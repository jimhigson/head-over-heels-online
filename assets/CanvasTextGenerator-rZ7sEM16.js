import{V as j,d as M,f,v as p,D as q,n as L,R as P,C as T,g as z,h as H,i as X,j as V}from"./App-Ct4kB5SW.js";var Q=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;class b extends j{constructor(t){t instanceof M&&(t={context:t});const{context:e,roundPixels:o,...r}=t||{};super({label:"Graphics",...r}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new M,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=o??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||t?.context===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new b(this._context.clone()):(this._ownedContext=null,new b(this._context))}lineStyle(t,e,o){f(p,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const r={};return t&&(r.width=t),e&&(r.color=e),o&&(r.alpha=o),this.context.strokeStyle=r,this}beginFill(t,e){f(p,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const o={};return t!==void 0&&(o.color=t),e!==void 0&&(o.alpha=e),this.context.fillStyle=o,this}endFill(){f(p,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==M.defaultStrokeStyle.width||t.color!==M.defaultStrokeStyle.color||t.alpha!==M.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return f(p,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return f(p,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return f(p,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return f(p,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return f(p,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return f(p,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}let m=null,C=null;function $(x,t){m||(m=q.get().createCanvas(256,128),C=m.getContext("2d",{willReadFrequently:!0}),C.globalCompositeOperation="copy",C.globalAlpha=1),(m.width<x||m.height<t)&&(m.width=L(x),m.height=L(t))}function A(x,t,e){for(let o=0,r=4*e*t;o<t;++o,r+=4)if(x[r+3]!==0)return!1;return!0}function U(x,t,e,o,r){const i=4*t;for(let h=o,n=o*i+4*e;h<=r;++h,n+=i)if(x[n+3]!==0)return!1;return!0}function J(...x){let t=x[0];t.canvas||(t={canvas:x[0],resolution:x[1]});const{canvas:e}=t,o=Math.min(t.resolution??1,1),r=t.width??e.width,i=t.height??e.height;let h=t.output;if($(r,i),!C)throw new TypeError("Failed to get canvas 2D context");C.drawImage(e,0,0,r,i,0,0,r*o,i*o);const c=C.getImageData(0,0,r,i).data;let s=0,l=0,d=r-1,u=i-1;for(;l<i&&A(c,r,l);)++l;if(l===i)return P.EMPTY;for(;A(c,r,u);)--u;for(;U(c,r,s,l,u);)++s;for(;U(c,r,d,l,u);)--d;return++d,++u,C.globalCompositeOperation="source-over",C.strokeRect(s,l,d-s,u-l),C.globalCompositeOperation="copy",h??(h=new P),h.set(s/o,l/o,(d-s)/o,(u-l)/o),h}const W=new P;class K{getCanvasAndContext(t){const{text:e,style:o,resolution:r=1}=t,i=o._getFinalPadding(),h=T.measureText(e||" ",o),n=Math.ceil(Math.ceil(Math.max(1,h.width)+i*2)*r),c=Math.ceil(Math.ceil(Math.max(1,h.height)+i*2)*r),s=z.getOptimalCanvasAndContext(n,c);this._renderTextToCanvas(e,o,i,r,s);const l=o.trim?J({canvas:s.canvas,width:n,height:c,resolution:1,output:W}):W.set(0,0,n,c);return{canvasAndContext:s,frame:l}}returnCanvasAndContext(t){z.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,o,r,i){const{canvas:h,context:n}=i,c=H(e),s=T.measureText(t||" ",e),l=s.lines,d=s.lineHeight,u=s.lineWidths,v=s.maxLineWidth,_=s.fontProperties,k=h.height;if(n.resetTransform(),n.scale(r,r),n.textBaseline=e.textBaseline,e._stroke?.width){const g=e._stroke;n.lineWidth=g.width,n.miterLimit=g.miterLimit,n.lineJoin=g.join,n.lineCap=g.cap}n.font=c;let w,S;const B=e.dropShadow?2:1;for(let g=0;g<B;++g){const G=e.dropShadow&&g===0,y=G?Math.ceil(Math.max(1,k)+o*2):0,D=y*r;if(G){n.fillStyle="black",n.strokeStyle="black";const a=e.dropShadow,I=a.color,E=a.alpha;n.shadowColor=X.shared.setValue(I).setAlpha(E).toRgbaString();const Y=a.blur*r,F=a.distance*r;n.shadowBlur=Y,n.shadowOffsetX=Math.cos(a.angle)*F,n.shadowOffsetY=Math.sin(a.angle)*F+D}else{if(n.fillStyle=e._fill?V(e._fill,n,s,o*2):null,e._stroke?.width){const a=e._stroke.width*.5+o*2;n.strokeStyle=V(e._stroke,n,s,a)}n.shadowColor="black"}let R=(d-_.fontSize)/2;d-_.fontSize<0&&(R=0);const O=e._stroke?.width??0;for(let a=0;a<l.length;a++)w=O/2,S=O/2+a*d+_.ascent+R,e.align==="right"?w+=v-u[a]:e.align==="center"&&(w+=(v-u[a])/2),e._stroke?.width&&this._drawLetterSpacing(l[a],e,i,w+o,S+o-y,!0),e._fill!==void 0&&this._drawLetterSpacing(l[a],e,i,w+o,S+o-y)}}_drawLetterSpacing(t,e,o,r,i,h=!1){const{context:n}=o,c=e.letterSpacing;let s=!1;if(T.experimentalLetterSpacingSupported&&(T.experimentalLetterSpacing?(n.letterSpacing=`${c}px`,n.textLetterSpacing=`${c}px`,s=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px")),c===0||s){h?n.strokeText(t,r,i):n.fillText(t,r,i);return}let l=r;const d=T.graphemeSegmenter(t);let u=n.measureText(t).width,v=0;for(let _=0;_<d.length;++_){const k=d[_];h?n.strokeText(k,l,i):n.fillText(k,l,i);let w="";for(let S=_+1;S<d.length;++S)w+=d[S];v=n.measureText(w).width,l+=u-v+c,u=v}}}const Z=new K;export{Z as C,b as G,Q as v};
