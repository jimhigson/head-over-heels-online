const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebGPURenderer-CYHdCSXE.js","assets/index-DYhBWggE.js","assets/index-B_a7eVs0.css","assets/colorToUniform-KTpA7KSL.js","assets/SharedSystems-BDI4Y2pc.js","assets/Graphics-BcjiiWzY.js","assets/WebGLRenderer-CtNR0pDp.js"])))=>i.map(i=>d[i]);
import{s as ho,x as _n,y as be,e as It,E as me,a as fo,C as y,d as dt,v as ut,Z as I,D as ht,a5 as Bt,k as po,K as Be,t as ke,T as Oe,U as mo,a6 as go,a7 as vo,a8 as yo,a9 as b,aa as Fn,ab as xo,ac as An,ad as wo,ae as Ve,af as P,ag as Pt,ah as ft,ai as He,aj as v,ak as bo,al as X,am as Ht,an as M,ao as Lt,ap as ge,aq as pe,ar as Ie,as as Sn,at as To,au as ne,av as D,aw as pt,ax as Co,ay as Pe,az as ko,aA as k,aB as ve,aC as je,aD as Oo,aE as Te,aF as Io,aG as G,aH as _t,aI as Po,aJ as _o,aK as Fo,aL as te,aM as le,aN as tt,aO as Le,aP as mt,aQ as Ut,aR as nt,aS as Ft,aT as O,aU as At,aV as Y,aW as Ao,aX as St,aY as Xt,aZ as Rn,a_ as ae,a$ as So,b0 as Ro,b1 as qe,b2 as U,b3 as Z,b4 as Je,b5 as zn,b6 as Gt,b7 as Dn,b8 as _,b9 as zo,ba as gt,bb as Ue,bc as Do,bd as Mo,be as Mn,bf as Eo,bg as ye,bh as Xe,bi as Rt,bj as ie,bk as No,bl as $o,bm as Wo,bn as Bo,bo as Ho,bp as Vt,bq as vt,br as yt,bs as xt,bt as Lo,bu as xe,bv as Uo,bw as zt,bx as Xo,by as Go,bz as Vo,bA as w,bB as Q,bC as ot,bD as En,bE as Ne,bF as jo,bG as qo,bH as st,bI as Jo,bJ as Zo,bK as Yo,bL as Ko,bM as Qo,bN as es}from"./index-DYhBWggE.js";import{S as ts,G as re}from"./Graphics-BcjiiWzY.js";const Nn=class wt extends ho{constructor(t){t={...wt.defaultOptions,...t},super(t),this.enabled=!0,this._state=ts.for2d(),this.blendMode=t.blendMode,this.padding=t.padding,typeof t.antialias=="boolean"?this.antialias=t.antialias?"on":"off":this.antialias=t.antialias,this.resolution=t.resolution,this.blendRequired=t.blendRequired,this.clipToViewport=t.clipToViewport,this.addResource("uTexture",0,1)}apply(t,n,o,s){t.applyFilter(this,n,o,s)}get blendMode(){return this._state.blendMode}set blendMode(t){this._state.blendMode=t}static from(t){const{gpu:n,gl:o,...s}=t;let r,i;return n&&(r=_n.from(n)),o&&(i=be.from(o)),new wt({gpuProgram:r,glProgram:i,...s})}};Nn.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let Ze=Nn;const bt=[];It.handleByNamedList(me.Environment,bt);async function ns(e){if(!e)for(let t=0;t<bt.length;t++){const n=bt[t];if(n.value.test()){await n.value.load();return}}}let de;function os(){if(typeof de=="boolean")return de;try{de=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{de=!1}return de}var $n=(e=>(e[e.NONE=0]="NONE",e[e.COLOR=16384]="COLOR",e[e.STENCIL=1024]="STENCIL",e[e.DEPTH=256]="DEPTH",e[e.COLOR_DEPTH=16640]="COLOR_DEPTH",e[e.COLOR_STENCIL=17408]="COLOR_STENCIL",e[e.DEPTH_STENCIL=1280]="DEPTH_STENCIL",e[e.ALL=17664]="ALL",e))($n||{});class ss{constructor(t){this.items=[],this._name=t}emit(t,n,o,s,r,i,a,c){const{name:l,items:d}=this;for(let u=0,h=d.length;u<h;u++)d[u][l](t,n,o,s,r,i,a,c);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const n=this.items.indexOf(t);return n!==-1&&this.items.splice(n,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const rs=["init","destroy","contextChange","resolutionChange","reset","renderEnd","renderStart","render","update","postrender","prerender"],Wn=class Bn extends fo{constructor(t){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const n=[...rs,...this.config.runners??[]];this._addRunners(...n),this._unsafeEvalCheck()}async init(t={}){const n=t.skipExtensionImports===!0?!0:t.manageImports===!1;await ns(n),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const o in this._systemsHash)t={...this._systemsHash[o].constructor.defaultOptions,...t};t={...Bn.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let o=0;o<this.runners.init.items.length;o++)await this.runners.init.items[o].init(t);this._initOptions=t}render(t,n){let o=t;if(o instanceof y&&(o={container:o},n&&(dt(ut,"passing a second argument is deprecated, please use render options instead"),o.target=n.renderTexture)),o.target||(o.target=this.view.renderTarget),o.target===this.view.renderTarget&&(this._lastObjectRendered=o.container,o.clearColor=this.background.colorRgba),o.clearColor){const s=Array.isArray(o.clearColor)&&o.clearColor.length===4;o.clearColor=s?o.clearColor:I.shared.setValue(o.clearColor).toArray()}o.transform||(o.container.updateLocalTransform(),o.transform=o.container.localTransform),o.container.enableRenderGroup(),this.runners.prerender.emit(o),this.runners.renderStart.emit(o),this.runners.render.emit(o),this.runners.renderEnd.emit(o),this.runners.postrender.emit(o)}resize(t,n,o){const s=this.view.resolution;this.view.resize(t,n,o),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),o!==void 0&&o!==s&&this.runners.resolutionChange.emit(o)}clear(t={}){const n=this;t.target||(t.target=n.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=$n.ALL);const{clear:o,clearColor:s,target:r}=t;I.shared.setValue(s??this.background.colorRgba),n.renderTarget.clear(r,o,I.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(n=>{this.runners[n]=new ss(n)})}_addSystems(t){let n;for(n in t){const o=t[n];this._addSystem(o.value,o.name)}}_addSystem(t,n){const o=new t(this);if(this[n])throw new Error(`Whoops! The name "${n}" is already in use`);this[n]=o,this._systemsHash[n]=o;for(const s in this.runners)this.runners[s].add(o);return this}_addPipes(t,n){const o=n.reduce((s,r)=>(s[r.name]=r.value,s),{});t.forEach(s=>{const r=s.value,i=s.name,a=o[i];this.renderPipes[i]=new r(this,a?new a:null)})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach(n=>{n.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!os())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}};Wn.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Hn=Wn,_e;function is(e){return _e!==void 0||(_e=(()=>{const t={stencil:!0,failIfMajorPerformanceCaveat:e??Hn.defaultOptions.failIfMajorPerformanceCaveat};try{if(!ht.get().getWebGLRenderingContext())return!1;let o=ht.get().createCanvas().getContext("webgl",t);const s=!!o?.getContextAttributes()?.stencil;if(o){const r=o.getExtension("WEBGL_lose_context");r&&r.loseContext()}return o=null,s}catch{return!1}})()),_e}let Fe;async function as(e={}){return Fe!==void 0||(Fe=await(async()=>{const t=ht.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(e)).requestDevice(),!0}catch{return!1}})()),Fe}const jt=["webgl","webgpu","canvas"];async function cs(e){let t=[];e.preference?(t.push(e.preference),jt.forEach(r=>{r!==e.preference&&t.push(r)})):t=jt.slice();let n,o={};for(let r=0;r<t.length;r++){const i=t[r];if(i==="webgpu"&&await as()){const{WebGPURenderer:a}=await Bt(async()=>{const{WebGPURenderer:c}=await import("./WebGPURenderer-CYHdCSXE.js");return{WebGPURenderer:c}},__vite__mapDeps([0,1,2,3,4,5]));n=a,o={...e,...e.webgpu};break}else if(i==="webgl"&&is(e.failIfMajorPerformanceCaveat??Hn.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await Bt(async()=>{const{WebGLRenderer:c}=await import("./WebGLRenderer-CtNR0pDp.js");return{WebGLRenderer:c}},__vite__mapDeps([6,1,2,3,4,5]));n=a,o={...e,...e.webgl};break}else if(i==="canvas")throw o={...e},new Error("CanvasRenderer is not yet implemented")}if(delete o.webgpu,delete o.webgl,!n)throw new Error("No available renderer for the current environment");const s=new n;return await s.init(o),s}const Ln="8.6.6";class Un{static init(){globalThis.__PIXI_APP_INIT__?.(this,Ln)}static destroy(){}}Un.extension=me.Application;class ls{constructor(t){this._renderer=t}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,Ln)}destroy(){this._renderer=null}}ls.extension={type:[me.WebGLSystem,me.WebGPUSystem],name:"initHook",priority:-10};const Xn=class Tt{constructor(...t){this.stage=new y,t[0]!==void 0&&dt(ut,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.renderer=await cs(t),Tt._plugins.forEach(n=>{n.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return dt(ut,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,n=!1){const o=Tt._plugins.slice(0);o.reverse(),o.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(n),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Xn._plugins=[];let Gn=Xn;It.handleByList(me.Application,Gn._plugins);It.add(Un);var ds=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,us=`
in vec2 vTextureCoord;

out vec4 finalColor;

uniform float uAlpha;
uniform sampler2D uTexture;

void main()
{
    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;
}
`,qt=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
 
    var sample = textureSample(uTexture, uSampler, uv);
    
    return sample * alphaUniforms.uAlpha;
}`;const Vn=class jn extends Ze{constructor(t){t={...jn.defaultOptions,...t};const n=_n.from({vertex:{source:qt,entryPoint:"mainVertex"},fragment:{source:qt,entryPoint:"mainFragment"}}),o=be.from({vertex:ds,fragment:us,name:"alpha-filter"}),{alpha:s,...r}=t,i=new po({uAlpha:{value:s,type:"f32"}});super({...r,gpuProgram:n,glProgram:o,resources:{alphaUniforms:i}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(t){this.resources.alphaUniforms.uniforms.uAlpha=t}};Vn.defaultOptions={alpha:1};let hs=Vn;class Ge extends Be{constructor(...t){let n=t[0];Array.isArray(t[0])&&(n={textures:t[0],autoUpdate:t[1]});const{textures:o,autoUpdate:s,...r}=n,[i]=o;super({...r,texture:i instanceof ke?i:i.texture}),this._textures=null,this._durations=null,this._autoUpdate=s??!0,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=o}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Oe.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Oe.shared.add(this.update,this,mo.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const n=t.deltaTime,o=this.animationSpeed*n,s=this.currentFrame;if(this._durations!==null){let r=this._currentTime%1*this._durations[this.currentFrame];for(r+=o/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*n);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=o;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):s!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<s||this.animationSpeed<0&&this.currentFrame>s)&&this.onLoop(),this._updateTexture())}_updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this.texture=this._textures[t],this.updateAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const n=[];for(let o=0;o<t.length;++o)n.push(ke.from(t[o]));return new Ge(n)}static fromImages(t){const n=[];for(let o=0;o<t.length;++o)n.push(ke.from(t[o]));return new Ge(n)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof ke)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let n=0;n<t.length;n++)this._textures.push(t[n].texture),this._durations.push(t[n].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const n=this.currentFrame;this._currentTime=t,n!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Oe.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Oe.shared.add(this.update,this),this._isConnectedToTicker=!0))}}var Ae={},Jt;function fs(){if(Jt)return Ae;Jt=1;var e=go(),t=e.mark(r),n=vo(),o=n.wrapWithIterableIterator,s=n.ensureIterable;function r(){var a,c,l,d,u,h,f=arguments;return e.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:for(a=f.length,c=new Array(a),l=0;l<a;l++)c[l]=f[l];d=0,u=c;case 2:if(!(d<u.length)){g.next=8;break}return h=u[d],g.delegateYield(s(h),"t0",5);case 5:d++,g.next=2;break;case 8:case"end":return g.stop()}},t)}Ae.__concat=r;var i=o(r);return Ae.concat=i,Ae}var rt,Zt;function ps(){return Zt||(Zt=1,rt=fs().concat),rt}var ms=ps();const $e=yo(ms),Yt={x:.5,y:1},Kt=e=>typeof e!="string"&&Object.hasOwn(e,"frames"),p=e=>{if(typeof e=="string")return p({texture:e});{const{anchor:t,flipX:n,pivot:o,x:s,y:r,filter:i}=e;let a;if(Kt(e)?a=gs(e):a=new Be(b.textures[e.texture]),t===void 0&&o===void 0)if(Kt(e))a.anchor=Yt;else{const c=b.data.frames[e.texture].frame;c.pivot!==void 0?a.pivot=c.pivot:a.anchor=Yt}else t!==void 0&&(a.anchor=t),o!==void 0&&(a.pivot=o);return s!==void 0&&(a.x=s),r!==void 0&&(a.y=r),i!==void 0&&(a.filters=i),a.eventMode="static",n===!0&&(a.scale.x=-1),a}};function gs({frames:e,animationSpeed:t,reverse:n,playOnce:o}){const s=e.map(i=>({texture:i,time:Fn}));n&&s.reverse();const r=new Ge(s);return r.animationSpeed=t||xo,r.play(),o!==void 0&&(r.loop=!1,r.onComplete=()=>{r.stop(),o==="and-destroy"&&(r.visible=!1)}),r}const vs=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","Å","Ä","Ö","0","1","2","3","4","5","6","7","8","9","!","@","#","$","%","^","&","*","(",")","-","_","=","+","[","]","{","}",";",":","'",'"',",",".","/","<",">","?","\\","|"," ","Enter","Shift","Control","Alt","`","~","Tab","Backspace","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadAdd","NumpadSubtract","NumpadMultiply","NumpadDivide","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"],Qt=e=>vs.includes(e),qn=["jump","fire","carry","swop","hold"],Jn=()=>({...An(qn.map(e=>[e,!1])),windowFocus:!0,direction:{x:0,y:0,z:0}}),ys=Object.freeze(Jn());function*en(e,t){for(const[n,o]of wo(e))o.includes(t)&&(yield n)}const tn=e=>e.length===1?e.toUpperCase():e,nn=e=>e==="away"||e==="towards"||e==="left"||e==="right",xs=({keyAssignment:e,inputState:t,onInputStateChange:n})=>{let o=0;const s={},r=()=>{let d=-1,u;for(const[h,f]of Ve(s))f>d&&(d=f,u=h);t.direction=u===void 0?P:Pt[u]},i=({key:d,repeat:u})=>{if(u)return;const h=tn(d);if(!Qt(h)){console.log("do not recognise key: ",h);return}for(const f of en(e,h))nn(f)?s[f]=o++:t[f]=!0;r(),n?.(t)},a=({key:d})=>{const u=tn(d);if(Qt(u)){for(const h of en(e,u))nn(h)?delete s[h]:t[h]=!1;r(),n?.(t)}},c=()=>{t.windowFocus=!0,n?.(t)},l=()=>{t.windowFocus=!1;for(const d of qn)t[d]=!1;n?.(t)};return window.focus(),window.addEventListener("keydown",i,!1),window.addEventListener("keyup",a,!1),window.addEventListener("focus",c,!1),window.addEventListener("blur",l,!1),()=>{window.removeEventListener("keydown",i,!1),window.removeEventListener("keyup",a,!1),window.removeEventListener("focus",c,!1),window.removeEventListener("blur",l,!1)}};function ws(e){return{all:e=e||new Map,on:function(t,n){var o=e.get(t);o?o.push(n):e.set(t,[n])},off:function(t,n){var o=e.get(t);o&&(n?o.splice(o.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var o=e.get(t);o&&o.slice().map(function(s){s(n)}),(o=e.get("*"))&&o.slice().map(function(s){s(t,n)})}}}const L={right:["P"],towards:["A"],left:["O"],away:["Q"],jump:[" ","M"],carry:["C","M"],fire:["N"],swop:["Enter","S"],hold:["H"]},bs={right:["ArrowRight",...L.right],towards:["ArrowDown",...L.towards],left:["ArrowLeft",...L.left],away:["ArrowUp",...L.away],jump:["`",...L.jump],carry:["Shift","`",...L.carry],fire:["D",...L.fire],swop:L.swop,hold:["F8",...L.hold]},Ts={right:["D"],towards:["S"],left:["A"],away:["W"],jump:[" ","F","P"],carry:["Shift","F","I","P"],fire:["E","O"],swop:["Q"],hold:["H"]},Cs={start:"1",coin:"5",directions:{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},buttons:["Control","Alt"," ","Shift","Z"]},ks={start:"2",coin:"6",directions:{up:"R",down:"F",left:"D",right:"G"},buttons:["A","S","Q","W","E"]},Os=(...e)=>({right:e.map(t=>t.directions.right),towards:e.map(t=>t.directions.down),left:e.map(t=>t.directions.left),away:e.map(t=>t.directions.up),jump:e.map(t=>[t.buttons[0],t.buttons[3]]).flat(),carry:e.map(t=>[t.buttons[1],t.buttons[3]]).flat(),fire:e.map(t=>t.buttons[2]),swop:e.map(t=>t.start),hold:e.map(t=>t.coin)}),Is={original:L,default:bs,mameP1P2:Os(Cs,ks),wasd:Ts},Ps=e=>{const t={};for(const n of Object.values(e.rooms))for(const o of Object.values(n.items))if(o.type==="player"){const{which:s}=o.config;t[s]=n.id}if(t.head===void 0&&t.heels===void 0)throw new Error("couldn't find either head or heels in campaign");return t},_s=({campaign:e,renderOptions:t})=>{const n=Ps(e),o=An(Object.keys(e.rooms).map(i=>[i,{}])),s=n.head&&ft(e.rooms[n.head],o[n.head],!0),r=n.heels===n.head?s:n.heels&&ft(e.rooms[n.heels],o[n.heels],!0);return{keyAssignment:Is.default,currentCharacterName:n.head===void 0?"heels":"head",characterRooms:{head:s,heels:r},entryState:{head:s===void 0?void 0:He(s.items.head),heels:r===void 0?void 0:He(r.items.heels)},inputState:Jn(),renderOptions:t,campaign:e,events:ws(),pickupsCollected:o,gameTime:0,progression:0,gameSpeed:1}},Fs={showBoundingBoxes:"none",showShadowMasks:!1,scaleFactor:1},N={original:new I("rgb(255, 255, 255)"),basic:new I("rgb(210, 210, 210)"),dimmed:new I("rgb(120, 120, 120)")},$={original:new I("rgb(255, 255, 0)"),basic:new I("hsl(50,65%,70%)"),dimmed:v.redShadow},B={original:new I("rgb(255, 0, 255)"),basic:v.pink,dimmed:new I("hsl(290,35%,38%)")},T={original:new I("rgb(0, 255, 255)"),basic:new I("hsl(183, 50%, 50%)"),dimmed:new I("hsl(183, 50%, 25%)")},H={original:new I("rgb(0, 255, 0)"),basic:v.moss,dimmed:new I("hsl(73,50%,25%)")},Dt={white:{basic:{main:N,edges:{towards:T,right:$},hud:{lives:$,dimmed:B,icons:T}},dimmed:{main:N,edges:{towards:H,right:T},hud:{lives:$,dimmed:B,icons:T}}},yellow:{basic:{main:$,edges:{towards:H,right:N},hud:{lives:T,dimmed:B,icons:H}},dimmed:{main:$,edges:{towards:T,right:T},hud:{lives:T,dimmed:B,icons:H}}},magenta:{basic:{main:B,edges:{towards:H,right:T},hud:{lives:N,dimmed:T,icons:$}},dimmed:{main:B,edges:{towards:H,right:T},hud:{lives:N,dimmed:T,icons:$}}},cyan:{basic:{main:T,edges:{towards:B,right:N},hud:{lives:N,dimmed:H,icons:$}},dimmed:{main:T,edges:{towards:B,right:N},hud:{lives:N,dimmed:H,icons:$}}},green:{basic:{main:H,edges:{towards:T,right:$},hud:{lives:N,dimmed:B,icons:T}},dimmed:{main:H,edges:{towards:T,right:$},hud:{lives:N,dimmed:B,icons:T}}}},Zn=e=>Dt[e.hue][e.shade],Mt=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,As=`in vec2 vTextureCoord;
out vec4 finalColor;

const int SWOP_COUNT = \${SWOP_COUNT};

uniform sampler2D uTexture;
uniform vec3 uOriginal[SWOP_COUNT];
uniform vec3 uReplacement[SWOP_COUNT];

// colours are floats so check if they're very close rather than exactly equal:
bool colorsEffectivelyEqual(vec3 color1, vec3 color2) {       
    return distance(color1, color2) < 0.05;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    if( c.a == 0.0 ) {
        finalColor = c;
        return;
    }
    
    for(int i = 0; i < SWOP_COUNT; i++) {
        if ( colorsEffectivelyEqual(c.rgb, uOriginal[i]) ) {
            finalColor = vec4(uReplacement[i], c.a);            
            return;
        }
    }    
    finalColor = vec4(c.rgb, c.a);
}
`;class Ye extends Ze{constructor(t){const n=Object.keys(t).length,o=be.from({vertex:Mt,fragment:As.replace(/\$\{SWOP_COUNT\}/g,n.toFixed(0)),name:"palette-swop-filter"});super({glProgram:o,resources:{colorReplaceUniforms:{uOriginal:{value:new Float32Array(3*n),type:"vec3<f32>",size:n},uReplacement:{value:new Float32Array(3*n),type:"vec3<f32>",size:n}}}});const s=this.resources.colorReplaceUniforms.uniforms;Object.entries(t).forEach(([r,i],a)=>{v[r].toArray().forEach((c,l)=>{s.uOriginal[a*3+l]=c}),i.toArray().forEach((c,l)=>{s.uReplacement[a*3+l]=c})})}}const Yn=({basic:e,dimmed:t})=>({replaceLight:e,replaceDark:t}),Kn=e=>Yn(Dt[e.color.hue][e.color.shade].main),Ss=e=>new Ye({lightBeige:v.lightGrey,redShadow:v.shadow,pink:v.lightGrey,moss:v.lightGrey,midRed:v.midGrey,highlightBeige:v.lightGrey,...Kn(e)}),Rs=new Ye({midGrey:v.midRed,lightGrey:v.lightBeige,white:v.highlightBeige,metallicBlue:v.redShadow,pink:v.midRed,moss:v.midRed,replaceDark:v.midRed,replaceLight:v.lightBeige}),Ct=(e,t)=>new Ye(Yn(Dt[e.color.hue][e.color.shade].edges[t])),J=e=>new Ye(Kn(e)),he=bo,zs=`precision mediump float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uSourceBlacks[2];
uniform vec3 uTargetColor;

// colours are floats so check if they're very close rather than exactly equal:
bool colorsEffectivelyEqual(vec3 color1, vec3 color2) {    
    
    return distance(color1, color2) < 0.05;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    if( c.a == 0.0 ) {
        finalColor = c;
        return;
    }

    if ( colorsEffectivelyEqual(c.rgb, uSourceBlacks[0]) || colorsEffectivelyEqual(c.rgb, uSourceBlacks[1])) {
        finalColor = vec4(0,0,0, 1.0);
    } else {
        finalColor = vec4(uTargetColor, 1);    
    }
}
`,on=[v.pureBlack,v.lightBlack];class fe extends Ze{uniforms;constructor(t="white"){const n=be.from({vertex:Mt,fragment:zs,name:"revert-colourise-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uSourceBlacks:{value:new Float32Array(6),type:"vec3<f32>",size:6},uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms;const[o,s,r]=on[0].toArray();this.uniforms.uSourceBlacks[0]=o,this.uniforms.uSourceBlacks[1]=s,this.uniforms.uSourceBlacks[2]=r;const[i,a,c]=on[1].toArray();this.uniforms.uSourceBlacks[3]=i,this.uniforms.uSourceBlacks[4]=a,this.uniforms.uSourceBlacks[5]=c,this.targetColor=t}set targetColor(t){const[n,o,s]=new I(t).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=o,this.uniforms.uTargetColor[2]=s}}function Ke(e,t){const n=t||new y;for(const o of e)n.addChild(o);return n}const Qn=e=>{const t=X(e,"head"),n=X(e,"heels");return t!==void 0&&n!==void 0&&t.state.action==="idle"&&n.state.action==="idle"&&t.state.standingOn===n},eo=e=>{if(e===void 0)return 0;const{shieldCollectedAt:t,gameTime:n}=e;return t!==null&&t+Ht>n?100-Math.ceil((n-t)/(Ht/100)):0},to=e=>{const t=100*M.w;return e.totalWalkDistance<=e.fastStepsStartedAtDistance+t?100-Math.ceil((e.totalWalkDistance-e.fastStepsStartedAtDistance)/M.w):0},Ds=24,Ms=56,Es=80,sn=112,ue=e=>e==="heels"?1:-1;function*Ns(e){const t=e.toString().split(""),n=t.length;for(let o=0;o<n;o++){const s=`hud.char.${t[o]}`;To(s),yield p({texture:s,x:(o+.5-n/2)*Sn.w})}}function Se(e,t){for(const n of e.children)n.destroy();Ke(Ns(t),e)}const $s=e=>{const t=new fe,n=new fe,o=new fe,s=new fe,r=(l=!1)=>{const d=l?2:1,u=new y;return u.scale={x:1,y:d},u},i=l=>{const d=new Be(b.textures[`${l}.walking.${l==="head"?"right":"towards"}.2`]);return d.anchor={x:.5,y:0},d},a=(l,d=!1,u=!1)=>{const h=new y;h.pivot={x:4,y:16};const f=new Be({texture:b.textures[l],anchor:d?{x:.5,y:0}:{x:.5,y:1},filters:t,y:d?0:8});h.addChild(f);const m=r();return m.y=d?0:16,m.filters=n,m.x=f.x=Sn.w/2,h.addChild(m),u&&(m.visible=!1),{text:m,icon:f,container:h}},c={head:{sprite:i("head"),livesText:r(!0),shield:a("hud.shield"),extraSkill:a("hud.fastSteps"),donuts:a("donuts",!0),hooter:a("hooter",!0,!0)},heels:{sprite:i("heels"),livesText:r(!0),shield:a("hud.shield"),extraSkill:a("hud.bigJumps"),bag:a("bag",!0,!0),carrying:{container:new y}}};for(const l of Lt)e.addChild(c[l].livesText),e.addChild(c[l].sprite),e.addChild(c[l].shield.container),e.addChild(c[l].extraSkill.container);return e.addChild(c.head.donuts.container),e.addChild(c.head.hooter.container),e.addChild(c.heels.bag.container),e.addChild(c.heels.carrying.container),(l,d)=>{const u=ge(l),{hud:{dimmed:h,lives:f,icons:m}}=Zn(u.color),g=x=>{const z=Ie(l,x),{text:q,container:F}=c[x].shield,{text:$t,container:Wt}=c[x].extraSkill;Wt.x=F.x=(d.x>>1)+ue(x)*Es,Se(q,eo(z)),F.y=d.y,Se($t,z===void 0?0:x==="head"?to(z):z.bigJumps),Wt.y=d.y-24},S=x=>{const{currentCharacterName:z}=l,q=z===x||z==="headOverHeels",F=c[x].sprite;q?F.filters=he:Qn(l)?(s.targetColor=h.basic,F.filters=s):F.filters=o,F.x=(d.x>>1)+ue(x)*Ms,F.y=d.y-pe.h},C=x=>{const q=Ie(l,x)?.lives??0,F=c[x].livesText;F.x=(d.x>>1)+ue(x)*Ds,F.y=d.y,F.tint=f.basic,Se(F,q??0)},R=x=>{const{container:z}=c.heels.carrying,q=z.children.length>0;if(x===null&&q)for(const F of z.children)F.destroy();x!==null&&!q&&z.addChild(p(x.type==="spring"?"spring.released":x.config.style))};o.targetColor=h.dimmed,n.targetColor=h.basic,t.targetColor=m.basic;for(const x of Lt)C(x),S(x),g(x);c.head.hooter.container.x=c.head.donuts.container.x=(d.x>>1)+ue("head")*sn,c.head.donuts.container.y=d.y-pe.h-8,c.heels.carrying.container.y=d.y-pe.h,c.heels.carrying.container.x=c.heels.bag.container.x=(d.x>>1)+ue("heels")*sn,c.heels.bag.container.y=c.head.hooter.container.y=d.y-8;const V=Ie(l,"head"),E=V?.hasHooter??!1;c.head.hooter.icon.filters=E?he:o;const j=V?.donuts??0;c.head.donuts.icon.filters=j!==0?he:o,Se(c.head.donuts.text,j);const ce=Ie(l,"heels"),Ce=ce?.hasBag??!1;R(ce?.carrying??null),c.heels.bag.icon.filters=Ce?he:o}},rn={movementType:"vel",vels:{gravity:P}},Ws=(e,t,n)=>{if(!ne(e))return rn;const{type:o,state:{vels:{gravity:{z:s}},standingOn:r}}=e,a=Co[(o==="headOverHeels"?"head":o)==="head"?"head":"others"];return r!==null?D("lift")(r)&&r.state.vels.lift.z<0?{movementType:"vel",vels:{gravity:{z:Math.max(s-pt*n,-a)}}}:rn:{movementType:"vel",vels:{gravity:{z:Math.max(s-pt*n,-a)}}}},Qe={movementType:"steady"},Re=e=>{const n=e/ko*Fn;return(e+.5*pt*n**2)/n},Bs={head:Re(Pe.head),headOnSpring:Re(Pe.head+M.h),heels:Re(Pe.heels),heelsOnSpring:Re(Pe.heels+M.h)},Hs=(e,t)=>{const n=e.type==="headOverHeels"?"head":e.type==="heels"&&e.state.bigJumps>0?(e.state.bigJumps--,"head"):e.type;return Bs[`${n}${t?"OnSpring":""}`]},no=(e,t)=>{const{state:{standingOn:n}}=e,{inputState:{jump:o}}=t,s=n!==null&&D("teleporter")(n);if(!(o&&n!==null&&!s))return n!==null?{movementType:"steady",stateDelta:{jumped:!1}}:Qe;const i=D("spring")(n);return{movementType:"vel",vels:{gravity:{x:0,y:0,z:Hs(e,i)}},stateDelta:{action:"moving",jumped:!0}}},Ls=({vel:e,acc:t,unitD:n,maxSpeed:o,deltaMS:s,minSpeed:r=0})=>{const i=ve(e),a=Math.max(r,Math.min(o,i+t*s)),c=Math.min(a,o);return k(n,c)},an={movementType:"vel",vels:{walking:P}},oo=(e,t,n)=>{const o=Us(e,t,n);if(o.movementType==="vel"&&o.vels.walking!==void 0){const s=ve(o.vels.walking);o.stateDelta=Object.assign(o.stateDelta||{},{walkDistance:s===0?0:e.state.walkDistance+s*n}),e.type==="head"&&e.state.standingOn!==null&&(o.stateDelta=Object.assign(o.stateDelta||{},{totalWalkDistance:e.state.totalWalkDistance+s*n}))}return o},Us=(e,{inputState:t,currentCharacterName:n},o)=>{const{type:s,state:{action:r,autoWalk:i,standingOn:a,facing:c,teleporting:l,walkDistance:d,vels:{walking:u,gravity:h}}}=e,m=n===e.id?t:ys,g=s==="headOverHeels"||s==="head"&&to(e.state)>0&&a!==null?"heels":s,S=i?c:m.direction,C=G[g];if(l!==null||r==="death")return an;if(s==="heels"){if(a===null)return e.state.jumped?{movementType:"vel",vels:{walking:je(u,k(u,Oo*o))}}:an;if(m.jump){const Ce=_t(S,te)?c:S,z=D("spring")(a)?1:Po;return{movementType:"vel",vels:{walking:k({...Ce,z:0},C*z)},stateDelta:{facing:Te(Ce)}}}}const R=a===null&&h.z<0;if(ve(S)!==0)return R?{movementType:"vel",vels:{walking:k({...S,z:0},C)},stateDelta:{facing:S,action:"falling"}}:{movementType:"vel",vels:{walking:Ls({vel:u,acc:_o[g],deltaMS:o,maxSpeed:C,unitD:S,minSpeed:0})},stateDelta:{facing:S,action:"moving"}};const E=ve(u);if(d>0&&d<1)return{movementType:"position",posDelta:k(c,1-d),stateDelta:{action:R?"falling":"idle",walkDistance:0}};const j=E===0?P:k(u,1/E),ce=Math.max(E-Fo[g]*o,0);return{movementType:"vel",vels:{walking:k(j,ce<Io[g]?0:ce)},stateDelta:{action:R?"falling":"idle"}}},cn=M.h,ze=.001,Xs=({totalDistance:e,currentAltitude:t,direction:n})=>{const o=tt**2/(2*le);if(n==="up"){if(t<=o)return Math.max(ze,Math.sqrt(2*le*Math.max(t,0)));if(t>=e-o){const s=Math.max(0,e-t);return Math.max(ze,Math.sqrt(2*le*s))}else return tt}else if(t>=e-o){const s=Math.max(0,e-t);return Math.min(-ze,-Math.sqrt(2*le*s))}else return t<=o?Math.min(-ze,-Math.sqrt(2*le*Math.max(t,0))):-tt};function Gs({config:{bottom:e,top:t},state:{direction:n,position:{z:o}}},s,r){const i=e*cn,a=t*cn,c=Xs({currentAltitude:o-i,direction:n,totalDistance:a-i});if(Number.isNaN(c))throw new Error("velocity is NaN");const l=o<=i?"up":o>=a?"down":n;return{movementType:"vel",vels:{lift:{x:0,y:0,z:c}},stateDelta:{direction:l}}}const Vs=.5,oe=(e,t,n,o)=>{const s=n.x+o.x-e.x,r=n.y+o.y-e.y,i=n.z+o.z-e.z,a=e.x+t.x-n.x,c=e.y+t.y-n.y,l=e.z+t.z-n.z,d=Math.abs(s)<Math.abs(a)?s:-a,u=Math.abs(r)<Math.abs(c)?r:-c,h=Math.abs(i)<Math.abs(l)?i:-l,f=Math.abs(d),m=Math.abs(u),g=Math.abs(h)*Vs;return f<m&&f<g?{x:d,y:0,z:0}:m<g?{x:0,y:u,z:0}:{x:0,y:0,z:h}},ln=(e,t)=>({x:e.x>0?t.state.position.x:t.state.position.x+t.aabb.x,y:e.y>0?t.state.position.y:t.state.position.y+t.aabb.y,z:e.z>0?t.state.position.z:t.state.position.z+t.aabb.z}),dn={stopAutowalk:0,portal:0,wall:0,doorLegs:0,sceneryPlayer:0,bubbles:0,block:1,barrier:1,floor:1,book:1,hushPuppy:1,teleporter:1,doorFrame:1,lift:2,movableBlock:2,portableBlock:2,slidingBlock:2,spring:2,ball:3,joystick:3,switch:3,charles:3,conveyor:3,head:4,heels:4,headOverHeels:4,pickup:8,firedDonut:9,slidingDeadly:10,moveableDeadly:10,deadlyBlock:10,baddie:10},so=(e,t)=>dn[e.type]-dn[t.type],js=(e,t)=>t.toSorted((n,o)=>{const s=so(n,o);if(s!==0)return s;const r=Le(e,ln(e,n)),i=Le(e,ln(e,o));return r-i});function ro({room:{roomTime:e},movingItem:t}){if(t.state.action==="death")return;const n=t.type==="headOverHeels"?t.state.head:t.state;eo(n)>0||(t.state.action="death",t.state.expires=e+mt)}const qs=e=>{const{gameState:t,movingItem:n,touchedItem:o,room:{id:s}}=e;if(t.pickupsCollected[s][o.id]===!0)return;const r=t.pickupsCollected[s];switch(r[o.id]=!0,o.config.gives){case"hooter":{const i=nt(n);if(i!==void 0){i.hasHooter=!0;break}break}case"donuts":{const i=nt(n);i!==void 0&&(i.donuts+=6);break}case"bag":{const i=Ut(n);if(i!==void 0){i.hasBag=!0;break}break}case"shield":{n.type==="headOverHeels"?(n.state.head.shieldCollectedAt=n.state.head.gameTime,n.state.heels.shieldCollectedAt=n.state.heels.gameTime):n.state.shieldCollectedAt=n.state.gameTime;break}case"fast":{const i=nt(n);i!==void 0&&(i.fastStepsStartedAtDistance=i.totalWalkDistance);break}case"jumps":{const i=Ut(n);i!==void 0&&(i.bigJumps+=10);break}case"extra-life":if(n.type==="headOverHeels"){n.state.head.lives+=2,n.state.heels.lives+=2;break}else n.state.lives+=2;break;case"scroll":t.inputState.jump=!1,t.events.emit("scrollOpened",{markdown:o.config.markdown});break;case"reincarnation":break;case"crown":break;default:o.config}},Js=({gameState:e,movingItem:t,touchedItem:n,movementVector:o})=>{const{config:{relativePoint:s,toRoom:r,direction:i},state:{position:a}}=n;Le(i,o)<=0||Ft({playableItem:t,gameState:e,toRoomId:r,positionRelativeToSourcePortal:je(t.state.position,O(a,s)),sourcePortal:n,changeType:"portal"})},Zs=({movingItem:e,movementVector:t,touchedItem:n})=>{const{config:{direction:o,part:s}}=n,r=At(o);if(s==="top")return;const i=s==="far"?{x:r==="x"?-Math.abs(t.y):0,y:r==="y"?-Math.abs(t.x):0,z:0}:{x:r==="x"?Math.abs(t.y):0,y:r==="y"?Math.abs(t.x):0,z:0};e.state.position=O(e.state.position,i)};function Ys({movingItem:e}){e.state.autoWalk=!1}const W=(e,...t)=>D(...t)(e.touchedItem),De=(e,...t)=>D(...t)(e.movingItem),io=e=>Y(e.movingItem),Ks=e=>Y(e.touchedItem),un=e=>{switch(!0){case W(e,"stopAutowalk"):Ys(e);break;case(W(e,...Ao)||W(e,"floor")&&e.touchedItem.config.deadly):ro(e);break;case W(e,"portal"):Js(e);break;case W(e,"pickup"):qs(e);break;case W(e,"doorFrame"):Zs(e);break}},Qs=e=>e[Math.floor(Math.random()*e.length)],we=Object.freeze({movementType:"vel",vels:{walking:P}}),er=({state:{position:e,vels:{walking:t}}},n,o,s)=>{const r=G["headless-base"];if(!_t(t,te))return{movementType:"steady"};const{items:{head:i,heels:a}}=n;for(const c of[i,a]){if(c===void 0)continue;const l=St(c.state.position,e);if(Math.abs(l.y)<2)return{movementType:"vel",vels:{walking:{x:l.x>0?r:-r,y:0,z:0}}};if(Math.abs(l.x)<2)return{movementType:"vel",vels:{walking:{x:0,y:l.y>0?r:-r,z:0}}}}return{movementType:"steady"}},tr=({state:{position:e,standingOn:t}},n,o,s)=>{const r=G.cyberman;if(t===null)return we;const{items:{head:i,heels:a}}=n,c=i===void 0?void 0:Xt(i.state.position,e),l=a===void 0?void 0:Xt(a.state.position,e),d=c===void 0?a:l===void 0||c<l?i:a;if(d===void 0)return Qe;const u=St(d?.state.position,e),h=Math.abs(u.x)<Math.abs(u.y)?"x":"y",f=Math.abs(u[h])>1?h:Rn(h);return{movementType:"vel",vels:{walking:{...P,[f]:u[f]>0?r:-r}}}},hn=({state:{vels:{walking:e},standingOn:t},config:{which:n}},o,s,r,i)=>t===null?we:{movementType:"vel",vels:{walking:ae(e,P)||Math.random()<r/1e3?k(Pt[Qs(i)],G[n]):e}},nr=(e,t,n,o)=>{const{state:{facing:s,vels:{walking:r},standingOn:i},config:a}=e;return i===null?we:_t(r,te)?{movementType:"vel",vels:{walking:k(s,G[a.which])}}:Qe},or=(e,t,n,o)=>{if(!e.state.activated||e.state.busyLickingDoughnutsOffFace)return we;switch(e.config.which){case"dalek":return hn(e,t,n,o,Ro);case"bubble-robot":case"helicopter-bug":return hn(e,t,n,o,So);case"headless-base":return er(e,t);case"cyberman":return tr(e,t);case"turtle":case"american-football-head":return nr(e);default:return we}},sr=({movingItem:e,touchedItem:{state:{position:t},aabb:n},deltaMS:o},{touchDurationBeforeTurn:s})=>{const{state:{position:r,vels:{walking:i},activated:a},aabb:c}=e;if(!a||(e.state.durationOfTouch+=o,e.state.durationOfTouch<s))return;const l=oe(r,c,t,n);if(l.x===0&&l.y===0)return;const d={x:-i.y,y:i.x,z:0};e.state.vels.walking=d,e.state.facing=Te(d),e.state.durationOfTouch=0},rr=({movingItem:e})=>{e.state.vels.walking=P},ir=({movingItem:e,touchedItem:{state:{position:t},aabb:n},deltaMS:o},{touchDurationBeforeTurn:s})=>{const{state:{position:r,vels:{walking:i},activated:a},aabb:c}=e;if(!a||(e.state.durationOfTouch+=o,e.state.durationOfTouch<s))return;const l=oe(r,c,t,n);if(l.x===0&&l.y===0)return;const d={x:l.x===0?i.x:-i.x,y:l.y===0?i.y:-i.y,z:0};e.state.vels.walking=d,e.state.facing=Te(d),e.state.durationOfTouch=0},ar=e=>{const{movingItem:t}=e;switch(t.config.which){case"dalek":case"helicopter-bug":case"bubble-robot":case"american-football-head":{ir(e,{touchDurationBeforeTurn:150});break}case"headless-base":rr(e);break;case"turtle":sr(e,{touchDurationBeforeTurn:150})}},cr=({touchedItem:e,gameState:{progression:t},room:n})=>{const{config:{activates:o},state:{setting:s,touchedOnProgression:r}}=e;if(e.state.touchedOnProgression=t,t===r+1||t===r)return;const i=e.state.setting=s==="left"?"right":"left";for(const[a,c]of Ve(o)){const l=n.items[a];l!==void 0&&(l.state={...l.state,...c[i]})}return!1},lr=({movingItem:e,touchedItem:t})=>{if(!ne(e))return;const{state:{position:n},aabb:o}=t,s=oe(e.state.position,e.aabb,n,o);if(s.x===0&&s.y===0)return;const r=Te(s),i=k(r,-G.ball);return t.state.vels.sliding=i,!1},dr=({movingItem:e,touchedItem:t})=>{if(!ne(t))return;const n=e.state.vels.sliding;if(ae(n,P))return;const{state:{position:o},aabb:s}=e,r=oe(t.state.position,t.aabb,o,s);return Le(r,e.state.vels.sliding)>0&&(e.state.vels.sliding=P),!1},ur=({gameState:e,movingItem:t,room:n,touchedItem:o,deltaMS:s})=>{const{config:{controls:r},state:{position:i},aabb:a}=o,c=oe(t.state.position,t.aabb,i,a);if(c.x===0&&c.y===0)return;const l=Te(c);for(const d of r){const u=n.items[d],h=k(l,-G.charles*s);u.state.facing=h,et({subjectItem:u,posDelta:h,gameState:e,room:n,pusher:o,deltaMS:s})}},hr=(e,t,n,o)=>{const s=Math.max(0,Math.min(e.x+t.x,n.x+o.x)-Math.max(e.x,n.x)),r=Math.max(0,Math.min(e.y+t.y,n.y+o.y)-Math.max(e.y,n.y));return s*r},fn=({state:{position:e},aabb:t},{state:{position:n},aabb:o})=>hr(e,t,n,o),pn=.001,Et=(e,t,n=.001)=>{if(!ne(t)||e.id===t.id)return!1;const{state:{vels:{gravity:{z:o}}}}=e;return o>0?!1:qe({state:{position:O(e.state.position,{x:0,y:0,z:-pn})},aabb:{...e.aabb,z:n+pn},id:e.id},{state:{position:O(t.state.position,{x:0,y:0,z:t.aabb.z})},aabb:{...t.aabb,z:0},id:t.id})},ao=(e,t)=>{const o=[...U(t).filter(r=>Et(e,r))];return o.length===0?void 0:o.reduce((r,i)=>{const a=so(i,r);return a<0||a===0&&fn(e,i)>fn(e,r)?i:r})},mn=e=>{const t=Z(e.movingItem)&&Et(e.movingItem,e.touchedItem,Math.abs(e.movementVector.z));if(e.touchedItem.state.disappear==="onTouch"||e.touchedItem.state.disappear==="onTouchByPlayer"&&Y(e.movingItem)||e.touchedItem.state.disappear==="onStand"&&t){if(t&&io(e)){Je({above:e.movingItem,below:e.touchedItem});const o=[no(e.movingItem,e.gameState),oo(e.movingItem,e.gameState,e.deltaMS)];lo(e.movingItem,o)}zn(e)}};function fr(e){const t=e.movingItem.type==="baddie"?e.movingItem:e.touchedItem;t.state.busyLickingDoughnutsOffFace=!0}const pr=e=>{io(e)&&un(e),Ks(e)&&un({...e,movingItem:e.touchedItem,touchedItem:e.movingItem}),W(e,...Gt)&&lr(e),De(e,...Gt)&&dr(e),(De(e,"baddie")&&W(e,"firedDonut")||De(e,"firedDonut")&&W(e,"baddie"))&&fr(e),De(e,"baddie")&&ar(e),W(e,"switch")&&cr(e),W(e,"joystick")&&ur(e),e.touchedItem.state.disappear&&mn(e),e.movingItem.state.disappear&&ne(e.touchedItem)&&mn({...e,movingItem:e.touchedItem,touchedItem:e.movingItem})},et=({subjectItem:e,posDelta:t,gameState:n,room:o,pusher:s,deltaMS:r,forceful:i=D("lift")(e)&&s===void 0,recursionDepth:a=0})=>{if(ae(t,P))return;if(a>16)throw new Error("this probably means a non-terminating issue");const{state:{position:c}}=e;e.state.position=O(c,t);const l=js(t,Dn(e,_(o.items)));for(const d of l){if(!qe(e,d))continue;if(s!==d&&pr({movingItem:e,touchedItem:d,movementVector:je(e.state.position,c),gameState:n,deltaMS:r,room:o}),o.items[e.id]===void 0)return;if(o.items[d.id]===void 0||!ne(d)||!ne(e))continue;const u=oe(e.state.position,e.aabb,d.state.position,d.aabb);if(Z(d)&&d!==s){const h=i||zo(d)?-1:-.5,f=k(u,h);if(e.state.position=O(e.state.position,u,f),et({subjectItem:d,posDelta:f,pusher:e,gameState:n,room:o,deltaMS:r,forceful:i,recursionDepth:a+1}),o.items[d.id]===void 0)continue;e.state.position=O(e.state.position,oe(e.state.position,e.aabb,d.state.position,d.aabb))}else e.state.position=O(e.state.position,u);Z(e)&&u.z>0&&(e.state.standingOn===null||!l.includes(e.state.standingOn))&&(gt(e),Je({above:e,below:d}))}};function mr(e,t,n){const{state:{teleporting:o,standingOn:s}}=e,{inputState:{jump:r}}=t;if(o===null)return r&&s!==null&&D("teleporter")(s)?{movementType:"steady",stateDelta:{teleporting:{phase:"out",toRoom:s.config.toRoom,timeRemaining:mt}}}:Qe;const i=Math.max(o.timeRemaining-n,0);switch(o.phase){case"out":if(i===0)return Ft({playableItem:e,gameState:t,toRoomId:o.toRoom,changeType:"teleport"}),{movementType:"steady",stateDelta:{teleporting:{phase:"in",timeRemaining:mt}}};break;case"in":if(i===0)return{movementType:"steady",stateDelta:{teleporting:null}};break}return{movementType:"steady",stateDelta:{teleporting:{...o,timeRemaining:i}}}}const gn={movementType:"vel",vels:{movingFloor:P}},gr=(e,t,n)=>{if(Y(e)&&e.state.teleporting!==null)return gn;const{state:{standingOn:o}}=e;if(o===null||!D("conveyor")(o))return gn;const{config:{direction:s}}=o,i=D("heels")(e)&&e.state.action==="moving"&&Ue(e.state.facing)===Do(s)?G.heels:Mo;return{movementType:"vel",vels:{movingFloor:k(Pt[s],i)}}},vr=(e,t,n,o)=>{const{inputState:s}=n,r=e.type==="heels"?e.state:e.state.heels,{carrying:i,hasBag:a}=r,{state:{position:c}}=e;if(!a)return;const l=U(_(t.items)).filter(Mn),d=i===null?xr(e,t):void 0;for(const u of l)u.state.wouldPickUpNext=!1;if(d!==void 0&&(d.state.wouldPickUpNext=!0),s.carry){if(i===null){if(d===void 0){console.warn("nothing to pick up");return}yr(t,r,d)}else{if(e.state.standingOn===null||!co(e,_(t.items)))return;const u=Eo({gameState:n,room:t,itemType:i.type,config:i.config,position:c});et({subjectItem:e,gameState:n,room:t,posDelta:{x:0,y:0,z:u.aabb.z},pusher:e,forceful:!0,deltaMS:o}),r.carrying=null}s.carry=!1}},yr=(e,t,n)=>{const o={type:n.type,config:n.config};t.carrying=o,ye({room:e,item:n})},xr=(e,t)=>ao(e,U(_(t.items)).filter(Mn)),co=(e,t)=>{const n={position:O(e.state.position,{z:M.h})},o=Dn({id:e.id,aabb:e.aabb,state:n},t);for(const s of o)if(!Z(s)||!co(s,t))return!1;return!0};function*wr(e,t,n,o){for(;(e.state.latentMovement.at(0)?.moveAtRoomTime??Number.POSITIVE_INFINITY)<t.roomTime;){const{positionDelta:s}=e.state.latentMovement.shift();yield{movementType:"position",posDelta:s}}}const br=(e,t,n,o)=>{const{inputState:{fire:s}}=n,r=e.type==="head"?e.state:e.state.head,{donuts:i,hasHooter:a,donutLastFireTime:c,gameTime:l}=r,{state:{position:d,facing:u}}=e;if(s&&a&&i>0&&c+500<l){const f={type:"firedDonut",...Xe,config:Rt,id:`firedDonut/${n.progression}`,shadowCastTexture:"shadow.smallRound",state:{position:O(d,k(u,M.w),e.type==="headOverHeels"?{z:M.h}:P),vels:{fired:k(u,G.firedDonut)},disappear:"onTouch",expires:null,stoodOnBy:new Set}};ie({room:t,item:f}),r.donuts-=1,r.donutLastFireTime=r.gameTime,n.inputState.fire=!1}},Tr=2;function*Cr(e,t,n,o){Z(e)&&(yield Ws(e,n,o),yield gr(e),yield*wr(e,t)),Y(e)&&(yield oo(e,n,o),e.id===n.currentCharacterName&&(yield mr(e,n,o),yield no(e,n),$o(e)&&vr(e,t,n,o),Wo(e)&&br(e,t,n))),Bo(e)&&(yield Gs(e)),Ho(e)&&(yield or(e,t,n,o))}const kr=(e,t,n,o)=>{Y(e)&&e.state.standingOn!==null&&No(e.state.standingOn)&&ro({gameState:n,room:t,movingItem:e,touchedItem:e.state.standingOn,deltaMS:o,movementVector:{x:0,y:0,z:-1}});const s=[...Cr(e,t,n,o)];if(s.length===0)return;Z(e)&&e.state.standingOn!==null&&e.state.standingOn.state.disappear==="onStand"&&zn({touchedItem:e.state.standingOn,gameState:n,room:t});let r=lo(e,s);(Z(e)||D("lift")(e)||D("firedDonut")(e))&&(r=O(r,...U(_(e.state.vels)).map(c=>k(c,o))));const i=Math.ceil(ve(r)/Tr),a=k(r,1/i);for(let c=0;c<i;c++)et({subjectItem:e,posDelta:a,gameState:n,room:t,deltaMS:o})},lo=(e,t)=>{let n=P;for(const o of t){if(o.movementType==="position"&&(n=O(n,o.posDelta)),o.movementType==="vel"&&(Z(e)||D("lift")(e)))for(const[r,i]of Ve(o.vels)){const a={...P,...i};e.state.vels[r]=a}const s=o.stateDelta;s!==void 0&&(e.state={...e.state,...s})}return n},vn=(e,...t)=>{const n={};for(const o of t)n[o]=e[o];return n},kt=e=>{const t={id:"head",type:"head",...Xe,...Vt,state:{...vt(),...yt(),...xt(),...e.state.head,facing:e.state.facing,position:O(e.state.position,{z:M.h}),switchedToAt:Number.NEGATIVE_INFINITY}},n={id:"heels",type:"heels",...Xe,...Vt,state:{...vt(),...yt(),...xt(),...e.state.heels,facing:e.state.facing,position:O(e.state.position),switchedToAt:Number.NEGATIVE_INFINITY}};return{head:t,heels:n}},Nt=({head:e,heels:t})=>({type:"headOverHeels",id:"headOverHeels",...Xe,shadowCastTexture:t.shadowCastTexture,config:Rt,aabb:Lo,state:{...vt(),...yt(),...xt(),position:t.state.position,action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:t.state.facing,head:{...vn(e.state,"hasHooter","donuts","donutLastFireTime","fastStepsStartedAtDistance","totalWalkDistance","lives","gameTime","shieldCollectedAt"),switchedToAt:Number.NEGATIVE_INFINITY},heels:{...vn(t.state,"hasBag","bigJumps","carrying","lives","gameTime","shieldCollectedAt"),switchedToAt:Number.NEGATIVE_INFINITY}}}),Or=e=>{const t=e.characterRooms.head,n=X(e,"head"),o=X(e,"heels"),s=Nt({head:n,heels:o});ye({room:t,item:"head"}),ye({room:t,item:"heels"}),ie({room:t,item:s}),e.previousPlayable=e.currentCharacterName,e.currentCharacterName="headOverHeels",e.characterRooms={head:void 0,heels:void 0,headOverHeels:t}},Ir=e=>{const t=e.characterRooms.headOverHeels,n=X(e,"headOverHeels"),o=xe(e.previousPlayable),{head:s,heels:r}=kt(n);ye({room:t,item:"headOverHeels"}),ie({room:t,item:s}),ie({room:t,item:r}),Je({above:s,below:r}),e.currentCharacterName=o,e.previousPlayable=void 0,e.characterRooms={head:t,heels:t,headOverHeels:void 0}},Pr=e=>{const t=X(e,e.currentCharacterName);t!==void 0&&(t.type==="headOverHeels"?(t.state.head.switchedToAt=t.state.head.gameTime,t.state.heels.switchedToAt=t.state.heels.gameTime):t.state.switchedToAt=t?.state.gameTime)},_r=e=>{if(Qn(e))Or(e);else if(e.currentCharacterName==="headOverHeels")Ir(e);else{if(X(e,xe(e.currentCharacterName))===void 0)return;e.currentCharacterName=xe(e.currentCharacterName)}Pr(e)},Fr=(e,t)=>{const n=e.characterRooms.headOverHeels;if(t.state.head.lives--,t.state.heels.lives--,t.state.head.lives+t.state.heels.lives===0){e.events.emit("gameOver");return}const s=t.state.head.lives>0,r=t.state.heels.lives>0;if(s&&!r||!s&&r){const l=s?"head":"heels";e.currentCharacterName=l,ee(e,t);const d=kt(t)[l],u=se({gameState:e,playableItems:[d],roomId:n.id});e.characterRooms={[l]:u},e.entryState={[l]:He(d)};return}if(e.entryState.headOverHeels!==void 0){ee(e,t);const l=se({gameState:e,playableItems:[t],roomId:n.id});e.characterRooms={headOverHeels:l};return}else{const{head:l,heels:d}=kt(t);if(ee(e,l),ee(e,d),qe(l,d)){const u=Nt({head:l,heels:d});ee(e,u,"heels");const h=se({gameState:e,playableItems:[u],roomId:n.id});e.characterRooms={headOverHeels:h},e.entryState={headOverHeels:He(u)};return}else{const u=se({gameState:e,playableItems:[l,d],roomId:n.id});e.characterRooms={head:u,heels:u};return}}},se=({gameState:e,playableItems:t,roomId:n})=>{const{campaign:o}=e,s=ft(o.rooms[n],e.pickupsCollected[n]);for(const r of t)ie({room:s,item:r});return s},ee=(e,t,n=t.id)=>{const o=e.entryState[n];t.state={...t.state,...o,expires:null,standingOn:null}},Ar=(e,t)=>{const n=X(e,xe(t.type));if(t.state.lives--,t.type==="heels"&&(t.state.carrying=null),t.state.lives===0)if(delete e.characterRooms[t.id],n!==void 0){e.currentCharacterName=n.type;return}else{e.events.emit("gameOver");return}else{const o=e.characterRooms[t.type];ee(e,t);const s=n===void 0?void 0:e.characterRooms[n.type];if(o===s){if(e.entryState.headOverHeels!==void 0){const a=Nt({head:o.items.head,heels:o.items.heels});ee(e,a);const c=se({gameState:e,playableItems:[a],roomId:o.id});e.characterRooms={headOverHeels:c};return}ie({room:o,item:t});return}else{const i=se({gameState:e,playableItems:[t],roomId:o.id});e.characterRooms[t.id]=i;return}}},Sr=(e,t)=>{t.type==="headOverHeels"?Fr(e,t):Ar(e,t)},Rr=e=>{for(const t of _(e.items))for(const n of t.state.stoodOnBy){if(!e.items[n.id]){gt(n);continue}if(!Et(n,t)){gt(n);const o=ao(n,_(e.items));o!==void 0&&Je({above:n,below:o})}}},zr=(e,t,n)=>{for(const o of e){const s=n[o.id];if(s===void 0)continue;const i={...je(o.state.position,s),z:0};if(!ae(i,P))for(const a of o.state.stoodOnBy)a.state.latentMovement.push({moveAtRoomTime:t.roomTime+2*Uo,positionDelta:i})}},Dr=(e,t)=>e.state.expires!==null&&e.state.expires<t.roomTime,Mr=(e,t,n)=>{for(const o of _(e.items)){const s=t[o.id];if(s===void 0)continue;ae(s,o.state.position)&&!Xo(o.state.position)&&(console.log(`snapping item ${o.id} to pixel grid`),o.state.position=Go(o.state.position),n.add(o))}},Er=(e,t)=>{const n={lift:-4,head:-3,heels:-3,baddie:-2,block:1,deadlyBlock:1},o=n[e.type]??0,s=n[t.type]??0;return o-s},Nr=(e,t)=>{if(e.gameSpeed>1){let n=new Set;for(let o=0;o<e.gameSpeed;o++)n=new Set($e(n,yn(e,t)));return n}return yn(e,t*e.gameSpeed)},yn=(e,t)=>{const{inputState:n}=e,o=ge(e),s=Object.fromEntries(U(Ve(o.items)).map(([a,c])=>[a,c.state.position]));n.swop&&(_r(e),n.swop=!1);for(const a of _(o.items))Dr(a,o)&&(ye({room:o,item:a}),Y(a)&&Sr(e,a));const r=Object.values(o.items).sort(Er);for(const a of r){if(zt(e).state.action==="death")break;o.items[a.id]!==void 0&&kr(a,o,e,t)}Rr(o);const i=new Set(U(_(o.items)).filter(a=>s[a.id]===void 0||!ae(a.state.position,s[a.id])));return zr(i,o,s),Mr(o,s,i),$r(e,o,t),i},$r=(e,t,n)=>{e.progression++,e.gameTime+=n,t.roomTime+=n;const o=zt(e);if(o.type==="headOverHeels")o.state.head.gameTime+=n,o.state.heels.gameTime+=n;else if(o.state.gameTime+=n,e.characterRooms.head===e.characterRooms.heels){const r=X(e,xe(o.type));r!==void 0&&(r.state.gameTime+=n)}},xn=(e,t)=>{const n=w(e),o=w(O(e,{x:t.x,z:t.z})),s=w(O(e,{y:t.y,z:t.z}));return{bottomCentre:n,topLeft:o,topRight:s}},it=(e,t,n,o,s=1e-5)=>o-s>e&&n<t-s,Wr=(e,t,n,o)=>{const s=xn(e,t),r=xn(n,o),i=s.topLeft.x,a=s.topRight.x,c=r.topLeft.x,l=r.topRight.x,d=it(i,a,c,l),u=s.topRight.y-s.topRight.x/2,h=s.bottomCentre.y-s.bottomCentre.x/2,f=r.topRight.y-r.topRight.x/2,m=r.bottomCentre.y-r.bottomCentre.x/2,g=it(u,h,f,m),S=s.topLeft.y+s.topLeft.x/2,C=s.bottomCentre.y+s.bottomCentre.x/2,R=r.topLeft.y+r.topLeft.x/2,V=r.bottomCentre.y+r.bottomCentre.x/2,E=it(S,C,R,V);return d&&g&&E},Br=(e,t)=>{if(e.renders===!1||t.renders===!1||e.fixedZIndex!==void 0||t.fixedZIndex!==void 0)return 0;const n=e.state.position,o=e.renderAabb||e.aabb,s=t.state.position,r=t.renderAabb||t.aabb;if(!Wr(n,o,s,r))return 0;for(const i of Vo){const a=e.state.position[i],c=a+o[i],l=t.state.position[i],d=l+r[i];if(c<=l)return 1*(i==="z"?-1:1);if(a>=d)return-1*(i==="z"?-1:1)}return wn(t)-wn(e)},wn=e=>e.state.position.x+e.state.position.y-e.state.position.z;class We extends Error{constructor(t,n,o){super(`CyclicDependencyError: .cyclicDependency property of this error has nodes as an array. ${t.join(" -> ")}`,o),this.cyclicDependency=t,this.hasClosedCycle=n}}const Hr=e=>{const t=Lr(e);let n=t.length,o=n;const s=new Array(n),r={},i=Ur(t);for(;o--;)r[o]||a(t[o],o,new Set);return s;function a(c,l,d){if(d.has(c))throw new We([c],!1);if(r[l])return;r[l]=!0;const u=e.get(c)||new Set,h=Array.from(u);if(l=h.length){d.add(c);do{const f=h[--l];try{a(f,i.get(f),d)}catch(m){throw m instanceof We?m.hasClosedCycle?m:new We([c,...m.cyclicDependency],m.cyclicDependency.includes(c)):m}}while(l);d.delete(c)}s[--n]=c}};function Lr(e){const t=new Set;for(const[n,o]of e.entries()){t.add(n);for(const s of o)t.add(s)}return Array.from(t)}function Ur(e){const t=new Map;for(let n=0,o=e.length;n<o;n++)t.set(e[n],n);return t}const bn=(e,t,n)=>{e.has(t)||e.set(t,new Set),e.get(t).add(n)},Me=(e,t,n)=>{const o=e.get(t);o!==void 0&&(o?.delete(n),o.size===0&&e.delete(t))},Xr=(e,t=new Set(_(e)),n=new Map)=>{const o=new Map;for(const[s,r]of n)if(!e[s])n.delete(s);else for(const i of r)e[i]||Me(n,s,i);for(const s of t)if(s.renders)for(const r of _(e)){if(!r.renders||o.get(r)?.has(s)||s===r)continue;const i=Br(s,r);if(bn(o,s,r),i===0){Me(n,s.id,r.id),Me(n,r.id,s.id);continue}const a=i>0?s.id:r.id,c=i>0?r.id:s.id;bn(n,a,c),Me(n,c,a)}return n},uo=(e,t,n=3)=>{try{return{order:Hr(e),impossible:!1}}catch(o){if(o instanceof We){const s=o.cyclicDependency;return e.get(s[0])?.delete(s[1]),{order:uo(e,t,n-1).order,impossible:!0}}else throw o}},Gr=(e,t,n,o)=>`${e}${o?".dark":""}.wall.${t}.${n}`,Vr=(e,t,n)=>{const s=b.textures[`door.frame.${e.planet}.${t}.near`]!==void 0?e.planet:"generic",r=e.color.shade==="dimmed"&&b.textures[`door.frame.${s}.dark.${t}.${n}`]!==void 0;return`door.frame.${s}${r?".dark":""}.${t}.${n}`},Ee=e=>A(()=>p(e)),A=e=>({item:t,room:n,currentlyRenderedProps:o,renderOptions:s})=>{if(o===void 0)return{container:e({item:t,room:n,renderOptions:s}),renderProps:Rt}};function*jr({config:{direction:e,inHiddenWall:t,height:n}},o){const s=At(e),r=s==="y"?1:16;function*i(a){if(t){if(n!==0){const l=p({pivot:{x:s==="x"?18:8,y:12},texture:`generic.door.floatingThreshold.${s}`,...ot(a,{y:-M.h*n})});l.filters=Ct(o,s==="x"?"towards":"right"),yield l}}else{yield p({pivot:{x:r,y:9},texture:"generic.door.legs.base",...ot(a,{})});for(let c=1;c<n;c++)yield p({pivot:{x:r,y:9},texture:"generic.door.legs.pillar",...ot(a,{y:-c*M.h})})}}yield*i(Q({...te,[s]:1})),yield*i(te),t||(yield p({pivot:{x:16,y:M.h*n+13},texture:`generic.door.legs.threshold.double.${s}`,...Q({...te,[s]:1})}))}const qr=A(({item:e,room:t})=>Ke(jr(e,t),new y({filters:J(t)})));function*Jr({config:{direction:e,part:t}},n){const o=At(e);yield p({texture:Vr(n,o,t),filter:J(n)})}const Zr=A(({item:e,room:t})=>Ke(Jr(e,t))),at={frames:b.animations["bubbles.cold"],animationSpeed:.25},K=({top:e,bottom:t="headless-base",filter:n})=>{const o=new y({filters:n});o.addChild(p(t));const s=p(e);return s.y=-12,o.addChild(s),o},Yr=`#version 300 es

in vec2 vTextureCoord;
out vec4 finalColor;

uniform vec2 uTextureSize;
uniform sampler2D uTexture;
uniform vec3 uOutline;
uniform float uOutlineWidth;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    if( c.a != 0.0 ) {
        finalColor = c;
        return;
    }

    vec2 texelSize = vec2(1.0) / vec2(textureSize(uTexture, 0));

    // right
    if( vTextureCoord.x + texelSize.x * uOutlineWidth >= 1.0 ) {
        finalColor = c;
        return;
    }
    vec4 cRight = texture(uTexture, vec2(vTextureCoord.x + texelSize.x * uOutlineWidth, vTextureCoord.y));

    if( cRight.a != 0.0 ) {
        finalColor = vec4(uOutline, 1);
        return;
    }

    // left
    if( vTextureCoord.x - texelSize.x <= 0.0 ) {
        finalColor = c;
        return;
    }

    vec4 cLeft = texture(uTexture, vec2(vTextureCoord.x - texelSize.x * uOutlineWidth, vTextureCoord.y));

    if( cLeft.a != 0.0 ) {
        finalColor = vec4(uOutline, 1);
        return;
    }


    // down
    if( vTextureCoord.y + texelSize.y * uOutlineWidth > 1.0 ) {
        finalColor = c;
        return;
    }

    vec4 cDown = texture(uTexture, vec2(vTextureCoord.x, vTextureCoord.y + texelSize.y * uOutlineWidth));

    if( cDown.a != 0.0 ) {
        finalColor = vec4(uOutline, 1);
        return;
    }

    // up
    if( vTextureCoord.y - texelSize.y * uOutlineWidth < 0.0 ) {
        finalColor = c;
        return;
    }

    vec4 cUp = texture(uTexture, vec2(vTextureCoord.x, vTextureCoord.y - texelSize.y * uOutlineWidth));

    if( cUp.a != 0.0 ) {
        finalColor = vec4(uOutline, 1);
        return;
    }    

    finalColor = c;
}
`;class Ot extends Ze{constructor(t,n){const o=be.from({vertex:Mt,fragment:Yr,name:"outline-filter"});super({glProgram:o,padding:n,resources:{colorReplaceUniforms:{uOutline:{value:new Float32Array(3),type:"vec3<f32>"},uOutlineWidth:{value:new Float32Array(1),type:"f32"}}}});const s=this.resources.colorReplaceUniforms.uniforms,[r,i,a]=t.toArray();s.uOutline[0]=r,s.uOutline[1]=i,s.uOutline[2]=a,s.uOutlineWidth[0]=n}}const ct=({name:e,action:t,facingXy4:n,teleporting:o,highlighted:s,scaleFactor:r})=>{if(t==="death")return{frames:b.animations[`${e}.fadeOut`]};if(o!==null){if(o.phase==="out")return{frames:b.animations[`${e}.fadeOut`]};if(o.phase==="in")return{frames:b.animations[`${e}.fadeOut`].toReversed()}}const i=s?new Ot(e==="head"?v.metallicBlue:v.pink,r):void 0;return t==="moving"?{frames:b.animations[`${e}.walking.${n}`],filter:i}:t==="falling"&&e==="head"&&(n==="towards"||n==="right")?{texture:`head.falling.${n}`,filter:i}:e==="head"&&(n==="towards"||n==="right")?{frames:b.animations[`head.idle.${n}`],filter:i}:{texture:`${e}.walking.${n}.2`,filter:i}},Tn=({gameTime:e,switchedToAt:t})=>t+500>e,lt=({item:e,currentlyRenderedProps:t,renderOptions:n})=>{const{type:o,state:{action:s,facing:r,teleporting:i}}=e,a=Ue(r),c=e.type==="headOverHeels"?Tn(e.state.head):Tn(e.state);if(t===void 0||t.action!==s||t.facingXy4!==a||t.teleportingPhase!==(i?.phase??null)||t.highlighted!==c)return{container:o==="headOverHeels"?K({top:ct({name:"head",action:s,facingXy4:a,teleporting:i,highlighted:c,scaleFactor:n.scaleFactor}),bottom:ct({name:"heels",action:s,facingXy4:a,teleporting:i,highlighted:c,scaleFactor:n.scaleFactor})}):p(ct({name:o,action:s,facingXy4:a,teleporting:i,highlighted:c,scaleFactor:n.scaleFactor})),renderProps:{action:s,facingXy4:a,teleportingPhase:i?.phase??null,highlighted:c}}};function*Kr(e,t,n){for(const o of jo){const s=Rn(o),r=o==="x"?"towards":"right",i=o==="x"?"away":"left";for(let a=0;a<=e.size[o];a++){let c;if(e.walls[i][a]==="none"){const l=U(_(e.roomJson.items)).find(d=>d.type==="door"&&d.config.direction===i&&(d.position[o]===a||d.position[o]+1===a)&&d.position[s]===e.size[s]);l===void 0?c="none":l.position.z===0?c="behind-door":c="corner-on-floor"}else c="corner-on-floor";c!=="none"&&(yield Ne({[o]:a-t[o],[s]:e.size[s]+(n[r]?.5:0)+(c==="behind-door"?.5:0)},p(c==="behind-door"?{anchor:{x:0,y:1},texture:"generic.wall.overdraw",flipX:o==="x"}:{anchor:{x:0,y:1},texture:"generic.floor.overdraw",flipX:o==="x"})))}}}const Qr=A(({item:e,room:t})=>{const{blockXMin:n,blockYMin:o,blockXMax:s,blockYMax:r,sidesWithDoors:i}=En(t.roomJson),a=s-n,c=r-o,{floor:l,color:{shade:d}}=t,u=new y({label:`floor(${t.id})`});if(l!=="none"){const C=l==="deadly"?`generic${d==="dimmed"?".dark":""}.floor.deadly`:`${l}${d==="dimmed"?".dark":""}.floor`,R=new y;for(let E=-1;E<=s+2;E++)for(let j=E%2-1;j<=r+2;j+=2)R.addChild(Ne({x:E+(i.right?-.5:0),y:j+(i.towards?-.5:0)},p({texture:C})));Ke(Kr(t,{x:n,y:o},i),R);const V=new re().poly([te,Q({x:a,y:0}),Q({x:a,y:c}),Q({x:0,y:c})],!0).fill({color:16711680,alpha:.5}).stroke({width:8});R.addChild(V),R.filters=J(t),R.mask=V,u.addChild(R)}const h=new y;for(let C=0;C<=a;C+=.5)h.addChild(Ne({x:C,y:0},p({pivot:{x:7,y:0},texture:"generic.edge.towards"})));h.filters=Ct(t,"towards");const f=new y;for(let C=0;C<=c;C+=.5)f.addChild(Ne({x:0,y:C},p({pivot:{x:0,y:0},texture:"generic.edge.right"})));f.filters=Ct(t,"right");const m=Q({x:t.size.x+(i.right?.5:0),y:-o}).x,g=Q({x:-n,y:t.size.y+(i.towards?.5:0)}).x,S=new re().poly([{x:m,y:16},{x:m,y:-999},{x:g,y:-999},{x:g,y:16}],!0).fill(16776960);return u.addChild(S),u.addChild(h),u.addChild(f),u.mask=S,u.y=-e.aabb.z,u.cacheAsTexture(!0),u}),ei=(e,t,n)=>t==="organic"&&e?`block.organic.dark${n?".disappearing":""}`:`block.${t}${n?".disappearing":""}`,Cn=v.moss,kn=A(({item:{config:{style:e}}})=>p(e)),ti={head:lt,heels:lt,headOverHeels:lt,doorFrame:Zr,doorLegs:qr,stopAutowalk(){throw new Error("these should always be non-rendering")},portal(){throw new Error("these should always be non-rendering")},wall:A(({item:{config:{side:e,style:t}},room:n})=>{if(e==="right"||e==="towards")throw new Error("this wall should be non-rendering");return p({texture:Gr(n.planet,t,e,n.color.shade==="dimmed"),y:1,pivot:e==="away"?{x:st.w,y:st.h+1}:{x:0,y:st.h+1},filter:J(n)})}),barrier:A(({item:{config:{axis:e}}})=>p({texture:`barrier.${e}`})),deadlyBlock:A(({item:{config:{style:e}},room:t})=>p({texture:e,filter:e==="volcano"?J(t):void 0})),slidingDeadly:kn,slidingBlock:kn,block({item:{config:{style:e},state:{disappear:t}},room:n,currentlyRenderedProps:o}){if(o===void 0||o.disappear!==t)return{container:p({texture:ei(n.color.shade==="dimmed",e,t!==null),filter:e==="organic"?J(n):void 0}),renderProps:{disappear:t}}},switch({item:{state:{setting:e}},currentlyRenderedProps:t}){if(t===void 0||e!==t.setting)return{container:p(`switch.${e}`),renderProps:{setting:e}}},conveyor({item:{config:{direction:e,count:t},state:{stoodOnBy:n}},currentlyRenderedProps:o}){const s=n.size>0;if(!(o===void 0||o.moving!==s))return;const i=new y,a=Jo(e);return i.addChild(...U(qo(t,0,-1)).map(c=>{const l=Zo({[a]:(c-1)*M.w});return p(s?{frames:b.animations[`conveyor.${a}`],reverse:e==="towards"||e==="right",animationSpeed:.5,...l}:{texture:`conveyor.${a}.6`,...l})})),{container:i,renderProps:{moving:s}}},lift:A(()=>{const e=new y,t={x:pe.w/2,y:pe.h-Yo};return e.addChild(p({frames:b.animations.lift,pivot:t})),e.addChild(p({texture:"lift.static",pivot:t})),e}),teleporter({item:{state:{stoodOnBy:e}},currentlyRenderedProps:t}){const n=U(e).find(Y)!==void 0;return t===void 0||n!==t.flashing?{container:n?new y({children:[p("teleporter"),p({frames:b.animations["teleporter.flashing"]})]}):p("teleporter"),renderProps:{flashing:n}}:void 0},pickup:A(({item:{config:{gives:e}},room:t})=>{const o={shield:"bunny",jumps:"bunny",fast:"bunny","extra-life":"bunny",bag:"bag",donuts:"donuts",hooter:"hooter",crown:"crown",scroll:{texture:"scroll",filter:J(t)},reincarnation:{frames:b.animations.fish,animationSpeed:.25}}[e];return p(o)}),moveableDeadly:A(({item:{config:{style:e}}})=>p(e==="deadFish"?"fish.1":"puck.deadly")),sceneryPlayer:A(({item:{config:{which:e}}})=>e==="headOverHeels"?K({top:"head.walking.towards.2",bottom:"heels.walking.towards.2"}):p(`${e}.walking.towards.2`)),charles({item:{state:{facing:e}},currentlyRenderedProps:t}){const n=Ue(e);if(t===void 0||n!==t.facingXy4)return{container:K({top:`charles.${n}`}),renderProps:{facingXy4:n}}},baddie({item:{config:e,state:t},room:n,currentlyRenderedProps:o}){const{activated:s,busyLickingDoughnutsOffFace:r}=t,i=r?Rs:s?void 0:Ss(n);switch(e.which){case"american-football-head":case"turtle":case"cyberman":case"computer-bot":case"elephant":case"monkey":{const a=Ue(t.facing);if(!(o===void 0||s!==o.activated||r!==o.busyLickingDoughnutsOffFace||a!==o.facingXy4))return;const l={facingXy4:a,activated:s,busyLickingDoughnutsOffFace:r};switch(e.which){case"american-football-head":return{container:p({texture:`${e.which}.${e.style}.${a}`,filter:i}),renderProps:l};case"turtle":return{container:p(s&&!r?{frames:b.animations[`${e.which}.${a}`],animationSpeed:.25,filter:i}:{texture:`${e.which}.${a}.1`,filter:i}),renderProps:l};case"cyberman":return{container:t.activated||t.busyLickingDoughnutsOffFace?K({top:{texture:`${e.which}.${a}`,filter:i||J(n)},bottom:at}):p({texture:`${e.which}.${a}`,filter:i}),renderProps:l};case"computer-bot":case"elephant":case"monkey":return{container:K({top:`${e.which}.${a}`,filter:i}),renderProps:l}}break}case"helicopter-bug":case"dalek":case"headless-base":case"elephant-head":case"bubble-robot":case"flying-ball":{if(!(o===void 0||r!==o.busyLickingDoughnutsOffFace||s!==o.activated))return;const c={activated:s,busyLickingDoughnutsOffFace:r};switch(e.which){case"helicopter-bug":case"dalek":{const l=b.animations[e.which];return{container:p(s&&!r?{frames:l,animationSpeed:.5,filter:i}:{texture:`${e.which}.1`,filter:i}),renderProps:c}}case"headless-base":return{filter:i,container:p({texture:e.which,filter:i}),renderProps:c};case"elephant-head":return{container:p({texture:"elephant.towards",filter:i}),renderProps:c};case"bubble-robot":return{container:K({top:at,filter:i}),renderProps:c};case"flying-ball":return{container:K({top:"ball",bottom:at,filter:i}),renderProps:c}}break}default:throw new Error(`unexpected baddie ${e}`)}},joystick:Ee("joystick"),movableBlock:A(({item:{config:{style:e}}})=>p(e)),portableBlock({item:{config:{style:e},state:{wouldPickUpNext:t}},currentlyRenderedProps:n,renderOptions:o}){const s=t;if(!(n===void 0||s!==n.highlighted))return;const i=s?new Ot(Cn,o.scaleFactor):void 0;return{container:p({texture:e,filter:i}),renderProps:{highlighted:s}}},spring({item:{state:{stoodOnBy:e,wouldPickUpNext:t}},currentlyRenderedProps:n,renderOptions:o}){const s=e.size>0,r=t;if(!(n===void 0||r!==n.highlighted||s!==n.compressed))return;const a=n?.compressed??!1,c=r?new Ot(Cn,o.scaleFactor):void 0;return{container:p(!s&&a?{frames:b.animations["spring.bounce"],playOnce:"and-stop",filter:c}:{texture:s?"spring.compressed":"spring.released",filter:c}),renderProps:{compressed:s,highlighted:r}}},book:A(({item:{config:{slider:e}}})=>p(`book.${e?"y":"x"}`)),hushPuppy:Ee("hushPuppy"),bubbles:A(({item:{config:{style:e}}})=>p({frames:b.animations[`bubbles.${e}`]})),firedDonut:Ee({frames:b.animations["bubbles.donut"]}),ball:Ee("ball"),floor:Qr},On=(e,t)=>{const n=new re().poly([w({}),w({x:e.x}),w({x:e.x,y:e.y}),w({y:e.y})]).poly([w({}),w({z:e.z}),w({y:e.y,z:e.z}),w({y:e.y})]).poly([w({x:e.x}),w({x:e.x,z:e.z}),w(e),w({x:e.x,y:e.y})]).poly([w({z:e.z}),w({x:e.x,z:e.z}),w({x:e.x,y:e.y,z:e.z}),w({y:e.y,z:e.z})]).stroke({width:.25,color:t,alpha:1});return n.eventMode="static",n.on("pointerenter",()=>{n.fill({color:t,alpha:.5})}),n.on("pointerleave",()=>{n.fill({color:"transparent"})}),n},ni={head:"rgba(255,184,0)",wall:"rgba(128,200,0)",portal:"rgba(255,0,255)",stopAutowalk:"rgba(255,128,128)"},oi=e=>{const t=ni[e.type]??"rgba(255,255,255)",n=new y;if(D("portal")(e)){const o=w(e.config.relativePoint);n.addChild(new re().circle(o.x,o.y,5).stroke(t)),n.addChild(new re().circle(o.x,o.y,2).fill(t))}return n.addChild(new re().circle(0,0,2).fill(t)),n.addChild(On(e.aabb,t)),e.renderAabb&&n.addChild(On(e.renderAabb,"rgba(184, 184, 255)")),n},si=(e,t,n)=>{if(e.shadowMask===void 0)return;const o=new y({label:"ItemShadowRenderer"}),s=new y({label:"shadows"});if(n.showShadowMasks||(o.filters=new hs({alpha:.5})),e.shadowMask.spriteOptions){const i=p(e.shadowMask.spriteOptions);e.shadowMask.relativeTo==="top"&&(i.y=-e.aabb.z),o.addChild(i),n.showShadowMasks||(o.mask=i)}const r={};return o.addChild(s),{get item(){return e},destroy(){o.destroy({children:!0})},tick({movedItems:i,progression:a}){const c=i.has(e),l=e.state.position.z+e.aabb.z,d=U(_(t.items)).filter(function(m){return m.shadowCastTexture!==void 0}),u={id:e.id,state:{position:{...e.state.position,z:l}},aabb:{...e.aabb,z:Ko}},h=Object.groupBy(d,f=>{const m=r[f.id]!==void 0,g=i.has(f);return!c&&!g?m?"keepUnchanged":"noShadow":qe(u,f)?m?"update":"create":"noShadow"});for(const f of $e(h.keepUnchanged,h.update))r[f.id].renderedOnProgression=a;for(const f of $e(h.create)){const m=p(f.shadowCastTexture);m.label=f.id,s.addChild(m),r[f.id]={sprite:m,renderedOnProgression:a}}for(const f of $e(h.create,h.update)){const{sprite:m}=r[f.id],g=w({...St(f.state.position,e.state.position),z:e.aabb.z});m.x=g.x,m.y=g.y}for(const[f,{sprite:m,renderedOnProgression:g}]of Qo(r))g!==a&&(m.destroy(),delete r[f]);o.visible=(h.keepUnchanged?.length??0)+(h.update?.length??0)+(h.create?.length??0)>0},container:o}},ri=(e,t,n)=>{t!==void 0&&n.onItemClick&&t!==void 0&&(t.eventMode="static",t.on("pointertap",()=>{n.onItemClick(e,t)}))},In=({state:{position:e}},t)=>{const n=es(e);t.x=n.x,t.y=n.y},ii=(e,t,n)=>{const o=n.showBoundingBoxes==="all"||n.showBoundingBoxes==="non-wall"&&e.type!=="wall";if(!e.renders&&!o)return;const s=new y({label:"render"});n.showBoundingBoxes!=="none"&&(s.alpha=.5);const r=new y({label:`ItemRenderer(${e.id})`});r.addChild(s),e.fixedZIndex!==void 0&&(r.zIndex=e.fixedZIndex),ri(e,r,n),o&&(r.addChild(oi(e)),In(e,r));let i;const a=ti[e.type],c=si(e,t,n);return c!==void 0&&r.addChild(c.container),{get item(){return e},destroy(){r.destroy({children:!0}),s.destroy({children:!0}),c&&c.destroy()},tick(l){const d=e.renders?a({item:e,room:t,currentlyRenderedProps:i,renderOptions:n}):void 0;d!==void 0&&(i=d.renderProps,s.children.forEach(h=>h.destroy()),d.container!==null&&s.addChild(d.container)),l.movedItems.has(e)&&In(e,r),c&&c.tick(l)},container:r}},ai=(e,t)=>{const{leftSide:n,rightSide:o,frontSide:s}=En(e.roomJson),r=(o.x+n.x)/2;t.x=-r,t.y=-s.y-Math.abs(r/2)},Pn=(e,t)=>{const n=new y({label:`RoomRenderer(${e.id})`}),o=new y({label:"items"});let s=!0;const r=new Map;n.addChild(o),ai(e,n);const i=new Map;return{get container(){return n},get room(){return e},tick(a){const c=s?{movedItems:new Set(_(e.items)),progression:0}:a;for(const l of _(e.items)){let d=i.get(l.id);if(d!==null){if(d===void 0){if(d=ii(l,e,t),d===void 0){i.set(l.id,null);continue}i.set(l.id,d),o.addChild(d.container)}d.tick(c)}}for(const[l,d]of i.entries())e.items[l]===void 0&&(d!==null&&d.destroy(),i.delete(l));if(s||c.movedItems.size>0){const{order:l}=uo(Xr(e.items,c.movedItems,r),e.items);for(let d=0;d<l.length;d++){const u=i.get(l[d]);if(u===void 0)throw new Error(`Item id=${l[d]} does not have a renderer - cannot assign a z-index`);u.container.zIndex=l.length-d}}s=!1},destroy(){n.destroy({children:!0}),i.forEach(a=>{a!==null&&a.destroy()})},get renderOptions(){return t}}},ci=16,li=(e,t)=>{const n=new y({label:"world"}),o=new y({label:"hud"});e.stage.addChild(n),e.stage.addChild(o);const s=new fe(v.shadow);let r=Pn(ge(t),t.renderOptions);n.addChild(r.container);const i=$s(o),a=({deltaMS:c})=>{n.x=e.renderer.width/t.renderOptions.scaleFactor/2;const l=t.gameSpeed===0,d={x:Math.floor(e.renderer.width/t.renderOptions.scaleFactor),y:Math.floor(e.renderer.height/t.renderOptions.scaleFactor)};n.y=d.y-ci,i(t,d);const u=ge(t);if((r.room!==u||r.renderOptions!==t.renderOptions)&&(r.destroy(),r=Pn(u,t.renderOptions),n.addChild(r.container),t.events.emit("roomChange",u.id),e.stage.scale=t.renderOptions.scaleFactor),l){e.stage.filters=s;const h=u.color;s.targetColor=Zn(h).main.original}else{e.stage.filters=he;const h=Nr(t,c);r.tick({progression:t.progression,movedItems:h})}};return{start(){return e.ticker.add(a),this},stop(){e.stage.removeChild(n),e.ticker.remove(a)}}},di=async e=>{const t=Fs,n=new Gn;await n.init({background:"#000000",resizeTo:window});const o=_s({campaign:e,renderOptions:t}),s=xs({keyAssignment:o.keyAssignment,inputState:o.inputState,onInputStateChange(i){o.events.emit("inputStateChanged",i)}}),r=li(n,o).start();return{campaign:e,events:o.events,renderIn(i){i.appendChild(n.canvas)},changeRoom(i){Ft({playableItem:zt(o),gameState:o,toRoomId:i,changeType:"level-select"})},get currentRoom(){return ge(o)},get gameState(){return o},set renderOptions(i){o.renderOptions=i},stop(){console.warn("tearing down game"),n.canvas.parentNode?.removeChild(n.canvas),r.stop(),s(),n.destroy()}}},fi=Object.freeze(Object.defineProperty({__proto__:null,gameMain:di},Symbol.toStringTag,{value:"Module"}));export{Hn as A,$n as C,Ze as F,ls as R,ss as S,Ln as V,fi as g,os as u};
