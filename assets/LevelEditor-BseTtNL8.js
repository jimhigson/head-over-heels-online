import{j as e,r as p}from"./index-DN7_HcAO.js";import{at as Y,ad as w,B as f,C as Q,H as T,z as xe,S as he,f as fe,U as ee,ae as j,au as A,ac as H,av as ye,aw as te,Y as M,ax as ge,M as ve,ay as be,az as je,a3 as oe,aA as we,aB as B,c as ke,e as F,aC as Se,aD as Ne,aE as Ce,q as se,aF as Ie,aG as Te,aH as Re,Q as $,aI as R,an as D,o as Pe,aJ as Be,as as $e,aK as Ee,aL as ze,aM as Ae,aN as _e,aO as Me}from"./App-BqlFHI7H.js";import{B as ne,g as Le,h as He,i as Fe,o as re,n as De,S as Oe}from"./ShowBoundingBoxSelect-CDGc3PBU.js";import{useAppSelectorWithLevelEditorSlice as b,selectTool as C,setTool as ie,selectCurrentEditingRoomColour as Ue,changeRoomColour as O,selectCurrentEditingRoomScenery as Je,changeRoomScenery as Xe,selectCanUndo as Ze,selectCanRedo as Ge,undo as ae,redo as ce,selectCurrentEditingRoomJson as U,setSelectedItemInRoom as We,applyToolToRoomJson as Ke,deleteSelected as qe,selectSelectedJsonItemIds as Ve}from"./levelEditorSlice-DP3w6Auc.js";import{c as Ye,A as Qe,s as et,R as tt,i as ot,z as st,a as nt,p as le}from"./roomRenderer-ApLC8brb.js";import"./Graphics-CpmC8u-Q.js";import"./changeCharacterRoom-DcvFpWCg.js";const L=t=>t,_="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",I=({className:t,onClick:o,children:s,disabled:n=!1,isCurrentTool:r=!1})=>e.jsx(ne,{disabled:n,"data-iscurrenttool":r,className:`active:pt-oneScaledPix ${_} gap-0 inline-flex overflow-hidden ${r?"bg-pastelBlue":""} ${n?"bg-midGrey text-lightGrey":""} ${t??""}`,onClick:o,children:s}),a=({itemTool:t,children:o,className:s})=>{const n=b(C),r=Y(n?.type==="item"&&n.item,t);return e.jsx(I,{isCurrentTool:r,className:s,onClick:()=>w.dispatch(ie({type:"item",item:t})),children:o})},E=({children:t})=>{const[o,s]=p.useState(!1),[n,r]=p.useState(0),c=t[n];return e.jsxs(Le,{open:o,onOpenChange:s,children:[e.jsxs("div",{className:`${_} relative`,children:[c,e.jsx(He,{asChild:!0,children:e.jsx(ne,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:e.jsx(f,{className:"pl-oneScaledPix",children:"⬇"})})})]}),e.jsx(Fe,{children:e.jsx(Q,{scaleFactor:2,children:e.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:t.map((d,u)=>u===n?null:e.jsx("div",{className:_,onClick:()=>{r(u),s(!1)},children:d},u))})})})]})},rt=()=>{const o=b(C)?.type==="pointer";return e.jsx(I,{onClick:()=>w.dispatch(ie({type:"pointer"})),isCurrentTool:o,children:e.jsx("span",{className:"sprite texture-hud.char.↖ relative"})})},J=t=>{const{main:o}=Ye[t].basic;return{backgroundColor:o.basic.toHex(),borderColor:o.dimmed.toHex()}};function it(){const t=T(),o=b(Ue);return e.jsxs(e.Fragment,{children:[e.jsx(re,{value:o.hue,onSelect:s=>{t(O({hue:s}))},values:xe,disableCommandInput:!0,OptionCommandItem:({value:s,onSelect:n})=>e.jsx(De,{value:s,className:"border-1 h-4 w-2",style:J(s),onSelect:n}),triggerButtonLabel:e.jsx(f,{children:"colour"}),triggerButtonClassName:L(`${o.hue==="white"?"text-pureBlack":"text-white"}`),triggerButtonStyle:J(o.hue)}),e.jsx(he,{value:o.shade==="basic",onClick:(s,n)=>{t(O({shade:n?"basic":"dimmed"}))},falseLabel:"dimmed",trueLabel:"basic"})]})}function at(){const t=T(),o=b(Je);return e.jsx(re,{value:o,onSelect:s=>{t(Xe(s))},values:fe,disableCommandInput:!0,triggerButtonClassName:"w-18 text-white",triggerButtonLabel:e.jsx(f,{children:o})})}const X="[button:not(:disabled):hover_&]:hidden mt-quarter",Z="hidden [button:not(:disabled):hover_&]:inline mt-quarter",G="hidden [button:not(:disabled):hover_&]:inline",ct=()=>{const t=T(),o=b(Ze),s=b(Ge);return e.jsxs(e.Fragment,{children:[e.jsxs(I,{disabled:!o,className:"flex-col",onClick:()=>{t(ae())},children:[e.jsx(f,{className:X,children:"⬅"}),e.jsx(f,{className:Z,children:"Un"}),e.jsx(f,{className:G,children:"do"})]}),e.jsxs(I,{disabled:!s,className:"flex-col",onClick:()=>{t(ce())},children:[e.jsx(f,{className:X,children:"➡"}),e.jsx(f,{className:Z,children:"Re"}),e.jsx(f,{className:G,children:"do"})]})]})},i=L("[button:not([data-iscurrenttool=true]):not(:hover)_&]:sprite-revert-to-two-tone"),v=L("flex flex-wrap gap-oneScaledPix w-full"),lt=()=>e.jsxs("div",{className:"flex fixed top-0 bottom-0 right-0 w-12 box-content text-white bg-metallicBlueHalfbrite p-half gap-1 flex-wrap justify-start overflow-auto",children:[e.jsxs("div",{className:v,children:[e.jsx(f,{className:"w-full",children:"Room"}),e.jsx(at,{}),e.jsx(it,{})]}),e.jsxs("div",{className:v,children:[e.jsx(f,{className:"w-full",children:"Edit"}),e.jsx(rt,{}),e.jsx(ct,{})]}),e.jsxs("div",{className:v,children:[e.jsx(f,{className:"w-full",children:"Monsters"}),e.jsx(a,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},children:e.jsx("span",{className:`sprite texture-dalek.1 [button:hover_&]:texture-animated-dalek" ${i}`})}),e.jsx(a,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},children:e.jsx("span",{className:`sprite texture-cyberman.towards [button:hover_&]:texture-cyberman.right ${i}`})}),e.jsx(a,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},children:e.jsx("span",{className:`sprite texture-skiHead.greenAndPink.towards [button:hover_&]:texture-skiHead.greenAndPink.right ${i}`})}),e.jsx(a,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:e.jsx("span",{className:`sprite texture-helicopterBug.1 [button:hover_&]:texture-animated-helicopterBug ${i}`})}),e.jsx(a,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},children:e.jsx("span",{className:`sprite texture-turtle.towards.1 [button:hover_&]:texture-animated-turtle.right ${i}`})}),e.jsx(a,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},children:e.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase.all ${i}`})}),e.jsx(a,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},children:e.jsx("span",{className:`sprite texture-computerBot.towards [button:hover_&]:texture-computerBot.right ${i}`})}),e.jsx(a,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:e.jsx("span",{className:`sprite texture-monkey.towards [button:hover_&]:texture-monkey.right ${i}`})}),e.jsxs(a,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},className:"inline relative",children:[e.jsx("span",{className:`sprite inline-block absolute left-0 texture-headlessBase ${i} [button:active_&]:top-oneScaledPix`}),e.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-elephant.towards [button:hover_&]:texture-elephant.right ${i} [button:active_&]:top-oneScaledPix`})]}),e.jsx(a,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},children:e.jsx("span",{className:`sprite texture-elephant.towards [button:hover_&]:texture-elephant.right ${i}`})}),e.jsxs(a,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",children:[e.jsx("span",{className:`sprite inline-block absolute left-0 texture-bubbles.cold.2 [button:hover_&]:texture-animated-bubbles.cold ${i} [button:active_&]:top-oneScaledPix`}),e.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-ball [button:hover_&]:texture-ball ${i} [button:active_&]:top-oneScaledPix`})]}),e.jsx(a,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},children:e.jsx("span",{className:`sprite texture-bubbles.cold.2 [button:hover_&]:texture-animated-bubbles.cold ${i}`})})]}),e.jsxs("div",{className:v,children:[e.jsx(f,{className:"w-full",children:"Blocks"}),e.jsx(a,{itemTool:{type:"block",config:{style:"artificial"}},children:e.jsx("span",{className:`sprite texture-block.artificial ${i}`})}),e.jsx(a,{itemTool:{type:"block",config:{style:"organic"}},children:e.jsx("span",{className:`sprite texture-block.organic ${i}`})}),e.jsx(a,{itemTool:{type:"block",config:{style:"tower"}},children:e.jsx("span",{className:`sprite texture-tower ${i}`})}),e.jsx(a,{itemTool:{type:"block",config:{style:"book"}},children:e.jsx("span",{className:`sprite texture-book.x ${i}`})})]}),e.jsxs("div",{className:v,children:[e.jsx(f,{className:"w-full",children:"Pickups"}),e.jsx(a,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:e.jsx("span",{className:`sprite texture-whiteRabbit ${i}`})}),e.jsx(a,{itemTool:{type:"pickup",config:{gives:"bag"}},children:e.jsx("span",{className:`sprite texture-bag ${i}`})}),e.jsx(a,{itemTool:{type:"pickup",config:{gives:"hooter"}},children:e.jsx("span",{className:`sprite texture-hooter ${i}`})}),e.jsx(a,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:e.jsx("span",{className:`sprite texture-doughnuts ${i}`})}),e.jsx(a,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:e.jsx("span",{className:`sprite texture-crown.blacktooth ${i}`})}),e.jsx(a,{itemTool:{type:"pickup",config:{gives:"scroll",page:"blacktooth"}},children:e.jsx("span",{className:`sprite texture-scroll ${i}`})})]}),e.jsxs("div",{className:v,children:[e.jsx(f,{className:"w-full",children:"misc."}),e.jsxs(a,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[e.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift.static ${i} [button:active_&]:top-oneScaledPix`}),e.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift.1 [button:hover_&]:texture-animated-lift ${i} [button:active_&]:top-oneScaledPix`})]}),e.jsxs(E,{children:[e.jsx(a,{itemTool:{type:"barrier",config:{axis:"x"}},children:e.jsx("span",{className:`sprite texture-barrier.x ${i}`})}),e.jsx(a,{itemTool:{type:"barrier",config:{axis:"y"}},children:e.jsx("span",{className:`sprite texture-barrier.y ${i}`})})]}),e.jsx(a,{itemTool:{type:"conveyor",config:{direction:"away"}},children:e.jsx("span",{className:`sprite texture-conveyor.y.1 [button:hover_&]:texture-animated-conveyor.x ${i}`})}),e.jsx(a,{itemTool:{type:"teleporter",config:{toRoom:"(placeholder)",toPosition:ee}},children:e.jsx("span",{className:`sprite texture-teleporter ${i}`})}),e.jsx(a,{itemTool:{type:"charles",config:j},children:e.jsx("span",{className:`sprite texture-charles.towards [button:hover_&]:texture-charles.right ${i}`})}),e.jsx(a,{itemTool:{type:"joystick",config:{controls:["(placeholder)"]}},children:e.jsx("span",{className:`sprite texture-joystick ${i}`})}),e.jsx(a,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:A}},children:e.jsx("span",{className:`sprite texture-switch.left [button:hover_&]:texture-switch.right ${i}`})}),e.jsx(a,{itemTool:{type:"ball",config:j},children:e.jsx("span",{className:`sprite texture-ball ${i}`})}),e.jsxs(E,{children:[e.jsx(a,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:e.jsx("span",{className:`sprite texture-cube ${i}`})}),e.jsx(a,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:e.jsx("span",{className:`sprite texture-drum ${i}`})}),e.jsx(a,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:e.jsx("span",{className:`sprite texture-sticks ${i}`})})]}),e.jsx(a,{itemTool:{type:"pushableBlock",config:{style:"stepStool"}},children:e.jsx("span",{className:`sprite texture-stepStool ${i}`})}),e.jsx(a,{itemTool:{type:"movingPlatform",config:{style:"sandwich",movement:"clockwise",activated:"on",startDirection:"towards"}},children:e.jsx("span",{className:`sprite texture-sandwich ${i}`})}),e.jsx(a,{itemTool:{type:"spikes",config:j},children:e.jsx("span",{className:`sprite texture-spikes ${i}`})}),e.jsxs(E,{children:[e.jsx(a,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},children:e.jsx("span",{className:`sprite texture-volcano.1 [button:hover_&]:texture-animated-volcano ${i}`})}),e.jsx(a,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},children:e.jsx("span",{className:`sprite texture-toaster.off ${i}`})})]}),e.jsx(a,{itemTool:{type:"slidingBlock",config:{style:"puck"}},children:e.jsx("span",{className:`sprite texture-puck ${i}`})}),e.jsx(a,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},children:e.jsx("span",{className:`sprite texture-spikyBall.1 [button:hover_&]:texture-spikyBall.2 ${i}`})})]}),e.jsxs("div",{className:v,children:[e.jsx(f,{className:"w-full",children:"Structure"}),e.jsx(a,{itemTool:{type:"door",config:{direction:"away",toRoom:"(placeholder)"}},children:e.jsx("span",{className:`sprite texture-door.frame.generic.x.whole ${i}`})}),e.jsx(a,{itemTool:{type:"wall",config:{direction:"away",tiles:["plain"]}},children:e.jsx("span",{className:`sprite texture-blacktooth.wall.plain.away ${i}`})})]}),e.jsxs("div",{className:v,children:[e.jsx(f,{className:"w-full",children:"debug"}),e.jsx(Oe,{})]})]}),de=p.createContext(null),dt=()=>{const[t,o]=p.useState(()=>H({roomJson:U(w.getState()),roomPickupsCollected:j,scrollsRead:j,isNewGame:!0})),s=b(U);return p.useEffect(()=>{const n=H({roomJson:s,roomPickupsCollected:j,scrollsRead:j,isNewGame:!0});o(n)},[s]),t},ut=({children:t})=>{const o=dt();return e.jsx(de,{value:o,children:t})},P=()=>{const t=p.useContext(de);if(t===null)throw new Error("no room state in context, or no context");return t},ue=p.createContext(null),mt=({children:t})=>{const[o,s]=p.useState(null);return p.useEffect(()=>{const n=new Qe;return n.init({background:et.pureBlack,sharedTicker:!0}).then(()=>{s(n)}),()=>{}},[]),o===null?null:e.jsx(ue,{value:o,children:t})},k=()=>p.useContext(ue),pt=(t,o)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:o},soundSettings:{mute:!0},pixiRenderer:t,gameState:void 0,paused:!1,colourised:!0,upscale:te(w.getState()),editor:!0}),W=(t,o,s)=>new tt({room:t,general:pt(o,s)}),xt=()=>{const{renderer:t}=k(),o=ye();if(!t)throw new Error("this should never be falsey (typescript violation)");const s=P(),[n,r]=p.useState(()=>W(s,t,o));return p.useEffect(()=>{const c=W(s,t,o);return r(c),()=>{c.destroy()}},[s,t,o]),n},N="cursor",K=({room:t,pointingAt:o,valid:s,includeCursor:n,previewItems:r})=>{const{face:c,position:d}=o;for(const u of r)ge({room:t,item:u});if(n){const u=ve(N,t.items);u?(u.state.position=d,u.state.face=c,u.state.valid=s):t.items[N]={type:"cursor",id:N,state:{...je(),face:c,position:d,valid:s},config:{},aabb:be}}else delete t.items[N]},z=t=>{for(const o of M(t.items))o.isCursorPreview&&delete t.items[o.id]};let ht=0;const me=(t,o,s)=>{if(t.face==="up")return B(t.position);if(s.type==="door"){const r=o.items[t.itemId];if(r.type!=="wall")return;const{config:c,aabb:d,state:{position:u}}=r,h={x:1,y:1,...c.times},l=ke(F(c.direction)),m=F(c.direction);if(h[l]<2)return;const x=u[l],y=u[l]+d[l]-Se,g=u.z,S=u.z+d.z-Ne,pe={[l]:Math.max(Math.min(t.position[l],y),x),[m]:t.position[m],z:Math.max(Math.min(t.position.z,S),g)};return B(pe)}const n=Ce[t.face];return se(B(t.position),n)},q=(t,o,s)=>{const n=[...M(o.items).filter(h=>oe(h)&&h.type!=="cursor"&&!h.isCursorPreview)],r=(h,l,m)=>{const x=Ie(`cursor/${ht++}`,{type:h,config:l,position:m},o.roomJson).toArray();return x.forEach(y=>{y.isCursorPreview=!0}),x},c=me(t,o,s);if(c===void 0)return;if(s.type==="door"){const h=o.items[t.itemId];if(h.type!=="wall")return;const l=h.config.direction;return r("door",{...s.config,direction:l},c)}const d=r(s.type,s.config,c);return d.some(h=>{const l=we(h,n);return!ot(l)})?void 0:d},ft=({x:t,y:o})=>s=>{const{bottomCentre:n,topLeft:r,topRight:c}=le(s.state.position,s.aabb);return!(t<r.x||t>c.x||o<c.y-(c.x-t)/2||o<r.y-(t-r.x)/2||o>n.y-(t-n.x)/2||o>n.y-(n.x-t)/2)},yt=(t,{x:o,y:s},n)=>{if(n.type==="item"&&n.item.type==="door"&&t.type==="wall")return Te(t.config.direction);const{bottomCentre:r,topLeft:c,topRight:d}=le(t.state.position,t.aabb);return s<c.y-(c.x-o)/2?s<d.y-(o-d.x)/2?"up":"right":o<r.x?"towards":"right"},V=t=>t.fixedZIndex!==void 0,gt=t=>{if(t.every(V))return t.toSorted((c,d)=>d.fixedZIndex-c.fixedZIndex).at(0);const o=t.filter(c=>!V(c));if(o.length===0)return;if(o.length===1)return o[0];const s=Object.fromEntries(o.map(c=>[c.id,c])),n=st(s),{order:r}=nt(n,s);return s[r[0]]},vt=({state:{position:t},aabb:o},s,n,r)=>{let c=ee,d;switch(s){case"up":c={z:o.z},d="xy";break;case"down":d="xy";break;case"towards":d="xz";break;case"away":c={y:o.y},d="xz";break;case"left":c={x:o.x},d="yz";break;case"right":d="yz";break;default:throw new Error('unexpected face "'+s+'"')}const u=Re(n,se(t,c),d),l=r.type==="item"&&r.item.type==="door"?$.w:$.w/2,m=$.h,x=l/2,y=m/2;return{x:d==="yz"?Math.round(u.x/l)*l:Math.floor((u.x-x)/l)*l,y:d==="xz"?Math.round(u.y/l)*l:Math.floor((u.y-x)/l)*l,z:d==="xy"?Math.round(u.z/m)*m:Math.floor((u.z+y)/m)*m}},bt=t=>o=>{const s=oe(o)&&o.type!=="cursor"&&!o.isCursorPreview;return t.type==="item"&&t.item.type==="door"?s&&o.type==="wall":s},jt=(t,o,s)=>{const n=gt(Array.from(M(o.items).filter(bt(s)).filter(ft(t))));if(n){const r=yt(n,t,s);return{itemId:n.id,face:r,position:vt(n,r,t,s)}}else return},wt=(t,o)=>{const s=t.cssUpscale*t.gameEngineUpscale;return{x:o.x/s-t.gameEngineScreenSize.x/2,y:o.y/s-t.gameEngineScreenSize.y+16}},kt=t=>{const o=k(),s=R(te),n=T(),r=P(),c=p.useRef(void 0);p.useEffect(()=>{if(o.stage.eventMode="none",t===null)return;const d=l=>{const m=wt(s,l),x=C(w.getState()),y=jt(m,r,x);if(!Y(y,c.current))if(c.current=y,y!==void 0)switch(x.type){case"item":{const g=q(y,r,x.item),S=g!==void 0;z(r),K({room:r,pointingAt:y,valid:S,includeCursor:!S,previewItems:g??A});break}case"pointer":{z(r),K({room:r,pointingAt:y,valid:!0,includeCursor:!0,previewItems:A});const g=r.items[y.itemId]?.jsonItemId;r.editor={...r.editor,hoveredJsonItemId:g};break}}else z(r)},u=l=>{const m=C(w.getState());switch(m.type){case"item":{const x=c.current;if(x===void 0||q(x,r,m.item)===void 0)return;const g=r.items[x.itemId];n(Ke({blockPosition:me(x,r,m.item),pointedAtItem:{type:g.type,config:g.config,jsonItemId:g.jsonItemId}}));break}case"pointer":{const x=c.current;if(!x)return;const{jsonItemId:y}=r.items[x.itemId];n(We({jsonItemId:y,additive:l.ctrlKey||l.metaKey}));break}}},h=l=>{const m=l.key;(m==="Backspace"||m==="Delete")&&n(qe()),(m==="z"||m==="Z")&&(l.ctrlKey||l.metaKey)&&w.dispatch(l.shiftKey?ce():ae())};return t.addEventListener("mousemove",d),t.addEventListener("click",u),window.addEventListener("keyup",h),()=>{t.removeEventListener("mousemove",d),t.removeEventListener("click",u),window.removeEventListener("keyup",h)}},[o.stage,s,t,n,r])},St=t=>{const o=P();p.useEffect(()=>{let s=0;const n=({deltaMS:r})=>{if(t.destroyed)return;t.renderContext.room!==o&&console.warn("room renderer does not have the current room");const c=new Set(Pe(o.items));o.roomTime+=r,t.tick({deltaMS:r,movedItems:c,progression:s++})};return D.shared.add(n),()=>{D.shared.remove(n)}},[t,o])},Nt=t=>{const o=k();p.useEffect(()=>{if(t)return t.appendChild(o.canvas),()=>{t.removeChild(o.canvas)}},[t,o])},Ct=()=>{const t=k(),o=R(s=>s.upscale.upscale.gameEngineUpscale);t.stage.scale=o},It=()=>{const t=k(),o=R(Be);p.useEffect(()=>{t.renderer?.resize(o.x,o.y)},[t.renderer,o])},Tt=t=>{const o=k(),[s]=p.useState(()=>new $e),n=R(Ee);p.useEffect(()=>{if(t.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return s.addChild(t.output.graphics),o.stage.addChild(s),()=>{o.stage.removeChild(s),s.removeChild(t.output.graphics)}},[t,o,s]),p.useEffect(()=>{s.x=n.x/2,s.y=n.y-16},[s,n])},Rt=()=>{const t=P(),o=b(Ve);p.useEffect(()=>{t.editor||(t.editor={}),t.editor.selectedJsonItemId=o},[t,o])};Ae.defaultOptions.scaleMode="nearest";const Pt=()=>{const t=xt(),[o,s]=p.useState(null);It(),Tt(t),St(t),kt(o),Nt(o),Ct(),Rt();const n=ze();return e.jsx("div",{style:n,ref:s})},Lt=()=>(_e(),Me(),e.jsxs(e.Fragment,{children:[e.jsx("title",{children:"Hoh Editor"}),e.jsx(mt,{children:e.jsx(ut,{children:e.jsx(Pt,{})})}),e.jsx(Q,{scaleFactor:2,children:e.jsx(lt,{})})]}));export{Lt as default};
