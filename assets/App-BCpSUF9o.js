const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-9xTwGAf4.js","assets/webworkerAll-C55yoMkB.js","assets/colorToUniform-3MxHuUz8.js","assets/CanvasTextGenerator-DXxRBjyD.js","assets/CanvasPool-CshWw3Xm.js","assets/index-BS1SDXPH.js","assets/index-CEun8YmI.css","assets/campaign-Bz7zdiBN.js","assets/Cheats-BzolzXgu.js","assets/pixiContainerToString-CUFYoFKb.js","assets/spritesheetPalette-BGwAC4SF.js","assets/gameMain-BMm8X7C5.js","assets/spectrumLut-CDNUDjvM.js","assets/LutPage-CfGWknyB.js"])))=>i.map(i=>d[i]);
import{a as Nn,r as v,R as hd,j as p,g as nt,_ as Bn,i as zn,t as ht,d as NA,D as ke,L as vq,c as Bo}from"./index-BS1SDXPH.js";var ac={exports:{}},lc={};var Kf;function _q(){if(Kf)return lc;Kf=1;var t=Nn();function e(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var r=typeof Object.is=="function"?Object.is:e,s=t.useSyncExternalStore,n=t.useRef,i=t.useEffect,o=t.useMemo,a=t.useDebugValue;return lc.useSyncExternalStoreWithSelector=function(l,c,u,h,d){var f=n(null);if(f.current===null){var m={hasValue:!1,value:null};f.current=m}else m=f.current;f=o(function(){function g(q){if(!A){if(A=!0,b=q,q=h(q),d!==void 0&&m.hasValue){var _=m.value;if(d(_,q))return x=_}return x=q}if(_=x,r(b,q))return _;var V=h(q);return d!==void 0&&d(_,V)?(b=q,_):(b=q,x=V)}var A=!1,b,x,w=u===void 0?null:u;return[function(){return g(c())},w===null?void 0:function(){return g(w())}]},[c,u,h,d]);var y=s(l,f[0],f[1]);return i(function(){m.hasValue=!0,m.value=y},[y]),a(y),y},lc}var Yf;function Sq(){return Yf||(Yf=1,ac.exports=_q()),ac.exports}var kq=Sq();function BA(t){t()}function Cq(){let t=null,e=null;return{clear(){t=null,e=null},notify(){BA(()=>{let r=t;for(;r;)r.callback(),r=r.next})},get(){const r=[];let s=t;for(;s;)r.push(s),s=s.next;return r},subscribe(r){let s=!0;const n=e={callback:r,next:null,prev:e};return n.prev?n.prev.next=n:t=n,function(){!s||t===null||(s=!1,n.next?n.next.prev=n.prev:e=n.prev,n.prev?n.prev.next=n.next:t=n.next)}}}}var Qf={notify(){},get:()=>[]};function Eq(t,e){let r,s=Qf,n=0,i=!1;function o(y){u();const g=s.subscribe(y);let A=!1;return()=>{A||(A=!0,g(),h())}}function a(){s.notify()}function l(){m.onStateChange&&m.onStateChange()}function c(){return i}function u(){n++,r||(r=t.subscribe(l),s=Cq())}function h(){n--,r&&n===0&&(r(),r=void 0,s.clear(),s=Qf)}function d(){i||(i=!0,u())}function f(){i&&(i=!1,h())}const m={addNestedSub:o,notifyNestedSubs:a,handleChangeWrapper:l,isSubscribed:c,trySubscribe:d,tryUnsubscribe:f,getListeners:()=>s};return m}var Pq=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Tq=Pq(),Rq=()=>typeof navigator<"u"&&navigator.product==="ReactNative",Mq=Rq(),Iq=()=>Tq||Mq?v.useLayoutEffect:v.useEffect,jq=Iq();function Xf(t,e){return t===e?t!==0||e!==0||1/t===1/e:t!==t&&e!==e}function Ri(t,e){if(Xf(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(let n=0;n<r.length;n++)if(!Object.prototype.hasOwnProperty.call(e,r[n])||!Xf(t[r[n]],e[r[n]]))return!1;return!0}var Oq=Symbol.for("react-redux-context"),Nq=typeof globalThis<"u"?globalThis:{};function Bq(){if(!v.createContext)return{};const t=Nq[Oq]??=new Map;let e=t.get(v.createContext);return e||(e=v.createContext(null),t.set(v.createContext,e)),e}var Jr=Bq();function zq(t){const{children:e,context:r,serverState:s,store:n}=t,i=v.useMemo(()=>{const l=Eq(n);return{store:n,subscription:l,getServerState:s?()=>s:void 0}},[n,s]),o=v.useMemo(()=>n.getState(),[n]);jq(()=>{const{subscription:l}=i;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),o!==n.getState()&&l.notifyNestedSubs(),()=>{l.tryUnsubscribe(),l.onStateChange=void 0}},[i,o]);const a=r||Jr;return v.createElement(a.Provider,{value:i},e)}var Dq=zq;function dd(t=Jr){return function(){return v.useContext(t)}}var zA=dd();function DA(t=Jr){const e=t===Jr?zA:dd(t),r=()=>{const{store:s}=e();return s};return Object.assign(r,{withTypes:()=>r}),r}var fd=DA();function Lq(t=Jr){const e=t===Jr?fd:DA(t),r=()=>e().dispatch;return Object.assign(r,{withTypes:()=>r}),r}var LA=Lq(),Fq=(t,e)=>t===e;function Uq(t=Jr){const e=t===Jr?zA:dd(t),r=(s,n={})=>{const{equalityFn:i=Fq}=typeof n=="function"?{equalityFn:n}:n,o=e(),{store:a,subscription:l,getServerState:c}=o;v.useRef(!0);const u=v.useCallback({[s.name](d){return s(d)}}[s.name],[s]),h=kq.useSyncExternalStoreWithSelector(l.addNestedSub,a.getState,c||a.getState,u,i);return v.useDebugValue(h),h};return Object.assign(r,{withTypes:()=>r}),r}var FA=Uq(),$q=BA;function Hq(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var r,s,n,i,o=[],a="",l=t.split("/");for(l[0]||l.shift();n=l.shift();)r=n[0],r==="*"?(o.push(r),a+=n[1]==="?"?"(?:/(.*))?":"/(.*)"):r===":"?(s=n.indexOf("?",1),i=n.indexOf(".",1),o.push(n.substring(1,~s?s:~i?i:n.length)),a+=~s&&!~i?"(?:/([^/]+?))?":"/([^/]+?)",~i&&(a+=(~s?"?":"")+"\\"+n.substring(i))):a+="/"+n;return{keys:o,pattern:new RegExp("^"+a+(e?"(?=$|/)":"/?$"),"i")}}var cc={exports:{}},uc={};var Jf;function Gq(){if(Jf)return uc;Jf=1;var t=Nn();function e(h,d){return h===d&&(h!==0||1/h===1/d)||h!==h&&d!==d}var r=typeof Object.is=="function"?Object.is:e,s=t.useState,n=t.useEffect,i=t.useLayoutEffect,o=t.useDebugValue;function a(h,d){var f=d(),m=s({inst:{value:f,getSnapshot:d}}),y=m[0].inst,g=m[1];return i(function(){y.value=f,y.getSnapshot=d,l(y)&&g({inst:y})},[h,f,d]),n(function(){return l(y)&&g({inst:y}),h(function(){l(y)&&g({inst:y})})},[h]),o(f),f}function l(h){var d=h.getSnapshot;h=h.value;try{var f=d();return!r(h,f)}catch{return!0}}function c(h,d){return d()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return uc.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,uc}var Zf;function Wq(){return Zf||(Zf=1,cc.exports=Gq()),cc.exports}var Kq=Wq();const Yq=hd.useInsertionEffect,Qq=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Xq=Qq?v.useLayoutEffect:v.useEffect,Jq=Yq||Xq,UA=t=>{const e=v.useRef([t,(...r)=>e[0](...r)]).current;return Jq(()=>{e[0]=t}),e[1]},Zq="popstate",pd="pushState",md="replaceState",ev="hashchange",ep=[Zq,pd,md,ev],tv=t=>{for(const e of ep)addEventListener(e,t);return()=>{for(const e of ep)removeEventListener(e,t)}},$A=(t,e)=>Kq.useSyncExternalStore(tv,t,e),tp=()=>location.search,rv=({ssrSearch:t}={})=>$A(tp,t!=null?()=>t:tp),rp=()=>location.pathname,sv=({ssrPath:t}={})=>$A(rp,t!=null?()=>t:rp),nv=(t,{replace:e=!1,state:r=null}={})=>history[e?md:pd](r,"",t),iv=(t={})=>[sv(t),nv],sp=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[sp]>"u"){for(const t of[pd,md]){const e=history[t];history[t]=function(){const r=e.apply(this,arguments),s=new Event(t);return s.arguments=arguments,dispatchEvent(s),r}}Object.defineProperty(window,sp,{value:!0})}const ov=(t,e)=>e.toLowerCase().indexOf(t.toLowerCase())?"~"+e:e.slice(t.length)||"/",HA=(t="")=>t==="/"?"":t,av=(t,e)=>t[0]==="~"?t.slice(1):HA(e)+t,lv=(t="",e)=>ov(np(HA(t)),np(e)),np=t=>{try{return decodeURI(t)}catch{return t}},GA={hook:iv,searchHook:rv,parser:Hq,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:t=>t,aroundNav:(t,e,r)=>t(e,r)},WA=v.createContext(GA),Pl=()=>v.useContext(WA),KA={},YA=v.createContext(KA),cv=()=>v.useContext(YA),gd=t=>{const[e,r]=t.hook(t);return[lv(t.base,e),UA((s,n)=>t.aroundNav(r,av(s,t.base),n))]},QA=(t,e,r,s)=>{const{pattern:n,keys:i}=e instanceof RegExp?{keys:!1,pattern:e}:t(e||"*",s),o=n.exec(r)||[],[a,...l]=o;return a!==void 0?[!0,(()=>{const c=i!==!1?Object.fromEntries(i.map((h,d)=>[h,l[d]])):o.groups;let u={...l};return c&&Object.assign(u,c),u})(),...s?[a]:[]]:[!1,null]},uv=({children:t,...e})=>{const r=Pl(),s=e.hook?GA:r;let n=s;const[i,o=e.ssrSearch??""]=e.ssrPath?.split("?")??[];i&&(e.ssrSearch=o,e.ssrPath=i),e.hrefs=e.hrefs??e.hook?.hrefs,e.searchHook=e.searchHook??e.hook?.searchHook;let a=v.useRef({}),l=a.current,c=l;for(let u in s){const h=u==="base"?s[u]+(e[u]??""):e[u]??s[u];l===c&&h!==c[u]&&(a.current=c={...c}),c[u]=h,(h!==s[u]||h!==n[u])&&(n=c)}return v.createElement(WA.Provider,{value:n,children:t})},ip=({children:t,component:e},r)=>e?v.createElement(e,{params:r}):typeof t=="function"?t(r):t,hv=t=>{let e=v.useRef(KA);const r=e.current;return e.current=Object.keys(t).length!==Object.keys(r).length||Object.entries(t).some(([s,n])=>n!==r[s])?t:r},ei=({path:t,nest:e,match:r,...s})=>{const n=Pl(),[i]=gd(n),[o,a,l]=r??QA(n.parser,t,i,e),c=hv({...cv(),...a});if(!o)return null;const u=l?v.createElement(uv,{base:l},ip(s,c)):ip(s,c);return v.createElement(YA.Provider,{value:c,children:u})};v.forwardRef((t,e)=>{const r=Pl(),[s,n]=gd(r),{to:i="",href:o=i,onClick:a,asChild:l,children:c,className:u,replace:h,state:d,transition:f,...m}=t,y=UA(A=>{A.ctrlKey||A.metaKey||A.altKey||A.shiftKey||A.button!==0||(a?.(A),A.defaultPrevented||(A.preventDefault(),n(o,t)))}),g=r.hrefs(o[0]==="~"?o.slice(1):r.base+o,r);return l&&v.isValidElement(c)?v.cloneElement(c,{onClick:y,href:g}):v.createElement("a",{...m,onClick:y,href:g,className:u?.call?u(s===o):u,children:c,ref:e})});const XA=t=>Array.isArray(t)?t.flatMap(e=>XA(e&&e.type===v.Fragment?e.props.children:e)):[t],dv=({children:t,location:e})=>{const r=Pl(),[s]=gd(r);for(const n of XA(t)){let i=0;if(v.isValidElement(n)&&(i=QA(r.parser,n.props.path,e||s,n.props.nest))[0])return v.cloneElement(n,{match:i})}return null},er=(t=typeof globalThis.window>"u"?"":window.location.search)=>new URLSearchParams(t);function tt(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var fv=typeof Symbol=="function"&&Symbol.observable||"@@observable",op=fv,hc=()=>Math.random().toString(36).substring(7).split("").join("."),pv={INIT:`@@redux/INIT${hc()}`,REPLACE:`@@redux/REPLACE${hc()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${hc()}`},Ja=pv;function bn(t){if(typeof t!="object"||t===null)return!1;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e||Object.getPrototypeOf(t)===null}function yd(t,e,r){if(typeof t!="function")throw new Error(tt(2));if(typeof e=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(tt(0));if(typeof e=="function"&&typeof r>"u"&&(r=e,e=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(tt(1));return r(yd)(t,e)}let s=t,n=e,i=new Map,o=i,a=0,l=!1;function c(){o===i&&(o=new Map,i.forEach((g,A)=>{o.set(A,g)}))}function u(){if(l)throw new Error(tt(3));return n}function h(g){if(typeof g!="function")throw new Error(tt(4));if(l)throw new Error(tt(5));let A=!0;c();const b=a++;return o.set(b,g),function(){if(A){if(l)throw new Error(tt(6));A=!1,c(),o.delete(b),i=null}}}function d(g){if(!bn(g))throw new Error(tt(7));if(typeof g.type>"u")throw new Error(tt(8));if(typeof g.type!="string")throw new Error(tt(17));if(l)throw new Error(tt(9));try{l=!0,n=s(n,g)}finally{l=!1}return(i=o).forEach(b=>{b()}),g}function f(g){if(typeof g!="function")throw new Error(tt(10));s=g,d({type:Ja.REPLACE})}function m(){const g=h;return{subscribe(A){if(typeof A!="object"||A===null)throw new Error(tt(11));function b(){const w=A;w.next&&w.next(u())}return b(),{unsubscribe:g(b)}},[op](){return this}}}return d({type:Ja.INIT}),{dispatch:d,subscribe:h,getState:u,replaceReducer:f,[op]:m}}function mv(t){Object.keys(t).forEach(e=>{const r=t[e];if(typeof r(void 0,{type:Ja.INIT})>"u")throw new Error(tt(12));if(typeof r(void 0,{type:Ja.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(tt(13))})}function Ad(t){const e=Object.keys(t),r={};for(let i=0;i<e.length;i++){const o=e[i];typeof t[o]=="function"&&(r[o]=t[o])}const s=Object.keys(r);let n;try{mv(r)}catch(i){n=i}return function(o={},a){if(n)throw n;let l=!1;const c={};for(let u=0;u<s.length;u++){const h=s[u],d=r[h],f=o[h],m=d(f,a);if(typeof m>"u")throw a&&a.type,new Error(tt(14));c[h]=m,l=l||m!==f}return l=l||s.length!==Object.keys(o).length,l?c:o}}function Za(...t){return t.length===0?e=>e:t.length===1?t[0]:t.reduce((e,r)=>(...s)=>e(r(...s)))}function gv(...t){return e=>(r,s)=>{const n=e(r,s);let i=()=>{throw new Error(tt(15))};const o={getState:n.getState,dispatch:(l,...c)=>i(l,...c)},a=t.map(l=>l(o));return i=Za(...a)(n.dispatch),{...n,dispatch:i}}}function xd(t){return bn(t)&&"type"in t&&typeof t.type=="string"}var bd=Symbol.for("immer-nothing"),Mi=Symbol.for("immer-draftable"),kt=Symbol.for("immer-state");function st(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Rs=Object.getPrototypeOf;function mr(t){return!!t&&!!t[kt]}function sr(t){return t?JA(t)||Array.isArray(t)||!!t[Mi]||!!t.constructor?.[Mi]||wo(t)||Vo(t):!1}var yv=Object.prototype.constructor.toString();function JA(t){if(!t||typeof t!="object")return!1;const e=Rs(t);if(e===null)return!0;const r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===yv}function Av(t){return mr(t)||st(15,t),t[kt].base_}function Hi(t,e){Ms(t)===0?Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)}):t.forEach((r,s)=>e(s,r,t))}function Ms(t){const e=t[kt];return e?e.type_:Array.isArray(t)?1:wo(t)?2:Vo(t)?3:0}function Gi(t,e){return Ms(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function dc(t,e){return Ms(t)===2?t.get(e):t[e]}function ZA(t,e,r){const s=Ms(t);s===2?t.set(e,r):s===3?t.add(r):t[e]=r}function xv(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function wo(t){return t instanceof Map}function Vo(t){return t instanceof Set}function ps(t){return t.copy_||t.base_}function Ju(t,e){if(wo(t))return new Map(t);if(Vo(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const r=JA(t);if(e===!0||e==="class_only"&&!r){const s=Object.getOwnPropertyDescriptors(t);delete s[kt];let n=Reflect.ownKeys(s);for(let i=0;i<n.length;i++){const o=n[i],a=s[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(s[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:t[o]})}return Object.create(Rs(t),s)}else{const s=Rs(t);if(s!==null&&r)return{...t};const n=Object.create(s);return Object.assign(n,t)}}function wd(t,e=!1){return Tl(t)||mr(t)||!sr(t)||(Ms(t)>1&&(t.set=t.add=t.clear=t.delete=bv),Object.freeze(t),e&&Object.entries(t).forEach(([r,s])=>wd(s,!0))),t}function bv(){st(2)}function Tl(t){return Object.isFrozen(t)}var Zu={};function Is(t){const e=Zu[t];return e||st(0,t),e}function wv(t,e){Zu[t]||(Zu[t]=e)}var Wi;function ex(){return Wi}function Vv(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function ap(t,e){e&&(Is("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function eh(t){th(t),t.drafts_.forEach(qv),t.drafts_=null}function th(t){t===Wi&&(Wi=t.parent_)}function lp(t){return Wi=Vv(Wi,t)}function qv(t){const e=t[kt];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function cp(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];return t!==void 0&&t!==r?(r[kt].modified_&&(eh(e),st(4)),sr(t)&&(t=el(e,t),e.parent_||tl(e,t)),e.patches_&&Is("Patches").generateReplacementPatches_(r[kt].base_,t,e.patches_,e.inversePatches_)):t=el(e,r,[]),eh(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==bd?t:void 0}function el(t,e,r){if(Tl(e))return e;const s=e[kt];if(!s)return Hi(e,(n,i)=>up(t,s,e,n,i,r)),e;if(s.scope_!==t)return e;if(!s.modified_)return tl(t,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;const n=s.copy_;let i=n,o=!1;s.type_===3&&(i=new Set(n),n.clear(),o=!0),Hi(i,(a,l)=>up(t,s,n,a,l,r,o)),tl(t,n,!1),r&&t.patches_&&Is("Patches").generatePatches_(s,r,t.patches_,t.inversePatches_)}return s.copy_}function up(t,e,r,s,n,i,o){if(mr(n)){const a=i&&e&&e.type_!==3&&!Gi(e.assigned_,s)?i.concat(s):void 0,l=el(t,n,a);if(ZA(r,s,l),mr(l))t.canAutoFreeze_=!1;else return}else o&&r.add(n);if(sr(n)&&!Tl(n)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;el(t,n),(!e||!e.scope_.parent_)&&typeof s!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,s)&&tl(t,n)}}function tl(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&wd(e,r)}function vv(t,e){const r=Array.isArray(t),s={type_:r?1:0,scope_:e?e.scope_:ex(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let n=s,i=Vd;r&&(n=[s],i=Ki);const{revoke:o,proxy:a}=Proxy.revocable(n,i);return s.draft_=a,s.revoke_=o,a}var Vd={get(t,e){if(e===kt)return t;const r=ps(t);if(!Gi(r,e))return _v(t,r,e);const s=r[e];return t.finalized_||!sr(s)?s:s===fc(t.base_,e)?(pc(t),t.copy_[e]=sh(s,t)):s},has(t,e){return e in ps(t)},ownKeys(t){return Reflect.ownKeys(ps(t))},set(t,e,r){const s=tx(ps(t),e);if(s?.set)return s.set.call(t.draft_,r),!0;if(!t.modified_){const n=fc(ps(t),e),i=n?.[kt];if(i&&i.base_===r)return t.copy_[e]=r,t.assigned_[e]=!1,!0;if(xv(r,n)&&(r!==void 0||Gi(t.base_,e)))return!0;pc(t),rh(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_[e]=!0),!0},deleteProperty(t,e){return fc(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,pc(t),rh(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=ps(t),s=Reflect.getOwnPropertyDescriptor(r,e);return s&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:s.enumerable,value:r[e]}},defineProperty(){st(11)},getPrototypeOf(t){return Rs(t.base_)},setPrototypeOf(){st(12)}},Ki={};Hi(Vd,(t,e)=>{Ki[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});Ki.deleteProperty=function(t,e){return Ki.set.call(this,t,e,void 0)};Ki.set=function(t,e,r){return Vd.set.call(this,t[0],e,r,t[0])};function fc(t,e){const r=t[kt];return(r?ps(r):t)[e]}function _v(t,e,r){const s=tx(e,r);return s?"value"in s?s.value:s.get?.call(t.draft_):void 0}function tx(t,e){if(!(e in t))return;let r=Rs(t);for(;r;){const s=Object.getOwnPropertyDescriptor(r,e);if(s)return s;r=Rs(r)}}function rh(t){t.modified_||(t.modified_=!0,t.parent_&&rh(t.parent_))}function pc(t){t.copy_||(t.copy_=Ju(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var Sv=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,r,s)=>{if(typeof e=="function"&&typeof r!="function"){const i=r;r=e;const o=this;return function(l=i,...c){return o.produce(l,u=>r.call(this,u,...c))}}typeof r!="function"&&st(6),s!==void 0&&typeof s!="function"&&st(7);let n;if(sr(e)){const i=lp(this),o=sh(e,void 0);let a=!0;try{n=r(o),a=!1}finally{a?eh(i):th(i)}return ap(i,s),cp(n,i)}else if(!e||typeof e!="object"){if(n=r(e),n===void 0&&(n=e),n===bd&&(n=void 0),this.autoFreeze_&&wd(n,!0),s){const i=[],o=[];Is("Patches").generateReplacementPatches_(e,n,i,o),s(i,o)}return n}else st(1,e)},this.produceWithPatches=(e,r)=>{if(typeof e=="function")return(o,...a)=>this.produceWithPatches(o,l=>e(l,...a));let s,n;return[this.produce(e,r,(o,a)=>{s=o,n=a}),s,n]},typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof t?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){sr(t)||st(8),mr(t)&&(t=kv(t));const e=lp(this),r=sh(t,void 0);return r[kt].isManual_=!0,th(e),r}finishDraft(t,e){const r=t&&t[kt];(!r||!r.isManual_)&&st(9);const{scope_:s}=r;return ap(s,e),cp(void 0,s)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let r;for(r=e.length-1;r>=0;r--){const n=e[r];if(n.path.length===0&&n.op==="replace"){t=n.value;break}}r>-1&&(e=e.slice(r+1));const s=Is("Patches").applyPatches_;return mr(t)?s(t,e):this.produce(t,n=>s(n,e))}};function sh(t,e){const r=wo(t)?Is("MapSet").proxyMap_(t,e):Vo(t)?Is("MapSet").proxySet_(t,e):vv(t,e);return(e?e.scope_:ex()).drafts_.push(r),r}function kv(t){return mr(t)||st(10,t),rx(t)}function rx(t){if(!sr(t)||Tl(t))return t;const e=t[kt];let r;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=Ju(t,e.scope_.immer_.useStrictShallowCopy_)}else r=Ju(t,!0);return Hi(r,(s,n)=>{ZA(r,s,rx(n))}),e&&(e.finalized_=!1),r}function Cv(){const e="replace",s="remove";function n(d,f,m,y){switch(d.type_){case 0:case 2:return o(d,f,m,y);case 1:return i(d,f,m,y);case 3:return a(d,f,m,y)}}function i(d,f,m,y){let{base_:g,assigned_:A}=d,b=d.copy_;b.length<g.length&&([g,b]=[b,g],[m,y]=[y,m]);for(let x=0;x<g.length;x++)if(A[x]&&b[x]!==g[x]){const w=f.concat([x]);m.push({op:e,path:w,value:h(b[x])}),y.push({op:e,path:w,value:h(g[x])})}for(let x=g.length;x<b.length;x++){const w=f.concat([x]);m.push({op:"add",path:w,value:h(b[x])})}for(let x=b.length-1;g.length<=x;--x){const w=f.concat([x]);y.push({op:s,path:w})}}function o(d,f,m,y){const{base_:g,copy_:A}=d;Hi(d.assigned_,(b,x)=>{const w=dc(g,b),q=dc(A,b),_=x?Gi(g,b)?e:"add":s;if(w===q&&_===e)return;const V=f.concat(b);m.push(_===s?{op:_,path:V}:{op:_,path:V,value:q}),y.push(_==="add"?{op:s,path:V}:_===s?{op:"add",path:V,value:h(w)}:{op:e,path:V,value:h(w)})})}function a(d,f,m,y){let{base_:g,copy_:A}=d,b=0;g.forEach(x=>{if(!A.has(x)){const w=f.concat([b]);m.push({op:s,path:w,value:x}),y.unshift({op:"add",path:w,value:x})}b++}),b=0,A.forEach(x=>{if(!g.has(x)){const w=f.concat([b]);m.push({op:"add",path:w,value:x}),y.unshift({op:s,path:w,value:x})}b++})}function l(d,f,m,y){m.push({op:e,path:[],value:f===bd?void 0:f}),y.push({op:e,path:[],value:d})}function c(d,f){return f.forEach(m=>{const{path:y,op:g}=m;let A=d;for(let q=0;q<y.length-1;q++){const _=Ms(A);let V=y[q];typeof V!="string"&&typeof V!="number"&&(V=""+V),(_===0||_===1)&&(V==="__proto__"||V==="constructor")&&st(19),typeof A=="function"&&V==="prototype"&&st(19),A=dc(A,V),typeof A!="object"&&st(18,y.join("/"))}const b=Ms(A),x=u(m.value),w=y[y.length-1];switch(g){case e:switch(b){case 2:return A.set(w,x);case 3:st(16);default:return A[w]=x}case"add":switch(b){case 1:return w==="-"?A.push(x):A.splice(w,0,x);case 2:return A.set(w,x);case 3:return A.add(x);default:return A[w]=x}case s:switch(b){case 1:return A.splice(w,1);case 2:return A.delete(w);case 3:return A.delete(m.value);default:return delete A[w]}default:st(17,g)}}),d}function u(d){if(!sr(d))return d;if(Array.isArray(d))return d.map(u);if(wo(d))return new Map(Array.from(d.entries()).map(([m,y])=>[m,u(y)]));if(Vo(d))return new Set(Array.from(d).map(u));const f=Object.create(Rs(d));for(const m in d)f[m]=u(d[m]);return Gi(d,Mi)&&(f[Mi]=d[Mi]),f}function h(d){return mr(d)?u(d):d}wv("Patches",{applyPatches_:c,generatePatches_:n,generateReplacementPatches_:l})}var zt=new Sv,Dn=zt.produce,sx=zt.produceWithPatches.bind(zt);zt.setAutoFreeze.bind(zt);zt.setUseStrictShallowCopy.bind(zt);var hp=zt.applyPatches.bind(zt);zt.createDraft.bind(zt);zt.finishDraft.bind(zt);function Ev(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function Pv(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function Tv(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(r=>typeof r=="function")){const r=t.map(s=>typeof s=="function"?`function ${s.name||"unnamed"}()`:typeof s).join(", ");throw new TypeError(`${e}[${r}]`)}}var dp=t=>Array.isArray(t)?t:[t];function Rv(t){const e=Array.isArray(t[0])?t[0]:t;return Tv(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function Mv(t,e){const r=[],{length:s}=t;for(let n=0;n<s;n++)r.push(t[n].apply(null,e));return r}var Iv=class{constructor(t){this.value=t}deref(){return this.value}},jv=typeof WeakRef<"u"?WeakRef:Iv,Ov=0,fp=1;function zo(){return{s:Ov,v:void 0,o:null,p:null}}function rl(t,e={}){let r=zo();const{resultEqualityCheck:s}=e;let n,i=0;function o(){let a=r;const{length:l}=arguments;for(let h=0,d=l;h<d;h++){const f=arguments[h];if(typeof f=="function"||typeof f=="object"&&f!==null){let m=a.o;m===null&&(a.o=m=new WeakMap);const y=m.get(f);y===void 0?(a=zo(),m.set(f,a)):a=y}else{let m=a.p;m===null&&(a.p=m=new Map);const y=m.get(f);y===void 0?(a=zo(),m.set(f,a)):a=y}}const c=a;let u;if(a.s===fp)u=a.v;else if(u=t.apply(null,arguments),i++,s){const h=n?.deref?.()??n;h!=null&&s(h,u)&&(u=h,i!==0&&i--),n=typeof u=="object"&&u!==null||typeof u=="function"?new jv(u):u}return c.s=fp,c.v=u,u}return o.clearCache=()=>{r=zo(),o.resetResultsCount()},o.resultsCount=()=>i,o.resetResultsCount=()=>{i=0},o}function Nv(t,...e){const r=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,s=(...n)=>{let i=0,o=0,a,l={},c=n.pop();typeof c=="object"&&(l=c,c=n.pop()),Ev(c,`createSelector expects an output function after the inputs, but received: [${typeof c}]`);const u={...r,...l},{memoize:h,memoizeOptions:d=[],argsMemoize:f=rl,argsMemoizeOptions:m=[]}=u,y=dp(d),g=dp(m),A=Rv(n),b=h(function(){return i++,c.apply(null,arguments)},...y),x=f(function(){o++;const q=Mv(A,arguments);return a=b.apply(null,q),a},...g);return Object.assign(x,{resultFunc:c,memoizedResultFunc:b,dependencies:A,dependencyRecomputations:()=>o,resetDependencyRecomputations:()=>{o=0},lastResult:()=>a,recomputations:()=>i,resetRecomputations:()=>{i=0},memoize:h,argsMemoize:f})};return Object.assign(s,{withTypes:()=>s}),s}var Rl=Nv(rl),Bv=Object.assign((t,e=Rl)=>{Pv(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const r=Object.keys(t),s=r.map(i=>t[i]);return e(s,(...i)=>i.reduce((o,a,l)=>(o[r[l]]=a,o),{}))},{withTypes:()=>Bv});function nx(t){return({dispatch:r,getState:s})=>n=>i=>typeof i=="function"?i(r,s,t):n(i)}var zv=nx(),Dv=nx,Lv=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Za:Za.apply(null,arguments)},Fv=t=>t&&typeof t.match=="function";function yt(t,e){function r(...s){if(e){let n=e(...s);if(!n)throw new Error(Xe(0));return{type:t,payload:n.payload,..."meta"in n&&{meta:n.meta},..."error"in n&&{error:n.error}}}return{type:t,payload:s[0]}}return r.toString=()=>`${t}`,r.type=t,r.match=s=>xd(s)&&s.type===t,r}var ix=class wi extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,wi.prototype)}static get[Symbol.species](){return wi}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new wi(...e[0].concat(this)):new wi(...e.concat(this))}};function pp(t){return sr(t)?Dn(t,()=>{}):t}function nh(t,e,r){return t.has(e)?t.get(e):t.set(e,r(e)).get(e)}function Uv(t){return typeof t=="boolean"}var $v=()=>function(e){const{thunk:r=!0,immutableCheck:s=!0,serializableCheck:n=!0,actionCreatorCheck:i=!0}=e??{};let o=new ix;return r&&(Uv(r)?o.push(zv):o.push(Dv(r.extraArgument))),o},Ml="RTK_autoBatch",ti=()=>t=>({payload:t,meta:{[Ml]:!0}}),mp=t=>e=>{setTimeout(e,t)},Hv=(t={type:"raf"})=>e=>(...r)=>{const s=e(...r);let n=!0,i=!1,o=!1;const a=new Set,l=t.type==="tick"?queueMicrotask:t.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:mp(10):t.type==="callback"?t.queueNotification:mp(t.timeout),c=()=>{o=!1,i&&(i=!1,a.forEach(u=>u()))};return Object.assign({},s,{subscribe(u){const h=()=>n&&u(),d=s.subscribe(h);return a.add(u),()=>{d(),a.delete(u)}},dispatch(u){try{return n=!u?.meta?.[Ml],i=!n,i&&(o||(o=!0,l(c))),s.dispatch(u)}finally{n=!0}}})},Gv=t=>function(r){const{autoBatch:s=!0}=r??{};let n=new ix(t);return s&&n.push(Hv(typeof s=="object"?s:void 0)),n};function Wv(t){const e=$v(),{reducer:r=void 0,middleware:s,devTools:n=!0,preloadedState:i=void 0,enhancers:o=void 0}=t||{};let a;if(typeof r=="function")a=r;else if(bn(r))a=Ad(r);else throw new Error(Xe(1));let l;typeof s=="function"?l=s(e):l=e();let c=Za;n&&(c=Lv({trace:!1,...typeof n=="object"&&n}));const u=gv(...l),h=Gv(u);let d=typeof o=="function"?o(h):h();const f=c(...d);return yd(a,i,f)}function ox(t){const e={},r=[];let s;const n={addCase(i,o){const a=typeof i=="string"?i:i.type;if(!a)throw new Error(Xe(28));if(a in e)throw new Error(Xe(29));return e[a]=o,n},addMatcher(i,o){return r.push({matcher:i,reducer:o}),n},addDefaultCase(i){return s=i,n}};return t(n),[e,r,s]}function Kv(t){return typeof t=="function"}function Yv(t,e){let[r,s,n]=ox(e),i;if(Kv(t))i=()=>pp(t());else{const a=pp(t);i=()=>a}function o(a=i(),l){let c=[r[l.type],...s.filter(({matcher:u})=>u(l)).map(({reducer:u})=>u)];return c.filter(u=>!!u).length===0&&(c=[n]),c.reduce((u,h)=>{if(h)if(mr(u)){const f=h(u,l);return f===void 0?u:f}else{if(sr(u))return Dn(u,d=>h(d,l));{const d=h(u,l);if(d===void 0){if(u===null)return u;throw Error("A case reducer on a non-draftable value must not return undefined")}return d}}return u},a)}return o.getInitialState=i,o}var ax=(t,e)=>Fv(t)?t.match(e):t(e);function gr(...t){return e=>t.some(r=>ax(r,e))}function Ii(...t){return e=>t.every(r=>ax(r,e))}function Il(t,e){if(!t||!t.meta)return!1;const r=typeof t.meta.requestId=="string",s=e.indexOf(t.meta.requestStatus)>-1;return r&&s}function qo(t){return typeof t[0]=="function"&&"pending"in t[0]&&"fulfilled"in t[0]&&"rejected"in t[0]}function qd(...t){return t.length===0?e=>Il(e,["pending"]):qo(t)?gr(...t.map(e=>e.pending)):qd()(t[0])}function wn(...t){return t.length===0?e=>Il(e,["rejected"]):qo(t)?gr(...t.map(e=>e.rejected)):wn()(t[0])}function jl(...t){const e=r=>r&&r.meta&&r.meta.rejectedWithValue;return t.length===0?Ii(wn(...t),e):qo(t)?Ii(wn(...t),e):jl()(t[0])}function Zr(...t){return t.length===0?e=>Il(e,["fulfilled"]):qo(t)?gr(...t.map(e=>e.fulfilled)):Zr()(t[0])}function ih(...t){return t.length===0?e=>Il(e,["pending","fulfilled","rejected"]):qo(t)?gr(...t.flatMap(e=>[e.pending,e.rejected,e.fulfilled])):ih()(t[0])}var Qv="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",vo=(t=21)=>{let e="",r=t;for(;r--;)e+=Qv[Math.random()*64|0];return e},Xv=["name","message","stack","code"],mc=class{constructor(t,e){this.payload=t,this.meta=e}_type},gp=class{constructor(t,e){this.payload=t,this.meta=e}_type},Jv=t=>{if(typeof t=="object"&&t!==null){const e={};for(const r of Xv)typeof t[r]=="string"&&(e[r]=t[r]);return e}return{message:String(t)}},yp="External signal was aborted",Ap=(()=>{function t(e,r,s){const n=yt(e+"/fulfilled",(l,c,u,h)=>({payload:l,meta:{...h||{},arg:u,requestId:c,requestStatus:"fulfilled"}})),i=yt(e+"/pending",(l,c,u)=>({payload:void 0,meta:{...u||{},arg:c,requestId:l,requestStatus:"pending"}})),o=yt(e+"/rejected",(l,c,u,h,d)=>({payload:h,error:(s&&s.serializeError||Jv)(l||"Rejected"),meta:{...d||{},arg:u,requestId:c,rejectedWithValue:!!h,requestStatus:"rejected",aborted:l?.name==="AbortError",condition:l?.name==="ConditionError"}}));function a(l,{signal:c}={}){return(u,h,d)=>{const f=s?.idGenerator?s.idGenerator(l):vo(),m=new AbortController;let y,g;function A(x){g=x,m.abort()}c&&(c.aborted?A(yp):c.addEventListener("abort",()=>A(yp),{once:!0}));const b=(async function(){let x;try{let q=s?.condition?.(l,{getState:h,extra:d});if(e0(q)&&(q=await q),q===!1||m.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const _=new Promise((V,S)=>{y=()=>{S({name:"AbortError",message:g||"Aborted"})},m.signal.addEventListener("abort",y)});u(i(f,l,s?.getPendingMeta?.({requestId:f,arg:l},{getState:h,extra:d}))),x=await Promise.race([_,Promise.resolve(r(l,{dispatch:u,getState:h,extra:d,requestId:f,signal:m.signal,abort:A,rejectWithValue:(V,S)=>new mc(V,S),fulfillWithValue:(V,S)=>new gp(V,S)})).then(V=>{if(V instanceof mc)throw V;return V instanceof gp?n(V.payload,f,l,V.meta):n(V,f,l)})])}catch(q){x=q instanceof mc?o(null,f,l,q.payload,q.meta):o(q,f,l)}finally{y&&m.signal.removeEventListener("abort",y)}return s&&!s.dispatchConditionRejection&&o.match(x)&&x.meta.condition||u(x),x})();return Object.assign(b,{abort:A,requestId:f,arg:l,unwrap(){return b.then(Zv)}})}}return Object.assign(a,{pending:i,rejected:o,fulfilled:n,settled:gr(o,n),typePrefix:e})}return t.withTypes=()=>t,t})();function Zv(t){if(t.meta&&t.meta.rejectedWithValue)throw t.payload;if(t.error)throw t.error;return t.payload}function e0(t){return t!==null&&typeof t=="object"&&typeof t.then=="function"}var t0=Symbol.for("rtk-slice-createasyncthunk");function r0(t,e){return`${t}/${e}`}function s0({creators:t}={}){const e=t?.asyncThunk?.[t0];return function(s){const{name:n,reducerPath:i=n}=s;if(!n)throw new Error(Xe(11));const o=(typeof s.reducers=="function"?s.reducers(i0()):s.reducers)||{},a=Object.keys(o),l={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},c={addCase(b,x){const w=typeof b=="string"?b:b.type;if(!w)throw new Error(Xe(12));if(w in l.sliceCaseReducersByType)throw new Error(Xe(13));return l.sliceCaseReducersByType[w]=x,c},addMatcher(b,x){return l.sliceMatchers.push({matcher:b,reducer:x}),c},exposeAction(b,x){return l.actionCreators[b]=x,c},exposeCaseReducer(b,x){return l.sliceCaseReducersByName[b]=x,c}};a.forEach(b=>{const x=o[b],w={reducerName:b,type:r0(n,b),createNotation:typeof s.reducers=="function"};a0(x)?c0(w,x,c,e):o0(w,x,c)});function u(){const[b={},x=[],w=void 0]=typeof s.extraReducers=="function"?ox(s.extraReducers):[s.extraReducers],q={...b,...l.sliceCaseReducersByType};return Yv(s.initialState,_=>{for(let V in q)_.addCase(V,q[V]);for(let V of l.sliceMatchers)_.addMatcher(V.matcher,V.reducer);for(let V of x)_.addMatcher(V.matcher,V.reducer);w&&_.addDefaultCase(w)})}const h=b=>b,d=new Map;let f;function m(b,x){return f||(f=u()),f(b,x)}function y(){return f||(f=u()),f.getInitialState()}function g(b,x=!1){function w(_){let V=_[b];return typeof V>"u"&&x&&(V=y()),V}function q(_=h){const V=nh(d,x,()=>new WeakMap);return nh(V,_,()=>{const S={};for(const[k,C]of Object.entries(s.selectors??{}))S[k]=n0(C,_,y,x);return S})}return{reducerPath:b,getSelectors:q,get selectors(){return q(w)},selectSlice:w}}const A={name:n,reducer:m,actions:l.actionCreators,caseReducers:l.sliceCaseReducersByName,getInitialState:y,...g(i),injectInto(b,{reducerPath:x,...w}={}){const q=x??i;return b.inject({reducerPath:q,reducer:m},w),{...A,...g(q,!0)}}};return A}}function n0(t,e,r,s){function n(i,...o){let a=e(i);return typeof a>"u"&&s&&(a=r()),t(a,...o)}return n.unwrapped=t,n}var Sr=s0();function i0(){function t(e,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...r}}return t.withTypes=()=>t,{reducer(e){return Object.assign({[e.name](...r){return e(...r)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:r}},asyncThunk:t}}function o0({type:t,reducerName:e,createNotation:r},s,n){let i,o;if("reducer"in s){if(r&&!l0(s))throw new Error(Xe(17));i=s.reducer,o=s.prepare}else i=s;n.addCase(t,i).exposeCaseReducer(e,i).exposeAction(e,o?yt(t,o):yt(t))}function a0(t){return t._reducerDefinitionType==="asyncThunk"}function l0(t){return t._reducerDefinitionType==="reducerWithPrepare"}function c0({type:t,reducerName:e},r,s,n){if(!n)throw new Error(Xe(18));const{payloadCreator:i,fulfilled:o,pending:a,rejected:l,settled:c,options:u}=r,h=n(t,i,u);s.exposeAction(e,h),o&&s.addCase(h.fulfilled,o),a&&s.addCase(h.pending,a),l&&s.addCase(h.rejected,l),c&&s.addMatcher(h.settled,c),s.exposeCaseReducer(e,{fulfilled:o||Do,pending:a||Do,rejected:l||Do,settled:c||Do})}function Do(){}var u0="task",lx="listener",cx="completed",vd="cancelled",h0=`task-${vd}`,d0=`task-${cx}`,oh=`${lx}-${vd}`,f0=`${lx}-${cx}`,Ol=class{constructor(t){this.code=t,this.message=`${u0} ${vd} (reason: ${t})`}name="TaskAbortError";message},_d=(t,e)=>{if(typeof t!="function")throw new TypeError(Xe(32))},sl=()=>{},ux=(t,e=sl)=>(t.catch(e),t),hx=(t,e)=>(t.addEventListener("abort",e,{once:!0}),()=>t.removeEventListener("abort",e)),Es=(t,e)=>{const r=t.signal;r.aborted||("reason"in r||Object.defineProperty(r,"reason",{enumerable:!0,value:e,configurable:!0,writable:!0}),t.abort(e))},Ps=t=>{if(t.aborted){const{reason:e}=t;throw new Ol(e)}};function dx(t,e){let r=sl;return new Promise((s,n)=>{const i=()=>n(new Ol(t.reason));if(t.aborted){i();return}r=hx(t,i),e.finally(()=>r()).then(s,n)}).finally(()=>{r=sl})}var p0=async(t,e)=>{try{return await Promise.resolve(),{status:"ok",value:await t()}}catch(r){return{status:r instanceof Ol?"cancelled":"rejected",error:r}}finally{e?.()}},nl=t=>e=>ux(dx(t,e).then(r=>(Ps(t),r))),fx=t=>{const e=nl(t);return r=>e(new Promise(s=>setTimeout(s,r)))},{assign:dn}=Object,xp={},Nl="listenerMiddleware",m0=(t,e)=>{const r=s=>hx(t,()=>Es(s,t.reason));return(s,n)=>{_d(s);const i=new AbortController;r(i);const o=p0(async()=>{Ps(t),Ps(i.signal);const a=await s({pause:nl(i.signal),delay:fx(i.signal),signal:i.signal});return Ps(i.signal),a},()=>Es(i,d0));return n?.autoJoin&&e.push(o.catch(sl)),{result:nl(t)(o),cancel(){Es(i,h0)}}}},g0=(t,e)=>{const r=async(s,n)=>{Ps(e);let i=()=>{};const a=[new Promise((l,c)=>{let u=t({predicate:s,effect:(h,d)=>{d.unsubscribe(),l([h,d.getState(),d.getOriginalState()])}});i=()=>{u(),c()}})];n!=null&&a.push(new Promise(l=>setTimeout(l,n,null)));try{const l=await dx(e,Promise.race(a));return Ps(e),l}finally{i()}};return(s,n)=>ux(r(s,n))},px=t=>{let{type:e,actionCreator:r,matcher:s,predicate:n,effect:i}=t;if(e)n=yt(e).match;else if(r)e=r.type,n=r.match;else if(s)n=s;else if(!n)throw new Error(Xe(21));return _d(i),{predicate:n,type:e,effect:i}},mx=dn(t=>{const{type:e,predicate:r,effect:s}=px(t);return{id:vo(),effect:s,type:e,predicate:r,pending:new Set,unsubscribe:()=>{throw new Error(Xe(22))}}},{withTypes:()=>mx}),bp=(t,e)=>{const{type:r,effect:s,predicate:n}=px(e);return Array.from(t.values()).find(i=>(typeof r=="string"?i.type===r:i.predicate===n)&&i.effect===s)},ah=t=>{t.pending.forEach(e=>{Es(e,oh)})},y0=t=>()=>{t.forEach(ah),t.clear()},wp=(t,e,r)=>{try{t(e,r)}catch(s){setTimeout(()=>{throw s},0)}},gx=dn(yt(`${Nl}/add`),{withTypes:()=>gx}),A0=yt(`${Nl}/removeAll`),yx=dn(yt(`${Nl}/remove`),{withTypes:()=>yx}),x0=(...t)=>{console.error(`${Nl}/error`,...t)},b0=(t={})=>{const e=new Map,{extra:r,onError:s=x0}=t;_d(s);const n=u=>(u.unsubscribe=()=>e.delete(u.id),e.set(u.id,u),h=>{u.unsubscribe(),h?.cancelActive&&ah(u)}),i=u=>{const h=bp(e,u)??mx(u);return n(h)};dn(i,{withTypes:()=>i});const o=u=>{const h=bp(e,u);return h&&(h.unsubscribe(),u.cancelActive&&ah(h)),!!h};dn(o,{withTypes:()=>o});const a=async(u,h,d,f)=>{const m=new AbortController,y=g0(i,m.signal),g=[];try{u.pending.add(m),await Promise.resolve(u.effect(h,dn({},d,{getOriginalState:f,condition:(A,b)=>y(A,b).then(Boolean),take:y,delay:fx(m.signal),pause:nl(m.signal),extra:r,signal:m.signal,fork:m0(m.signal,g),unsubscribe:u.unsubscribe,subscribe:()=>{e.set(u.id,u)},cancelActiveListeners:()=>{u.pending.forEach((A,b,x)=>{A!==m&&(Es(A,oh),x.delete(A))})},cancel:()=>{Es(m,oh),u.pending.delete(m)},throwIfCancelled:()=>{Ps(m.signal)}})))}catch(A){A instanceof Ol||wp(s,A,{raisedBy:"effect"})}finally{await Promise.all(g),Es(m,f0),u.pending.delete(m)}},l=y0(e);return{middleware:u=>h=>d=>{if(!xd(d))return h(d);if(gx.match(d))return i(d.payload);if(A0.match(d)){l();return}if(yx.match(d))return o(d.payload);let f=u.getState();const m=()=>{if(f===xp)throw new Error(Xe(23));return f};let y;try{if(y=h(d),e.size>0){const g=u.getState(),A=Array.from(e.values());for(const b of A){let x=!1;try{x=b.predicate(d,g,f)}catch(w){x=!1,wp(s,w,{raisedBy:"predicate"})}x&&a(b,d,u,m)}}}finally{f=xp}return y},startListening:i,stopListening:o,clearListeners:l}},w0=t=>"reducerPath"in t&&typeof t.reducerPath=="string",V0=t=>t.flatMap(e=>w0(e)?[[e.reducerPath,e.reducer]]:Object.entries(e)),Sd=Symbol.for("rtk-state-proxy-original"),q0=t=>!!t&&!!t[Sd],v0=new WeakMap,_0=(t,e)=>nh(v0,t,()=>new Proxy(t,{get:(r,s,n)=>{if(s===Sd)return r;const i=Reflect.get(r,s,n);if(typeof i>"u"){const o=e[s.toString()];if(o){const a=o(void 0,{type:vo()});if(typeof a>"u")throw new Error(Xe(24));return a}}return i}})),S0=t=>{if(!q0(t))throw new Error(Xe(25));return t[Sd]},k0=(t={})=>t;function C0(...t){const e=Object.fromEntries(V0(t)),r=()=>Object.keys(e).length?Ad(e):k0;let s=r();function n(a,l){return s(a,l)}n.withLazyLoadedSlices=()=>n;const i=(a,l={})=>{const{reducerPath:c,reducer:u}=a,h=e[c];return!l.overrideExisting&&h&&h!==u||(e[c]=u,s=r()),n},o=Object.assign(function(l,c){return function(h,...d){return l(_0(c?c(h,...d):h,e),...d)}},{original:S0});return Object.assign(n,{inject:i,selector:o})}function Xe(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}const kd=v.createContext(null),E0=({gameApi:t,children:e})=>p.jsx(kd,{value:t,children:e}),Ln=()=>{const t=v.useContext(kd);if(t===null)throw new Error("useGameApi must be used within a GameApiProvider");if(t===void 0)throw new Error("useGameApi must be called once we have a GameApi");return t},Ax=()=>{const t=v.useContext(kd);if(t===null)throw new Error("useGameApi must be used within a GameApiProvider");return t},xx=b0(),Cd=xx.startListening.withTypes();function P0(t){var e="";return r(t),e;function r(n){if(n===null||typeof n!="object"||n.toJSON!=null)e+=JSON.stringify(n);else if(Array.isArray(n)){e+="[";var i=!1;n.forEach(function(a){i&&(e+=","),i=!0,a===void 0&&(a=null),r(a)}),e+="]"}else{e+="{";var o=Object.keys(n).filter(function(a){return n[a]!==void 0}).sort();o.forEach(function(a,l){return s(n,a,l)}),e+="}"}}function s(n,i,o){o>0&&(e+=","),e+=JSON.stringify(i),e+=":",r(n[i])}}var Ed="persist:",Pd="persist/FLUSH",_o="persist/REHYDRATE",Td="persist/PAUSE",Rd="persist/PERSIST",Md="persist/PURGE",Id="persist/REGISTER",bx=-1;function Da(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Da=function(r){return typeof r}:Da=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Da(t)}function Vp(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function T0(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Vp(r,!0).forEach(function(s){R0(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Vp(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function R0(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function M0(t,e,r,s){s.debug;var n=T0({},r);return t&&Da(t)==="object"&&Object.keys(t).forEach(function(i){i!=="_persist"&&e[i]===r[i]&&(n[i]=t[i])}),n}function I0(t){var e=t.blacklist||null,r=t.whitelist||null,s=t.transforms||[],n=t.throttle||0,i="".concat(t.keyPrefix!==void 0?t.keyPrefix:Ed).concat(t.key),o=t.storage,a;t.serialize===!1?a=function(q){return q}:typeof t.serialize=="function"?a=t.serialize:a=j0;var l=t.writeFailHandler||null,c={},u={},h=[],d=null,f=null,m=function(q){Object.keys(q).forEach(function(_){A(_)&&c[_]!==q[_]&&h.indexOf(_)===-1&&h.push(_)}),Object.keys(c).forEach(function(_){q[_]===void 0&&A(_)&&h.indexOf(_)===-1&&c[_]!==void 0&&h.push(_)}),d===null&&(d=setInterval(y,n)),c=q};function y(){if(h.length===0){d&&clearInterval(d),d=null;return}var w=h.shift(),q=s.reduce(function(_,V){return V.in(_,w,c)},c[w]);if(q!==void 0)try{u[w]=a(q)}catch(_){console.error("redux-persist/createPersistoid: error serializing state",_)}else delete u[w];h.length===0&&g()}function g(){Object.keys(u).forEach(function(w){c[w]===void 0&&delete u[w]}),f=o.setItem(i,a(u)).catch(b)}function A(w){return!(r&&r.indexOf(w)===-1&&w!=="_persist"||e&&e.indexOf(w)!==-1)}function b(w){l&&l(w)}var x=function(){for(;h.length!==0;)y();return f||Promise.resolve()};return{update:m,flush:x}}function j0(t){return JSON.stringify(t)}function O0(t){var e=t.transforms||[],r="".concat(t.keyPrefix!==void 0?t.keyPrefix:Ed).concat(t.key),s=t.storage;t.debug;var n;return t.deserialize===!1?n=function(o){return o}:typeof t.deserialize=="function"?n=t.deserialize:n=N0,s.getItem(r).then(function(i){if(i)try{var o={},a=n(i);return Object.keys(a).forEach(function(l){o[l]=e.reduceRight(function(c,u){return u.out(c,l,a)},n(a[l]))}),o}catch(l){throw l}else return})}function N0(t){return JSON.parse(t)}function B0(t){var e=t.storage,r="".concat(t.keyPrefix!==void 0?t.keyPrefix:Ed).concat(t.key);return e.removeItem(r,z0)}function z0(t){}function qp(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function Vr(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?qp(r,!0).forEach(function(s){D0(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):qp(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function D0(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function L0(t,e){if(t==null)return{};var r=F0(t,e),s,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)s=i[n],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(r[s]=t[s])}return r}function F0(t,e){if(t==null)return{};var r={},s=Object.keys(t),n,i;for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&(r[n]=t[n]);return r}var U0=5e3;function $0(t,e){var r=t.version!==void 0?t.version:bx;t.debug;var s=t.stateReconciler===void 0?M0:t.stateReconciler,n=t.getStoredState||O0,i=t.timeout!==void 0?t.timeout:U0,o=null,a=!1,l=!0,c=function(h){return h._persist.rehydrated&&o&&!l&&o.update(h),h};return function(u,h){var d=u||{},f=d._persist,m=L0(d,["_persist"]),y=m;if(h.type===Rd){var g=!1,A=function(S,k){g||(h.rehydrate(t.key,S,k),g=!0)};if(i&&setTimeout(function(){!g&&A(void 0,new Error('redux-persist: persist timed out for persist key "'.concat(t.key,'"')))},i),l=!1,o||(o=I0(t)),f)return Vr({},e(y,h),{_persist:f});if(typeof h.rehydrate!="function"||typeof h.register!="function")throw new Error("redux-persist: either rehydrate or register is not a function on the PERSIST action. This can happen if the action is being replayed. This is an unexplored use case, please open an issue and we will figure out a resolution.");return h.register(t.key),n(t).then(function(V){var S=t.migrate||function(k,C){return Promise.resolve(k)};S(V,r).then(function(k){A(k)},function(k){A(void 0,k)})},function(V){A(void 0,V)}),Vr({},e(y,h),{_persist:{version:r,rehydrated:!1}})}else{if(h.type===Md)return a=!0,h.result(B0(t)),Vr({},e(y,h),{_persist:f});if(h.type===Pd)return h.result(o&&o.flush()),Vr({},e(y,h),{_persist:f});if(h.type===Td)l=!0;else if(h.type===_o){if(a)return Vr({},y,{_persist:Vr({},f,{rehydrated:!0})});if(h.key===t.key){var b=e(y,h),x=h.payload,w=s!==!1&&x!==void 0?s(x,u,b,t):b,q=Vr({},w,{_persist:Vr({},f,{rehydrated:!0})});return c(q)}}}if(!f)return e(u,h);var _=e(y,h);return _===y?u:c(Vr({},_,{_persist:f}))}}function vp(t){return W0(t)||G0(t)||H0()}function H0(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function G0(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}function W0(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function _p(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function lh(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?_p(r,!0).forEach(function(s){K0(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_p(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function K0(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var wx={registry:[],bootstrapped:!1},Y0=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wx,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case Id:return lh({},e,{registry:[].concat(vp(e.registry),[r.key])});case _o:var s=e.registry.indexOf(r.key),n=vp(e.registry);return n.splice(s,1),lh({},e,{registry:n,bootstrapped:n.length===0});default:return e}};function Q0(t,e,r){var s=yd(Y0,wx,void 0),n=function(l){s.dispatch({type:Id,key:l})},i=function(l,c,u){var h={type:_o,payload:c,err:u,key:l};t.dispatch(h),s.dispatch(h)},o=lh({},s,{purge:function(){var l=[];return t.dispatch({type:Md,result:function(u){l.push(u)}}),Promise.all(l)},flush:function(){var l=[];return t.dispatch({type:Pd,result:function(u){l.push(u)}}),Promise.all(l)},pause:function(){t.dispatch({type:Td})},persist:function(){t.dispatch({type:Rd,register:n,rehydrate:i})}});return o.persist(),o}function X0(t,e){return function(r,s){if(!r)return Promise.resolve(void 0);var n=r._persist&&r._persist.version!==void 0?r._persist.version:bx;if(n===s||n>s)return Promise.resolve(r);var i=Object.keys(t).map(function(a){return parseInt(a)}).filter(function(a){return s>=a&&a>n}).sort(function(a,l){return a-l});try{var o=i.reduce(function(a,l){return t[l](a)},r);return Promise.resolve(o)}catch(a){return Promise.reject(a)}}}const Wr=1e-4,tr=(t,e)=>Math.abs(t-e)<Wr,fU=t=>t===0?Wr:Math.abs(t)<Wr?Wr*Math.sign(t):t,fn=["away","towards","left","right"],J0=["awayRight","towardsRight","towardsLeft","awayLeft"],Vn=[...fn,...J0],Vx=t=>t==="away"||t==="towards"?"y":"x",pU=t=>t==="away"?"towards":t==="towards"?"away":t==="left"?"right":"left",qx=t=>Bl(Vx(t)),Bl=t=>t==="x"?"y":"x",Kr=(t,...e)=>{const r={x:t.x,y:t.y};for(const s of e)r.x+=s.x??0,r.y+=s.y??0;return r},Z0=(t,...e)=>{const r={x:t.x,y:t.y};for(const s of e)r.x-=s.x??0,r.y-=s.y??0;return r},vx=(t,e)=>({x:t.x*e,y:t.y*e}),mU=(t,e)=>(t.x*=e,t.y*=e,t),Wt=(t,e)=>({x:t.x*e,y:t.y*e,z:t.z*e}),Sp=(t,e,r)=>{const s=t;return s.x=e.x*r,s.y=e.y*r,s.z=e.z*r,s},e_=(t,e)=>(t.x*=e,t.y*=e,t.z*=e,t),t_=(t,e)=>({x:t.x*e.x,y:t.y*e.y,z:t.z*e.z}),Fn=({x:t,y:e,z:r})=>Math.hypot(t,e,r),_x=({x:t,y:e})=>Math.hypot(t,e),r_=({x:t,y:e,z:r})=>t**2+e**2+r**2,s_=({x:t,y:e})=>t**2+e**2,n_=t=>{const e=Fn(t);if(e===0)throw new Error("unitVector called with zero length vector");return Wt(t,1/e)},cn=t=>{const e=Fn(t);if(e===0)throw new Error("unitVectorInPlace called with zero length vector");return e_(t,1/e)},U=(...t)=>{if(t.length===0)return{x:0,y:0,z:0};const[e,...r]=t,s={x:e.x??0,y:e.y??0,z:e.z??0};for(const n of r)s.x+=n.x??0,s.y+=n.y??0,s.z+=n.z??0;return s},i_=(t,...e)=>{for(const r of e)t.x+=r.x??0,t.y+=r.y??0,t.z+=r.z??0;return t},Sx=(...t)=>t.reduce(({x:e,y:r,z:s},{x:n,y:i,z:o})=>({x:e*n,y:r*i,z:s*o}),So),Mr=(t,...e)=>{const r={x:t.x,y:t.y,z:t.z};for(const s of e)r.x-=s.x??0,r.y-=s.y??0,r.z-=s.z??0;return r},o_=(t,...e)=>{for(const r of e)t.x-=r.x??0,t.y-=r.y??0,t.z-=r.z??0;return t},jd=({x:t,y:e,z:r},{x:s,y:n,z:i})=>t===s&&e===n&&r===i,a_=({x:t,y:e},{x:r,y:s})=>t===r&&e===s,gU=t=>{const{x:e}=t,r=Math.round(e),s=!Number.isInteger(e)&&tr(e,r),{y:n}=t,i=Math.round(n),o=!Number.isInteger(n)&&tr(n,i),{z:a}=t,l=Math.round(a),c=!Number.isInteger(a)&&tr(t.z,l);return s||o||c?{x:s?r:e,y:o?i:n,z:c?l:a}:t},yU=({x:t=0,y:e=0,z:r=0})=>Number.isInteger(t)&&Number.isInteger(e)&&Number.isInteger(r),AU=({x:t,y:e,z:r})=>({x:Math.round(t),y:Math.round(e),z:Math.round(r)}),kx=Object.freeze({x:0,y:0}),ee=Object.freeze({x:0,y:0,z:0}),So=Object.freeze({x:1,y:1,z:1}),xU=Object.freeze({x:1,y:1,z:0}),bU=Object.freeze({x:1,y:0,z:1}),wU=Object.freeze({x:0,y:1,z:1}),VU=Object.freeze({x:1,y:0,z:0}),qU=Object.freeze({x:0,y:1,z:0}),l_=["x","y","z"],il=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,c_=({x:t,y:e})=>{if(!(tr(t,0)&&tr(e,0)))return e>t?e>-t?"away":"right":e>-t?"left":"towards"},u_=["right","towardsRight","towards","towardsLeft","left","awayLeft","away","awayRight"],Od=({x:t,y:e})=>{if(tr(t,0)&&tr(e,0))return;const r=Math.atan2(-e,-t),s=Math.round(8*r/(2*Math.PI))&7;return u_[s]},vU=({x:t,y:e},{x:r,y:s})=>Math.abs(r-t)**2+Math.abs(s-e)**2,_U=(t,e)=>{const r=t.x*e.x+t.y*e.y+t.z*e.z;if(r<=0)return!1;const s=t.x*t.x+t.y*t.y+t.z*t.z,n=e.x*e.x+e.y*e.y+e.z*e.z;return Math.abs(r*r-s*n)<Wr},SU=t=>{t.x=0,t.y=0,t.z=0},Cx=["lookUp","lookDown","lookLeft","lookRight"],Ex=["jump","fire","carry","swop","swop.head","swop.heels","hold","toggleColourisation","toggleCrtFilter","cycleResolution","toggleShowFps","menu_select","menu_openOrExit","menu_exit","map",...fn,"lookShift",...Cx,"pageUp","pageDown","home","end"],Px=[...Ex];var Pt={},gc={},yc={},kp;function zl(){if(kp)return yc;kp=1;function t(e){return typeof e<"u"}return yc.notUndefined=t,yc}var Cp;function Tx(){if(Cp)return gc;Cp=1;const{notUndefined:t}=zl();function e(r){return r!=null&&t(r[Symbol.iterator])}return gc.isIterable=e,gc}var Ac={},Ep;function h_(){return Ep||(Ep=1,Ac.isLoopable=Tx().isIterable),Ac}var xc={},Pp;function d_(){if(Pp)return xc;Pp=1;const{notUndefined:t}=zl();function e(r){return r==null||t(r[Symbol.iterator])}return xc.isWrappable=e,xc}var Lo={},Tp;function f_(){if(Tp)return Lo;Tp=1;function*t(r){yield*r}Lo.wrap=t;function*e(r){r!=null&&(yield*r)}return Lo.nullableWrap=e,Lo}var Fo={},Rp;function p_(){if(Rp)return Fo;Rp=1;function t(s,n=s.length,i=[]){return(...o)=>n<=o.length?s(...i,...o):t(s,n-o.length,[...i,...o])}Fo.curry=t;function e(s,n){const{fn:i,validateArgs:o,variadic:a,reduces:l,growRight:c,minArgs:u,maxArgs:h,isIterable:d,iterableType:f,applyOnIterableArgs:m,IterableClass:y}=s;if(n.length>u){let g=!0;const A=a?n.findIndex((x,w)=>d(x)&&w>=u):Math.min(h,n.length-1),b=a?n.length:A+1;if(a)for(let x=A;x<n.length;x++)g=g&&d(n[x]);else g=d(n[A]);if(n.length>h&&(A===-1||!g)){const x=a?`...${f}s`:f,w=`${i.name} takes up to ${h} arguments, followed by ${x}. You already passed ${n.length} arguments`;throw a?new Error(`${w} and the following arguments were not all ${f}s`):new Error(`${w} and the last argument was not ${f}`)}if(A>=0&&g){for(let w=A;w<b;w++)n[w]=m(n[w]);const x=a?n.slice(A):n[A];return n.splice(A),c||n.reverse(),n.unshift(x),o(n),l?i(...n):new y(i,n)}}return r(s,n)}function r(s,n=[]){return(...i)=>{if(i.length===0)throw new Error("Cannot make a partial application with no arguments");return i.unshift(...n),e(s,i)}}return Fo.variadicCurryWithValidation=r,Fo}var ri={},Mp;function m_(){if(Mp)return ri;Mp=1;const t=Symbol.for("_");ri._=t;const e=Symbol("__iterate");ri.__iterate=e;const r=Symbol("split");return ri.split=r,ri}var Ip;function Ct(){if(Ip)return Pt;Ip=1;const{isIterable:t}=Tx(),{isLoopable:e}=h_(),{isWrappable:r}=d_(),{nullableWrap:s}=f_(),{variadicCurryWithValidation:n}=p_(),{_:i,__iterate:o}=m_();Pt.wrap=s,Pt.isIterable=t,Pt.isLoopable=e,Pt.isWrappable=r;function a(y){if(r(y))return t(y)?y:s(y);throw typeof y.next=="function"?new TypeError("iter-tools received a value that looked like an iterator but was not iterable. Get help fixing this: https://github.com/iter-tools/iter-tools/wiki/Making-iterators-iterable"):new TypeError("Expected an iterable, null, or undefined")}Pt.ensureIterable=a;function l(y){"return"in y&&y.return()}Pt.callReturn=l;function c(y,g){this[i]={fn:y,args:g,staticIterator:null}}Pt.BaseIterableIterator=c,Object.assign(c.prototype,{constructor:c,[o](){const{fn:y,args:g}=this[i];return y(...g)},next(){const y=this[i];return y.staticIterator=y.staticIterator||this[o](),y.staticIterator.next()},return(y){const g=this[i];return g.staticIterator=g.staticIterator||this[o](),g.staticIterator.return(y)},throw(y){const g=this[i];return g.staticIterator=g.staticIterator||this[o](),g.staticIterator.throw(y)}});function u(...y){c.apply(this,y)}Pt.IterableIterator=u,u.prototype=Object.assign(Object.create(c.prototype),{constructor:u,[Symbol.iterator](){return this[o]()}});function h(y,g={}){const{validateArgs:A=S=>{},variadic:b=!1,reduces:x=!1,growRight:w=!1,minArgs:q=y.length-1,maxArgs:_=y.length-1,applyOnIterableArgs:V=a}=g;return{fn:y,validateArgs:A,variadic:b,reduces:x,growRight:w,minArgs:q,maxArgs:_,isIterable:r,iterableType:"iterable",applyOnIterableArgs:V,IterableClass:u}}function d(y){return[...y]}Pt.cache=d;function f(y,{validateArgs:g=A=>A}={}){return(...A)=>(g(A),new u(y,A))}Pt.wrapWithIterableIterator=f;const m=(y,g)=>n(h(y,g));return Pt.iterableCurry=m,Pt}var bc={},jp;function g_(){if(jp)return bc;jp=1;class t{[Symbol.iterator](){return this}}return bc.IterableIterator=t,bc}var si={},Op;function Rx(){if(Op)return si;Op=1;function t(s,n=!1){return typeof s=="number"&&!isNaN(s)&&isFinite(s)&&!(n&&s===0)}si.isInteger=t;function e(s,n=!1){return t(s)&&(n?s>0:s>=0)}si.isPositiveInteger=e;function r(s,n=!1){return typeof s=="number"&&!isNaN(s)&&!(n&&s===0)}return si.isIntegerOrInfinite=r,si}var Uo={},Np;function y_(){if(Np)return Uo;Np=1;const{iterableCurry:t}=Ct();function*e(s,n){let i=0;for(const o of s)yield n(o,i++)}Uo.__map=e;const r=t(e);return Uo.map=r,Uo}var $o={},Bp;function A_(){if(Bp)return $o;Bp=1;const{ensureIterable:t}=Ct();function e(s){const n=[];for(const i of s)n.push(i);return n}$o.__toArray=e;function r(s){return e(t(s))}return $o.toArray=r,$o}var wc={},zp;function Mx(){if(zp)return wc;zp=1;function t(e){return typeof e=="object"&&e!==null}return wc.isObject=t,wc}var Vc={},Dp;function x_(){if(Dp)return Vc;Dp=1;function t(e,r){for(const s of e)r(s)}return Vc.parallelEach=t,Vc}var qc={},Lp;function b_(){if(Lp)return qc;Lp=1;const{ensureIterable:t,callReturn:e}=Ct(),r=Symbol.for("_");class s{constructor(o){this.peekr=o}next(){const{peekr:o}=this,{current:a}=o;return o.advance(),a}return(){return this.peekr.return(),{value:void 0,done:!0}}[Symbol.iterator](){return this}}class n{static from(o,...a){const l=t(o)[Symbol.iterator](),c=l.next();return new this(l,c,...a)}constructor(o,a){this[r]={iterator:o,current:a,index:0}}get current(){return this[r].current}get value(){return this[r].current.value}get done(){return this[r].current.done}get index(){return this[r].index}advance(){const o=this[r];return o.current.done||(o.index++,o.current=o.iterator.next()),this}return(){const o=this[r];return this.done||e(o.iterator),o.current={value:void 0,done:!0},this}asIterator(){return new s(this)}}return qc.Peekerator=n,qc}var vc={},Fp;function w_(){if(Fp)return vc;Fp=1;const{isInteger:t}=Rx(),{isObject:e}=Mx(),{notUndefined:r}=zl(),s=n=>function(o){if(e(o[1])){const{start:a,step:l}=o[1];o[1]=a,o[2]=l}if(r(o[2])&&(o[2]=Number(o[2]),!t(o[2],!0)))throw new Error(`step argument to ${n} must be a non-zero integer`)};return vc.makeValidateArgs=s,vc}var ni={},Up;function V_(){if(Up)return ni;Up=1;const{iterableCurry:t,callReturn:e}=Ct(),{IterableIterator:r}=g_(),{parallelEach:s}=x_(),{Peekerator:n}=b_(),{__map:i}=y_(),{__toArray:o}=A_(),a=Symbol.for("_"),l=Symbol.for("__advance");class c extends n{constructor(g,A,b){super(g,A),this[a].inputSummary=b}advance(){this[a].inputSummary.advanceBuffer(this)}[l](){super.advance()}}class u{constructor(){this.buffers=[],this.notDoneBuffer=null,this.index=0}init(g){this.buffers=g,this.updateNotDone()}updateNotDone(){this.notDoneBuffer=this.buffers.find(g=>!g.done)}advanceBuffer(g){const A=g.done;g[l](),this.index++,!A&&g.done&&this.updateNotDone()}}class h{constructor(g){this[a]=g}advance(){throw new Error("advance() is not supported on an interleave summary")}get current(){return{value:this.value,done:this.done}}get value(){return this[a].notDoneBuffer}get done(){return this[a].notDoneBuffer===void 0}get index(){return this[a].index}}ni.InputSummary=h;class d extends r{constructor(g,A,b){super(),this.sources=g,this.strategy=A,this.options=b,this.initialized=!1,this.inputSummary=new u(g)}init(){this.initialized=!0;const{strategy:g,options:A,inputSummary:b}=this;this.buffers=o(i(this.sources,x=>c.from(x,b))),this.iterator=g(A,new h(b),...this.buffers),b.init(this.buffers)}returnBuffers(){s(this.buffers,g=>g.return())}next(){this.initialized||this.init();const g=this.iterator.next();return g.done&&this.returnBuffers(),g}return(){return e(this.iterator),this.returnBuffers(),{value:void 0,done:!0}}}function f(y,g,A={}){return new d(y,g,A)}ni.__interleave=f;const m=t(f,{variadic:!0,growRight:!0,minArgs:1,maxArgs:2});return ni.interleave=m,ni}var Ho={},Go={},$p;function Ix(){if($p)return Go;$p=1;const{iterableCurry:t,callReturn:e}=Ct();function r(n,i){const o=n[Symbol.iterator](),{value:a,done:l}=o.next();return l?i:(e(o),a)}Go.__firstOr=r;const s=t(r,{reduces:!0});return Go.firstOr=s,Go}var Hp;function q_(){if(Hp)return Ho;Hp=1;const{iterableCurry:t}=Ct(),{__firstOr:e}=Ix();function r(n){return e(n,void 0)}Ho.__first=r;const s=t(r,{reduces:!0});return Ho.first=s,Ho}var Wo={},Gp;function v_(){if(Gp)return Wo;Gp=1;const{iterableCurry:t}=Ct(),{__firstOr:e}=Ix(),r=Symbol("none");function s(i){return e(i,r)===r}Wo.__isEmpty=s;const n=t(s,{reduces:!0});return Wo.isEmpty=n,Wo}var Ko={},Wp;function __(){if(Wp)return Ko;Wp=1;const{wrapWithIterableIterator:t}=Ct(),{hasOwnProperty:e}=Object.prototype;function*r(n){if(n!=null)for(const i in n)e.call(n,i)&&(yield[i,n[i]])}Ko.__objectEntries=r;const s=t(r,{validateArgs(n){if(!(n[0]==null||typeof n[0]=="object"))throw new Error("obj argument to objectEntries must be an object, null, or undefined")}});return Ko.objectEntries=s,Ko}var Yo={},Kp;function S_(){if(Kp)return Yo;Kp=1;const{wrapWithIterableIterator:t}=Ct(),{hasOwnProperty:e}=Object.prototype;function*r(n){if(n!=null)for(const i in n)e.call(n,i)&&(yield i)}Yo.__objectKeys=r;const s=t(r,{validateArgs(n){if(!(n[0]==null||typeof n[0]=="object"))throw new Error("obj argument to objectKeys must be an object, null, or undefined")}});return Yo.objectKeys=s,Yo}var Qo={},Yp;function k_(){if(Yp)return Qo;Yp=1;const{wrapWithIterableIterator:t}=Ct(),{hasOwnProperty:e}=Object.prototype;function*r(n){if(n!=null)for(const i in n)e.call(n,i)&&(yield n[i])}Qo.__objectValues=r;const s=t(r,{validateArgs(n){if(!(n[0]==null||typeof n[0]=="object"))throw new Error("obj argument to objectValues must be an object, null, or undefined")}});return Qo.objectValues=s,Qo}var Xo={},Qp;function C_(){if(Qp)return Xo;Qp=1;const{wrapWithIterableIterator:t}=Ct(),{isInteger:e,isIntegerOrInfinite:r}=Rx(),{isObject:s}=Mx(),{notUndefined:n}=zl();function*i(a=0,l=1/0,c=1){for(let u=a;c>0?u<l:u>l;u+=c)yield u}Xo.__range=i;const o=t(i,{growRight:!0,validateArgs(a){let[l,c=1/0,u]=a,h;if(s(l)?{start:h,end:c,step:u}=l:a.length>1?h=l:c=l,n(h)&&!e(h))throw new TypeError("The specified start was not an integer");if(n(c)&&!r(c))throw new TypeError("The specified end was not an integer or infinite");if(n(u)&&!e(u,!0))throw new TypeError("The specified step was not a non-zero integer");a[0]=h,a[1]=c,a[2]=u}});return Xo.range=o,Xo}var Jo={},Xp;function E_(){if(Xp)return Jo;Xp=1;const{iterableCurry:t}=Ct(),{__interleave:e}=V_(),{makeValidateArgs:r}=w_();function*s({start:o,step:a},l,...c){o=o%c.length;for(let u=o;!l.done;u=(u+a)%c.length){const h=c[u];h.done||(yield h.value,h.advance())}}function n(o,a=1,l=0){return e(o,s,{start:l,step:a})}Jo.__roundRobin=n;const i=t(n,{variadic:!0,minArgs:0,maxArgs:2,validateArgs:r("roundRobin")});return Jo.roundRobin=i,Jo}var Zo={},Jp;function P_(){if(Jp)return Zo;Jp=1;const{ensureIterable:t}=Ct();function e(s){const n=t(s);let i=0;for(const o of n)i++;return i}Zo.__size=e;const r=e;return Zo.size=r,Zo}var ea={},Zp;function T_(){if(Zp)return ea;Zp=1;const{iterableCurry:t}=Ct();function*e(s,n){if(n===0)return;let i=0;for(const o of s)if(yield o,++i===n)break}ea.__take=e;const r=t(e);return ea.take=r,ea}var _c,em;function R_(){return em||(em=1,_c=q_().first),_c}var M_=R_();const jx=nt(M_);var Sc,tm;function I_(){return tm||(tm=1,Sc=v_().isEmpty),Sc}var j_=I_();const rm=nt(j_);var kc,sm;function O_(){return sm||(sm=1,kc=__().objectEntries),kc}var N_=O_();const Nd=nt(N_);var Cc,nm;function B_(){return nm||(nm=1,Cc=S_().objectKeys),Cc}var z_=B_();const Ox=nt(z_);var Ec,im;function D_(){return im||(im=1,Ec=k_().objectValues),Ec}var L_=D_();const Nr=nt(L_);var Pc,om;function F_(){return om||(om=1,Pc=C_().range),Pc}var U_=F_();const Nx=nt(U_);var Tc,am;function $_(){return am||(am=1,Tc=E_().roundRobin),Tc}var H_=$_();const G_=nt(H_);var Rc,lm;function W_(){return lm||(lm=1,Rc=P_().size),Rc}var K_=W_();const ch=nt(K_);var Mc,cm;function Y_(){return cm||(cm=1,Mc=T_().take),Mc}var Q_=Y_();const X_=nt(Q_),Ge=t=>t[Symbol.iterator](),ko=Object.entries,Bx=Nd,zx=Object.keys,Dx=Ox,J_=Object.fromEntries,Un=Object.fromEntries,Bd=(t,e)=>{const s=Ge(Bx(t)).map(e).filter(n=>n!==void 0);return J_(s)},Lx={presses:Un(Px.map(t=>[t,{keys:[],gamepadButtons:[]}])),axes:{x:[],y:[],xLook:[],yLook:[]},radialAxes:{xy:[]}},ta=(t,e)=>Array.from(new Set([...t??[],...e??[]]));function Bs(...t){const e=new Set,r=new Set,s=new Set,n=new Set;return t.reduceRight((i,o)=>{const a=new Set(e),l=new Set(r),c=new Set(s),u=new Set(n);for(const f of Px){const m=o?.presses?.[f]?.keys??[],y=o?.presses?.[f]?.gamepadButtons??[],g=m.filter(b=>!a.has(b)),A=y.filter(b=>!l.has(b));i.presses[f]={keys:ta(i.presses[f]?.keys,g),gamepadButtons:ta(i.presses[f]?.gamepadButtons,A)};for(const b of m)e.add(b);for(const b of y)r.add(b)}for(const f of["x","y","xLook","yLook"]){const m=o.axes?.[f]??[],y=m.filter(g=>!c.has(g));i.axes[f]=ta(i.axes[f],y);for(const g of m)s.add(g)}const h=o.radialAxes?.xy??[],d=h.filter(f=>!u.has(f));i.radialAxes&&(i.radialAxes.xy=ta(i.radialAxes.xy,d));for(const f of h)n.add(f);return i},structuredClone(Lx))}const $n={buttons:{dPadDown:13,dPadUp:12,dPadLeft:14,dPadRight:15,a:0,b:1,x:2,y:3,lb:4,lt:6,rb:5,rt:7,select:8,start:9,lPress:10,rPress:11},axes:{lStickX:0,lStickY:1,rStickX:2,rStickY:3},radialAxes:{}},Z_={buttons:{a:0,b:1,x:3,y:4,lb:6,lt:8,rb:7,rt:9,select:10,start:11,l3:2,r3:5},axes:{lStickX:0,lStickY:1,rStickX:2,rStickY:5},radialAxes:{xy:9}},um=Bd($n.buttons,([t,e])=>[e,t]),eS={start:"1",coin:"5",directions:{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},buttons:["Control","Alt"," ","Shift","Z","X"]},Ls={directions:{up:"R",down:"F",left:"D",right:"G"},buttons:["A","S","Q","W","I","K"]},Dt={dPadUp:"C",dPadDown:"D",dPadLeft:"E",dPadRight:"F",a:"J",b:"G",y:"H",x:"I",rb:"M",start:"O",select:"N"},zs={presses:{right:{keys:["ArrowRight"]},towards:{keys:["ArrowDown"]},left:{keys:["ArrowLeft"]},away:{keys:["ArrowUp"]},jump:{keys:[" ","`","Z","\\"]},carry:{keys:["Shift","`","Z","\\"]},fire:{keys:["D"]},swop:{keys:["Enter"]},"swop.head":{keys:["[","A"]},"swop.heels":{keys:["]","S"]},hold:{keys:["P"]},map:{keys:["M","Tab"]},menu_openOrExit:{keys:["Escape",""]},menu_select:{keys:["Enter"]},toggleCrtFilter:{keys:["F8","T"]},toggleShowFps:{keys:["F9"]},toggleColourisation:{keys:["F10"]},cycleResolution:{keys:["0"]},pageDown:{keys:["PageDown"]},pageUp:{keys:["PageUp"]},home:{keys:["Home"]},end:{keys:["End"]}}},Hn=({buttons:t,axes:e,radialAxes:r})=>{const s=n=>n!==void 0;return{presses:{right:{gamepadButtons:[t.dPadRight].filter(s)},towards:{gamepadButtons:[t.dPadDown].filter(s)},left:{gamepadButtons:[t.dPadLeft].filter(s)},away:{gamepadButtons:[t.dPadUp].filter(s)},jump:{gamepadButtons:[t.a,t.y].filter(s)},carry:{gamepadButtons:[t.x,t.y].filter(s)},fire:{gamepadButtons:[t.b].filter(s)},lookShift:{gamepadButtons:[t.rb].filter(s)},"swop.head":{gamepadButtons:[t.lt].filter(s)},"swop.heels":{gamepadButtons:[t.rt].filter(s)},hold:{gamepadButtons:[t.start].filter(s)},menu_select:{gamepadButtons:[t.a].filter(s)},menu_exit:{gamepadButtons:[t.b].filter(s)},menu_openOrExit:{gamepadButtons:[t.select].filter(s)},map:{gamepadButtons:[t.lb].filter(s)},toggleCrtFilter:{gamepadButtons:[t.l3].filter(s)},toggleShowFps:{gamepadButtons:[t.r3].filter(s)}},axes:{x:[e.lStickX].filter(s),y:[e.lStickY].filter(s),xLook:[e.rStickX].filter(s),yLook:[e.rStickY].filter(s)},radialAxes:{xy:[r.xy].filter(s)}}},tS={inputAssignment:Bs(zs,Hn($n),{presses:{right:{keys:["P","7"]},towards:{keys:["A","8"]},left:{keys:["O","6"]},away:{keys:["Q","9"]},jump:{keys:[" ","M","N","B","Alt"]},carry:{keys:[" ","Enter","L","K","J"]},fire:{keys:["Shift","Z","X","C","V"]},swop:{keys:["S","D","F","G"]},hold:{keys:["H"]}}}),description:"Closely matches the ZX Spectrum original game's keys"},rS={inputAssignment:Bs(zs,Hn($n),{presses:{carry:{keys:["F3","F5"]},fire:{keys:[" "]},jump:{keys:["F5"]},swop:{keys:["F1"]},hold:{keys:["H"]}}}),description:"Closely matches Amiga version keys - heavy on the F-keys"},sS={inputAssignment:Bs(zs,Hn($n),{presses:{lookUp:{keys:["I"]},lookDown:{keys:["K"]},lookLeft:{keys:["J"]},lookRight:{keys:["L"]},lookShift:{keys:["C"]}}}),description:"Combined key and joystick/gamepad assignment, should work on most setups"},nS={inputAssignment:Bs(zs,Hn($n),{presses:{right:{keys:["D"]},towards:{keys:["S"]},left:{keys:["A"]},away:{keys:["W"]},jump:{keys:[" ","F","P"]},carry:{keys:["Shift","F","I","P"]},fire:{keys:["E","O","Control"]},swop:{keys:["Q"]},hold:{keys:["H"]}}}),description:"Modern, minimalist WASD key layout"},iS={inputAssignment:Bs(zs,Hn($n),{presses:{right:{keys:[Dt.dPadRight]},towards:{keys:[Dt.dPadDown]},left:{keys:[Dt.dPadLeft]},away:{keys:[Dt.dPadUp]},jump:{keys:[Dt.a,Dt.y]},carry:{keys:[Dt.b,Dt.y]},fire:{keys:[Dt.x]},swop:{keys:[Dt.rb]},hold:{keys:[Dt.start]},menu_openOrExit:{keys:[Dt.select]}}}),description:"8bitdo controllers in keyboard mode (identifies to OS as a keyboard). They work as controllers even on phones that dont support controllers"},oS={inputAssignment:Bs(zs,Hn(Z_)),description:"8Bitdo Ultimate 2c Wired reports in a non-standard way on some systems - use this if you have this controller and it doesn't work as expected"},aS=t=>({presses:{right:{keys:[t.directions.right]},towards:{keys:[t.directions.down]},left:{keys:[t.directions.left]},away:{keys:[t.directions.up]},jump:{keys:[t.buttons[0],t.buttons[3]]},carry:{keys:[t.buttons[1],t.buttons[3]]},fire:{keys:[t.buttons[2]]},swop:{keys:[t.start]},hold:{keys:[t.coin]},menu_openOrExit:{keys:[t.buttons[4]]},lookShift:{keys:[t.buttons[5]]}}}),lS={inputAssignment:Bs(Lx,zs,{presses:{menu_openOrExit:{keys:["`","Tab"]}}},aS(eS),{presses:{lookDown:{keys:[Ls.directions.down]},lookLeft:{keys:[Ls.directions.left]},lookRight:{keys:[Ls.directions.right]},lookUp:{keys:[Ls.directions.up]},"swop.head":{keys:[Ls.buttons[0]]},"swop.heels":{keys:[Ls.buttons[1]]}}}),description:"Arcade-style control panels"},qn={Default:sS,"ZX Spec":tS,Amiga:rS,MAME:lS,WASD:nS," 8b kbd":iS," 8b U2c":oS},zd=()=>er().get("campaignName")?.startsWith("data:");var Pe=(t=>(t.Application="application",t.WebGLPipes="webgl-pipes",t.WebGLPipesAdaptor="webgl-pipes-adaptor",t.WebGLSystem="webgl-system",t.WebGPUPipes="webgpu-pipes",t.WebGPUPipesAdaptor="webgpu-pipes-adaptor",t.WebGPUSystem="webgpu-system",t.CanvasSystem="canvas-system",t.CanvasPipesAdaptor="canvas-pipes-adaptor",t.CanvasPipes="canvas-pipes",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t.MaskEffect="mask-effect",t.BlendMode="blend-mode",t.TextureSource="texture-source",t.Environment="environment",t.ShapeBuilder="shape-builder",t.Batcher="batcher",t))(Pe||{});const uh=t=>{if(typeof t=="function"||typeof t=="object"&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={...typeof t.extension!="object"?{type:t.extension}:t.extension,ref:t}}if(typeof t=="object")t={...t};else throw new Error("Invalid extension type");return typeof t.type=="string"&&(t.type=[t.type]),t},ra=(t,e)=>uh(t).priority??e,Br={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(uh).forEach(e=>{e.type.forEach(r=>this._removeHandlers[r]?.(e))}),this},add(...t){return t.map(uh).forEach(e=>{e.type.forEach(r=>{const s=this._addHandlers,n=this._queue;s[r]?s[r]?.(e):(n[r]=n[r]||[],n[r]?.push(e))})}),this},handle(t,e,r){const s=this._addHandlers,n=this._removeHandlers;if(s[t]||n[t])throw new Error(`Extension type ${t} already has a handler`);s[t]=e,n[t]=r;const i=this._queue;return i[t]&&(i[t]?.forEach(o=>e(o)),delete i[t]),this},handleByMap(t,e){return this.handle(t,r=>{r.name&&(e[r.name]=r.ref)},r=>{r.name&&delete e[r.name]})},handleByNamedList(t,e,r=-1){return this.handle(t,s=>{e.findIndex(i=>i.name===s.name)>=0||(e.push({name:s.name,value:s.ref}),e.sort((i,o)=>ra(o.value,r)-ra(i.value,r)))},s=>{const n=e.findIndex(i=>i.name===s.name);n!==-1&&e.splice(n,1)})},handleByList(t,e,r=-1){return this.handle(t,s=>{e.includes(s.ref)||(e.push(s.ref),e.sort((n,i)=>ra(i,r)-ra(n,r)))},s=>{const n=e.indexOf(s.ref);n!==-1&&e.splice(n,1)})},mixin(t,...e){for(const r of e)Object.defineProperties(t.prototype,Object.getOwnPropertyDescriptors(r))}},cS={extension:{type:Pe.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Bn(()=>import("./browserAll-9xTwGAf4.js"),__vite__mapDeps([0,1,2,3,4,5,6]))}},uS={extension:{type:Pe.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await Bn(()=>import("./webworkerAll-C55yoMkB.js"),__vite__mapDeps([1,2,3,4,5,6]))}};class at{constructor(e,r,s){this._x=r||0,this._y=s||0,this._observer=e}clone(e){return new at(e??this._observer,this._x,this._y)}set(e=0,r=e){return(this._x!==e||this._y!==r)&&(this._x=e,this._y=r,this._observer._onUpdate(this)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this._observer._onUpdate(this)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this._observer._onUpdate(this))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this._observer._onUpdate(this))}}var Ic={exports:{}},hm;function hS(){return hm||(hm=1,(function(t){var e=Object.prototype.hasOwnProperty,r="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(r=!1));function n(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function i(l,c,u,h,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new n(u,h||l,d),m=r?r+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],f]:l._events[m].push(f):(l._events[m]=f,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new s:delete l._events[c]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,h;if(this._eventsCount===0)return c;for(h in u=this._events)e.call(u,h)&&c.push(r?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=r?r+c:c,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var d=0,f=h.length,m=new Array(f);d<f;d++)m[d]=h[d].fn;return m},a.prototype.listenerCount=function(c){var u=r?r+c:c,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(c,u,h,d,f,m){var y=r?r+c:c;if(!this._events[y])return!1;var g=this._events[y],A=arguments.length,b,x;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),A){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,h),!0;case 4:return g.fn.call(g.context,u,h,d),!0;case 5:return g.fn.call(g.context,u,h,d,f),!0;case 6:return g.fn.call(g.context,u,h,d,f,m),!0}for(x=1,b=new Array(A-1);x<A;x++)b[x-1]=arguments[x];g.fn.apply(g.context,b)}else{var w=g.length,q;for(x=0;x<w;x++)switch(g[x].once&&this.removeListener(c,g[x].fn,void 0,!0),A){case 1:g[x].fn.call(g[x].context);break;case 2:g[x].fn.call(g[x].context,u);break;case 3:g[x].fn.call(g[x].context,u,h);break;case 4:g[x].fn.call(g[x].context,u,h,d);break;default:if(!b)for(q=1,b=new Array(A-1);q<A;q++)b[q-1]=arguments[q];g[x].fn.apply(g[x].context,b)}}return!0},a.prototype.on=function(c,u,h){return i(this,c,u,h,!1)},a.prototype.once=function(c,u,h){return i(this,c,u,h,!0)},a.prototype.removeListener=function(c,u,h,d){var f=r?r+c:c;if(!this._events[f])return this;if(!u)return o(this,f),this;var m=this._events[f];if(m.fn)m.fn===u&&(!d||m.once)&&(!h||m.context===h)&&o(this,f);else{for(var y=0,g=[],A=m.length;y<A;y++)(m[y].fn!==u||d&&!m[y].once||h&&m[y].context!==h)&&g.push(m[y]);g.length?this._events[f]=g.length===1?g[0]:g:o(this,f)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=r?r+c:c,this._events[u]&&o(this,u)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a})(Ic)),Ic.exports}var dS=hS();const is=nt(dS),fS=Math.PI*2,pS=180/Math.PI,mS=Math.PI/180;class dt{constructor(e=0,r=0){this.x=0,this.y=0,this.x=e,this.y=r}clone(){return new dt(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,r=e){return this.x=e,this.y=r,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return jc.x=0,jc.y=0,jc}}const jc=new dt;class fe{constructor(e=1,r=0,s=0,n=1,i=0,o=0){this.array=null,this.a=e,this.b=r,this.c=s,this.d=n,this.tx=i,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,r,s,n,i,o){return this.a=e,this.b=r,this.c=s,this.d=n,this.tx=i,this.ty=o,this}toArray(e,r){this.array||(this.array=new Float32Array(9));const s=r||this.array;return e?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(e,r){r=r||new dt;const s=e.x,n=e.y;return r.x=this.a*s+this.c*n+this.tx,r.y=this.b*s+this.d*n+this.ty,r}applyInverse(e,r){r=r||new dt;const s=this.a,n=this.b,i=this.c,o=this.d,a=this.tx,l=this.ty,c=1/(s*o+i*-n),u=e.x,h=e.y;return r.x=o*c*u+-i*c*h+(l*i-a*o)*c,r.y=s*c*h+-n*c*u+(-l*s+a*n)*c,r}translate(e,r){return this.tx+=e,this.ty+=r,this}scale(e,r){return this.a*=e,this.d*=r,this.c*=e,this.b*=r,this.tx*=e,this.ty*=r,this}rotate(e){const r=Math.cos(e),s=Math.sin(e),n=this.a,i=this.c,o=this.tx;return this.a=n*r-this.b*s,this.b=n*s+this.b*r,this.c=i*r-this.d*s,this.d=i*s+this.d*r,this.tx=o*r-this.ty*s,this.ty=o*s+this.ty*r,this}append(e){const r=this.a,s=this.b,n=this.c,i=this.d;return this.a=e.a*r+e.b*n,this.b=e.a*s+e.b*i,this.c=e.c*r+e.d*n,this.d=e.c*s+e.d*i,this.tx=e.tx*r+e.ty*n+this.tx,this.ty=e.tx*s+e.ty*i+this.ty,this}appendFrom(e,r){const s=e.a,n=e.b,i=e.c,o=e.d,a=e.tx,l=e.ty,c=r.a,u=r.b,h=r.c,d=r.d;return this.a=s*c+n*h,this.b=s*u+n*d,this.c=i*c+o*h,this.d=i*u+o*d,this.tx=a*c+l*h+r.tx,this.ty=a*u+l*d+r.ty,this}setTransform(e,r,s,n,i,o,a,l,c){return this.a=Math.cos(a+c)*i,this.b=Math.sin(a+c)*i,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(s*this.a+n*this.c),this.ty=r-(s*this.b+n*this.d),this}prepend(e){const r=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const s=this.a,n=this.c;this.a=s*e.a+this.b*e.c,this.b=s*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=r*e.a+this.ty*e.c+e.tx,this.ty=r*e.b+this.ty*e.d+e.ty,this}decompose(e){const r=this.a,s=this.b,n=this.c,i=this.d,o=e.pivot,a=-Math.atan2(-n,i),l=Math.atan2(s,r),c=Math.abs(a+l);return c<1e-5||Math.abs(fS-c)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(r*r+s*s),e.scale.y=Math.sqrt(n*n+i*i),e.position.x=this.tx+(o.x*r+o.y*n),e.position.y=this.ty+(o.x*s+o.y*i),e}invert(){const e=this.a,r=this.b,s=this.c,n=this.d,i=this.tx,o=e*n-r*s;return this.a=n/o,this.b=-r/o,this.c=-s/o,this.d=e/o,this.tx=(s*this.ty-n*i)/o,this.ty=-(e*this.ty-r*i)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new fe;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}equals(e){return e.a===this.a&&e.b===this.b&&e.c===this.c&&e.d===this.d&&e.tx===this.tx&&e.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return yS.identity()}static get shared(){return gS.identity()}}const gS=new fe,yS=new fe,ms=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],gs=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ys=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],As=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],hh=[],Fx=[],sa=Math.sign;function AS(){for(let t=0;t<16;t++){const e=[];hh.push(e);for(let r=0;r<16;r++){const s=sa(ms[t]*ms[r]+ys[t]*gs[r]),n=sa(gs[t]*ms[r]+As[t]*gs[r]),i=sa(ms[t]*ys[r]+ys[t]*As[r]),o=sa(gs[t]*ys[r]+As[t]*As[r]);for(let a=0;a<16;a++)if(ms[a]===s&&gs[a]===n&&ys[a]===i&&As[a]===o){e.push(a);break}}}for(let t=0;t<16;t++){const e=new fe;e.set(ms[t],gs[t],ys[t],As[t],0,0),Fx.push(e)}}AS();const we={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>ms[t],uY:t=>gs[t],vX:t=>ys[t],vY:t=>As[t],inv:t=>t&8?t&15:-t&7,add:(t,e)=>hh[t][e],sub:(t,e)=>hh[t][we.inv(e)],rotate180:t=>t^4,isVertical:t=>(t&3)===2,byDirection:(t,e)=>Math.abs(t)*2<=Math.abs(e)?e>=0?we.S:we.N:Math.abs(e)*2<=Math.abs(t)?t>0?we.E:we.W:e>0?t>0?we.SE:we.SW:t>0?we.NE:we.NW,matrixAppendRotationInv:(t,e,r=0,s=0)=>{const n=Fx[we.inv(e)];n.tx=r,n.ty=s,t.append(n)},transformRectCoords:(t,e,r,s)=>{const{x:n,y:i,width:o,height:a}=t,{x:l,y:c,width:u,height:h}=e;return r===we.E?(s.set(n+l,i+c,o,a),s):r===we.S?s.set(u-i-a+l,n+c,a,o):r===we.W?s.set(u-n-o+l,h-i-a+c,o,a):r===we.N?s.set(i+l,h-n-o+c,a,o):s.set(n+l,i+c,o,a)}},na=[new dt,new dt,new dt,new dt];class Qe{constructor(e=0,r=0,s=0,n=0){this.type="rectangle",this.x=Number(e),this.y=Number(r),this.width=Number(s),this.height=Number(n)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new Qe(0,0,0,0)}clone(){return new Qe(this.x,this.y,this.width,this.height)}copyFromBounds(e){return this.x=e.minX,this.y=e.minY,this.width=e.maxX-e.minX,this.height=e.maxY-e.minY,this}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,r){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&r>=this.y&&r<this.y+this.height}strokeContains(e,r,s,n=.5){const{width:i,height:o}=this;if(i<=0||o<=0)return!1;const a=this.x,l=this.y,c=s*(1-n),u=s-c,h=a-c,d=a+i+c,f=l-c,m=l+o+c,y=a+u,g=a+i-u,A=l+u,b=l+o-u;return e>=h&&e<=d&&r>=f&&r<=m&&!(e>y&&e<g&&r>A&&r<b)}intersects(e,r){if(!r){const S=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=S)return!1;const C=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>C}const s=this.left,n=this.right,i=this.top,o=this.bottom;if(n<=s||o<=i)return!1;const a=na[0].set(e.left,e.top),l=na[1].set(e.left,e.bottom),c=na[2].set(e.right,e.top),u=na[3].set(e.right,e.bottom);if(c.x<=a.x||l.y<=a.y)return!1;const h=Math.sign(r.a*r.d-r.b*r.c);if(h===0||(r.apply(a,a),r.apply(l,l),r.apply(c,c),r.apply(u,u),Math.max(a.x,l.x,c.x,u.x)<=s||Math.min(a.x,l.x,c.x,u.x)>=n||Math.max(a.y,l.y,c.y,u.y)<=i||Math.min(a.y,l.y,c.y,u.y)>=o))return!1;const d=h*(l.y-a.y),f=h*(a.x-l.x),m=d*s+f*i,y=d*n+f*i,g=d*s+f*o,A=d*n+f*o;if(Math.max(m,y,g,A)<=d*a.x+f*a.y||Math.min(m,y,g,A)>=d*u.x+f*u.y)return!1;const b=h*(a.y-c.y),x=h*(c.x-a.x),w=b*s+x*i,q=b*n+x*i,_=b*s+x*o,V=b*n+x*o;return!(Math.max(w,q,_,V)<=b*a.x+x*a.y||Math.min(w,q,_,V)>=b*u.x+x*u.y)}pad(e=0,r=e){return this.x-=e,this.y-=r,this.width+=e*2,this.height+=r*2,this}fit(e){const r=Math.max(this.x,e.x),s=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),i=Math.min(this.y+this.height,e.y+e.height);return this.x=r,this.width=Math.max(s-r,0),this.y=n,this.height=Math.max(i-n,0),this}ceil(e=1,r=.001){const s=Math.ceil((this.x+this.width-r)*e)/e,n=Math.ceil((this.y+this.height-r)*e)/e;return this.x=Math.floor((this.x+r)*e)/e,this.y=Math.floor((this.y+r)*e)/e,this.width=s-this.x,this.height=n-this.y,this}scale(e,r=e){return this.x*=e,this.y*=r,this.width*=e,this.height*=r,this}enlarge(e){const r=Math.min(this.x,e.x),s=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),i=Math.max(this.y+this.height,e.y+e.height);return this.x=r,this.width=s-r,this.y=n,this.height=i-n,this}getBounds(e){return e||(e=new Qe),e.copyFrom(this),e}containsRect(e){if(this.width<=0||this.height<=0)return!1;const r=e.x,s=e.y,n=e.x+e.width,i=e.y+e.height;return r>=this.x&&r<this.x+this.width&&s>=this.y&&s<this.y+this.height&&n>=this.x&&n<this.x+this.width&&i>=this.y&&i<this.y+this.height}set(e,r,s,n){return this.x=e,this.y=r,this.width=s,this.height=n,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const Oc={default:-1};function $e(t="default"){return Oc[t]===void 0&&(Oc[t]=-1),++Oc[t]}const dm=new Set,lt="8.0.0",xS="8.3.4",un={quiet:!1,noColor:!1},_e=(t,e,r=3)=>{if(un.quiet||dm.has(e))return;let s=new Error().stack;const n=`${e}
Deprecated since v${t}`,i=typeof console.groupCollapsed=="function"&&!un.noColor;typeof s>"u"?console.warn("PixiJS Deprecation Warning: ",n):(s=s.split(`
`).splice(r).join(`
`),i?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",n),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",n),console.warn(s))),dm.add(e)};Object.defineProperties(_e,{quiet:{get:()=>un.quiet,set:t=>{un.quiet=t},enumerable:!0,configurable:!1},noColor:{get:()=>un.noColor,set:t=>{un.noColor=t},enumerable:!0,configurable:!1}});const Ux=()=>{};function fm(t){return t+=t===0?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1}function pm(t){return!(t&t-1)&&!!t}function $x(t){const e={};for(const r in t)t[r]!==void 0&&(e[r]=t[r]);return e}const mm=Object.create(null);function bS(t){const e=mm[t];return e===void 0&&(mm[t]=$e("resource")),e}const Hx=class Gx extends is{constructor(e={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,e={...Gx.defaultOptions,...e},this.addressMode=e.addressMode,this.addressModeU=e.addressModeU??this.addressModeU,this.addressModeV=e.addressModeV??this.addressModeV,this.addressModeW=e.addressModeW??this.addressModeW,this.scaleMode=e.scaleMode,this.magFilter=e.magFilter??this.magFilter,this.minFilter=e.minFilter??this.minFilter,this.mipmapFilter=e.mipmapFilter??this.mipmapFilter,this.lodMinClamp=e.lodMinClamp,this.lodMaxClamp=e.lodMaxClamp,this.compare=e.compare,this.maxAnisotropy=e.maxAnisotropy??1}set addressMode(e){this.addressModeU=e,this.addressModeV=e,this.addressModeW=e}get addressMode(){return this.addressModeU}set wrapMode(e){_e(lt,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=e}get wrapMode(){return this.addressMode}set scaleMode(e){this.magFilter=e,this.minFilter=e,this.mipmapFilter=e}get scaleMode(){return this.magFilter}set maxAnisotropy(e){this._maxAnisotropy=Math.min(e,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this._sharedResourceId=null,this.emit("change",this)}_generateResourceId(){const e=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=bS(e),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};Hx.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let Wx=Hx;const Kx=class Yx extends is{constructor(e={}){super(),this.options=e,this._gpuData=Object.create(null),this._gcLastUsed=-1,this.uid=$e("textureSource"),this._resourceType="textureSource",this._resourceId=$e("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,e={...Yx.defaultOptions,...e},this.label=e.label??"",this.resource=e.resource,this.autoGarbageCollect=e.autoGarbageCollect,this._resolution=e.resolution,e.width?this.pixelWidth=e.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,e.height?this.pixelHeight=e.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=e.format,this.dimension=e.dimensions,this.mipLevelCount=e.mipLevelCount,this.autoGenerateMipmaps=e.autoGenerateMipmaps,this.sampleCount=e.sampleCount,this.antialias=e.antialias,this.alphaMode=e.alphaMode,this.style=new Wx($x(e)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(e){this.style!==e&&(this._style?.off("change",this._onStyleChange,this),this._style=e,this._style?.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(e){this._style.maxAnisotropy=e}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(e){this._style.addressMode=e}get repeatMode(){return this._style.addressMode}set repeatMode(e){this._style.addressMode=e}get magFilter(){return this._style.magFilter}set magFilter(e){this._style.magFilter=e}get minFilter(){return this._style.minFilter}set minFilter(e){this._style.minFilter=e}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(e){this._style.mipmapFilter=e}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(e){this._style.lodMinClamp=e}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(e){this._style.lodMaxClamp=e}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const e=this._resolution;if(this.resize(this.resourceWidth/e,this.resourceHeight/e))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.unload(),this.emit("destroy",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=$e("resource"),this.emit("change",this),this.emit("unload",this);for(const e in this._gpuData)this._gpuData[e]?.destroy?.();this._gpuData=Object.create(null)}get resourceWidth(){const{resource:e}=this;return e.naturalWidth||e.videoWidth||e.displayWidth||e.width}get resourceHeight(){const{resource:e}=this;return e.naturalHeight||e.videoHeight||e.displayHeight||e.height}get resolution(){return this._resolution}set resolution(e){this._resolution!==e&&(this._resolution=e,this.width=this.pixelWidth/e,this.height=this.pixelHeight/e)}resize(e,r,s){s||(s=this._resolution),e||(e=this.width),r||(r=this.height);const n=Math.round(e*s),i=Math.round(r*s);return this.width=n/s,this.height=i/s,this._resolution=s,this.pixelWidth===n&&this.pixelHeight===i?!1:(this._refreshPOT(),this.pixelWidth=n,this.pixelHeight=i,this.emit("resize",this),this._resourceId=$e("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(e){this._style.wrapMode=e}get wrapMode(){return this._style.wrapMode}set scaleMode(e){this._style.scaleMode=e}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=pm(this.pixelWidth)&&pm(this.pixelHeight)}static test(e){throw new Error("Unimplemented")}};Kx.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let Yt=Kx;class Dd extends Yt{constructor(e){const r=e.resource||new Float32Array(e.width*e.height*4);let s=e.format;s||(r instanceof Float32Array?s="rgba32float":r instanceof Int32Array||r instanceof Uint32Array?s="rgba32uint":r instanceof Int16Array||r instanceof Uint16Array?s="rgba16uint":(r instanceof Int8Array,s="bgra8unorm")),super({...e,resource:r,format:s}),this.uploadMethodId="buffer"}static test(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}Dd.extension=Pe.TextureSource;const gm=new fe;class wS{constructor(e,r){this.mapCoord=new fe,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof r>"u"?this.clampMargin=e.width<10?0:.5:this.clampMargin=r,this.isSimple=!1,this.texture=e}get texture(){return this._texture}set texture(e){this.texture!==e&&(this._texture?.removeListener("update",this.update,this),this._texture=e,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(e,r){r===void 0&&(r=e);const s=this.mapCoord;for(let n=0;n<e.length;n+=2){const i=e[n],o=e[n+1];r[n]=i*s.a+o*s.c+s.tx,r[n+1]=i*s.b+o*s.d+s.ty}return r}update(){const e=this._texture;this._updateID++;const r=e.uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const s=e.orig,n=e.trim;n&&(gm.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(gm));const i=e.source,o=this.uClampFrame,a=this.clampMargin/i._resolution,l=this.clampOffset/i._resolution;return o[0]=(e.frame.x+a+l)/i.width,o[1]=(e.frame.y+a+l)/i.height,o[2]=(e.frame.x+e.frame.width-a+l)/i.width,o[3]=(e.frame.y+e.frame.height-a+l)/i.height,this.uClampOffset[0]=this.clampOffset/i.pixelWidth,this.uClampOffset[1]=this.clampOffset/i.pixelHeight,this.isSimple=e.frame.width===i.width&&e.frame.height===i.height&&e.rotate===0,!0}}class Ae extends is{constructor({source:e,label:r,frame:s,orig:n,trim:i,defaultAnchor:o,defaultBorders:a,rotate:l,dynamic:c}={}){if(super(),this.uid=$e("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new Qe,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=r,this.source=e?.source??new Yt,this.noFrame=!s,s)this.frame.copyFrom(s);else{const{width:u,height:h}=this._source;this.frame.width=u,this.frame.height=h}this.orig=n||this.frame,this.trim=i,this.rotate=l??0,this.defaultAnchor=o,this.defaultBorders=a,this.destroyed=!1,this.dynamic=c||!1,this.updateUvs()}set source(e){this._source&&this._source.off("resize",this.update,this),this._source=e,e.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new wS(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:e,frame:r}=this,{width:s,height:n}=this._source,i=r.x/s,o=r.y/n,a=r.width/s,l=r.height/n;let c=this.rotate;if(c){const u=a/2,h=l/2,d=i+u,f=o+h;c=we.add(c,we.NW),e.x0=d+u*we.uX(c),e.y0=f+h*we.uY(c),c=we.add(c,2),e.x1=d+u*we.uX(c),e.y1=f+h*we.uY(c),c=we.add(c,2),e.x2=d+u*we.uX(c),e.y2=f+h*we.uY(c),c=we.add(c,2),e.x3=d+u*we.uX(c),e.y3=f+h*we.uY(c)}else e.x0=i,e.y0=o,e.x1=i+a,e.y1=o,e.x2=i+a,e.y2=o+l,e.x3=i,e.y3=o+l}destroy(e=!1){this._source&&(this._source.off("resize",this.update,this),e&&(this._source.destroy(),this._source=null)),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return _e(lt,"Texture.baseTexture is now Texture.source"),this._source}}Ae.EMPTY=new Ae({label:"EMPTY",source:new Yt({label:"EMPTY"})});Ae.EMPTY.destroy=Ux;Ae.WHITE=new Ae({source:new Dd({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});Ae.WHITE.destroy=Ux;function VS(t,e,r){const{width:s,height:n}=r.orig,i=r.trim;if(i){const o=i.width,a=i.height;t.minX=i.x-e._x*s,t.maxX=t.minX+o,t.minY=i.y-e._y*n,t.maxY=t.minY+a}else t.minX=-e._x*s,t.maxX=t.minX+s,t.minY=-e._y*n,t.maxY=t.minY+n}const ym=new fe;class nr{constructor(e=1/0,r=1/0,s=-1/0,n=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=ym,this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new Qe);const e=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(e.x=0,e.y=0,e.width=0,e.height=0):e.copyFromBounds(this),e}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=ym,this}set(e,r,s,n){this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}addFrame(e,r,s,n,i){i||(i=this.matrix);const o=i.a,a=i.b,l=i.c,c=i.d,u=i.tx,h=i.ty;let d=this.minX,f=this.minY,m=this.maxX,y=this.maxY,g=o*e+l*r+u,A=a*e+c*r+h;g<d&&(d=g),A<f&&(f=A),g>m&&(m=g),A>y&&(y=A),g=o*s+l*r+u,A=a*s+c*r+h,g<d&&(d=g),A<f&&(f=A),g>m&&(m=g),A>y&&(y=A),g=o*e+l*n+u,A=a*e+c*n+h,g<d&&(d=g),A<f&&(f=A),g>m&&(m=g),A>y&&(y=A),g=o*s+l*n+u,A=a*s+c*n+h,g<d&&(d=g),A<f&&(f=A),g>m&&(m=g),A>y&&(y=A),this.minX=d,this.minY=f,this.maxX=m,this.maxY=y}addRect(e,r){this.addFrame(e.x,e.y,e.x+e.width,e.y+e.height,r)}addBounds(e,r){this.addFrame(e.minX,e.minY,e.maxX,e.maxY,r)}addBoundsMask(e){this.minX=this.minX>e.minX?this.minX:e.minX,this.minY=this.minY>e.minY?this.minY:e.minY,this.maxX=this.maxX<e.maxX?this.maxX:e.maxX,this.maxY=this.maxY<e.maxY?this.maxY:e.maxY}applyMatrix(e){const r=this.minX,s=this.minY,n=this.maxX,i=this.maxY,{a:o,b:a,c:l,d:c,tx:u,ty:h}=e;let d=o*r+l*s+u,f=a*r+c*s+h;this.minX=d,this.minY=f,this.maxX=d,this.maxY=f,d=o*n+l*s+u,f=a*n+c*s+h,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY,d=o*r+l*i+u,f=a*r+c*i+h,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY,d=o*n+l*i+u,f=a*n+c*i+h,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY}fit(e){return this.minX<e.left&&(this.minX=e.left),this.maxX>e.right&&(this.maxX=e.right),this.minY<e.top&&(this.minY=e.top),this.maxY>e.bottom&&(this.maxY=e.bottom),this}fitBounds(e,r,s,n){return this.minX<e&&(this.minX=e),this.maxX>r&&(this.maxX=r),this.minY<s&&(this.minY=s),this.maxY>n&&(this.maxY=n),this}pad(e,r=e){return this.minX-=e,this.maxX+=e,this.minY-=r,this.maxY+=r,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new nr(this.minX,this.minY,this.maxX,this.maxY)}scale(e,r=e){return this.minX*=e,this.minY*=r,this.maxX*=e,this.maxY*=r,this}get x(){return this.minX}set x(e){const r=this.maxX-this.minX;this.minX=e,this.maxX=e+r}get y(){return this.minY}set y(e){const r=this.maxY-this.minY;this.minY=e,this.maxY=e+r}get width(){return this.maxX-this.minX}set width(e){this.maxX=this.minX+e}get height(){return this.maxY-this.minY}set height(e){this.maxY=this.minY+e}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(e,r,s,n){let i=this.minX,o=this.minY,a=this.maxX,l=this.maxY;n||(n=this.matrix);const c=n.a,u=n.b,h=n.c,d=n.d,f=n.tx,m=n.ty;for(let y=r;y<s;y+=2){const g=e[y],A=e[y+1],b=c*g+h*A+f,x=u*g+d*A+m;i=b<i?b:i,o=x<o?x:o,a=b>a?b:a,l=x>l?x:l}this.minX=i,this.minY=o,this.maxX=a,this.maxY=l}containsPoint(e,r){return this.minX<=e&&this.minY<=r&&this.maxX>=e&&this.maxY>=r}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this}}var qS={grad:.9,turn:360,rad:360/(2*Math.PI)},qr=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},Ke=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},$t=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),t>r?r:t>e?t:e},Qx=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},Am=function(t){return{r:$t(t.r,0,255),g:$t(t.g,0,255),b:$t(t.b,0,255),a:$t(t.a)}},Nc=function(t){return{r:Ke(t.r),g:Ke(t.g),b:Ke(t.b),a:Ke(t.a,3)}},vS=/^#([0-9a-f]{3,8})$/i,ia=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},Xx=function(t){var e=t.r,r=t.g,s=t.b,n=t.a,i=Math.max(e,r,s),o=i-Math.min(e,r,s),a=o?i===e?(r-s)/o:i===r?2+(s-e)/o:4+(e-r)/o:0;return{h:60*(a<0?a+6:a),s:i?o/i*100:0,v:i/255*100,a:n}},Jx=function(t){var e=t.h,r=t.s,s=t.v,n=t.a;e=e/360*6,r/=100,s/=100;var i=Math.floor(e),o=s*(1-r),a=s*(1-(e-i)*r),l=s*(1-(1-e+i)*r),c=i%6;return{r:255*[s,a,o,o,l,s][c],g:255*[l,s,s,a,o,o][c],b:255*[o,o,l,s,s,a][c],a:n}},xm=function(t){return{h:Qx(t.h),s:$t(t.s,0,100),l:$t(t.l,0,100),a:$t(t.a)}},bm=function(t){return{h:Ke(t.h),s:Ke(t.s),l:Ke(t.l),a:Ke(t.a,3)}},wm=function(t){return Jx((r=(e=t).s,{h:e.h,s:(r*=((s=e.l)<50?s:100-s)/100)>0?2*r/(s+r)*100:0,v:s+r,a:e.a}));var e,r,s},ji=function(t){return{h:(e=Xx(t)).h,s:(n=(200-(r=e.s))*(s=e.v)/100)>0&&n<200?r*s/100/(n<=100?n:200-n)*100:0,l:n/2,a:e.a};var e,r,s,n},_S=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,SS=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,kS=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,CS=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,dh={string:[[function(t){var e=vS.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?Ke(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?Ke(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=kS.exec(t)||CS.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:Am({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=_S.exec(t)||SS.exec(t);if(!e)return null;var r,s,n=xm({h:(r=e[1],s=e[2],s===void 0&&(s="deg"),Number(r)*(qS[s]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return wm(n)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,s=t.b,n=t.a,i=n===void 0?1:n;return qr(e)&&qr(r)&&qr(s)?Am({r:Number(e),g:Number(r),b:Number(s),a:Number(i)}):null},"rgb"],[function(t){var e=t.h,r=t.s,s=t.l,n=t.a,i=n===void 0?1:n;if(!qr(e)||!qr(r)||!qr(s))return null;var o=xm({h:Number(e),s:Number(r),l:Number(s),a:Number(i)});return wm(o)},"hsl"],[function(t){var e=t.h,r=t.s,s=t.v,n=t.a,i=n===void 0?1:n;if(!qr(e)||!qr(r)||!qr(s))return null;var o=(function(a){return{h:Qx(a.h),s:$t(a.s,0,100),v:$t(a.v,0,100),a:$t(a.a)}})({h:Number(e),s:Number(r),v:Number(s),a:Number(i)});return Jx(o)},"hsv"]]},Vm=function(t,e){for(var r=0;r<e.length;r++){var s=e[r][0](t);if(s)return[s,e[r][1]]}return[null,void 0]},ES=function(t){return typeof t=="string"?Vm(t.trim(),dh.string):typeof t=="object"&&t!==null?Vm(t,dh.object):[null,void 0]},Bc=function(t,e){var r=ji(t);return{h:r.h,s:$t(r.s+100*e,0,100),l:r.l,a:r.a}},zc=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},qm=function(t,e){var r=ji(t);return{h:r.h,s:r.s,l:$t(r.l+100*e,0,100),a:r.a}},fh=(function(){function t(e){this.parsed=ES(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return Ke(zc(this.rgba),2)},t.prototype.isDark=function(){return zc(this.rgba)<.5},t.prototype.isLight=function(){return zc(this.rgba)>=.5},t.prototype.toHex=function(){return e=Nc(this.rgba),r=e.r,s=e.g,n=e.b,o=(i=e.a)<1?ia(Ke(255*i)):"","#"+ia(r)+ia(s)+ia(n)+o;var e,r,s,n,i,o},t.prototype.toRgb=function(){return Nc(this.rgba)},t.prototype.toRgbString=function(){return e=Nc(this.rgba),r=e.r,s=e.g,n=e.b,(i=e.a)<1?"rgba("+r+", "+s+", "+n+", "+i+")":"rgb("+r+", "+s+", "+n+")";var e,r,s,n,i},t.prototype.toHsl=function(){return bm(ji(this.rgba))},t.prototype.toHslString=function(){return e=bm(ji(this.rgba)),r=e.h,s=e.s,n=e.l,(i=e.a)<1?"hsla("+r+", "+s+"%, "+n+"%, "+i+")":"hsl("+r+", "+s+"%, "+n+"%)";var e,r,s,n,i},t.prototype.toHsv=function(){return e=Xx(this.rgba),{h:Ke(e.h),s:Ke(e.s),v:Ke(e.v),a:Ke(e.a,3)};var e},t.prototype.invert=function(){return hr({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),hr(Bc(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),hr(Bc(this.rgba,-e))},t.prototype.grayscale=function(){return hr(Bc(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),hr(qm(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),hr(qm(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?hr({r:(r=this.rgba).r,g:r.g,b:r.b,a:e}):Ke(this.rgba.a,3);var r},t.prototype.hue=function(e){var r=ji(this.rgba);return typeof e=="number"?hr({h:e,s:r.s,l:r.l,a:r.a}):Ke(r.h)},t.prototype.isEqual=function(e){return this.toHex()===hr(e).toHex()},t})(),hr=function(t){return t instanceof fh?t:new fh(t)},vm=[],PS=function(t){t.forEach(function(e){vm.indexOf(e)<0&&(e(fh,dh),vm.push(e))})};function TS(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},s={};for(var n in r)s[r[n]]=n;var i={};t.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,c=s[this.toHex()];if(c)return c;if(o?.closest){var u=this.toRgb(),h=1/0,d="black";if(!i.length)for(var f in r)i[f]=new t(r[f]).toRgb();for(var m in r){var y=(a=u,l=i[m],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));y<h&&(h=y,d=m)}return d}},e.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":r[a];return l?new t(l).toRgb():null},"name"])}PS([TS]);const vn=class Vi{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof Vi)this._value=this._cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,e))&&(this._value=this._cloneSource(e),this._normalize(this._value))}}get value(){return this._value}_cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}_isSourceEqual(e,r){const s=typeof e;if(s!==typeof r)return!1;if(s==="number"||s==="string"||e instanceof Number)return e===r;if(Array.isArray(e)&&Array.isArray(r)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(r))return e.length!==r.length?!1:e.every((i,o)=>i===r[o]);if(e!==null&&r!==null){const i=Object.keys(e),o=Object.keys(r);return i.length!==o.length?!1:i.every(a=>e[a]===r[a])}return e===r}toRgba(){const[e,r,s,n]=this._components;return{r:e,g:r,b:s,a:n}}toRgb(){const[e,r,s]=this._components;return{r:e,g:r,b:s}}toRgbaString(){const[e,r,s]=this.toUint8RgbArray();return`rgba(${e},${r},${s},${this.alpha})`}toUint8RgbArray(e){const[r,s,n]=this._components;return this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb),e[0]=Math.round(r*255),e[1]=Math.round(s*255),e[2]=Math.round(n*255),e}toArray(e){this._arrayRgba||(this._arrayRgba=[]),e||(e=this._arrayRgba);const[r,s,n,i]=this._components;return e[0]=r,e[1]=s,e[2]=n,e[3]=i,e}toRgbArray(e){this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb);const[r,s,n]=this._components;return e[0]=r,e[1]=s,e[2]=n,e}toNumber(){return this._int}toBgrNumber(){const[e,r,s]=this.toUint8RgbArray();return(s<<16)+(r<<8)+e}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[r,s,n,i]=Vi._temp.setValue(e)._components;return this._components[0]*=r,this._components[1]*=s,this._components[2]*=n,this._components[3]*=i,this._refreshInt(),this._value=null,this}premultiply(e,r=!0){return r&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this._refreshInt(),this._value=null,this}toPremultiplied(e,r=!0){if(e===1)return(255<<24)+this._int;if(e===0)return r?0:this._int;let s=this._int>>16&255,n=this._int>>8&255,i=this._int&255;return r&&(s=s*e+.5|0,n=n*e+.5|0,i=i*e+.5|0),(e*255<<24)+(s<<16)+(n<<8)+i}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const r=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-r.length)+r}setAlpha(e){return this._components[3]=this._clamp(e),this}_normalize(e){let r,s,n,i;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const o=e;r=(o>>16&255)/255,s=(o>>8&255)/255,n=(o&255)/255,i=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[r,s,n,i=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[r,s,n,i=255]=e,r/=255,s/=255,n/=255,i/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const a=Vi.HEX_PATTERN.exec(e);a&&(e=`#${a[2]}`)}const o=hr(e);o.isValid()&&({r,g:s,b:n,a:i}=o.rgba,r/=255,s/=255,n/=255)}if(r!==void 0)this._components[0]=r,this._components[1]=s,this._components[2]=n,this._components[3]=i,this._refreshInt();else throw new Error(`Unable to convert color ${e}`)}_refreshInt(){this._clamp(this._components);const[e,r,s]=this._components;this._int=(e*255<<16)+(r*255<<8)+(s*255|0)}_clamp(e,r=0,s=1){return typeof e=="number"?Math.min(Math.max(e,r),s):(e.forEach((n,i)=>{e[i]=Math.min(Math.max(n,r),s)}),e)}static isColorLike(e){return typeof e=="number"||typeof e=="string"||e instanceof Number||e instanceof Vi||Array.isArray(e)||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e.r!==void 0&&e.g!==void 0&&e.b!==void 0||e.r!==void 0&&e.g!==void 0&&e.b!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0&&e.a!==void 0}};vn.shared=new vn;vn._temp=new vn;vn.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Ve=vn;const RS={cullArea:null,cullable:!1,cullableChildren:!0};let Dc=0;const _m=500;function Nt(...t){Dc!==_m&&(Dc++,Dc===_m?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...t))}const Ld={_registeredResources:new Set,register(t){this._registeredResources.add(t)},unregister(t){this._registeredResources.delete(t)},release(){this._registeredResources.forEach(t=>t.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(t){return this._registeredResources.has(t)},reset(){this._registeredResources.clear()}};class MS{constructor(e,r){this._pool=[],this._count=0,this._index=0,this._classType=e,r&&this.prepopulate(r)}prepopulate(e){for(let r=0;r<e;r++)this._pool[this._index++]=new this._classType;this._count+=e}get(e){let r;return this._index>0?r=this._pool[--this._index]:(r=new this._classType,this._count++),r.init?.(e),r}return(e){e.reset?.(),this._pool[this._index++]=e}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let e=0;e<this._index;e++)this._pool[e].destroy();this._pool.length=0,this._count=0,this._index=0}}class IS{constructor(){this._poolsByClass=new Map}prepopulate(e,r){this.getPool(e).prepopulate(r)}get(e,r){return this.getPool(e).get(r)}return(e){this.getPool(e.constructor).return(e)}getPool(e){return this._poolsByClass.has(e)||this._poolsByClass.set(e,new MS(e)),this._poolsByClass.get(e)}stats(){const e={};return this._poolsByClass.forEach(r=>{const s=e[r._classType.name]?r._classType.name+r._classType.ID:r._classType.name;e[s]={free:r.totalFree,used:r.totalUsed,size:r.totalSize}}),e}clear(){this._poolsByClass.forEach(e=>e.clear()),this._poolsByClass.clear()}}const Kt=new IS;Ld.register(Kt);const jS={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(t){typeof t=="boolean"&&t===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(t===!0?{}:t))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(t){_e("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(t)}};function OS(t,e,r){const s=t.length;let n;if(e>=s||r===0)return;r=e+r>s?s-e:r;const i=s-r;for(n=e;n<i;++n)t[n]=t[n+r];t.length=i}const NS={allowChildren:!0,removeChildren(t=0,e){const r=e??this.children.length,s=r-t,n=[];if(s>0&&s<=r){for(let o=r-1;o>=t;o--){const a=this.children[o];a&&(n.push(a),a.parent=null)}OS(this.children,t,r);const i=this.renderGroup||this.parentRenderGroup;i&&i.removeChildren(n);for(let o=0;o<n.length;++o){const a=n[o];a.parentRenderLayer?.detach(a),this.emit("childRemoved",a,this,o),n[o].emit("removed",this)}return n.length>0&&this._didViewChangeTick++,n}else if(s===0&&this.children.length===0)return n;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(t){const e=this.getChildAt(t);return this.removeChild(e)},getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]},setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);this.getChildIndex(t),this.addChildAt(t,e)},getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied Container must be a child of the caller");return e},addChildAt(t,e){this.allowChildren||_e(lt,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:r}=this;if(e<0||e>r.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${r.length}`);if(t.parent){const n=t.parent.children.indexOf(t);if(t.parent===this&&n===e)return t;n!==-1&&t.parent.children.splice(n,1)}e===r.length?r.push(t):r.splice(e,0,t),t.parent=this,t.didChange=!0,t._updateFlags=15;const s=this.renderGroup||this.parentRenderGroup;return s&&s.addChild(t),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",t,this,e),t.emit("added",this),t},swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),s=this.getChildIndex(e);this.children[r]=e,this.children[s]=t;const n=this.renderGroup||this.parentRenderGroup;n&&(n.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...t){return t.length===1?this.reparentChildAt(t[0],this.children.length):(t.forEach(e=>this.reparentChildAt(e,this.children.length)),t[0])},reparentChildAt(t,e){if(t.parent===this)return this.setChildIndex(t,e),t;const r=t.worldTransform.clone();t.removeFromParent(),this.addChildAt(t,e);const s=this.worldTransform.clone();return s.invert(),r.prepend(s),t.setFromMatrix(r),t},replaceChild(t,e){t.updateLocalTransform(),this.addChildAt(e,this.getChildIndex(t)),e.setFromMatrix(t.localTransform),e.updateLocalTransform(),this.removeChild(t)}},BS={collectRenderables(t,e,r){this.parentRenderLayer&&this.parentRenderLayer!==r||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(t,e,r):this.renderGroup?e.renderPipes.renderGroup.addRenderGroup(this.renderGroup,t):this.collectRenderablesWithEffects(t,e,r))},collectRenderablesSimple(t,e,r){const s=this.children,n=s.length;for(let i=0;i<n;i++)s[i].collectRenderables(t,e,r)},collectRenderablesWithEffects(t,e,r){const{renderPipes:s}=e;for(let n=0;n<this.effects.length;n++){const i=this.effects[n];s[i.pipe].push(i,this,t)}this.collectRenderablesSimple(t,e,r);for(let n=this.effects.length-1;n>=0;n--){const i=this.effects[n];s[i.pipe].pop(i,this,t)}}};class Sm{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let e=0;e<this.filters.length;e++)this.filters[e].destroy();this.filters=null,this.filterArea=null}}class zS{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(e=>{this.add({test:e.test,maskClass:e})}))}add(e){this._tests.push(e)}getMaskEffect(e){this._initialized||this.init();for(let r=0;r<this._tests.length;r++){const s=this._tests[r];if(s.test(e))return Kt.get(s.maskClass,e)}return e}returnMaskEffect(e){Kt.return(e)}}const ph=new zS;Br.handleByList(Pe.MaskEffect,ph._effectClasses);const DS={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const t=this.renderGroup||this.parentRenderGroup;t&&(t.structureDidChange=!0)},addEffect(t){this.effects.indexOf(t)===-1&&(this.effects.push(t),this.effects.sort((r,s)=>r.priority-s.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(t){const e=this.effects.indexOf(t);e!==-1&&(this.effects.splice(e,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(t){const e=this._maskEffect;e?.mask!==t&&(e&&(this.removeEffect(e),ph.returnMaskEffect(e),this._maskEffect=null),t!=null&&(this._maskEffect=ph.getMaskEffect(t),this.addEffect(this._maskEffect)))},get mask(){return this._maskEffect?.mask},setMask(t){this._maskOptions={...this._maskOptions,...t},t.mask&&(this.mask=t.mask),this._markStructureAsChanged()},set filters(t){!Array.isArray(t)&&t&&(t=[t]);const e=this._filterEffect||(this._filterEffect=new Sm);t=t;const r=t?.length>0,s=e.filters?.length>0,n=r!==s;t=Array.isArray(t)?t.slice(0):t,e.filters=Object.freeze(t),n&&(r?this.addEffect(e):(this.removeEffect(e),e.filters=t??null))},get filters(){return this._filterEffect?.filters},set filterArea(t){this._filterEffect||(this._filterEffect=new Sm),this._filterEffect.filterArea=t},get filterArea(){return this._filterEffect?.filterArea}},LS={label:null,get name(){return _e(lt,"Container.name property has been removed, use Container.label instead"),this.label},set name(t){_e(lt,"Container.name property has been removed, use Container.label instead"),this.label=t},getChildByName(t,e=!1){return this.getChildByLabel(t,e)},getChildByLabel(t,e=!1){const r=this.children;for(let s=0;s<r.length;s++){const n=r[s];if(n.label===t||t instanceof RegExp&&t.test(n.label))return n}if(e)for(let s=0;s<r.length;s++){const i=r[s].getChildByLabel(t,!0);if(i)return i}return null},getChildrenByLabel(t,e=!1,r=[]){const s=this.children;for(let n=0;n<s.length;n++){const i=s[n];(i.label===t||t instanceof RegExp&&t.test(i.label))&&r.push(i)}if(e)for(let n=0;n<s.length;n++)s[n].getChildrenByLabel(t,!0,r);return r}},mt=Kt.getPool(fe),Tr=Kt.getPool(nr),FS=new fe,US={getFastGlobalBounds(t,e){e||(e=new nr),e.clear(),this._getGlobalBoundsRecursive(!!t,e,this.parentRenderLayer),e.isValid||e.set(0,0,0,0);const r=this.renderGroup||this.parentRenderGroup;return e.applyMatrix(r.worldTransform),e},_getGlobalBoundsRecursive(t,e,r){let s=e;if(t&&this.parentRenderLayer&&this.parentRenderLayer!==r||this.localDisplayStatus!==7||!this.measurable)return;const n=!!this.effects.length;if((this.renderGroup||n)&&(s=Tr.get().clear()),this.boundsArea)e.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const o=this.bounds;s.addFrame(o.minX,o.minY,o.maxX,o.maxY,this.groupTransform)}const i=this.children;for(let o=0;o<i.length;o++)i[o]._getGlobalBoundsRecursive(t,s,r)}if(n){let i=!1;const o=this.renderGroup||this.parentRenderGroup;for(let a=0;a<this.effects.length;a++)this.effects[a].addBounds&&(i||(i=!0,s.applyMatrix(o.worldTransform)),this.effects[a].addBounds(s,!0));i&&s.applyMatrix(o.worldTransform.copyTo(FS).invert()),e.addBounds(s),Tr.return(s)}else this.renderGroup&&(e.addBounds(s,this.relativeGroupTransform),Tr.return(s))}};function Zx(t,e,r){r.clear();let s,n;return t.parent?e?s=t.parent.worldTransform:(n=mt.get().identity(),s=Fd(t,n)):s=fe.IDENTITY,eb(t,r,s,e),n&&mt.return(n),r.isValid||r.set(0,0,0,0),r}function eb(t,e,r,s){if(!t.visible||!t.measurable)return;let n;s?n=t.worldTransform:(t.updateLocalTransform(),n=mt.get(),n.appendFrom(t.localTransform,r));const i=e,o=!!t.effects.length;if(o&&(e=Tr.get().clear()),t.boundsArea)e.addRect(t.boundsArea,n);else{const a=t.bounds;a&&!a.isEmpty()&&(e.matrix=n,e.addBounds(a));for(let l=0;l<t.children.length;l++)eb(t.children[l],e,n,s)}if(o){for(let a=0;a<t.effects.length;a++)t.effects[a].addBounds?.(e);i.addBounds(e,fe.IDENTITY),Tr.return(e)}s||mt.return(n)}function Fd(t,e){const r=t.parent;return r&&(Fd(r,e),r.updateLocalTransform(),e.append(r.localTransform)),e}function tb(t,e){if(t===16777215||!e)return e;if(e===16777215||!t)return t;const r=t>>16&255,s=t>>8&255,n=t&255,i=e>>16&255,o=e>>8&255,a=e&255,l=r*i/255|0,c=s*o/255|0,u=n*a/255|0;return(l<<16)+(c<<8)+u}const km=16777215;function Cm(t,e){return t===km?e:e===km?t:tb(t,e)}function La(t){return((t&255)<<16)+(t&65280)+(t>>16&255)}const $S={getGlobalAlpha(t){if(t)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let e=this.alpha,r=this.parent;for(;r;)e*=r.alpha,r=r.parent;return e},getGlobalTransform(t=new fe,e){if(e)return t.copyFrom(this.worldTransform);this.updateLocalTransform();const r=Fd(this,mt.get().identity());return t.appendFrom(this.localTransform,r),mt.return(r),t},getGlobalTint(t){if(t)return this.renderGroup?La(this.renderGroup.worldColor):this.parentRenderGroup?La(Cm(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let e=this.localColor,r=this.parent;for(;r;)e=Cm(e,r.localColor),r=r.parent;return La(e)}};function rb(t,e,r){return e.clear(),r||(r=fe.IDENTITY),sb(t,e,r,t,!0),e.isValid||e.set(0,0,0,0),e}function sb(t,e,r,s,n){let i;if(n)i=mt.get(),i=r.copyTo(i);else{if(!t.visible||!t.measurable)return;t.updateLocalTransform();const l=t.localTransform;i=mt.get(),i.appendFrom(l,r)}const o=e,a=!!t.effects.length;if(a&&(e=Tr.get().clear()),t.boundsArea)e.addRect(t.boundsArea,i);else{t.renderPipeId&&(e.matrix=i,e.addBounds(t.bounds));const l=t.children;for(let c=0;c<l.length;c++)sb(l[c],e,i,s,!1)}if(a){for(let l=0;l<t.effects.length;l++)t.effects[l].addLocalBounds?.(e,s);o.addBounds(e,fe.IDENTITY),Tr.return(e)}mt.return(i)}function nb(t,e){const r=t.children;for(let s=0;s<r.length;s++){const n=r[s],i=n.uid,o=(n._didViewChangeTick&65535)<<16|n._didContainerChangeTick&65535,a=e.index;(e.data[a]!==i||e.data[a+1]!==o)&&(e.data[e.index]=i,e.data[e.index+1]=o,e.didChange=!0),e.index=a+2,n.children.length&&nb(n,e)}return e.didChange}const HS=new fe,GS={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(t,e){const r=Math.sign(this.scale.x)||1;e!==0?this.scale.x=t/e*r:this.scale.x=r},_setHeight(t,e){const r=Math.sign(this.scale.y)||1;e!==0?this.scale.y=t/e*r:this.scale.y=r},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new nr});const t=this._localBoundsCacheData;return t.index=1,t.didChange=!1,t.data[0]!==this._didViewChangeTick&&(t.didChange=!0,t.data[0]=this._didViewChangeTick),nb(this,t),t.didChange&&rb(this,t.localBounds,HS),t.localBounds},getBounds(t,e){return Zx(this,t,e||new nr)}},WS={_onRender:null,set onRender(t){const e=this.renderGroup||this.parentRenderGroup;if(!t){this._onRender&&e?.removeOnRender(this),this._onRender=null;return}this._onRender||e?.addOnRender(this),this._onRender=t},get onRender(){return this._onRender}},KS={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(YS))}};function YS(t,e){return t._zIndex-e._zIndex}const QS={getGlobalPosition(t=new dt,e=!1){return this.parent?this.parent.toGlobal(this._position,t,e):(t.x=this._position.x,t.y=this._position.y),t},toGlobal(t,e,r=!1){const s=this.getGlobalTransform(mt.get(),r);return e=s.apply(t,e),mt.return(s),e},toLocal(t,e,r,s){e&&(t=e.toGlobal(t,r,s));const n=this.getGlobalTransform(mt.get(),s);return r=n.applyInverse(t,r),mt.return(n),r}};class ib{constructor(){this.uid=$e("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(e){this.instructions[this.instructionSize++]=e}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let XS=0;class JS{constructor(e){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this.textureStyle=new Wx(this.textureOptions)}createTexture(e,r,s){const n=new Yt({...this.textureOptions,width:e,height:r,resolution:1,antialias:s,autoGarbageCollect:!1});return new Ae({source:n,label:`texturePool_${XS++}`})}getOptimalTexture(e,r,s=1,n){let i=Math.ceil(e*s-1e-6),o=Math.ceil(r*s-1e-6);i=fm(i),o=fm(o);const a=(i<<17)+(o<<1)+(n?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let l=this._texturePool[a].pop();return l||(l=this.createTexture(i,o,n)),l.source._resolution=s,l.source.width=i/s,l.source.height=o/s,l.source.pixelWidth=i,l.source.pixelHeight=o,l.frame.x=0,l.frame.y=0,l.frame.width=e,l.frame.height=r,l.updateUvs(),this._poolKeyHash[l.uid]=a,l}getSameSizeTexture(e,r=!1){const s=e.source;return this.getOptimalTexture(e.width,e.height,s._resolution,r)}returnTexture(e,r=!1){const s=this._poolKeyHash[e.uid];r&&(e.source.style=this.textureStyle),this._texturePool[s].push(e)}clear(e){if(e=e!==!1,e)for(const r in this._texturePool){const s=this._texturePool[r];if(s)for(let n=0;n<s.length;n++)s[n].destroy(!0)}this._texturePool={}}}const ob=new JS;Ld.register(ob);class ZS{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new fe,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new ib,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(e){this.root=e,e._onRender&&this.addOnRender(e),e.didChange=!0;const r=e.children;for(let s=0;s<r.length;s++){const n=r[s];n._updateFlags=15,this.addChild(n)}}enableCacheAsTexture(e={}){this.textureOptions=e,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(ob.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const e=this._parentCacheAsTextureRenderGroup;e&&!e.textureNeedsUpdate&&e.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const e in this.childrenToUpdate){const r=this.childrenToUpdate[e];r.list.fill(null),r.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(e){e.renderGroupParent&&e.renderGroupParent._removeRenderGroupChild(e),e.renderGroupParent=this,this.renderGroupChildren.push(e)}_removeRenderGroupChild(e){const r=this.renderGroupChildren.indexOf(e);r>-1&&this.renderGroupChildren.splice(r,1),e.renderGroupParent=null}addChild(e){if(this.structureDidChange=!0,e.parentRenderGroup=this,e.updateTick=-1,e.parent===this.root?e.relativeRenderGroupDepth=1:e.relativeRenderGroupDepth=e.parent.relativeRenderGroupDepth+1,e.didChange=!0,this.onChildUpdate(e),e.renderGroup){this.addRenderGroupChild(e.renderGroup);return}e._onRender&&this.addOnRender(e);const r=e.children;for(let s=0;s<r.length;s++)this.addChild(r[s])}removeChild(e){if(this.structureDidChange=!0,e._onRender&&(e.renderGroup||this.removeOnRender(e)),e.parentRenderGroup=null,e.renderGroup){this._removeRenderGroupChild(e.renderGroup);return}const r=e.children;for(let s=0;s<r.length;s++)this.removeChild(r[s])}removeChildren(e){for(let r=0;r<e.length;r++)this.removeChild(e[r])}onChildUpdate(e){let r=this.childrenToUpdate[e.relativeRenderGroupDepth];r||(r=this.childrenToUpdate[e.relativeRenderGroupDepth]={index:0,list:[]}),r.list[r.index++]=e}updateRenderable(e){e.globalDisplayStatus<7||(this.instructionSet.renderPipes[e.renderPipeId].updateRenderable(e),e.didViewUpdate=!1)}onChildViewUpdate(e){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=e}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(e){this._onRenderContainers.push(e)}removeOnRender(e){this._onRenderContainers.splice(this._onRenderContainers.indexOf(e),1)}runOnRender(e){for(let r=0;r<this._onRenderContainers.length;r++)this._onRenderContainers[r]._onRender(e)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(e=[]){const r=this.root.children;for(let s=0;s<r.length;s++)this._getChildren(r[s],e);return e}_getChildren(e,r=[]){if(r.push(e),e.renderGroup)return r;const s=e.children;for(let n=0;n<s.length;n++)this._getChildren(s[n],r);return r}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return(this._matrixDirty&1)===0?this._inverseWorldTransform:(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new fe),this._inverseWorldTransform.copyFrom(this.worldTransform).invert())}get textureOffsetInverseTransform(){return(this._matrixDirty&2)===0?this._textureOffsetInverseTransform:(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new fe),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y))}get inverseParentTextureTransform(){if((this._matrixDirty&4)===0)return this._inverseParentTextureTransform;this._matrixDirty&=-5;const e=this._parentCacheAsTextureRenderGroup;return e?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new fe),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(e.inverseWorldTransform).translate(-e._textureBounds.x,-e._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function ek(t,e,r={}){for(const s in e)!r[s]&&e[s]!==void 0&&(t[s]=e[s])}const Lc=new at(null),oa=new at(null),Fc=new at(null,1,1),aa=new at(null),Em=1,tk=2,Uc=4;class Gn extends is{constructor(e={}){super(),this.uid=$e("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.parentRenderLayer=null,this.updateTick=-1,this.localTransform=new fe,this.relativeGroupTransform=new fe,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new at(this,0,0),this._scale=Fc,this._pivot=oa,this._origin=aa,this._skew=Lc,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],ek(this,e,{children:!0,parent:!0,effects:!0}),e.children?.forEach(r=>this.addChild(r)),e.parent?.addChild(this)}static mixin(e){_e("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),Br.mixin(Gn,e)}set _didChangeId(e){this._didViewChangeTick=e>>12&4095,this._didContainerChangeTick=e&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...e){if(this.allowChildren||_e(lt,"addChild: Only Containers will be allowed to add children in v8.0.0"),e.length>1){for(let n=0;n<e.length;n++)this.addChild(e[n]);return e[0]}const r=e[0],s=this.renderGroup||this.parentRenderGroup;return r.parent===this?(this.children.splice(this.children.indexOf(r),1),this.children.push(r),s&&(s.structureDidChange=!0),r):(r.parent&&r.parent.removeChild(r),this.children.push(r),this.sortableChildren&&(this.sortDirty=!0),r.parent=this,r.didChange=!0,r._updateFlags=15,s&&s.addChild(r),this.emit("childAdded",r,this,this.children.length-1),r.emit("added",this),this._didViewChangeTick++,r._zIndex!==0&&r.depthOfChildModified(),r)}removeChild(...e){if(e.length>1){for(let n=0;n<e.length;n++)this.removeChild(e[n]);return e[0]}const r=e[0],s=this.children.indexOf(r);return s>-1&&(this._didViewChangeTick++,this.children.splice(s,1),this.renderGroup?this.renderGroup.removeChild(r):this.parentRenderGroup&&this.parentRenderGroup.removeChild(r),r.parentRenderLayer&&r.parentRenderLayer.detach(r),r.parent=null,this.emit("childRemoved",r,this,s),r.emit("removed",this)),r}_onUpdate(e){e&&e===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(e){!!this.renderGroup!==e&&(e?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const e=this.parentRenderGroup;e?.removeChild(this),this.renderGroup=Kt.get(ZS,this),this.groupTransform=fe.IDENTITY,e?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const e=this.parentRenderGroup;e?.removeChild(this),Kt.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,e?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new fe),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(e){this._position.x=e}get y(){return this._position.y}set y(e){this._position.y=e}get position(){return this._position}set position(e){this._position.copyFrom(e)}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this._skew))}get angle(){return this.rotation*pS}set angle(e){this.rotation=e*mS}get pivot(){return this._pivot===oa&&(this._pivot=new at(this,0,0)),this._pivot}set pivot(e){this._pivot===oa&&(this._pivot=new at(this,0,0),this._origin!==aa&&Nt("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof e=="number"?this._pivot.set(e):this._pivot.copyFrom(e)}get skew(){return this._skew===Lc&&(this._skew=new at(this,0,0)),this._skew}set skew(e){this._skew===Lc&&(this._skew=new at(this,0,0)),this._skew.copyFrom(e)}get scale(){return this._scale===Fc&&(this._scale=new at(this,1,1)),this._scale}set scale(e){this._scale===Fc&&(this._scale=new at(this,0,0)),typeof e=="string"&&(e=parseFloat(e)),typeof e=="number"?this._scale.set(e):this._scale.copyFrom(e)}get origin(){return this._origin===aa&&(this._origin=new at(this,0,0)),this._origin}set origin(e){this._origin===aa&&(this._origin=new at(this,0,0),this._pivot!==oa&&Nt("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof e=="number"?this._origin.set(e):this._origin.copyFrom(e)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(e){const r=this.getLocalBounds().width;this._setWidth(e,r)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(e){const r=this.getLocalBounds().height;this._setHeight(e,r)}getSize(e){e||(e={});const r=this.getLocalBounds();return e.width=Math.abs(this.scale.x*r.width),e.height=Math.abs(this.scale.y*r.height),e}setSize(e,r){const s=this.getLocalBounds();typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,s.width),r!==void 0&&this._setHeight(r,s.height)}_updateSkew(){const e=this._rotation,r=this._skew;this._cx=Math.cos(e+r._y),this._sx=Math.sin(e+r._y),this._cy=-Math.sin(e-r._x),this._sy=Math.cos(e-r._x)}updateTransform(e){return this.position.set(typeof e.x=="number"?e.x:this.position.x,typeof e.y=="number"?e.y:this.position.y),this.scale.set(typeof e.scaleX=="number"?e.scaleX||1:this.scale.x,typeof e.scaleY=="number"?e.scaleY||1:this.scale.y),this.rotation=typeof e.rotation=="number"?e.rotation:this.rotation,this.skew.set(typeof e.skewX=="number"?e.skewX:this.skew.x,typeof e.skewY=="number"?e.skewY:this.skew.y),this.pivot.set(typeof e.pivotX=="number"?e.pivotX:this.pivot.x,typeof e.pivotY=="number"?e.pivotY:this.pivot.y),this.origin.set(typeof e.originX=="number"?e.originX:this.origin.x,typeof e.originY=="number"?e.originY:this.origin.y),this}setFromMatrix(e){e.decompose(this)}updateLocalTransform(){const e=this._didContainerChangeTick;if(this._didLocalTransformChangeId===e)return;this._didLocalTransformChangeId=e;const r=this.localTransform,s=this._scale,n=this._pivot,i=this._origin,o=this._position,a=s._x,l=s._y,c=n._x,u=n._y,h=-i._x,d=-i._y;r.a=this._cx*a,r.b=this._sx*a,r.c=this._cy*l,r.d=this._sy*l,r.tx=o._x-(c*r.a+u*r.c)+(h*r.a+d*r.c)-h,r.ty=o._y-(c*r.b+u*r.d)+(h*r.b+d*r.d)-d}set alpha(e){e!==this.localAlpha&&(this.localAlpha=e,this._updateFlags|=Em,this._onUpdate())}get alpha(){return this.localAlpha}set tint(e){const s=Ve.shared.setValue(e??16777215).toBgrNumber();s!==this.localColor&&(this.localColor=s,this._updateFlags|=Em,this._onUpdate())}get tint(){return La(this.localColor)}set blendMode(e){this.localBlendMode!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=tk,this.localBlendMode=e,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(e){const r=e?2:0;(this.localDisplayStatus&2)!==r&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Uc,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(e){const r=e?0:4;(this.localDisplayStatus&4)!==r&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Uc,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(e){const r=e?1:0;(this.localDisplayStatus&1)!==r&&(this._updateFlags|=Uc,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(e=!1){if(this.destroyed)return;this.destroyed=!0;let r;if(this.children.length&&(r=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof e=="boolean"?e:e?.children)&&r)for(let n=0;n<r.length;++n)r[n].destroy(e);this.renderGroup?.destroy(),this.renderGroup=null}}Br.mixin(Gn,NS,US,QS,WS,GS,DS,LS,KS,RS,jS,$S,BS);class ab extends Gn{constructor(e){super(e),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this._bounds=new nr(0,1,0,0),this._boundsDirty=!0,this.autoGarbageCollect=e.autoGarbageCollect??!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(e){this._roundPixels=e?1:0}containsPoint(e){const r=this.bounds,{x:s,y:n}=e;return s>=r.minX&&s<=r.maxX&&n>=r.minY&&n<=r.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const e=this.renderGroup||this.parentRenderGroup;e&&e.onChildViewUpdate(this)}unload(){this.emit("unload",this);for(const e in this._gpuData)this._gpuData[e]?.destroy();this._gpuData=Object.create(null),this.onViewUpdate()}destroy(e){this.unload(),super.destroy(e),this._bounds=null}collectRenderablesSimple(e,r,s){const{renderPipes:n}=r;n.blendMode.pushBlendMode(this,this.groupBlendMode,e),n[this.renderPipeId].addRenderable(this,e),this.didViewUpdate=!1;const o=this.children,a=o.length;for(let l=0;l<a;l++)o[l].collectRenderables(e,r,s);n.blendMode.popBlendMode(e)}}class js extends ab{constructor(e=Ae.EMPTY){e instanceof Ae&&(e={texture:e});const{texture:r=Ae.EMPTY,anchor:s,roundPixels:n,width:i,height:o,...a}=e;super({label:"Sprite",...a}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new at({_onUpdate:()=>{this.onViewUpdate()}}),s?this.anchor=s:r.defaultAnchor&&(this.anchor=r.defaultAnchor),this.texture=r,this.allowChildren=!1,this.roundPixels=n??!1,i!==void 0&&(this.width=i),o!==void 0&&(this.height=o)}static from(e,r=!1){return e instanceof Ae?new js(e):new js(Ae.from(e,r))}set texture(e){e||(e=Ae.EMPTY);const r=this._texture;r!==e&&(r&&r.dynamic&&r.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return VS(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return _e("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const e=this._anchor,r=this._texture,s=this._bounds,{width:n,height:i}=r.orig;s.minX=-e._x*n,s.maxX=s.minX+n,s.minY=-e._y*i,s.maxY=s.minY+i}destroy(e=!1){if(super.destroy(e),typeof e=="boolean"?e:e?.texture){const s=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(s)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this._setWidth(e,this._texture.orig.width),this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this._setHeight(e,this._texture.orig.height),this._height=e}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this._texture.orig.width,e.height=Math.abs(this.scale.y)*this._texture.orig.height,e}setSize(e,r){typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,this._texture.orig.width),r!==void 0&&this._setHeight(r,this._texture.orig.height)}}const rk=new nr;function lb(t,e,r){const s=rk;t.measurable=!0,Zx(t,r,s),e.addBoundsMask(s),t.measurable=!1}function cb(t,e,r){const s=Tr.get();t.measurable=!0;const n=mt.get().identity(),i=ub(t,r,n);rb(t,s,i),t.measurable=!1,e.addBoundsMask(s),mt.return(n),Tr.return(s)}function ub(t,e,r){return t?(t!==e&&(ub(t.parent,e,r),t.updateLocalTransform(),r.append(t.localTransform)),r):(Nt("Mask bounds, renderable is not inside the root container"),r)}class hb{constructor(e){this.priority=0,this.inverse=!1,this.pipe="alphaMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.renderMaskToTexture=!(e instanceof js),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask=null)}addBounds(e,r){this.inverse||lb(this.mask,e,r)}addLocalBounds(e,r){cb(this.mask,e,r)}containsPoint(e,r){const s=this.mask;return r(s,e)}destroy(){this.reset()}static test(e){return e instanceof js}}hb.extension=Pe.MaskEffect;class db{constructor(e){this.priority=0,this.pipe="colorMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e}destroy(){}static test(e){return typeof e=="number"}}db.extension=Pe.MaskEffect;class fb{constructor(e){this.priority=0,this.pipe="stencilMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null)}addBounds(e,r){lb(this.mask,e,r)}addLocalBounds(e,r){cb(this.mask,e,r)}containsPoint(e,r){const s=this.mask;return r(s,e)}destroy(){this.reset()}static test(e){return e instanceof Gn}}fb.extension=Pe.MaskEffect;const sk={createCanvas:(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>new DOMParser().parseFromString(t,"text/xml")};let Pm=sk;const Co={get(){return Pm},set(t){Pm=t}};class pb extends Yt{constructor(e){e.resource||(e.resource=Co.get().createCanvas()),e.width||(e.width=e.resource.width,e.autoDensity||(e.width/=e.resolution)),e.height||(e.height=e.resource.height,e.autoDensity||(e.height/=e.resolution)),super(e),this.uploadMethodId="image",this.autoDensity=e.autoDensity,this.resizeCanvas(),this.transparent=!!e.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(e=this.width,r=this.height,s=this._resolution){const n=super.resize(e,r,s);return n&&this.resizeCanvas(),n}static test(e){return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&e instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}pb.extension=Pe.TextureSource;class ol extends Yt{constructor(e){super(e),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(e){return globalThis.HTMLImageElement&&e instanceof HTMLImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||globalThis.VideoFrame&&e instanceof VideoFrame}}ol.extension=Pe.TextureSource;var al=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(al||{});class $c{constructor(e,r=null,s=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=e,this._context=r,this.priority=s,this._once=n}match(e,r=null){return this._fn===e&&this._context===r}emit(e){this._fn&&(this._context?this._fn.call(this._context,e):this._fn(e));const r=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),r}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const r=this.next;return this.next=e?null:r,this.previous=null,r}}const mb=class Tt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new $c(null,null,1/0),this.deltaMS=1/Tt.targetFPMS,this.elapsedMS=1/Tt.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,r,s=al.NORMAL){return this._addListener(new $c(e,r,s))}addOnce(e,r,s=al.NORMAL){return this._addListener(new $c(e,r,s,!0))}_addListener(e){let r=this._head.next,s=this._head;if(!r)e.connect(s);else{for(;r;){if(e.priority>r.priority){e.connect(s);break}s=r,r=r.next}e.previous||e.connect(s)}return this._startIfPossible(),this}remove(e,r){let s=this._head.next;for(;s;)s.match(e,r)?s=s.destroy():s=s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,r=this._head;for(;r=r.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let r;if(e>this.lastTime){if(r=this.elapsedMS=e-this.lastTime,r>this._maxElapsedMS&&(r=this._maxElapsedMS),r*=this.speed,this._minElapsedMS){const i=e-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=e-i%this._minElapsedMS}this.deltaMS=r,this.deltaTime=this.deltaMS*Tt.targetFPMS;const s=this._head;let n=s.next;for(;n;)n=n.emit(this);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const r=Math.min(this.maxFPS,e),s=Math.min(Math.max(0,r)/1e3,Tt.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const r=Math.max(this.minFPS,e);this._minElapsedMS=1/(r/1e3)}}static get shared(){if(!Tt._shared){const e=Tt._shared=new Tt;e.autoStart=!0,e._protected=!0}return Tt._shared}static get system(){if(!Tt._system){const e=Tt._system=new Tt;e.autoStart=!0,e._protected=!0}return Tt._system}};mb.targetFPMS=.06;let gt=mb,Hc;async function nk(){return Hc??(Hc=(async()=>{const e=Co.get().createCanvas(1,1).getContext("webgl");if(!e)return"premultiply-alpha-on-upload";const r=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!r)return"premultiply-alpha-on-upload";const s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);const n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r);const i=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,i),e.deleteFramebuffer(n),e.deleteTexture(s),e.getExtension("WEBGL_lose_context")?.loseContext(),i[0]<=i[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Hc}const Dl=class gb extends Yt{constructor(e){super(e),this.isReady=!1,this.uploadMethodId="video",e={...gb.defaultOptions,...e},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this.alphaMode=e.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const e=gt.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const e=this.resource,r=this.options;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(r.preload||e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlayThrough),e.addEventListener("error",this._onError,!0)),this.alphaMode=await nk(),this._load=new Promise((s,n)=>{this.isValid?s(this):(this._resolve=s,this._reject=n,r.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${r.preloadTimeoutMs}ms`))})),e.load())}),this._load}_onError(e){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.resource;return!e.paused&&!e.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const e=this.resource;this.isValid&&(this.isReady=!0,this.resize(e.videoWidth,e.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const e=this.resource;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlayThrough),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(gt.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(gt.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(gt.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement}};Dl.extension=Pe.TextureSource;Dl.defaultOptions={...Yt.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};Dl.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let ik=Dl;const rn=(t,e,r=!1)=>(Array.isArray(t)||(t=[t]),e?t.map(s=>typeof s=="string"||r?e(s):s):t);class ok{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const r=this._cache.get(e);return r||Nt(`[Assets] Asset id ${e} was not found in the Cache`),r}set(e,r){const s=rn(e);let n;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.test(r)){n=c.getCacheableAssets(s,r);break}}const i=new Map(Object.entries(n||{}));n||s.forEach(l=>{i.set(l,r)});const o=[...i.keys()],a={cacheKeys:o,keys:s};s.forEach(l=>{this._cacheMap.set(l,a)}),o.forEach(l=>{const c=n?n[l]:r;this._cache.has(l)&&this._cache.get(l)!==c&&Nt("[Cache] already has key:",l),this._cache.set(l,i.get(l))})}remove(e){if(!this._cacheMap.has(e)){Nt(`[Assets] Asset id ${e} was not found in the Cache`);return}const r=this._cacheMap.get(e);r.cacheKeys.forEach(n=>{this._cache.delete(n)}),r.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const sn=new ok,mh=[];Br.handleByList(Pe.TextureSource,mh);function yb(t={}){const e=t&&t.resource,r=e?t.resource:t,s=e?t:{resource:t};for(let n=0;n<mh.length;n++){const i=mh[n];if(i.test(r))return new i(s)}throw new Error(`Could not find a source type for resource: ${s.resource}`)}function ak(t={},e=!1){const r=t&&t.resource,s=r?t.resource:t,n=r?t:{resource:t};if(!e&&sn.has(s))return sn.get(s);const i=new Ae({source:yb(n)});return i.on("destroy",()=>{sn.has(s)&&sn.remove(s)}),e||sn.set(s,i),i}function lk(t,e=!1){return typeof t=="string"?sn.get(t):t instanceof Yt?new Ae({source:t}):ak(t,e)}Ae.from=lk;Yt.from=yb;Br.add(hb,db,fb,ik,ol,pb,Dd);var Ab=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Ab||{});function Xt(t){if(typeof t!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function ii(t){return t.split("?")[0].split("#")[0]}function ck(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function uk(t,e,r){return t.replace(new RegExp(ck(e),"g"),r)}function hk(t,e){let r="",s=0,n=-1,i=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||i===1))if(n!==a-1&&i===2){if(r.length<2||s!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){const l=r.lastIndexOf("/");if(l!==r.length-1){l===-1?(r="",s=0):(r=r.slice(0,l),s=r.length-1-r.lastIndexOf("/")),n=a,i=0;continue}}else if(r.length===2||r.length===1){r="",s=0,n=a,i=0;continue}}}else r.length>0?r+=`/${t.slice(n+1,a)}`:r=t.slice(n+1,a),s=a-n-1;n=a,i=0}else o===46&&i!==-1?++i:i=-1}return r}const Yi={toPosix(t){return uk(t,"\\","/")},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},isBlobUrl(t){return t.startsWith("blob:")},hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){Xt(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const r=/^[^/:]+:\/{0,2}/.exec(t);return r?r[0]:""},toAbsolute(t,e,r){if(Xt(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const s=ii(this.toPosix(e??Co.get().getBaseUrl())),n=ii(this.toPosix(r??this.rootname(s)));return t=this.toPosix(t),t.startsWith("/")?Yi.join(n,t.slice(1)):this.isAbsolute(t)?t:this.join(s,t)},normalize(t){if(Xt(t),t.length===0)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;t=this.toPosix(t);let e="";const r=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const s=t.endsWith("/");return t=hk(t),t.length>0&&s&&(t+="/"),r?`/${t}`:e+t},isAbsolute(t){return Xt(t),t=this.toPosix(t),this.hasProtocol(t)?!0:t.startsWith("/")},join(...t){if(t.length===0)return".";let e;for(let r=0;r<t.length;++r){const s=t[r];if(Xt(s),s.length>0)if(e===void 0)e=s;else{const n=t[r-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?e+=`/../${s}`:e+=`/${s}`}}return e===void 0?".":this.normalize(e)},dirname(t){if(Xt(t),t.length===0)return".";t=this.toPosix(t);let e=t.charCodeAt(0);const r=e===47;let s=-1,n=!0;const i=this.getProtocol(t),o=t;t=t.slice(i.length);for(let a=t.length-1;a>=1;--a)if(e=t.charCodeAt(a),e===47){if(!n){s=a;break}}else n=!1;return s===-1?r?"/":this.isUrl(o)?i+t:i:r&&s===1?"//":i+t.slice(0,s)},rootname(t){Xt(t),t=this.toPosix(t);let e="";if(t.startsWith("/")?e="/":e=this.getProtocol(t),this.isUrl(t)){const r=t.indexOf("/",e.length);r!==-1?e=t.slice(0,r):e=t,e.endsWith("/")||(e+="/")}return e},basename(t,e){Xt(t),e&&Xt(e),t=ii(this.toPosix(t));let r=0,s=-1,n=!0,i;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(i=t.length-1;i>=0;--i){const l=t.charCodeAt(i);if(l===47){if(!n){r=i+1;break}}else a===-1&&(n=!1,a=i+1),o>=0&&(l===e.charCodeAt(o)?--o===-1&&(s=i):(o=-1,s=a))}return r===s?s=a:s===-1&&(s=t.length),t.slice(r,s)}for(i=t.length-1;i>=0;--i)if(t.charCodeAt(i)===47){if(!n){r=i+1;break}}else s===-1&&(n=!1,s=i+1);return s===-1?"":t.slice(r,s)},extname(t){Xt(t),t=ii(this.toPosix(t));let e=-1,r=0,s=-1,n=!0,i=0;for(let o=t.length-1;o>=0;--o){const a=t.charCodeAt(o);if(a===47){if(!n){r=o+1;break}continue}s===-1&&(n=!1,s=o+1),a===46?e===-1?e=o:i!==1&&(i=1):e!==-1&&(i=-1)}return e===-1||s===-1||i===0||i===1&&e===s-1&&e===r+1?"":t.slice(e,s)},parse(t){Xt(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;t=ii(this.toPosix(t));let r=t.charCodeAt(0);const s=this.isAbsolute(t);let n;e.root=this.rootname(t),s||this.hasProtocol(t)?n=1:n=0;let i=-1,o=0,a=-1,l=!0,c=t.length-1,u=0;for(;c>=n;--c){if(r=t.charCodeAt(c),r===47){if(!l){o=c+1;break}continue}a===-1&&(l=!1,a=c+1),r===46?i===-1?i=c:u!==1&&(u=1):i!==-1&&(u=-1)}return i===-1||a===-1||u===0||u===1&&i===a-1&&i===o+1?a!==-1&&(o===0&&s?e.base=e.name=t.slice(1,a):e.base=e.name=t.slice(o,a)):(o===0&&s?(e.name=t.slice(1,i),e.base=t.slice(1,a)):(e.name=t.slice(o,i),e.base=t.slice(o,a)),e.ext=t.slice(i,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":",joinExtensions:[".html"]};function xb(t,e,r,s,n){const i=e[r];for(let o=0;o<i.length;o++){const a=i[o];r<e.length-1?xb(t.replace(s[r],a),e,r+1,s,n):n.push(t.replace(s[r],a))}}function dk(t){const e=/\{(.*?)\}/g,r=t.match(e),s=[];if(r){const n=[];r.forEach(i=>{const o=i.substring(1,i.length-1).split(",");n.push(o)}),xb(t,n,0,r,s)}else s.push(t);return s}const Tm=t=>!Array.isArray(t);class bb{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,r)=>`${e}${this._bundleIdConnector}${r}`,extractAssetIdFromBundle:(e,r)=>r.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const r=e;this._defaultSearchParams=Object.keys(r).map(s=>`${encodeURIComponent(s)}=${encodeURIComponent(r[s])}`).join("&")}}getAlias(e){const{alias:r,src:s}=e;return rn(r||s,i=>typeof i=="string"?i:Array.isArray(i)?i.map(o=>o?.src??o):i?.src?i.src:i,!0)}addManifest(e){this._manifest&&Nt("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(e,r){const s=[];let n=r;Array.isArray(r)||(n=Object.entries(r).map(([i,o])=>typeof o=="string"||Array.isArray(o)?{alias:i,src:o}:{alias:i,...o})),n.forEach(i=>{const o=i.src,a=i.alias;let l;if(typeof a=="string"){const c=this._createBundleAssetId(e,a);s.push(c),l=[a,c]}else{const c=a.map(u=>this._createBundleAssetId(e,u));s.push(...c),l=[...a,...c]}this.add({...i,alias:l,src:o})}),this._bundles[e]=s}add(e){const r=[];Array.isArray(e)?r.push(...e):r.push(e);let s;s=i=>{this.hasKey(i)&&Nt(`[Resolver] already has key: ${i} overwriting`)},rn(r).forEach(i=>{const{src:o}=i;let{data:a,format:l,loadParser:c,parser:u}=i;const h=rn(o).map(y=>typeof y=="string"?dk(y):Array.isArray(y)?y:[y]),d=this.getAlias(i);Array.isArray(d)?d.forEach(s):s(d);const f=[],m=y=>({...this._parsers.find(A=>A.test(y))?.parse(y),src:y});h.forEach(y=>{y.forEach(g=>{let A={};if(typeof g!="object"?A=m(g):(a=g.data??a,l=g.format??l,(g.loadParser||g.parser)&&(c=g.loadParser??c,u=g.parser??u),A={...m(g.src),...g}),!d)throw new Error(`[Resolver] alias is undefined for this asset: ${A.src}`);A=this._buildResolvedAsset(A,{aliases:d,data:a,format:l,loadParser:c,parser:u,progressSize:i.progressSize}),f.push(A)})}),d.forEach(y=>{this._assetMap[y]=f})})}resolveBundle(e){const r=Tm(e);e=rn(e);const s={};return e.forEach(n=>{const i=this._bundles[n];if(i){const o=this.resolve(i),a={};for(const l in o){const c=o[l];a[this._extractAssetIdFromBundle(n,l)]=c}s[n]=a}}),r?s[e[0]]:s}resolveUrl(e){const r=this.resolve(e);if(typeof e!="string"){const s={};for(const n in r)s[n]=r[n].src;return s}return r.src}resolve(e){const r=Tm(e);e=rn(e);const s={};return e.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let i=this._assetMap[n];const o=this._getPreferredOrder(i);o?.priority.forEach(a=>{o.params[a].forEach(l=>{const c=i.filter(u=>u[a]?u[a]===l:!1);c.length&&(i=c)})}),this._resolverHash[n]=i[0]}else this._resolverHash[n]=this._buildResolvedAsset({alias:[n],src:n},{});s[n]=this._resolverHash[n]}),r?s[e[0]]:s}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let r=0;r<e.length;r++){const s=e[r],n=this._preferredOrder.find(i=>i.params.format.includes(s.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const r=/\?/.test(e)?"&":"?";return`${e}${r}${this._defaultSearchParams}`}_buildResolvedAsset(e,r){const{aliases:s,data:n,loadParser:i,parser:o,format:a,progressSize:l}=r;return(this._basePath||this._rootPath)&&(e.src=Yi.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=s??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...n||{},...e.data},e.loadParser=i??e.loadParser,e.parser=o??e.parser,e.format=a??e.format??fk(e.src),l!==void 0&&(e.progressSize=l),e}}bb.RETINA_PREFIX=/@([0-9\.]+)x/;function fk(t){return t.split(".").pop().split("?").shift().split("#").shift()}const Rm=(t,e)=>{const r=e.split("?")[1];return r&&(t+=`?${r}`),t},wb=class qi{constructor(e,r){this.linkedSheets=[];let s=e;e?.source instanceof Yt&&(s={texture:e,data:r});const{texture:n,data:i,cachePrefix:o=""}=s;this.cachePrefix=o,this._texture=n instanceof Ae?n:null,this.textureSource=n.source,this.textures={},this.animations={},this.data=i;const a=parseFloat(i.meta.scale);a?(this.resolution=a,n.source.resolution=this.resolution):this.resolution=n.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=qi.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}parseSync(){return this._processFrames(0,!0),this._processAnimations(),this.textures}_processFrames(e,r=!1){let s=e;const n=r?1/0:qi.BATCH_SIZE;for(;s-e<n&&s<this._frameKeys.length;){const i=this._frameKeys[s],o=this._frames[i],a=o.frame;if(a){let l=null,c=null;const u=o.trimmed!==!1&&o.sourceSize?o.sourceSize:o.frame,h=new Qe(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);o.rotated?l=new Qe(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):l=new Qe(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),o.trimmed!==!1&&o.spriteSourceSize&&(c=new Qe(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[i]=new Ae({source:this.textureSource,frame:l,orig:h,trim:c,rotate:o.rotated?2:0,defaultAnchor:o.anchor,defaultBorders:o.borders,label:i.toString()})}s++}}_processAnimations(){const e=this.data.animations||{};for(const r in e){this.animations[r]=[];for(let s=0;s<e[r].length;s++){const n=e[r][s];this.animations[r].push(this.textures[n])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*qi.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*qi.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};wb.BATCH_SIZE=1e3;let gh=wb;const pk=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function Vb(t,e,r){const s={};if(t.forEach(n=>{s[n]=e}),Object.keys(e.textures).forEach(n=>{s[`${e.cachePrefix}${n}`]=e.textures[n]}),!r){const n=Yi.dirname(t[0]);e.linkedSheets.forEach((i,o)=>{const a=Vb([`${n}/${e.data.meta.related_multi_packs[o]}`],i,!0);Object.assign(s,a)})}return s}const mk={extension:Pe.Asset,cache:{test:t=>t instanceof gh,getCacheableAssets:(t,e)=>Vb(t,e,!1)},resolver:{extension:{type:Pe.ResolveParser,name:"resolveSpritesheet"},test:t=>{const r=t.split("?")[0].split("."),s=r.pop(),n=r.pop();return s==="json"&&pk.includes(n)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(bb.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:Pe.LoadParser,priority:Ab.Normal,name:"spritesheetLoader"},async testParse(t,e){return Yi.extname(e.src).toLowerCase()===".json"&&!!t.frames},async parse(t,e,r){const{texture:s,imageFilename:n,textureOptions:i,cachePrefix:o}=e?.data??{};let a=Yi.dirname(e.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let l;if(s instanceof Ae)l=s;else{const h=Rm(a+(n??t.meta.image),e.src);l=(await r.load([{src:h,data:i}]))[h]}const c=new gh({texture:l.source,data:t,cachePrefix:o});await c.parse();const u=t?.meta?.related_multi_packs;if(Array.isArray(u)){const h=[];for(const f of u){if(typeof f!="string")continue;let m=a+f;e.data?.ignoreMultiPack||(m=Rm(m,e.src),h.push(r.load({src:m,data:{textureOptions:i,ignoreMultiPack:!0}})))}const d=await Promise.all(h);c.linkedSheets=d,d.forEach(f=>{f.linkedSheets=[c].concat(c.linkedSheets.filter(m=>m!==f))})}return c},async unload(t,e,r){await r.unload(t.textureSource._sourceOrigin),t.destroy(!1)}}};Br.add(mk);const Gc=Object.create(null),Mm=Object.create(null);function Ud(t,e){let r=Mm[t];return r===void 0&&(Gc[e]===void 0&&(Gc[e]=1),Mm[t]=r=Gc[e]++),r}let la;function qb(){return(!la||la?.isContextLost())&&(la=Co.get().createCanvas().getContext("webgl",{})),la}let ca;function gk(){if(!ca){ca="mediump";const t=qb();t&&t.getShaderPrecisionFormat&&(ca=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?"highp":"mediump")}return ca}function yk(t,e,r){return e?t:r?(t=t.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${t}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${t}
        `}function Ak(t,e,r){const s=r?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if(t.substring(0,9)!=="precision"){let n=r?e.requestedFragmentPrecision:e.requestedVertexPrecision;return n==="highp"&&s!=="highp"&&(n="mediump"),`precision ${n} float;
${t}`}else if(s!=="highp"&&t.substring(0,15)==="precision highp")return t.replace("precision highp","precision mediump");return t}function xk(t,e){return e?`#version 300 es
${t}`:t}const bk={},wk={};function Vk(t,{name:e="pixi-program"},r=!0){e=e.replace(/\s+/g,"-"),e+=r?"-fragment":"-vertex";const s=r?bk:wk;return s[e]?(s[e]++,e+=`-${s[e]}`):s[e]=1,t.indexOf("#define SHADER_NAME")!==-1?t:`${`#define SHADER_NAME ${e}`}
${t}`}function qk(t,e){return e?t.replace("#version 300 es",""):t}const Wc={stripVersion:qk,ensurePrecision:Ak,addProgramDefines:yk,setProgramName:Vk,insertVersion:xk},oi=Object.create(null),vb=class yh{constructor(e){e={...yh.defaultOptions,...e};const r=e.fragment.indexOf("#version 300 es")!==-1,s={stripVersion:r,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:gk()},setProgramName:{name:e.name},addProgramDefines:r,insertVersion:r};let n=e.fragment,i=e.vertex;Object.keys(Wc).forEach(o=>{const a=s[o];n=Wc[o](n,a,!0),i=Wc[o](i,a,!1)}),this.fragment=n,this.vertex=i,this.transformFeedbackVaryings=e.transformFeedbackVaryings,this._key=Ud(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,oi[this._cacheKey]=null}static from(e){const r=`${e.vertex}:${e.fragment}`;return oi[r]||(oi[r]=new yh(e),oi[r]._cacheKey=r),oi[r]}};vb.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let Ll=vb;const Im={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function vk(t){return Im[t]??Im.float32}const _k={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function Sk({source:t,entryPoint:e}){const r={},s=t.indexOf(`fn ${e}`);if(s!==-1){const n=t.indexOf("->",s);if(n!==-1){const i=t.substring(s,n),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let a;for(;(a=o.exec(i))!==null;){const l=_k[a[3]]??"float32";r[a[2]]={location:parseInt(a[1],10),format:l,stride:vk(l).stride,offset:0,instance:!1,start:0}}}}return r}function Kc(t){const e=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,r=/@group\((\d+)\)/,s=/@binding\((\d+)\)/,n=/var(<[^>]+>)? (\w+)/,i=/:\s*(\w+)/,o=/struct\s+(\w+)\s*{([^}]+)}/g,a=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,c=t.match(e)?.map(h=>({group:parseInt(h.match(r)[1],10),binding:parseInt(h.match(s)[1],10),name:h.match(n)[2],isUniform:h.match(n)[1]==="<uniform>",type:h.match(i)[1]}));if(!c)return{groups:[],structs:[]};const u=t.match(o)?.map(h=>{const d=h.match(l)[1],f=h.match(a).reduce((m,y)=>{const[g,A]=y.split(":");return m[g.trim()]=A.trim(),m},{});return f?{name:d,members:f}:null}).filter(({name:h})=>c.some(d=>d.type===h))??[];return{groups:c,structs:u}}var vi=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(vi||{});function kk({groups:t}){const e=[];for(let r=0;r<t.length;r++){const s=t[r];e[s.group]||(e[s.group]=[]),s.isUniform?e[s.group].push({binding:s.binding,visibility:vi.VERTEX|vi.FRAGMENT,buffer:{type:"uniform"}}):s.type==="sampler"?e[s.group].push({binding:s.binding,visibility:vi.FRAGMENT,sampler:{type:"filtering"}}):s.type==="texture_2d"&&e[s.group].push({binding:s.binding,visibility:vi.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}function Ck({groups:t}){const e=[];for(let r=0;r<t.length;r++){const s=t[r];e[s.group]||(e[s.group]={}),e[s.group][s.name]=s.binding}return e}function Ek(t,e){const r=new Set,s=new Set,n=[...t.structs,...e.structs].filter(o=>r.has(o.name)?!1:(r.add(o.name),!0)),i=[...t.groups,...e.groups].filter(o=>{const a=`${o.name}-${o.binding}`;return s.has(a)?!1:(s.add(a),!0)});return{structs:n,groups:i}}const ai=Object.create(null);class Eo{constructor(e){this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:r,vertex:s,layout:n,gpuLayout:i,name:o}=e;if(this.name=o,this.fragment=r,this.vertex=s,r.source===s.source){const a=Kc(r.source);this.structsAndGroups=a}else{const a=Kc(s.source),l=Kc(r.source);this.structsAndGroups=Ek(a,l)}this.layout=n??Ck(this.structsAndGroups),this.gpuLayout=i??kk(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:e,fragment:r}=this,s=e.source+r.source+e.entryPoint+r.entryPoint;this._layoutKey=Ud(s,"program")}get attributeData(){return this._attributeData??(this._attributeData=Sk(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,ai[this._cacheKey]=null}static from(e){const r=`${e.vertex.source}:${e.fragment.source}:${e.fragment.entryPoint}:${e.vertex.entryPoint}`;return ai[r]||(ai[r]=new Eo(e),ai[r]._cacheKey=r),ai[r]}}const _b=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],Pk=_b.reduce((t,e)=>(t[e]=!0,t),{});function Tk(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Sb=class kb{constructor(e,r){this._touched=0,this.uid=$e("uniform"),this._resourceType="uniformGroup",this._resourceId=$e("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,r={...kb.defaultOptions,...r},this.uniformStructures=e;const s={};for(const n in e){const i=e[n];if(i.name=n,i.size=i.size??1,!Pk[i.type]){const o=i.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(o){const[,a,l]=o;throw new Error(`Uniform type ${i.type} is not supported. Use type: '${a}', size: ${l} instead.`)}throw new Error(`Uniform type ${i.type} is not supported. Supported uniform types are: ${_b.join(", ")}`)}i.value??(i.value=Tk(i.type,i.size)),s[n]=i.value}this.uniforms=s,this._dirtyId=1,this.ubo=r.ubo,this.isStatic=r.isStatic,this._signature=Ud(Object.keys(s).map(n=>`${n}-${e[n].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};Sb.defaultOptions={ubo:!1,isStatic:!1};let Cb=Sb;class Fa{constructor(e){this.resources=Object.create(null),this._dirty=!0;let r=0;for(const s in e){const n=e[s];this.setResource(n,r++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const e=[];let r=0;for(const s in this.resources)e[r++]=this.resources[s]._resourceId;this._key=e.join("|")}setResource(e,r){const s=this.resources[r];e!==s&&(s&&e.off?.("change",this.onResourceChange,this),e.on?.("change",this.onResourceChange,this),this.resources[r]=e,this._dirty=!0)}getResource(e){return this.resources[e]}_touch(e,r){const s=this.resources;for(const n in s)s[n]._gcLastUsed=e,s[n]._touched=r}destroy(){const e=this.resources;for(const r in e)e[r]?.off?.("change",this.onResourceChange,this);this.resources=null}onResourceChange(e){if(this._dirty=!0,e.destroyed){const r=this.resources;for(const s in r)r[s]===e&&(r[s]=null)}else this._updateKey()}}var Ah=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.BOTH=3]="BOTH",t))(Ah||{});class Fl extends is{constructor(e){super(),this.uid=$e("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[],this._destroyed=!1;let{gpuProgram:r,glProgram:s,groups:n,resources:i,compatibleRenderers:o,groupMap:a}=e;this.gpuProgram=r,this.glProgram=s,o===void 0&&(o=0,r&&(o|=Ah.WEBGPU),s&&(o|=Ah.WEBGL)),this.compatibleRenderers=o;const l={};if(!i&&!n&&(i={}),i&&n)throw new Error("[Shader] Cannot have both resources and groups");if(!r&&n&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!r&&n&&a)for(const c in a)for(const u in a[c]){const h=a[c][u];l[h]={group:c,binding:u,name:h}}else if(r&&n&&!a){const c=r.structsAndGroups.groups;a={},c.forEach(u=>{a[u.group]=a[u.group]||{},a[u.group][u.binding]=u.name,l[u.name]=u})}else if(i){n={},a={},r&&r.structsAndGroups.groups.forEach(h=>{a[h.group]=a[h.group]||{},a[h.group][h.binding]=h.name,l[h.name]=h});let c=0;for(const u in i)l[u]||(n[99]||(n[99]=new Fa,this._ownedBindGroups.push(n[99])),l[u]={group:99,binding:c,name:u},a[99]=a[99]||{},a[99][c]=u,c++);for(const u in i){const h=u;let d=i[u];!d.source&&!d._resourceType&&(d=new Cb(d));const f=l[h];f&&(n[f.group]||(n[f.group]=new Fa,this._ownedBindGroups.push(n[f.group])),n[f.group].setResource(d,f.binding))}}this.groups=n,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(n,l)}addResource(e,r,s){var n,i;(n=this._uniformBindMap)[r]||(n[r]={}),(i=this._uniformBindMap[r])[s]||(i[s]=e),this.groups[r]||(this.groups[r]=new Fa,this._ownedBindGroups.push(this.groups[r]))}_buildResourceAccessor(e,r){const s={};for(const n in r){const i=r[n];Object.defineProperty(s,i.name,{get(){return e[i.group].getResource(i.binding)},set(o){e[i.group].setResource(o,i.binding)}})}return s}destroy(e=!1){this._destroyed||(this._destroyed=!0,this.emit("destroy",this),e&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(r=>{r.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null)}static from(e){const{gpu:r,gl:s,...n}=e;let i,o;return r&&(i=Eo.from(r)),s&&(o=Ll.from(s)),new Fl({gpuProgram:i,glProgram:o,...n})}}const Rk={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},Yc=0,Qc=1,Xc=2,Jc=3,Zc=4,eu=5,xh=class Eb{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Yc)}set blend(e){!!(this.data&1<<Yc)!==e&&(this.data^=1<<Yc)}get offsets(){return!!(this.data&1<<Qc)}set offsets(e){!!(this.data&1<<Qc)!==e&&(this.data^=1<<Qc)}set cullMode(e){if(e==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=e==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<Xc)}set culling(e){!!(this.data&1<<Xc)!==e&&(this.data^=1<<Xc)}get depthTest(){return!!(this.data&1<<Jc)}set depthTest(e){!!(this.data&1<<Jc)!==e&&(this.data^=1<<Jc)}get depthMask(){return!!(this.data&1<<eu)}set depthMask(e){!!(this.data&1<<eu)!==e&&(this.data^=1<<eu)}get clockwiseFrontFace(){return!!(this.data&1<<Zc)}set clockwiseFrontFace(e){!!(this.data&1<<Zc)!==e&&(this.data^=1<<Zc)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!=="none",this._blendMode=e,this._blendModeId=Rk[e]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const e=new Eb;return e.depthTest=!1,e.blend=!0,e}};xh.default2d=xh.for2d();let Mk=xh;const Pb=class bh extends Fl{constructor(e){e={...bh.defaultOptions,...e},super(e),this.enabled=!0,this._state=Mk.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1),e.blendRequired&&this.addResource("uBackTexture",0,3)}apply(e,r,s,n){e.applyFilter(this,r,s,n)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:r,gl:s,...n}=e;let i,o;return r&&(i=Eo.from(r)),s&&(o=Ll.from(s)),new bh({gpuProgram:i,glProgram:o,...n})}};Pb.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let Ik=Pb;function jm(t,e,r=2){const s=e&&e.length,n=s?e[0]*r:t.length;let i=Tb(t,0,n,r,!0);const o=[];if(!i||i.next===i.prev)return o;let a,l,c;if(s&&(i=zk(t,e,i,r)),t.length>80*r){a=t[0],l=t[1];let u=a,h=l;for(let d=r;d<n;d+=r){const f=t[d],m=t[d+1];f<a&&(a=f),m<l&&(l=m),f>u&&(u=f),m>h&&(h=m)}c=Math.max(u-a,h-l),c=c!==0?32767/c:0}return Qi(i,o,r,a,l,c,0),o}function Tb(t,e,r,s,n){let i;if(n===Qk(t,e,r,s)>0)for(let o=e;o<r;o+=s)i=Om(o/s|0,t[o],t[o+1],i);else for(let o=r-s;o>=e;o-=s)i=Om(o/s|0,t[o],t[o+1],i);return i&&_n(i,i.next)&&(Ji(i),i=i.next),i}function Os(t,e){if(!t)return t;e||(e=t);let r=t,s;do if(s=!1,!r.steiner&&(_n(r,r.next)||Te(r.prev,r,r.next)===0)){if(Ji(r),r=e=r.prev,r===r.next)break;s=!0}else r=r.next;while(s||r!==e);return e}function Qi(t,e,r,s,n,i,o){if(!t)return;!o&&i&&$k(t,s,n,i);let a=t;for(;t.prev!==t.next;){const l=t.prev,c=t.next;if(i?Ok(t,s,n,i):jk(t)){e.push(l.i,t.i,c.i),Ji(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=Nk(Os(t),e),Qi(t,e,r,s,n,i,2)):o===2&&Bk(t,e,r,s,n,i):Qi(Os(t),e,r,s,n,i,1);break}}}function jk(t){const e=t.prev,r=t,s=t.next;if(Te(e,r,s)>=0)return!1;const n=e.x,i=r.x,o=s.x,a=e.y,l=r.y,c=s.y,u=Math.min(n,i,o),h=Math.min(a,l,c),d=Math.max(n,i,o),f=Math.max(a,l,c);let m=s.next;for(;m!==e;){if(m.x>=u&&m.x<=d&&m.y>=h&&m.y<=f&&_i(n,a,i,l,o,c,m.x,m.y)&&Te(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Ok(t,e,r,s){const n=t.prev,i=t,o=t.next;if(Te(n,i,o)>=0)return!1;const a=n.x,l=i.x,c=o.x,u=n.y,h=i.y,d=o.y,f=Math.min(a,l,c),m=Math.min(u,h,d),y=Math.max(a,l,c),g=Math.max(u,h,d),A=wh(f,m,e,r,s),b=wh(y,g,e,r,s);let x=t.prevZ,w=t.nextZ;for(;x&&x.z>=A&&w&&w.z<=b;){if(x.x>=f&&x.x<=y&&x.y>=m&&x.y<=g&&x!==n&&x!==o&&_i(a,u,l,h,c,d,x.x,x.y)&&Te(x.prev,x,x.next)>=0||(x=x.prevZ,w.x>=f&&w.x<=y&&w.y>=m&&w.y<=g&&w!==n&&w!==o&&_i(a,u,l,h,c,d,w.x,w.y)&&Te(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;x&&x.z>=A;){if(x.x>=f&&x.x<=y&&x.y>=m&&x.y<=g&&x!==n&&x!==o&&_i(a,u,l,h,c,d,x.x,x.y)&&Te(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;w&&w.z<=b;){if(w.x>=f&&w.x<=y&&w.y>=m&&w.y<=g&&w!==n&&w!==o&&_i(a,u,l,h,c,d,w.x,w.y)&&Te(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function Nk(t,e){let r=t;do{const s=r.prev,n=r.next.next;!_n(s,n)&&Mb(s,r,r.next,n)&&Xi(s,n)&&Xi(n,s)&&(e.push(s.i,r.i,n.i),Ji(r),Ji(r.next),r=t=n),r=r.next}while(r!==t);return Os(r)}function Bk(t,e,r,s,n,i){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Wk(o,a)){let l=Ib(o,a);o=Os(o,o.next),l=Os(l,l.next),Qi(o,e,r,s,n,i,0),Qi(l,e,r,s,n,i,0);return}a=a.next}o=o.next}while(o!==t)}function zk(t,e,r,s){const n=[];for(let i=0,o=e.length;i<o;i++){const a=e[i]*s,l=i<o-1?e[i+1]*s:t.length,c=Tb(t,a,l,s,!1);c===c.next&&(c.steiner=!0),n.push(Gk(c))}n.sort(Dk);for(let i=0;i<n.length;i++)r=Lk(n[i],r);return r}function Dk(t,e){let r=t.x-e.x;if(r===0&&(r=t.y-e.y,r===0)){const s=(t.next.y-t.y)/(t.next.x-t.x),n=(e.next.y-e.y)/(e.next.x-e.x);r=s-n}return r}function Lk(t,e){const r=Fk(t,e);if(!r)return e;const s=Ib(r,t);return Os(s,s.next),Os(r,r.next)}function Fk(t,e){let r=e;const s=t.x,n=t.y;let i=-1/0,o;if(_n(t,r))return r;do{if(_n(t,r.next))return r.next;if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){const h=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=s&&h>i&&(i=h,o=r.x<r.next.x?r:r.next,h===s))return o}r=r.next}while(r!==e);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0;r=o;do{if(s>=r.x&&r.x>=l&&s!==r.x&&Rb(n<c?s:i,n,l,c,n<c?i:s,n,r.x,r.y)){const h=Math.abs(n-r.y)/(s-r.x);Xi(r,t)&&(h<u||h===u&&(r.x>o.x||r.x===o.x&&Uk(o,r)))&&(o=r,u=h)}r=r.next}while(r!==a);return o}function Uk(t,e){return Te(t.prev,t,e.prev)<0&&Te(e.next,t,t.next)<0}function $k(t,e,r,s){let n=t;do n.z===0&&(n.z=wh(n.x,n.y,e,r,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,Hk(n)}function Hk(t){let e,r=1;do{let s=t,n;t=null;let i=null;for(e=0;s;){e++;let o=s,a=0;for(let c=0;c<r&&(a++,o=o.nextZ,!!o);c++);let l=r;for(;a>0||l>0&&o;)a!==0&&(l===0||!o||s.z<=o.z)?(n=s,s=s.nextZ,a--):(n=o,o=o.nextZ,l--),i?i.nextZ=n:t=n,n.prevZ=i,i=n;s=o}i.nextZ=null,r*=2}while(e>1);return t}function wh(t,e,r,s,n){return t=(t-r)*n|0,e=(e-s)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Gk(t){let e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Rb(t,e,r,s,n,i,o,a){return(n-o)*(e-a)>=(t-o)*(i-a)&&(t-o)*(s-a)>=(r-o)*(e-a)&&(r-o)*(i-a)>=(n-o)*(s-a)}function _i(t,e,r,s,n,i,o,a){return!(t===o&&e===a)&&Rb(t,e,r,s,n,i,o,a)}function Wk(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Kk(t,e)&&(Xi(t,e)&&Xi(e,t)&&Yk(t,e)&&(Te(t.prev,t,e.prev)||Te(t,e.prev,e))||_n(t,e)&&Te(t.prev,t,t.next)>0&&Te(e.prev,e,e.next)>0)}function Te(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function _n(t,e){return t.x===e.x&&t.y===e.y}function Mb(t,e,r,s){const n=ha(Te(t,e,r)),i=ha(Te(t,e,s)),o=ha(Te(r,s,t)),a=ha(Te(r,s,e));return!!(n!==i&&o!==a||n===0&&ua(t,r,e)||i===0&&ua(t,s,e)||o===0&&ua(r,t,s)||a===0&&ua(r,e,s))}function ua(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function ha(t){return t>0?1:t<0?-1:0}function Kk(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Mb(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Xi(t,e){return Te(t.prev,t,t.next)<0?Te(t,e,t.next)>=0&&Te(t,t.prev,e)>=0:Te(t,e,t.prev)<0||Te(t,t.next,e)<0}function Yk(t,e){let r=t,s=!1;const n=(t.x+e.x)/2,i=(t.y+e.y)/2;do r.y>i!=r.next.y>i&&r.next.y!==r.y&&n<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(s=!s),r=r.next;while(r!==t);return s}function Ib(t,e){const r=Vh(t.i,t.x,t.y),s=Vh(e.i,e.x,e.y),n=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,s.next=r,r.prev=s,i.next=s,s.prev=i,s}function Om(t,e,r,s){const n=Vh(t,e,r);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function Ji(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Vh(t,e,r){return{i:t,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Qk(t,e,r,s){let n=0;for(let i=e,o=r-s;i<r;i+=s)n+=(t[o]-t[i])*(t[i+1]+t[o+1]),o=i;return n}const Xk=jm.default||jm,Nm=[{offset:0,color:"white"},{offset:1,color:"black"}],$d=class qh{constructor(...e){this.uid=$e("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let r=Jk(e);r={...r.type==="radial"?qh.defaultRadialOptions:qh.defaultLinearOptions,...$x(r)},this._textureSize=r.textureSize,this._wrapMode=r.wrapMode,r.type==="radial"?(this.center=r.center,this.outerCenter=r.outerCenter??this.center,this.innerRadius=r.innerRadius,this.outerRadius=r.outerRadius,this.scale=r.scale,this.rotation=r.rotation):(this.start=r.start,this.end=r.end),this.textureSpace=r.textureSpace,this.type=r.type,r.colorStops.forEach(n=>{this.addColorStop(n.offset,n.color)})}addColorStop(e,r){return this.colorStops.push({offset:e,color:Ve.shared.setValue(r).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:e,y:r}=this.start,{x:s,y:n}=this.end,i=s-e,o=n-r;const a=i<0||o<0;if(this._wrapMode==="clamp-to-edge"){if(i<0){const g=e;e=s,s=g,i*=-1}if(o<0){const g=r;r=n,n=g,o*=-1}}const l=this.colorStops.length?this.colorStops:Nm,c=this._textureSize,{canvas:u,context:h}=zm(c,1),d=a?h.createLinearGradient(this._textureSize,0,0,0):h.createLinearGradient(0,0,this._textureSize,0);Bm(d,l),h.fillStyle=d,h.fillRect(0,0,c,1),this.texture=new Ae({source:new ol({resource:u,addressMode:this._wrapMode})});const f=Math.sqrt(i*i+o*o),m=Math.atan2(o,i),y=new fe;y.scale(f/c,1),y.rotate(m),y.translate(e,r),this.textureSpace==="local"&&y.scale(c,c),this.transform=y}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const e=this.colorStops.length?this.colorStops:Nm,r=this._textureSize,{canvas:s,context:n}=zm(r,r),{x:i,y:o}=this.center,{x:a,y:l}=this.outerCenter,c=this.innerRadius,u=this.outerRadius,h=a-u,d=l-u,f=r/(u*2),m=(i-h)*f,y=(o-d)*f,g=n.createRadialGradient(m,y,c*f,(a-h)*f,(l-d)*f,u*f);Bm(g,e),n.fillStyle=e[e.length-1].color,n.fillRect(0,0,r,r),n.fillStyle=g,n.translate(m,y),n.rotate(this.rotation),n.scale(1,this.scale),n.translate(-m,-y),n.fillRect(0,0,r,r),this.texture=new Ae({source:new ol({resource:s,addressMode:this._wrapMode})});const A=new fe;A.scale(1/f,1/f),A.translate(h,d),this.textureSpace==="local"&&A.scale(r,r),this.transform=A}destroy(){this.texture?.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};$d.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};$d.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Po=$d;function Bm(t,e){for(let r=0;r<e.length;r++){const s=e[r];t.addColorStop(s.offset,s.color)}}function zm(t,e){const r=Co.get().createCanvas(t,e),s=r.getContext("2d");return{canvas:r,context:s}}function Jk(t){let e=t[0]??{};return(typeof e=="number"||t[1])&&(_e("8.5.2","use options object instead"),e={type:"linear",start:{x:t[0],y:t[1]},end:{x:t[2],y:t[3]},textureSpace:t[4],textureSize:t[5]??Po.defaultLinearOptions.textureSize}),e}const Dm={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Zk{constructor(e,r){this.uid=$e("fillPattern"),this._tick=0,this.transform=new fe,this.texture=e,this.transform.scale(1/e.frame.width,1/e.frame.height),r&&(e.source.style.addressModeU=Dm[r].addressModeU,e.source.style.addressModeV=Dm[r].addressModeV)}setTransform(e){const r=this.texture;this.transform.copyFrom(e),this.transform.invert(),this.transform.scale(1/r.frame.width,1/r.frame.height),this._tick++}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture=e,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}var tu,Lm;function eC(){if(Lm)return tu;Lm=1,tu=r;var t={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},e=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function r(i){var o=[];return i.replace(e,function(a,l,c){var u=l.toLowerCase();for(c=n(c),u=="m"&&c.length>2&&(o.push([l].concat(c.splice(0,2))),u="l",l=l=="m"?"l":"L");;){if(c.length==t[u])return c.unshift(l),o.push(c);if(c.length<t[u])throw new Error("malformed path data");o.push([l].concat(c.splice(0,t[u])))}}),o}var s=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function n(i){var o=i.match(s);return o?o.map(Number):[]}return tu}var tC=eC();const rC=nt(tC);function sC(t,e){const r=rC(t),s=[];let n=null,i=0,o=0;for(let a=0;a<r.length;a++){const l=r[a],c=l[0],u=l;switch(c){case"M":i=u[1],o=u[2],e.moveTo(i,o);break;case"m":i+=u[1],o+=u[2],e.moveTo(i,o);break;case"H":i=u[1],e.lineTo(i,o);break;case"h":i+=u[1],e.lineTo(i,o);break;case"V":o=u[1],e.lineTo(i,o);break;case"v":o+=u[1],e.lineTo(i,o);break;case"L":i=u[1],o=u[2],e.lineTo(i,o);break;case"l":i+=u[1],o+=u[2],e.lineTo(i,o);break;case"C":i=u[5],o=u[6],e.bezierCurveTo(u[1],u[2],u[3],u[4],i,o);break;case"c":e.bezierCurveTo(i+u[1],o+u[2],i+u[3],o+u[4],i+u[5],o+u[6]),i+=u[5],o+=u[6];break;case"S":i=u[3],o=u[4],e.bezierCurveToShort(u[1],u[2],i,o);break;case"s":e.bezierCurveToShort(i+u[1],o+u[2],i+u[3],o+u[4]),i+=u[3],o+=u[4];break;case"Q":i=u[3],o=u[4],e.quadraticCurveTo(u[1],u[2],i,o);break;case"q":e.quadraticCurveTo(i+u[1],o+u[2],i+u[3],o+u[4]),i+=u[3],o+=u[4];break;case"T":i=u[1],o=u[2],e.quadraticCurveToShort(i,o);break;case"t":i+=u[1],o+=u[2],e.quadraticCurveToShort(i,o);break;case"A":i=u[6],o=u[7],e.arcToSvg(u[1],u[2],u[3],u[4],u[5],i,o);break;case"a":i+=u[6],o+=u[7],e.arcToSvg(u[1],u[2],u[3],u[4],u[5],i,o);break;case"Z":case"z":e.closePath(),s.length>0&&(n=s.pop(),n?(i=n.startX,o=n.startY):(i=0,o=0)),n=null;break;default:Nt(`Unknown SVG path command: ${c}`)}c!=="Z"&&c!=="z"&&n===null&&(n={startX:i,startY:o},s.push(n))}return e}class Hd{constructor(e=0,r=0,s=0){this.type="circle",this.x=e,this.y=r,this.radius=s}clone(){return new Hd(this.x,this.y,this.radius)}contains(e,r){if(this.radius<=0)return!1;const s=this.radius*this.radius;let n=this.x-e,i=this.y-r;return n*=n,i*=i,n+i<=s}strokeContains(e,r,s,n=.5){if(this.radius===0)return!1;const i=this.x-e,o=this.y-r,a=this.radius,l=(1-n)*s,c=Math.sqrt(i*i+o*o);return c<=a+l&&c>a-(s-l)}getBounds(e){return e||(e=new Qe),e.x=this.x-this.radius,e.y=this.y-this.radius,e.width=this.radius*2,e.height=this.radius*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.radius=e.radius,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Gd{constructor(e=0,r=0,s=0,n=0){this.type="ellipse",this.x=e,this.y=r,this.halfWidth=s,this.halfHeight=n}clone(){return new Gd(this.x,this.y,this.halfWidth,this.halfHeight)}contains(e,r){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let s=(e-this.x)/this.halfWidth,n=(r-this.y)/this.halfHeight;return s*=s,n*=n,s+n<=1}strokeContains(e,r,s,n=.5){const{halfWidth:i,halfHeight:o}=this;if(i<=0||o<=0)return!1;const a=s*(1-n),l=s-a,c=i-l,u=o-l,h=i+a,d=o+a,f=e-this.x,m=r-this.y,y=f*f/(c*c)+m*m/(u*u),g=f*f/(h*h)+m*m/(d*d);return y>1&&g<=1}getBounds(e){return e||(e=new Qe),e.x=this.x-this.halfWidth,e.y=this.y-this.halfHeight,e.width=this.halfWidth*2,e.height=this.halfHeight*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.halfWidth=e.halfWidth,this.halfHeight=e.halfHeight,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function nC(t,e,r,s,n,i){const o=t-r,a=e-s,l=n-r,c=i-s,u=o*l+a*c,h=l*l+c*c;let d=-1;h!==0&&(d=u/h);let f,m;d<0?(f=r,m=s):d>1?(f=n,m=i):(f=r+d*l,m=s+d*c);const y=t-f,g=e-m;return y*y+g*g}let iC,oC;class Oi{constructor(...e){this.type="polygon";let r=Array.isArray(e[0])?e[0]:e;if(typeof r[0]!="number"){const s=[];for(let n=0,i=r.length;n<i;n++)s.push(r[n].x,r[n].y);r=s}this.points=r,this.closePath=!0}isClockwise(){let e=0;const r=this.points,s=r.length;for(let n=0;n<s;n+=2){const i=r[n],o=r[n+1],a=r[(n+2)%s],l=r[(n+3)%s];e+=(a-i)*(l+o)}return e<0}containsPolygon(e){const r=this.getBounds(iC),s=e.getBounds(oC);if(!r.containsRect(s))return!1;const n=e.points;for(let i=0;i<n.length;i+=2){const o=n[i],a=n[i+1];if(!this.contains(o,a))return!1}return!0}clone(){const e=this.points.slice(),r=new Oi(e);return r.closePath=this.closePath,r}contains(e,r){let s=!1;const n=this.points.length/2;for(let i=0,o=n-1;i<n;o=i++){const a=this.points[i*2],l=this.points[i*2+1],c=this.points[o*2],u=this.points[o*2+1];l>r!=u>r&&e<(c-a)*((r-l)/(u-l))+a&&(s=!s)}return s}strokeContains(e,r,s,n=.5){const i=s*s,o=i*(1-n),a=i-o,{points:l}=this,c=l.length-(this.closePath?0:2);for(let u=0;u<c;u+=2){const h=l[u],d=l[u+1],f=l[(u+2)%l.length],m=l[(u+3)%l.length],y=nC(e,r,h,d,f,m),g=Math.sign((f-h)*(r-d)-(m-d)*(e-h));if(y<=(g<0?a:o))return!0}return!1}getBounds(e){e||(e=new Qe);const r=this.points;let s=1/0,n=-1/0,i=1/0,o=-1/0;for(let a=0,l=r.length;a<l;a+=2){const c=r[a],u=r[a+1];s=c<s?c:s,n=c>n?c:n,i=u<i?u:i,o=u>o?u:o}return e.x=s,e.width=n-s,e.y=i,e.height=o-i,e}copyFrom(e){return this.points=e.points.slice(),this.closePath=e.closePath,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((e,r)=>`${e}, ${r}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return _e("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return _e("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const da=(t,e,r,s,n,i,o)=>{const a=t-r,l=e-s,c=Math.sqrt(a*a+l*l);return c>=n-i&&c<=n+o};class Wd{constructor(e=0,r=0,s=0,n=0,i=20){this.type="roundedRectangle",this.x=e,this.y=r,this.width=s,this.height=n,this.radius=i}getBounds(e){return e||(e=new Qe),e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}clone(){return new Wd(this.x,this.y,this.width,this.height,this.radius)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,r){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&r>=this.y&&r<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(r>=this.y+s&&r<=this.y+this.height-s||e>=this.x+s&&e<=this.x+this.width-s)return!0;let n=e-(this.x+s),i=r-(this.y+s);const o=s*s;if(n*n+i*i<=o||(n=e-(this.x+this.width-s),n*n+i*i<=o)||(i=r-(this.y+this.height-s),n*n+i*i<=o)||(n=e-(this.x+s),n*n+i*i<=o))return!0}return!1}strokeContains(e,r,s,n=.5){const{x:i,y:o,width:a,height:l,radius:c}=this,u=s*(1-n),h=s-u,d=i+c,f=o+c,m=a-c*2,y=l-c*2,g=i+a,A=o+l;return(e>=i-u&&e<=i+h||e>=g-h&&e<=g+u)&&r>=f&&r<=f+y||(r>=o-u&&r<=o+h||r>=A-h&&r<=A+u)&&e>=d&&e<=d+m?!0:e<d&&r<f&&da(e,r,d,f,c,h,u)||e>g-c&&r<f&&da(e,r,g-c,f,c,h,u)||e>g-c&&r>A-c&&da(e,r,g-c,A-c,c,h,u)||e<d&&r>A-c&&da(e,r,d,A-c,c,h,u)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const jb={};function aC(t,e,r){let s=2166136261;for(let n=0;n<e;n++)s^=t[n].uid,s=Math.imul(s,16777619),s>>>=0;return jb[s]||lC(t,e,s,r)}function lC(t,e,r,s){const n={};let i=0;for(let a=0;a<s;a++){const l=a<e?t[a]:Ae.EMPTY.source;n[i++]=l.source,n[i++]=l.style}const o=new Fa(n);return jb[r]=o,o}class Fm{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this.uint32View=null,this.float32View=null,this.uint16View=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._int32View=null,this._float64Array=null,this._bigUint64Array=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}function Um(t,e){const r=t.byteLength/8|0,s=new Float64Array(t,0,r);new Float64Array(e,0,r).set(s);const i=t.byteLength-r*8;if(i>0){const o=new Uint8Array(t,r*8,i);new Uint8Array(e,r*8,i).set(o)}}const cC={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var uC=(t=>(t[t.DISABLED=0]="DISABLED",t[t.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",t[t.MASK_ACTIVE=2]="MASK_ACTIVE",t[t.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",t[t.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",t[t.NONE=5]="NONE",t))(uC||{});function $m(t,e){return e.alphaMode==="no-premultiply-alpha"&&cC[t]||t}const hC=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function dC(t){let e="";for(let r=0;r<t;++r)r>0&&(e+=`
else `),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}function fC(t,e){if(t===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);try{for(;;){const s=hC.replace(/%forloop%/gi,dC(t));if(e.shaderSource(r,s),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))t=t/2|0;else break}}finally{e.deleteShader(r)}return t}let Fs=null;function pC(){if(Fs)return Fs;const t=qb();return Fs=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Fs=fC(Fs,t),t.getExtension("WEBGL_lose_context")?.loseContext(),Fs}class mC{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let e=0;e<this.count;e++){const r=this.textures[e];this.textures[e]=null,this.ids[r.uid]=null}this.count=0}}class gC{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new mC,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const Ni=[];let ll=0;Ld.register({clear:()=>{if(Ni.length>0)for(const t of Ni)t&&t.destroy();Ni.length=0,ll=0}});function Hm(){return ll>0?Ni[--ll]:new gC}function Gm(t){Ni[ll++]=t}let li=0;const Ob=class Nb{constructor(e){this.uid=$e("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],e={...Nb.defaultOptions,...e},e.maxTextures||(_e("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),e.maxTextures=pC());const{maxTextures:r,attributesInitialSize:s,indicesInitialSize:n}=e;this.attributeBuffer=new Fm(s*4),this.indexBuffer=new Uint16Array(n),this.maxTextures=r}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let e=0;e<this.batchIndex;e++)Gm(this.batches[e]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(e){this._elements[this.elementSize++]=e,e._indexStart=this.indexSize,e._attributeStart=this.attributeSize,e._batcher=this,this.indexSize+=e.indexSize,this.attributeSize+=e.attributeSize*this.vertexSize}checkAndUpdateTexture(e,r){const s=e._batch.textures.ids[r._source.uid];return!s&&s!==0?!1:(e._textureId=s,e.texture=r,!0)}updateElement(e){this.dirty=!0;const r=this.attributeBuffer;e.packAsQuad?this.packQuadAttributes(e,r.float32View,r.uint32View,e._attributeStart,e._textureId):this.packAttributes(e,r.float32View,r.uint32View,e._attributeStart,e._textureId)}break(e){const r=this._elements;if(!r[this.elementStart])return;let s=Hm(),n=s.textures;n.clear();const i=r[this.elementStart];let o=$m(i.blendMode,i.texture._source),a=i.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const l=this.attributeBuffer.float32View,c=this.attributeBuffer.uint32View,u=this.indexBuffer;let h=this._batchIndexSize,d=this._batchIndexStart,f="startBatch";const m=this.maxTextures;for(let y=this.elementStart;y<this.elementSize;++y){const g=r[y];r[y]=null;const b=g.texture._source,x=$m(g.blendMode,b),w=o!==x||a!==g.topology;if(b._batchTick===li&&!w){g._textureId=b._textureBindLocation,h+=g.indexSize,g.packAsQuad?(this.packQuadAttributes(g,l,c,g._attributeStart,g._textureId),this.packQuadIndex(u,g._indexStart,g._attributeStart/this.vertexSize)):(this.packAttributes(g,l,c,g._attributeStart,g._textureId),this.packIndex(g,u,g._indexStart,g._attributeStart/this.vertexSize)),g._batch=s;continue}b._batchTick=li,(n.count>=m||w)&&(this._finishBatch(s,d,h-d,n,o,a,e,f),f="renderBatch",d=h,o=x,a=g.topology,s=Hm(),n=s.textures,n.clear(),++li),g._textureId=b._textureBindLocation=n.count,n.ids[b.uid]=n.count,n.textures[n.count++]=b,g._batch=s,h+=g.indexSize,g.packAsQuad?(this.packQuadAttributes(g,l,c,g._attributeStart,g._textureId),this.packQuadIndex(u,g._indexStart,g._attributeStart/this.vertexSize)):(this.packAttributes(g,l,c,g._attributeStart,g._textureId),this.packIndex(g,u,g._indexStart,g._attributeStart/this.vertexSize))}n.count>0&&(this._finishBatch(s,d,h-d,n,o,a,e,f),d=h,++li),this.elementStart=this.elementSize,this._batchIndexStart=d,this._batchIndexSize=h}_finishBatch(e,r,s,n,i,o,a,l){e.gpuBindGroup=null,e.bindGroup=null,e.action=l,e.batcher=this,e.textures=n,e.blendMode=i,e.topology=o,e.start=r,e.size=s,++li,this.batches[this.batchIndex++]=e,a.add(e)}finish(e){this.break(e)}ensureAttributeBuffer(e){e*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(e*4)}ensureIndexBuffer(e){e<=this.indexBuffer.length||this._resizeIndexBuffer(e)}_resizeAttributeBuffer(e){const r=Math.max(e,this.attributeBuffer.size*2),s=new Fm(r);Um(this.attributeBuffer.rawBinaryData,s.rawBinaryData),this.attributeBuffer=s}_resizeIndexBuffer(e){const r=this.indexBuffer;let s=Math.max(e,r.length*1.5);s+=s%2;const n=s>65535?new Uint32Array(s):new Uint16Array(s);if(n.BYTES_PER_ELEMENT!==r.BYTES_PER_ELEMENT)for(let i=0;i<r.length;i++)n[i]=r[i];else Um(r.buffer,n.buffer);this.indexBuffer=n}packQuadIndex(e,r,s){e[r]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+3]=s+0,e[r+4]=s+2,e[r+5]=s+3}packIndex(e,r,s,n){const i=e.indices,o=e.indexSize,a=e.indexOffset,l=e.attributeOffset;for(let c=0;c<o;c++)r[s++]=n+i[c+a]-l}destroy(e={}){if(this.batches!==null){for(let r=0;r<this.batchIndex;r++)Gm(this.batches[r]);this.batches=null,this.geometry.destroy(!0),this.geometry=null,e.shader&&(this.shader?.destroy(),this.shader=null);for(let r=0;r<this._elements.length;r++)this._elements[r]&&(this._elements[r]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};Ob.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let yC=Ob;var St=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(St||{});let Zi=class extends is{constructor(e){let{data:r,size:s}=e;const{usage:n,label:i,shrinkToFit:o}=e;super(),this._gpuData=Object.create(null),this._gcLastUsed=-1,this.autoGarbageCollect=!0,this.uid=$e("buffer"),this._resourceType="buffer",this._resourceId=$e("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,r instanceof Array&&(r=new Float32Array(r)),this._data=r,s??(s=r?.byteLength);const a=!!r;this.descriptor={size:s,usage:n,mappedAtCreation:a,label:i},this.shrinkToFit=o??!0}get data(){return this._data}set data(e){this.setDataWithSize(e,e.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&St.STATIC)}set static(e){e?this.descriptor.usage|=St.STATIC:this.descriptor.usage&=~St.STATIC}setDataWithSize(e,r,s){if(this._updateID++,this._updateSize=r*e.BYTES_PER_ELEMENT,this._data===e){s&&this.emit("update",this);return}const n=this._data;if(this._data=e,this._dataInt32=null,!n||n.length!==e.length){!this.shrinkToFit&&n&&e.byteLength<n.byteLength?s&&this.emit("update",this):(this.descriptor.size=e.byteLength,this._resourceId=$e("resource"),this.emit("change",this));return}s&&this.emit("update",this)}update(e){this._updateSize=e??this._updateSize,this._updateID++,this.emit("update",this)}unload(){this.emit("unload",this);for(const e in this._gpuData)this._gpuData[e]?.destroy();this._gpuData=Object.create(null)}destroy(){this.destroyed=!0,this.unload(),this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}};function Bb(t,e){if(!(t instanceof Zi)){let r=e?St.INDEX:St.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),r=St.INDEX|St.COPY_DST):(t=new Float32Array(t),r=St.VERTEX|St.COPY_DST)),t=new Zi({data:t,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:r})}return t}function AC(t,e,r){const s=t.getAttribute(e);if(!s)return r.minX=0,r.minY=0,r.maxX=0,r.maxY=0,r;const n=s.buffer.data;let i=1/0,o=1/0,a=-1/0,l=-1/0;const c=n.BYTES_PER_ELEMENT,u=(s.offset||0)/c,h=(s.stride||8)/c;for(let d=u;d<n.length;d+=h){const f=n[d],m=n[d+1];f>a&&(a=f),m>l&&(l=m),f<i&&(i=f),m<o&&(o=m)}return r.minX=i,r.minY=o,r.maxX=a,r.maxY=l,r}function xC(t){return(t instanceof Zi||Array.isArray(t)||t.BYTES_PER_ELEMENT)&&(t={buffer:t}),t.buffer=Bb(t.buffer,!1),t}class bC extends is{constructor(e={}){super(),this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this.uid=$e("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new nr,this._boundsDirty=!0;const{attributes:r,indexBuffer:s,topology:n}=e;if(this.buffers=[],this.attributes={},r)for(const i in r)this.addAttribute(i,r[i]);this.instanceCount=e.instanceCount??1,s&&this.addIndex(s),this.topology=n||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(e){return this.attributes[e]}getIndex(){return this.indexBuffer}getBuffer(e){return this.getAttribute(e).buffer}getSize(){for(const e in this.attributes){const r=this.attributes[e];return r.buffer.data.length/(r.stride/4||r.size)}return 0}addAttribute(e,r){const s=xC(r);this.buffers.indexOf(s.buffer)===-1&&(this.buffers.push(s.buffer),s.buffer.on("update",this.onBufferUpdate,this),s.buffer.on("change",this.onBufferUpdate,this)),this.attributes[e]=s}addIndex(e){this.indexBuffer=Bb(e,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,AC(this,"aPosition",this._bounds)):this._bounds}unload(){this.emit("unload",this);for(const e in this._gpuData)this._gpuData[e]?.destroy();this._gpuData=Object.create(null)}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners(),e&&this.buffers.forEach(r=>r.destroy()),this.unload(),this.indexBuffer?.destroy(),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const wC=new Float32Array(1),VC=new Uint32Array(1);class qC extends bC{constructor(){const r=new Zi({data:wC,label:"attribute-batch-buffer",usage:St.VERTEX|St.COPY_DST,shrinkToFit:!1}),s=new Zi({data:VC,label:"index-batch-buffer",usage:St.INDEX|St.COPY_DST,shrinkToFit:!1}),n=24;super({attributes:{aPosition:{buffer:r,format:"float32x2",stride:n,offset:0},aUV:{buffer:r,format:"float32x2",stride:n,offset:8},aColor:{buffer:r,format:"unorm8x4",stride:n,offset:16},aTextureIdAndRound:{buffer:r,format:"uint16x2",stride:n,offset:20}},indexBuffer:s})}}function Wm(t,e,r){if(t)for(const s in t){const n=s.toLocaleLowerCase(),i=e[n];if(i){let o=t[s];s==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),r&&i.push(`//----${r}----//`),i.push(o)}else Nt(`${s} placement hook does not exist in shader`)}}const vC=/\{\{(.*?)\}\}/g;function Km(t){const e={};return(t.match(vC)?.map(s=>s.replace(/[{()}]/g,""))??[]).forEach(s=>{e[s]=[]}),e}function Ym(t,e){let r;const s=/@in\s+([^;]+);/g;for(;(r=s.exec(t))!==null;)e.push(r[1])}function Qm(t,e,r=!1){const s=[];Ym(e,s),t.forEach(a=>{a.header&&Ym(a.header,s)});const n=s;r&&n.sort();const i=n.map((a,l)=>`       @location(${l}) ${a},`).join(`
`);let o=e.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${i}
`),o}function Xm(t,e){let r;const s=/@out\s+([^;]+);/g;for(;(r=s.exec(t))!==null;)e.push(r[1])}function _C(t){const r=/\b(\w+)\s*:/g.exec(t);return r?r[1]:""}function SC(t){const e=/@.*?\s+/g;return t.replace(e,"")}function kC(t,e){const r=[];Xm(e,r),t.forEach(l=>{l.header&&Xm(l.header,r)});let s=0;const n=r.sort().map(l=>l.indexOf("builtin")>-1?l:`@location(${s++}) ${l}`).join(`,
`),i=r.sort().map(l=>`       var ${SC(l)};`).join(`
`),o=`return VSOutput(
            ${r.sort().map(l=>` ${_C(l)}`).join(`,
`)});`;let a=e.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`
${n}
`),a=a.replace("{{start}}",`
${i}
`),a=a.replace("{{return}}",`
${o}
`),a}function Jm(t,e){let r=t;for(const s in e){const n=e[s];n.join(`
`).length?r=r.replace(`{{${s}}}`,`//-----${s} START-----//
${n.join(`
`)}
//----${s} FINISH----//`):r=r.replace(`{{${s}}}`,"")}return r}const Hr=Object.create(null),ru=new Map;let CC=0;function EC({template:t,bits:e}){const r=zb(t,e);if(Hr[r])return Hr[r];const{vertex:s,fragment:n}=TC(t,e);return Hr[r]=Db(s,n,e),Hr[r]}function PC({template:t,bits:e}){const r=zb(t,e);return Hr[r]||(Hr[r]=Db(t.vertex,t.fragment,e)),Hr[r]}function TC(t,e){const r=e.map(o=>o.vertex).filter(o=>!!o),s=e.map(o=>o.fragment).filter(o=>!!o);let n=Qm(r,t.vertex,!0);n=kC(r,n);const i=Qm(s,t.fragment,!0);return{vertex:n,fragment:i}}function zb(t,e){return e.map(r=>(ru.has(r)||ru.set(r,CC++),ru.get(r))).sort((r,s)=>r-s).join("-")+t.vertex+t.fragment}function Db(t,e,r){const s=Km(t),n=Km(e);return r.forEach(i=>{Wm(i.vertex,s,i.name),Wm(i.fragment,n,i.name)}),{vertex:Jm(t,s),fragment:Jm(e,n)}}const RC=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,MC=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,IC=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,jC=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,OC={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},NC={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function BC({bits:t,name:e}){const r=EC({template:{fragment:MC,vertex:RC},bits:[OC,...t]});return Eo.from({name:e,vertex:{source:r.vertex,entryPoint:"main"},fragment:{source:r.fragment,entryPoint:"main"}})}function zC({bits:t,name:e}){return new Ll({name:e,...PC({template:{vertex:IC,fragment:jC},bits:[NC,...t]})})}const DC={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},LC={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},su={};function FC(t){const e=[];if(t===1)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let r=0;for(let s=0;s<t;s++)e.push(`@group(1) @binding(${r++}) var textureSource${s+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${r++}) var textureSampler${s+1}: sampler;`)}return e.join(`
`)}function UC(t){const e=[];if(t===1)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let r=0;r<t;r++)r===t-1?e.push("  default:{"):e.push(`  case ${r}:{`),e.push(`      outColor = textureSampleGrad(textureSource${r+1}, textureSampler${r+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join(`
`)}function $C(t){return su[t]||(su[t]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${FC(t)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${UC(t)}
            `}}),su[t]}const nu={};function HC(t){const e=[];for(let r=0;r<t;r++)r>0&&e.push("else"),r<t-1&&e.push(`if(vTextureId < ${r}.5)`),e.push("{"),e.push(`	outColor = texture(uTextures[${r}], vUV);`),e.push("}");return e.join(`
`)}function GC(t){return nu[t]||(nu[t]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${t}];

            `,main:`

                ${HC(t)}
            `}}),nu[t]}const WC={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},KC={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Zm={};function YC(t){let e=Zm[t];if(e)return e;const r=new Int32Array(t);for(let s=0;s<t;s++)r[s]=s;return e=Zm[t]=new Cb({uTextures:{value:r,type:"i32",size:t}},{isStatic:!0}),e}class eg extends Fl{constructor(e){const r=zC({name:"batch",bits:[LC,GC(e),KC]}),s=BC({name:"batch",bits:[DC,$C(e),WC]});super({glProgram:r,gpuProgram:s,resources:{batchSamplers:YC(e)}}),this.maxTextures=e}}let ci=null;const Lb=class Fb extends yC{constructor(e){super(e),this.geometry=new qC,this.name=Fb.extension.name,this.vertexSize=6,ci??(ci=new eg(e.maxTextures)),this.shader=ci}packAttributes(e,r,s,n,i){const o=i<<16|e.roundPixels&65535,a=e.transform,l=a.a,c=a.b,u=a.c,h=a.d,d=a.tx,f=a.ty,{positions:m,uvs:y}=e,g=e.color,A=e.attributeOffset,b=A+e.attributeSize;for(let x=A;x<b;x++){const w=x*2,q=m[w],_=m[w+1];r[n++]=l*q+u*_+d,r[n++]=h*_+c*q+f,r[n++]=y[w],r[n++]=y[w+1],s[n++]=g,s[n++]=o}}packQuadAttributes(e,r,s,n,i){const o=e.texture,a=e.transform,l=a.a,c=a.b,u=a.c,h=a.d,d=a.tx,f=a.ty,m=e.bounds,y=m.maxX,g=m.minX,A=m.maxY,b=m.minY,x=o.uvs,w=e.color,q=i<<16|e.roundPixels&65535;r[n+0]=l*g+u*b+d,r[n+1]=h*b+c*g+f,r[n+2]=x.x0,r[n+3]=x.y0,s[n+4]=w,s[n+5]=q,r[n+6]=l*y+u*b+d,r[n+7]=h*b+c*y+f,r[n+8]=x.x1,r[n+9]=x.y1,s[n+10]=w,s[n+11]=q,r[n+12]=l*y+u*A+d,r[n+13]=h*A+c*y+f,r[n+14]=x.x2,r[n+15]=x.y2,s[n+16]=w,s[n+17]=q,r[n+18]=l*g+u*A+d,r[n+19]=h*A+c*g+f,r[n+20]=x.x3,r[n+21]=x.y3,s[n+22]=w,s[n+23]=q}_updateMaxTextures(e){this.shader.maxTextures!==e&&(ci=new eg(e),this.shader=ci)}destroy(){this.shader=null,super.destroy()}};Lb.extension={type:[Pe.Batcher],name:"default"};let QC=Lb;class XC{constructor(e){this.items=Object.create(null);const{renderer:r,type:s,onUnload:n,priority:i,name:o}=e;this._renderer=r,r.gc.addResourceHash(this,"items",s,i??0),this._onUnload=n,this.name=o}add(e){return this.items[e.uid]?!1:(this.items[e.uid]=e,e.once("unload",this.remove,this),e._gcLastUsed=this._renderer.gc.now,!0)}remove(e,...r){if(!this.items[e.uid])return;const s=e._gpuData[this._renderer.uid];s&&(this._onUnload?.(e,...r),s.destroy(),e._gpuData[this._renderer.uid]=null,this.items[e.uid]=null)}removeAll(...e){Object.values(this.items).forEach(r=>r&&this.remove(r,...e))}destroy(...e){this.removeAll(...e),this.items=Object.create(null),this._renderer=null,this._onUnload=null}}function JC(t,e,r,s,n,i,o,a=null){let l=0;r*=e,n*=i;const c=a.a,u=a.b,h=a.c,d=a.d,f=a.tx,m=a.ty;for(;l<o;){const y=t[r],g=t[r+1];s[n]=c*y+h*g+f,s[n+1]=u*y+d*g+m,n+=i,r+=e,l++}}function ZC(t,e,r,s){let n=0;for(e*=r;n<s;)t[e]=0,t[e+1]=0,e+=r,n++}function Ub(t,e,r,s,n){const i=e.a,o=e.b,a=e.c,l=e.d,c=e.tx,u=e.ty;r||(r=0),s||(s=2),n||(n=t.length/s-r);let h=r*s;for(let d=0;d<n;d++){const f=t[h],m=t[h+1];t[h]=i*f+a*m+c,t[h+1]=o*f+l*m+u,h+=s}}const e1=new fe;class $b{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const e=this.baseColor,r=e>>16|e&65280|(e&255)<<16,s=this.renderable;return s?tb(r,s.groupColor)+(this.alpha*s.groupAlpha*255<<24):r+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||e1}copyTo(e){e.indexOffset=this.indexOffset,e.indexSize=this.indexSize,e.attributeOffset=this.attributeOffset,e.attributeSize=this.attributeSize,e.baseColor=this.baseColor,e.alpha=this.alpha,e.texture=this.texture,e.geometryData=this.geometryData,e.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const eo={extension:{type:Pe.ShapeBuilder,name:"circle"},build(t,e){let r,s,n,i,o,a;if(t.type==="circle"){const w=t;if(o=a=w.radius,o<=0)return!1;r=w.x,s=w.y,n=i=0}else if(t.type==="ellipse"){const w=t;if(o=w.halfWidth,a=w.halfHeight,o<=0||a<=0)return!1;r=w.x,s=w.y,n=i=0}else{const w=t,q=w.width/2,_=w.height/2;r=w.x+q,s=w.y+_,o=a=Math.max(0,Math.min(w.radius,Math.min(q,_))),n=q-o,i=_-a}if(n<0||i<0)return!1;const l=Math.ceil(2.3*Math.sqrt(o+a)),c=l*8+(n?4:0)+(i?4:0);if(c===0)return!1;if(l===0)return e[0]=e[6]=r+n,e[1]=e[3]=s+i,e[2]=e[4]=r-n,e[5]=e[7]=s-i,!0;let u=0,h=l*4+(n?2:0)+2,d=h,f=c,m=n+o,y=i,g=r+m,A=r-m,b=s+y;if(e[u++]=g,e[u++]=b,e[--h]=b,e[--h]=A,i){const w=s-y;e[d++]=A,e[d++]=w,e[--f]=w,e[--f]=g}for(let w=1;w<l;w++){const q=Math.PI/2*(w/l),_=n+Math.cos(q)*o,V=i+Math.sin(q)*a,S=r+_,k=r-_,C=s+V,E=s-V;e[u++]=S,e[u++]=C,e[--h]=C,e[--h]=k,e[d++]=k,e[d++]=E,e[--f]=E,e[--f]=S}m=n,y=i+a,g=r+m,A=r-m,b=s+y;const x=s-y;return e[u++]=g,e[u++]=b,e[--f]=x,e[--f]=g,n&&(e[u++]=A,e[u++]=b,e[--f]=x,e[--f]=A),!0},triangulate(t,e,r,s,n,i){if(t.length===0)return;let o=0,a=0;for(let u=0;u<t.length;u+=2)o+=t[u],a+=t[u+1];o/=t.length/2,a/=t.length/2;let l=s;e[l*r]=o,e[l*r+1]=a;const c=l++;for(let u=0;u<t.length;u+=2)e[l*r]=t[u],e[l*r+1]=t[u+1],u>0&&(n[i++]=l,n[i++]=c,n[i++]=l-1),l++;n[i++]=c+1,n[i++]=c,n[i++]=l-1}},t1={...eo,extension:{...eo.extension,name:"ellipse"}},r1={...eo,extension:{...eo.extension,name:"roundedRectangle"}},Hb=1e-4,tg=1e-4;function s1(t){const e=t.length;if(e<6)return 1;let r=0;for(let s=0,n=t[e-2],i=t[e-1];s<e;s+=2){const o=t[s],a=t[s+1];r+=(o-n)*(a+i),n=o,i=a}return r<0?-1:1}function rg(t,e,r,s,n,i,o,a){const l=t-r*n,c=e-s*n,u=t+r*i,h=e+s*i;let d,f;o?(d=s,f=-r):(d=-s,f=r);const m=l+d,y=c+f,g=u+d,A=h+f;return a.push(m,y),a.push(g,A),2}function as(t,e,r,s,n,i,o,a){const l=r-t,c=s-e;let u=Math.atan2(l,c),h=Math.atan2(n-t,i-e);a&&u<h?u+=Math.PI*2:!a&&u>h&&(h+=Math.PI*2);let d=u;const f=h-u,m=Math.abs(f),y=Math.sqrt(l*l+c*c),g=(15*m*Math.sqrt(y)/Math.PI>>0)+1,A=f/g;if(d+=A,a){o.push(t,e),o.push(r,s);for(let b=1,x=d;b<g;b++,x+=A)o.push(t,e),o.push(t+Math.sin(x)*y,e+Math.cos(x)*y);o.push(t,e),o.push(n,i)}else{o.push(r,s),o.push(t,e);for(let b=1,x=d;b<g;b++,x+=A)o.push(t+Math.sin(x)*y,e+Math.cos(x)*y),o.push(t,e);o.push(n,i),o.push(t,e)}return g*2}function n1(t,e,r,s,n,i){const o=Hb;if(t.length===0)return;const a=e;let l=a.alignment;if(e.alignment!==.5){let L=s1(t);l=(l-.5)*L+.5}const c=new dt(t[0],t[1]),u=new dt(t[t.length-2],t[t.length-1]),h=s,d=Math.abs(c.x-u.x)<o&&Math.abs(c.y-u.y)<o;if(h){t=t.slice(),d&&(t.pop(),t.pop(),u.set(t[t.length-2],t[t.length-1]));const L=(c.x+u.x)*.5,Q=(u.y+c.y)*.5;t.unshift(L,Q),t.push(L,Q)}const f=n,m=t.length/2;let y=t.length;const g=f.length/2,A=a.width/2,b=A*A,x=a.miterLimit*a.miterLimit;let w=t[0],q=t[1],_=t[2],V=t[3],S=0,k=0,C=-(q-V),E=w-_,T=0,R=0,I=Math.sqrt(C*C+E*E);C/=I,E/=I,C*=A,E*=A;const z=l,P=(1-z)*2,M=z*2;h||(a.cap==="round"?y+=as(w-C*(P-M)*.5,q-E*(P-M)*.5,w-C*P,q-E*P,w+C*M,q+E*M,f,!0)+2:a.cap==="square"&&(y+=rg(w,q,C,E,P,M,!0,f))),f.push(w-C*P,q-E*P),f.push(w+C*M,q+E*M);for(let L=1;L<m-1;++L){w=t[(L-1)*2],q=t[(L-1)*2+1],_=t[L*2],V=t[L*2+1],S=t[(L+1)*2],k=t[(L+1)*2+1],C=-(q-V),E=w-_,I=Math.sqrt(C*C+E*E),C/=I,E/=I,C*=A,E*=A,T=-(V-k),R=_-S,I=Math.sqrt(T*T+R*R),T/=I,R/=I,T*=A,R*=A;const Q=_-w,ge=q-V,oe=_-S,se=k-V,ye=Q*oe+ge*se,ae=ge*oe-se*Q,ue=ae<0;if(Math.abs(ae)<.001*Math.abs(ye)){f.push(_-C*P,V-E*P),f.push(_+C*M,V+E*M),ye>=0&&(a.join==="round"?y+=as(_,V,_-C*P,V-E*P,_-T*P,V-R*P,f,!1)+4:y+=2,f.push(_-T*M,V-R*M),f.push(_+T*P,V+R*P));continue}const Fe=(-C+w)*(-E+V)-(-C+_)*(-E+q),ar=(-T+S)*(-R+V)-(-T+_)*(-R+k),Vt=(Q*ar-oe*Fe)/ae,Qt=(se*Fe-ge*ar)/ae,br=(Vt-_)*(Vt-_)+(Qt-V)*(Qt-V),Et=_+(Vt-_)*P,qt=V+(Qt-V)*P,lr=_-(Vt-_)*M,wr=V-(Qt-V)*M,Vq=Math.min(Q*Q+ge*ge,oe*oe+se*se),Wf=ue?P:M,qq=Vq+Wf*Wf*b;br<=qq?a.join==="bevel"||br/b>x?(ue?(f.push(Et,qt),f.push(_+C*M,V+E*M),f.push(Et,qt),f.push(_+T*M,V+R*M)):(f.push(_-C*P,V-E*P),f.push(lr,wr),f.push(_-T*P,V-R*P),f.push(lr,wr)),y+=2):a.join==="round"?ue?(f.push(Et,qt),f.push(_+C*M,V+E*M),y+=as(_,V,_+C*M,V+E*M,_+T*M,V+R*M,f,!0)+4,f.push(Et,qt),f.push(_+T*M,V+R*M)):(f.push(_-C*P,V-E*P),f.push(lr,wr),y+=as(_,V,_-C*P,V-E*P,_-T*P,V-R*P,f,!1)+4,f.push(_-T*P,V-R*P),f.push(lr,wr)):(f.push(Et,qt),f.push(lr,wr)):(f.push(_-C*P,V-E*P),f.push(_+C*M,V+E*M),a.join==="round"?ue?y+=as(_,V,_+C*M,V+E*M,_+T*M,V+R*M,f,!0)+2:y+=as(_,V,_-C*P,V-E*P,_-T*P,V-R*P,f,!1)+2:a.join==="miter"&&br/b<=x&&(ue?(f.push(lr,wr),f.push(lr,wr)):(f.push(Et,qt),f.push(Et,qt)),y+=2),f.push(_-T*P,V-R*P),f.push(_+T*M,V+R*M),y+=2)}w=t[(m-2)*2],q=t[(m-2)*2+1],_=t[(m-1)*2],V=t[(m-1)*2+1],C=-(q-V),E=w-_,I=Math.sqrt(C*C+E*E),C/=I,E/=I,C*=A,E*=A,f.push(_-C*P,V-E*P),f.push(_+C*M,V+E*M),h||(a.cap==="round"?y+=as(_-C*(P-M)*.5,V-E*(P-M)*.5,_-C*P,V-E*P,_+C*M,V+E*M,f,!1)+2:a.cap==="square"&&(y+=rg(_,V,C,E,P,M,!1,f)));const D=tg*tg;for(let L=g;L<y+g-2;++L)w=f[L*2],q=f[L*2+1],_=f[(L+1)*2],V=f[(L+1)*2+1],S=f[(L+2)*2],k=f[(L+2)*2+1],!(Math.abs(w*(V-k)+_*(k-q)+S*(q-V))<D)&&i.push(L,L+1,L+2)}function i1(t,e,r,s){const n=Hb;if(t.length===0)return;const i=t[0],o=t[1],a=t[t.length-2],l=t[t.length-1],c=e||Math.abs(i-a)<n&&Math.abs(o-l)<n,u=r,h=t.length/2,d=u.length/2;for(let f=0;f<h;f++)u.push(t[f*2]),u.push(t[f*2+1]);for(let f=0;f<h-1;f++)s.push(d+f,d+f+1);c&&s.push(d+h-1,d)}function Gb(t,e,r,s,n,i,o){const a=Xk(t,e,2);if(!a)return;for(let c=0;c<a.length;c+=3)i[o++]=a[c]+n,i[o++]=a[c+1]+n,i[o++]=a[c+2]+n;let l=n*s;for(let c=0;c<t.length;c+=2)r[l]=t[c],r[l+1]=t[c+1],l+=s}const o1=[],a1={extension:{type:Pe.ShapeBuilder,name:"polygon"},build(t,e){for(let r=0;r<t.points.length;r++)e[r]=t.points[r];return!0},triangulate(t,e,r,s,n,i){Gb(t,o1,e,r,s,n,i)}},l1={extension:{type:Pe.ShapeBuilder,name:"rectangle"},build(t,e){const r=t,s=r.x,n=r.y,i=r.width,o=r.height;return i>0&&o>0?(e[0]=s,e[1]=n,e[2]=s+i,e[3]=n,e[4]=s+i,e[5]=n+o,e[6]=s,e[7]=n+o,!0):!1},triangulate(t,e,r,s,n,i){let o=0;s*=r,e[s+o]=t[0],e[s+o+1]=t[1],o+=r,e[s+o]=t[2],e[s+o+1]=t[3],o+=r,e[s+o]=t[6],e[s+o+1]=t[7],o+=r,e[s+o]=t[4],e[s+o+1]=t[5],o+=r;const a=s/r;n[i++]=a,n[i++]=a+1,n[i++]=a+2,n[i++]=a+1,n[i++]=a+3,n[i++]=a+2}},c1={extension:{type:Pe.ShapeBuilder,name:"triangle"},build(t,e){return e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,!0},triangulate(t,e,r,s,n,i){let o=0;s*=r,e[s+o]=t[0],e[s+o+1]=t[1],o+=r,e[s+o]=t[2],e[s+o+1]=t[3],o+=r,e[s+o]=t[4],e[s+o+1]=t[5];const a=s/r;n[i++]=a,n[i++]=a+1,n[i++]=a+2}},u1=new fe,h1=new Qe;function d1(t,e,r,s){const n=e.matrix?t.copyFrom(e.matrix).invert():t.identity();if(e.textureSpace==="local"){const o=r.getBounds(h1);e.width&&o.pad(e.width);const{x:a,y:l}=o,c=1/o.width,u=1/o.height,h=-a*c,d=-l*u,f=n.a,m=n.b,y=n.c,g=n.d;n.a*=c,n.b*=c,n.c*=u,n.d*=u,n.tx=h*f+d*y+n.tx,n.ty=h*m+d*g+n.ty}else n.translate(e.texture.frame.x,e.texture.frame.y),n.scale(1/e.texture.source.width,1/e.texture.source.height);const i=e.texture.source.style;return!(e.fill instanceof Po)&&i.addressMode==="clamp-to-edge"&&(i.addressMode="repeat",i.update()),s&&n.append(u1.copyFrom(s).invert()),n}const Ul={};Br.handleByMap(Pe.ShapeBuilder,Ul);Br.add(l1,a1,c1,eo,t1,r1);const f1=new Qe,p1=new fe;function m1(t,e){const{geometryData:r,batches:s}=e;s.length=0,r.indices.length=0,r.vertices.length=0,r.uvs.length=0;for(let n=0;n<t.instructions.length;n++){const i=t.instructions[n];if(i.action==="texture")g1(i.data,s,r);else if(i.action==="fill"||i.action==="stroke"){const o=i.action==="stroke",a=i.data.path.shapePath,l=i.data.style,c=i.data.hole;o&&c&&sg(c.shapePath,l,!0,s,r),c&&(a.shapePrimitives[a.shapePrimitives.length-1].holes=c.shapePath.shapePrimitives),sg(a,l,o,s,r)}}}function g1(t,e,r){const s=[],n=Ul.rectangle,i=f1;i.x=t.dx,i.y=t.dy,i.width=t.dw,i.height=t.dh;const o=t.transform;if(!n.build(i,s))return;const{vertices:a,uvs:l,indices:c}=r,u=c.length,h=a.length/2;o&&Ub(s,o),n.triangulate(s,a,2,h,c,u);const d=t.image,f=d.uvs;l.push(f.x0,f.y0,f.x1,f.y1,f.x3,f.y3,f.x2,f.y2);const m=Kt.get($b);m.indexOffset=u,m.indexSize=c.length-u,m.attributeOffset=h,m.attributeSize=a.length/2-h,m.baseColor=t.style,m.alpha=t.alpha,m.texture=d,m.geometryData=r,e.push(m)}function sg(t,e,r,s,n){const{vertices:i,uvs:o,indices:a}=n;t.shapePrimitives.forEach(({shape:l,transform:c,holes:u})=>{const h=[],d=Ul[l.type];if(!d.build(l,h))return;const f=a.length,m=i.length/2;let y="triangle-list";if(c&&Ub(h,c),r){const x=l.closePath??!0,w=e;w.pixelLine?(i1(h,x,i,a),y="line-list"):n1(h,w,!1,x,i,a)}else if(u){const x=[],w=h.slice();y1(u).forEach(_=>{x.push(w.length/2),w.push(..._)}),Gb(w,x,i,2,m,a,f)}else d.triangulate(h,i,2,m,a,f);const g=o.length/2,A=e.texture;if(A!==Ae.WHITE){const x=d1(p1,e,l,c);JC(i,2,m,o,g,2,i.length/2-m,x)}else ZC(o,g,2,i.length/2-m);const b=Kt.get($b);b.indexOffset=f,b.indexSize=a.length-f,b.attributeOffset=m,b.attributeSize=i.length/2-m,b.baseColor=e.color,b.alpha=e.alpha,b.texture=A,b.geometryData=n,b.topology=y,s.push(b)})}function y1(t){const e=[];for(let r=0;r<t.length;r++){const s=t[r].shape,n=[];Ul[s.type].build(s,n)&&e.push(n)}return e}class A1{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}reset(){this.batches&&this.batches.forEach(e=>{Kt.return(e)}),this.graphicsData&&Kt.return(this.graphicsData),this.isBatchable=!1,this.context=null,this.batches.length=0,this.geometryData.indices.length=0,this.geometryData.vertices.length=0,this.geometryData.uvs.length=0,this.graphicsData=null}destroy(){this.reset(),this.batches=null,this.geometryData=null}}class x1{constructor(){this.instructions=new ib}init(e){const r=e.maxTextures;this.batcher?this.batcher._updateMaxTextures(r):this.batcher=new QC({maxTextures:r}),this.instructions.reset()}get geometry(){return _e(xS,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const Kd=class vh{constructor(e){this._renderer=e,this._managedContexts=new XC({renderer:e,type:"resource",name:"graphicsContext"})}init(e){vh.defaultOptions.bezierSmoothness=e?.bezierSmoothness??vh.defaultOptions.bezierSmoothness}getContextRenderData(e){return e._gpuData[this._renderer.uid].graphicsData||this._initContextRenderData(e)}updateGpuContext(e){const r=!!e._gpuData[this._renderer.uid],s=e._gpuData[this._renderer.uid]||this._initContext(e);if(e.dirty||!r){r&&s.reset(),m1(e,s);const n=e.batchMode;e.customShader||n==="no-batch"?s.isBatchable=!1:n==="auto"?s.isBatchable=s.geometryData.vertices.length<400:s.isBatchable=!0,e.dirty=!1}return s}getGpuContext(e){return e._gpuData[this._renderer.uid]||this._initContext(e)}_initContextRenderData(e){const r=Kt.get(x1,{maxTextures:this._renderer.limits.maxBatchableTextures}),s=e._gpuData[this._renderer.uid],{batches:n,geometryData:i}=s;s.graphicsData=r;const o=i.vertices.length,a=i.indices.length;for(let h=0;h<n.length;h++)n[h].applyTransform=!1;const l=r.batcher;l.ensureAttributeBuffer(o),l.ensureIndexBuffer(a),l.begin();for(let h=0;h<n.length;h++){const d=n[h];l.add(d)}l.finish(r.instructions);const c=l.geometry;c.indexBuffer.setDataWithSize(l.indexBuffer,l.indexSize,!0),c.buffers[0].setDataWithSize(l.attributeBuffer.float32View,l.attributeSize,!0);const u=l.batches;for(let h=0;h<u.length;h++){const d=u[h];d.bindGroup=aC(d.textures.textures,d.textures.count,this._renderer.limits.maxBatchableTextures)}return r}_initContext(e){const r=new A1;return r.context=e,e._gpuData[this._renderer.uid]=r,this._managedContexts.add(e),r}destroy(){this._managedContexts.destroy(),this._renderer=null}};Kd.extension={type:[Pe.WebGLSystem,Pe.WebGPUSystem,Pe.CanvasSystem],name:"graphicsContext"};Kd.defaultOptions={bezierSmoothness:.5};let Wb=Kd;const b1=8,fa=11920929e-14,w1=1;function Kb(t,e,r,s,n,i,o,a,l,c){const h=Math.min(.99,Math.max(0,c??Wb.defaultOptions.bezierSmoothness));let d=(w1-h)/1;return d*=d,V1(e,r,s,n,i,o,a,l,t,d),t}function V1(t,e,r,s,n,i,o,a,l,c){_h(t,e,r,s,n,i,o,a,l,c,0),l.push(o,a)}function _h(t,e,r,s,n,i,o,a,l,c,u){if(u>b1)return;const h=(t+r)/2,d=(e+s)/2,f=(r+n)/2,m=(s+i)/2,y=(n+o)/2,g=(i+a)/2,A=(h+f)/2,b=(d+m)/2,x=(f+y)/2,w=(m+g)/2,q=(A+x)/2,_=(b+w)/2;if(u>0){let V=o-t,S=a-e;const k=Math.abs((r-o)*S-(s-a)*V),C=Math.abs((n-o)*S-(i-a)*V);if(k>fa&&C>fa){if((k+C)*(k+C)<=c*(V*V+S*S)){l.push(q,_);return}}else if(k>fa){if(k*k<=c*(V*V+S*S)){l.push(q,_);return}}else if(C>fa){if(C*C<=c*(V*V+S*S)){l.push(q,_);return}}else if(V=q-(t+o)/2,S=_-(e+a)/2,V*V+S*S<=c){l.push(q,_);return}}_h(t,e,h,d,A,b,q,_,l,c,u+1),_h(q,_,x,w,y,g,o,a,l,c,u+1)}const q1=8,v1=11920929e-14,_1=1;function S1(t,e,r,s,n,i,o,a){const c=Math.min(.99,Math.max(0,a??Wb.defaultOptions.bezierSmoothness));let u=(_1-c)/1;return u*=u,k1(e,r,s,n,i,o,t,u),t}function k1(t,e,r,s,n,i,o,a){Sh(o,t,e,r,s,n,i,a,0),o.push(n,i)}function Sh(t,e,r,s,n,i,o,a,l){if(l>q1)return;const c=(e+s)/2,u=(r+n)/2,h=(s+i)/2,d=(n+o)/2,f=(c+h)/2,m=(u+d)/2;let y=i-e,g=o-r;const A=Math.abs((s-i)*g-(n-o)*y);if(A>v1){if(A*A<=a*(y*y+g*g)){t.push(f,m);return}}else if(y=f-(e+i)/2,g=m-(r+o)/2,y*y+g*g<=a){t.push(f,m);return}Sh(t,e,r,c,u,f,m,a,l+1),Sh(t,f,m,h,d,i,o,a,l+1)}function Yb(t,e,r,s,n,i,o,a){let l=Math.abs(n-i);(!o&&n>i||o&&i>n)&&(l=2*Math.PI-l),a||(a=Math.max(6,Math.floor(6*Math.pow(s,1/3)*(l/Math.PI)))),a=Math.max(a,3);let c=l/a,u=n;c*=o?-1:1;for(let h=0;h<a+1;h++){const d=Math.cos(u),f=Math.sin(u),m=e+d*s,y=r+f*s;t.push(m,y),u+=c}}function C1(t,e,r,s,n,i){const o=t[t.length-2],l=t[t.length-1]-r,c=o-e,u=n-r,h=s-e,d=Math.abs(l*h-c*u);if(d<1e-8||i===0){(t[t.length-2]!==e||t[t.length-1]!==r)&&t.push(e,r);return}const f=l*l+c*c,m=u*u+h*h,y=l*u+c*h,g=i*Math.sqrt(f)/d,A=i*Math.sqrt(m)/d,b=g*y/f,x=A*y/m,w=g*h+A*c,q=g*u+A*l,_=c*(A+b),V=l*(A+b),S=h*(g+x),k=u*(g+x),C=Math.atan2(V-q,_-w),E=Math.atan2(k-q,S-w);Yb(t,w+e,q+r,i,C,E,c*u>h*l)}const Bi=Math.PI*2,iu={centerX:0,centerY:0,ang1:0,ang2:0},ou=({x:t,y:e},r,s,n,i,o,a,l)=>{t*=r,e*=s;const c=n*t-i*e,u=i*t+n*e;return l.x=c+o,l.y=u+a,l};function E1(t,e){const r=e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),s=e===1.5707963267948966?.551915024494:r,n=Math.cos(t),i=Math.sin(t),o=Math.cos(t+e),a=Math.sin(t+e);return[{x:n-i*s,y:i+n*s},{x:o+a*s,y:a-o*s},{x:o,y:a}]}const ng=(t,e,r,s)=>{const n=t*s-e*r<0?-1:1;let i=t*r+e*s;return i>1&&(i=1),i<-1&&(i=-1),n*Math.acos(i)},P1=(t,e,r,s,n,i,o,a,l,c,u,h,d)=>{const f=Math.pow(n,2),m=Math.pow(i,2),y=Math.pow(u,2),g=Math.pow(h,2);let A=f*m-f*g-m*y;A<0&&(A=0),A/=f*g+m*y,A=Math.sqrt(A)*(o===a?-1:1);const b=A*n/i*h,x=A*-i/n*u,w=c*b-l*x+(t+r)/2,q=l*b+c*x+(e+s)/2,_=(u-b)/n,V=(h-x)/i,S=(-u-b)/n,k=(-h-x)/i,C=ng(1,0,_,V);let E=ng(_,V,S,k);a===0&&E>0&&(E-=Bi),a===1&&E<0&&(E+=Bi),d.centerX=w,d.centerY=q,d.ang1=C,d.ang2=E};function T1(t,e,r,s,n,i,o,a=0,l=0,c=0){if(i===0||o===0)return;const u=Math.sin(a*Bi/360),h=Math.cos(a*Bi/360),d=h*(e-s)/2+u*(r-n)/2,f=-u*(e-s)/2+h*(r-n)/2;if(d===0&&f===0)return;i=Math.abs(i),o=Math.abs(o);const m=Math.pow(d,2)/Math.pow(i,2)+Math.pow(f,2)/Math.pow(o,2);m>1&&(i*=Math.sqrt(m),o*=Math.sqrt(m)),P1(e,r,s,n,i,o,l,c,u,h,d,f,iu);let{ang1:y,ang2:g}=iu;const{centerX:A,centerY:b}=iu;let x=Math.abs(g)/(Bi/4);Math.abs(1-x)<1e-7&&(x=1);const w=Math.max(Math.ceil(x),1);g/=w;let q=t[t.length-2],_=t[t.length-1];const V={x:0,y:0};for(let S=0;S<w;S++){const k=E1(y,g),{x:C,y:E}=ou(k[0],i,o,h,u,A,b,V),{x:T,y:R}=ou(k[1],i,o,h,u,A,b,V),{x:I,y:z}=ou(k[2],i,o,h,u,A,b,V);Kb(t,q,_,C,E,T,R,I,z),q=I,_=z,y+=g}}function R1(t,e,r){const s=(o,a)=>{const l=a.x-o.x,c=a.y-o.y,u=Math.sqrt(l*l+c*c),h=l/u,d=c/u;return{len:u,nx:h,ny:d}},n=(o,a)=>{o===0?t.moveTo(a.x,a.y):t.lineTo(a.x,a.y)};let i=e[e.length-1];for(let o=0;o<e.length;o++){const a=e[o%e.length],l=a.radius??r;if(l<=0){n(o,a),i=a;continue}const c=e[(o+1)%e.length],u=s(a,i),h=s(a,c);if(u.len<1e-4||h.len<1e-4){n(o,a),i=a;continue}let d=Math.asin(u.nx*h.ny-u.ny*h.nx),f=1,m=!1;u.nx*h.nx-u.ny*-h.ny<0?d<0?d=Math.PI+d:(d=Math.PI-d,f=-1,m=!0):d>0&&(f=-1,m=!0);const y=d/2;let g,A=Math.abs(Math.cos(y)*l/Math.sin(y));A>Math.min(u.len/2,h.len/2)?(A=Math.min(u.len/2,h.len/2),g=Math.abs(A*Math.sin(y)/Math.cos(y))):g=l;const b=a.x+h.nx*A+-h.ny*g*f,x=a.y+h.ny*A+h.nx*g*f,w=Math.atan2(u.ny,u.nx)+Math.PI/2*f,q=Math.atan2(h.ny,h.nx)-Math.PI/2*f;o===0&&t.moveTo(b+Math.cos(w)*g,x+Math.sin(w)*g),t.arc(b,x,g,w,q,m),i=a}}function M1(t,e,r,s){const n=(a,l)=>Math.sqrt((a.x-l.x)**2+(a.y-l.y)**2),i=(a,l,c)=>({x:a.x+(l.x-a.x)*c,y:a.y+(l.y-a.y)*c}),o=e.length;for(let a=0;a<o;a++){const l=e[(a+1)%o],c=l.radius??r;if(c<=0){a===0?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y);continue}const u=e[a],h=e[(a+2)%o],d=n(u,l);let f;if(d<1e-4)f=l;else{const g=Math.min(d/2,c);f=i(l,u,g/d)}const m=n(h,l);let y;if(m<1e-4)y=l;else{const g=Math.min(m/2,c);y=i(l,h,g/m)}a===0?t.moveTo(f.x,f.y):t.lineTo(f.x,f.y),t.quadraticCurveTo(l.x,l.y,y.x,y.y,s)}}const I1=new Qe;class j1{constructor(e){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new nr,this._graphicsPath2D=e,this.signed=e.checkForHoles}moveTo(e,r){return this.startPoly(e,r),this}lineTo(e,r){this._ensurePoly();const s=this._currentPoly.points,n=s[s.length-2],i=s[s.length-1];return(n!==e||i!==r)&&s.push(e,r),this}arc(e,r,s,n,i,o){this._ensurePoly(!1);const a=this._currentPoly.points;return Yb(a,e,r,s,n,i,o),this}arcTo(e,r,s,n,i){this._ensurePoly();const o=this._currentPoly.points;return C1(o,e,r,s,n,i),this}arcToSvg(e,r,s,n,i,o,a){const l=this._currentPoly.points;return T1(l,this._currentPoly.lastX,this._currentPoly.lastY,o,a,e,r,s,n,i),this}bezierCurveTo(e,r,s,n,i,o,a){this._ensurePoly();const l=this._currentPoly;return Kb(this._currentPoly.points,l.lastX,l.lastY,e,r,s,n,i,o,a),this}quadraticCurveTo(e,r,s,n,i){this._ensurePoly();const o=this._currentPoly;return S1(this._currentPoly.points,o.lastX,o.lastY,e,r,s,n,i),this}closePath(){return this.endPoly(!0),this}addPath(e,r){this.endPoly(),r&&!r.isIdentity()&&(e=e.clone(!0),e.transform(r));const s=this.shapePrimitives,n=s.length;for(let i=0;i<e.instructions.length;i++){const o=e.instructions[i];this[o.action](...o.data)}if(e.checkForHoles&&s.length-n>1){let i=null;for(let o=n;o<s.length;o++){const a=s[o];if(a.shape.type==="polygon"){const l=a.shape,c=i?.shape;c&&c.containsPolygon(l)?(i.holes||(i.holes=[]),i.holes.push(a),s.copyWithin(o,o+1),s.length--,o--):i=a}}}return this}finish(e=!1){this.endPoly(e)}rect(e,r,s,n,i){return this.drawShape(new Qe(e,r,s,n),i),this}circle(e,r,s,n){return this.drawShape(new Hd(e,r,s),n),this}poly(e,r,s){const n=new Oi(e);return n.closePath=r,this.drawShape(n,s),this}regularPoly(e,r,s,n,i=0,o){n=Math.max(n|0,3);const a=-1*Math.PI/2+i,l=Math.PI*2/n,c=[];for(let u=0;u<n;u++){const h=a-u*l;c.push(e+s*Math.cos(h),r+s*Math.sin(h))}return this.poly(c,!0,o),this}roundPoly(e,r,s,n,i,o=0,a){if(n=Math.max(n|0,3),i<=0)return this.regularPoly(e,r,s,n,o);const l=s*Math.sin(Math.PI/n)-.001;i=Math.min(i,l);const c=-1*Math.PI/2+o,u=Math.PI*2/n,h=(n-2)*Math.PI/n/2;for(let d=0;d<n;d++){const f=d*u+c,m=e+s*Math.cos(f),y=r+s*Math.sin(f),g=f+Math.PI+h,A=f-Math.PI-h,b=m+i*Math.cos(g),x=y+i*Math.sin(g),w=m+i*Math.cos(A),q=y+i*Math.sin(A);d===0?this.moveTo(b,x):this.lineTo(b,x),this.quadraticCurveTo(m,y,w,q,a)}return this.closePath()}roundShape(e,r,s=!1,n){return e.length<3?this:(s?M1(this,e,r,n):R1(this,e,r),this.closePath())}filletRect(e,r,s,n,i){if(i===0)return this.rect(e,r,s,n);const o=Math.min(s,n)/2,a=Math.min(o,Math.max(-o,i)),l=e+s,c=r+n,u=a<0?-a:0,h=Math.abs(a);return this.moveTo(e,r+h).arcTo(e+u,r+u,e+h,r,h).lineTo(l-h,r).arcTo(l-u,r+u,l,r+h,h).lineTo(l,c-h).arcTo(l-u,c-u,e+s-h,c,h).lineTo(e+h,c).arcTo(e+u,c-u,e,c-h,h).closePath()}chamferRect(e,r,s,n,i,o){if(i<=0)return this.rect(e,r,s,n);const a=Math.min(i,Math.min(s,n)/2),l=e+s,c=r+n,u=[e+a,r,l-a,r,l,r+a,l,c-a,l-a,c,e+a,c,e,c-a,e,r+a];for(let h=u.length-1;h>=2;h-=2)u[h]===u[h-2]&&u[h-1]===u[h-3]&&u.splice(h-1,2);return this.poly(u,!0,o)}ellipse(e,r,s,n,i){return this.drawShape(new Gd(e,r,s,n),i),this}roundRect(e,r,s,n,i,o){return this.drawShape(new Wd(e,r,s,n,i),o),this}drawShape(e,r){return this.endPoly(),this.shapePrimitives.push({shape:e,transform:r}),this}startPoly(e,r){let s=this._currentPoly;return s&&this.endPoly(),s=new Oi,s.points.push(e,r),this._currentPoly=s,this}endPoly(e=!1){const r=this._currentPoly;return r&&r.points.length>2&&(r.closePath=e,this.shapePrimitives.push({shape:r})),this._currentPoly=null,this}_ensurePoly(e=!0){if(!this._currentPoly&&(this._currentPoly=new Oi,e)){const r=this.shapePrimitives[this.shapePrimitives.length-1];if(r){let s=r.shape.x,n=r.shape.y;if(r.transform&&!r.transform.isIdentity()){const i=r.transform,o=s;s=i.a*s+i.c*n+i.tx,n=i.b*o+i.d*n+i.ty}this._currentPoly.points.push(s,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const e=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let r=0;r<e.instructions.length;r++){const s=e.instructions[r];this[s.action](...s.data)}this.finish()}get bounds(){const e=this._bounds;e.clear();const r=this.shapePrimitives;for(let s=0;s<r.length;s++){const n=r[s],i=n.shape.getBounds(I1);n.transform?e.addRect(i,n.transform):e.addRect(i)}return e}}class Rr{constructor(e,r=!1){this.instructions=[],this.uid=$e("graphicsPath"),this._dirty=!0,this.checkForHoles=r,typeof e=="string"?sC(e,this):this.instructions=e?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new j1(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(e,r){return e=e.clone(),this.instructions.push({action:"addPath",data:[e,r]}),this._dirty=!0,this}arc(...e){return this.instructions.push({action:"arc",data:e}),this._dirty=!0,this}arcTo(...e){return this.instructions.push({action:"arcTo",data:e}),this._dirty=!0,this}arcToSvg(...e){return this.instructions.push({action:"arcToSvg",data:e}),this._dirty=!0,this}bezierCurveTo(...e){return this.instructions.push({action:"bezierCurveTo",data:e}),this._dirty=!0,this}bezierCurveToShort(e,r,s,n,i){const o=this.instructions[this.instructions.length-1],a=this.getLastPoint(dt.shared);let l=0,c=0;if(!o||o.action!=="bezierCurveTo")l=a.x,c=a.y;else{l=o.data[2],c=o.data[3];const u=a.x,h=a.y;l=u+(u-l),c=h+(h-c)}return this.instructions.push({action:"bezierCurveTo",data:[l,c,e,r,s,n,i]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...e){return this.instructions.push({action:"ellipse",data:e}),this._dirty=!0,this}lineTo(...e){return this.instructions.push({action:"lineTo",data:e}),this._dirty=!0,this}moveTo(...e){return this.instructions.push({action:"moveTo",data:e}),this}quadraticCurveTo(...e){return this.instructions.push({action:"quadraticCurveTo",data:e}),this._dirty=!0,this}quadraticCurveToShort(e,r,s){const n=this.instructions[this.instructions.length-1],i=this.getLastPoint(dt.shared);let o=0,a=0;if(!n||n.action!=="quadraticCurveTo")o=i.x,a=i.y;else{o=n.data[0],a=n.data[1];const l=i.x,c=i.y;o=l+(l-o),a=c+(c-a)}return this.instructions.push({action:"quadraticCurveTo",data:[o,a,e,r,s]}),this._dirty=!0,this}rect(e,r,s,n,i){return this.instructions.push({action:"rect",data:[e,r,s,n,i]}),this._dirty=!0,this}circle(e,r,s,n){return this.instructions.push({action:"circle",data:[e,r,s,n]}),this._dirty=!0,this}roundRect(...e){return this.instructions.push({action:"roundRect",data:e}),this._dirty=!0,this}poly(...e){return this.instructions.push({action:"poly",data:e}),this._dirty=!0,this}regularPoly(...e){return this.instructions.push({action:"regularPoly",data:e}),this._dirty=!0,this}roundPoly(...e){return this.instructions.push({action:"roundPoly",data:e}),this._dirty=!0,this}roundShape(...e){return this.instructions.push({action:"roundShape",data:e}),this._dirty=!0,this}filletRect(...e){return this.instructions.push({action:"filletRect",data:e}),this._dirty=!0,this}chamferRect(...e){return this.instructions.push({action:"chamferRect",data:e}),this._dirty=!0,this}star(e,r,s,n,i,o,a){i||(i=n/2);const l=-1*Math.PI/2+o,c=s*2,u=Math.PI*2/c,h=[];for(let d=0;d<c;d++){const f=d%2?i:n,m=d*u+l;h.push(e+f*Math.cos(m),r+f*Math.sin(m))}return this.poly(h,!0,a),this}clone(e=!1){const r=new Rr;if(r.checkForHoles=this.checkForHoles,!e)r.instructions=this.instructions.slice();else for(let s=0;s<this.instructions.length;s++){const n=this.instructions[s];r.instructions.push({action:n.action,data:n.data.slice()})}return r}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(e){if(e.isIdentity())return this;const r=e.a,s=e.b,n=e.c,i=e.d,o=e.tx,a=e.ty;let l=0,c=0,u=0,h=0,d=0,f=0,m=0,y=0;for(let g=0;g<this.instructions.length;g++){const A=this.instructions[g],b=A.data;switch(A.action){case"moveTo":case"lineTo":l=b[0],c=b[1],b[0]=r*l+n*c+o,b[1]=s*l+i*c+a;break;case"bezierCurveTo":u=b[0],h=b[1],d=b[2],f=b[3],l=b[4],c=b[5],b[0]=r*u+n*h+o,b[1]=s*u+i*h+a,b[2]=r*d+n*f+o,b[3]=s*d+i*f+a,b[4]=r*l+n*c+o,b[5]=s*l+i*c+a;break;case"quadraticCurveTo":u=b[0],h=b[1],l=b[2],c=b[3],b[0]=r*u+n*h+o,b[1]=s*u+i*h+a,b[2]=r*l+n*c+o,b[3]=s*l+i*c+a;break;case"arcToSvg":l=b[5],c=b[6],m=b[0],y=b[1],b[0]=r*m+n*y,b[1]=s*m+i*y,b[5]=r*l+n*c+o,b[6]=s*l+i*c+a;break;case"circle":b[4]=ui(b[3],e);break;case"rect":b[4]=ui(b[4],e);break;case"ellipse":b[8]=ui(b[8],e);break;case"roundRect":b[5]=ui(b[5],e);break;case"addPath":b[0].transform(e);break;case"poly":b[2]=ui(b[2],e);break;default:Nt("unknown transform action",A.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(e){let r=this.instructions.length-1,s=this.instructions[r];if(!s)return e.x=0,e.y=0,e;for(;s.action==="closePath";){if(r--,r<0)return e.x=0,e.y=0,e;s=this.instructions[r]}switch(s.action){case"moveTo":case"lineTo":e.x=s.data[0],e.y=s.data[1];break;case"quadraticCurveTo":e.x=s.data[2],e.y=s.data[3];break;case"bezierCurveTo":e.x=s.data[4],e.y=s.data[5];break;case"arc":case"arcToSvg":e.x=s.data[5],e.y=s.data[6];break;case"addPath":s.data[0].getLastPoint(e);break}return e}}function ui(t,e){return t?t.prepend(e):e.clone()}function Ie(t,e,r){const s=t.getAttribute(e);return s?Number(s):r}function O1(t,e){const r=t.querySelectorAll("defs");for(let s=0;s<r.length;s++){const n=r[s];for(let i=0;i<n.children.length;i++){const o=n.children[i];switch(o.nodeName.toLowerCase()){case"lineargradient":e.defs[o.id]=N1(o);break;case"radialgradient":e.defs[o.id]=B1();break}}}}function N1(t){const e=Ie(t,"x1",0),r=Ie(t,"y1",0),s=Ie(t,"x2",1),n=Ie(t,"y2",0),i=t.getAttribute("gradientUnits")||"objectBoundingBox",o=new Po(e,r,s,n,i==="objectBoundingBox"?"local":"global");for(let a=0;a<t.children.length;a++){const l=t.children[a],c=Ie(l,"offset",0),u=Ve.shared.setValue(l.getAttribute("stop-color")).toNumber();o.addColorStop(c,u)}return o}function B1(t){return Nt("[SVG Parser] Radial gradients are not yet supported"),new Po(0,0,1,0)}function ig(t){const e=t.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return e?e[1]:""}const og={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function Qb(t,e){const r=t.getAttribute("style"),s={},n={},i={strokeStyle:s,fillStyle:n,useFill:!1,useStroke:!1};for(const o in og){const a=t.getAttribute(o);a&&ag(e,i,o,a.trim())}if(r){const o=r.split(";");for(let a=0;a<o.length;a++){const l=o[a].trim(),[c,u]=l.split(":");og[c]&&ag(e,i,c,u.trim())}}return{strokeStyle:i.useStroke?s:null,fillStyle:i.useFill?n:null,useFill:i.useFill,useStroke:i.useStroke}}function ag(t,e,r,s){switch(r){case"stroke":if(s!=="none"){if(s.startsWith("url(")){const n=ig(s);e.strokeStyle.fill=t.defs[n]}else e.strokeStyle.color=Ve.shared.setValue(s).toNumber();e.useStroke=!0}break;case"stroke-width":e.strokeStyle.width=Number(s);break;case"fill":if(s!=="none"){if(s.startsWith("url(")){const n=ig(s);e.fillStyle.fill=t.defs[n]}else e.fillStyle.color=Ve.shared.setValue(s).toNumber();e.useFill=!0}break;case"fill-opacity":e.fillStyle.alpha=Number(s);break;case"stroke-opacity":e.strokeStyle.alpha=Number(s);break;case"opacity":e.fillStyle.alpha=Number(s),e.strokeStyle.alpha=Number(s);break}}function z1(t){if(t.length<=2)return!0;const e=t.map(a=>a.area).sort((a,l)=>l-a),[r,s]=e,n=e[e.length-1],i=r/s,o=s/n;return!(i>3&&o<2)}function D1(t){return t.split(/(?=[Mm])/).filter(s=>s.trim().length>0)}function L1(t){const e=t.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!e||e.length<4)return 0;const r=e.map(Number),s=[],n=[];for(let u=0;u<r.length;u+=2)u+1<r.length&&(s.push(r[u]),n.push(r[u+1]));if(s.length===0||n.length===0)return 0;const i=Math.min(...s),o=Math.max(...s),a=Math.min(...n),l=Math.max(...n);return(o-i)*(l-a)}function lg(t,e){const r=new Rr(t,!1);for(const s of r.instructions)e.instructions.push(s)}function F1(t,e){if(typeof t=="string"){const o=document.createElement("div");o.innerHTML=t.trim(),t=o.querySelector("svg")}const r={context:e,defs:{},path:new Rr};O1(t,r);const s=t.children,{fillStyle:n,strokeStyle:i}=Qb(t,r);for(let o=0;o<s.length;o++){const a=s[o];a.nodeName.toLowerCase()!=="defs"&&Xb(a,r,n,i)}return e}function Xb(t,e,r,s){const n=t.children,{fillStyle:i,strokeStyle:o}=Qb(t,e);i&&r?r={...r,...i}:i&&(r=i),o&&s?s={...s,...o}:o&&(s=o);const a=!r&&!s;a&&(r={color:0});let l,c,u,h,d,f,m,y,g,A,b,x,w,q,_,V,S;switch(t.nodeName.toLowerCase()){case"path":{q=t.getAttribute("d");const k=t.getAttribute("fill-rule"),C=D1(q),E=k==="evenodd",T=C.length>1;if(E&&T){const I=C.map(P=>({path:P,area:L1(P)}));if(I.sort((P,M)=>M.area-P.area),C.length>3||!z1(I))for(let P=0;P<I.length;P++){const M=I[P],D=P===0;e.context.beginPath();const L=new Rr(void 0,!0);lg(M.path,L),e.context.path(L),D?(r&&e.context.fill(r),s&&e.context.stroke(s)):e.context.cut()}else for(let P=0;P<I.length;P++){const M=I[P],D=P%2===1;e.context.beginPath();const L=new Rr(void 0,!0);lg(M.path,L),e.context.path(L),D?e.context.cut():(r&&e.context.fill(r),s&&e.context.stroke(s))}}else{const I=k?k==="evenodd":!0;_=new Rr(q,I),e.context.path(_),r&&e.context.fill(r),s&&e.context.stroke(s)}break}case"circle":m=Ie(t,"cx",0),y=Ie(t,"cy",0),g=Ie(t,"r",0),e.context.ellipse(m,y,g,g),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"rect":l=Ie(t,"x",0),c=Ie(t,"y",0),V=Ie(t,"width",0),S=Ie(t,"height",0),A=Ie(t,"rx",0),b=Ie(t,"ry",0),A||b?e.context.roundRect(l,c,V,S,A||b):e.context.rect(l,c,V,S),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"ellipse":m=Ie(t,"cx",0),y=Ie(t,"cy",0),A=Ie(t,"rx",0),b=Ie(t,"ry",0),e.context.beginPath(),e.context.ellipse(m,y,A,b),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"line":u=Ie(t,"x1",0),h=Ie(t,"y1",0),d=Ie(t,"x2",0),f=Ie(t,"y2",0),e.context.beginPath(),e.context.moveTo(u,h),e.context.lineTo(d,f),s&&e.context.stroke(s);break;case"polygon":w=t.getAttribute("points"),x=w.match(/-?\d+/g).map(k=>parseInt(k,10)),e.context.poly(x,!0),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"polyline":w=t.getAttribute("points"),x=w.match(/-?\d+/g).map(k=>parseInt(k,10)),e.context.poly(x,!1),s&&e.context.stroke(s);break;case"g":case"svg":break;default:{Nt(`[SVG parser] <${t.nodeName}> elements unsupported`);break}}a&&(r=null);for(let k=0;k<n.length;k++)Xb(n[k],e,r,s)}function U1(t){return Ve.isColorLike(t)}function cg(t){return t instanceof Zk}function ug(t){return t instanceof Po}function $1(t){return t instanceof Ae}function H1(t,e,r){const s=Ve.shared.setValue(e??0);return t.color=s.toNumber(),t.alpha=s.alpha===1?r.alpha:s.alpha,t.texture=Ae.WHITE,{...r,...t}}function G1(t,e,r){return t.texture=e,{...r,...t}}function hg(t,e,r){return t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,{...r,...t}}function dg(t,e,r){return e.buildGradient(),t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,t.textureSpace=e.textureSpace,{...r,...t}}function W1(t,e){const r={...e,...t},s=Ve.shared.setValue(r.color);return r.alpha*=s.alpha,r.color=s.toNumber(),r}function Si(t,e){if(t==null)return null;const r={},s=t;return U1(t)?H1(r,t,e):$1(t)?G1(r,t,e):cg(t)?hg(r,t,e):ug(t)?dg(r,t,e):s.fill&&cg(s.fill)?hg(s,s.fill,e):s.fill&&ug(s.fill)?dg(s,s.fill,e):W1(s,e)}function fg(t,e){const{width:r,alignment:s,miterLimit:n,cap:i,join:o,pixelLine:a,...l}=e,c=Si(t,l);return c?{width:r,alignment:s,miterLimit:n,cap:i,join:o,pixelLine:a,...c}:null}const K1=new dt,pg=new fe,Yd=class dr extends is{constructor(){super(...arguments),this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this.uid=$e("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this.destroyed=!1,this._activePath=new Rr,this._transform=new fe,this._fillStyle={...dr.defaultFillStyle},this._strokeStyle={...dr.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new nr,this._boundsDirty=!0}clone(){const e=new dr;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle={...this._fillStyle},e._strokeStyle={...this._strokeStyle},e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=Si(e,dr.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=fg(e,dr.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=Si(e,dr.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=Si(e,dr.defaultStrokeStyle),this}texture(e,r,s,n,i,o){return this.instructions.push({action:"texture",data:{image:e,dx:s||0,dy:n||0,dw:i||e.frame.width,dh:o||e.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:r?Ve.shared.setValue(r).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new Rr,this}fill(e,r){let s;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n?.action==="stroke"?s=n.data.path:s=this._activePath.clone(),s?(e!=null&&(r!==void 0&&typeof e=="number"&&(_e(lt,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:r}),this._fillStyle=Si(e,dr.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:s}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:e,y:r}=this._activePath.getLastPoint(dt.shared);this._activePath.clear(),this._activePath.moveTo(e,r)}stroke(e){let r;const s=this.instructions[this.instructions.length-1];return this._tick===0&&s?.action==="fill"?r=s.data.path:r=this._activePath.clone(),r?(e!=null&&(this._strokeStyle=fg(e,dr.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let e=0;e<2;e++){const r=this.instructions[this.instructions.length-1-e],s=this._activePath.clone();if(r&&(r.action==="stroke"||r.action==="fill"))if(r.data.hole)r.data.hole.addPath(s);else{r.data.hole=s;break}}return this._initNextPathLocation(),this}arc(e,r,s,n,i,o){this._tick++;const a=this._transform;return this._activePath.arc(a.a*e+a.c*r+a.tx,a.b*e+a.d*r+a.ty,s,n,i,o),this}arcTo(e,r,s,n,i){this._tick++;const o=this._transform;return this._activePath.arcTo(o.a*e+o.c*r+o.tx,o.b*e+o.d*r+o.ty,o.a*s+o.c*n+o.tx,o.b*s+o.d*n+o.ty,i),this}arcToSvg(e,r,s,n,i,o,a){this._tick++;const l=this._transform;return this._activePath.arcToSvg(e,r,s,n,i,l.a*o+l.c*a+l.tx,l.b*o+l.d*a+l.ty),this}bezierCurveTo(e,r,s,n,i,o,a){this._tick++;const l=this._transform;return this._activePath.bezierCurveTo(l.a*e+l.c*r+l.tx,l.b*e+l.d*r+l.ty,l.a*s+l.c*n+l.tx,l.b*s+l.d*n+l.ty,l.a*i+l.c*o+l.tx,l.b*i+l.d*o+l.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(e,r,s,n){return this._tick++,this._activePath.ellipse(e,r,s,n,this._transform.clone()),this}circle(e,r,s){return this._tick++,this._activePath.circle(e,r,s,this._transform.clone()),this}path(e){return this._tick++,this._activePath.addPath(e,this._transform.clone()),this}lineTo(e,r){this._tick++;const s=this._transform;return this._activePath.lineTo(s.a*e+s.c*r+s.tx,s.b*e+s.d*r+s.ty),this}moveTo(e,r){this._tick++;const s=this._transform,n=this._activePath.instructions,i=s.a*e+s.c*r+s.tx,o=s.b*e+s.d*r+s.ty;return n.length===1&&n[0].action==="moveTo"?(n[0].data[0]=i,n[0].data[1]=o,this):(this._activePath.moveTo(i,o),this)}quadraticCurveTo(e,r,s,n,i){this._tick++;const o=this._transform;return this._activePath.quadraticCurveTo(o.a*e+o.c*r+o.tx,o.b*e+o.d*r+o.ty,o.a*s+o.c*n+o.tx,o.b*s+o.d*n+o.ty,i),this}rect(e,r,s,n){return this._tick++,this._activePath.rect(e,r,s,n,this._transform.clone()),this}roundRect(e,r,s,n,i){return this._tick++,this._activePath.roundRect(e,r,s,n,i,this._transform.clone()),this}poly(e,r){return this._tick++,this._activePath.poly(e,r,this._transform.clone()),this}regularPoly(e,r,s,n,i=0,o){return this._tick++,this._activePath.regularPoly(e,r,s,n,i,o),this}roundPoly(e,r,s,n,i,o){return this._tick++,this._activePath.roundPoly(e,r,s,n,i,o),this}roundShape(e,r,s,n){return this._tick++,this._activePath.roundShape(e,r,s,n),this}filletRect(e,r,s,n,i){return this._tick++,this._activePath.filletRect(e,r,s,n,i),this}chamferRect(e,r,s,n,i,o){return this._tick++,this._activePath.chamferRect(e,r,s,n,i,o),this}star(e,r,s,n,i=0,o=0){return this._tick++,this._activePath.star(e,r,s,n,i,o,this._transform.clone()),this}svg(e){return this._tick++,F1(e,this),this}restore(){const e=this._stateStack.pop();return e&&(this._transform=e.transform,this._fillStyle=e.fillStyle,this._strokeStyle=e.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(e){return this._transform.rotate(e),this}scale(e,r=e){return this._transform.scale(e,r),this}setTransform(e,r,s,n,i,o){return e instanceof fe?(this._transform.set(e.a,e.b,e.c,e.d,e.tx,e.ty),this):(this._transform.set(e,r,s,n,i,o),this)}transform(e,r,s,n,i,o){return e instanceof fe?(this._transform.append(e),this):(pg.set(e,r,s,n,i,o),this._transform.append(pg),this)}translate(e,r=e){return this._transform.translate(e,r),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const e=this._bounds;e.clear();for(let r=0;r<this.instructions.length;r++){const s=this.instructions[r],n=s.action;if(n==="fill"){const i=s.data;e.addBounds(i.path.bounds)}else if(n==="texture"){const i=s.data;e.addFrame(i.dx,i.dy,i.dx+i.dw,i.dy+i.dh,i.transform)}if(n==="stroke"){const i=s.data,o=i.style.alignment,a=i.style.width*(1-o),l=i.path.bounds;e.addFrame(l.minX-a,l.minY-a,l.maxX+a,l.maxY+a)}}return e}containsPoint(e){if(!this.bounds.containsPoint(e.x,e.y))return!1;const r=this.instructions;let s=!1;for(let n=0;n<r.length;n++){const i=r[n],o=i.data,a=o.path;if(!i.action||!a)continue;const l=o.style,c=a.shapePath.shapePrimitives;for(let u=0;u<c.length;u++){const h=c[u].shape;if(!l||!h)continue;const d=c[u].transform,f=d?d.applyInverse(e,K1):e;if(i.action==="fill")s=h.contains(f.x,f.y);else{const y=l;s=h.strokeContains(f.x,f.y,y.width,y.alignment)}const m=o.hole;if(m){const y=m.shapePath?.shapePrimitives;if(y)for(let g=0;g<y.length;g++)y[g].shape.contains(f.x,f.y)&&(s=!1)}if(s)return!0}}return s}unload(){this.emit("unload",this);for(const e in this._gpuData)this._gpuData[e]?.destroy();this._gpuData=Object.create(null)}destroy(e=!1){if(this.destroyed)return;if(this.destroyed=!0,this._stateStack.length=0,this._transform=null,this.unload(),this.emit("destroy",this),this.removeAllListeners(),typeof e=="boolean"?e:e?.texture){const s=typeof e=="boolean"?e:e?.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(s)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(s))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Yd.defaultFillStyle={color:16777215,alpha:1,texture:Ae.WHITE,matrix:null,fill:null,textureSpace:"local"};Yd.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:Ae.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let hi=Yd;var Y1=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;class cl extends ab{constructor(e){e instanceof hi&&(e={context:e});const{context:r,roundPixels:s,...n}=e||{};super({label:"Graphics",...n}),this.renderPipeId="graphics",r?this.context=r:(this.context=this._ownedContext=new hi,this.context.autoGarbageCollect=this.autoGarbageCollect),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=s??!1}set context(e){e!==this._context&&(this._context&&(this._context.off("update",this.onViewUpdate,this),this._context.off("unload",this.unload,this)),this._context=e,this._context.on("update",this.onViewUpdate,this),this._context.on("unload",this.unload,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(e){return this._context.containsPoint(e)}destroy(e){this._ownedContext&&!e?this._ownedContext.destroy(e):(e===!0||e?.context===!0)&&this._context.destroy(e),this._ownedContext=null,this._context=null,super.destroy(e)}_onTouch(e){this._gcLastUsed=e,this._context._gcLastUsed=e}_callContextMethod(e,r){return this.context[e](...r),this}setFillStyle(...e){return this._callContextMethod("setFillStyle",e)}setStrokeStyle(...e){return this._callContextMethod("setStrokeStyle",e)}fill(...e){return this._callContextMethod("fill",e)}stroke(...e){return this._callContextMethod("stroke",e)}texture(...e){return this._callContextMethod("texture",e)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...e){return this._callContextMethod("arc",e)}arcTo(...e){return this._callContextMethod("arcTo",e)}arcToSvg(...e){return this._callContextMethod("arcToSvg",e)}bezierCurveTo(...e){return this._callContextMethod("bezierCurveTo",e)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...e){return this._callContextMethod("ellipse",e)}circle(...e){return this._callContextMethod("circle",e)}path(...e){return this._callContextMethod("path",e)}lineTo(...e){return this._callContextMethod("lineTo",e)}moveTo(...e){return this._callContextMethod("moveTo",e)}quadraticCurveTo(...e){return this._callContextMethod("quadraticCurveTo",e)}rect(...e){return this._callContextMethod("rect",e)}roundRect(...e){return this._callContextMethod("roundRect",e)}poly(...e){return this._callContextMethod("poly",e)}regularPoly(...e){return this._callContextMethod("regularPoly",e)}roundPoly(...e){return this._callContextMethod("roundPoly",e)}roundShape(...e){return this._callContextMethod("roundShape",e)}filletRect(...e){return this._callContextMethod("filletRect",e)}chamferRect(...e){return this._callContextMethod("chamferRect",e)}star(...e){return this._callContextMethod("star",e)}svg(...e){return this._callContextMethod("svg",e)}restore(...e){return this._callContextMethod("restore",e)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...e){return this._callContextMethod("rotate",e)}scaleTransform(...e){return this._callContextMethod("scale",e)}setTransform(...e){return this._callContextMethod("setTransform",e)}transform(...e){return this._callContextMethod("transform",e)}translateTransform(...e){return this._callContextMethod("translate",e)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(e){this._context.fillStyle=e}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(e){this._context.strokeStyle=e}clone(e=!1){return e?new cl(this._context.clone()):(this._ownedContext=null,new cl(this._context))}lineStyle(e,r,s){_e(lt,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const n={};return e&&(n.width=e),r&&(n.color=r),s&&(n.alpha=s),this.context.strokeStyle=n,this}beginFill(e,r){_e(lt,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const s={};return e!==void 0&&(s.color=e),r!==void 0&&(s.alpha=r),this.context.fillStyle=s,this}endFill(){_e(lt,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const e=this.context.strokeStyle;return(e.width!==hi.defaultStrokeStyle.width||e.color!==hi.defaultStrokeStyle.color||e.alpha!==hi.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...e){return _e(lt,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",e)}drawEllipse(...e){return _e(lt,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",e)}drawPolygon(...e){return _e(lt,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",e)}drawRect(...e){return _e(lt,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",e)}drawRoundedRect(...e){return _e(lt,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",e)}drawStar(...e){return _e(lt,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",e)}}class $l extends Ae{static create(e){const{dynamic:r,...s}=e;return new $l({source:new Yt(s),dynamic:r??!1})}resize(e,r,s){return this.source.resize(e,r,s),this}}Br.add(cS,uS);const CU=["yellow","cyan","green","magenta","white"],To=25,EU=1e3/To,Wn={amigaHiResPal:{name:"Amiga Hi-Res PAL",size:{x:640,y:512}},classicMac:{name:"Classic Mac",size:{x:512,y:384}},amigaLowResPal:{name:"Amiga Lo-Res PAL",size:{x:320,y:256}},zxSpectrum:{name:"ZX Spectrum",size:{x:256,y:192}},handheld:{name:"Handheld",size:{x:256,y:135}}},Q1=Object.keys(Wn),X1={red:new Ve("#f00"),green:new Ve("#0f0"),blue:new Ve("#00f"),cyan:new Ve("#0ff"),magenta:new Ve("#f0f"),yellow:new Ve("#ff0"),black:new Ve("#000"),white:new Ve("#fff")},J1={red:new Ve("#B00"),green:new Ve("#0B0"),blue:new Ve("#00B"),cyan:new Ve("#0BB"),magenta:new Ve("#B0B"),yellow:new Ve("#BB0"),black:new Ve("#000"),white:new Ve("#BBB")};function PU(t,e){const{hue:r,shade:s}=typeof t=="object"?t:{hue:t,shade:e??"basic"};return(s==="dimmed"?J1:X1)[r]}const Ua=()=>At()==="mobile"||At()==="tablet",At=()=>{if(typeof globalThis.window>"u")return"server";const t=er().get("device");if(t!==null)return t;const e=navigator.userAgent;return navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1||/iPad|Tablet|Android(?!.*Mobi)/i.test(e)?"tablet":/Mobi|Android|iPhone|iPod/i.test(e)?"mobile":"desktop"},Z1=()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0,pn=[],Jb=new Set,TU=new Map;Jb.add=()=>{throw new Error("emptySet.add")};Jb.clear=()=>{throw new Error("emptySet.clear")};const pe=Object.freeze({}),ul=(t,e)=>e.split(".").reduce((r,s)=>r[s],t),eE=(t,e,r)=>{const s=e.split(".");let n=t;for(let i=0;i<s.length-1;i++){const o=s[i];n=n[o]}n[s[s.length-1]]=r},pa=(t,e)=>{const r=t.indexOf(e);return t[(r+1)%t.length]},to=(t,...e)=>{const r={};for(const s of e)r[s]=t[s];return r},RU=(t,...e)=>{const r={...t};for(const s of e)delete r[s];return r},Sn={inputAssignment:qn.Default.inputAssignment,infiniteLivesPoke:!1,infiniteDoughnutsPoke:!1,displaySettings:{showBoundingBoxes:"none",showShadowMasks:!1,crtFilter:!1,uncolourised:!1,emulatedResolution:At()==="mobile"?"handheld":"zxSpectrum"},gameSpeed:1.2,showFps:!1,onScreenControls:At()==="mobile"||At()==="tablet",inputDirectionMode:"8-way",directionsRelativeTo:"mixed",soundSettings:{mute:!1,noFootsteps:!1}},Zb=["world","screen","mixed"];var au,mg;function tE(){if(mg)return au;mg=1;function t(s){if(Array.isArray(s))return!0;var n=s.length;return typeof n=="number"&&n>-1?n?0 in s&&n-1 in s:!0:!1}function e(s){var n=typeof s;return n==="object"?s===null?"null":t(s)?"array":s.constructor===Object?"pure-object":"object":n}function r(s,n){if(s===n||s!==s&&n!==n)return!0;var i=e(s),o=e(n);if(i!==o)return!1;if(i==="pure-object"){if(s===n)return!0;var a=Object.keys(s),l=Object.keys(n).length;if(a.length!==l)return!1;for(var c=0,u=a.length;c<u;c++){var h=a[c];if(!n.hasOwnProperty(a[c]))return!1;var d=s[h],f=n[h];if(d===s||f===n||d===n||f===s)return d===f;if(!r(d,f))return!1}return!0}else if(i==="array"){if(s.length===n.length)for(var m=0;m<s.length;m++){var y=s[m],g=n[m];if(y===s||g===n||y===n||g===s)return y===g;if(!r(y,g))return!1}else return!1;return!0}else if(i==="object"){if(s.valueOf!==Object.prototype.valueOf()&&n.valueOf!==Object.prototype.valueOf())return s.valueOf()===n.valueOf();if(s.toString!==Object.prototype.toString()&&n.toString!==Object.prototype.toString())return s.toString()===n.toString()}return!1}return au=r,au}var rE=tE();const sE=nt(rE),Qd=LA.withTypes(),X=FA.withTypes();fd.withTypes();const Xd=t=>()=>X(t);var ew=(t=>(t.uninitialized="uninitialized",t.pending="pending",t.fulfilled="fulfilled",t.rejected="rejected",t))(ew||{});function gg(t){return{status:t,isUninitialized:t==="uninitialized",isLoading:t==="pending",isSuccess:t==="fulfilled",isError:t==="rejected"}}var yg=bn;function tw(t,e){if(t===e||!(yg(t)&&yg(e)||Array.isArray(t)&&Array.isArray(e)))return e;const r=Object.keys(e),s=Object.keys(t);let n=r.length===s.length;const i=Array.isArray(e)?[]:{};for(const o of r)i[o]=tw(t[o],e[o]),n&&(n=t[o]===i[o]);return n?t:i}function mn(t){let e=0;for(const r in t)e++;return e}var Ag=t=>[].concat(...t);function nE(){return typeof document>"u"?!0:document.visibilityState!=="hidden"}function hl(t){return t!=null}function iE(){return typeof navigator>"u"||navigator.onLine===void 0?!0:navigator.onLine}function oE(t,e,r){return t.has(e)?t.get(e):t.set(e,r).get(e)}var xg=class{constructor(t,e=void 0){this.value=t,this.meta=e}},Jd=yt("__rtkq/focused"),rw=yt("__rtkq/unfocused"),Zd=yt("__rtkq/online"),sw=yt("__rtkq/offline");function ef(t){return t.type==="query"}function aE(t){return t.type==="mutation"}function tf(t){return t.type==="infinitequery"}function rf(t,e,r,s,n,i){return lE(t)?t(e,r,s,n).filter(hl).map(kh).map(i):Array.isArray(t)?t.map(kh).map(i):[]}function lE(t){return typeof t=="function"}function kh(t){return typeof t=="string"?{type:t}:t}function cE(t,e){return t.catch(e)}var ro=Symbol("forceQueryFn"),Ch=t=>typeof t[ro]=="function";function uE({serializeQueryArgs:t,queryThunk:e,infiniteQueryThunk:r,mutationThunk:s,api:n,context:i}){const o=new Map,a=new Map,{unsubscribeQueryResult:l,removeMutationResult:c,updateSubscriptionOptions:u}=n.internalActions;return{buildInitiateQuery:g,buildInitiateInfiniteQuery:A,buildInitiateMutation:b,getRunningQueryThunk:h,getRunningMutationThunk:d,getRunningQueriesThunk:f,getRunningMutationsThunk:m};function h(x,w){return q=>{const _=i.endpointDefinitions[x],V=t({queryArgs:w,endpointDefinition:_,endpointName:x});return o.get(q)?.[V]}}function d(x,w){return q=>a.get(q)?.[w]}function f(){return x=>Object.values(o.get(x)||{}).filter(hl)}function m(){return x=>Object.values(a.get(x)||{}).filter(hl)}function y(x,w){const q=(_,{subscribe:V=!0,forceRefetch:S,subscriptionOptions:k,[ro]:C,...E}={})=>(T,R)=>{const I=t({queryArgs:_,endpointDefinition:w,endpointName:x});let z;const P={...E,type:"query",subscribe:V,forceRefetch:S,subscriptionOptions:k,endpointName:x,originalArgs:_,queryCacheKey:I,[ro]:C};if(ef(w))z=e(P);else{const{direction:ue,initialPageParam:Fe}=E;z=r({...P,direction:ue,initialPageParam:Fe})}const M=n.endpoints[x].select(_),D=T(z),L=M(R()),{requestId:Q,abort:ge}=D,oe=L.requestId!==Q,se=o.get(T)?.[I],ye=()=>M(R()),ae=Object.assign(C?D.then(ye):oe&&!se?Promise.resolve(L):Promise.all([se,D]).then(ye),{arg:_,requestId:Q,subscriptionOptions:k,queryCacheKey:I,abort:ge,async unwrap(){const ue=await ae;if(ue.isError)throw ue.error;return ue.data},refetch:()=>T(q(_,{subscribe:!1,forceRefetch:!0})),unsubscribe(){V&&T(l({queryCacheKey:I,requestId:Q}))},updateSubscriptionOptions(ue){ae.subscriptionOptions=ue,T(u({endpointName:x,requestId:Q,queryCacheKey:I,options:ue}))}});if(!se&&!oe&&!C){const ue=oE(o,T,{});ue[I]=ae,ae.then(()=>{delete ue[I],mn(ue)||o.delete(T)})}return ae};return q}function g(x,w){return y(x,w)}function A(x,w){return y(x,w)}function b(x){return(w,{track:q=!0,fixedCacheKey:_}={})=>(V,S)=>{const k=s({type:"mutation",endpointName:x,originalArgs:w,track:q,fixedCacheKey:_}),C=V(k),{requestId:E,abort:T,unwrap:R}=C,I=cE(C.unwrap().then(D=>({data:D})),D=>({error:D})),z=()=>{V(c({requestId:E,fixedCacheKey:_}))},P=Object.assign(I,{arg:C.arg,requestId:E,abort:T,unwrap:R,reset:z}),M=a.get(V)||{};return a.set(V,M),M[E]=P,P.then(()=>{delete M[E],mn(M)||a.delete(V)}),_&&(M[_]=P,P.then(()=>{M[_]===P&&(delete M[_],mn(M)||a.delete(V))})),P}}}function hE(t){return t}var ma=(t={})=>({...t,[Ml]:!0});function dE({reducerPath:t,baseQuery:e,context:{endpointDefinitions:r},serializeQueryArgs:s,api:n,assertTagType:i,selectors:o}){const a=(S,k,C,E)=>(T,R)=>{const I=r[S],z=s({queryArgs:k,endpointDefinition:I,endpointName:S});if(T(n.internalActions.queryResultPatched({queryCacheKey:z,patches:C})),!E)return;const P=n.endpoints[S].select(k)(R()),M=rf(I.providesTags,P.data,void 0,k,{},i);T(n.internalActions.updateProvidedBy({queryCacheKey:z,providedTags:M}))};function l(S,k,C=0){const E=[k,...S];return C&&E.length>C?E.slice(0,-1):E}function c(S,k,C=0){const E=[...S,k];return C&&E.length>C?E.slice(1):E}const u=(S,k,C,E=!0)=>(T,R)=>{const z=n.endpoints[S].select(k)(R()),P={patches:[],inversePatches:[],undo:()=>T(n.util.patchQueryData(S,k,P.inversePatches,E))};if(z.status==="uninitialized")return P;let M;if("data"in z)if(sr(z.data)){const[D,L,Q]=sx(z.data,C);P.patches.push(...L),P.inversePatches.push(...Q),M=D}else M=C(z.data),P.patches.push({op:"replace",path:[],value:M}),P.inversePatches.push({op:"replace",path:[],value:z.data});return P.patches.length===0||T(n.util.patchQueryData(S,k,P.patches,E)),P},h=(S,k,C)=>E=>E(n.endpoints[S].initiate(k,{subscribe:!1,forceRefetch:!0,[ro]:()=>({data:C})})),d=(S,k)=>S.query&&S[k]?S[k]:hE,f=async(S,{signal:k,abort:C,rejectWithValue:E,fulfillWithValue:T,dispatch:R,getState:I,extra:z})=>{const P=r[S.endpointName];try{let M=d(P,"transformResponse");const D={signal:k,abort:C,dispatch:R,getState:I,extra:z,endpoint:S.endpointName,type:S.type,forced:S.type==="query"?m(S,I()):void 0,queryCacheKey:S.type==="query"?S.queryCacheKey:void 0},L=S.type==="query"?S[ro]:void 0;let Q;const ge=async(se,ye,ae,ue)=>{if(ye==null&&se.pages.length)return Promise.resolve({data:se});const Fe={queryArg:S.originalArgs,pageParam:ye},ar=await oe(Fe),Vt=ue?l:c;return{data:{pages:Vt(se.pages,ar.data,ae),pageParams:Vt(se.pageParams,ye,ae)}}};async function oe(se){let ye;const{extraOptions:ae}=P;if(L?ye=L():P.query?ye=await e(P.query(se),D,ae):ye=await P.queryFn(se,D,ae,Fe=>e(Fe,D,ae)),typeof process<"u",ye.error)throw new xg(ye.error,ye.meta);const ue=await M(ye.data,ye.meta,se);return{...ye,data:ue}}if(S.type==="query"&&"infiniteQueryOptions"in P){const{infiniteQueryOptions:se}=P,{maxPages:ye=1/0}=se;let ae;const ue={pages:[],pageParams:[]},Fe=o.selectQueryEntry(I(),S.queryCacheKey)?.data,Vt=m(S,I())&&!S.direction||!Fe?ue:Fe;if("direction"in S&&S.direction&&Vt.pages.length){const Qt=S.direction==="backward",Et=(Qt?nw:Eh)(se,Vt);ae=await ge(Vt,Et,ye,Qt)}else{const{initialPageParam:Qt=se.initialPageParam}=S,br=Fe?.pageParams??[],Et=br[0]??Qt,qt=br.length;ae=await ge(Vt,Et,ye),L&&(ae={data:ae.data.pages[0]});for(let lr=1;lr<qt;lr++){const wr=Eh(se,ae.data);ae=await ge(ae.data,wr,ye)}}Q=ae}else Q=await oe(S.originalArgs);return T(Q.data,ma({fulfilledTimeStamp:Date.now(),baseQueryMeta:Q.meta}))}catch(M){let D=M;if(D instanceof xg){let L=d(P,"transformErrorResponse");try{return E(await L(D.value,D.meta,S.originalArgs),ma({baseQueryMeta:D.meta}))}catch(Q){D=Q}}throw console.error(D),D}};function m(S,k){const C=o.selectQueryEntry(k,S.queryCacheKey),E=o.selectConfig(k).refetchOnMountOrArgChange,T=C?.fulfilledTimeStamp,R=S.forceRefetch??(S.subscribe&&E);return R?R===!0||(Number(new Date)-Number(T))/1e3>=R:!1}const y=()=>Ap(`${t}/executeQuery`,f,{getPendingMeta({arg:k}){const C=r[k.endpointName];return ma({startedTimeStamp:Date.now(),...tf(C)?{direction:k.direction}:{}})},condition(k,{getState:C}){const E=C(),T=o.selectQueryEntry(E,k.queryCacheKey),R=T?.fulfilledTimeStamp,I=k.originalArgs,z=T?.originalArgs,P=r[k.endpointName],M=k.direction;return Ch(k)?!0:T?.status==="pending"?!1:m(k,E)||ef(P)&&P?.forceRefetch?.({currentArg:I,previousArg:z,endpointState:T,state:E})?!0:!(R&&!M)},dispatchConditionRejection:!0}),g=y(),A=y(),b=Ap(`${t}/executeMutation`,f,{getPendingMeta(){return ma({startedTimeStamp:Date.now()})}}),x=S=>"force"in S,w=S=>"ifOlderThan"in S,q=(S,k,C)=>(E,T)=>{const R=x(C)&&C.force,I=w(C)&&C.ifOlderThan,z=(M=!0)=>{const D={forceRefetch:M,isPrefetch:!0};return n.endpoints[S].initiate(k,D)},P=n.endpoints[S].select(k)(T());if(R)E(z());else if(I){const M=P?.fulfilledTimeStamp;if(!M){E(z());return}(Number(new Date)-Number(new Date(M)))/1e3>=I&&E(z())}else E(z(!1))};function _(S){return k=>k?.meta?.arg?.endpointName===S}function V(S,k){return{matchPending:Ii(qd(S),_(k)),matchFulfilled:Ii(Zr(S),_(k)),matchRejected:Ii(wn(S),_(k))}}return{queryThunk:g,mutationThunk:b,infiniteQueryThunk:A,prefetch:q,updateQueryData:u,upsertQueryData:h,patchQueryData:a,buildMatchThunkActions:V}}function Eh(t,{pages:e,pageParams:r}){const s=e.length-1;return t.getNextPageParam(e[s],e,r[s],r)}function nw(t,{pages:e,pageParams:r}){return t.getPreviousPageParam?.(e[0],e,r[0],r)}function iw(t,e,r,s){return rf(r[t.meta.arg.endpointName][e],Zr(t)?t.payload:void 0,jl(t)?t.payload:void 0,t.meta.arg.originalArgs,"baseQueryMeta"in t.meta?t.meta.baseQueryMeta:void 0,s)}function ga(t,e,r){const s=t[e];s&&r(s)}function so(t){return("arg"in t?t.arg.fixedCacheKey:t.fixedCacheKey)??t.requestId}function bg(t,e,r){const s=t[so(e)];s&&r(s)}var di={};function fE({reducerPath:t,queryThunk:e,mutationThunk:r,serializeQueryArgs:s,context:{endpointDefinitions:n,apiUid:i,extractRehydrationInfo:o,hasRehydrationInfo:a},assertTagType:l,config:c}){const u=yt(`${t}/resetApiState`);function h(V,S,k,C){V[S.queryCacheKey]??={status:"uninitialized",endpointName:S.endpointName},ga(V,S.queryCacheKey,E=>{E.status="pending",E.requestId=k&&E.requestId?E.requestId:C.requestId,S.originalArgs!==void 0&&(E.originalArgs=S.originalArgs),E.startedTimeStamp=C.startedTimeStamp;const T=n[C.arg.endpointName];tf(T)&&"direction"in S&&(E.direction=S.direction)})}function d(V,S,k,C){ga(V,S.arg.queryCacheKey,E=>{if(E.requestId!==S.requestId&&!C)return;const{merge:T}=n[S.arg.endpointName];if(E.status="fulfilled",T)if(E.data!==void 0){const{fulfilledTimeStamp:R,arg:I,baseQueryMeta:z,requestId:P}=S;let M=Dn(E.data,D=>T(D,k,{arg:I.originalArgs,baseQueryMeta:z,fulfilledTimeStamp:R,requestId:P}));E.data=M}else E.data=k;else E.data=n[S.arg.endpointName].structuralSharing??!0?tw(mr(E.data)?Av(E.data):E.data,k):k;delete E.error,E.fulfilledTimeStamp=S.fulfilledTimeStamp})}const f=Sr({name:`${t}/queries`,initialState:di,reducers:{removeQueryResult:{reducer(V,{payload:{queryCacheKey:S}}){delete V[S]},prepare:ti()},cacheEntriesUpserted:{reducer(V,S){for(const k of S.payload){const{queryDescription:C,value:E}=k;h(V,C,!0,{arg:C,requestId:S.meta.requestId,startedTimeStamp:S.meta.timestamp}),d(V,{arg:C,requestId:S.meta.requestId,fulfilledTimeStamp:S.meta.timestamp,baseQueryMeta:{}},E,!0)}},prepare:V=>({payload:V.map(C=>{const{endpointName:E,arg:T,value:R}=C,I=n[E];return{queryDescription:{type:"query",endpointName:E,originalArgs:C.arg,queryCacheKey:s({queryArgs:T,endpointDefinition:I,endpointName:E})},value:R}}),meta:{[Ml]:!0,requestId:vo(),timestamp:Date.now()}})},queryResultPatched:{reducer(V,{payload:{queryCacheKey:S,patches:k}}){ga(V,S,C=>{C.data=hp(C.data,k.concat())})},prepare:ti()}},extraReducers(V){V.addCase(e.pending,(S,{meta:k,meta:{arg:C}})=>{const E=Ch(C);h(S,C,E,k)}).addCase(e.fulfilled,(S,{meta:k,payload:C})=>{const E=Ch(k.arg);d(S,k,C,E)}).addCase(e.rejected,(S,{meta:{condition:k,arg:C,requestId:E},error:T,payload:R})=>{ga(S,C.queryCacheKey,I=>{if(!k){if(I.requestId!==E)return;I.status="rejected",I.error=R??T}})}).addMatcher(a,(S,k)=>{const{queries:C}=o(k);for(const[E,T]of Object.entries(C))(T?.status==="fulfilled"||T?.status==="rejected")&&(S[E]=T)})}}),m=Sr({name:`${t}/mutations`,initialState:di,reducers:{removeMutationResult:{reducer(V,{payload:S}){const k=so(S);k in V&&delete V[k]},prepare:ti()}},extraReducers(V){V.addCase(r.pending,(S,{meta:k,meta:{requestId:C,arg:E,startedTimeStamp:T}})=>{E.track&&(S[so(k)]={requestId:C,status:"pending",endpointName:E.endpointName,startedTimeStamp:T})}).addCase(r.fulfilled,(S,{payload:k,meta:C})=>{C.arg.track&&bg(S,C,E=>{E.requestId===C.requestId&&(E.status="fulfilled",E.data=k,E.fulfilledTimeStamp=C.fulfilledTimeStamp)})}).addCase(r.rejected,(S,{payload:k,error:C,meta:E})=>{E.arg.track&&bg(S,E,T=>{T.requestId===E.requestId&&(T.status="rejected",T.error=k??C)})}).addMatcher(a,(S,k)=>{const{mutations:C}=o(k);for(const[E,T]of Object.entries(C))(T?.status==="fulfilled"||T?.status==="rejected")&&E!==T?.requestId&&(S[E]=T)})}}),y=Sr({name:`${t}/invalidation`,initialState:di,reducers:{updateProvidedBy:{reducer(V,S){const{queryCacheKey:k,providedTags:C}=S.payload;for(const E of Object.values(V))for(const T of Object.values(E)){const R=T.indexOf(k);R!==-1&&T.splice(R,1)}for(const{type:E,id:T}of C){const R=(V[E]??={})[T||"__internal_without_id"]??=[];R.includes(k)||R.push(k)}},prepare:ti()}},extraReducers(V){V.addCase(f.actions.removeQueryResult,(S,{payload:{queryCacheKey:k}})=>{for(const C of Object.values(S))for(const E of Object.values(C)){const T=E.indexOf(k);T!==-1&&E.splice(T,1)}}).addMatcher(a,(S,k)=>{const{provided:C}=o(k);for(const[E,T]of Object.entries(C))for(const[R,I]of Object.entries(T)){const z=(S[E]??={})[R||"__internal_without_id"]??=[];for(const P of I)z.includes(P)||z.push(P)}}).addMatcher(gr(Zr(e),jl(e)),(S,k)=>{g(S,k)}).addMatcher(f.actions.cacheEntriesUpserted.match,(S,k)=>{for(const{queryDescription:C,value:E}of k.payload)g(S,{type:"UNKNOWN",payload:E,meta:{requestStatus:"fulfilled",requestId:"UNKNOWN",arg:C}})})}});function g(V,S){const k=iw(S,"providesTags",n,l),{queryCacheKey:C}=S.meta.arg;y.caseReducers.updateProvidedBy(V,y.actions.updateProvidedBy({queryCacheKey:C,providedTags:k}))}const A=Sr({name:`${t}/subscriptions`,initialState:di,reducers:{updateSubscriptionOptions(V,S){},unsubscribeQueryResult(V,S){},internal_getRTKQSubscriptions(){}}}),b=Sr({name:`${t}/internalSubscriptions`,initialState:di,reducers:{subscriptionsUpdated:{reducer(V,S){return hp(V,S.payload)},prepare:ti()}}}),x=Sr({name:`${t}/config`,initialState:{online:iE(),focused:nE(),middlewareRegistered:!1,...c},reducers:{middlewareRegistered(V,{payload:S}){V.middlewareRegistered=V.middlewareRegistered==="conflict"||i!==S?"conflict":!0}},extraReducers:V=>{V.addCase(Zd,S=>{S.online=!0}).addCase(sw,S=>{S.online=!1}).addCase(Jd,S=>{S.focused=!0}).addCase(rw,S=>{S.focused=!1}).addMatcher(a,S=>({...S}))}}),w=Ad({queries:f.reducer,mutations:m.reducer,provided:y.reducer,subscriptions:b.reducer,config:x.reducer}),q=(V,S)=>w(u.match(S)?void 0:V,S),_={...x.actions,...f.actions,...A.actions,...b.actions,...m.actions,...y.actions,resetApiState:u};return{reducer:q,actions:_}}var kr=Symbol.for("RTKQ/skipToken"),ow={status:"uninitialized"},wg=Dn(ow,()=>{}),Vg=Dn(ow,()=>{});function pE({serializeQueryArgs:t,reducerPath:e,createSelector:r}){const s=x=>wg,n=x=>Vg;return{buildQuerySelector:d,buildInfiniteQuerySelector:f,buildMutationSelector:m,selectInvalidatedBy:y,selectCachedArgsForQuery:g,selectApiState:o,selectQueries:a,selectMutations:c,selectQueryEntry:l,selectConfig:u};function i(x){return{...x,...gg(x.status)}}function o(x){return x[e]}function a(x){return o(x)?.queries}function l(x,w){return a(x)?.[w]}function c(x){return o(x)?.mutations}function u(x){return o(x)?.config}function h(x,w,q){return _=>{if(_===kr)return r(s,q);const V=t({queryArgs:_,endpointDefinition:w,endpointName:x});return r(k=>l(k,V)??wg,q)}}function d(x,w){return h(x,w,i)}function f(x,w){const{infiniteQueryOptions:q}=w;function _(V){const S={...V,...gg(V.status)},{isLoading:k,isError:C,direction:E}=S,T=E==="forward",R=E==="backward";return{...S,hasNextPage:A(q,S.data),hasPreviousPage:b(q,S.data),isFetchingNextPage:k&&T,isFetchingPreviousPage:k&&R,isFetchNextPageError:C&&T,isFetchPreviousPageError:C&&R}}return h(x,w,_)}function m(){return x=>{let w;return typeof x=="object"?w=so(x)??kr:w=x,r(w===kr?n:V=>o(V)?.mutations?.[w]??Vg,i)}}function y(x,w){const q=x[e],_=new Set;for(const V of w.filter(hl).map(kh)){const S=q.provided[V.type];if(!S)continue;let k=(V.id!==void 0?S[V.id]:Ag(Object.values(S)))??[];for(const C of k)_.add(C)}return Ag(Array.from(_.values()).map(V=>{const S=q.queries[V];return S?[{queryCacheKey:V,endpointName:S.endpointName,originalArgs:S.originalArgs}]:[]}))}function g(x,w){return Object.values(a(x)).filter(q=>q?.endpointName===w&&q.status!=="uninitialized").map(q=>q.originalArgs)}function A(x,w){return w?Eh(x,w)!=null:!1}function b(x,w){return!w||!x.getPreviousPageParam?!1:nw(x,w)!=null}}var qg=WeakMap?new WeakMap:void 0,Ph=({endpointName:t,queryArgs:e})=>{let r="";const s=qg?.get(e);if(typeof s=="string")r=s;else{const n=JSON.stringify(e,(i,o)=>(o=typeof o=="bigint"?{$bigint:o.toString()}:o,o=bn(o)?Object.keys(o).sort().reduce((a,l)=>(a[l]=o[l],a),{}):o,o));bn(e)&&qg?.set(e,n),r=n}return`${t}(${r})`};function aw(...t){return function(r){const s=rl(c=>r.extractRehydrationInfo?.(c,{reducerPath:r.reducerPath??"api"})),n={reducerPath:"api",keepUnusedDataFor:60,refetchOnMountOrArgChange:!1,refetchOnFocus:!1,refetchOnReconnect:!1,invalidationBehavior:"delayed",...r,extractRehydrationInfo:s,serializeQueryArgs(c){let u=Ph;if("serializeQueryArgs"in c.endpointDefinition){const h=c.endpointDefinition.serializeQueryArgs;u=d=>{const f=h(d);return typeof f=="string"?f:Ph({...d,queryArgs:f})}}else r.serializeQueryArgs&&(u=r.serializeQueryArgs);return u(c)},tagTypes:[...r.tagTypes||[]]},i={endpointDefinitions:{},batch(c){c()},apiUid:vo(),extractRehydrationInfo:s,hasRehydrationInfo:rl(c=>s(c)!=null)},o={injectEndpoints:l,enhanceEndpoints({addTagTypes:c,endpoints:u}){if(c)for(const h of c)n.tagTypes.includes(h)||n.tagTypes.push(h);if(u)for(const[h,d]of Object.entries(u))typeof d=="function"?d(i.endpointDefinitions[h]):Object.assign(i.endpointDefinitions[h]||{},d);return o}},a=t.map(c=>c.init(o,n,i));function l(c){const u=c.endpoints({query:h=>({...h,type:"query"}),mutation:h=>({...h,type:"mutation"}),infiniteQuery:h=>({...h,type:"infinitequery"})});for(const[h,d]of Object.entries(u)){if(c.overrideExisting!==!0&&h in i.endpointDefinitions){if(c.overrideExisting==="throw")throw new Error(Xe(39));continue}i.endpointDefinitions[h]=d;for(const f of a)f.injectEndpoint(h,d)}return o}return o.injectEndpoints({endpoints:r.endpoints})}}function mE(){return function(){throw new Error(Xe(33))}}function vr(t,...e){return Object.assign(t,...e)}var gE=({api:t,queryThunk:e,internalState:r})=>{const s=`${t.reducerPath}/subscriptions`;let n=null,i=null;const{updateSubscriptionOptions:o,unsubscribeQueryResult:a}=t.internalActions,l=(f,m)=>{if(o.match(m)){const{queryCacheKey:g,requestId:A,options:b}=m.payload;return f?.[g]?.[A]&&(f[g][A]=b),!0}if(a.match(m)){const{queryCacheKey:g,requestId:A}=m.payload;return f[g]&&delete f[g][A],!0}if(t.internalActions.removeQueryResult.match(m))return delete f[m.payload.queryCacheKey],!0;if(e.pending.match(m)){const{meta:{arg:g,requestId:A}}=m,b=f[g.queryCacheKey]??={};return b[`${A}_running`]={},g.subscribe&&(b[A]=g.subscriptionOptions??b[A]??{}),!0}let y=!1;if(e.fulfilled.match(m)||e.rejected.match(m)){const g=f[m.meta.arg.queryCacheKey]||{},A=`${m.meta.requestId}_running`;y||=!!g[A],delete g[A]}if(e.rejected.match(m)){const{meta:{condition:g,arg:A,requestId:b}}=m;if(g&&A.subscribe){const x=f[A.queryCacheKey]??={};x[b]=A.subscriptionOptions??x[b]??{},y=!0}}return y},c=()=>r.currentSubscriptions,d={getSubscriptions:c,getSubscriptionCount:f=>{const y=c()[f]??{};return mn(y)},isRequestSubscribed:(f,m)=>!!c()?.[f]?.[m]};return(f,m)=>{if(n||(n=JSON.parse(JSON.stringify(r.currentSubscriptions))),t.util.resetApiState.match(f))return n=r.currentSubscriptions={},i=null,[!0,!1];if(t.internalActions.internal_getRTKQSubscriptions.match(f))return[!1,d];const y=l(r.currentSubscriptions,f);let g=!0;if(y){i||(i=setTimeout(()=>{const x=JSON.parse(JSON.stringify(r.currentSubscriptions)),[,w]=sx(n,()=>x);m.next(t.internalActions.subscriptionsUpdated(w)),n=x,i=null},500));const A=typeof f.type=="string"&&!!f.type.startsWith(s),b=e.rejected.match(f)&&f.meta.condition&&!!f.meta.arg.subscribe;g=!A&&!b}return[g,!1]}};function yE(t){for(const e in t)return!1;return!0}var AE=2147483647/1e3-1,xE=({reducerPath:t,api:e,queryThunk:r,context:s,internalState:n,selectors:{selectQueryEntry:i,selectConfig:o}})=>{const{removeQueryResult:a,unsubscribeQueryResult:l,cacheEntriesUpserted:c}=e.internalActions,u=gr(l.match,r.fulfilled,r.rejected,c.match);function h(g){const A=n.currentSubscriptions[g];return!!A&&!yE(A)}const d={},f=(g,A,b)=>{const x=A.getState(),w=o(x);if(u(g)){let q;if(c.match(g))q=g.payload.map(_=>_.queryDescription.queryCacheKey);else{const{queryCacheKey:_}=l.match(g)?g.payload:g.meta.arg;q=[_]}m(q,A,w)}if(e.util.resetApiState.match(g))for(const[q,_]of Object.entries(d))_&&clearTimeout(_),delete d[q];if(s.hasRehydrationInfo(g)){const{queries:q}=s.extractRehydrationInfo(g);m(Object.keys(q),A,w)}};function m(g,A,b){const x=A.getState();for(const w of g){const q=i(x,w);y(w,q?.endpointName,A,b)}}function y(g,A,b,x){const q=s.endpointDefinitions[A]?.keepUnusedDataFor??x.keepUnusedDataFor;if(q===1/0)return;const _=Math.max(0,Math.min(q,AE));if(!h(g)){const V=d[g];V&&clearTimeout(V),d[g]=setTimeout(()=>{h(g)||b.dispatch(a({queryCacheKey:g})),delete d[g]},_*1e3)}}return f},vg=new Error("Promise never resolved before cacheEntryRemoved."),bE=({api:t,reducerPath:e,context:r,queryThunk:s,mutationThunk:n,internalState:i,selectors:{selectQueryEntry:o,selectApiState:a}})=>{const l=ih(s),c=ih(n),u=Zr(s,n),h={};function d(A,b,x){const w=h[A];w?.valueResolved&&(w.valueResolved({data:b,meta:x}),delete w.valueResolved)}function f(A){const b=h[A];b&&(delete h[A],b.cacheEntryRemoved())}const m=(A,b,x)=>{const w=y(A);function q(_,V,S,k){const C=o(x,V),E=o(b.getState(),V);!C&&E&&g(_,k,V,b,S)}if(s.pending.match(A))q(A.meta.arg.endpointName,w,A.meta.requestId,A.meta.arg.originalArgs);else if(t.internalActions.cacheEntriesUpserted.match(A))for(const{queryDescription:_,value:V}of A.payload){const{endpointName:S,originalArgs:k,queryCacheKey:C}=_;q(S,C,A.meta.requestId,k),d(C,V,{})}else if(n.pending.match(A))b.getState()[e].mutations[w]&&g(A.meta.arg.endpointName,A.meta.arg.originalArgs,w,b,A.meta.requestId);else if(u(A))d(w,A.payload,A.meta.baseQueryMeta);else if(t.internalActions.removeQueryResult.match(A)||t.internalActions.removeMutationResult.match(A))f(w);else if(t.util.resetApiState.match(A))for(const _ of Object.keys(h))f(_)};function y(A){return l(A)?A.meta.arg.queryCacheKey:c(A)?A.meta.arg.fixedCacheKey??A.meta.requestId:t.internalActions.removeQueryResult.match(A)?A.payload.queryCacheKey:t.internalActions.removeMutationResult.match(A)?so(A.payload):""}function g(A,b,x,w,q){const _=r.endpointDefinitions[A],V=_?.onCacheEntryAdded;if(!V)return;const S={},k=new Promise(z=>{S.cacheEntryRemoved=z}),C=Promise.race([new Promise(z=>{S.valueResolved=z}),k.then(()=>{throw vg})]);C.catch(()=>{}),h[x]=S;const E=t.endpoints[A].select(_.type==="query"?b:x),T=w.dispatch((z,P,M)=>M),R={...w,getCacheEntry:()=>E(w.getState()),requestId:q,extra:T,updateCachedData:_.type==="query"?z=>w.dispatch(t.util.updateQueryData(A,b,z)):void 0,cacheDataLoaded:C,cacheEntryRemoved:k},I=V(b,R);Promise.resolve(I).catch(z=>{if(z!==vg)throw z})}return m},wE=({api:t,context:{apiUid:e},reducerPath:r})=>(s,n)=>{t.util.resetApiState.match(s)&&n.dispatch(t.internalActions.middlewareRegistered(e))},VE=({reducerPath:t,context:e,context:{endpointDefinitions:r},mutationThunk:s,queryThunk:n,api:i,assertTagType:o,refetchQuery:a,internalState:l})=>{const{removeQueryResult:c}=i.internalActions,u=gr(Zr(s),jl(s)),h=gr(Zr(s,n),wn(s,n));let d=[];const f=(g,A)=>{u(g)?y(iw(g,"invalidatesTags",r,o),A):h(g)?y([],A):i.util.invalidateTags.match(g)&&y(rf(g.payload,void 0,void 0,void 0,void 0,o),A)};function m(g){const{queries:A,mutations:b}=g;for(const x of[A,b])for(const w in x)if(x[w]?.status==="pending")return!0;return!1}function y(g,A){const b=A.getState(),x=b[t];if(d.push(...g),x.config.invalidationBehavior==="delayed"&&m(x))return;const w=d;if(d=[],w.length===0)return;const q=i.util.selectInvalidatedBy(b,w);e.batch(()=>{const _=Array.from(q.values());for(const{queryCacheKey:V}of _){const S=x.queries[V],k=l.currentSubscriptions[V]??{};S&&(mn(k)===0?A.dispatch(c({queryCacheKey:V})):S.status!=="uninitialized"&&A.dispatch(a(S)))}})}return f},qE=({reducerPath:t,queryThunk:e,api:r,refetchQuery:s,internalState:n})=>{const i={},o=(d,f)=>{(r.internalActions.updateSubscriptionOptions.match(d)||r.internalActions.unsubscribeQueryResult.match(d))&&l(d.payload,f),(e.pending.match(d)||e.rejected.match(d)&&d.meta.condition)&&l(d.meta.arg,f),(e.fulfilled.match(d)||e.rejected.match(d)&&!d.meta.condition)&&a(d.meta.arg,f),r.util.resetApiState.match(d)&&u()};function a({queryCacheKey:d},f){const m=f.getState()[t],y=m.queries[d],g=n.currentSubscriptions[d];if(!y||y.status==="uninitialized")return;const{lowestPollingInterval:A,skipPollingIfUnfocused:b}=h(g);if(!Number.isFinite(A))return;const x=i[d];x?.timeout&&(clearTimeout(x.timeout),x.timeout=void 0);const w=Date.now()+A;i[d]={nextPollTimestamp:w,pollingInterval:A,timeout:setTimeout(()=>{(m.config.focused||!b)&&f.dispatch(s(y)),a({queryCacheKey:d},f)},A)}}function l({queryCacheKey:d},f){const y=f.getState()[t].queries[d],g=n.currentSubscriptions[d];if(!y||y.status==="uninitialized")return;const{lowestPollingInterval:A}=h(g);if(!Number.isFinite(A)){c(d);return}const b=i[d],x=Date.now()+A;(!b||x<b.nextPollTimestamp)&&a({queryCacheKey:d},f)}function c(d){const f=i[d];f?.timeout&&clearTimeout(f.timeout),delete i[d]}function u(){for(const d of Object.keys(i))c(d)}function h(d={}){let f=!1,m=Number.POSITIVE_INFINITY;for(let y in d)d[y].pollingInterval&&(m=Math.min(d[y].pollingInterval,m),f=d[y].skipPollingIfUnfocused||f);return{lowestPollingInterval:m,skipPollingIfUnfocused:f}}return o},vE=({api:t,context:e,queryThunk:r,mutationThunk:s})=>{const n=qd(r,s),i=wn(r,s),o=Zr(r,s),a={};return(c,u)=>{if(n(c)){const{requestId:h,arg:{endpointName:d,originalArgs:f}}=c.meta,m=e.endpointDefinitions[d],y=m?.onQueryStarted;if(y){const g={},A=new Promise((q,_)=>{g.resolve=q,g.reject=_});A.catch(()=>{}),a[h]=g;const b=t.endpoints[d].select(m.type==="query"?f:h),x=u.dispatch((q,_,V)=>V),w={...u,getCacheEntry:()=>b(u.getState()),requestId:h,extra:x,updateCachedData:m.type==="query"?q=>u.dispatch(t.util.updateQueryData(d,f,q)):void 0,queryFulfilled:A};y(f,w)}}else if(o(c)){const{requestId:h,baseQueryMeta:d}=c.meta;a[h]?.resolve({data:c.payload,meta:d}),delete a[h]}else if(i(c)){const{requestId:h,rejectedWithValue:d,baseQueryMeta:f}=c.meta;a[h]?.reject({error:c.payload??c.error,isUnhandledError:!d,meta:f}),delete a[h]}}},_E=({reducerPath:t,context:e,api:r,refetchQuery:s,internalState:n})=>{const{removeQueryResult:i}=r.internalActions,o=(l,c)=>{Jd.match(l)&&a(c,"refetchOnFocus"),Zd.match(l)&&a(c,"refetchOnReconnect")};function a(l,c){const u=l.getState()[t],h=u.queries,d=n.currentSubscriptions;e.batch(()=>{for(const f of Object.keys(d)){const m=h[f],y=d[f];if(!y||!m)continue;(Object.values(y).some(A=>A[c]===!0)||Object.values(y).every(A=>A[c]===void 0)&&u.config[c])&&(mn(y)===0?l.dispatch(i({queryCacheKey:f})):m.status!=="uninitialized"&&l.dispatch(s(m)))}})}return o};function SE(t){const{reducerPath:e,queryThunk:r,api:s,context:n}=t,{apiUid:i}=n,o={invalidateTags:yt(`${e}/invalidateTags`)},a=h=>h.type.startsWith(`${e}/`),l=[wE,xE,VE,qE,bE,vE];return{middleware:h=>{let d=!1;const m={...t,internalState:{currentSubscriptions:{}},refetchQuery:u,isThisApiSliceAction:a},y=l.map(b=>b(m)),g=gE(m),A=_E(m);return b=>x=>{if(!xd(x))return b(x);d||(d=!0,h.dispatch(s.internalActions.middlewareRegistered(i)));const w={...h,next:b},q=h.getState(),[_,V]=g(x,w,q);let S;if(_?S=b(x):S=V,h.getState()[e]&&(A(x,w,q),a(x)||n.hasRehydrationInfo(x)))for(const k of y)k(x,w,q);return S}},actions:o};function u(h){return t.api.endpoints[h.endpointName].initiate(h.originalArgs,{subscribe:!1,forceRefetch:!0})}}var _g=Symbol(),lw=({createSelector:t=Rl}={})=>({name:_g,init(e,{baseQuery:r,tagTypes:s,reducerPath:n,serializeQueryArgs:i,keepUnusedDataFor:o,refetchOnMountOrArgChange:a,refetchOnFocus:l,refetchOnReconnect:c,invalidationBehavior:u},h){Cv();const d=oe=>oe;Object.assign(e,{reducerPath:n,endpoints:{},internalActions:{onOnline:Zd,onOffline:sw,onFocus:Jd,onFocusLost:rw},util:{}});const f=pE({serializeQueryArgs:i,reducerPath:n,createSelector:t}),{selectInvalidatedBy:m,selectCachedArgsForQuery:y,buildQuerySelector:g,buildInfiniteQuerySelector:A,buildMutationSelector:b}=f;vr(e.util,{selectInvalidatedBy:m,selectCachedArgsForQuery:y});const{queryThunk:x,infiniteQueryThunk:w,mutationThunk:q,patchQueryData:_,updateQueryData:V,upsertQueryData:S,prefetch:k,buildMatchThunkActions:C}=dE({baseQuery:r,reducerPath:n,context:h,api:e,serializeQueryArgs:i,assertTagType:d,selectors:f}),{reducer:E,actions:T}=fE({context:h,queryThunk:x,mutationThunk:q,serializeQueryArgs:i,reducerPath:n,assertTagType:d,config:{refetchOnFocus:l,refetchOnReconnect:c,refetchOnMountOrArgChange:a,keepUnusedDataFor:o,reducerPath:n,invalidationBehavior:u}});vr(e.util,{patchQueryData:_,updateQueryData:V,upsertQueryData:S,prefetch:k,resetApiState:T.resetApiState,upsertQueryEntries:T.cacheEntriesUpserted}),vr(e.internalActions,T);const{middleware:R,actions:I}=SE({reducerPath:n,context:h,queryThunk:x,mutationThunk:q,infiniteQueryThunk:w,api:e,assertTagType:d,selectors:f});vr(e.util,I),vr(e,{reducer:E,middleware:R});const{buildInitiateQuery:z,buildInitiateInfiniteQuery:P,buildInitiateMutation:M,getRunningMutationThunk:D,getRunningMutationsThunk:L,getRunningQueriesThunk:Q,getRunningQueryThunk:ge}=uE({queryThunk:x,mutationThunk:q,infiniteQueryThunk:w,api:e,serializeQueryArgs:i,context:h});return vr(e.util,{getRunningMutationThunk:D,getRunningMutationsThunk:L,getRunningQueryThunk:ge,getRunningQueriesThunk:Q}),{name:_g,injectEndpoint(oe,se){const ye=e,ae=ye.endpoints[oe]??={};ef(se)&&vr(ae,{name:oe,select:g(oe,se),initiate:z(oe,se)},C(x,oe)),aE(se)&&vr(ae,{name:oe,select:b(),initiate:M(oe)},C(q,oe)),tf(se)&&vr(ae,{name:oe,select:A(oe,se),initiate:P(oe,se)},C(x,oe))}}}});lw();function ya(t){return t.replace(t[0],t[0].toUpperCase())}function kE(t){return t.type==="query"}function CE(t){return t.type==="mutation"}function cw(t){return t.type==="infinitequery"}function fi(t,...e){return Object.assign(t,...e)}var lu=Symbol();function Sg(t,e,r,s){const n=v.useMemo(()=>({queryArgs:t,serialized:typeof t=="object"?e({queryArgs:t,endpointDefinition:r,endpointName:s}):t}),[t,e,r,s]),i=v.useRef(n);return v.useEffect(()=>{i.current.serialized!==n.serialized&&(i.current=n)},[n]),i.current.serialized===n.serialized?i.current.queryArgs:t}function Aa(t){const e=v.useRef(t);return v.useEffect(()=>{Ri(e.current,t)||(e.current=t)},[t]),Ri(e.current,t)?e.current:t}var EE=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",PE=EE(),TE=()=>typeof navigator<"u"&&navigator.product==="ReactNative",RE=TE(),ME=()=>PE||RE?v.useLayoutEffect:v.useEffect,IE=ME(),kg=t=>t.isUninitialized?{...t,isUninitialized:!1,isFetching:!0,isLoading:t.data===void 0,status:ew.pending}:t;function cu(t,...e){const r={};return e.forEach(s=>{r[s]=t[s]}),r}var uu=["data","status","isLoading","isSuccess","isError","error"];function jE({api:t,moduleOptions:{batch:e,hooks:{useDispatch:r,useSelector:s,useStore:n},unstable__sideEffectsInRender:i,createSelector:o},serializeQueryArgs:a,context:l}){const c=i?w=>w():v.useEffect;return{buildQueryHooks:A,buildInfiniteQueryHooks:b,buildMutationHook:x,usePrefetch:d};function u(w,q,_){if(q?.endpointName&&w.isUninitialized){const{endpointName:T}=q,R=l.endpointDefinitions[T];_!==kr&&a({queryArgs:q.originalArgs,endpointDefinition:R,endpointName:T})===a({queryArgs:_,endpointDefinition:R,endpointName:T})&&(q=void 0)}let V=w.isSuccess?w.data:q?.data;V===void 0&&(V=w.data);const S=V!==void 0,k=w.isLoading,C=(!q||q.isLoading||q.isUninitialized)&&!S&&k,E=w.isSuccess||S&&(k&&!q?.isError||w.isUninitialized);return{...w,data:V,currentData:w.data,isFetching:k,isLoading:C,isSuccess:E}}function h(w,q,_){if(q?.endpointName&&w.isUninitialized){const{endpointName:T}=q,R=l.endpointDefinitions[T];a({queryArgs:q.originalArgs,endpointDefinition:R,endpointName:T})===a({queryArgs:_,endpointDefinition:R,endpointName:T})&&(q=void 0)}let V=w.isSuccess?w.data:q?.data;V===void 0&&(V=w.data);const S=V!==void 0,k=w.isLoading,C=(!q||q.isLoading||q.isUninitialized)&&!S&&k,E=w.isSuccess||k&&S;return{...w,data:V,currentData:w.data,isFetching:k,isLoading:C,isSuccess:E}}function d(w,q){const _=r(),V=Aa(q);return v.useCallback((S,k)=>_(t.util.prefetch(w,S,{...V,...k})),[w,_,V])}function f(w,q,{refetchOnReconnect:_,refetchOnFocus:V,refetchOnMountOrArgChange:S,skip:k=!1,pollingInterval:C=0,skipPollingIfUnfocused:E=!1,...T}={}){const{initiate:R}=t.endpoints[w],I=r(),z=v.useRef(void 0);if(!z.current){const ue=I(t.internalActions.internal_getRTKQSubscriptions());z.current=ue}const P=Sg(k?kr:q,Ph,l.endpointDefinitions[w],w),M=Aa({refetchOnReconnect:_,refetchOnFocus:V,pollingInterval:C,skipPollingIfUnfocused:E}),D=v.useRef(!1),L=T.initialPageParam,Q=Aa(L),ge=v.useRef(void 0);let{queryCacheKey:oe,requestId:se}=ge.current||{},ye=!1;oe&&se&&(ye=z.current.isRequestSubscribed(oe,se));const ae=!ye&&D.current;return c(()=>{D.current=ye}),c(()=>{ae&&(ge.current=void 0)},[ae]),c(()=>{const ue=ge.current;if(P===kr){ue?.unsubscribe(),ge.current=void 0;return}const Fe=ge.current?.subscriptionOptions;if(!ue||ue.arg!==P){ue?.unsubscribe();const ar=I(R(P,{subscriptionOptions:M,forceRefetch:S,...cw(l.endpointDefinitions[w])?{initialPageParam:Q}:{}}));ge.current=ar}else M!==Fe&&ue.updateSubscriptionOptions(M)},[I,R,S,P,M,ae,Q,w]),[ge,I,R,M]}function m(w,q){return(V,{skip:S=!1,selectFromResult:k}={})=>{const{select:C}=t.endpoints[w],E=Sg(S?kr:V,a,l.endpointDefinitions[w],w),T=v.useRef(void 0),R=v.useMemo(()=>o([C(E),(D,L)=>L,D=>E],q,{memoizeOptions:{resultEqualityCheck:Ri}}),[C,E]),I=v.useMemo(()=>k?o([R],k,{devModeChecks:{identityFunctionCheck:"never"}}):R,[R,k]),z=s(D=>I(D,T.current),Ri),P=n(),M=R(P.getState(),T.current);return IE(()=>{T.current=M},[M]),z}}function y(w){v.useEffect(()=>()=>{w.current?.unsubscribe?.(),w.current=void 0},[w])}function g(w){if(!w.current)throw new Error(Xe(38));return w.current.refetch()}function A(w){const q=(S,k={})=>{const[C]=f(w,S,k);return y(C),v.useMemo(()=>({refetch:()=>g(C)}),[C])},_=({refetchOnReconnect:S,refetchOnFocus:k,pollingInterval:C=0,skipPollingIfUnfocused:E=!1}={})=>{const{initiate:T}=t.endpoints[w],R=r(),[I,z]=v.useState(lu),P=v.useRef(void 0),M=Aa({refetchOnReconnect:S,refetchOnFocus:k,pollingInterval:C,skipPollingIfUnfocused:E});c(()=>{const ge=P.current?.subscriptionOptions;M!==ge&&P.current?.updateSubscriptionOptions(M)},[M]);const D=v.useRef(M);c(()=>{D.current=M},[M]);const L=v.useCallback(function(ge,oe=!1){let se;return e(()=>{P.current?.unsubscribe(),P.current=se=R(T(ge,{subscriptionOptions:D.current,forceRefetch:!oe})),z(ge)}),se},[R,T]),Q=v.useCallback(()=>{P.current?.queryCacheKey&&R(t.internalActions.removeQueryResult({queryCacheKey:P.current?.queryCacheKey}))},[R]);return v.useEffect(()=>()=>{P?.current?.unsubscribe()},[]),v.useEffect(()=>{I!==lu&&!P.current&&L(I,!0)},[I,L]),v.useMemo(()=>[L,I,{reset:Q}],[L,I,Q])},V=m(w,u);return{useQueryState:V,useQuerySubscription:q,useLazyQuerySubscription:_,useLazyQuery(S){const[k,C,{reset:E}]=_(S),T=V(C,{...S,skip:C===lu}),R=v.useMemo(()=>({lastArg:C}),[C]);return v.useMemo(()=>[k,{...T,reset:E},R],[k,T,E,R])},useQuery(S,k){const C=q(S,k),E=V(S,{selectFromResult:S===kr||k?.skip?void 0:kg,...k}),T=cu(E,...uu);return v.useDebugValue(T),v.useMemo(()=>({...E,...C}),[E,C])}}}function b(w){const q=(V,S={})=>{const[k,C,E,T]=f(w,V,S),R=v.useRef(T);c(()=>{R.current=T},[T]);const I=v.useCallback(function(z,P){let M;return e(()=>{k.current?.unsubscribe(),k.current=M=C(E(z,{subscriptionOptions:R.current,direction:P}))}),M},[k,C,E]);return y(k),v.useMemo(()=>({trigger:I,refetch:()=>g(k),fetchNextPage:()=>I(V,"forward"),fetchPreviousPage:()=>I(V,"backward")}),[k,I,V])},_=m(w,h);return{useInfiniteQueryState:_,useInfiniteQuerySubscription:q,useInfiniteQuery(V,S){const{refetch:k,fetchNextPage:C,fetchPreviousPage:E}=q(V,S),T=_(V,{selectFromResult:V===kr||S?.skip?void 0:kg,...S}),R=cu(T,...uu,"hasNextPage","hasPreviousPage");return v.useDebugValue(R),v.useMemo(()=>({...T,fetchNextPage:C,fetchPreviousPage:E,refetch:k}),[T,C,E,k])}}}function x(w){return({selectFromResult:q,fixedCacheKey:_}={})=>{const{select:V,initiate:S}=t.endpoints[w],k=r(),[C,E]=v.useState();v.useEffect(()=>()=>{C?.arg.fixedCacheKey||C?.reset()},[C]);const T=v.useCallback(function(ge){const oe=k(S(ge,{fixedCacheKey:_}));return E(oe),oe},[k,S,_]),{requestId:R}=C||{},I=v.useMemo(()=>V({fixedCacheKey:_,requestId:C?.requestId}),[_,C,V]),z=v.useMemo(()=>q?o([I],q):I,[q,I]),P=s(z,Ri),M=_==null?C?.arg.originalArgs:void 0,D=v.useCallback(()=>{e(()=>{C&&E(void 0),_&&k(t.internalActions.removeMutationResult({requestId:R,fixedCacheKey:_}))})},[k,_,C,R]),L=cu(P,...uu,"endpointName");v.useDebugValue(L);const Q=v.useMemo(()=>({...P,originalArgs:M,reset:D}),[P,M,D]);return v.useMemo(()=>[T,Q],[T,Q])}}}var OE=Symbol(),NE=({batch:t=$q,hooks:e={useDispatch:LA,useSelector:FA,useStore:fd},createSelector:r=Rl,unstable__sideEffectsInRender:s=!1,...n}={})=>({name:OE,init(i,{serializeQueryArgs:o},a){const l=i,{buildQueryHooks:c,buildInfiniteQueryHooks:u,buildMutationHook:h,usePrefetch:d}=jE({api:i,moduleOptions:{batch:t,hooks:e,unstable__sideEffectsInRender:s,createSelector:r},serializeQueryArgs:o,context:a});return fi(l,{usePrefetch:d}),fi(a,{batch:t}),{injectEndpoint(f,m){if(kE(m)){const{useQuery:y,useLazyQuery:g,useLazyQuerySubscription:A,useQueryState:b,useQuerySubscription:x}=c(f);fi(l.endpoints[f],{useQuery:y,useLazyQuery:g,useLazyQuerySubscription:A,useQueryState:b,useQuerySubscription:x}),i[`use${ya(f)}Query`]=y,i[`useLazy${ya(f)}Query`]=g}if(CE(m)){const y=h(f);fi(l.endpoints[f],{useMutation:y}),i[`use${ya(f)}Mutation`]=y}else if(cw(m)){const{useInfiniteQuery:y,useInfiniteQuerySubscription:g,useInfiniteQueryState:A}=u(f);fi(l.endpoints[f],{useInfiniteQuery:y,useInfiniteQuerySubscription:g,useInfiniteQueryState:A}),i[`use${ya(f)}InfiniteQuery`]=y}}}}}),BE=aw(lw(),NE());const zE=zn(()=>Bn(()=>import("./campaign-Bz7zdiBN.js"),__vite__mapDeps([7,5,6]))),Hl=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const DE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ki=Array.prototype.slice.call(DE),xa=(t=>{let e={};return t.forEach((r,s)=>e[r]=s),e})(ki),LE=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,$a=String.fromCharCode.bind(String),Cg=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),FE=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),uw=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),UE=t=>{let e,r,s,n,i="";const o=t.length%3;for(let a=0;a<t.length;){if((r=t.charCodeAt(a++))>255||(s=t.charCodeAt(a++))>255||(n=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=r<<16|s<<8|n,i+=ki[e>>18&63]+ki[e>>12&63]+ki[e>>6&63]+ki[e&63]}return o?i.slice(0,o-3)+"===".substring(o):i},$E=typeof btoa=="function"?t=>btoa(t):Hl?t=>Buffer.from(t,"binary").toString("base64"):UE,Eg=Hl?t=>Buffer.from(t).toString("base64"):t=>{let r=[];for(let s=0,n=t.length;s<n;s+=4096)r.push($a.apply(null,t.subarray(s,s+4096)));return $E(r.join(""))},HE=(t,e=!1)=>e?FE(Eg(t)):Eg(t),GE=t=>{if(t=t.replace(/\s+/g,""),!LE.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,r="",s,n;for(let i=0;i<t.length;)e=xa[t.charAt(i++)]<<18|xa[t.charAt(i++)]<<12|(s=xa[t.charAt(i++)])<<6|(n=xa[t.charAt(i++)]),r+=s===64?$a(e>>16&255):n===64?$a(e>>16&255,e>>8&255):$a(e>>16&255,e>>8&255,e&255);return r},WE=typeof atob=="function"?t=>atob(uw(t)):Hl?t=>Buffer.from(t,"base64").toString("binary"):GE,KE=Hl?t=>Cg(Buffer.from(t,"base64")):t=>Cg(WE(t).split("").map(e=>e.charCodeAt(0))),YE=t=>KE(QE(t)),QE=t=>uw(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),XE=!0,hw="gzip",JE=async t=>{const e=JSON.stringify(t),s=new TextEncoder().encode(e),n=new Blob([s]),i=new CompressionStream(hw),o=n.stream().pipeThrough(i),a=await new Response(o).arrayBuffer(),l=new Uint8Array(a);return HE(l,XE)},dw=async t=>{try{const e=YE(t),r=new Blob([new Uint8Array(e)]),s=new DecompressionStream(hw),n=r.stream().pipeThrough(s),i=await new Response(n).text();return JSON.parse(i)}catch(e){throw new Error("error decompressing object",{cause:e})}};var Pg=function(){return Pg=Object.assign||function(e){for(var r,s=1,n=arguments.length;s<n;s++){r=arguments[s];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Pg.apply(this,arguments)};function Gl(t,e){var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(t);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n])&&(r[s[n]]=t[s[n]]);return r}function ZE(t,e,r,s){function n(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{c(s.next(u))}catch(h){o(h)}}function l(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((s=s.apply(t,e||[])).next())})}function MU(t,e,r){if(r||arguments.length===2)for(var s=0,n=e.length,i;s<n;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))}const eP=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class sf extends Error{constructor(e,r="FunctionsError",s){super(e),this.name=r,this.context=s}}class tP extends sf{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Tg extends sf{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Rg extends sf{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Th;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Th||(Th={}));class rP{constructor(e,{headers:r={},customFetch:s,region:n=Th.Any}={}){this.url=e,this.headers=r,this.region=n,this.fetch=eP(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return ZE(this,arguments,void 0,function*(r,s={}){var n;let i,o;try{const{headers:a,method:l,body:c,signal:u,timeout:h}=s;let d={},{region:f}=s;f||(f=this.region);const m=new URL(`${this.url}/${r}`);f&&f!=="any"&&(d["x-region"]=f,m.searchParams.set("forceFunctionRegion",f));let y;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",y=c):typeof c=="string"?(d["Content-Type"]="text/plain",y=c):typeof FormData<"u"&&c instanceof FormData?y=c:(d["Content-Type"]="application/json",y=JSON.stringify(c)):c&&typeof c!="string"&&!(typeof Blob<"u"&&c instanceof Blob)&&!(c instanceof ArrayBuffer)&&!(typeof FormData<"u"&&c instanceof FormData)?y=JSON.stringify(c):y=c;let g=u;h&&(o=new AbortController,i=setTimeout(()=>o.abort(),h),u?(g=o.signal,u.addEventListener("abort",()=>o.abort())):g=o.signal);const A=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),a),body:y,signal:g}).catch(q=>{throw new tP(q)}),b=A.headers.get("x-relay-error");if(b&&b==="true")throw new Tg(A);if(!A.ok)throw new Rg(A);let x=((n=A.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),w;return x==="application/json"?w=yield A.json():x==="application/octet-stream"||x==="application/pdf"?w=yield A.blob():x==="text/event-stream"?w=A:x==="multipart/form-data"?w=yield A.formData():w=yield A.text(),{data:w,error:null,response:A}}catch(a){return{data:null,error:a,response:a instanceof Rg||a instanceof Tg?a.context:void 0}}finally{i&&clearTimeout(i)}})}}var sP=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},nP=class{constructor(t){var e,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(r=t.isMaybeSingle)!==null&&r!==void 0?r:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,a=null,l=null,c=i.status,u=i.statusText;if(i.ok){var h,d;if(r.method!=="HEAD"){var f;const A=await i.text();A===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((f=r.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?a=A:a=JSON.parse(A))}const y=(h=r.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),g=(d=i.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");y&&g&&g.length>1&&(l=parseInt(g[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,c=406,u="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var m;const y=await i.text();try{o=JSON.parse(y),Array.isArray(o)&&i.status===404&&(a=[],o=null,c=200,u="OK")}catch{i.status===404&&y===""?(c=204,u="No Content"):o={message:y}}if(o&&r.isMaybeSingle&&(!(o==null||(m=o.details)===null||m===void 0)&&m.includes("0 rows"))&&(o=null,c=200,u="OK"),o&&r.shouldThrowOnError)throw new sP(o)}return{error:o,data:a,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(n=n.catch(i=>{var o;let a="";const l=i?.cause;if(l){var c,u,h,d;const m=(c=l?.message)!==null&&c!==void 0?c:"",y=(u=l?.code)!==null&&u!==void 0?u:"";a=`${(h=i?.name)!==null&&h!==void 0?h:"FetchError"}: ${i?.message}`,a+=`

Caused by: ${(d=l?.name)!==null&&d!==void 0?d:"Error"}: ${m}`,y&&(a+=` (${y})`),l?.stack&&(a+=`
${l.stack}`)}else{var f;a=(f=i?.stack)!==null&&f!==void 0?f:""}return{error:{message:`${(o=i?.name)!==null&&o!==void 0?o:"FetchError"}: ${i?.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),n.then(t,e)}returns(){return this}overrideTypes(){return this}},iP=class extends nP{select(t){let e=!1;const r=(t??"*").split("").map(s=>/\s/.test(s)&&!e?"":(s==='"'&&(e=!e),s)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const i=n?`${n}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,e,{foreignTable:r,referencedTable:s=r}={}){const n=typeof s>"u"?"offset":`${s}.offset`,i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${t}`),this.url.searchParams.set(i,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:i="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const Mg=new RegExp("[,()]");var nn=class extends iP{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const r=Array.from(new Set(e)).map(s=>typeof s=="string"&&Mg.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}notIn(t,e){const r=Array.from(new Set(e)).map(s=>typeof s=="string"&&Mg.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`not.in.(${r})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");const i=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${n}fts${i}.${e}`),this}match(t){return Object.entries(t).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(t,e,r){return this.url.searchParams.append(t,`not.${e}.${r}`),this}or(t,{foreignTable:e,referencedTable:r=e}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,e,r){return this.url.searchParams.append(t,`${e}.${r}`),this}},oP=class{constructor(t,{headers:e={},schema:r,fetch:s}){this.url=t,this.headers=new Headers(e),this.schema=r,this.fetch=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:r=!1,count:s}=e??{},n=r?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(c=>/\s/.test(c)&&!i?"":(c==='"'&&(i=!i),c)).join(""),{url:a,headers:l}=this.cloneRequestState();return a.searchParams.set("select",o),s&&l.append("Prefer",`count=${s}`),new nn({method:n,url:a,headers:l,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:r=!0}={}){var s;const n="POST",{url:i,headers:o}=this.cloneRequestState();if(e&&o.append("Prefer",`count=${e}`),r||o.append("Prefer","missing=default"),Array.isArray(t)){const a=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(a.length>0){const l=[...new Set(a)].map(c=>`"${c}"`);i.searchParams.set("columns",l.join(","))}}return new nn({method:n,url:i,headers:o,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){var i;const o="POST",{url:a,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),e!==void 0&&a.searchParams.set("on_conflict",e),s&&l.append("Prefer",`count=${s}`),n||l.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(c.length>0){const u=[...new Set(c)].map(h=>`"${h}"`);a.searchParams.set("columns",u.join(","))}}return new nn({method:o,url:a,headers:l,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:e}={}){var r;const s="PATCH",{url:n,headers:i}=this.cloneRequestState();return e&&i.append("Prefer",`count=${e}`),new nn({method:s,url:n,headers:i,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:t}={}){var e;const r="DELETE",{url:s,headers:n}=this.cloneRequestState();return t&&n.append("Prefer",`count=${t}`),new nn({method:r,url:s,headers:n,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},aP=class fw{constructor(e,{headers:r={},schema:s,fetch:n}={}){this.url=e,this.headers=new Headers(r),this.schemaName=s,this.fetch=n}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new oP(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new fw(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,r={},{head:s=!1,get:n=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let c;const u=f=>f!==null&&typeof f=="object"&&(!Array.isArray(f)||f.some(u)),h=s&&Object.values(r).some(u);h?(a="POST",c=r):s||n?(a=s?"HEAD":"GET",Object.entries(r).filter(([f,m])=>m!==void 0).map(([f,m])=>[f,Array.isArray(m)?`{${m.join(",")}}`:`${m}`]).forEach(([f,m])=>{l.searchParams.append(f,m)})):(a="POST",c=r);const d=new Headers(this.headers);return h?d.set("Prefer",i?`count=${i},return=minimal`:"return=minimal"):i&&d.set("Prefer",`count=${i}`),new nn({method:a,url:l,headers:d,schema:this.schemaName,body:c,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class lP{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const r=globalThis.process;if(r){const s=r.versions;if(s&&s.node){const n=s.node,i=parseInt(n.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let r=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(r+=`

Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const s=this.getWebSocketConstructor();return new s(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const cP="2.93.1",uP=`realtime-js/${cP}`,hP="1.0.0",pw="2.0.0",Ig=pw,Rh=1e4,dP=1e3,fP=100;var Lr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Lr||(Lr={}));var He;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(He||(He={}));var Zt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Zt||(Zt={}));var Mh;(function(t){t.websocket="websocket"})(Mh||(Mh={}));var bs;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(bs||(bs={}));class pP{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,r){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return r(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var r;return this._isArrayBuffer((r=e.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var r,s;const n=(s=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(e){var r,s;const n=(s=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&s!==void 0?s:{},o=new TextEncoder().encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,r,s){var n,i;const o=e.topic,a=(n=e.ref)!==null&&n!==void 0?n:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",c=e.payload.event,u=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},h=Object.keys(u).length===0?"":JSON.stringify(u);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`metadata length ${h.length} exceeds maximum of 255`);const d=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+c.length+h.length,f=new ArrayBuffer(this.HEADER_LENGTH+d);let m=new DataView(f),y=0;m.setUint8(y++,this.KINDS.userBroadcastPush),m.setUint8(y++,l.length),m.setUint8(y++,a.length),m.setUint8(y++,o.length),m.setUint8(y++,c.length),m.setUint8(y++,h.length),m.setUint8(y++,r),Array.from(l,A=>m.setUint8(y++,A.charCodeAt(0))),Array.from(a,A=>m.setUint8(y++,A.charCodeAt(0))),Array.from(o,A=>m.setUint8(y++,A.charCodeAt(0))),Array.from(c,A=>m.setUint8(y++,A.charCodeAt(0))),Array.from(h,A=>m.setUint8(y++,A.charCodeAt(0)));var g=new Uint8Array(f.byteLength+s.byteLength);return g.set(new Uint8Array(f),0),g.set(new Uint8Array(s),f.byteLength),g.buffer}decode(e,r){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return r(s)}if(typeof e=="string"){const s=JSON.parse(e),[n,i,o,a,l]=s;return r({join_ref:n,ref:i,topic:o,event:a,payload:l})}return r({})}_binaryDecode(e){const r=new DataView(e),s=r.getUint8(0),n=new TextDecoder;if(s===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,r,n)}_decodeUserBroadcast(e,r,s){const n=r.getUint8(1),i=r.getUint8(2),o=r.getUint8(3),a=r.getUint8(4);let l=this.HEADER_LENGTH+4;const c=s.decode(e.slice(l,l+n));l=l+n;const u=s.decode(e.slice(l,l+i));l=l+i;const h=s.decode(e.slice(l,l+o));l=l+o;const d=e.slice(l,e.byteLength),f=a===this.JSON_ENCODING?JSON.parse(s.decode(d)):d,m={type:this.BROADCAST_EVENT,event:u,payload:f};return o>0&&(m.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(e){var r;return e instanceof ArrayBuffer||((r=e?.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(e,r){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([s])=>r.includes(s)))}}class mw{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ve;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(ve||(ve={}));const jg=(t,e,r={})=>{var s;const n=(s=r.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=mP(o,t,e,n),i),{}):{}},mP=(t,e,r,s)=>{const n=e.find(a=>a.name===t),i=n?.type,o=r[t];return i&&!s.includes(i)?gw(i,o):Ih(o)},gw=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return xP(e,r)}switch(t){case ve.bool:return gP(e);case ve.float4:case ve.float8:case ve.int2:case ve.int4:case ve.int8:case ve.numeric:case ve.oid:return yP(e);case ve.json:case ve.jsonb:return AP(e);case ve.timestamp:return bP(e);case ve.abstime:case ve.date:case ve.daterange:case ve.int4range:case ve.int8range:case ve.money:case ve.reltime:case ve.text:case ve.time:case ve.timestamptz:case ve.timetz:case ve.tsrange:case ve.tstzrange:return Ih(e);default:return Ih(e)}},Ih=t=>t,gP=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},yP=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},AP=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},xP=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,s=t[r];if(t[0]==="{"&&s==="}"){let i;const o=t.slice(1,r);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>gw(e,a))}return t},bP=t=>typeof t=="string"?t.replace(" ","T"):t,yw=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class hu{constructor(e,r,s={},n=Rh){this.channel=e,this.event=r,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var s;return this._hasReceived(e)&&r((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Og;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Og||(Og={}));class zi{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=zi.syncState(this.state,n,i,o),this.pendingDiffs.forEach(l=>{this.state=zi.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=zi.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,s,n){const i=this.cloneDeep(e),o=this.transformState(r),a={},l={};return this.map(i,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const h=i[c];if(h){const d=u.map(g=>g.presence_ref),f=h.map(g=>g.presence_ref),m=u.filter(g=>f.indexOf(g.presence_ref)<0),y=h.filter(g=>d.indexOf(g.presence_ref)<0);m.length>0&&(a[c]=m),y.length>0&&(l[c]=y)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},s,n)}static syncDiff(e,r,s,n){const{joins:i,leaves:o}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const h=e[a].map(f=>f.presence_ref),d=u.filter(f=>h.indexOf(f.presence_ref)<0);e[a].unshift(...d)}s(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=c,n(a,c,l),c.length===0&&delete e[a]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(s=>r(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,s)=>{const n=e[s];return"metas"in n?r[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):r[s]=n,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ng;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Ng||(Ng={}));var Di;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Di||(Di={}));var _r;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(_r||(_r={}));class hn{constructor(e,r={config:{}},s){var n,i;if(this.topic=e,this.params=r,this.socket=s,this.bindings={},this.state=He.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new hu(this,Zt.join,this.params,this.timeout),this.rejoinTimer=new mw(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=He.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=He.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=He.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=He.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=He.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Zt.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new zi(this),this.broadcastEndpointURL=yw(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,r=this.timeout){var s,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==He.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(f=>f.filter))!==null&&n!==void 0?n:[],u=!!this.bindings[Di.PRESENCE]&&this.bindings[Di.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},d={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(f=>e?.(_r.CHANNEL_ERROR,f)),this._onClose(()=>e?.(_r.CLOSED)),this.updateJoinPayload(Object.assign({config:d},h)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:f})=>{var m;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){e?.(_r.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,g=(m=y?.length)!==null&&m!==void 0?m:0,A=[];for(let b=0;b<g;b++){const x=y[b],{filter:{event:w,schema:q,table:_,filter:V}}=x,S=f&&f[b];if(S&&S.event===w&&hn.isFilterValueEqual(S.schema,q)&&hn.isFilterValueEqual(S.table,_)&&hn.isFilterValueEqual(S.filter,V))A.push(Object.assign(Object.assign({},x),{id:S.id}));else{this.unsubscribe(),this.state=He.errored,e?.(_r.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=A,e&&e(_r.SUBSCRIBED);return}}).receive("error",f=>{this.state=He.errored,e?.(_r.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e?.(_r.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,s){return this.state===He.joined&&e===Di.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,r,s)}async httpSend(e,r,s={}){var n;if(r==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:r,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,r={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const c=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=He.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Zt.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new hu(this,Zt.leave,{},e),s.receive("ok",()=>{r(),n("ok")}).receive("timeout",()=>{r(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=He.closed,this.bindings={}}async _fetchWithTimeout(e,r,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:n.signal}));return clearTimeout(i),o}_push(e,r,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new hu(this,e,r,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>fP){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,s){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,s){var n,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=Zt;if(s&&[a,l,c,u].indexOf(o)>=0&&s!==this._joinRef())return;let d=this._onMessage(o,r,s);if(r&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var m,y,g;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((g=(y=f.filter)===null||y===void 0?void 0:y.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===o}).map(f=>f.callback(d,s)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var m,y,g,A,b,x;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const w=f.id,q=(m=f.filter)===null||m===void 0?void 0:m.event;return w&&((y=r.ids)===null||y===void 0?void 0:y.includes(w))&&(q==="*"||q?.toLocaleLowerCase()===((g=r.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const w=(b=(A=f?.filter)===null||A===void 0?void 0:A.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return w==="*"||w===((x=r?.event)===null||x===void 0?void 0:x.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof d=="object"&&"ids"in d){const m=d.data,{schema:y,table:g,commit_timestamp:A,type:b,errors:x}=m;d=Object.assign(Object.assign({},{schema:y,table:g,commit_timestamp:A,eventType:b,new:{},old:{},errors:x}),this._getPayloadRecords(m))}f.callback(d,s)})}_isClosed(){return this.state===He.closed}_isJoined(){return this.state===He.joined}_isJoining(){return this.state===He.joining}_isLeaving(){return this.state===He.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,s){const n=e.toLocaleLowerCase(),i={type:n,filter:r,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,r){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&hn.isEqual(n.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(e[s]!==r[s])return!1;return!0}static isFilterValueEqual(e,r){return(e??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Zt.close,{},e)}_onError(e){this._on(Zt.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=He.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=jg(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=jg(e.columns,e.old_record)),r}}const du=()=>{},ba={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},wP=[1e3,2e3,5e3,1e4],VP=1e4,qP=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class vP{constructor(e,r){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Rh,this.transport=null,this.heartbeatIntervalMs=ba.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=du,this.ref=0,this.reconnectTimer=null,this.vsn=Ig,this.logger=du,this.conn=null,this.sendBuffer=[],this.serializer=new pP,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=n=>n?(...i)=>n(...i):(...i)=>fetch(...i),!(!((s=r?.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${Mh.websocket}`,this.httpEndpoint=yw(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=lP.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,s){this.logger(e,r,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Lr.connecting:return bs.Connecting;case Lr.open:return bs.Open;case Lr.closing:return bs.Closing;default:return bs.Closed}}isConnected(){return this.connectionState()===bs.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{const i=new hn(`realtime:${e}`,r,this);return this.channels.push(i),i}}push(e){const{topic:r,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${r} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(dP,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},ba.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply"&&r.ref&&r.ref===this.pendingHeartbeatRef){const c=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error",c)}catch(u){this.log("error","error in heartbeat callback",u)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:s,event:n,payload:i,ref:o}=r,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${s} ${n} ${a}`.trim(),i),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(n,i,o)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Lr.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Lr.open||this.conn.readyState===Lr.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(r){this.log("error","error in heartbeat callback",r)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(Zt.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(r);return`${e}${s}${n}`}_workerObjectUrl(e){let r;if(e)r=e;else{const s=new Blob([qP],{type:"application/javascript"});r=URL.createObjectURL(s)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r,s=!1;if(e)r=e,s=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(n){this.log("error","Error fetching access token from callback",n),r=this.accessTokenValue}else r=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const i={access_token:r,version:uP};r&&n.updateJoinPayload(i),n.joinedOnce&&n._isJoined()&&n._push(Zt.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(r)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new mw(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ba.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,s,n,i,o,a,l,c,u,h,d,f;switch(this.transport=(r=e?.transport)!==null&&r!==void 0?r:null,this.timeout=(s=e?.timeout)!==null&&s!==void 0?s:Rh,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:ba.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e?.heartbeatCallback)!==null&&a!==void 0?a:du,this.vsn=(l=e?.vsn)!==null&&l!==void 0?l:Ig,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e?.reconnectAfterMs)!==null&&c!==void 0?c:(m=>wP[m-1]||VP),this.vsn){case hP:this.encode=(u=e?.encode)!==null&&u!==void 0?u:((m,y)=>y(JSON.stringify(m))),this.decode=(h=e?.decode)!==null&&h!==void 0?h:((m,y)=>y(JSON.parse(m)));break;case pw:this.encode=(d=e?.encode)!==null&&d!==void 0?d:this.serializer.encode.bind(this.serializer),this.decode=(f=e?.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var no=class extends Error{constructor(t,e){super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function _P(t,e,r){const s=new URL(e,t);if(r)for(const[n,i]of Object.entries(r))i!==void 0&&s.searchParams.set(n,i);return s.toString()}async function SP(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function kP(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:r,path:s,query:n,body:i,headers:o}){const a=_P(t.baseUrl,s,n),l=await SP(t.auth),c=await e(a,{method:r,headers:{...i?{"Content-Type":"application/json"}:{},...l,...o},body:i?JSON.stringify(i):void 0}),u=await c.text(),h=(c.headers.get("content-type")||"").includes("application/json"),d=h&&u?JSON.parse(u):u;if(!c.ok){const f=h?d:void 0,m=f?.error;throw new no(m?.message??`Request failed with status ${c.status}`,{status:c.status,icebergType:m?.type,icebergCode:m?.code,details:f})}return{status:c.status,headers:c.headers,data:d}}}}function wa(t){return t.join("")}var CP=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:wa(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(t,e){const r={namespace:t.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${wa(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${wa(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${wa(t.namespace)}`}),!0}catch(e){if(e instanceof no&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(r){if(r instanceof no&&r.status===409)return;throw r}}};function Us(t){return t.join("")}var EP=class{constructor(t,e="",r){this.client=t,this.prefix=e,this.accessDelegation=r}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Us(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Us(t.namespace)}/tables`,body:e,headers:r})).data.metadata}async updateTable(t,e){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Us(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Us(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Us(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Us(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(r){if(r instanceof no&&r.status===404)return!1;throw r}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(r){if(r instanceof no&&r.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw r}}},PP=class{constructor(t){let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const r=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=kP({baseUrl:r,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=t.accessDelegation?.join(","),this.namespaceOps=new CP(this.client,e),this.tableOps=new EP(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},Wl=class extends Error{constructor(t,e="storage",r,s){super(t),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=r,this.statusCode=s}};function Kl(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var Va=class extends Wl{constructor(t,e,r,s="storage"){super(t,s,e,r),this.name=s==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Aw=class extends Wl{constructor(t,e,r="storage"){super(t,r),this.name=r==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const TP=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),RP=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},jh=t=>{if(Array.isArray(t))return t.map(r=>jh(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,s])=>{const n=r.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=jh(s)}),e},MP=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function io(t){"@babel/helpers - typeof";return io=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},io(t)}function IP(t,e){if(io(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e);if(io(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function jP(t){var e=IP(t,"string");return io(e)=="symbol"?e:e+""}function OP(t,e,r){return(e=jP(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Bg(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function Y(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Bg(Object(r),!0).forEach(function(s){OP(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Bg(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}const zg=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},NP=async(t,e,r,s)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!r?.noResolveJson){const n=t,i=n.status||500;if(typeof n.json=="function")n.json().then(o=>{const a=o?.statusCode||o?.code||i+"";e(new Va(zg(o),i,a,s))}).catch(()=>{if(s==="vectors"){const o=i+"";e(new Va(n.statusText||`HTTP ${i} error`,i,o,s))}else{const o=i+"";e(new Va(n.statusText||`HTTP ${i} error`,i,o,s))}});else{const o=i+"";e(new Va(n.statusText||`HTTP ${i} error`,i,o,s))}}else e(new Aw(zg(t),t,s))},BP=(t,e,r,s)=>{const n={method:t,headers:e?.headers||{}};return t==="GET"||t==="HEAD"||!s?Y(Y({},n),r):(RP(s)?(n.headers=Y({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(s)):n.body=s,e?.duplex&&(n.duplex=e.duplex),Y(Y({},n),r))};async function pi(t,e,r,s,n,i,o){return new Promise((a,l)=>{t(r,BP(e,s,n,i)).then(c=>{if(!c.ok)throw c;if(s?.noResolveJson)return c;if(o==="vectors"){const u=c.headers.get("content-type");if(!u||!u.includes("application/json"))return{}}return c.json()}).then(c=>a(c)).catch(c=>NP(c,l,s,o))})}function zP(t="storage"){return{get:async(e,r,s,n)=>pi(e,"GET",r,s,n,void 0,t),post:async(e,r,s,n,i)=>pi(e,"POST",r,n,i,s,t),put:async(e,r,s,n,i)=>pi(e,"PUT",r,n,i,s,t),head:async(e,r,s,n)=>pi(e,"HEAD",r,Y(Y({},s),{},{noResolveJson:!0}),n,void 0,t),remove:async(e,r,s,n,i)=>pi(e,"DELETE",r,n,i,s,t)}}const DP=zP("storage"),{get:oo,post:Ce,put:Oh,head:LP,remove:nf}=DP;var Kn=class{constructor(t,e={},r,s="storage"){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.fetch=TP(r),this.namespace=s}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(t){var e=this;try{return{data:await t(),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Kl(r))return{data:null,error:r};throw r}}},FP=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Kl(e))return{data:null,error:e};throw e}}};let xw;xw=Symbol.toStringTag;var UP=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[xw]="BlobDownloadBuilder",this.promise=null}asStream(){return new FP(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Kl(e))return{data:null,error:e};throw e}}};const $P={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Dg={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var HP=class extends Kn{constructor(t,e={},r,s){super(t,e,s,"storage"),this.bucketId=r}async uploadOrUpdate(t,e,r,s){var n=this;return n.handleOperation(async()=>{let i;const o=Y(Y({},Dg),s);let a=Y(Y({},n.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",n.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",n.encodeMetadata(l))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=n.toBase64(n.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),s?.headers&&(a=Y(Y({},a),s.headers));const c=n._removeEmptyFolders(e),u=n._getFinalPath(c),h=await(t=="PUT"?Oh:Ce)(n.fetch,`${n.url}/object/${u}`,i,Y({headers:a},o?.duplex?{duplex:o.duplex}:{}));return{path:c,id:h.Id,fullPath:h.Key}})}async upload(t,e,r){return this.uploadOrUpdate("POST",t,e,r)}async uploadToSignedUrl(t,e,r,s){var n=this;const i=n._removeEmptyFolders(t),o=n._getFinalPath(i),a=new URL(n.url+`/object/upload/sign/${o}`);return a.searchParams.set("token",e),n.handleOperation(async()=>{let l;const c=Y({upsert:Dg.upsert},s),u=Y(Y({},n.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType),{path:i,fullPath:(await Oh(n.fetch,a.toString(),l,{headers:u})).Key}})}async createSignedUploadUrl(t,e){var r=this;return r.handleOperation(async()=>{let s=r._getFinalPath(t);const n=Y({},r.headers);e?.upsert&&(n["x-upsert"]="true");const i=await Ce(r.fetch,`${r.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(r.url+i.url),a=o.searchParams.get("token");if(!a)throw new Wl("No token returned by API");return{signedUrl:o.toString(),path:t,token:a}})}async update(t,e,r){return this.uploadOrUpdate("PUT",t,e,r)}async move(t,e,r){var s=this;return s.handleOperation(async()=>await Ce(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:s.headers}))}async copy(t,e,r){var s=this;return s.handleOperation(async()=>({path:(await Ce(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:s.headers})).Key}))}async createSignedUrl(t,e,r){var s=this;return s.handleOperation(async()=>{let n=s._getFinalPath(t),i=await Ce(s.fetch,`${s.url}/object/sign/${n}`,Y({expiresIn:e},r?.transform?{transform:r.transform}:{}),{headers:s.headers});const o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{signedUrl:encodeURI(`${s.url}${i.signedURL}${o}`)}})}async createSignedUrls(t,e,r){var s=this;return s.handleOperation(async()=>{const n=await Ce(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:e,paths:t},{headers:s.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return n.map(o=>Y(Y({},o),{},{signedUrl:o.signedURL?encodeURI(`${s.url}${o.signedURL}${i}`):null}))})}download(t,e){const r=typeof e?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(e?.transform||{}),n=s?`?${s}`:"",i=this._getFinalPath(t),o=()=>oo(this.fetch,`${this.url}/${r}/${i}${n}`,{headers:this.headers,noResolveJson:!0});return new UP(o,this.shouldThrowOnError)}async info(t){var e=this;const r=e._getFinalPath(t);return e.handleOperation(async()=>jh(await oo(e.fetch,`${e.url}/object/info/${r}`,{headers:e.headers})))}async exists(t){var e=this;const r=e._getFinalPath(t);try{return await LP(e.fetch,`${e.url}/object/${r}`,{headers:e.headers}),{data:!0,error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(Kl(s)&&s instanceof Aw){const n=s.originalError;if([400,404].includes(n?.status))return{data:!1,error:s}}throw s}}getPublicUrl(t,e){const r=this._getFinalPath(t),s=[],n=e?.download?`download=${e.download===!0?"":e.download}`:"";n!==""&&s.push(n);const i=typeof e?.transform<"u"?"render/image":"object",o=this.transformOptsToQueryString(e?.transform||{});o!==""&&s.push(o);let a=s.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${a}`)}}}async remove(t){var e=this;return e.handleOperation(async()=>await nf(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}))}async list(t,e,r){var s=this;return s.handleOperation(async()=>{const n=Y(Y(Y({},$P),e),{},{prefix:t||""});return await Ce(s.fetch,`${s.url}/object/list/${s.bucketId}`,n,{headers:s.headers},r)})}async listV2(t,e){var r=this;return r.handleOperation(async()=>{const s=Y({},t);return await Ce(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,s,{headers:r.headers},e)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const GP="2.93.1",Ro={"X-Client-Info":`storage-js/${GP}`};var WP=class extends Kn{constructor(t,e={},r,s){const n=new URL(t);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."));const i=n.href.replace(/\/$/,""),o=Y(Y({},Ro),e);super(i,o,r,"storage")}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const r=e.listBucketOptionsToQueryString(t);return await oo(e.fetch,`${e.url}/bucket${r}`,{headers:e.headers})})}async getBucket(t){var e=this;return e.handleOperation(async()=>await oo(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}))}async createBucket(t,e={public:!1}){var r=this;return r.handleOperation(async()=>await Ce(r.fetch,`${r.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async updateBucket(t,e){var r=this;return r.handleOperation(async()=>await Oh(r.fetch,`${r.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async emptyBucket(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await nf(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},KP=class extends Kn{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=Y(Y({},Ro),e);super(s,n,r,"storage")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}))}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const r=new URLSearchParams;t?.limit!==void 0&&r.set("limit",t.limit.toString()),t?.offset!==void 0&&r.set("offset",t.offset.toString()),t?.sortColumn&&r.set("sortColumn",t.sortColumn),t?.sortOrder&&r.set("sortOrder",t.sortOrder),t?.search&&r.set("search",t.search);const s=r.toString(),n=s?`${e.url}/bucket?${s}`:`${e.url}/bucket`;return await oo(e.fetch,n,{headers:e.headers})})}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await nf(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}from(t){var e=this;if(!MP(t))throw new Wl("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new PP({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(r,{get(n,i){const o=n[i];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(n,a),error:null}}catch(l){if(s)throw l;return{data:null,error:l}}}}})}},YP=class extends Kn{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=Y(Y({},Ro),{},{"Content-Type":"application/json"},e);super(s,n,r,"vectors")}async createIndex(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{})}async getIndex(t,e){var r=this;return r.handleOperation(async()=>await Ce(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers}))}async listIndexes(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}))}async deleteIndex(t,e){var r=this;return r.handleOperation(async()=>await Ce(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers})||{})}},QP=class extends Kn{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=Y(Y({},Ro),{},{"Content-Type":"application/json"},e);super(s,n,r,"vectors")}async putVectors(t){var e=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{})}async getVectors(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}))}async listVectors(t){var e=this;if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}))}async queryVectors(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}))}async deleteVectors(t){var e=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{})}},XP=class extends Kn{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=Y(Y({},Ro),{},{"Content-Type":"application/json"},e);super(s,n,r,"vectors")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}async getBucket(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}))}async listBuckets(t={}){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}},JP=class extends XP{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new ZP(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,r=this;return e().call(r,t)}async getBucket(t){var e=()=>super.getBucket,r=this;return e().call(r,t)}async listBuckets(t={}){var e=()=>super.listBuckets,r=this;return e().call(r,t)}async deleteBucket(t){var e=()=>super.deleteBucket,r=this;return e().call(r,t)}},ZP=class extends YP{constructor(t,e,r,s){super(t,e,s),this.vectorBucketName=r}async createIndex(t){var e=()=>super.createIndex,r=this;return e().call(r,Y(Y({},t),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,r=this;return e().call(r,Y(Y({},t),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,r=this;return e().call(r,r.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,r=this;return e().call(r,r.vectorBucketName,t)}index(t){return new eT(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},eT=class extends QP{constructor(t,e,r,s,n){super(t,e,n),this.vectorBucketName=r,this.indexName=s}async putVectors(t){var e=()=>super.putVectors,r=this;return e().call(r,Y(Y({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(t){var e=()=>super.getVectors,r=this;return e().call(r,Y(Y({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,r=this;return e().call(r,Y(Y({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,r=this;return e().call(r,Y(Y({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,r=this;return e().call(r,Y(Y({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},tT=class extends WP{constructor(t,e={},r,s){super(t,e,r,s)}from(t){return new HP(this.url,this.headers,t,this.fetch)}get vectors(){return new JP(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new KP(this.url+"/iceberg",this.headers,this.fetch)}};const bw="2.93.1",on=30*1e3,Nh=3,fu=Nh*on,rT="http://localhost:9999",sT="supabase.auth.token",nT={"X-Client-Info":`gotrue-js/${bw}`},Bh="X-Supabase-Api-Version",ww={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},iT=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,oT=600*1e3;class ao extends Error{constructor(e,r,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=s}}function $(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class aT extends ao{constructor(e,r,s){super(e,r,s),this.name="AuthApiError",this.status=r,this.code=s}}function lT(t){return $(t)&&t.name==="AuthApiError"}class ws extends ao{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class zr extends ao{constructor(e,r,s,n){super(e,s,n),this.name=r,this.status=s}}class Rt extends zr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function pu(t){return $(t)&&t.name==="AuthSessionMissingError"}class $s extends zr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class qa extends zr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class va extends zr{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function cT(t){return $(t)&&t.name==="AuthImplicitGrantRedirectError"}class Lg extends zr{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class uT extends zr{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class zh extends zr{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function mu(t){return $(t)&&t.name==="AuthRetryableFetchError"}class Fg extends zr{constructor(e,r,s){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=s}}class Dh extends zr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const dl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ug=` 	
\r=`.split(""),hT=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Ug.length;e+=1)t[Ug[e].charCodeAt(0)]=-2;for(let e=0;e<dl.length;e+=1)t[dl[e].charCodeAt(0)]=e;return t})();function $g(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;r(dl[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;r(dl[s]),e.queuedBits-=6}}function Vw(t,e,r){const s=hT[t];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Hg(t){const e=[],r=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{pT(o,s,r)};for(let o=0;o<t.length;o+=1)Vw(t.charCodeAt(o),n,i);return e.join("")}function dT(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function fT(t,e){for(let r=0;r<t.length;r+=1){let s=t.charCodeAt(r);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(t.charCodeAt(r+1)-56320&65535|n)+65536,r+=1}dT(s,e)}}function pT(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let s=1;s<6;s+=1)if((t>>7-s&1)===0){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function gn(t){const e=[],r={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<t.length;n+=1)Vw(t.charCodeAt(n),r,s);return new Uint8Array(e)}function mT(t){const e=[];return fT(t,r=>e.push(r)),new Uint8Array(e)}function Ss(t){const e=[],r={queue:0,queuedBits:0},s=n=>{e.push(n)};return t.forEach(n=>$g(n,r,s)),$g(null,r,s),e.join("")}function gT(t){return Math.round(Date.now()/1e3)+t}function yT(){return Symbol("auth-callback")}const et=()=>typeof window<"u"&&typeof document<"u",ls={tested:!1,writable:!1},qw=()=>{if(!et())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ls.tested)return ls.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ls.tested=!0,ls.writable=!0}catch{ls.tested=!0,ls.writable=!1}return ls.writable};function AT(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return r.searchParams.forEach((s,n)=>{e[n]=s}),e}const vw=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),xT=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",an=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},cs=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Je=async(t,e)=>{await t.removeItem(e)};class Yl{constructor(){this.promise=new Yl.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}Yl.promiseConstructor=Promise;function _a(t){const e=t.split(".");if(e.length!==3)throw new Dh("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!iT.test(e[s]))throw new Dh("JWT not in base64url format");return{header:JSON.parse(Hg(e[0])),payload:JSON.parse(Hg(e[1])),signature:gn(e[2]),raw:{header:e[0],payload:e[1]}}}async function bT(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function wT(t,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function VT(t){return("0"+t.toString(16)).substr(-2)}function qT(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=r.length;let n="";for(let i=0;i<56;i++)n+=r.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,VT).join("")}async function vT(t){const r=new TextEncoder().encode(t),s=await crypto.subtle.digest("SHA-256",r),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function _T(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await vT(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Hs(t,e,r=!1){const s=qT();let n=s;r&&(n+="/PASSWORD_RECOVERY"),await an(t,`${e}-code-verifier`,n);const i=await _T(s);return[i,s===i?"plain":"s256"]}const ST=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function kT(t){const e=t.headers.get(Bh);if(!e||!e.match(ST))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function CT(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function ET(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const PT=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Gs(t){if(!PT.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function gu(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const s=r.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function TT(t,e){return new Proxy(t,{get:(r,s,n)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const i=s.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,s,n)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(r,s,n)}})}function Gg(t){return JSON.parse(JSON.stringify(t))}const xs=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),RT=[502,503,504];async function Wg(t){var e;if(!xT(t))throw new zh(xs(t),0);if(RT.includes(t.status))throw new zh(xs(t),t.status);let r;try{r=await t.json()}catch(i){throw new ws(xs(i),i)}let s;const n=kT(t);if(n&&n.getTime()>=ww["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?s=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(s=r.error_code),s){if(s==="weak_password")throw new Fg(xs(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new Rt}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Fg(xs(r),t.status,r.weak_password.reasons);throw new aT(xs(r),t.status||500,s)}const MT=(t,e,r,s)=>{const n={method:t,headers:e?.headers||{}};return t==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))};async function K(t,e,r,s){var n;const i=Object.assign({},s?.headers);i[Bh]||(i[Bh]=ww["2024-01-01"].name),s?.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(n=s?.query)!==null&&n!==void 0?n:{};s?.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await IT(t,e,r+a,{headers:i,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(l):{data:Object.assign({},l),error:null}}async function IT(t,e,r,s,n,i){const o=MT(e,s,n,i);let a;try{a=await t(r,Object.assign({},o))}catch(l){throw console.error(l),new zh(xs(l),0)}if(a.ok||await Wg(a),s?.noResolveJson)return a;try{return await a.json()}catch(l){await Wg(l)}}function Jt(t){var e;let r=null;NT(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=gT(t.expires_in)));const s=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:s},error:null}}function Kg(t){const e=Jt(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,s)=>r&&typeof s=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Ur(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function jT(t){return{data:t,error:null}}function OT(t){const{action_link:e,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i}=t,o=Gl(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Yg(t){return t}function NT(t){return t.access_token&&t.refresh_token&&t.expires_in}const yu=["global","local","others"];class BT{constructor({url:e="",headers:r={},fetch:s}){this.url=e,this.headers=r,this.fetch=vw(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,r=yu[0]){if(yu.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${yu.join(", ")}`);try{return await K(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if($(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,r={}){try{return await K(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Ur})}catch(s){if($(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:r}=e,s=Gl(e,["options"]),n=Object.assign(Object.assign({},s),r);return"newEmail"in s&&(n.new_email=s?.newEmail,delete n.newEmail),await K(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:OT,redirectTo:r?.redirectTo})}catch(r){if($(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await K(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ur})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,s,n,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await K(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Yg});if(u.error)throw u.error;const h=await u.json(),d=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(m.split(";")[1].split("=")[1]);c[`${g}Page`]=y}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if($(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Gs(e);try{return await K(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ur})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){Gs(e);try{return await K(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:Ur})}catch(s){if($(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,r=!1){Gs(e);try{return await K(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:Ur})}catch(s){if($(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Gs(e.userId);try{const{data:r,error:s}=await K(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:r,error:s}}catch(r){if($(r))return{data:null,error:r};throw r}}async _deleteFactor(e){Gs(e.userId),Gs(e.id);try{return{data:await K(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if($(r))return{data:null,error:r};throw r}}async _listOAuthClients(e){var r,s,n,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await K(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Yg});if(u.error)throw u.error;const h=await u.json(),d=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(m.split(";")[1].split("=")[1]);c[`${g}Page`]=y}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if($(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await K(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if($(r))return{data:null,error:r};throw r}}async _getOAuthClient(e){try{return await K(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if($(r))return{data:null,error:r};throw r}}async _updateOAuthClient(e,r){try{return await K(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:r,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if($(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await K(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if($(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(e){try{return await K(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if($(r))return{data:null,error:r};throw r}}}function Qg(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const Ws={debug:!!(globalThis&&qw()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class _w extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class zT extends _w{}async function DT(t,e,r){Ws.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Ws.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){Ws.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,n.name);try{return await r()}finally{Ws.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,n.name)}}else{if(e===0)throw Ws.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new zT(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Ws.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function LT(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Sw(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function FT(t){return parseInt(t,16)}function UT(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function $T(t){var e;const{chainId:r,domain:s,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:h,version:d}=t;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(d!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const f=Sw(t.address),m=u?`${u}://${s}`:s,y=t.statement?`${t.statement}
`:"",g=`${m} wants you to sign in with your Ethereum account:
${f}

${y}`;let A=`URI: ${h}
Version: ${d}
Chain ID: ${r}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(n&&(A+=`
Expiration Time: ${n.toISOString()}`),a&&(A+=`
Not Before: ${a.toISOString()}`),l&&(A+=`
Request ID: ${l}`),c){let b=`
Resources:`;for(const x of c){if(!x||typeof x!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${x}`);b+=`
- ${x}`}A+=b}return`${g}
${A}`}class Ue extends Error{constructor({message:e,code:r,cause:s,name:n}){var i;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(i=n??(s instanceof Error?s.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=r}}class fl extends Ue{constructor(e,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:e}),this.name="WebAuthnUnknownError",this.originalError=r}}function HT({error:t,options:e}){var r,s,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ue({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Ue({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Ue({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Ue({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new Ue({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new Ue({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Ue({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Ue({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(kw(o)){if(i.rp.id!==o)return new Ue({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Ue({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Ue({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new Ue({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Ue({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function GT({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ue({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new Ue({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const s=window.location.hostname;if(kw(s)){if(r.rpId!==s)return new Ue({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Ue({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new Ue({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Ue({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class WT{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const KT=new WT;function YT(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:r,excludeCredentials:s}=t,n=Gl(t,["challenge","user","excludeCredentials"]),i=gn(e).buffer,o=Object.assign(Object.assign({},r),{id:gn(r.id).buffer}),a=Object.assign(Object.assign({},n),{challenge:i,user:o});if(s&&s.length>0){a.excludeCredentials=new Array(s.length);for(let l=0;l<s.length;l++){const c=s[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:gn(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function QT(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:r}=t,s=Gl(t,["challenge","allowCredentials"]),n=gn(e).buffer,i=Object.assign(Object.assign({},s),{challenge:n});if(r&&r.length>0){i.allowCredentials=new Array(r.length);for(let o=0;o<r.length;o++){const a=r[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:gn(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function XT(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:Ss(new Uint8Array(t.response.attestationObject)),clientDataJSON:Ss(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function JT(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t,s=t.getClientExtensionResults(),n=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Ss(new Uint8Array(n.authenticatorData)),clientDataJSON:Ss(new Uint8Array(n.clientDataJSON)),signature:Ss(new Uint8Array(n.signature)),userHandle:n.userHandle?Ss(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function kw(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function Xg(){var t,e;return!!(et()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function ZT(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new fl("Browser returned unexpected credential type",e)}:{data:null,error:new fl("Empty credential response",e)}}catch(e){return{data:null,error:HT({error:e,options:t})}}}async function eR(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new fl("Browser returned unexpected credential type",e)}:{data:null,error:new fl("Empty credential response",e)}}catch(e){return{data:null,error:GT({error:e,options:t})}}}const tR={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},rR={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function pl(...t){const e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),r=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),s={};for(const n of t)if(n)for(const i in n){const o=n[i];if(o!==void 0)if(Array.isArray(o))s[i]=o;else if(r(o))s[i]=o;else if(e(o)){const a=s[i];e(a)?s[i]=pl(a,o):s[i]=pl(o)}else s[i]=o}return s}function sR(t,e){return pl(tR,t,e||{})}function nR(t,e){return pl(rR,t,e||{})}class iR{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:r,friendlyName:s,signal:n},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:r});if(!o)return{data:null,error:a};const l=n??KT.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:c}=o.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${s}`),c.displayName||(c.displayName=c.name)}switch(o.webauthn.type){case"create":{const c=sR(o.webauthn.credential_options.publicKey,i?.create),{data:u,error:h}=await ZT({publicKey:c,signal:l});return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}case"request":{const c=nR(o.webauthn.credential_options.publicKey,i?.request),{data:u,error:h}=await eR(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:c,signal:l}));return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}}}catch(o){return $(o)?{data:null,error:o}:{data:null,error:new ws("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:r,webauthn:s}){return this.client.mfa.verify({factorId:r,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!r)return{data:null,error:new ao("rpId is required for WebAuthn authentication")};try{if(!Xg())return{data:null,error:new ws("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:r,rpOrigins:s},signal:n},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:r,rpOrigins:s,credential_response:l.credential_response}})}catch(o){return $(o)?{data:null,error:o}:{data:null,error:new ws("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!r)return{data:null,error:new ao("rpId is required for WebAuthn registration")};try{if(!Xg())return{data:null,error:new ws("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(u=>{var h;return(h=u.data)===null||h===void 0?void 0:h.all.find(d=>d.factor_type==="webauthn"&&d.friendly_name===e&&d.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u?.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:r,rpOrigins:s},signal:n},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:r,rpOrigins:s,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return $(o)?{data:null,error:o}:{data:null,error:new ws("Unexpected error in register",o)}}}}LT();const oR={url:rT,storageKey:sT,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:nT,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function Jg(t,e,r){return await r()}const Ks={};class lo{get jwks(){var e,r;return(r=(e=Ks[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Ks[this.storageKey]=Object.assign(Object.assign({},Ks[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Ks[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ks[this.storageKey]=Object.assign(Object.assign({},Ks[this.storageKey]),{cachedAt:e})}constructor(e){var r,s,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},oR),e);if(this.storageKey=i.storageKey,this.instanceID=(r=lo.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,lo.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&et()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new BT({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=vw(i.fetch),this.lock=i.lock||Jg,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,this.lockAcquireTimeout=i.lockAcquireTimeout,i.lock?this.lock=i.lock:this.persistSession&&et()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=DT:this.lock=Jg,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new iR(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:qw()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Qg(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Qg(this.memoryStorage)),et()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(a){this._debug("#broadcastChannel","error",a)}})}this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${bw}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r={},s="none";if(et()&&(r=AT(window.location.href),this._isImplicitGrantCallback(r)?s="implicit":await this._isPKCECallback(r)&&(s="pkce")),et()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(r,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),cT(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return{error:i}}const{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return $(r)?this._returnResult({error:r}):this._returnResult({error:new ws("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,s,n;try{const i=await K(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:Jt}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if($(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var r,s,n;try{let i;if("email"in e){const{email:u,password:h,options:d}=e;let f=null,m=null;this.flowType==="pkce"&&([f,m]=await Hs(this.storage,this.storageKey)),i=await K(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:{email:u,password:h,data:(r=d?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:f,code_challenge_method:m},xform:Jt})}else if("phone"in e){const{phone:u,password:h,options:d}=e;i=await K(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=d?.data)!==null&&s!==void 0?s:{},channel:(n=d?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:Jt})}else throw new qa("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return await Je(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let r;if("email"in e){const{email:i,password:o,options:a}=e;r=await K(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Kg})}else if("phone"in e){const{phone:i,password:o,options:a}=e;r=await K(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Kg})}else throw new qa("You must provide either an email or phone number and a password");const{data:s,error:n}=r;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!s||!s.session||!s.user){const i=new $s;return this._returnResult({data:{user:null,session:null},error:i})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(r){if($(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(e){var r,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;switch(r){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(e){var r,s,n,i,o,a,l,c,u,h,d;let f,m;if("message"in e)f=e.message,m=e.signature;else{const{chain:y,wallet:g,statement:A,options:b}=e;let x;if(et())if(typeof g=="object")x=g;else{const k=window;if("ethereum"in k&&typeof k.ethereum=="object"&&"request"in k.ethereum&&typeof k.ethereum.request=="function")x=k.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=g}const w=new URL((r=b?.url)!==null&&r!==void 0?r:window.location.href),q=await x.request({method:"eth_requestAccounts"}).then(k=>k).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!q||q.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const _=Sw(q[0]);let V=(s=b?.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!V){const k=await x.request({method:"eth_chainId"});V=FT(k)}const S={domain:w.host,address:_,statement:A,uri:w.href,version:"1",chainId:V,nonce:(n=b?.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(i=b?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=b?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=b?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=b?.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=b?.signInWithEthereum)===null||u===void 0?void 0:u.resources};f=$T(S),m=await x.request({method:"personal_sign",params:[UT(f),_]})}try{const{data:y,error:g}=await K(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:m},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(d=e.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:Jt});if(g)throw g;if(!y||!y.session||!y.user){const A=new $s;return this._returnResult({data:{user:null,session:null},error:A})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:g})}catch(y){if($(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async signInWithSolana(e){var r,s,n,i,o,a,l,c,u,h,d,f;let m,y;if("message"in e)m=e.message,y=e.signature;else{const{chain:g,wallet:A,statement:b,options:x}=e;let w;if(et())if(typeof A=="object")w=A;else{const _=window;if("solana"in _&&typeof _.solana=="object"&&("signIn"in _.solana&&typeof _.solana.signIn=="function"||"signMessage"in _.solana&&typeof _.solana.signMessage=="function"))w=_.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof A!="object"||!x?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=A}const q=new URL((r=x?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in w&&w.signIn){const _=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},x?.signInWithSolana),{version:"1",domain:q.host,uri:q.href}),b?{statement:b}:null));let V;if(Array.isArray(_)&&_[0]&&typeof _[0]=="object")V=_[0];else if(_&&typeof _=="object"&&"signedMessage"in _&&"signature"in _)V=_;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in V&&"signature"in V&&(typeof V.signedMessage=="string"||V.signedMessage instanceof Uint8Array)&&V.signature instanceof Uint8Array)m=typeof V.signedMessage=="string"?V.signedMessage:new TextDecoder().decode(V.signedMessage),y=V.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${q.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${q.href}`,`Issued At: ${(n=(s=x?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=x?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${x.signInWithSolana.notBefore}`]:[],...!((o=x?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${x.signInWithSolana.expirationTime}`]:[],...!((a=x?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${x.signInWithSolana.chainId}`]:[],...!((l=x?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${x.signInWithSolana.nonce}`]:[],...!((c=x?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${x.signInWithSolana.requestId}`]:[],...!((h=(u=x?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...x.signInWithSolana.resources.map(V=>`- ${V}`)]:[]].join(`
`);const _=await w.signMessage(new TextEncoder().encode(m),"utf8");if(!_||!(_ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=_}}try{const{data:g,error:A}=await K(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Ss(y)},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Jt});if(A)throw A;if(!g||!g.session||!g.user){const b=new $s;return this._returnResult({data:{user:null,session:null},error:b})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:A})}catch(g){if($(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async _exchangeCodeForSession(e){const r=await cs(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(r??"").split("/");try{if(!s&&this.flowType==="pkce")throw new uT;const{data:i,error:o}=await K(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Jt});if(await Je(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new $s;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:r,provider:s,token:n,access_token:i,nonce:o}=e,a=await K(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:Jt}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const u=new $s;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(r){if($(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(e){var r,s,n,i,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Hs(this.storage,this.storageKey));const{error:h}=await K(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=l?.data)!==null&&r!==void 0?r:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await K(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c?.message_id},error:u})}throw new qa("You must provide either an email or phone number.")}catch(a){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var r,s;try{let n,i;"options"in e&&(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await K(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:Jt});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(n){if($(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(e){var r,s,n,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await Hs(this.storage,this.storageKey));const c=await K(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:jT});return!((i=c.data)===null||i===void 0)&&i.url&&et()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:s}=e;if(s)throw s;if(!r)throw new Rt;const{error:n}=await K(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if($(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:o}=await K(this.fetch,"POST",r,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:o,error:a}=await K(this.fetch,"POST",r,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:a})}throw new qa("You must provide either an email or phone number and a type")}catch(r){if($(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await r()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=r();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await cs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<fu:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const o=await cs(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=gu()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=TT(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const r=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(e){try{return e?await K(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ur}):await this._useSession(async r=>{var s,n,i;const{data:o,error:a}=r;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Rt}:await K(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:Ur})})}catch(r){if($(r))return pu(r)&&(await this._removeSession(),await Je(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new Rt;const o=n.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Hs(this.storage,this.storageKey));const{data:c,error:u}=await K(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:Ur});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(s){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Rt;const r=Date.now()/1e3;let s=r,n=!0,i=null;const{payload:o}=_a(e.access_token);if(o.exp&&(s=o.exp,n=s<=r),n){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-r,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(r){if($(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var s;if(!e){const{data:o,error:a}=r;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new Rt;const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if($(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(e,r){try{if(!et())throw new va("No browser detected.");if(e.error||e.error_description||e.error_code)throw new va(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new Lg("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new va("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Lg("No code detected.");const{data:b,error:x}=await this._exchangeCodeForSession(e.code);if(x)throw x;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!i||!a||!o||!c)throw new va("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let d=u+h;l&&(d=parseInt(l));const f=d-u;f*1e3<=on&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const m=d-h;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,d,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,d,u);const{data:y,error:g}=await this._getUser(i);if(g)throw g;const A={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:d,refresh_token:o,token_type:c,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:A,redirectType:e.type},error:null})}catch(s){if($(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await cs(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var s;const{data:n,error:i}=r;if(i&&!pu(i))return this._returnResult({error:i});const o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(lT(a)&&(a.status===404||a.status===401||a.status===403)||pu(a)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Je(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const r=yT(),s={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,s),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async r=>{var s,n;try{const{data:{session:i},error:o}=r;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,r={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await Hs(this.storage,this.storageKey,!0));try{return await K(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(i){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:r,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var r;try{const{data:s,error:n}=await this._useSession(async i=>{var o,a,l,c,u;const{data:h,error:d}=i;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await K(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return et()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(s?.url),this._returnResult({data:{provider:e.provider,url:s?.url},error:null})}catch(s){if($(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async r=>{var s;try{const{error:n,data:{session:i}}=r;if(n)throw n;const{options:o,provider:a,token:l,access_token:c,nonce:u}=e,h=await K(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=i?.access_token)!==null&&s!==void 0?s:void 0,body:{provider:a,id_token:l,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Jt}),{data:d,error:f}=h;return f?this._returnResult({data:{user:null,session:null},error:f}):!d||!d.session||!d.user?this._returnResult({data:{user:null,session:null},error:new $s}):(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:f}))}catch(n){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(e){try{return await this._useSession(async r=>{var s,n;const{data:i,error:o}=r;if(o)throw o;return await K(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const s=Date.now();return await wT(async n=>(n>0&&await bT(200*Math.pow(2,n-1)),this._debug(r,"refreshing attempt",n),await K(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Jt})),(n,i)=>{const o=200*Math.pow(2,n);return i&&mu(i)&&Date.now()+o-s<on})}catch(s){if(this._debug(r,"error",s),$(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",s),et()&&!r.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,r;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await cs(this.storage,this.storageKey);if(n&&this.userStorage){let o=await cs(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await an(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o?.user)!==null&&e!==void 0?e:gu()}else if(n&&!n.user&&!n.user){const o=await cs(this.storage,this.storageKey+"-user");o&&o?.user?(n.user=o.user,await Je(this.storage,this.storageKey+"-user"),await an(this.storage,this.storageKey,n)):n.user=gu()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}const i=((r=n.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<fu;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${fu}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),mu(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(n.access_token);!a&&o?.user?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n),console.error(n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var r,s;if(!e)throw new Rt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Yl;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Rt;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(n,"error",i),$(i)){const o={data:null,error:i};return mu(i)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,r,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",r,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:r});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,r)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Je(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},e),s=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&r.user&&await an(this.userStorage,this.storageKey+"-user",{user:r.user});const n=Object.assign({},r);delete n.user;const i=Gg(n);await an(this.storage,this.storageKey,i)}else{const n=Gg(r);await an(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Je(this.storage,this.storageKey),await Je(this.storage,this.storageKey+"-code-verifier"),await Je(this.storage,this.storageKey+"-user"),this.userStorage&&await Je(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&et()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),on);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const r=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:s}}=r;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/on);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${on}ms, refresh threshold is ${Nh} ticks`),n<=Nh&&await this._callRefreshToken(s.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof _w)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!et()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,s){const n=[`provider=${encodeURIComponent(r)}`];if(s?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await Hs(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(s?.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s?.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var s;const{data:n,error:i}=r;return i?this._returnResult({data:null,error:i}):await K(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token})})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(e){try{return await this._useSession(async r=>{var s,n;const{data:i,error:o}=r;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await K(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((n=l?.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var s;const{data:n,error:i}=r;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?XT(e.webauthn.credential_response):JT(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await K(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var s;const{data:n,error:i}=r;if(i)return this._returnResult({data:null,error:i});const o=await K(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:YT(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:QT(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(e){const{data:r,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){var e;const{data:{user:r},error:s}=await this.getUser();if(s)return{data:null,error:s};const n={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=r?.factors)!==null&&e!==void 0?e:[])n.all.push(i),i.status==="verified"&&n[i.factor_type].push(i);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(e){var r,s,n,i;if(e)try{const{payload:f}=_a(e);let m=null;f.aal&&(m=f.aal);let y=m;const{data:{user:g},error:A}=await this.getUser(e);if(A)return this._returnResult({data:null,error:A});((s=(r=g?.factors)===null||r===void 0?void 0:r.filter(w=>w.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(y="aal2");const x=f.amr||[];return{data:{currentLevel:m,nextLevel:y,currentAuthenticationMethods:x},error:null}}catch(f){if($(f))return this._returnResult({data:null,error:f});throw f}const{data:{session:o},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=_a(o.access_token);let c=null;l.aal&&(c=l.aal);let u=c;((i=(n=o.user.factors)===null||n===void 0?void 0:n.filter(f=>f.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(u="aal2");const d=l.amr||[];return{data:{currentLevel:c,nextLevel:u,currentAuthenticationMethods:d},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;return n?this._returnResult({data:null,error:n}):s?await K(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Rt})})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(e,r){try{return await this._useSession(async s=>{const{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new Rt});const o=await K(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&et()&&!r?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if($(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,r){try{return await this._useSession(async s=>{const{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new Rt});const o=await K(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&et()&&!r?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if($(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:r},error:s}=e;return s?this._returnResult({data:null,error:s}):r?await K(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new Rt})})}catch(e){if($(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;return n?this._returnResult({data:null,error:n}):s?(await K(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Rt})})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,r={keys:[]}){let s=r.keys.find(a=>a.kid===e);if(s)return s;const n=Date.now();if(s=this.jwks.keys.find(a=>a.kid===e),s&&this.jwks_cached_at+oT>n)return s;const{data:i,error:o}=await K(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,s=i.keys.find(a=>a.kid===e),!s)?null:s}async getClaims(e,r={}){try{let s=e;if(!s){const{data:f,error:m}=await this.getSession();if(m||!f.session)return this._returnResult({data:null,error:m});s=f.session.access_token}const{header:n,payload:i,signature:o,raw:{header:a,payload:l}}=_a(s);r?.allowExpired||CT(i.exp);const c=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!c){const{error:f}=await this.getUser(s);if(f)throw f;return{data:{claims:i,header:n,signature:o},error:null}}const u=ET(n.alg),h=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,o,mT(`${a}.${l}`)))throw new Dh("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if($(s))return this._returnResult({data:null,error:s});throw s}}}lo.nextInstanceID={};const aR=lo,lR="2.93.1";let Ci="";typeof Deno<"u"?Ci="deno":typeof document<"u"?Ci="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ci="react-native":Ci="node";function cR(){const t=globalThis.process;if(t&&t.platform){const e=t.platform;if(e==="darwin")return"macOS";if(e==="win32")return"Windows";if(e==="linux")return"Linux";if(e==="android")return"Android"}if(typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platform){const e=navigator.userAgentData.platform;if(e==="macOS")return"macOS";if(e==="Windows")return"Windows";if(e==="Linux")return"Linux";if(e==="Android")return"Android";if(e==="iOS")return"iOS"}return null}function uR(){const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node&&typeof window>"u")try{const r=globalThis.require;if(r)return r("os").release()}catch{return null}}if(typeof Deno<"u"&&Deno.osRelease)try{return Deno.osRelease()}catch{return null}return typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platformVersion?navigator.userAgentData.platformVersion:null}function hR(){if(typeof Deno<"u")return"deno";if(typeof Bun<"u")return"bun";const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node)return"node"}return null}function dR(){if(typeof Deno<"u"&&Deno.version)return Deno.version.deno;if(typeof Bun<"u"&&Bun.version)return Bun.version;const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node)return e.node}return null}function fR(){const t={"X-Client-Info":`supabase-js-${Ci}/${lR}`},e=cR();e&&(t["X-Supabase-Client-Platform"]=e);const r=uR();r&&(t["X-Supabase-Client-Platform-Version"]=r);const s=hR();s&&(t["X-Supabase-Client-Runtime"]=s);const n=dR();return n&&(t["X-Supabase-Client-Runtime-Version"]=n),t}const pR=fR(),mR={headers:pR},gR={schema:"public"},yR={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},AR={};function co(t){"@babel/helpers - typeof";return co=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},co(t)}function xR(t,e){if(co(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e);if(co(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function bR(t){var e=xR(t,"string");return co(e)=="symbol"?e:e+""}function wR(t,e,r){return(e=bR(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Zg(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function Oe(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Zg(Object(r),!0).forEach(function(s){wR(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zg(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}const VR=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),qR=()=>Headers,vR=(t,e,r)=>{const s=VR(r),n=qR();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:t;let c=new n(o?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(i,Oe(Oe({},o),{},{headers:c}))}};function _R(t){return t.endsWith("/")?t:t+"/"}function SR(t,e){var r,s;const{db:n,auth:i,realtime:o,global:a}=t,{db:l,auth:c,realtime:u,global:h}=e,d={db:Oe(Oe({},l),n),auth:Oe(Oe({},c),i),realtime:Oe(Oe({},u),o),storage:{},global:Oe(Oe(Oe({},h),a),{},{headers:Oe(Oe({},(r=h?.headers)!==null&&r!==void 0?r:{}),(s=a?.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}function kR(t){const e=t?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(_R(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var CR=class extends aR{constructor(t){super(t)}},ER=class{constructor(t,e,r){var s,n;this.supabaseUrl=t,this.supabaseKey=e;const i=kR(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a={db:gR,realtime:AR,auth:Oe(Oe({},yR),{},{storageKey:o}),global:mR},l=SR(r??{},a);if(this.storageKey=(s=l.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=l.global.headers)!==null&&n!==void 0?n:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(u,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=vR(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Oe({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(u=>this.realtime.setAuth(u)).catch(u=>console.warn("Failed to set initial Realtime auth token:",u)),this.rest=new aP(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new tT(this.storageUrl.href,this.headers,this.fetch,r?.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new rP(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,r)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,r;if(t.accessToken)return await t.accessToken();const{data:s}=await t.auth.getSession();return(e=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,userStorage:n,storageKey:i,flowType:o,lock:a,debug:l,throwOnError:c},u,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new CR({url:this.authUrl.href,headers:Oe(Oe({},d),u),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,userStorage:n,flowType:o,lock:a,debug:l,throwOnError:c,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new vP(this.realtimeUrl.href,Oe(Oe({},t),{},{params:Oe(Oe({},{apikey:this.supabaseKey}),t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e?.access_token)})}_handleTokenChanged(t,e,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const PR=(t,e,r)=>new ER(t,e,r);function TR(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const r=e.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}TR()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const of=PR("https://pkswdnpftrundnewgnya.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrc3dkbnBmdHJ1bmRuZXdnbnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODI2MzIsImV4cCI6MjA2ODI1ODYzMn0.r_Y1RLOGJ55C0De5SBTVXqO09SMDqgV38sQuE-oDxXE"),RR=async t=>{if(t.locator.campaignName===void 0)throw new Error("can not save a campaign without a name");const e=await of.rpc("save_campaign_version",{p_name:t.locator.campaignName,p_data:await JE(t),p_published:t.meta?.published??!1});if(e.error)throw new Error(`error saving to db ${e.error.message} ${e.error.details}`,{cause:e.error});return e.data},MR=async t=>{const e=await of.rpc("get_latest_campaign",{p_campaign_name:t.campaignName,p_user_id:t.userId,p_version:t.version===-1?void 0:t.version});if(e.error)throw new Error("could not get campaign",{cause:e.error});const r=await dw(e.data.data);return Object.values(r.rooms).forEach(s=>{delete s.size}),r.locator===void 0&&(r.locator={userId:t.userId||"upgraded, unknown",campaignName:t.campaignName,version:e.data.version}),delete r.name,r},IR=async({publishedOnly:t})=>{const e=await of.rpc("get_all_users_latest_campaigns",{p_published_only:t});if(e.error)throw new Error("could not get user campaigns",{cause:e.error});return e.data},Li=t=>{const e=[];for(let r=t;r!==void 0;r=r instanceof Error?r.cause:void 0)r instanceof Error&&e.push({message:r.message,stack:r.stack});return e},es=BE({reducerPath:"campaignsApi",baseQuery:mE(),endpoints:t=>({getCampaign:t.query({async queryFn(e){try{return e.userId==="@@original"&&e.campaignName==="original"?{data:(await zE()).campaign}:e.campaignName.startsWith("data:")?{data:await dw(e.campaignName.substring(5))}:{data:await MR(e)}}catch(r){return{error:Li(new Error(`getCampaign queryFn( ${JSON.stringify(e)} ) failed: ${r}`))}}}}),getAllUsersLatestCampaigns:t.query({async queryFn({publishedOnly:e}){try{return{data:await IR({publishedOnly:e})}}catch(r){return{error:Li(new Error(`getAllUsersLatestCampaigns queryFn() failed: ${r}`))}}}}),saveCampaign:t.mutation({async queryFn(e){try{return{data:await RR(e)}}catch(r){return{error:Li(new Error(`saveCampaign queryFn( ${JSON.stringify(e)} ) failed: ${r}`))}}}})})}),{useGetAllUsersLatestCampaignsQuery:Cw}=es,jR=es.endpoints.getCampaign.select,OR=(t,e)=>jR(e)(t).data,wt=t=>e=>ul(e.gameMenus.userSettings,t)??ul(Sn,t),ml=wt("inputAssignment"),IU=t=>t.gameMenus.openMenus.length>0,NR=()=>X(t=>t.gameMenus.cheatsOn),Ew=t=>t.gameMenus.assigningInput!==void 0,Pw=()=>X(Ew),BR=t=>{if(t.gameMenus.userSettings.inputAssignment===void 0)return"Default";for(const[e,r]of Ge(Bx(qn)))if(sE(r.inputAssignment,t.gameMenus.userSettings.inputAssignment))return e},kn=()=>X(t=>t.gameMenus.gameRunning),zR=wt("showFps"),Ql=wt("displaySettings.emulatedResolution"),af=wt("gameSpeed"),DR=()=>X(Ql),LR=wt("displaySettings.uncolourised"),lf=()=>X(LR),FR=wt("displaySettings.crtFilter"),Tw=wt("infiniteLivesPoke"),Rw=wt("infiniteDoughnutsPoke"),jU=t=>t.gameMenus.gameInPlay.planetsLiberated.egyptus&&t.gameMenus.gameInPlay.planetsLiberated.bookworld&&t.gameMenus.gameInPlay.planetsLiberated.penitentiary&&t.gameMenus.gameInPlay.planetsLiberated.safari,cf=wt("directionsRelativeTo"),uf=()=>X(cf),hf=wt("inputDirectionMode"),Mw=()=>X(hf),UR=t=>ch(Ge(Nr(t.gameMenus.gameInPlay.planetsLiberated)).filter(Boolean)),$R=wt("displaySettings.showBoundingBoxes"),OU=()=>X($R),HR=wt("displaySettings.showShadowMasks"),NU=()=>X(HR),GR=wt("onScreenControls"),WR=wt("soundSettings.mute"),KR=wt("soundSettings.noFootsteps"),BU=({gameMenus:t,upscale:e})=>(t.userSettings.onScreenControls??Sn.onScreenControls)&&e.upscale.rotate90===!1,YR=()=>X(GR),QR=(t,e)=>!!(ul(t.userSettings,e)??ul(Sn,e)??!1),XR=()=>X(t=>t.gameMenus.gameInPlay.roomsExplored),Iw=t=>{const e=JR(t);if(!e)throw new Error(`No current campaign. Campaign locator is:
${JSON.stringify(t.gameMenus.gameInPlay.campaignLocator,null,2)}`);return e},jw=Xd(Iw),JR=t=>{const e=t.gameMenus.gameInPlay.campaignLocator;return e===void 0?void 0:OR(t,e)},Lh=[1,1.2,1.5,2],zU=["none","non-wall","all"],mi=t=>P0(to(t,"userId","campaignName")),Ow=["4-way","8-way","analogue"],ZR=At()!=="server",eM=ZR?er().has("cheats"):!1,tM={blacktooth:!1,bookworld:!1,egyptus:!1,penitentiary:!1,safari:!1},Fh={planetsLiberated:tM,roomsExplored:{},scrollsRead:{},reincarnationPoint:void 0,freeCharacters:{}},Uh={userSettings:{displaySettings:{},soundSettings:navigator.webdriver?{mute:!0}:{}},gameRunning:!1,gameInPlay:Fh,openMenus:[{menuId:"mainMenu",scrollableSelection:!1,menuParam:pe}],assigningInput:void 0,cheatsOn:eM,savedGames:{saves:{}}},Mo=Sr({name:"gameMenus",initialState:Uh,reducers:{setEmulatedResolution(t,{payload:e}){let r;e===void 0?r=pa(Q1,Ql({gameMenus:t})):r=e,t.userSettings.displaySettings.emulatedResolution=r},setGameSpeed(t,{payload:e}){let r;e===void 0?r=pa(Lh,af({gameMenus:t})):r=e,t.userSettings.gameSpeed=r},scrollRead(t,{payload:e}){e.source==="manual"?(t.gameInPlay.scrollsRead[e.page]=!0,t.openMenus=[{menuId:`markdown/${e.page}`,scrollableSelection:!1,menuParam:pe}]):t.openMenus=[{menuId:"markdown/inline",scrollableSelection:!1,menuParam:{markdown:e.markdown}}]},nextInputDirectionMode(t){t.userSettings.inputDirectionMode=pa(Ow,hf({gameMenus:t}))},nextDirectionRelativeTo(t){t.userSettings.directionsRelativeTo=pa(Zb,cf({gameMenus:t}))},inputAddedDuringAssignment(t,{payload:e}){if(t.assigningInput===void 0)throw new Error("reducer called while not assigning keys");const r=(o,a)=>{o.includes(a)||o.push(a)},{presses:s,axes:n,action:i}=t.assigningInput;switch(e.type){case"key":r(s.keys,e.input);break;case"gamepadButtons":r(s.gamepadButtons,e.input);break;case"gamepadAxes":{fn.includes(i)&&r(n,e.input);break}}},doneAssigningInput(t){if(t.assigningInput===void 0)throw new Error("illegal action for state");const{action:e,presses:r,axes:s}=t.assigningInput,n=r.keys.length+r.gamepadButtons.length+s.length,i=t.userSettings.inputAssignment===void 0?t.userSettings.inputAssignment=structuredClone(qn.Default.inputAssignment):t.userSettings.inputAssignment;n>0&&(i.presses[e]=r,(e==="left"||e==="right")&&(i.axes.x=s),(e==="towards"||e==="away")&&(i.axes.y=s)),t.assigningInput=void 0},menuOpenOrExitPressed(t){if(t.openMenus.length>0){if(t.openMenus.length===1&&!t.gameRunning)return;const[,...e]=t.openMenus;t.openMenus=e}else t.openMenus=[{menuId:"mainMenu",scrollableSelection:!1,menuParam:pe}]},goToSubmenu(t,{payload:e}){t.openMenus=[{menuId:e,scrollableSelection:!1,menuParam:{}},...t.openMenus]},closeAllMenus(t){t.openMenus=[]},gameStarted(t,{payload:{campaignLocator:e,noShowCrowns:r}}){if(t.gameRunning)throw new Error("game is already running");t.openMenus=r?[]:[{menuId:"crowns",scrollableSelection:!1,menuParam:{playMusic:!1}}],t.gameRunning=!0,t.gameInPlay={...Fh,campaignLocator:e}},backToParentMenu(t){const[,...e]=t.openMenus;t.openMenus=e},assignInputStart(t,{payload:e}){t.assigningInput={action:e,presses:{gamepadButtons:[],keys:[]},axes:[]}},keyAssignmentPresetChosen(t,{payload:e}){const[,...r]=t.openMenus;t.openMenus=r,t.userSettings.inputAssignment=qn[e].inputAssignment},setFocussedMenuItemId(t,{payload:{focussedItemId:e,scrollableSelection:r}}){const[s]=t.openMenus;s.focussedItemId=e,s.scrollableSelection=r},holdPressed(t,{payload:e}){t.openMenus.length>0?t.openMenus[0]?.menuId==="hold"&&e!=="hold"&&(t.openMenus=[]):e!=="unhold"&&(t.openMenus=[{menuId:"hold",scrollableSelection:!1,menuParam:pe}])},mapPressed(t){const e={menuId:"map",scrollableSelection:!1,menuParam:pe};if(t.openMenus.length>=1){const s=t.openMenus.at(0)?.menuId;if(s==="map"){const[,...n]=t.openMenus;t.openMenus=n}else s==="hold"&&(t.openMenus=[e,...t.openMenus])}else t.openMenus=[e]},setShowBoundingBoxes(t,{payload:e}){t.userSettings.displaySettings.showBoundingBoxes=e},setShowShadowMasks(t,{payload:e}){t.userSettings.displaySettings.showShadowMasks=e},toggleUserSetting(t,{payload:{path:e,value:r}}){eE(t.userSettings,e,r??!QR(t,e))},crownCollected(t,{payload:e}){t.gameInPlay.planetsLiberated[e]=!0;const r=Object.values(t.gameInPlay.planetsLiberated).every(i=>i),n={menuId:"crowns",scrollableSelection:!1,menuParam:{playMusic:!(t.userSettings.soundSettings.mute??Sn.soundSettings.mute)}};r?t.openMenus=[{menuId:"proclaimEmperor",scrollableSelection:!1,menuParam:pe},n]:t.openMenus=[n]},roomExplored(t,{payload:e}){t.gameInPlay.roomsExplored[e]=!0},gameOver(t,{payload:{offerReincarnation:e}}){if(e&&t.gameInPlay.reincarnationPoint!==void 0)t.openMenus=[{menuId:"score",scrollableSelection:!1,menuParam:pe},{menuId:"offerReincarnation",scrollableSelection:!1,menuParam:pe}];else{t.gameRunning=!1,delete t.gameInPlay.reincarnationPoint;const r=t.gameInPlay.campaignLocator,s=r&&mi(r);s&&(delete t.savedGames.saves[s],delete t.savedGames.lastSavedCampaignLocator),t.openMenus=[{menuId:"score",scrollableSelection:!1,menuParam:pe},{menuId:"mainMenu",scrollableSelection:!0,menuParam:pe}]}},reincarnationFishEaten(t,{payload:e}){t.gameInPlay.reincarnationPoint=e},reincarnationAccepted(t){delete t.gameInPlay.reincarnationPoint,t.openMenus=[{menuId:"reincarnatedRestart",scrollableSelection:!1,menuParam:pe}]},saveGame(t,{payload:e}){const r=t.gameInPlay.campaignLocator;if(r===void 0)throw new Error("trying to save a game, but seems like there's no campaign to save against");if(zd())throw new Error("shouldn't be saving in playtest mode");t.savedGames.saves[mi(r)]=e,t.savedGames.lastSavedCampaignLocator=r},gameRestoreFromSave(t,{payload:e}){t.gameInPlay={freeCharacters:{},...e},e.freeCharacters===void 0&&(t.gameInPlay.freeCharacters={})},errorCaught(t,{payload:e}){t.openMenus=[{menuId:"errorCaught",scrollableSelection:!1,menuParam:e}]},errorDismissed(t,{payload:e}){switch(e){case"ignore":t.openMenus=[];break;case"clearAllData":Object.assign(t,Uh),t.gameRunning=!1;break}},debugItemClicked(t,e){},characterRoomChange(t,e){},lostLife(t,e){},characterReachesFreedom(t,{payload:e}){t.gameInPlay.freeCharacters[e]=!0}},extraReducers(t){t.addCase(_o,(e,r)=>{if(er().get("campaignName")?.startsWith("data:"))return;const s=[{menuId:"hold",scrollableSelection:!1,menuParam:pe}],n={userId:er().get("campaignAuthorUserId")??void 0,campaignName:er().get("campaignName")??void 0},i=r.payload?.savedGames;if((c=>c.userId!==void 0&&c.campaignName!==void 0)(n)){e.gameRunning=!0;const c=i?.saves[mi(n)];if(c){e.gameRunning=!0,e.gameInPlay={freeCharacters:{},...c.store.gameMenus.gameInPlay},e.openMenus=s;return}else{e.gameRunning=!0,e.gameInPlay={...Fh,campaignLocator:n},e.openMenus=s;return}}const a=i?.lastSavedCampaignLocator,l=a&&i.saves[mi(a)];l&&(e.gameRunning=!0,e.gameInPlay={freeCharacters:{},...l.store.gameMenus.gameInPlay},e.openMenus=s)})},selectors:{selectHasError(t){return t.openMenus.some(e=>e.menuId==="errorCaught")},selectSaveForCampaign(t,e){return t.savedGames.saves[mi(e)]}}}),{assignInputStart:Be,backToParentMenu:xt,characterReachesFreedom:DU,characterRoomChange:Nw,closeAllMenus:rM,crownCollected:sM,debugItemClicked:nM,doneAssigningInput:iM,errorCaught:df,errorDismissed:ey,gameOver:ff,gameRestoreFromSave:LU,gameStarted:uo,goToSubmenu:ut,holdPressed:Bw,inputAddedDuringAssignment:oM,keyAssignmentPresetChosen:aM,lostLife:lM,mapPressed:cM,menuOpenOrExitPressed:ty,nextDirectionRelativeTo:uM,nextInputDirectionMode:hM,reincarnationAccepted:pf,reincarnationFishEaten:FU,roomExplored:dM,saveGame:fM,scrollRead:UU,setEmulatedResolution:mf,setFocussedMenuItemId:gf,setGameSpeed:pM,setShowBoundingBoxes:$U,setShowShadowMasks:HU,toggleUserSetting:rr}=Mo.actions,{selectHasError:GU}=Mo.selectors,WU=Mo.selectors.selectSaveForCampaign,mM=()=>{const{hostname:t}=window.location;if(t==="localhost"||t.endsWith(".local")||t==="::1"||t==="[::1]")return!0;const e=t.startsWith("[")?t.slice(1,-1):t;if(e.toLowerCase().startsWith("fe80:")||e.toLowerCase().startsWith("fc00:")||e.toLowerCase().startsWith("fd00:")||t.startsWith("127.")||t.startsWith("192.168.")||t.startsWith("10."))return!0;if(t.startsWith("172.")){const r=Number.parseInt(t.split(".")[1]);if(r>=16&&r<=31)return!0}return!1},ry="https://cloud.umami.is/script.js",gM="11813495-5844-44e6-acd4-f81e9c955951",yM=()=>{const e=er().get("track");if(e!==null){const s=e==="1";return console.log(s?" tracking explicitly enabled via query param":" tracking explicitly disabled via query param"),s}const r=mM();return console.log(r?" not tracking because running on local network":" tracking enabled based on non-local network hostname"),!r},AM=gr(ff,pf,lM,df,uo,sM,Nw),xM=()=>{const t=Ax();v.useEffect(()=>Cd({matcher:AM,effect(r,{getState:s}){const n=t?.gameState,[,i]=r.type.split("/"),o=s(),a=n?Math.round(n.gameTime/1e3):void 0,l=r.payload===void 0?{}:r.type==="gameMenus/crownCollected"?{crownForPlanet:r.payload}:r.type==="gameMenus/gameStarted"?void 0:r.type==="gameMenus/lostLife"?{position:r.payload.characterLosingLifeItem.state.position}:r.payload,c={gameTimeSeconds:a,cheatsOn:o.gameMenus.cheatsOn,...l,currentCharacter:n?.currentCharacterName,inRoom:n?.characterRooms[n.currentCharacterName]};window.umami?(console.debug(" umami event:",i,c),window.umami.track(i,c)):console.debug(" no umami for event:",i,c)}}),[t])},bM=()=>{if(document.querySelector(`script[src="${ry}"]`))return;const t=document.createElement("script");t.src=ry,t.dataset.websiteId=gM,t.onload=()=>console.log(" umami script dynamically loaded"),document.head.appendChild(t)},wM=()=>(xM(),v.useEffect(bM,[]),null),VM=()=>{const t=v.useRef(null);return t.current===null&&(t.current=yM()),t.current?p.jsx(wM,{}):null},qM=zn(()=>Bn(()=>import("./Cheats-BzolzXgu.js"),__vite__mapDeps([8,5,6,9,10]))),Ys=(t,e,r)=>{const s=({x:i,y:o,w:a,h:l,pivot:c})=>e==="x"?{...Kr(r,{x:-i-a-1,y:o}),w:a,h:l,pivot:{x:a-c.x,y:c.y}}:{...Kr(r,{x:i+2,y:o}),w:a,h:l,pivot:c};function*n(){yield[`door.frame.${t}.${e}.whole`,{frame:{...s({x:-41,y:0,w:40,h:64,pivot:{x:9,y:63}})}}],yield[`door.frame.${t}.${e}.far`,{frame:{...s({x:-18,y:0,w:17,h:57,pivot:{x:9,y:52}})}}],yield[`door.frame.${t}.${e}.near`,{frame:{...s({x:-41,y:6,w:20,h:58,pivot:{x:8,y:58}})}}],yield[`door.frame.${t}.${e}.top`,{frame:{...s({x:-57,y:-1,w:15,h:36,pivot:{x:0,y:37}})}}]}return Un(n())},vM={frames:{...Ys("generic","y",{x:580,y:415}),...Ys("generic","x",{x:582,y:415}),...Ys("moonbase","y",{x:752,y:232}),...Ys("moonbase","x",{x:915,y:232}),...Ys("moonbase.dark","y",{x:752,y:306}),...Ys("moonbase.dark","x",{x:915,y:306})}},us=(t,{x:e,y:r},s)=>{function*n(){yield[`${t}.left`,{frame:{x:e,y:r,...s}}],yield[`${t}.away`,{frame:{x:e+s.w+1,y:r,...s}}],yield[`${t}.towards`,{frame:{x:e,y:r+s.h+1,...s}}],yield[`${t}.right`,{frame:{x:e+s.w+1,y:r+s.h+1,...s}}]}return Object.fromEntries(n())},xe=(t,e,{x:r,y:s},n,i=e)=>{function*o(){for(let a=0;a<e;a++)yield[`${t}.${a+1}`,{frame:{x:r+a%i*(n.w+1),y:s+Math.floor(a/i)*(n.h+1),...n}}]}return Object.fromEntries(o())},sy=(t,{x:e,y:r},s,n=t.length,i)=>{function*o(){for(let a=0;a<t.length;a++)yield[i?`${i}.${t[a]}`:t[a],{frame:{x:e+a%n*(s.w+1),y:r+Math.floor(a/n)*(s.h+1),...s}}]}return Object.fromEntries(o())},_M=(t,e,r,s)=>({...xe(`${t}.left`,e,r,s),...xe(`${t}.away`,e,Kr(r,{x:(s.w+1)*e}),s),...xe(`${t}.towards`,e,Kr(r,{y:s.h+1}),s),...xe(`${t}.right`,e,Kr(r,{x:(s.w+1)*e,y:s.h+1}),s)}),Fr=(t,e)=>[...Ge(Nx(1,e+1)).map(r=>`${t}.${String(r)}`)],SM={frames:{...sy(["share","save","open","pointer","eyedropper"],{x:640,y:10},{w:12,h:12},void 0,"editor.tool"),...sy(["single","corridor","double","triple.line","triple.^","quad.square","quad.s","quad.31","quad.t","5.x"],{x:640,y:0},{w:9,h:9},void 0,"editor.addRoom")}},zw={" ":"space",",":"comma",";":"scolon",":":"colon",".":"dot","'":"sQuote","":"lQuote","":"rQuote","`":"backtick","<":"lt",">":"gt","?":"questMk","!":"exclMk","-":"hyph","/":"slash","\\":"bSlash"},Lt=t=>zw[t].toUpperCase(),Dw=t=>zw[t]??t,$h={w:32,h:16},It={w:16,h:56},J={w:32,h:28},N={w:24,h:24},Ei={w:8,h:8},kM={h:10},O=t=>({x:t.x*(N.w+1)+1,y:t.y*(N.h+1)+2}),re=t=>({x:t.x*(J.w+1)+1,y:t.y*(J.h+1)+682}),Lw="",Fw="",CM="",EM="",PM="",TM="",RM=[{char:"a",width:8},{char:"b",width:8},{char:"c",width:7},{char:"d",width:8},{char:"e",width:8},{char:"f",width:6},{char:"g",width:8},{char:"h",width:8},{char:"i",width:4},{char:"j",width:5},{char:"k",width:8},{char:"l",width:5},{char:"m",width:9},{char:"n",width:8},{char:"o",width:8},{char:"p",width:8},{char:"q",width:8},{char:"r",width:5},{char:"s",width:6},{char:"t",width:6},{char:"u",width:8},{char:"v",width:8},{char:"w",width:9},{char:"x",width:8},{char:"y",width:8},{char:"z",width:6},{char:"?",width:6},{char:"!",width:4},{char:".",width:4},{char:",",width:4},{char:";",width:4},{char:":",width:3},{char:"/",width:7},{char:"\\",width:7},{char:"",width:4},{char:"",width:4},{char:"'",width:4},{char:"-",width:5}],MM=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9","_","#","","","","",{char:"",width:16},{char:Lw,width:16},{char:Fw,width:16}],IM=[" ",Lt("?"),Lt("!"),Lt("."),Lt(","),Lt(";"),Lt(":"),Lt("/"),Lt("\\"),Lt(""),Lt(""),Lt("'"),"`",Lt("-"),"+","%","","","","","","","","","(",")","[","]","<",">","","","","EnterFullscreen","ExitFullscreen","","*","@","",CM,EM,PM,TM,"","","^","","","",""],Au=(t,e,r=Ei.h)=>{function*s(){let{x:n}=e;for(let i=0;i<t.length;i++){const o=t[i],a=typeof o=="string"?o:o.char,c=(typeof o=="string"?void 0:o.width)??Ei.w;yield[`hud.char.${Dw(a)}`,{frame:{x:n,y:e.y,...Ei,w:c,h:r}}],n+=Math.max(c,Ei.w)+1}}return Un(s())},jM={frames:{...Au(RM,{x:1,y:994},10),...Au(MM,{x:1,y:1005}),...Au(IM,{x:1,y:1014})}},Z=(t,e)=>Object.assign([...t],{animationSpeed:e});let he=0,ne=0;const OM={...xe("dalek",2,O({x:0,y:0}),N),...xe("dalek.dark",2,O({x:0,y:1}),N),"shadowMask.dalek":{frame:{...O({x:2,y:0}),...N}},headlessBase:{frame:{...O({x:7,y:0}),...N}},...xe("headlessBase",4,O({x:8,y:0}),N),"headlessBase.all":{frame:{...O({x:12,y:0}),...N}},..._M("turtle",2,O({x:0,y:3}),N),"shadowMask.turtle.away":{frame:{...O({x:4,y:3}),...N}},"shadowMask.turtle.right":{frame:{...O({x:4,y:4}),...N}},...us("cyberman",O({x:6,y:3}),N),...us("skiHead.greenAndPink",O({x:9,y:3}),{w:24,h:32}),...us("skiHead.starsAndStripes",O({x:11,y:3}),{w:24,h:32}),"shadowMask.skiHead.away":{frame:{...O({x:13,y:3}),...N,h:32}},"shadowMask.skiHead.right":{frame:{...O({x:14,y:3}),...N,h:32}},...us("charles",O({x:0,y:5}),N),"shadowMask.charles.away":{frame:{...O({x:2,y:5}),...N}},"shadowMask.charles.right":{frame:{...O({x:2,y:6}),...N}},...us("monkey",O({x:0,y:7}),N),...us("computerBot",O({x:3,y:7}),N),...us("elephant",O({x:6,y:7}),N),...xe("helicopterBug",4,O({x:9,y:7}),N),"barrier.x.disappearing":{frame:{...O({x:17,y:0}),...N,pivot:{x:18,y:23}}},"barrier.y.disappearing":{frame:{...O({x:18,y:0}),...N,pivot:{x:6,y:23}}},"barrier.x":{frame:{...O({x:19,y:0}),...N,pivot:{x:18,y:23}}},"barrier.y":{frame:{...O({x:20,y:0}),...N,pivot:{x:6,y:23}}},"shadow.barrier.y":{frame:{...O({x:21,y:0}),...N,pivot:{x:6,y:22}}},"shadowMask.barrier.y":{frame:{...O({x:22,y:0}),...N,pivot:{x:6,y:22}}},"joystick.stick":{frame:{...O({x:18,y:1}),...N}},"joystick.ball":{frame:{...O({x:19,y:1}),...N}},"joystick.whole":{frame:{...O({x:20,y:1}),...N}},"shadowMask.joystick":{frame:{...O({x:21,y:1}),...N}},ball:{frame:{...O({x:17,y:2}),...N}},"shadowMask.ball":{frame:{...O({x:18,y:2}),...N}},"ball.uncolourised":{frame:{...O({x:19,y:2}),...N}},"spikyBall.1":{frame:{...O({x:20,y:2}),...N}},"spikyBall.2":{frame:{...O({x:21,y:2}),...N}},tower:{frame:{...O({x:15,y:3}),...N}},"shadowMask.tower":{frame:{...O({x:16,y:3}),...N}},sticks:{frame:{...O({x:18,y:3}),...N}},cube:{frame:{...O({x:19,y:3}),...N}},drum:{frame:{...O({x:21,y:3}),...N}},"shadowMask.drum":{frame:{...O({x:22,y:3}),...N}},puck:{frame:{...O({x:15,y:4}),...N}},"shadow.smallRound":{frame:{...O({x:16,y:4}),...N}},"shadowMask.smallRound":{frame:{...O({x:17,y:4}),...N}},"spring.compressed":{frame:{...O({x:19,y:4}),...N}},"spring.released":{frame:{...O({x:20,y:4}),...N}},"shadowMask.spring.compressed":{frame:{...O({x:21,y:4}),...N}},"shadowMask.spring.released":{frame:{...O({x:22,y:4}),...N}},...xe("fish",2,O({x:16,y:6}),N),doughnuts:{frame:{...O({x:18,y:6}),...N}},"shadowMask.doughnuts":{frame:{...O({x:19,y:6}),...N}},hooter:{frame:{...O({x:21,y:6}),...N}},bag:{frame:{...O({x:22,y:6}),...N}},whiteRabbit:{frame:{...O({x:24,y:6}),...N}},"shadowMask.whiteRabbit":{frame:{...O({x:25,y:6}),...N}},"crown.blacktooth":{frame:{...O({x:he=16,y:ne=7}),...N}},"crown.safari":{frame:{...O({x:++he,y:ne}),...N}},"crown.egyptus":{frame:{...O({x:++he,y:ne}),...N}},"crown.penitentiary":{frame:{...O({x:++he,y:ne}),...N}},"crown.bookworld":{frame:{...O({x:++he,y:ne}),...N}},"crown.uncolourised":{frame:{...O({x:++he,y:ne}),...N}},scroll:{frame:{...O({x:he=16,y:ne=8}),...N,pivot:{x:17,y:24}}},"shadow.scroll":{frame:{...O({x:++he,y:ne}),...N,pivot:{x:17,y:24}}},"shadowMask.scroll":{frame:{...O({x:++he,y:ne}),...N,pivot:{x:17,y:24}}},buttonInGame:{frame:{...O({x:he=16,y:ne=9}),...N}},"buttonInGame.pressed":{frame:{...O({x:++he,y:ne}),...N}},"shadowMask.buttonInGame":{frame:{...O({x:++he,y:ne}),...N}},"switch.left":{frame:{...O({x:++he,y:ne}),...N}},"switch.right":{frame:{...O({x:++he,y:ne}),...N}},"shadowMask.switch":{frame:{...O({x:++he,y:ne}),...N}},"lift.static":{frame:{...O({x:16,y:ne=10}),...N}},...xe("lift",4,O({x:17,y:ne}),N),"shadow.smallBlock":{frame:{...O({x:21,y:ne}),...N}},"shadowMask.smallBlock":{frame:{...O({x:22,y:ne}),...N}},"shadow.wallCorner":{frame:{...O({x:21,y:ne+1}),...N}},...xe("shadow.lift",4,O({x:17,y:11}),N),...xe("bubbles.white",3,O({x:he=23,y:ne=9}),N),...xe("bubbles.taupe",3,O({x:he,y:++ne}),N),...xe("bubbles.jetpack",2,O({x:he,y:++ne}),N),...xe("bubbles.blueGreen",2,O({x:he,y:++ne}),N),...xe("bubbles.cold",2,O({x:he,y:++ne}),N),"block.organic":{frame:{...re({x:0,y:0}),...J}},"block.organic.disappearing":{frame:{...re({x:1,y:0}),...J}},"block.organic.dark":{frame:{...re({x:2,y:0}),...J}},"block.organic.dark.disappearing":{frame:{...re({x:3,y:0}),...J}},"shadowMask.organic":{frame:{...re({x:4,y:0}),...J}},"block.artificial":{frame:{...re({x:5,y:0}),...J}},"block.artificial.disappearing":{frame:{...re({x:6,y:0}),...J}},"shadowMask.artificial":{frame:{...re({x:7,y:0}),...J}},"book.x":{frame:{...re({x:8,y:0}),...J}},"book.y":{frame:{...re({x:9,y:0}),...J}},"shadowMask.book":{frame:{...re({x:10,y:0}),...J}},"shadowMask.fullBlock":{frame:{...re({x:10,y:0}),...J}},"shadow.fullBlock":{frame:{...re({x:11,y:0}),...J}},spikes:{frame:{...re({x:12,y:0}),...J}},"shadowMask.spikes":{frame:{...re({x:13,y:0}),...J}},stepStool:{frame:{...re({x:he=0,y:ne=1}),...J}},"shadowMask.stepStool":{frame:{...re({x:++he,y:ne}),...J}},"volcano.1":{frame:{...re({x:++he,y:ne}),...J}},"volcano.2":{frame:{...re({x:++he,y:ne}),...J}},"shadowMask.volcano":{frame:{...re({x:++he,y:ne}),...J}},hushPuppy:{frame:{...re({x:++he,y:ne}),...J}},"shadowMask.hushPuppy":{frame:{...re({x:++he,y:ne}),...J}},"toaster.on":{frame:{...re({x:++he,y:ne}),...J}},"toaster.off":{frame:{...re({x:++he,y:ne}),...J}},"toaster.off.1":{frame:{...re({x:he,y:ne}),...J}},"toaster.off.2":{frame:{...re({x:++he,y:ne}),...J}},"shadowMask.toaster":{frame:{...re({x:++he,y:ne}),...J}},sandwich:{frame:{...re({x:++he,y:ne}),...J}},"shadowMask.sandwich":{frame:{...re({x:++he,y:ne}),...J}},...xe("conveyor.x",7,re({x:0,y:2}),J),"shadowMask.conveyor":{frame:{...re({x:7,y:2}),...J}},button:{frame:{...re({x:9,y:2}),...J}},"button.pressed":{frame:{...re({x:10,y:2}),...J}},"button.surfaceMask":{frame:{...re({x:11,y:2}),...J}},...xe("conveyor.y",7,re({x:0,y:3}),J),teleporter:{frame:{...re({x:7,y:3}),...J}},...xe("teleporter.flashing",2,re({x:8,y:3}),J),"shadowMask.teleporter":{frame:{...re({x:10,y:3}),...J}},"shadowMask.teleporter.flashing":{frame:{...re({x:11,y:3}),...J}},...xe("particle.head",4,{x:100,y:798},{w:9,h:11}),...xe("particle.heels",4,{x:100,y:856},{w:9,h:11})},Uw={frames:OM,animations:{"teleporter.flashing":Z(["teleporter.flashing.1","teleporter.flashing.2"],.5),fish:Z(["fish.1","fish.2"],.25),lift:Z(["lift.1","lift.2","lift.3","lift.4"],.5),"shadow.lift":Z(["shadow.lift.1","shadow.lift.2","shadow.lift.3","shadow.lift.4"],.5),dalek:Z(["dalek.1","dalek.2"],.5),"dalek.dark":Z(["dalek.dark.1","dalek.dark.2"],.5),"turtle.left":Z(["turtle.left.1","turtle.left.2"],.25),"turtle.away":Z(["turtle.away.1","turtle.away.2"],.25),"turtle.towards":Z(["turtle.towards.1","turtle.towards.2"],.25),"turtle.right":Z(["turtle.right.1","turtle.right.2"],.25),helicopterBug:Z(["helicopterBug.1","helicopterBug.2","helicopterBug.3","helicopterBug.4"],.5),"bubbles.cold":Z(["bubbles.cold.1","bubbles.cold.2"],.25),"bubbles.blueGreen":Z(["bubbles.blueGreen.1","bubbles.blueGreen.2"],.25),"bubbles.white":Z(["bubbles.white.1","bubbles.white.2","bubbles.white.3"],.5),"bubbles.bounce.white":Z(["bubbles.white.1","bubbles.white.2","bubbles.white.3","bubbles.white.2"],.5),"bubbles.doughnut":Z(["bubbles.taupe.1","bubbles.taupe.2"],.5),"bubbles.jetpack":Z(["bubbles.jetpack.1","bubbles.jetpack.2"],.25),"conveyor.x":Z(Fr("conveyor.x",7),.5),"conveyor.y":Z(Fr("conveyor.y",7),.5),volcano:Z(Fr("volcano",2),3/16),"toaster.off":Z(Fr("toaster.off",2),3/16),"spring.bounce":Z(["spring.released","spring.compressed","spring.released","spring.compressed","spring.released"],.5),"shadowMask.spring.bounce":Z(["shadowMask.spring.released","shadowMask.spring.compressed","shadowMask.spring.released","shadowMask.spring.compressed","shadowMask.spring.released"],.5),"headlessBase.scan":Z(["headlessBase.4","headlessBase","headlessBase.3","headlessBase","headlessBase.2","headlessBase","headlessBase.1","headlessBase","headlessBase","headlessBase","headlessBase","headlessBase","headlessBase.all","headlessBase","headlessBase","headlessBase","headlessBase"],.25),"headlessBase.flash":Z(["headlessBase.all","headlessBase"],.5),switch:Z(["switch.left","switch.right"],.02),"particle.head.fade":Z(Fr("particle.head",4),.5),"particle.heels.fade":Z(Fr("particle.heels",4),.5)}},NM=.5,$w=5e3,BM=$w*2,gi=(t,e)=>{const r=Math.round($w/(To*4)),s=`head.walking.${t}.${e}`,n=`head.blinking.${t}`,i=[...new Array(r-3).fill(s),n,s,n];return Z(i,.5)},yi=(t,e=2)=>{const r=Math.round(BM/(To*4)),s=t==="towards"||t==="right"?`heels.standing.${t}`:`heels.walking.${t}.${e}`,n=`heels.blinking.${t}`,i=[...new Array(Math.floor(r*.8)).fill(s),...new Array(Math.ceil(r*.2)).fill(n)];return Z(i,.5)},ny=(t,e,r)=>{const s=["awayLeft","away","awayRight","right","towardsRight","towards","towardsLeft","left"];function*n(){for(let i=0;i<Vn.length;i++){const o=s[i];r[o]?.noShadowMaskFalling||(yield[`shadowMask.${t}.falling.${o}`,{frame:{...O({x:e.x,y:e.y+i}),...N}}]),r[o]?.noShadowMask||(yield[`shadowMask.${t}.${o}`,{frame:{...O({x:e.x+1,y:e.y+i}),...N}}]);for(let a=1;a<=3;a++)yield[`${t}.walking.${o}.${a}`,{frame:{...O({x:e.x+a+1,y:e.y+i}),...N}}];yield[`${t}.falling.${o}`,{frame:{...O({x:e.x+5,y:e.y+i}),...N}}],r[o]?.noBlinking||(yield[`${t}.blinking.${o}`,{frame:{...O({x:e.x+6,y:e.y+i}),...N}}]),r[o]?.noStanding||(yield[`${t}.standing.${o}`,{frame:{...O({x:e.x+7,y:e.y+i}),...N}}])}}return Object.fromEntries(n())};function iy(t){function*e(r,s){yield`${r}.walking.${s}.1`,yield`${r}.walking.${s}.2`,yield`${r}.walking.${s}.3`,yield`${r}.walking.${s}.2`}return Vn.reduce((r,s)=>({...r,[`${t}.walking.${s}`]:Z([...e(t,s)],NM)}),{})}const zM={...xe("bubbles.head",6,O({x:1,y:10}),N),...ny("head",{x:0,y:11},{awayLeft:{noBlinking:!0,noStanding:!0,noShadowMaskFalling:!0},away:{noBlinking:!0,noStanding:!0},awayRight:{noStanding:!0,noShadowMaskFalling:!0},right:{noStanding:!0},towardsRight:{noStanding:!0},towards:{noShadowMask:!0,noStanding:!0,noShadowMaskFalling:!0},towardsLeft:{noShadowMask:!0,noStanding:!0,noShadowMaskFalling:!0},left:{noBlinking:!0,noShadowMask:!0,noStanding:!0,noShadowMaskFalling:!0}}),...xe("bubbles.heels",6,O({x:9,y:10}),N),...ny("heels",{x:8,y:11},{awayLeft:{noBlinking:!0,noStanding:!0,noShadowMaskFalling:!0},away:{noBlinking:!0,noStanding:!0,noShadowMaskFalling:!0},awayRight:{noStanding:!0,noShadowMaskFalling:!0},right:{noShadowMaskFalling:!0},towardsRight:{noStanding:!0,noShadowMaskFalling:!0},towards:{noShadowMask:!0,noShadowMaskFalling:!0},towardsLeft:{noShadowMask:!0,noStanding:!0,noShadowMaskFalling:!0},left:{noBlinking:!0,noShadowMask:!0,noStanding:!0,noShadowMaskFalling:!0}}),...xe("shine.head",6,re({x:0,y:4}),J,3),...xe("shine.heels",6,re({x:0,y:6}),J,3),blank:{frame:{...O({x:0,y:2}),...N}},"shadow.playable":{frame:{...O({x:7,y:10}),...N}}},Hw={frames:zM,animations:{...iy("head"),...iy("heels"),"heels.screenDirections":Z(["heels.walking.towardsRight.2","heels.walking.towardsLeft.2","heels.walking.awayLeft.2","heels.walking.awayRight.2"],1/16),"heels.worldDirections":Z(["heels.standing.towards","heels.walking.left.2","heels.walking.away.2","heels.standing.right"],1/16),"heels.mixedDirections":Z(["heels.walking.towardsRight.2","heels.standing.towards","heels.walking.towardsLeft.2","heels.walking.left.2","heels.walking.awayLeft.2","heels.walking.away.2","heels.walking.awayRight.2","heels.standing.right"],1/8),"head.idle.right":gi("right",3),"head.idle.towards":gi("towards",3),"head.idle.towardsRight":gi("towardsRight",2),"head.idle.towardsLeft":gi("towardsLeft",2),"head.idle.awayRight":gi("awayRight",2),"heels.idle.right":yi("right"),"heels.idle.towards":yi("towards"),"heels.idle.towardsRight":yi("towardsRight",2),"heels.idle.towardsLeft":yi("towardsLeft",2),"heels.idle.awayRight":yi("awayRight",2),"head.fadeOut":Z(["bubbles.head.1","bubbles.head.2","bubbles.head.4","bubbles.head.3","bubbles.head.4","bubbles.head.6","bubbles.head.5","bubbles.head.6","bubbles.head.5"],.5),"heels.fadeOut":Z(["bubbles.heels.1","bubbles.heels.2","bubbles.heels.4","bubbles.heels.3","bubbles.heels.4","bubbles.heels.6","bubbles.heels.5","bubbles.heels.6","bubbles.heels.5"],.5),"shine.head":Z(Fr("shine.head",6),.5),"shine.heels":Z(Fr("shine.heels",6),.5),"shine.headInSymbio":Z(["shine.head.1","shine.head.2","shine.head.3","blank","blank","blank","blank","blank","blank","shine.head.4","shine.head.5","shine.head.6"],.5),"shine.heelsInSymbio":Z(["blank","blank","blank","shine.heels.1","shine.heels.2","shine.heels.3","shine.heels.4","shine.heels.5","shine.heels.6","blank","blank","blank"],.5)}},DM={jail:["bars"],blacktooth:["plain","shield","armour"],bookworld:["book","cowboy"],egyptus:["hieroglyphics","sarcophagus"],market:["more-fruits","fruits","passage"],moonbase:["coil","window3","window2","window1","window-clear"],penitentiary:["skeleton","loop"],safari:["wall","shield","window"]},KU=["blacktooth","penitentiary","bookworld","egyptus","safari"],it=(t,e,r,s)=>{function*n(i,o,a){const l=DM[i],{w:c,h:u}=It,h=c>>1;for(let d=0;d<l.length;d++)yield[`${i}${s}.wall.${l[d]}.left`,{frame:{x:o-c*(d+1),y:a+h*d,...It}}],yield[`${i}${s}.wall.${l[d]}.away`,{frame:{x:o+c*d,y:a+h*d,...It}}];yield[`${i}${s}.floor`,{frame:{x:o-c,y:a+u,...$h}}]}return Object.fromEntries(n(t,e,r))},oy={w:16,h:13},ay={w:8,h:9},cr=74;let ot=53;const LM={...it("egyptus",834,ot,""),...it("egyptus",834,ot+=cr,".dark"),...it("moonbase",834,ot+=cr,""),...it("moonbase",834,ot+=cr,".dark"),...it("bookworld",834,ot+=cr,""),...it("bookworld",834,ot,".dark"),...it("jail",834,ot+=cr,""),...it("jail",834,ot,".dark"),...it("blacktooth",834,ot+=cr,""),...it("blacktooth",834,ot+=cr,".dark"),...it("penitentiary",834,ot+=cr,""),...it("penitentiary",834,ot,".dark"),...it("market",834,ot+=cr,""),...it("market",834,ot,".dark"),...it("safari",834,ot+=cr,""),...it("safari",834,ot,".dark"),"floorEdge.right":{frame:{x:418,y:466,...oy,pivot:{x:0,y:4}}},"floorEdge.towards":{frame:{x:401,y:466,...oy,pivot:{x:15,y:4}}},"floorEdge.half.right":{frame:{x:418,y:470,...ay,pivot:{x:0,y:0}}},"floorEdge.half.towards":{frame:{x:401,y:466,...ay,pivot:{x:7,y:0}}},"floorOverdraw.cornerNearWall":{frame:{x:623,y:452,w:It.w,h:8}},"shadow.wall.y":{frame:{x:432,y:435,w:36,h:16}},"shadow.doorFrame.top.y":{frame:{x:432,y:402,w:36,h:32,pivot:{x:18,y:31.5}}},"generic.floor.deadly":{frame:{x:785,y:462,...$h}},"generic.dark.floor.deadly":{frame:{x:785,y:479,...$h}},"generic.door.legs.pillar.y":{frame:{x:508,y:476,w:It.w,h:12}},"generic.door.legs.base.y":{frame:{x:508,y:488,w:It.w,h:9}},"generic.door.legs.pillar.x":{frame:{x:524,y:476,w:It.w,h:12}},"generic.door.legs.base.x":{frame:{x:524,y:488,w:It.w,h:9}},"generic.door.legs.threshold.double.x":{frame:{x:508,y:452,w:It.w*2,h:24}},"generic.door.legs.threshold.double.y":{frame:{x:469,y:452,w:It.w*2,h:24}},"shadowMask.door.legs.threshold.double.y":{frame:{x:469,y:430,w:It.w*2,h:21,pivot:{x:0,y:21}}},"generic.door.floatingThreshold.x":{frame:{x:457,y:492,w:26,h:19,pivot:{x:18,y:12}}},"generic.door.floatingThreshold.y":{frame:{x:430,y:492,w:26,h:19,pivot:{x:8,y:12}}},"shadowMask.door.floatingThreshold.double.y":{frame:{x:541,y:480,w:42,h:21,pivot:{x:8,y:20}}},"shadow.door.floatingThreshold.double.y":{frame:{x:584,y:480,w:42,h:21,pivot:{x:8,y:20}}},...xe("moonbase.wall.screen.window1.away",3,{x:883,y:217},{w:10,h:7}),...xe("moonbase.wall.screen.window2.away",2,{x:867,y:209},{w:10,h:7}),...xe("moonbase.wall.screen.window3.away",4,{x:851,y:201},{w:10,h:7})},Gw={frames:LM,animations:{"moonbase.wall.screen.window1.away":Z(["moonbase.wall.screen.window1.away.1","moonbase.wall.screen.window1.away.2","moonbase.wall.screen.window1.away.3"],1/16),"moonbase.wall.screen.window2.away":Z(["moonbase.wall.screen.window2.away.1","moonbase.wall.screen.window2.away.1","moonbase.wall.screen.window2.away.2"],1/16),"moonbase.wall.screen.window3.away":Z(["moonbase.wall.screen.window3.away.1","moonbase.wall.screen.window3.away.2","moonbase.wall.screen.window3.away.3","moonbase.wall.screen.window3.away.4","moonbase.wall.screen.window3.away.4"],1/16)}},FM={...Uw.frames,...Hw.frames,...Gw.frames,...jM.frames,...vM.frames,...SM.frames},pt={frames:FM,animations:{...Hw.animations,...Uw.animations,...Gw.animations},meta:{scale:1}},UM=Object.keys(pt.frames),Sa={w:1024,h:1024};function YU(t){if(!Hh(t))throw new Error(`Invalid textureId: "${t}"; textureId  {${Object.keys(pt.frames).sort().map(e=>`"${e}"`).join(`,
`)}}`)}function Hh(t){return pt.frames[t]!==void 0}function QU(t){return pt.animations[t]!==void 0}const Ww="/assets/sprites-DISRg-RN.png";var $M=`#version 300 es
precision highp float;in vec2 vTextureCoord;out vec4 finalColor;uniform sampler2D uTexture;uniform sampler2D uMask;void main(void){vec4 c=texture(uTexture,vTextureCoord);float maskVal=texture(uMask,vTextureCoord).r;vec4 shadowColor=vec4(0.0,0.0,0.0,c.a*(1.0-c.r));finalColor=mix(c,shadowColor,maskVal);}`;const HM=Ll.from({vertex:Y1,fragment:$M,name:"preprocess-shadow-textures-filter"});class GM extends Ik{#e;constructor(e){super({glProgram:HM,resources:{uMask:e.source}}),this.#e=e}destroy(e){const r=e===!0||typeof e=="object"&&e.destroyPrograms;(e===!0||typeof e=="object"&&e.destroyMask)&&this.#e?.destroy(!0),this.#e=null,super.destroy(r)}}const WM=t=>{const e=new DataView(t),r=[];r.push(t.slice(0,8));let s=8;for(;s<t.byteLength;){const a=e.getUint32(s),l=new TextDecoder().decode(new Uint8Array(t,s+4,4)),c=12+a;l!=="iCCP"&&r.push(t.slice(s,s+c)),s+=c}const n=r.reduce((a,l)=>a+l.byteLength,0),i=new Uint8Array(n);let o=0;for(const a of r)i.set(new Uint8Array(a),o),o+=a.byteLength;return i.buffer},KM=new Ve(0),YM=new Ve(16777215),QM=t=>typeof t=="function"?Ge(UM).filter(t):t,XM=(t,{rects:e,placeholderColoursMasks:r,clearColour:s})=>{const n=new cl,i=new Gn({children:[n]});if(s!==void 0&&n.rect(0,0,Sa.w,Sa.h).fill(s),e!==void 0){const{textureIds:a,color:l}=e,c=QM(a);for(const u of c){const{frame:{x:h,y:d,w:f,h:m}}=pt.frames[u];n.rect(h,d,f,m).fill(l)}}if(r!==void 0&&r.textureIds.length>0){const{textureIds:a,filter:l,originalSpritesheet:c}=r;for(const u of a){const h=new js({texture:c.textures[u],x:c.data.frames[u].frame.x,y:c.data.frames[u].frame.y,filters:l});i.addChild(h)}}const o=$l.create({width:Sa.w,height:Sa.h});return t.render({container:i,target:o}),o};let ho,Gr;const JM=async()=>{if(ho!==void 0)return ho;try{const e=await(await fetch(Ww)).arrayBuffer(),r=WM(e),s=new Blob([r],{type:"image/png"}),n=await createImageBitmap(s);Gr=Ae.from(n)}catch{console.warn("did not load textures - hopefully we are running under node"),Gr=Ae.EMPTY}},XU=t=>{if(Gr===void 0)throw new Error("cannot init original spritesheet before texture load");const e=XM(t,{rects:{textureIds:o=>o.startsWith("shadow."),color:YM},clearColour:KM}),r=new GM(e),s=new js(Gr);s.filters=r;const n=$l.create({width:Gr.width,height:Gr.height});t.render({container:s,target:n});const i=new gh(n,pt);i.parseSync(),i.textureSource.scaleMode="nearest",ho=i,s.destroy(),e.destroy(!0)},ZM=()=>{if(ho===void 0)throw new Error(`spritesheet not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`);return ho},JU=()=>{if(Gr===void 0)throw new Error(`spritesheet not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`);return Gr},eI=({className:t,children:e})=>t?p.jsx("div",{className:`contents ${t}`,children:e}):e,tI=t=>t.replaceAll(/(?<!\.)\./g,"_"),j=({children:t,className:e,noSlitWords:r,classnameCycle:s,onClick:n,noTint:i=!1,TagName:o="span",role:a})=>{const l=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(l.length===0)return null;const c=r?[l]:l.split(/\s+/);return p.jsxs(o,{className:e,onClick:n,children:[p.jsx("span",{className:"sr-only",children:l}),c.map((u,h)=>p.jsx("span",{className:ht("text-nowrap inline-block [&>*]:align-top",h===c.length-1?"":"me-threeQuarters sprites-uppercase:me-1"),children:Array.from(u).map((d,f)=>{const m=`hud.char.${Dw(d)}`;return Hh(m)||console.error("no texture for char",d,d.charCodeAt(0),m,"we have:",Object.keys(ZM().textures)),p.jsx("span",{role:a,className:`sprite ${Hh(m)?`texture-${tI(m)}`:"texture-hud_char_?"}
                  ${i?"":"sprite-tinted"}
                  ${s===void 0?"":s[f%s.length]}`},f)})},h))]})},rI=t=>t.props.children!==void 0,rt=({children:t,className:e})=>p.jsx(eI,{className:e,children:Array.isArray(t)?t.map((r,s)=>p.jsx(rt,{children:r},s)):typeof t=="number"?p.jsx(j,{children:String(t)}):typeof t=="string"?p.jsx(j,{children:t}):v.isValidElement(t)?t.type===j||t.type===rt?t:rI(t)?v.cloneElement(t,void 0,typeof t.props.children=="string"?p.jsx(j,{children:`${t.props.children}`}):p.jsx(rt,{children:t.props.children})):t:t});var Xl=NA();const sI=nt(Xl),Kw=({renderAreaSize:t,emulatedResolutionName:e,devicePixelRatio:r,deviceType:s=At(),maximumCanvasUpscale:n})=>{const i=Wn[e],{renderAreaSize:o,rotate90:a}=s!=="desktop"&&t.x<t.y?{renderAreaSize:{x:t.y,y:t.x},rotate90:!0}:{renderAreaSize:t,rotate90:!1},l=vx(o,r),c=Math.max(Math.floor(Math.min(l.x/i.size.x,l.y/i.size.y)),1),u=Math.min(n,c),h=c/u/r,d={x:Math.floor(l.x/c),y:Math.floor(l.y/c)},f={x:Math.ceil(o.x/h),y:Math.ceil(o.y/h)};return{gameEngineUpscale:u,cssUpscale:h,gameEngineScreenSize:d,canvasSize:f,rotate90:a}},nI=t=>At()==="server"?Wn.zxSpectrum.size:t?{x:t.clientWidth,y:t.clientHeight}:{x:window.innerWidth,y:window.innerHeight},Yw=(t,e,r)=>{const s=At();return{renderAreaSize:nI(r),emulatedResolutionName:t,devicePixelRatio:s==="server"?1:window.devicePixelRatio,maximumCanvasUpscale:e.crtFilter?6:8}},iI={upscale:Kw(Yw(Sn.displaySettings.emulatedResolution,Sn.displaySettings))},gl=Sr({name:"upscale",initialState:iI,reducers:{upscaleToWindow(t,{payload:e}){t.upscale=Kw(e)}},selectors:{selectCanvasSize(t){return t.upscale.canvasSize},selectGameEngineUpscale(t){return t.upscale.gameEngineUpscale},selectGameEngineScreenSize(t){return t.upscale.gameEngineScreenSize},selectRot90(t){return t.upscale.rotate90},selectUpscale(t){return t.upscale},selectTotalUpscale({upscale:{cssUpscale:t,gameEngineUpscale:e}}){return t*e}}}),{upscaleToWindow:oI}=gl.actions,{selectCanvasSize:aI,selectRot90:lI,selectUpscale:cI,selectGameEngineUpscale:ZU,selectTotalUpscale:uI,selectGameEngineScreenSize:e$}=gl.selectors,Io=()=>X(uI),yn=({children:t,scaleFactor:e})=>{const r=Io();return p.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??r,"--block":`${(e??r)*8}px`},children:t})},Le=({children:t})=>Xl.createPortal(p.jsx(yn,{children:t}),document.body),hI=({text:t})=>p.jsxs("div",{className:"flex flex-col h-full items-center justify-center gap-y-1",children:[p.jsx("span",{className:"sprite texture-animated-dalek"}),p.jsx(j,{children:t})]}),dI=()=>p.jsx("div",{className:"flex h-full items-center justify-center loading-border zx:zx-loading-border",role:"status","aria-label":"Loading",children:p.jsx("span",{className:"sprite texture-animated-head_walking_right","aria-hidden":!0})});var Ai={},ka={},Ca={},ly;function fI(){if(ly)return Ca;ly=1,Ca.__esModule=!0,Ca.default=n;function t(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?t=function(a){return typeof a}:t=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},t(i)}function e(){}var r={getItem:e,setItem:e,removeItem:e};function s(i){if((typeof self>"u"?"undefined":t(self))!=="object"||!(i in self))return!1;try{var o=self[i],a="redux-persist ".concat(i," test");o.setItem(a,"test"),o.getItem(a),o.removeItem(a)}catch{return!1}return!0}function n(i){var o="".concat(i,"Storage");return s(o)?self[o]:r}return Ca}var cy;function pI(){if(cy)return ka;cy=1,ka.__esModule=!0,ka.default=r;var t=e(fI());function e(s){return s&&s.__esModule?s:{default:s}}function r(s){var n=(0,t.default)(s);return{getItem:function(o){return new Promise(function(a,l){a(n.getItem(o))})},setItem:function(o,a){return new Promise(function(l,c){l(n.setItem(o,a))})},removeItem:function(o){return new Promise(function(a,l){a(n.removeItem(o))})}}}return ka}var uy;function mI(){if(uy)return Ai;uy=1,Ai.__esModule=!0,Ai.default=void 0;var t=e(pI());function e(s){return s&&s.__esModule?s:{default:s}}var r=(0,t.default)("local");return Ai.default=r,Ai}var gI=mI();const yI=nt(gI),Ze=t=>{const e=Uh.userSettings;return console.log("migrating state: persisted is:",t,"I am not migrating - reverting to initial/default state:",e),e},AI=X0({1:Ze,2:Ze,3:Ze,4:Ze,5:Ze,6:Ze,7:Ze,8:Ze,9:Ze,10:Ze,11:Ze,12:Ze,13:Ze,14:Ze,15:Ze,16:Ze,17:Ze}),xI=["userSettings","savedGames"],bI=17,wI={key:"hohol/gameMenus/userSettings",version:bI,migrate:AI,storage:yI,whitelist:xI},VI=$0(wI,Mo.reducer),qI={count:0},yl=Sr({name:"gameAssetsLoading",initialState:qI,reducers:{gameAssetsLoadingStarted(t){t.count++},gameAssetsLoadingFinished(t){t.count=Math.max(0,t.count-1)}},selectors:{selectGameAssetsLoadingCount(t){return t.count}}}),{gameAssetsLoadingStarted:vI,gameAssetsLoadingFinished:hy}=yl.actions,{selectGameAssetsLoadingCount:Qw}=yl.selectors,Al=(t,e,r,s)=>{t(oI(Yw(Ql(e()),e().gameMenus.userSettings.displaySettings,s)))},_I=()=>{At()!=="server"&&Cd({actionCreator:mf,effect(t,{dispatch:e,getState:r}){Al(e,r)}})},SI=()=>{At()!=="server"&&Cd({predicate(t,{gameMenus:{userSettings:{displaySettings:e}}},{gameMenus:{userSettings:{displaySettings:r}}}){return e!==r},effect(t,{dispatch:e,getState:r}){Al(e,r)}})},Gh=C0({[Mo.reducerPath]:VI,[gl.reducerPath]:gl.reducer,[es.reducerPath]:es.reducer,[yl.reducerPath]:yl.reducer}).withLazyLoadedSlices();Gh.inject;const kI=(t,e)=>e.type==="@@_RESET_FOR_TESTS"?Gh(void 0,e):Gh(t,e),ce=Wv({reducer:kI,middleware:t=>t({serializableCheck:{ignoredActions:[Pd,_o,Td,Rd,Md,Id,nM.type]}}).prepend(xx.middleware).concat(es.middleware)});typeof window<"u"&&(window._e2e_store=ce);_I();SI();const CI=Q0(ce),dy=t=>{let e=t.parentElement;for(;e!==null;){const{overflowY:r}=window.getComputedStyle(e);if(r==="scroll"||r==="auto")return e;e=e.parentElement}return null},EI=()=>({directionVector:ee,lookVector:{...ee},...Un(Ex.map(t=>[t,!1]))}),xu={x:1,y:0,z:0},bu={x:-1,y:0,z:0},wu={x:0,y:-1,z:0},Vu={x:0,y:1,z:0},de={away:Vu,left:xu,right:bu,towards:wu,down:{x:0,y:0,z:-1},up:{x:0,y:0,z:1},awayRight:cn(U(Vu,bu)),towardsRight:cn(U(wu,bu)),towardsLeft:cn(U(wu,xu)),awayLeft:cn(U(Vu,xu))},PI={left:{axis:"x",plane:"xy",direction:-1},right:{axis:"x",plane:"xy",direction:1},towards:{axis:"y",plane:"xy",direction:1},away:{axis:"y",plane:"xy",direction:-1},lookLeft:{axis:"xLook",plane:"look",direction:-1},lookRight:{axis:"xLook",plane:"look",direction:1},lookUp:{axis:"yLook",plane:"look",direction:1},lookDown:{axis:"yLook",plane:"look",direction:-1}},Wh=t=>PI[t],TI=Math.cos(13*(Math.PI/180)),xl=-Math.PI/4,RI=t=>{const e=Math.cos(xl),r=Math.sin(xl);return{x:t.x*e-t.y*r,y:t.x*r+t.y*e,z:0}},MI=t=>{const e=Math.cos(xl),r=Math.sin(xl),s=t.x;return t.x=s*e-t.y*r,t.y=s*r+t.y*e,t};cn({x:1,y:2,z:0});cn({x:-1,y:2,z:0});const II=t=>{const e=c_(t);return e===void 0?ee:de[e]},jI=t=>{const e=Od(t);return e===void 0?ee:de[e]},OI=(t,e=TI)=>{const{x:r,y:s}=t,n=Math.sqrt(r*r+s*s);if(n===0)return ee;const i=r/n,o=s/n,a=Math.abs(i),l=Math.abs(o);if(a>l){if(a>=e)return{x:Math.sign(r)*n,y:0,z:0}}else if(l>=e)return{x:0,y:Math.sign(s)*n,z:0};return t},NI={"4-way":II,"8-way":jI,analogue:OI},BI=t=>t.map(e=>e===null?null:{buttons:e.buttons.map(r=>({pressed:r.pressed})),axes:e.axes.map(r=>r)}),zI={lookLeft:de.left,lookRight:de.right,lookUp:de.away,lookDown:de.towards},DI=[{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1},{x:-1,y:0},{x:-1,y:-1}],LI=t=>{const e=Math.round((t+1)*3.5);return DI[e]??kx},FI=.2,UI=45,$I=(t,e)=>!!t.keyboardState.has(e),Xw=(t,e)=>{for(const r of t.gamepads)if(!(r===null||r.buttons.length<=e)&&r.buttons[e].pressed)return!0;return!1},bl=.5,Jw=(t,e,r)=>{for(const s of t.gamepads)if(!(s===null||s.axes.length<=e)){if(r===void 0){if(Math.abs(s.axes[e])>bl)return!0}else if(s.axes[e]*r>bl)return!0}return!1},hs=(t,e,r=!0)=>{const s=ml(ce.getState()),n=s.presses[e];if(t.hudInputState[e])return!0;for(const o of n.keys)if($I(t,o))return!0;for(const o of n.gamepadButtons)if(Xw(t,o))return!0;const i=s.radialAxes?.xy??pn;for(const o of i){const a=Wh(e);if(a!==void 0&&a.plane==="xy")for(const l of t.gamepads){if(l===null||l.axes.length<=o)continue;const c=l.axes[o];if(LI(c)[a.axis]*a.direction>bl)return!0}}if(r){const o=Wh(e);if(o!==void 0){const a=s.axes[o.axis];for(const l of a)if(Jw(t,l,o.direction))return!0}}return!1},fy=t=>{const e=_x(t);return e>1?Wt(t,1/e):t},py=(t,e)=>t?MI(e):e;class HI{constructor(e,r){this.keyboardStateMap=e,this.hudInputState=r}#e=[];#t=ee;#r=ee;#s=new Map;#n=()=>{const e=this.#e.at(0);if(e===void 0||hs(e,"lookShift",!1))return ee;let r,s,n,i;switch("tap"){case(r=this.currentActionPress("left")):return de.left;case(s=this.currentActionPress("right")):return de.right;case(n=this.currentActionPress("away")):return de.away;case(i=this.currentActionPress("towards")):return de.towards}const o=(r!=="released"?1:0)+(s!=="released"?1:0)+(n!=="released"?1:0)+(i!=="released"?1:0);if(o>1)return this.#t;if(o===1)switch("hold"){case r:return de.left;case s:return de.right;case n:return de.away;case i:return de.towards}return ee};*#i(e,r,s){for(const n of r)hs(e,n,!1)&&(yield s[n])}*#o(e,r,s,n,i){const o=ml(ce.getState()).axes,a=o[r],l=o[s];for(const c of e.gamepads){if(c===null)continue;let u=0,h=0;for(const f of a)c.axes.length<=f||(u+=c.axes[f]*n);for(const f of l)c.axes.length<=f||(h+=c.axes[f]*i);const d={x:u,y:h,z:0};Fn(d)>FI&&(yield d)}}#l(e){const r=this.#e.at(0);if(r===void 0||hs(r,"lookShift",!1))return ee;let s=[...this.#i(r,fn,de)],n;if(s.length===1){const[c]=s,u=[...Ge(this.#e).drop(1).map(h=>[...this.#i(h,fn,de)])];e:for(const h of u){if(h.length>2)break e;if(h.length===2&&h.some(d=>jd(d,c))){const d=h.find(f=>il(f,c)<.001);if(d!==void 0){n=d;break e}}}if(!n)for(const h of u)h.length===0&&(s=pn)}const i=e==="screen",o=e==="screen"||e==="mixed",a=py(i,U(...s)),l=py(o,U(...this.#o(r,"x","y",-1,-1)));return U(n??ee,a,l)}#c(){const e=this.#e.at(0);if(e===void 0)return ee;const r=hs(e,"lookShift",!1);return fy(U(...this.#i(e,Cx,zI),...this.#o(e,"xLook","yLook",-1,-1),...r?this.#i(e,fn,de):pn,...r?this.#o(e,"x","y",-1,-1):pn))}#a=({lastTime:e})=>{const r=hf(ce.getState()),s=NI[r];this.#t=fy(s(U(r==="4-way"?this.#n():this.#l(cf(ce.getState())),this.hudInputState.directionVector))),this.#r=this.#c();const n={keyboardState:new Map(this.keyboardStateMap),hudInputState:{...this.hudInputState},gamepads:BI(navigator.getGamepads()),atTime:e};this.#e.unshift(n);const i=e-UI,o=this.#e.findIndex(a=>a.atTime<i);if(o!==-1&&this.#e.splice(o+1),this.#s.size>0){const a=performance.now();for(const[l,c]of this.#s)(!hs(n,l)||a>=c)&&this.#s.delete(l)}};currentActionPress(e,r=!1){const s=this.#e.at(0);if(s===void 0||!r&&this.#s.has(e))return"released";if(hs(s,e)){const i=this.#e.at(1);return(i===void 0?!1:hs(i,e))?"hold":"tap"}return"released"}inputTap(){const e=this.#e.at(0),r=this.#e.at(1);if(e!==void 0){for(const s of this.keyboardStateMap.keys())if(r===void 0||!r.keyboardState.has(s))return{type:"key",input:s};for(const s of e.gamepads)if(s!==null){for(const[n,i]of s.buttons.entries())if(i.pressed&&(r===void 0||!Xw(r,n)))return{type:"gamepadButtons",input:n};for(const[n,i]of s.axes.entries())if(Math.abs(i)>bl&&(r===void 0||!Jw(r,n)))return{type:"gamepadAxes",input:n}}}}inputWasHandled(e,r=1/0){this.#s.set(e,performance.now()+r)}get directionVector(){return this.#t}get lookVector(){return this.#r}startTicking(){gt.shared.add(this.#a,void 0,al.INTERACTION)}stopTicking(){gt.shared.remove(this.#a)}}const GI=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","","","","0","1","2","3","4","5","6","7","8","9","!","@","#","$","%","^","&","*","(",")","-","_","=","+","[","]","{","}",";",":","'",'"',",",".","/","<",">","?","\\","|"," ","Enter","Shift","Control","Alt","Meta","`","~","Tab","Backspace","Delete","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","Numpad+","Numpad-","Numpad*","Numpad/","Numpad.","NumpadEnter","Numpad=","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Escape",""],WI=t=>GI.includes(t);let KI=1;const YI=()=>KI++,QI=3,my=({key:t,location:e,repeat:r})=>{if(r)return;const s=t.length===1?t.toUpperCase():t,n=e===QI&&!s.startsWith("Arrow")?`Numpad${s}`:s;if(WI(n))return n;console.warn("unrecognised key",t)},XI=()=>new Map,JI=t=>{const e=n=>{const i=my(n);i!==void 0&&t.set(i,YI())},r=n=>{const i=my(n);i!==void 0&&t.delete(i)},s=()=>{t.clear()};return window.addEventListener("keydown",e,!1),window.addEventListener("keyup",r,!1),window.addEventListener("blur",s,!1),()=>{window.removeEventListener("keydown",e,!1),window.removeEventListener("keyup",r,!1),window.removeEventListener("blur",s,!1)}},Zw=v.createContext(null),ZI=({children:t})=>{const[e]=v.useState(XI),[r]=v.useState(()=>new HI(e,EI()));return v.useEffect(()=>{const s=JI(e);return r.startTicking(),()=>{s(),r.stopTicking()}},[r,e]),p.jsx(Zw,{value:r,children:t})},yf=()=>{const t=v.useContext(Zw);if(t===null)throw new Error("InputStateProvider required to use useInputState");return t},Se=({handler:t,action:e,disabled:r=!1})=>{const s=v.useMemo(()=>Array.isArray(e)?e:[e],[e]),n=yf();v.useEffect(()=>{if(r)return;const i=()=>{for(const o of s)if(n.currentActionPress(o)==="tap"){if(!t(o))for(const c of s)n.inputWasHandled(c);break}};return gt.shared.add(i),()=>{gt.shared.remove(i)}},[s,r,n,t])},ej=({handler:t,disabled:e=!1})=>{const r=yf();v.useEffect(()=>{if(e)return;const s=()=>{const n=r.inputTap();n!==void 0&&t(n,r)};return gt.shared.add(s),()=>{gt.shared.remove(s)}},[e,t,r])},Cn="data-menuitem_id",Ha="data-menuitem_hidden",Ga="data-menuitem_disabled",tj="grid grid-cols-menuItems gap-x-1 gap-y-oneScaledPix mobile:!gap-y-half mobile:sprites-double-height h-min",eV=()=>{const t=document.body.querySelectorAll(`[${Cn}]`);return Array.from(t)},rj=(t,e)=>{let r=t;for(;r!==null&&r!==e;){const{position:s}=window.getComputedStyle(r);if(s==="sticky")return r;r=r.parentElement}return null},gy=(t,e)=>{const r=t.firstChild,s=r.getBoundingClientRect().top,n=e??document.documentElement;return rj(t,n)!==null?(e?.firstChild?.getBoundingClientRect().top??0)-r.getBoundingClientRect().height:s},Qs=(t,e)=>{const{gameMenus:{openMenus:[{focussedItemId:r}]}}=ce.getState();if(r===void 0)return!0;const s=eV();if(s.length<=1)return!0;const n=s.findIndex(c=>c.getAttribute(Cn)===r);if(n===-1)return!0;let i=n;const o=s[n],a=dy(o);switch(e){case"all":{for(i=t===-1?0:s.length-1;s[i].getAttribute(Ha)==="true"||s[i].getAttribute(Ga)==="true";)if(i+=t,i<0||i>=s.length)return!0;break}case"page":{const c=gy(o,a),u=a?.clientHeight??window.innerHeight,h=c+t*u;let d=n,f=1/0;for(let m=0;m<s.length;m++){if(m===n)continue;const y=s[m];if(y.getAttribute(Ha)==="true"||y.getAttribute(Ga)==="true")continue;const g=gy(y,a),A=Math.abs(g-h);(t===-1&&g<c||t===1&&g>c)&&A<f&&(f=A,d=m)}i=d;break}case"single":{do i=(i+t+s.length)%s.length;while(s[i].getAttribute(Ha)==="true"||s[i].getAttribute(Ga)==="true");break}}if(i===n)return!0;const l=s[i];return a!==dy(l)&&a?.scrollTo({top:0,behavior:"smooth"}),ce.dispatch(gf({focussedItemId:s[i].getAttribute(Cn),scrollableSelection:!0})),!1},sj=t=>{const e=Pw();Se({action:"away",handler:v.useCallback(()=>{if(t.current!==null)return Qs(-1,"single")},[t]),disabled:e}),Se({action:"towards",handler:v.useCallback(()=>{if(t.current!==null)return Qs(1,"single")},[t]),disabled:e}),Se({action:"pageUp",handler:v.useCallback(()=>{if(t.current!==null)return Qs(-1,"page")},[t]),disabled:e}),Se({action:"pageDown",handler:v.useCallback(()=>{if(t.current!==null)return Qs(1,"page")},[t]),disabled:e}),Se({action:"home",handler:v.useCallback(()=>{if(t.current!==null)return Qs(-1,"all")},[t]),disabled:e}),Se({action:"end",handler:v.useCallback(()=>{if(t.current!==null)return Qs(1,"all")},[t]),disabled:e})},Re=({className:t="",children:e,inline:r=!1})=>{const s=v.useRef(null);return v.useEffect(()=>{if(s.current===null||ce.getState().gameMenus.openMenus[0].focussedItemId!==void 0)return;const n=eV(),i=n.at(0);if(i===void 0){const{openMenus:[{menuId:l}]}=ce.getState().gameMenus;throw new Error(`<MenuItems> component mounted with no menu items on the page in store current top menu is "${l}"`)}const o=i.getAttribute(Cn),a=o==="back"&&n.length>1?n[1].getAttribute(Cn):o;ce.dispatch(gf({focussedItemId:a,scrollableSelection:!0}))},[]),sj(s),p.jsx("menu",{ref:s,className:ht(r?"":tj,t),children:e})};function B(t,e){const r=Qd();return v.useCallback(()=>{r(t(e))},[t,r,e])}const nj=["menu_select","swop","jump"],ij=()=>{},tV=({id:t,hidden:e=!1,disabled:r=!1,onSelect:s=ij})=>{const n=v.useRef(!0),i=X(a=>a.gameMenus.openMenus.at(0)?.scrollableSelection??!1),o=X(a=>a.gameMenus.openMenus.at(0)?.focussedItemId===t);return Se({action:nj,handler:s,disabled:!o||e||r}),{menuItemProps:{[Cn]:t,[Ha]:e,[Ga]:r,onMouseMove:B(gf,{focussedItemId:t,scrollableSelection:!1}),onClick:r?void 0:s,tabIndex:0,role:"menuitem"},ref(a){o&&i&&a?.scrollIntoView({behavior:n.current?"instant":"smooth",block:"center"}),n.current=!1},focussed:o}},rV=({className:t})=>{const e=B(xt),{menuItemProps:r,ref:s,focussed:n}=tV({id:"back",onSelect:e});return p.jsxs("div",{...r,className:ht("sprites-double-height flex flex-row gap-1 cursor-pointer "+(n?"selectedMenuItem":""),t),"data-to-parent-menu":!0,ref:s,children:[p.jsx(j,{className:"inline-block scale-x-[-1]",children:""}),p.jsx(j,{className:"inline-block",children:"Back"})]})},Ar=({path:t=pn,className:e})=>{const r=t.at(-1);return p.jsxs("div",{className:ht("flex flex-row sticky top-0 z-slightlyAbove py-oneScaledPix gap-2 pl-2",e),children:[p.jsx(Re,{inline:!0,children:p.jsx(rV,{})}),p.jsxs("div",{className:"flex flex-row items-center",children:[t.slice(0,-1).map((s,n)=>p.jsxs("div",{className:"flex flex-row",children:[p.jsx(j,{className:"text-midGrey zx:text-pureBlack",children:s}),p.jsx(j,{className:"text-midRed zx:text-zxRedDimmed",children:""})]},n)),r&&p.jsx("div",{className:"flex flex-row sprites-double-height text-midRed zx:text-zxBlue",children:p.jsx(j,{TagName:"h1",children:r})})]})]})};var oj=["second","minute","hour","day","week","month","year"];function aj(t,e){if(e===0)return["just now","right now"];var r=oj[Math.floor(e/2)];return t>1&&(r+="s"),[t+" "+r+" ago","in "+t+" "+r]}var lj=["","","","","","",""];function cj(t,e){if(e===0)return["",""];var r=lj[~~(e/2)];return[t+" "+r+"",t+" "+r+""]}var Kh={},sV=function(t,e){Kh[t]=e},uj=function(t){return Kh[t]||Kh.en_US},qu=[60,60,24,7,365/7/12,12];function hj(t){return t instanceof Date?t:!isNaN(t)||/^\d+$/.test(t)?new Date(parseInt(t)):(t=(t||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(t))}function dj(t,e){var r=t<0?1:0;t=Math.abs(t);for(var s=t,n=0;t>=qu[n]&&n<qu.length;n++)t/=qu[n];return t=Math.floor(t),n*=2,t>(n===0?9:1)&&(n+=1),e(t,n,s)[r].replace("%s",t.toString())}function fj(t,e){var r=new Date;return(+r-+hj(t))/1e3}var pj=function(t,e,r){var s=fj(t);return dj(s,uj(e))};sV("en_US",aj);sV("zh_CN",cj);var Ft={},Xs={},Js={},yy;function Jl(){if(yy)return Js;yy=1;var t=Js&&Js.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Js,"__esModule",{value:!0});const r=t(Nn()).default.createContext({refs:{},renderItems:{},register:()=>{},unregister:()=>{}});return Js.default=r,Js}var Ay;function mj(){if(Ay)return Xs;Ay=1;var t=Xs&&Xs.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Xs,"__esModule",{value:!0});const e=t(Nn()),r=t(NA()),s=t(Jl()),n=({id:i,children:o})=>{const{refs:a,renderItems:l}=e.default.useContext(s.default),c=a[i],u=l[i];return c?u?r.default.createPortal(u(o),c,i):r.default.createPortal(o,c,i):null};return Xs.default=n,Xs}var Zs={},xy;function gj(){if(xy)return Zs;xy=1;var t=Zs&&Zs.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Zs,"__esModule",{value:!0});const e=t(Nn()),r=t(Jl()),s=({id:n,renderItem:i=a=>a,className:o})=>{const{register:a,unregister:l}=e.default.useContext(r.default),c=e.default.useRef(null);return e.default.useEffect(()=>(c.current&&a(n,c.current,i),()=>l(n)),[n,c.current]),e.default.createElement("div",{className:[`portal-placeholder-${n}`,o].filter(u=>!!u).join(" "),ref:c})};return Zs.default=s,Zs}var Dr={},by;function yj(){if(by)return Dr;by=1;var t=Dr&&Dr.__rest||function(i,o){var a={};for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&o.indexOf(l)<0&&(a[l]=i[l]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,l=Object.getOwnPropertySymbols(i);c<l.length;c++)o.indexOf(l[c])<0&&Object.prototype.propertyIsEnumerable.call(i,l[c])&&(a[l[c]]=i[l[c]]);return a},e=Dr&&Dr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Dr,"__esModule",{value:!0});const r=e(Nn()),s=e(Jl()),n=({children:i})=>{const[o,a]=r.default.useState({}),[l,c]=r.default.useState({}),u=r.default.useCallback((f,m,y)=>{a(g=>Object.assign(Object.assign({},g),{[f]:m})),c(g=>Object.assign(Object.assign({},g),{[f]:y}))},[]),h=r.default.useCallback(f=>{a(m=>{const y=m,g=f;return y[g],t(y,[typeof g=="symbol"?g:g+""])}),c(m=>{const y=m,g=f;return y[g],t(y,[typeof g=="symbol"?g:g+""])})},[]),d=r.default.useMemo(()=>({refs:o,renderItems:l,register:u,unregister:h}),[o,l,u,h]);return r.default.createElement(s.default.Provider,{value:d},i)};return Dr.default=n,Dr}var wy;function Aj(){if(wy)return Ft;wy=1;var t=Ft&&Ft.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.Context=Ft.Placeholder=Ft.Provider=void 0;const e=t(mj()),r=t(gj()),s=t(yj()),n=t(Jl());Ft.Provider=s.default,Ft.Placeholder=r.default,Ft.Context=n.default;const i=e.default;return i.Context=n.default,i.Placeholder=r.default,i.Provider=s.default,Ft.default=i,Ft}var xj=Aj();const Zl=nt(xj),bj=({flip:t=!1,focussed:e=!1,verticalAlignItemsCentre:r=!1})=>p.jsx(j,{className:"inline-block col-start-1 w-min ml-auto "+(t?"scale-x-[-1] relative bottom-oneScaledPix":"")+(r===!0?"flex items-center h-3":""),children:e?"":""}),le="leading-none [--line-gap:1px] [&_[class*='texture-hud']]:mb-[calc(var(--scale)*var(--line-gap))]",wj=["menu_select","swop","jump"],Vj=()=>{},F=({id:t,label:e,valueElement:r,flipLeader:s=!1,doubleHeight:n=!1,doubleHeightWhenFocussed:i,onSelect:o=Vj,hidden:a=!1,disabled:l=!1,hintInline:c=!1,className:u,hint:h,leader:d,verticalAlignItemsCentre:f=!1,opensSubMenu:m=!1,toParentMenu:y=!1})=>{const{menuItemProps:g,ref:A,focussed:b}=tV({id:t,hidden:a,disabled:l,onSelect:o});Se({action:wj,handler:o,disabled:!b||a||l});const x=p.jsxs("li",{...g,"data-opens-submenu":m,"data-to-parent-menu":y,className:ht("contents cursor-pointer",a?"hidden":"",n||i&&b?"sprites-double-height":"",b?"selectedMenuItem":"",u),children:[d||p.jsx(bj,{verticalAlignItemsCentre:f,flip:s,focussed:b}),p.jsx("div",{ref:A,className:ht(r===void 0?"col-span-2":"",f===!0?"flex items-center":""),children:typeof e=="string"?p.jsx(p.Fragment,{children:p.jsx(j,{children:e})}):e}),r&&p.jsx("div",{className:`flex ${f===!0?"items-center":""}`,children:r}),!b||h===void 0||c?null:p.jsx(Zl,{children:typeof h=="string"?p.jsx(j,{className:le,children:h}):h})]});return c&&h?p.jsxs(p.Fragment,{children:[x,p.jsx("div",{className:"col-span-2 col-start-2 mb-1",children:h})]}):x},Wa="text-lightGrey zx:text-zxWhite sprites-normal-height",qj=({userId:t,campaignName:e,label:r,version:s,createdAt:n})=>p.jsx(F,{className:"sprites-double-height",id:`campaign-${t}-${e}`,label:r,doubleHeightWhenFocussed:!0,onSelect:B(uo,{campaignLocator:{userId:t,campaignName:e,version:-1}}),hintInline:!0,hint:p.jsx("div",{"data-screenshot-mask":!0,children:p.jsx(j,{className:Wa,children:`v.${s} updated ${pj(n)}`})})}),vj=({campaigns:t})=>p.jsx(p.Fragment,{children:p.jsx("div",{className:"zx:text-zxCyan  resHandheld:mt-half flex flex-col gap-2",children:Object.values(t).flatMap(e=>p.jsxs("div",{className:"flex flex-col gap-half",children:[p.jsxs(j,{className:"text-metallicBlue zx:text-zxYellow pl-4 sprites-double-height",children:["By ",e.user.username,":"]}),Object.values(e.campaigns).map(r=>p.jsx(p.Fragment,{children:p.jsx(Re,{children:p.jsx(qj,{userId:e.user.id,campaignName:r.name,label:`'${r.name}'`,version:r.version,createdAt:r.created_at})})},r.name))]},e.user.id))})}),_j=t=>{const{data:e,error:r,isLoading:s,refetch:n}=Cw({publishedOnly:!0});return v.useEffect(()=>{n()},[n]),p.jsx(Le,{children:p.jsxs(ke,{fullScreen:!0,className:"bg-metallicBlueHalfbrite text-highlightBeige zx:text-zxCyan selectedMenuItem:text-white zx:bg-zxRed gap-y-2 resHandheld:gap-y-1",dialogId:"communityGames",children:[p.jsx(Ar,{path:["Play","Community"],className:"mobile:px-4"}),p.jsxs("div",{className:"flex flex-col gap-1 p-1 overflow-y-scroll scrollbar scrollbar-w-1 scrollbar-thumb-lightGrey scrollbar-track-metallicBlueHalfbrite zx:scrollbar-thumb-zxBlue zx:scrollbar-track-zxWhite mobile:px-3 [--leader-col-width:theme(width.3)] ",children:[r!==void 0?p.jsx(hI,{text:"Failed to load campaigns"}):null,s?p.jsx(dI,{}):null,e!==void 0?p.jsx(vj,{campaigns:e}):null]})]})})},W={x:16,y:16,z:12},nV=To/1e3,t$={head:15e-5,heels:15e-5},r$=1e3/110,s$=330,Sj=2e-4,kj={head:W.z*2/1e3,others:W.z*6/1e3},n$=Sj*.13,i$=kj.others*.85,o$=.8,a$=.001,iV={head:1,heels:2,charles:1,dalek:Math.SQRT2,bubbleRobot:(Math.SQRT2+1)/2,cyberman:1,skiHead:1,helicopterBug:1,homingBot:2,monkey:1,elephant:1,elephantHead:0,emperor:1,emperorsGuardian:Math.SQRT2,computerBot:1,turtle:1,ball:2.625,firedDoughnut:2,movingPlatform:1,floatingText:1},l$=Bd(iV,([t,e])=>[t,e*nV]),Cj=Bd(iV,([t,e])=>[t,(e*.8+.4)*nV]),c$=1.5,Ej=(t=1)=>t*To/1e3,u$=Ej(),h$=2,Vy=1.1,d$={head:W.z*2.6+Vy,heels:W.z+1+Vy},Pj=10,f$=6e4,Tj=8,p$=750,m$=1500,g$=200,y$=.25,A$=150,Rj=8,Mj=It.h-It.w/2,oV=Mj+2,Af=9999,x$=1e3/12,Ij=1e3/12,b$=100,w$=150,jj=["head","heels"],Oj=[...jj,"headOverHeels"],An=t=>t==="head"?"heels":"head";W.z;W.x/2;const aV="@@original",Nj="original",lV={userId:aV,campaignName:Nj,version:-1},Bj=t=>{const{queries:e}=t[es.reducerPath],{mutations:r}=t[es.reducerPath],s=Object.values(e??{}).some(o=>o?.status==="pending"),n=Object.values(r??{}).some(o=>o?.status==="pending"),i=Qw(t)>0;return s||n||i},zj=es.endpoints.getCampaign.select,Dj=t=>{if(Qw(t)>0)return!0;const{campaignLocator:r}=t.gameMenus.gameInPlay;return r!==void 0&&r!==lV&&zj(r)(t).status==="pending"},Lj=Xd(Bj),Fj=Xd(Dj),bt=({className:t,onClick:e})=>Lj()?p.jsx(vq,{}):p.jsx("div",{className:`fixed inset-0 z-border ${t??""}`,onClick:e});function cV(t){var e,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(r=cV(t[e]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function xf(){for(var t,e,r=0,s="",n=arguments.length;r<n;r++)(t=arguments[r])&&(e=cV(t))&&(s&&(s+=" "),s+=e);return s}function bf(...t){return ht(xf(t))}const Uj=t=>t.replace(/ArrowLeft/g,"").replace(/ArrowRight/g,"").replace(/ArrowUp/g,"").replace(/ArrowDown/g,""),qy=t=>{const e=t.map(Uj);return e.length===1?`

key: **${e[0]}**`:`

keys: ${e.map(r=>`**${r}**`).join(" or ")}`},wf=(t,e)=>e?t?`${t}${qy(e)}`:qy(e):t;function Cr(t,e,{checkForDefaultPrevented:r=!0}={}){return function(n){if(t?.(n),r===!1||!n.defaultPrevented)return e?.(n)}}function vy(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function uV(...t){return e=>{let r=!1;const s=t.map(n=>{const i=vy(n,e);return!r&&typeof i=="function"&&(r=!0),i});if(r)return()=>{for(let n=0;n<s.length;n++){const i=s[n];typeof i=="function"?i():vy(t[n],null)}}}}function Ds(...t){return v.useCallback(uV(...t),t)}function hV(t,e=[]){let r=[];function s(i,o){const a=v.createContext(o),l=r.length;r=[...r,o];const c=h=>{const{scope:d,children:f,...m}=h,y=d?.[t]?.[l]||a,g=v.useMemo(()=>m,Object.values(m));return p.jsx(y.Provider,{value:g,children:f})};c.displayName=i+"Provider";function u(h,d){const f=d?.[t]?.[l]||a,m=v.useContext(f);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${i}\``)}return[c,u]}const n=()=>{const i=r.map(o=>v.createContext(o));return function(a){const l=a?.[t]||i;return v.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return n.scopeName=t,[s,$j(n,...e)]}function $j(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const s=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(i){const o=s.reduce((a,{useScope:l,scopeName:c})=>{const h=l(i)[`__scope${c}`];return{...a,...h}},{});return v.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return r.scopeName=e.scopeName,r}function Hj(t){const e=Gj(t),r=v.forwardRef((s,n)=>{const{children:i,...o}=s,a=v.Children.toArray(i),l=a.find(Kj);if(l){const c=l.props.children,u=a.map(h=>h===l?v.Children.count(c)>1?v.Children.only(null):v.isValidElement(c)?c.props.children:null:h);return p.jsx(e,{...o,ref:n,children:v.isValidElement(c)?v.cloneElement(c,void 0,u):null})}return p.jsx(e,{...o,ref:n,children:i})});return r.displayName=`${t}.Slot`,r}function Gj(t){const e=v.forwardRef((r,s)=>{const{children:n,...i}=r;if(v.isValidElement(n)){const o=Qj(n),a=Yj(i,n.props);return n.type!==v.Fragment&&(a.ref=s?uV(s,o):o),v.cloneElement(n,a)}return v.Children.count(n)>1?v.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var dV=Symbol("radix.slottable");function Wj(t){const e=({children:r})=>p.jsx(p.Fragment,{children:r});return e.displayName=`${t}.Slottable`,e.__radixId=dV,e}function Kj(t){return v.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===dV}function Yj(t,e){const r={...e};for(const s in e){const n=t[s],i=e[s];/^on[A-Z]/.test(s)?n&&i?r[s]=(...a)=>{const l=i(...a);return n(...a),l}:n&&(r[s]=n):s==="style"?r[s]={...n,...i}:s==="className"&&(r[s]=[n,i].filter(Boolean).join(" "))}return{...t,...r}}function Qj(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var Xj=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],os=Xj.reduce((t,e)=>{const r=Hj(`Primitive.${e}`),s=v.forwardRef((n,i)=>{const{asChild:o,...a}=n,l=o?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),p.jsx(l,{...a,ref:i})});return s.displayName=`Primitive.${e}`,{...t,[e]:s}},{});function Jj(t,e){t&&Xl.flushSync(()=>t.dispatchEvent(e))}function ec(t){const e=v.useRef(t);return v.useEffect(()=>{e.current=t}),v.useMemo(()=>(...r)=>e.current?.(...r),[])}function Zj(t,e=globalThis?.document){const r=ec(t);v.useEffect(()=>{const s=n=>{n.key==="Escape"&&r(n)};return e.addEventListener("keydown",s,{capture:!0}),()=>e.removeEventListener("keydown",s,{capture:!0})},[r,e])}var eO="DismissableLayer",Yh="dismissableLayer.update",tO="dismissableLayer.pointerDownOutside",rO="dismissableLayer.focusOutside",_y,fV=v.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),pV=v.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:s,onPointerDownOutside:n,onFocusOutside:i,onInteractOutside:o,onDismiss:a,...l}=t,c=v.useContext(fV),[u,h]=v.useState(null),d=u?.ownerDocument??globalThis?.document,[,f]=v.useState({}),m=Ds(e,V=>h(V)),y=Array.from(c.layers),[g]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),A=y.indexOf(g),b=u?y.indexOf(u):-1,x=c.layersWithOutsidePointerEventsDisabled.size>0,w=b>=A,q=iO(V=>{const S=V.target,k=[...c.branches].some(C=>C.contains(S));!w||k||(n?.(V),o?.(V),V.defaultPrevented||a?.())},d),_=oO(V=>{const S=V.target;[...c.branches].some(C=>C.contains(S))||(i?.(V),o?.(V),V.defaultPrevented||a?.())},d);return Zj(V=>{b===c.layers.size-1&&(s?.(V),!V.defaultPrevented&&a&&(V.preventDefault(),a()))},d),v.useEffect(()=>{if(u)return r&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(_y=d.body.style.pointerEvents,d.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),Sy(),()=>{r&&c.layersWithOutsidePointerEventsDisabled.size===1&&(d.body.style.pointerEvents=_y)}},[u,d,r,c]),v.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),Sy())},[u,c]),v.useEffect(()=>{const V=()=>f({});return document.addEventListener(Yh,V),()=>document.removeEventListener(Yh,V)},[]),p.jsx(os.div,{...l,ref:m,style:{pointerEvents:x?w?"auto":"none":void 0,...t.style},onFocusCapture:Cr(t.onFocusCapture,_.onFocusCapture),onBlurCapture:Cr(t.onBlurCapture,_.onBlurCapture),onPointerDownCapture:Cr(t.onPointerDownCapture,q.onPointerDownCapture)})});pV.displayName=eO;var sO="DismissableLayerBranch",nO=v.forwardRef((t,e)=>{const r=v.useContext(fV),s=v.useRef(null),n=Ds(e,s);return v.useEffect(()=>{const i=s.current;if(i)return r.branches.add(i),()=>{r.branches.delete(i)}},[r.branches]),p.jsx(os.div,{...t,ref:n})});nO.displayName=sO;function iO(t,e=globalThis?.document){const r=ec(t),s=v.useRef(!1),n=v.useRef(()=>{});return v.useEffect(()=>{const i=a=>{if(a.target&&!s.current){let l=function(){mV(tO,r,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",n.current),n.current=l,e.addEventListener("click",n.current,{once:!0})):l()}else e.removeEventListener("click",n.current);s.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",i),e.removeEventListener("click",n.current)}},[e,r]),{onPointerDownCapture:()=>s.current=!0}}function oO(t,e=globalThis?.document){const r=ec(t),s=v.useRef(!1);return v.useEffect(()=>{const n=i=>{i.target&&!s.current&&mV(rO,r,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",n),()=>e.removeEventListener("focusin",n)},[e,r]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function Sy(){const t=new CustomEvent(Yh);document.dispatchEvent(t)}function mV(t,e,r,{discrete:s}){const n=r.originalEvent.target,i=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&n.addEventListener(t,e,{once:!0}),s?Jj(n,i):n.dispatchEvent(i)}var ts=globalThis?.document?v.useLayoutEffect:()=>{},aO=hd[" useId ".trim().toString()]||(()=>{}),lO=0;function cO(t){const[e,r]=v.useState(aO());return ts(()=>{r(s=>s??String(lO++))},[t]),e?`radix-${e}`:""}const uO=["top","right","bottom","left"],rs=Math.min,jt=Math.max,wl=Math.round,Ea=Math.floor,pr=t=>({x:t,y:t}),hO={left:"right",right:"left",bottom:"top",top:"bottom"},dO={start:"end",end:"start"};function Qh(t,e,r){return jt(t,rs(e,r))}function Ir(t,e){return typeof t=="function"?t(e):t}function jr(t){return t.split("-")[0]}function Yn(t){return t.split("-")[1]}function Vf(t){return t==="x"?"y":"x"}function qf(t){return t==="y"?"height":"width"}function ss(t){return["top","bottom"].includes(jr(t))?"y":"x"}function vf(t){return Vf(ss(t))}function fO(t,e,r){r===void 0&&(r=!1);const s=Yn(t),n=vf(t),i=qf(n);let o=n==="x"?s===(r?"end":"start")?"right":"left":s==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(o=Vl(o)),[o,Vl(o)]}function pO(t){const e=Vl(t);return[Xh(t),e,Xh(e)]}function Xh(t){return t.replace(/start|end/g,e=>dO[e])}function mO(t,e,r){const s=["left","right"],n=["right","left"],i=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return r?e?n:s:e?s:n;case"left":case"right":return e?i:o;default:return[]}}function gO(t,e,r,s){const n=Yn(t);let i=mO(jr(t),r==="start",s);return n&&(i=i.map(o=>o+"-"+n),e&&(i=i.concat(i.map(Xh)))),i}function Vl(t){return t.replace(/left|right|bottom|top/g,e=>hO[e])}function yO(t){return{top:0,right:0,bottom:0,left:0,...t}}function gV(t){return typeof t!="number"?yO(t):{top:t,right:t,bottom:t,left:t}}function ql(t){const{x:e,y:r,width:s,height:n}=t;return{width:s,height:n,top:r,left:e,right:e+s,bottom:r+n,x:e,y:r}}function ky(t,e,r){let{reference:s,floating:n}=t;const i=ss(e),o=vf(e),a=qf(o),l=jr(e),c=i==="y",u=s.x+s.width/2-n.width/2,h=s.y+s.height/2-n.height/2,d=s[a]/2-n[a]/2;let f;switch(l){case"top":f={x:u,y:s.y-n.height};break;case"bottom":f={x:u,y:s.y+s.height};break;case"right":f={x:s.x+s.width,y:h};break;case"left":f={x:s.x-n.width,y:h};break;default:f={x:s.x,y:s.y}}switch(Yn(e)){case"start":f[o]-=d*(r&&c?-1:1);break;case"end":f[o]+=d*(r&&c?-1:1);break}return f}const AO=async(t,e,r)=>{const{placement:s="bottom",strategy:n="absolute",middleware:i=[],platform:o}=r,a=i.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:n}),{x:u,y:h}=ky(c,s,l),d=s,f={},m=0;for(let y=0;y<a.length;y++){const{name:g,fn:A}=a[y],{x:b,y:x,data:w,reset:q}=await A({x:u,y:h,initialPlacement:s,placement:d,strategy:n,middlewareData:f,rects:c,platform:o,elements:{reference:t,floating:e}});u=b??u,h=x??h,f={...f,[g]:{...f[g],...w}},q&&m<=50&&(m++,typeof q=="object"&&(q.placement&&(d=q.placement),q.rects&&(c=q.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:n}):q.rects),{x:u,y:h}=ky(c,d,l)),y=-1)}return{x:u,y:h,placement:d,strategy:n,middlewareData:f}};async function fo(t,e){var r;e===void 0&&(e={});const{x:s,y:n,platform:i,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:d=!1,padding:f=0}=Ir(e,t),m=gV(f),g=a[d?h==="floating"?"reference":"floating":h],A=ql(await i.getClippingRect({element:(r=await(i.isElement==null?void 0:i.isElement(g)))==null||r?g:g.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),b=h==="floating"?{x:s,y:n,width:o.floating.width,height:o.floating.height}:o.reference,x=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),w=await(i.isElement==null?void 0:i.isElement(x))?await(i.getScale==null?void 0:i.getScale(x))||{x:1,y:1}:{x:1,y:1},q=ql(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:b,offsetParent:x,strategy:l}):b);return{top:(A.top-q.top+m.top)/w.y,bottom:(q.bottom-A.bottom+m.bottom)/w.y,left:(A.left-q.left+m.left)/w.x,right:(q.right-A.right+m.right)/w.x}}const xO=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:s,placement:n,rects:i,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Ir(t,e)||{};if(c==null)return{};const h=gV(u),d={x:r,y:s},f=vf(n),m=qf(f),y=await o.getDimensions(c),g=f==="y",A=g?"top":"left",b=g?"bottom":"right",x=g?"clientHeight":"clientWidth",w=i.reference[m]+i.reference[f]-d[f]-i.floating[m],q=d[f]-i.reference[f],_=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let V=_?_[x]:0;(!V||!await(o.isElement==null?void 0:o.isElement(_)))&&(V=a.floating[x]||i.floating[m]);const S=w/2-q/2,k=V/2-y[m]/2-1,C=rs(h[A],k),E=rs(h[b],k),T=C,R=V-y[m]-E,I=V/2-y[m]/2+S,z=Qh(T,I,R),P=!l.arrow&&Yn(n)!=null&&I!==z&&i.reference[m]/2-(I<T?C:E)-y[m]/2<0,M=P?I<T?I-T:I-R:0;return{[f]:d[f]+M,data:{[f]:z,centerOffset:I-z-M,...P&&{alignmentOffset:M}},reset:P}}}),bO=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,s;const{placement:n,middlewareData:i,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:d,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:y=!0,...g}=Ir(t,e);if((r=i.arrow)!=null&&r.alignmentOffset)return{};const A=jr(n),b=ss(a),x=jr(a)===a,w=await(l.isRTL==null?void 0:l.isRTL(c.floating)),q=d||(x||!y?[Vl(a)]:pO(a)),_=m!=="none";!d&&_&&q.push(...gO(a,y,m,w));const V=[a,...q],S=await fo(e,g),k=[];let C=((s=i.flip)==null?void 0:s.overflows)||[];if(u&&k.push(S[A]),h){const I=fO(n,o,w);k.push(S[I[0]],S[I[1]])}if(C=[...C,{placement:n,overflows:k}],!k.every(I=>I<=0)){var E,T;const I=(((E=i.flip)==null?void 0:E.index)||0)+1,z=V[I];if(z)return{data:{index:I,overflows:C},reset:{placement:z}};let P=(T=C.filter(M=>M.overflows[0]<=0).sort((M,D)=>M.overflows[1]-D.overflows[1])[0])==null?void 0:T.placement;if(!P)switch(f){case"bestFit":{var R;const M=(R=C.filter(D=>{if(_){const L=ss(D.placement);return L===b||L==="y"}return!0}).map(D=>[D.placement,D.overflows.filter(L=>L>0).reduce((L,Q)=>L+Q,0)]).sort((D,L)=>D[1]-L[1])[0])==null?void 0:R[0];M&&(P=M);break}case"initialPlacement":P=a;break}if(n!==P)return{reset:{placement:P}}}return{}}}};function Cy(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Ey(t){return uO.some(e=>t[e]>=0)}const wO=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:s="referenceHidden",...n}=Ir(t,e);switch(s){case"referenceHidden":{const i=await fo(e,{...n,elementContext:"reference"}),o=Cy(i,r.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:Ey(o)}}}case"escaped":{const i=await fo(e,{...n,altBoundary:!0}),o=Cy(i,r.floating);return{data:{escapedOffsets:o,escaped:Ey(o)}}}default:return{}}}}};async function VO(t,e){const{placement:r,platform:s,elements:n}=t,i=await(s.isRTL==null?void 0:s.isRTL(n.floating)),o=jr(r),a=Yn(r),l=ss(r)==="y",c=["left","top"].includes(o)?-1:1,u=i&&l?-1:1,h=Ir(e,t);let{mainAxis:d,crossAxis:f,alignmentAxis:m}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return a&&typeof m=="number"&&(f=a==="end"?m*-1:m),l?{x:f*u,y:d*c}:{x:d*c,y:f*u}}const qO=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,s;const{x:n,y:i,placement:o,middlewareData:a}=e,l=await VO(e,t);return o===((r=a.offset)==null?void 0:r.placement)&&(s=a.arrow)!=null&&s.alignmentOffset?{}:{x:n+l.x,y:i+l.y,data:{...l,placement:o}}}}},vO=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:s,placement:n}=e,{mainAxis:i=!0,crossAxis:o=!1,limiter:a={fn:g=>{let{x:A,y:b}=g;return{x:A,y:b}}},...l}=Ir(t,e),c={x:r,y:s},u=await fo(e,l),h=ss(jr(n)),d=Vf(h);let f=c[d],m=c[h];if(i){const g=d==="y"?"top":"left",A=d==="y"?"bottom":"right",b=f+u[g],x=f-u[A];f=Qh(b,f,x)}if(o){const g=h==="y"?"top":"left",A=h==="y"?"bottom":"right",b=m+u[g],x=m-u[A];m=Qh(b,m,x)}const y=a.fn({...e,[d]:f,[h]:m});return{...y,data:{x:y.x-r,y:y.y-s,enabled:{[d]:i,[h]:o}}}}}},_O=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:s,placement:n,rects:i,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Ir(t,e),u={x:r,y:s},h=ss(n),d=Vf(h);let f=u[d],m=u[h];const y=Ir(a,e),g=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(l){const x=d==="y"?"height":"width",w=i.reference[d]-i.floating[x]+g.mainAxis,q=i.reference[d]+i.reference[x]-g.mainAxis;f<w?f=w:f>q&&(f=q)}if(c){var A,b;const x=d==="y"?"width":"height",w=["top","left"].includes(jr(n)),q=i.reference[h]-i.floating[x]+(w&&((A=o.offset)==null?void 0:A[h])||0)+(w?0:g.crossAxis),_=i.reference[h]+i.reference[x]+(w?0:((b=o.offset)==null?void 0:b[h])||0)-(w?g.crossAxis:0);m<q?m=q:m>_&&(m=_)}return{[d]:f,[h]:m}}}},SO=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var r,s;const{placement:n,rects:i,platform:o,elements:a}=e,{apply:l=()=>{},...c}=Ir(t,e),u=await fo(e,c),h=jr(n),d=Yn(n),f=ss(n)==="y",{width:m,height:y}=i.floating;let g,A;h==="top"||h==="bottom"?(g=h,A=d===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(A=h,g=d==="end"?"top":"bottom");const b=y-u.top-u.bottom,x=m-u.left-u.right,w=rs(y-u[g],b),q=rs(m-u[A],x),_=!e.middlewareData.shift;let V=w,S=q;if((r=e.middlewareData.shift)!=null&&r.enabled.x&&(S=x),(s=e.middlewareData.shift)!=null&&s.enabled.y&&(V=b),_&&!d){const C=jt(u.left,0),E=jt(u.right,0),T=jt(u.top,0),R=jt(u.bottom,0);f?S=m-2*(C!==0||E!==0?C+E:jt(u.left,u.right)):V=y-2*(T!==0||R!==0?T+R:jt(u.top,u.bottom))}await l({...e,availableWidth:S,availableHeight:V});const k=await o.getDimensions(a.floating);return m!==k.width||y!==k.height?{reset:{rects:!0}}:{}}}};function tc(){return typeof window<"u"}function Qn(t){return yV(t)?(t.nodeName||"").toLowerCase():"#document"}function Bt(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function xr(t){var e;return(e=(yV(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function yV(t){return tc()?t instanceof Node||t instanceof Bt(t).Node:!1}function ir(t){return tc()?t instanceof Element||t instanceof Bt(t).Element:!1}function yr(t){return tc()?t instanceof HTMLElement||t instanceof Bt(t).HTMLElement:!1}function Py(t){return!tc()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Bt(t).ShadowRoot}function jo(t){const{overflow:e,overflowX:r,overflowY:s,display:n}=or(t);return/auto|scroll|overlay|hidden|clip/.test(e+s+r)&&!["inline","contents"].includes(n)}function kO(t){return["table","td","th"].includes(Qn(t))}function rc(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function _f(t){const e=Sf(),r=ir(t)?or(t):t;return["transform","translate","scale","rotate","perspective"].some(s=>r[s]?r[s]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(s=>(r.willChange||"").includes(s))||["paint","layout","strict","content"].some(s=>(r.contain||"").includes(s))}function CO(t){let e=ns(t);for(;yr(e)&&!En(e);){if(_f(e))return e;if(rc(e))return null;e=ns(e)}return null}function Sf(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function En(t){return["html","body","#document"].includes(Qn(t))}function or(t){return Bt(t).getComputedStyle(t)}function sc(t){return ir(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function ns(t){if(Qn(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Py(t)&&t.host||xr(t);return Py(e)?e.host:e}function AV(t){const e=ns(t);return En(e)?t.ownerDocument?t.ownerDocument.body:t.body:yr(e)&&jo(e)?e:AV(e)}function po(t,e,r){var s;e===void 0&&(e=[]),r===void 0&&(r=!0);const n=AV(t),i=n===((s=t.ownerDocument)==null?void 0:s.body),o=Bt(n);if(i){const a=Jh(o);return e.concat(o,o.visualViewport||[],jo(n)?n:[],a&&r?po(a):[])}return e.concat(n,po(n,[],r))}function Jh(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function xV(t){const e=or(t);let r=parseFloat(e.width)||0,s=parseFloat(e.height)||0;const n=yr(t),i=n?t.offsetWidth:r,o=n?t.offsetHeight:s,a=wl(r)!==i||wl(s)!==o;return a&&(r=i,s=o),{width:r,height:s,$:a}}function kf(t){return ir(t)?t:t.contextElement}function xn(t){const e=kf(t);if(!yr(e))return pr(1);const r=e.getBoundingClientRect(),{width:s,height:n,$:i}=xV(e);let o=(i?wl(r.width):r.width)/s,a=(i?wl(r.height):r.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const EO=pr(0);function bV(t){const e=Bt(t);return!Sf()||!e.visualViewport?EO:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function PO(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==Bt(t)?!1:e}function Ns(t,e,r,s){e===void 0&&(e=!1),r===void 0&&(r=!1);const n=t.getBoundingClientRect(),i=kf(t);let o=pr(1);e&&(s?ir(s)&&(o=xn(s)):o=xn(t));const a=PO(i,r,s)?bV(i):pr(0);let l=(n.left+a.x)/o.x,c=(n.top+a.y)/o.y,u=n.width/o.x,h=n.height/o.y;if(i){const d=Bt(i),f=s&&ir(s)?Bt(s):s;let m=d,y=Jh(m);for(;y&&s&&f!==m;){const g=xn(y),A=y.getBoundingClientRect(),b=or(y),x=A.left+(y.clientLeft+parseFloat(b.paddingLeft))*g.x,w=A.top+(y.clientTop+parseFloat(b.paddingTop))*g.y;l*=g.x,c*=g.y,u*=g.x,h*=g.y,l+=x,c+=w,m=Bt(y),y=Jh(m)}}return ql({width:u,height:h,x:l,y:c})}function Cf(t,e){const r=sc(t).scrollLeft;return e?e.left+r:Ns(xr(t)).left+r}function wV(t,e,r){r===void 0&&(r=!1);const s=t.getBoundingClientRect(),n=s.left+e.scrollLeft-(r?0:Cf(t,s)),i=s.top+e.scrollTop;return{x:n,y:i}}function TO(t){let{elements:e,rect:r,offsetParent:s,strategy:n}=t;const i=n==="fixed",o=xr(s),a=e?rc(e.floating):!1;if(s===o||a&&i)return r;let l={scrollLeft:0,scrollTop:0},c=pr(1);const u=pr(0),h=yr(s);if((h||!h&&!i)&&((Qn(s)!=="body"||jo(o))&&(l=sc(s)),yr(s))){const f=Ns(s);c=xn(s),u.x=f.x+s.clientLeft,u.y=f.y+s.clientTop}const d=o&&!h&&!i?wV(o,l,!0):pr(0);return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x+d.x,y:r.y*c.y-l.scrollTop*c.y+u.y+d.y}}function RO(t){return Array.from(t.getClientRects())}function MO(t){const e=xr(t),r=sc(t),s=t.ownerDocument.body,n=jt(e.scrollWidth,e.clientWidth,s.scrollWidth,s.clientWidth),i=jt(e.scrollHeight,e.clientHeight,s.scrollHeight,s.clientHeight);let o=-r.scrollLeft+Cf(t);const a=-r.scrollTop;return or(s).direction==="rtl"&&(o+=jt(e.clientWidth,s.clientWidth)-n),{width:n,height:i,x:o,y:a}}function IO(t,e){const r=Bt(t),s=xr(t),n=r.visualViewport;let i=s.clientWidth,o=s.clientHeight,a=0,l=0;if(n){i=n.width,o=n.height;const c=Sf();(!c||c&&e==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}return{width:i,height:o,x:a,y:l}}function jO(t,e){const r=Ns(t,!0,e==="fixed"),s=r.top+t.clientTop,n=r.left+t.clientLeft,i=yr(t)?xn(t):pr(1),o=t.clientWidth*i.x,a=t.clientHeight*i.y,l=n*i.x,c=s*i.y;return{width:o,height:a,x:l,y:c}}function Ty(t,e,r){let s;if(e==="viewport")s=IO(t,r);else if(e==="document")s=MO(xr(t));else if(ir(e))s=jO(e,r);else{const n=bV(t);s={x:e.x-n.x,y:e.y-n.y,width:e.width,height:e.height}}return ql(s)}function VV(t,e){const r=ns(t);return r===e||!ir(r)||En(r)?!1:or(r).position==="fixed"||VV(r,e)}function OO(t,e){const r=e.get(t);if(r)return r;let s=po(t,[],!1).filter(a=>ir(a)&&Qn(a)!=="body"),n=null;const i=or(t).position==="fixed";let o=i?ns(t):t;for(;ir(o)&&!En(o);){const a=or(o),l=_f(o);!l&&a.position==="fixed"&&(n=null),(i?!l&&!n:!l&&a.position==="static"&&!!n&&["absolute","fixed"].includes(n.position)||jo(o)&&!l&&VV(t,o))?s=s.filter(u=>u!==o):n=a,o=ns(o)}return e.set(t,s),s}function NO(t){let{element:e,boundary:r,rootBoundary:s,strategy:n}=t;const o=[...r==="clippingAncestors"?rc(e)?[]:OO(e,this._c):[].concat(r),s],a=o[0],l=o.reduce((c,u)=>{const h=Ty(e,u,n);return c.top=jt(h.top,c.top),c.right=rs(h.right,c.right),c.bottom=rs(h.bottom,c.bottom),c.left=jt(h.left,c.left),c},Ty(e,a,n));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function BO(t){const{width:e,height:r}=xV(t);return{width:e,height:r}}function zO(t,e,r){const s=yr(e),n=xr(e),i=r==="fixed",o=Ns(t,!0,i,e);let a={scrollLeft:0,scrollTop:0};const l=pr(0);if(s||!s&&!i)if((Qn(e)!=="body"||jo(n))&&(a=sc(e)),s){const d=Ns(e,!0,i,e);l.x=d.x+e.clientLeft,l.y=d.y+e.clientTop}else n&&(l.x=Cf(n));const c=n&&!s&&!i?wV(n,a):pr(0),u=o.left+a.scrollLeft-l.x-c.x,h=o.top+a.scrollTop-l.y-c.y;return{x:u,y:h,width:o.width,height:o.height}}function vu(t){return or(t).position==="static"}function Ry(t,e){if(!yr(t)||or(t).position==="fixed")return null;if(e)return e(t);let r=t.offsetParent;return xr(t)===r&&(r=r.ownerDocument.body),r}function qV(t,e){const r=Bt(t);if(rc(t))return r;if(!yr(t)){let n=ns(t);for(;n&&!En(n);){if(ir(n)&&!vu(n))return n;n=ns(n)}return r}let s=Ry(t,e);for(;s&&kO(s)&&vu(s);)s=Ry(s,e);return s&&En(s)&&vu(s)&&!_f(s)?r:s||CO(t)||r}const DO=async function(t){const e=this.getOffsetParent||qV,r=this.getDimensions,s=await r(t.floating);return{reference:zO(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function LO(t){return or(t).direction==="rtl"}const FO={convertOffsetParentRelativeRectToViewportRelativeRect:TO,getDocumentElement:xr,getClippingRect:NO,getOffsetParent:qV,getElementRects:DO,getClientRects:RO,getDimensions:BO,getScale:xn,isElement:ir,isRTL:LO};function vV(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function UO(t,e){let r=null,s;const n=xr(t);function i(){var a;clearTimeout(s),(a=r)==null||a.disconnect(),r=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),i();const c=t.getBoundingClientRect(),{left:u,top:h,width:d,height:f}=c;if(a||e(),!d||!f)return;const m=Ea(h),y=Ea(n.clientWidth-(u+d)),g=Ea(n.clientHeight-(h+f)),A=Ea(u),x={rootMargin:-m+"px "+-y+"px "+-g+"px "+-A+"px",threshold:jt(0,rs(1,l))||1};let w=!0;function q(_){const V=_[0].intersectionRatio;if(V!==l){if(!w)return o();V?o(!1,V):s=setTimeout(()=>{o(!1,1e-7)},1e3)}V===1&&!vV(c,t.getBoundingClientRect())&&o(),w=!1}try{r=new IntersectionObserver(q,{...x,root:n.ownerDocument})}catch{r=new IntersectionObserver(q,x)}r.observe(t)}return o(!0),i}function $O(t,e,r,s){s===void 0&&(s={});const{ancestorScroll:n=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=s,c=kf(t),u=n||i?[...c?po(c):[],...po(e)]:[];u.forEach(A=>{n&&A.addEventListener("scroll",r,{passive:!0}),i&&A.addEventListener("resize",r)});const h=c&&a?UO(c,r):null;let d=-1,f=null;o&&(f=new ResizeObserver(A=>{let[b]=A;b&&b.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(d),d=requestAnimationFrame(()=>{var x;(x=f)==null||x.observe(e)})),r()}),c&&!l&&f.observe(c),f.observe(e));let m,y=l?Ns(t):null;l&&g();function g(){const A=Ns(t);y&&!vV(y,A)&&r(),y=A,m=requestAnimationFrame(g)}return r(),()=>{var A;u.forEach(b=>{n&&b.removeEventListener("scroll",r),i&&b.removeEventListener("resize",r)}),h?.(),(A=f)==null||A.disconnect(),f=null,l&&cancelAnimationFrame(m)}}const HO=qO,GO=vO,WO=bO,KO=SO,YO=wO,My=xO,QO=_O,XO=(t,e,r)=>{const s=new Map,n={platform:FO,...r},i={...n.platform,_c:s};return AO(t,e,{...n,platform:i})};var Ka=typeof document<"u"?v.useLayoutEffect:v.useEffect;function vl(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,s,n;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(s=r;s--!==0;)if(!vl(t[s],e[s]))return!1;return!0}if(n=Object.keys(t),r=n.length,r!==Object.keys(e).length)return!1;for(s=r;s--!==0;)if(!{}.hasOwnProperty.call(e,n[s]))return!1;for(s=r;s--!==0;){const i=n[s];if(!(i==="_owner"&&t.$$typeof)&&!vl(t[i],e[i]))return!1}return!0}return t!==t&&e!==e}function _V(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Iy(t,e){const r=_V(t);return Math.round(e*r)/r}function _u(t){const e=v.useRef(t);return Ka(()=>{e.current=t}),e}function JO(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:s=[],platform:n,elements:{reference:i,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,h]=v.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[d,f]=v.useState(s);vl(d,s)||f(s);const[m,y]=v.useState(null),[g,A]=v.useState(null),b=v.useCallback(D=>{D!==_.current&&(_.current=D,y(D))},[]),x=v.useCallback(D=>{D!==V.current&&(V.current=D,A(D))},[]),w=i||m,q=o||g,_=v.useRef(null),V=v.useRef(null),S=v.useRef(u),k=l!=null,C=_u(l),E=_u(n),T=_u(c),R=v.useCallback(()=>{if(!_.current||!V.current)return;const D={placement:e,strategy:r,middleware:d};E.current&&(D.platform=E.current),XO(_.current,V.current,D).then(L=>{const Q={...L,isPositioned:T.current!==!1};I.current&&!vl(S.current,Q)&&(S.current=Q,Xl.flushSync(()=>{h(Q)}))})},[d,e,r,E,T]);Ka(()=>{c===!1&&S.current.isPositioned&&(S.current.isPositioned=!1,h(D=>({...D,isPositioned:!1})))},[c]);const I=v.useRef(!1);Ka(()=>(I.current=!0,()=>{I.current=!1}),[]),Ka(()=>{if(w&&(_.current=w),q&&(V.current=q),w&&q){if(C.current)return C.current(w,q,R);R()}},[w,q,R,C,k]);const z=v.useMemo(()=>({reference:_,floating:V,setReference:b,setFloating:x}),[b,x]),P=v.useMemo(()=>({reference:w,floating:q}),[w,q]),M=v.useMemo(()=>{const D={position:r,left:0,top:0};if(!P.floating)return D;const L=Iy(P.floating,u.x),Q=Iy(P.floating,u.y);return a?{...D,transform:"translate("+L+"px, "+Q+"px)",..._V(P.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:L,top:Q}},[r,a,P.floating,u.x,u.y]);return v.useMemo(()=>({...u,update:R,refs:z,elements:P,floatingStyles:M}),[u,R,z,P,M])}const ZO=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:s,padding:n}=typeof t=="function"?t(r):t;return s&&e(s)?s.current!=null?My({element:s.current,padding:n}).fn(r):{}:s?My({element:s,padding:n}).fn(r):{}}}},eN=(t,e)=>({...HO(t),options:[t,e]}),tN=(t,e)=>({...GO(t),options:[t,e]}),rN=(t,e)=>({...QO(t),options:[t,e]}),sN=(t,e)=>({...WO(t),options:[t,e]}),nN=(t,e)=>({...KO(t),options:[t,e]}),iN=(t,e)=>({...YO(t),options:[t,e]}),oN=(t,e)=>({...ZO(t),options:[t,e]});var aN="Arrow",SV=v.forwardRef((t,e)=>{const{children:r,width:s=10,height:n=5,...i}=t;return p.jsx(os.svg,{...i,ref:e,width:s,height:n,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:p.jsx("polygon",{points:"0,0 30,0 15,10"})})});SV.displayName=aN;var lN=SV;function cN(t){const[e,r]=v.useState(void 0);return ts(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const s=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const i=n[0];let o,a;if("borderBoxSize"in i){const l=i.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=t.offsetWidth,a=t.offsetHeight;r({width:o,height:a})});return s.observe(t,{box:"border-box"}),()=>s.unobserve(t)}else r(void 0)},[t]),e}var Ef="Popper",[kV,CV]=hV(Ef),[uN,EV]=kV(Ef),PV=t=>{const{__scopePopper:e,children:r}=t,[s,n]=v.useState(null);return p.jsx(uN,{scope:e,anchor:s,onAnchorChange:n,children:r})};PV.displayName=Ef;var TV="PopperAnchor",RV=v.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:s,...n}=t,i=EV(TV,r),o=v.useRef(null),a=Ds(e,o);return v.useEffect(()=>{i.onAnchorChange(s?.current||o.current)}),s?null:p.jsx(os.div,{...n,ref:a})});RV.displayName=TV;var Pf="PopperContent",[hN,dN]=kV(Pf),MV=v.forwardRef((t,e)=>{const{__scopePopper:r,side:s="bottom",sideOffset:n=0,align:i="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:h="partial",hideWhenDetached:d=!1,updatePositionStrategy:f="optimized",onPlaced:m,...y}=t,g=EV(Pf,r),[A,b]=v.useState(null),x=Ds(e,Fe=>b(Fe)),[w,q]=v.useState(null),_=cN(w),V=_?.width??0,S=_?.height??0,k=s+(i!=="center"?"-"+i:""),C=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},E=Array.isArray(c)?c:[c],T=E.length>0,R={padding:C,boundary:E.filter(pN),altBoundary:T},{refs:I,floatingStyles:z,placement:P,isPositioned:M,middlewareData:D}=JO({strategy:"fixed",placement:k,whileElementsMounted:(...Fe)=>$O(...Fe,{animationFrame:f==="always"}),elements:{reference:g.anchor},middleware:[eN({mainAxis:n+S,alignmentAxis:o}),l&&tN({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?rN():void 0,...R}),l&&sN({...R}),nN({...R,apply:({elements:Fe,rects:ar,availableWidth:Vt,availableHeight:Qt})=>{const{width:br,height:Et}=ar.reference,qt=Fe.floating.style;qt.setProperty("--radix-popper-available-width",`${Vt}px`),qt.setProperty("--radix-popper-available-height",`${Qt}px`),qt.setProperty("--radix-popper-anchor-width",`${br}px`),qt.setProperty("--radix-popper-anchor-height",`${Et}px`)}}),w&&oN({element:w,padding:a}),mN({arrowWidth:V,arrowHeight:S}),d&&iN({strategy:"referenceHidden",...R})]}),[L,Q]=OV(P),ge=ec(m);ts(()=>{M&&ge?.()},[M,ge]);const oe=D.arrow?.x,se=D.arrow?.y,ye=D.arrow?.centerOffset!==0,[ae,ue]=v.useState();return ts(()=>{A&&ue(window.getComputedStyle(A).zIndex)},[A]),p.jsx("div",{ref:I.setFloating,"data-radix-popper-content-wrapper":"",style:{...z,transform:M?z.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ae,"--radix-popper-transform-origin":[D.transformOrigin?.x,D.transformOrigin?.y].join(" "),...D.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:p.jsx(hN,{scope:r,placedSide:L,onArrowChange:q,arrowX:oe,arrowY:se,shouldHideArrow:ye,children:p.jsx(os.div,{"data-side":L,"data-align":Q,...y,ref:x,style:{...y.style,animation:M?void 0:"none"}})})})});MV.displayName=Pf;var IV="PopperArrow",fN={top:"bottom",right:"left",bottom:"top",left:"right"},jV=v.forwardRef(function(e,r){const{__scopePopper:s,...n}=e,i=dN(IV,s),o=fN[i.placedSide];return p.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:p.jsx(lN,{...n,ref:r,style:{...n.style,display:"block"}})})});jV.displayName=IV;function pN(t){return t!==null}var mN=t=>({name:"transformOrigin",options:t,fn(e){const{placement:r,rects:s,middlewareData:n}=e,o=n.arrow?.centerOffset!==0,a=o?0:t.arrowWidth,l=o?0:t.arrowHeight,[c,u]=OV(r),h={start:"0%",center:"50%",end:"100%"}[u],d=(n.arrow?.x??0)+a/2,f=(n.arrow?.y??0)+l/2;let m="",y="";return c==="bottom"?(m=o?h:`${d}px`,y=`${-l}px`):c==="top"?(m=o?h:`${d}px`,y=`${s.floating.height+l}px`):c==="right"?(m=`${-l}px`,y=o?h:`${f}px`):c==="left"&&(m=`${s.floating.width+l}px`,y=o?h:`${f}px`),{data:{x:m,y}}}});function OV(t){const[e,r="center"]=t.split("-");return[e,r]}var gN=PV,yN=RV,AN=MV,xN=jV,bN="Portal",NV=v.forwardRef((t,e)=>{const{container:r,...s}=t,[n,i]=v.useState(!1);ts(()=>i(!0),[]);const o=r||n&&globalThis?.document?.body;return o?sI.createPortal(p.jsx(os.div,{...s,ref:e}),o):null});NV.displayName=bN;function wN(t,e){return v.useReducer((r,s)=>e[r][s]??r,t)}var Tf=t=>{const{present:e,children:r}=t,s=VN(e),n=typeof r=="function"?r({present:s.isPresent}):v.Children.only(r),i=Ds(s.ref,qN(n));return typeof r=="function"||s.isPresent?v.cloneElement(n,{ref:i}):null};Tf.displayName="Presence";function VN(t){const[e,r]=v.useState(),s=v.useRef(null),n=v.useRef(t),i=v.useRef("none"),o=t?"mounted":"unmounted",[a,l]=wN(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return v.useEffect(()=>{const c=Pa(s.current);i.current=a==="mounted"?c:"none"},[a]),ts(()=>{const c=s.current,u=n.current;if(u!==t){const d=i.current,f=Pa(c);t?l("MOUNT"):f==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&d!==f?"ANIMATION_OUT":"UNMOUNT"),n.current=t}},[t,l]),ts(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,h=f=>{const y=Pa(s.current).includes(f.animationName);if(f.target===e&&y&&(l("ANIMATION_END"),!n.current)){const g=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=g)})}},d=f=>{f.target===e&&(i.current=Pa(s.current))};return e.addEventListener("animationstart",d),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",d),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:v.useCallback(c=>{s.current=c?getComputedStyle(c):null,r(c)},[])}}function Pa(t){return t?.animationName||"none"}function qN(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var vN=hd[" useInsertionEffect ".trim().toString()]||ts;function _N({prop:t,defaultProp:e,onChange:r=()=>{},caller:s}){const[n,i,o]=SN({defaultProp:e,onChange:r}),a=t!==void 0,l=a?t:n;{const u=v.useRef(t!==void 0);v.useEffect(()=>{const h=u.current;h!==a&&console.warn(`${s} is changing from ${h?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,s])}const c=v.useCallback(u=>{if(a){const h=kN(u)?u(t):u;h!==t&&o.current?.(h)}else i(u)},[a,t,i,o]);return[l,c]}function SN({defaultProp:t,onChange:e}){const[r,s]=v.useState(t),n=v.useRef(r),i=v.useRef(e);return vN(()=>{i.current=e},[e]),v.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,s,i]}function kN(t){return typeof t=="function"}var CN=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),EN="VisuallyHidden",BV=v.forwardRef((t,e)=>p.jsx(os.span,{...t,ref:e,style:{...CN,...t.style}}));BV.displayName=EN;var PN=BV,[nc]=hV("Tooltip",[CV]),ic=CV(),TN="TooltipProvider",Zh="tooltip.open",[V$,Rf]=nc(TN),mo="Tooltip",[RN,Oo]=nc(mo),zV=t=>{const{__scopeTooltip:e,children:r,open:s,defaultOpen:n,onOpenChange:i,disableHoverableContent:o,delayDuration:a}=t,l=Rf(mo,t.__scopeTooltip),c=ic(e),[u,h]=v.useState(null),d=cO(),f=v.useRef(0),m=o??l.disableHoverableContent,y=a??l.delayDuration,g=v.useRef(!1),[A,b]=_N({prop:s,defaultProp:n??!1,onChange:V=>{V?(l.onOpen(),document.dispatchEvent(new CustomEvent(Zh))):l.onClose(),i?.(V)},caller:mo}),x=v.useMemo(()=>A?g.current?"delayed-open":"instant-open":"closed",[A]),w=v.useCallback(()=>{window.clearTimeout(f.current),f.current=0,g.current=!1,b(!0)},[b]),q=v.useCallback(()=>{window.clearTimeout(f.current),f.current=0,b(!1)},[b]),_=v.useCallback(()=>{window.clearTimeout(f.current),f.current=window.setTimeout(()=>{g.current=!0,b(!0),f.current=0},y)},[y,b]);return v.useEffect(()=>()=>{f.current&&(window.clearTimeout(f.current),f.current=0)},[]),p.jsx(gN,{...c,children:p.jsx(RN,{scope:e,contentId:d,open:A,stateAttribute:x,trigger:u,onTriggerChange:h,onTriggerEnter:v.useCallback(()=>{l.isOpenDelayedRef.current?_():w()},[l.isOpenDelayedRef,_,w]),onTriggerLeave:v.useCallback(()=>{m?q():(window.clearTimeout(f.current),f.current=0)},[q,m]),onOpen:w,onClose:q,disableHoverableContent:m,children:r})})};zV.displayName=mo;var ed="TooltipTrigger",DV=v.forwardRef((t,e)=>{const{__scopeTooltip:r,...s}=t,n=Oo(ed,r),i=Rf(ed,r),o=ic(r),a=v.useRef(null),l=Ds(e,a,n.onTriggerChange),c=v.useRef(!1),u=v.useRef(!1),h=v.useCallback(()=>c.current=!1,[]);return v.useEffect(()=>()=>document.removeEventListener("pointerup",h),[h]),p.jsx(yN,{asChild:!0,...o,children:p.jsx(os.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...s,ref:l,onPointerMove:Cr(t.onPointerMove,d=>{d.pointerType!=="touch"&&!u.current&&!i.isPointerInTransitRef.current&&(n.onTriggerEnter(),u.current=!0)}),onPointerLeave:Cr(t.onPointerLeave,()=>{n.onTriggerLeave(),u.current=!1}),onPointerDown:Cr(t.onPointerDown,()=>{n.open&&n.onClose(),c.current=!0,document.addEventListener("pointerup",h,{once:!0})}),onFocus:Cr(t.onFocus,()=>{c.current||n.onOpen()}),onBlur:Cr(t.onBlur,n.onClose),onClick:Cr(t.onClick,n.onClose)})})});DV.displayName=ed;var Mf="TooltipPortal",[MN,IN]=nc(Mf,{forceMount:void 0}),LV=t=>{const{__scopeTooltip:e,forceMount:r,children:s,container:n}=t,i=Oo(Mf,e);return p.jsx(MN,{scope:e,forceMount:r,children:p.jsx(Tf,{present:r||i.open,children:p.jsx(NV,{asChild:!0,container:n,children:s})})})};LV.displayName=Mf;var Pn="TooltipContent",FV=v.forwardRef((t,e)=>{const r=IN(Pn,t.__scopeTooltip),{forceMount:s=r.forceMount,side:n="top",...i}=t,o=Oo(Pn,t.__scopeTooltip);return p.jsx(Tf,{present:s||o.open,children:o.disableHoverableContent?p.jsx(UV,{side:n,...i,ref:e}):p.jsx(jN,{side:n,...i,ref:e})})}),jN=v.forwardRef((t,e)=>{const r=Oo(Pn,t.__scopeTooltip),s=Rf(Pn,t.__scopeTooltip),n=v.useRef(null),i=Ds(e,n),[o,a]=v.useState(null),{trigger:l,onClose:c}=r,u=n.current,{onPointerInTransitChange:h}=s,d=v.useCallback(()=>{a(null),h(!1)},[h]),f=v.useCallback((m,y)=>{const g=m.currentTarget,A={x:m.clientX,y:m.clientY},b=DN(A,g.getBoundingClientRect()),x=LN(A,b),w=FN(y.getBoundingClientRect()),q=$N([...x,...w]);a(q),h(!0)},[h]);return v.useEffect(()=>()=>d(),[d]),v.useEffect(()=>{if(l&&u){const m=g=>f(g,u),y=g=>f(g,l);return l.addEventListener("pointerleave",m),u.addEventListener("pointerleave",y),()=>{l.removeEventListener("pointerleave",m),u.removeEventListener("pointerleave",y)}}},[l,u,f,d]),v.useEffect(()=>{if(o){const m=y=>{const g=y.target,A={x:y.clientX,y:y.clientY},b=l?.contains(g)||u?.contains(g),x=!UN(A,o);b?d():x&&(d(),c())};return document.addEventListener("pointermove",m),()=>document.removeEventListener("pointermove",m)}},[l,u,o,c,d]),p.jsx(UV,{...t,ref:i})}),[ON,NN]=nc(mo,{isInside:!1}),BN=Wj("TooltipContent"),UV=v.forwardRef((t,e)=>{const{__scopeTooltip:r,children:s,"aria-label":n,onEscapeKeyDown:i,onPointerDownOutside:o,...a}=t,l=Oo(Pn,r),c=ic(r),{onClose:u}=l;return v.useEffect(()=>(document.addEventListener(Zh,u),()=>document.removeEventListener(Zh,u)),[u]),v.useEffect(()=>{if(l.trigger){const h=d=>{d.target?.contains(l.trigger)&&u()};return window.addEventListener("scroll",h,{capture:!0}),()=>window.removeEventListener("scroll",h,{capture:!0})}},[l.trigger,u]),p.jsx(pV,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:h=>h.preventDefault(),onDismiss:u,children:p.jsxs(AN,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[p.jsx(BN,{children:s}),p.jsx(ON,{scope:r,isInside:!0,children:p.jsx(PN,{id:l.contentId,role:"tooltip",children:n||s})})]})})});FV.displayName=Pn;var $V="TooltipArrow",zN=v.forwardRef((t,e)=>{const{__scopeTooltip:r,...s}=t,n=ic(r);return NN($V,r).isInside?null:p.jsx(xN,{...n,...s,ref:e})});zN.displayName=$V;function DN(t,e){const r=Math.abs(e.top-t.y),s=Math.abs(e.bottom-t.y),n=Math.abs(e.right-t.x),i=Math.abs(e.left-t.x);switch(Math.min(r,s,n,i)){case i:return"left";case n:return"right";case r:return"top";case s:return"bottom";default:throw new Error("unreachable")}}function LN(t,e,r=5){const s=[];switch(e){case"top":s.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":s.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":s.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":s.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return s}function FN(t){const{top:e,right:r,bottom:s,left:n}=t;return[{x:n,y:e},{x:r,y:e},{x:r,y:s},{x:n,y:s}]}function UN(t,e){const{x:r,y:s}=t;let n=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i],l=e[o],c=a.x,u=a.y,h=l.x,d=l.y;u>s!=d>s&&r<(h-c)*(s-u)/(d-u)+c&&(n=!n)}return n}function $N(t){const e=t.slice();return e.sort((r,s)=>r.x<s.x?-1:r.x>s.x?1:r.y<s.y?-1:r.y>s.y?1:0),HN(e)}function HN(t){if(t.length<=1)return t.slice();const e=[];for(let s=0;s<t.length;s++){const n=t[s];for(;e.length>=2;){const i=e[e.length-1],o=e[e.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))e.pop();else break}e.push(n)}e.pop();const r=[];for(let s=t.length-1;s>=0;s--){const n=t[s];for(;r.length>=2;){const i=r[r.length-1],o=r[r.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))r.pop();else break}r.push(n)}return r.pop(),e.length===1&&r.length===1&&e[0].x===r[0].x&&e[0].y===r[0].y?e:e.concat(r)}var GN=zV;const WN={"":v.Fragment,pre:"pre",code:"code",ol:"ol",ul:"ul",hr:"hr",blockquote:"blockquote",li:"li",a:"a",img:"img",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",p:"p",em:"em",strong:"strong"},jy=t=>t.replace(RegExp("^"+(t.match(/^(\t| )+/)||"")[0],"gm"),""),KN=t=>t&&typeof t!="string"&&["div","ul","ol","pre","h1","h2","h3","h4","h5","h6"].includes(t.t),Su=t=>t.replace(/^\s+|\s+$/g," "),We=(t,e=[],r={})=>({t,c:Array.isArray(e)?e:[e],p:r}),Pi=(t,e=!1)=>{let r=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,s=0;const n=We("");let i,o;e?(i=We("p"),o=[n,i],n.c.push(i)):(i=n,o=[n]);let a;const l=(h,d=!0)=>(d&&o.push(h),i.c.push(h),d&&(i=h),h),c=h=>{const d=o.findIndex(f=>f.t===h);o=o.slice(0,d),i=o.at(-1)};for(;a=r.exec(t);){const h=t.substring(s,a.index);if(s=r.lastIndex,h!=="")if(i===n&&e){const d=We("p",Su(h));n.c.push(d),o=[n,d],i=d}else i.c.push(Su(h));if(!h.match(/[^\\](\\\\)*\\$/)){if(a[3]||a[4]){const d=We("pre",a[4]?jy(a[4]):We("code",jy(a[3]),a[2]?{language:`language-${a[2].toLowerCase()}`}:{}));n.c.push(d),o=[n],i=n}else if(a[6]){const d=a[6],f=d!==">",m=!!d.match(/\./),y=f?m?"ol":"ul":"blockquote",g=a[5].split(`
`).map(b=>b.replace(/^(\*|-|\+|>|\d+\.)\s+/,"")).filter(b=>b.trim()!==""),A=We(y,f?g.map(b=>We("li",Pi(b).c)):Pi(g.join(`
`)).c);n.c.push(A),o=[n,A],i=n}else if(a[8]){const d=We("img",[],{src:a[8],...a[7]?{alt:a[7]}:{}});if(e&&i===n){const f=We("p",d);n.c.push(f),i=f,o=[n,f]}else l(d,!1)}else if(a[10]){const d=o.find(f=>f.t==="a");d&&(d.p.href=a[11])}else if(a[9])l(We("a"));else if(a[14]){const d="h"+a[14].length;n.c.push(We(d,Pi(a[15]).c)),o=[n],i=n}else if(a[13])n.c.push(We("h1",Pi(a[12]).c)),o=[n],i=n;else if(a[16])l(We("code",a[16]),!1);else if(a[17]?.[0]===`
`||a[17]===`  
`){if(!(o[1]?.t==="p")){const m=n.c;let y;for(y=m.length-1;y>=0&&!KN(m[y]);y--);if(y!==n.c.length-1){const g=n.c.splice(y+1);n.c.push(We("p",g))}}const f=We("p");n.c.push(f),o=[n,f],i=f}else if(a[1])n.c.push(We("hr")),o=[n],i=n;else if(a[17]){const d=a[17].length===2?"strong":"em";o.findIndex(m=>m.t===d)===-1?l(We(d)):c(d)}}}const u=Su(t.substring(s));if(u.length){const h=n.c.at(-1);let d;h?.t==="p"?d=h:e?(d=We("p"),n.c.push(d)):d=n,d.c.push(u)}return n.c=n.c.filter(h=>typeof h=="string"||h.t!=="p"||h.c?.length>0),n},YN=(t,e={})=>{const r={...WN,...e},s=(n,i=0)=>{const o=n.t===""?v.Fragment:r[n.t];return v.createElement(o,{...n.p,key:i},n.c.length===0?void 0:n.c.map((a,l)=>typeof a=="string"?a:s(a,l)))};return s(Pi(t,!0))},QN=({markdown:t,customComponents:e})=>YN(t,e),XN={h2:function({children:e}){return p.jsx("h2",{className:`mb-1 sprites-double-height text-metallicBlue zx:text-zxBlue clear-both ${le}`,children:p.jsx(rt,{children:e})})},h3:function({children:e}){return p.jsx("h3",{className:"mt-1 mb-1 text-metallicBlue zx:text-zxBlue clear-both",children:p.jsx(rt,{children:e})})},blockquote:function({children:e}){return p.jsx("blockquote",{className:`${le} mt-1 mb-1 text-moss zx:text-zxBlue clear-both`,children:p.jsxs(rt,{children:["> ",e]})})},p:function({children:e}){return p.jsx("div",{className:`mb-1 last:mb-0 ${le}`,children:p.jsx(rt,{children:e})})},a:function({children:e,href:r}){return p.jsx("a",{className:"bitmap-text-link",href:r,target:"_blank",rel:"noopener noreferrer",children:p.jsx(rt,{children:e})})},li:function({children:e}){return p.jsx("div",{className:`mb-1 clear-both ${le}`,children:p.jsxs(rt,{children:[p.jsx(j,{className:"text-metallicBlue zx:text-zxYellow",children:""}),e]})})},strong:function({children:e}){return p.jsx(rt,{className:"strong text-midRed zx:text-zxRed",children:e})},em:function({children:e}){return p.jsx(rt,{className:"em text-moss zx:text-zxBlue",children:e})},img:function({src:e}){const r=Io();if(e===void 0)throw new Error("image without src");const s=e.split(/\?|&/);return p.jsx("span",{style:{"--scale":r*2},children:p.jsx("span",{className:ht("sprite float-left mr-1 mb-1 zx:sprite-revert-to-two-tone",s.join(" "))})})},hr:function(){return p.jsx("hr",{className:"bg-metallicBlue zx:bg-zxWhite h-half mb-half border-none"})}},me=({markdown:t,className:e})=>p.jsx("div",{className:`contents ${e}`,children:p.jsx(QN,{customComponents:XN,markdown:t})}),If=({triggerContent:t,tooltipContent:e})=>e?p.jsxs(GN,{children:[p.jsx(DV,{asChild:!0,children:t}),p.jsx(LV,{children:p.jsx(yn,{scaleFactor:2,children:p.jsx(FV,{side:"bottom",align:"end",className:"bg-lightBeige text-white p-1 mt-oneScaledPix drop-shadow-oneBlock z-popups",children:typeof e=="string"?p.jsx("div",{className:"max-w-16",children:p.jsx(me,{markdown:e})}):e})})})]}):t,JN=/^(?<modifiers>[^]*)(?<key>.+)$/,ZN=t=>{const e=new Set;for(const r of t){if(e.has(r))return!0;e.add(r)}return!1},jf=(t,e,r,s=void 0)=>{const n=t?.join(" ");v.useEffect(()=>{if(!t||t.length===0||s===null)return;const i=s??window,o=a=>{let c=a.target;for(;c&&c!==i;){if(c.classList.contains("no-keyboard-shortcuts"))return;c=c.parentElement}for(const u of t){const h=u.match(JN);if(!h||!h.groups)continue;const{modifiers:d,key:f}=h.groups;if(ZN(d)){console.warn(`Invalid shortcut "${u}": duplicate modifiers`);continue}const m=d.includes("^"),y=d.includes(""),g=d.includes(""),A=d.includes(""),b=m||y||g||A,x=m===a.ctrlKey&&y===a.metaKey&&g===a.shiftKey&&A===a.altKey&&(b||!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&!a.altKey);if((A&&a.altKey?a.code.replace(/^Key/,"").toLowerCase():a.key.toLowerCase())===f.toLowerCase()&&x){e||r?.(),a.preventDefault();break}}};return i.addEventListener("keydown",o),()=>{i.removeEventListener("keydown",o)}},[e,r,n,s])},eB=({className:t,selected:e,disabled:r=!1,onClick:s,ref:n,tooltipContent:i,shortcutKeys:o,children:a,...l})=>{jf(o,r,s);const c=p.jsx("button",{disabled:r,onClick:s,"data-selected":e,className:bf(`inline-flex items-center justify-center whitespace-nowrap 
          bg-metallicBlue zx:bg-zxBlue border-none border-shadow
          gap-2
           disabled:bg-midGrey disabled:text-lightGrey 
           data-[selected=true]:bg-lightBeige
           [&:not(:disabled):hover:not([data-selected=true])]:bg-pastelBlue 
           `,t),ref:n,...l,children:a}),u=wf(typeof i=="string"?i:void 0,o)??i;return p.jsx(If,{triggerContent:c,tooltipContent:u})},Xn="bg-white zx:bg-zxWhite py-0 gap-y-0 text-metallicBlueHalfbrite zx:text-zxBlue disabledMenuItem:text-midGrey zx:disabledMenuItem:text-zxYellow selectedMenuItem:text-metallicBlue zx:selectedMenuItem:text-zxGreen [--leader-col-width:theme(width.3)] ",Jn="flex flex-col gap-1 p-1 overflow-y-scroll scrollbar scrollbar-w-1 scrollbar-thumb-midGrey scrollbar-track-white zx:scrollbar-thumb-zxBlue zx:scrollbar-track-zxWhite mobile:px-3",Zn="bg-lightGrey zx:bg-zxWhiteDimmed mobile:px-4",te=t=>t,tB=t=>{const e=t.length;if(e===1)return[t[0]];let r=0;for(let n=0;n<e-1;n++)r=Math.max(r,t[n].length+n);const s=t[e-1].length+(e-1);return r=Math.max(r,s),t.map((n,i)=>{if(i===e-1){const a=r-n.length;return" ".repeat(a)+n}else{const a=i,l=r-n.length-a;return" ".repeat(a)+n+" ".repeat(l)}})},HV=({label:t})=>p.jsx(j,{className:"inline-block mr-1 text-lightGrey py-half",noSlitWords:!0,children:t}),Yr=({className:t,value:e,onChange:r,trueLabel:s="ON",falseLabel:n="OFF",label:i,shortcutKeys:o,tooltipContent:a})=>{const l=Math.max(s.length,n.length)+1,c=s.padStart(l," "),u=n.padEnd(l," ");jf(o,!1,()=>{r?.(!e,void 0)});const h=p.jsxs("span",{onClick:f=>r?.(!e,f),className:bf("inline-flex justify-between leading-none",t),children:[i&&p.jsx(HV,{label:i}),p.jsx(j,{role:"switch",className:xf("inline-block w-min h-min py-half px-half sprites-uppercase",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:e?c:u})]}),d=wf(typeof a=="string"?a:void 0,o)??a;return p.jsx(If,{triggerContent:h,tooltipContent:d})},Oy=te(["bg-redShadowHalfbrite text-highlightBeige zx:bg-zxBlack zx:text-zxGreen","bg-metallicBlueHalfbrite text-pastelBlue zx:bg-zxBlack zx:text-zxBlue","bg-pinkHalfbrite text-pink zx:bg-zxBlack zx:text-zxYellow","bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"]),Of=({className:t,value:e,onChange:r,values:s,valueLabels:n=s.map(l=>`${l}`),label:i,shortcutKeys:o,tooltipContent:a})=>{const l=s.indexOf(e),c=s.length,u=v.useCallback(()=>{const y=(l+1)%c;r?.(s[y],void 0)},[r,l,s,c]);jf(o,!1,()=>{u()});const h=tB(n),d=c>4?l%4:l,f=p.jsxs("span",{onClick:u,className:bf("inline-flex justify-between leading-none",t),children:[i&&p.jsx(HV,{label:i}),p.jsx(j,{role:"switch",className:xf("inline-block w-min h-min py-half px-half sprites-uppercase",Oy[d]??Oy[0]),noSlitWords:!0,children:h[l]})]}),m=wf(typeof a=="string"?a:void 0,o)??a;return p.jsx(If,{triggerContent:f,tooltipContent:m})},Ee=te("[&_.em]:text-moss zx:[&_.em]:text-zxCyan [&_h2]:text-midRed zx:[&_h2]:text-zxBlue text-lightGrey zx:text-zxBlack sprites-normal-height"),be="sprite zx:sprite-revert-to-two-tone colourised:brightness-halfBrite selectedMenuItem:filter-none zx:selectedMenuItem:sprite-revert-zxYellow sprites-normal-height",rB="**4-way**: True to the 1987 original - move in x directions only",sB="**8-way**: The original with *4-way* movement, plus *diagonals*",nB="**Analogue**: Move in *any* direction with analogue stick",iB=()=>{const t=Mw();return p.jsx(F,{id:"analogueControl",label:"Directions",leader:p.jsx("span",{className:`${be} texture-joystick_whole sprites-normal-height`}),valueElement:p.jsx(Of,{className:"ml-auto",values:Ow,valueLabels:["4-way","8-way","anlg"],value:t}),onSelect:B(hM),verticalAlignItemsCentre:!0,className:"sprites-double-height",hintInline:!0,hint:p.jsx(me,{className:Ee,markdown:t==="analogue"?nB:t==="8-way"?sB:rB})})},oB=()=>p.jsx(F,{className:"sprites-double-height",id:"onScreenControls",label:p.jsx(j,{className:`${le} mobile:w-max`,children:"Touch controls"}),valueElement:p.jsx(Yr,{className:"ml-auto",value:YR()}),onSelect:B(rr,{path:"onScreenControls"}),verticalAlignItemsCentre:!0,hintInline:!0,hint:p.jsx(me,{className:Ee,markdown:`Enables on-screen controls: for mobile, tablet, or any device with a touch-screen.

You can turn this off for phones paired with joypads/keyboards`})}),aB="This blockstack.ing remake comes with modern default mappings for keyboard and controller. You can also select presets matching the original game or different systems.",lB=({className:t})=>{const e=X(BR);return p.jsx(j,{className:ht("text-nowrap","ml-auto","text-pinkHalfbrite zx:text-zxRed selectedMenuItem:text-pink zx:selectedMenuItem:text-zxRed",t),children:e??"custom"})},cB=()=>p.jsx(F,{id:"preset",doubleHeight:!0,label:p.jsx(j,{className:`${le}`,children:"Key/button preset"}),valueElement:p.jsx(lB,{}),onSelect:B(ut,"inputPreset"),opensSubMenu:!0,hint:p.jsx(me,{className:Ee,markdown:aB}),hintInline:!0}),uB={screen:`**Screen**: Control is relative to the *screen*.
More intuitive if you find directions confusing in isometric games, but means hitting diagonals a lot`,world:"**World**: Control is relative to directions in the *isometric world* - like the original",mixed:"**Mixed (default)**: *Analogue sticks* move relative to the *screen*, digital inputs like *keys* and *d-pad* move relative to the *world*"},hB={screen:te("texture-heels_walking_towardsRight_2 selectedMenuItem:texture-animated-heels_screenDirections"),world:te("texture-heels_standing_right selectedMenuItem:texture-animated-heels_worldDirections sprites-normal-height"),mixed:te("texture-heels_standing_right selectedMenuItem:texture-animated-heels_mixedDirections sprites-normal-height")},dB=()=>{const t=uf();return p.jsx(Of,{className:"ml-auto",values:Zb,value:t})},fB=()=>{const t=uf();return p.jsx(F,{id:"screenRelativeControl",label:"Input axes",leader:p.jsx("span",{className:`${be} ${hB[t]}`}),valueElement:p.jsx(dB,{}),onSelect:B(uM),hintInline:!0,verticalAlignItemsCentre:!0,className:"sprites-double-height",hint:p.jsx(me,{className:Ee,markdown:uB[t]})})},Vs="text-mossHalfbrite zx:text-zxGreen selectedMenuItem:text-moss zx:selectedMenuItem:text-zxGreen",pB=t=>{const e=r=>r.startsWith("Arrow")?1:r.startsWith("Numpad")?2:0;return t.toSorted((r,s)=>{const n=e(r)-e(s);if(n!==0)return n;const i=r===" "?"Space":r,o=s===" "?"Space":s,a=i.length-o.length;return a!==0?a:i.localeCompare(o)})},mB=t=>{const e=/(Numpad|F)(.*)/.exec(t);if(e!==null)return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:Vs,children:e[1]}),e[2]]});switch(t){case" ":return"Space";case"ArrowDown":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:Vs,children:"Cursor"}),""]});case"ArrowUp":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:Vs,children:"Cursor"}),""]});case"ArrowLeft":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:Vs,children:"Cursor"}),""]});case"ArrowRight":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:Vs,children:"Cursor"}),""]});default:return t}},gB=["","","R","R"],yB=t=>gB[t]??`axis${t}`,AB=t=>{switch(um[t]){case"dPadDown":return"D-pad";case"dPadUp":return"D-pad";case"dPadLeft":return"D-pad";case"dPadRight":return"D-pad";case"a":return p.jsx("span",{className:"colourised:text-mossHalfbrite colourised:selectedMenuItem:text-moss zx:text-zxGreen",children:"A"});case"b":return p.jsx("span",{className:"colourised:text-midRedHalfbrite colourised:selectedMenuItem:text-midRed zx:text-zxRed",children:"B"});case"x":return p.jsx("span",{className:"colourised:text-metallicBlueHalfbrite colourised:selectedMenuItem:text-metallicBlue zx:text-zxBlue",children:"X"});case"y":return p.jsx("span",{className:"colourised:text-highlightBeigeHalfbrite colourised:selectedMenuItem:text-highlightBeige zx:text-zxYellow",children:"Y"});case"start":return"Start";case"select":return"Select"}return um[t]?.toUpperCase()??t},_l=({action:t,keyClassName:e,className:r,flashingCursor:s=!1,inline:n=!1})=>{const i=X(c=>c.gameMenus.assigningInput?.action===t?c.gameMenus.assigningInput?.presses:ml(c).presses[t]),o=X(c=>{const u=Wh(t);return u===void 0?pn:c.gameMenus.assigningInput?.action===t?c.gameMenus.assigningInput.axes:ml(c).axes[u.axis]}),a=p.jsxs(p.Fragment,{children:[pB(i.keys).map(c=>p.jsx("span",{className:ht("text-nowrap h-[calc(10px*var(--scale))]",e),children:p.jsx(rt,{children:mB(c)})},`key:${c}`)),s&&p.jsx("span",{className:"sprite texture-hud_char_space bg-[currentColor] animate-flash"})]}),l=p.jsxs(p.Fragment,{children:[o.map(c=>p.jsx("span",{className:ht("text-nowrap h-[calc(10px*var(--scale))]",e),children:p.jsxs(rt,{children:[p.jsx("span",{className:Vs,children:""}),yB(c)]})},`gamePadAxis:${c}`)),i.gamepadButtons.map(c=>p.jsx("span",{className:ht("text-nowrap h-[calc(10px*var(--scale))]",e),children:p.jsxs(rt,{children:[p.jsx("span",{className:Vs,children:""}),AB(c)]})},`gamePadButton:${c}`)),s&&p.jsx("span",{className:"sprite texture-hud_char_space bg-[currentColor] animate-flash"})]});return p.jsxs("div",{className:ht(r,n?"inline":"w-full"),children:[n?a:p.jsx("div",{className:"flex flex-col w-[50%] gap-y-oneScaledPix",children:a}),n?l:p.jsx("div",{className:"flex flex-col",children:l})]})},Ny="text-pink zx:text-zxCyan",xB=()=>{const t=X(({gameMenus:e})=>e.assigningInput?.action);return t===void 0?null:p.jsxs("div",{className:`
        bg-metallicBlueHalfbrite text-white
        zx:bg-zxBlueDimmed zx:text-zxCyanDimmed

        ${le} inline-block absolute inset-x-0 bottom-0 h-min pt-1 px-1`,children:[p.jsx(j,{children:"Press: "}),p.jsx(_l,{inline:!0,className:`${Ny}`,action:"menu_openOrExit",keyClassName:"me-1"}),p.jsx(j,{children:"when done selecting keys for "}),p.jsx(j,{className:Ny,children:t})]})},bB="text-pinkHalfbrite zx:text-zxRed selectedMenuItem:text-pink zx:selectedMenuItem:text-zxRed",ze=({className:t,action:e})=>{const r=X(s=>s.gameMenus.assigningInput?.action===e);return p.jsx(_l,{className:ht("flex flex-wrap gap-y-oneScaledPix gap-x-1 ml-2",t),action:e,keyClassName:bB,flashingCursor:r})},wB=()=>{const t=uf()==="screen";return p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"col-span-3",children:p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${le} pt-1  sprites-double-height`,children:"Movement"})}),p.jsx(F,{id:"left",label:`Left ${t?"":""}`,leader:p.jsx("span",{className:`${be} ${t?"texture-head_walking_towardsLeft_2 selectedMenuItem:texture-animated-head_walking_towardsLeft":"texture-head_walking_left_2 selectedMenuItem:texture-animated-head_walking_left"}`}),valueElement:p.jsx(ze,{action:"left"}),onSelect:B(Be,"left")}),p.jsx(F,{id:"right",label:`Right ${t?"":""}`,leader:p.jsx("span",{className:`${be} ${t?"texture-head_walking_awayRight_2 selectedMenuItem:texture-animated-head_walking_awayRight":"texture-head_walking_right_2 selectedMenuItem:texture-animated-head_walking_right"}`}),valueElement:p.jsx(ze,{action:"right"}),onSelect:B(Be,"right")}),p.jsx(F,{id:"up",label:`Up ${t?"":""}`,leader:p.jsx("span",{className:`${be} ${t?"texture-head_walking_awayLeft_2 selectedMenuItem:texture-animated-head_walking_awayLeft":"texture-head_walking_away_2 selectedMenuItem:texture-animated-head_walking_away"}`}),valueElement:p.jsx(ze,{action:"away"}),onSelect:B(Be,"away")}),p.jsx(F,{id:"down",label:`Down ${t?"":""}`,leader:p.jsx("span",{className:`${be} ${t?"texture-head_walking_towardsRight_2 selectedMenuItem:texture-animated-head_walking_towardsRight":"texture-head_walking_towards_2 selectedMenuItem:texture-animated-head_walking_towards"}`}),valueElement:p.jsx(ze,{action:"towards"}),onSelect:B(Be,"towards")}),p.jsx(F,{id:"jump",label:"Jump",leader:p.jsx("span",{className:`${be} texture-spring_released selectedMenuItem:texture-spring_compressed`}),valueElement:p.jsx(ze,{action:"jump"}),onSelect:B(Be,"jump")}),p.jsx("div",{className:"col-span-3",children:p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${le} pt-1  sprites-double-height`,children:"Character-specific Abilities"})}),p.jsx("div",{className:`${le} col-span-3`,children:p.jsx(me,{markdown:`**NOTE:** Some puzzles require Heels to jump and pick up/down simultaneously - assign a key to *both jump and carry*
          `,className:Ee})}),p.jsx(F,{id:"carry",label:"Carry",leader:p.jsx("span",{className:`${be} texture-bag`}),valueElement:p.jsx(ze,{action:"carry"}),onSelect:B(Be,"carry"),hint:p.jsx(me,{className:Ee,markdown:"Carrying is **Heels only** and requires the bag"}),hintInline:!0}),p.jsx(F,{id:"fire",label:p.jsx(j,{className:`inline-block w-6 ${le}`,children:"Fire dough- nuts"}),leader:p.jsx("span",{className:`${be} texture-doughnuts`}),hint:p.jsx(me,{className:Ee,markdown:"Firing doughnuts is **Head only** and requires the hooter"}),hintInline:!0,valueElement:p.jsx(ze,{action:"fire"}),onSelect:B(Be,"fire")}),p.jsx("div",{className:"col-span-3",children:p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${le} pt-1  sprites-double-height`,children:"Character Swopping"})}),p.jsx(F,{id:"swop",label:"Swop",valueElement:p.jsx(ze,{action:"swop"}),onSelect:B(Be,"swop"),hint:p.jsx(me,{className:Ee,markdown:"Works like the original game. *Cycles through* the characters, Moves *in and out of symbiosis* if head is on top of heels"}),hintInline:!0,leader:p.jsxs("span",{className:`${be} texture-blank relative overflow-hidden`,children:[p.jsx("span",{className:`${be} texture-head_walking_towardsRight_2 selectedMenuItem:texture-animated-head_walking_towardsRight absolute right-[50%]`}),p.jsx("span",{className:`${be} texture-heels_walking_towardsRight_2 selectedMenuItem:texture-animated-heels_walking_towardsRight absolute left-[50%]`})]})}),p.jsx(F,{id:"swopHead",label:p.jsx(j,{className:`inline-block w-6 ${le}`,children:"Swop to head"}),valueElement:p.jsx(ze,{action:"swop.head"}),onSelect:B(Be,"swop.head"),hint:p.jsx(me,{className:Ee,markdown:"Go *directly* to *Head*, avoiding cycling if in symbiosis"}),hintInline:!0,leader:p.jsx("span",{className:`${be} texture-head_walking_towardsRight_2 selectedMenuItem:texture-animated-head_walking_towardsRight`})}),p.jsx(F,{id:"swopHeels",label:p.jsxs("div",{className:`w-6 ${le}`,children:[p.jsx(j,{className:"me-1",children:"Swop to"}),p.jsx(j,{className:"text-pinkHalfbrite selectedMenuItem:text-pink",children:"heels"})]}),valueElement:p.jsx(ze,{action:"swop.heels"}),onSelect:B(Be,"swop.heels"),hint:p.jsx(me,{className:Ee,markdown:"Go *directly* to *Heels*, avoiding cycling if in symbiosis"}),hintInline:!0,leader:p.jsx("span",{className:`${be} texture-heels_walking_towardsRight_2 selectedMenuItem:texture-animated-heels_walking_towardsRight`})}),p.jsx("div",{className:"col-span-3",children:p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${le} pt-1  sprites-double-height`,children:"Stopping the Game"})}),p.jsx(F,{id:"map",label:"Map",valueElement:p.jsx(ze,{action:"map"}),onSelect:B(Be,"map"),leader:p.jsx("span",{className:`${be} texture-scroll`})}),p.jsx(F,{id:"hold",label:"Pause",valueElement:p.jsx(ze,{action:"hold"}),onSelect:B(Be,"hold"),leader:p.jsx("span",{className:`${be} texture-drum`})}),p.jsx(F,{id:"menu",label:"Menu",valueElement:p.jsx(ze,{action:"menu_openOrExit"}),onSelect:B(Be,"menu_openOrExit")}),p.jsxs("div",{className:"col-span-3",children:[p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${le} pt-1 sprites-double-height pb-1`,children:"Look controls"}),p.jsx(me,{markdown:"Look controls are useful for seeing more of larger rooms that dont fit on the screen.",className:Ee})]}),p.jsx(F,{id:"lookShift",label:"Look",valueElement:p.jsx(ze,{action:"lookShift"}),onSelect:B(Be,"lookShift"),hint:p.jsx(me,{className:Ee,markdown:"Hold the look key and press a direction to look around the room"}),hintInline:!0}),p.jsx(F,{id:"lookLeft",label:"Look ",valueElement:p.jsx(ze,{action:"lookLeft"}),onSelect:B(Be,"lookLeft")}),p.jsx(F,{id:"lookRight",label:"Look ",valueElement:p.jsx(ze,{action:"lookRight"}),onSelect:B(Be,"lookRight")}),p.jsx(F,{id:"lookUp",label:"Look ",valueElement:p.jsx(ze,{action:"lookUp"}),onSelect:B(Be,"lookUp")}),p.jsx(F,{id:"lookDown",label:"Look ",valueElement:p.jsx(ze,{action:"lookDown"}),onSelect:B(Be,"lookDown")}),p.jsx("div",{className:"col-span-3",children:p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${le} pt-1  sprites-double-height`,children:"Remake Option Toggles"})}),p.jsx(F,{id:"toggleColourisation",label:p.jsx(j,{className:`inline-block w-6 ${le}`,children:"Toggle colour- isation"}),valueElement:p.jsx(ze,{action:"toggleColourisation"}),onSelect:B(Be,"toggleColourisation"),leader:p.jsx("span",{className:`${be} texture-switch_left sprites-normal-height`})}),p.jsx(F,{id:"cycleRes",label:p.jsx(j,{className:`inline-block w-6 ${le}`,children:"Cycle res- olution"}),valueElement:p.jsx(ze,{action:"cycleResolution"}),onSelect:B(Be,"cycleResolution"),leader:p.jsx("span",{className:`${be} texture-switch_left sprites-normal-height`})}),p.jsx(F,{id:"toggleCrt",label:p.jsx(j,{className:`inline-block w-6 ${le}`,children:"Toggle CRT effect"}),valueElement:p.jsx(ze,{action:"toggleCrtFilter"}),onSelect:B(Be,"toggleCrtFilter"),leader:p.jsx("span",{className:`${be} texture-switch_left sprites-normal-height`})})]})},VB=()=>{const t=!Pw();Se({action:"menu_openOrExit",handler:v.useCallback(()=>{ce.dispatch(iM())},[]),disabled:t}),ej({handler:v.useCallback((e,r)=>{r.currentActionPress("menu_openOrExit")==="released"&&Ew(ce.getState())&&ce.dispatch(oM(e))},[]),disabled:t})},qB=({showAll:t})=>p.jsxs("div",{className:"text-metallicBlueHalfbrite zx:text-zxBlue",children:[p.jsx(j,{className:`block mb-1 ${le}`,children:"Detected that you are on a phone or tablet"}),p.jsx(j,{className:`block mb-1 ${le}`,children:"Additional settings for keys and gamepad buttons are designed for desktop/laptops, but you can use them on phones/tablets if you have a keyboard or gamepad connected"}),p.jsx(eB,{className:`block w-full mb-2 text-white p-1 bg-midRed zx:text-zxRed ${le}`,onClick:t,children:p.jsx(j,{children:"Tap here to show all settings"})})]}),By=" !gap-y-1 ",vB=()=>{VB();const[t,e]=v.useState(!Ua()),r=Mw();return p.jsxs(Le,{children:[p.jsx(bt,{className:"bg-lightGrey zx:bg-zxRedDimmed",onClick:B(xt)}),p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"controlOptions",children:[p.jsx(Ar,{path:["Options","Controls"],className:Zn}),p.jsxs("div",{className:Jn,children:[p.jsxs(Re,{className:`${By} w-full`,children:[p.jsx(iB,{}),r!=="4-way"&&t&&p.jsx(fB,{}),p.jsx(oB,{}),t&&p.jsxs(p.Fragment,{children:[p.jsx(cB,{}),p.jsx(j,{TagName:"h1",className:"text-midRed zx:text-zxBlue sprites-double-height mt-1 block col-span-3 text-center sprites-uppercase",children:"Select the Keys"})]})]}),t?p.jsx(p.Fragment,{children:p.jsx(Re,{className:`${By} !sprites-normal-height`,children:p.jsx(wB,{})})}):p.jsx(p.Fragment,{children:p.jsx(qB,{showAll:()=>e(!0)})})]}),p.jsx(xB,{})]})]})},_B="/assets/rock-C4e7VvX5.mp3",No=({customLabel:t})=>p.jsx(F,{id:"back",label:t||"Back",flipLeader:!0,doubleHeightWhenFocussed:!0,onSelect:B(xt),toParentMenu:!0}),zy={egyptus:["text-lightBeige","text-midRed","text-highlightBeige"],blacktooth:["text-midGrey","text-lightGrey","text-moss","text-midRed"],safari:["text-moss","text-midRed","text-highlightBeige"],bookworld:["text-midRed","text-redShadow","text-midGrey"],penitentiary:["text-shadow","text-metallicBlue","text-midGrey"]},SB={egyptus:te("texture-crown_egyptus"),blacktooth:te("texture-crown_blacktooth"),bookworld:te("texture-crown_bookworld"),penitentiary:te("texture-crown_penitentiary"),safari:te("texture-crown_safari")},xi=({planet:t,className:e,label:r=t})=>{const s=X(i=>i.gameMenus.gameInPlay.planetsLiberated[t]),n=lf();return p.jsxs("div",{className:`flex flex-col ${e}`,children:[p.jsx("span",{className:`sprite block mx-auto
          ${n?"texture-crown_uncolourised sprite-tinted":SB[t]} 
          ${s?"zx:text-zxYellow":"colourised:brightness-halfBrite zx:text-zxMagentaDimmed"}
          `}),p.jsx("span",{className:`sprite block 
          ${n?"texture-ball_uncolourised":"texture-ball"} 
          zx:sprite-tinted mx-auto 
          ${s?"zx:text-zxWhite":"zx:text-zxYellowDimmed colourised:brightness-halfBrite"} 
          ${zy[t][0]}
          `}),p.jsx(j,{classnameCycle:n?void 0:zy[t],className:`block mx-auto ${s?"zx:text-zxMagenta":"zx:text-zxMagentaDimmed colourised:brightness-halfBrite"}`,children:r})]})},kB=()=>p.jsxs(p.Fragment,{children:[p.jsx(j,{className:"block sprites-double-height text-highlightBeige zx:text-zxYellow mx-auto w-max",children:"The Blacktooth Empire"}),p.jsxs("div",{className:"mx-auto relative w-0 h-1",children:[p.jsx(xi,{planet:"egyptus",label:"Egyptus",className:"w-12 absolute left-m10 top-1 resHandheld:left-m8 resHandheld:top-m1 translate-x-[-50%]"}),p.jsx(xi,{planet:"penitentiary",label:"Penitentiary",className:"w-12 absolute left-10 top-1 resHandheld:left-8 resHandheld:top-m1 translate-x-[-50%]"}),p.jsx(xi,{planet:"safari",label:"Safari",className:"w-12 left-m10 top-14 absolute resHandheld:left-m8 resHandheld:top-8 translate-x-[-50%]"}),p.jsx(xi,{planet:"bookworld",label:"Book World",className:"w-12 absolute left-10 top-14 resHandheld:left-7 resHandheld:top-8 translate-x-[-50%]"}),p.jsx(xi,{planet:"blacktooth",label:"Blacktooth",className:"w-12 absolute left-0 top-8 resHandheld:left-0 ml-[-50%] resHandheld:top-3 translate-x-[-50%]"})]})]}),CB=({playMusic:t=!1})=>{const e=Fj(),r=B(xt);return p.jsxs(Le,{children:[p.jsx(bt,{className:"bg-pureBlack zx:bg-zxBlack"}),p.jsxs(ke,{className:"bg-pureBlack w-zx h-full block p-0",onClick:e?void 0:r,dialogId:"crowns",children:[t&&p.jsx("audio",{src:_B,autoPlay:!0,loop:!0}),p.jsx(kB,{}),e&&p.jsx("div",{children:p.jsx(j,{className:"animate-flash text-center sprites-double-height block text-midRed zx:text-zxRed bg-white top-4",children:"LOADING"})}),!e&&p.jsx(Re,{className:"hidden",children:p.jsx(No,{})})]})]})},oc=t=>p.jsx("div",{className:`col-span-3 h-1 ${t}`}),EB=`![](texture-animated-head_walking_towards?float-right&mt-1)**Off**: Original *two-tone* spectrum graphics

**On**: *16-colour* palette with colourised sprites`,PB=`Here for the nostalgia?

Make your fancy new screen look like its 1987 again.`,TB=()=>p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"displayOptions",children:[p.jsx(Ar,{path:["Options","Display"],className:Zn}),p.jsx("div",{className:Jn,children:p.jsxs(Re,{children:[p.jsx(F,{hintInline:!0,className:"sprites-double-height",id:"colourise",label:"Colourise",valueElement:p.jsx(Yr,{className:"ml-auto",value:!lf()}),onSelect:B(rr,{path:"displaySettings.uncolourised"}),hint:p.jsx(me,{className:Ee,markdown:EB}),verticalAlignItemsCentre:!0}),p.jsx(F,{hintInline:!0,className:"sprites-double-height",id:"crtFilter",verticalAlignItemsCentre:!0,label:p.jsxs("span",{className:"align-top",children:[p.jsxs("span",{className:"bg-shadow zx:bg-pureBlack inline-block",children:[p.jsx(j,{className:"text-midRed zx:text-zxRed",children:"C"}),p.jsx(j,{className:"text-moss zx:text-zxGreen",children:"R"}),p.jsx(j,{className:"text-pastelBlue zx:text-zxBlue",children:"T"})]}),p.jsx(j,{children:" TV Effect"})]}),valueElement:p.jsx(Yr,{className:"ml-auto",value:X(FR)}),onSelect:B(rr,{path:"displaySettings.crtFilter"}),hint:p.jsx(me,{className:Ee,markdown:PB})}),p.jsx(F,{hintInline:!0,className:"sprites-double-height",id:"emulatedResolution",label:"Emulated Resolution",onSelect:B(ut,"emulatedResolution"),opensSubMenu:!0,verticalAlignItemsCentre:!0,hint:p.jsx(me,{className:Ee,markdown:"See more of the room by choosing a higher resolution to emulate."})}),p.jsx(F,{hintInline:!0,className:"sprites-double-height",verticalAlignItemsCentre:!0,id:"showFps",label:"Show FPS",valueElement:p.jsx(Yr,{className:"ml-auto",value:X(zR)}),onSelect:B(rr,{path:"showFps"}),hint:p.jsx(me,{className:Ee,markdown:"Frames per second shown during gameplay."})}),p.jsx(oc,{})]})})]}),RB=({resolutionName:t})=>{const e=X(Ql),r=Wn[t];return p.jsx(F,{id:t,label:`${e===t?"* ":""}${r.name}`,doubleHeightWhenFocussed:!0,hintInline:!0,hint:p.jsxs(j,{className:Ee,children:[r.size.x," x ",r.size.y]}),onSelect:B(mf,t)},t)},MB=()=>p.jsx(Le,{children:p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"emulatedResolution",children:[p.jsx(Ar,{path:["Options","Display","Res."],className:Zn}),p.jsx("div",{className:Jn,children:p.jsx(Re,{children:zx(Wn).map(t=>p.jsx(RB,{resolutionName:t},t))})})]})}),IB="/Users/jim/dev/hohjs",jB=({children:t})=>{const e=/https?:\/\/[^\s)>\]}]+/gi,r=t.split(e),s=[...t.matchAll(e)],n=[];return r.forEach((i,o)=>{n.push(i);const a=s[o];if(a)try{const[l]=a,c=new URL(l);if(c.pathname.startsWith("/node_modules/.vite/deps/")){n.push(l);return}const u=`${IB}${c.pathname}`,h=l.match(/:(\d+):(\d+)$/),d=h?`:${h[1]}:${h[2]}`:"",f=`vscode://file${u}${d}`;n.push(p.jsx("a",{href:f,target:"_blank",children:c.pathname},o))}catch{n.push(a[0])}}),p.jsx(v.Fragment,{children:n})},OB=t=>{const{message:e,stack:r}=t;if(!r)return{message:e,sanitizedStack:""};const s=/^(?:[A-Z]\w*)?Error:\s*/,n=s.test(r);let i=r;n&&(i=i.replace(s,"")),i.startsWith(e)&&(i=i.slice(e.length),i=i.replace(/^\n/,""));const o=i.indexOf(`
`);if(o!==-1){const a=i.slice(0,o);(a===e||a===`Error: ${e}`)&&(i=i.slice(o+1))}return i=i.split(`
`).map(a=>a.trim()).filter(a=>a.length>0).join(`
`),{message:e,sanitizedStack:i}},NB=`##The game crashed!
You could:

* Open an [issue on Github](https://github.com/jimhigson/head-over-heels-online/issues)
* Email [jim@blockstack.ing](mailto:jim@blockstack.ing)
* Rant on the [Discord server](https://discord.gg/XmV9QNWY)
* Play [the MSX remake](https://www.file-hunter.com/Homebrew/?id=headoverheels) instead`,BB=t=>t.toReversed().map(e=>{const{message:r,sanitizedStack:s}=OB(e);return`
${r}

${s}
  `}).join(`
    

 ERROR        CAUGHT, WRAPPED, & RETHROWN 


`),zB=({errors:t})=>{const e=X(o=>o.gameMenus.gameInPlay.reincarnationPoint!==void 0),[r,s]=v.useState(!1),n=B(pf),i=BB(t);return v.useEffect(()=>{console.error("ErrorCaughtDialog: Showing Report:",i)},[i]),p.jsxs(Le,{children:[p.jsx(bt,{className:"loading-border"}),p.jsx(ke,{className:"bg-white zx:bg-zxRed gap-y-0 text-redShadow zx:text-zxBlack px-1",tall:!0,wide:!0,dialogId:"errorCaught",children:p.jsxs("div",{className:"overflow-y-scroll h-full scrollbar scrollbar-w-1 pl-1 scrollbar-thumb-midRed scrollbar-track-highlightBeige zx:scrollbar-thumb-zxCyanDimmed zx:scrollbar-track-zxCyan",children:[p.jsx(me,{markdown:NB}),p.jsx("hr",{className:"bg-pastelBlue zx:bg-zxWhite h-1 my-1 border-none"}),p.jsxs(Re,{className:`text-lightGrey zx:text-zxWhite mt-1 resHandheld:mt-0 selectedMenuItem:text-midRed zx:selectedMenuItem:text-zxYellow resHandheld:!gap-y-1 ${le}`,children:[p.jsx(F,{doubleHeightWhenFocussed:!0,id:"tryContinue",label:"Ignore, hope it goes away",onSelect:B(ey,"ignore")}),e&&p.jsx(F,{doubleHeightWhenFocussed:!0,id:"reincarnate",label:"Try reincarnating",onSelect:n}),p.jsx(F,{doubleHeightWhenFocussed:!0,id:"clearAllData",label:"Clear all data, reboot game",onSelect:B(ey,"clearAllData")}),r?p.jsx(j,{className:"text-metallicBlue col-span-2 sprites-double-height ml-3",children:"Error report copied"}):p.jsx(F,{doubleHeightWhenFocussed:!0,id:"copyClipboard",label:"Copy error to clipboard",onSelect:()=>navigator.clipboard.writeText(i).then(()=>s(!0))})]}),p.jsx("hr",{className:"bg-pastelBlue zx:bg-zxWhite h-1 my-1 border-none"}),p.jsx(j,{className:"block sprites-double-height my-1 text-midRed zx:text-zxWhite",children:"Error message for nerds:"}),p.jsx("pre",{className:"bg-shadow zx:bg-zxBlack text-white zx:text-zxWhite leading-[1em] [&_a]:text-pastelBlue px-1 w-max min-w-full",children:p.jsx(jB,{children:i})})]})})]})},DB=()=>p.jsx(Le,{children:p.jsxs(ke,{className:"!h-min !w-max text-center text-zxCyan p-0 bg-transparent",onClick:B(xt),dialogId:"hold",children:[p.jsx(j,{className:"block w-min mx-auto px-1 sprites-double-height bg-zxBlack py-oneScaledPix sprites-uppercase",children:"PAUSED"}),p.jsx("span",{className:"zx",children:At()==="desktop"?p.jsxs("div",{className:"flex flex-col gap-1",children:[p.jsxs("div",{className:`${le} px-1 bg-zxBlack py-oneScaledPix`,children:[p.jsxs(rt,{children:["Press to ",p.jsx("span",{className:"text-zxWhite",children:"continue"}),":"]}),p.jsx("div",{className:"flex flex-row gap-1 mx-auto",children:p.jsx(_l,{className:"flex flex-row gap-1",keyClassName:"text-pink zx:text-zxRed",action:"hold"})})]}),p.jsxs("div",{className:`${le} px-1 bg-zxBlack py-oneScaledPix`,children:[p.jsxs(rt,{children:["Press for ",p.jsx("span",{className:"text-zxWhite",children:"Map"}),":"]}),p.jsx("div",{className:"flex flex-row gap-1 mx-auto",children:p.jsx(_l,{className:"flex flex-row gap-1",keyClassName:"text-pink zx:text-zxRed",action:"map"})})]})]}):p.jsxs("div",{className:`${le} px-1 bg-zxBlack py-oneScaledPix`,children:[p.jsx(j,{className:"me-1 text-pink zx:text-zxRed",children:"Tap screen"}),p.jsx(j,{children:"to continue"})]})})]})}),LB=({presetName:t})=>{const{description:e}=qn[t];return p.jsx(F,{hintInline:!0,id:t,label:t,doubleHeightWhenFocussed:!0,hint:e&&p.jsx(j,{className:Ee,children:e}),onSelect:B(aM,t)},t)},FB=()=>p.jsx(Le,{children:p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"inputPreset",children:[p.jsx(Ar,{path:["Options","Controls","Presets"],className:Zn}),p.jsx("div",{className:Jn,children:p.jsx(Re,{children:zx(qn).map(t=>p.jsx(LB,{presetName:t},t))})})]})}),UB="1.16.3",Dy="https://github.com/jimhigson/head-over-heels-online/",$B=()=>p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"flex absolute top-oneScaledPix right-1 z-dialog",children:p.jsxs("a",{href:Dy,className:"bitmap-text-link bg-transparent zx:bg-zxBlack",children:[p.jsx(j,{className:"text-highlightBeige zx:text-zxYellow",children:""}),p.jsxs("span",{className:"text-lightGrey zx:text-whiteHalfbrite",children:[p.jsx(j,{className:"resHandheld:hidden",children:" on"}),p.jsx(j,{children:Fw}),p.jsx(j,{className:"resHandheld:hidden",children:"Github"})]})]})}),p.jsx("footer",{className:"flex absolute bottom-0 right-0 z-dialog","data-screenshot-mask":!0,children:p.jsx("a",{href:`${Dy}releases`,target:"_blank",className:"bitmap-text-link bg-pastelBlueHalfbrite text-metallicBlueHalfbrite zx:bg-zxBlack",children:p.jsx(j,{children:`v${UB} `})})})]}),fr=["text-midRed zx:text-zxCyan","text-highlightBeige zx:text-zxYellow","text-moss zx:text-zxWhite"],HB=({className:t})=>p.jsxs("footer",{className:`flex justify-center gap-2 resHandheld:gap-1 leading-none ${t??""}`,children:[p.jsxs("div",{className:"flex flex-col items-center",children:[p.jsx(j,{className:"text-pastelBlue zx:text-zxBlack relative left-oneScaledPix",children:"1987 Original"}),p.jsxs("div",{className:"flex gap-1",children:[p.jsxs("address",{className:"flex flex-col items-center relative bottom-oneScaledPix",children:[p.jsx(j,{className:"relative left-[calc(6.5px*var(--scale))]",classnameCycle:fr,children:"Jon"}),p.jsx(j,{className:"relative bottom-[calc(3px*var(--scale))]",classnameCycle:fr,children:"Ritman"})]}),p.jsxs("address",{className:"flex flex-col items-center relative bottom-oneScaledPix",children:[p.jsx(j,{classnameCycle:fr,children:"Bernie"}),p.jsx(j,{className:"relative bottom-[calc(3px*var(--scale))]",classnameCycle:fr,children:"Drummand"})]})]})]}),p.jsxs("div",{className:"flex flex-col items-center",children:[p.jsx(j,{className:"text-pink zx:text-zxBlack",children:"2025 Remake"}),p.jsx("address",{className:"flex relative left-[calc(0.5px*var(--scale))] bottom-oneScaledPix",children:p.jsxs("div",{className:"flex flex-col items-center",children:[p.jsx(j,{className:"relative left-[calc(1.5px*var(--scale))]",classnameCycle:fr,children:"Jim"}),p.jsx(j,{className:"relative bottom-[calc(3px*var(--scale))]",classnameCycle:fr,children:"Higson"})]})})]})]}),Tn=({facingXy8:t,character:e,action:r})=>{switch(e){case"head":{switch(r){case"walking":switch(t){case"away":return te("texture-animated-head_walking_away");case"towards":return te("texture-animated-head_walking_towards");case"left":return te("texture-animated-head_walking_left");case"right":return te("texture-animated-head_walking_right");case"awayRight":return te("texture-animated-head_walking_awayRight");case"towardsRight":return te("texture-animated-head_walking_towardsRight");case"towardsLeft":return te("texture-animated-head_walking_towardsLeft");case"awayLeft":return te("texture-animated-head_walking_awayLeft");default:throw new Error(`Invalid facingXy8: ${t}`)}case"idle":switch(t){case"towards":return te("texture-animated-head_idle_towards");case"right":return te("texture-animated-head_idle_right");case"awayRight":return te("texture-animated-head_idle_awayRight");case"towardsRight":return te("texture-animated-head_idle_towardsRight");case"towardsLeft":return te("texture-animated-head_idle_towardsLeft");case"away":return te("texture-head_walking_away_2");case"left":return te("texture-head_walking_left_2");case"awayLeft":return te("texture-head_walking_awayLeft_2");default:throw new Error(`Invalid facingXy8: ${t}`)}}break}case"heels":{switch(r){case"walking":switch(t){case"away":return te("texture-animated-heels_walking_away");case"towards":return te("texture-animated-heels_walking_towards");case"left":return te("texture-animated-heels_walking_left");case"right":return te("texture-animated-heels_walking_right");case"awayRight":return te("texture-animated-heels_walking_awayRight");case"towardsRight":return te("texture-animated-heels_walking_towardsRight");case"towardsLeft":return te("texture-animated-heels_walking_towardsLeft");case"awayLeft":return te("texture-animated-heels_walking_awayLeft");default:throw new Error(`Invalid facingXy8: ${t}`)}case"idle":switch(t){case"towards":return te("texture-animated-heels_idle_towards");case"right":return te("texture-animated-heels_idle_right");case"awayRight":return te("texture-heels_walking_awayRight_2");case"towardsRight":return te("texture-animated-heels_idle_towardsRight");case"towardsLeft":return te("texture-heels_walking_towardsLeft_2");case"away":return te("texture-heels_walking_away_2");case"left":return te("texture-heels_walking_left_2");case"awayLeft":return te("texture-heels_walking_awayLeft_2");default:throw new Error(`Invalid facingXy8: ${t}`)}}break}}},GB=(t,e,r)=>{const s=t.getBoundingClientRect(),n=s.left+s.width/2,i=s.top+s.height/2,o=n-e,a=i-r,c=RI({x:o,y:a});return Od(c)},Ly=({character:t,defaultFacing:e,className:r=""})=>{const[s,n]=v.useState(e),[i,o]=v.useState(!1),a=v.useRef(null);v.useEffect(()=>{const d=m=>{a.current&&n(GB(a.current,m.clientX,m.clientY)||"right")},f=()=>{n(e),o(!1)};return window.addEventListener("mousemove",d),document.addEventListener("mouseleave",f),()=>{window.removeEventListener("mousemove",d),document.removeEventListener("mouseleave",f)}},[e,t]);const l=()=>{o(!0)},c=()=>{o(!1)},h=Tn({character:t,facingXy8:s,action:i?"walking":"idle"});return p.jsxs("div",{ref:a,className:`relative ${r}`,onMouseEnter:l,onMouseLeave:c,children:[p.jsx("span",{className:`sprite zx:sprite-revert-to-white ${h} relative z-topSprite`}),p.jsx("span",{className:"sprite zx:hidden texture-shadow_playable sprite-shadow absolute left-0 opacity-halfBrite"})]})},GV=({noSubtitle:t,className:e})=>p.jsxs("div",{className:`flex flex-col items-center ${e}`,children:[p.jsxs("h1",{className:"flex",children:[p.jsxs("div",{className:"flex flex-col resHandheld:flex-row resHandheld:gap-1 gap-y-oneScaledPix items-center me-1 sprites-uppercase",children:[p.jsx(j,{className:"sprites-double-height text-pastelBlue zx:text-zxYellow resHandheld:mt-1",children:"Head"}),p.jsx(Ly,{character:"head",defaultFacing:"right",className:"mt-1 resHandheld:mt-0"})]}),p.jsx(j,{classnameCycle:fr,className:"mt-1 me-1 resHandheld:mt-2",children:"over"}),p.jsxs("div",{className:"flex flex-col resHandheld:flex-row-reverse resHandheld:gap-1 items-center sprites-uppercase",children:[p.jsx(j,{className:"sprites-double-height text-pink zx:text-zxYellow resHandheld:mt-1",children:"Heels"}),p.jsx(Ly,{character:"heels",defaultFacing:"towards",className:"mt-1 resHandheld:mt-0"})]})]}),t||p.jsxs("h2",{className:"mt-1 w-max resHandheld:hidden",children:[p.jsx(j,{className:"text-midRed zx:text-zxCyan",children:"block"}),p.jsx(j,{className:"text-highlightBeige zx:text-zxYellow",children:"stack"}),p.jsx(j,{className:"text-metallicBlue zx:text-zxBlack",children:"."}),p.jsx(j,{className:"text-moss zx:text-zxWhite",children:"ing"}),p.jsx(j,{classnameCycle:fr,children:" remake"})]})]}),WB=()=>{const t=kn(),e=B(rM),r=B(ut,"whichGame");return t?p.jsx(F,{id:"playGame",label:p.jsx(j,{children:"Resume the game"}),doubleHeightWhenFocussed:!0,onSelect:e}):p.jsx(F,{id:"playGame",label:p.jsx(j,{children:"Play the game"}),doubleHeightWhenFocussed:!0,onSelect:r,opensSubMenu:!0})},KB=()=>p.jsx(F,{id:"installGuide",label:"Install",doubleHeightWhenFocussed:!0,onSelect:B(ut,"markdown/installGuide"),opensSubMenu:!0}),YB=()=>p.jsx(F,{id:"levelEditor",label:"Level Editor",doubleHeightWhenFocussed:!0,onSelect:B(ut,"sureWantEditor"),opensSubMenu:!0}),QB=()=>{const t=kn(),e=X(r=>r.gameMenus.gameInPlay.reincarnationPoint!==void 0);return p.jsx(F,{id:"quitGame",label:e?"quit / reincarnate":"quit the game",className:"text-midRed zx:text-zxYellow",onSelect:B(ut,"quitGameConfirm"),doubleHeightWhenFocussed:!0,hidden:!t,opensSubMenu:!0})},Fy="https://discord.gg/Se5Jznc2jm",XB=t=>{Cw({publishedOnly:!0});const e=kn(),r=B(ut,"crowns"),s=B(ut,"score"),n=v.useCallback(()=>{r(),s()},[r,s]),i=Z1();return p.jsxs(Le,{children:[p.jsx(bt,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed"}),p.jsxs(ke,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed gap-y-2 resHandheld:gap-y-1 justify-center",dialogId:"mainMenu",children:[p.jsx(GV,{noSubtitle:e,className:e?"resHandheld:hidden":""}),p.jsxs("div",{className:"text-highlightBeige zx:text-zxCyan selectedMenuItem:text-white resHandheld:mt-half flex flex-col gap-1 sprites-uppercase",children:[p.jsxs(Re,{className:"w-24 mx-auto",children:[p.jsx(WB,{}),!e&&At()==="desktop"&&p.jsx(YB,{}),p.jsx(F,{id:"map",label:"use the Map",onSelect:B(ut,"map"),doubleHeightWhenFocussed:!0,hidden:!e,opensSubMenu:!0}),p.jsx(F,{id:"viewCrowns",label:"Progress so far",onSelect:n,doubleHeightWhenFocussed:!0,hidden:!e,opensSubMenu:!0})]}),p.jsxs("div",{className:"flex flex-row justify-between gap-2 w-24 mx-auto",children:[p.jsxs(Re,{children:[p.jsx(F,{id:"options",label:"Options",doubleHeightWhenFocussed:!0,onSelect:B(ut,"modernisationOptions"),opensSubMenu:!0}),p.jsx(F,{id:"readTheManual",label:"Manual",doubleHeightWhenFocussed:!0,onSelect:B(ut,"readTheManual"),opensSubMenu:!0})]}),p.jsxs(Re,{children:[i?null:p.jsx(KB,{}),p.jsx(F,{id:"discord",leader:p.jsx(j,{children:Lw}),label:p.jsx("a",{href:Fy,target:"_blank",children:p.jsx(j,{children:"Discord"})}),doubleHeightWhenFocussed:!0,onSelect:v.useCallback(()=>{window.open(Fy,"_blank")},[])}),i?p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"h-1"}),p.jsx("div",{className:"h-1"}),p.jsx("div",{className:"h-1"})]}):null]})]}),e&&p.jsx(Re,{className:"w-24 mx-auto",children:p.jsx(QB,{})})]}),!e&&p.jsx(HB,{className:"resHandheld:mt-1"})]}),p.jsx($B,{})]})};var ku,Uy;function Nf(){if(Uy)return ku;Uy=1;function t(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return ku=t,ku}var Cu,$y;function JB(){if($y)return Cu;$y=1;var t=typeof Bo=="object"&&Bo&&Bo.Object===Object&&Bo;return Cu=t,Cu}var Eu,Hy;function WV(){if(Hy)return Eu;Hy=1;var t=JB(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=t||e||Function("return this")();return Eu=r,Eu}var Pu,Gy;function ZB(){if(Gy)return Pu;Gy=1;var t=WV(),e=function(){return t.Date.now()};return Pu=e,Pu}var Tu,Wy;function ez(){if(Wy)return Tu;Wy=1;var t=/\s/;function e(r){for(var s=r.length;s--&&t.test(r.charAt(s)););return s}return Tu=e,Tu}var Ru,Ky;function tz(){if(Ky)return Ru;Ky=1;var t=ez(),e=/^\s+/;function r(s){return s&&s.slice(0,t(s)+1).replace(e,"")}return Ru=r,Ru}var Mu,Yy;function KV(){if(Yy)return Mu;Yy=1;var t=WV(),e=t.Symbol;return Mu=e,Mu}var Iu,Qy;function rz(){if(Qy)return Iu;Qy=1;var t=KV(),e=Object.prototype,r=e.hasOwnProperty,s=e.toString,n=t?t.toStringTag:void 0;function i(o){var a=r.call(o,n),l=o[n];try{o[n]=void 0;var c=!0}catch{}var u=s.call(o);return c&&(a?o[n]=l:delete o[n]),u}return Iu=i,Iu}var ju,Xy;function sz(){if(Xy)return ju;Xy=1;var t=Object.prototype,e=t.toString;function r(s){return e.call(s)}return ju=r,ju}var Ou,Jy;function nz(){if(Jy)return Ou;Jy=1;var t=KV(),e=rz(),r=sz(),s="[object Null]",n="[object Undefined]",i=t?t.toStringTag:void 0;function o(a){return a==null?a===void 0?n:s:i&&i in Object(a)?e(a):r(a)}return Ou=o,Ou}var Nu,Zy;function iz(){if(Zy)return Nu;Zy=1;function t(e){return e!=null&&typeof e=="object"}return Nu=t,Nu}var Bu,eA;function oz(){if(eA)return Bu;eA=1;var t=nz(),e=iz(),r="[object Symbol]";function s(n){return typeof n=="symbol"||e(n)&&t(n)==r}return Bu=s,Bu}var zu,tA;function az(){if(tA)return zu;tA=1;var t=tz(),e=Nf(),r=oz(),s=NaN,n=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt;function l(c){if(typeof c=="number")return c;if(r(c))return s;if(e(c)){var u=typeof c.valueOf=="function"?c.valueOf():c;c=e(u)?u+"":u}if(typeof c!="string")return c===0?c:+c;c=t(c);var h=i.test(c);return h||o.test(c)?a(c.slice(2),h?2:8):n.test(c)?s:+c}return zu=l,zu}var Du,rA;function YV(){if(rA)return Du;rA=1;var t=Nf(),e=ZB(),r=az(),s="Expected a function",n=Math.max,i=Math.min;function o(a,l,c){var u,h,d,f,m,y,g=0,A=!1,b=!1,x=!0;if(typeof a!="function")throw new TypeError(s);l=r(l)||0,t(c)&&(A=!!c.leading,b="maxWait"in c,d=b?n(r(c.maxWait)||0,l):d,x="trailing"in c?!!c.trailing:x);function w(R){var I=u,z=h;return u=h=void 0,g=R,f=a.apply(z,I),f}function q(R){return g=R,m=setTimeout(S,l),A?w(R):f}function _(R){var I=R-y,z=R-g,P=l-I;return b?i(P,d-z):P}function V(R){var I=R-y,z=R-g;return y===void 0||I>=l||I<0||b&&z>=d}function S(){var R=e();if(V(R))return k(R);m=setTimeout(S,_(R))}function k(R){return m=void 0,x&&u?w(R):(u=h=void 0,f)}function C(){m!==void 0&&clearTimeout(m),g=0,u=y=h=m=void 0}function E(){return m===void 0?f:k(e())}function T(){var R=e(),I=V(R);if(u=arguments,h=this,y=R,I){if(m===void 0)return q(y);if(b)return clearTimeout(m),m=setTimeout(S,l),w(y)}return m===void 0&&(m=setTimeout(S,l)),f}return T.cancel=C,T.flush=E,T}return Du=o,Du}var lz=YV();const cz=nt(lz);var Lu,sA;function uz(){if(sA)return Lu;sA=1;var t=YV(),e=Nf(),r="Expected a function";function s(n,i,o){var a=!0,l=!0;if(typeof n!="function")throw new TypeError(r);return e(o)&&(a="leading"in o?!!o.leading:a,l="trailing"in o?!!o.trailing:l),t(n,i,{leading:a,maxWait:i,trailing:l})}return Lu=s,Lu}var hz=uz();const dz=nt(hz),fz=(t,e,r,s)=>{switch(e){case"debounce":return cz(t,r,s);case"throttle":return dz(t,r,s);default:return t}},pz=t=>{const e=v.useRef(t);return v.useEffect(()=>{e.current=t}),v.useMemo(()=>((...r)=>{var s;return(s=e.current)===null||s===void 0?void 0:s.call(e,...r)}),[])},mz=t=>{const[e,r]=v.useState(t?.current||null);return t&&setTimeout(()=>{t.current!==e&&r(t.current)},0),{refProxy:v.useMemo(()=>new Proxy(n=>{n!==e&&r(n)},{get(n,i){return i==="current"?e:n[i]},set(n,i,o){return i==="current"?r(o):n[i]=o,!0}}),[e]),refElement:e,setRefElement:r}},gz=(t,e)=>e==="border-box"?{width:t.borderBoxSize[0].inlineSize,height:t.borderBoxSize[0].blockSize}:e==="content-box"?{width:t.contentBoxSize[0].inlineSize,height:t.contentBoxSize[0].blockSize}:{width:t.contentRect.width,height:t.contentRect.height};function yz({skipOnMount:t=!1,refreshMode:e,refreshRate:r=1e3,refreshOptions:s,handleWidth:n=!0,handleHeight:i=!0,targetRef:o,observerOptions:a,onResize:l}={}){const c=v.useRef(t),u=pz(l),[h,d]=v.useState({width:void 0,height:void 0}),{refProxy:f,refElement:m}=mz(o),{box:y}=a||{},g=v.useCallback(b=>{if(!n&&!i)return;if(c.current){c.current=!1;return}const x=(w,q)=>n&&w.width!==q.width||i&&w.height!==q.height;b.forEach(w=>{const q=gz(w,y);d(_=>x(_,q)?(u?.({width:q.width,height:q.height,entry:w}),q):_)})},[n,i,c,y]),A=v.useCallback(fz(g,e,r,s),[g,e,r,s]);return v.useEffect(()=>{let b;return m?(b=new window.ResizeObserver(A),b.observe(m,a)):(h.width||h.height)&&(u?.({width:null,height:null,entry:null}),d({width:void 0,height:void 0})),()=>{var x,w,q;(x=b?.disconnect)===null||x===void 0||x.call(b),(q=(w=A).cancel)===null||q===void 0||q.call(w)}},[A,m]),Object.assign({ref:f},h)}const Me=(...t)=>{if(t.length===1){const[e]=t;return r=>r.type===e}return e=>t.includes(e.type)},Az=Me("bubbles","stopAutowalk","firedDoughnut","floatingText","emitter","particle"),xz=(t,e)=>Az(t)||qs(t)&&(e!==void 0&&Sl(e)||t.config.direction.z!==0)||tq(t)&&t.config.floorType==="none",Qr=(t,e)=>!xz(t,e),bz=t=>t.type==="movingPlatform"||t.type==="pushableBlock",Bf=(t,e,r=!1)=>Ts(e)&&!(!r&&Sl(e)&&e.state.autoWalk)&&!(eq(t)&&bz(e))&&!(zf(e)&&e.config.which==="cyberman"&&e.state.everActivated===!1),QV=["ball","slidingBlock","slidingDeadly"],wz=Me(...QV),Vz=["portableBlock","spring","sceneryPlayer","sceneryCrown","monster","slidingBlock"],qz=["dalek","turtle","elephantHead","homingBot","helicopterBug"],q$=t=>t.type==="slidingBlock"?t.config.style==="puck":t.type==="monster"?qz.includes(t.config.which):Vz.includes(t.type),Sl=t=>t.type==="head"||t.type==="heels"||t.type==="headOverHeels";function Ts(t){return XV.includes(t.type)}const XV=[...Oj,"monster","ball","charles","pushableBlock","movingPlatform","moveableDeadly","pickup","portableBlock","slidingBlock","slidingDeadly","spring","sceneryPlayer","sceneryCrown"],vz=["monster","deadlyBlock","moveableDeadly","slidingDeadly"],_z=Me(...vz),nA=t=>zf(t)&&!t.state.activated?!1:_z(t)||t.type==="floor"&&t.config.floorType==="deadly",Sz=t=>t.config.times!==void 0,qs=Me("portal"),v$=Me("teleporter"),JV=Me("heels"),ZV=Me("head"),kl=Me("headOverHeels"),_$=Me("heels","headOverHeels"),S$=Me("head","headOverHeels"),eq=Me("lift"),k$=Me("button"),C$=Me("emitter"),zf=Me("monster"),tq=Me("floor"),kz=Me("pickup"),E$=t=>t.type==="button"||t.type==="switch"&&t.config.type==="in-room",P$=t=>kz(t)&&t.config.gives==="crown",T$=Me("spring"),Cz=Me("joystick"),R$=Me("conveyor"),Ez=Me("hushPuppy"),M$=Me("firedDoughnut"),I$=Me("wall","doorFrame"),j$=Me("monster","movingPlatform"),O$=t=>zf(t)&&t.config.which==="cyberman"&&t.state.everActivated===!1,Or=(t,e)=>t.characterRooms[e]?.items[e],N$=t=>Or(t,t.currentCharacterName),B$=t=>{if(ZV(t))return t.state;if(kl(t))return t.state.head},Pz=t=>{if(JV(t))return t.state;if(kl(t))return t.state.heels},Tz=(t,e)=>{const r=Or(t,t.currentCharacterName==="headOverHeels"?"headOverHeels":e);if(r!==void 0){if(e==="head"&&ZV(r)||e==="heels"&&JV(r))return r.state;if(e==="head"&&kl(r))return r.state.head;if(e==="heels"&&kl(r))return r.state.heels}},z$=Tz,Rz=t=>{const e=Or(t,"head"),r=Or(t,"heels");return e!==void 0&&r!==void 0&&e.state.action==="idle"&&r.state.action==="idle"&&e.state.standingOnItemId==="heels"},td=(t,e)=>e?.[t],Mz=t=>Nr(t),Ot=t=>Ge(Mz(t)),D$=t=>Ge(Nd(t)),L$=t=>({head:t.head,heels:t.heels,headOverHeels:t.headOverHeels}),Ht=Symbol("roomSpatialIndexKey"),ft={x:12,y:12,z:W.z},Iz={x:14,y:14,z:W.z},vs={x:16,y:16,z:W.z},Ya={...ft,z:W.z*2},Df=t=>{switch(t.type){case"spring":case"portableBlock":case"moveableDeadly":case"slidingDeadly":case"firedDoughnut":return{aabb:ft};case"slidingBlock":return t.config.style==="book"?{aabb:vs}:{aabb:ft};case"lift":return{aabb:{...ft,z:ft.z}};case"switch":return{aabb:{...ft,z:ft.z}};case"button":return{aabb:{x:15,y:15,z:2}};case"pickup":return t.config.gives==="scroll"?{aabb:{x:16,y:4,z:13}}:{aabb:ft};case"charles":return{aabb:Ya};case"ball":return{aabb:{x:12,y:12,z:12}};case"pushableBlock":case"movingPlatform":return{aabb:vs};case"block":switch(t.config.style){case"artificial":case"organic":case"book":return{aabb:vs};case"tower":return{aabb:{x:11,y:11,z:W.z}};default:throw new Error("unknown block style")}case"monster":switch(t.config.which){case"skiHead":return{aabb:{...ft,z:21}};case"bubbleRobot":case"cyberman":case"elephant":case"emperorsGuardian":case"monkey":case"computerBot":return{aabb:Ya};case"helicopterBug":case"dalek":case"emperor":case"homingBot":case"elephantHead":return{aabb:ft};case"turtle":return{aabb:ft};default:throw t.config,new Error("unknown monster type")}case"deadlyBlock":case"spikes":return{aabb:vs};case"bubbles":return{aabb:ft};case"conveyor":case"hushPuppy":case"teleporter":return{aabb:vs};case"barrier":return{aabb:t.config.axis==="y"?{x:3,y:15,z:W.z}:{x:15,y:3,z:W.z}};case"sceneryPlayer":return t.config.which==="headOverHeels"?{aabb:Ya}:{aabb:ft};case"emitter":return{aabb:ee};default:return{aabb:Iz}}},ct={aabb:ft,castsShadowWhileStoodOn:!1},Rn=t=>({x:t.direction==="away"?t.tiles.length:t.direction==="towards"?t.times?.x??1:1,y:t.direction==="left"?t.tiles.length:t.direction==="right"?t.times?.y??1:1}),F$=t=>t.type==="wall"?Rn(t.config):Sz(t)?t.config.times:void 0,go=(t=So)=>({x:t.x??1,y:t.y??1,z:t.z??1}),U$=t=>({x:t.x??1,y:t.y??1}),iA=t=>{const e=r=>r.config.times!==void 0;return t.type==="wall"?go(Rn(t.config)):e(t)?go(t.config.times):So},jz=t=>{const e=r=>r.config.times!==void 0;return t.type==="wall"?go(Rn(t.config)):e(t)?go(t.config.times):So},$$=t=>{const e={};let r=!1;return t.x!==1&&(e.x=t.x,r=!0),t.y!==1&&(e.y=t.y,r=!0),t.z!==1&&(e.z=t.z,r=!0),r?e:void 0},yo=(t,e={})=>{const r=go(e),s=Mr(W,t);return o_(t_(r,W),s)},H$=1e3,Xr=-2,De=Number.MIN_SAFE_INTEGER,G$=({x:t=0,y:e=0})=>e-t,Ne=({x:t=0,y:e=0,z:r=0})=>({x:e-t,y:-(t+e)/2-r}),je=({x:t=0,y:e=0,z:r=0})=>({x:t*W.x,y:e*W.y,z:r*W.z}),W$=t=>Ne(je(t)),rd=t=>{const e=je(t.position),{aabb:r}=Df(t);if(r===void 0)throw new Error(`item type= ${t.type} config=${JSON.stringify(t.config)} has no bounding box`);return t.type==="wall"?e:U(e,{x:W.x-r.x>>1,y:W.y-r.y>>1})},Ye=()=>({expires:null,stoodOnBy:{},disappearing:null,switchedAtRoomTime:De,stoodOnUntilRoomTime:De,actedOnAt:{roomTime:De,by:pe}}),rq=()=>({gravity:ee,movingFloor:ee}),Mn=()=>({vels:rq(),latentMovement:[],collidedWith:{roomTime:De,by:pe},controlledWithJoystickAtRoomTime:De,standingOnItemId:null,standingOnUntilRoomTime:De,previousStandingOnItemId:null}),Oz=t=>{const e=XV.includes(t.type);return{...Ye(),position:rd(t),...e?{...Mn(),vels:{...rq(),...QV.includes(t.type)?{sliding:ee}:{},...t.type==="monster"||t.type==="movingPlatform"?{walking:ee}:{}}}:{},...t.type==="joystick"||t.type==="emitter"||t.type==="lift"||t.type==="conveyor"||t.type==="teleporter"?{...structuredClone(t.config)}:{},...t.type==="monster"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",timeOfLastDirectionChange:Number.NEGATIVE_INFINITY,...t.config.which==="skiHead"||t.config.which==="turtle"||t.config.which==="elephantHead"||t.config.which==="cyberman"?{facing:de[t.config.startDirection]}:{facing:de.towards}}:{},...t.type==="pickup"?{disappearing:{on:"touch",byType:t.config.gives==="bag"||t.config.gives==="jumps"?["heels","headOverHeels"]:t.config.gives==="doughnuts"||t.config.gives==="hooter"||t.config.gives==="fast"?["head","headOverHeels"]:["head","heels","headOverHeels"]}}:{},...t.type==="movingPlatform"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",facing:de[t.config.startDirection]}:{},...t.type==="switch"?{setting:t.config.initialSetting,lastToggledAtRoomTime:De}:{},...t.type==="button"?{pressed:!1}:{},...t.type==="block"?{disappearing:t.config.disappearing??null}:{},...t.type==="conveyor"?{disappearing:t.config.disappearing??null}:{},...t.type==="barrier"?{disappearing:t.config.disappearing??null}:{},...t.type==="lift"?{direction:"up",vels:{lift:ee}}:{},...t.type==="charles"?{facing:de.towards}:{},...t.type==="emitter"?{lastEmittedAtRoomTime:De,quantityEmitted:0}:{},...t.type==="firedDoughnut"?{disappearing:{on:"touch"},vels:{fired:t.config.direction?Wt(de[t.config.direction],Cj.firedDoughnut):ee}}:{}}},Nz=({config:{direction:t},position:e})=>t==="right"&&e.x===0||t==="towards"&&e.y===0,Bz=Object.freeze({textureId:"shadow.door.floatingThreshold.double.y",spritesheetVariant:"original"}),zz=Object.freeze({textureId:"shadow.doorFrame.top.y",spritesheetVariant:"original"}),Dz=Object.freeze({textureId:"shadow.doorFrame.top.y",flipX:!0,spritesheetVariant:"original"}),Lz=["doorLegs"],Fz=Object.freeze({textureId:"shadow.door.floatingThreshold.double.y",flipX:!0,spritesheetVariant:"original"}),Fu=W.z*2,Uz=4,Ta=W.z*Uz,$z=2;2*W.x;const Hz=.5,oA=2;function*Gz(t,e){const{config:{direction:r},position:s}=t,n=qx(r),i=Bl(n),o=Nz(t),a={...ee,[i]:o?-.5:0},l=1,c={[i]:o?-l:0},u=l*W.x,h={...ee,[i]:u},d=9,f=8,m=8;{const y={[n]:f,[i]:m,z:Ta};yield{...t,...ct,type:"doorFrame",id:`${e}/frameFar`,jsonItemId:e,config:{...t.config,inHiddenWall:o,part:"far"},state:{...Ye(),position:je(U(s,{[n]:1.5},a,c)),stoodOnBy:pe},aabb:U(y,h),renderAabb:y,renderAabbOffset:o?h:void 0}}{const y={[n]:d,[i]:m,z:Ta};yield{...t,...ct,type:"doorFrame",id:`${e}/frameNear`,jsonItemId:e,config:{...t.config,inHiddenWall:o,part:"near"},state:{...Ye(),position:je(U(s,a,c)),stoodOnBy:pe},aabb:U(y,h),renderAabb:y,renderAabbOffset:o?h:void 0}}{const y={[n]:2*W.x-d-f,[i]:m,z:Ta-Fu};yield{...t,...ct,type:"doorFrame",id:`${e}/frameTop`,jsonItemId:e,config:{...t.config,inHiddenWall:o,part:"top"},state:{...Ye(),position:U(je(U(s,a,c)),{[n]:d,z:Fu}),stoodOnBy:pe},aabb:U(y,h),renderAabb:y,renderAabbOffset:o?h:void 0,shadowCastTexture:o?void 0:n==="x"?Dz:zz,castsShadowWhileStoodOn:!0,noShadowCastOn:o?void 0:Lz}}yield{...t,...ct,type:"blocker",id:`${e}/blockerAbove`,jsonItemId:e,config:{},renders:!1,state:{...Ye(),position:U(je(U(s,a,c)),{z:Ta}),stoodOnBy:pe},aabb:U(je({[n]:2,[i]:l}),{[i]:m,z:Af}),renderAabb:ee,fixedZIndex:Xr},yield{...t,...ct,type:"portal",id:`${e}/portal`,jsonItemId:e,config:{...to(t.config,"toRoom","toDoor"),inHidden:o,relativePoint:je({...ee,[i]:o?l+.25:-.25}),direction:de[r]},fixedZIndex:Xr,state:{...Ye(),position:U(je(U(s,{[i]:o?-.5-l:.5})),{[n]:d}),stoodOnBy:pe},aabb:{[n]:$z*W.x-d-f,[i]:u,z:Fu}},s.z!==0&&(yield{...t,...ct,type:"doorLegs",id:`${e}/legs`,jsonItemId:e,config:{...t.config,inHiddenWall:o,style:"none",side:"away",height:s.z},renders:!0,shadowCastTexture:o?n==="x"?Fz:Bz:void 0,castsShadowWhileStoodOn:o,state:{...Ye(),position:{...je(U(s,a,c)),z:0}},aabb:U(je({[n]:2,[i]:.5,z:s.z}),h),renderAabb:o?U(je({[n]:2,[i]:.5,z:.5})):void 0,renderAabbOffset:o?U({[n]:0,[i]:0,z:(s.z-.5)*W.z},{[i]:h[i]}):void 0,shadowOffset:{z:s.z*W.z,[i]:o?h[i]:void 0}}),yield{...ct,type:"stopAutowalk",id:`${e}/stopAutowalk`,jsonItemId:e,aabb:je({[n]:2,[i]:oA,z:2}),config:{},fixedZIndex:Xr,state:{...Ye(),position:je(Mr(s,Wt(de[r],Hz),o?ee:{[i]:oA})),stoodOnBy:pe}}}const aA=3,lA=10,cA=.52,Ra=.5,Wz=Object.freeze({textureId:"shadow.fullBlock",spritesheetVariant:"original"}),Kz=(t,e,r)=>{const{config:{times:s},position:n}=e,i=U(n,{z:-aA}),o={...s,z:aA};let a=i,l=o;const c=Ge(Nr(r.items)).filter(d=>d.type==="door");if(n.z===0){const d={};for(const f of c){const{position:m,config:{direction:y}}=f;switch(y){case"towards":!d.towards&&m.y===i.y&&m.x>=i.x&&m.x<=i.x+s.x-2&&(l=U(l,{y:Ra}),a=U(a,{y:-Ra}),d.towards=!0);break;case"away":!d.away&&m.y===i.y+s.y&&m.x>=i.x&&m.x<=i.x+s.x-2&&(l=U(l,{y:cA}),d.away=!0);break;case"right":!d.right&&m.x===i.x&&m.y>=i.y&&m.y<=i.y+s.y-2&&(l=U(l,{x:Ra}),a=U(a,{x:-Ra}),d.right=!0);break;case"left":!d.left&&m.x===i.x+s.x&&m.y>=i.y&&m.y<=i.y+s.y-2&&(l=U(l,{x:cA}),d.left=!0);break}}}const u=je(a),h=yo(vs,l);return{...ct,type:"floor",id:t,jsonItemId:t,config:{...e.config,naturalFootprint:{aabb:yo(vs,o),position:je(i)}},aabb:h,renderAabb:{...h,z:lA},renderAabbOffset:{...ee,z:h.z-lA},shadowCastTexture:Wz,state:{...Ye(),position:u}}},Yz=Object.freeze({animationId:"shadow.lift",spritesheetVariant:"original"}),uA=Object.freeze({textureId:"shadow.smallBlock",spritesheetVariant:"original"}),en=Object.freeze({textureId:"shadow.smallRound",spritesheetVariant:"original"}),Ma=Object.freeze({textureId:"shadow.fullBlock",spritesheetVariant:"original"}),Qz=Object.freeze({textureId:"shadow.fullBlock",flipX:!0,spritesheetVariant:"original"}),Xz=Object.freeze({textureId:"shadow.barrier.y",spritesheetVariant:"original"}),Jz=Object.freeze({textureId:"shadow.barrier.y",flipX:!0,spritesheetVariant:"original"}),Zz=Object.freeze({textureId:"shadow.scroll",spritesheetVariant:"original"}),eD=t=>{switch(t.type){case"lift":return Yz;case"switch":return uA;case"conveyor":return Vx(t.config.direction)==="x"?Qz:Ma;case"barrier":return t.config.axis==="x"?Jz:Xz;case"spring":case"firedDoughnut":case"slidingDeadly":return en;case"block":return t.config.style==="tower"?en:Ma;case"pushableBlock":case"movingPlatform":case"hushPuppy":case"deadlyBlock":case"teleporter":case"spikes":return Ma;case"portableBlock":return t.config.style==="drum"?en:uA;case"pickup":return t.config.gives==="scroll"?Zz:en;case"ball":case"charles":case"monster":return en;case"slidingBlock":return t.config.style==="book"?Ma:en}},tD=Object.freeze({textureId:"shadow.playable",spritesheetVariant:"original"}),Cl={config:pe,shadowCastTexture:tD,castsShadowWhileStoodOn:!0,aabb:ft},Ao=()=>{const t=Tw(ce.getState());return{action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:de.towards,visualFacingVector:de.towards,walkStartFacing:de.towards,walkDistance:0,vels:{walking:ee,gravity:ee,movingFloor:ee},switchedToAt:De,lastDiedAt:De,gameTime:0,jumpStartTime:De,lives:t?"infinite":Tj,jumpStartZ:0}},rD=(t,e)=>{const r=Rw(ce.getState());return t.config.which==="head"?{id:e,jsonItemId:e,type:"head",...ct,...Cl,state:{...Ye(),...Mn(),...Ao(),hasHooter:!1,gameWalkDistance:0,fastStepsStartedAtDistance:De,shieldCollectedAt:De,doughnuts:r?"infinite":0,position:rd(t),stoodOnUntilRoomTime:De}}:{id:e,jsonItemId:e,type:"heels",...ct,...Cl,state:{...Ye(),...Mn(),...Ao(),carrying:null,hasBag:!1,bigJumps:0,isBigJump:!1,shieldCollectedAt:De,position:rd(t),stoodOnUntilRoomTime:De}}},sD=t=>t==="towards"||t==="right",nD=Object.freeze({textureId:"shadow.wall.y",spritesheetVariant:"original"}),iD=Object.freeze({textureId:"shadow.wall.y",flipX:!0,spritesheetVariant:"original"}),Lf=1,oD={x:W.x,y:W.y*Lf,z:Af},aD={x:W.x,y:0,z:oV},lD={x:W.x*Lf,y:W.y,z:Af},cD={x:0,y:W.y,z:oV},uD=(t,e)=>{const{config:{direction:r},position:s}=e,n=Rn(e.config),i=qx(r),o=Bl(i),a=sD(r),l={...ee,[o]:a?-Lf:0};return{type:"wall",id:t,jsonItemId:t,config:e.config,aabb:yo(i==="y"?lD:oD,n),renderAabb:a?ee:yo(i==="y"?cD:aD,n),fixedZIndex:a?Xr:void 0,state:{...Ye(),position:je(U(s,l)),stoodOnBy:pe},shadowCastTexture:i!=="y"?iD:nD,castsShadowWhileStoodOn:a}};function*Ff(t,e,r,s=pe,n={},i=""){if(!s[t]&&!(e.type==="pickup"&&e.config.gives==="scroll"&&e.config.source==="manual"&&n[e.config.page]))switch(!0){case e.type==="door":return yield*Gz(e,t);case e.type==="player":{yield rD(e,t);return}case e.type==="wall":{yield uD(t,e);return}case e.type==="floor":{yield Kz(t,e,r);return}case(e.type==="block"&&e.config.disappearing!==void 0&&Fn(iA(e))>=2):{const o=iA(e);for(let a=0;a<o.x;a++)for(let l=0;l<o.y;l++)for(let c=0;c<o.z;c++){const u=Dn(e,h=>{h.position={x:e.position.x+a,y:e.position.y+l,z:e.position.z+c},h.config.times=So});yield*Ff(t,u,r,s,n,`${i}_${a}_${l}_${c}`)}break}case(e.type==="sceneryCrown"&&!ce.getState().gameMenus.gameInPlay.planetsLiberated[e.config.planet]):return;default:{const o=Df(e),a=e.config.times!==void 0?{aabb:yo(o.aabb,e.config.times),renderAabb:void 0}:o;let l;try{l=Oz(e)}catch(c){throw new Error(`loadItemFromJson: error creating initial state for jsonItem ${JSON.stringify(e,null,2)}`,{cause:c})}yield{...e,...ct,...a,id:`${t}${i}`,jsonItemId:t,fixedZIndex:e.type==="emitter"?Xr:void 0,shadowCastTexture:eD(e),castsShadowWhileStoodOn:e.type==="monster"&&(e.config.which==="emperor"||e.config.which==="emperorsGuardian"||e.config.which==="cyberman"||e.config.which==="turtle"||e.config.which==="helicopterBug")||e.type==="pickup"||e.type==="ball"||e.type==="lift"||e.type==="pushableBlock"||e.type==="sceneryPlayer"||e.type==="slidingDeadly"||e.type==="spring",config:e.config,state:l}}}}const hD=({gameState:t,room:e,itemType:r,config:s,position:n,additionalIdPart:i})=>{const o={type:r,config:s,position:ee},a=`${r}/${i}`,l=jx(Ff(a,o,e.roomJson,t.pickupsCollected[e.id]??pe));if(l===void 0)throw console.error("failed to generate any items for json",a,o),new Error("failed to generate any items");return In({room:e,item:l,atPosition:n}),l},In=({room:t,item:e,atPosition:r})=>(t.items[e.id]=e,r!==void 0&&(e.state.position=r),t[Ht].addItem(e),e),dD=(t,e)=>Ge(Dx(t)).map(r=>{const s=e.items[r];if(s===void 0)throw new Error(`item ${r} in stoodOnBy is not in the room`);return s});function sq(t,e){return t===null?null:e.items[t]}const K$=(t,{standingOnItemId:e,standingOnUntilRoomTime:r,previousStandingOnItemId:s,jumped:n})=>e!==null?e:!n&&r+Ij>t.roomTime&&t.items[s]?s:null,sd=(t,e)=>{if(t.state.standingOnItemId!==null){const r=sq(t.state.standingOnItemId,e);delete r.state.stoodOnBy[t.id],t.state.previousStandingOnItemId=t.state.standingOnItemId,t.state.standingOnItemId=null,r.state.stoodOnUntilRoomTime=e.roomTime,t.state.standingOnUntilRoomTime=e.roomTime}},jn=({room:t,item:e})=>{const r=nq({room:t,item:e});t[Ht].removeItem(r)},nq=({room:t,item:e})=>{const r=typeof e=="string"?t.items[e]:e;Ts(r)&&sd(r,t);for(const s of dD(r.state.stoodOnBy,t))sd(s,t);return typeof e=="string"?delete t.items[e]:delete t.items[r.id],r},Uf=({above:t,below:e})=>{const r=e.state.stoodOnBy;if(!Object.isExtensible(r))throw new Error(`${t.id} can't stand on ${e.id} - its standingOn is not extensible`);t.state.previousStandingOnItemId=t.state.standingOnItemId,t.state.standingOnItemId=e.id,r[t.id]=!0},fD=t=>{const e={id:"head",type:"head",...ct,...Cl,state:{...Ye(),...Mn(),...Ao(),...t.state.head,facing:t.state.facing,visualFacingVector:t.state.visualFacingVector,position:U(t.state.position,{z:W.z}),switchedToAt:De,actedOnAt:t.state.actedOnAt,collidedWith:t.state.collidedWith,stoodOnUntilRoomTime:t.state.stoodOnUntilRoomTime}},r={id:"heels",type:"heels",...ct,...Cl,state:{...Ye(),...Mn(),...Ao(),...t.state.heels,facing:t.state.facing,visualFacingVector:t.state.visualFacingVector,position:U(t.state.position),switchedToAt:De,actedOnAt:t.state.actedOnAt,collidedWith:t.state.collidedWith,stoodOnUntilRoomTime:t.state.stoodOnUntilRoomTime,isBigJump:!1}};return{head:e,heels:r}},pD=({head:t,heels:e})=>({id:"headOverHeels",type:"headOverHeels",...ct,shadowCastTexture:e.shadowCastTexture,castsShadowWhileStoodOn:e.castsShadowWhileStoodOn,config:pe,aabb:Ya,state:{...Ye(),...Mn(),...Ao(),position:e.state.position,action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:e.state.facing,visualFacingVector:e.state.visualFacingVector,actedOnAt:e.state.actedOnAt.roomTime>t.state.actedOnAt.roomTime?e.state.actedOnAt:t.state.actedOnAt,collidedWith:e.state.collidedWith.roomTime>t.state.collidedWith.roomTime?e.state.collidedWith:t.state.collidedWith,stoodOnUntilRoomTime:e.state.stoodOnUntilRoomTime,head:{...to(t.state,"hasHooter","doughnuts","fastStepsStartedAtDistance","gameWalkDistance","lives","gameTime","shieldCollectedAt","lastDiedAt"),switchedToAt:De},heels:{...to(e.state,"hasBag","bigJumps","carrying","lives","gameTime","shieldCollectedAt","lastDiedAt"),switchedToAt:De}}}),mD=t=>{const e=t.characterRooms.head,r=Or(t,"head"),s=Or(t,"heels"),n=pD({head:r,heels:s});jn({room:e,item:"head"}),jn({room:e,item:"heels"}),In({room:e,item:n}),t.previousPlayable=t.currentCharacterName,t.currentCharacterName="headOverHeels",t.characterRooms={head:void 0,heels:void 0,headOverHeels:e}},gD=(t,e)=>{const r=t.characterRooms.headOverHeels,s=Or(t,"headOverHeels"),n=e??An(t.previousPlayable),{head:i,heels:o}=fD(s);jn({room:r,item:"headOverHeels"}),In({room:r,item:i}),In({room:r,item:o}),Uf({above:i,below:o}),t.currentCharacterName=n,t.previousPlayable=void 0,t.characterRooms={head:r,heels:r,headOverHeels:void 0}},yD=t=>{const e=Or(t,t.currentCharacterName);e!==void 0&&(e.type==="headOverHeels"?(e.state.head.switchedToAt=e.state.head.gameTime,e.state.heels.switchedToAt=e.state.heels.gameTime):e.state.switchedToAt=e?.state.gameTime)},Qa=(t,e)=>{Rz(t)&&(!e||e===t.currentCharacterName)?mD(t):t.currentCharacterName==="headOverHeels"?gD(t,e):(!e||e!==t.currentCharacterName)&&Or(t,An(t.currentCharacterName))!==void 0&&(t.currentCharacterName=An(t.currentCharacterName)),yD(t)},Uu=4,$u=Ei.h,iq=()=>{const t=Io(),e=v.useRef(null),r=v.useCallback((s,n="lines")=>{if(e.current===null)return;const{scrollTop:i,scrollLeft:o}=e.current,a=de[s],l=n==="all"?a.y<0?9999:0:n==="lines"?i+t*Uu*-a.y*$u:i+-a.y*(e.current?.getBoundingClientRect().height-t*$u*Uu),c=o+t*Uu*a.x*$u;e.current.scrollTo({left:c,top:l,behavior:"smooth"})},[t]);return Se({handler:v.useCallback(()=>{r("towards")},[r]),action:"towards"}),Se({handler:v.useCallback(()=>{r("away")},[r]),action:"away"}),Se({handler:v.useCallback(()=>{r("towards","pages")},[r]),action:"pageDown"}),Se({handler:v.useCallback(()=>{r("away","pages")},[r]),action:"pageUp"}),Se({handler:v.useCallback(()=>{r("towards","all")},[r]),action:"end"}),Se({handler:v.useCallback(()=>{r("away","all")},[r]),action:"home"}),Se({handler:v.useCallback(()=>{r("left")},[r]),action:"left"}),Se({handler:v.useCallback(()=>{r("right")},[r]),action:"right"}),e},AD=(t,e,r)=>{if(e==="*")return!0;const s=r.meta.subRooms[e];return t.x>=s.physicalPosition.from.x&&t.y>=s.physicalPosition.from.y&&t.x<=s.physicalPosition.to.x&&t.y<=s.physicalPosition.to.y},xD=({position:t},e,r)=>AD(t,e,r),bD=(t,e,r)=>{if(e==="*")return 0;const s=r.meta.subRooms[e],{from:n,to:i}=s.physicalPosition;if(t.x>=n.x&&t.y>=n.y&&t.x<=i.x&&t.y<=i.y)return 0;let o=0,a=0;return t.x<n.x?o=n.x-t.x:t.x>i.x&&(o=t.x-i.x),t.y<n.y?a=n.y-t.y:t.y>i.y&&(a=t.y-i.y),o+a},$f=(t,e,r)=>{const s=r.meta?.subRooms;if(s===void 0)return"*";let n,i=1/0;const o=e==="fine"?{x:t.x/W.x,y:t.y/W.y}:t;for(const a of Dx(s)){const l=bD(o,a,r);if(l===0)return a;l<i&&(i=l,n=a)}if(n===void 0)throw new Error(`item not found in any subroom of ${r.id}
      item at  ${JSON.stringify(o)}
      subrooms ${JSON.stringify(r.meta?.subRooms,null,2)}`);return n},G=48,Er=36,xo=.55,_t=G*((1-xo)/2),vt=G-_t,bo=8,ks=128,_s=({mapTitle:t,y:e=0,className:r,textOnly:s=!1})=>{const n=Io();return p.jsxs("g",{className:r,children:[s||p.jsx("rect",{y:e,width:1e4,height:1e4}),p.jsx("foreignObject",{width:n*(t.length+3)*8,height:n*16*3,x:bo,y:e+16,children:p.jsx(j,{className:`left-2 relative sprites-double-height ${le}`,children:t})})]})},$r={blacktooth:{bgClassName:"fill-redShadow zx:fill-zxGreenDimmed text-lightGrey zx:text-zxWhite",containerClassName:"bg-moss zx:bg-zxGreenDimmed scrollbar-track-moss zx:scrollbar-track-zxGreenDimmed scrollbar-thumb-shadow zx:scrollbar-thumb-zxWhite"},bookworld:{bgClassName:"fill-redShadow zx:fill-zxBlue text-highlightBeige zx:text-zxWhite",containerClassName:"bg-redShadow zx:bg-zxBlue scrollbar-track-redShadow zx:scrollbar-track-zxBlue scrollbar-thumb-highlightBeige zx:scrollbar-thumb-zxWhite"},jail:{bgClassName:"fill-shadow zx:fill-zxBlue text-black zx:text-zxWhite",containerClassName:"bg-shadow zx:bg-zxBlue scrollbar-track-shadow zx:scrollbar-track-zxBlue scrollbar-thumb-lightGrey zx:scrollbar-thumb-zxWhite"},egyptus:{bgClassName:"fill-midRed zx:fill-zxRedDimmed text-highlightBeige zx:text-zxYellow",containerClassName:"bg-midRed zx:bg-zxRedDimmed scrollbar-track-midRed zx:scrollbar-track-zxBlue zx:scrollbar-track-zxRedDimmed scrollbar-thumb-highlightBeige zx:scrollbar-thumb-zxYellow"},moonbase:{bgClassName:"fill-pastelBlue zx:fill-zxBlue text-metallicBlue zx:text-zxWhite",containerClassName:"bg-pastelBlue zx:bg-zxBlue scrollbar-track-pastelBlue zx:scrollbar-track-zxBlue scrollbar-thumb-metallicBlue zx:scrollbar-thumb-zxWhite"},market:{bgClassName:"fill-metallicBlueHalfbrite zx:fill-zxCyan text-highlightBeige zx:text-zxBlack",containerClassName:"bg-metallicBlueHalfbrite zx:bg-zxCyan scrollbar-track-metallicBlueHalfbrite zx:scrollbar-track-zxBlue scrollbar-thumb-highlightBeige zx:scrollbar-thumb-zxBlack"},penitentiary:{bgClassName:"fill-shadow zx:fill-zxBlue text-moss zx:text-zxWhite",containerClassName:"bg-shadow zx:bg-zxBlue scrollbar-track-shadow zx:scrollbar-track-zxBlue scrollbar-thumb-moss zx:scrollbar-thumb-zxWhite"},safari:{bgClassName:"fill-redShadow zx:fill-zxBlue text-moss zx:text-zxWhite",containerClassName:"bg-redShadow zx:bg-zxBlue scrollbar-track-redShadow zx:scrollbar-track-zxBlue scrollbar-thumb-moss zx:scrollbar-thumb-zxWhite"},freedom:{bgClassName:"fill-moss zx:fill-zxGreen text-metallicBlue zx:text-zxBlack",containerClassName:"bg-moss zx:bg-zxGreen scrollbar-track-moss zx:scrollbar-track-zxGreen scrollbar-thumb-moss zx:scrollbar-thumb-zxBlack"}},wD=t=>{switch(t.hue){case"cyan":return"[--roomHintColor:theme(colors.pastelBlue)] [--roomHintColorDarker:theme(colors.pastelBlueHalfbrite)] zx:[--roomHintColor:theme(colors.zxCyan)] zx:[--roomHintColorDarker:theme(colors.zxCyanDimmed)]";case"green":return"[--roomHintColor:theme(colors.moss)] [--roomHintColorDarker:theme(colors.mossHalfbrite)] zx:[--roomHintColor:theme(colors.zxGreen)] zx:[--roomHintColorDarker:theme(colors.zxGreenDimmed)]";case"magenta":return"[--roomHintColor:theme(colors.pink)] [--roomHintColorDarker:theme(colors.pinkHalfbrite)] zx:[--roomHintColor:theme(colors.zxMagenta)] zx:[--roomHintColorDarker:theme(colors.zxMagentaDimmed)]";case"white":return"[--roomHintColor:theme(colors.lightGrey)] [--roomHintColorDarker:theme(colors.lightGreyHalfbrite)] zx:[--roomHintColor:theme(colors.zxWhiteDimmed)] zx:[--roomHintColorDarker:theme(colors.zxBlack)]";case"yellow":return"[--roomHintColor:theme(colors.highlightBeige)] [--roomHintColorDarker:theme(colors.highlightBeigeHalfbrite)] zx:[--roomHintColor:theme(colors.zxYellow)] zx:[--roomHintColorDarker:theme(colors.zxYellowDimmed)]";default:throw t.hue,new Error("unknown hue")}},oq=t=>(t&&$r[t])??{bgClassName:"fill-shadow",containerClassName:""},Gt=t=>({x:(t.x??0)*G,y:(t.y??0)*G,z:(t.z??0)*Er}),On=t=>Math.round(t*10)/10,Hf=t=>{const e=Ne(t);return`translate(${On(e.x)},${On(e.y)})`},H=t=>{const e=Ne(t);return Mt(e)},Mt=t=>`${On(t.x)},${On(t.y)}`,VD=({originalCampaignPositions:t,mapBounds:e,containerWidth:r})=>{const s=Io(),n=e.r-e.l+2*bo,i={x:-e.l+bo+(r-n)/2,y:-e.t+ks},o=(x,w=ee)=>Kr(i,Ne(Gt(U(t[x].gridPosition,w)))),a=o("blacktooth44market/*",{x:1,z:1.5}),l=o("blacktooth44market/*",{x:1}),c=o("blacktooth45market/*"),u=o("blacktooth48market/*",{y:1}),h=o("blacktooth53market/*",{x:0,y:0,z:0}),d=o("blacktooth53market/*",{x:0,y:1,z:0}),f=o("blacktooth53market/*",{x:1,y:1,z:0}),m=o("blacktooth52market/*",{x:1,y:.5,z:0}),y=s*8*2,g="Market",A=(g.length+3)*s*8,b=s*8*2+32;return p.jsxs(p.Fragment,{children:[p.jsx("path",{className:`${$r.market.bgClassName} stroke-metallicBlueHalfbrite zx:stroke-zxCyan`,strokeWidth:12,d:`
M ${Mt({x:y,y:m.y+b})}
L ${Mt({x:A,y:m.y+b})}
L ${Mt({x:A,y:a.y})}
L ${Mt(a)}
L ${Mt(l)}
L ${Mt(c)}
L ${Mt(u)}
L ${Mt(h)}
L ${Mt(d)}
L ${Mt(f)}
L ${Mt(m)}
L ${Mt({...m,x:y})}
z`}),p.jsx(_s,{y:m.y,mapTitle:g,className:$r.market.bgClassName,textOnly:!0})]})},qD=({gridPositions:t,mapBounds:e,containerWidth:r})=>{const s=t,n=Ne(Gt({x:1,y:1,z:0})).y,i=(o,a)=>{if(s[o]===void 0)throw new Error(`OriginalCampaignMainMapBackground: this campaign does not have any room called "${o}" to use to calculate yBetweenRooms`);if(s[a]===void 0)throw new Error(`OriginalCampaignMainMapBackground: this campaign does not have any room called "${a}" to use to calculate yBetweenRooms`);const l=Ne(Gt(s[o].gridPosition)).y,c=Ne(Gt(s[a].gridPosition)).y+n;return(l+c)/2};return p.jsxs(p.Fragment,{children:[p.jsx(_s,{y:0,mapTitle:"Freedom",className:$r.freedom.bgClassName}),p.jsx(_s,{y:i("finalroom/*","blacktooth83tofreedom/*")-e.t+ks,mapTitle:"Castle Blacktooth",className:$r.blacktooth.bgClassName}),p.jsx(_s,{y:i("blacktooth87crown/*","moonbase35/*")-e.t+ks,mapTitle:"Moonbase",className:$r.moonbase.bgClassName}),p.jsx(_s,{y:i("moonbase4/*","blacktooth62fish/right")-e.t+ks,mapTitle:"Blacktooth escape",className:$r.blacktooth.bgClassName}),p.jsx(VD,{mapBounds:e,originalCampaignPositions:s,containerWidth:r}),p.jsx(_s,{y:i("blacktooth24/*","blacktooth1head/*")-e.t+ks,mapTitle:"Jail",className:$r.jail.bgClassName})]})},vD={blacktooth:"Blacktooth",bookworld:"Bookworld",jail:"Blacktooth",egyptus:"Egyptus",moonbase:"Moonbase",market:"Market",penitentiary:"Penitentiary",safari:"Safari"},_D=t=>{const{campaign:e,curRoomId:r}=t,s=e.locator.userId===aV&&!["penitentiary","bookworld","egyptus","safari"].includes(e.rooms[r].planet),n=oq(t.curRoomScenery);return s?p.jsx(qD,{...t}):p.jsx(_s,{mapTitle:vD[e.rooms[r].planet],className:n.bgClassName})},hA=t=>i_(Wt(t.aabb,.5),t.state.position),SD={x:1,y:1,z:1},dA=(t,e,r)=>e===r?t===e?.5:t>e?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:(t-e)/(r-e),Y$=t=>t,kD=t=>Nr(t.items),CD=t=>Nd(t),aq=t=>Ge(kD(t)),Q$=(t,...e)=>{const r=Ge(CD(t));return e.length===0?r:r.filter(([,s])=>e.includes(s.type))},ED={floors:{edgeLeftX:Number.POSITIVE_INFINITY,edgeRightX:Number.NEGATIVE_INFINITY,topEdgeY:Number.POSITIVE_INFINITY,bottomEdgeY:Number.NEGATIVE_INFINITY},allItems:{topEdgeY:Number.POSITIVE_INFINITY}},X$=t=>Ot(t.items).reduce((e,r)=>{if(r.type==="floor"){const{config:{naturalFootprint:s},state:{position:n},renderAabb:i,renderAabbOffset:o,aabb:a}=r,l=Ne(U(s.position,{x:s.aabb.x,z:s.aabb.z})).x,c=Ne(U(s.position,{y:s.aabb.y,z:s.aabb.z})).x,u=Ne(U(s.position,s.aabb)).y,h=Ne(U(n,o??ee,{z:(i??a).z})).y;return{allItems:e.allItems,floors:{edgeLeftX:Math.min(e.floors.edgeLeftX,l),edgeRightX:Math.max(e.floors.edgeRightX,c),topEdgeY:Math.min(e.floors.topEdgeY,u),bottomEdgeY:Math.max(e.floors.bottomEdgeY,h)}}}else{const s=Ne(U(r.state.position,r.renderAabb??r.aabb??ee,r.renderAabbOffset??ee)).y;return{allItems:{topEdgeY:Math.min(e.allItems.topEdgeY,s)},floors:e.floors}}},ED),PD={from:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,z:Number.POSITIVE_INFINITY},to:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY,z:Number.NEGATIVE_INFINITY}},lq=t=>{const e=aq(t).filter(r=>r.type==="floor").reduce((r,s)=>{const{position:n,config:{times:i}}=s;return{from:{x:Math.min(r.from.x,n.x),y:Math.min(r.from.y,n.y),z:Math.min(r.from.z,n.z)},to:{x:Math.max(r.to.x,n.x+i.x),y:Math.max(r.to.y,n.y+i.y),z:Math.max(r.to.z,n.z)}}},PD);if(isFinite(e.from.x))return e},cq=({svg:t=!1,smooth:e=!1})=>{const r=v.useRef(null);return v.useLayoutEffect(()=>{r.current?.scrollIntoView({behavior:e?"smooth":"instant",block:"center"})}),t?p.jsx("g",{ref:r}):p.jsx("div",{ref:r})},Xa=({className:t,scrollTo:e=!1,onClick:r,yAdjust:s=0})=>p.jsxs("foreignObject",{x:-50,y:-100+s,width:100,height:100,className:t,style:{pointerEvents:"none"},children:[p.jsx("div",{className:`sprite zx:sprite-revert-to-two-tone ml-[calc(50px-var(--scale)*var(--w)/2)] mt-[calc(100px-var(--scale)*var(--h))] ${t}`,onClick:r,style:r?{pointerEvents:"all"}:{}}),e&&p.jsx(cq,{})]}),Ti=({characterName:t,facing:e,isCurrent:r=!1,onlyPlayableInRoom:s=!1,yAdjust:n=0,onClick:i})=>p.jsx(Xa,{className:`${s?"[--scale:2.5]":"[--scale:1.5]"}
                ${Tn({character:t,action:r?"walking":"idle",facingXy8:Od(e)??"towards"})}`,scrollTo:r,yAdjust:n,onClick:o=>{i?.(t),o.preventDefault(),o.stopPropagation()}}),TD=({item:t})=>{const r=t.type==="hushPuppy"||t.type==="teleporter"?"[--scale:1.25]":"[--scale:1.5]";if(t.type==="lift")return p.jsxs(p.Fragment,{children:[p.jsx(Xa,{className:`${r} texture-lift_static`}),p.jsx(Xa,{className:`${r} texture-lift_2`})]});const s=t.type==="teleporter"?"texture-teleporter":t.type==="hushPuppy"?"texture-hushPuppy":t.config.gives==="extra-life"||t.config.gives==="fast"||t.config.gives==="jumps"||t.config.gives==="shield"?"texture-whiteRabbit":t.config.gives==="doughnuts"?"texture-doughnuts":t.config.gives==="hooter"?"texture-hooter":t.config.gives==="bag"?"texture-bag":t.config.gives==="reincarnation"?"texture-animated-fish":t.config.gives==="crown"?t.config.planet==="blacktooth"?"texture-crown_blacktooth":t.config.planet==="egyptus"?"texture-crown_egyptus":t.config.planet==="penitentiary"?"texture-crown_penitentiary":t.config.planet==="safari"?"texture-crown_safari":t.config.planet==="bookworld"?"texture-crown_bookworld":"texture-crown_dark":"texture-block_organic";return p.jsx(Xa,{className:`${r} ${s}`})},RD=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:0,y:.5},{x:.5,y:.5},{x:1,y:.5},{x:0,y:1},{x:.5,y:1},{x:1,y:1}],MD=({x:t,y:e},{x:r,y:s})=>(t-r)**2+(e-s)**2,ID=(t,e)=>{const r=t%3,s=Math.floor(t/3),n=e%3,i=Math.floor(e/3);return Math.abs(r-n)<=1&&Math.abs(s-i)<=1&&t!==e},fA=t=>t.some((e,r)=>t.slice(r+1).some(s=>ID(e,s))),Fi=(t,e)=>{if(e===0)return[[]];if(t.length<e)return[];const[r,...s]=t;return[...Fi(s,e),...Fi(s,e-1).map(n=>[r,...n])]},uq=t=>t.length<=1?[t]:t.flatMap((e,r)=>uq([...t.slice(0,r),...t.slice(r+1)]).map(s=>[e,...s])),pA={1:Fi([...Array(9).keys()],1),2:Fi([...Array(9).keys()],2).filter(t=>!fA(t)),3:Fi([...Array(9).keys()],3).filter(t=>!fA(t))},nd=3,hq=({items:t,itemNormalisedPosition:e})=>{const r=ko(t),s=r.length;if(s===0)return pe;if(s>nd)throw new Error(`roomItemPositions supports up to ${nd} items, but got ${s}: ${Object.keys(t).join(", ")}`);const n=r.map(([a,l])=>({id:a,pos:e(l)}));let i=pe,o=1/0;if(pA[s]===void 0)throw new Error(`no precomputed valid grid index combinations for count ${s}`);for(const a of pA[s]){const l=a.map(c=>RD[c]);for(const c of uq(l)){const u={};let h=0;for(let d=0;d<s;d++){const{id:f,pos:m}=n[d],y=c[d];u[f]=y,h+=MD(m,y)}h<o&&(o=h,i=u)}}return i},dq=({items:t,positions:e,ItemComponent:r})=>p.jsx("g",{"data-class":"items",children:ko(e).sort(([s,n],[i,o])=>o.y-n.y+(o.x-n.x)).map(([s,n])=>p.jsx("g",{"data-position":JSON.stringify(n),transform:`${Hf(vx(n,G*.5))} translate(0,-3)`,children:p.jsx(r,{item:t[s]})},s))}),jD=(t,e)=>{if(t==="*"){const r=lq(e);if(r===void 0)throw new Error(`no floors in room ${e.id} when trying to get start and end for subroom ${t}`);return r}else{if(!e.meta?.subRooms)throw new Error(`no subrooms in ${e.id} when trying to get start and end for subroom ${t}`);return e.meta.subRooms[t].physicalPosition}},OD=({items:t,roomJson:e,subRoomId:r})=>{const s=v.useMemo(()=>hq({items:t,itemNormalisedPosition:i=>{const o={...i.config.times??pe,...SD},a=Kr(i.position,Wt(o,.5)),l=jD(r,e);return{x:(a.x-l.from.x)/(l.to.x-l.from.x),y:(a.y-l.from.y)/(l.to.y-l.from.y)}}}),[t,e,r]);return p.jsx(dq,{ItemComponent:TD,items:t,positions:s})},ND=({headItemInRoom:t,heelsItemInRoom:e,roomJson:r,currentCharacterName:s,onClick:n})=>{const i=v.useMemo(()=>({item:{type:l,state:{facing:c}}})=>p.jsx(Ti,{characterName:l,facing:c,isCurrent:s===l,onlyPlayableInRoom:!1,onClick:n}),[s,n]),o=v.useMemo(()=>({head:t,heels:e}),[t,e]),a=v.useMemo(()=>hq({items:o,itemNormalisedPosition:c=>{const u=hA(c),h=Sx(hA(c),{x:1/W.x,y:1/W.y,z:1}),d=lq(r);if(d===void 0)throw new Error(`no floors in room ${r.id} when trying to get item position`);return{x:dA(h.x,d.from.x,d.to.x),y:dA(u.y,d.from.y,d.to.y)}}}),[o,r]);return p.jsx(dq,{ItemComponent:i,items:o,positions:a})},BD=(t,e,r)=>xD(t,e,r)&&(t.type==="teleporter"||t.type==="hushPuppy"||t.type==="lift"||t.type==="pickup"&&t.config.gives!=="scroll"),zD=(t,e)=>{const r=Object.entries(t);if(r.length<=e)return t;const s=Object.groupBy(r,i=>i[1].type),n=X_(e,G_(...Nr(s)));return Object.fromEntries(n)},DD=(t,e,r)=>v.useMemo(()=>{let s=!1,n=!1;const i=Ge(ko(t.items)).filter(([o,a])=>!e[o]).filter(([o,a])=>{if(a.type==="hushPuppy"){if(s)return!1;s=!0}if(a.type==="pickup"&&a.config.gives==="crown"){if(n)return!1;n=!0}return!0}).filter(o=>BD(o[1],r,t));return zD(Un(i),nd)},[t,e,r]),fq=.15,Ia=Ne(Gt({x:.5,y:.5,z:0})),mA=Ne(Gt({x:fq,y:0,z:0})),gA=Ne(Gt({x:fq*1.66,y:0,z:0})),LD=({className:t})=>p.jsxs(p.Fragment,{children:[p.jsx("ellipse",{className:"fill-white",cx:Ia.x,cy:Ia.y,rx:Math.abs(gA.x),ry:Math.abs(gA.y)}),p.jsx("ellipse",{className:t,cx:Ia.x,cy:Ia.y,rx:Math.abs(mA.x),ry:Math.abs(mA.y)})]}),Ut=3,yA=_x(Ne({x:G,y:0})),ja={wall:void 0,open:"0,999",doorway:`${On(yA*((1-xo)/2)-Ut/2)}, ${On(yA*xo+Ut)}, 999`},Hu=`
M ${H({})}
L ${H({y:G})}
L ${H({x:G,y:G})}
L ${H({x:G})}
z`,Oa=(t,e=xo)=>{const r=G*((1-e)/2),s=G-r,n=t.away!=="wall",i=t.towards!=="wall",o=t.left!=="wall",a=t.right!=="wall";let l=`M${H({x:r,y:r})}`;return a&&(l+=`L${H({x:0,y:r})} L${H({x:0,y:s})}`),l+=`L${H({x:r,y:s})}`,n&&(l+=`L${H({x:r,y:G})} L${H({x:s,y:G})}`),l+=`L${H({x:s,y:s})}`,o&&(l+=`L${H({x:G,y:s})} L${H({x:G,y:r})}`),l+=`L${H({x:s,y:r})}`,i&&(l+=`L${H({x:s,y:0})} L${H({x:r,y:0})}`),l+="z",l},Gu=4,FD=Ge(Nx(Gu)).map(t=>`
M${H({x:G*((t+.5)/Gu),y:0})}
L${H({x:G*((t+.5)/Gu),y:G})}`).toArray().join(""),AA=t=>{const e=`
M${H({x:0,y:G})}
L${H({x:0,y:G,z:Er})}
L${H({x:G,y:G,z:Er})}
L${H({x:G,y:G})}
z
`;return t?e+`
M${H({x:_t,y:G})}
L${H({x:_t,y:G,z:Er})}
L${H({x:vt,y:G,z:Er})}
L${H({x:vt,y:G})}
L${H({x:_t,y:G})}`:e},UD=`            
M${H({x:G,y:G,z:Er})}            
L${H({x:G,y:G})}            
M${H({x:G,y:0,z:Er})}            
L${H({x:G,y:0})}            
M${H({x:0,y:G,z:Er})}            
L${H({x:0,y:G})}            
`,$D=`            
M${H({x:0,y:0,z:Er})}            
L0, 0            
`,HD=({roomGridPositionSpec:{boundaries:t,subRoomId:e},roomPickupsCollected:r,roomJson:s,roomVisited:n,headItemInRoom:i,heelsItemInRoom:o,headOverHeelsItemInRoom:a,currentCharacterName:l,onPlayableClick:c,onRoomClick:u})=>{const{id:h,roomAbove:d,color:f,items:m}=s,y=s.meta?.label,g=DD(s,r,e),A=Object.values(m).filter(w=>w.type==="floor"),b=A.every(w=>w.config.floorType==="none"),x=A.some(w=>w.config.floorType==="deadly");return p.jsxs("g",{"data-room-id":h,strokeWidth:Ut,className:wD(f),children:[b?p.jsxs(p.Fragment,{children:[p.jsx("path",{className:"fill-[var(--roomHintColor)]",fillRule:"evenodd",d:`${Hu} ${Oa(t)}`}),p.jsx("path",{className:"fill-white",fillRule:"evenodd",d:`${Oa(t)} ${Oa(t,xo*.7)}`})]}):p.jsxs(p.Fragment,{children:[p.jsx("path",{className:"fill-[var(--roomHintColor)]",d:Hu}),p.jsx("path",{className:"fill-white",d:Oa(t)}),x&&p.jsx("path",{className:"stroke-[var(--roomHintColor)]",strokeDasharray:"1, 12.4",d:FD})]}),s.id==="blacktooth11"?p.jsx("path",{className:"fill-[var(--roomHintColor)]",d:`
M${H({x:_t,y:_t})}
L${H({x:vt,y:_t})}
L${H({x:vt,y:_t-Ut*2})}
L${H({x:_t,y:_t-Ut*2})}
z
M${H({x:_t,y:vt})}
L${H({x:vt,y:vt})}
L${H({x:vt,y:vt+Ut*2})}
L${H({x:_t,y:vt+Ut*2})}
z
`}):s.id==="moonbase20"||s.id==="moonbase23"?p.jsx("path",{className:"stroke-[var(--roomHintColor)]",strokeWidth:Ut*2,d:`
M${H({x:_t,y:G/2})}
L${H({x:vt,y:G/2})}

M${H({x:G/2,y:_t})}
L${H({x:vt,y:G/2})}

M${H({x:G/2,y:vt})}
L${H({x:vt,y:G/2})}
`}):s.id==="blacktooth77"||s.id==="safari26"?p.jsx("path",{className:"fill-[var(--roomHintColor)]",strokeWidth:1,d:`
M${H({x:G/2-Ut,y:0})}
L${H({x:G/2+Ut,y:0})}
L${H({x:G/2+Ut,y:G})}
L${H({x:G/2-Ut,y:G})}
z
`}):null,d&&p.jsxs(p.Fragment,{children:[p.jsx("path",{className:"fill-[var(--roomHintColorDarker)]",fillRule:"evenodd",d:AA(t.away==="doorway")}),p.jsx("path",{className:"fill-[var(--roomHintColor)]",fillRule:"evenodd",transform:"scale(-1, 1)",d:AA(t.left==="doorway")})]}),p.jsxs("g",{className:"fill-transparent stroke-midGreyHalfbrite",children:[p.jsx("path",{d:`M${H({x:0,y:G})} L0, 0`,"data-direction":"right","data-boundary":t.right,strokeDasharray:ja[t.right]}),p.jsx("path",{d:`M${H({x:G,y:0})} L${H({x:G,y:G})}`,"data-direction":"left","data-boundary":t.left,strokeDasharray:ja[t.left]}),p.jsx("path",{d:`M${H({x:G,y:0})} L0, 0`,"data-direction":"towards","data-boundary":t.towards,strokeDasharray:ja[t.towards]}),p.jsx("path",{d:`M${H({x:0,y:G})} L${H({x:G,y:G})}`,"data-direction":"away","data-boundary":t.away,strokeDasharray:ja[t.away]})]}),n&&p.jsx(LD,{className:"fill-[var(--roomHintColor)]"}),d&&p.jsx("path",{className:"fill-transparent stroke-midGreyHalfbrite",d:UD}),i&&o?p.jsx(ND,{roomJson:s,currentCharacterName:l,headItemInRoom:i,heelsItemInRoom:o,onClick:c}):i?p.jsx(Ti,{characterName:"head",isCurrent:l==="head",onlyPlayableInRoom:!0,facing:i.state.facing,yAdjust:-8,onClick:c}):o?p.jsx(Ti,{characterName:"heels",isCurrent:l==="heels",onlyPlayableInRoom:!0,facing:o.state.facing,yAdjust:-8,onClick:c}):a?p.jsxs(p.Fragment,{children:[p.jsx(Ti,{characterName:"heels",onlyPlayableInRoom:!1,facing:a.state.facing,yAdjust:-16,isCurrent:!0}),p.jsx(Ti,{characterName:"head",onlyPlayableInRoom:!1,facing:a.state.facing,isCurrent:!0,yAdjust:-36})]}):p.jsx(OD,{roomJson:s,subRoomId:e,items:g}),d&&p.jsx("path",{className:"fill-transparent stroke-midGreyHalfbrite",d:$D}),y&&p.jsx("g",{transform:Hf(Gt(Kr(y.gridOffset,{x:.5,y:.5}))),children:p.jsx("foreignObject",{width:y.text.length*16,height:kM.h*2,y:-8,x:y.align==="left"?0:y.text.length*-16,children:p.jsx(j,{noTint:!0,className:"[--scale:2] [--block:16px]",children:y.text})})}),u?p.jsx("path",{className:"fill-transparent cursor-pointer",d:Hu,onClick:()=>{u(h)}}):null]})},Wu=(t,e,r,s)=>{const n=td(e,t[e]?.items);return n&&r===t[e].roomJson.id&&s===$f(n.state.position,"fine",t[e].roomJson)?n:void 0},GD=t=>{const{campaign:e,pickupsCollected:r,gridPositions:s,currentCharacterName:n,characterRooms:i,mapBounds:o,containerWidth:a,roomsExplored:l,onPlayableClick:c,curRoomId:u,onRoomClick:h}=t;if(a===void 0)return null;const d=o.r-o.l+2*bo,f=o.b-o.t+2*ks,m=Object.values(s);return p.jsxs("svg",{className:"w-full",style:{minWidth:`${d}px`,height:`${f}px`},strokeLinecap:"round",strokeLinejoin:"round",children:[u===void 0?null:p.jsx(_D,{...t,curRoomId:u,containerWidth:a}),p.jsx("g",{transform:`translate(${-o.l+bo+(a-d)/2},${-o.t+ +ks})`,children:m.map(y=>{const{roomId:g,subRoomId:A,gridPosition:b}=y,x=`${g}/${A}`;return p.jsxs("g",{"data-id":x,transform:Hf(Gt(b)),children:[p.jsx(HD,{roomGridPositionSpec:y,roomPickupsCollected:r[g]??pe,roomJson:e.rooms[g],headItemInRoom:Wu(i,"head",g,A),heelsItemInRoom:Wu(i,"heels",g,A),headOverHeelsItemInRoom:Wu(i,"headOverHeels",g,A),currentCharacterName:n,roomVisited:l[g]??!1,onPlayableClick:c,onRoomClick:h}),u===g?p.jsx(cq,{svg:!0,smooth:!0}):null]},x)})})]})},WD=t=>{const{inputStateTracker:e}=t;return e.currentActionPress("swop")==="tap"?(Qa(t),!0):e.currentActionPress("swop.head")==="tap"?(Qa(t,"head"),!0):e.currentActionPress("swop.heels")==="tap"?(Qa(t,"heels"),!0):!1},KD=()=>{const t=Ln(),[e,r]=v.useState(t.gameState.currentCharacterName);return v.useEffect(()=>{const s=()=>{r(t.gameState.currentCharacterName)};return gt.shared.add(s),()=>{gt.shared.remove(s)}},[t.gameState]),e},YD=()=>{const t=Ln();v.useEffect(()=>{const e=()=>{WD(t.gameState)};return gt.shared.add(e),()=>{gt.shared.remove(e)}},[t.gameState])},QD=t=>t.characterRooms[t.currentCharacterName],id=t=>JSON.parse(JSON.stringify(t)),XD=()=>er().get("cheats")==="1",JD=(t,e)=>{const r=new URL(e),s=r.hash.substring(1);if(s!==""&&t.rooms[s]!==void 0)return r.hash.substring(1)},ZD=t=>Ne(t),e2=(t,e)=>Ne(U(t,{x:e.x,z:e.z})),t2=(t,e)=>Ne(U(t,{y:e.y,z:e.z})),xA=(t,e,r)=>{const s=e2(e,r),n=t2(e,r),i=ZD(e),o=t;return o.xAxisProjectionMin=n.y-n.x/2,o.xAxisProjectionMax=i.y-i.x/2,o.yAxisProjectionMin=s.y+s.x/2,o.yAxisProjectionMax=i.y+i.x/2,o.zAxisProjectionMin=s.x,o.zAxisProjectionMax=n.x,o},bA=W.x*2,wA=W.x*2,VA=W.x*2,qA=W.x*2;class pq{#e=new Map;#t=new Map;#r=new Map;#s=new Map;#n=new Map;constructor(e){if(e)for(const r of e)this.addItem(r)}#i(e,r,s,n){const i=new Set;for(const o of r)n(o).add(e),i.add(o);s.set(e,i)}#o(e,r,s){const n=s.get(e);if(s.delete(e),!!n)for(const i of n){const o=r.get(i);o&&(o.delete(e),o.size===0&&r.delete(i))}}#l(e,r,s,n,i){const o=n.get(e);if(!o)throw new Error(`Item ${e.id} not in index`);const a=new Set(r);let l=!1,c=!1;for(const u of o)if(!a.has(u)){const h=s.get(u);h&&(l=!0,h.delete(e))}for(const u of a)o.has(u)||(i(u).add(e),c=!0);if(l)for(const u of o){const h=s.get(u);h&&h.size===0&&s.delete(u)}l||c?n.set(e,a):a.clear()}addItem(e){if(this.#r.has(e)){const r=this.#r.get(e);throw new Error(`Item ${e.id} is already in the spatial index at ${[...r].join(" ")}`)}this.#i(e,this.#u(e.state.position,e.aabb),this.#r,r=>this.#a(r)),this.#f(e),this.#i(e,this.#h(e),this.#s,r=>this.#d(r))}#c(e,r){return`${e},${r}`}#a(e){let r=this.#e.get(e);return r||(r=new Set,this.#e.set(e,r)),r}#d(e){let r=this.#t.get(e);return r||(r=new Set,this.#t.set(e,r)),r}*#u(e,r){const s=e,n=U(e,r),i=Math.floor(s.x/wA),o=Math.floor(s.y/bA),a=Math.floor(n.x/wA),l=Math.floor(n.y/bA);for(let c=i;c<=a;c++)for(let u=o;u<=l;u++)yield this.#c(c,u)}#f(e){const r=e.renderAabbOffset?U(e.state.position,e.renderAabbOffset):e.state.position,s=e.renderAabb||e.aabb,n=this.#n.get(e);if(n!==void 0)return xA(n,r,s),n;{const i=xA({},r,s);return this.#n.set(e,i),i}}*#h(e){const r=this.#n.get(e);if(r===void 0)throw new Error("projectionAxes not calculated for "+e.id);const{xAxisProjectionMin:s,xAxisProjectionMax:n,yAxisProjectionMin:i,yAxisProjectionMax:o}=r,a=Math.floor(s/qA),l=Math.floor(i/VA),c=Math.floor(n/qA),u=Math.floor(o/VA);for(let h=a;h<=c;h++)for(let d=l;d<=u;d++)yield this.#c(h,d)}removeItem(e){if(!this.#r.has(e))throw new Error(`Item ${e.id} is not in the spatial index`);this.#o(e,this.#e,this.#r),this.#o(e,this.#t,this.#s),this.#n.delete(e)}updateItemSpatialIndex(e){this.#l(e,this.#u(e.state.position,e.aabb),this.#e,this.#r,r=>this.#a(r))}updateItemProjectedIndex(e){this.#f(e),this.#l(e,this.#h(e),this.#t,this.#s,r=>this.#d(r))}getCuboidNeighbourhood(e,r,s){const n=new Set;for(const i of this.#u(e,r)){const o=this.#e.get(i);if(o)for(const a of o)a!==s&&n.add(a)}return n}getProjectedNeighbourhood(e,r){const s=new Set;for(const n of this.#h(e)){const i=this.#t.get(n);if(i)for(const o of i)o!==r&&s.add(o)}return s}getItemCuboidNeighbourhood(e){return this.getCuboidNeighbourhood(e.state.position,e.aabb,e)}getItemProjectedNeighbourhood(e){return this.getProjectedNeighbourhood(e,e)}getItemAxesProjections(e){return this.#n.get(e)}debugToString(){const r=Array.from(this.#e.keys()).sort().map(i=>{const o=this.#e.get(i),a=Array.from(o).map(l=>l.id);return`  (${i}) => [${a.join(", ")}]`}),n=Array.from(this.#t.keys()).sort().map(i=>{const o=this.#t.get(i),a=Array.from(o).map(l=>l.id);return`  (${i}) => [${a.join(", ")}]`});return`GridSpatialIndex (${this.#e.size} 2D cells, ${this.#t.size} projected cells, ${this.#r.size} items) {
  2D Cells:
${r.join(`,
`)}
  Projected Cells:
${n.join(`,
`)}
}`}}const mq=(t,e,r,s)=>!(t.x+e.x<=r.x||t.x>=r.x+s.x)&&!(t.y+e.y<=r.y||t.y>=r.y+s.y)&&!(t.z+e.z<=r.z||t.z>=r.z+s.z),Gf=({aabb:t,state:{position:e}},{aabb:r,state:{position:s}})=>mq(e,t,s,r),r2=t=>!0;function*Cs(t,e,r=r2){const s=e.getItemCuboidNeighbourhood(t);for(const n of s)r(n)&&Gf(t,n)&&(yield n)}const vA=(t,e)=>({x:t.x>0?e.state.position.x:e.state.position.x+e.aabb.x,y:t.y>0?e.state.position.y:e.state.position.y+e.aabb.y,z:t.z>0?e.state.position.z:e.state.position.z+e.aabb.z}),_A={stopAutowalk:5,portal:5,wall:5,blocker:5,doorLegs:5,sceneryPlayer:5,bubbles:5,switch:10,button:10,doorFrame:15,ball:18,block:20,barrier:20,floor:20,hushPuppy:20,teleporter:20,lift:30,movingPlatform:30,pushableBlock:30,portableBlock:30,sceneryCrown:30,slidingBlock:30,spring:30,joystick:40,charles:40,conveyor:40,head:50,heels:50,headOverHeels:50,pickup:80,firedDoughnut:90,spikes:98,slidingDeadly:100,moveableDeadly:100,deadlyBlock:100,monster:100,floatingText:200,particle:200,emitter:200},gq=(t,e)=>_A[t.type]-_A[e.type],s2=(t,e)=>e.toSorted((r,s)=>{const n=gq(r,s);if(n!==0)return n;const i=il(t,vA(t,r)),o=il(t,vA(t,s));return Math.abs(i-o)<1e-4?r.id<s.id?-1:1:i-o}),n2=(t,e,r,s)=>{const n=Math.max(0,Math.min(t.x+e.x,r.x+s.x)-Math.max(t.x,r.x)),i=Math.max(0,Math.min(t.y+e.y,r.y+s.y)-Math.max(t.y,r.y));return n*i},SA=({state:{position:t},aabb:e},{state:{position:r},aabb:s})=>n2(t,e,r,s),ds={state:{position:{x:0,y:0,z:0}},aabb:{x:0,y:0,z:0}},fs={state:{position:{x:0,y:0,z:0}},aabb:{x:0,y:0,z:0}},i2=(t,e,r=.001)=>{if(!Qr(e,t)||t.id===e.id)return!1;const{state:{vels:{gravity:{z:s}}}}=t;return s>0?!1:(ds.state.position.x=t.state.position.x,ds.state.position.y=t.state.position.y,ds.state.position.z=t.state.position.z-Wr,ds.aabb.x=t.aabb.x,ds.aabb.y=t.aabb.y,ds.aabb.z=r+Wr,fs.state.position.x=e.state.position.x,fs.state.position.y=e.state.position.y,fs.state.position.z=e.state.position.z+e.aabb.z,fs.aabb.x=e.aabb.x,fs.aabb.y=e.aabb.y,fs.aabb.z=0,Gf(ds,fs))},o2=(t,e)=>{const s=[...Ge(e).filter(i=>i2(t,i))];return s.length===0?void 0:s.reduce((i,o)=>{const a=gq(o,i);return a<0||a===0&&SA(t,o)>SA(t,i)?o:i})},Na=W.z,a2=-W.z,l2=t=>{const e=Ot(t).filter(tq).reduce((r,{config:{naturalFootprint:{position:{x:s,y:n},aabb:{x:i,y:o}}}})=>{const a=s+i,l=n+o;return{minX:Math.min(r.minX,s),maxX:Math.max(r.maxX,a),minY:Math.min(r.minY,n),maxY:Math.max(r.maxY,l)}},{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0});if(!(e.minX>e.maxY))return e};function*c2(t,e){const r=l2(e);if(r===void 0)return;const{minX:s,maxX:n,minY:i,maxY:o}=r;t.roomBelow!==void 0&&(yield{...ct,type:"portal",id:"portal/toRoomBelow",fixedZIndex:Xr,config:{toRoom:t.roomBelow,relativePoint:{x:(s+n)/2,y:(i+o)/2,z:Na+W.z},direction:de.down},aabb:{x:n-s,y:o-i,z:Na},state:{...Ye(),position:{x:s,y:i,z:a2-Na}},renders:!1}),t.roomAbove!==void 0&&(yield{...ct,type:"portal",id:"portal/toRoomAbove",fixedZIndex:Xr,config:{toRoom:t.roomAbove,relativePoint:{...t.ceilingRelativePoint!==void 0?je(t.ceilingRelativePoint):{x:(s+n)/2,y:(i+o)/2},z:-W.z},direction:de.up},aabb:{x:n-s,y:o-i,z:Na},state:{...Ye(),position:U({x:s,y:i},{z:W.z*(t.height??Pj)})}})}const u2={x:-9/12,y:-9/12},h2=je({x:9/12,y:9/12,z:1}),kA=(t,e)=>{const r=`${t.position.x},${t.position.y}`;let s=e.get(r);s===void 0&&(s=new Map,e.set(r,s)),s.set(t.config.direction,t)};function*d2(t){const e=new Map,r=new Map;for(const s of aq(t))switch(s.type){case"wall":kA(s,e);break;case"door":kA(s,r);break}for(const[s,n]of e.entries()){const i=n.get("right"),o=n.get("towards");if(!i||!o)continue;const a=U(i.position,Rn(i.config),{x:-1});if(r.get(`${a.x},${a.y}`)?.get("right")===void 0)continue;const l=U(o.position,Rn(o.config),{y:-1});if(r.get(`${l.x},${l.y}`)?.get("towards")===void 0)continue;const c=i.position;yield{id:`extraCornerShadow-${s}`,type:"blocker",state:{...Ye(),position:je(U(c,u2))},shadowCastTexture:{textureId:"shadow.wallCorner",spritesheetVariant:"original"},castsShadowWhileStoodOn:!0,config:pe,aabb:h2,fixedZIndex:Xr}}}function*f2(t,e,r,s){const n=ko(t.items);for(const[i,o]of n)o.type==="player"&&!s||(yield*Ff(i,o,t,e,r))}const Ku=t=>Ge(t).reduce((e,r)=>({...e,[r.id]:r}),{}),od=({roomJson:t,roomPickupsCollected:e,scrollsRead:r,isNewGame:s=!1})=>{const n=Ku(f2(t,e,r,s)),i={...Ku(c2(t,n)),...n,...Ku(d2(t))},o=new pq(Ot(i));for(const l of Ot(i)){const u=Cs(l,o).find(h=>Qr(l)&&Qr(h)&&!(l.type==="wall"&&h.type==="wall"));u!==void 0&&console.error(`in room ${t.id} item ${l.id} @${JSON.stringify(l.state.position)} #${JSON.stringify(l.aabb)} is colliding with (solid item) ${u.id} @${JSON.stringify(u.state.position)} #${JSON.stringify(u.aabb)} on loading room ${t.id}`)}for(const l of Ot(i).filter(Ts)){const c=o2(l,Ot(i).filter(u=>u.id!==l.id));c!==void 0&&Uf({above:l,below:c})}return{...t,roomJson:t,items:i,roomTime:0,[Ht]:o}},Pr=(t,e,r)=>{const s=t[Ht];e.state.position=r,s.updateItemSpatialIndex(e)},p2=.5,m2=(t,e,r,s,n,i)=>{if(Fn(n)<1e-4)return Object.assign(i,ee),i;const a=n_(n);if(!mq(t,e,r,s))return Object.assign(i,ee),i;let l=-1/0,c=1/0;for(const u of l_){const h=a[u];if(Math.abs(h)<1e-4){const w=t[u],q=t[u]+e[u],_=r[u],V=r[u]+s[u];if(q<=_||w>=V)return Object.assign(i,ee),i;continue}const d=r[u],f=r[u]+s[u],m=t[u],y=t[u]+e[u],g=(d-y)/h,A=(f-m)/h,b=Math.min(g,A),x=Math.max(g,A);l=Math.max(l,b),c=Math.min(c,x)}return l>c?(Object.assign(i,ee),i):c>0&&(l>=0||c<-l)?Sp(i,a,c):l<0?Sp(i,a,l):(Object.assign(i,ee),i)},g2=(t,e,r,s,n)=>m2(t,e,r,s,n,{}),y2=(t,e,r,s,n)=>{const i=r.x+s.x-t.x,o=r.y+s.y-t.y,a=r.z+s.z-t.z,l=t.x+e.x-r.x,c=t.y+e.y-r.y,u=t.z+e.z-r.z,h=Math.abs(i)<Math.abs(l)?i:-l,d=Math.abs(o)<Math.abs(c)?o:-c,f=Math.abs(a)<Math.abs(u)?a:-u,m=Math.abs(h),y=Math.abs(d),g=Math.abs(f)*p2;return m<y&&m<g?(n.x=h,n.y=0,n.z=0,n):y<g?(n.x=0,n.y=d,n.z=0,n):(n.x=0,n.y=0,n.z=f,n)},ad=(t,e,r,s)=>y2(t,e,r,s,{}),CA=(t,e,r)=>{const s=e.state.actedOnAt;s!==void 0&&(s.roomTime===r.roomTime?t&&(s.by[t.id]=!0):(s.by=t?{[t.id]:!0}:{},s.roomTime=r.roomTime))},A2=(t,e,r)=>{const s=(n,i)=>{const{collidedWith:o}=n.state;o.roomTime===r.roomTime?o.by[i.id]=!0:(o.by={[i.id]:!0},o.roomTime=r.roomTime)};s(t,e),Ts(e)&&s(e,t)},x2=(t,e,r,s)=>{const n=Bf(t,e,r),i=ad(t.state.position,t.aabb,e.state.position,e.aabb);if(n&&i.z===0){const o=Mr(s,t.state.position),a=r_(o),l=il(i,o)/a;if(o.z=0,l>.44)return g2(t.state.position,t.aabb,e.state.position,e.aabb,o)}return i},Ui=.1,ur={id:"sensor",aabb:{x:0,y:0,z:0},state:{position:{x:0,y:0,z:0}}},tn={id:"sensor",aabb:{x:Ui,y:Ui,z:Ui},state:{position:{x:0,y:0,z:0}}},b2=5/12,w2=6/12,V2=1,q2=1/12,v2=0,_2=1,S2=2,k2=3,Yu=4,EA=.75,C2=(t,e,r,s,n,i)=>{if(i.length===0)return;const o=t.state.position,a=tr(r.x,0),l=tr(r.y,0);if(a===l)return;const c=Mr(o,e),u=s_(c)/s;if(!tr(u,0))return;const h=t.state.standingOnItemId===null;ur.state.position.z=o.z,ur.aabb.z=h?Wr:t.aabb.z;const d=a?"y":"x",m=i.some(k=>k.type==="doorFrame")?q2:h?t.state.vels.gravity.z<0?w2:V2:b2;ur.state.position[d]=t.state.position[d]+(r[d]<0?-Ui:t.aabb[d]),ur.aabb[d]=Ui;const y=Bl(d),g=m*t.aabb[y];ur.aabb[y]=g,ur.state.position[y]=t.state.position[y];const A=(k,C)=>{const E=C===t||!Qr(C)?v2:C.type==="doorFrame"?_2:Bf(t,C)?S2:Cz(C)?Yu:k2;return Math.max(k,E)},b=Cs(ur,n[Ht]).reduce(A,0);if(b===Yu)return;tn.state.position.z=t.state.position.z-1,tn.state.position[d]=ur.state.position[d],tn.state.position[y]=t.state.position[y];const x=Cs(tn,n[Ht]).filter(k=>Qr(k)&&!(Sl(t)&&nA(k))),w=h||!rm(x);ur.state.position[y]=t.state.position[y]+t.aabb[y]-g;const q=Cs(ur,n[Ht]).reduce(A,0);if(q===Yu)return;tn.state.position[y]=t.state.position[y]+t.aabb[y]-1;const _=Cs(tn,n[Ht]).filter(k=>Qr(k)&&!(Sl(t)&&nA(k))),V=h||!rm(_);if(b===q)return;const S=b>q;if(S){if(!V)return}else if(!w)return;return{x:a?r.y*(S?1:-1)*(r.y>0?1:-1)*EA:0,y:l?r.x*(S?1:-1)*(r.x>0?1:-1)*EA:0,z:0}},PA=void 0,E2={x:-1,y:-1,z:-1},P2={x:-.6,y:-.6,z:-.4},T2={x:-1,y:-1,z:-.4},ld=({subjectItem:t,posDelta:e,gameState:r,room:s,deltaMS:n,onTouch:i,visited:o=new Set,forceful:a=eq(t)&&o.size===0,isHelpful:l})=>{if(jd(e,ee))return!1;let c=!1;const{state:{position:u}}=t;Pr(s,t,U(u,e)),o.size===0&&CA(void 0,t,s);const h=s2(e,Cs(t,s[Ht]).toArray());for(const d of h){if(o.has(d.id)||!Gf(t,d))continue;if(CA(t,d,s),i!==void 0&&PA&&console.group(`handling onTouch() callback for ${t.id} touching ${d.id}`),i?.({movingItem:t,touchedItem:d,movementVector:Mr(t.state.position,u),gameState:r,deltaMS:n,room:s}),i!==void 0&&PA&&console.groupEnd(),s.items[t.id]===void 0)return c;if(s.items[d.id]===void 0||!Qr(d,t)||!Qr(t))continue;const f=Bf(t,d,a),m=x2(t,d,a,u),y=tr(Fn(ad(u,t.aabb,d.state.position,d.aabb)),0);if(f){const g=a?E2:wz(d)?T2:P2,A=Sx(m,g);if(Pr(s,t,U(t.state.position,m,A)),o.size<Rj?(c||=ld({subjectItem:d,posDelta:A,gameState:r,room:s,deltaMS:n,forceful:a,visited:o.add(t.id),onTouch:i}),o.delete(t.id)):console.warn("hit recursion depth limit",new Error),s.items[d.id]===void 0)continue;Pr(s,t,U(t.state.position,ad(t.state.position,t.aabb,d.state.position,d.aabb)))}else Pr(s,t,U(t.state.position,m));Ts(t)&&m.z>0&&e.z<0&&(t.state.standingOnItemId===null||!h.includes(sq(t.state.standingOnItemId,s)))&&(sd(t,s),Uf({above:t,below:d})),Ts(t)&&!y&&A2(t,d,s)}if(Ts(t)&&!c&&!l){const d=C2(t,u,e,n,s,h);d&&(ld({subjectItem:t,posDelta:d,gameState:r,room:s,deltaMS:n,forceful:!1,onTouch:i,isHelpful:!0,visited:o.add(t.id)}),o.delete(t.id),c=!0)}return c},cd=({state:{position:t,facing:e,autoWalk:r,action:s,vels:n}})=>({position:t,facing:e,autoWalk:r,action:s,vels:{...n}}),R2=t=>{let e=2166136261;const r=t.length;for(let s=Math.max(0,r-9);s<r;s++)e^=t.charCodeAt(s),e=Math.imul(e,1540483477),e^=e>>>15;return(e>>>0)/4294967295},M2=1e3/25,yq=t=>{const e=pt.animations[t],r=e.length,{animationSpeed:s}=e;return r*M2/s};yq("bubbles.white");const I2=yq("head.fadeOut"),j2=({touchedItem:t,room:e,gameState:r})=>{jn({room:e,item:t});const s=jz(t),n=t.type==="pickup"?{type:"pickup",gives:t.config.gives}:t.type==="hushPuppy"?{type:"hushPuppy"}:{type:"disappearing"},i=Wt(Df(t).aabb,.5);for(let o=0;o<s.x;o++)for(let a=0;a<s.y;a++)for(let l=0;l<s.z;l++){const c=`${t.id}/${o},${a},${l}`,u=hD({itemType:"bubbles",config:{style:"white",was:n},position:ee,room:e,gameState:r,additionalIdPart:c}),h={x:o*W.x,y:a*W.y,z:l*W.z},d=U(t.state.position,h,i);Pr(e,u,Mr(d,Wt(u.aabb,.5)));const f=R2(c)*.5+.75;u.state.expires=e.roomTime+I2*f}},O2=(t,e)=>{const r=Ot(t.items).filter(Ez);for(const s of r)j2({touchedItem:s,gameState:e,room:t})},N2=(t,e,{changeType:r,sourceItem:s})=>{switch(r){case"portal":return Ot(t.items).find(n=>qs(n)&&n.config.toRoom===e.id&&(s.config.toDoor===void 0||n.jsonItemId===s.config.toDoor)&&jd(Wt(s.config.direction,-1),n.config.direction));case"level-select":return Ot(t.items).find(n=>qs(n)&&n.config.toRoom===e.id&&n.config.direction.z===0)??Ot(t.items).find(n=>qs(n)&&n.config.direction.z===0)??Ot(t.items).find(n=>qs(n)&&n.config.direction.z>0)??Ot(t.items).find(qs)}},B2=(t,e,r,s)=>{const n=1*W.x;Pr(s,t,U(t.state.position,Wt(e,n)));for(let i=0;i<n;i++)ld({subjectItem:t,posDelta:Wt(e,-1),gameState:r,room:s,deltaMS:16,forceful:!0,onTouch:void 0})},z2=t=>{const{playableItem:e,gameState:r,toRoomId:s,changeType:n,sourceItem:i}=t,o=r.characterRooms[e.id];if(o===void 0)throw new Error(`${e.id} is not in a room on the gameState`);if(s===o.id)throw new Error(`Can't move ${e.id} to the same room "${s}""`);let a;switch(n){case"portal":{const{config:{relativePoint:m},state:{position:y}}=i;a=Mr(e.state.position,U(y,m));break}case"teleport":{const{state:{position:m}}=i;a=Mr(e.state.position,m);break}case"level-select":a={x:0,y:0,z:0};break;default:throw new Error}const l=e.type==="headOverHeels"?void 0:r.characterRooms[An(e.id)],u=Iw(ce.getState()).rooms[s];if(u===void 0)throw new Error(`room ${s} does not exist in campaign`);const h=l?.id===s?l:od({roomJson:u,roomPickupsCollected:r.pickupsCollected[s]??pe,scrollsRead:ce.getState().gameMenus.gameInPlay.scrollsRead}),d=Pz(e);if(d!==void 0){const{carrying:m}=d;m!==null&&(In({room:o,item:m,atPosition:e.state.position}),d.carrying=null)}if(jn({room:o,item:e}),e.state.latentMovement=[],e.state.previousStandingOnItemId=null,e.state.standingOnUntilRoomTime=De,(e.type==="head"||e.type==="headOverHeels")&&O2(h,r),h.items[e.id]!==void 0&&jn({room:h,item:e}),In({room:h,item:e}),r.characterRooms[e.id]=h,t.changeType==="teleport"){const{state:{toPosition:m}}=t.sourceItem;Pr(h,e,U(je(m),a))}else{const m=N2(h,o,t);if(m===void 0)if(t.changeType==="level-select")Pr(h,e,je({x:1,y:1,z:8}));else throw new Error(`trying to move ${e.id} from ${o.id} --to-> ${s} but no destination portal found to locate with`);else{const y=U(m.state.position,m.config.relativePoint,a,n==="portal"&&i.config.direction.z>0?{z:W.z}:{});Pr(h,e,y);const{config:{direction:g}}=m;g.z===0&&(e.state.autoWalk=!0,e.state.facing=e.state.visualFacingVector=Wt(g,-1),e.state.action==="idle"&&(e.state.action="moving"),B2(e,g,r,h))}}const f=jx(Cs(e,h[Ht],m=>!qs(m)));f!==void 0&&console.warn("on entering room",s,"character",e.id,"at",e.state.position,"collides with (at least one; only first is shown) non-portal item:",f),r.entryState[e.id]=cd(e),e.id==="headOverHeels"?(delete r.entryState.head,delete r.entryState.heels):(r.entryState[An(e.id)]||(r.entryState[An(e.id)]=r.entryState.headOverHeels),delete r.entryState.headOverHeels),ce.dispatch(dM(s)),ce.dispatch(Nw({characterName:e.type,roomId:s}))},Aq=t=>{const e={};for(const r of Object.values(t.rooms))for(const s of Object.values(r.items))if(s.type==="player"){const{which:n}=s.config;if(e[n]!==void 0)throw new Error(`Campaign has duplicate starting rooms for ${n}`);e[n]=r.id}return e},D2=t=>{const e=Aq(t),r={...e};if(e.head===void 0&&e.heels===void 0)throw new Error("couldn't find either head or heels in campaign");let s=er().get("playAsHeels")==="1"?"heels":e.head!==void 0?"head":"heels";const n=XD()?JD(t,window.location.href):void 0;return n!==void 0&&(r[s]=n),r.head===void 0&&(s="heels"),{campaignStartingRoomIds:e,startingRoomIds:r,startAs:s,changedCharacterRoomFromCampaign:n!==void 0&&e[s]!==r[s]}},L2=t=>{for(const e of Nr(t)){const r=e;r[Ht]===void 0&&(r[Ht]=new pq(Ot(e.items)))}return t},F2=({campaign:t,inputStateTracker:e,savedGame:r,writeInto:s={}})=>{if(r){const m=r.gameState.characterRooms,y=id(m);return m.head!==void 0&&m.head.id===m.heels?.id&&(y.heels=y.head),Object.assign(s,{inputStateTracker:e,...id(r.gameState)}),s.characterRooms=L2(y),s}const{startAs:n,startingRoomIds:i,campaignStartingRoomIds:o,changedCharacterRoomFromCampaign:a}=D2(t),l={roomPickupsCollected:pe,scrollsRead:pe,isNewGame:!0},c=o.head&&od({roomJson:t.rooms[o.head],...l}),u=o.heels===o.head?c:o.heels&&od({roomJson:t.rooms[o.heels],...l}),h=c===void 0?void 0:td("head",c?.items),d=u===void 0?void 0:td("heels",u?.items),f=Object.assign(s,{inputStateTracker:e,currentCharacterName:n,entryState:{head:h===void 0?void 0:cd(h),heels:d===void 0?void 0:cd(d)},pickupsCollected:{},gameTime:0,freeCharacters:{},characterRooms:{head:c,heels:u,headOverHeels:void 0}});return a&&z2({changeType:"level-select",gameState:f,playableItem:n==="head"?h:d,toRoomId:i[n],sourceItem:void 0}),f},J$=t=>{try{return F2(t)}catch(e){throw new Error("failed to load game state",{cause:e})}},U2=Ne(Gt({x:1,y:1,z:1})).y,TA=Ne(Gt({x:0,y:1,z:0})).x,$2=t=>t.reduce((e,{gridPosition:r})=>{const s=Ne(Gt(r));return{t:Math.min(e.t,s.y+U2),b:Math.max(e.b,s.y),l:Math.min(e.l,s.x-TA),r:Math.max(e.r,s.x+TA)}},{t:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,l:Number.POSITIVE_INFINITY,r:Number.NEGATIVE_INFINITY}),H2="$$final",Ba=(t,e,r,s)=>e.some(n=>n.config.direction===t)?"doorway":r===void 0?"wall":Object.values(r).some(({gridPosition:n})=>a_(de[t],Z0(n,s)))?"open":"wall";function*ln(t){try{yield*G2(t)}catch(e){const r=e;throw new Error(`
  error in recursion ${t.roomId}/${t.subRoomId??"*"}`,{cause:r})}}function*G2({roomId:t,subRoomId:e="*",campaign:r,visited:s={},vectorFromPrevious:n,previousRoomGridPosition:i=ee}){if(t==="nowhere"||s[t]?.[e])return;s[t]===void 0&&(s[t]={}),s[t][e]=!0;const o=r.rooms[t];if(o===void 0)throw new Error(`no room in the campaign with id="${t}"`);const a=[...Ge(Nr(o.items)).filter(f=>f.type==="door").filter(f=>$f(f.position,"block",o)===e)],l=U(i,n===void 0?kx:n),c=o.meta?.subRooms;if(c){if(e==="*")throw new Error(`subRoomId '*' means 'all' and is not allowed for big rooms. Must be one of the sub-rooms in ${t}: ${Object.keys(c)}`);if(!c[e])throw new Error(`Sub-room ${e} not found in room ${t}. Available sub-rooms: ${Object.keys(c)}`)}const u=c?.[e].gridPosition,h={left:Ba("left",a,c,u),right:Ba("right",a,c,u),away:Ba("away",a,c,u),towards:Ba("towards",a,c,u)};if(yield{roomId:t,subRoomId:e,gridPosition:l,boundaries:h},c!==void 0){if(u===void 0)throw new Error(`Sub-room ${e} not found in room ${t}. Available sub-rooms: ${Object.keys(c)}`);for(const[f,{gridPosition:m}]of Ge(ko(c)))f!==e&&(yield*ln({roomId:t,subRoomId:f,campaign:r,visited:s,vectorFromPrevious:Mr({...m,z:0},u),previousRoomGridPosition:l}))}if(o.roomAbove!==void 0){const{roomAbove:f,subRoomAbove:m}=o;yield*ln({roomId:f,subRoomId:m,campaign:r,visited:s,vectorFromPrevious:de.up,previousRoomGridPosition:l})}if(o.roomBelow!==void 0){const{roomBelow:f,subRoomBelow:m}=o;yield*ln({roomId:f,subRoomId:m,campaign:r,visited:s,vectorFromPrevious:de.down,previousRoomGridPosition:l})}for(const f of a){const{toRoom:m}=f.config;if(m!==H2)try{yield*ln({roomId:m,campaign:r,visited:s,subRoomId:f.config.meta?.toSubRoom,vectorFromPrevious:de[f.config.direction],previousRoomGridPosition:l})}catch(y){throw new Error(`error while traversing door ${JSON.stringify(f,null,2)} in room ${t} to room ${m}`,{cause:y})}}const d=o.meta?.nonContiguousRelationship;if(d!==void 0){const{with:{room:f},gridOffset:m}=d;yield*ln({roomId:f,campaign:r,visited:s,subRoomId:"*",vectorFromPrevious:m,previousRoomGridPosition:l})}}const W2=t=>{const r=[...t].sort(({gridPosition:s},{gridPosition:n})=>s.z!==n.z?s.z-n.z:n.x+n.y-(s.x+s.y)).map(s=>[`${s.roomId}/${s.subRoomId}`,s]);return Un(r)},K2=()=>{const t=KD(),e=XR(),{gameState:r}=Ln(),s=jw();return v.useMemo(()=>{try{const n=QD(r),i=n?.roomJson.id??Aq(s).head;let o;if(!r)o="*";else if(!n?.roomJson.meta?.subRooms)o="*";else{const u=n?.items[t];u?o=$f(u.state.position,"fine",n.roomJson):o="*"}const a=[...ln({campaign:s,roomId:i,subRoomId:o})],l=W2(a);return{mapBounds:$2(a),curRoomId:n?.roomJson.id,gridPositions:l,currentCharacterName:t,pickupsCollected:r.pickupsCollected,characterRooms:r.characterRooms,campaign:s,roomsExplored:e,curRoomScenery:n?.planet}}catch(n){throw new Error("error getting map data",{cause:n})}},[s,t,r,e])},Y2=()=>{const{ref:t,width:e}=yz(),r=iq(),s=Ln();YD();const n=K2(),i=oq(n.curRoomScenery);return p.jsx(Le,{children:p.jsx(ke,{ref:t,fullScreen:!0,className:`bg-white zx:bg-zxBlack pr-0 p-0 mobile:pl-0 justify-center ${i.containerClassName}`,onClick:B(xt),dialogId:"map",children:p.jsx("div",{className:"overflow-y-scroll scrollbar scrollbar-w-1 h-min",ref:r,children:p.jsx(GD,{onPlayableClick:o=>Qa(s.gameState,o),containerWidth:e,...n})})})})},Q2=`## Bag

![](texture-bag)The *bag* may be used to carry small objects around a room. It is essential for
Heels to find and get the bag as it is impossible to get far without it.

The object in the bag will be displayed immediately above the bags icon at the
bottom right of the screen. To pick up an object, stand on top of it and
press *carry*. 

![](texture-cube)![](texture-drum)![](texture-spring_compressed)![](texture-sticks)

It is not possible to take items through doorways.

> Section adapted from the original Head over Heels manual

`,X2=`## Planet Blacktooth

![](texture-blacktooth_wall_armour_left?bg-pureBlack)![](texture-blacktooth_wall_shield_away?bg-pureBlack&float-right)This planet has a large moon with three lunar space stations on it, the larger
of these, *Moon Station HQ*, is the main teleport center for the empire, with a
direct teleport to all the slave planets.

Sometime after the Egyptus episode,
the latest Emperor sent out a craft to find that same strange planet, and after
much exploration, it was finally located, and the craft landed. However, the
crew found the people had changed: instead of pyramids they used castles,
instead of wrapping corpses up in cloth, they wrapped living men in metal and
then tried to turn them into corpses with sharp metal sticks.

![](texture-teleporter)The Emperor, not to be outdone by his ancestor, built a castle on Blacktooth and
used it as his headquarters. The castle is surrounded by a small market, and
then a range of impassable mountains. The only way to leave is via teleport to
one of the three lunar space stations.

> Section adapted from the original Head over Heels manual`,J2=`## Planet Book World

![](texture-bookworld_wall_cowboy_left?bg-pureBlack)![](texture-book_x?float-right&clear-right)![](texture-book_y?float-right&clear-right)The emperor is very keen
on *cowboy books* and has devoted an entire world to a *western library*.

Only the emperor's minions are permitted to read them.
Information is rigorously suppressed in the empire.

> Section adapted from the original Head over Heels manual
`,Z2=`## Conveyor Belts

![](texture-animated-heels_walking_right?z-topSprite&relative&ml-centreSmallBlockOnLarge&mr-2)![](texture-animated-conveyor_x?&relative&clear-left&bottom-bottomStackPullup)The rollers on the conveyor simply push you along it. If you wish to go the
opposite direction you have to jump along.

> Section adapted from the original Head over Heels manual
`,eL=`## Credits

### Original credits

Written by Jon Ritman and Bernie Drummond.  
Music and sound effect by Guy Stevens.  
Produced by D.C. Ward.  
1987 Ocean Software Limited.

### 38 years later, a Remake

* code by Jim Higson
* Playtesting, ideas, map design, and general support by my brother, Tom Higson
* Playtesting, moral support, and constant comms by [Jon Albaugh](https://x.com/fextwolf?s=21&t=PEqxJblCn3JB_NH8AOR6Zg)
* Head over heels [font](https://fontstruct.com/fontstructions/show/996776/head_over_heels)
recreated by [Patrick H. Lauke](http://splintered.co.uk/)

This project is licensed under the GNU Affero General Public License v3.0 (only) - see the LICENSE file for details. All code is original except where indicated otherwise.

2025 Jim Higson`,tL=`## Crowns

![](texture-crown_blacktooth)![](texture-crown_bookworld?float-right)![](texture-crown_egyptus?clear-left)![](texture-crown_penitentiary?float-right&clear-right)![](texture-crown_safari?clear-left)Find a crown and start a revolution. At the beginning of each game, a screen
showing all five planets with a crown above each will be displayed.

As each
crown is collected this screen will be shown again with the appropriate crowns
in a bright color.

> Section adapted from the original Head over Heels manual`,rL=`## Cuddly Stuffed White Rabbits

![](texture-whiteRabbit?float-right)The *cute toy bunnies* magically enhance your powers. The status display at the
bottom of the screen will keep you informed as to which powers are temporarily
enhanced.

If Head and Heels are connected when they pick up a *Life* or *Iron pill*,
they will both get the enhanced power.

There are four types:

## Two extra lives
If you pick them up while head and heels are joined, they get *two each*

##  Iron Pills

![](texture-animated-shine?text-metallicBlue&float-left)To make you invulnerable

##  Jump higher bunny

![](texture-animated-heels_idle_right?text-metallicBlue&float-left)Only works on Heels

##  Go faster bunny
![](texture-animated-head_idle_right?text-metallicBlue&float-left)Only works on slow-moving Head

> Section adapted from the original Head over Heels manual
`,sL=`## Doughnuts

![](texture-doughnuts)Trays of *six doughnuts* are few and far between, so dont waste shots. Only Head
may pick up doughnuts.

The number of remaining doughnuts will be displayed above
the doughnut icon at the bottom left of the screen.

> Section adapted from the original Head over Heels manual
`,nL=`## Planet Egyptus

![](texture-egyptus_wall_sarcophagus_left)![](texture-egyptus_wall_sarcophagus_away?float-right)![](texture-egyptus_wall_hieroglyphics_left?clear-left)![](texture-egyptus_wall_hieroglyphics_away?float-right&clear-right)Once, a long time ago, a craft from Blacktooth got a bit lost while doing a
hyperspace jump and landed on an unknown planet.

Here the crew found a primitive
animal forming a sort of civilization that appeared to revolve around wrapping
corpses in lots of bandages and putting them into huge stone pyramids.

When they
returned to Blacktooth their emperor liked the sound of it so much that he
rebuilt the capital city of one of the slave planets to resemble the story.

> Section adapted from the original Head over Heels manual
`,iL=`## Head 
### (HEADUS MOUTHION)

![](texture-animated-head_walking_towards?float-right)This creature is a symbiotic partner to Heels and will normally be found sitting
on top of one.

![](texture-head_falling_right)Head is descended from a breed of flying reptile and still has
rudimentary wings that allow Head to jump up to twice his own height and to
guide himself through the air.

> Section adapted from the original Head over Heels manual
`,oL=`## Heels 
### (FOOTUS UNDERIUM)

![](texture-animated-heels_walking_towards?float-right)During Heelss evolution, the arms have totally disappeared while the legs have
become very powerful.

Heels can jump their own height and can also run very fast.

> Section adapted from the original Head over Heels manual`,aL=`## Hints and Tips

1. **1** Beginners should aim to escape from Blacktooth and get back to Freedom initially. Only the very skillful can hope to liberate a planet or two.
2. **2** ![](texture-animated-head_idle_towards?float-right&relative&z-topSprite)![](texture-heels_standing_towards&float-right&clear-right&relative&bottom-bottomStackPullup)When you first get Head and Heels in the same location, practice placing Head on top of Heels and joining them together accurately with the swop key. Both of their icons will light up when they are successfully joined.
3. **3** Remember Head and Heels are a team. Just because both are in the same room does not mean you have to join them together, and in fact, some problems may only be solved by separating Head and Heels.
4. **4** Make sure Head learns to climb ladders; this is an essential skill.
5. **5** ![](texture-bag?float-right)![](texture-hooter?float-right)Both Heelss bag and Heads hooter must be collected at the initial stages for there to be any chance of completing the game.
6. **6** If Head and Heels are in the same room, extra jumping height may be obtained by one jumping off the others back.
7. **7** Find a safe spot and get used to how far Head and Heels may move over the edge of a brick before they fall. This will enable you to make the longest jumps. Both Head and Heels will jump slightly further if they are running as they jump.
8. **8** Learn the difference in distance and control between Heads jumps and Heelss jumps.
9. **9** This remake comes with a **map**. Use it!
10. **10** ![](texture-doughnuts?float-right)Do not waste doughnuts; they are not easy to find.
11. **11** Do not get confused; only Heels may carry anything, and only Head may fire.
12. **12** ![](texture-spring_released?float-right&relative&z-topSprite)![](texture-cube?float-right&clear-right&relative&bottom-bottomStackPullup)To discover if there is a room above, pile objects as high as possible and jump from the top. If there is a spring in the room, put it on the top for extra jumping height.
13. **13** If you cant understand a room, try exiting and entering again, watching carefully for any movement in the room as you enter.

> Section adapted from the original Head over Heels manual`,lL=`## The Blacktooth Empire

![](texture-crown_blacktooth)Far, far away from our star Sol lies **The Blacktooth empire**, an evil empire, four
worlds enslaved by the planet Blacktooth.

![](texture-animated-dalek?float-right)All of the slave worlds bubble with
unrest, but due to the oppressive nature of their rulers they never reach
boiling point, they all lack a leader to draw the masses of population together.

![](texture-animated-helicopterBug?float-right)Blacktooth itself is not any better, a world rigidly controlled by its dynastic
leaders for so long that the populace do not ever think about revolution.

![](texture-head_walking_right_2)The peoples of the neighbouring stars are getting very worried about signs of
military expansion from Blacktooth and have sent a spy from the planet Freedom
to see if he can push the slave planets into full rebellion by finding the
crowns lost when Blacktooth took over.

![](texture-heels_standing_right)The creatures of *Freedom* are very strange in that they are formed from a pair of
*symbiotic animals* that have adapted to operate either independently or, to their
mutual advantage, join together as one - **Head** saddled on **Heels**, and indeed these
*are* their names and both are highly trained spies.

> Section adapted from the original Head over Heels manual
`,cL=`## Hooter

![](texture-hooter)The *hooter* may be used by Head to fire *doughnuts* at attacking monsters.

This will freeze them in place as they lick the doughnut off their faces.

![](texture-doughnuts?float-right&clear-both)The hooter may only be used by **Head** and requires a tray of *doughnuts* to be of any use.

> Section adapted from the original Head over Heels manual
`,uL=`## Hush Puppies

![](texture-hushPuppy?float-right)These are a very strange type of beast; they are incredibly 
sleepy. In fact, they never wake up and it is quite normal for them to sleep for 
their entire lives.

They are often used as tables and even used as building bricks. 
They are a native of Freedom, ![](texture-head_walking_right_2?clear-both)and for many thousands of years Head and his ancestors 
have been mistaking them for Heels and causing so much trouble to the poor old hush
puppies that they evolved a defense mechanism they somehow learned to teleport
themselves away.

![](texture-animated-bubbles_white?float-right&clear-both)Nobody knows where they go, but
the instant they see any of Heads race, they disappear and wont return until they are sure the coast is
clear.

> Section adapted from the original Head over Heels manual
`,hL=`
## Planet Penitentiary
### The empires prison planet

![](texture-penitentiary_wall_skeleton_left)Millions are imprisoned here. A harsh planet, very mountainous, much climbing,
skill required.

The worst place is The Pit, try not to fall into it!

> Section adapted from the original Head over Heels manual
`,dL=`## Reincarnation Fish

![](texture-animated-fish)The strangest animal in the known universe! This fish likes to be eaten! There
have been cases of it jumping onto plates!

But there is more: when you eat one,
its prodigious memory remembers everything about you. Its memory is so good that
if you die at some later date, you will be reincarnated at the very place you
ate the fish, and you will even have its taste still in your mouth!

How a fish
can remember anything when it's been eaten has never been successfully
explained.

![](texture-fish_1)You must be very careful to check that the fish is
alive and wriggling as **dead fish decompose very quickly and it rapidly
turns so poisonous that a single lick can kill.**

### WARNING:

Even living reincarnation fish taste horrible!

> Section adapted from the original Head over Heels manual
`,fL=`## Install the game

**> This page also available with normal fonts: [on Github](https://github.com/jimhigson/head-over-heels-online/tree/main/src/manual/remake/installGuide.md)**

You can play the blockstack.ing Head over Heels remake from *any modern web
browser*: phone, desktop, or tablet.

However, It is **highly recommended** to **install the game** as a [P.W.A.](https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps)

----
## Chrome / Chromium

On: **Mac**, **Windows**, **Linux**, **Chromebooks**, **iphone**, or **Android**

To install:

* Go to [blockstack.ing](https://blockstack.ing) if youre not there already
* To the right of the address bar, click the **install icon: **. It might also look like a 'download' icon.
* In the dialog, choose *install*
* **Head over heels** is now installed as an app!

----
## iphone / ipad Safari

To install:

* Go to [blockstack.ing](https://blockstack.ing) if youre not there already
* Tap the **share button **
* The share button is at the bottom of the screen for phones in portrait, or to the right of the address bar on ipad or phones in landscape
* Choose **Add to Home Screen **
* **Head over heels** is now available on your home screen!

----
## Mac Safari

* Go to [blockstack.ing](https://blockstack.ing) if youre not there already
* Click the **share button ** to the right of the address bar
* Choose **Add to Dock **
* **Head over heels** is now installed on your mac
* If you dont want to keep the game in the Dock, right-click the doc icon and uncheck **Options  keep in doc**. It is still available in Applications

---

## Firefox 

* Firefox doesn't support PWAs out of the box, but there is a [browser extension](https://addons.mozilla.org/en-US/firefox/addon/pwas-for-firefox/).
* Probably easier to play in the browser until Mozilla adds support`,pL=`## Supported platforms

Almost anything with an up-to-date browser can play

Heres some Ive tried:

* **Linux** - install using Chromium. Play in-browser using Chromium or Firefox
* **Mac** - install using Safari or Chrome. Play in-browser using Safari, Chrome, or Firefox
* **Windows** - Chrome works for installed and in-browser play. Edge not tested but should work
* **iPhone** - in-browser play works, but there is no way to go full-screen - installing as a an app is better. 60fps cap in Safari. Turning on [Guided access](https://support.apple.com/en-gb/111795) is recommended for gaming.
* **Android** - Default browser has *excellent* PWA support
* **Raspberry Pi** - Pi 5 gets 45-60fps with Chromium and Firefox; 30 in busier rooms.
* **Apple watch** - Not really playable, but it runs if you message yourself the link to open it on the watch!
* **ZX Spectrum** - Currently untested`,mL=`## Planet Safari

![](texture-monkey_right?float-left&relative&z-topSprite)![](texture-homingBot?float-left&clear-left&relative&bottom-bottomStackPullup)![](texture-elephant_towards?float-right&relative&z-topSprite)![](texture-homingBot?float-right&clear-right&relative&bottom-bottomStackPullup)A densely vegetated planet, mainly used for hunting.

The natives live in wooden forts in the jungle, **beware traps!**

> Section adapted from the original Head over Heels manual`,gL=`## Springs

![](texture-animated-once-spring_bounce)Jumping from a spring will give extra height to your jump.

> Section adapted from the original Head over Heels manual
`,yL=`## Switches

![](texture-animated-switch)Simply push the switch to switch things off and on!

Switching a deadly monster off will make them no longer deadly to touch. Push them or jump on them to reach new areas!

This varies from the original Head over Heels game, where disabled enemies remained deadly.

> Section adapted from the original Head over Heels manual, revised for remake
`,AL=`## Swop Key

If Head is sitting on Heels, the swop key will, on each push, give you control
of:

* *1* Heels.
* *2* Head + Heels.
* *3* Head.
* *4* Head + Heels.

If Head is not on Heels, the swop key will, on each push, give you control of:

* *1* Head.
* *2* Heels.

At all times, the character(s) whose icon is lit is under player control. When
Head and Heels are joined together, all their abilities are combined.

> Section adapted from the original Head over Heels manual`,xL=`## Exalted Emperor:

![](texture-teleporter)Sire, I took the liberty of installing this teleporter 
to aid your magnificent return to the moonbase after the daily crown inspections.

![](texture-cyberman_towards)Supplies are running short of teleporters, so I set it up one-way
until more come in.
May I humbly suggest you teleport after inspecting the crown or his grace
will have a long walk (well, ride on a minions back) to get back here.

Of course, those two spies we threw in jail might try to use it to grab the crown and escape.
Just kidding, theyll never get this far!

*> Your humble minion*
`,bL=`## Teleports

![](texture-teleporter)Standing on a teleport will activate its mechanism, which will sound a warning
siren. Pressing the *jump key* will cause you to teleport.

Not all teleports are two-way; some are linked in a chain.

> Section adapted from the original Head over Heels manual `,wL=`## The Emperors Guardian

![](texture-ball?relative&z-topSprite)![](texture-animated-bubbles_cold?relative&clear-both&bottom-bottomStackPullup)The guardian blocks the door to the throne room in Blacktooth castle. He is **VERY
DANGEROUS**, and he *doesn't like doughnuts*.

Only a true hero may pass the guardian.

> Section adapted from the original Head over Heels manual
`,VL=`## The Game

![](texture-animated-heels_idle_right)![](texture-animated-head_idle_towards?float-right)Head and Heels have been captured, separated and imprisoned in the castle
headquarters of Blacktooth. Their cells contain keep fit equipment, including
a wall ladder that Head really must learn to climb.

![](texture-market_wall_fruits_left?bg-pureBlack)![](texture-moonbase_wall_window2_away?bg-pureBlack&float-right)Your job is to get them both
out of the castle and into the *marketplace* so they can join up again. From
there, the journey leads to *Moonbase Headquarters*, where you will have to decide
either to try to escape back to *Freedom* or to be a true hero and teleport to one
of the slave planets to search for its lost crown!

![](texture-crown_bookworld?clear-left)To overthrow the dictatorship on any of the slave planets would be a major blow
to Blacktooth and you could return to Freedom in glory. Of course, Blacktooth
would probably enslave them again eventually but it would slow down any
expansion plans for now.


![](texture-cyberman_towards?float-right&relative&z-topSprite)![](texture-animated-bubbles_cold?float-right&clear-right&relative&bottom-bottomStackPullup)The populace of Blacktooth are so heavily oppressed
that they would have to see all four of the slave planets revolt before the
Blacktooth crown could cause an uprising. ![](texture-animated-turtle_right)This of course would be the ultimate
accolade, and unfortunately, almost certain suicide.

> Section adapted from the original Head over Heels manual
`,qe=Object.assign({"./bag.md":Q2,"./blacktooth.md":X2,"./bookWorld.md":J2,"./conveyorBelts.md":Z2,"./credits.md":eL,"./crowns.md":tL,"./cuddlyStuffedWhiteRabbits.md":rL,"./doughnuts.md":sL,"./egyptus.md":nL,"./head.md":iL,"./heels.md":oL,"./hintsAndTips.md":aL,"./historyOfTheBlacktoothEmpire.md":lL,"./hooter.md":cL,"./hushPuppies.md":uL,"./penitentiary.md":hL,"./reincarnationFish.md":dL,"./remake/installGuide.md":fL,"./remake/supportedPlatforms.md":pL,"./safari.md":mL,"./springs.md":gL,"./switches.md":yL,"./swopKey.md":AL,"./teleportBack.md":xL,"./teleports.md":bL,"./theEmperorsGuardian.md":wL,"./theGame.md":VL}),$i={historyOfTheBlacktoothEmpire:qe["./historyOfTheBlacktoothEmpire.md"],theGame:qe["./theGame.md"],egyptus:qe["./egyptus.md"],penitentiary:qe["./penitentiary.md"],safari:qe["./safari.md"],bookWorld:qe["./bookWorld.md"],blacktooth:qe["./blacktooth.md"],head:qe["./head.md"],heels:qe["./heels.md"],reincarnationFish:qe["./reincarnationFish.md"],cuddlyStuffedWhiteRabbits:qe["./cuddlyStuffedWhiteRabbits.md"],hooter:qe["./hooter.md"],doughnuts:qe["./doughnuts.md"],bag:qe["./bag.md"],crowns:qe["./crowns.md"],teleports:qe["./teleports.md"],springs:qe["./springs.md"],switches:qe["./switches.md"],conveyorBelts:qe["./conveyorBelts.md"],hushPuppies:qe["./hushPuppies.md"],theEmperorsGuardian:qe["./theEmperorsGuardian.md"],swopKey:qe["./swopKey.md"],hintsAndTips:qe["./hintsAndTips.md"],credits:qe["./credits.md"],installGuide:qe["./remake/installGuide.md"]},qL={...$i,teleportBack:qe["./teleportBack.md"]},vL=/^##\s+(.*)$/m,ud=t=>{const e=t.match(vL);if(e===null)return"no title found";const[,r]=e;return r},Qu=t=>{const e=t.source==="manual"?qL[t.pageName]:t.markdown,r=iq(),s=X(n=>{const{openMenus:i}=n.gameMenus;return i.some(o=>o.menuId==="readTheManual")});return p.jsxs(Le,{children:[p.jsx(bt,{className:"bg-midGrey zx:bg-zxWhiteDimmed",onClick:B(xt)}),p.jsxs(ke,{tall:!0,className:"bg-highlightBeige zx:bg-zxCyanDimmed text-shadow zx:text-zxWhite !gap-y-0 py-0 selectedMenuItem:text-shadow zx:selectedMenuItem:text-zxBlack ",dialogId:t.dialogId,children:[p.jsx(Ar,{className:"pl-1 mobile:px-3 ",path:s?["Manual"]:[]}),p.jsx("div",{className:ht("overflow-y-scroll h-full scrollbar scrollbar-w-1 pl-1 pt-1 scrollbar-thumb-midRed scrollbar-track-highlightBeige zx:scrollbar-thumb-zxCyanDimmed zx:scrollbar-track-zxCyan mobile:px-3"),ref:r,onClick:B(xt),children:p.jsx(me,{markdown:e})})]})]})},xq=t=>{t.reincarnateFrom(ce.getState().gameMenus.gameInPlay.reincarnationPoint),ce.dispatch(pf())},_L="![](?sprite&texture-animated-fish&float-left)Ah, But you ate a Reincarnation Fish! Reincarnate?",SL=()=>{const t=Ln();return p.jsxs(Le,{children:[p.jsx(bt,{className:"bg-midRed zx:bg-zxYellow"}),p.jsxs(ke,{className:"bg-white zx:bg-zxRed px-1",dialogId:"offerReincarnation",children:[p.jsx(j,{className:"sprites-double-height mt-1 mb-2 resHandheld:mt-0 text-redShadow zx:text-zxWhite",children:"Uh-oh! Game over."}),p.jsx(me,{markdown:_L,className:"text-redShadow zx:text-zxWhite"}),p.jsxs(Re,{className:"text-lightGrey zx:text-zxWhite mt-1 resHandheld:mt-0 selectedMenuItem:text-midRed zx:selectedMenuItem:text-zxYellow resHandheld:!gap-y-1",children:[p.jsx(F,{doubleHeightWhenFocussed:!0,id:"reincarnate",label:"Reincarnate",onSelect:()=>{xq(t)}}),p.jsx(F,{doubleHeightWhenFocussed:!0,id:"donotreincarnate",label:"Stay dead",onSelect:B(ff,{offerReincarnation:!1})})]})]})]})},kL="Play at the original **1x** speed, **1.2x (default)** or faster **1.5x** or **2x** speeds",CL=`**Off**: Start with *8 lives*

Extra life rabbits spread thinly through the game`,EL=`**On**: *Live forever*

Extra life rabbits have no effect`,PL="*Select the keys* and other input settings",TL=`##Cheats

Magazines used to print memory locations to *poke* values into so that readers could modify their games; usually to cheat.
                  
A true hero leaves these **off**! Then again, do modern gamers even know what lives are?`,RL=()=>{const t=X(Tw);return p.jsx(Le,{children:p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"modernisationOptions",children:[p.jsx(Ar,{path:["Options"],className:Zn}),p.jsx("div",{className:Jn,children:p.jsxs(Re,{className:"gap-y-half",children:[p.jsx(F,{hintInline:!0,id:"controlOptions",label:"Controls",verticalAlignItemsCentre:!0,className:"sprites-double-height",onSelect:B(ut,"controlOptions"),opensSubMenu:!0,hint:p.jsx(me,{className:Ee,markdown:PL}),leader:p.jsx("span",{className:`${be} sprite texture-joystick_whole sprites-normal-height zx:sprite-revert-to-white`})}),p.jsx(F,{hintInline:!0,id:"sound",label:"Sounds",className:"sprites-double-height",verticalAlignItemsCentre:!0,onSelect:B(ut,"sound"),opensSubMenu:!0,hint:p.jsx(me,{className:Ee,markdown:"Footsteps getting annoying?"})}),p.jsx(F,{hintInline:!0,id:"display",label:"Display",className:"sprites-double-height",verticalAlignItemsCentre:!0,onSelect:B(ut,"displayOptions"),opensSubMenu:!0,hint:p.jsx(me,{className:Ee,markdown:"Change how the game looks"})}),p.jsx(F,{hintInline:!0,id:"gameSpeed",label:"Game Speed",className:"sprites-double-height",valueElement:p.jsx(Of,{className:"ml-auto",values:Lh,valueLabels:Lh.map(e=>`${e}`),value:X(af)}),onSelect:B(pM,void 0),hint:p.jsx(me,{className:Ee,markdown:kL}),verticalAlignItemsCentre:!0}),p.jsx("div",{className:"col-span-3 pb-1",children:p.jsx(me,{markdown:TL,className:Ee})}),p.jsx(F,{hintInline:!0,className:"sprites-double-height",id:"livesModel",verticalAlignItemsCentre:!0,label:" Lives Poke",leader:p.jsx("span",{className:`${be} sprite texture-whiteRabbit sprites-normal-height zx:sprite-revert-to-white`}),hint:p.jsx(me,{className:Ee,markdown:t?EL:CL}),valueElement:p.jsx(Yr,{className:"ml-auto",value:t}),onSelect:B(rr,{path:"infiniteLivesPoke"}),disabled:kn()}),p.jsx(F,{hintInline:!0,leader:p.jsx("span",{className:`${be} sprite texture-doughnuts sprites-normal-height zx:sprite-revert-to-white`}),className:"sprites-double-height",verticalAlignItemsCentre:!0,id:"infiniteDoughnutsPoke",label:" Doughnuts Poke",valueElement:p.jsx(Yr,{className:"ml-auto",value:X(Rw)}),onSelect:B(rr,{path:"infiniteDoughnutsPoke"}),disabled:kn()}),p.jsx(oc,{})]})})]})})},RA="sprite texture-crown_blacktooth zx:texture-crown_uncolourised zx:sprite-tinted zx:text-zxYellow",ML=()=>p.jsxs(Le,{children:[p.jsx(bt,{className:"bg-pureBlack zx:bg-zxBlack"}),p.jsx(ke,{className:"bg-pureBlack w-zx h-full block p-0",onClick:B(xt),dialogId:"proclaimEmperor",children:p.jsxs("div",{className:"flex flex-col gap-3 items-center",children:[p.jsxs("div",{className:"flex gap-7",children:[p.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center me-1",children:[p.jsx("span",{className:RA}),p.jsx("span",{className:"sprite zx:sprite-revert-zxYellow texture-animated-head_idle_right hover:texture-animated-head_walking_right relative z-topSprite"})]}),p.jsxs("div",{className:"flex flex-col items-center me-1",children:[p.jsx("span",{className:RA}),p.jsx("span",{className:"sprite zx:sprite-revert-zxYellow texture-animated-heels_idle_towards hover:texture-animated-heels_walking_towards relative z-topSprite"})]})]}),p.jsxs("div",{className:"flex flex-col gap-1 items-center text-lightGrey zx:text-zxCyan",children:[p.jsx(j,{children:"The people salute your heroism"}),p.jsx(j,{children:"and proclaim you"})]}),p.jsx(j,{className:"text-highlightBeige sprites-double-height",classnameCycle:["text-pink zx:text-zxMagenta","text-metallicBlue zx:text-zxCyan","text-highlightBeige zx:text-zxYellow"],children:"EMPEROR"}),p.jsx(Re,{className:"hidden",children:p.jsx(No,{})})]})})]}),bq=({className:t})=>p.jsx("div",{className:ht("contents",t),children:p.jsx(Zl.Placeholder,{})}),IL=()=>{const t=X(r=>r.gameMenus.gameInPlay.reincarnationPoint!==void 0),e=Ln();return p.jsxs(Le,{children:[p.jsx(bt,{className:"bg-midRed zx:bg-zxYellowDimmed"}),p.jsx(ke,{className:"bg-white zx:bg-zxRedDimmed px-1",dialogId:"quitGameConfirm",children:p.jsx(Zl.Provider,{children:p.jsxs("div",{className:"flex flex-col gap-y-2 mt-1 items-center h-full",children:[p.jsx(j,{className:"sprites-double-height resHandheld:mt-0 text-midRed zx:text-zxWhite",children:"Quit the Game?"}),p.jsxs(Re,{className:"text-lightGrey zx:text-zxWhite resHandheld:mt-0 resHandheld:!gap-y-1",children:[p.jsx(F,{doubleHeightWhenFocussed:!0,id:"no",label:"Back",className:"selectedMenuItem:text-moss zx:selectedMenuItem:text-zxGreen",leader:p.jsx("span",{className:`${be} sprite texture-head_walking_awayLeft_2 selectedMenuItem:texture-animated-head_walking_towardsRight sprites-normal-height zx:sprite-revert-to-white`}),onSelect:B(xt),hint:"Back to the game",verticalAlignItemsCentre:!0}),t&&p.jsx(F,{doubleHeightWhenFocussed:!0,id:"reincarnate",label:"Reincarnate",className:"selectedMenuItem:text-metallicBlue zx:selectedMenuItem:text-zxBlue",leader:p.jsx("span",{className:`${be} sprite texture-fish_1 selectedMenuItem:texture-animated-fish sprites-normal-height zx:sprite-revert-to-white`}),onSelect:()=>xq(e),hint:p.jsx(me,{className:"zx:[&_.strong]:text-zxYellow",markdown:"Go back and continue from the last **Reincarnation Fish** you ate"}),verticalAlignItemsCentre:!0}),p.jsx(F,{doubleHeightWhenFocussed:!0,id:"yes",label:"Quit",className:"selectedMenuItem:text-midRed zx:selectedMenuItem:text-zxYellow",onSelect:B(ff,{offerReincarnation:!1}),leader:p.jsx("span",{className:`${be} sprite texture-bubbles_white_1 selectedMenuItem:texture-animated-bubbles_bounce_white sprites-normal-height zx:sprite-revert-to-white`}),hint:p.jsx(me,{className:"zx:[&_.strong]:text-zxYellow",markdown:"**Warning!** This game will end!"}),verticalAlignItemsCentre:!0})]}),p.jsx(bq,{className:"text-midGrey zx:text-zxWhite resHandheld:hidden"})]})})})]})},jL=({pageName:t})=>{const e=$i[t],r=ud(e),s=At()==="desktop";return p.jsx(F,{id:`markdown/${t}`,label:r,onSelect:B(ut,`markdown/${t}`),doubleHeightWhenFocussed:s,opensSubMenu:!0})},OL=Object.keys($i).sort((t,e)=>ud($i[t]).localeCompare(ud($i[e]))),NL=()=>p.jsxs(Le,{children:[p.jsx(bt,{className:"bg-midGrey zx:bg-zxCyan",onClick:B(xt)}),p.jsxs(ke,{tall:!0,className:"bg-highlightBeige zx:bg-zxCyanDimmed max-h-min text-redShadow zx:text-zxWhite !gap-y-0 py-0 selectedMenuItem:text-shadow zx:selectedMenuItem:text-zxBlack ",dialogId:"readTheManual",children:[p.jsx(Ar,{className:"pl-1 mobile:px-3 "}),p.jsxs("div",{className:"overflow-y-scroll scrollbar scrollbar-w-1 pl-1 scrollbar-thumb-moss scrollbar-track-highlightBeige zx:scrollbar-thumb-zxBlack zx:scrollbar-track-zxCyanDimmed mobile:px-3 ",children:[p.jsxs("h1",{className:"text-moss zx:text-zxBlack mx-auto flex flex-row justify-center items-center w-full mb-1",children:[p.jsx("span",{className:"sprite texture-book_x zx:sprite-revert-to-white sprites-normal-height"}),p.jsx(j,{className:"sprites-double-height mx-1",children:"Read the manual"}),p.jsx("span",{className:"sprite texture-book_y zx:sprite-revert-to-white sprites-normal-height"})]}),p.jsxs(Re,{children:[[...OL.map(t=>p.jsx(jL,{pageName:t},t))],p.jsx(oc,{})]})]})]})]}),BL=()=>p.jsx(Le,{children:p.jsxs(ke,{className:"!h-min !w-max text-center p-0 bg-transparent",onClick:B(xt),dialogId:"reincarnatedRestart",children:[p.jsx(j,{className:`${le} text-zxRed block w-24 mx-auto px-1 bg-zxBlack py-oneScaledPix`,children:"You dont go towards the light"}),p.jsx(j,{className:`${le} block text-zxYellow w-24 mx-auto px-1 bg-zxBlack py-oneScaledPix`,children:"You have a horrible taste in your mouth"}),p.jsx(j,{className:`${le} block text-zxGreen w-24 mx-auto px-1 sprites-double-height bg-zxBlack py-oneScaledPix`,children:"You have reincarnated!"}),p.jsx(j,{className:`${le} block text-zxCyan w-24 mx-auto px-1 bg-zxBlack py-oneScaledPix`,children:"Everything is back to how it was when you ate the fish"}),p.jsx("span",{className:"sprite mx-auto  bg-zxBlack texture-animated-fish sprite-revert-to-white"}),p.jsx(Re,{className:"hidden",children:p.jsx(No,{})})]})}),bi=94e3,MA=(t,e,r)=>t*160+e*1e4+r*1e4,zL=[{upToProportion:8e3/bi,label:"beginner"},{upToProportion:2e4/bi,label:"novice"},{upToProportion:3e4/bi,label:"spy"},{upToProportion:55e3/bi,label:"master-spy"},{upToProportion:84e3/bi,label:"hero"},{upToProportion:1,label:"liberator"},{upToProportion:1/0,label:"completionist"}],DL=(t,e)=>{const r=t/e;for(const{upToProportion:s,label:n}of zL)if(r<s)return n;return"completionist"},LL=Rl(({gameMenus:{gameInPlay:{freeCharacters:t}}})=>t,t=>Object.keys(t)),FL=()=>{const t=jw(),e=X(UR),r=X(({gameMenus:{gameInPlay:{roomsExplored:l}}})=>ch(Ge(Nr(l)))),s=X(LL),n=MA(r,e,s.length),i=ch(Ox(t.rooms)),o=MA(i,5,2),a=DL(n,o);return p.jsxs(p.Fragment,{children:[p.jsx(GV,{noSubtitle:!0,className:"resHandheld:hidden"}),p.jsx(j,{classnameCycle:fr,className:"mt-1 resHandheld:mt-3 block text-center mx-auto sprites-double-height sprites-uppercase",children:a}),p.jsxs("div",{className:`contents ${le}`,children:[p.jsxs(j,{className:"mt-1 block text-center mx-auto text-highlightBeige zx:text-zxYellow",children:["Score ",n.toLocaleString()]}),p.jsx("div",{className:"mt-1",children:s.map(l=>p.jsxs("span",{className:"block text-center mx-auto text-lightGrey zx:text-zxYellow",children:[l==="head"?p.jsx(j,{className:"text-metallicBlue zx:text-zxBlue",children:"Head"}):p.jsx(j,{className:"text-pink zx:text-zxWhite",children:"Heels"}),p.jsx(j,{children:" is"}),p.jsx(j,{classnameCycle:fr,children:" free"})]},l))}),p.jsxs(j,{className:"mt-1 block text-center mx-auto text-pink zx:text-zxCyan",children:["Explored ",r," / ",i," rooms"," ",`(${(100*r/i).toFixed(1)}%)`]}),p.jsxs(j,{className:"mt-1 block text-center mx-auto text-lightGrey zx:text-zxWhite",children:["Liberated ",e," planets"]}),p.jsx(Re,{className:"hidden",children:p.jsx(No,{})})]})]})},UL=()=>p.jsx(Le,{children:p.jsxs(v.Suspense,{fallback:p.jsxs(p.Fragment,{children:[p.jsx(bt,{className:"bg-metallicBlue zx:bg-zxCyan"}),p.jsx(ke,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed h-full block"})]}),children:[p.jsx(bt,{className:"bg-metallicBlue zx:bg-zxCyan"}),p.jsx(ke,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed w-zx h-full block",onClick:B(xt),dialogId:"score",children:p.jsx(FL,{})})]})}),$L=()=>{const t=X(WR),e=X(KR);return p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"sound",children:[p.jsx(Ar,{path:["Options","Sounds"],className:Zn}),p.jsx("div",{className:Jn,children:p.jsxs(Re,{children:[p.jsx(F,{className:"sprites-double-height",id:"mute",label:"Mute",valueElement:p.jsx(Yr,{value:t}),verticalAlignItemsCentre:!0,onSelect:B(rr,{path:"soundSettings.mute"})}),p.jsx(F,{className:"sprites-double-height",id:"footsteps",label:"Footstep sounds",valueElement:p.jsx(Yr,{value:!t&&!e}),verticalAlignItemsCentre:!0,onSelect:B(rr,{path:"soundSettings.noFootsteps"}),disabled:t}),p.jsx(oc,{})]})})]})},HL=`##*HohEd * the Level Editor
I built an *editor* so I could make the **sequel levels**

![](texture-headlessBase?float-left)**Make puzzles**!

*Challenge* others to **solve them**!

**In beta**; expect *crashes* and *confusion*!`,GL=()=>{const t=v.useCallback(()=>{window.location.href="/editor/"},[]);return p.jsxs(Le,{children:[p.jsx(bt,{className:"bg-pureBlack zx:bg-zxBlack",onClick:B(xt)}),p.jsx(ke,{className:"bg-shadowHalfbrite zx:bg-zxBlack px-1 py-0",dialogId:"sureWantEditor",children:p.jsx(Zl.Provider,{children:p.jsxs("div",{className:"flex flex-col gap-y-2 mt-1 h-full",children:[Ua()&&p.jsx(rV,{className:"text-midGrey zx:text-zxWhite"}),p.jsx("div",{children:p.jsx(me,{className:"text-midGrey zx:text-zxWhite",markdown:HL})}),p.jsxs(Re,{className:"text-lightGrey zx:text-zxWhite resHandheld:mt-0 selectedMenuItem:text-metallicBlue zx:selectedMenuItem:text-zxCyan resHandheld:!gap-y-1",children:[p.jsx(F,{doubleHeightWhenFocussed:!0,id:"yes",label:"Edit the levels",onSelect:t}),Ua()||p.jsx(No,{customLabel:"Im scared, go back"})]}),Ua()||p.jsx(bq,{className:"text-midGrey zx:text-zxWhite resHandheld:hidden"})]})})})]})},WL="2924c962-99f1-4dd2-9b9c-fef832dc991b",KL=t=>p.jsxs(Le,{children:[p.jsx(bt,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed",onClick:B(xt)}),p.jsxs(ke,{fullScreen:!0,className:"bg-metallicBlueHalfbrite zx:text-zxCyan text-highlightBeige selectedMenuItem:text-white zx:bg-zxRed gap-y-2 resHandheld:gap-y-1",dialogId:"whichGame",children:[p.jsx(Ar,{path:["Select which game"],className:"mobile:px-4"}),p.jsx("div",{className:"flex flex-col gap-1 p-1 overflow-y-scroll scrollbar scrollbar-w-1 scrollbar-thumb-lightGrey scrollbar-track-metallicBlueHalfbrite zx:scrollbar-thumb-zxBlue zx:scrollbar-track-zxWhite mobile:px-3 ",children:p.jsxs(Re,{className:"gap-y-1",children:[p.jsx(F,{className:"sprites-double-height",id:"originalGame",label:"Original Remastered",hintInline:!0,onSelect:B(uo,{campaignLocator:lV}),leader:p.jsx("span",{className:`${be} sprite texture-head_walking_right_2 selectedMenuItem:texture-animated-head_walking_right sprites-normal-height zx:sprite-revert-to-white`}),hint:p.jsx(me,{className:Wa,markdown:"*Remaster* of the **300-some** rooms from the original game, lightly updated for modern play"})}),p.jsx(F,{id:"remake",label:"38 Years Later",className:"sprites-double-height",hintInline:!0,onSelect:B(uo,{campaignLocator:{userId:WL,campaignName:"sequel",version:-1}}),leader:p.jsx("span",{className:`${be} sprite texture-heels_standing_right selectedMenuItem:texture-animated-heels_walking_right sprites-normal-height zx:sprite-revert-to-white`}),hint:p.jsx(me,{className:Wa,markdown:"*Unofficial sequel* - the empire is back! All-new levels designed for the remake. **Work in progress!**"})}),p.jsx(F,{id:"community",label:"Community contributed",className:"sprites-double-height",hintInline:!0,onSelect:B(ut,"communityGames"),opensSubMenu:!0,leader:p.jsx("span",{className:`${be} sprite texture-charles_right sprites-normal-height zx:sprite-revert-to-white`}),hint:p.jsx(me,{className:Wa,markdown:"Check out what people have made in the editor"})})]})})]})]}),YL=t=>t.startsWith("markdown/"),QL=t=>{const e=X(r=>r.gameMenus.openMenus.at(0));if(e===void 0)return null;if(YL(e.menuId)){if(e.menuId==="markdown/inline")return p.jsx(Qu,{source:"inline",markdown:e.menuParam.markdown,dialogId:"markdown/inline"});{const r=e.menuId.slice(9);return p.jsx(Qu,{source:"manual",pageName:r,dialogId:e.menuId})}}switch(e.menuId){case"communityGames":return p.jsx(_j,{});case"controlOptions":return p.jsx(vB,{});case"crowns":return p.jsx(CB,{playMusic:e.menuParam.playMusic});case"emulatedResolution":return p.jsx(MB,{});case"errorCaught":return p.jsx(zB,{errors:e.menuParam});case"hold":return p.jsx(DB,{});case"inputPreset":return p.jsx(FB,{});case"installGuide":return p.jsx(Qu,{source:"manual",pageName:"installGuide",dialogId:"installGuide"});case"mainMenu":return p.jsx(XB,{});case"map":return p.jsx(Y2,{});case"modernisationOptions":return p.jsx(RL,{});case"offerReincarnation":return p.jsx(SL,{});case"proclaimEmperor":return p.jsx(ML,{});case"quitGameConfirm":return p.jsx(IL,{});case"readTheManual":return p.jsx(NL,{});case"reincarnatedRestart":return p.jsx(BL,{});case"score":return p.jsx(UL,{});case"displayOptions":return p.jsx(TB,{});case"sound":return p.jsx($L,{});case"sureWantEditor":return p.jsx(GL,{});case"whichGame":return p.jsx(KL,{});default:return e.menuId,p.jsx(ke,{children:p.jsx(j,{children:`unknown dialog ${e}`})})}},XL=zn(()=>Bn(()=>import("./gameMain-BMm8X7C5.js"),__vite__mapDeps([11,10,12,5,6,9,3,4]))),JL="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAARAAALSQBAQEBAQFZWVlZWVmNjY2NjY3FxcXFxcX5+fn5+fomJiYmJiZSUlJSUlJ6enp6enqmpqamptLS0tLS0v7+/v7+/ysrKysrK1NTU1NTU39/f39/f6urq6urq9fX19fX1//////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJAZAQQABuAAAC0mIpRnOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uwxAAABGwBW7QAACH6lCs/NvBI1AAbSkgF4ABRZcPlz4Pg+D4IROD74Pn+q3wQ/KOwQOQQBAMAAOJTDmiIJGRsnW4gAAAAGHBw0GGr6h1QsZCJmtI5hYgmsYoAR0Ag4JBUuUZAsPJMg6JJglclhHUckcsioTqgczgUZ3kIHEq4rEwqNkFsLgn2Y+C3J43WE3Xo9BYGhDDkPxFE+X4CQuplOyOZfBxw0udCrX3zOQVmZoMIXhedAAJChVEEU7wAEGTZdNwgH7mWw5DSFJLPdV2KNnLuOzSTEqBeEAdPlZlTEwHqxNqs1LMcxMM1a1djNU425jGjLFpvdlvuYsfO+n1l+gAR6tolOGFYmwQBCMWKqZ1qMDBIZELiWfE5pVNre897tRKIpRXrvmoG1vegftCy+Kzbj//LZEz9fMoQA2aXZklv4AAYkhwMhQNKHAIx0Fw6iMOQxEpgKZZPRYJ8qBGb7ZHoZqcMofVh2ktwoGiAkzC8VF9v2AAkLDsqNzd5lQAV49Xg4qgYi4La1Xx8Tg0zFyPZIkpbTT7GNSxffKqESjUh0B0DZvlpu/0wBWqpZVsm4AAVjWOro4yB/tqpNY8ZjQNFXPky40t8krDdfZpDHvm58XRUg0XCIpf4nF7nTcVfLwQBXeXdXlvCymVErYmUA1UDNKRHROOh7OHcKWss9aNWDMxPfS5VDJocqMY8plQWcUpemgAGiJhlSS8AABLZawwON1FlnaA2kBuSB6H4eRSYmC0sEFJ6AoX2k5armpKStllLC7mA2Ui/iAAsTEyzX/hw2PKNiagjPDYWlUyDk62rR+41nJr50i0hS0p5W1D/+1DE3YBJfKlV/ZQAKOYGqrWNMBWNB1CoYU2F1bm1AEiIiHeP/wAAGeu00cmu3GAFjOSBwqEpNHHeS+xC60FPuHFcS+ddde3vq92QACKzvDvtwGIfpxBPjpjH+mmJx5JgBEY8FLXit5bva+ElTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVEBiZgJkAAAAFhBRpzk2oF9X2Vys7kT6VmBXM0AAAqVgiMgd0ljw7xocqTEFNRTMuMTAwqqqqqqqqqqqq//sgxPgAR1RxXeywY2jRjir9lIldqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqoQSXcAAAAAADsYgVwgUZnVIPsgaXAKRyFrIA7uFp1MQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7IMT3AEcIR1PsvMMoyQ5p/ZYMdVVVVVVVVVVVVVVVVVVVVVUiUAAABiblGtCRdQPwAdAVA2HQVHNLqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqhPQAAAO8d7/+yDE+ABGtHNJ7LBlKLsNKX2GDHRUNQVKqAeAFALgMUhOTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqIoAAABVRRqMgKxqApRNAYEQONA1MQU1FMy4xMDBVVVVV//sQxPwARZQhSewwZmiDgmj894QUVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUwAAABgK0HQWBEQADnZgKHRLExBTUUzLjEwMKqqqqr/+xDE6wDDBBlNxj2AYEQCajjEsAWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqIgAAACRH2BRkK4jAAqJ6MYhqTEFNRTMuMTAwqqqqqv/7EMTlAcJAEUnGMeAoLoJpuLYEFKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqjQAAABWHpJWVawACtQ6Yp1MQU1FMy4xMDBVVVVV//sQxOGBwWQNQoY9YCAsAihQxawEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVWAAAAoBIFQJYcX1UxBTUUzLjEwMFVVVVX/+xDE4AHBgA1Ah72AKB8BaJDGLARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVXCAQAAAAAA4GyRY0NlTjf/5362Fc93KTEFNRTMuMTAwqqqqqv/7EMTgAcE0Cz6HvMAgKQGn0PYkBaqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqq//sQxN8BwTQLOQesQCAhAaeQ9IgEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDE3wHBRA04h6RAIB2BZxC2CASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EMTeAcEoCTEGPAAoGYFmIMeEBKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sQxNuBwPAHKqYcACgMASVCkgAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDE4YACzBk0mYAAAAAAP8OAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EMTWA8AAAf4AAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",ZL="/assets/bonus-CvVo342Z.mp3",eF="/assets/bubblesLoop-B_LY362Z.mp3",tF="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAHAAAH8ABjY2NjY2NjY2NjY2NjY5SUlJSUlJSUlJSUlJSUsbGxsbGxsbGxsbGxsbHKysrKysrKysrKysrKysre3t7e3t7e3t7e3t7e3u/v7+/v7+/v7+/v7+/v//////////////////8AAAAeTEFNRTMuMTAwBJwAAAAAAAAAABUgJANtQQABrgAAB/B6uTQrAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uwxAAABAgDT7QAACIImOq/MPAAEJBsURDiAAEUBBwIGMEwfNqOB/lKwffKBj+IMoCGJwQmJJWiaVAVBQwskybYBAAAY8mQzeGmHtSaXBy2yKgEkRsibBi3wOGaBGYZPx1okZ53oIk5dk6cA9RSxkJaXahNQ5C2F5WklAbHyfUx3rZ5LKsYXJdSNdDHVLu8B46uyn6pE8OmLHm2qGNUQocvvmmHVL0zvzqW0eHCeeUsxUlA7P39Cs1jJVY1EKWbbhgiQiX6wiPAWU1AApZk08REEoTmCh652bI4C8N40VsJMQ1DzqOd+1+bL/MjxkORqViL86shsxVl2KsI2ujQVC87XDhZD0E4qdOqU/1fRcPNsiseRoFbP2yumR2kY0djbG0v7Q3PLPIbWoFZl/IqHGSSmn8JgeQbVlzBjyNcfeK4s4RY2bV1W1Ib+Pv/w/TGqatTeX7fmABrK38xETIRACEm3QE0SFLFuVZRMgtCqisKyoZ3kin58iaOSqIculpxtPd/6cTf+ktz3OnvyLDKbeX/16pF6d8IUGHQEPNlVOYTkko66Jxhgqq/L1XpkDJTQxJSKToCx1QZCJDQqD0CFk5RtERSkojVt06ns8pWEc1O6g9RT2I5nKGUghNIgm+mzNBN0GBa20LmURYs3dopwomTPuxfMt73nElqpyrtc1Z1RRAaSkwHbB6wSLikGUSIqSnEStIhkahAz2KXOxV1nb8I+CapoNFnlRERljohLG2rOsfbiJYiAKxqBeMERZ8aVro6yTUsJWxUwu53Z5ljBNROQARCYAqDhVkGSgUHkJ5BMUisnaT7gquejBTI4OAAbJv/+3DE3QAURTlh/YeACUYZLrzzDcwliqC4mNiJQCfDS99qMbryA54qW+ii7ZkZlQyBkl9AZnNMB8NAOicSzNKZa+FGAdr+ovEOMbBe9dq3FX7cRbm1DRvLBeSLXdP//9RpjHQzxTdJfo//3QuAKGZzEJy7AAiURgPywUWFIjNsJzXIESDEAphNO0z2YiwwFl3XoCpyhR4RmnnWHzxG0Ywcm59YlMF82DSZw7EogqSAAWuISoVDyEuRLIxThCiircUsheFPYaYG86iSivs+K/XIoyviu+zGnf//zi5MQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqgJZq8BUKgi+IweMHBVwVsI1BWeBaJXdSxgdlXc7LUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVV//tAxPUACiEtdeSEWWEyjO38FIw0VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+zDE9oAHuE1p5JhqoP+GK/yGGJlVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+yDE+wAHdFNd4CRBwNEGKjwApAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQxOUDw7wXOQABIEAAAD/AAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+xDE1gPAAAH+AAAAIAAAP8AAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",rF="/assets/conveyorLoop-CF-OA6qJ.mp3",sF="/assets/conveyorStart-CcCK4MGd.mp3",nF="/assets/conveyorStop-D5zeg8cv.mp3",iF="/assets/destroy-CZDN4Ktz.mp3",oF="/assets/detect-D_kRR5uD.mp3",aF="data:audio/mpeg;base64,SUQzAwAAAAABZlRZRVIAAAALAAAAMjAxOS0wNy0yMlREUkMAAAALAAAAMjAxOS0wNy0yMlRJVDIAAAARAAAASGl0IEdsYXNzIEJvdHRsZVRBTEIAAAAlAAAAR2xhc3MgRXNzZW50aWFscyBmb3IgU291bmQgRGVzaWduZXJzVFJDSwAAAAQAAAA3OTdDT01NAAAAKAAAAAAAAABIaXR0aW5nIEdsYXNzIEJvdHRsZSwgU2luZ2xlLCBDbGlua0NPTU0AAAAoAAAAWFhYAEhpdHRpbmcgR2xhc3MgQm90dGxlLCBTaW5nbGUsIENsaW5r//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAOAAAJ3QBLS0tLS0tLZWVlZWVlZXR0dHR0dHSBgYGBgYGBjo6Ojo6Ojpqampqampqnp6enp6entLS0tLS0tLTAwMDAwMDAzc3Nzc3Nzdra2tra2trm5ubm5ubm8/Pz8/Pz8/////////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJAXAQQABuAAACd1hx+LLAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uwxAAAA5wBYfQAACIEmGp/N6ABmZYgAzErrwAAAfB8cQKLB83lwfD5c+X6w/BM/y8XQAAAAAAABkLQ3wlAAAAEQCwAwww0+WFa3dKgv4UAX3JSIKgDXzlh5HA2onSwloqV6WFcNjBcHO5I/A2nao/IO7QNDrL5DEV7sGilCECu5N2ZdD6x5VWsTCGjFa9mHHFiEu5P37Hf9oTWJXUhuJbi0f3jf/////Kx/6w1IqXWNbDPhkACAABbeAAglG0QILxOnB7jM6izYniEZDiombEIbu2UDNAsCoiDAR8RMrHzFdtSTKSlIhwndIvEFQJoni8dPVGKK060UeUVmT39aE/l8mXwVKPLZsuYARADU+sYvG5LsvtYZ1nAN6GjBlThtPbQ41qaNRKnLBREVTK3U1235+UqDZrLmni127D6GP7hQP7esoGjUNUiyqt5YQVQCibgADqFMeHg1YBC+v1Uf8WImfCX2fb7uOELxKpF7Zo0YMEJXiHq9QV1GuBcuGQ1oIy1R5Yyaq4EFYAiXvMoZmtw887IpW1j30JKl6XVIj/aMvP6BTW7aIDIRXh8oxbkyFCdKLvuxAmEf7gAACUdZaUJZc/MUygMRlgX4rXomhjhgAI61iUMeob/9VyliVmmGAHcGncdaLpwYClXWFmpAllZeRCMRufXVZ9fSZpuIF6SzMlVALqhB5WdwAAAKqjzk1H9osoBA0+eS2xDa9B7PvtMmf9YBVVYZdVwAMnzjOLOixgcJ+o4iHkTm4Ghzqw+dUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVQC6tguqngAAACpVR4j+BDEUApT/+1DE34BKpKlb/YkAIQkVa32VnlRNmgn05U6qyId3/pItAN3GDc4OCrmmUNA+BOcus1KXqDolTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVAJiVCAgAAACCtZrSkAaFXbQN8xwByrKrBKAC3GVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUAWg0A//sgxPEAR1hjU+ZgpaC5CGo9l5WUPFJEWDoMAGAGAMAKSkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqoEAAWFJYIvgAC3XiY3TEFNRTMuMTAwqqqqqv/7EMTzAMVIXVvg4QNgk4hpOBykZKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqoAMAAAg8N5aA1MQU1FMy4xMDCqqqqq//sQxPSARBQ/T+BhIyBviCq8B6hsqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpRlYUFXUxBTUUzLjEwMFVVVVX/+xDE8IDEAEFT4D0jYFMGK7gEoG1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUF9aTEFNRTMuMTAwqqqqqv/7EMTkgMIYG0/ACYJgMQOo0AQsXaqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqq//sQxN6AwTwdQIAFZGgaA6jgACQeqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqr/+xDE3IHA5B82oAGA8BeDp1AAPByqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EMTag8D4HTUAKeggBQNmQAAcJKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sQxNiDwFAdKACB4SAJg6WAECQkqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDE14PALBsuAIBBIAUAZoAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EMTWA8AAAf4AAAAgAAA/wAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sQxNYDwAAB/gAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqo=",lF="/assets/headFall-rxdxTCeK.mp3",cF="/assets/headJump-GCHlCfni.mp3",uF="/assets/headWalk-B5kQ4tvC.mp3",hF="/assets/heelsFall-IsGtipMw.mp3",dF="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAMAAANvQA8PDw8PDw8PFFRUVFRUVFRYGBgYGBgYGBtbW1tbW1tbW2Dg4ODg4ODg5SUlJSUlJSUpaWlpaWlpaWltra2tra2trbFxcXFxcXFxeTk5OTk5OTk5PX19fX19fX1//////////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJAP3QQABuAAADb3ce6y6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vAxAAABqgBabQAACL+Jyq/M5AAAATd0rslm3BwuD4PvKAgCEMYIAmD4Pg+fiAEDivB//BB2CYP8EPlHQfB8PygIfUcwfD+CAYAAU4EERahmVG1qTLSTRQACHQxwMcMsQaNBDJykQAnheOVsEjpbtBSluhY8aLnhkR3SqInu5pvluoCGSNeIPEP7PIsMVAof8vqJIx+WjoAGziDvEiannoTqQJv+0KPDobqTKkIbRlSwicofK9BcD9jj2flFuRxqG4IZpVoIx+cf3jH3bymJbbxuRDmnwwrxLmpba+3O/ErHaWc5hR9j1FX+EfSxTtJf5Xw7U3zPLtX93P13n8q0H8rc1fcf/2L9C1KBFc4gxM3ZCYJmGinxCyQF6IUdQ+jRISyQlcGwEOLFUWAlRJGCxiiZGykUUUVOsZRsxqgbLdYXQljEukqSpKi1RH0CbCYiMlaKRuVF4rBUmhlRRMaI9x4osiymzPfWyRkizL17nqukpI37b1Ge+cSSMm1qSMlXb1mySRvqU6jZJX5hhAoPEGrCrl7RMBc4xmIkmS2dx0kvlSGcyItAQ7CyS/Im6bufIFqiY2tBakdJ/EMFq2Y8EqwmDkowf3YIWW1NR58qp/W7OkvEWr123iWK4i96wY5eleVa7basASy6Q4hZ3I4etRFgbWA2XHZiHG+y+QF2HYI4TiV1JEWkxrXwwxLraLURInnGvIxrj7qZAZf79rQT06eVSprKvhjzbStl/25YYBkc4lld1tgADlzyqygh+XOi5b8cqWXJOiCP7izoTNBbakKzalazLiaPx0MIQUFDj5qZnDbNvW2IU+d2jMC5bmOa8HfWbaEuoX7/ofcHaTKCaoIKVk2lFU+TQADpM9RDdyAlEXAlK6OnRKRHINRFtwMUFl3Ww9da+P2qv+f9wJyyJoxE4yTEFEzrrqIhw+nan+4Rr4+fSdsUW2CB/VrcgGS3iLl3+/+YAKdlIf/+2DE6IAQdVFb/PaAKUGVLDz0HfSlDIIgrA4H92yr5cAuKkFkhW7a1rZDWricNKm+oQmq25qlRr91S79meUexMW6rst5aLH/u71fzQAASKHmP0cFUb7VH5vUUppI9RQrVs0alF94d2ECivnfDHRKkw9EiSy+l0e9T0ZWd9/+VdAkigRcGdFAl0okAoEAYAGo0SOObDj4QAiD0ej4AgBlyt9sGDiq7XKjYyg9chwAXABM+F9A2wiAZ2BFwwv6A8DLkTGIKBDZQJ/qw48QoSwtg54XyHPC5AKQRD8+M2TQ4BKBASSJMTwOk2E8/zcn0jQuNEZFAQmFpEaFknP+ybn0GZOVxKBb/+0DE9oAKEM1b56BxoUaZ6j2HoHzIsM2LgLJoOP/+yC001MhOmyJkTpkiXjUC/9Px8VpHYGaDBR8uiAKF8r1kDRHDX4oVTRp+YZj9/B+amUqE46DOi2iMgeRvJRI0UbIol0GwSzzNFnNjzwVsLijM2QdMjvDbESjW1pamwzi0XV5/MiX/mmkX/6G5mv9B8w8lZyVnElvL/WTmDRAgheNxEAEpQIGsN80TuDtnMlnLCfqHrw9W6v/7MMT1gAmoqUvsMWkg9hKqfPYcfN6tr/F+M71h8j3JG2a6y9rzqELFmDWmPrNcwiQ3x9Yx5d7yYJeaTwdV93Lez9HjRkfpuBZ9+T4gf8k+Ofwyb/wZcF/jSPK0VRZQmIIVTzbNFgy35L0whBPTi0mVYsmen3JU+67Wsf3+vqmmtSMcfb6BjyXvzl3rN6V+dzRCgGviO9U/CAFSYf/7YMTzgAcggUW1gYAijidqvzUgQMuLnVQWVPiV9H5VjRT+l4F/loQ7f2y/1//HSPI0C6Arwaur2vcIA1LBQ1CmHEbm/92uTTvv7VilrsRcXsK1podo2HzUrH28/H2+s2xDoV7j4OrbvFiq45nCusWz8+uDvOmIzTwab00QnIdiifcX+1rm//wUyqAZ+Y55mmFp3cW+r60EQodkND92jYAHly9vYGehmTdM7jmwO2uF1uEPasNO/xbMbdfbC2q3jC4RpNQZtty5YosXMHWHuWZnGnLj3xjbbDzokInKmkiNVQwC2u+qOiCn+WaVJAHULvSc1/1e5YSQGimpk5emQAJmsIhLFf/7UMT9AAytA2H9hoAhkyVrfPOLzJ5Dq4L0DQ7J62Vxt8JluDcoVZzyxqZ/vK7D0v3Vy3vmW98ZlT8pHDMyplRSBo1RDRa19VLISV72ThYEndXbNx8RnOPmsqocxH+YuO3/+Q5K3pUdP/A++awgAFaY1HlRQE1pyZC4MNyGrFsX1Rk4g8uOQDy8migDCo2qNSQJkdzViTxUPc1as8PHZeyNmD329Pyw+W2dr28AAACXPUDhVn4l8Krv/KY7A1uJOFqxOElu6aP/XB4yPrLtiJn/+1DE9QALhSth56y6YZKdKr2HofzIIFy1rTeWqGGuSgIXr6P3ff/22dn/6/QqeAmgqWaTeECCoYEAIAAAAFx64msnKFFjiqafYSTbc7jgMvUbJcvn2WWYebpAZ1KBr1dlseUBqw4bKBhRfoGjmgWVgZAIGFBc/f8G5geoRACwMPQ//C6gWcHqE4JzEYf/44BZZsaDliC4yf//5qQMiYsggh4Zgihp///5EzhcK9Zd///B8PA+CAADH////0gRAAPWKgvFMiPaNosABEAHoAl0//tQxPIAC+TRTew9TeGBnWi9hJ8MSKp0muQGavaZwAYYcqcx4NWwzRUyBVtEChJaWRYSccwPwYGPXRGDgriBR0rsBHi4miGPAaDyCpmAyZmwBGiik74hC1I0kNEgq0+y0YFAQVFhpSX9SsFcooM3eyd5LciIoQXmEASMEoABlYV0/ADR1PU+P0cRUY/SZLkBAmw2bgB3uSmFZaoKeSPi/FXCCp1cESzkj+R2rWhqnz5q9Tf+qb/1yd39yD3Qy+MyyNy2rlF9Svf8nZnuvqXrH//7QMTvgAf0oUesNKzhBg3n9rCwBPq3U//3dpu3LwPSVTb6tbitOoA2ukN5JkSUlAYEHAkImfuZKXlcalg2WtxgSRyynjiOaVCSKxNdDDxfaS3FUFgWr/1qggwvnORt7jEkVEEK3/fkP/u2Vb/ouhP9cs7yMQ/PWeppkGmHU1dd1YgNOQoHEnhLKEyJ4q2cuajZ1ezv45cQpiPGANEEFppumtSaaA7BL2rOpvbQ4sUXetNNabGJ//uAxP8AEdUxU/maAEN8KSq/NbIAoaDkBwDWbz5s6epY8E1piGSZRghd6ytqAzpb/qd0zMna/6HX/6noGC9vzqDiKkYFYKYBUCQBUFBAGAwAAADvUU0NTsnI/zOjRFNNZI7/EV6cC3lMf9MQEvCS4LEcRMLC6P3JYepIl0TIdxfC6+XhxDGNZNJUT4yNvuXR7D2TOf/pGJqTVP//zpdJFJR1EW/56W2KTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+1DE9AAKYOtn/YUAIamnrD6e0AWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sgxPKADKDVUfmWggAAADSDgAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==",fF="/assets/heelsWalk-Bmk6WOTI.mp3",pF="/assets/helicopter-BYGzJTF2.mp3",mF="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAMAAAMtwBBQUFBQUFBQVlZWVlZWVlZbGxsbGxsbGx+fn5+fn5+fn6Pj4+Pj4+Pj6KioqKioqKisrKysrKysrKyxcXFxcXFxcXV1dXV1dXV1ePj4+Pj4+Pj4/b29vb29vb2//////////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJASdQQABuAAADLeLlBWMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vAxAAABqgBYbQAACJ3neu/MYIARAV1lrd0u4AfKAgGHA+8EAQB8Hwf4gBB2D4fygIO5cHHcH+UDH+oEAQdic/lAQBAHz+BAxoAQBSAwTDAgNkVT1nptAgAY0GGiYh7PCRB7DVx5YfkOOROSqQUSkYfHnOLhrEBoy3a5IOd+kTrUdfJXD4SqC23fdhrDn9VGu+Qt0nmCOG6FaA4Ae1uz4xaWQfGZLemJfSQmknrk/Sbv07+xC9L5HMUtuU1Z2IWbs/K5fqB5uzEpTRT0owszM/3m/13/pM963rffzrw+CDbv8oNBhIDE6rYGQNTY0KMcsuARgjTREBw4Ri4lBZ+m7rPl2FVO9Pq/kQ4BaQPIVXUKQENMSs4tYXKPuiQMhXx8Eia0h0D0uidKzaBOkTmQyhqtjMmzY+qs2ugouvY8esZuYoqRL5s6a2WgiyJcNs6bpJoGR5lMsxVTWpVajya1S+gtkEKa6k3pmakUy2aqnjiVBBJddqmzCMI+j4M53RLH3dr+TYQYGiM7BLic4Eo1vSFBQHNUD7gA7zX+eZpX/cgD8G5e0Aiykc7yJof/8qNc77txu/HHXJpxv1HGzQozYRplB3VRUOpE5BFOINWjpk9L0nTn/SMyKfmfY94QSU9P4JHMjMRbGE+VP+vc3EYseEuQRzpwWcUP1S6128evAlRtUZ2GCGlx9iSNLeJR73naPocpt+dCjFKam+tERuTgd3X1CJg1b+jOpjB+y8U3EeTz+F6hvN7e3v0IdXVj1S27Iys96P1br/29/T7f16yuznaZnRLUY52tV20UJIr14XBsyPEEAbe5M2jVjT0bJYkSst1YAV9QsBlIMsO420Vg3RFs0KkLW0T89yeZ+J6n9/Tze3t0P0Xq/QvX0/6U7ps3t0/vEzK2GAWU5xQGFIs71p31HkDDNVsDTRZJmyrDjWPDvT0PZ0eYWm5QFdneDMKSaLz5v82JA7nkUz/+2DE+QATXVdp/YmAKeew7jzzjuXvVgAmb8f43qGvqIdS+f29/+LdD9X4w5E1botnbanUfp//fSmWaLWXxRdb4Fg7oqyjEC5KUFvVVSNicwizxubAxpbaJEgc4fE0K6beiDOD+eQxEdoE7y3kTbh89FHuyUffVviXPW1On5d0/S6GpvEtT0sozsS7ez7f33VobykDRRNpAA7tweNRCwUpRA8TjHZszi8fHMMpd2wWVP8lndHsHk1AfbUT/Hvv5fRu93uk68hvhupsNwFWcpoZIyodR2duivvqW1DGKbJzwUhHSO8lCcm5RC1A69cnygdbFgWDl+KyHFStDWHLqwBAlUNItbj/+1DE5oAMBZt57LxH6WAlr/2GiTQMep4YoZGdlTlAcef7+WxXdBGt8PVDJN5d0jU+Q83vukqDKnO3SaN9tVs3iZlalUwZIEMiSJgFJ02unBmHeFs3iCULufW9bJig6ZlFPe/gKmS+kPtQEosYaOz4j6UDhepvTpbQf29eD9W4Z0jvUyrbXXtqXTjqPukiTPZURy3A72GCaqjPGzFI8E5tsJme5qpARahVmLv2NwroO9ktPvW6hfpUnoC2q4Ys7wHod8ls5vbq2gRV2Jx3fU3V//tQxOeACdTHf+essmFFje89h6i8LkZughomPzcg5KKXwPs693/8Kmt2K0btqo0bB0xEkpBIzcmxus0lWdT0kc/jYXLy3pPwtc97LrhYFTbzQEq1ig7CFXwhtGdG7mbQP+3VtxL0Tl9S8YLyzpCJP6KnsZRQaUUMKeOKyz1EXLc/WSlYq6+hyIolpBwBHU3ZRac/EQ8hsjZQLw39Gat+9BZgVjNTQXwzN4wUDlLWpdnlGAHNTK+XbkegidC9W4IX0V9m6jcEnt0bovL7+qf5W//7QMT1AAmscXfnoVIBU5HvvYWc9NNbaq7FKMIrPqI1L3KxbX+SqgYAJCViAAC/R5CDjKFMyod7VAJ3owRV6tUkYiFq1LMpdwYgF5UNM+DDSvAqXVTQs2o0U1YufUdbiU/X/ne3Kt0/5zccO/2+/+vufspHUwxTZc5BX7k/8hrVFAggckSAAAu8TzVmHJLlQu6Ro9dwE2f1VIAlvWSReDGSvEKzsoep7UMZJdZNPdN+N1Auo3iv//tQxPQACgzHdeesUKFQGS889QpMtqXp9fN09N5m5fXyFupO6M1TEWYpN6loJG307mHqigcARERIIUjOCbmQrBhghVs8Alr8FwKrW8mCl4uciKnnrwUL7rH9a3lJHW+Kr99wwwNYqoNej9RHQB6k6epOrdH6N0p//K+z9D8j5o3ZmePjKHdDWEAMqCGwQUnwpOQw8q5F1T9KtGfIUKixhTdWStnxrTQ/i4Z1A0/UBpPjZuJvAvP5upeYM3X05VbKnN6fGXp7dX/1+3X6mxINlv/7QMT/AAt4tXfsMLBhXSVuvPOKlDSXnp8LBm5prFKy8ASXKlJrkaq9yDqsE40hao+rGAJISmPYaBjasuyzLBdxYBKDOr5JU3fRuj8L5PL5NVZrba/ty+/QaoN0uUQt3W16KHwYBmlXSRJW8AEXpGg6hBRrB0mdOMovLTXRYw8rWsFkt+9wzCt17HdbQVB6rEQYTIvzPzdH8vl9PL4NtX6N0N0CG5+nxttGdvpqShcCOjZ2y7cA//tQxPYACz0ra+w85eFOpW09honkCvyYY3iQkUX0uU57GJb3KEkarUaAhhO03QDsJObmZfCfjZxxJayme5efo/fr9LWmXmIDcRPtkt8Q7bazoRABQCAQUH8uLYAAAADVy4BE4GkD9DAk+0dUxRax4cC0Njc941/ykiERi5N1kFqSAvTfcJhhS4f4hA61y9QEFSWOlMqpOHkkXAt2FiEUrLIp8Hi1LJ+UjMmViBO5x5HTBikJ5qFjG9Z/+frWv4B4Mgh/3mb//3k7V//99weuKf/7QMT8gAp1K2nnrFEhMaWsvYOJ5NMhHICZLKAAVQEg1BqA04KwNjJawIQlCUTicfLlgYCYGgaUDQNYNA0e8Gg5lgaBVygaBnxKCrsSgqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//swxP0ACWDJa+w8R+ElHiy884qMqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//tQxPYACKyNYfT2gCH6F2o3MPAIqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EMTxg8csL028wYAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",gF="/assets/hushPuppyVanish-CZOUg83F.mp3",yF="data:audio/mpeg;base64,SUQzAwAAAAABJlRZRVIAAAALAAAAMjAxMC0wMy0xMlREUkMAAAALAAAAMjAxMC0wMy0xMlRJVDIAAAATAAAARGlzYXBwZWFyaW5nIGFjdCAxQ09NTQAAABUAAAAAAAAAd3d3LmJsYXp6bmV0LmNvbUNPTU0AAAAVAAAAWFhYAHd3dy5ibGF6em5ldC5jb21UQ09OAAAAFwAAAFNGWCBwcm9kdWN0aW9uIGVsZW1lbnT/+5BkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABYaW5nAAAADwAAAAkAAAzXAEpKSkpKSkpKSkpKYWFhYWFhYWFhYWF5eXl5eXl5eXl5eZCQkJCQkJCQkJCQrKysrKysrKysrKzDw8PDw8PDw8PDw9/f39/f39/f39/f9vb29vb29vb29vb//////////////wAAAChMQU1FMy4xMDAEpQAAAAAAAAAANSAkBqtNAAG4AAAM17UwrB8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+9BkAAACtwDY7QQACj7AGq2ggAFNOH9J+aeAATUMKT8w8AEMl2x223XXYDXgACBOHh4eGCMAAADw8PDwwAAAAADw//0AAAAAB4eHh6QAd/h4eHh4YAAAAIDw8PD0gAACPDw8PDwwAAAAADw8PD0gAAAAgPDw8/AAABARKUssltuoAAp4eHgAAYAAYeHh4eACAAARh4eHjwAAAAADDx/+7wAAAw8P/YAAAAABh4eHjwAAAABGHh4fOAARoKg7m7q6w7fVgAAAAAAGVKJXHUQiRk6oIINAoes5bwJAnhHlxWSwCXhBQ4eYKkPgwBYAjh/EQSIvJdVKdKtimtsHgLcGcQpNLbPBbVFBjQTRQliNKZ1AxndK/MbMEYe///////////1mAojQbrDKzs7a0AAAAAAAB7QJFv27F509ww88gEd4/eNh1yFVTUcCJrEChbRFDkUKUUMJucGNVq023rZFZbsyxDy2QG1zkZoQKMR8sHoBBtNuO78AAAElR0jwLGOESSdqKEepFF9W1Oo451rAyxzhrsgmsz7mnMl0D8i1tkwUVjFzNVCPnf5YRjd4hoDKVyPf4AAASJEoONd/pWjpJ8pLpZp6aT8QEHzBGb0DFf7Q4wE4lEe6McUGC0yHgQTrtuh2bXAAIDG6r9xMwDkvQmgw2IUkUjltYRzNqJIYlSM76znywZCgohD3yXY2XqjBQ6wWPg0GDi4lv7SDBckyAxuy7cKELMpl0jVcWNjXdF684oREQm1IzzVBysxBAYZvB9u478ju+v+kb+t1ACZNdUu+4AEOkhKBm7axdX8Gmw9GBeGbK5SSamYgKsmjRLPttZMyFZ1U+4yxCD6yZEILmJqp7F5FT6JIpmAOSq34AAIebpRB0lUf5c5QGQHz8ioSLPpHVp5C5x+qR5CPRbQ//ERuuky8/jnf0BGEJUt78BQVZzncUifJYTRzMg5z8STzEJDzVlETIKRNS7NXeGx8pmLKI3TMjIGVOgRuxpZvU69awVWAkSjf8AASnYk4DvsrXiFkPJbUwQOdD2PF0tSYVTOpCdis1f6a3ZZ3ETuzFpyvI4lyRjKk0AFGNLv/AAFRFhLJmSoUNFAcIIlhArCocHTs//tgZOkBEewa0+88wAo3Q2p954wBRxBdU6exBWC4h6p09IzdOAPemIppHGks/UH26Xud1aZ9w0aovRKm0/lgzsFRytntsc/wPEARgAFl34AABUD1nUwG7orCEBICgIUGiChKs4wUS4Yxe2/f1gfV/CdaHlge/oz+92AZLa++U3B6DMDOM2CK6ZZzoo/IB/yqVffKmEiTsqSaKKXyM8GLEJEsKMMNOuAw8JRc/LmzyIYM72zERskwE4Sy09vyBSxKzA2w1En4fDTARJQlmi4Ioje5PJR3P3KlQSClMFAQoXnuhs/DOU5ELNIVIc5rvAAAgLu3AATAOolOC/CEl72SNCijGyYA//tgZOuBAd4XVWsMMbgwwnqdPMI9Rxh1VaeYbKDakuo1hIkcIFLhOTmJNFrC9faW29ON3mIP7ZQlkP5uXkU6wQ4o5miMQZp9fQyLSeRk62+lEmgdpgFEVZfgACLCcOcZ6V0+eU0o0guqtj2s0lNaTapUPbHIDcnKk1//e/0uftMYOS4Fn47N2AJQSijL/8ADfA0TkLINJaN8Xc4xkSjXBIlabPkTR5sksFELBPcisaGNdznE18177gRISF6tY7Zxn0pE1fv6te1oH/sMWtwsqb+gABtmKfhJZ1MHyWhRmoXE0w7QGC4IohhpEBl0UXuXY413LLQe6F0Qe7IKlVRvBtchTL+V//tgZO4BEfod1NMMQTowIVqNPSMzR6RfVUw8waDeEiq1hIzlYVIRRae++AAdZFieIeStBCTCu7NA90eEq09CBLmkkaKTjUTY3Xms3lu9/WztuTjBsz+3kPQKO/DQyA+o9bvmZ+mdh/2A+EWZxoubf4AA4C3eITqgthPRnJExAmEb4jgEPC1Q4bSnmEd6lJBw7Kkd5ioUITYeX7Jg1sgEQ5MzsGUE0GTCr/9wAp4VAXcXmsPDIPGtNt32gFzmTShwXkSokUmjaS1NdHH/772KE3LG8aqBYfWIyd4xRD9zuUIRrg5YH0Mb26XktEB5v7d/6AdzkDit34ABsdkgl2JwKUSkUpeS//twZOyAAjwuVNMMGnozJFqqPCODSGxRWaekaqjljys09g1NaWLaY7EfyhhU3aeWJfyt97VaQ6GO4KTZZJSm3OycuQgFEHJ1vSogyRS5t+AEKHoLwLeU6eHUa4blkSQXLANPQia6oxNbKoUtHItxEF57mT0/+f8OlD6acz3HR4hOmV/db5jOOTn/scnAK6SCCk3/ACoJEoQcx3YKI42Ukj5DUahEYwFIsauzFsNku/6+kY8zUFx2w6AFi944gDSQGWNoaOMAPTYRf1HALAKClvwAgkhctZTpqkPhKIghFcSARBseLlpnY8/1hy/WYIHlnmZsZGluCM3ROlwWhS5/5KR+WEEhND33hzbc9lIgkgAMUCU3fbxCpX1wTFQYhiTQJh0IIiXLaf1jqT2jVXGo7U9GZz10tOEfCP/7YGT7AAIvGtdp7DKKOeQK7T2DRUmgm2GsJG1o5pHr9PCOlMChiAIimDe8XfTYbSSCzxp3Ypz2UCdJGiCKUAAZPPgAYAgQryPVAywACUqiL4W5DkdvCec14MFi+HSFZWe5jILCuYxjFazTKWUrvsaispjP0KUpHlURBIGh6Ni3LO4rJAINwgAKeegBLCbCPClLon4DqOldGiwHVDTp+KJtagg4nJjCjBS1JtmhrD9UJua1SIdWdaWZ7+3Z7eWYEQU4VAXcl3izAQDAQCAYEA7wGviBAo+OjXyI6D38AUeGw29Qd//7CoAYEAQDAQEAAAAAAgItfBWiR8eJV4CgD4FUv4iYy//7cEToABISJVfR7Bm6P0J6/THoCwhwmV9MMGWhBg+r9YYMdP4kHg834qd/10xBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+2BE7wACPypWbTygCEPFSr2njAED8E04mKOAAJsMJ7MaUABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+xBk3Y/wAABpBwAACAAADSDgAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",AF="/assets/jetpackLoop-0RyqqDBh.mp3",xF="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAEAAAHVQCSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpK2tra2tra2tra2tra2tra2tra2tra2tra27e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7f////////////////////////////////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJATpQQABuAAAB1VdJF2gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vQxAAABxQBZfQAACPjQav/MUAAAAEShDM7J7pnHA+fECjgDPlAfB8Hz5c+UBDg+fLh/6gxigIf+D//5c35QEHFwfeIDmD8uH///+CAAAkwmpRB0hs1kTclhaJSJjSFpGr7DzDheqXqq6EC8wWUHFZcuhXpdpduxAAvg2bLwYzAeCD9B9B8YRFABSQBgopAZoh47yaIiO4MgihA6YQuOwdBJigxPAog4yGkSJ4iRASySgncgRuxTWo4ekDL50jRgjklIlSVIcaFIxLxGE6RNKT5EikdMDpwiw7i8XCdJshhFCoyZmmWC8Ym6loMkRqEvIIGaZHIktYyLhoaHGOqMECbMluYsWDFZ5EpIqdu6SzhbROF8mygThoZpHDQgZMn0zBZDjpiampeLJmaKU6jWaT5QJg6cIkVCJrKDU////7If///5maqA0aFdlVa5E0QslGN4UBj7Kg9SmJ+lC/GOeJ1JVVRg+AKHzAtEguIqRd5otUltoPNZlypGiIcNo7ZB+OFho4WvaYqPWomGkZbTxPqk0090dVfSxawrTNPxbLHx6VHTLXPX/1Es6RMMs/P/vfz/czLW/W6H3U/FssTCTLm2AJHBCCcIysaPY400CQEOIkKwDK4ehyIqsdWUTY8nCsxBUdeIkszUXA7ebUglyQaNlgKCs6WDSbizxK4We0t90JPcwRXaFg0pVNnv8f7PnRgNKyx5HtW6AYQZXiFdCcckjTXx8lxfljcC8s5YYyhYZHNILmd8LEBLVzUzyMyRkU0NhIiUOLBVLRzjz0A4jCQOyx4JNSLOTET89YxvCS5IW2uZ0emWsQx+8CwVvPFkqBoCB2SlWUWERlOzNugAAAABajznzQcoBnPkxJEqqceWTHEY7UxwMAAt4yYMFh8uRwkFB+pskpBDQMUwj7JSQY5n8daUxWqIfR0mU3H8o00yry0km1XMcRSsQmvVKGqalYFn3OB0uocR5CrCa4ahVCzTD528xf534Vv7WzX////1rnNNe+Pmv8lbZ////xv+lsY3m+d+2dQdW/9t////4+M/Xzjy+2961v/7r64rjdszVkf/8x//XVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVf/7UMT+AA/lk3H89AApUonsvPYYaFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVapFiGAAEwNgPCMqZWrToKnYlHncN/ywcET4iUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+3DE8YAK+Fdd9PGAAtayKn8y8EhVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQxOODw1gRMTzAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",bF="data:audio/mpeg;base64,SUQzAwAAAAACQFRQRTEAAAAOAAAAU21hcnRTb3VuZCBGWFRDT04AAAAHAAAASW1wYWN0Q09NTQAAAFcAAAAAAAAASW1wYWN0IG9uIGEgbWV0YWwgb2JqZWN0LCBjbGFuZ2luZyBzb3VuZC4gSGl0LCBJbXBhY3QsIENsYW5nLCBSYXR0bGUsIFJpbmcsIE1ldGFsLkNPTU0AAABXAAAAWFhYAEltcGFjdCBvbiBhIG1ldGFsIG9iamVjdCwgY2xhbmdpbmcgc291bmQuIEhpdCwgSW1wYWN0LCBDbGFuZywgUmF0dGxlLCBSaW5nLCBNZXRhbC5USVQyAAAAIQAAAElNUEFDVCBNRVRBTCBDbGFuZyBNZWRpdW0gMDMud2F2VFlFUgAAAAsAAAAyMDE5LTA2LTEzVERSQwAAAAsAAAAyMDE5LTA2LTEz//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAALAAALmQBJSUlJSUlJSUloaGhoaGhoaGh6enp6enp6enqNjY2NjY2NjY2fn5+fn5+fn5+xsbGxsbGxsbHDw8PDw8PDw8PT09PT09PT09Pl5eXl5eXl5eX19fX19fX19fX///////////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJARIQQABuAAAC5m46ML8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vAxAAAB3gBcfQAACNdsy4/NPAAl3qJ2XMAAC5OFAgGFg4cLvKVlz8HwfeUB9QIHCgIAgGIIAgCDso7+Jw/8oGP6wfB8P/+fUclwfB8H/B+ZaZhnZ1QlUiApNnQ2Dw/ssBgMUS/OXDzBIYWCSMzRsxIovmBgqNiagGjBYWEBEzx/goyZdThDkwYJPk8hAWCGkxMpmP4BjK2KpwLQ9cFcqhCLEHYY20YVFrd0bJ0KFFGS0502YTUVvfKatEy5rW4NECdEKaZrXZ4bisksivixZZWF24f/UaLiBRgmW4fhMEGTLOrJZ8Xis7yDnWV1BgX7x5RngUYPGeUS0VzbMQ9SvI00kBthYzvXtX4zrxXBAN7HHxSLSBqlJbbf7iQM4h23qLA////9IqqlmW1dnVYCUkZmwP1KhxCSn+4ksNY9lhKlsa4LYlHMaIh4WDCoLTcwYPuGHxyTXRx1KQw9imHe0Q1rFXzBOURdSQIVyOpLHUYP4mxZ0YgfE7VbuMtqPfMEoxtmafQfWqra9Lt916Hr2k+trS98vExN21LdznsscrwPtumUtJ2zvdQ6MyTRAe0QEZW7Nye5yY401/mTv06Tc5dnjKpOtRAIV0E9S/85zK0YGqO2xsafTMy8tWKmc+G3PRezL36p1/qvmuV1TIyzv32WYCC4dIkVgyoWHITzw3pdZV3Z5mFVjZbISnjk1J+hIZGa4UBG6QlgNl5NbQvW0zrFub02qHmz/+VJ9wt+MSFCp5MCJNdDpELPxTTvtXUPrAo20gVmWiw/zqP/0fX/oqGWGhWUSiiQjmgfCkMlDy2FewHwttKMGyi4ZRImur10U2ZN6mehHCx9wIsOUUVcGwEHlB1R448XMNPuUdZHiY1zHGnxOkmFQUgGdMAr3//0F/Tv+ru77bNEEghzjUAgaR9BlIliQHghLyiTokNMXj84BMDKOpyBL9CnxDSqNLU7PS/sqNVt0V9xHD/+3DE2QAPrXV5/PQAAXAkb/2BifgKGiN0B1WPt3YZCJ1C1g6Fk3qraXWl7f4Rjnr9Tw0vUw6EgmDLupxvkAIAICojjUqF4jGA5lRglrF/vawwSwMfHCfSTmd4YOhi+GTnzLJPL525eU//ar/nCyPPlOmhw9NN78PNXaF5rhUsrcK4c+4pDesrX0//69f/vrCAUAAvBLYOxiRaHgKJrYiiC8TzMc4TNVW8n8ElLmcvasOAyFsUFYafMlr3KZVLenGOeZ3vcgrWElJPPJfiIUoON5JPQyr/9LP93VCM7s6qgEFJF3wh5hyOIsEYRQdBqdjt7ZLM9L+Q0BozlPNULoYuEQ2art2/xC/vMu5blVT2bvfo4bKLGE0Lvf4Bc4Ue5RUCx9EK5JC3G2bPT3+l0v2/sQARJT4LiOAg//tAxP4ACbCBe+ewY8FSDC789I1YqCWQACDyMCgRLkQzEo7fI6txjQO1wfAbH9XLQw7Duad79D0nmKj9itp70qzmWyHs6q/XWJ61NvJOcxjxlyEKubdN/q/uuQrPTNEMiANNKUGIExOH9AQR1AwIGDktJktNL1a1uWqFq8tPUPX8mZar8xTbY9dabezppbC7qbmKIlCYa3NSyZIUu6cov/4TthD5aqpdhcimNDR1eIeJUhILTdr/+0DE/YAKTJ9zpgxPQWqkLrz2DDgN4pB1MJOjAOqIijGLjCVLtHJA5NHuSKncLrGx87CKeWMUymQHpQkoN1M0it6HW16EaC9WU59DnXM9nkr+VnzZBb31SRjiWUmC0u8qswoiDYi5sMhiIYYZ0Jg/5jmykmZPQlyhbMGeNmjwTmzBnxCnXGMSTTpXdGXewchcHkkFCdih4gOxa0/1yR2eaho7c+yIl2WZciATkmARhCqgzy6nUv/7QMT3gAnMrXOnsGVhSZXuvPYMNBy7OuAhO3sijMsLhPD2R2i72/bKbGOZWugJk0RmfbRHz3Ei3K11K11bLoeRKtefSb/m6LKNyYou+uSKWokEkmgDkUBQEhIHFsbjsOpOyNiYmOtV2hAsJqxaeKwSjdIxf31SXEMAhrOWh5WlIqsnaxu3VV8N3N9uy9f/6Kg5b0kjrUAViXhniWMglLdwAvVAPHcGhKOBNC6ACsJu6TEM/UQW//tAxPeACkzXcaYMUOFGJG58wItkxMQCpKaRU4R9EsLIm5ulAeQmEhK4Bx40ILVCY0Xa05WJdzVkTzxdArVtKvEQxw7AABil4AtjafKpVCFWJWXCMivtWJ0gkIDHthgt3tezV4lUgaKkPkzvz6g7GZ0yL/Dcj9X9bcGNJCjBR08IlN1sDTFuE2xJZ7WD1XapQ2kxIB2bYAT5jO1JEuZyVnSdLEifjCFWjMLY1AXd6yoXiBJ0tc//+0DE9gBKTRNx55hNIRqR7jjxicx4p5/8hJumdLTUsjCchlDpUKfwLaBs6tf0dByzqaOogArLwAYbQUpeixNzITAhOi3UppYdtstEGriUYpioeztQLHOVZi55yo5jN+qGOdW1EfTHdN85Bx3dH/+Zj3bSTEFNRTMuMTAwqqqqqpxgGAgGAOMBQGAAAAAAG0E6MWwG0AmfBbSD5iJb4HqYnvx3DtJU4kqrxhRxF8vL/84YqcyNv//7MMT6AAkw+XHnmEzhKJ8stMSJdSs8K0xBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7QMTzgAkcVW/mFHChNZWsvPQNpFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxPiACES5ZeeUbmEPGqv+nnAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQxPKABxyHT7jWgAAAADSDgAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",wF="/assets/metalicScraping-BqmM5ys4.mp3",VF="/assets/mojo-D9S1pz9n.mp3",qF="/assets/mojoTurnSound-D3oZPBXv.mp3",vF="/assets/robotBeepingLoop-Cz0TGwJH.mp3",_F="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAFAAAHBgCHh4eHh4eHh4eHh4eHh4eHh4eHpKSkpKSkpKSkpKSkpKSkpKSkpKTBwcHBwcHBwcHBwcHBwcHBwcHBwdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ//////////////////////////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJAM2QQABuAAABwbVZvomAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vAxAAACbQNZ7QwACnxFem3NvABAAAb/0m/2/DnECCBGAgAAHfHfAVjn/mAGf+YeHv9AI/9/mHh4AAAAABh4eHj3Sf6MPH////7zDw8PAAAAAAMPDw8PAAAAAFY4ef4AAAAAACAJLlcmslzaAAAAA2dhA8cuNgUzOZEQCemOB48SmLBSXoBIB4bRWLmodWkIyM3KQbxTk5MgkxYg5TEmKcVImoNot5fXBIMZ6wUILqZqPRipgksX3ycRsY3WhpPFfXD9wjP2WCzWi4Z9M1lU4rrEJyfbg4tf5nlSFyl9BDltdXPvf+ALefotw91Kg4XKLrKnrM7XFKkPlm0r62lQG0SkaIee1fdc3yedKObrKqLVO1Tt+09AQj4eK79+e/bVR/unc8uLTcn34t3eGbDHckkUd3K0+q+QaU3nU3EvM2q0GCgoYcv1QP5+7LldGULYTd9qYJKpfHTDNTWlWkCVxEXsA0NJe8kpbGX1Q1lrpG7f/wAFfElzwgk5nDf0u0JoQI2sRE3BsCSljdGmx70Q5Yg/U20rsJ0NItx4T1FXM2t7V2/dZ76daq/iuwEHOUVVLy7f8AGSoqMcpzEIGFVQPIdxGC1g8eyzUJPB/m+Vs40oU0Ln1rchVwreG7jwtkrzwk2XyO1OjltCtYM8yWuSW38AFFsUh7NgmT2ISQn6LxK5lZATETo/wgKuhIPbwWTCUA+ZF4ZAKFIVcWqQvTeka0Plby4pSVnEKmgzDXm45rtwAUOrrpafToPNcaq3bO4tWy+kVpIIrlC3c+YfE4bc9y8bUa2N0mmqfTltWw+ALkINOReTXarVeRKPhu81QCgSjCUVpZ2R/d7LQIAgAAESQ6DJhyCwQEJtFbpvkLRAB6vDAgDTBYBzU1CDEMllappkMZMWwCMNhdXkshDm11YEBBJYB5BLIsRiSvE0FyqJQbB1edgF+H3iZhEhOTOBh3ebtKNyZ/40/D/Qw//+zDE/gBJ6HVjvYWAKPOObHWGCVwKxYYhmDMqGV0sjpqeHI3F5XTO1EpE6NWHdd33HPcYpoxbkErn9b1lrtX/////+vlSZWM7FcLhJQUAvy5QGCQfCwlYIiJ07/dd0KUFAKVYWZ////50YkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+zDE+wAH+IllqLyhqPyJrL0nrByqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+yDE/wAH8EtjrDxjoQyNbHawYASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//tQxPQAGFTpVfncAEAAAD/DgAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==",SF="/assets/rollingBallLoop-BUA084C_.mp3",kF="/assets/servosLoop-Bn-haKck.mp3",CF="/assets/servosStart-BgsySGJF.mp3",EF="/assets/servosStop-BR1i0gi5.mp3",PF="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAADAAAF6QCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqrn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+f///////////////////////////////////////////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJAV6QQABuAAABel6uP7WAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vAxAAAB9gRZfRgACKqmyl/OYAAAAACI1hbN7r+CemAgACCCAZB8Hwfh/WUBAEAQdggCBcP8Hwf/ggCAYqdlAfD/5AHwff/1AMHwfD8EAQd+CBwAABI1kyRERCWqKVtkgAAA42djFAiNzBQIMQVI5g8aESdUUGkKkOYLCLOCAIGDwArAKAEs8YnDjqLFfhp8lYiODUwghOhrcCurDOSqLUCcyJMM6gPOkeWXTqE5Dk8TaQBI4eiVFWfSch+awwo7sVp5ZG/mv7elVHPw9ekbceU0ip6acrW8MM7E1S3dc1S4WsOZR6/rlcJg4Lzjq0lgLOVCDBIs9nWE0JGbalKA4KIWpSZSJSZv5tDYAAAAPtilTj7SsKZLpm1EpwZwFwYMrkoFPLeJQBYhjQGt9ThSgC2YBdx6EqWEliGKgWRZVRkPUOUCVVR9iyo4vy5gkvMUt5IxbiFNJ+KZrVapeSTt+LVkz6x6PN18lcyxY2czxs41/S+cZ39/+vvPJC7Ve/tEClDL/+CxV6RzS3//SIQDni4i2eXeVYLhGAAAAAAAfmqMy0mLmhWDlAyyLqppdsjlLcX8YA2k7EnTAJDPLFYTz4nr46zX4cZMGHUOZmZabfv0bK7MqAhh4bf1UxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+2DE7gAR8MtP+beQATGN6z8ywkBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+xDE1gPAAAH+HAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",TF="/assets/spring-CP3uOhml.mp3",RF="data:audio/mpeg;base64,//OAZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAADAAAErwBDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0PKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr///////////////////////////////////////////8AAAAyTEFNRTMuMTAwBG4AAAAAAAAAADUIJAL7LQABwgAABK//PX1CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/zkGQAAcwDIACgAAAAAAP8AUAAAP/////////8pD6nHC7yChYKxXdLXLLlcpVcZRKfNIh3joGTm+AAOhvljbRkUtWRrLKfwzRbh9MTGzzP/7BT6LoXH//vG3L5icqgAEIwyGpkSP5f9LCJ6HHUlfbAJYmDMBYOFzaizvh1veOO8cauf4f/f7TmWIOil+DQJftXDPAMIaNZ/X///lQQ45kPMEWZFmWKQgeHHUlZKLNqtNMVCz4KJTUMwq6AiE0ukL1iLKAiZokGW/ypt41ast1Vx7hvt/mcvqc5n3/+BRZmY4UvwzxYCBjREFMkv3LUtX+zgMFFBUyofH9Sr/y/9fjjrLKx/P/z4GThI33zdy/F6JBFQ77e/5jSQO3bcXw+KV+93n3du/zMaAsOSQApEeTGkNFWALiDZnQxIxVqar4ZgpCUJAGUJfJ6tO3jS/jW1KpdbawqaQiIihLZZK5VKXTKXCmv00y1vGxeaWSpx+tLAesCj/GDpc7hl3JhyxKT3jk8lp+DnAAYCMedrU1M8lukvAqaOgEywc4/8tVopLI/FxACHQYRlNCLM0iyy1/yeOuPCoy09e50Wh7CBMvNSgIqpjkxiqm/7/5fLKe3/56sWDKGx4kn214uwHD2QJpgYjl394///Xt2JXPw5H377dl9qlMiNV0EgzNCzmoTEiDeBiIUalUdokZsGYI4BjO8f//1l+sv+XxepYou2LH/z/7zNRYgDDAExYEOGruSrIhMPSZ/14K4eIVAqM//7/LL//////P/53DXM8////v///BTWIQztkEBiwQGhV/N+79JlLKSSVaSxabqH4dniAqgezyMJYFQVUDQwGioK8RA0CoKgry0FVgqdLHlA1BUqGs6Cp3EriJU6JQ1BpQNHip0ShqDRY9Ue4KlQVd/yx4RPWdgrUeUegrBVwiPCIOwVWCrix4RYiUHZVxUFYNKDv4lD+YjkSQaDiUq4RLDYlO4iDqCx4Gnhoso9UeDuIv1xEo9nuCv+CsFfy3UeT/8GlB1TEFNRTMuMTAwVVVVVVVVVf/zgGSlDKADQ4/gAAAL8AZZvcAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",MF="/assets/teleportIn-DZAhHW9-.mp3",IF="/assets/teleportOut-Bra-ABlh.mp3",jF="/assets/teleportWarningSiren-Boo1HoAB.mp3",OF="/assets/toasterPopUp-CNfTxQPs.mp3",Xu=new window.AudioContext;let El;const ie=async t=>{try{return await Xu.decodeAudioData(await(await fetch(t)).arrayBuffer())}catch(e){if(navigator.webdriver===!0)return console.warn(`Audio decode failed for ${t} - running in automated browser`,e),Xu.createBuffer(2,1,Xu.sampleRate);throw e}},NF=zn(async()=>({bonus:await ie(ZL),bubbleRobotLoop:await ie(eF),carry:await ie(tF),conveyorEnd:await ie(nF),conveyorLoop:await ie(rF),conveyorStart:await ie(sF),destroy:await ie(iF),detect:await ie(oF),drum:await ie(JL),glassClink:await ie(aF),headFall:await ie(lF),headJump:await ie(cF),headWalk:await ie(uF),heelsFall:await ie(hF),heelsJump:await ie(dF),heelsWalk:await ie(fF),helicopter:await ie(pF),hooter:await ie(mF),hushPuppyVanish:await ie(gF),jetpackLoop:await ie(AF),jetpackTurnaround:await ie(yF),landing:await ie(xF),metalHit:await ie(bF),mojoLoop:await ie(VF),mojoTurn:await ie(qF),robotBeepingLoop:await ie(vF),robotWhirLoop:await ie(_F),rollingBallLoop:await ie(SF),servoLoop:await ie(kF),servoStart:await ie(CF),servoStop:await ie(EF),softBump:await ie(PF),springBoing:await ie(TF),stepStoolScraping:await ie(wF),switchClick:await ie(RF),toasterPopUpSoundUrl:await ie(OF),teleportIn:await ie(MF),teleportOut:await ie(IF),teleportWarningSiren:await ie(jF)})),BF=async()=>{El===void 0&&(El=await NF())},Z$=()=>{if(El===void 0)throw new Error(`sounds not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`);return El},zF=(t,e)=>{const r=Qd();v.useLayoutEffect(()=>{Al(ce.dispatch,ce.getState,t,e)},[t,e]),v.useLayoutEffect(()=>{const s=()=>Al(ce.dispatch,ce.getState,t,e);return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[r,e,t])},DF=["characterRooms","currentCharacterName","entryState","gameTime","pickupsCollected","previousPlayable"],LF=(t,e,r)=>{const s=id({saveTime:Date.now(),gameState:to(t,...DF),store:{gameMenus:{gameInPlay:e.gameMenus.gameInPlay}}});if(r){const{characterPickingUp:n,pickupId:i}=r,o=s.gameState,a=o.characterRooms[n];if(a===void 0)throw new Error("how are we saving from a pickup if the character picking up is not in any room?");const l=a.id;for(const c of Nr(o.characterRooms))c.id===l&&nq({room:c,item:c.items[i]})}return s},FF=()=>{const t=Qd(),e=Ax();v.useEffect(()=>{if(e===void 0)return;const r=()=>{zd()||(t(fM(LF(e.gameState,ce.getState()))),CI.flush())},s=()=>{document.visibilityState==="hidden"&&(t(Bw("hold")),r())};return document.addEventListener("visibilitychange",s),window.addEventListener("beforeunload",r),()=>{document.removeEventListener("visibilitychange",s),window.removeEventListener("beforeunload",r)}},[t,e])},UF=()=>{const t=X(r=>r.gameMenus.assigningInput!==void 0),e=X(r=>r.gameMenus.openMenus.length>0);Se({action:"menu_openOrExit",handler:v.useCallback(()=>{zd()&&window.close(),ce.dispatch(ty())},[]),disabled:t}),Se({action:"menu_exit",handler:B(ty),disabled:!e}),Se({action:"toggleShowFps",handler:B(rr,{path:"showFps"}),disabled:e}),Se({action:"hold",handler:B(Bw,"toggle"),disabled:t}),Se({action:"map",handler:B(cM),disabled:t}),v.useEffect(()=>{const r=()=>{};return window.addEventListener("blur",r,!1),()=>{window.removeEventListener("blur",r,!1)}}),Se({action:"toggleColourisation",handler:B(rr,{path:"displaySettings.uncolourised"}),disabled:t}),Se({action:"toggleCrtFilter",handler:B(rr,{path:"displaySettings.crtFilter"}),disabled:t}),Se({action:"cycleResolution",handler:B(mf,void 0),disabled:t})},$F=()=>(zF(),UF(),FF(),null),HF=t=>e=>(t(e),null),GF=()=>{const t=X(af);v.useEffect(()=>{gt.shared.speed=t},[t])},WF=HF(GF);class KF extends v.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,r){console.error("Error caught in DispatchingErrorBoundary:",e),ce.dispatch(df(Li(e)))}render(){return this.props.children}}const YF=()=>{const{cssUpscale:t,canvasSize:e,rotate90:r}=X(cI);return{transform:r?`scale(${t}) rotate(90deg) translate(0, -${e.y}px)`:`scale(${t})`,width:e.x,height:e.y,transformOrigin:"top left"}},IA=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,QF=()=>{const t=DR(),e=X(lI);v.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",At())},[]),v.useEffect(()=>{document.body.classList.remove(...Object.keys(Wn).map(IA)),document.body.classList.add(IA(t)),document.body.classList.toggle("portrait-rot",e)},[t,e])},XF=v.lazy(qM),jA=zn(()=>Promise.all([XL(),JM(),BF()])),JF=()=>{const[t,e]=v.useState(),r=kn(),s=X(i=>i.gameMenus.gameInPlay.campaignLocator),n=yf();return v.useEffect(()=>{if(!r){e(void 0),window._e2e_gamePageGameAi=void 0,jA();return}let i=!1,o;return(async()=>{let l=!1;try{if(s===void 0)throw new Error("game is marked as running, but we have no campaign locator, no way to know which campaign to load");l=!0,ce.dispatch(vI());const[{default:c}]=await jA();ce.dispatch(hy()),i||(o=await c(s,n),e(o),window._e2e_gamePageGameAi=o)}catch(c){l&&ce.dispatch(hy()),console.error(c),ce.dispatch(df(Li(new Error("error in loading game assets or state",{cause:c}))))}})(),()=>{o?.stop(),i=!0}},[r,n,s]),t},ZF=()=>{const[t,e]=v.useState(null),r=NR(),s=JF(),n=X(aI),i=YF();return QF(),v.useEffect(()=>{t===null||s===void 0||(s.renderIn(t),t.addEventListener("touchstart",o=>o.preventDefault(),{passive:!1}))},[s,t]),v.useEffect(()=>{s?.resizeTo(n)},[n,s]),p.jsxs(p.Fragment,{children:[p.jsx("div",{tabIndex:0,className:"fixed top-0",style:i,ref:e}),p.jsxs(E0,{gameApi:s,children:[p.jsxs(KF,{children:[p.jsx(VM,{}),p.jsx($F,{}),p.jsx(WF,{}),p.jsx(QL,{})]}),s&&r&&p.jsx(v.Suspense,{fallback:null,children:p.jsx(XF,{})})]})]})},eU=zn(()=>Bn(()=>import("./LutPage-CfGWknyB.js"),__vite__mapDeps([13,5,6,10,12]))),tU=2,za=10,rU=({textureId:t,spritesheetSize:e})=>{const{frame:r}=pt.frames[t];return p.jsx("div",{className:"absolute border hover:bg-white group",style:{left:`${r.x/e.x*100}%`,top:`${r.y/e.y*100}%`,width:`${r.w/e.x*100}%`,height:`${r.h/e.y*100}%`},children:p.jsx("span",{className:"group-hover:inline text-pureBlack hidden",children:t})})},sU=()=>{const[t,e]=v.useState(null),[r,s]=v.useState(null),n=v.useRef(null),i=v.useRef(null);v.useEffect(()=>{const c=()=>{n.current&&s({x:n.current.naturalWidth,y:n.current.naturalHeight})},u=n.current;if(u)if(u.complete)c();else return u.addEventListener("load",c),()=>u.removeEventListener("load",c)},[]);const o=c=>{if(!n.current||!r)return;const u=n.current.getBoundingClientRect(),h=r.x/u.width,d=r.y/u.height,f=Math.floor((c.clientX-u.left)*h),m=Math.floor((c.clientY-u.top)*d);f>=0&&f<r.x&&m>=0&&m<r.y&&e({x:f,y:m})},a=()=>{e(null)},l=Object.keys(pt.frames).sort();return p.jsxs("div",{ref:i,className:"relative w-full",onMouseMove:o,onMouseLeave:a,children:[p.jsx("img",{ref:n,src:Ww,className:"w-full cursor-crosshair [background:repeating-conic-gradient(#999_0_25%,_#888_0_50%)_50%_/_20px_20px] pixelated"}),r&&l.map(c=>p.jsx(rU,{textureId:c,spritesheetSize:r},c)),t&&r&&n.current&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"absolute pointer-events-none border bg-pink outline-2",style:{left:`${t.x/r.x*100}%`,top:`${t.y/r.y*100}%`,width:`${1/r.x*100}%`,height:`${1/r.y*100}%`}}),p.jsxs("div",{className:"absolute pointer-events-none bg-black text-white px-1 text-xs font-mono",style:{left:`${t.x/r.x*100}%`,top:`calc(${t.y/r.y*100}% + 40px)`,transform:"translate(8px, -100%)"},children:[t.x,",",t.y]})]})]})},nU=({scale:t})=>{const e=Object.keys(pt.frames).sort();return p.jsxs("div",{className:"e2e-snapshot-target",children:[p.jsx(sU,{}),p.jsx("title",{children:"Sprites"}),p.jsx("div",{className:"flex flex-wrap p-[8px] bg-pureBlack",children:e.map(r=>{const{frame:s}=pt.frames[r],n=s;return p.jsxs("div",{className:"bg-shadow m-[4px] p-[8px] text-left flex flex-col w-8","data-texture-id":r,children:[p.jsx("div",{className:`
                  sprite bg-pureBlack hover:bg-moss border-shadow 
                  box-content w-min`,style:{"--x":`${pt.frames[r].frame.x}px`,"--y":`${pt.frames[r].frame.y}px`,"--h":`${pt.frames[r].frame.h}px`,"--w":`${pt.frames[r].frame.w}px`},children:n.pivot?p.jsx("div",{className:"bg-midRed relative",style:{width:`${za}px`,height:`${za}px`,left:`${n.pivot.x*t-za/2}px`,top:`${n.pivot.y*t-za/2}px`}}):null}),p.jsx("div",{className:"flex-grow"}),p.jsx("div",{className:"text-moss mt-1 flex-wrap flex-row flex",children:r.split(/(\.)/).map(i=>p.jsx("span",{children:i}))}),p.jsxs("div",{className:"text-lightGrey",children:[s.w,"x",s.h]}),n.pivot?p.jsxs("div",{className:"text-midRed",children:["pivot: (",n.pivot.x,",",n.pivot.y,")"]}):p.jsx("div",{className:"text-metallicBlue",children:"no pivot"}),p.jsxs("div",{className:"text-midGrey",children:["@(",s.x,",",s.y,")"]})]},r)})})]})},iU=()=>{const t=er().get("scale"),e=t?Number(t):tU;return p.jsx(yn,{scaleFactor:e,children:p.jsx(nU,{scale:e})})},oU=()=>p.jsxs(Le,{children:[p.jsx(bt,{className:"loading-border"}),p.jsxs(ke,{className:"bg-white zx:bg-zxRed gap-y-0 text-redShadow zx:text-zxBlack px-1 flex-row",children:[p.jsx("div",{className:"flex flex-col",children:Vn.map(t=>p.jsx("span",{className:`sprite zx:sprite-revert-to-white ${Tn({action:"walking",character:"head",facingXy8:t})}`},t))}),p.jsxs("div",{className:"flex flex-col grow text-center justify-center",children:[p.jsx(j,{className:"sprites-double-height",children:"404 Not found"}),p.jsx(j,{className:`${le} p-1 pt-2 text-metallicBlue zx:text-zxYellow`,children:"whatever youre looking for, it aint here"})]}),p.jsx("div",{className:"flex flex-col",children:Vn.toReversed().map(t=>p.jsx("span",{className:`sprite zx:sprite-revert-to-white ${Tn({action:"walking",character:"heels",facingXy8:t})}`},t))})]})]}),aU=()=>p.jsxs(Le,{children:[p.jsx(bt,{className:"loading-border"}),p.jsxs(ke,{className:"bg-white zx:bg-zxRed gap-y-0 text-redShadow zx:text-zxBlack px-1 flex-row",children:[p.jsx("div",{className:"flex flex-col",children:Vn.map(t=>p.jsx("span",{className:`sprite ${Tn({action:"idle",character:"head",facingXy8:t})}`},t))}),p.jsxs("div",{className:"flex flex-col grow text-center justify-center",children:[p.jsx(j,{className:"sprites-double-height mb-1",children:"This is not the editor"}),p.jsxs(rt,{className:`${le} p-1 pt-2 text-metallicBlue`,children:[p.jsx("p",{children:"If youre seeing this, youre trying to access the level editor, but the web manifest is getting in the way and redirected you to the games client-side routing."}),p.jsxs("p",{className:"pt-1",children:["You could try going to:"," ",p.jsx("a",{href:"/editor/",className:"bitmap-text-link",children:"/editor/"})," ","(with a slash on the end)"]})]})]}),p.jsx("div",{className:"flex flex-col",children:Vn.toReversed().map(t=>p.jsx("span",{className:`sprite ${Tn({action:"idle",character:"heels",facingXy8:t})}`},t))})]})]}),lU=v.lazy(eU),wq=er(),OA=wq.get("campaignName");OA!==null&&ce.dispatch(uo({campaignLocator:{userId:wq.get("campaignAuthorUserId")||"editorUser",campaignName:OA,version:-1},noShowCrowns:!0}));const cU=()=>{const t=lf();return v.useEffect(()=>{document.body.classList.toggle("zx",t),document.body.classList.toggle("colourised",!t)},[t]),p.jsxs(dv,{children:[p.jsx(ei,{path:"/",children:p.jsx(yn,{children:p.jsx(ZI,{children:p.jsx(ZF,{})})})}),p.jsx(ei,{path:"/sprites",children:p.jsx(iU,{})}),p.jsx(ei,{path:"/lut",children:p.jsx(lU,{})}),p.jsx(ei,{path:"/editor",children:p.jsx(yn,{children:p.jsx(aU,{})})}),p.jsx(ei,{children:p.jsx(yn,{children:p.jsx(oU,{})})})]})},uU=()=>p.jsx(Dq,{store:ce,children:p.jsx(cU,{})}),eH=Object.freeze(Object.defineProperty({__proto__:null,App:uU},Symbol.toStringTag,{value:"Module"}));export{ob as $,Cb as A,St as B,Ve as C,Co as D,is as E,Po as F,Ld as G,BC as H,DC as I,$C as J,WC as K,Fl as L,fe as M,Ah as N,Ik as O,dt as P,wS as Q,Qe as R,Mk as S,Ae as T,al as U,Eo as V,Ll as W,QC as X,Kt as Y,Zx as Z,nr as _,hi as a,sD as a$,Sm as a0,js as a1,vk as a2,Cm as a3,Uc as a4,Em as a5,tk as a6,Wx as a7,ZS as a8,rb as a9,iA as aA,W as aB,P0 as aC,RU as aD,$$ as aE,KU as aF,Ge as aG,Nx as aH,CU as aI,jx as aJ,Q$ as aK,Ox as aL,H2 as aM,U$ as aN,Rn as aO,Bl as aP,Vx as aQ,Mr as aR,U as aS,$f as aT,pU as aU,ln as aV,jd as aW,de as aX,kv as aY,Nr as aZ,aq as a_,$l as aa,bC as ab,fC as ac,zC as ad,LC as ae,GC as af,KC as ag,YC as ah,Ct as ai,A_ as aj,X1 as ak,X_ as al,Rl as am,Dn as an,Nd as ao,od as ap,pe as aq,X$ as ar,ee as as,bU as at,wU as au,So as av,xU as aw,qU as ax,VU as ay,Fn as az,Si as b,ce as b$,Dx as b0,Wt as b1,Sx as b2,Sr as b3,FA as b4,Xl as b5,sI as b6,Pg as b7,Gl as b8,MU as b9,NU as bA,Yr as bB,HU as bC,N$ as bD,QD as bE,Ht as bF,An as bG,td as bH,z2 as bI,mD as bJ,Or as bK,hD as bL,X as bM,pM as bN,Y1 as bO,at as bP,ab as bQ,sn as bR,JU as bS,gh as bT,pt as bU,pn as bV,XM as bW,YM as bX,KM as bY,ZM as bZ,UM as b_,bf as ba,JO as bb,eN as bc,tN as bd,sN as be,nN as bf,oN as bg,iN as bh,rN as bi,$O as bj,eB as bk,j as bl,yn as bm,Qd as bn,OU as bo,zU as bp,$U as bq,PU as br,lf as bs,Ln as bt,Cd as bu,Nw as bv,nM as bw,Me as bx,Ts as by,JD as bz,fg as c,g2 as c$,es as c0,f$ as c1,ZU as c2,go as c3,W$ as c4,EU as c5,R2 as c6,Ei as c7,ch as c8,YU as c9,I2 as cA,d$ as cB,Sj as cC,Vy as cD,h$ as cE,K$ as cF,T$ as cG,x$ as cH,kz as cI,Sl as cJ,l$ as cK,a$ as cL,sq as cM,Wr as cN,De as cO,w$ as cP,o$ as cQ,t$ as cR,nA as cS,i2 as cT,sd as cU,Uf as cV,j2 as cW,dD as cX,M2 as cY,vx as cZ,CA as c_,Dw as ca,zR as cb,Pz as cc,m$ as cd,L$ as ce,vU as cf,zf as cg,Cj as ch,jU as ci,Qr as cj,Z0 as ck,fU as cl,_x as cm,c_ as cn,a_ as co,kx as cp,_U as cq,n_ as cr,ad as cs,fn as ct,Vn as cu,J0 as cv,SU as cw,i_ as cx,ul as cy,v$ as cz,Zk as d,Pj as d$,s_ as d0,il as d1,cn as d2,e_ as d3,b$ as d4,Ot as d5,rr as d6,sM as d7,In as d8,LF as d9,Xr as dA,Od as dB,NM as dC,p$ as dD,g$ as dE,y$ as dF,Hh as dG,QU as dH,It as dI,QR as dJ,O$ as dK,N as dL,Jb as dM,TU as dN,to as dO,uI as dP,$u as dQ,RI as dR,OI as dS,FI as dT,jj as dU,z$ as dV,Xu as dW,Z$ as dX,rm as dY,Sn as dZ,Sp as d_,FU as da,UU as db,B$ as dc,hA as dd,Ye as de,H$ as df,ct as dg,jn as dh,DU as di,ff as dj,QV as dk,ld as dl,Cs as dm,q$ as dn,o2 as dp,Cz as dq,Sz as dr,F$ as ds,JR as dt,qx as du,Ne as dv,Kr as dw,cl as dx,G$ as dy,I$ as dz,ko as e,E$ as e0,Af as e1,$R as e2,LR as e3,tr as e4,l_ as e5,pq as e6,At as e7,lM as e8,fD as e9,C$ as eA,k$ as eB,D$ as eC,WD as eD,df as eE,Li as eF,GU as eG,IU as eH,BU as eI,hf as eJ,s$ as eK,r$ as eL,XU as eM,WU as eN,J$ as eO,LU as eP,dM as eQ,Y$ as eR,ol as eS,$b as eT,$m as eU,Fm as eV,VS as eW,Wb as eX,eH as eY,cd as ea,Gf as eb,pD as ec,Iw as ed,O2 as ee,Mz as ef,gU as eg,Pr as eh,yU as ei,AU as ej,A$ as ek,Ff as el,eq as em,kj as en,n$ as eo,i$ as ep,R$ as eq,JV as er,u$ as es,mU as et,c$ as eu,M$ as ev,P$ as ew,_$ as ex,S$ as ey,j$ as ez,_e as f,Br as g,Pe as h,Gn as i,gt as j,aC as k,XC as l,Um as m,fm as n,Bx as o,uC as p,Zi as q,OS as r,Fa as s,Bd as t,$e as u,lt as v,Nt as w,Ud as x,pb as y,Yt as z};
