const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebGPURenderer-C9Etn4Rf.js","assets/index-BO1A9LSm.js","assets/index-CXeBZTFP.css","assets/colorToUniform-CTaNm8ES.js","assets/SharedSystems-EjCd5V-H.js","assets/Graphics-BBKgR2Lp.js","assets/WebGLRenderer-CXvCghHH.js"])))=>i.map(i=>d[i]);
import{u as bn,y as Cn,z as Qe,e as et,E as ce,c as Tn,C as g,d as Ne,v as Ue,Y as k,D as We,a4 as at,K as ke,a as he,b as fe,U as kn,a5 as m,a6 as Rt,a7 as _n,a8 as $t,a9 as Bt,aa as Pn,ab as je,ac as lt,ad as Ve,ae as G,af as Sn,ag as _e,ah as D,ai as W,aj as pe,ak as Xt,al as He,am as On,an as Q,ao as v,ap as Ge,aq as L,ar as An,as as Lt,at as me,au as X,av as In,aw as ee,ax as O,ay as F,az as Mn,aA as Oe,aB as Fn,aC as ae,aD as ct,aE as Ae,aF as Dn,aG as En,aH as dt,aI as zn,aJ as te,aK as De,aL as qe,aM as Nt,aN as tt,aO as Ie,aP as Rn,aQ as nt,aR as de,aS as Ut,aT as ue,aU as ut,aV as $n,aW as Wt,aX as N,aY as jt,aZ as Y,a_ as Bn,a$ as Me,b0 as Xn,b1 as Ln,b2 as J,b3 as Vt,b4 as Nn,b5 as Ht,b6 as Un,b7 as Wn,b8 as Gt,b9 as jn,ba as Vn,bb as Hn,bc as Gn,bd as j,be,bf as ne,bg as qn,bh as x,bi as Ce,bj as Yn,bk as Jn,bl as Ee,bm as ht,bn as Zn,bo as Kn,bp as ft,bq as Qn,br as er,bs as tr,bt as nr}from"./index-BO1A9LSm.js";import{S as rr,G as K}from"./Graphics-BBKgR2Lp.js";const qt=class Ye extends bn{constructor(t){t={...Ye.defaultOptions,...t},super(t),this.enabled=!0,this._state=rr.for2d(),this.blendMode=t.blendMode,this.padding=t.padding,typeof t.antialias=="boolean"?this.antialias=t.antialias?"on":"off":this.antialias=t.antialias,this.resolution=t.resolution,this.blendRequired=t.blendRequired,this.addResource("uTexture",0,1)}apply(t,n,r,o){t.applyFilter(this,n,r,o)}get blendMode(){return this._state.blendMode}set blendMode(t){this._state.blendMode=t}static from(t){const{gpu:n,gl:r,...o}=t;let s,i;return n&&(s=Cn.from(n)),r&&(i=Qe.from(r)),new Ye({gpuProgram:s,glProgram:i,...o})}};qt.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1};let Yt=qt;const Je=[];et.handleByNamedList(ce.Environment,Je);async function or(e){if(!e)for(let t=0;t<Je.length;t++){const n=Je[t];if(n.value.test()){await n.value.load();return}}}let re;function sr(){if(typeof re=="boolean")return re;try{re=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{re=!1}return re}var Jt=(e=>(e[e.NONE=0]="NONE",e[e.COLOR=16384]="COLOR",e[e.STENCIL=1024]="STENCIL",e[e.DEPTH=256]="DEPTH",e[e.COLOR_DEPTH=16640]="COLOR_DEPTH",e[e.COLOR_STENCIL=17408]="COLOR_STENCIL",e[e.DEPTH_STENCIL=1280]="DEPTH_STENCIL",e[e.ALL=17664]="ALL",e))(Jt||{});class ir{constructor(t){this.items=[],this._name=t}emit(t,n,r,o,s,i,a,l){const{name:c,items:d}=this;for(let h=0,f=d.length;h<f;h++)d[h][c](t,n,r,o,s,i,a,l);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const n=this.items.indexOf(t);return n!==-1&&this.items.splice(n,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const ar=["init","destroy","contextChange","resolutionChange","reset","renderEnd","renderStart","render","update","postrender","prerender"],Zt=class Kt extends Tn{constructor(t){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const n=[...ar,...this.config.runners??[]];this._addRunners(...n),this._unsafeEvalCheck()}async init(t={}){const n=t.skipExtensionImports===!0?!0:t.manageImports===!1;await or(n),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const r in this._systemsHash)t={...this._systemsHash[r].constructor.defaultOptions,...t};t={...Kt.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let r=0;r<this.runners.init.items.length;r++)await this.runners.init.items[r].init(t);this._initOptions=t}render(t,n){let r=t;if(r instanceof g&&(r={container:r},n&&(Ne(Ue,"passing a second argument is deprecated, please use render options instead"),r.target=n.renderTexture)),r.target||(r.target=this.view.renderTarget),r.target===this.view.renderTarget&&(this._lastObjectRendered=r.container,r.clearColor=this.background.colorRgba),r.clearColor){const o=Array.isArray(r.clearColor)&&r.clearColor.length===4;r.clearColor=o?r.clearColor:k.shared.setValue(r.clearColor).toArray()}r.transform||(r.container.updateLocalTransform(),r.transform=r.container.localTransform),this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r)}resize(t,n,r){const o=this.view.resolution;this.view.resize(t,n,r),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),r!==void 0&&r!==o&&this.runners.resolutionChange.emit(r)}clear(t={}){const n=this;t.target||(t.target=n.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=Jt.ALL);const{clear:r,clearColor:o,target:s}=t;k.shared.setValue(o??this.background.colorRgba),n.renderTarget.clear(s,r,k.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(n=>{this.runners[n]=new ir(n)})}_addSystems(t){let n;for(n in t){const r=t[n];this._addSystem(r.value,r.name)}}_addSystem(t,n){const r=new t(this);if(this[n])throw new Error(`Whoops! The name "${n}" is already in use`);this[n]=r,this._systemsHash[n]=r;for(const o in this.runners)this.runners[o].add(r);return this}_addPipes(t,n){const r=n.reduce((o,s)=>(o[s.name]=s.value,o),{});t.forEach(o=>{const s=o.value,i=o.name,a=r[i];this.renderPipes[i]=new s(this,a?new a:null)})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach(n=>{n.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!sr())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}};Zt.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Qt=Zt,ge;function lr(e){return ge!==void 0||(ge=(()=>{const t={stencil:!0,failIfMajorPerformanceCaveat:e??Qt.defaultOptions.failIfMajorPerformanceCaveat};try{if(!We.get().getWebGLRenderingContext())return!1;let r=We.get().createCanvas().getContext("webgl",t);const o=!!r?.getContextAttributes()?.stencil;if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,o}catch{return!1}})()),ge}let ye;async function cr(e={}){return ye!==void 0||(ye=await(async()=>{const t=We.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(e)).requestDevice(),!0}catch{return!1}})()),ye}const pt=["webgl","webgpu","canvas"];async function dr(e){let t=[];e.preference?(t.push(e.preference),pt.forEach(s=>{s!==e.preference&&t.push(s)})):t=pt.slice();let n,r={};for(let s=0;s<t.length;s++){const i=t[s];if(i==="webgpu"&&await cr()){const{WebGPURenderer:a}=await at(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-C9Etn4Rf.js");return{WebGPURenderer:l}},__vite__mapDeps([0,1,2,3,4,5]));n=a,r={...e,...e.webgpu};break}else if(i==="webgl"&&lr(e.failIfMajorPerformanceCaveat??Qt.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await at(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-CXvCghHH.js");return{WebGLRenderer:l}},__vite__mapDeps([6,1,2,3,4,5]));n=a,r={...e,...e.webgl};break}else if(i==="canvas")throw r={...e},new Error("CanvasRenderer is not yet implemented")}if(delete r.webgpu,delete r.webgl,!n)throw new Error("No available renderer for the current environment");const o=new n;return await o.init(r),o}const en="8.4.1";class tn{static init(){globalThis.__PIXI_APP_INIT__?.(this,en)}static destroy(){}}tn.extension=ce.Application;class ur{constructor(t){this._renderer=t}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,en)}destroy(){this._renderer=null}}ur.extension={type:[ce.WebGLSystem,ce.WebGPUSystem],name:"initHook",priority:-10};const nn=class Ze{constructor(...t){this.stage=new g,t[0]!==void 0&&Ne(Ue,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.renderer=await dr(t),Ze._plugins.forEach(n=>{n.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return Ne(Ue,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,n=!1){const r=Ze._plugins.slice(0);r.reverse(),r.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(n),this.stage=null,this.renderer.destroy(t),this.renderer=null}};nn._plugins=[];let rn=nn;et.handleByList(ce.Application,rn._plugins);et.add(tn);class Pe extends ke{constructor(...t){let n=t[0];Array.isArray(t[0])&&(n={textures:t[0],autoUpdate:t[1]});const{textures:r,autoUpdate:o,...s}=n,[i]=r;super({...s,texture:i instanceof he?i:i.texture}),this._textures=null,this._durations=null,this._autoUpdate=o??!0,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=r}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(fe.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(fe.shared.add(this.update,this,kn.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const n=t.deltaTime,r=this.animationSpeed*n,o=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=r/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*n);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o||this.animationSpeed<0&&this.currentFrame>o)&&this.onLoop(),this._updateTexture())}_updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this.texture=this._textures[t],this.updateAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const n=[];for(let r=0;r<t.length;++r)n.push(he.from(t[r]));return new Pe(n)}static fromImages(t){const n=[];for(let r=0;r<t.length;++r)n.push(he.from(t[r]));return new Pe(n)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof he)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let n=0;n<t.length;n++)this._textures.push(t[n].texture),this._durations.push(t[n].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const n=this.currentFrame;this._currentTime=t,n!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(fe.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(fe.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const hr={x:.5,y:1},fr=e=>typeof e!="string"&&Object.hasOwn(e,"frames"),u=e=>{if(typeof e=="string")return u({texture:e});{const{anchor:t,flipX:n,pivot:r,x:o,y:s}=e;let i;return fr(e)?i=pr(e):i=new ke(m.textures[e.texture]),t===void 0&&r===void 0?i.anchor=hr:(t!==void 0&&(i.anchor=t),r!==void 0&&(i.pivot=r)),o!==void 0&&(i.x=o),s!==void 0&&(i.y=s),i.eventMode="static",n===!0&&(i.scale.x=-1),i}};function pr({frames:e,animationSpeed:t,reverse:n,playOnce:r}){const o=e.map(i=>({texture:i,time:Rt}));n&&o.reverse();const s=new Pe(o);return s.animationSpeed=t||_n,s.play(),r!==void 0&&(s.loop=!1,s.onComplete=()=>{s.stop(),r==="and-destroy"&&(s.visible=!1)}),s}const mr=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","Å","Ä","Ö","0","1","2","3","4","5","6","7","8","9","!","@","#","$","%","^","&","*","(",")","-","_","=","+","[","]","{","}",";",":","'",'"',",",".","/","<",">","?","\\","|"," ","Enter","Shift","Control","`","~","Tab","Backspace","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadAdd","NumpadSubtract","NumpadMultiply","NumpadDivide","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"],mt=e=>mr.includes(e),on=[...Bt,"jump","fire","carry","swop","hold"],gr=()=>({...$t(on.map(e=>[e,!1])),windowFocus:!0}),U={right:["P"],towards:["A"],left:["O"],away:["Q"],jump:[" ","M"],carry:["C","M"],fire:["N"],swop:["Enter","S"],hold:["H"]},yr={right:["ArrowRight",...U.right],towards:["ArrowDown",...U.towards],left:["ArrowLeft",...U.left],away:["ArrowUp",...U.away],jump:["`",...U.jump],carry:["Shift","`",...U.carry],fire:["Control",...U.fire],swop:U.swop,hold:["F8",...U.hold]};function*gt(e,t){for(const[n,r]of Pn(e))r.includes(t)&&(yield n)}const yt=e=>e.length===1?e.toUpperCase():e,vr=({keyAssignment:e,inputState:t,onInputStateChange:n})=>{const r=({key:a})=>{const l=yt(a);if(!mt(l)){console.log("do not recognise key: ",l);return}for(const c of gt(e,l))t[c]=!0;n?.(t)},o=({key:a})=>{const l=yt(a);if(mt(l)){for(const c of gt(e,l))t[c]=!1;n?.(t)}},s=()=>{t.windowFocus=!0,n?.(t)},i=()=>{t.windowFocus=!1;for(const a of on)t[a]=!1;n?.(t)};return window.addEventListener("keydown",r,!1),window.addEventListener("keyup",o,!1),window.addEventListener("focus",s,!1),window.addEventListener("blur",i,!1),()=>{window.removeEventListener("keydown",r,!1),window.removeEventListener("keyup",o,!1),window.removeEventListener("focus",s,!1),window.removeEventListener("blur",i,!1)}};function xr(e){return{all:e=e||new Map,on:function(t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&(n?r.splice(r.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var r=e.get(t);r&&r.slice().map(function(o){o(n)}),(r=e.get("*"))&&r.slice().map(function(o){o(t,n)})}}}const wr=e=>{const t={};for(const n of Object.values(e.rooms))for(const r of Object.values(n.items))if(r.type==="player"){const{which:o}=r.config;t[o]=n.id}if(t.head===void 0&&t.heels===void 0)throw new Error("couldn't find either head or heels in campaign");return t},br=(e,t)=>{const n=wr(e),r=$t(Object.keys(e.rooms).map(i=>[i,{}])),o=n.head&&je(e.rooms[n.head],r[n.head]),s=n.heels===n.head?o:n.heels&&je(e.rooms[n.heels],r[n.heels]);return{keyAssignment:yr,currentCharacterName:n.head===void 0?"heels":"head",characterRooms:{head:o===void 0?void 0:{room:o,entryState:lt(o.items.head)},heels:s===void 0?void 0:{room:s,entryState:lt(s.items.heels)}},inputState:gr(),renderOptions:t,campaign:e,events:xr(),pickupsCollected:r,gameTime:0,progression:0,gameSpeed:1}},Cr=e=>{let t=1;return{get curUpscale(){return t},rescale(){if(e.renderer.width===0||e.renderer.height===0)throw new Error;const n=Math.floor(Math.min(e.renderer.width/Ve.width,e.renderer.height/Ve.height)),r={x:Math.round(e.renderer.width/n),y:Math.round(e.renderer.height/n)};return t===n||(t=n,console.log("scale factor changed to:",n),e.stage.scale=n),r}}},E={original:new k("rgb(255, 255, 255)"),basic:new k("rgb(210, 210, 210)"),dimmed:new k("rgb(120, 120, 120)")},z={original:new k("rgb(255, 255, 0)"),basic:new k("hsl(50,58%,70%)"),dimmed:G().redShadow},R={original:new k("rgb(255, 0, 255)"),basic:G().pink,dimmed:new k("hsl(290,25%,40%)")},T={original:new k("rgb(0, 255, 255)"),basic:new k("hsl(183, 28%, 50%)"),dimmed:new k("hsl(183, 28%,39%)")},$={original:new k("rgb(0, 255, 0)"),basic:G().moss,dimmed:new k("hsl(73,35%,35%)")},rt={white:{basic:{main:E,edges:{towards:T,right:z},hud:{lives:z,dimmed:R,icons:T}},dimmed:{main:E,edges:{towards:$,right:T},hud:{lives:z,dimmed:R,icons:T}}},yellow:{basic:{main:z,edges:{towards:$,right:E},hud:{lives:T,dimmed:R,icons:$}},dimmed:{main:z,edges:{towards:T,right:T},hud:{lives:T,dimmed:R,icons:$}}},magenta:{basic:{main:R,edges:{towards:$,right:T},hud:{lives:E,dimmed:T,icons:z}},dimmed:{main:R,edges:{towards:$,right:T},hud:{lives:E,dimmed:T,icons:z}}},cyan:{basic:{main:T,edges:{towards:R,right:E},hud:{lives:E,dimmed:$,icons:z}},dimmed:{main:T,edges:{towards:R,right:E},hud:{lives:E,dimmed:$,icons:z}}},green:{basic:{main:$,edges:{towards:T,right:z},hud:{lives:E,dimmed:R,icons:T}},dimmed:{main:$,edges:{towards:T,right:z},hud:{lives:E,dimmed:R,icons:T}}}},sn=e=>rt[e.hue][e.shade],an=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Tr=`in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uOriginalColor;
uniform vec3 uTargetColor;
uniform float uTolerance;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);
    vec3 colorDiff = uOriginalColor - (c.rgb / max(c.a, 0.0000000001));
    float colorDistance = length(colorDiff);
    float doReplace = step(colorDistance, uTolerance);
    finalColor = vec4(mix(c.rgb, uTargetColor * c.a, doReplace), c.a);
}
`;class Se extends Yt{static DEFAULT_OPTIONS={originalColor:16711680,targetColor:0,tolerance:.4};uniforms;_originalColor;_targetColor;constructor(t){t={...Se.DEFAULT_OPTIONS,...t};const n=Qe.from({vertex:an,fragment:Tr,name:"palette-swap-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uOriginalColor:{value:new Float32Array(3),type:"vec3<f32>"},uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"},uTolerance:{value:t.tolerance,type:"f32"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this._originalColor=new k,this._targetColor=new k,this.originalColor=t.originalColor??16711680,this.targetColor=t.targetColor??0,Object.assign(this,t)}get originalColor(){return this._originalColor.value}set originalColor(t){this._originalColor.setValue(t);const[n,r,o]=this._originalColor.toArray();this.uniforms.uOriginalColor[0]=n,this.uniforms.uOriginalColor[1]=r,this.uniforms.uOriginalColor[2]=o}get targetColor(){return this._targetColor.value}set targetColor(t){this._targetColor.setValue(t);const[n,r,o]=this._targetColor.toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}get tolerance(){return this.uniforms.uTolerance}set tolerance(t){this.uniforms.uTolerance=t}}const ln=e=>[new Se({originalColor:G().replaceLight,targetColor:e.basic,tolerance:.1}),new Se({originalColor:G().replaceDark,targetColor:e.dimmed,tolerance:.1})],Ke=(e,t)=>ln(rt[e.color.hue][e.color.shade].edges[t]),kr=e=>ln(rt[e.color.hue][e.color.shade].main),ie=Sn,_r=`precision mediump float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uSourceBlacks[2];
uniform vec3 uTargetColor;

// colours are floats so check if they're very close rather than exactly equal:
bool colorsEffectivelyEqual(vec3 color1, vec3 color2) {    
    
    return distance(color1, color2) < 0.05;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    if( c.a == 0.0 ) {
        finalColor = c;
        return;
    }

    if ( colorsEffectivelyEqual(c.rgb, uSourceBlacks[0]) || colorsEffectivelyEqual(c.rgb, uSourceBlacks[1])) {
        finalColor = vec4(0,0,0, 1.0);
    } else {
        finalColor = vec4(uTargetColor, 1);    
    }
}
`,vt=[G().pureBlack,G().lightBlack];class le extends Yt{uniforms;constructor(t="white"){const n=Qe.from({vertex:an,fragment:_r,name:"revert-colourise-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uSourceBlacks:{value:new Float32Array(6),type:"vec3<f32>",size:6},uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms;const[r,o,s]=vt[0].toArray();this.uniforms.uSourceBlacks[0]=r,this.uniforms.uSourceBlacks[1]=o,this.uniforms.uSourceBlacks[2]=s;const[i,a,l]=vt[1].toArray();this.uniforms.uSourceBlacks[3]=i,this.uniforms.uSourceBlacks[4]=a,this.uniforms.uSourceBlacks[5]=l,this.targetColor=t}set targetColor(t){const[n,r,o]=new k(t).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}}function ot(e,t){const n=t||new g;for(const r of e)n.addChild(r);return n}const Pr=24,Sr=56,Or=80,xt=112,oe=e=>e==="heels"?1:-1;function*Ar(e){const t=e.toString().split(""),n=t.length;for(let r=0;r<n;r++){const o=`hud.char.${t[r]}`;On(o),yield u({texture:o,x:(r+.5-n/2)*Xt.w})}}function ve(e,t){for(const n of e.children)n.destroy();ot(Ar(t),e)}const Ir=e=>{const t=new le,n=new le,r=new le,o=(l=!1)=>{const c=l?2:1,d=new g;return d.scale={x:1,y:c},d},s=l=>{const c=new ke(m.textures[`${l}.walking.${l==="head"?"right":"towards"}.2`]);return c.anchor={x:.5,y:0},c},i=(l,c=!1,d=!1)=>{const h=new g;h.pivot={x:4,y:16};const f=new ke({texture:m.textures[l],anchor:c?{x:.5,y:0}:{x:.5,y:1},filters:t,y:c?0:8});h.addChild(f);const p=o();return p.y=c?0:16,p.filters=n,p.x=f.x=Xt.w/2,h.addChild(p),d&&(p.visible=!1),{text:p,icon:f,container:h}},a={head:{sprite:s("head"),livesText:o(!0),shield:i("hud.shield"),extraSkill:i("hud.fastSteps"),donuts:i("donuts",!0),hooter:i("hooter",!0,!0)},heels:{sprite:s("heels"),livesText:o(!0),shield:i("hud.shield"),extraSkill:i("hud.bigJumps"),bag:i("bag",!0,!0),carrying:{container:new g}}};for(const l of _e)e.addChild(a[l].livesText),e.addChild(a[l].sprite),e.addChild(a[l].shield.container),e.addChild(a[l].extraSkill.container);return e.addChild(a.head.donuts.container),e.addChild(a.head.hooter.container),e.addChild(a.heels.bag.container),e.addChild(a.heels.carrying.container),(l,c)=>{const d=D(l),{hud:{dimmed:h,lives:f,icons:p}}=sn(d.color),_=y=>{const A=pe(l,y),I=A?.state.shieldCollectedAt??null,{text:H,container:st}=a[y].shield,{text:xn,container:it}=a[y].extraSkill;it.x=st.x=(c.x>>1)+oe(y)*Or;const wn=I===null||l.gameTime>I+He?0:100-Math.ceil((l.gameTime-I)/(He/100));ve(H,wn),st.y=c.y,ve(xn,A===void 0?0:A.type==="head"?A.state.fastSteps:A.state.bigJumps),it.y=c.y-24},b=y=>{const A=l.currentCharacterName===y,I=a[y].sprite;I.filters=A?ie:r,I.x=(c.x>>1)+oe(y)*Sr,I.y=c.y-W.h},P=y=>{const I=pe(l,y)?.state.lives??0,H=a[y].livesText;H.x=(c.x>>1)+oe(y)*Pr,H.y=c.y,H.tint=f.basic,ve(H,I??0)},V=y=>{const{container:A}=a.heels.carrying,I=A.children.length>0;if(y===null&&I)for(const H of A.children)H.destroy();y!==null&&!I&&A.addChild(u(y.type==="spring"?"spring.released":y.config.style))};r.targetColor=h.dimmed,n.targetColor=h.basic,t.targetColor=p.basic;for(const y of _e)P(y),b(y),_(y);a.head.hooter.container.x=a.head.donuts.container.x=(c.x>>1)+oe("head")*xt,a.head.donuts.container.y=c.y-W.h-8,a.heels.carrying.container.y=c.y-W.h,a.heels.carrying.container.x=a.heels.bag.container.x=(c.x>>1)+oe("heels")*xt,a.heels.bag.container.y=a.head.hooter.container.y=c.y-8;const w=pe(l,"head"),S=w?.state.hasHooter??!1;a.head.hooter.icon.filters=S?ie:r;const q=w?.state.donuts??0;a.head.donuts.icon.filters=q!==0?ie:r,ve(a.head.donuts.text,q);const C=pe(l,"heels"),Z=C?.state.hasBag??!1;V(C?.state.carrying??null),a.heels.bag.icon.filters=Z?ie:r}},wt={movementType:"vel",vels:{gravity:L}},Mr=(e,t,n)=>{if(!Q(e,t.progression))return wt;const{type:r,state:{vels:{gravity:{z:o}},standingOn:s}}=e,i=An[r==="head"?"head":"others"];return s!==null?v("lift")(s)&&s.state.vels.lift.z<0?{movementType:"vel",vels:{gravity:{z:Math.max(o-Ge*n,-i)}}}:wt:{movementType:"vel",vels:{gravity:{z:Math.max(o-Ge*n,-i)}}}},xe=e=>{const n=e/In*Rt;return(e+.5*Ge*n**2)/n},Fr={head:xe(me.head),headOnSpring:xe(me.head+X.h),heels:xe(me.heels),heelsOnSpring:xe(me.heels+X.h)},Dr=(e,t)=>Fr[`${e}${t?"OnSpring":""}`],Er=({type:e,state:{standingOn:t}},n,r)=>{const{inputState:{jump:o}}=n,s=t!==null&&v("teleporter")(t);if(!(o&&t!==null&&!s))return t!==null?{movementType:"steady",stateDelta:{jumped:!1}}:Lt;const a=v("spring")(t);return{movementType:"vel",vels:{gravity:{z:Dr(e,a)}},stateDelta:{action:"moving",jumped:!0}}},zr=({vel:e,acc:t,unitD:n,maxSpeed:r,deltaMS:o,crossComponentFade:s=0,minVelocity:i=0})=>{const a=ee(e,n),l=Math.max(a+t*o,i),c=l>=r,d=Mn(n),h=ee(e,d),f=h>=0?Math.max(h-s*o,0):Math.min(h+s*o,0);return O(F(n,c?r:l),F(d,f))},bt={movementType:"vel",vels:{walking:L}},Rr=(e,{inputState:t},n)=>{const{type:r,state:{autoWalk:o,standingOn:s,facing:i,teleporting:a,vels:{walking:l,gravity:c}}}=e,d=o?i:Bt.find(P=>t[P]===!0),h=Ae[r];if(a!==null)return bt;if(r==="heels"){if(s===null)return e.state.jumped?{movementType:"vel",vels:{walking:Oe(l,F(l,Fn*n))}}:bt;if(t.jump){const P=d??i,w=v("spring")(s)?1:Dn;return{movementType:"vel",vels:{walking:F(ae[P],h*w)},stateDelta:{facing:P}}}}const f=s===null&&c.z<0;if(d!==void 0)return f?{movementType:"vel",vels:{walking:F(ae[d],h)},stateDelta:{facing:d,action:"falling"}}:{movementType:"vel",vels:{walking:zr({vel:l,acc:En[r],deltaMS:n,maxSpeed:h,unitD:ae[d],crossComponentFade:dt[r],minVelocity:ct[r]})},stateDelta:{facing:d,action:"moving"}};const p=zn(l),_=p===0?L:F(l,1/p),b=Math.max(p-dt[r]*n,0);return{movementType:"vel",vels:{walking:F(_,b<ct[r]?0:b)},stateDelta:{action:f?"falling":"idle"}}},Ct=X.h,we=.001,$r=({totalDistance:e,currentAltitude:t,direction:n})=>{const r=De**2/(2*te);if(n==="up"){if(t<=r)return Math.max(we,Math.sqrt(2*te*Math.max(t,0)));if(t>=e-r){const o=Math.max(0,e-t);return Math.max(we,Math.sqrt(2*te*o))}else return De}else if(t>=e-r){const o=Math.max(0,e-t);return Math.min(-we,-Math.sqrt(2*te*o))}else return t<=r?Math.min(-we,-Math.sqrt(2*te*Math.max(t,0))):-De};function Br({config:{bottom:e,top:t},state:{direction:n,position:{z:r}}},o,s){const i=e*Ct,a=t*Ct,l=$r({currentAltitude:r-i,direction:n,totalDistance:a-i});if(Number.isNaN(l))throw new Error("velocity is NaN");const c=r<=i?"up":r>=a?"down":n;return{movementType:"vel",vels:{lift:{z:l}},stateDelta:{direction:c}}}const Tt=(e,t)=>({x:e.x>0?t.state.position.x:t.state.position.x+t.aabb.x,y:e.y>0?t.state.position.y:t.state.position.y+t.aabb.y,z:e.z>0?t.state.position.z:t.state.position.z+t.aabb.z}),kt={stopAutowalk:0,portal:0,wall:0,doorLegs:0,sceneryPlayer:0,block:1,barrier:1,floor:1,book:1,hushPuppy:1,teleporter:1,doorFrame:1,lift:2,movableBlock:2,portableBlock:2,slidingBlock:2,spring:2,ball:3,joystick:3,switch:3,charles:3,conveyor:3,head:3,heels:3,pickup:8,scroll:8,slidingDeadly:10,moveableDeadly:10,deadlyBlock:10,baddie:10},cn=(e,t)=>kt[e.type]-kt[t.type],Xr=(e,t)=>t.toSorted((n,r)=>{const o=cn(n,r);if(o!==0)return o;const s=ee(e,Tt(e,n)),i=ee(e,Tt(e,r));return s-i});function Lr({gameState:e,movingItem:t}){if(t.state.action==="death")return!1;const{shieldCollectedAt:n}=t.state;return n!==null&&n+He>e.gameTime?!1:(t.state.action="death",t.state.expires=e.gameTime+qe,!0)}const ze=v("head"),_t=v("heels"),Nr=({gameState:e,movingItem:t,touchedItem:n})=>{const r=D(e).id;if(e.pickupsCollected[r][n.id]===!0)return;const o=e.pickupsCollected[r];switch(o[n.id]=!0,Nt(n,e),n.config.gives){case"hooter":{if(ze(t)){t.state.hasHooter=!0;break}break}case"donuts":{if(ze(t)){t.state.donuts+=6;break}break}case"bag":{if(_t(t)){t.state.hasBag=!0;break}break}case"shield":{t.state.shieldCollectedAt=e.gameTime;break}case"fast":{ze(t)&&(t.state.fastSteps=99);break}case"jumps":{_t(t)&&(t.state.bigJumps=10);break}case"extra-life":t.state.lives+=2;break}},Ur=({gameState:e,movingItem:t,touchedItem:n,movementVector:r})=>{const{config:{relativePoint:o,toRoom:s,direction:i},state:{position:a}}=n,l=ae[i];return ee(l,r)<=0?!1:(tt({gameState:e,toRoomId:s,positionRelativeToSourcePortal:Oe(t.state.position,O(a,o)),sourcePortal:n,changeType:"portal"}),!0)},Wr=({movingItem:e,movementVector:t,touchedItem:n})=>{const{config:{direction:r,nearness:o}}=n,s=Ie(r),i=o==="far"?{x:s==="x"?-Math.abs(t.y):0,y:s==="y"?-Math.abs(t.x):0,z:0}:{x:s==="x"?Math.abs(t.y):0,y:s==="y"?Math.abs(t.x):0,z:0};return e.state.position=O(e.state.position,i),!1};function jr({movingItem:e}){return e.state.autoWalk=!1,!1}const Vr=({touchedItem:e,gameState:{progression:t,events:n}})=>{const{config:r,state:{touchedOnProgression:o}}=e;if(e.state.touchedOnProgression=t,console.log("ℹ️ update touchedOnProgression to",t),t<o+10){console.log("❌ not considering scroll touchd because progression is",t,"and touchedOnProgression is",o);return}console.log("✅ considering scroll touchd because progression is",t,"and touchedOnProgression is",o),n.emit("scrollOpened",r)},M=(e,...t)=>v(...t)(e.touchedItem),Re=(e,...t)=>v(...t)(e.movingItem),Pt=e=>{switch(!0){case M(e,"stopAutowalk"):jr(e);break;case(M(e,...Rn)||M(e,"floor")&&e.touchedItem.config.deadly):if(Lr(e))return!0;break;case M(e,"portal"):if(Ur(e))return!0;break;case M(e,"pickup"):Nr(e);break;case M(e,"doorFrame"):Wr(e);break;case M(e,"block","barrier"):{(v("barrier")(e.touchedItem)&&e.touchedItem.config.disappearing||v("block")(e.touchedItem)&&e.touchedItem.state.disappearing)&&Nt(e.touchedItem,e.gameState);break}case M(e,"scroll"):Vr(e)}return!1},Hr=({touchedItem:e,gameState:{progression:t},room:n})=>{const{config:{activates:r},state:{setting:o,touchedOnProgression:s}}=e;if(e.state.touchedOnProgression=t,t===s+1||t===s)return;const i=e.state.setting=o==="left"?"right":"left";for(const[a,l]of nt(r)){const c=n.items[a];c.state={...c.state,...l[i]}}return!1},Gr=({movingItem:e,touchedItem:t,gameState:n})=>{if(!Q(e,n.progression))return;const{state:{position:r},aabb:o}=t,s=de(e.state.position,e.aabb,r,o);if(s.x===0&&s.y===0)return;const i=Ut(s),a=F(i,-Ae.ball);return t.state.vels.sliding=a,!1},qr=({movingItem:e,touchedItem:t,gameState:n})=>{if(!Q(t,n.progression))return;const r=e.state.vels.sliding;if(ue(r,L))return;const{state:{position:o},aabb:s}=e,i=de(t.state.position,t.aabb,o,s);return ee(i,e.state.vels.sliding)>0&&(e.state.vels.sliding=L),!1},Yr=({gameState:e,movingItem:t,touchedItem:n,deltaMS:r})=>{const o=D(e),{config:{controls:s},state:{position:i},aabb:a}=n,l=de(t.state.position,t.aabb,i,a);if(l.x===0&&l.y===0)return;const c=Ut(l);for(const d of s){const h=o.items[d],f=F(c,-Ae.charles*r);h.state.facing=f,Fe({subjectItem:h,posDelta:f,gameState:e,pusher:n,deltaMS:r})}return!1},dn=e=>!!(Re(e,..._e)&&Pt(e)||M(e,..._e)&&Pt({...e,movingItem:e.touchedItem,touchedItem:e.movingItem})||M(e,...ut)&&Gr(e)||Re(e,...ut)&&qr(e)||Re(e,"baddie")&&$n(e)||M(e,"switch")&&Hr(e)||M(e,"joystick")&&Yr(e)),un=e=>{e.state.standingOn!==null&&e.state.standingOn.state.stoodOnBy.delete(e),e.state.standingOn=null},hn=(e,t)=>{e.state.standingOn=t,t.state.stoodOnBy.add(e)},Fe=({subjectItem:e,posDelta:t,gameState:n,pusher:r,deltaMS:o,forceful:s=v("lift")(e)&&r===void 0,recursionDepth:i=0})=>{if(ue(t,L))return!1;if(i>16)throw new Error("this probably means a non-terminating issue");const a=D(n),{state:{position:l}}=e;e.state.position=O(l,t);const c=Xr(t,Wt(e,N(a.items)));for(const d of c){if(!jt(e,d))continue;if(r!==d&&dn({movingItem:e,touchedItem:d,movementVector:Oe(e.state.position,l),gameState:n,deltaMS:o,room:a}))return!0;if(!Q(d,n.progression)||!Q(e,n.progression))continue;const h=de(e.state.position,e.aabb,d.state.position,d.aabb);if(Y(d)&&d!==r){const f=s||Bn(d)?-1:-.5,p=F(h,f);if(e.state.position=O(e.state.position,h,p),Fe({subjectItem:d,posDelta:p,pusher:e,gameState:n,deltaMS:o,forceful:s,recursionDepth:i+1}))return!0;e.state.position=O(e.state.position,de(e.state.position,e.aabb,d.state.position,d.aabb))}else e.state.position=O(e.state.position,h);Y(e)&&h.z>0&&(e.state.standingOn===null||!c.includes(e.state.standingOn))&&(un(e),hn(e,d))}return!1};function Jr(e,t,n){const{state:{teleporting:r,standingOn:o}}=e,{inputState:{jump:s}}=t;if(r===null)return s&&o!==null&&v("teleporter")(o)?{movementType:"steady",stateDelta:{teleporting:{phase:"out",toRoom:o.config.toRoom,timeRemaining:qe}}}:Lt;const i=Math.max(r.timeRemaining-n,0);switch(r.phase){case"out":if(i===0)return tt({gameState:t,toRoomId:r.toRoom,changeType:"teleport"}),{movementType:"endTick",stateDelta:{teleporting:{phase:"in",timeRemaining:qe}}};break;case"in":if(i===0)return{movementType:"steady",stateDelta:{teleporting:null}};break}return{movementType:"steady",stateDelta:{teleporting:{...r,timeRemaining:i}}}}const St={movementType:"vel",vels:{movingFloor:L},stateDelta:{activeConveyor:null}},Zr=(e,t,n)=>{if(Me(e)&&e.state.teleporting!==null)return St;const{state:{standingOn:r}}=e;if(r===null||!v("conveyor")(r))return St;const{config:{direction:o}}=r,i=v("heels")(e)&&e.state.action==="moving"&&e.state.facing===Xn(o)?Ae.heels:Ln;return{movementType:"vel",vels:{movingFloor:F(ae[o],i)},stateDelta:{activeConveyor:r}}},Kr=(e,t,n,r)=>{const o=Math.max(0,Math.min(e.x+t.x,n.x+r.x)-Math.max(e.x,n.x)),s=Math.max(0,Math.min(e.y+t.y,n.y+r.y)-Math.max(e.y,n.y));return o*s},Ot=({state:{position:e},aabb:t},{state:{position:n},aabb:r})=>Kr(e,t,n,r),Qr=.001,fn=(e,t,n)=>{if(!Q(t,n)||e.id===t.id)return!1;const{state:{position:r,vels:{gravity:{z:o}}},aabb:s,id:i}=e;if(o>0)return!1;const a=O(r,{z:-Qr});return jt({state:{position:a},aabb:s,id:i},t)},pn=(e,t,n)=>{const o=[...J(t).filter(i=>fn(e,i,n))];return o.length===0?void 0:o.reduce((i,a)=>{const l=cn(a,i);return l>0||l===0&&Ot(e,a)>Ot(e,i)?a:i})},eo=(e,t,n,r)=>{const{inputState:o}=n,{state:{carrying:s,position:i,hasBag:a}}=e;if(!a)return;const l=J(N(t.items)).filter(Vt),c=s===null?no(e,t,n):void 0;for(const d of l)d.state.wouldPickUpNext=!1;if(c!==void 0&&(c.state.wouldPickUpNext=!0),o.carry){if(s===null){if(c===void 0){console.warn("nothing to pick up");return}to(t,e,c)}else{if(e.state.standingOn===null||!mn(e,N(t.items)))return;const d=Nn(n,t,s.type,s.config);d.state.position=i,Fe({subjectItem:e,gameState:n,posDelta:{x:0,y:0,z:d.aabb.z},pusher:e,forceful:!0,deltaMS:r}),e.state.carrying=null}o.carry=!1}},to=(e,t,n)=>{const r={type:n.type,config:n.config};t.state.carrying=r,Ht(e,n)},no=(e,t,n)=>pn(e,J(N(t.items)).filter(Vt),n.progression),mn=(e,t)=>{const n={position:O(e.state.position,{z:X.h})},r=Wt({id:e.id,aabb:e.aabb,state:n},t);for(const o of r)if(!Y(o)||!mn(o,t))return!1;return!0};function*ro(e,t,n){for(;(e.state.latentMovement.at(0)?.moveAtGameTime??Number.POSITIVE_INFINITY)<t.gameTime;){const{positionDelta:r}=e.state.latentMovement.shift();yield{movementType:"position",posDelta:r}}}function*oo(e,t,n,r){Y(e)&&(yield Mr(e,n,r),yield Zr(e),yield*ro(e,n)),Me(e)&&e.type===n.currentCharacterName&&(yield Jr(e,n,r),yield Rr(e,n,r),yield Er(e,n),v("heels")(e)&&eo(e,t,n,r)),v("lift")(e)&&(yield Br(e)),v("baddie")(e)&&(yield Un(e,t,n,r))}const so=(e,t,n,r)=>{let o=L;const s=[...oo(e,t,n,r)];for(const i of s){if(i.movementType==="position"&&(o=O(o,i.posDelta)),i.movementType==="vel"&&(Y(e)||v("lift")(e)))for(const[l,c]of nt(i.vels)){const d={...L,...c};e.state.vels[l]=d}const a=i.stateDelta;if(a!==void 0&&(e.state={...e.state,...a}),i.movementType==="endTick")return!0}return(Y(e)||v("lift")(e))&&(o=O(o,...J(N(e.state.vels)).map(i=>F(i,r)))),Fe({subjectItem:e,posDelta:o,gameState:n,deltaMS:r})},io=e=>{Wn(e)!==void 0&&(e.currentCharacterName=Gt(e.currentCharacterName))},ao=e=>{const{currentCharacterName:t}=e,{room:n,entryState:r}=e.characterRooms[t],o=n.items[t],s=Gt(t),i=o.state,a=o.state.lives-1;if(a===0){o.state.lives=a,e.characterRooms[t]=void 0,e.currentCharacterName=s;return}o.state={...i,...r,expires:null,lives:a,standingOn:null};const l=je(e.campaign.rooms[n.id],e.pickupsCollected[n.id],{[t]:o});e.characterRooms[t].room=l},lo=10,co=(e,t)=>e.state.expires!==null&&e.state.expires<t.gameTime,uo=(e,t)=>{for(const n of N(e.items)){const r=t[n.id];if(r===void 0)continue;ue(r,n.state.position)&&!Hn(n.state.position)&&(console.log(`snapping item ${n.id} to pixel grid`),n.state.position=Gn(n.state.position))}},ho=(e,t)=>{const n={lift:-4,head:-3,heels:-3,baddie:-2,block:1,deadlyBlock:1},r=n[e.type]??0,o=n[t.type]??0;return r-o},fo=(e,t)=>{const n=t*e.gameSpeed,r=Math.ceil(n/lo),o=n/r,{inputState:s}=e;if(s.swop){io(e),s.swop=!1;return}const i=D(e);for(let a=0;a<r;a++){const l=Object.fromEntries(J(nt(i.items)).map(([d,h])=>[d,h.state.position]));for(const d of N(i.items))if(co(d,e))if(Me(d)){ao(e);return}else Ht(i,d);const c=Object.values(i.items).sort(ho);for(const d of c){if(jn(e).state.action==="death")break;if(i.items[d.id]!==void 0&&so(d,i,e,o))return}for(const d of c)for(const h of d.state.stoodOnBy)if(fn(h,d,e.progression)){const p={...Oe(d.state.position,l[d.id]),z:0};ue(p,L)||h.state.latentMovement.push({moveAtGameTime:e.gameTime+2*Vn,positionDelta:p})}else{un(h);const f=pn(h,N(i.items),e.progression);f!==void 0&&hn(h,f)}for(const d of c)!Y(d)||d.state.standingOn===null||dn({movingItem:d,touchedItem:d.state.standingOn,gameState:e,deltaMS:o,movementVector:{x:0,y:0,z:-1},room:i});if(e.progression++,e.gameTime+=o,i!==D(e))throw new Error(`room has changed during physics tick ${i.id} -> ${D(e).id} but did not return out of the tick`);uo(i,l)}},gn=e=>{const t={},n=Object.values(e.items).filter(v("doorFrame"));for(const{config:{direction:r},state:{position:{x:o,y:s}}}of n)Ie(r)==="x"?s<0?t.towards=!0:s===e.size.y*X.d&&(t.away=!0):o<0?t.right=!0:o===e.size.x*X.w&&(t.left=!0);return t},yn=e=>{const t=gn(e),n=t.right?-.5:0,r=e.size.x+(t.left?.5:0),o=t.towards?-.5:0,s=e.size.y+(t.away?.5:0),i=j({x:n,y:s}),a=j({x:r,y:o}),l=j({x:n,y:o}),c=j({x:r,y:s}),d=c.y+be.h;return{blockXMin:n,blockXMax:r,blockYMin:o,blockYMax:s,rightSide:i,leftSide:a,frontSide:l,backSide:c,top:d}},po=e=>{const{towards:t,right:n}=gn(e),{blockXMin:r,blockYMin:o,rightSide:s,leftSide:i,frontSide:a,backSide:l}=yn(e),{floor:c,color:{shade:d}}=e,h=new g({label:`floor(${e.id})`}),f=Object.fromEntries(e.floorSkip.map(({x:w,y:S})=>[`${w},${S}`,!0]));if(c!=="none"){const w=c==="deadly"?`generic${d==="dimmed"?".dark":""}.floor.deadly`:`${c}${d==="dimmed"?".dark":""}.floor`,S=new g;for(let C=-1;C<=e.size.x;C++)for(let Z=C%2-1;Z<=e.size.y;Z+=2)f[`${C},${Z}`]||S.addChild(ne({x:C,y:Z},u({anchor:{x:.5,y:1},texture:w})));for(let C=0;C<=e.size.x;C++)e.walls.away[C]!=="none"&&S.addChild(ne({x:C,y:e.size.y},u({anchor:{x:0,y:1},texture:"generic.floor.overdraw",flipX:!0})));for(let C=0;C<=e.size.y;C++)e.walls.left[C]!=="none"&&S.addChild(ne({x:e.size.x,y:C},u({anchor:{x:0,y:1},texture:"generic.floor.overdraw"})));const q=new K().poly([a,s,l,i],!0).fill(16711680).stroke({width:8});S.addChild(q),S.mask=q,h.addChild(S)}const p=new g;for(let w=r;w<=e.size.x;w+=.5)p.addChild(ne({x:w,y:t?-.5:0},u({pivot:{x:7,y:0},texture:"generic.edge.towards"})));p.filters=Ke(e,"towards");const _=new g;for(let w=o;w<=e.size.y;w+=.5)_.addChild(ne({x:n?-.5:0,y:w},u({pivot:{x:0,y:0},texture:"generic.edge.right"})));_.filters=Ke(e,"right");const b=j({x:0,y:e.size.y}),P=j({x:e.size.x,y:0}),V=new K().poly([{x:a.x,y:a.y+16},{x:b.x,y:b.y+16},{x:b.x,y:-999},{x:P.x,y:-999},{x:P.x,y:P.y+16}],!0).fill(16776960);return h.addChild(V),h.addChild(p),h.addChild(_),h.mask=V,h},At=(e,t)=>{const n=x(e),r=x(O(e,{x:t.x,z:t.z})),o=x(O(e,{y:t.y,z:t.z}));return{bottomCentre:n,topLeft:r,topRight:o}},$e=(e,t,n,r,o=1e-5)=>r-o>e&&n<t-o,mo=(e,t,n,r)=>{const o=At(e,t),s=At(n,r),i=o.topLeft.x,a=o.topRight.x,l=s.topLeft.x,c=s.topRight.x,d=$e(i,a,l,c),h=o.topRight.y-o.topRight.x/2,f=o.bottomCentre.y-o.bottomCentre.x/2;if(h>f)throw new Error(`aXAxisSlopeMinC ${h} > aXAxisSlopeMaxC ${f}`);const p=s.topRight.y-s.topRight.x/2,_=s.bottomCentre.y-s.bottomCentre.x/2;if(p>_)throw new Error("bXAxisSlopeMinC > bXAxisSlopeMaxC");const b=$e(h,f,p,_),P=o.topLeft.y+o.topLeft.x/2,V=o.bottomCentre.y+o.bottomCentre.x/2;if(P>V)throw new Error("aYAxisSlopeMinC > aYAxisSlopeMaxC");const w=s.topLeft.y+s.topLeft.x/2,S=s.bottomCentre.y+s.bottomCentre.x/2;if(w>S)throw new Error("bYAxisSlopeMinC > bYAxisSlopeMaxC");const q=$e(P,V,w,S);return d&&b&&q},go=(e,t)=>{if(e.renders===!1||t.renders===!1)return 0;const n=e.state.position,r=e.renderAabb||e.aabb,o=t.state.position,s=t.renderAabb||t.aabb;if(!mo(n,r,o,s))return 0;for(const i of qn){const a=e.state.position[i],l=a+r[i],c=t.state.position[i],d=c+s[i];if(l<=c)return 1*(i==="z"?-1:1);if(a>=d)return-1*(i==="z"?-1:1)}return It(t)-It(e)},It=e=>e.state.position.x+e.state.position.y-e.state.position.z;class Te extends Error{constructor(t,n,r,o){super(t,o),this.cyclicDependency=n,this.hasClosedCycle=r}}const yo=e=>vo(xo(e),e),vo=(e,t)=>{let n=e.length,r=n;const o=new Array(n),s={},i=wo(t),a=bo(e);for(t.forEach(function(c){if(!a.has(c[0])||!a.has(c[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});r--;)s[r]||l(e[r],r,new Set);return o;function l(c,d,h){if(h.has(c))throw new Te("Cyclic dependency found - see .cyclicDependency of this error for details",[c],!1);if(!a.has(c))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(c));if(s[d])return;s[d]=!0;const f=i.get(c)||new Set,p=Array.from(f);if(d=p.length){h.add(c);do{const _=p[--d];try{l(_,a.get(_),h)}catch(b){throw b instanceof Te?b.hasClosedCycle?b:new Te(b.message,[...b.cyclicDependency,c],b.cyclicDependency.includes(c)):b}}while(d);h.delete(c)}o[--n]=c}};function xo(e){const t=new Set;for(let n=0,r=e.length;n<r;n++){const o=e[n];t.add(o[0]),t.add(o[1])}return Array.from(t)}function wo(e){const t=new Map;for(let n=0,r=e.length;n<r;n++){const o=e[n];t.has(o[0])||t.set(o[0],new Set),t.has(o[1])||t.set(o[1],new Set),t.get(o[0]).add(o[1])}return t}function bo(e){const t=new Map;for(let n=0,r=e.length;n<r;n++)t.set(e[n],n);return t}const Co=e=>{const t=[];for(const n of e)if(n.renders)for(const r of e){if(n===r)break;if(!r.renders)continue;const o=go(n,r);o!==0&&(o>0?t.push([r.id,n.id]):t.push([n.id,r.id]))}return t},vn=(e,t,n=3)=>{try{return{order:yo(e),impossible:!1}}catch(r){if(r instanceof Te){const o=r.cyclicDependency,s=e.find(([i,a])=>o.includes(i)&&o.includes(a));if(s===void 0)throw new Error("could not find bad link");return{order:vn(e.filter(i=>i!==s),t,n-1).order,impossible:!0}}else throw r}},To=(e,t,n,r)=>`${e}${r?".dark":""}.wall.${t}.${n}`,ko=(e,t,n)=>{const o=m.textures[`${e.planet}.door.front.${t}`]!==void 0?e.planet:"generic",s=e.color.shade==="dimmed"&&m.textures[`${o}.dark.door.front.${t}`]!==void 0;return`${o}${s?".dark":""}.door.${n=="near"?"front":"back"}.${t}`},Mt=e=>()=>({container:u(e),renderProps:{}}),B=e=>({item:t,room:n,currentlyRenderedProps:r})=>{if(r===void 0)return e({item:t,room:n})};function*_o({config:{direction:e,inHiddenWall:t,height:n}},r){const o=Ie(e),s=o==="y"?0:16;function*i(a){if(t){if(n!==0){const c=u({pivot:{x:o==="x"?18:8,y:12},texture:`generic.door.floatingThreshold.${o}`,...Ee(a,{y:-X.h*n})});c.filters=Ke(r,o==="x"?"towards":"right"),yield c}}else{yield u({pivot:{x:s,y:12},texture:"generic.door.legs.base",...Ee(a,{y:n})});for(let l=1;l<n;l++)yield u({pivot:{x:s,y:9},texture:"generic.door.legs.pillar",...Ee(a,{y:-l*X.h})})}}yield*i(j({...Ce,[o]:1})),yield*i(Ce),t||(yield u({pivot:{x:16,y:X.h*n+13},texture:`generic.door.legs.threshold.double.${o}`,...j({...Ce,[o]:1})}))}const Po=B(({item:e,room:t})=>({container:ot(_o(e,t)),renderProps:{}}));function*So({config:{direction:e,inHiddenWall:t,nearness:n},state:{position:r}},o){const s=Ie(e),{z:i}=r;if(!t&&i===0){const a=j({[Yn(s)]:.5});n==="far"&&(yield u({anchor:{x:0,y:1},flipX:s==="x",texture:"generic.wall.overdraw",...a}))}yield u({texture:ko(o,s,n),pivot:Jn[n][s]})}const Oo=B(({item:e,room:t})=>({container:ot(So(e,t)),renderProps:{}})),Ft=({item:{type:e,state:{action:t,facing:n,teleporting:r}},currentlyRenderedProps:o})=>o===void 0||o.action!==t||o.facingXy4!==n||o.teleportingPhase!==(r?.phase??null)?{container:(()=>{if(t==="death")return u({frames:m.animations[`${e}.fadeOut`]});if(r!==null){if(r.phase==="out")return u({frames:m.animations[`${e}.fadeOut`]});if(r.phase==="in")return u({frames:m.animations[`${e}.fadeOut`].toReversed()})}return u(t==="moving"?{frames:m.animations[`${e}.walking.${n}`]}:t==="falling"&&e==="head"&&(n==="towards"||n==="right")?`head.falling.${n}`:e==="head"&&(n==="towards"||n==="right")?{frames:m.animations[`head.idle.${n}`]}:`${e}.walking.${n}.2`)})(),renderProps:{action:t,facingXy4:n,teleportingPhase:r?.phase??null}}:void 0,Be={frames:m.animations["bubbles.cold"],animationSpeed:.25},se=(e,t="headless-base")=>{const n=new g;n.addChild(u(t));const r=u(e);return r.y=-12,n.addChild(r),n},Xe=(e,t)=>t?new g({children:[u({texture:e,pivot:{x:W.w/2,y:W.h}}),u({texture:`${e}.outline`,pivot:{x:W.w/2+1,y:W.h+1}})]}):u(e),Le=B(({item:{config:{style:e}}})=>({container:u(e),renderProps:{}})),Ao={head:Ft,heels:Ft,doorFrame:Oo,doorLegs:Po,stopAutowalk(){throw new Error("these should always be non-rendering")},portal(){throw new Error("these should always be non-rendering")},wall:B(({item:{config:{side:e,style:t}},room:n})=>{if(e==="right"||e==="towards")throw new Error("this wall should be non-rendering");return{container:u({texture:To(n.planet,t,e,n.color.shade==="dimmed"),pivot:e==="away"?{x:be.w,y:be.h+1}:{x:0,y:be.h+1}}),renderProps:{}}}),barrier({item:{config:{axis:e},state:{expires:t}},currentlyRenderedProps:n}){const r=t!==null;if(n===void 0||r!==n.bubbles)return{container:u(r?{frames:m.animations["bubbles.taupe"],playOnce:"and-destroy",pivot:ht[e]}:{texture:`barrier.${e}`,pivot:ht[e]}),renderProps:{bubbles:r}}},deadlyBlock:Le,slidingDeadly:Le,slidingBlock:Le,block({item:{config:{style:e},state:{expires:t,disappearing:n}},currentlyRenderedProps:r}){const o=t!==null;if(r===void 0||r.bubbles!==o||r.disappearing!==n)return{container:u(o?{frames:m.animations["bubbles.taupe"],playOnce:"and-destroy"}:`block.${e}${n?".disappearing":""}`),renderProps:{bubbles:o,disappearing:n}}},switch({item:{state:{setting:e}},currentlyRenderedProps:t}){if(t===void 0||e!==t.setting)return{container:u(`switch.${e}`),renderProps:{setting:e}}},conveyor({item:{config:{direction:e,count:t},state:{stoodOnBy:n}},currentlyRenderedProps:r}){const o=n.size>0;if(!(r===void 0||r.moving!==o))return;const i=new g,a=Qn(e);return i.addChild(...J(Zn(t,0,-1)).map(l=>{const c=er({[a]:(l-1)*X.w});return u(o?{frames:m.animations[`conveyor.${a}`],reverse:e==="towards"||e==="right",animationSpeed:.5,...c}:{texture:`conveyor.${a}.6`,...c})})),{container:i,renderProps:{moving:o}}},lift:B(()=>{const e=new g,t={x:W.w/2,y:W.h-tr};return e.addChild(u({frames:m.animations.lift,pivot:t})),e.addChild(u({texture:"lift.static",pivot:t})),{container:e,renderProps:{}}}),teleporter({item:{state:{stoodOnBy:e}},currentlyRenderedProps:t}){const n=J(e).find(Me)!==void 0;return t===void 0||n!==t.flashing?{container:n?new g({children:[u("teleporter"),u({frames:m.animations["teleporter.flashing"]})]}):u("teleporter"),renderProps:{flashing:n}}:void 0},pickup({item:{config:{gives:e},state:{expires:t}},currentlyRenderedProps:n}){const r=t!==null;if(!(n===void 0||n.bubbles!==r))return;const i={shield:"bunny",jumps:"bunny",fast:"bunny","extra-life":"bunny",bag:"bag",donuts:"donuts",hooter:"hooter",crown:"crown",reincarnation:{frames:m.animations.fish,animationSpeed:.25}}[e];return{container:u(r?{frames:i==="donuts"?m.animations["bubbles.taupe"]:m.animations["bubbles.white"],playOnce:"and-destroy"}:i),renderProps:{bubbles:r}}},moveableDeadly:B(({item:{config:{style:e}}})=>({container:u(e==="deadFish"?"fish.1":"puck.deadly"),renderProps:{}})),sceneryPlayer:B(({item:{config:{which:e}}})=>({container:u(`${e}.walking.towards.2`),renderProps:{}})),charles({item:{state:{facing:e}},currentlyRenderedProps:t}){const n=ft(e);if(t===void 0||n!==t.facingXy4)return{container:se(`charles.${n}`),renderProps:{facingXy4:n}}},baddie({item:{config:e,state:t},currentlyRenderedProps:n}){let r;const{activated:o}=t;switch(e.which){case"american-football-head":case"turtle":case"cyberman":r=e.startDirection;case"computer-bot":case"elephant":case"monkey":{const s=Kn(t.vels.walking,Ce)?r??"towards":ft(t.vels.walking);if(!(n===void 0||o!==n.activated||s!==n.facingXy4))return;const a={facingXy4:s,activated:o};switch(e.which){case"american-football-head":return{container:u({texture:`${e.which}.${e.style}.${s}`}),renderProps:a};case"turtle":return{container:u(o?{frames:m.animations[`${e.which}.${s}`],animationSpeed:.25}:`${e.which}.${s}.1`),renderProps:a};case"cyberman":return{container:t.activated?se(`${e.which}.${s}`,Be):u(`${e.which}.${s}`),renderProps:a};case"computer-bot":case"elephant":case"monkey":return{container:se(`${e.which}.${s}`),renderProps:a}}break}case"helicopter-bug":case"dalek":case"headless-base":case"elephant-head":case"bubble-robot":case"flying-ball":{if(!(n===void 0||o!==n.activated))return;const i={activated:o};switch(e.which){case"helicopter-bug":case"dalek":return{container:u({frames:m.animations[e.which],animationSpeed:.5}),renderProps:i};case"headless-base":return{container:u(e.which),renderProps:i};case"elephant-head":return{container:u("elephant.towards"),renderProps:i};case"bubble-robot":return{container:se(Be),renderProps:i};case"flying-ball":return{container:se("ball",Be),renderProps:i}}break}default:throw new Error(`unexpected baddie ${e}`)}},joystick:Mt("joystick"),movableBlock:B(({item:{config:{style:e}}})=>({container:u(e),renderProps:{}})),portableBlock({item:{config:{style:e},state:{wouldPickUpNext:t}},currentlyRenderedProps:n}){const r=t;if(n===void 0||r!==n.highlighted)return{container:Xe(e,r),renderProps:{highlighted:r}}},spring({item:{state:{stoodOnBy:e,wouldPickUpNext:t}},currentlyRenderedProps:n}){const r=e.size>0,o=t;if(!(n===void 0||o!==n.highlighted||r!==n.compressed))return;const i=n?.compressed??!1;return{container:!r&&i?u({frames:m.animations["spring.bounce"],playOnce:"and-stop"}):Xe(r?"spring.compressed":"spring.released",o),renderProps:{compressed:r,highlighted:o}}},book:B(({item:{config:{slider:e}}})=>({container:u(`book.${e?"y":"x"}`),renderProps:{}})),hushPuppy({item:{state:{expires:e}},currentlyRenderedProps:t}){const n=e!==null;if(t===void 0||t.bubbles!==n)return{container:u(n?{frames:m.animations["bubbles.taupe"],playOnce:"and-destroy"}:"hushPuppy"),renderProps:{bubbles:n}}},ball:Mt("ball"),floor(){throw new Error("floor should not be rendered as an item")},scroll:B(()=>({renderProps:{},container:u({texture:"scroll",pivot:{x:17,y:24}})}))},Dt=(e,t)=>new K().poly([x({}),x({x:e.x}),x({x:e.x,y:e.y}),x({y:e.y})]).poly([x({}),x({z:e.z}),x({y:e.y,z:e.z}),x({y:e.y})]).poly([x({x:e.x}),x({x:e.x,z:e.z}),x(e),x({x:e.x,y:e.y})]).poly([x({z:e.z}),x({x:e.x,z:e.z}),x({x:e.x,y:e.y,z:e.z}),x({y:e.y,z:e.z})]).stroke({width:1,color:t,alpha:.5}),Io={head:"rgba(255,184,0)",wall:"rgba(128,200,0)",portal:"rgba(255,0,255)",stopAutowalk:"rgba(255,128,128)"},Mo=e=>{const t=Io[e.type]??"rgba(255,255,255)",n=new g;if(v("portal")(e)){const r=x(e.config.relativePoint);n.addChild(new K().circle(r.x,r.y,5).stroke(t)),n.addChild(new K().circle(r.x,r.y,2).fill(t))}return n.addChild(new K().circle(0,0,2).fill(t)),n.addChild(Dt(e.aabb,t)),e.renderAabb&&n.addChild(Dt(e.renderAabb,"rgba(184, 184, 255)")),n},Fo=(e,t,n)=>{t!==void 0&&(n.onItemClick&&t!==void 0&&(t.eventMode="static",t.on("pointertap",()=>{n.onItemClick(e,t)})),t.on("pointerenter",()=>{t.filters=new le("white")}),t.on("pointerleave",()=>{t.filters=[]}))},Et=({state:{position:e}},t)=>{const n=nr(e);t.x=n.x,t.y=n.y},Do=(e,t,n)=>{const r=new g;n.showBoundingBoxes!=="none"&&(r.alpha=.5);const o=new g({label:`item(${e.id})`});o.addChild(r),Fo(e,r,n),(n.showBoundingBoxes==="all"||n.showBoundingBoxes==="non-wall"&&e.type!=="wall")&&(o.addChild(Mo(e)),Et(e,o));let s,i;return{get item(){return e},destroy(){o.destroy({children:!0}),r.destroy({children:!0})},tick(){if(!e.renders)return;const a=Ao[e.type],l=a({item:e,room:t,currentlyRenderedProps:s});l!==void 0&&(s=l.renderProps,r.children.forEach(h=>h.destroy()),l.container!==null&&r.addChild(l.container));const{state:{position:c}}=e,d=i===void 0||!ue(i,c);return d&&(Et(e,o),i=c),d},container:o}},Eo=(e,t)=>{const{leftSide:n,rightSide:r,frontSide:o,top:s}=yn(e),i=(r.x+n.x)/2,a=(s+o.y)/2;t.x=-i,t.y=-a},zt=(e,t)=>{const n=new g({label:`room(${e.id})`}),r=new g({label:`items(room(${e.id}))`});n.addChild(po(e)),n.addChild(r),n.filters=kr(e),Eo(e,n);const o=new Map;return{get container(){return n},get room(){return e},tick(){let s=!1;for(const i of N(e.items)){let a=o.get(i.id);a===void 0&&(a=Do(i,e,t),o.set(i.id,a),r.addChild(a.container)),s=a.tick()||s}for(const i of o.values())e.items[i.item.id]||(o.delete(i.item.id),i.destroy());if(s){const{order:i}=vn(Co(N(e.items)),e.items);for(let a=0;a<i.length;a++){const l=o.get(i[a]);if(l===void 0)throw new Error(`Item id=${i[a]} does not have a renderer - cannot assign a z-index`);l.container.zIndex=a}}},destroy(){n.destroy({children:!0}),o.forEach(s=>{s.destroy()})},get renderOptions(){return t}}},zo=4,Ro=(e,t)=>{const n=new g;n.label="world",n.y=Ve.height*.7,e.stage.addChild(n);const r=new g;r.y=-zo,e.stage.addChild(r);const o=new le(G().shadow);let s=zt(D(t),t.renderOptions);n.addChild(s.container);const i=Ir(r),a=Cr(e),l=({deltaMS:c})=>{const d=a.rescale();n.x=e.renderer.width/a.curUpscale/2;const h=t.gameSpeed===0;if(i(t,d),(s.room!==D(t)||s.renderOptions!==t.renderOptions)&&(s.destroy(),s=zt(D(t),t.renderOptions),n.addChild(s.container)),!h)e.stage.filters=ie,fo(t,c),s.tick();else{e.stage.filters=o;const f=D(t).color;o.targetColor=sn(f).main.original}};return{start(){return e.ticker.add(l),this},stop(){e.stage.removeChild(n),e.ticker.remove(l)}}},$o=async e=>{const t={showBoundingBoxes:"none"},n=new rn;await n.init({background:"#000000",resizeTo:window});const r=br(e,t),o=vr({keyAssignment:r.keyAssignment,inputState:r.inputState,onInputStateChange(i){r.events.emit("inputStateChanged",i)}}),s=Ro(n,r).start();return{campaign:e,events:r.events,renderIn(i){i.appendChild(n.canvas)},changeRoom(i){tt({gameState:r,toRoomId:i,changeType:"level-select"})},get currentRoom(){return D(r)},get gameState(){return r},set renderOptions(i){r.renderOptions=i},stop(){console.warn("tearing down game"),n.canvas.parentNode?.removeChild(n.canvas),s.stop(),o(),n.destroy()}}},Lo=Object.freeze(Object.defineProperty({__proto__:null,gameMain:$o},Symbol.toStringTag,{value:"Module"}));export{Qt as A,Jt as C,Yt as F,ur as R,ir as S,en as V,Lo as g,sr as u};
