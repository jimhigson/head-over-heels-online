import{j as o,r as d,R as vn}from"./index-Cf1cuTeW.js";import{r as ve,S as Lt,ax as Bt,a7 as ue,ay as Mt,B as _,C as bn,z as wn,f as Sn,L as _t,a8 as ce,az as nt,a6 as mt,aA as zn,aB as Ht,P as at,aC as jn,A as Cn,aD as kn,aE as Pn,Z as Dt,aF as In,aG as Ke,c as Rn,e as xt,aH as En,aI as Nn,aJ as Tn,R as Gt,aK as An,au as $n,aL as Ln,I as Ve,aM as Ge,ah as ht,o as Bn,aN as Mn,am as _n,aO as Hn,aP as Dn,aQ as Gn,aR as Fn,aS as Un}from"./App-rX53IGdA.js";import{B as Ft,g as On,h as Wn,i as Xn,j as Ut,C as Jn,R as Kn,S as Vn}from"./RoomSelect-D_jEdJPC.js";import{useAppSelectorWithLevelEditorSlice as ee,changeGridResolution as Zn,selectTool as Me,setTool as Ot,selectCurrentEditingRoomColour as qn,changeRoomColour as gt,selectCurrentEditingRoomScenery as Yn,changeRoomScenery as Qn,selectCanUndo as eo,selectCanRedo as to,undo as Wt,redo as Xt,changeToRoom as no,selectCurrentEditingRoomJson as yt,setSelectedItemInRoom as oo,applyToolToRoomJson as so,deleteSelected as ro,selectSelectedJsonItemIds as io}from"./levelEditorSlice-CE58Z27A.js";import{c as ao,A as lo,s as co,a as uo,R as fo,i as po,z as mo,b as xo,p as Jt}from"./stopAppAutoRendering-BL_8M8j9.js";import"./Graphics-BzVokoG1.js";import"./changeCharacterRoom-e08TvkTA.js";const Kt=e=>e,ho=()=>{const e=ve();return o.jsx(Lt,{className:"w-full",label:"res",value:ee(t=>t.levelEditor.halfGridResolution),onClick:(t,n)=>{e(Zn(n))},falseLabel:"Blocks",trueLabel:"Halves"})},ot="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",_e=({className:e,onClick:t,children:n,disabled:s=!1,isCurrentTool:r=!1})=>o.jsx(Ft,{disabled:s,"data-iscurrenttool":r,className:`active:pt-oneScaledPix ${ot} gap-0 inline-flex overflow-hidden ${r?"bg-pastelBlue":""} ${s?"bg-midGrey text-lightGrey":""} ${e??""}`,onClick:t,children:n}),g=({itemTool:e,children:t,className:n})=>{const s=ee(Me),r=Bt(s?.type==="item"&&s.item,e);return o.jsx(_e,{isCurrentTool:r,className:n,onClick:()=>ue.dispatch(Ot({type:"item",item:e})),children:t})},ke=({children:e})=>{const[t,n]=d.useState(!1),[s,r]=d.useState(0),i=e[s];return o.jsxs(On,{open:t,onOpenChange:n,children:[o.jsxs("div",{className:Mt(ot,"relative",{"drop-shadow-oneBlock z-popups":t}),children:[i,o.jsx(Wn,{asChild:!0,children:o.jsx(Ft,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:o.jsx(_,{className:"pl-oneScaledPix",children:t?"X":"â¬‡"})})})]}),o.jsx(Xn,{children:o.jsx(bn,{scaleFactor:2,children:o.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:e.map((l,a)=>a===s?null:o.jsx("div",{className:ot,onClick:()=>{r(a),n(!1)},children:l},a))})})})]})},go=()=>{const t=ee(Me)?.type==="pointer";return o.jsx(_e,{onClick:()=>ue.dispatch(Ot({type:"pointer"})),isCurrentTool:t,children:o.jsx("span",{className:"sprite texture-hud.char.â†– relative"})})},vt=e=>{const{main:t}=ao[e].basic;return{backgroundColor:t.basic.toHex(),borderColor:t.dimmed.toHex()}};function yo(){const e=ve(),t=ee(qn);return o.jsxs(o.Fragment,{children:[o.jsx(Ut,{value:t.hue,onSelect:n=>{e(gt({hue:n}))},values:wn,disableCommandInput:!0,OptionCommandItem:({value:n,onSelect:s})=>o.jsx(Jn,{value:n,className:"border-l-3 h-2 w-full p-0",style:vt(n),onSelect:s}),triggerButtonLabel:"colour",triggerButtonClassName:Mt("w-full",`${t.hue==="white"?"text-pureBlack":"text-white"}`),triggerButtonStyle:vt(t.hue)}),o.jsx(Lt,{className:"w-full",label:"shade",value:t.shade==="basic",onClick:(n,s)=>{e(gt({shade:s?"basic":"dimmed"}))},falseLabel:"dim",trueLabel:"basic"})]})}function vo(){const e=ve(),t=ee(Yn);return o.jsx(Ut,{value:t,onSelect:n=>{e(Qn(n))},values:Sn,disableCommandInput:!0,triggerButtonClassName:"w-full",triggerButtonLabel:t})}const bt="[button:not(:disabled):hover_&]:hidden mt-quarter",wt="hidden [button:not(:disabled):hover_&]:inline mt-quarter",St="hidden [button:not(:disabled):hover_&]:inline",bo=()=>{const e=ve(),t=ee(eo),n=ee(to);return o.jsxs(o.Fragment,{children:[o.jsxs(_e,{disabled:!t,className:"flex-col",onClick:()=>{e(Wt())},children:[o.jsx(_,{className:bt,children:"â¬…"}),o.jsx(_,{className:wt,children:"Un"}),o.jsx(_,{className:St,children:"do"})]}),o.jsxs(_e,{disabled:!n,className:"flex-col",onClick:()=>{e(Xt())},children:[o.jsx(_,{className:bt,children:"âž¡"}),o.jsx(_,{className:wt,children:"Re"}),o.jsx(_,{className:St,children:"do"})]})]})},w=Kt("[button:not([data-iscurrenttool=true]):not(:hover)_&]:sprite-revert-to-two-tone"),V=Kt("flex flex-wrap gap-oneScaledPix w-full"),ae=({topClasses:e,bottomClasses:t="texture-headlessBase"})=>o.jsxs("div",{className:"relative w-full h-full",children:[o.jsx("span",{className:`sprite absolute top-[calc(9px*var(--scale))] left-0 ${t} ${w}`}),o.jsx("span",{className:`sprite absolute top-[calc(-3px*var(--scale))] left-0 ${e} ${w}`})]}),oe=({iconClasses:e,text:t})=>o.jsxs("div",{className:"relative w-full h-full",children:[o.jsx("span",{className:`sprite absolute top-0 left-0 ${e} ${w}`}),o.jsx(_,{className:"bg-metallicBlueHalfbrite absolute top-0 right-0 pl-oneScaledPix block",children:t})]}),wo=()=>{const e=ee(n=>n.levelEditor.campaignInProgress),t=ve();return o.jsxs("div",{className:"scale-editor flex w-full h-full box-content text-white bg-metallicBlueHalfbrite py-1 gap-1 flex-wrap justify-start overflow-auto",children:[o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Campaign"}),o.jsx(Kn,{campaign:e,onRoomSelect:n=>{t(no(n))}})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Room"}),o.jsx(vo,{}),o.jsx(yo,{})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Edit"}),o.jsx(go,{}),o.jsx(bo,{}),o.jsx(ho,{})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Monsters"}),o.jsx(g,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},children:o.jsx("span",{className:`sprite texture-dalek.1 [button:hover_&]:texture-animated-dalek" ${w}`})}),o.jsx(g,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},children:o.jsx(ae,{topClasses:"texture-cyberman.towards [button:hover_&]:texture-cyberman.right",bottomClasses:"texture-bubbles.cold.2 [button:hover_&]:texture-animated-bubbles.cold"})}),o.jsx(g,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-skiHead.greenAndPink.towards [button:hover_&]:texture-skiHead.greenAndPink.right ${w}`})}),o.jsx(g,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:o.jsx("span",{className:`sprite texture-helicopterBug.1 [button:hover_&]:texture-animated-helicopterBug ${w}`})}),o.jsx(g,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-turtle.towards.1 [button:hover_&]:texture-animated-turtle.right ${w}`})}),o.jsx(g,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},children:o.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase.all ${w}`})}),o.jsx(g,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},children:o.jsx(ae,{topClasses:"texture-computerBot.towards [button:hover_&]:texture-computerBot.right"})}),o.jsx(g,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:o.jsx(ae,{topClasses:"texture-monkey.towards [button:hover_&]:texture-monkey.right"})}),o.jsx(g,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},children:o.jsx(ae,{topClasses:"texture-elephant.towards [button:hover_&]:texture-elephant.right"})}),o.jsx(g,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-elephant.towards [button:hover_&]:texture-elephant.right ${w}`})}),o.jsx(g,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",children:o.jsx(ae,{topClasses:"texture-ball",bottomClasses:"texture-bubbles.cold.2 [button:hover_&]:texture-animated-bubbles.cold"})}),o.jsx(g,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},children:o.jsx("span",{className:`sprite texture-bubbles.cold.2 [button:hover_&]:texture-animated-bubbles.cold ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Blocks"}),o.jsx(g,{itemTool:{type:"block",config:{style:"artificial"}},children:o.jsx("span",{className:`sprite texture-block.artificial ${w}`})}),o.jsx(g,{itemTool:{type:"block",config:{style:"organic"}},children:o.jsx("span",{className:`sprite texture-block.organic ${w}`})}),o.jsx(g,{itemTool:{type:"block",config:{style:"tower"}},children:o.jsx("span",{className:`sprite texture-tower ${w}`})}),o.jsx(g,{itemTool:{type:"block",config:{style:"book"}},children:o.jsx("span",{className:`sprite texture-book.x ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Pickups"}),o.jsxs(ke,{children:[o.jsx(g,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:o.jsx(oe,{iconClasses:"texture-whiteRabbit",text:"2"})}),o.jsx(g,{itemTool:{type:"pickup",config:{gives:"shield"}},children:o.jsx(oe,{iconClasses:"texture-whiteRabbit",text:"ðŸ›¡"})}),o.jsx(g,{itemTool:{type:"pickup",config:{gives:"jumps"}},children:o.jsx(oe,{iconClasses:"texture-whiteRabbit",text:"â™¨"})}),o.jsx(g,{itemTool:{type:"pickup",config:{gives:"fast"}},children:o.jsx(oe,{iconClasses:"texture-whiteRabbit",text:"âš¡"})})]}),o.jsx(g,{itemTool:{type:"pickup",config:{gives:"bag"}},children:o.jsx("span",{className:`sprite texture-bag ${w}`})}),o.jsx(g,{itemTool:{type:"pickup",config:{gives:"hooter"}},children:o.jsx("span",{className:`sprite texture-hooter ${w}`})}),o.jsx(g,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:o.jsx("span",{className:`sprite texture-doughnuts ${w}`})}),o.jsx(g,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:o.jsx("span",{className:`sprite texture-crown.blacktooth ${w}`})}),o.jsx(g,{itemTool:{type:"pickup",config:{gives:"scroll",page:"blacktooth"}},children:o.jsx("span",{className:`sprite texture-scroll ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"misc."}),o.jsxs(g,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[o.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift.static ${w} [button:active_&]:top-oneScaledPix`}),o.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift.1 [button:hover_&]:texture-animated-lift ${w} [button:active_&]:top-oneScaledPix`})]}),o.jsxs(ke,{children:[o.jsx(g,{itemTool:{type:"barrier",config:{axis:"x"}},children:o.jsx("span",{className:`sprite texture-barrier.x ${w}`})}),o.jsx(g,{itemTool:{type:"barrier",config:{axis:"y"}},children:o.jsx("span",{className:`sprite texture-barrier.y ${w}`})})]}),o.jsxs(ke,{children:[o.jsx(g,{itemTool:{type:"conveyor",config:{direction:"away"}},children:o.jsx(oe,{iconClasses:"texture-conveyor.y.1 [button:hover_&]:texture-animated-conveyor.y",text:"â†—"})}),o.jsx(g,{itemTool:{type:"conveyor",config:{direction:"towards"}},children:o.jsx(oe,{iconClasses:"texture-conveyor.y.1 [button:hover_&]:texture-animated-reversed-conveyor.y",text:"â†™"})}),o.jsx(g,{itemTool:{type:"conveyor",config:{direction:"left"}},children:o.jsx(oe,{iconClasses:"texture-conveyor.x.1 [button:hover_&]:texture-animated-conveyor.x",text:"â†–"})}),o.jsx(g,{itemTool:{type:"conveyor",config:{direction:"right"}},children:o.jsx(oe,{iconClasses:"texture-conveyor.x.1 [button:hover_&]:texture-animated-reversed-conveyor.x",text:"â†˜"})})]}),o.jsx(g,{itemTool:{type:"teleporter",config:{toRoom:"(placeholder)",toPosition:_t}},children:o.jsx("span",{className:`sprite texture-teleporter ${w}`})}),o.jsx(g,{itemTool:{type:"charles",config:ce},children:o.jsx(ae,{topClasses:"texture-charles.towards [button:hover_&]:texture-charles.right"})}),o.jsx(g,{itemTool:{type:"joystick",config:{controls:["(placeholder)"]}},children:o.jsx("span",{className:`sprite texture-joystick ${w}`})}),o.jsx(g,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:nt}},children:o.jsx("span",{className:`sprite texture-switch.left [button:hover_&]:texture-switch.right ${w}`})}),o.jsx(g,{itemTool:{type:"ball",config:ce},children:o.jsx("span",{className:`sprite texture-ball ${w}`})}),o.jsxs(ke,{children:[o.jsx(g,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:o.jsx("span",{className:`sprite texture-cube ${w}`})}),o.jsx(g,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:o.jsx("span",{className:`sprite texture-drum ${w}`})}),o.jsx(g,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:o.jsx("span",{className:`sprite texture-sticks ${w}`})})]}),o.jsx(g,{itemTool:{type:"pushableBlock",config:{}},children:o.jsx("span",{className:`sprite texture-stepStool ${w}`})}),o.jsx(g,{itemTool:{type:"movingPlatform",config:{movement:"clockwise",activated:"on",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-sandwich ${w}`})}),o.jsx(g,{itemTool:{type:"spikes",config:ce},children:o.jsx("span",{className:`sprite texture-spikes ${w}`})}),o.jsxs(ke,{children:[o.jsx(g,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},children:o.jsx("span",{className:`sprite texture-volcano.1 [button:hover_&]:texture-animated-volcano ${w}`})}),o.jsx(g,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},children:o.jsx("span",{className:`sprite texture-toaster.off ${w}`})})]}),o.jsx(g,{itemTool:{type:"slidingBlock",config:{style:"puck"}},children:o.jsx("span",{className:`sprite texture-puck ${w}`})}),o.jsx(g,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},children:o.jsx("span",{className:`sprite texture-spikyBall.1 [button:hover_&]:texture-spikyBall.2 ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Structure"}),o.jsx(g,{itemTool:{type:"door",config:{direction:"away",toRoom:"(placeholder)"}},children:o.jsx("span",{className:`sprite texture-door.frame.generic.x.whole ${w}`})}),o.jsx(g,{itemTool:{type:"wall",config:{direction:"away",tiles:["plain"]}},children:o.jsx("span",{className:`sprite texture-blacktooth.wall.plain.away ${w}`})}),o.jsx(g,{itemTool:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:{x:1,y:1}}},children:o.jsx("span",{className:`sprite texture-blacktooth.floor ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Player"}),o.jsx(g,{itemTool:{type:"player",config:{which:"head"}},children:o.jsx("span",{className:`sprite texture-head.walking.towards.2 [button:hover_&]:texture-animated-head.walking.right ${w}`})}),o.jsx(g,{itemTool:{type:"player",config:{which:"heels"}},children:o.jsx("span",{className:`sprite texture-heels.walking.towards.2 [button:hover_&]:texture-animated-heels.walking.right ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"NPCâ€™s"}),o.jsx(g,{itemTool:{type:"sceneryPlayer",config:{which:"head",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-head.walking.towards.2 [button:hover_&]:texture-animated-head.walking.right ${w}`})}),o.jsx(g,{itemTool:{type:"sceneryPlayer",config:{which:"heels",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-heels.walking.towards.2 [button:hover_&]:texture-animated-heels.walking.right ${w}`})}),o.jsx(g,{itemTool:{type:"sceneryPlayer",config:{which:"headOverHeels",startDirection:"towards"}},children:o.jsx(ae,{topClasses:"texture-head.walking.towards.2 [button:hover_&]:texture-animated-head.walking.right",bottomClasses:"texture-heels.walking.towards.2 [button:hover_&]:texture-animated-heels.walking.right"})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"debug"}),o.jsx(Vn,{})]})]})},Vt=d.createContext(null),So=()=>{const[e,t]=d.useState(()=>mt({roomJson:yt(ue.getState()),roomPickupsCollected:ce,scrollsRead:ce,isNewGame:!0})),n=ee(yt);return d.useEffect(()=>{const s=mt({roomJson:n,roomPickupsCollected:ce,scrollsRead:ce,isNewGame:!0});t(s)},[n]),e},zo=({children:e})=>{const t=So();return o.jsx(Vt,{value:t,children:e})},Fe=()=>{const e=d.useContext(Vt);if(e===null)throw new Error("no room state in context, or no context");return e},Zt=d.createContext(null),jo=({children:e})=>{const[t,n]=d.useState(null);return d.useEffect(()=>{const s=new lo;return s.init({background:co.pureBlack,sharedTicker:!0}).then(()=>{uo(s),n(s)}),()=>{}},[]),t===null?null:o.jsx(Zt,{value:t,children:e})},pe=()=>d.useContext(Zt),Co=(e,t)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:t},soundSettings:{mute:!0},pixiRenderer:e,gameState:void 0,paused:!1,colourised:!0,upscale:Ht(ue.getState()),editor:!0}),zt=(e,t,n)=>new fo({room:e,general:Co(t,n)}),ko=()=>{const{renderer:e}=pe(),t=zn();if(!e)throw new Error("this should never be falsey (typescript violation)");const n=Fe(),[s,r]=d.useState(()=>zt(n,e,t));return d.useEffect(()=>{const i=zt(n,e,t);return r(i),()=>{i.destroy()}},[n,e,t]),s},$e="cursor",jt=({room:e,pointingAt:t,valid:n,includeCursor:s,previewItems:r})=>{const{face:i,position:l}=t;for(const a of r)jn({room:e,item:a});if(s){const a=Cn($e,e.items);a?(a.state.position=l,a.state.face=i,a.state.valid=n):e.items[$e]={type:"cursor",id:$e,state:{...Pn(),face:i,position:l,valid:n},config:{},aabb:kn}}else delete e.items[$e]},Ze=e=>{for(const t of at(e.items))t.isCursorPreview&&delete e.items[t.id]};let Po=0;const qt=(e,t,n)=>{if(e.face==="up")return Ke(e.position);if(n.type==="door"){const r=t.items[e.itemId];if(r.type!=="wall")return;const{config:i,aabb:l,state:{position:a}}=r,c={x:1,y:1,...i.times},p=Rn(xt(i.direction)),m=xt(i.direction);if(c[p]<2)return;const f=a[p],u=a[p]+l[p]-En,h=a.z,v=a.z+l.z-Nn,I={[p]:Math.max(Math.min(e.position[p],u),f),[m]:e.position[m],z:Math.max(Math.min(e.position.z,v),h)};return Ke(I)}const s=Tn[e.face];return Gt(Ke(e.position),s)},Ct=(e,t,n)=>{const s=[...at(t.items).filter(c=>Dt(c)&&c.type!=="cursor"&&!c.isCursorPreview)],r=(c,p,m)=>{const f=An(`cursor/${Po++}`,{type:c,config:p,position:m},t.roomJson).toArray();return f.forEach(u=>{u.isCursorPreview=!0}),f},i=qt(e,t,n);if(i===void 0)return;if(n.type==="door"){const c=t.items[e.itemId];if(c.type!=="wall")return;const p=c.config.direction;return r("door",{...n.config,direction:p},i)}const l=r(n.type,n.config,i);return l.some(c=>{const p=In(c,s);return!po(p)})?void 0:l},Io=({x:e,y:t})=>n=>{const{bottomCentre:s,topLeft:r,topRight:i}=Jt(n.state.position,n.aabb);return!(e<r.x||e>i.x||t<i.y-(i.x-e)/2||t<r.y-(e-r.x)/2||t>s.y-(e-s.x)/2||t>s.y-(s.x-e)/2)},Ro=(e,{x:t,y:n},s)=>{if(s.type==="item"&&s.item.type==="door"&&e.type==="wall")return $n(e.config.direction);const{bottomCentre:r,topLeft:i,topRight:l}=Jt(e.state.position,e.aabb);return n<i.y-(i.x-t)/2?n<l.y-(t-l.x)/2?"up":"right":t<r.x?"towards":"right"},kt=e=>e.fixedZIndex!==void 0,Eo=e=>{if(e.every(kt))return e.toSorted((i,l)=>l.fixedZIndex-i.fixedZIndex).at(0);const t=e.filter(i=>!kt(i));if(t.length===0)return;if(t.length===1)return t[0];const n=Object.fromEntries(t.map(i=>[i.id,i])),s=mo(n),{order:r}=xo(s,n);return n[r[0]]},No=({state:{position:e},aabb:t},n,s,r,i)=>{let l=_t,a;switch(n){case"up":l={z:t.z},a="xy";break;case"down":a="xy";break;case"towards":a="xz";break;case"away":l={y:t.y},a="xz";break;case"left":l={x:t.x},a="yz";break;case"right":a="yz";break;default:throw new Error('unexpected face "'+n+'"')}const c=Ln(s,Gt(e,l),a),p=!i||r.type==="item"&&r.item.type==="door",m=p?Ve.w:Ve.w/2,f=Ve.h,u=p?0:m/2,h=f/2;return{x:a==="yz"?Math.round(c.x/m)*m:Math.floor((c.x-u)/m)*m,y:a==="xz"?Math.round(c.y/m)*m:Math.floor((c.y-u)/m)*m,z:a==="xy"?Math.round(c.z/f)*f:Math.floor((c.z+h)/f)*f}},To=e=>t=>{const n=Dt(t)&&t.type!=="cursor"&&!t.isCursorPreview;return e.type==="item"&&e.item.type==="door"?n&&t.type==="wall":n},Ao=(e,t,n,s)=>{const r=Eo(Array.from(at(t.items).filter(To(n)).filter(Io(e))));if(r){const i=Ro(r,e,n);return{itemId:r.id,face:i,position:No(r,i,e,n,s)}}else return},$o=(e,t)=>{const n=e.cssUpscale*e.gameEngineUpscale;return{x:t.x/n-e.gameEngineScreenSize.x/2,y:t.y/n-e.gameEngineScreenSize.y+16}},Lo=e=>{const t=pe(),n=Ge(Ht),s=ve(),r=Fe(),i=d.useRef(void 0);d.useEffect(()=>{if(t.stage.eventMode="none",e===null)return;const l=p=>{const m=$o(n,p),f=ue.getState(),u=Me(f),h=Ao(m,r,u,f.levelEditor.halfGridResolution);if(!Bt(h,i.current))if(i.current=h,h!==void 0)switch(u.type){case"item":{const v=Ct(h,r,u.item),I=v!==void 0;Ze(r),jt({room:r,pointingAt:h,valid:I,includeCursor:!I,previewItems:v??nt});break}case"pointer":{Ze(r),jt({room:r,pointingAt:h,valid:!0,includeCursor:!0,previewItems:nt});const v=r.items[h.itemId]?.jsonItemId;r.editor={...r.editor,hoveredJsonItemId:v};break}}else Ze(r)},a=p=>{const m=Me(ue.getState());switch(m.type){case"item":{const f=i.current;if(f===void 0||Ct(f,r,m.item)===void 0)return;const h=r.items[f.itemId];s(so({blockPosition:qt(f,r,m.item),pointedAtItem:{type:h.type,config:h.config,jsonItemId:h.jsonItemId}}));break}case"pointer":{const f=i.current;if(!f)return;const{jsonItemId:u}=r.items[f.itemId];s(oo({jsonItemId:u,additive:p.ctrlKey||p.metaKey}));break}}},c=p=>{const m=p.key;(m==="Backspace"||m==="Delete")&&s(ro()),(m==="z"||m==="Z")&&ue.dispatch(p.shiftKey?Xt():Wt())};return e.addEventListener("mousemove",l),e.addEventListener("click",a),window.addEventListener("keyup",c),()=>{e.removeEventListener("mousemove",l),e.removeEventListener("click",a),window.removeEventListener("keyup",c)}},[t.stage,n,e,s,r])},Bo=e=>{const t=Fe(),n=pe();d.useEffect(()=>{let s=0;const r=({deltaMS:i})=>{if(e.destroyed)return;e.renderContext.room!==t&&console.warn("room renderer does not have the current room");const l=new Set(Bn(t.items));t.roomTime+=i,e.tick({deltaMS:i,movedItems:l,progression:s++}),n.render()};return ht.shared.add(r),()=>{ht.shared.remove(r)}},[e,t,n])},Mo=e=>{const t=pe();d.useEffect(()=>{if(e)return e.appendChild(t.canvas),()=>{e.removeChild(t.canvas)}},[e,t])},_o=()=>{const e=pe(),t=Ge(n=>n.upscale.upscale.gameEngineUpscale);e.stage.scale=t},Ho=()=>{const e=pe(),t=Ge(Mn);d.useEffect(()=>{e.renderer?.resize(t.x,t.y)},[e.renderer,t])},Do=e=>{const t=pe(),[n]=d.useState(()=>new _n),s=Ge(Hn);d.useEffect(()=>{if(e.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return n.addChild(e.output.graphics),t.stage.addChild(n),()=>{t.stage.removeChild(n),n.removeChild(e.output.graphics)}},[e,t,n]),d.useEffect(()=>{n.x=s.x/2,n.y=s.y-16},[n,s])},Go=()=>{const e=Fe(),t=ee(io);d.useEffect(()=>{e.editor||(e.editor={}),e.editor.selectedJsonItemId=t},[e,t])};Gn.defaultOptions.scaleMode="nearest";const Fo=()=>{const e=ko(),[t,n]=d.useState(null);Ho(),Do(e),Bo(e),Lo(t),Mo(t),_o(),Go();const s=Dn();return o.jsx("div",{style:s,ref:n})},Ue=d.createContext(null);Ue.displayName="PanelGroupContext";const $={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},lt=10,de=d.useLayoutEffect,Pt=vn.useId,Uo=typeof Pt=="function"?Pt:()=>null;let Oo=0;function ct(e=null){const t=Uo(),n=d.useRef(e||t||null);return n.current===null&&(n.current=""+Oo++),e??n.current}function Yt({children:e,className:t="",collapsedSize:n,collapsible:s,defaultSize:r,forwardedRef:i,id:l,maxSize:a,minSize:c,onCollapse:p,onExpand:m,onResize:f,order:u,style:h,tagName:v="div",...I}){const R=d.useContext(Ue);if(R===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:k,expandPanel:T,getPanelSize:B,getPanelStyle:H,groupId:q,isPanelCollapsed:N,reevaluatePanelConstraints:P,registerPanel:J,resizePanel:te,unregisterPanel:W}=R,F=ct(l),L=d.useRef({callbacks:{onCollapse:p,onExpand:m,onResize:f},constraints:{collapsedSize:n,collapsible:s,defaultSize:r,maxSize:a,minSize:c},id:F,idIsFromProps:l!==void 0,order:u});d.useRef({didLogMissingDefaultSizeWarning:!1}),de(()=>{const{callbacks:G,constraints:D}=L.current,U={...D};L.current.id=F,L.current.idIsFromProps=l!==void 0,L.current.order=u,G.onCollapse=p,G.onExpand=m,G.onResize=f,D.collapsedSize=n,D.collapsible=s,D.defaultSize=r,D.maxSize=a,D.minSize=c,(U.collapsedSize!==D.collapsedSize||U.collapsible!==D.collapsible||U.maxSize!==D.maxSize||U.minSize!==D.minSize)&&P(L.current,U)}),de(()=>{const G=L.current;return J(G),()=>{W(G)}},[u,F,J,W]),d.useImperativeHandle(i,()=>({collapse:()=>{k(L.current)},expand:G=>{T(L.current,G)},getId(){return F},getSize(){return B(L.current)},isCollapsed(){return N(L.current)},isExpanded(){return!N(L.current)},resize:G=>{te(L.current,G)}}),[k,T,B,N,F,te]);const ie=H(L.current,r);return d.createElement(v,{...I,children:e,className:t,id:F,style:{...ie,...h},[$.groupId]:q,[$.panel]:"",[$.panelCollapsible]:s||void 0,[$.panelId]:F,[$.panelSize]:parseFloat(""+ie.flexGrow).toFixed(1)})}const Pe=d.forwardRef((e,t)=>d.createElement(Yt,{...e,forwardedRef:t}));Yt.displayName="Panel";Pe.displayName="forwardRef(Panel)";let st=null,Be=-1,se=null;function Wo(e,t){if(t){const n=(t&on)!==0,s=(t&sn)!==0,r=(t&rn)!==0,i=(t&an)!==0;if(n)return r?"se-resize":i?"ne-resize":"e-resize";if(s)return r?"sw-resize":i?"nw-resize":"w-resize";if(r)return"s-resize";if(i)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function Xo(){se!==null&&(document.head.removeChild(se),st=null,se=null,Be=-1)}function qe(e,t){var n,s;const r=Wo(e,t);if(st!==r){if(st=r,se===null&&(se=document.createElement("style"),document.head.appendChild(se)),Be>=0){var i;(i=se.sheet)===null||i===void 0||i.removeRule(Be)}Be=(n=(s=se.sheet)===null||s===void 0?void 0:s.insertRule(`*{cursor: ${r} !important;}`))!==null&&n!==void 0?n:-1}}function Qt(e){return e.type==="keydown"}function en(e){return e.type.startsWith("pointer")}function tn(e){return e.type.startsWith("mouse")}function Oe(e){if(en(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if(tn(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}function Jo(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function Ko(e,t,n){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function Vo(e,t){if(e===t)throw new Error("Cannot compare node with itself");const n={a:Et(e),b:Et(t)};let s;for(;n.a.at(-1)===n.b.at(-1);)e=n.a.pop(),t=n.b.pop(),s=e;j(s,"Stacking order can only be calculated for elements with a common ancestor");const r={a:Rt(It(n.a)),b:Rt(It(n.b))};if(r.a===r.b){const i=s.childNodes,l={a:n.a.at(-1),b:n.b.at(-1)};let a=i.length;for(;a--;){const c=i[a];if(c===l.a)return 1;if(c===l.b)return-1}}return Math.sign(r.a-r.b)}const Zo=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function qo(e){var t;const n=getComputedStyle((t=nn(e))!==null&&t!==void 0?t:e).display;return n==="flex"||n==="inline-flex"}function Yo(e){const t=getComputedStyle(e);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||qo(e))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||Zo.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function It(e){let t=e.length;for(;t--;){const n=e[t];if(j(n,"Missing node"),Yo(n))return n}return null}function Rt(e){return e&&Number(getComputedStyle(e).zIndex)||0}function Et(e){const t=[];for(;e;)t.push(e),e=nn(e);return t}function nn(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const on=1,sn=2,rn=4,an=8,Qo=Jo()==="coarse";let Z=[],ye=!1,re=new Map,We=new Map;const Ee=new Set;function es(e,t,n,s,r){var i;const{ownerDocument:l}=t,a={direction:n,element:t,hitAreaMargins:s,setResizeHandlerState:r},c=(i=re.get(l))!==null&&i!==void 0?i:0;return re.set(l,c+1),Ee.add(a),He(),function(){var m;We.delete(e),Ee.delete(a);const f=(m=re.get(l))!==null&&m!==void 0?m:1;if(re.set(l,f-1),He(),f===1&&re.delete(l),Z.includes(a)){const u=Z.indexOf(a);u>=0&&Z.splice(u,1),dt(),r("up",!0,null)}}}function ts(e){const{target:t}=e,{x:n,y:s}=Oe(e);ye=!0,ut({target:t,x:n,y:s}),He(),Z.length>0&&(De("down",e),e.preventDefault(),ln(t)||e.stopImmediatePropagation())}function Ye(e){const{x:t,y:n}=Oe(e);if(ye&&e.buttons===0&&(ye=!1,De("up",e)),!ye){const{target:s}=e;ut({target:s,x:t,y:n})}De("move",e),dt(),Z.length>0&&e.preventDefault()}function Qe(e){const{target:t}=e,{x:n,y:s}=Oe(e);We.clear(),ye=!1,Z.length>0&&(e.preventDefault(),ln(t)||e.stopImmediatePropagation()),De("up",e),ut({target:t,x:n,y:s}),dt(),He()}function ln(e){let t=e;for(;t;){if(t.hasAttribute($.resizeHandle))return!0;t=t.parentElement}return!1}function ut({target:e,x:t,y:n}){Z.splice(0);let s=null;(e instanceof HTMLElement||e instanceof SVGElement)&&(s=e),Ee.forEach(r=>{const{element:i,hitAreaMargins:l}=r,a=i.getBoundingClientRect(),{bottom:c,left:p,right:m,top:f}=a,u=Qo?l.coarse:l.fine;if(t>=p-u&&t<=m+u&&n>=f-u&&n<=c+u){if(s!==null&&document.contains(s)&&i!==s&&!i.contains(s)&&!s.contains(i)&&Vo(s,i)>0){let v=s,I=!1;for(;v&&!v.contains(i);){if(Ko(v.getBoundingClientRect(),a)){I=!0;break}v=v.parentElement}if(I)return}Z.push(r)}})}function et(e,t){We.set(e,t)}function dt(){let e=!1,t=!1;Z.forEach(s=>{const{direction:r}=s;r==="horizontal"?e=!0:t=!0});let n=0;We.forEach(s=>{n|=s}),e&&t?qe("intersection",n):e?qe("horizontal",n):t?qe("vertical",n):Xo()}let tt;function He(){var e;(e=tt)===null||e===void 0||e.abort(),tt=new AbortController;const t={capture:!0,signal:tt.signal};Ee.size&&(ye?(Z.length>0&&re.forEach((n,s)=>{const{body:r}=s;n>0&&(r.addEventListener("contextmenu",Qe,t),r.addEventListener("pointerleave",Ye,t),r.addEventListener("pointermove",Ye,t))}),re.forEach((n,s)=>{const{body:r}=s;r.addEventListener("pointerup",Qe,t),r.addEventListener("pointercancel",Qe,t)})):re.forEach((n,s)=>{const{body:r}=s;n>0&&(r.addEventListener("pointerdown",ts,t),r.addEventListener("pointermove",Ye,t))}))}function De(e,t){Ee.forEach(n=>{const{setResizeHandlerState:s}=n,r=Z.includes(n);s(e,r,t)})}function ns(){const[e,t]=d.useState(0);return d.useCallback(()=>t(n=>n+1),[])}function j(e,t){if(!e)throw console.error(t),Error(t)}function fe(e,t,n=lt){return e.toFixed(n)===t.toFixed(n)?0:e>t?1:-1}function ne(e,t,n=lt){return fe(e,t,n)===0}function X(e,t,n){return fe(e,t,n)===0}function os(e,t,n){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){const r=e[s],i=t[s];if(!X(r,i,n))return!1}return!0}function ge({panelConstraints:e,panelIndex:t,size:n}){const s=e[t];j(s!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:r=0,collapsible:i,maxSize:l=100,minSize:a=0}=s;if(fe(n,a)<0)if(i){const c=(r+a)/2;fe(n,c)<0?n=r:n=a}else n=a;return n=Math.min(l,n),n=parseFloat(n.toFixed(lt)),n}function Ie({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:s,prevLayout:r,trigger:i}){if(X(e,0))return t;const l=[...t],[a,c]=s;j(a!=null,"Invalid first pivot index"),j(c!=null,"Invalid second pivot index");let p=0;if(i==="keyboard"){{const f=e<0?c:a,u=n[f];j(u,`Panel constraints not found for index ${f}`);const{collapsedSize:h=0,collapsible:v,minSize:I=0}=u;if(v){const R=t[f];if(j(R!=null,`Previous layout not found for panel index ${f}`),X(R,h)){const k=I-R;fe(k,Math.abs(e))>0&&(e=e<0?0-k:k)}}}{const f=e<0?a:c,u=n[f];j(u,`No panel constraints found for index ${f}`);const{collapsedSize:h=0,collapsible:v,minSize:I=0}=u;if(v){const R=t[f];if(j(R!=null,`Previous layout not found for panel index ${f}`),X(R,I)){const k=R-h;fe(k,Math.abs(e))>0&&(e=e<0?0-k:k)}}}}{const f=e<0?1:-1;let u=e<0?c:a,h=0;for(;;){const I=t[u];j(I!=null,`Previous layout not found for panel index ${u}`);const k=ge({panelConstraints:n,panelIndex:u,size:100})-I;if(h+=k,u+=f,u<0||u>=n.length)break}const v=Math.min(Math.abs(e),Math.abs(h));e=e<0?0-v:v}{let u=e<0?a:c;for(;u>=0&&u<n.length;){const h=Math.abs(e)-Math.abs(p),v=t[u];j(v!=null,`Previous layout not found for panel index ${u}`);const I=v-h,R=ge({panelConstraints:n,panelIndex:u,size:I});if(!X(v,R)&&(p+=v-R,l[u]=R,p.toPrecision(3).localeCompare(Math.abs(e).toPrecision(3),void 0,{numeric:!0})>=0))break;e<0?u--:u++}}if(os(r,l))return r;{const f=e<0?c:a,u=t[f];j(u!=null,`Previous layout not found for panel index ${f}`);const h=u+p,v=ge({panelConstraints:n,panelIndex:f,size:h});if(l[f]=v,!X(v,h)){let I=h-v,k=e<0?c:a;for(;k>=0&&k<n.length;){const T=l[k];j(T!=null,`Previous layout not found for panel index ${k}`);const B=T+I,H=ge({panelConstraints:n,panelIndex:k,size:B});if(X(T,H)||(I-=H-T,l[k]=H),X(I,0))break;e>0?k--:k++}}}const m=l.reduce((f,u)=>u+f,0);return X(m,100)?l:r}function ss({layout:e,panelsArray:t,pivotIndices:n}){let s=0,r=100,i=0,l=0;const a=n[0];j(a!=null,"No pivot index found"),t.forEach((f,u)=>{const{constraints:h}=f,{maxSize:v=100,minSize:I=0}=h;u===a?(s=I,r=v):(i+=I,l+=v)});const c=Math.min(r,100-i),p=Math.max(s,100-l),m=e[a];return{valueMax:c,valueMin:p,valueNow:m}}function Ne(e,t=document){return Array.from(t.querySelectorAll(`[${$.resizeHandleId}][data-panel-group-id="${e}"]`))}function cn(e,t,n=document){const r=Ne(e,n).findIndex(i=>i.getAttribute($.resizeHandleId)===t);return r??null}function un(e,t,n){const s=cn(e,t,n);return s!=null?[s,s+1]:[-1,-1]}function rs(e){return e instanceof HTMLElement?!0:typeof e=="object"&&e!==null&&"tagName"in e&&"getAttribute"in e}function dn(e,t=document){if(rs(t)&&t.dataset.panelGroupId==e)return t;const n=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return n||null}function Xe(e,t=document){const n=t.querySelector(`[${$.resizeHandleId}="${e}"]`);return n||null}function is(e,t,n,s=document){var r,i,l,a;const c=Xe(t,s),p=Ne(e,s),m=c?p.indexOf(c):-1,f=(r=(i=n[m])===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null,u=(l=(a=n[m+1])===null||a===void 0?void 0:a.id)!==null&&l!==void 0?l:null;return[f,u]}function as({committedValuesRef:e,eagerValuesRef:t,groupId:n,layout:s,panelDataArray:r,panelGroupElement:i,setLayout:l}){d.useRef({didWarnAboutMissingResizeHandle:!1}),de(()=>{if(!i)return;const a=Ne(n,i);for(let c=0;c<r.length-1;c++){const{valueMax:p,valueMin:m,valueNow:f}=ss({layout:s,panelsArray:r,pivotIndices:[c,c+1]}),u=a[c];if(u!=null){const h=r[c];j(h,`No panel data found for index "${c}"`),u.setAttribute("aria-controls",h.id),u.setAttribute("aria-valuemax",""+Math.round(p)),u.setAttribute("aria-valuemin",""+Math.round(m)),u.setAttribute("aria-valuenow",f!=null?""+Math.round(f):"")}}return()=>{a.forEach((c,p)=>{c.removeAttribute("aria-controls"),c.removeAttribute("aria-valuemax"),c.removeAttribute("aria-valuemin"),c.removeAttribute("aria-valuenow")})}},[n,s,r,i]),d.useEffect(()=>{if(!i)return;const a=t.current;j(a,"Eager values not found");const{panelDataArray:c}=a,p=dn(n,i);j(p!=null,`No group found for id "${n}"`);const m=Ne(n,i);j(m,`No resize handles found for group id "${n}"`);const f=m.map(u=>{const h=u.getAttribute($.resizeHandleId);j(h,"Resize handle element has no handle id attribute");const[v,I]=is(n,h,c,i);if(v==null||I==null)return()=>{};const R=k=>{if(!k.defaultPrevented)switch(k.key){case"Enter":{k.preventDefault();const T=c.findIndex(B=>B.id===v);if(T>=0){const B=c[T];j(B,`No panel data found for index ${T}`);const H=s[T],{collapsedSize:q=0,collapsible:N,minSize:P=0}=B.constraints;if(H!=null&&N){const J=Ie({delta:X(H,q)?P-q:q-H,initialLayout:s,panelConstraints:c.map(te=>te.constraints),pivotIndices:un(n,h,i),prevLayout:s,trigger:"keyboard"});s!==J&&l(J)}}break}}};return u.addEventListener("keydown",R),()=>{u.removeEventListener("keydown",R)}});return()=>{f.forEach(u=>u())}},[i,e,t,n,s,r,l])}function Nt(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function fn(e,t){const n=e==="horizontal",{x:s,y:r}=Oe(t);return n?s:r}function ls(e,t,n,s,r){const i=n==="horizontal",l=Xe(t,r);j(l,`No resize handle element found for id "${t}"`);const a=l.getAttribute($.groupId);j(a,"Resize handle element has no group id attribute");let{initialCursorPosition:c}=s;const p=fn(n,e),m=dn(a,r);j(m,`No group element found for id "${a}"`);const f=m.getBoundingClientRect(),u=i?f.width:f.height;return(p-c)/u*100}function cs(e,t,n,s,r,i){if(Qt(e)){const l=n==="horizontal";let a=0;e.shiftKey?a=100:r!=null?a=r:a=10;let c=0;switch(e.key){case"ArrowDown":c=l?0:a;break;case"ArrowLeft":c=l?-a:0;break;case"ArrowRight":c=l?a:0;break;case"ArrowUp":c=l?0:-a;break;case"End":c=100;break;case"Home":c=-100;break}return c}else return s==null?0:ls(e,t,n,s,i)}function us({panelDataArray:e}){const t=Array(e.length),n=e.map(i=>i.constraints);let s=0,r=100;for(let i=0;i<e.length;i++){const l=n[i];j(l,`Panel constraints not found for index ${i}`);const{defaultSize:a}=l;a!=null&&(s++,t[i]=a,r-=a)}for(let i=0;i<e.length;i++){const l=n[i];j(l,`Panel constraints not found for index ${i}`);const{defaultSize:a}=l;if(a!=null)continue;const c=e.length-s,p=r/c;s++,t[i]=p,r-=p}return t}function xe(e,t,n){t.forEach((s,r)=>{const i=e[r];j(i,`Panel data not found for index ${r}`);const{callbacks:l,constraints:a,id:c}=i,{collapsedSize:p=0,collapsible:m}=a,f=n[c];if(f==null||s!==f){n[c]=s;const{onCollapse:u,onExpand:h,onResize:v}=l;v&&v(s,f),m&&(u||h)&&(h&&(f==null||ne(f,p))&&!ne(s,p)&&h(),u&&(f==null||!ne(f,p))&&ne(s,p)&&u())}})}function Le(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function ds({defaultSize:e,dragState:t,layout:n,panelData:s,panelIndex:r,precision:i=3}){const l=n[r];let a;return l==null?a=e!=null?e.toPrecision(i):"1":s.length===1?a="1":a=l.toPrecision(i),{flexBasis:0,flexGrow:a,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function fs(e,t=10){let n=null;return(...r)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...r)},t)}}function Tt(e){try{if(typeof localStorage<"u")e.getItem=t=>localStorage.getItem(t),e.setItem=(t,n)=>{localStorage.setItem(t,n)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),e.getItem=()=>null,e.setItem=()=>{}}}function pn(e){return`react-resizable-panels:${e}`}function mn(e){return e.map(t=>{const{constraints:n,id:s,idIsFromProps:r,order:i}=t;return r?s:i?`${i}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((t,n)=>t.localeCompare(n)).join(",")}function xn(e,t){try{const n=pn(e),s=t.getItem(n);if(s){const r=JSON.parse(s);if(typeof r=="object"&&r!=null)return r}}catch{}return null}function ps(e,t,n){var s,r;const i=(s=xn(e,n))!==null&&s!==void 0?s:{},l=mn(t);return(r=i[l])!==null&&r!==void 0?r:null}function ms(e,t,n,s,r){var i;const l=pn(e),a=mn(t),c=(i=xn(e,r))!==null&&i!==void 0?i:{};c[a]={expandToSizes:Object.fromEntries(n.entries()),layout:s};try{r.setItem(l,JSON.stringify(c))}catch(p){console.error(p)}}function At({layout:e,panelConstraints:t}){const n=[...e],s=n.reduce((i,l)=>i+l,0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map(i=>`${i}%`).join(", ")}`);if(!X(s,100)&&n.length>0)for(let i=0;i<t.length;i++){const l=n[i];j(l!=null,`No layout data found for index ${i}`);const a=100/s*l;n[i]=a}let r=0;for(let i=0;i<t.length;i++){const l=n[i];j(l!=null,`No layout data found for index ${i}`);const a=ge({panelConstraints:t,panelIndex:i,size:l});l!=a&&(r+=l-a,n[i]=a)}if(!X(r,0))for(let i=0;i<t.length;i++){const l=n[i];j(l!=null,`No layout data found for index ${i}`);const a=l+r,c=ge({panelConstraints:t,panelIndex:i,size:a});if(l!==c&&(r-=c-l,n[i]=c,X(r,0)))break}return n}const xs=100,Re={getItem:e=>(Tt(Re),Re.getItem(e)),setItem:(e,t)=>{Tt(Re),Re.setItem(e,t)}},$t={};function hn({autoSaveId:e=null,children:t,className:n="",direction:s,forwardedRef:r,id:i=null,onLayout:l=null,keyboardResizeBy:a=null,storage:c=Re,style:p,tagName:m="div",...f}){const u=ct(i),h=d.useRef(null),[v,I]=d.useState(null),[R,k]=d.useState([]),T=ns(),B=d.useRef({}),H=d.useRef(new Map),q=d.useRef(0),N=d.useRef({autoSaveId:e,direction:s,dragState:v,id:u,keyboardResizeBy:a,onLayout:l,storage:c}),P=d.useRef({layout:R,panelDataArray:[],panelDataArrayChanged:!1});d.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),d.useImperativeHandle(r,()=>({getId:()=>N.current.id,getLayout:()=>{const{layout:x}=P.current;return x},setLayout:x=>{const{onLayout:S}=N.current,{layout:C,panelDataArray:b}=P.current,y=At({layout:x,panelConstraints:b.map(z=>z.constraints)});Nt(C,y)||(k(y),P.current.layout=y,S&&S(y),xe(b,y,B.current))}}),[]),de(()=>{N.current.autoSaveId=e,N.current.direction=s,N.current.dragState=v,N.current.id=u,N.current.onLayout=l,N.current.storage=c}),as({committedValuesRef:N,eagerValuesRef:P,groupId:u,layout:R,panelDataArray:P.current.panelDataArray,setLayout:k,panelGroupElement:h.current}),d.useEffect(()=>{const{panelDataArray:x}=P.current;if(e){if(R.length===0||R.length!==x.length)return;let S=$t[e];S==null&&(S=fs(ms,xs),$t[e]=S);const C=[...x],b=new Map(H.current);S(e,C,b,R,c)}},[e,R,c]),d.useEffect(()=>{});const J=d.useCallback(x=>{const{onLayout:S}=N.current,{layout:C,panelDataArray:b}=P.current;if(x.constraints.collapsible){const y=b.map(Y=>Y.constraints),{collapsedSize:z=0,panelSize:E,pivotIndices:M}=le(b,x,C);if(j(E!=null,`Panel size not found for panel "${x.id}"`),!ne(E,z)){H.current.set(x.id,E);const Q=he(b,x)===b.length-1?E-z:z-E,A=Ie({delta:Q,initialLayout:C,panelConstraints:y,pivotIndices:M,prevLayout:C,trigger:"imperative-api"});Le(C,A)||(k(A),P.current.layout=A,S&&S(A),xe(b,A,B.current))}}},[]),te=d.useCallback((x,S)=>{const{onLayout:C}=N.current,{layout:b,panelDataArray:y}=P.current;if(x.constraints.collapsible){const z=y.map(K=>K.constraints),{collapsedSize:E=0,panelSize:M=0,minSize:Y=0,pivotIndices:Q}=le(y,x,b),A=S??Y;if(ne(M,E)){const K=H.current.get(x.id),je=K!=null&&K>=A?K:A,Je=he(y,x)===y.length-1?M-je:je-M,O=Ie({delta:Je,initialLayout:b,panelConstraints:z,pivotIndices:Q,prevLayout:b,trigger:"imperative-api"});Le(b,O)||(k(O),P.current.layout=O,C&&C(O),xe(y,O,B.current))}}},[]),W=d.useCallback(x=>{const{layout:S,panelDataArray:C}=P.current,{panelSize:b}=le(C,x,S);return j(b!=null,`Panel size not found for panel "${x.id}"`),b},[]),F=d.useCallback((x,S)=>{const{panelDataArray:C}=P.current,b=he(C,x);return ds({defaultSize:S,dragState:v,layout:R,panelData:C,panelIndex:b})},[v,R]),L=d.useCallback(x=>{const{layout:S,panelDataArray:C}=P.current,{collapsedSize:b=0,collapsible:y,panelSize:z}=le(C,x,S);return j(z!=null,`Panel size not found for panel "${x.id}"`),y===!0&&ne(z,b)},[]),ie=d.useCallback(x=>{const{layout:S,panelDataArray:C}=P.current,{collapsedSize:b=0,collapsible:y,panelSize:z}=le(C,x,S);return j(z!=null,`Panel size not found for panel "${x.id}"`),!y||fe(z,b)>0},[]),G=d.useCallback(x=>{const{panelDataArray:S}=P.current;S.push(x),S.sort((C,b)=>{const y=C.order,z=b.order;return y==null&&z==null?0:y==null?-1:z==null?1:y-z}),P.current.panelDataArrayChanged=!0,T()},[T]);de(()=>{if(P.current.panelDataArrayChanged){P.current.panelDataArrayChanged=!1;const{autoSaveId:x,onLayout:S,storage:C}=N.current,{layout:b,panelDataArray:y}=P.current;let z=null;if(x){const M=ps(x,y,C);M&&(H.current=new Map(Object.entries(M.expandToSizes)),z=M.layout)}z==null&&(z=us({panelDataArray:y}));const E=At({layout:z,panelConstraints:y.map(M=>M.constraints)});Nt(b,E)||(k(E),P.current.layout=E,S&&S(E),xe(y,E,B.current))}}),de(()=>{const x=P.current;return()=>{x.layout=[]}},[]);const D=d.useCallback(x=>{let S=!1;const C=h.current;return C&&window.getComputedStyle(C,null).getPropertyValue("direction")==="rtl"&&(S=!0),function(y){y.preventDefault();const z=h.current;if(!z)return()=>null;const{direction:E,dragState:M,id:Y,keyboardResizeBy:Q,onLayout:A}=N.current,{layout:K,panelDataArray:je}=P.current,{initialLayout:Ae}=M??{},Je=un(Y,x,z);let O=cs(y,x,E,M,Q,z);const ft=E==="horizontal";ft&&S&&(O=-O);const gn=je.map(yn=>yn.constraints),Ce=Ie({delta:O,initialLayout:Ae??K,panelConstraints:gn,pivotIndices:Je,prevLayout:K,trigger:Qt(y)?"keyboard":"mouse-or-touch"}),pt=!Le(K,Ce);(en(y)||tn(y))&&q.current!=O&&(q.current=O,!pt&&O!==0?ft?et(x,O<0?on:sn):et(x,O<0?rn:an):et(x,0)),pt&&(k(Ce),P.current.layout=Ce,A&&A(Ce),xe(je,Ce,B.current))}},[]),U=d.useCallback((x,S)=>{const{onLayout:C}=N.current,{layout:b,panelDataArray:y}=P.current,z=y.map(K=>K.constraints),{panelSize:E,pivotIndices:M}=le(y,x,b);j(E!=null,`Panel size not found for panel "${x.id}"`);const Q=he(y,x)===y.length-1?E-S:S-E,A=Ie({delta:Q,initialLayout:b,panelConstraints:z,pivotIndices:M,prevLayout:b,trigger:"imperative-api"});Le(b,A)||(k(A),P.current.layout=A,C&&C(A),xe(y,A,B.current))},[]),be=d.useCallback((x,S)=>{const{layout:C,panelDataArray:b}=P.current,{collapsedSize:y=0,collapsible:z}=S,{collapsedSize:E=0,collapsible:M,maxSize:Y=100,minSize:Q=0}=x.constraints,{panelSize:A}=le(b,x,C);A!=null&&(z&&M&&ne(A,y)?ne(y,E)||U(x,E):A<Q?U(x,Q):A>Y&&U(x,Y))},[U]),we=d.useCallback((x,S)=>{const{direction:C}=N.current,{layout:b}=P.current;if(!h.current)return;const y=Xe(x,h.current);j(y,`Drag handle element not found for id "${x}"`);const z=fn(C,S);I({dragHandleId:x,dragHandleRect:y.getBoundingClientRect(),initialCursorPosition:z,initialLayout:b})},[]),Se=d.useCallback(()=>{I(null)},[]),Te=d.useCallback(x=>{const{panelDataArray:S}=P.current,C=he(S,x);C>=0&&(S.splice(C,1),delete B.current[x.id],P.current.panelDataArrayChanged=!0,T())},[T]),me=d.useMemo(()=>({collapsePanel:J,direction:s,dragState:v,expandPanel:te,getPanelSize:W,getPanelStyle:F,groupId:u,isPanelCollapsed:L,isPanelExpanded:ie,reevaluatePanelConstraints:be,registerPanel:G,registerResizeHandle:D,resizePanel:U,startDragging:we,stopDragging:Se,unregisterPanel:Te,panelGroupElement:h.current}),[J,v,s,te,W,F,u,L,ie,be,G,D,U,we,Se,Te]),ze={display:"flex",flexDirection:s==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return d.createElement(Ue.Provider,{value:me},d.createElement(m,{...f,children:t,className:n,id:i,ref:h,style:{...ze,...p},[$.group]:"",[$.groupDirection]:s,[$.groupId]:u}))}const rt=d.forwardRef((e,t)=>d.createElement(hn,{...e,forwardedRef:t}));hn.displayName="PanelGroup";rt.displayName="forwardRef(PanelGroup)";function he(e,t){return e.findIndex(n=>n===t||n.id===t.id)}function le(e,t,n){const s=he(e,t),i=s===e.length-1?[s-1,s]:[s,s+1],l=n[s];return{...t.constraints,panelSize:l,pivotIndices:i}}function hs({disabled:e,handleId:t,resizeHandler:n,panelGroupElement:s}){d.useEffect(()=>{if(e||n==null||s==null)return;const r=Xe(t,s);if(r==null)return;const i=l=>{if(!l.defaultPrevented)switch(l.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{l.preventDefault(),n(l);break}case"F6":{l.preventDefault();const a=r.getAttribute($.groupId);j(a,`No group element found for id "${a}"`);const c=Ne(a,s),p=cn(a,t,s);j(p!==null,`No resize element found for id "${t}"`);const m=l.shiftKey?p>0?p-1:c.length-1:p+1<c.length?p+1:0;c[m].focus();break}}};return r.addEventListener("keydown",i),()=>{r.removeEventListener("keydown",i)}},[s,e,t,n])}function it({children:e=null,className:t="",disabled:n=!1,hitAreaMargins:s,id:r,onBlur:i,onClick:l,onDragging:a,onFocus:c,onPointerDown:p,onPointerUp:m,style:f={},tabIndex:u=0,tagName:h="div",...v}){var I,R;const k=d.useRef(null),T=d.useRef({onClick:l,onDragging:a,onPointerDown:p,onPointerUp:m});d.useEffect(()=>{T.current.onClick=l,T.current.onDragging=a,T.current.onPointerDown=p,T.current.onPointerUp=m});const B=d.useContext(Ue);if(B===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:H,groupId:q,registerResizeHandle:N,startDragging:P,stopDragging:J,panelGroupElement:te}=B,W=ct(r),[F,L]=d.useState("inactive"),[ie,G]=d.useState(!1),[D,U]=d.useState(null),be=d.useRef({state:F});de(()=>{be.current.state=F}),d.useEffect(()=>{if(n)U(null);else{const me=N(W);U(()=>me)}},[n,W,N]);const we=(I=s?.coarse)!==null&&I!==void 0?I:15,Se=(R=s?.fine)!==null&&R!==void 0?R:5;d.useEffect(()=>{if(n||D==null)return;const me=k.current;j(me,"Element ref not attached");let ze=!1;return es(W,me,H,{coarse:we,fine:Se},(S,C,b)=>{if(!C){L("inactive");return}switch(S){case"down":{L("drag"),ze=!1,j(b,'Expected event to be defined for "down" action'),P(W,b);const{onDragging:y,onPointerDown:z}=T.current;y?.(!0),z?.();break}case"move":{const{state:y}=be.current;ze=!0,y!=="drag"&&L("hover"),j(b,'Expected event to be defined for "move" action'),D(b);break}case"up":{L("hover"),J();const{onClick:y,onDragging:z,onPointerUp:E}=T.current;z?.(!1),E?.(),ze||y?.();break}}})},[we,H,n,Se,N,W,D,P,J]),hs({disabled:n,handleId:W,resizeHandler:D,panelGroupElement:te});const Te={touchAction:"none",userSelect:"none"};return d.createElement(h,{...v,children:e,className:t,id:r,onBlur:()=>{G(!1),i?.()},onFocus:()=>{G(!0),c?.()},ref:k,role:"separator",style:{...Te,...f},tabIndex:u,[$.groupDirection]:H,[$.groupId]:q,[$.resizeHandle]:"",[$.resizeHandleActive]:F==="drag"?"pointer":ie?"keyboard":void 0,[$.resizeHandleEnabled]:!n,[$.resizeHandleId]:W,[$.resizeHandleState]:F})}it.displayName="PanelResizeHandle";const js=()=>(Fn(),Un(),o.jsxs(o.Fragment,{children:[o.jsx("title",{children:"Hoh Editor"}),o.jsxs(rt,{direction:"horizontal",className:"w-full h-full",children:[o.jsx(Pe,{children:o.jsxs(rt,{direction:"vertical",children:[o.jsx(Pe,{id:"editingArea",children:o.jsx(jo,{children:o.jsx(zo,{children:o.jsx(Fo,{})})})}),o.jsx(it,{className:"scale-editor h-1 bg-metallicBlueHalfbrite hover:border-moss hover:bg-moss border-t-[calc(1px*var(--scale))] border-metallicBlue"}),o.jsx(Pe,{defaultSize:25,minSize:10,id:"jsonEditor",className:"text-white",collapsible:!0,children:"json editor here"})]})}),o.jsx(it,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-l-[calc(1px*var(--scale))] border-metallicBlue"}),o.jsx(Pe,{id:"toolbar",defaultSize:20,maxSize:33,minSize:10,children:o.jsx(wo,{})})]})]}));export{js as default};
