import{j as o,r as d,R as hn}from"./index-DOLpP-MY.js";import{r as ve,S as Tt,ax as $t,a7 as ue,ay as At,B as _,C as gn,z as yn,f as vn,L as Lt,a8 as ce,az as bn,a6 as ft,aA as wn,aB as Mt,P as rt,aC as Sn,Z as Bt,aD as zn,aE as Je,c as jn,e as pt,aF as Cn,aG as Pn,aH as kn,R as _t,aI as Rn,au as In,aJ as En,I as Ke,aK as De,ah as mt,o as Nn,aL as Tn,am as $n,aM as An,aN as Ln,aO as Mn,aP as Bn,aQ as _n}from"./App-B9nvoZeW.js";import{B as Ht,g as Hn,h as Dn,i as Gn,j as Dt,C as Fn,R as Un,S as On}from"./RoomSelect-k7ktYkE0.js";import{useAppSelectorWithLevelEditorSlice as ee,changeGridResolution as Wn,selectTool as Me,setTool as Gt,selectCurrentEditingRoomColour as Xn,changeRoomColour as xt,selectCurrentEditingRoomScenery as Jn,changeRoomScenery as Kn,selectCanUndo as Vn,selectCanRedo as Zn,undo as Ft,redo as Ut,changeToRoom as qn,selectCurrentEditingRoomJson as ht,setSelectedItemInRoom as Yn,applyToolToRoomJson as Qn,deleteSelected as eo,selectSelectedJsonItemIds as to}from"./levelEditorSlice-BkchzKJT.js";import{c as no,A as oo,s as so,a as ro,R as io,i as ao,z as lo,b as co,p as Ot}from"./stopAppAutoRendering-CtWpJHCe.js";import"./Graphics-DlhlWwDQ.js";import"./changeCharacterRoom-B365KppR.js";const Wt=e=>e,uo=()=>{const e=ve();return o.jsx(Tt,{className:"w-full",label:"res",value:ee(t=>t.levelEditor.halfGridResolution),onClick:(t,n)=>{e(Wn(n))},falseLabel:"Blocks",trueLabel:"Halves"})},tt="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",Be=({className:e,onClick:t,children:n,disabled:s=!1,isCurrentTool:r=!1})=>o.jsx(Ht,{disabled:s,"data-iscurrenttool":r,className:`active:pt-oneScaledPix ${tt} gap-0 inline-flex overflow-hidden ${r?"bg-pastelBlue":""} ${s?"bg-midGrey text-lightGrey":""} ${e??""}`,onClick:t,children:n}),h=({itemTool:e,children:t,className:n})=>{const s=ee(Me),r=$t(s?.type==="item"&&s.item,e);return o.jsx(Be,{isCurrentTool:r,className:n,onClick:()=>ue.dispatch(Gt({type:"item",item:e})),children:t})},Pe=({children:e})=>{const[t,n]=d.useState(!1),[s,r]=d.useState(0),i=e[s];return o.jsxs(Hn,{open:t,onOpenChange:n,children:[o.jsxs("div",{className:At(tt,"relative",{"drop-shadow-oneBlock z-popups":t}),children:[i,o.jsx(Dn,{asChild:!0,children:o.jsx(Ht,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:o.jsx(_,{className:"pl-oneScaledPix",children:t?"X":"â¬‡"})})})]}),o.jsx(Gn,{children:o.jsx(gn,{scaleFactor:2,children:o.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:e.map((a,l)=>l===s?null:o.jsx("div",{className:tt,onClick:()=>{r(l),n(!1)},children:a},l))})})})]})},fo=()=>{const t=ee(Me)?.type==="pointer";return o.jsx(Be,{onClick:()=>ue.dispatch(Gt({type:"pointer"})),isCurrentTool:t,children:o.jsx("span",{className:"sprite texture-hud.char.â†– relative"})})},gt=e=>{const{main:t}=no[e].basic;return{backgroundColor:t.basic.toHex(),borderColor:t.dimmed.toHex()}};function po(){const e=ve(),t=ee(Xn);return o.jsxs(o.Fragment,{children:[o.jsx(Dt,{value:t.hue,onSelect:n=>{e(xt({hue:n}))},values:yn,disableCommandInput:!0,OptionCommandItem:({value:n,onSelect:s})=>o.jsx(Fn,{value:n,className:"border-l-3 h-2 w-full p-0",style:gt(n),onSelect:s}),triggerButtonLabel:"colour",triggerButtonClassName:At("w-full",`${t.hue==="white"?"text-pureBlack":"text-white"}`),triggerButtonStyle:gt(t.hue)}),o.jsx(Tt,{className:"w-full",label:"shade",value:t.shade==="basic",onClick:(n,s)=>{e(xt({shade:s?"basic":"dimmed"}))},falseLabel:"dim",trueLabel:"basic"})]})}function mo(){const e=ve(),t=ee(Jn);return o.jsx(Dt,{value:t,onSelect:n=>{e(Kn(n))},values:vn,disableCommandInput:!0,triggerButtonClassName:"w-full",triggerButtonLabel:t})}const yt="[button:not(:disabled):hover_&]:hidden mt-quarter",vt="hidden [button:not(:disabled):hover_&]:inline mt-quarter",bt="hidden [button:not(:disabled):hover_&]:inline",xo=()=>{const e=ve(),t=ee(Vn),n=ee(Zn);return o.jsxs(o.Fragment,{children:[o.jsxs(Be,{disabled:!t,className:"flex-col",onClick:()=>{e(Ft())},children:[o.jsx(_,{className:yt,children:"â¬…"}),o.jsx(_,{className:vt,children:"Un"}),o.jsx(_,{className:bt,children:"do"})]}),o.jsxs(Be,{disabled:!n,className:"flex-col",onClick:()=>{e(Ut())},children:[o.jsx(_,{className:yt,children:"âž¡"}),o.jsx(_,{className:vt,children:"Re"}),o.jsx(_,{className:bt,children:"do"})]})]})},w=Wt("[button:not([data-iscurrenttool=true]):not(:hover)_&]:sprite-revert-to-two-tone"),V=Wt("flex flex-wrap gap-oneScaledPix w-full"),ae=({topClasses:e,bottomClasses:t="texture-headlessBase"})=>o.jsxs("div",{className:"relative w-full h-full",children:[o.jsx("span",{className:`sprite absolute top-[calc(9px*var(--scale))] left-0 ${t} ${w}`}),o.jsx("span",{className:`sprite absolute top-[calc(-3px*var(--scale))] left-0 ${e} ${w}`})]}),oe=({iconClasses:e,text:t})=>o.jsxs("div",{className:"relative w-full h-full",children:[o.jsx("span",{className:`sprite absolute top-0 left-0 ${e} ${w}`}),o.jsx(_,{className:"bg-metallicBlueHalfbrite absolute top-0 right-0 pl-oneScaledPix block",children:t})]}),ho=()=>{const e=ee(n=>n.levelEditor.campaignInProgress),t=ve();return o.jsxs("div",{className:"scale-editor flex w-full h-full box-content text-white bg-metallicBlueHalfbrite py-1 gap-1 flex-wrap justify-start overflow-auto",children:[o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Campaign"}),o.jsx(Un,{campaign:e,onRoomSelect:n=>{t(qn(n))}})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Room"}),o.jsx(mo,{}),o.jsx(po,{})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Edit"}),o.jsx(fo,{}),o.jsx(xo,{}),o.jsx(uo,{})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Monsters"}),o.jsx(h,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},children:o.jsx("span",{className:`sprite texture-dalek.1 [button:hover_&]:texture-animated-dalek" ${w}`})}),o.jsx(h,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},children:o.jsx(ae,{topClasses:"texture-cyberman.towards [button:hover_&]:texture-cyberman.right",bottomClasses:"texture-bubbles.cold.2 [button:hover_&]:texture-animated-bubbles.cold"})}),o.jsx(h,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-skiHead.greenAndPink.towards [button:hover_&]:texture-skiHead.greenAndPink.right ${w}`})}),o.jsx(h,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:o.jsx("span",{className:`sprite texture-helicopterBug.1 [button:hover_&]:texture-animated-helicopterBug ${w}`})}),o.jsx(h,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-turtle.towards.1 [button:hover_&]:texture-animated-turtle.right ${w}`})}),o.jsx(h,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},children:o.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase.all ${w}`})}),o.jsx(h,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},children:o.jsx(ae,{topClasses:"texture-computerBot.towards [button:hover_&]:texture-computerBot.right"})}),o.jsx(h,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:o.jsx(ae,{topClasses:"texture-monkey.towards [button:hover_&]:texture-monkey.right"})}),o.jsx(h,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},children:o.jsx(ae,{topClasses:"texture-elephant.towards [button:hover_&]:texture-elephant.right"})}),o.jsx(h,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-elephant.towards [button:hover_&]:texture-elephant.right ${w}`})}),o.jsx(h,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",children:o.jsx(ae,{topClasses:"texture-ball",bottomClasses:"texture-bubbles.cold.2 [button:hover_&]:texture-animated-bubbles.cold"})}),o.jsx(h,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},children:o.jsx("span",{className:`sprite texture-bubbles.cold.2 [button:hover_&]:texture-animated-bubbles.cold ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Blocks"}),o.jsx(h,{itemTool:{type:"block",config:{style:"artificial"}},children:o.jsx("span",{className:`sprite texture-block.artificial ${w}`})}),o.jsx(h,{itemTool:{type:"block",config:{style:"organic"}},children:o.jsx("span",{className:`sprite texture-block.organic ${w}`})}),o.jsx(h,{itemTool:{type:"block",config:{style:"tower"}},children:o.jsx("span",{className:`sprite texture-tower ${w}`})}),o.jsx(h,{itemTool:{type:"block",config:{style:"book"}},children:o.jsx("span",{className:`sprite texture-book.x ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Pickups"}),o.jsxs(Pe,{children:[o.jsx(h,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:o.jsx(oe,{iconClasses:"texture-whiteRabbit",text:"2"})}),o.jsx(h,{itemTool:{type:"pickup",config:{gives:"shield"}},children:o.jsx(oe,{iconClasses:"texture-whiteRabbit",text:"ðŸ›¡"})}),o.jsx(h,{itemTool:{type:"pickup",config:{gives:"jumps"}},children:o.jsx(oe,{iconClasses:"texture-whiteRabbit",text:"â™¨"})}),o.jsx(h,{itemTool:{type:"pickup",config:{gives:"fast"}},children:o.jsx(oe,{iconClasses:"texture-whiteRabbit",text:"âš¡"})})]}),o.jsx(h,{itemTool:{type:"pickup",config:{gives:"bag"}},children:o.jsx("span",{className:`sprite texture-bag ${w}`})}),o.jsx(h,{itemTool:{type:"pickup",config:{gives:"hooter"}},children:o.jsx("span",{className:`sprite texture-hooter ${w}`})}),o.jsx(h,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:o.jsx("span",{className:`sprite texture-doughnuts ${w}`})}),o.jsx(h,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:o.jsx("span",{className:`sprite texture-crown.blacktooth ${w}`})}),o.jsx(h,{itemTool:{type:"pickup",config:{gives:"scroll",page:"blacktooth"}},children:o.jsx("span",{className:`sprite texture-scroll ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"misc."}),o.jsxs(h,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[o.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift.static ${w} [button:active_&]:top-oneScaledPix`}),o.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift.1 [button:hover_&]:texture-animated-lift ${w} [button:active_&]:top-oneScaledPix`})]}),o.jsxs(Pe,{children:[o.jsx(h,{itemTool:{type:"barrier",config:{axis:"x"}},children:o.jsx("span",{className:`sprite texture-barrier.x ${w}`})}),o.jsx(h,{itemTool:{type:"barrier",config:{axis:"y"}},children:o.jsx("span",{className:`sprite texture-barrier.y ${w}`})})]}),o.jsxs(Pe,{children:[o.jsx(h,{itemTool:{type:"conveyor",config:{direction:"away"}},children:o.jsx(oe,{iconClasses:"texture-conveyor.y.1 [button:hover_&]:texture-animated-conveyor.y",text:"â†—"})}),o.jsx(h,{itemTool:{type:"conveyor",config:{direction:"towards"}},children:o.jsx(oe,{iconClasses:"texture-conveyor.y.1 [button:hover_&]:texture-animated-reversed-conveyor.y",text:"â†™"})}),o.jsx(h,{itemTool:{type:"conveyor",config:{direction:"left"}},children:o.jsx(oe,{iconClasses:"texture-conveyor.x.1 [button:hover_&]:texture-animated-conveyor.x",text:"â†–"})}),o.jsx(h,{itemTool:{type:"conveyor",config:{direction:"right"}},children:o.jsx(oe,{iconClasses:"texture-conveyor.x.1 [button:hover_&]:texture-animated-reversed-conveyor.x",text:"â†˜"})})]}),o.jsx(h,{itemTool:{type:"teleporter",config:{toRoom:"(placeholder)",toPosition:Lt}},children:o.jsx("span",{className:`sprite texture-teleporter ${w}`})}),o.jsx(h,{itemTool:{type:"charles",config:ce},children:o.jsx(ae,{topClasses:"texture-charles.towards [button:hover_&]:texture-charles.right"})}),o.jsx(h,{itemTool:{type:"joystick",config:{controls:["(placeholder)"]}},children:o.jsx("span",{className:`sprite texture-joystick ${w}`})}),o.jsx(h,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:bn}},children:o.jsx("span",{className:`sprite texture-switch.left [button:hover_&]:texture-switch.right ${w}`})}),o.jsx(h,{itemTool:{type:"ball",config:ce},children:o.jsx("span",{className:`sprite texture-ball ${w}`})}),o.jsxs(Pe,{children:[o.jsx(h,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:o.jsx("span",{className:`sprite texture-cube ${w}`})}),o.jsx(h,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:o.jsx("span",{className:`sprite texture-drum ${w}`})}),o.jsx(h,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:o.jsx("span",{className:`sprite texture-sticks ${w}`})})]}),o.jsx(h,{itemTool:{type:"pushableBlock",config:{}},children:o.jsx("span",{className:`sprite texture-stepStool ${w}`})}),o.jsx(h,{itemTool:{type:"movingPlatform",config:{movement:"clockwise",activated:"on",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-sandwich ${w}`})}),o.jsx(h,{itemTool:{type:"spikes",config:ce},children:o.jsx("span",{className:`sprite texture-spikes ${w}`})}),o.jsxs(Pe,{children:[o.jsx(h,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},children:o.jsx("span",{className:`sprite texture-volcano.1 [button:hover_&]:texture-animated-volcano ${w}`})}),o.jsx(h,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},children:o.jsx("span",{className:`sprite texture-toaster.off ${w}`})})]}),o.jsx(h,{itemTool:{type:"slidingBlock",config:{style:"puck"}},children:o.jsx("span",{className:`sprite texture-puck ${w}`})}),o.jsx(h,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},children:o.jsx("span",{className:`sprite texture-spikyBall.1 [button:hover_&]:texture-spikyBall.2 ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Structure"}),o.jsx(h,{itemTool:{type:"door",config:{direction:"away",toRoom:"(placeholder)"}},children:o.jsx("span",{className:`sprite texture-door.frame.generic.x.whole ${w}`})}),o.jsx(h,{itemTool:{type:"wall",config:{direction:"away",tiles:["plain"]}},children:o.jsx("span",{className:`sprite texture-blacktooth.wall.plain.away ${w}`})}),o.jsx(h,{itemTool:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:{x:1,y:1}}},children:o.jsx("span",{className:`sprite texture-blacktooth.floor ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"Player"}),o.jsx(h,{itemTool:{type:"player",config:{which:"head"}},children:o.jsx("span",{className:`sprite texture-head.walking.towards.2 [button:hover_&]:texture-animated-head.walking.right ${w}`})}),o.jsx(h,{itemTool:{type:"player",config:{which:"heels"}},children:o.jsx("span",{className:`sprite texture-heels.walking.towards.2 [button:hover_&]:texture-animated-heels.walking.right ${w}`})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"NPCâ€™s"}),o.jsx(h,{itemTool:{type:"sceneryPlayer",config:{which:"head",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-head.walking.towards.2 [button:hover_&]:texture-animated-head.walking.right ${w}`})}),o.jsx(h,{itemTool:{type:"sceneryPlayer",config:{which:"heels",startDirection:"towards"}},children:o.jsx("span",{className:`sprite texture-heels.walking.towards.2 [button:hover_&]:texture-animated-heels.walking.right ${w}`})}),o.jsx(h,{itemTool:{type:"sceneryPlayer",config:{which:"headOverHeels",startDirection:"towards"}},children:o.jsx(ae,{topClasses:"texture-head.walking.towards.2 [button:hover_&]:texture-animated-head.walking.right",bottomClasses:"texture-heels.walking.towards.2 [button:hover_&]:texture-animated-heels.walking.right"})})]}),o.jsxs("div",{className:V,children:[o.jsx(_,{className:"w-full",children:"debug"}),o.jsx(On,{})]})]})},Xt=d.createContext(null),go=()=>{const[e,t]=d.useState(()=>ft({roomJson:ht(ue.getState()),roomPickupsCollected:ce,scrollsRead:ce,isNewGame:!0})),n=ee(ht);return d.useEffect(()=>{const s=ft({roomJson:n,roomPickupsCollected:ce,scrollsRead:ce,isNewGame:!0});t(s)},[n]),e},yo=({children:e})=>{const t=go();return o.jsx(Xt,{value:t,children:e})},Ge=()=>{const e=d.useContext(Xt);if(e===null)throw new Error("no room state in context, or no context");return e},Jt=d.createContext(null),vo=({children:e})=>{const[t,n]=d.useState(null);return d.useEffect(()=>{const s=new oo;return s.init({background:so.pureBlack,sharedTicker:!0}).then(()=>{ro(s),n(s)}),()=>{}},[]),t===null?null:o.jsx(Jt,{value:t,children:e})},pe=()=>d.useContext(Jt),bo=(e,t)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:t},soundSettings:{mute:!0},pixiRenderer:e,gameState:void 0,paused:!1,colourised:!0,upscale:Mt(ue.getState()),editor:!0}),wt=(e,t,n)=>new io({room:e,general:bo(t,n)}),wo=()=>{const{renderer:e}=pe(),t=wn();if(!e)throw new Error("this should never be falsey (typescript violation)");const n=Ge(),[s,r]=d.useState(()=>wt(n,e,t));return d.useEffect(()=>{const i=wt(n,e,t);return r(i),()=>{i.destroy()}},[n,e,t]),s},So=(e,t)=>{for(const n of t)Sn({room:e,item:n})},Ve=e=>{for(const t of rt(e.items))t.isCursorPreview&&delete e.items[t.id]};let zo=0;const Kt=(e,t,n)=>{if(e.face==="up")return Je(e.position);if(n.type==="door"){const r=t.items[e.itemId];if(r.type!=="wall")return;const{config:i,aabb:a,state:{position:l}}=r,c={x:1,y:1,...i.times},p=jn(pt(i.direction)),m=pt(i.direction);if(c[p]<2)return;const f=l[p],u=l[p]+a[p]-Cn,y=l.z,v=l.z+a.z-Pn,I={[p]:Math.max(Math.min(e.position[p],u),f),[m]:e.position[m],z:Math.max(Math.min(e.position.z,v),y)};return Je(I)}const s=kn[e.face];return _t(Je(e.position),s)},St=(e,t,n)=>{const s=[...rt(t.items).filter(c=>Bt(c)&&!c.isCursorPreview)],r=(c,p,m)=>{const f=Rn(`cursor/${zo++}`,{type:c,config:p,position:m},t.roomJson).toArray();return f.forEach(u=>{u.isCursorPreview=!0}),f},i=Kt(e,t,n);if(i===void 0)return;if(n.type==="door"){const c=t.items[e.itemId];if(c.type!=="wall")return;const p=c.config.direction;return r("door",{...n.config,direction:p},i)}const a=r(n.type,n.config,i);return a.some(c=>{const p=zn(c,s);return!ao(p)})?void 0:a},jo=({x:e,y:t})=>n=>{const{bottomCentre:s,topLeft:r,topRight:i}=Ot(n.state.position,n.aabb);return!(e<r.x||e>i.x||t<i.y-(i.x-e)/2||t<r.y-(e-r.x)/2||t>s.y-(e-s.x)/2||t>s.y-(s.x-e)/2)},Co=(e,{x:t,y:n},s)=>{if(s.type==="item"&&s.item.type==="door"&&e.type==="wall")return In(e.config.direction);const{bottomCentre:r,topLeft:i,topRight:a}=Ot(e.state.position,e.aabb);return n<i.y-(i.x-t)/2?n<a.y-(t-a.x)/2?"up":"right":t<r.x?"towards":"right"},zt=e=>e.fixedZIndex!==void 0,Po=e=>{if(e.every(zt))return e.toSorted((i,a)=>a.fixedZIndex-i.fixedZIndex).at(0);const t=e.filter(i=>!zt(i));if(t.length===0)return;if(t.length===1)return t[0];const n=Object.fromEntries(t.map(i=>[i.id,i])),s=lo(n),{order:r}=co(s,n);return n[r[0]]},ko=({state:{position:e},aabb:t},n,s,r,i)=>{let a=Lt,l;switch(n){case"up":a={z:t.z},l="xy";break;case"down":l="xy";break;case"towards":l="xz";break;case"away":a={y:t.y},l="xz";break;case"left":a={x:t.x},l="yz";break;case"right":l="yz";break;default:throw new Error('unexpected face "'+n+'"')}const c=En(s,_t(e,a),l),p=!i||r.type==="item"&&r.item.type==="door",m=p?Ke.w:Ke.w/2,f=Ke.h,u=p?0:m/2,y=f/2;return{x:l==="yz"?Math.round(c.x/m)*m:Math.floor((c.x-u)/m)*m,y:l==="xz"?Math.round(c.y/m)*m:Math.floor((c.y-u)/m)*m,z:l==="xy"?Math.round(c.z/f)*f:Math.floor((c.z+y)/f)*f}},Ro=e=>t=>{const n=Bt(t)&&!t.isCursorPreview;return e.type==="item"&&e.item.type==="door"?n&&t.type==="wall":n},Io=(e,t,n,s)=>{const r=Po(Array.from(rt(t.items).filter(Ro(n)).filter(jo(e))));if(r){const i=Co(r,e,n);return{itemId:r.id,face:i,position:ko(r,i,e,n,s)}}else return},Eo=(e,t)=>{const n=e.cssUpscale*e.gameEngineUpscale;return{x:t.x/n-e.gameEngineScreenSize.x/2,y:t.y/n-e.gameEngineScreenSize.y+16}},No=e=>{const t=pe(),n=De(Mt),s=ve(),r=Ge(),i=d.useRef(void 0);d.useEffect(()=>{if(t.stage.eventMode="none",e===null)return;const a=p=>{const m=Eo(n,p),f=ue.getState(),u=Me(f),y=Io(m,r,u,f.levelEditor.halfGridResolution);if(!$t(y,i.current))if(i.current=y,y!==void 0)switch(u.type){case"item":{const v=St(y,r,u.item);Ve(r),v!==void 0&&So(r,v);break}case"pointer":{Ve(r);const v=r.items[y.itemId]?.jsonItemId;r.editor={...r.editor,hoveredJsonItemId:v};break}}else Ve(r)},l=p=>{const m=Me(ue.getState());switch(m.type){case"item":{const f=i.current;if(f===void 0||St(f,r,m.item)===void 0)return;const y=r.items[f.itemId];s(Qn({blockPosition:Kt(f,r,m.item),pointedAtItem:{type:y.type,config:y.config,jsonItemId:y.jsonItemId}}));break}case"pointer":{const f=i.current;if(!f)return;const{jsonItemId:u}=r.items[f.itemId];s(Yn({jsonItemId:u,additive:p.ctrlKey||p.metaKey}));break}}},c=p=>{const m=p.key;(m==="Backspace"||m==="Delete")&&s(eo()),(m==="z"||m==="Z")&&ue.dispatch(p.shiftKey?Ut():Ft())};return e.addEventListener("mousemove",a),e.addEventListener("click",l),window.addEventListener("keyup",c),()=>{e.removeEventListener("mousemove",a),e.removeEventListener("click",l),window.removeEventListener("keyup",c)}},[t.stage,n,e,s,r])},To=e=>{const t=Ge(),n=pe();d.useEffect(()=>{let s=0;const r=({deltaMS:i})=>{if(e.destroyed)return;e.renderContext.room!==t&&console.warn("room renderer does not have the current room");const a=new Set(Nn(t.items));t.roomTime+=i,e.tick({deltaMS:i,movedItems:a,progression:s++}),n.render()};return mt.shared.add(r),()=>{mt.shared.remove(r)}},[e,t,n])},$o=e=>{const t=pe();d.useEffect(()=>{if(e)return e.appendChild(t.canvas),()=>{e.removeChild(t.canvas)}},[e,t])},Ao=()=>{const e=pe(),t=De(n=>n.upscale.upscale.gameEngineUpscale);e.stage.scale=t},Lo=()=>{const e=pe(),t=De(Tn);d.useEffect(()=>{e.renderer?.resize(t.x,t.y)},[e.renderer,t])},Mo=e=>{const t=pe(),[n]=d.useState(()=>new $n),s=De(An);d.useEffect(()=>{if(e.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return n.addChild(e.output.graphics),t.stage.addChild(n),()=>{t.stage.removeChild(n),n.removeChild(e.output.graphics)}},[e,t,n]),d.useEffect(()=>{n.x=s.x/2,n.y=s.y-16},[n,s])},Bo=()=>{const e=Ge(),t=ee(to);d.useEffect(()=>{e.editor||(e.editor={}),e.editor.selectedJsonItemId=t},[e,t])};Mn.defaultOptions.scaleMode="nearest";const _o=()=>{const e=wo(),[t,n]=d.useState(null);Lo(),Mo(e),To(e),No(t),$o(t),Ao(),Bo();const s=Ln();return o.jsx("div",{style:s,ref:n})},Fe=d.createContext(null);Fe.displayName="PanelGroupContext";const A={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},it=10,de=d.useLayoutEffect,jt=hn.useId,Ho=typeof jt=="function"?jt:()=>null;let Do=0;function at(e=null){const t=Ho(),n=d.useRef(e||t||null);return n.current===null&&(n.current=""+Do++),e??n.current}function Vt({children:e,className:t="",collapsedSize:n,collapsible:s,defaultSize:r,forwardedRef:i,id:a,maxSize:l,minSize:c,onCollapse:p,onExpand:m,onResize:f,order:u,style:y,tagName:v="div",...I}){const R=d.useContext(Fe);if(R===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:P,expandPanel:T,getPanelSize:M,getPanelStyle:H,groupId:q,isPanelCollapsed:N,reevaluatePanelConstraints:k,registerPanel:J,resizePanel:te,unregisterPanel:W}=R,F=at(a),L=d.useRef({callbacks:{onCollapse:p,onExpand:m,onResize:f},constraints:{collapsedSize:n,collapsible:s,defaultSize:r,maxSize:l,minSize:c},id:F,idIsFromProps:a!==void 0,order:u});d.useRef({didLogMissingDefaultSizeWarning:!1}),de(()=>{const{callbacks:G,constraints:D}=L.current,U={...D};L.current.id=F,L.current.idIsFromProps=a!==void 0,L.current.order=u,G.onCollapse=p,G.onExpand=m,G.onResize=f,D.collapsedSize=n,D.collapsible=s,D.defaultSize=r,D.maxSize=l,D.minSize=c,(U.collapsedSize!==D.collapsedSize||U.collapsible!==D.collapsible||U.maxSize!==D.maxSize||U.minSize!==D.minSize)&&k(L.current,U)}),de(()=>{const G=L.current;return J(G),()=>{W(G)}},[u,F,J,W]),d.useImperativeHandle(i,()=>({collapse:()=>{P(L.current)},expand:G=>{T(L.current,G)},getId(){return F},getSize(){return M(L.current)},isCollapsed(){return N(L.current)},isExpanded(){return!N(L.current)},resize:G=>{te(L.current,G)}}),[P,T,M,N,F,te]);const ie=H(L.current,r);return d.createElement(v,{...I,children:e,className:t,id:F,style:{...ie,...y},[A.groupId]:q,[A.panel]:"",[A.panelCollapsible]:s||void 0,[A.panelId]:F,[A.panelSize]:parseFloat(""+ie.flexGrow).toFixed(1)})}const ke=d.forwardRef((e,t)=>d.createElement(Vt,{...e,forwardedRef:t}));Vt.displayName="Panel";ke.displayName="forwardRef(Panel)";let nt=null,Le=-1,se=null;function Go(e,t){if(t){const n=(t&en)!==0,s=(t&tn)!==0,r=(t&nn)!==0,i=(t&on)!==0;if(n)return r?"se-resize":i?"ne-resize":"e-resize";if(s)return r?"sw-resize":i?"nw-resize":"w-resize";if(r)return"s-resize";if(i)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function Fo(){se!==null&&(document.head.removeChild(se),nt=null,se=null,Le=-1)}function Ze(e,t){var n,s;const r=Go(e,t);if(nt!==r){if(nt=r,se===null&&(se=document.createElement("style"),document.head.appendChild(se)),Le>=0){var i;(i=se.sheet)===null||i===void 0||i.removeRule(Le)}Le=(n=(s=se.sheet)===null||s===void 0?void 0:s.insertRule(`*{cursor: ${r} !important;}`))!==null&&n!==void 0?n:-1}}function Zt(e){return e.type==="keydown"}function qt(e){return e.type.startsWith("pointer")}function Yt(e){return e.type.startsWith("mouse")}function Ue(e){if(qt(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if(Yt(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}function Uo(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function Oo(e,t,n){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function Wo(e,t){if(e===t)throw new Error("Cannot compare node with itself");const n={a:kt(e),b:kt(t)};let s;for(;n.a.at(-1)===n.b.at(-1);)e=n.a.pop(),t=n.b.pop(),s=e;j(s,"Stacking order can only be calculated for elements with a common ancestor");const r={a:Pt(Ct(n.a)),b:Pt(Ct(n.b))};if(r.a===r.b){const i=s.childNodes,a={a:n.a.at(-1),b:n.b.at(-1)};let l=i.length;for(;l--;){const c=i[l];if(c===a.a)return 1;if(c===a.b)return-1}}return Math.sign(r.a-r.b)}const Xo=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function Jo(e){var t;const n=getComputedStyle((t=Qt(e))!==null&&t!==void 0?t:e).display;return n==="flex"||n==="inline-flex"}function Ko(e){const t=getComputedStyle(e);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||Jo(e))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||Xo.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function Ct(e){let t=e.length;for(;t--;){const n=e[t];if(j(n,"Missing node"),Ko(n))return n}return null}function Pt(e){return e&&Number(getComputedStyle(e).zIndex)||0}function kt(e){const t=[];for(;e;)t.push(e),e=Qt(e);return t}function Qt(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const en=1,tn=2,nn=4,on=8,Vo=Uo()==="coarse";let Z=[],ye=!1,re=new Map,Oe=new Map;const Ee=new Set;function Zo(e,t,n,s,r){var i;const{ownerDocument:a}=t,l={direction:n,element:t,hitAreaMargins:s,setResizeHandlerState:r},c=(i=re.get(a))!==null&&i!==void 0?i:0;return re.set(a,c+1),Ee.add(l),_e(),function(){var m;Oe.delete(e),Ee.delete(l);const f=(m=re.get(a))!==null&&m!==void 0?m:1;if(re.set(a,f-1),_e(),f===1&&re.delete(a),Z.includes(l)){const u=Z.indexOf(l);u>=0&&Z.splice(u,1),ct(),r("up",!0,null)}}}function qo(e){const{target:t}=e,{x:n,y:s}=Ue(e);ye=!0,lt({target:t,x:n,y:s}),_e(),Z.length>0&&(He("down",e),e.preventDefault(),sn(t)||e.stopImmediatePropagation())}function qe(e){const{x:t,y:n}=Ue(e);if(ye&&e.buttons===0&&(ye=!1,He("up",e)),!ye){const{target:s}=e;lt({target:s,x:t,y:n})}He("move",e),ct(),Z.length>0&&e.preventDefault()}function Ye(e){const{target:t}=e,{x:n,y:s}=Ue(e);Oe.clear(),ye=!1,Z.length>0&&(e.preventDefault(),sn(t)||e.stopImmediatePropagation()),He("up",e),lt({target:t,x:n,y:s}),ct(),_e()}function sn(e){let t=e;for(;t;){if(t.hasAttribute(A.resizeHandle))return!0;t=t.parentElement}return!1}function lt({target:e,x:t,y:n}){Z.splice(0);let s=null;(e instanceof HTMLElement||e instanceof SVGElement)&&(s=e),Ee.forEach(r=>{const{element:i,hitAreaMargins:a}=r,l=i.getBoundingClientRect(),{bottom:c,left:p,right:m,top:f}=l,u=Vo?a.coarse:a.fine;if(t>=p-u&&t<=m+u&&n>=f-u&&n<=c+u){if(s!==null&&document.contains(s)&&i!==s&&!i.contains(s)&&!s.contains(i)&&Wo(s,i)>0){let v=s,I=!1;for(;v&&!v.contains(i);){if(Oo(v.getBoundingClientRect(),l)){I=!0;break}v=v.parentElement}if(I)return}Z.push(r)}})}function Qe(e,t){Oe.set(e,t)}function ct(){let e=!1,t=!1;Z.forEach(s=>{const{direction:r}=s;r==="horizontal"?e=!0:t=!0});let n=0;Oe.forEach(s=>{n|=s}),e&&t?Ze("intersection",n):e?Ze("horizontal",n):t?Ze("vertical",n):Fo()}let et;function _e(){var e;(e=et)===null||e===void 0||e.abort(),et=new AbortController;const t={capture:!0,signal:et.signal};Ee.size&&(ye?(Z.length>0&&re.forEach((n,s)=>{const{body:r}=s;n>0&&(r.addEventListener("contextmenu",Ye,t),r.addEventListener("pointerleave",qe,t),r.addEventListener("pointermove",qe,t))}),re.forEach((n,s)=>{const{body:r}=s;r.addEventListener("pointerup",Ye,t),r.addEventListener("pointercancel",Ye,t)})):re.forEach((n,s)=>{const{body:r}=s;n>0&&(r.addEventListener("pointerdown",qo,t),r.addEventListener("pointermove",qe,t))}))}function He(e,t){Ee.forEach(n=>{const{setResizeHandlerState:s}=n,r=Z.includes(n);s(e,r,t)})}function Yo(){const[e,t]=d.useState(0);return d.useCallback(()=>t(n=>n+1),[])}function j(e,t){if(!e)throw console.error(t),Error(t)}function fe(e,t,n=it){return e.toFixed(n)===t.toFixed(n)?0:e>t?1:-1}function ne(e,t,n=it){return fe(e,t,n)===0}function X(e,t,n){return fe(e,t,n)===0}function Qo(e,t,n){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){const r=e[s],i=t[s];if(!X(r,i,n))return!1}return!0}function ge({panelConstraints:e,panelIndex:t,size:n}){const s=e[t];j(s!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:r=0,collapsible:i,maxSize:a=100,minSize:l=0}=s;if(fe(n,l)<0)if(i){const c=(r+l)/2;fe(n,c)<0?n=r:n=l}else n=l;return n=Math.min(a,n),n=parseFloat(n.toFixed(it)),n}function Re({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:s,prevLayout:r,trigger:i}){if(X(e,0))return t;const a=[...t],[l,c]=s;j(l!=null,"Invalid first pivot index"),j(c!=null,"Invalid second pivot index");let p=0;if(i==="keyboard"){{const f=e<0?c:l,u=n[f];j(u,`Panel constraints not found for index ${f}`);const{collapsedSize:y=0,collapsible:v,minSize:I=0}=u;if(v){const R=t[f];if(j(R!=null,`Previous layout not found for panel index ${f}`),X(R,y)){const P=I-R;fe(P,Math.abs(e))>0&&(e=e<0?0-P:P)}}}{const f=e<0?l:c,u=n[f];j(u,`No panel constraints found for index ${f}`);const{collapsedSize:y=0,collapsible:v,minSize:I=0}=u;if(v){const R=t[f];if(j(R!=null,`Previous layout not found for panel index ${f}`),X(R,I)){const P=R-y;fe(P,Math.abs(e))>0&&(e=e<0?0-P:P)}}}}{const f=e<0?1:-1;let u=e<0?c:l,y=0;for(;;){const I=t[u];j(I!=null,`Previous layout not found for panel index ${u}`);const P=ge({panelConstraints:n,panelIndex:u,size:100})-I;if(y+=P,u+=f,u<0||u>=n.length)break}const v=Math.min(Math.abs(e),Math.abs(y));e=e<0?0-v:v}{let u=e<0?l:c;for(;u>=0&&u<n.length;){const y=Math.abs(e)-Math.abs(p),v=t[u];j(v!=null,`Previous layout not found for panel index ${u}`);const I=v-y,R=ge({panelConstraints:n,panelIndex:u,size:I});if(!X(v,R)&&(p+=v-R,a[u]=R,p.toPrecision(3).localeCompare(Math.abs(e).toPrecision(3),void 0,{numeric:!0})>=0))break;e<0?u--:u++}}if(Qo(r,a))return r;{const f=e<0?c:l,u=t[f];j(u!=null,`Previous layout not found for panel index ${f}`);const y=u+p,v=ge({panelConstraints:n,panelIndex:f,size:y});if(a[f]=v,!X(v,y)){let I=y-v,P=e<0?c:l;for(;P>=0&&P<n.length;){const T=a[P];j(T!=null,`Previous layout not found for panel index ${P}`);const M=T+I,H=ge({panelConstraints:n,panelIndex:P,size:M});if(X(T,H)||(I-=H-T,a[P]=H),X(I,0))break;e>0?P--:P++}}}const m=a.reduce((f,u)=>u+f,0);return X(m,100)?a:r}function es({layout:e,panelsArray:t,pivotIndices:n}){let s=0,r=100,i=0,a=0;const l=n[0];j(l!=null,"No pivot index found"),t.forEach((f,u)=>{const{constraints:y}=f,{maxSize:v=100,minSize:I=0}=y;u===l?(s=I,r=v):(i+=I,a+=v)});const c=Math.min(r,100-i),p=Math.max(s,100-a),m=e[l];return{valueMax:c,valueMin:p,valueNow:m}}function Ne(e,t=document){return Array.from(t.querySelectorAll(`[${A.resizeHandleId}][data-panel-group-id="${e}"]`))}function rn(e,t,n=document){const r=Ne(e,n).findIndex(i=>i.getAttribute(A.resizeHandleId)===t);return r??null}function an(e,t,n){const s=rn(e,t,n);return s!=null?[s,s+1]:[-1,-1]}function ts(e){return e instanceof HTMLElement?!0:typeof e=="object"&&e!==null&&"tagName"in e&&"getAttribute"in e}function ln(e,t=document){if(ts(t)&&t.dataset.panelGroupId==e)return t;const n=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return n||null}function We(e,t=document){const n=t.querySelector(`[${A.resizeHandleId}="${e}"]`);return n||null}function ns(e,t,n,s=document){var r,i,a,l;const c=We(t,s),p=Ne(e,s),m=c?p.indexOf(c):-1,f=(r=(i=n[m])===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null,u=(a=(l=n[m+1])===null||l===void 0?void 0:l.id)!==null&&a!==void 0?a:null;return[f,u]}function os({committedValuesRef:e,eagerValuesRef:t,groupId:n,layout:s,panelDataArray:r,panelGroupElement:i,setLayout:a}){d.useRef({didWarnAboutMissingResizeHandle:!1}),de(()=>{if(!i)return;const l=Ne(n,i);for(let c=0;c<r.length-1;c++){const{valueMax:p,valueMin:m,valueNow:f}=es({layout:s,panelsArray:r,pivotIndices:[c,c+1]}),u=l[c];if(u!=null){const y=r[c];j(y,`No panel data found for index "${c}"`),u.setAttribute("aria-controls",y.id),u.setAttribute("aria-valuemax",""+Math.round(p)),u.setAttribute("aria-valuemin",""+Math.round(m)),u.setAttribute("aria-valuenow",f!=null?""+Math.round(f):"")}}return()=>{l.forEach((c,p)=>{c.removeAttribute("aria-controls"),c.removeAttribute("aria-valuemax"),c.removeAttribute("aria-valuemin"),c.removeAttribute("aria-valuenow")})}},[n,s,r,i]),d.useEffect(()=>{if(!i)return;const l=t.current;j(l,"Eager values not found");const{panelDataArray:c}=l,p=ln(n,i);j(p!=null,`No group found for id "${n}"`);const m=Ne(n,i);j(m,`No resize handles found for group id "${n}"`);const f=m.map(u=>{const y=u.getAttribute(A.resizeHandleId);j(y,"Resize handle element has no handle id attribute");const[v,I]=ns(n,y,c,i);if(v==null||I==null)return()=>{};const R=P=>{if(!P.defaultPrevented)switch(P.key){case"Enter":{P.preventDefault();const T=c.findIndex(M=>M.id===v);if(T>=0){const M=c[T];j(M,`No panel data found for index ${T}`);const H=s[T],{collapsedSize:q=0,collapsible:N,minSize:k=0}=M.constraints;if(H!=null&&N){const J=Re({delta:X(H,q)?k-q:q-H,initialLayout:s,panelConstraints:c.map(te=>te.constraints),pivotIndices:an(n,y,i),prevLayout:s,trigger:"keyboard"});s!==J&&a(J)}}break}}};return u.addEventListener("keydown",R),()=>{u.removeEventListener("keydown",R)}});return()=>{f.forEach(u=>u())}},[i,e,t,n,s,r,a])}function Rt(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function cn(e,t){const n=e==="horizontal",{x:s,y:r}=Ue(t);return n?s:r}function ss(e,t,n,s,r){const i=n==="horizontal",a=We(t,r);j(a,`No resize handle element found for id "${t}"`);const l=a.getAttribute(A.groupId);j(l,"Resize handle element has no group id attribute");let{initialCursorPosition:c}=s;const p=cn(n,e),m=ln(l,r);j(m,`No group element found for id "${l}"`);const f=m.getBoundingClientRect(),u=i?f.width:f.height;return(p-c)/u*100}function rs(e,t,n,s,r,i){if(Zt(e)){const a=n==="horizontal";let l=0;e.shiftKey?l=100:r!=null?l=r:l=10;let c=0;switch(e.key){case"ArrowDown":c=a?0:l;break;case"ArrowLeft":c=a?-l:0;break;case"ArrowRight":c=a?l:0;break;case"ArrowUp":c=a?0:-l;break;case"End":c=100;break;case"Home":c=-100;break}return c}else return s==null?0:ss(e,t,n,s,i)}function is({panelDataArray:e}){const t=Array(e.length),n=e.map(i=>i.constraints);let s=0,r=100;for(let i=0;i<e.length;i++){const a=n[i];j(a,`Panel constraints not found for index ${i}`);const{defaultSize:l}=a;l!=null&&(s++,t[i]=l,r-=l)}for(let i=0;i<e.length;i++){const a=n[i];j(a,`Panel constraints not found for index ${i}`);const{defaultSize:l}=a;if(l!=null)continue;const c=e.length-s,p=r/c;s++,t[i]=p,r-=p}return t}function xe(e,t,n){t.forEach((s,r)=>{const i=e[r];j(i,`Panel data not found for index ${r}`);const{callbacks:a,constraints:l,id:c}=i,{collapsedSize:p=0,collapsible:m}=l,f=n[c];if(f==null||s!==f){n[c]=s;const{onCollapse:u,onExpand:y,onResize:v}=a;v&&v(s,f),m&&(u||y)&&(y&&(f==null||ne(f,p))&&!ne(s,p)&&y(),u&&(f==null||!ne(f,p))&&ne(s,p)&&u())}})}function Ae(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function as({defaultSize:e,dragState:t,layout:n,panelData:s,panelIndex:r,precision:i=3}){const a=n[r];let l;return a==null?l=e!=null?e.toPrecision(i):"1":s.length===1?l="1":l=a.toPrecision(i),{flexBasis:0,flexGrow:l,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function ls(e,t=10){let n=null;return(...r)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...r)},t)}}function It(e){try{if(typeof localStorage<"u")e.getItem=t=>localStorage.getItem(t),e.setItem=(t,n)=>{localStorage.setItem(t,n)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),e.getItem=()=>null,e.setItem=()=>{}}}function un(e){return`react-resizable-panels:${e}`}function dn(e){return e.map(t=>{const{constraints:n,id:s,idIsFromProps:r,order:i}=t;return r?s:i?`${i}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((t,n)=>t.localeCompare(n)).join(",")}function fn(e,t){try{const n=un(e),s=t.getItem(n);if(s){const r=JSON.parse(s);if(typeof r=="object"&&r!=null)return r}}catch{}return null}function cs(e,t,n){var s,r;const i=(s=fn(e,n))!==null&&s!==void 0?s:{},a=dn(t);return(r=i[a])!==null&&r!==void 0?r:null}function us(e,t,n,s,r){var i;const a=un(e),l=dn(t),c=(i=fn(e,r))!==null&&i!==void 0?i:{};c[l]={expandToSizes:Object.fromEntries(n.entries()),layout:s};try{r.setItem(a,JSON.stringify(c))}catch(p){console.error(p)}}function Et({layout:e,panelConstraints:t}){const n=[...e],s=n.reduce((i,a)=>i+a,0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map(i=>`${i}%`).join(", ")}`);if(!X(s,100)&&n.length>0)for(let i=0;i<t.length;i++){const a=n[i];j(a!=null,`No layout data found for index ${i}`);const l=100/s*a;n[i]=l}let r=0;for(let i=0;i<t.length;i++){const a=n[i];j(a!=null,`No layout data found for index ${i}`);const l=ge({panelConstraints:t,panelIndex:i,size:a});a!=l&&(r+=a-l,n[i]=l)}if(!X(r,0))for(let i=0;i<t.length;i++){const a=n[i];j(a!=null,`No layout data found for index ${i}`);const l=a+r,c=ge({panelConstraints:t,panelIndex:i,size:l});if(a!==c&&(r-=c-a,n[i]=c,X(r,0)))break}return n}const ds=100,Ie={getItem:e=>(It(Ie),Ie.getItem(e)),setItem:(e,t)=>{It(Ie),Ie.setItem(e,t)}},Nt={};function pn({autoSaveId:e=null,children:t,className:n="",direction:s,forwardedRef:r,id:i=null,onLayout:a=null,keyboardResizeBy:l=null,storage:c=Ie,style:p,tagName:m="div",...f}){const u=at(i),y=d.useRef(null),[v,I]=d.useState(null),[R,P]=d.useState([]),T=Yo(),M=d.useRef({}),H=d.useRef(new Map),q=d.useRef(0),N=d.useRef({autoSaveId:e,direction:s,dragState:v,id:u,keyboardResizeBy:l,onLayout:a,storage:c}),k=d.useRef({layout:R,panelDataArray:[],panelDataArrayChanged:!1});d.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),d.useImperativeHandle(r,()=>({getId:()=>N.current.id,getLayout:()=>{const{layout:x}=k.current;return x},setLayout:x=>{const{onLayout:S}=N.current,{layout:C,panelDataArray:b}=k.current,g=Et({layout:x,panelConstraints:b.map(z=>z.constraints)});Rt(C,g)||(P(g),k.current.layout=g,S&&S(g),xe(b,g,M.current))}}),[]),de(()=>{N.current.autoSaveId=e,N.current.direction=s,N.current.dragState=v,N.current.id=u,N.current.onLayout=a,N.current.storage=c}),os({committedValuesRef:N,eagerValuesRef:k,groupId:u,layout:R,panelDataArray:k.current.panelDataArray,setLayout:P,panelGroupElement:y.current}),d.useEffect(()=>{const{panelDataArray:x}=k.current;if(e){if(R.length===0||R.length!==x.length)return;let S=Nt[e];S==null&&(S=ls(us,ds),Nt[e]=S);const C=[...x],b=new Map(H.current);S(e,C,b,R,c)}},[e,R,c]),d.useEffect(()=>{});const J=d.useCallback(x=>{const{onLayout:S}=N.current,{layout:C,panelDataArray:b}=k.current;if(x.constraints.collapsible){const g=b.map(Y=>Y.constraints),{collapsedSize:z=0,panelSize:E,pivotIndices:B}=le(b,x,C);if(j(E!=null,`Panel size not found for panel "${x.id}"`),!ne(E,z)){H.current.set(x.id,E);const Q=he(b,x)===b.length-1?E-z:z-E,$=Re({delta:Q,initialLayout:C,panelConstraints:g,pivotIndices:B,prevLayout:C,trigger:"imperative-api"});Ae(C,$)||(P($),k.current.layout=$,S&&S($),xe(b,$,M.current))}}},[]),te=d.useCallback((x,S)=>{const{onLayout:C}=N.current,{layout:b,panelDataArray:g}=k.current;if(x.constraints.collapsible){const z=g.map(K=>K.constraints),{collapsedSize:E=0,panelSize:B=0,minSize:Y=0,pivotIndices:Q}=le(g,x,b),$=S??Y;if(ne(B,E)){const K=H.current.get(x.id),je=K!=null&&K>=$?K:$,Xe=he(g,x)===g.length-1?B-je:je-B,O=Re({delta:Xe,initialLayout:b,panelConstraints:z,pivotIndices:Q,prevLayout:b,trigger:"imperative-api"});Ae(b,O)||(P(O),k.current.layout=O,C&&C(O),xe(g,O,M.current))}}},[]),W=d.useCallback(x=>{const{layout:S,panelDataArray:C}=k.current,{panelSize:b}=le(C,x,S);return j(b!=null,`Panel size not found for panel "${x.id}"`),b},[]),F=d.useCallback((x,S)=>{const{panelDataArray:C}=k.current,b=he(C,x);return as({defaultSize:S,dragState:v,layout:R,panelData:C,panelIndex:b})},[v,R]),L=d.useCallback(x=>{const{layout:S,panelDataArray:C}=k.current,{collapsedSize:b=0,collapsible:g,panelSize:z}=le(C,x,S);return j(z!=null,`Panel size not found for panel "${x.id}"`),g===!0&&ne(z,b)},[]),ie=d.useCallback(x=>{const{layout:S,panelDataArray:C}=k.current,{collapsedSize:b=0,collapsible:g,panelSize:z}=le(C,x,S);return j(z!=null,`Panel size not found for panel "${x.id}"`),!g||fe(z,b)>0},[]),G=d.useCallback(x=>{const{panelDataArray:S}=k.current;S.push(x),S.sort((C,b)=>{const g=C.order,z=b.order;return g==null&&z==null?0:g==null?-1:z==null?1:g-z}),k.current.panelDataArrayChanged=!0,T()},[T]);de(()=>{if(k.current.panelDataArrayChanged){k.current.panelDataArrayChanged=!1;const{autoSaveId:x,onLayout:S,storage:C}=N.current,{layout:b,panelDataArray:g}=k.current;let z=null;if(x){const B=cs(x,g,C);B&&(H.current=new Map(Object.entries(B.expandToSizes)),z=B.layout)}z==null&&(z=is({panelDataArray:g}));const E=Et({layout:z,panelConstraints:g.map(B=>B.constraints)});Rt(b,E)||(P(E),k.current.layout=E,S&&S(E),xe(g,E,M.current))}}),de(()=>{const x=k.current;return()=>{x.layout=[]}},[]);const D=d.useCallback(x=>{let S=!1;const C=y.current;return C&&window.getComputedStyle(C,null).getPropertyValue("direction")==="rtl"&&(S=!0),function(g){g.preventDefault();const z=y.current;if(!z)return()=>null;const{direction:E,dragState:B,id:Y,keyboardResizeBy:Q,onLayout:$}=N.current,{layout:K,panelDataArray:je}=k.current,{initialLayout:$e}=B??{},Xe=an(Y,x,z);let O=rs(g,x,E,B,Q,z);const ut=E==="horizontal";ut&&S&&(O=-O);const mn=je.map(xn=>xn.constraints),Ce=Re({delta:O,initialLayout:$e??K,panelConstraints:mn,pivotIndices:Xe,prevLayout:K,trigger:Zt(g)?"keyboard":"mouse-or-touch"}),dt=!Ae(K,Ce);(qt(g)||Yt(g))&&q.current!=O&&(q.current=O,!dt&&O!==0?ut?Qe(x,O<0?en:tn):Qe(x,O<0?nn:on):Qe(x,0)),dt&&(P(Ce),k.current.layout=Ce,$&&$(Ce),xe(je,Ce,M.current))}},[]),U=d.useCallback((x,S)=>{const{onLayout:C}=N.current,{layout:b,panelDataArray:g}=k.current,z=g.map(K=>K.constraints),{panelSize:E,pivotIndices:B}=le(g,x,b);j(E!=null,`Panel size not found for panel "${x.id}"`);const Q=he(g,x)===g.length-1?E-S:S-E,$=Re({delta:Q,initialLayout:b,panelConstraints:z,pivotIndices:B,prevLayout:b,trigger:"imperative-api"});Ae(b,$)||(P($),k.current.layout=$,C&&C($),xe(g,$,M.current))},[]),be=d.useCallback((x,S)=>{const{layout:C,panelDataArray:b}=k.current,{collapsedSize:g=0,collapsible:z}=S,{collapsedSize:E=0,collapsible:B,maxSize:Y=100,minSize:Q=0}=x.constraints,{panelSize:$}=le(b,x,C);$!=null&&(z&&B&&ne($,g)?ne(g,E)||U(x,E):$<Q?U(x,Q):$>Y&&U(x,Y))},[U]),we=d.useCallback((x,S)=>{const{direction:C}=N.current,{layout:b}=k.current;if(!y.current)return;const g=We(x,y.current);j(g,`Drag handle element not found for id "${x}"`);const z=cn(C,S);I({dragHandleId:x,dragHandleRect:g.getBoundingClientRect(),initialCursorPosition:z,initialLayout:b})},[]),Se=d.useCallback(()=>{I(null)},[]),Te=d.useCallback(x=>{const{panelDataArray:S}=k.current,C=he(S,x);C>=0&&(S.splice(C,1),delete M.current[x.id],k.current.panelDataArrayChanged=!0,T())},[T]),me=d.useMemo(()=>({collapsePanel:J,direction:s,dragState:v,expandPanel:te,getPanelSize:W,getPanelStyle:F,groupId:u,isPanelCollapsed:L,isPanelExpanded:ie,reevaluatePanelConstraints:be,registerPanel:G,registerResizeHandle:D,resizePanel:U,startDragging:we,stopDragging:Se,unregisterPanel:Te,panelGroupElement:y.current}),[J,v,s,te,W,F,u,L,ie,be,G,D,U,we,Se,Te]),ze={display:"flex",flexDirection:s==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return d.createElement(Fe.Provider,{value:me},d.createElement(m,{...f,children:t,className:n,id:i,ref:y,style:{...ze,...p},[A.group]:"",[A.groupDirection]:s,[A.groupId]:u}))}const ot=d.forwardRef((e,t)=>d.createElement(pn,{...e,forwardedRef:t}));pn.displayName="PanelGroup";ot.displayName="forwardRef(PanelGroup)";function he(e,t){return e.findIndex(n=>n===t||n.id===t.id)}function le(e,t,n){const s=he(e,t),i=s===e.length-1?[s-1,s]:[s,s+1],a=n[s];return{...t.constraints,panelSize:a,pivotIndices:i}}function fs({disabled:e,handleId:t,resizeHandler:n,panelGroupElement:s}){d.useEffect(()=>{if(e||n==null||s==null)return;const r=We(t,s);if(r==null)return;const i=a=>{if(!a.defaultPrevented)switch(a.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{a.preventDefault(),n(a);break}case"F6":{a.preventDefault();const l=r.getAttribute(A.groupId);j(l,`No group element found for id "${l}"`);const c=Ne(l,s),p=rn(l,t,s);j(p!==null,`No resize element found for id "${t}"`);const m=a.shiftKey?p>0?p-1:c.length-1:p+1<c.length?p+1:0;c[m].focus();break}}};return r.addEventListener("keydown",i),()=>{r.removeEventListener("keydown",i)}},[s,e,t,n])}function st({children:e=null,className:t="",disabled:n=!1,hitAreaMargins:s,id:r,onBlur:i,onClick:a,onDragging:l,onFocus:c,onPointerDown:p,onPointerUp:m,style:f={},tabIndex:u=0,tagName:y="div",...v}){var I,R;const P=d.useRef(null),T=d.useRef({onClick:a,onDragging:l,onPointerDown:p,onPointerUp:m});d.useEffect(()=>{T.current.onClick=a,T.current.onDragging=l,T.current.onPointerDown=p,T.current.onPointerUp=m});const M=d.useContext(Fe);if(M===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:H,groupId:q,registerResizeHandle:N,startDragging:k,stopDragging:J,panelGroupElement:te}=M,W=at(r),[F,L]=d.useState("inactive"),[ie,G]=d.useState(!1),[D,U]=d.useState(null),be=d.useRef({state:F});de(()=>{be.current.state=F}),d.useEffect(()=>{if(n)U(null);else{const me=N(W);U(()=>me)}},[n,W,N]);const we=(I=s?.coarse)!==null&&I!==void 0?I:15,Se=(R=s?.fine)!==null&&R!==void 0?R:5;d.useEffect(()=>{if(n||D==null)return;const me=P.current;j(me,"Element ref not attached");let ze=!1;return Zo(W,me,H,{coarse:we,fine:Se},(S,C,b)=>{if(!C){L("inactive");return}switch(S){case"down":{L("drag"),ze=!1,j(b,'Expected event to be defined for "down" action'),k(W,b);const{onDragging:g,onPointerDown:z}=T.current;g?.(!0),z?.();break}case"move":{const{state:g}=be.current;ze=!0,g!=="drag"&&L("hover"),j(b,'Expected event to be defined for "move" action'),D(b);break}case"up":{L("hover"),J();const{onClick:g,onDragging:z,onPointerUp:E}=T.current;z?.(!1),E?.(),ze||g?.();break}}})},[we,H,n,Se,N,W,D,k,J]),fs({disabled:n,handleId:W,resizeHandler:D,panelGroupElement:te});const Te={touchAction:"none",userSelect:"none"};return d.createElement(y,{...v,children:e,className:t,id:r,onBlur:()=>{G(!1),i?.()},onFocus:()=>{G(!0),c?.()},ref:P,role:"separator",style:{...Te,...f},tabIndex:u,[A.groupDirection]:H,[A.groupId]:q,[A.resizeHandle]:"",[A.resizeHandleActive]:F==="drag"?"pointer":ie?"keyboard":void 0,[A.resizeHandleEnabled]:!n,[A.resizeHandleId]:W,[A.resizeHandleState]:F})}st.displayName="PanelResizeHandle";const bs=()=>(Bn(),_n(),o.jsxs(o.Fragment,{children:[o.jsx("title",{children:"Hoh Editor"}),o.jsxs(ot,{direction:"horizontal",className:"w-full h-full",children:[o.jsx(ke,{children:o.jsxs(ot,{direction:"vertical",children:[o.jsx(ke,{id:"editingArea",children:o.jsx(vo,{children:o.jsx(yo,{children:o.jsx(_o,{})})})}),o.jsx(st,{className:"scale-editor h-1 bg-metallicBlueHalfbrite hover:border-moss hover:bg-moss border-t-[calc(1px*var(--scale))] border-metallicBlue"}),o.jsx(ke,{defaultSize:25,minSize:10,id:"jsonEditor",className:"text-white",collapsible:!0,children:"json editor here"})]})}),o.jsx(st,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-l-[calc(1px*var(--scale))] border-metallicBlue"}),o.jsx(ke,{id:"toolbar",defaultSize:20,maxSize:33,minSize:10,children:o.jsx(ho,{})})]})]}));export{bs as default};
