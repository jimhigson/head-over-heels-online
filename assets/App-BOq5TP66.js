const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-B58vrxoQ.js","assets/webworkerAll-c7PycqGy.js","assets/Graphics-Dzp8yGfj.js","assets/colorToUniform-KTpA7KSL.js","assets/index-BLYhQSnX.js","assets/index-CwRnNpWc.css","assets/Cheats-DOLS9EwM.js","assets/swopCharacters-Dc383lxh.js","assets/gameMain-B-ChBClz.js","assets/testCampaign-D0dDCSKu.js"])))=>i.map(i=>d[i]);
import{b as wr,r as L,R as Yu,_ as Qt,g as rt,j as p,t as Ie,d as Ac,B as st,D as ze,i as Qr}from"./index-BLYhQSnX.js";function Xu(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var r,s,n,i,a=[],o="",l=t.split("/");for(l[0]||l.shift();n=l.shift();)r=n[0],r==="*"?(a.push(r),o+=n[1]==="?"?"(?:/(.*))?":"/(.*)"):r===":"?(s=n.indexOf("?",1),i=n.indexOf(".",1),a.push(n.substring(1,~s?s:~i?i:n.length)),o+=~s&&!~i?"(?:/([^/]+?))?":"/([^/]+?)",~i&&(o+=(~s?"?":"")+"\\"+n.substring(i))):o+="/"+n;return{keys:a,pattern:new RegExp("^"+o+(e?"(?=$|/)":"/?$"),"i")}}var tn={exports:{}},rn={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ea;function Ku(){if(Ea)return rn;Ea=1;var t=wr();function e(u,f){return u===f&&(u!==0||1/u===1/f)||u!==u&&f!==f}var r=typeof Object.is=="function"?Object.is:e,s=t.useState,n=t.useEffect,i=t.useLayoutEffect,a=t.useDebugValue;function o(u,f){var d=f(),g=s({inst:{value:d,getSnapshot:f}}),x=g[0].inst,m=g[1];return i(function(){x.value=d,x.getSnapshot=f,l(x)&&m({inst:x})},[u,d,f]),n(function(){return l(x)&&m({inst:x}),u(function(){l(x)&&m({inst:x})})},[u]),a(d),d}function l(u){var f=u.getSnapshot;u=u.value;try{var d=f();return!r(u,d)}catch{return!0}}function c(u,f){return f()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:o;return rn.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:h,rn}var Ra;function Zu(){return Ra||(Ra=1,tn.exports=Ku()),tn.exports}var Qu=Zu();const Ju=Yu.useInsertionEffect,ed=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",td=ed?L.useLayoutEffect:L.useEffect,rd=Ju||td,kc=t=>{const e=L.useRef([t,(...r)=>e[0](...r)]).current;return rd(()=>{e[0]=t}),e[1]},sd="popstate",Ui="pushState",Vi="replaceState",nd="hashchange",ja=[sd,Ui,Vi,nd],id=t=>{for(const e of ja)addEventListener(e,t);return()=>{for(const e of ja)removeEventListener(e,t)}},Cc=(t,e)=>Qu.useSyncExternalStore(id,t,e),ad=()=>location.search,od=({ssrSearch:t=""}={})=>Cc(ad,()=>t),Ba=()=>location.pathname,ld=({ssrPath:t}={})=>Cc(Ba,t?()=>t:Ba),cd=(t,{replace:e=!1,state:r=null}={})=>history[e?Vi:Ui](r,"",t),hd=(t={})=>[ld(t),cd],za=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[za]>"u"){for(const t of[Ui,Vi]){const e=history[t];history[t]=function(){const r=e.apply(this,arguments),s=new Event(t);return s.arguments=arguments,dispatchEvent(s),r}}Object.defineProperty(window,za,{value:!0})}const ud=(t,e)=>e.toLowerCase().indexOf(t.toLowerCase())?"~"+e:e.slice(t.length)||"/",Pc=(t="")=>t==="/"?"":t,dd=(t,e)=>t[0]==="~"?t.slice(1):Pc(e)+t,fd=(t="",e)=>ud(Fa(Pc(t)),Fa(e)),Fa=t=>{try{return decodeURI(t)}catch{return t}},Mc={hook:hd,searchHook:od,parser:Xu,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:t=>t},Ic=L.createContext(Mc),qi=()=>L.useContext(Ic),Tc={},Ec=L.createContext(Tc),pd=()=>L.useContext(Ec),Rc=t=>{const[e,r]=t.hook(t);return[fd(t.base,e),kc((s,n)=>r(dd(s,t.base),n))]},md=(t,e,r,s)=>{const{pattern:n,keys:i}=e instanceof RegExp?{keys:!1,pattern:e}:t(e||"*",s),a=n.exec(r)||[],[o,...l]=a;return o!==void 0?[!0,(()=>{const c=i!==!1?Object.fromEntries(i.map((u,f)=>[u,l[f]])):a.groups;let h={...l};return c&&Object.assign(h,c),h})(),...s?[o]:[]]:[!1,null]},gd=({children:t,...e})=>{const r=qi(),s=e.hook?Mc:r;let n=s;const[i,a]=e.ssrPath?.split("?")??[];a&&(e.ssrSearch=a,e.ssrPath=i),e.hrefs=e.hrefs??e.hook?.hrefs;let o=L.useRef({}),l=o.current,c=l;for(let h in s){const u=h==="base"?s[h]+(e[h]||""):e[h]||s[h];l===c&&u!==c[h]&&(o.current=c={...c}),c[h]=u,u!==s[h]&&(n=c)}return L.createElement(Ic.Provider,{value:n,children:t})},Oa=({children:t,component:e},r)=>e?L.createElement(e,{params:r}):typeof t=="function"?t(r):t,xd=t=>{let e=L.useRef(Tc);const r=e.current;return e.current=Object.keys(t).length!==Object.keys(r).length||Object.entries(t).some(([s,n])=>n!==r[s])?t:r},Na=({path:t,nest:e,match:r,...s})=>{const n=qi(),[i]=Rc(n),[a,o,l]=r??md(n.parser,t,i,e),c=xd({...pd(),...o});if(!a)return null;const h=l?L.createElement(gd,{base:l},Oa(s,c)):Oa(s,c);return L.createElement(Ec.Provider,{value:c,children:h})};L.forwardRef((t,e)=>{const r=qi(),[s,n]=Rc(r),{to:i="",href:a=i,onClick:o,asChild:l,children:c,className:h,replace:u,state:f,...d}=t,g=kc(m=>{m.ctrlKey||m.metaKey||m.altKey||m.shiftKey||m.button!==0||(o?.(m),m.defaultPrevented||(m.preventDefault(),n(a,t)))}),x=r.hrefs(a[0]==="~"?a.slice(1):r.base+a,r);return l&&L.isValidElement(c)?L.cloneElement(c,{onClick:g,href:x}):L.createElement("a",{...d,onClick:g,href:x,className:h?.call?h(s===a):h,children:c,ref:e})});var U=(t=>(t.Application="application",t.WebGLPipes="webgl-pipes",t.WebGLPipesAdaptor="webgl-pipes-adaptor",t.WebGLSystem="webgl-system",t.WebGPUPipes="webgpu-pipes",t.WebGPUPipesAdaptor="webgpu-pipes-adaptor",t.WebGPUSystem="webgpu-system",t.CanvasSystem="canvas-system",t.CanvasPipesAdaptor="canvas-pipes-adaptor",t.CanvasPipes="canvas-pipes",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t.MaskEffect="mask-effect",t.BlendMode="blend-mode",t.TextureSource="texture-source",t.Environment="environment",t.ShapeBuilder="shape-builder",t.Batcher="batcher",t))(U||{});const mi=t=>{if(typeof t=="function"||typeof t=="object"&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={...typeof t.extension!="object"?{type:t.extension}:t.extension,ref:t}}if(typeof t=="object")t={...t};else throw new Error("Invalid extension type");return typeof t.type=="string"&&(t.type=[t.type]),t},ss=(t,e)=>mi(t).priority??e,Be={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(mi).forEach(e=>{e.type.forEach(r=>this._removeHandlers[r]?.(e))}),this},add(...t){return t.map(mi).forEach(e=>{e.type.forEach(r=>{const s=this._addHandlers,n=this._queue;s[r]?s[r]?.(e):(n[r]=n[r]||[],n[r]?.push(e))})}),this},handle(t,e,r){const s=this._addHandlers,n=this._removeHandlers;if(s[t]||n[t])throw new Error(`Extension type ${t} already has a handler`);s[t]=e,n[t]=r;const i=this._queue;return i[t]&&(i[t]?.forEach(a=>e(a)),delete i[t]),this},handleByMap(t,e){return this.handle(t,r=>{r.name&&(e[r.name]=r.ref)},r=>{r.name&&delete e[r.name]})},handleByNamedList(t,e,r=-1){return this.handle(t,s=>{e.findIndex(i=>i.name===s.name)>=0||(e.push({name:s.name,value:s.ref}),e.sort((i,a)=>ss(a.value,r)-ss(i.value,r)))},s=>{const n=e.findIndex(i=>i.name===s.name);n!==-1&&e.splice(n,1)})},handleByList(t,e,r=-1){return this.handle(t,s=>{e.includes(s.ref)||(e.push(s.ref),e.sort((n,i)=>ss(i,r)-ss(n,r)))},s=>{const n=e.indexOf(s.ref);n!==-1&&e.splice(n,1)})},mixin(t,...e){for(const r of e)Object.defineProperties(t.prototype,Object.getOwnPropertyDescriptors(r))}},yd={extension:{type:U.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Qt(()=>import("./browserAll-B58vrxoQ.js"),__vite__mapDeps([0,1,2,3,4,5]))}},bd={extension:{type:U.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await Qt(()=>import("./webworkerAll-c7PycqGy.js"),__vite__mapDeps([1,2,3,4,5]))}};class De{constructor(e,r,s){this._x=r||0,this._y=s||0,this._observer=e}clone(e){return new De(e??this._observer,this._x,this._y)}set(e=0,r=e){return(this._x!==e||this._y!==r)&&(this._x=e,this._y=r,this._observer._onUpdate(this)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this._observer._onUpdate(this)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=0 y=0 scope=${this._observer}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this._observer._onUpdate(this))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this._observer._onUpdate(this))}}var sn={exports:{}},La;function wd(){return La||(La=1,function(t){var e=Object.prototype.hasOwnProperty,r="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(r=!1));function n(l,c,h){this.fn=l,this.context=c,this.once=h||!1}function i(l,c,h,u,f){if(typeof h!="function")throw new TypeError("The listener must be a function");var d=new n(h,u||l,f),g=r?r+c:c;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],d]:l._events[g].push(d):(l._events[g]=d,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new s:delete l._events[c]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],h,u;if(this._eventsCount===0)return c;for(u in h=this._events)e.call(h,u)&&c.push(r?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},o.prototype.listeners=function(c){var h=r?r+c:c,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var f=0,d=u.length,g=new Array(d);f<d;f++)g[f]=u[f].fn;return g},o.prototype.listenerCount=function(c){var h=r?r+c:c,u=this._events[h];return u?u.fn?1:u.length:0},o.prototype.emit=function(c,h,u,f,d,g){var x=r?r+c:c;if(!this._events[x])return!1;var m=this._events[x],w=arguments.length,b,A;if(m.fn){switch(m.once&&this.removeListener(c,m.fn,void 0,!0),w){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,u),!0;case 4:return m.fn.call(m.context,h,u,f),!0;case 5:return m.fn.call(m.context,h,u,f,d),!0;case 6:return m.fn.call(m.context,h,u,f,d,g),!0}for(A=1,b=new Array(w-1);A<w;A++)b[A-1]=arguments[A];m.fn.apply(m.context,b)}else{var P=m.length,E;for(A=0;A<P;A++)switch(m[A].once&&this.removeListener(c,m[A].fn,void 0,!0),w){case 1:m[A].fn.call(m[A].context);break;case 2:m[A].fn.call(m[A].context,h);break;case 3:m[A].fn.call(m[A].context,h,u);break;case 4:m[A].fn.call(m[A].context,h,u,f);break;default:if(!b)for(E=1,b=new Array(w-1);E<w;E++)b[E-1]=arguments[E];m[A].fn.apply(m[A].context,b)}}return!0},o.prototype.on=function(c,h,u){return i(this,c,h,u,!1)},o.prototype.once=function(c,h,u){return i(this,c,h,u,!0)},o.prototype.removeListener=function(c,h,u,f){var d=r?r+c:c;if(!this._events[d])return this;if(!h)return a(this,d),this;var g=this._events[d];if(g.fn)g.fn===h&&(!f||g.once)&&(!u||g.context===u)&&a(this,d);else{for(var x=0,m=[],w=g.length;x<w;x++)(g[x].fn!==h||f&&!g[x].once||u&&g[x].context!==u)&&m.push(g[x]);m.length?this._events[d]=m.length===1?m[0]:m:a(this,d)}return this},o.prototype.removeAllListeners=function(c){var h;return c?(h=r?r+c:c,this._events[h]&&a(this,h)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,t.exports=o}(sn)),sn.exports}var _d=wd();const xt=rt(_d),vd=Math.PI*2,Sd=180/Math.PI,Ad=Math.PI/180;class Me{constructor(e=0,r=0){this.x=0,this.y=0,this.x=e,this.y=r}clone(){return new Me(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,r=e){return this.x=e,this.y=r,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return nn.x=0,nn.y=0,nn}}const nn=new Me;class ee{constructor(e=1,r=0,s=0,n=1,i=0,a=0){this.array=null,this.a=e,this.b=r,this.c=s,this.d=n,this.tx=i,this.ty=a}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,r,s,n,i,a){return this.a=e,this.b=r,this.c=s,this.d=n,this.tx=i,this.ty=a,this}toArray(e,r){this.array||(this.array=new Float32Array(9));const s=r||this.array;return e?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(e,r){r=r||new Me;const s=e.x,n=e.y;return r.x=this.a*s+this.c*n+this.tx,r.y=this.b*s+this.d*n+this.ty,r}applyInverse(e,r){r=r||new Me;const s=this.a,n=this.b,i=this.c,a=this.d,o=this.tx,l=this.ty,c=1/(s*a+i*-n),h=e.x,u=e.y;return r.x=a*c*h+-i*c*u+(l*i-o*a)*c,r.y=s*c*u+-n*c*h+(-l*s+o*n)*c,r}translate(e,r){return this.tx+=e,this.ty+=r,this}scale(e,r){return this.a*=e,this.d*=r,this.c*=e,this.b*=r,this.tx*=e,this.ty*=r,this}rotate(e){const r=Math.cos(e),s=Math.sin(e),n=this.a,i=this.c,a=this.tx;return this.a=n*r-this.b*s,this.b=n*s+this.b*r,this.c=i*r-this.d*s,this.d=i*s+this.d*r,this.tx=a*r-this.ty*s,this.ty=a*s+this.ty*r,this}append(e){const r=this.a,s=this.b,n=this.c,i=this.d;return this.a=e.a*r+e.b*n,this.b=e.a*s+e.b*i,this.c=e.c*r+e.d*n,this.d=e.c*s+e.d*i,this.tx=e.tx*r+e.ty*n+this.tx,this.ty=e.tx*s+e.ty*i+this.ty,this}appendFrom(e,r){const s=e.a,n=e.b,i=e.c,a=e.d,o=e.tx,l=e.ty,c=r.a,h=r.b,u=r.c,f=r.d;return this.a=s*c+n*u,this.b=s*h+n*f,this.c=i*c+a*u,this.d=i*h+a*f,this.tx=o*c+l*u+r.tx,this.ty=o*h+l*f+r.ty,this}setTransform(e,r,s,n,i,a,o,l,c){return this.a=Math.cos(o+c)*i,this.b=Math.sin(o+c)*i,this.c=-Math.sin(o-l)*a,this.d=Math.cos(o-l)*a,this.tx=e-(s*this.a+n*this.c),this.ty=r-(s*this.b+n*this.d),this}prepend(e){const r=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const s=this.a,n=this.c;this.a=s*e.a+this.b*e.c,this.b=s*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=r*e.a+this.ty*e.c+e.tx,this.ty=r*e.b+this.ty*e.d+e.ty,this}decompose(e){const r=this.a,s=this.b,n=this.c,i=this.d,a=e.pivot,o=-Math.atan2(-n,i),l=Math.atan2(s,r),c=Math.abs(o+l);return c<1e-5||Math.abs(vd-c)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=l),e.scale.x=Math.sqrt(r*r+s*s),e.scale.y=Math.sqrt(n*n+i*i),e.position.x=this.tx+(a.x*r+a.y*n),e.position.y=this.ty+(a.x*s+a.y*i),e}invert(){const e=this.a,r=this.b,s=this.c,n=this.d,i=this.tx,a=e*n-r*s;return this.a=n/a,this.b=-r/a,this.c=-s/a,this.d=e/a,this.tx=(s*this.ty-n*i)/a,this.ty=-(e*this.ty-r*i)/a,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new ee;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}equals(e){return e.a===this.a&&e.b===this.b&&e.c===this.c&&e.d===this.d&&e.tx===this.tx&&e.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return Cd.identity()}static get shared(){return kd.identity()}}const kd=new ee,Cd=new ee,Nt=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Lt=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Gt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Dt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],gi=[],jc=[],ns=Math.sign;function Pd(){for(let t=0;t<16;t++){const e=[];gi.push(e);for(let r=0;r<16;r++){const s=ns(Nt[t]*Nt[r]+Gt[t]*Lt[r]),n=ns(Lt[t]*Nt[r]+Dt[t]*Lt[r]),i=ns(Nt[t]*Gt[r]+Gt[t]*Dt[r]),a=ns(Lt[t]*Gt[r]+Dt[t]*Dt[r]);for(let o=0;o<16;o++)if(Nt[o]===s&&Lt[o]===n&&Gt[o]===i&&Dt[o]===a){e.push(o);break}}}for(let t=0;t<16;t++){const e=new ee;e.set(Nt[t],Lt[t],Gt[t],Dt[t],0,0),jc.push(e)}}Pd();const he={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>Nt[t],uY:t=>Lt[t],vX:t=>Gt[t],vY:t=>Dt[t],inv:t=>t&8?t&15:-t&7,add:(t,e)=>gi[t][e],sub:(t,e)=>gi[t][he.inv(e)],rotate180:t=>t^4,isVertical:t=>(t&3)===2,byDirection:(t,e)=>Math.abs(t)*2<=Math.abs(e)?e>=0?he.S:he.N:Math.abs(e)*2<=Math.abs(t)?t>0?he.E:he.W:e>0?t>0?he.SE:he.SW:t>0?he.NE:he.NW,matrixAppendRotationInv:(t,e,r=0,s=0)=>{const n=jc[he.inv(e)];n.tx=r,n.ty=s,t.append(n)}},is=[new Me,new Me,new Me,new Me];class ge{constructor(e=0,r=0,s=0,n=0){this.type="rectangle",this.x=Number(e),this.y=Number(r),this.width=Number(s),this.height=Number(n)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new ge(0,0,0,0)}clone(){return new ge(this.x,this.y,this.width,this.height)}copyFromBounds(e){return this.x=e.minX,this.y=e.minY,this.width=e.maxX-e.minX,this.height=e.maxY-e.minY,this}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,r){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&r>=this.y&&r<this.y+this.height}strokeContains(e,r,s,n=.5){const{width:i,height:a}=this;if(i<=0||a<=0)return!1;const o=this.x,l=this.y,c=s*(1-n),h=s-c,u=o-c,f=o+i+c,d=l-c,g=l+a+c,x=o+h,m=o+i-h,w=l+h,b=l+a-h;return e>=u&&e<=f&&r>=d&&r<=g&&!(e>x&&e<m&&r>w&&r<b)}intersects(e,r){if(!r){const N=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=N)return!1;const j=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>j}const s=this.left,n=this.right,i=this.top,a=this.bottom;if(n<=s||a<=i)return!1;const o=is[0].set(e.left,e.top),l=is[1].set(e.left,e.bottom),c=is[2].set(e.right,e.top),h=is[3].set(e.right,e.bottom);if(c.x<=o.x||l.y<=o.y)return!1;const u=Math.sign(r.a*r.d-r.b*r.c);if(u===0||(r.apply(o,o),r.apply(l,l),r.apply(c,c),r.apply(h,h),Math.max(o.x,l.x,c.x,h.x)<=s||Math.min(o.x,l.x,c.x,h.x)>=n||Math.max(o.y,l.y,c.y,h.y)<=i||Math.min(o.y,l.y,c.y,h.y)>=a))return!1;const f=u*(l.y-o.y),d=u*(o.x-l.x),g=f*s+d*i,x=f*n+d*i,m=f*s+d*a,w=f*n+d*a;if(Math.max(g,x,m,w)<=f*o.x+d*o.y||Math.min(g,x,m,w)>=f*h.x+d*h.y)return!1;const b=u*(o.y-c.y),A=u*(c.x-o.x),P=b*s+A*i,E=b*n+A*i,I=b*s+A*a,T=b*n+A*a;return!(Math.max(P,E,I,T)<=b*o.x+A*o.y||Math.min(P,E,I,T)>=b*h.x+A*h.y)}pad(e=0,r=e){return this.x-=e,this.y-=r,this.width+=e*2,this.height+=r*2,this}fit(e){const r=Math.max(this.x,e.x),s=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),i=Math.min(this.y+this.height,e.y+e.height);return this.x=r,this.width=Math.max(s-r,0),this.y=n,this.height=Math.max(i-n,0),this}ceil(e=1,r=.001){const s=Math.ceil((this.x+this.width-r)*e)/e,n=Math.ceil((this.y+this.height-r)*e)/e;return this.x=Math.floor((this.x+r)*e)/e,this.y=Math.floor((this.y+r)*e)/e,this.width=s-this.x,this.height=n-this.y,this}enlarge(e){const r=Math.min(this.x,e.x),s=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),i=Math.max(this.y+this.height,e.y+e.height);return this.x=r,this.width=s-r,this.y=n,this.height=i-n,this}getBounds(e){return e||(e=new ge),e.copyFrom(this),e}containsRect(e){if(this.width<=0||this.height<=0)return!1;const r=e.x,s=e.y,n=e.x+e.width,i=e.y+e.height;return r>=this.x&&r<this.x+this.width&&s>=this.y&&s<this.y+this.height&&n>=this.x&&n<this.x+this.width&&i>=this.y&&i<this.y+this.height}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const an={default:-1};function xe(t="default"){return an[t]===void 0&&(an[t]=-1),++an[t]}const Ga={},Pe="8.0.0",Md="8.3.4";function me(t,e,r=3){if(Ga[e])return;let s=new Error().stack;typeof s>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`):(s=s.split(`
`).splice(r).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${t}`),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`),console.warn(s))),Ga[e]=!0}const Bc=()=>{};function Ts(t){return t+=t===0?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1}function Da(t){return!(t&t-1)&&!!t}function zc(t){const e={};for(const r in t)t[r]!==void 0&&(e[r]=t[r]);return e}const $a=Object.create(null);function Id(t){const e=$a[t];return e===void 0&&($a[t]=xe("resource")),e}const Fc=class Oc extends xt{constructor(e={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,e={...Oc.defaultOptions,...e},this.addressMode=e.addressMode,this.addressModeU=e.addressModeU??this.addressModeU,this.addressModeV=e.addressModeV??this.addressModeV,this.addressModeW=e.addressModeW??this.addressModeW,this.scaleMode=e.scaleMode,this.magFilter=e.magFilter??this.magFilter,this.minFilter=e.minFilter??this.minFilter,this.mipmapFilter=e.mipmapFilter??this.mipmapFilter,this.lodMinClamp=e.lodMinClamp,this.lodMaxClamp=e.lodMaxClamp,this.compare=e.compare,this.maxAnisotropy=e.maxAnisotropy??1}set addressMode(e){this.addressModeU=e,this.addressModeV=e,this.addressModeW=e}get addressMode(){return this.addressModeU}set wrapMode(e){me(Pe,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=e}get wrapMode(){return this.addressMode}set scaleMode(e){this.magFilter=e,this.minFilter=e,this.mipmapFilter=e}get scaleMode(){return this.magFilter}set maxAnisotropy(e){this._maxAnisotropy=Math.min(e,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const e=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=Id(e),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};Fc.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let Td=Fc;const Nc=class Lc extends xt{constructor(e={}){super(),this.options=e,this.uid=xe("textureSource"),this._resourceType="textureSource",this._resourceId=xe("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,e={...Lc.defaultOptions,...e},this.label=e.label??"",this.resource=e.resource,this.autoGarbageCollect=e.autoGarbageCollect,this._resolution=e.resolution,e.width?this.pixelWidth=e.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,e.height?this.pixelHeight=e.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=e.format,this.dimension=e.dimensions,this.mipLevelCount=e.mipLevelCount,this.autoGenerateMipmaps=e.autoGenerateMipmaps,this.sampleCount=e.sampleCount,this.antialias=e.antialias,this.alphaMode=e.alphaMode,this.style=new Td(zc(e)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(e){this.style!==e&&(this._style?.off("change",this._onStyleChange,this),this._style=e,this._style?.on("change",this._onStyleChange,this),this._onStyleChange())}get addressMode(){return this._style.addressMode}set addressMode(e){this._style.addressMode=e}get repeatMode(){return this._style.addressMode}set repeatMode(e){this._style.addressMode=e}get magFilter(){return this._style.magFilter}set magFilter(e){this._style.magFilter=e}get minFilter(){return this._style.minFilter}set minFilter(e){this._style.minFilter=e}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(e){this._style.mipmapFilter=e}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(e){this._style.lodMinClamp=e}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(e){this._style.lodMaxClamp=e}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const e=this._resolution;if(this.resize(this.resourceWidth/e,this.resourceHeight/e))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=xe("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:e}=this;return e.naturalWidth||e.videoWidth||e.displayWidth||e.width}get resourceHeight(){const{resource:e}=this;return e.naturalHeight||e.videoHeight||e.displayHeight||e.height}get resolution(){return this._resolution}set resolution(e){this._resolution!==e&&(this._resolution=e,this.width=this.pixelWidth/e,this.height=this.pixelHeight/e)}resize(e,r,s){s||(s=this._resolution),e||(e=this.width),r||(r=this.height);const n=Math.round(e*s),i=Math.round(r*s);return this.width=n/s,this.height=i/s,this._resolution=s,this.pixelWidth===n&&this.pixelHeight===i?!1:(this._refreshPOT(),this.pixelWidth=n,this.pixelHeight=i,this.emit("resize",this),this._resourceId=xe("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(e){this._style.wrapMode=e}get wrapMode(){return this._style.wrapMode}set scaleMode(e){this._style.scaleMode=e}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=Da(this.pixelWidth)&&Da(this.pixelHeight)}static test(e){throw new Error("Unimplemented")}};Nc.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let yt=Nc;class Yi extends yt{constructor(e){const r=e.resource||new Float32Array(e.width*e.height*4);let s=e.format;s||(r instanceof Float32Array?s="rgba32float":r instanceof Int32Array||r instanceof Uint32Array?s="rgba32uint":r instanceof Int16Array||r instanceof Uint16Array?s="rgba16uint":(r instanceof Int8Array,s="bgra8unorm")),super({...e,resource:r,format:s}),this.uploadMethodId="buffer"}static test(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}Yi.extension=U.TextureSource;const Ha=new ee;class Ed{constructor(e,r){this.mapCoord=new ee,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof r>"u"?this.clampMargin=e.width<10?0:.5:this.clampMargin=r,this.isSimple=!1,this.texture=e}get texture(){return this._texture}set texture(e){this.texture!==e&&(this._texture?.removeListener("update",this.update,this),this._texture=e,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(e,r){r===void 0&&(r=e);const s=this.mapCoord;for(let n=0;n<e.length;n+=2){const i=e[n],a=e[n+1];r[n]=i*s.a+a*s.c+s.tx,r[n+1]=i*s.b+a*s.d+s.ty}return r}update(){const e=this._texture;this._updateID++;const r=e.uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const s=e.orig,n=e.trim;n&&(Ha.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Ha));const i=e.source,a=this.uClampFrame,o=this.clampMargin/i._resolution,l=this.clampOffset/i._resolution;return a[0]=(e.frame.x+o+l)/i.width,a[1]=(e.frame.y+o+l)/i.height,a[2]=(e.frame.x+e.frame.width-o+l)/i.width,a[3]=(e.frame.y+e.frame.height-o+l)/i.height,this.uClampOffset[0]=this.clampOffset/i.pixelWidth,this.uClampOffset[1]=this.clampOffset/i.pixelHeight,this.isSimple=e.frame.width===i.width&&e.frame.height===i.height&&e.rotate===0,!0}}class J extends xt{constructor({source:e,label:r,frame:s,orig:n,trim:i,defaultAnchor:a,defaultBorders:o,rotate:l,dynamic:c}={}){if(super(),this.uid=xe("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new ge,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=r,this.source=e?.source??new yt,this.noFrame=!s,s)this.frame.copyFrom(s);else{const{width:h,height:u}=this._source;this.frame.width=h,this.frame.height=u}this.orig=n||this.frame,this.trim=i,this.rotate=l??0,this.defaultAnchor=a,this.defaultBorders=o,this.destroyed=!1,this.dynamic=c||!1,this.updateUvs()}set source(e){this._source&&this._source.off("resize",this.update,this),this._source=e,e.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Ed(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:e,frame:r}=this,{width:s,height:n}=this._source,i=r.x/s,a=r.y/n,o=r.width/s,l=r.height/n;let c=this.rotate;if(c){const h=o/2,u=l/2,f=i+h,d=a+u;c=he.add(c,he.NW),e.x0=f+h*he.uX(c),e.y0=d+u*he.uY(c),c=he.add(c,2),e.x1=f+h*he.uX(c),e.y1=d+u*he.uY(c),c=he.add(c,2),e.x2=f+h*he.uX(c),e.y2=d+u*he.uY(c),c=he.add(c,2),e.x3=f+h*he.uX(c),e.y3=d+u*he.uY(c)}else e.x0=i,e.y0=a,e.x1=i+o,e.y1=a,e.x2=i+o,e.y2=a+l,e.x3=i,e.y3=a+l}destroy(e=!1){this._source&&e&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return me(Pe,"Texture.baseTexture is now Texture.source"),this._source}}J.EMPTY=new J({label:"EMPTY",source:new yt({label:"EMPTY"})});J.EMPTY.destroy=Bc;J.WHITE=new J({source:new Yi({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});J.WHITE.destroy=Bc;function Rd(t,e,r){const{width:s,height:n}=r.orig,i=r.trim;if(i){const a=i.width,o=i.height;t.minX=i.x-e._x*s,t.maxX=t.minX+a,t.minY=i.y-e._y*n,t.maxY=t.minY+o}else t.minX=-e._x*s,t.maxX=t.minX+s,t.minY=-e._y*n,t.maxY=t.minY+n}const Wa=new ee;class ot{constructor(e=1/0,r=1/0,s=-1/0,n=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Wa,this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new ge);const e=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(e.x=0,e.y=0,e.width=0,e.height=0):e.copyFromBounds(this),e}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Wa,this}set(e,r,s,n){this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}addFrame(e,r,s,n,i){i||(i=this.matrix);const a=i.a,o=i.b,l=i.c,c=i.d,h=i.tx,u=i.ty;let f=this.minX,d=this.minY,g=this.maxX,x=this.maxY,m=a*e+l*r+h,w=o*e+c*r+u;m<f&&(f=m),w<d&&(d=w),m>g&&(g=m),w>x&&(x=w),m=a*s+l*r+h,w=o*s+c*r+u,m<f&&(f=m),w<d&&(d=w),m>g&&(g=m),w>x&&(x=w),m=a*e+l*n+h,w=o*e+c*n+u,m<f&&(f=m),w<d&&(d=w),m>g&&(g=m),w>x&&(x=w),m=a*s+l*n+h,w=o*s+c*n+u,m<f&&(f=m),w<d&&(d=w),m>g&&(g=m),w>x&&(x=w),this.minX=f,this.minY=d,this.maxX=g,this.maxY=x}addRect(e,r){this.addFrame(e.x,e.y,e.x+e.width,e.y+e.height,r)}addBounds(e,r){this.addFrame(e.minX,e.minY,e.maxX,e.maxY,r)}addBoundsMask(e){this.minX=this.minX>e.minX?this.minX:e.minX,this.minY=this.minY>e.minY?this.minY:e.minY,this.maxX=this.maxX<e.maxX?this.maxX:e.maxX,this.maxY=this.maxY<e.maxY?this.maxY:e.maxY}applyMatrix(e){const r=this.minX,s=this.minY,n=this.maxX,i=this.maxY,{a,b:o,c:l,d:c,tx:h,ty:u}=e;let f=a*r+l*s+h,d=o*r+c*s+u;this.minX=f,this.minY=d,this.maxX=f,this.maxY=d,f=a*n+l*s+h,d=o*n+c*s+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY,f=a*r+l*i+h,d=o*r+c*i+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY,f=a*n+l*i+h,d=o*n+c*i+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY}fit(e){return this.minX<e.left&&(this.minX=e.left),this.maxX>e.right&&(this.maxX=e.right),this.minY<e.top&&(this.minY=e.top),this.maxY>e.bottom&&(this.maxY=e.bottom),this}fitBounds(e,r,s,n){return this.minX<e&&(this.minX=e),this.maxX>r&&(this.maxX=r),this.minY<s&&(this.minY=s),this.maxY>n&&(this.maxY=n),this}pad(e,r=e){return this.minX-=e,this.maxX+=e,this.minY-=r,this.maxY+=r,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new ot(this.minX,this.minY,this.maxX,this.maxY)}scale(e,r=e){return this.minX*=e,this.minY*=r,this.maxX*=e,this.maxY*=r,this}get x(){return this.minX}set x(e){const r=this.maxX-this.minX;this.minX=e,this.maxX=e+r}get y(){return this.minY}set y(e){const r=this.maxY-this.minY;this.minY=e,this.maxY=e+r}get width(){return this.maxX-this.minX}set width(e){this.maxX=this.minX+e}get height(){return this.maxY-this.minY}set height(e){this.maxY=this.minY+e}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(e,r,s,n){let i=this.minX,a=this.minY,o=this.maxX,l=this.maxY;n||(n=this.matrix);const c=n.a,h=n.b,u=n.c,f=n.d,d=n.tx,g=n.ty;for(let x=r;x<s;x+=2){const m=e[x],w=e[x+1],b=c*m+u*w+d,A=h*m+f*w+g;i=b<i?b:i,a=A<a?A:a,o=b>o?b:o,l=A>l?A:l}this.minX=i,this.minY=a,this.maxX=o,this.maxY=l}containsPoint(e,r){return this.minX<=e&&this.minY<=r&&this.maxX>=e&&this.maxY>=r}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this}}var jd={grad:.9,turn:360,rad:360/(2*Math.PI)},wt=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},ve=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},et=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),t>r?r:t>e?t:e},Gc=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},Ua=function(t){return{r:et(t.r,0,255),g:et(t.g,0,255),b:et(t.b,0,255),a:et(t.a)}},on=function(t){return{r:ve(t.r),g:ve(t.g),b:ve(t.b),a:ve(t.a,3)}},Bd=/^#([0-9a-f]{3,8})$/i,as=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},Dc=function(t){var e=t.r,r=t.g,s=t.b,n=t.a,i=Math.max(e,r,s),a=i-Math.min(e,r,s),o=a?i===e?(r-s)/a:i===r?2+(s-e)/a:4+(e-r)/a:0;return{h:60*(o<0?o+6:o),s:i?a/i*100:0,v:i/255*100,a:n}},$c=function(t){var e=t.h,r=t.s,s=t.v,n=t.a;e=e/360*6,r/=100,s/=100;var i=Math.floor(e),a=s*(1-r),o=s*(1-(e-i)*r),l=s*(1-(1-e+i)*r),c=i%6;return{r:255*[s,o,a,a,l,s][c],g:255*[l,s,s,o,a,a][c],b:255*[a,a,l,s,s,o][c],a:n}},Va=function(t){return{h:Gc(t.h),s:et(t.s,0,100),l:et(t.l,0,100),a:et(t.a)}},qa=function(t){return{h:ve(t.h),s:ve(t.s),l:ve(t.l),a:ve(t.a,3)}},Ya=function(t){return $c((r=(e=t).s,{h:e.h,s:(r*=((s=e.l)<50?s:100-s)/100)>0?2*r/(s+r)*100:0,v:s+r,a:e.a}));var e,r,s},Dr=function(t){return{h:(e=Dc(t)).h,s:(n=(200-(r=e.s))*(s=e.v)/100)>0&&n<200?r*s/100/(n<=100?n:200-n)*100:0,l:n/2,a:e.a};var e,r,s,n},zd=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Fd=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Od=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Nd=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,xi={string:[[function(t){var e=Bd.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?ve(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?ve(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=Od.exec(t)||Nd.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:Ua({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=zd.exec(t)||Fd.exec(t);if(!e)return null;var r,s,n=Va({h:(r=e[1],s=e[2],s===void 0&&(s="deg"),Number(r)*(jd[s]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return Ya(n)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,s=t.b,n=t.a,i=n===void 0?1:n;return wt(e)&&wt(r)&&wt(s)?Ua({r:Number(e),g:Number(r),b:Number(s),a:Number(i)}):null},"rgb"],[function(t){var e=t.h,r=t.s,s=t.l,n=t.a,i=n===void 0?1:n;if(!wt(e)||!wt(r)||!wt(s))return null;var a=Va({h:Number(e),s:Number(r),l:Number(s),a:Number(i)});return Ya(a)},"hsl"],[function(t){var e=t.h,r=t.s,s=t.v,n=t.a,i=n===void 0?1:n;if(!wt(e)||!wt(r)||!wt(s))return null;var a=function(o){return{h:Gc(o.h),s:et(o.s,0,100),v:et(o.v,0,100),a:et(o.a)}}({h:Number(e),s:Number(r),v:Number(s),a:Number(i)});return $c(a)},"hsv"]]},Xa=function(t,e){for(var r=0;r<e.length;r++){var s=e[r][0](t);if(s)return[s,e[r][1]]}return[null,void 0]},Ld=function(t){return typeof t=="string"?Xa(t.trim(),xi.string):typeof t=="object"&&t!==null?Xa(t,xi.object):[null,void 0]},ln=function(t,e){var r=Dr(t);return{h:r.h,s:et(r.s+100*e,0,100),l:r.l,a:r.a}},cn=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Ka=function(t,e){var r=Dr(t);return{h:r.h,s:r.s,l:et(r.l+100*e,0,100),a:r.a}},yi=function(){function t(e){this.parsed=Ld(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return ve(cn(this.rgba),2)},t.prototype.isDark=function(){return cn(this.rgba)<.5},t.prototype.isLight=function(){return cn(this.rgba)>=.5},t.prototype.toHex=function(){return e=on(this.rgba),r=e.r,s=e.g,n=e.b,a=(i=e.a)<1?as(ve(255*i)):"","#"+as(r)+as(s)+as(n)+a;var e,r,s,n,i,a},t.prototype.toRgb=function(){return on(this.rgba)},t.prototype.toRgbString=function(){return e=on(this.rgba),r=e.r,s=e.g,n=e.b,(i=e.a)<1?"rgba("+r+", "+s+", "+n+", "+i+")":"rgb("+r+", "+s+", "+n+")";var e,r,s,n,i},t.prototype.toHsl=function(){return qa(Dr(this.rgba))},t.prototype.toHslString=function(){return e=qa(Dr(this.rgba)),r=e.h,s=e.s,n=e.l,(i=e.a)<1?"hsla("+r+", "+s+"%, "+n+"%, "+i+")":"hsl("+r+", "+s+"%, "+n+"%)";var e,r,s,n,i},t.prototype.toHsv=function(){return e=Dc(this.rgba),{h:ve(e.h),s:ve(e.s),v:ve(e.v),a:ve(e.a,3)};var e},t.prototype.invert=function(){return dt({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),dt(ln(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),dt(ln(this.rgba,-e))},t.prototype.grayscale=function(){return dt(ln(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),dt(Ka(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),dt(Ka(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?dt({r:(r=this.rgba).r,g:r.g,b:r.b,a:e}):ve(this.rgba.a,3);var r},t.prototype.hue=function(e){var r=Dr(this.rgba);return typeof e=="number"?dt({h:e,s:r.s,l:r.l,a:r.a}):ve(r.h)},t.prototype.isEqual=function(e){return this.toHex()===dt(e).toHex()},t}(),dt=function(t){return t instanceof yi?t:new yi(t)},Za=[],Gd=function(t){t.forEach(function(e){Za.indexOf(e)<0&&(e(yi,xi),Za.push(e))})};function Dd(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},s={};for(var n in r)s[r[n]]=n;var i={};t.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,l,c=s[this.toHex()];if(c)return c;if(a?.closest){var h=this.toRgb(),u=1/0,f="black";if(!i.length)for(var d in r)i[d]=new t(r[d]).toRgb();for(var g in r){var x=(o=h,l=i[g],Math.pow(o.r-l.r,2)+Math.pow(o.g-l.g,2)+Math.pow(o.b-l.b,2));x<u&&(u=x,f=g)}return f}},e.string.push([function(a){var o=a.toLowerCase(),l=o==="transparent"?"#0000":r[o];return l?new t(l).toRgb():null},"name"])}Gd([Dd]);const mr=class Br{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof Br)this._value=this._cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,e))&&(this._value=this._cloneSource(e),this._normalize(this._value))}}get value(){return this._value}_cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}_isSourceEqual(e,r){const s=typeof e;if(s!==typeof r)return!1;if(s==="number"||s==="string"||e instanceof Number)return e===r;if(Array.isArray(e)&&Array.isArray(r)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(r))return e.length!==r.length?!1:e.every((i,a)=>i===r[a]);if(e!==null&&r!==null){const i=Object.keys(e),a=Object.keys(r);return i.length!==a.length?!1:i.every(o=>e[o]===r[o])}return e===r}toRgba(){const[e,r,s,n]=this._components;return{r:e,g:r,b:s,a:n}}toRgb(){const[e,r,s]=this._components;return{r:e,g:r,b:s}}toRgbaString(){const[e,r,s]=this.toUint8RgbArray();return`rgba(${e},${r},${s},${this.alpha})`}toUint8RgbArray(e){const[r,s,n]=this._components;return this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb),e[0]=Math.round(r*255),e[1]=Math.round(s*255),e[2]=Math.round(n*255),e}toArray(e){this._arrayRgba||(this._arrayRgba=[]),e||(e=this._arrayRgba);const[r,s,n,i]=this._components;return e[0]=r,e[1]=s,e[2]=n,e[3]=i,e}toRgbArray(e){this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb);const[r,s,n]=this._components;return e[0]=r,e[1]=s,e[2]=n,e}toNumber(){return this._int}toBgrNumber(){const[e,r,s]=this.toUint8RgbArray();return(s<<16)+(r<<8)+e}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[r,s,n,i]=Br._temp.setValue(e)._components;return this._components[0]*=r,this._components[1]*=s,this._components[2]*=n,this._components[3]*=i,this._refreshInt(),this._value=null,this}premultiply(e,r=!0){return r&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this._refreshInt(),this._value=null,this}toPremultiplied(e,r=!0){if(e===1)return(255<<24)+this._int;if(e===0)return r?0:this._int;let s=this._int>>16&255,n=this._int>>8&255,i=this._int&255;return r&&(s=s*e+.5|0,n=n*e+.5|0,i=i*e+.5|0),(e*255<<24)+(s<<16)+(n<<8)+i}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const r=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-r.length)+r}setAlpha(e){return this._components[3]=this._clamp(e),this}_normalize(e){let r,s,n,i;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const a=e;r=(a>>16&255)/255,s=(a>>8&255)/255,n=(a&255)/255,i=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[r,s,n,i=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[r,s,n,i=255]=e,r/=255,s/=255,n/=255,i/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const o=Br.HEX_PATTERN.exec(e);o&&(e=`#${o[2]}`)}const a=dt(e);a.isValid()&&({r,g:s,b:n,a:i}=a.rgba,r/=255,s/=255,n/=255)}if(r!==void 0)this._components[0]=r,this._components[1]=s,this._components[2]=n,this._components[3]=i,this._refreshInt();else throw new Error(`Unable to convert color ${e}`)}_refreshInt(){this._clamp(this._components);const[e,r,s]=this._components;this._int=(e*255<<16)+(r*255<<8)+(s*255|0)}_clamp(e,r=0,s=1){return typeof e=="number"?Math.min(Math.max(e,r),s):(e.forEach((n,i)=>{e[i]=Math.min(Math.max(n,r),s)}),e)}static isColorLike(e){return typeof e=="number"||typeof e=="string"||e instanceof Number||e instanceof Br||Array.isArray(e)||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e.r!==void 0&&e.g!==void 0&&e.b!==void 0||e.r!==void 0&&e.g!==void 0&&e.b!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0&&e.a!==void 0}};mr.shared=new mr;mr._temp=new mr;mr.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let ke=mr;const $d={cullArea:null,cullable:!1,cullableChildren:!0};class Xi{constructor(e,r){this._pool=[],this._count=0,this._index=0,this._classType=e,r&&this.prepopulate(r)}prepopulate(e){for(let r=0;r<e;r++)this._pool[this._index++]=new this._classType;this._count+=e}get(e){let r;return this._index>0?r=this._pool[--this._index]:r=new this._classType,r.init?.(e),r}return(e){e.reset?.(),this._pool[this._index++]=e}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){this._pool.length=0,this._index=0}}class Hd{constructor(){this._poolsByClass=new Map}prepopulate(e,r){this.getPool(e).prepopulate(r)}get(e,r){return this.getPool(e).get(r)}return(e){this.getPool(e.constructor).return(e)}getPool(e){return this._poolsByClass.has(e)||this._poolsByClass.set(e,new Xi(e)),this._poolsByClass.get(e)}stats(){const e={};return this._poolsByClass.forEach(r=>{const s=e[r._classType.name]?r._classType.name+r._classType.ID:r._classType.name;e[s]={free:r.totalFree,used:r.totalUsed,size:r.totalSize}}),e}}const kt=new Hd,Wd={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(t){typeof t=="boolean"&&t===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(t===!0?{}:t))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(t){me("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(t)}};function Ud(t,e,r){const s=t.length;let n;if(e>=s||r===0)return;r=e+r>s?s-e:r;const i=s-r;for(n=e;n<i;++n)t[n]=t[n+r];t.length=i}const Vd={allowChildren:!0,removeChildren(t=0,e){const r=e??this.children.length,s=r-t,n=[];if(s>0&&s<=r){for(let a=r-1;a>=t;a--){const o=this.children[a];o&&(n.push(o),o.parent=null)}Ud(this.children,t,r);const i=this.renderGroup||this.parentRenderGroup;i&&i.removeChildren(n);for(let a=0;a<n.length;++a)this.emit("childRemoved",n[a],this,a),n[a].emit("removed",this);return n.length>0&&this._didViewChangeTick++,n}else if(s===0&&this.children.length===0)return n;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(t){const e=this.getChildAt(t);return this.removeChild(e)},getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]},setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);this.getChildIndex(t),this.addChildAt(t,e)},getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied Container must be a child of the caller");return e},addChildAt(t,e){this.allowChildren||me(Pe,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:r}=this;if(e<0||e>r.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${r.length}`);if(t.parent){const n=t.parent.children.indexOf(t);if(t.parent===this&&n===e)return t;n!==-1&&t.parent.children.splice(n,1)}e===r.length?r.push(t):r.splice(e,0,t),t.parent=this,t.didChange=!0,t._updateFlags=15;const s=this.renderGroup||this.parentRenderGroup;return s&&s.addChild(t),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",t,this,e),t.emit("added",this),t},swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),s=this.getChildIndex(e);this.children[r]=e,this.children[s]=t;const n=this.renderGroup||this.parentRenderGroup;n&&(n.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...t){return t.length===1?this.reparentChildAt(t[0],this.children.length):(t.forEach(e=>this.reparentChildAt(e,this.children.length)),t[0])},reparentChildAt(t,e){if(t.parent===this)return this.setChildIndex(t,e),t;const r=t.worldTransform.clone();t.removeFromParent(),this.addChildAt(t,e);const s=this.worldTransform.clone();return s.invert(),r.prepend(s),t.setFromMatrix(r),t}},qd={collectRenderables(t,e,r){this.parentRenderLayer&&this.parentRenderLayer!==r||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(t,e,r):this.renderGroup?e.renderPipes.renderGroup.addRenderGroup(this.renderGroup,t):this.collectRenderablesWithEffects(t,e,r))},collectRenderablesSimple(t,e,r){const s=this.children,n=s.length;for(let i=0;i<n;i++)s[i].collectRenderables(t,e,r)},collectRenderablesWithEffects(t,e,r){const{renderPipes:s}=e;for(let n=0;n<this.effects.length;n++){const i=this.effects[n];s[i.pipe].push(i,this,t)}this.collectRenderablesSimple(t,e,r);for(let n=this.effects.length-1;n>=0;n--){const i=this.effects[n];s[i.pipe].pop(i,this,t)}}};class Qa{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let e=0;e<this.filters.length;e++)this.filters[e].destroy();this.filters=null,this.filterArea=null}}class Yd{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(e=>{this.add({test:e.test,maskClass:e})}))}add(e){this._tests.push(e)}getMaskEffect(e){this._initialized||this.init();for(let r=0;r<this._tests.length;r++){const s=this._tests[r];if(s.test(e))return kt.get(s.maskClass,e)}return e}returnMaskEffect(e){kt.return(e)}}const bi=new Yd;Be.handleByList(U.MaskEffect,bi._effectClasses);const Xd={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const t=this.renderGroup||this.parentRenderGroup;t&&(t.structureDidChange=!0)},addEffect(t){this.effects.indexOf(t)===-1&&(this.effects.push(t),this.effects.sort((r,s)=>r.priority-s.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(t){const e=this.effects.indexOf(t);e!==-1&&(this.effects.splice(e,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(t){const e=this._maskEffect;e?.mask!==t&&(e&&(this.removeEffect(e),bi.returnMaskEffect(e),this._maskEffect=null),t!=null&&(this._maskEffect=bi.getMaskEffect(t),this.addEffect(this._maskEffect)))},setMask(t){this._maskOptions={...this._maskOptions,...t},t.mask&&(this.mask=t.mask),this._markStructureAsChanged()},get mask(){return this._maskEffect?.mask},set filters(t){!Array.isArray(t)&&t&&(t=[t]);const e=this._filterEffect||(this._filterEffect=new Qa);t=t;const r=t?.length>0,s=e.filters?.length>0,n=r!==s;t=Array.isArray(t)?t.slice(0):t,e.filters=Object.freeze(t),n&&(r?this.addEffect(e):(this.removeEffect(e),e.filters=t??null))},get filters(){return this._filterEffect?.filters},set filterArea(t){this._filterEffect||(this._filterEffect=new Qa),this._filterEffect.filterArea=t},get filterArea(){return this._filterEffect?.filterArea}},Kd={label:null,get name(){return me(Pe,"Container.name property has been removed, use Container.label instead"),this.label},set name(t){me(Pe,"Container.name property has been removed, use Container.label instead"),this.label=t},getChildByName(t,e=!1){return this.getChildByLabel(t,e)},getChildByLabel(t,e=!1){const r=this.children;for(let s=0;s<r.length;s++){const n=r[s];if(n.label===t||t instanceof RegExp&&t.test(n.label))return n}if(e)for(let s=0;s<r.length;s++){const i=r[s].getChildByLabel(t,!0);if(i)return i}return null},getChildrenByLabel(t,e=!1,r=[]){const s=this.children;for(let n=0;n<s.length;n++){const i=s[n];(i.label===t||t instanceof RegExp&&t.test(i.label))&&r.push(i)}if(e)for(let n=0;n<s.length;n++)s[n].getChildrenByLabel(t,!0,r);return r}},Ee=new Xi(ee),Ct=new Xi(ot),Zd=new ee,Qd={getFastGlobalBounds(t,e){e||(e=new ot),e.clear(),this._getGlobalBoundsRecursive(!!t,e,this.parentRenderLayer),e.isValid||e.set(0,0,0,0);const r=this.renderGroup||this.parentRenderGroup;return e.applyMatrix(r.worldTransform),e},_getGlobalBoundsRecursive(t,e,r){let s=e;if(t&&this.parentRenderLayer&&this.parentRenderLayer!==r||this.localDisplayStatus!==7||!this.measurable)return;const n=!!this.effects.length;if((this.renderGroup||n)&&(s=Ct.get().clear()),this.boundsArea)e.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const a=this.bounds;s.addFrame(a.minX,a.minY,a.maxX,a.maxY,this.groupTransform)}const i=this.children;for(let a=0;a<i.length;a++)i[a]._getGlobalBoundsRecursive(t,s,r)}if(n){let i=!1;const a=this.renderGroup||this.parentRenderGroup;for(let o=0;o<this.effects.length;o++)this.effects[o].addBounds&&(i||(i=!0,s.applyMatrix(a.worldTransform)),this.effects[o].addBounds(s,!0));i&&(s.applyMatrix(a.worldTransform.copyTo(Zd).invert()),e.addBounds(s,this.relativeGroupTransform)),e.addBounds(s),Ct.return(s)}else this.renderGroup&&(e.addBounds(s,this.relativeGroupTransform),Ct.return(s))}};function Hc(t,e,r){r.clear();let s,n;return t.parent?e?s=t.parent.worldTransform:(n=Ee.get().identity(),s=Ki(t,n)):s=ee.IDENTITY,Wc(t,r,s,e),n&&Ee.return(n),r.isValid||r.set(0,0,0,0),r}function Wc(t,e,r,s){if(!t.visible||!t.measurable)return;let n;s?n=t.worldTransform:(t.updateLocalTransform(),n=Ee.get(),n.appendFrom(t.localTransform,r));const i=e,a=!!t.effects.length;if(a&&(e=Ct.get().clear()),t.boundsArea)e.addRect(t.boundsArea,n);else{t.bounds&&(e.matrix=n,e.addBounds(t.bounds));for(let o=0;o<t.children.length;o++)Wc(t.children[o],e,n,s)}if(a){for(let o=0;o<t.effects.length;o++)t.effects[o].addBounds?.(e);i.addBounds(e,ee.IDENTITY),Ct.return(e)}s||Ee.return(n)}function Ki(t,e){const r=t.parent;return r&&(Ki(r,e),r.updateLocalTransform(),e.append(r.localTransform)),e}function Uc(t,e){if(t===16777215||!e)return e;if(e===16777215||!t)return t;const r=t>>16&255,s=t>>8&255,n=t&255,i=e>>16&255,a=e>>8&255,o=e&255,l=r*i/255|0,c=s*a/255|0,h=n*o/255|0;return(l<<16)+(c<<8)+h}const Ja=16777215;function eo(t,e){return t===Ja?e:e===Ja?t:Uc(t,e)}function As(t){return((t&255)<<16)+(t&65280)+(t>>16&255)}const Jd={getGlobalAlpha(t){if(t)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let e=this.alpha,r=this.parent;for(;r;)e*=r.alpha,r=r.parent;return e},getGlobalTransform(t,e){if(e)return t.copyFrom(this.worldTransform);this.updateLocalTransform();const r=Ki(this,Ee.get().identity());return t.appendFrom(this.localTransform,r),Ee.return(r),t},getGlobalTint(t){if(t)return this.renderGroup?As(this.renderGroup.worldColor):this.parentRenderGroup?As(eo(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let e=this.localColor,r=this.parent;for(;r;)e=eo(e,r.localColor),r=r.parent;return As(e)}};let hn=0;const to=500;function ue(...t){hn!==to&&(hn++,hn===to?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...t))}function Vc(t,e,r){return e.clear(),r||(r=ee.IDENTITY),qc(t,e,r,t,!0),e.isValid||e.set(0,0,0,0),e}function qc(t,e,r,s,n){let i;if(n)i=Ee.get(),i=r.copyTo(i);else{if(!t.visible||!t.measurable)return;t.updateLocalTransform();const l=t.localTransform;i=Ee.get(),i.appendFrom(l,r)}const a=e,o=!!t.effects.length;if(o&&(e=Ct.get().clear()),t.boundsArea)e.addRect(t.boundsArea,i);else{t.renderPipeId&&(e.matrix=i,e.addBounds(t.bounds));const l=t.children;for(let c=0;c<l.length;c++)qc(l[c],e,i,s,!1)}if(o){for(let l=0;l<t.effects.length;l++)t.effects[l].addLocalBounds?.(e,s);a.addBounds(e,ee.IDENTITY),Ct.return(e)}Ee.return(i)}function Yc(t,e){const r=t.children;for(let s=0;s<r.length;s++){const n=r[s],i=n.uid,a=(n._didViewChangeTick&65535)<<16|n._didContainerChangeTick&65535,o=e.index;(e.data[o]!==i||e.data[o+1]!==a)&&(e.data[e.index]=i,e.data[e.index+1]=a,e.didChange=!0),e.index=o+2,n.children.length&&Yc(n,e)}return e.didChange}const ef=new ee,tf={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(t,e){const r=Math.sign(this.scale.x)||1;e!==0?this.scale.x=t/e*r:this.scale.x=r},_setHeight(t,e){const r=Math.sign(this.scale.y)||1;e!==0?this.scale.y=t/e*r:this.scale.y=r},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new ot});const t=this._localBoundsCacheData;return t.index=1,t.didChange=!1,t.data[0]!==this._didViewChangeTick&&(t.didChange=!0,t.data[0]=this._didViewChangeTick),Yc(this,t),t.didChange&&Vc(this,t.localBounds,ef),t.localBounds},getBounds(t,e){return Hc(this,t,e||new ot)}},rf={_onRender:null,set onRender(t){const e=this.renderGroup||this.parentRenderGroup;if(!t){this._onRender&&e?.removeOnRender(this),this._onRender=null;return}this._onRender||e?.addOnRender(this),this._onRender=t},get onRender(){return this._onRender}},sf={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(nf))}};function nf(t,e){return t._zIndex-e._zIndex}const af={getGlobalPosition(t=new Me,e=!1){return this.parent?this.parent.toGlobal(this._position,t,e):(t.x=this._position.x,t.y=this._position.y),t},toGlobal(t,e,r=!1){const s=this.getGlobalTransform(Ee.get(),r);return e=s.apply(t,e),Ee.return(s),e},toLocal(t,e,r,s){e&&(t=e.toGlobal(t,r,s));const n=this.getGlobalTransform(Ee.get(),s);return r=n.applyInverse(t,r),Ee.return(n),r}};class Xc{constructor(){this.uid=xe("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}add(e){this.instructions[this.instructionSize++]=e}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let of=0;class lf{constructor(e){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1}createTexture(e,r,s){const n=new yt({...this.textureOptions,width:e,height:r,resolution:1,antialias:s,autoGarbageCollect:!1});return new J({source:n,label:`texturePool_${of++}`})}getOptimalTexture(e,r,s=1,n){let i=Math.ceil(e*s-1e-6),a=Math.ceil(r*s-1e-6);i=Ts(i),a=Ts(a);const o=(i<<17)+(a<<1)+(n?1:0);this._texturePool[o]||(this._texturePool[o]=[]);let l=this._texturePool[o].pop();return l||(l=this.createTexture(i,a,n)),l.source._resolution=s,l.source.width=i/s,l.source.height=a/s,l.source.pixelWidth=i,l.source.pixelHeight=a,l.frame.x=0,l.frame.y=0,l.frame.width=e,l.frame.height=r,l.updateUvs(),this._poolKeyHash[l.uid]=o,l}getSameSizeTexture(e,r=!1){const s=e.source;return this.getOptimalTexture(e.width,e.height,s._resolution,r)}returnTexture(e){const r=this._poolKeyHash[e.uid];this._texturePool[r].push(e)}clear(e){if(e=e!==!1,e)for(const r in this._texturePool){const s=this._texturePool[r];if(s)for(let n=0;n<s.length;n++)s[n].destroy(!0)}this._texturePool={}}}const cf=new lf;class hf{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new ee,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new Xc,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(e){this.root=e,e._onRender&&this.addOnRender(e),e.didChange=!0;const r=e.children;for(let s=0;s<r.length;s++){const n=r[s];n._updateFlags=15,this.addChild(n)}}enableCacheAsTexture(e={}){this.textureOptions=e,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(cf.returnTexture(this.texture),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0}reset(){this.renderGroupChildren.length=0;for(const e in this.childrenToUpdate){const r=this.childrenToUpdate[e];r.list.fill(null),r.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(e){e.renderGroupParent&&e.renderGroupParent._removeRenderGroupChild(e),e.renderGroupParent=this,this.renderGroupChildren.push(e)}_removeRenderGroupChild(e){const r=this.renderGroupChildren.indexOf(e);r>-1&&this.renderGroupChildren.splice(r,1),e.renderGroupParent=null}addChild(e){if(this.structureDidChange=!0,e.parentRenderGroup=this,e.updateTick=-1,e.parent===this.root?e.relativeRenderGroupDepth=1:e.relativeRenderGroupDepth=e.parent.relativeRenderGroupDepth+1,e.didChange=!0,this.onChildUpdate(e),e.renderGroup){this.addRenderGroupChild(e.renderGroup);return}e._onRender&&this.addOnRender(e);const r=e.children;for(let s=0;s<r.length;s++)this.addChild(r[s])}removeChild(e){if(this.structureDidChange=!0,e._onRender&&(e.renderGroup||this.removeOnRender(e)),e.parentRenderGroup=null,e.renderGroup){this._removeRenderGroupChild(e.renderGroup);return}const r=e.children;for(let s=0;s<r.length;s++)this.removeChild(r[s])}removeChildren(e){for(let r=0;r<e.length;r++)this.removeChild(e[r])}onChildUpdate(e){let r=this.childrenToUpdate[e.relativeRenderGroupDepth];r||(r=this.childrenToUpdate[e.relativeRenderGroupDepth]={index:0,list:[]}),r.list[r.index++]=e}updateRenderable(e){e.globalDisplayStatus<7||(this.instructionSet.renderPipes[e.renderPipeId].updateRenderable(e),e.didViewUpdate=!1)}onChildViewUpdate(e){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=e}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(e){this._onRenderContainers.push(e)}removeOnRender(e){this._onRenderContainers.splice(this._onRenderContainers.indexOf(e),1)}runOnRender(e){for(let r=0;r<this._onRenderContainers.length;r++)this._onRenderContainers[r]._onRender(e)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(e=[]){const r=this.root.children;for(let s=0;s<r.length;s++)this._getChildren(r[s],e);return e}_getChildren(e,r=[]){if(r.push(e),e.renderGroup)return r;const s=e.children;for(let n=0;n<s.length;n++)this._getChildren(s[n],r);return r}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return(this._matrixDirty&1)===0?this._inverseWorldTransform:(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new ee),this._inverseWorldTransform.copyFrom(this.worldTransform).invert())}get textureOffsetInverseTransform(){return(this._matrixDirty&2)===0?this._textureOffsetInverseTransform:(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new ee),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y))}get inverseParentTextureTransform(){if((this._matrixDirty&4)===0)return this._inverseParentTextureTransform;this._matrixDirty&=-5;const e=this._parentCacheAsTextureRenderGroup;return e?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new ee),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(e.inverseWorldTransform).translate(-e._textureBounds.x,-e._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function uf(t,e,r={}){for(const s in e)!r[s]&&e[s]!==void 0&&(t[s]=e[s])}const un=new De(null),dn=new De(null),fn=new De(null,1,1),ro=1,df=2,pn=4;class Jr extends xt{constructor(e={}){super(),this.uid=xe("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new ee,this.relativeGroupTransform=new ee,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new De(this,0,0),this._scale=fn,this._pivot=dn,this._skew=un,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],uf(this,e,{children:!0,parent:!0,effects:!0}),e.children?.forEach(r=>this.addChild(r)),e.parent?.addChild(this)}static mixin(e){me("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),Be.mixin(Jr,e)}set _didChangeId(e){this._didViewChangeTick=e>>12&4095,this._didContainerChangeTick=e&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...e){if(this.allowChildren||me(Pe,"addChild: Only Containers will be allowed to add children in v8.0.0"),e.length>1){for(let n=0;n<e.length;n++)this.addChild(e[n]);return e[0]}const r=e[0],s=this.renderGroup||this.parentRenderGroup;return r.parent===this?(this.children.splice(this.children.indexOf(r),1),this.children.push(r),s&&(s.structureDidChange=!0),r):(r.parent&&r.parent.removeChild(r),this.children.push(r),this.sortableChildren&&(this.sortDirty=!0),r.parent=this,r.didChange=!0,r._updateFlags=15,s&&s.addChild(r),this.emit("childAdded",r,this,this.children.length-1),r.emit("added",this),this._didViewChangeTick++,r._zIndex!==0&&r.depthOfChildModified(),r)}removeChild(...e){if(e.length>1){for(let n=0;n<e.length;n++)this.removeChild(e[n]);return e[0]}const r=e[0],s=this.children.indexOf(r);return s>-1&&(this._didViewChangeTick++,this.children.splice(s,1),this.renderGroup?this.renderGroup.removeChild(r):this.parentRenderGroup&&this.parentRenderGroup.removeChild(r),r.parentRenderLayer&&r.parentRenderLayer.detach(r),r.parent=null,this.emit("childRemoved",r,this,s),r.emit("removed",this)),r}_onUpdate(e){e&&e===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(e){!!this.renderGroup!==e&&(e?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const e=this.parentRenderGroup;e?.removeChild(this),this.renderGroup=kt.get(hf,this),this.groupTransform=ee.IDENTITY,e?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const e=this.parentRenderGroup;e?.removeChild(this),kt.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,e?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new ee),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(e){this._position.x=e}get y(){return this._position.y}set y(e){this._position.y=e}get position(){return this._position}set position(e){this._position.copyFrom(e)}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this._skew))}get angle(){return this.rotation*Sd}set angle(e){this.rotation=e*Ad}get pivot(){return this._pivot===dn&&(this._pivot=new De(this,0,0)),this._pivot}set pivot(e){this._pivot===dn&&(this._pivot=new De(this,0,0)),typeof e=="number"?this._pivot.set(e):this._pivot.copyFrom(e)}get skew(){return this._skew===un&&(this._skew=new De(this,0,0)),this._skew}set skew(e){this._skew===un&&(this._skew=new De(this,0,0)),this._skew.copyFrom(e)}get scale(){return this._scale===fn&&(this._scale=new De(this,1,1)),this._scale}set scale(e){this._scale===fn&&(this._scale=new De(this,0,0)),typeof e=="number"?this._scale.set(e):this._scale.copyFrom(e)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(e){const r=this.getLocalBounds().width;this._setWidth(e,r)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(e){const r=this.getLocalBounds().height;this._setHeight(e,r)}getSize(e){e||(e={});const r=this.getLocalBounds();return e.width=Math.abs(this.scale.x*r.width),e.height=Math.abs(this.scale.y*r.height),e}setSize(e,r){const s=this.getLocalBounds();typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,s.width),r!==void 0&&this._setHeight(r,s.height)}_updateSkew(){const e=this._rotation,r=this._skew;this._cx=Math.cos(e+r._y),this._sx=Math.sin(e+r._y),this._cy=-Math.sin(e-r._x),this._sy=Math.cos(e-r._x)}updateTransform(e){return this.position.set(typeof e.x=="number"?e.x:this.position.x,typeof e.y=="number"?e.y:this.position.y),this.scale.set(typeof e.scaleX=="number"?e.scaleX||1:this.scale.x,typeof e.scaleY=="number"?e.scaleY||1:this.scale.y),this.rotation=typeof e.rotation=="number"?e.rotation:this.rotation,this.skew.set(typeof e.skewX=="number"?e.skewX:this.skew.x,typeof e.skewY=="number"?e.skewY:this.skew.y),this.pivot.set(typeof e.pivotX=="number"?e.pivotX:this.pivot.x,typeof e.pivotY=="number"?e.pivotY:this.pivot.y),this}setFromMatrix(e){e.decompose(this)}updateLocalTransform(){const e=this._didContainerChangeTick;if(this._didLocalTransformChangeId===e)return;this._didLocalTransformChangeId=e;const r=this.localTransform,s=this._scale,n=this._pivot,i=this._position,a=s._x,o=s._y,l=n._x,c=n._y;r.a=this._cx*a,r.b=this._sx*a,r.c=this._cy*o,r.d=this._sy*o,r.tx=i._x-(l*r.a+c*r.c),r.ty=i._y-(l*r.b+c*r.d)}set alpha(e){e!==this.localAlpha&&(this.localAlpha=e,this._updateFlags|=ro,this._onUpdate())}get alpha(){return this.localAlpha}set tint(e){const s=ke.shared.setValue(e??16777215).toBgrNumber();s!==this.localColor&&(this.localColor=s,this._updateFlags|=ro,this._onUpdate())}get tint(){return As(this.localColor)}set blendMode(e){this.localBlendMode!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=df,this.localBlendMode=e,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(e){const r=e?2:0;(this.localDisplayStatus&2)!==r&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=pn,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(e){const r=e?0:4;(this.localDisplayStatus&4)!==r&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=pn,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(e){const r=e?1:0;(this.localDisplayStatus&1)!==r&&(this._updateFlags|=pn,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(e=!1){if(this.destroyed)return;this.destroyed=!0;let r;if(this.children.length&&(r=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof e=="boolean"?e:e?.children)&&r)for(let n=0;n<r.length;++n)r[n].destroy(e);this.renderGroup?.destroy(),this.renderGroup=null}}Be.mixin(Jr,Vd,Qd,af,rf,tf,Xd,Kd,sf,$d,Wd,Jd,qd);class ff extends Jr{constructor(e){super(e),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._bounds=new ot(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(e){this._roundPixels=e?1:0}containsPoint(e){const r=this.bounds,{x:s,y:n}=e;return s>=r.minX&&s<=r.maxX&&n>=r.minY&&n<=r.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const e=this.renderGroup||this.parentRenderGroup;e&&e.onChildViewUpdate(this)}destroy(e){super.destroy(e),this._bounds=null}collectRenderablesSimple(e,r,s){const{renderPipes:n,renderableGC:i}=r;n.blendMode.setBlendMode(this,this.groupBlendMode,e),n[this.renderPipeId].addRenderable(this,e),i.addRenderable(this),this.didViewUpdate=!1;const o=this.children,l=o.length;for(let c=0;c<l;c++)o[c].collectRenderables(e,r,s)}}class Ur extends ff{constructor(e=J.EMPTY){e instanceof J&&(e={texture:e});const{texture:r=J.EMPTY,anchor:s,roundPixels:n,width:i,height:a,...o}=e;super({label:"Sprite",...o}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new De({_onUpdate:()=>{this.onViewUpdate()}}),s?this.anchor=s:r.defaultAnchor&&(this.anchor=r.defaultAnchor),this.texture=r,this.allowChildren=!1,this.roundPixels=n??!1,i!==void 0&&(this.width=i),a!==void 0&&(this.height=a)}static from(e,r=!1){return e instanceof J?new Ur(e):new Ur(J.from(e,r))}set texture(e){e||(e=J.EMPTY);const r=this._texture;r!==e&&(r&&r.dynamic&&r.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return Rd(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return me("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const e=this._anchor,r=this._texture,s=this._bounds,{width:n,height:i}=r.orig;s.minX=-e._x*n,s.maxX=s.minX+n,s.minY=-e._y*i,s.maxY=s.minY+i}destroy(e=!1){if(super.destroy(e),typeof e=="boolean"?e:e?.texture){const s=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(s)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this._setWidth(e,this._texture.orig.width),this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this._setHeight(e,this._texture.orig.height),this._height=e}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this._texture.orig.width,e.height=Math.abs(this.scale.y)*this._texture.orig.height,e}setSize(e,r){typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,this._texture.orig.width),r!==void 0&&this._setHeight(r,this._texture.orig.height)}}const pf=new ot;function Kc(t,e,r){const s=pf;t.measurable=!0,Hc(t,r,s),e.addBoundsMask(s),t.measurable=!1}function Zc(t,e,r){const s=Ct.get();t.measurable=!0;const n=Ee.get().identity(),i=Qc(t,r,n);Vc(t,s,i),t.measurable=!1,e.addBoundsMask(s),Ee.return(n),Ct.return(s)}function Qc(t,e,r){return t?(t!==e&&(Qc(t.parent,e,r),t.updateLocalTransform(),r.append(t.localTransform)),r):(ue("Mask bounds, renderable is not inside the root container"),r)}class Jc{constructor(e){this.priority=0,this.inverse=!1,this.pipe="alphaMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.renderMaskToTexture=!(e instanceof Ur),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(e,r){this.inverse||Kc(this.mask,e,r)}addLocalBounds(e,r){Zc(this.mask,e,r)}containsPoint(e,r){const s=this.mask;return r(s,e)}destroy(){this.reset()}static test(e){return e instanceof Ur}}Jc.extension=U.MaskEffect;class eh{constructor(e){this.priority=0,this.pipe="colorMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e}destroy(){}static test(e){return typeof e=="number"}}eh.extension=U.MaskEffect;class th{constructor(e){this.priority=0,this.pipe="stencilMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(e,r){Kc(this.mask,e,r)}addLocalBounds(e,r){Zc(this.mask,e,r)}containsPoint(e,r){const s=this.mask;return r(s,e)}destroy(){this.reset()}static test(e){return e instanceof Jr}}th.extension=U.MaskEffect;const mf={createCanvas:(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>new DOMParser().parseFromString(t,"text/xml")};let so=mf;const be={get(){return so},set(t){so=t}};class rh extends yt{constructor(e){e.resource||(e.resource=be.get().createCanvas()),e.width||(e.width=e.resource.width,e.autoDensity||(e.width/=e.resolution)),e.height||(e.height=e.resource.height,e.autoDensity||(e.height/=e.resolution)),super(e),this.uploadMethodId="image",this.autoDensity=e.autoDensity,this.resizeCanvas(),this.transparent=!!e.transparent}resizeCanvas(){this.autoDensity&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(e=this.width,r=this.height,s=this._resolution){const n=super.resize(e,r,s);return n&&this.resizeCanvas(),n}static test(e){return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&e instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}rh.extension=U.TextureSource;class Xt extends yt{constructor(e){if(e.resource&&globalThis.HTMLImageElement&&e.resource instanceof HTMLImageElement){const r=be.get().createCanvas(e.resource.width,e.resource.height);r.getContext("2d").drawImage(e.resource,0,0,e.resource.width,e.resource.height),e.resource=r,ue("ImageSource: Image element passed, converting to canvas. Use CanvasSource instead.")}super(e),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(e){return globalThis.HTMLImageElement&&e instanceof HTMLImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||globalThis.VideoFrame&&e instanceof VideoFrame}}Xt.extension=U.TextureSource;var Es=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Es||{});class mn{constructor(e,r=null,s=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=e,this._context=r,this.priority=s,this._once=n}match(e,r=null){return this._fn===e&&this._context===r}emit(e){this._fn&&(this._context?this._fn.call(this._context,e):this._fn(e));const r=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),r}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const r=this.next;return this.next=e?null:r,this.previous=null,r}}const sh=class Ge{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new mn(null,null,1/0),this.deltaMS=1/Ge.targetFPMS,this.elapsedMS=1/Ge.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,r,s=Es.NORMAL){return this._addListener(new mn(e,r,s))}addOnce(e,r,s=Es.NORMAL){return this._addListener(new mn(e,r,s,!0))}_addListener(e){let r=this._head.next,s=this._head;if(!r)e.connect(s);else{for(;r;){if(e.priority>r.priority){e.connect(s);break}s=r,r=r.next}e.previous||e.connect(s)}return this._startIfPossible(),this}remove(e,r){let s=this._head.next;for(;s;)s.match(e,r)?s=s.destroy():s=s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,r=this._head;for(;r=r.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let r;if(e>this.lastTime){if(r=this.elapsedMS=e-this.lastTime,r>this._maxElapsedMS&&(r=this._maxElapsedMS),r*=this.speed,this._minElapsedMS){const i=e-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=e-i%this._minElapsedMS}this.deltaMS=r,this.deltaTime=this.deltaMS*Ge.targetFPMS;const s=this._head;let n=s.next;for(;n;)n=n.emit(this);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const r=Math.min(this.maxFPS,e),s=Math.min(Math.max(0,r)/1e3,Ge.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const r=Math.max(this.minFPS,e);this._minElapsedMS=1/(r/1e3)}}static get shared(){if(!Ge._shared){const e=Ge._shared=new Ge;e.autoStart=!0,e._protected=!0}return Ge._shared}static get system(){if(!Ge._system){const e=Ge._system=new Ge;e.autoStart=!0,e._protected=!0}return Ge._system}};sh.targetFPMS=.06;let gt=sh,gn;async function nh(){return gn??(gn=(async()=>{const e=document.createElement("canvas").getContext("webgl");if(!e)return"premultiply-alpha-on-upload";const r=await new Promise(a=>{const o=document.createElement("video");o.onloadeddata=()=>a(o),o.onerror=()=>a(null),o.autoplay=!1,o.crossOrigin="anonymous",o.preload="auto",o.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",o.load()});if(!r)return"premultiply-alpha-on-upload";const s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);const n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r);const i=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,i),e.deleteFramebuffer(n),e.deleteTexture(s),e.getExtension("WEBGL_lose_context")?.loseContext(),i[0]<=i[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),gn}const Ds=class ih extends yt{constructor(e){super(e),this.isReady=!1,this.uploadMethodId="video",e={...ih.defaultOptions,...e},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this.alphaMode=e.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const e=gt.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const e=this.resource,r=this.options;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(r.preload||e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlayThrough),e.addEventListener("error",this._onError,!0)),this.alphaMode=await nh(),this._load=new Promise((s,n)=>{this.isValid?s(this):(this._resolve=s,this._reject=n,r.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${r.preloadTimeoutMs}ms`))})),e.load())}),this._load}_onError(e){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.resource;return!e.paused&&!e.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const e=this.resource;this.isValid&&(this.isReady=!0,this.resize(e.videoWidth,e.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const e=this.resource;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlayThrough),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(gt.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(gt.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(gt.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement}};Ds.extension=U.TextureSource;Ds.defaultOptions={...yt.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};Ds.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let ks=Ds;const it=(t,e,r=!1)=>(Array.isArray(t)||(t=[t]),e?t.map(s=>typeof s=="string"||r?e(s):s):t);class gf{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const r=this._cache.get(e);return r||ue(`[Assets] Asset id ${e} was not found in the Cache`),r}set(e,r){const s=it(e);let n;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.test(r)){n=c.getCacheableAssets(s,r);break}}const i=new Map(Object.entries(n||{}));n||s.forEach(l=>{i.set(l,r)});const a=[...i.keys()],o={cacheKeys:a,keys:s};s.forEach(l=>{this._cacheMap.set(l,o)}),a.forEach(l=>{const c=n?n[l]:r;this._cache.has(l)&&this._cache.get(l)!==c&&ue("[Cache] already has key:",l),this._cache.set(l,i.get(l))})}remove(e){if(!this._cacheMap.has(e)){ue(`[Assets] Asset id ${e} was not found in the Cache`);return}const r=this._cacheMap.get(e);r.cacheKeys.forEach(n=>{this._cache.delete(n)}),r.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const pe=new gf,wi=[];Be.handleByList(U.TextureSource,wi);function ah(t={}){const e=t&&t.resource,r=e?t.resource:t,s=e?t:{resource:t};for(let n=0;n<wi.length;n++){const i=wi[n];if(i.test(r))return new i(s)}throw new Error(`Could not find a source type for resource: ${s.resource}`)}function xf(t={},e=!1){const r=t&&t.resource,s=r?t.resource:t,n=r?t:{resource:t};if(!e&&pe.has(s))return pe.get(s);const i=new J({source:ah(n)});return i.on("destroy",()=>{pe.has(s)&&pe.remove(s)}),e||pe.set(s,i),i}function yf(t,e=!1){return typeof t=="string"?pe.get(t):t instanceof yt?new J({source:t}):xf(t,e)}J.from=yf;yt.from=ah;Be.add(Jc,eh,th,ks,Xt,rh,Yi);var zt=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(zt||{});function nt(t){if(typeof t!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function Cr(t){return t.split("?")[0].split("#")[0]}function bf(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function wf(t,e,r){return t.replace(new RegExp(bf(e),"g"),r)}function _f(t,e){let r="",s=0,n=-1,i=0,a=-1;for(let o=0;o<=t.length;++o){if(o<t.length)a=t.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(n===o-1||i===1))if(n!==o-1&&i===2){if(r.length<2||s!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){const l=r.lastIndexOf("/");if(l!==r.length-1){l===-1?(r="",s=0):(r=r.slice(0,l),s=r.length-1-r.lastIndexOf("/")),n=o,i=0;continue}}else if(r.length===2||r.length===1){r="",s=0,n=o,i=0;continue}}}else r.length>0?r+=`/${t.slice(n+1,o)}`:r=t.slice(n+1,o),s=o-n-1;n=o,i=0}else a===46&&i!==-1?++i:i=-1}return r}const $e={toPosix(t){return wf(t,"\\","/")},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},isBlobUrl(t){return t.startsWith("blob:")},hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){nt(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const r=/^[^/:]+:\/{0,2}/.exec(t);return r?r[0]:""},toAbsolute(t,e,r){if(nt(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const s=Cr(this.toPosix(e??be.get().getBaseUrl())),n=Cr(this.toPosix(r??this.rootname(s)));return t=this.toPosix(t),t.startsWith("/")?$e.join(n,t.slice(1)):this.isAbsolute(t)?t:this.join(s,t)},normalize(t){if(nt(t),t.length===0)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;t=this.toPosix(t);let e="";const r=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const s=t.endsWith("/");return t=_f(t),t.length>0&&s&&(t+="/"),r?`/${t}`:e+t},isAbsolute(t){return nt(t),t=this.toPosix(t),this.hasProtocol(t)?!0:t.startsWith("/")},join(...t){if(t.length===0)return".";let e;for(let r=0;r<t.length;++r){const s=t[r];if(nt(s),s.length>0)if(e===void 0)e=s;else{const n=t[r-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?e+=`/../${s}`:e+=`/${s}`}}return e===void 0?".":this.normalize(e)},dirname(t){if(nt(t),t.length===0)return".";t=this.toPosix(t);let e=t.charCodeAt(0);const r=e===47;let s=-1,n=!0;const i=this.getProtocol(t),a=t;t=t.slice(i.length);for(let o=t.length-1;o>=1;--o)if(e=t.charCodeAt(o),e===47){if(!n){s=o;break}}else n=!1;return s===-1?r?"/":this.isUrl(a)?i+t:i:r&&s===1?"//":i+t.slice(0,s)},rootname(t){nt(t),t=this.toPosix(t);let e="";if(t.startsWith("/")?e="/":e=this.getProtocol(t),this.isUrl(t)){const r=t.indexOf("/",e.length);r!==-1?e=t.slice(0,r):e=t,e.endsWith("/")||(e+="/")}return e},basename(t,e){nt(t),e&&nt(e),t=Cr(this.toPosix(t));let r=0,s=-1,n=!0,i;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let a=e.length-1,o=-1;for(i=t.length-1;i>=0;--i){const l=t.charCodeAt(i);if(l===47){if(!n){r=i+1;break}}else o===-1&&(n=!1,o=i+1),a>=0&&(l===e.charCodeAt(a)?--a===-1&&(s=i):(a=-1,s=o))}return r===s?s=o:s===-1&&(s=t.length),t.slice(r,s)}for(i=t.length-1;i>=0;--i)if(t.charCodeAt(i)===47){if(!n){r=i+1;break}}else s===-1&&(n=!1,s=i+1);return s===-1?"":t.slice(r,s)},extname(t){nt(t),t=Cr(this.toPosix(t));let e=-1,r=0,s=-1,n=!0,i=0;for(let a=t.length-1;a>=0;--a){const o=t.charCodeAt(a);if(o===47){if(!n){r=a+1;break}continue}s===-1&&(n=!1,s=a+1),o===46?e===-1?e=a:i!==1&&(i=1):e!==-1&&(i=-1)}return e===-1||s===-1||i===0||i===1&&e===s-1&&e===r+1?"":t.slice(e,s)},parse(t){nt(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;t=Cr(this.toPosix(t));let r=t.charCodeAt(0);const s=this.isAbsolute(t);let n;e.root=this.rootname(t),s||this.hasProtocol(t)?n=1:n=0;let i=-1,a=0,o=-1,l=!0,c=t.length-1,h=0;for(;c>=n;--c){if(r=t.charCodeAt(c),r===47){if(!l){a=c+1;break}continue}o===-1&&(l=!1,o=c+1),r===46?i===-1?i=c:h!==1&&(h=1):i!==-1&&(h=-1)}return i===-1||o===-1||h===0||h===1&&i===o-1&&i===a+1?o!==-1&&(a===0&&s?e.base=e.name=t.slice(1,o):e.base=e.name=t.slice(a,o)):(a===0&&s?(e.name=t.slice(1,i),e.base=t.slice(1,o)):(e.name=t.slice(a,i),e.base=t.slice(a,o)),e.ext=t.slice(i,o)),e.dir=this.dirname(t),e},sep:"/",delimiter:":",joinExtensions:[".html"]};function oh(t,e,r,s,n){const i=e[r];for(let a=0;a<i.length;a++){const o=i[a];r<e.length-1?oh(t.replace(s[r],o),e,r+1,s,n):n.push(t.replace(s[r],o))}}function vf(t){const e=/\{(.*?)\}/g,r=t.match(e),s=[];if(r){const n=[];r.forEach(i=>{const a=i.substring(1,i.length-1).split(",");n.push(a)}),oh(t,n,0,r,s)}else s.push(t);return s}const Rs=t=>!Array.isArray(t);class _r{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,r)=>`${e}${this._bundleIdConnector}${r}`,extractAssetIdFromBundle:(e,r)=>r.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const r=e;this._defaultSearchParams=Object.keys(r).map(s=>`${encodeURIComponent(s)}=${encodeURIComponent(r[s])}`).join("&")}}getAlias(e){const{alias:r,src:s}=e;return it(r||s,i=>typeof i=="string"?i:Array.isArray(i)?i.map(a=>a?.src??a):i?.src?i.src:i,!0)}addManifest(e){this._manifest&&ue("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(e,r){const s=[];let n=r;Array.isArray(r)||(n=Object.entries(r).map(([i,a])=>typeof a=="string"||Array.isArray(a)?{alias:i,src:a}:{alias:i,...a})),n.forEach(i=>{const a=i.src,o=i.alias;let l;if(typeof o=="string"){const c=this._createBundleAssetId(e,o);s.push(c),l=[o,c]}else{const c=o.map(h=>this._createBundleAssetId(e,h));s.push(...c),l=[...o,...c]}this.add({...i,alias:l,src:a})}),this._bundles[e]=s}add(e){const r=[];Array.isArray(e)?r.push(...e):r.push(e);let s;s=i=>{this.hasKey(i)&&ue(`[Resolver] already has key: ${i} overwriting`)},it(r).forEach(i=>{const{src:a}=i;let{data:o,format:l,loadParser:c}=i;const h=it(a).map(d=>typeof d=="string"?vf(d):Array.isArray(d)?d:[d]),u=this.getAlias(i);Array.isArray(u)?u.forEach(s):s(u);const f=[];h.forEach(d=>{d.forEach(g=>{let x={};if(typeof g!="object"){x.src=g;for(let m=0;m<this._parsers.length;m++){const w=this._parsers[m];if(w.test(g)){x=w.parse(g);break}}}else o=g.data??o,l=g.format??l,c=g.loadParser??c,x={...x,...g};if(!u)throw new Error(`[Resolver] alias is undefined for this asset: ${x.src}`);x=this._buildResolvedAsset(x,{aliases:u,data:o,format:l,loadParser:c}),f.push(x)})}),u.forEach(d=>{this._assetMap[d]=f})})}resolveBundle(e){const r=Rs(e);e=it(e);const s={};return e.forEach(n=>{const i=this._bundles[n];if(i){const a=this.resolve(i),o={};for(const l in a){const c=a[l];o[this._extractAssetIdFromBundle(n,l)]=c}s[n]=o}}),r?s[e[0]]:s}resolveUrl(e){const r=this.resolve(e);if(typeof e!="string"){const s={};for(const n in r)s[n]=r[n].src;return s}return r.src}resolve(e){const r=Rs(e);e=it(e);const s={};return e.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let i=this._assetMap[n];const a=this._getPreferredOrder(i);a?.priority.forEach(o=>{a.params[o].forEach(l=>{const c=i.filter(h=>h[o]?h[o]===l:!1);c.length&&(i=c)})}),this._resolverHash[n]=i[0]}else this._resolverHash[n]=this._buildResolvedAsset({alias:[n],src:n},{});s[n]=this._resolverHash[n]}),r?s[e[0]]:s}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let r=0;r<e.length;r++){const s=e[r],n=this._preferredOrder.find(i=>i.params.format.includes(s.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const r=/\?/.test(e)?"&":"?";return`${e}${r}${this._defaultSearchParams}`}_buildResolvedAsset(e,r){const{aliases:s,data:n,loadParser:i,format:a}=r;return(this._basePath||this._rootPath)&&(e.src=$e.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=s??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...n||{},...e.data},e.loadParser=i??e.loadParser,e.format=a??e.format??Sf(e.src),e}}_r.RETINA_PREFIX=/@([0-9\.]+)x/;function Sf(t){return t.split(".").pop().split("?").shift().split("#").shift()}const _i=(t,e)=>{const r=e.split("?")[1];return r&&(t+=`?${r}`),t},lh=class zr{constructor(e,r){this.linkedSheets=[],this._texture=e instanceof J?e:null,this.textureSource=e.source,this.textures={},this.animations={},this.data=r;const s=parseFloat(r.meta.scale);s?(this.resolution=s,e.source.resolution=this.resolution):this.resolution=e.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=zr.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let r=e;const s=zr.BATCH_SIZE;for(;r-e<s&&r<this._frameKeys.length;){const n=this._frameKeys[r],i=this._frames[n],a=i.frame;if(a){let o=null,l=null;const c=i.trimmed!==!1&&i.sourceSize?i.sourceSize:i.frame,h=new ge(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);i.rotated?o=new ge(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):o=new ge(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),i.trimmed!==!1&&i.spriteSourceSize&&(l=new ge(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[n]=new J({source:this.textureSource,frame:o,orig:h,trim:l,rotate:i.rotated?2:0,defaultAnchor:i.anchor,defaultBorders:i.borders,label:n.toString()})}r++}}_processAnimations(){const e=this.data.animations||{};for(const r in e){this.animations[r]=[];for(let s=0;s<e[r].length;s++){const n=e[r][s];this.animations[r].push(this.textures[n])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*zr.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*zr.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};lh.BATCH_SIZE=1e3;let vi=lh;const Af=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function ch(t,e,r){const s={};if(t.forEach(n=>{s[n]=e}),Object.keys(e.textures).forEach(n=>{s[n]=e.textures[n]}),!r){const n=$e.dirname(t[0]);e.linkedSheets.forEach((i,a)=>{const o=ch([`${n}/${e.data.meta.related_multi_packs[a]}`],i,!0);Object.assign(s,o)})}return s}const kf={extension:U.Asset,cache:{test:t=>t instanceof vi,getCacheableAssets:(t,e)=>ch(t,e,!1)},resolver:{extension:{type:U.ResolveParser,name:"resolveSpritesheet"},test:t=>{const r=t.split("?")[0].split("."),s=r.pop(),n=r.pop();return s==="json"&&Af.includes(n)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(_r.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:U.LoadParser,priority:zt.Normal,name:"spritesheetLoader"},async testParse(t,e){return $e.extname(e.src).toLowerCase()===".json"&&!!t.frames},async parse(t,e,r){const{texture:s,imageFilename:n,textureOptions:i}=e?.data??{};let a=$e.dirname(e.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let o;if(s instanceof J)o=s;else{const h=_i(a+(n??t.meta.image),e.src);o=(await r.load([{src:h,data:i}]))[h]}const l=new vi(o.source,t);await l.parse();const c=t?.meta?.related_multi_packs;if(Array.isArray(c)){const h=[];for(const f of c){if(typeof f!="string")continue;let d=a+f;e.data?.ignoreMultiPack||(d=_i(d,e.src),h.push(r.load({src:d,data:{textureOptions:i,ignoreMultiPack:!0}})))}const u=await Promise.all(h);l.linkedSheets=u,u.forEach(f=>{f.linkedSheets=[l].concat(l.linkedSheets.filter(d=>d!==f))})}return l},async unload(t,e,r){await r.unload(t.textureSource._sourceOrigin),t.destroy(!1)}}};Be.add(kf);const xn=Object.create(null),no=Object.create(null);function Zi(t,e){let r=no[t];return r===void 0&&(xn[e]===void 0&&(xn[e]=1),no[t]=r=xn[e]++),r}let os;function hh(){return(!os||os?.isContextLost())&&(os=be.get().createCanvas().getContext("webgl",{})),os}let ls;function Cf(){if(!ls){ls="mediump";const t=hh();t&&t.getShaderPrecisionFormat&&(ls=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?"highp":"mediump")}return ls}function Pf(t,e,r){return e?t:r?(t=t.replace("out vec4 finalColor;",""),`
        
        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${t}
        `):`
        
        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${t}
        `}function Mf(t,e,r){const s=r?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if(t.substring(0,9)!=="precision"){let n=r?e.requestedFragmentPrecision:e.requestedVertexPrecision;return n==="highp"&&s!=="highp"&&(n="mediump"),`precision ${n} float;
${t}`}else if(s!=="highp"&&t.substring(0,15)==="precision highp")return t.replace("precision highp","precision mediump");return t}function If(t,e){return e?`#version 300 es
${t}`:t}const Tf={},Ef={};function Rf(t,{name:e="pixi-program"},r=!0){e=e.replace(/\s+/g,"-"),e+=r?"-fragment":"-vertex";const s=r?Tf:Ef;return s[e]?(s[e]++,e+=`-${s[e]}`):s[e]=1,t.indexOf("#define SHADER_NAME")!==-1?t:`${`#define SHADER_NAME ${e}`}
${t}`}function jf(t,e){return e?t.replace("#version 300 es",""):t}const yn={stripVersion:jf,ensurePrecision:Mf,addProgramDefines:Pf,setProgramName:Rf,insertVersion:If},bn=Object.create(null),uh=class Si{constructor(e){e={...Si.defaultOptions,...e};const r=e.fragment.indexOf("#version 300 es")!==-1,s={stripVersion:r,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:Cf()},setProgramName:{name:e.name},addProgramDefines:r,insertVersion:r};let n=e.fragment,i=e.vertex;Object.keys(yn).forEach(a=>{const o=s[a];n=yn[a](n,o,!0),i=yn[a](i,o,!1)}),this.fragment=n,this.vertex=i,this.transformFeedbackVaryings=e.transformFeedbackVaryings,this._key=Zi(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(e){const r=`${e.vertex}:${e.fragment}`;return bn[r]||(bn[r]=new Si(e)),bn[r]}};uh.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let dh=uh;const io={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function Bf(t){return io[t]??io.float32}const zf={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function Ff({source:t,entryPoint:e}){const r={},s=t.indexOf(`fn ${e}`);if(s!==-1){const n=t.indexOf("->",s);if(n!==-1){const i=t.substring(s,n),a=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let o;for(;(o=a.exec(i))!==null;){const l=zf[o[3]]??"float32";r[o[2]]={location:parseInt(o[1],10),format:l,stride:Bf(l).stride,offset:0,instance:!1,start:0}}}}return r}function wn(t){const e=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,r=/@group\((\d+)\)/,s=/@binding\((\d+)\)/,n=/var(<[^>]+>)? (\w+)/,i=/:\s*(\w+)/,a=/struct\s+(\w+)\s*{([^}]+)}/g,o=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,c=t.match(e)?.map(u=>({group:parseInt(u.match(r)[1],10),binding:parseInt(u.match(s)[1],10),name:u.match(n)[2],isUniform:u.match(n)[1]==="<uniform>",type:u.match(i)[1]}));if(!c)return{groups:[],structs:[]};const h=t.match(a)?.map(u=>{const f=u.match(l)[1],d=u.match(o).reduce((g,x)=>{const[m,w]=x.split(":");return g[m.trim()]=w.trim(),g},{});return d?{name:f,members:d}:null}).filter(({name:u})=>c.some(f=>f.type===u))??[];return{groups:c,structs:h}}var Fr=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(Fr||{});function Of({groups:t}){const e=[];for(let r=0;r<t.length;r++){const s=t[r];e[s.group]||(e[s.group]=[]),s.isUniform?e[s.group].push({binding:s.binding,visibility:Fr.VERTEX|Fr.FRAGMENT,buffer:{type:"uniform"}}):s.type==="sampler"?e[s.group].push({binding:s.binding,visibility:Fr.FRAGMENT,sampler:{type:"filtering"}}):s.type==="texture_2d"&&e[s.group].push({binding:s.binding,visibility:Fr.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}function Nf({groups:t}){const e=[];for(let r=0;r<t.length;r++){const s=t[r];e[s.group]||(e[s.group]={}),e[s.group][s.name]=s.binding}return e}function Lf(t,e){const r=new Set,s=new Set,n=[...t.structs,...e.structs].filter(a=>r.has(a.name)?!1:(r.add(a.name),!0)),i=[...t.groups,...e.groups].filter(a=>{const o=`${a.name}-${a.binding}`;return s.has(o)?!1:(s.add(o),!0)});return{structs:n,groups:i}}const _n=Object.create(null);class $s{constructor(e){this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:r,vertex:s,layout:n,gpuLayout:i,name:a}=e;if(this.name=a,this.fragment=r,this.vertex=s,r.source===s.source){const o=wn(r.source);this.structsAndGroups=o}else{const o=wn(s.source),l=wn(r.source);this.structsAndGroups=Lf(o,l)}this.layout=n??Nf(this.structsAndGroups),this.gpuLayout=i??Of(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:e,fragment:r}=this,s=e.source+r.source+e.entryPoint+r.entryPoint;this._layoutKey=Zi(s,"program")}get attributeData(){return this._attributeData??(this._attributeData=Ff(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(e){const r=`${e.vertex.source}:${e.fragment.source}:${e.fragment.entryPoint}:${e.vertex.entryPoint}`;return _n[r]||(_n[r]=new $s(e)),_n[r]}}const fh=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],Gf=fh.reduce((t,e)=>(t[e]=!0,t),{});function Df(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const ph=class mh{constructor(e,r){this._touched=0,this.uid=xe("uniform"),this._resourceType="uniformGroup",this._resourceId=xe("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,r={...mh.defaultOptions,...r},this.uniformStructures=e;const s={};for(const n in e){const i=e[n];if(i.name=n,i.size=i.size??1,!Gf[i.type])throw new Error(`Uniform type ${i.type} is not supported. Supported uniform types are: ${fh.join(", ")}`);i.value??(i.value=Df(i.type,i.size)),s[n]=i.value}this.uniforms=s,this._dirtyId=1,this.ubo=r.ubo,this.isStatic=r.isStatic,this._signature=Zi(Object.keys(s).map(n=>`${n}-${e[n].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};ph.defaultOptions={ubo:!1,isStatic:!1};let gh=ph;class Cs{constructor(e){this.resources=Object.create(null),this._dirty=!0;let r=0;for(const s in e){const n=e[s];this.setResource(n,r++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const e=[];let r=0;for(const s in this.resources)e[r++]=this.resources[s]._resourceId;this._key=e.join("|")}setResource(e,r){const s=this.resources[r];e!==s&&(s&&e.off?.("change",this.onResourceChange,this),e.on?.("change",this.onResourceChange,this),this.resources[r]=e,this._dirty=!0)}getResource(e){return this.resources[e]}_touch(e){const r=this.resources;for(const s in r)r[s]._touched=e}destroy(){const e=this.resources;for(const r in e)e[r].off?.("change",this.onResourceChange,this);this.resources=null}onResourceChange(e){if(this._dirty=!0,e.destroyed){const r=this.resources;for(const s in r)r[s]===e&&(r[s]=null)}else this._updateKey()}}var Ai=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.BOTH=3]="BOTH",t))(Ai||{});class Qi extends xt{constructor(e){super(),this.uid=xe("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:r,glProgram:s,groups:n,resources:i,compatibleRenderers:a,groupMap:o}=e;this.gpuProgram=r,this.glProgram=s,a===void 0&&(a=0,r&&(a|=Ai.WEBGPU),s&&(a|=Ai.WEBGL)),this.compatibleRenderers=a;const l={};if(!i&&!n&&(i={}),i&&n)throw new Error("[Shader] Cannot have both resources and groups");if(!r&&n&&!o)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!r&&n&&o)for(const c in o)for(const h in o[c]){const u=o[c][h];l[u]={group:c,binding:h,name:u}}else if(r&&n&&!o){const c=r.structsAndGroups.groups;o={},c.forEach(h=>{o[h.group]=o[h.group]||{},o[h.group][h.binding]=h.name,l[h.name]=h})}else if(i){n={},o={},r&&r.structsAndGroups.groups.forEach(u=>{o[u.group]=o[u.group]||{},o[u.group][u.binding]=u.name,l[u.name]=u});let c=0;for(const h in i)l[h]||(n[99]||(n[99]=new Cs,this._ownedBindGroups.push(n[99])),l[h]={group:99,binding:c,name:h},o[99]=o[99]||{},o[99][c]=h,c++);for(const h in i){const u=h;let f=i[h];!f.source&&!f._resourceType&&(f=new gh(f));const d=l[u];d&&(n[d.group]||(n[d.group]=new Cs,this._ownedBindGroups.push(n[d.group])),n[d.group].setResource(f,d.binding))}}this.groups=n,this._uniformBindMap=o,this.resources=this._buildResourceAccessor(n,l)}addResource(e,r,s){var n,i;(n=this._uniformBindMap)[r]||(n[r]={}),(i=this._uniformBindMap[r])[s]||(i[s]=e),this.groups[r]||(this.groups[r]=new Cs,this._ownedBindGroups.push(this.groups[r]))}_buildResourceAccessor(e,r){const s={};for(const n in r){const i=r[n];Object.defineProperty(s,i.name,{get(){return e[i.group].getResource(i.binding)},set(a){e[i.group].setResource(a,i.binding)}})}return s}destroy(e=!1){this.emit("destroy",this),e&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(r=>{r.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(e){const{gpu:r,gl:s,...n}=e;let i,a;return r&&(i=$s.from(r)),s&&(a=dh.from(s)),new Qi({gpuProgram:i,glProgram:a,...n})}}var cs={exports:{}},ao;function $f(){if(ao)return cs.exports;ao=1,cs.exports=t,cs.exports.default=t;function t(y,S,k){k=k||2;var v=S&&S.length,_=v?S[0]*k:y.length,C=e(y,0,_,k,!0),M=[];if(!C||C.next===C.prev)return M;var R,B,G,V,q,Y,ie;if(v&&(C=l(y,S,C,k)),y.length>80*k){R=G=y[0],B=V=y[1];for(var X=k;X<_;X+=k)q=y[X],Y=y[X+1],q<R&&(R=q),Y<B&&(B=Y),q>G&&(G=q),Y>V&&(V=Y);ie=Math.max(G-R,V-B),ie=ie!==0?32767/ie:0}return s(C,M,k,R,B,ie,0),M}function e(y,S,k,v,_){var C,M;if(_===Oe(y,S,k,v)>0)for(C=S;C<k;C+=v)M=K(C,y[C],y[C+1],M);else for(C=k-v;C>=S;C-=v)M=K(C,y[C],y[C+1],M);return M&&P(M,M.next)&&(Q(M),M=M.next),M}function r(y,S){if(!y)return y;S||(S=y);var k=y,v;do if(v=!1,!k.steiner&&(P(k,k.next)||A(k.prev,k,k.next)===0)){if(Q(k),k=S=k.prev,k===k.next)break;v=!0}else k=k.next;while(v||k!==S);return S}function s(y,S,k,v,_,C,M){if(y){!M&&C&&d(y,v,_,C);for(var R=y,B,G;y.prev!==y.next;){if(B=y.prev,G=y.next,C?i(y,v,_,C):n(y)){S.push(B.i/k|0),S.push(y.i/k|0),S.push(G.i/k|0),Q(y),y=G.next,R=G.next;continue}if(y=G,y===R){M?M===1?(y=a(r(y),S,k),s(y,S,k,v,_,C,2)):M===2&&o(y,S,k,v,_,C):s(r(y),S,k,v,_,C,1);break}}}}function n(y){var S=y.prev,k=y,v=y.next;if(A(S,k,v)>=0)return!1;for(var _=S.x,C=k.x,M=v.x,R=S.y,B=k.y,G=v.y,V=_<C?_<M?_:M:C<M?C:M,q=R<B?R<G?R:G:B<G?B:G,Y=_>C?_>M?_:M:C>M?C:M,ie=R>B?R>G?R:G:B>G?B:G,X=v.next;X!==S;){if(X.x>=V&&X.x<=Y&&X.y>=q&&X.y<=ie&&w(_,R,C,B,M,G,X.x,X.y)&&A(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function i(y,S,k,v){var _=y.prev,C=y,M=y.next;if(A(_,C,M)>=0)return!1;for(var R=_.x,B=C.x,G=M.x,V=_.y,q=C.y,Y=M.y,ie=R<B?R<G?R:G:B<G?B:G,X=V<q?V<Y?V:Y:q<Y?q:Y,bt=R>B?R>G?R:G:B>G?B:G,Ne=V>q?V>Y?V:Y:q>Y?q:Y,ct=x(ie,X,S,k,v),ht=x(bt,Ne,S,k,v),Z=y.prevZ,re=y.nextZ;Z&&Z.z>=ct&&re&&re.z<=ht;){if(Z.x>=ie&&Z.x<=bt&&Z.y>=X&&Z.y<=Ne&&Z!==_&&Z!==M&&w(R,V,B,q,G,Y,Z.x,Z.y)&&A(Z.prev,Z,Z.next)>=0||(Z=Z.prevZ,re.x>=ie&&re.x<=bt&&re.y>=X&&re.y<=Ne&&re!==_&&re!==M&&w(R,V,B,q,G,Y,re.x,re.y)&&A(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;Z&&Z.z>=ct;){if(Z.x>=ie&&Z.x<=bt&&Z.y>=X&&Z.y<=Ne&&Z!==_&&Z!==M&&w(R,V,B,q,G,Y,Z.x,Z.y)&&A(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;re&&re.z<=ht;){if(re.x>=ie&&re.x<=bt&&re.y>=X&&re.y<=Ne&&re!==_&&re!==M&&w(R,V,B,q,G,Y,re.x,re.y)&&A(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function a(y,S,k){var v=y;do{var _=v.prev,C=v.next.next;!P(_,C)&&E(_,v,v.next,C)&&z(_,C)&&z(C,_)&&(S.push(_.i/k|0),S.push(v.i/k|0),S.push(C.i/k|0),Q(v),Q(v.next),v=y=C),v=v.next}while(v!==y);return r(v)}function o(y,S,k,v,_,C){var M=y;do{for(var R=M.next.next;R!==M.prev;){if(M.i!==R.i&&b(M,R)){var B=$(M,R);M=r(M,M.next),B=r(B,B.next),s(M,S,k,v,_,C,0),s(B,S,k,v,_,C,0);return}R=R.next}M=M.next}while(M!==y)}function l(y,S,k,v){var _=[],C,M,R,B,G;for(C=0,M=S.length;C<M;C++)R=S[C]*v,B=C<M-1?S[C+1]*v:y.length,G=e(y,R,B,v,!1),G===G.next&&(G.steiner=!0),_.push(m(G));for(_.sort(c),C=0;C<_.length;C++)k=h(_[C],k);return k}function c(y,S){return y.x-S.x}function h(y,S){var k=u(y,S);if(!k)return S;var v=$(k,y);return r(v,v.next),r(k,k.next)}function u(y,S){var k=S,v=y.x,_=y.y,C=-1/0,M;do{if(_<=k.y&&_>=k.next.y&&k.next.y!==k.y){var R=k.x+(_-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(R<=v&&R>C&&(C=R,M=k.x<k.next.x?k:k.next,R===v))return M}k=k.next}while(k!==S);if(!M)return null;var B=M,G=M.x,V=M.y,q=1/0,Y;k=M;do v>=k.x&&k.x>=G&&v!==k.x&&w(_<V?v:C,_,G,V,_<V?C:v,_,k.x,k.y)&&(Y=Math.abs(_-k.y)/(v-k.x),z(k,y)&&(Y<q||Y===q&&(k.x>M.x||k.x===M.x&&f(M,k)))&&(M=k,q=Y)),k=k.next;while(k!==B);return M}function f(y,S){return A(y.prev,y,S.prev)<0&&A(S.next,y,y.next)<0}function d(y,S,k,v){var _=y;do _.z===0&&(_.z=x(_.x,_.y,S,k,v)),_.prevZ=_.prev,_.nextZ=_.next,_=_.next;while(_!==y);_.prevZ.nextZ=null,_.prevZ=null,g(_)}function g(y){var S,k,v,_,C,M,R,B,G=1;do{for(k=y,y=null,C=null,M=0;k;){for(M++,v=k,R=0,S=0;S<G&&(R++,v=v.nextZ,!!v);S++);for(B=G;R>0||B>0&&v;)R!==0&&(B===0||!v||k.z<=v.z)?(_=k,k=k.nextZ,R--):(_=v,v=v.nextZ,B--),C?C.nextZ=_:y=_,_.prevZ=C,C=_;k=v}C.nextZ=null,G*=2}while(M>1);return y}function x(y,S,k,v,_){return y=(y-k)*_|0,S=(S-v)*_|0,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,y|S<<1}function m(y){var S=y,k=y;do(S.x<k.x||S.x===k.x&&S.y<k.y)&&(k=S),S=S.next;while(S!==y);return k}function w(y,S,k,v,_,C,M,R){return(_-M)*(S-R)>=(y-M)*(C-R)&&(y-M)*(v-R)>=(k-M)*(S-R)&&(k-M)*(C-R)>=(_-M)*(v-R)}function b(y,S){return y.next.i!==S.i&&y.prev.i!==S.i&&!N(y,S)&&(z(y,S)&&z(S,y)&&j(y,S)&&(A(y.prev,y,S.prev)||A(y,S.prev,S))||P(y,S)&&A(y.prev,y,y.next)>0&&A(S.prev,S,S.next)>0)}function A(y,S,k){return(S.y-y.y)*(k.x-S.x)-(S.x-y.x)*(k.y-S.y)}function P(y,S){return y.x===S.x&&y.y===S.y}function E(y,S,k,v){var _=T(A(y,S,k)),C=T(A(y,S,v)),M=T(A(k,v,y)),R=T(A(k,v,S));return!!(_!==C&&M!==R||_===0&&I(y,k,S)||C===0&&I(y,v,S)||M===0&&I(k,y,v)||R===0&&I(k,S,v))}function I(y,S,k){return S.x<=Math.max(y.x,k.x)&&S.x>=Math.min(y.x,k.x)&&S.y<=Math.max(y.y,k.y)&&S.y>=Math.min(y.y,k.y)}function T(y){return y>0?1:y<0?-1:0}function N(y,S){var k=y;do{if(k.i!==y.i&&k.next.i!==y.i&&k.i!==S.i&&k.next.i!==S.i&&E(k,k.next,y,S))return!0;k=k.next}while(k!==y);return!1}function z(y,S){return A(y.prev,y,y.next)<0?A(y,S,y.next)>=0&&A(y,y.prev,S)>=0:A(y,S,y.prev)<0||A(y,y.next,S)<0}function j(y,S){var k=y,v=!1,_=(y.x+S.x)/2,C=(y.y+S.y)/2;do k.y>C!=k.next.y>C&&k.next.y!==k.y&&_<(k.next.x-k.x)*(C-k.y)/(k.next.y-k.y)+k.x&&(v=!v),k=k.next;while(k!==y);return v}function $(y,S){var k=new ae(y.i,y.x,y.y),v=new ae(S.i,S.x,S.y),_=y.next,C=S.prev;return y.next=S,S.prev=y,k.next=_,_.prev=k,v.next=k,k.prev=v,C.next=v,v.prev=C,v}function K(y,S,k,v){var _=new ae(y,S,k);return v?(_.next=v.next,_.prev=v,v.next.prev=_,v.next=_):(_.prev=_,_.next=_),_}function Q(y){y.next.prev=y.prev,y.prev.next=y.next,y.prevZ&&(y.prevZ.nextZ=y.nextZ),y.nextZ&&(y.nextZ.prevZ=y.prevZ)}function ae(y,S,k){this.i=y,this.x=S,this.y=k,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}t.deviation=function(y,S,k,v){var _=S&&S.length,C=_?S[0]*k:y.length,M=Math.abs(Oe(y,0,C,k));if(_)for(var R=0,B=S.length;R<B;R++){var G=S[R]*k,V=R<B-1?S[R+1]*k:y.length;M-=Math.abs(Oe(y,G,V,k))}var q=0;for(R=0;R<v.length;R+=3){var Y=v[R]*k,ie=v[R+1]*k,X=v[R+2]*k;q+=Math.abs((y[Y]-y[X])*(y[ie+1]-y[Y+1])-(y[Y]-y[ie])*(y[X+1]-y[Y+1]))}return M===0&&q===0?0:Math.abs((q-M)/M)};function Oe(y,S,k,v){for(var _=0,C=S,M=k-v;C<k;C+=v)_+=(y[M]-y[C])*(y[C+1]+y[M+1]),M=C;return _}return t.flatten=function(y){for(var S=y[0][0].length,k={vertices:[],holes:[],dimensions:S},v=0,_=0;_<y.length;_++){for(var C=0;C<y[_].length;C++)for(var M=0;M<S;M++)k.vertices.push(y[_][C][M]);_>0&&(v+=y[_-1].length,k.holes.push(v))}return k},cs.exports}var Hf=$f();const Wf=rt(Hf);class xh extends xt{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return me(Pe,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return me(Pe,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return me(Pe,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return me(Pe,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return me(Pe,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners();for(const r in this.chars)this.chars[r].texture?.destroy();this.chars=null,e&&(this.pages.forEach(r=>r.texture.destroy(!0)),this.pages=null)}}const oo=[{offset:0,color:"white"},{offset:1,color:"black"}],Ji=class ki{constructor(...e){this.uid=xe("fillGradient"),this.type="linear",this.colorStops=[];let r=Uf(e);r={...r.type==="radial"?ki.defaultRadialOptions:ki.defaultLinearOptions,...zc(r)},this._textureSize=r.textureSize,r.type==="radial"?(this.center=r.center,this.outerCenter=r.outerCenter??this.center,this.innerRadius=r.innerRadius,this.outerRadius=r.outerRadius,this.scale=r.scale,this.rotation=r.rotation):(this.start=r.start,this.end=r.end),this.textureSpace=r.textureSpace,this.type=r.type,r.colorStops.forEach(n=>{this.addColorStop(n.offset,n.color)})}addColorStop(e,r){return this.colorStops.push({offset:e,color:ke.shared.setValue(r).toHexa()}),this}buildLinearGradient(){if(this.texture)return;const e=this.colorStops.length?this.colorStops:oo,r=this._textureSize,{canvas:s,context:n}=co(r,1),i=n.createLinearGradient(0,0,this._textureSize,0);lo(i,e),n.fillStyle=i,n.fillRect(0,0,r,1),this.texture=new J({source:new Xt({resource:s})});const{x:a,y:o}=this.start,{x:l,y:c}=this.end,h=new ee,u=l-a,f=c-o,d=Math.sqrt(u*u+f*f),g=Math.atan2(f,u);h.scale(d/r,1),h.rotate(g),h.translate(a,o),this.textureSpace==="local"&&h.scale(r,r),this.transform=h}buildGradient(){this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const e=this.colorStops.length?this.colorStops:oo,r=this._textureSize,{canvas:s,context:n}=co(r,r),{x:i,y:a}=this.center,{x:o,y:l}=this.outerCenter,c=this.innerRadius,h=this.outerRadius,u=o-h,f=l-h,d=r/(h*2),g=(i-u)*d,x=(a-f)*d,m=n.createRadialGradient(g,x,c*d,(o-u)*d,(l-f)*d,h*d);lo(m,e),n.fillStyle=e[e.length-1].color,n.fillRect(0,0,r,r),n.fillStyle=m,n.translate(g,x),n.rotate(this.rotation),n.scale(1,this.scale),n.translate(-g,-x),n.fillRect(0,0,r,r),this.texture=new J({source:new Xt({resource:s,addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"})});const w=new ee;w.scale(1/d,1/d),w.translate(u,f),this.textureSpace==="local"&&w.scale(r,r),this.transform=w}get styleKey(){return this.uid}destroy(){this.texture?.destroy(!0),this.texture=null}};Ji.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256};Ji.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256};let jt=Ji;function lo(t,e){for(let r=0;r<e.length;r++){const s=e[r];t.addColorStop(s.offset,s.color)}}function co(t,e){const r=be.get().createCanvas(t,e),s=r.getContext("2d");return{canvas:r,context:s}}function Uf(t){let e=t[0]??{};return(typeof e=="number"||t[1])&&(me("8.5.2","use options object instead"),e={type:"linear",start:{x:t[0],y:t[1]},end:{x:t[2],y:t[3]},textureSpace:t[4],textureSize:t[5]??jt.defaultLinearOptions.textureSize}),e}const ho={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Hs{constructor(e,r){this.uid=xe("fillPattern"),this.transform=new ee,this._styleKey=null,this.texture=e,this.transform.scale(1/e.frame.width,1/e.frame.height),r&&(e.source.style.addressModeU=ho[r].addressModeU,e.source.style.addressModeV=ho[r].addressModeV)}setTransform(e){const r=this.texture;this.transform.copyFrom(e),this.transform.invert(),this.transform.scale(1/r.frame.width,1/r.frame.height),this._styleKey=null}get styleKey(){return this._styleKey?this._styleKey:(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`,this._styleKey)}}var vn,uo;function Vf(){if(uo)return vn;uo=1,vn=r;var t={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},e=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function r(i){var a=[];return i.replace(e,function(o,l,c){var h=l.toLowerCase();for(c=n(c),h=="m"&&c.length>2&&(a.push([l].concat(c.splice(0,2))),h="l",l=l=="m"?"l":"L");;){if(c.length==t[h])return c.unshift(l),a.push(c);if(c.length<t[h])throw new Error("malformed path data");a.push([l].concat(c.splice(0,t[h])))}}),a}var s=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function n(i){var a=i.match(s);return a?a.map(Number):[]}return vn}var qf=Vf();const Yf=rt(qf);function Xf(t,e){const r=Yf(t),s=[];let n=null,i=0,a=0;for(let o=0;o<r.length;o++){const l=r[o],c=l[0],h=l;switch(c){case"M":i=h[1],a=h[2],e.moveTo(i,a);break;case"m":i+=h[1],a+=h[2],e.moveTo(i,a);break;case"H":i=h[1],e.lineTo(i,a);break;case"h":i+=h[1],e.lineTo(i,a);break;case"V":a=h[1],e.lineTo(i,a);break;case"v":a+=h[1],e.lineTo(i,a);break;case"L":i=h[1],a=h[2],e.lineTo(i,a);break;case"l":i+=h[1],a+=h[2],e.lineTo(i,a);break;case"C":i=h[5],a=h[6],e.bezierCurveTo(h[1],h[2],h[3],h[4],i,a);break;case"c":e.bezierCurveTo(i+h[1],a+h[2],i+h[3],a+h[4],i+h[5],a+h[6]),i+=h[5],a+=h[6];break;case"S":i=h[3],a=h[4],e.bezierCurveToShort(h[1],h[2],i,a);break;case"s":e.bezierCurveToShort(i+h[1],a+h[2],i+h[3],a+h[4]),i+=h[3],a+=h[4];break;case"Q":i=h[3],a=h[4],e.quadraticCurveTo(h[1],h[2],i,a);break;case"q":e.quadraticCurveTo(i+h[1],a+h[2],i+h[3],a+h[4]),i+=h[3],a+=h[4];break;case"T":i=h[1],a=h[2],e.quadraticCurveToShort(i,a);break;case"t":i+=h[1],a+=h[2],e.quadraticCurveToShort(i,a);break;case"A":i=h[6],a=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],i,a);break;case"a":i+=h[6],a+=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],i,a);break;case"Z":case"z":e.closePath(),s.length>0&&(n=s.pop(),n?(i=n.startX,a=n.startY):(i=0,a=0)),n=null;break;default:ue(`Unknown SVG path command: ${c}`)}c!=="Z"&&c!=="z"&&n===null&&(n={startX:i,startY:a},s.push(n))}return e}class ea{constructor(e=0,r=0,s=0){this.type="circle",this.x=e,this.y=r,this.radius=s}clone(){return new ea(this.x,this.y,this.radius)}contains(e,r){if(this.radius<=0)return!1;const s=this.radius*this.radius;let n=this.x-e,i=this.y-r;return n*=n,i*=i,n+i<=s}strokeContains(e,r,s,n=.5){if(this.radius===0)return!1;const i=this.x-e,a=this.y-r,o=this.radius,l=(1-n)*s,c=Math.sqrt(i*i+a*a);return c<=o+l&&c>o-(s-l)}getBounds(e){return e||(e=new ge),e.x=this.x-this.radius,e.y=this.y-this.radius,e.width=this.radius*2,e.height=this.radius*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.radius=e.radius,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class ta{constructor(e=0,r=0,s=0,n=0){this.type="ellipse",this.x=e,this.y=r,this.halfWidth=s,this.halfHeight=n}clone(){return new ta(this.x,this.y,this.halfWidth,this.halfHeight)}contains(e,r){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let s=(e-this.x)/this.halfWidth,n=(r-this.y)/this.halfHeight;return s*=s,n*=n,s+n<=1}strokeContains(e,r,s,n=.5){const{halfWidth:i,halfHeight:a}=this;if(i<=0||a<=0)return!1;const o=s*(1-n),l=s-o,c=i-l,h=a-l,u=i+o,f=a+o,d=e-this.x,g=r-this.y,x=d*d/(c*c)+g*g/(h*h),m=d*d/(u*u)+g*g/(f*f);return x>1&&m<=1}getBounds(e){return e||(e=new ge),e.x=this.x-this.halfWidth,e.y=this.y-this.halfHeight,e.width=this.halfWidth*2,e.height=this.halfHeight*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.halfWidth=e.halfWidth,this.halfHeight=e.halfHeight,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function Kf(t,e,r,s,n,i){const a=t-r,o=e-s,l=n-r,c=i-s,h=a*l+o*c,u=l*l+c*c;let f=-1;u!==0&&(f=h/u);let d,g;f<0?(d=r,g=s):f>1?(d=n,g=i):(d=r+f*l,g=s+f*c);const x=t-d,m=e-g;return x*x+m*m}let Zf,Qf;class $r{constructor(...e){this.type="polygon";let r=Array.isArray(e[0])?e[0]:e;if(typeof r[0]!="number"){const s=[];for(let n=0,i=r.length;n<i;n++)s.push(r[n].x,r[n].y);r=s}this.points=r,this.closePath=!0}isClockwise(){let e=0;const r=this.points,s=r.length;for(let n=0;n<s;n+=2){const i=r[n],a=r[n+1],o=r[(n+2)%s],l=r[(n+3)%s];e+=(o-i)*(l+a)}return e<0}containsPolygon(e){const r=this.getBounds(Zf),s=e.getBounds(Qf);if(!r.containsRect(s))return!1;const n=e.points;for(let i=0;i<n.length;i+=2){const a=n[i],o=n[i+1];if(!this.contains(a,o))return!1}return!0}clone(){const e=this.points.slice(),r=new $r(e);return r.closePath=this.closePath,r}contains(e,r){let s=!1;const n=this.points.length/2;for(let i=0,a=n-1;i<n;a=i++){const o=this.points[i*2],l=this.points[i*2+1],c=this.points[a*2],h=this.points[a*2+1];l>r!=h>r&&e<(c-o)*((r-l)/(h-l))+o&&(s=!s)}return s}strokeContains(e,r,s,n=.5){const i=s*s,a=i*(1-n),o=i-a,{points:l}=this,c=l.length-(this.closePath?0:2);for(let h=0;h<c;h+=2){const u=l[h],f=l[h+1],d=l[(h+2)%l.length],g=l[(h+3)%l.length],x=Kf(e,r,u,f,d,g),m=Math.sign((d-u)*(r-f)-(g-f)*(e-u));if(x<=(m<0?o:a))return!0}return!1}getBounds(e){e||(e=new ge);const r=this.points;let s=1/0,n=-1/0,i=1/0,a=-1/0;for(let o=0,l=r.length;o<l;o+=2){const c=r[o],h=r[o+1];s=c<s?c:s,n=c>n?c:n,i=h<i?h:i,a=h>a?h:a}return e.x=s,e.width=n-s,e.y=i,e.height=a-i,e}copyFrom(e){return this.points=e.points.slice(),this.closePath=e.closePath,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((e,r)=>`${e}, ${r}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}const hs=(t,e,r,s,n,i,a)=>{const o=t-r,l=e-s,c=Math.sqrt(o*o+l*l);return c>=n-i&&c<=n+a};class ra{constructor(e=0,r=0,s=0,n=0,i=20){this.type="roundedRectangle",this.x=e,this.y=r,this.width=s,this.height=n,this.radius=i}getBounds(e){return e||(e=new ge),e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}clone(){return new ra(this.x,this.y,this.width,this.height,this.radius)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,r){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&r>=this.y&&r<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(r>=this.y+s&&r<=this.y+this.height-s||e>=this.x+s&&e<=this.x+this.width-s)return!0;let n=e-(this.x+s),i=r-(this.y+s);const a=s*s;if(n*n+i*i<=a||(n=e-(this.x+this.width-s),n*n+i*i<=a)||(i=r-(this.y+this.height-s),n*n+i*i<=a)||(n=e-(this.x+s),n*n+i*i<=a))return!0}return!1}strokeContains(e,r,s,n=.5){const{x:i,y:a,width:o,height:l,radius:c}=this,h=s*(1-n),u=s-h,f=i+c,d=a+c,g=o-c*2,x=l-c*2,m=i+o,w=a+l;return(e>=i-h&&e<=i+u||e>=m-u&&e<=m+h)&&r>=d&&r<=d+x||(r>=a-h&&r<=a+u||r>=w-u&&r<=w+h)&&e>=f&&e<=f+g?!0:e<f&&r<d&&hs(e,r,f,d,c,u,h)||e>m-c&&r<d&&hs(e,r,m-c,d,c,u,h)||e>m-c&&r>w-c&&hs(e,r,m-c,w-c,c,u,h)||e<f&&r>w-c&&hs(e,r,f,w-c,c,u,h)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const Jf=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function ep(t){let e="";for(let r=0;r<t;++r)r>0&&(e+=`
else `),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}function tp(t,e){if(t===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);try{for(;;){const s=Jf.replace(/%forloop%/gi,ep(t));if(e.shaderSource(r,s),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))t=t/2|0;else break}}finally{e.deleteShader(r)}return t}let nr=null;function yh(){if(nr)return nr;const t=hh();return nr=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),nr=tp(nr,t),t.getExtension("WEBGL_lose_context")?.loseContext(),nr}const bh={};function rp(t,e){let r=2166136261;for(let s=0;s<e;s++)r^=t[s].uid,r=Math.imul(r,16777619),r>>>=0;return bh[r]||sp(t,e,r)}let Sn=0;function sp(t,e,r){const s={};let n=0;Sn||(Sn=yh());for(let a=0;a<Sn;a++){const o=a<e?t[a]:J.EMPTY.source;s[n++]=o.source,s[n++]=o.style}const i=new Cs(s);return bh[r]=i,i}class fo{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}function po(t,e){const r=t.byteLength/8|0,s=new Float64Array(t,0,r);new Float64Array(e,0,r).set(s);const i=t.byteLength-r*8;if(i>0){const a=new Uint8Array(t,r*8,i);new Uint8Array(e,r*8,i).set(a)}}const np={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var ip=(t=>(t[t.DISABLED=0]="DISABLED",t[t.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",t[t.MASK_ACTIVE=2]="MASK_ACTIVE",t[t.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",t[t.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",t[t.NONE=5]="NONE",t))(ip||{});function mo(t,e){return e.alphaMode==="no-premultiply-alpha"&&np[t]||t}class ap{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let e=0;e<this.count;e++){const r=this.textures[e];this.textures[e]=null,this.ids[r.uid]=null}this.count=0}}class op{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new ap,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const wh=[];let Ci=0;function go(){return Ci>0?wh[--Ci]:new op}function xo(t){wh[Ci++]=t}let Pr=0;const _h=class Ps{constructor(e={}){this.uid=xe("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],Ps.defaultOptions.maxTextures=Ps.defaultOptions.maxTextures??yh(),e={...Ps.defaultOptions,...e};const{maxTextures:r,attributesInitialSize:s,indicesInitialSize:n}=e;this.attributeBuffer=new fo(s*4),this.indexBuffer=new Uint16Array(n),this.maxTextures=r}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let e=0;e<this.batchIndex;e++)xo(this.batches[e]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(e){this._elements[this.elementSize++]=e,e._indexStart=this.indexSize,e._attributeStart=this.attributeSize,e._batcher=this,this.indexSize+=e.indexSize,this.attributeSize+=e.attributeSize*this.vertexSize}checkAndUpdateTexture(e,r){const s=e._batch.textures.ids[r._source.uid];return!s&&s!==0?!1:(e._textureId=s,e.texture=r,!0)}updateElement(e){this.dirty=!0;const r=this.attributeBuffer;e.packAsQuad?this.packQuadAttributes(e,r.float32View,r.uint32View,e._attributeStart,e._textureId):this.packAttributes(e,r.float32View,r.uint32View,e._attributeStart,e._textureId)}break(e){const r=this._elements;if(!r[this.elementStart])return;let s=go(),n=s.textures;n.clear();const i=r[this.elementStart];let a=mo(i.blendMode,i.texture._source),o=i.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const l=this.attributeBuffer.float32View,c=this.attributeBuffer.uint32View,h=this.indexBuffer;let u=this._batchIndexSize,f=this._batchIndexStart,d="startBatch";const g=this.maxTextures;for(let x=this.elementStart;x<this.elementSize;++x){const m=r[x];r[x]=null;const b=m.texture._source,A=mo(m.blendMode,b),P=a!==A||o!==m.topology;if(b._batchTick===Pr&&!P){m._textureId=b._textureBindLocation,u+=m.indexSize,m.packAsQuad?(this.packQuadAttributes(m,l,c,m._attributeStart,m._textureId),this.packQuadIndex(h,m._indexStart,m._attributeStart/this.vertexSize)):(this.packAttributes(m,l,c,m._attributeStart,m._textureId),this.packIndex(m,h,m._indexStart,m._attributeStart/this.vertexSize)),m._batch=s;continue}b._batchTick=Pr,(n.count>=g||P)&&(this._finishBatch(s,f,u-f,n,a,o,e,d),d="renderBatch",f=u,a=A,o=m.topology,s=go(),n=s.textures,n.clear(),++Pr),m._textureId=b._textureBindLocation=n.count,n.ids[b.uid]=n.count,n.textures[n.count++]=b,m._batch=s,u+=m.indexSize,m.packAsQuad?(this.packQuadAttributes(m,l,c,m._attributeStart,m._textureId),this.packQuadIndex(h,m._indexStart,m._attributeStart/this.vertexSize)):(this.packAttributes(m,l,c,m._attributeStart,m._textureId),this.packIndex(m,h,m._indexStart,m._attributeStart/this.vertexSize))}n.count>0&&(this._finishBatch(s,f,u-f,n,a,o,e,d),f=u,++Pr),this.elementStart=this.elementSize,this._batchIndexStart=f,this._batchIndexSize=u}_finishBatch(e,r,s,n,i,a,o,l){e.gpuBindGroup=null,e.bindGroup=null,e.action=l,e.batcher=this,e.textures=n,e.blendMode=i,e.topology=a,e.start=r,e.size=s,++Pr,this.batches[this.batchIndex++]=e,o.add(e)}finish(e){this.break(e)}ensureAttributeBuffer(e){e*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(e*4)}ensureIndexBuffer(e){e<=this.indexBuffer.length||this._resizeIndexBuffer(e)}_resizeAttributeBuffer(e){const r=Math.max(e,this.attributeBuffer.size*2),s=new fo(r);po(this.attributeBuffer.rawBinaryData,s.rawBinaryData),this.attributeBuffer=s}_resizeIndexBuffer(e){const r=this.indexBuffer;let s=Math.max(e,r.length*1.5);s+=s%2;const n=s>65535?new Uint32Array(s):new Uint16Array(s);if(n.BYTES_PER_ELEMENT!==r.BYTES_PER_ELEMENT)for(let i=0;i<r.length;i++)n[i]=r[i];else po(r.buffer,n.buffer);this.indexBuffer=n}packQuadIndex(e,r,s){e[r]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+3]=s+0,e[r+4]=s+2,e[r+5]=s+3}packIndex(e,r,s,n){const i=e.indices,a=e.indexSize,o=e.indexOffset,l=e.attributeOffset;for(let c=0;c<a;c++)r[s++]=n+i[c+o]-l}destroy(){for(let e=0;e<this.batches.length;e++)xo(this.batches[e]);this.batches=null;for(let e=0;e<this._elements.length;e++)this._elements[e]._batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};_h.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let lp=_h;var je=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(je||{});class Vr extends xt{constructor(e){let{data:r,size:s}=e;const{usage:n,label:i,shrinkToFit:a}=e;super(),this.uid=xe("buffer"),this._resourceType="buffer",this._resourceId=xe("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,r instanceof Array&&(r=new Float32Array(r)),this._data=r,s??(s=r?.byteLength);const o=!!r;this.descriptor={size:s,usage:n,mappedAtCreation:o,label:i},this.shrinkToFit=a??!0}get data(){return this._data}set data(e){this.setDataWithSize(e,e.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&je.STATIC)}set static(e){e?this.descriptor.usage|=je.STATIC:this.descriptor.usage&=~je.STATIC}setDataWithSize(e,r,s){if(this._updateID++,this._updateSize=r*e.BYTES_PER_ELEMENT,this._data===e){s&&this.emit("update",this);return}const n=this._data;if(this._data=e,this._dataInt32=null,!n||n.length!==e.length){!this.shrinkToFit&&n&&e.byteLength<n.byteLength?s&&this.emit("update",this):(this.descriptor.size=e.byteLength,this._resourceId=xe("resource"),this.emit("change",this));return}s&&this.emit("update",this)}update(e){this._updateSize=e??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function vh(t,e){if(!(t instanceof Vr)){let r=e?je.INDEX:je.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),r=je.INDEX|je.COPY_DST):(t=new Float32Array(t),r=je.VERTEX|je.COPY_DST)),t=new Vr({data:t,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:r})}return t}function cp(t,e,r){const s=t.getAttribute(e);if(!s)return r.minX=0,r.minY=0,r.maxX=0,r.maxY=0,r;const n=s.buffer.data;let i=1/0,a=1/0,o=-1/0,l=-1/0;const c=n.BYTES_PER_ELEMENT,h=(s.offset||0)/c,u=(s.stride||2*4)/c;for(let f=h;f<n.length;f+=u){const d=n[f],g=n[f+1];d>o&&(o=d),g>l&&(l=g),d<i&&(i=d),g<a&&(a=g)}return r.minX=i,r.minY=a,r.maxX=o,r.maxY=l,r}function hp(t){return(t instanceof Vr||Array.isArray(t)||t.BYTES_PER_ELEMENT)&&(t={buffer:t}),t.buffer=vh(t.buffer,!1),t}class up extends xt{constructor(e={}){super(),this.uid=xe("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new ot,this._boundsDirty=!0;const{attributes:r,indexBuffer:s,topology:n}=e;if(this.buffers=[],this.attributes={},r)for(const i in r)this.addAttribute(i,r[i]);this.instanceCount=e.instanceCount??1,s&&this.addIndex(s),this.topology=n||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(e){return this.attributes[e]}getIndex(){return this.indexBuffer}getBuffer(e){return this.getAttribute(e).buffer}getSize(){for(const e in this.attributes){const r=this.attributes[e];return r.buffer.data.length/(r.stride/4||r.size)}return 0}addAttribute(e,r){const s=hp(r);this.buffers.indexOf(s.buffer)===-1&&(this.buffers.push(s.buffer),s.buffer.on("update",this.onBufferUpdate,this),s.buffer.on("change",this.onBufferUpdate,this)),this.attributes[e]=s}addIndex(e){this.indexBuffer=vh(e,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,cp(this,"aPosition",this._bounds)):this._bounds}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners(),e&&this.buffers.forEach(r=>r.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const dp=new Float32Array(1),fp=new Uint32Array(1);class pp extends up{constructor(){const r=new Vr({data:dp,label:"attribute-batch-buffer",usage:je.VERTEX|je.COPY_DST,shrinkToFit:!1}),s=new Vr({data:fp,label:"index-batch-buffer",usage:je.INDEX|je.COPY_DST,shrinkToFit:!1}),n=6*4;super({attributes:{aPosition:{buffer:r,format:"float32x2",stride:n,offset:0},aUV:{buffer:r,format:"float32x2",stride:n,offset:2*4},aColor:{buffer:r,format:"unorm8x4",stride:n,offset:4*4},aTextureIdAndRound:{buffer:r,format:"uint16x2",stride:n,offset:5*4}},indexBuffer:s})}}function yo(t,e,r){if(t)for(const s in t){const n=s.toLocaleLowerCase(),i=e[n];if(i){let a=t[s];s==="header"&&(a=a.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),r&&i.push(`//----${r}----//`),i.push(a)}else ue(`${s} placement hook does not exist in shader`)}}const mp=/\{\{(.*?)\}\}/g;function bo(t){const e={};return(t.match(mp)?.map(s=>s.replace(/[{()}]/g,""))??[]).forEach(s=>{e[s]=[]}),e}function wo(t,e){let r;const s=/@in\s+([^;]+);/g;for(;(r=s.exec(t))!==null;)e.push(r[1])}function _o(t,e,r=!1){const s=[];wo(e,s),t.forEach(o=>{o.header&&wo(o.header,s)});const n=s;r&&n.sort();const i=n.map((o,l)=>`       @location(${l}) ${o},`).join(`
`);let a=e.replace(/@in\s+[^;]+;\s*/g,"");return a=a.replace("{{in}}",`
${i}
`),a}function vo(t,e){let r;const s=/@out\s+([^;]+);/g;for(;(r=s.exec(t))!==null;)e.push(r[1])}function gp(t){const r=/\b(\w+)\s*:/g.exec(t);return r?r[1]:""}function xp(t){const e=/@.*?\s+/g;return t.replace(e,"")}function yp(t,e){const r=[];vo(e,r),t.forEach(l=>{l.header&&vo(l.header,r)});let s=0;const n=r.sort().map(l=>l.indexOf("builtin")>-1?l:`@location(${s++}) ${l}`).join(`,
`),i=r.sort().map(l=>`       var ${xp(l)};`).join(`
`),a=`return VSOutput(
            ${r.sort().map(l=>` ${gp(l)}`).join(`,
`)});`;let o=e.replace(/@out\s+[^;]+;\s*/g,"");return o=o.replace("{{struct}}",`
${n}
`),o=o.replace("{{start}}",`
${i}
`),o=o.replace("{{return}}",`
${a}
`),o}function So(t,e){let r=t;for(const s in e){const n=e[s];n.join(`
`).length?r=r.replace(`{{${s}}}`,`//-----${s} START-----//
${n.join(`
`)}
//----${s} FINISH----//`):r=r.replace(`{{${s}}}`,"")}return r}const Rt=Object.create(null),An=new Map;let bp=0;function wp({template:t,bits:e}){const r=Sh(t,e);if(Rt[r])return Rt[r];const{vertex:s,fragment:n}=vp(t,e);return Rt[r]=Ah(s,n,e),Rt[r]}function _p({template:t,bits:e}){const r=Sh(t,e);return Rt[r]||(Rt[r]=Ah(t.vertex,t.fragment,e)),Rt[r]}function vp(t,e){const r=e.map(a=>a.vertex).filter(a=>!!a),s=e.map(a=>a.fragment).filter(a=>!!a);let n=_o(r,t.vertex,!0);n=yp(r,n);const i=_o(s,t.fragment,!0);return{vertex:n,fragment:i}}function Sh(t,e){return e.map(r=>(An.has(r)||An.set(r,bp++),An.get(r))).sort((r,s)=>r-s).join("-")+t.vertex+t.fragment}function Ah(t,e,r){const s=bo(t),n=bo(e);return r.forEach(i=>{yo(i.vertex,s,i.name),yo(i.fragment,n,i.name)}),{vertex:So(t,s),fragment:So(e,n)}}const Sp=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}
        
        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);
       
        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,Ap=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;
   
    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {
        
        {{start}}

        var outColor:vec4<f32>;
      
        {{main}}
        
        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,kp=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;
        
        {{start}}
        
        vColor = vec4(1.);
        
        {{main}}
        
        vUV = uv;
        
        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,Cp=`
   
    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {
        
        {{start}}

        vec4 outColor;
      
        {{main}}
        
        finalColor = outColor * vColor;
        
        {{end}}
    }
`,Pp={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},Mp={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function Ip({bits:t,name:e}){const r=wp({template:{fragment:Ap,vertex:Sp},bits:[Pp,...t]});return $s.from({name:e,vertex:{source:r.vertex,entryPoint:"main"},fragment:{source:r.fragment,entryPoint:"main"}})}function Tp({bits:t,name:e}){return new dh({name:e,..._p({template:{vertex:kp,fragment:Cp},bits:[Mp,...t]})})}const Ep={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},Rp={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},kn={};function jp(t){const e=[];if(t===1)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let r=0;for(let s=0;s<t;s++)e.push(`@group(1) @binding(${r++}) var textureSource${s+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${r++}) var textureSampler${s+1}: sampler;`)}return e.join(`
`)}function Bp(t){const e=[];if(t===1)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let r=0;r<t;r++)r===t-1?e.push("  default:{"):e.push(`  case ${r}:{`),e.push(`      outColor = textureSampleGrad(textureSource${r+1}, textureSampler${r+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join(`
`)}function zp(t){return kn[t]||(kn[t]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${jp(t)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${Bp(t)}
            `}}),kn[t]}const Cn={};function Fp(t){const e=[];for(let r=0;r<t;r++)r>0&&e.push("else"),r<t-1&&e.push(`if(vTextureId < ${r}.5)`),e.push("{"),e.push(`	outColor = texture(uTextures[${r}], vUV);`),e.push("}");return e.join(`
`)}function Op(t){return Cn[t]||(Cn[t]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${t}];

            `,main:`

                ${Fp(t)}
            `}}),Cn[t]}const Np={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32> 
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Lp={name:"round-pixels-bit",vertex:{header:`   
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {       
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Ao={};function Gp(t){let e=Ao[t];if(e)return e;const r=new Int32Array(t);for(let s=0;s<t;s++)r[s]=s;return e=Ao[t]=new gh({uTextures:{value:r,type:"i32",size:t}},{isStatic:!0}),e}class Dp extends Qi{constructor(e){const r=Tp({name:"batch",bits:[Rp,Op(e),Lp]}),s=Ip({name:"batch",bits:[Ep,zp(e),Np]});super({glProgram:r,gpuProgram:s,resources:{batchSamplers:Gp(e)}})}}let ko=null;const kh=class Ch extends lp{constructor(){super(...arguments),this.geometry=new pp,this.shader=ko||(ko=new Dp(this.maxTextures)),this.name=Ch.extension.name,this.vertexSize=6}packAttributes(e,r,s,n,i){const a=i<<16|e.roundPixels&65535,o=e.transform,l=o.a,c=o.b,h=o.c,u=o.d,f=o.tx,d=o.ty,{positions:g,uvs:x}=e,m=e.color,w=e.attributeOffset,b=w+e.attributeSize;for(let A=w;A<b;A++){const P=A*2,E=g[P],I=g[P+1];r[n++]=l*E+h*I+f,r[n++]=u*I+c*E+d,r[n++]=x[P],r[n++]=x[P+1],s[n++]=m,s[n++]=a}}packQuadAttributes(e,r,s,n,i){const a=e.texture,o=e.transform,l=o.a,c=o.b,h=o.c,u=o.d,f=o.tx,d=o.ty,g=e.bounds,x=g.maxX,m=g.minX,w=g.maxY,b=g.minY,A=a.uvs,P=e.color,E=i<<16|e.roundPixels&65535;r[n+0]=l*m+h*b+f,r[n+1]=u*b+c*m+d,r[n+2]=A.x0,r[n+3]=A.y0,s[n+4]=P,s[n+5]=E,r[n+6]=l*x+h*b+f,r[n+7]=u*b+c*x+d,r[n+8]=A.x1,r[n+9]=A.y1,s[n+10]=P,s[n+11]=E,r[n+12]=l*x+h*w+f,r[n+13]=u*w+c*x+d,r[n+14]=A.x2,r[n+15]=A.y2,s[n+16]=P,s[n+17]=E,r[n+18]=l*m+h*w+f,r[n+19]=u*w+c*m+d,r[n+20]=A.x3,r[n+21]=A.y3,s[n+22]=P,s[n+23]=E}};kh.extension={type:[U.Batcher],name:"default"};let $p=kh;function Hp(t,e,r,s,n,i,a,o=null){let l=0;r*=e,n*=i;const c=o.a,h=o.b,u=o.c,f=o.d,d=o.tx,g=o.ty;for(;l<a;){const x=t[r],m=t[r+1];s[n]=c*x+u*m+d,s[n+1]=h*x+f*m+g,n+=i,r+=e,l++}}function Wp(t,e,r,s){let n=0;for(e*=r;n<s;)t[e]=0,t[e+1]=0,e+=r,n++}function Ph(t,e,r,s,n){const i=e.a,a=e.b,o=e.c,l=e.d,c=e.tx,h=e.ty;r||(r=0),s||(s=2),n||(n=t.length/s-r);let u=r*s;for(let f=0;f<n;f++){const d=t[u],g=t[u+1];t[u]=i*d+o*g+c,t[u+1]=a*d+l*g+h,u+=s}}const Up=new ee;class Mh{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const e=this.baseColor,r=e>>16|e&65280|(e&255)<<16,s=this.renderable;return s?Uc(r,s.groupColor)+(this.alpha*s.groupAlpha*255<<24):r+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||Up}copyTo(e){e.indexOffset=this.indexOffset,e.indexSize=this.indexSize,e.attributeOffset=this.attributeOffset,e.attributeSize=this.attributeSize,e.baseColor=this.baseColor,e.alpha=this.alpha,e.texture=this.texture,e.geometryData=this.geometryData,e.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}const qr={extension:{type:U.ShapeBuilder,name:"circle"},build(t,e){let r,s,n,i,a,o;if(t.type==="circle"){const P=t;r=P.x,s=P.y,a=o=P.radius,n=i=0}else if(t.type==="ellipse"){const P=t;r=P.x,s=P.y,a=P.halfWidth,o=P.halfHeight,n=i=0}else{const P=t,E=P.width/2,I=P.height/2;r=P.x+E,s=P.y+I,a=o=Math.max(0,Math.min(P.radius,Math.min(E,I))),n=E-a,i=I-o}if(!(a>=0&&o>=0&&n>=0&&i>=0))return e;const l=Math.ceil(2.3*Math.sqrt(a+o)),c=l*8+(n?4:0)+(i?4:0);if(c===0)return e;if(l===0)return e[0]=e[6]=r+n,e[1]=e[3]=s+i,e[2]=e[4]=r-n,e[5]=e[7]=s-i,e;let h=0,u=l*4+(n?2:0)+2,f=u,d=c,g=n+a,x=i,m=r+g,w=r-g,b=s+x;if(e[h++]=m,e[h++]=b,e[--u]=b,e[--u]=w,i){const P=s-x;e[f++]=w,e[f++]=P,e[--d]=P,e[--d]=m}for(let P=1;P<l;P++){const E=Math.PI/2*(P/l),I=n+Math.cos(E)*a,T=i+Math.sin(E)*o,N=r+I,z=r-I,j=s+T,$=s-T;e[h++]=N,e[h++]=j,e[--u]=j,e[--u]=z,e[f++]=z,e[f++]=$,e[--d]=$,e[--d]=N}g=n,x=i+o,m=r+g,w=r-g,b=s+x;const A=s-x;return e[h++]=m,e[h++]=b,e[--d]=A,e[--d]=m,n&&(e[h++]=w,e[h++]=b,e[--d]=A,e[--d]=w),e},triangulate(t,e,r,s,n,i){if(t.length===0)return;let a=0,o=0;for(let h=0;h<t.length;h+=2)a+=t[h],o+=t[h+1];a/=t.length/2,o/=t.length/2;let l=s;e[l*r]=a,e[l*r+1]=o;const c=l++;for(let h=0;h<t.length;h+=2)e[l*r]=t[h],e[l*r+1]=t[h+1],h>0&&(n[i++]=l,n[i++]=c,n[i++]=l-1),l++;n[i++]=c+1,n[i++]=c,n[i++]=l-1}},Vp={...qr,extension:{...qr.extension,name:"ellipse"}},qp={...qr,extension:{...qr.extension,name:"roundedRectangle"}},Ih=1e-4,Co=1e-4;function Yp(t){const e=t.length;if(e<6)return 1;let r=0;for(let s=0,n=t[e-2],i=t[e-1];s<e;s+=2){const a=t[s],o=t[s+1];r+=(a-n)*(o+i),n=a,i=o}return r<0?-1:1}function Po(t,e,r,s,n,i,a,o){const l=t-r*n,c=e-s*n,h=t+r*i,u=e+s*i;let f,d;a?(f=s,d=-r):(f=-s,d=r);const g=l+f,x=c+d,m=h+f,w=u+d;return o.push(g,x),o.push(m,w),2}function Ft(t,e,r,s,n,i,a,o){const l=r-t,c=s-e;let h=Math.atan2(l,c),u=Math.atan2(n-t,i-e);o&&h<u?h+=Math.PI*2:!o&&h>u&&(u+=Math.PI*2);let f=h;const d=u-h,g=Math.abs(d),x=Math.sqrt(l*l+c*c),m=(15*g*Math.sqrt(x)/Math.PI>>0)+1,w=d/m;if(f+=w,o){a.push(t,e),a.push(r,s);for(let b=1,A=f;b<m;b++,A+=w)a.push(t,e),a.push(t+Math.sin(A)*x,e+Math.cos(A)*x);a.push(t,e),a.push(n,i)}else{a.push(r,s),a.push(t,e);for(let b=1,A=f;b<m;b++,A+=w)a.push(t+Math.sin(A)*x,e+Math.cos(A)*x),a.push(t,e);a.push(n,i),a.push(t,e)}return m*2}function Xp(t,e,r,s,n,i){const a=Ih;if(t.length===0)return;const o=e;let l=o.alignment;if(e.alignment!==.5){let v=Yp(t);l=(l-.5)*v+.5}const c=new Me(t[0],t[1]),h=new Me(t[t.length-2],t[t.length-1]),u=s,f=Math.abs(c.x-h.x)<a&&Math.abs(c.y-h.y)<a;if(u){t=t.slice(),f&&(t.pop(),t.pop(),h.set(t[t.length-2],t[t.length-1]));const v=(c.x+h.x)*.5,_=(h.y+c.y)*.5;t.unshift(v,_),t.push(v,_)}const d=n,g=t.length/2;let x=t.length;const m=d.length/2,w=o.width/2,b=w*w,A=o.miterLimit*o.miterLimit;let P=t[0],E=t[1],I=t[2],T=t[3],N=0,z=0,j=-(E-T),$=P-I,K=0,Q=0,ae=Math.sqrt(j*j+$*$);j/=ae,$/=ae,j*=w,$*=w;const Oe=l,y=(1-Oe)*2,S=Oe*2;u||(o.cap==="round"?x+=Ft(P-j*(y-S)*.5,E-$*(y-S)*.5,P-j*y,E-$*y,P+j*S,E+$*S,d,!0)+2:o.cap==="square"&&(x+=Po(P,E,j,$,y,S,!0,d))),d.push(P-j*y,E-$*y),d.push(P+j*S,E+$*S);for(let v=1;v<g-1;++v){P=t[(v-1)*2],E=t[(v-1)*2+1],I=t[v*2],T=t[v*2+1],N=t[(v+1)*2],z=t[(v+1)*2+1],j=-(E-T),$=P-I,ae=Math.sqrt(j*j+$*$),j/=ae,$/=ae,j*=w,$*=w,K=-(T-z),Q=I-N,ae=Math.sqrt(K*K+Q*Q),K/=ae,Q/=ae,K*=w,Q*=w;const _=I-P,C=E-T,M=I-N,R=z-T,B=_*M+C*R,G=C*M-R*_,V=G<0;if(Math.abs(G)<.001*Math.abs(B)){d.push(I-j*y,T-$*y),d.push(I+j*S,T+$*S),B>=0&&(o.join==="round"?x+=Ft(I,T,I-j*y,T-$*y,I-K*y,T-Q*y,d,!1)+4:x+=2,d.push(I-K*S,T-Q*S),d.push(I+K*y,T+Q*y));continue}const q=(-j+P)*(-$+T)-(-j+I)*(-$+E),Y=(-K+N)*(-Q+T)-(-K+I)*(-Q+z),ie=(_*Y-M*q)/G,X=(R*q-C*Y)/G,bt=(ie-I)*(ie-I)+(X-T)*(X-T),Ne=I+(ie-I)*y,ct=T+(X-T)*y,ht=I-(ie-I)*S,Z=T-(X-T)*S,re=Math.min(_*_+C*C,M*M+R*R),Ta=V?y:S,qu=re+Ta*Ta*b;bt<=qu?o.join==="bevel"||bt/b>A?(V?(d.push(Ne,ct),d.push(I+j*S,T+$*S),d.push(Ne,ct),d.push(I+K*S,T+Q*S)):(d.push(I-j*y,T-$*y),d.push(ht,Z),d.push(I-K*y,T-Q*y),d.push(ht,Z)),x+=2):o.join==="round"?V?(d.push(Ne,ct),d.push(I+j*S,T+$*S),x+=Ft(I,T,I+j*S,T+$*S,I+K*S,T+Q*S,d,!0)+4,d.push(Ne,ct),d.push(I+K*S,T+Q*S)):(d.push(I-j*y,T-$*y),d.push(ht,Z),x+=Ft(I,T,I-j*y,T-$*y,I-K*y,T-Q*y,d,!1)+4,d.push(I-K*y,T-Q*y),d.push(ht,Z)):(d.push(Ne,ct),d.push(ht,Z)):(d.push(I-j*y,T-$*y),d.push(I+j*S,T+$*S),o.join==="round"?V?x+=Ft(I,T,I+j*S,T+$*S,I+K*S,T+Q*S,d,!0)+2:x+=Ft(I,T,I-j*y,T-$*y,I-K*y,T-Q*y,d,!1)+2:o.join==="miter"&&bt/b<=A&&(V?(d.push(ht,Z),d.push(ht,Z)):(d.push(Ne,ct),d.push(Ne,ct)),x+=2),d.push(I-K*y,T-Q*y),d.push(I+K*S,T+Q*S),x+=2)}P=t[(g-2)*2],E=t[(g-2)*2+1],I=t[(g-1)*2],T=t[(g-1)*2+1],j=-(E-T),$=P-I,ae=Math.sqrt(j*j+$*$),j/=ae,$/=ae,j*=w,$*=w,d.push(I-j*y,T-$*y),d.push(I+j*S,T+$*S),u||(o.cap==="round"?x+=Ft(I-j*(y-S)*.5,T-$*(y-S)*.5,I-j*y,T-$*y,I+j*S,T+$*S,d,!1)+2:o.cap==="square"&&(x+=Po(I,T,j,$,y,S,!1,d)));const k=Co*Co;for(let v=m;v<x+m-2;++v)P=d[v*2],E=d[v*2+1],I=d[(v+1)*2],T=d[(v+1)*2+1],N=d[(v+2)*2],z=d[(v+2)*2+1],!(Math.abs(P*(T-z)+I*(z-E)+N*(E-T))<k)&&i.push(v,v+1,v+2)}function Kp(t,e,r,s){const n=Ih;if(t.length===0)return;const i=t[0],a=t[1],o=t[t.length-2],l=t[t.length-1],c=e||Math.abs(i-o)<n&&Math.abs(a-l)<n,h=r,u=t.length/2,f=h.length/2;for(let d=0;d<u;d++)h.push(t[d*2]),h.push(t[d*2+1]);for(let d=0;d<u-1;d++)s.push(f+d,f+d+1);c&&s.push(f+u-1,f)}function Th(t,e,r,s,n,i,a){const o=Wf(t,e,2);if(!o)return;for(let c=0;c<o.length;c+=3)i[a++]=o[c]+n,i[a++]=o[c+1]+n,i[a++]=o[c+2]+n;let l=n*s;for(let c=0;c<t.length;c+=2)r[l]=t[c],r[l+1]=t[c+1],l+=s}const Zp=[],Qp={extension:{type:U.ShapeBuilder,name:"polygon"},build(t,e){for(let r=0;r<t.points.length;r++)e[r]=t.points[r];return e},triangulate(t,e,r,s,n,i){Th(t,Zp,e,r,s,n,i)}},Jp={extension:{type:U.ShapeBuilder,name:"rectangle"},build(t,e){const r=t,s=r.x,n=r.y,i=r.width,a=r.height;return i>=0&&a>=0&&(e[0]=s,e[1]=n,e[2]=s+i,e[3]=n,e[4]=s+i,e[5]=n+a,e[6]=s,e[7]=n+a),e},triangulate(t,e,r,s,n,i){let a=0;s*=r,e[s+a]=t[0],e[s+a+1]=t[1],a+=r,e[s+a]=t[2],e[s+a+1]=t[3],a+=r,e[s+a]=t[6],e[s+a+1]=t[7],a+=r,e[s+a]=t[4],e[s+a+1]=t[5],a+=r;const o=s/r;n[i++]=o,n[i++]=o+1,n[i++]=o+2,n[i++]=o+1,n[i++]=o+3,n[i++]=o+2}},em={extension:{type:U.ShapeBuilder,name:"triangle"},build(t,e){return e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,e},triangulate(t,e,r,s,n,i){let a=0;s*=r,e[s+a]=t[0],e[s+a+1]=t[1],a+=r,e[s+a]=t[2],e[s+a+1]=t[3],a+=r,e[s+a]=t[4],e[s+a+1]=t[5];const o=s/r;n[i++]=o,n[i++]=o+1,n[i++]=o+2}},tm=new ee,rm=new ge;function sm(t,e,r,s){const n=e.matrix?t.copyFrom(e.matrix).invert():t.identity();if(e.textureSpace==="local"){const i=r.getBounds(rm);n.translate(-i.x,-i.y),n.scale(1/i.width,1/i.height)}else{n.translate(e.texture.frame.x,e.texture.frame.y),n.scale(1/e.texture.source.width,1/e.texture.source.height);const i=e.texture.source.style;i.addressMode==="clamp-to-edge"&&(i.addressMode="repeat",i.update())}return s&&n.append(tm.copyFrom(s).invert()),n}const Ws={};Be.handleByMap(U.ShapeBuilder,Ws);Be.add(Jp,Qp,em,qr,Vp,qp);const nm=new ge,im=new ee;function am(t,e){const{geometryData:r,batches:s}=e;s.length=0,r.indices.length=0,r.vertices.length=0,r.uvs.length=0;for(let n=0;n<t.instructions.length;n++){const i=t.instructions[n];if(i.action==="texture")om(i.data,s,r);else if(i.action==="fill"||i.action==="stroke"){const a=i.action==="stroke",o=i.data.path.shapePath,l=i.data.style,c=i.data.hole;a&&c&&Mo(c.shapePath,l,!0,s,r),c&&(o.shapePrimitives[o.shapePrimitives.length-1].holes=c.shapePath.shapePrimitives),Mo(o,l,a,s,r)}}}function om(t,e,r){const{vertices:s,uvs:n,indices:i}=r,a=i.length,o=s.length/2,l=[],c=Ws.rectangle,h=nm,u=t.image;h.x=t.dx,h.y=t.dy,h.width=t.dw,h.height=t.dh;const f=t.transform;c.build(h,l),f&&Ph(l,f),c.triangulate(l,s,2,o,i,a);const d=u.uvs;n.push(d.x0,d.y0,d.x1,d.y1,d.x3,d.y3,d.x2,d.y2);const g=kt.get(Mh);g.indexOffset=a,g.indexSize=i.length-a,g.attributeOffset=o,g.attributeSize=s.length/2-o,g.baseColor=t.style,g.alpha=t.alpha,g.texture=u,g.geometryData=r,e.push(g)}function Mo(t,e,r,s,n){const{vertices:i,uvs:a,indices:o}=n;t.shapePrimitives.forEach(({shape:l,transform:c,holes:h})=>{const u=o.length,f=i.length/2,d=[],g=Ws[l.type];let x="triangle-list";if(g.build(l,d),c&&Ph(d,c),r){const A=l.closePath??!0,P=e;P.pixelLine?(Kp(d,A,i,o),x="line-list"):Xp(d,P,!1,A,i,o)}else if(h){const A=[],P=d.slice();lm(h).forEach(I=>{A.push(P.length/2),P.push(...I)}),Th(P,A,i,2,f,o,u)}else g.triangulate(d,i,2,f,o,u);const m=a.length/2,w=e.texture;if(w!==J.WHITE){const A=sm(im,e,l,c);Hp(i,2,f,a,m,2,i.length/2-f,A)}else Wp(a,m,2,i.length/2-f);const b=kt.get(Mh);b.indexOffset=u,b.indexSize=o.length-u,b.attributeOffset=f,b.attributeSize=i.length/2-f,b.baseColor=e.color,b.alpha=e.alpha,b.texture=w,b.geometryData=n,b.topology=x,s.push(b)})}function lm(t){const e=[];for(let r=0;r<t.length;r++){const s=t[r].shape,n=[];Ws[s.type].build(s,n),e.push(n)}return e}class cm{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class hm{constructor(){this.batcher=new $p,this.instructions=new Xc}init(){this.instructions.reset()}get geometry(){return me(Md,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const sa=class Pi{constructor(e){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),e.renderableGC.addManagedHash(this,"_gpuContextHash"),e.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(e){Pi.defaultOptions.bezierSmoothness=e?.bezierSmoothness??Pi.defaultOptions.bezierSmoothness}getContextRenderData(e){return this._graphicsDataContextHash[e.uid]||this._initContextRenderData(e)}updateGpuContext(e){let r=this._gpuContextHash[e.uid]||this._initContext(e);if(e.dirty){r?this._cleanGraphicsContextData(e):r=this._initContext(e),am(e,r);const s=e.batchMode;e.customShader||s==="no-batch"?r.isBatchable=!1:s==="auto"&&(r.isBatchable=r.geometryData.vertices.length<400),e.dirty=!1}return r}getGpuContext(e){return this._gpuContextHash[e.uid]||this._initContext(e)}_initContextRenderData(e){const r=kt.get(hm),{batches:s,geometryData:n}=this._gpuContextHash[e.uid],i=n.vertices.length,a=n.indices.length;for(let h=0;h<s.length;h++)s[h].applyTransform=!1;const o=r.batcher;o.ensureAttributeBuffer(i),o.ensureIndexBuffer(a),o.begin();for(let h=0;h<s.length;h++){const u=s[h];o.add(u)}o.finish(r.instructions);const l=o.geometry;l.indexBuffer.setDataWithSize(o.indexBuffer,o.indexSize,!0),l.buffers[0].setDataWithSize(o.attributeBuffer.float32View,o.attributeSize,!0);const c=o.batches;for(let h=0;h<c.length;h++){const u=c[h];u.bindGroup=rp(u.textures.textures,u.textures.count)}return this._graphicsDataContextHash[e.uid]=r,r}_initContext(e){const r=new cm;return r.context=e,this._gpuContextHash[e.uid]=r,e.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]}onGraphicsContextDestroy(e){this._cleanGraphicsContextData(e),e.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]=null}_cleanGraphicsContextData(e){const r=this._gpuContextHash[e.uid];r.isBatchable||this._graphicsDataContextHash[e.uid]&&(kt.return(this.getContextRenderData(e)),this._graphicsDataContextHash[e.uid]=null),r.batches&&r.batches.forEach(s=>{kt.return(s)})}destroy(){for(const e in this._gpuContextHash)this._gpuContextHash[e]&&this.onGraphicsContextDestroy(this._gpuContextHash[e].context)}};sa.extension={type:[U.WebGLSystem,U.WebGPUSystem,U.CanvasSystem],name:"graphicsContext"};sa.defaultOptions={bezierSmoothness:.5};let Eh=sa;const um=8,us=11920929e-14,dm=1;function Rh(t,e,r,s,n,i,a,o,l,c){const u=Math.min(.99,Math.max(0,c??Eh.defaultOptions.bezierSmoothness));let f=(dm-u)/1;return f*=f,fm(e,r,s,n,i,a,o,l,t,f),t}function fm(t,e,r,s,n,i,a,o,l,c){Mi(t,e,r,s,n,i,a,o,l,c,0),l.push(a,o)}function Mi(t,e,r,s,n,i,a,o,l,c,h){if(h>um)return;const u=(t+r)/2,f=(e+s)/2,d=(r+n)/2,g=(s+i)/2,x=(n+a)/2,m=(i+o)/2,w=(u+d)/2,b=(f+g)/2,A=(d+x)/2,P=(g+m)/2,E=(w+A)/2,I=(b+P)/2;if(h>0){let T=a-t,N=o-e;const z=Math.abs((r-a)*N-(s-o)*T),j=Math.abs((n-a)*N-(i-o)*T);if(z>us&&j>us){if((z+j)*(z+j)<=c*(T*T+N*N)){l.push(E,I);return}}else if(z>us){if(z*z<=c*(T*T+N*N)){l.push(E,I);return}}else if(j>us){if(j*j<=c*(T*T+N*N)){l.push(E,I);return}}else if(T=E-(t+a)/2,N=I-(e+o)/2,T*T+N*N<=c){l.push(E,I);return}}Mi(t,e,u,f,w,b,E,I,l,c,h+1),Mi(E,I,A,P,x,m,a,o,l,c,h+1)}const pm=8,mm=11920929e-14,gm=1;function xm(t,e,r,s,n,i,a,o){const c=Math.min(.99,Math.max(0,o??Eh.defaultOptions.bezierSmoothness));let h=(gm-c)/1;return h*=h,ym(e,r,s,n,i,a,t,h),t}function ym(t,e,r,s,n,i,a,o){Ii(a,t,e,r,s,n,i,o,0),a.push(n,i)}function Ii(t,e,r,s,n,i,a,o,l){if(l>pm)return;const c=(e+s)/2,h=(r+n)/2,u=(s+i)/2,f=(n+a)/2,d=(c+u)/2,g=(h+f)/2;let x=i-e,m=a-r;const w=Math.abs((s-i)*m-(n-a)*x);if(w>mm){if(w*w<=o*(x*x+m*m)){t.push(d,g);return}}else if(x=d-(e+i)/2,m=g-(r+a)/2,x*x+m*m<=o){t.push(d,g);return}Ii(t,e,r,c,h,d,g,o,l+1),Ii(t,d,g,u,f,i,a,o,l+1)}function jh(t,e,r,s,n,i,a,o){let l=Math.abs(n-i);(!a&&n>i||a&&i>n)&&(l=2*Math.PI-l),o||(o=Math.max(6,Math.floor(6*Math.pow(s,1/3)*(l/Math.PI)))),o=Math.max(o,3);let c=l/o,h=n;c*=a?-1:1;for(let u=0;u<o+1;u++){const f=Math.cos(h),d=Math.sin(h),g=e+f*s,x=r+d*s;t.push(g,x),h+=c}}function bm(t,e,r,s,n,i){const a=t[t.length-2],l=t[t.length-1]-r,c=a-e,h=n-r,u=s-e,f=Math.abs(l*u-c*h);if(f<1e-8||i===0){(t[t.length-2]!==e||t[t.length-1]!==r)&&t.push(e,r);return}const d=l*l+c*c,g=h*h+u*u,x=l*h+c*u,m=i*Math.sqrt(d)/f,w=i*Math.sqrt(g)/f,b=m*x/d,A=w*x/g,P=m*u+w*c,E=m*h+w*l,I=c*(w+b),T=l*(w+b),N=u*(m+A),z=h*(m+A),j=Math.atan2(T-E,I-P),$=Math.atan2(z-E,N-P);jh(t,P+e,E+r,i,j,$,c*h>u*l)}const Hr=Math.PI*2,Pn={centerX:0,centerY:0,ang1:0,ang2:0},Mn=({x:t,y:e},r,s,n,i,a,o,l)=>{t*=r,e*=s;const c=n*t-i*e,h=i*t+n*e;return l.x=c+a,l.y=h+o,l};function wm(t,e){const r=e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),s=e===1.5707963267948966?.551915024494:r,n=Math.cos(t),i=Math.sin(t),a=Math.cos(t+e),o=Math.sin(t+e);return[{x:n-i*s,y:i+n*s},{x:a+o*s,y:o-a*s},{x:a,y:o}]}const Io=(t,e,r,s)=>{const n=t*s-e*r<0?-1:1;let i=t*r+e*s;return i>1&&(i=1),i<-1&&(i=-1),n*Math.acos(i)},_m=(t,e,r,s,n,i,a,o,l,c,h,u,f)=>{const d=Math.pow(n,2),g=Math.pow(i,2),x=Math.pow(h,2),m=Math.pow(u,2);let w=d*g-d*m-g*x;w<0&&(w=0),w/=d*m+g*x,w=Math.sqrt(w)*(a===o?-1:1);const b=w*n/i*u,A=w*-i/n*h,P=c*b-l*A+(t+r)/2,E=l*b+c*A+(e+s)/2,I=(h-b)/n,T=(u-A)/i,N=(-h-b)/n,z=(-u-A)/i,j=Io(1,0,I,T);let $=Io(I,T,N,z);o===0&&$>0&&($-=Hr),o===1&&$<0&&($+=Hr),f.centerX=P,f.centerY=E,f.ang1=j,f.ang2=$};function vm(t,e,r,s,n,i,a,o=0,l=0,c=0){if(i===0||a===0)return;const h=Math.sin(o*Hr/360),u=Math.cos(o*Hr/360),f=u*(e-s)/2+h*(r-n)/2,d=-h*(e-s)/2+u*(r-n)/2;if(f===0&&d===0)return;i=Math.abs(i),a=Math.abs(a);const g=Math.pow(f,2)/Math.pow(i,2)+Math.pow(d,2)/Math.pow(a,2);g>1&&(i*=Math.sqrt(g),a*=Math.sqrt(g)),_m(e,r,s,n,i,a,l,c,h,u,f,d,Pn);let{ang1:x,ang2:m}=Pn;const{centerX:w,centerY:b}=Pn;let A=Math.abs(m)/(Hr/4);Math.abs(1-A)<1e-7&&(A=1);const P=Math.max(Math.ceil(A),1);m/=P;let E=t[t.length-2],I=t[t.length-1];const T={x:0,y:0};for(let N=0;N<P;N++){const z=wm(x,m),{x:j,y:$}=Mn(z[0],i,a,u,h,w,b,T),{x:K,y:Q}=Mn(z[1],i,a,u,h,w,b,T),{x:ae,y:Oe}=Mn(z[2],i,a,u,h,w,b,T);Rh(t,E,I,j,$,K,Q,ae,Oe),E=ae,I=Oe,x+=m}}function Sm(t,e,r){const s=(a,o)=>{const l=o.x-a.x,c=o.y-a.y,h=Math.sqrt(l*l+c*c),u=l/h,f=c/h;return{len:h,nx:u,ny:f}},n=(a,o)=>{a===0?t.moveTo(o.x,o.y):t.lineTo(o.x,o.y)};let i=e[e.length-1];for(let a=0;a<e.length;a++){const o=e[a%e.length],l=o.radius??r;if(l<=0){n(a,o),i=o;continue}const c=e[(a+1)%e.length],h=s(o,i),u=s(o,c);if(h.len<1e-4||u.len<1e-4){n(a,o),i=o;continue}let f=Math.asin(h.nx*u.ny-h.ny*u.nx),d=1,g=!1;h.nx*u.nx-h.ny*-u.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,d=-1,g=!0):f>0&&(d=-1,g=!0);const x=f/2;let m,w=Math.abs(Math.cos(x)*l/Math.sin(x));w>Math.min(h.len/2,u.len/2)?(w=Math.min(h.len/2,u.len/2),m=Math.abs(w*Math.sin(x)/Math.cos(x))):m=l;const b=o.x+u.nx*w+-u.ny*m*d,A=o.y+u.ny*w+u.nx*m*d,P=Math.atan2(h.ny,h.nx)+Math.PI/2*d,E=Math.atan2(u.ny,u.nx)-Math.PI/2*d;a===0&&t.moveTo(b+Math.cos(P)*m,A+Math.sin(P)*m),t.arc(b,A,m,P,E,g),i=o}}function Am(t,e,r,s){const n=(o,l)=>Math.sqrt((o.x-l.x)**2+(o.y-l.y)**2),i=(o,l,c)=>({x:o.x+(l.x-o.x)*c,y:o.y+(l.y-o.y)*c}),a=e.length;for(let o=0;o<a;o++){const l=e[(o+1)%a],c=l.radius??r;if(c<=0){o===0?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y);continue}const h=e[o],u=e[(o+2)%a],f=n(h,l);let d;if(f<1e-4)d=l;else{const m=Math.min(f/2,c);d=i(l,h,m/f)}const g=n(u,l);let x;if(g<1e-4)x=l;else{const m=Math.min(g/2,c);x=i(l,u,m/g)}o===0?t.moveTo(d.x,d.y):t.lineTo(d.x,d.y),t.quadraticCurveTo(l.x,l.y,x.x,x.y,s)}}const km=new ge;class Cm{constructor(e){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new ot,this._graphicsPath2D=e,this.signed=e.checkForHoles}moveTo(e,r){return this.startPoly(e,r),this}lineTo(e,r){this._ensurePoly();const s=this._currentPoly.points,n=s[s.length-2],i=s[s.length-1];return(n!==e||i!==r)&&s.push(e,r),this}arc(e,r,s,n,i,a){this._ensurePoly(!1);const o=this._currentPoly.points;return jh(o,e,r,s,n,i,a),this}arcTo(e,r,s,n,i){this._ensurePoly();const a=this._currentPoly.points;return bm(a,e,r,s,n,i),this}arcToSvg(e,r,s,n,i,a,o){const l=this._currentPoly.points;return vm(l,this._currentPoly.lastX,this._currentPoly.lastY,a,o,e,r,s,n,i),this}bezierCurveTo(e,r,s,n,i,a,o){this._ensurePoly();const l=this._currentPoly;return Rh(this._currentPoly.points,l.lastX,l.lastY,e,r,s,n,i,a,o),this}quadraticCurveTo(e,r,s,n,i){this._ensurePoly();const a=this._currentPoly;return xm(this._currentPoly.points,a.lastX,a.lastY,e,r,s,n,i),this}closePath(){return this.endPoly(!0),this}addPath(e,r){this.endPoly(),r&&!r.isIdentity()&&(e=e.clone(!0),e.transform(r));const s=this.shapePrimitives,n=s.length;for(let i=0;i<e.instructions.length;i++){const a=e.instructions[i];this[a.action](...a.data)}if(e.checkForHoles&&s.length-n>1){let i=null;for(let a=n;a<s.length;a++){const o=s[a];if(o.shape.type==="polygon"){const l=o.shape,c=i?.shape;c&&c.containsPolygon(l)?(i.holes||(i.holes=[]),i.holes.push(o),s.copyWithin(a,a+1),s.length--,a--):i=o}}}return this}finish(e=!1){this.endPoly(e)}rect(e,r,s,n,i){return this.drawShape(new ge(e,r,s,n),i),this}circle(e,r,s,n){return this.drawShape(new ea(e,r,s),n),this}poly(e,r,s){const n=new $r(e);return n.closePath=r,this.drawShape(n,s),this}regularPoly(e,r,s,n,i=0,a){n=Math.max(n|0,3);const o=-1*Math.PI/2+i,l=Math.PI*2/n,c=[];for(let h=0;h<n;h++){const u=o-h*l;c.push(e+s*Math.cos(u),r+s*Math.sin(u))}return this.poly(c,!0,a),this}roundPoly(e,r,s,n,i,a=0,o){if(n=Math.max(n|0,3),i<=0)return this.regularPoly(e,r,s,n,a);const l=s*Math.sin(Math.PI/n)-.001;i=Math.min(i,l);const c=-1*Math.PI/2+a,h=Math.PI*2/n,u=(n-2)*Math.PI/n/2;for(let f=0;f<n;f++){const d=f*h+c,g=e+s*Math.cos(d),x=r+s*Math.sin(d),m=d+Math.PI+u,w=d-Math.PI-u,b=g+i*Math.cos(m),A=x+i*Math.sin(m),P=g+i*Math.cos(w),E=x+i*Math.sin(w);f===0?this.moveTo(b,A):this.lineTo(b,A),this.quadraticCurveTo(g,x,P,E,o)}return this.closePath()}roundShape(e,r,s=!1,n){return e.length<3?this:(s?Am(this,e,r,n):Sm(this,e,r),this.closePath())}filletRect(e,r,s,n,i){if(i===0)return this.rect(e,r,s,n);const a=Math.min(s,n)/2,o=Math.min(a,Math.max(-a,i)),l=e+s,c=r+n,h=o<0?-o:0,u=Math.abs(o);return this.moveTo(e,r+u).arcTo(e+h,r+h,e+u,r,u).lineTo(l-u,r).arcTo(l-h,r+h,l,r+u,u).lineTo(l,c-u).arcTo(l-h,c-h,e+s-u,c,u).lineTo(e+u,c).arcTo(e+h,c-h,e,c-u,u).closePath()}chamferRect(e,r,s,n,i,a){if(i<=0)return this.rect(e,r,s,n);const o=Math.min(i,Math.min(s,n)/2),l=e+s,c=r+n,h=[e+o,r,l-o,r,l,r+o,l,c-o,l-o,c,e+o,c,e,c-o,e,r+o];for(let u=h.length-1;u>=2;u-=2)h[u]===h[u-2]&&h[u-1]===h[u-3]&&h.splice(u-1,2);return this.poly(h,!0,a)}ellipse(e,r,s,n,i){return this.drawShape(new ta(e,r,s,n),i),this}roundRect(e,r,s,n,i,a){return this.drawShape(new ra(e,r,s,n,i),a),this}drawShape(e,r){return this.endPoly(),this.shapePrimitives.push({shape:e,transform:r}),this}startPoly(e,r){let s=this._currentPoly;return s&&this.endPoly(),s=new $r,s.points.push(e,r),this._currentPoly=s,this}endPoly(e=!1){const r=this._currentPoly;return r&&r.points.length>2&&(r.closePath=e,this.shapePrimitives.push({shape:r})),this._currentPoly=null,this}_ensurePoly(e=!0){if(!this._currentPoly&&(this._currentPoly=new $r,e)){const r=this.shapePrimitives[this.shapePrimitives.length-1];if(r){let s=r.shape.x,n=r.shape.y;if(r.transform&&!r.transform.isIdentity()){const i=r.transform,a=s;s=i.a*s+i.c*n+i.tx,n=i.b*a+i.d*n+i.ty}this._currentPoly.points.push(s,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const e=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let r=0;r<e.instructions.length;r++){const s=e.instructions[r];this[s.action](...s.data)}this.finish()}get bounds(){const e=this._bounds;e.clear();const r=this.shapePrimitives;for(let s=0;s<r.length;s++){const n=r[s],i=n.shape.getBounds(km);n.transform?e.addRect(i,n.transform):e.addRect(i)}return e}}class gr{constructor(e,r=!1){this.instructions=[],this.uid=xe("graphicsPath"),this._dirty=!0,this.checkForHoles=r,typeof e=="string"?Xf(e,this):this.instructions=e?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new Cm(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(e,r){return e=e.clone(),this.instructions.push({action:"addPath",data:[e,r]}),this._dirty=!0,this}arc(...e){return this.instructions.push({action:"arc",data:e}),this._dirty=!0,this}arcTo(...e){return this.instructions.push({action:"arcTo",data:e}),this._dirty=!0,this}arcToSvg(...e){return this.instructions.push({action:"arcToSvg",data:e}),this._dirty=!0,this}bezierCurveTo(...e){return this.instructions.push({action:"bezierCurveTo",data:e}),this._dirty=!0,this}bezierCurveToShort(e,r,s,n,i){const a=this.instructions[this.instructions.length-1],o=this.getLastPoint(Me.shared);let l=0,c=0;if(!a||a.action!=="bezierCurveTo")l=o.x,c=o.y;else{l=a.data[2],c=a.data[3];const h=o.x,u=o.y;l=h+(h-l),c=u+(u-c)}return this.instructions.push({action:"bezierCurveTo",data:[l,c,e,r,s,n,i]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...e){return this.instructions.push({action:"ellipse",data:e}),this._dirty=!0,this}lineTo(...e){return this.instructions.push({action:"lineTo",data:e}),this._dirty=!0,this}moveTo(...e){return this.instructions.push({action:"moveTo",data:e}),this}quadraticCurveTo(...e){return this.instructions.push({action:"quadraticCurveTo",data:e}),this._dirty=!0,this}quadraticCurveToShort(e,r,s){const n=this.instructions[this.instructions.length-1],i=this.getLastPoint(Me.shared);let a=0,o=0;if(!n||n.action!=="quadraticCurveTo")a=i.x,o=i.y;else{a=n.data[0],o=n.data[1];const l=i.x,c=i.y;a=l+(l-a),o=c+(c-o)}return this.instructions.push({action:"quadraticCurveTo",data:[a,o,e,r,s]}),this._dirty=!0,this}rect(e,r,s,n,i){return this.instructions.push({action:"rect",data:[e,r,s,n,i]}),this._dirty=!0,this}circle(e,r,s,n){return this.instructions.push({action:"circle",data:[e,r,s,n]}),this._dirty=!0,this}roundRect(...e){return this.instructions.push({action:"roundRect",data:e}),this._dirty=!0,this}poly(...e){return this.instructions.push({action:"poly",data:e}),this._dirty=!0,this}regularPoly(...e){return this.instructions.push({action:"regularPoly",data:e}),this._dirty=!0,this}roundPoly(...e){return this.instructions.push({action:"roundPoly",data:e}),this._dirty=!0,this}roundShape(...e){return this.instructions.push({action:"roundShape",data:e}),this._dirty=!0,this}filletRect(...e){return this.instructions.push({action:"filletRect",data:e}),this._dirty=!0,this}chamferRect(...e){return this.instructions.push({action:"chamferRect",data:e}),this._dirty=!0,this}star(e,r,s,n,i,a,o){i||(i=n/2);const l=-1*Math.PI/2+a,c=s*2,h=Math.PI*2/c,u=[];for(let f=0;f<c;f++){const d=f%2?i:n,g=f*h+l;u.push(e+d*Math.cos(g),r+d*Math.sin(g))}return this.poly(u,!0,o),this}clone(e=!1){const r=new gr;if(r.checkForHoles=this.checkForHoles,!e)r.instructions=this.instructions.slice();else for(let s=0;s<this.instructions.length;s++){const n=this.instructions[s];r.instructions.push({action:n.action,data:n.data.slice()})}return r}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(e){if(e.isIdentity())return this;const r=e.a,s=e.b,n=e.c,i=e.d,a=e.tx,o=e.ty;let l=0,c=0,h=0,u=0,f=0,d=0,g=0,x=0;for(let m=0;m<this.instructions.length;m++){const w=this.instructions[m],b=w.data;switch(w.action){case"moveTo":case"lineTo":l=b[0],c=b[1],b[0]=r*l+n*c+a,b[1]=s*l+i*c+o;break;case"bezierCurveTo":h=b[0],u=b[1],f=b[2],d=b[3],l=b[4],c=b[5],b[0]=r*h+n*u+a,b[1]=s*h+i*u+o,b[2]=r*f+n*d+a,b[3]=s*f+i*d+o,b[4]=r*l+n*c+a,b[5]=s*l+i*c+o;break;case"quadraticCurveTo":h=b[0],u=b[1],l=b[2],c=b[3],b[0]=r*h+n*u+a,b[1]=s*h+i*u+o,b[2]=r*l+n*c+a,b[3]=s*l+i*c+o;break;case"arcToSvg":l=b[5],c=b[6],g=b[0],x=b[1],b[0]=r*g+n*x,b[1]=s*g+i*x,b[5]=r*l+n*c+a,b[6]=s*l+i*c+o;break;case"circle":b[4]=Mr(b[3],e);break;case"rect":b[4]=Mr(b[4],e);break;case"ellipse":b[8]=Mr(b[8],e);break;case"roundRect":b[5]=Mr(b[5],e);break;case"addPath":b[0].transform(e);break;case"poly":b[2]=Mr(b[2],e);break;default:ue("unknown transform action",w.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(e){let r=this.instructions.length-1,s=this.instructions[r];if(!s)return e.x=0,e.y=0,e;for(;s.action==="closePath";){if(r--,r<0)return e.x=0,e.y=0,e;s=this.instructions[r]}switch(s.action){case"moveTo":case"lineTo":e.x=s.data[0],e.y=s.data[1];break;case"quadraticCurveTo":e.x=s.data[2],e.y=s.data[3];break;case"bezierCurveTo":e.x=s.data[4],e.y=s.data[5];break;case"arc":case"arcToSvg":e.x=s.data[5],e.y=s.data[6];break;case"addPath":s.data[0].getLastPoint(e);break}return e}}function Mr(t,e){return t?t.prepend(e):e.clone()}function de(t,e,r){const s=t.getAttribute(e);return s?Number(s):r}function Pm(t,e){const r=t.querySelectorAll("defs");for(let s=0;s<r.length;s++){const n=r[s];for(let i=0;i<n.children.length;i++){const a=n.children[i];switch(a.nodeName.toLowerCase()){case"lineargradient":e.defs[a.id]=Mm(a);break;case"radialgradient":e.defs[a.id]=Im();break}}}}function Mm(t){const e=de(t,"x1",0),r=de(t,"y1",0),s=de(t,"x2",1),n=de(t,"y2",0),i=t.getAttribute("gradientUnits")||"objectBoundingBox",a=new jt(e,r,s,n,i==="objectBoundingBox"?"local":"global");for(let o=0;o<t.children.length;o++){const l=t.children[o],c=de(l,"offset",0),h=ke.shared.setValue(l.getAttribute("stop-color")).toNumber();a.addColorStop(c,h)}return a}function Im(t){return ue("[SVG Parser] Radial gradients are not yet supported"),new jt(0,0,1,0)}function To(t){const e=t.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return e?e[1]:""}const Eo={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function Bh(t,e){const r=t.getAttribute("style"),s={},n={},i={strokeStyle:s,fillStyle:n,useFill:!1,useStroke:!1};for(const a in Eo){const o=t.getAttribute(a);o&&Ro(e,i,a,o.trim())}if(r){const a=r.split(";");for(let o=0;o<a.length;o++){const l=a[o].trim(),[c,h]=l.split(":");Eo[c]&&Ro(e,i,c,h.trim())}}return{strokeStyle:i.useStroke?s:null,fillStyle:i.useFill?n:null,useFill:i.useFill,useStroke:i.useStroke}}function Ro(t,e,r,s){switch(r){case"stroke":if(s!=="none"){if(s.startsWith("url(")){const n=To(s);e.strokeStyle.fill=t.defs[n]}else e.strokeStyle.color=ke.shared.setValue(s).toNumber();e.useStroke=!0}break;case"stroke-width":e.strokeStyle.width=Number(s);break;case"fill":if(s!=="none"){if(s.startsWith("url(")){const n=To(s);e.fillStyle.fill=t.defs[n]}else e.fillStyle.color=ke.shared.setValue(s).toNumber();e.useFill=!0}break;case"fill-opacity":e.fillStyle.alpha=Number(s);break;case"stroke-opacity":e.strokeStyle.alpha=Number(s);break;case"opacity":e.fillStyle.alpha=Number(s),e.strokeStyle.alpha=Number(s);break}}function Tm(t,e){if(typeof t=="string"){const a=document.createElement("div");a.innerHTML=t.trim(),t=a.querySelector("svg")}const r={context:e,defs:{},path:new gr};Pm(t,r);const s=t.children,{fillStyle:n,strokeStyle:i}=Bh(t,r);for(let a=0;a<s.length;a++){const o=s[a];o.nodeName.toLowerCase()!=="defs"&&zh(o,r,n,i)}return e}function zh(t,e,r,s){const n=t.children,{fillStyle:i,strokeStyle:a}=Bh(t,e);i&&r?r={...r,...i}:i&&(r=i),a&&s?s={...s,...a}:a&&(s=a);const o=!r&&!s;o&&(r={color:0});let l,c,h,u,f,d,g,x,m,w,b,A,P,E,I,T,N;switch(t.nodeName.toLowerCase()){case"path":E=t.getAttribute("d"),t.getAttribute("fill-rule")==="evenodd"&&ue("SVG Evenodd fill rule not supported, your svg may render incorrectly"),I=new gr(E,!0),e.context.path(I),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"circle":g=de(t,"cx",0),x=de(t,"cy",0),m=de(t,"r",0),e.context.ellipse(g,x,m,m),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"rect":l=de(t,"x",0),c=de(t,"y",0),T=de(t,"width",0),N=de(t,"height",0),w=de(t,"rx",0),b=de(t,"ry",0),w||b?e.context.roundRect(l,c,T,N,w||b):e.context.rect(l,c,T,N),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"ellipse":g=de(t,"cx",0),x=de(t,"cy",0),w=de(t,"rx",0),b=de(t,"ry",0),e.context.beginPath(),e.context.ellipse(g,x,w,b),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"line":h=de(t,"x1",0),u=de(t,"y1",0),f=de(t,"x2",0),d=de(t,"y2",0),e.context.beginPath(),e.context.moveTo(h,u),e.context.lineTo(f,d),s&&e.context.stroke(s);break;case"polygon":P=t.getAttribute("points"),A=P.match(/\d+/g).map(z=>parseInt(z,10)),e.context.poly(A,!0),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"polyline":P=t.getAttribute("points"),A=P.match(/\d+/g).map(z=>parseInt(z,10)),e.context.poly(A,!1),s&&e.context.stroke(s);break;case"g":case"svg":break;default:{ue(`[SVG parser] <${t.nodeName}> elements unsupported`);break}}o&&(r=null);for(let z=0;z<n.length;z++)zh(n[z],e,r,s)}function Em(t){return ke.isColorLike(t)}function jo(t){return t instanceof Hs}function Bo(t){return t instanceof jt}function Rm(t){return t instanceof J}function jm(t,e,r){const s=ke.shared.setValue(e??0);return t.color=s.toNumber(),t.alpha=s.alpha===1?r.alpha:s.alpha,t.texture=J.WHITE,{...r,...t}}function Bm(t,e,r){return t.texture=e,{...r,...t}}function zo(t,e,r){return t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,{...r,...t}}function Fo(t,e,r){return e.buildGradient(),t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,t.textureSpace=e.textureSpace,{...r,...t}}function zm(t,e){const r={...e,...t},s=ke.shared.setValue(r.color);return r.alpha*=s.alpha,r.color=s.toNumber(),r}function Ut(t,e){if(t==null)return null;const r={},s=t;return Em(t)?jm(r,t,e):Rm(t)?Bm(r,t,e):jo(t)?zo(r,t,e):Bo(t)?Fo(r,t,e):s.fill&&jo(s.fill)?zo(s,s.fill,e):s.fill&&Bo(s.fill)?Fo(s,s.fill,e):zm(s,e)}function js(t,e){const{width:r,alignment:s,miterLimit:n,cap:i,join:a,pixelLine:o,...l}=e,c=Ut(t,l);return c?{width:r,alignment:s,miterLimit:n,cap:i,join:a,pixelLine:o,...c}:null}const Fm=new Me,Oo=new ee,na=class ft extends xt{constructor(){super(...arguments),this.uid=xe("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new gr,this._transform=new ee,this._fillStyle={...ft.defaultFillStyle},this._strokeStyle={...ft.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new ot,this._boundsDirty=!0}clone(){const e=new ft;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle={...this._fillStyle},e._strokeStyle={...this._strokeStyle},e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=Ut(e,ft.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=js(e,ft.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=Ut(e,ft.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=Ut(e,ft.defaultStrokeStyle),this}texture(e,r,s,n,i,a){return this.instructions.push({action:"texture",data:{image:e,dx:s||0,dy:n||0,dw:i||e.frame.width,dh:a||e.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:r?ke.shared.setValue(r).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new gr,this}fill(e,r){let s;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n&&n.action==="stroke"?s=n.data.path:s=this._activePath.clone(),s?(e!=null&&(r!==void 0&&typeof e=="number"&&(me(Pe,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:r}),this._fillStyle=Ut(e,ft.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:s}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:e,y:r}=this._activePath.getLastPoint(Me.shared);this._activePath.clear(),this._activePath.moveTo(e,r)}stroke(e){let r;const s=this.instructions[this.instructions.length-1];return this._tick===0&&s&&s.action==="fill"?r=s.data.path:r=this._activePath.clone(),r?(e!=null&&(this._strokeStyle=js(e,ft.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let e=0;e<2;e++){const r=this.instructions[this.instructions.length-1-e],s=this._activePath.clone();if(r&&(r.action==="stroke"||r.action==="fill"))if(r.data.hole)r.data.hole.addPath(s);else{r.data.hole=s;break}}return this._initNextPathLocation(),this}arc(e,r,s,n,i,a){this._tick++;const o=this._transform;return this._activePath.arc(o.a*e+o.c*r+o.tx,o.b*e+o.d*r+o.ty,s,n,i,a),this}arcTo(e,r,s,n,i){this._tick++;const a=this._transform;return this._activePath.arcTo(a.a*e+a.c*r+a.tx,a.b*e+a.d*r+a.ty,a.a*s+a.c*n+a.tx,a.b*s+a.d*n+a.ty,i),this}arcToSvg(e,r,s,n,i,a,o){this._tick++;const l=this._transform;return this._activePath.arcToSvg(e,r,s,n,i,l.a*a+l.c*o+l.tx,l.b*a+l.d*o+l.ty),this}bezierCurveTo(e,r,s,n,i,a,o){this._tick++;const l=this._transform;return this._activePath.bezierCurveTo(l.a*e+l.c*r+l.tx,l.b*e+l.d*r+l.ty,l.a*s+l.c*n+l.tx,l.b*s+l.d*n+l.ty,l.a*i+l.c*a+l.tx,l.b*i+l.d*a+l.ty,o),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(e,r,s,n){return this._tick++,this._activePath.ellipse(e,r,s,n,this._transform.clone()),this}circle(e,r,s){return this._tick++,this._activePath.circle(e,r,s,this._transform.clone()),this}path(e){return this._tick++,this._activePath.addPath(e,this._transform.clone()),this}lineTo(e,r){this._tick++;const s=this._transform;return this._activePath.lineTo(s.a*e+s.c*r+s.tx,s.b*e+s.d*r+s.ty),this}moveTo(e,r){this._tick++;const s=this._transform,n=this._activePath.instructions,i=s.a*e+s.c*r+s.tx,a=s.b*e+s.d*r+s.ty;return n.length===1&&n[0].action==="moveTo"?(n[0].data[0]=i,n[0].data[1]=a,this):(this._activePath.moveTo(i,a),this)}quadraticCurveTo(e,r,s,n,i){this._tick++;const a=this._transform;return this._activePath.quadraticCurveTo(a.a*e+a.c*r+a.tx,a.b*e+a.d*r+a.ty,a.a*s+a.c*n+a.tx,a.b*s+a.d*n+a.ty,i),this}rect(e,r,s,n){return this._tick++,this._activePath.rect(e,r,s,n,this._transform.clone()),this}roundRect(e,r,s,n,i){return this._tick++,this._activePath.roundRect(e,r,s,n,i,this._transform.clone()),this}poly(e,r){return this._tick++,this._activePath.poly(e,r,this._transform.clone()),this}regularPoly(e,r,s,n,i=0,a){return this._tick++,this._activePath.regularPoly(e,r,s,n,i,a),this}roundPoly(e,r,s,n,i,a){return this._tick++,this._activePath.roundPoly(e,r,s,n,i,a),this}roundShape(e,r,s,n){return this._tick++,this._activePath.roundShape(e,r,s,n),this}filletRect(e,r,s,n,i){return this._tick++,this._activePath.filletRect(e,r,s,n,i),this}chamferRect(e,r,s,n,i,a){return this._tick++,this._activePath.chamferRect(e,r,s,n,i,a),this}star(e,r,s,n,i=0,a=0){return this._tick++,this._activePath.star(e,r,s,n,i,a,this._transform.clone()),this}svg(e){return this._tick++,Tm(e,this),this}restore(){const e=this._stateStack.pop();return e&&(this._transform=e.transform,this._fillStyle=e.fillStyle,this._strokeStyle=e.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(e){return this._transform.rotate(e),this}scale(e,r=e){return this._transform.scale(e,r),this}setTransform(e,r,s,n,i,a){return e instanceof ee?(this._transform.set(e.a,e.b,e.c,e.d,e.tx,e.ty),this):(this._transform.set(e,r,s,n,i,a),this)}transform(e,r,s,n,i,a){return e instanceof ee?(this._transform.append(e),this):(Oo.set(e,r,s,n,i,a),this._transform.append(Oo),this)}translate(e,r=e){return this._transform.translate(e,r),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const e=this._bounds;e.clear();for(let r=0;r<this.instructions.length;r++){const s=this.instructions[r],n=s.action;if(n==="fill"){const i=s.data;e.addBounds(i.path.bounds)}else if(n==="texture"){const i=s.data;e.addFrame(i.dx,i.dy,i.dx+i.dw,i.dy+i.dh,i.transform)}if(n==="stroke"){const i=s.data,a=i.style.alignment,o=i.style.width*(1-a),l=i.path.bounds;e.addFrame(l.minX-o,l.minY-o,l.maxX+o,l.maxY+o)}}return e}containsPoint(e){if(!this.bounds.containsPoint(e.x,e.y))return!1;const r=this.instructions;let s=!1;for(let n=0;n<r.length;n++){const i=r[n],a=i.data,o=a.path;if(!i.action||!o)continue;const l=a.style,c=o.shapePath.shapePrimitives;for(let h=0;h<c.length;h++){const u=c[h].shape;if(!l||!u)continue;const f=c[h].transform,d=f?f.applyInverse(e,Fm):e;if(i.action==="fill")s=u.contains(d.x,d.y);else{const x=l;s=u.strokeContains(d.x,d.y,x.width,x.alignment)}const g=a.hole;if(g){const x=g.shapePath?.shapePrimitives;if(x)for(let m=0;m<x.length;m++)x[m].shape.contains(d.x,d.y)&&(s=!1)}if(s)return!0}}return s}destroy(e=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof e=="boolean"?e:e?.texture){const s=typeof e=="boolean"?e:e?.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(s),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(s)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};na.defaultFillStyle={color:16777215,alpha:1,texture:J.WHITE,matrix:null,fill:null,textureSpace:"local"};na.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:J.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let $t=na;const No=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function Om(t){const e=[];let r=0;for(let s=0;s<No.length;s++){const n=`_${No[s]}`;e[r++]=t[n]}return r=Fh(t._fill,e,r),r=Nm(t._stroke,e,r),r=Lm(t.dropShadow,e,r),e.join("-")}function Fh(t,e,r){return t&&(e[r++]=t.color,e[r++]=t.alpha,e[r++]=t.fill?.styleKey),r}function Nm(t,e,r){return t&&(r=Fh(t,e,r),e[r++]=t.width,e[r++]=t.alignment,e[r++]=t.cap,e[r++]=t.join,e[r++]=t.miterLimit),r}function Lm(t,e,r){return t&&(e[r++]=t.alpha,e[r++]=t.angle,e[r++]=t.blur,e[r++]=t.distance,e[r++]=ke.shared.setValue(t.color).toNumber()),r}const ia=class cr extends xt{constructor(e={}){super(),Gm(e);const r={...cr.defaultTextStyle,...e};for(const s in r){const n=s;this[n]=r[s]}this.update()}get align(){return this._align}set align(e){this._align=e,this.update()}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords=e,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(e){e!==null&&typeof e=="object"?this._dropShadow=this._createProxy({...cr.defaultDropShadow,...e}):this._dropShadow=e?this._createProxy({...cr.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily=e,this.update()}get fontSize(){return this._fontSize}set fontSize(e){typeof e=="string"?this._fontSize=parseInt(e,10):this._fontSize=e,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle=e.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant=e,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight=e,this.update()}get leading(){return this._leading}set leading(e){this._leading=e,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing=e,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight=e,this.update()}get padding(){return this._padding}set padding(e){this._padding=e,this.update()}get trim(){return this._trim}set trim(e){this._trim=e,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline=e,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace=e,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap=e,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth=e,this.update()}get fill(){return this._originalFill}set fill(e){e!==this._originalFill&&(this._originalFill=e,this._isFillStyle(e)&&(this._originalFill=this._createProxy({...$t.defaultFillStyle,...e},()=>{this._fill=Ut({...this._originalFill},$t.defaultFillStyle)})),this._fill=Ut(e===0?"black":e,$t.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(e){e!==this._originalStroke&&(this._originalStroke=e,this._isFillStyle(e)&&(this._originalStroke=this._createProxy({...$t.defaultStrokeStyle,...e},()=>{this._stroke=js({...this._originalStroke},$t.defaultStrokeStyle)})),this._stroke=js(e,$t.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=Om(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const e=cr.defaultTextStyle;for(const r in e)this[r]=e[r]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new cr({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(e=!1){if(this.removeAllListeners(),typeof e=="boolean"?e:e?.texture){const s=typeof e=="boolean"?e:e?.textureSource;this._fill?.texture&&this._fill.texture.destroy(s),this._originalFill?.texture&&this._originalFill.texture.destroy(s),this._stroke?.texture&&this._stroke.texture.destroy(s),this._originalStroke?.texture&&this._originalStroke.texture.destroy(s)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(e,r){return new Proxy(e,{set:(s,n,i)=>(s[n]=i,r?.(n,i),this.update(),!0)})}_isFillStyle(e){return(e??null)!==null&&!(ke.isColorLike(e)||e instanceof jt||e instanceof Hs)}};ia.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};ia.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Yr=ia;function Gm(t){const e=t;if(typeof e.dropShadow=="boolean"&&e.dropShadow){const r=Yr.defaultDropShadow;t.dropShadow={alpha:e.dropShadowAlpha??r.alpha,angle:e.dropShadowAngle??r.angle,blur:e.dropShadowBlur??r.blur,color:e.dropShadowColor??r.color,distance:e.dropShadowDistance??r.distance}}if(e.strokeThickness!==void 0){me(Pe,"strokeThickness is now a part of stroke");const r=e.stroke;let s={};if(ke.isColorLike(r))s.color=r;else if(r instanceof jt||r instanceof Hs)s.fill=r;else if(Object.hasOwnProperty.call(r,"color")||Object.hasOwnProperty.call(r,"fill"))s=r;else throw new Error("Invalid stroke value.");t.stroke={...s,width:e.strokeThickness}}if(Array.isArray(e.fillGradientStops)){me(Pe,"gradient fill is now a fill pattern: `new FillGradient(...)`");let r;t.fontSize==null?t.fontSize=Yr.defaultTextStyle.fontSize:typeof t.fontSize=="string"?r=parseInt(t.fontSize,10):r=t.fontSize;const s=new jt({start:{x:0,y:0},end:{x:0,y:(r||0)*1.7}}),n=e.fillGradientStops.map(i=>ke.shared.setValue(i).toNumber());n.forEach((i,a)=>{const o=a/(n.length-1);s.addColorStop(o,i)}),t.fill={fill:s}}}class Dm{constructor(e){this._canvasPool=Object.create(null),this.canvasOptions=e||{},this.enableFullScreen=!1}_createCanvasAndContext(e,r){const s=be.get().createCanvas();s.width=e,s.height=r;const n=s.getContext("2d");return{canvas:s,context:n}}getOptimalCanvasAndContext(e,r,s=1){e=Math.ceil(e*s-1e-6),r=Math.ceil(r*s-1e-6),e=Ts(e),r=Ts(r);const n=(e<<17)+(r<<1);this._canvasPool[n]||(this._canvasPool[n]=[]);let i=this._canvasPool[n].pop();return i||(i=this._createCanvasAndContext(e,r)),i}returnCanvasAndContext(e){const r=e.canvas,{width:s,height:n}=r,i=(s<<17)+(n<<1);e.context.clearRect(0,0,s,n),this._canvasPool[i].push(e)}clear(){this._canvasPool={}}}const Lo=new Dm,$m=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Ti(t){const e=typeof t.fontSize=="number"?`${t.fontSize}px`:t.fontSize;let r=t.fontFamily;Array.isArray(t.fontFamily)||(r=t.fontFamily.split(","));for(let s=r.length-1;s>=0;s--){let n=r[s].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!$m.includes(n)&&(n=`"${n}"`),r[s]=n}return`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${e} ${r.join(",")}`}const In={willReadFrequently:!0},lt=class H{static get experimentalLetterSpacingSupported(){let e=H._experimentalLetterSpacingSupported;if(e!==void 0){const r=be.get().getCanvasRenderingContext2D().prototype;e=H._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return e}constructor(e,r,s,n,i,a,o,l,c){this.text=e,this.style=r,this.width=s,this.height=n,this.lines=i,this.lineWidths=a,this.lineHeight=o,this.maxLineWidth=l,this.fontProperties=c}static measureText(e=" ",r,s=H._canvas,n=r.wordWrap){const i=`${e}:${r.styleKey}`;if(H._measurementCache[i])return H._measurementCache[i];const a=Ti(r),o=H.measureFont(a);o.fontSize===0&&(o.fontSize=r.fontSize,o.ascent=r.fontSize);const l=H.__context;l.font=a;const h=(n?H._wordWrap(e,r,s):e).split(/(?:\r\n|\r|\n)/),u=new Array(h.length);let f=0;for(let b=0;b<h.length;b++){const A=H._measureText(h[b],r.letterSpacing,l);u[b]=A,f=Math.max(f,A)}const d=r._stroke?.width||0;let g=f+d;r.dropShadow&&(g+=r.dropShadow.distance);const x=r.lineHeight||o.fontSize;let m=Math.max(x,o.fontSize+d)+(h.length-1)*(x+r.leading);return r.dropShadow&&(m+=r.dropShadow.distance),new H(e,r,g,m,h,u,x+r.leading,f,o)}static _measureText(e,r,s){let n=!1;H.experimentalLetterSpacingSupported&&(H.experimentalLetterSpacing?(s.letterSpacing=`${r}px`,s.textLetterSpacing=`${r}px`,n=!0):(s.letterSpacing="0px",s.textLetterSpacing="0px"));const i=s.measureText(e);let a=i.width;const o=-i.actualBoundingBoxLeft;let c=i.actualBoundingBoxRight-o;if(a>0)if(n)a-=r,c-=r;else{const h=(H.graphemeSegmenter(e).length-1)*r;a+=h,c+=h}return Math.max(a,c)}static _wordWrap(e,r,s=H._canvas){const n=s.getContext("2d",In);let i=0,a="",o="";const l=Object.create(null),{letterSpacing:c,whiteSpace:h}=r,u=H._collapseSpaces(h),f=H._collapseNewlines(h);let d=!u;const g=r.wordWrapWidth+c,x=H._tokenize(e);for(let m=0;m<x.length;m++){let w=x[m];if(H._isNewline(w)){if(!f){o+=H._addLine(a),d=!u,a="",i=0;continue}w=" "}if(u){const A=H.isBreakingSpace(w),P=H.isBreakingSpace(a[a.length-1]);if(A&&P)continue}const b=H._getFromCache(w,c,l,n);if(b>g)if(a!==""&&(o+=H._addLine(a),a="",i=0),H.canBreakWords(w,r.breakWords)){const A=H.wordWrapSplit(w);for(let P=0;P<A.length;P++){let E=A[P],I=E,T=1;for(;A[P+T];){const z=A[P+T];if(!H.canBreakChars(I,z,w,P,r.breakWords))E+=z;else break;I=z,T++}P+=T-1;const N=H._getFromCache(E,c,l,n);N+i>g&&(o+=H._addLine(a),d=!1,a="",i=0),a+=E,i+=N}}else{a.length>0&&(o+=H._addLine(a),a="",i=0);const A=m===x.length-1;o+=H._addLine(w,!A),d=!1,a="",i=0}else b+i>g&&(d=!1,o+=H._addLine(a),a="",i=0),(a.length>0||!H.isBreakingSpace(w)||d)&&(a+=w,i+=b)}return o+=H._addLine(a,!1),o}static _addLine(e,r=!0){return e=H._trimRight(e),e=r?`${e}
`:e,e}static _getFromCache(e,r,s,n){let i=s[e];return typeof i!="number"&&(i=H._measureText(e,r,n)+r,s[e]=i),i}static _collapseSpaces(e){return e==="normal"||e==="pre-line"}static _collapseNewlines(e){return e==="normal"}static _trimRight(e){if(typeof e!="string")return"";for(let r=e.length-1;r>=0;r--){const s=e[r];if(!H.isBreakingSpace(s))break;e=e.slice(0,-1)}return e}static _isNewline(e){return typeof e!="string"?!1:H._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,r){return typeof e!="string"?!1:H._breakingSpaces.includes(e.charCodeAt(0))}static _tokenize(e){const r=[];let s="";if(typeof e!="string")return r;for(let n=0;n<e.length;n++){const i=e[n],a=e[n+1];if(H.isBreakingSpace(i,a)||H._isNewline(i)){s!==""&&(r.push(s),s=""),r.push(i);continue}s+=i}return s!==""&&r.push(s),r}static canBreakWords(e,r){return r}static canBreakChars(e,r,s,n,i){return!0}static wordWrapSplit(e){return H.graphemeSegmenter(e)}static measureFont(e){if(H._fonts[e])return H._fonts[e];const r=H._context;r.font=e;const s=r.measureText(H.METRICS_STRING+H.BASELINE_SYMBOL),n={ascent:s.actualBoundingBoxAscent,descent:s.actualBoundingBoxDescent,fontSize:s.actualBoundingBoxAscent+s.actualBoundingBoxDescent};return H._fonts[e]=n,n}static clearMetrics(e=""){e?delete H._fonts[e]:H._fonts={}}static get _canvas(){if(!H.__canvas){let e;try{const r=new OffscreenCanvas(0,0);if(r.getContext("2d",In)?.measureText)return H.__canvas=r,r;e=be.get().createCanvas()}catch{e=be.get().createCanvas()}e.width=e.height=10,H.__canvas=e}return H.__canvas}static get _context(){return H.__context||(H.__context=H._canvas.getContext("2d",In)),H.__context}};lt.METRICS_STRING="|q";lt.BASELINE_SYMBOL="M";lt.BASELINE_MULTIPLIER=1.4;lt.HEIGHT_MULTIPLIER=2;lt.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map(r=>r.segment)}return t=>[...t]})();lt.experimentalLetterSpacing=!1;lt._fonts={};lt._newlines=[10,13];lt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];lt._measurementCache={};let Go=lt;const Do=1e5;function $o(t,e,r,s=0){if(t.texture===J.WHITE&&!t.fill)return ke.shared.setValue(t.color).setAlpha(t.alpha??1).toHexa();if(t.fill){if(t.fill instanceof Hs){const n=t.fill,i=e.createPattern(n.texture.source.resource,"repeat"),a=n.transform.copyTo(ee.shared);return a.scale(n.texture.frame.width,n.texture.frame.height),i.setTransform(a),i}else if(t.fill instanceof jt){const n=t.fill,i=n.type==="linear",a=n.textureSpace==="local";let o=1,l=1;a&&r&&(o=r.width+s,l=r.height+s);let c,h=!1;if(i){const{start:u,end:f}=n;c=e.createLinearGradient(u.x*o,u.y*l,f.x*o,f.y*l),h=Math.abs(f.x-u.x)<Math.abs((f.y-u.y)*.1)}else{const{center:u,innerRadius:f,outerCenter:d,outerRadius:g}=n;c=e.createRadialGradient(u.x*o,u.y*l,f*o,d.x*o,d.y*l,g*o)}if(h&&a&&r){const u=r.lineHeight/l;for(let f=0;f<r.lines.length;f++){const d=(f*r.lineHeight+s/2)/l;n.colorStops.forEach(g=>{const x=d+g.offset*u;c.addColorStop(Math.floor(x*Do)/Do,ke.shared.setValue(g.color).toHex())})}}else n.colorStops.forEach(u=>{c.addColorStop(u.offset,ke.shared.setValue(u.color).toHex())});return c}}else{const n=e.createPattern(t.texture.source.resource,"repeat"),i=t.matrix.copyTo(ee.shared);return i.scale(t.texture.frame.width,t.texture.frame.height),n.setTransform(i),n}return ue("FillStyle not recognised",t),"red"}function Oh(t){if(t==="")return[];typeof t=="string"&&(t=[t]);const e=[];for(let r=0,s=t.length;r<s;r++){const n=t[r];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);if(n[0].length===0||n[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const i=n[0].charCodeAt(0),a=n[1].charCodeAt(0);if(a<i)throw new Error("[BitmapFont]: Invalid character range.");for(let o=i,l=a;o<=l;o++)e.push(String.fromCharCode(o))}else e.push(...Array.from(n))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const Nh=class Lh extends xh{constructor(e){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentPageIndex=-1,this._skipKerning=!1;const r={...Lh.defaultOptions,...e};this._textureSize=r.textureSize,this._mipmap=r.mipmap;const s=r.style.clone();r.overrideFill&&(s._fill.color=16777215,s._fill.alpha=1,s._fill.texture=J.WHITE,s._fill.fill=null),this.applyFillAsTint=r.overrideFill;const n=s.fontSize;s.fontSize=this.baseMeasurementFontSize;const i=Ti(s);r.overrideSize?s._stroke&&(s._stroke.width*=this.baseRenderedFontSize/n):s.fontSize=this.baseRenderedFontSize=n,this._style=s,this._skipKerning=r.skipKerning??!1,this.resolution=r.resolution??1,this._padding=r.padding??4,this.fontMetrics=Go.measureFont(i),this.lineHeight=s.lineHeight||this.fontMetrics.fontSize||s.fontSize}ensureCharacters(e){const r=Oh(e).filter(m=>!this._currentChars.includes(m)).filter((m,w,b)=>b.indexOf(m)===w);if(!r.length)return;this._currentChars=[...this._currentChars,...r];let s;this._currentPageIndex===-1?s=this._nextPage():s=this.pages[this._currentPageIndex];let{canvas:n,context:i}=s.canvasAndContext,a=s.texture.source;const o=this._style;let l=this._currentX,c=this._currentY;const h=this.baseRenderedFontSize/this.baseMeasurementFontSize,u=this._padding*h;let f=0,d=!1;const g=n.width/this.resolution,x=n.height/this.resolution;for(let m=0;m<r.length;m++){const w=r[m],b=Go.measureText(w,o,n,!1);b.lineHeight=b.height;const A=b.width*h,P=Math.ceil((o.fontStyle==="italic"?2:1)*A),E=b.height*h,I=P+u*2,T=E+u*2;if(d=!1,w!==`
`&&w!=="\r"&&w!=="	"&&w!==" "&&(d=!0,f=Math.ceil(Math.max(T,f))),l+I>g&&(c+=f,f=T,l=0,c+f>x)){a.update();const z=this._nextPage();n=z.canvasAndContext.canvas,i=z.canvasAndContext.context,a=z.texture.source,c=0}const N=A/h-(o.dropShadow?.distance??0)-(o._stroke?.width??0);if(this.chars[w]={id:w.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:N,kerning:{}},d){this._drawGlyph(i,b,l+u,c+u,h,o);const z=a.width*h,j=a.height*h,$=new ge(l/z*a.width,c/j*a.height,I/z*a.width,T/j*a.height);this.chars[w].texture=new J({source:a,frame:$}),l+=Math.ceil(I)}}a.update(),this._currentX=l,this._currentY=c,this._skipKerning&&this._applyKerning(r,i)}get pageTextures(){return me(Pe,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(e,r){const s=this._measureCache;for(let n=0;n<e.length;n++){const i=e[n];for(let a=0;a<this._currentChars.length;a++){const o=this._currentChars[a];let l=s[i];l||(l=s[i]=r.measureText(i).width);let c=s[o];c||(c=s[o]=r.measureText(o).width);let h=r.measureText(i+o).width,u=h-(l+c);u&&(this.chars[i].kerning[o]=u),h=r.measureText(i+o).width,u=h-(l+c),u&&(this.chars[o].kerning[i]=u)}}}_nextPage(){this._currentPageIndex++;const e=this.resolution,r=Lo.getOptimalCanvasAndContext(this._textureSize,this._textureSize,e);this._setupContext(r.context,this._style,e);const s=e*(this.baseRenderedFontSize/this.baseMeasurementFontSize),n=new J({source:new Xt({resource:r.canvas,resolution:s,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})}),i={canvasAndContext:r,texture:n};return this.pages[this._currentPageIndex]=i,i}_setupContext(e,r,s){r.fontSize=this.baseRenderedFontSize,e.scale(s,s),e.font=Ti(r),r.fontSize=this.baseMeasurementFontSize,e.textBaseline=r.textBaseline;const n=r._stroke,i=n?.width??0;if(n&&(e.lineWidth=i,e.lineJoin=n.join,e.miterLimit=n.miterLimit,e.strokeStyle=$o(n,e)),r._fill&&(e.fillStyle=$o(r._fill,e)),r.dropShadow){const a=r.dropShadow,o=ke.shared.setValue(a.color).toArray(),l=a.blur*s,c=a.distance*s;e.shadowColor=`rgba(${o[0]*255},${o[1]*255},${o[2]*255},${a.alpha})`,e.shadowBlur=l,e.shadowOffsetX=Math.cos(a.angle)*c,e.shadowOffsetY=Math.sin(a.angle)*c}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0}_drawGlyph(e,r,s,n,i,a){const o=r.text,l=r.fontProperties,h=(a._stroke?.width??0)*i,u=s+h/2,f=n-h/2,d=l.descent*i,g=r.lineHeight*i;a.stroke&&h&&e.strokeText(o,u,f+g-d),a._fill&&e.fillText(o,u,f+g-d)}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){const{canvasAndContext:r,texture:s}=this.pages[e];Lo.returnCanvasAndContext(r),s.destroy(!0)}this.pages=null}};Nh.defaultOptions={textureSize:512,style:new Yr,mipmap:!0};let Ho=Nh;function Hm(t,e,r,s){const n={width:0,height:0,offsetY:0,scale:e.fontSize/r.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};n.offsetY=r.baseLineOffset;let i=n.lines[0],a=null,o=!0;const l={width:0,start:0,index:0,positions:[],chars:[]},c=g=>{const x=i.width;for(let m=0;m<l.index;m++){const w=g.positions[m];i.chars.push(g.chars[m]),i.charPositions.push(w+x)}i.width+=g.width,o=!1,l.width=0,l.index=0,l.chars.length=0},h=()=>{let g=i.chars.length-1;if(s){let x=i.chars[g];for(;x===" ";)i.width-=r.chars[x].xAdvance,x=i.chars[--g]}n.width=Math.max(n.width,i.width),i={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,n.lines.push(i),n.height+=r.lineHeight},u=r.baseMeasurementFontSize/e.fontSize,f=e.letterSpacing*u,d=e.wordWrapWidth*u;for(let g=0;g<t.length+1;g++){let x;const m=g===t.length;m||(x=t[g]);const w=r.chars[x]||r.chars[" "];if(/(?:\s)/.test(x)||x==="\r"||x===`
`||m){if(!o&&e.wordWrap&&i.width+l.width-f>d?(h(),c(l),m||i.charPositions.push(0)):(l.start=i.width,c(l),m||i.charPositions.push(0)),x==="\r"||x===`
`)i.width!==0&&h();else if(!m){const E=w.xAdvance+(w.kerning[a]||0)+f;i.width+=E,i.spaceWidth=E,i.spacesIndex.push(i.charPositions.length),i.chars.push(x)}}else{const P=w.kerning[a]||0,E=w.xAdvance+P+f;l.positions[l.index++]=l.width+P,l.chars.push(x),l.width+=E}a=x}return h(),e.align==="center"?Wm(n):e.align==="right"?Um(n):e.align==="justify"&&Vm(n),n}function Wm(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],s=t.width/2-r.width/2;for(let n=0;n<r.charPositions.length;n++)r.charPositions[n]+=s}}function Um(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],s=t.width-r.width;for(let n=0;n<r.charPositions.length;n++)r.charPositions[n]+=s}}function Vm(t){const e=t.width;for(let r=0;r<t.lines.length;r++){const s=t.lines[r];let n=0,i=s.spacesIndex[n++],a=0;const o=s.spacesIndex.length,c=(e-s.width)/o;for(let h=0;h<s.charPositions.length;h++)h===i&&(i=s.spacesIndex[n++],a+=c),s.charPositions[h]+=a}}let ds=0;class qm{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1}}getFont(e,r){let s=`${r.fontFamily}-bitmap`,n=!0;if(r._fill.fill&&!r._stroke)s+=r._fill.fill.styleKey,n=!1;else if(r._stroke||r.dropShadow){let a=r.styleKey;a=a.substring(0,a.lastIndexOf("-")),s=`${a}-bitmap`,n=!1}if(!pe.has(s)){const a=new Ho({style:r,overrideFill:n,overrideSize:!0,...this.defaultOptions});ds++,ds>50&&ue("BitmapText",`You have dynamically created ${ds} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),a.once("destroy",()=>{ds--,pe.remove(s)}),pe.set(s,a)}const i=pe.get(s);return i.ensureCharacters?.(e),i}getLayout(e,r,s=!0){const n=this.getFont(e,r);return Hm([...e],r,n,s)}measureText(e,r,s=!0){return this.getLayout(e,r,s)}install(...e){let r=e[0];typeof r=="string"&&(r={name:r,style:e[1],chars:e[2]?.chars,resolution:e[2]?.resolution,padding:e[2]?.padding,skipKerning:e[2]?.skipKerning},me(Pe,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const s=r?.name;if(!s)throw new Error("[BitmapFontManager] Property `name` is required.");r={...this.defaultOptions,...r};const n=r.style,i=n instanceof Yr?n:new Yr(n),a=i._fill.fill!==null&&i._fill.fill!==void 0,o=new Ho({style:i,overrideFill:a,skipKerning:r.skipKerning,padding:r.padding,resolution:r.resolution,overrideSize:!1}),l=Oh(r.chars);return o.ensureCharacters(l.join("")),pe.set(`${s}-bitmap`,o),o.once("destroy",()=>pe.remove(`${s}-bitmap`)),o}uninstall(e){const r=`${e}-bitmap`,s=pe.get(r);s&&s.destroy()}}const Wo=new qm;class Gh extends xh{constructor(e,r){super();const{textures:s,data:n}=e;Object.keys(n.pages).forEach(i=>{const a=n.pages[parseInt(i,10)],o=s[a.id];this.pages.push({texture:o})}),Object.keys(n.chars).forEach(i=>{const a=n.chars[i],{frame:o,source:l}=s[a.page],c=new ge(a.x+o.x,a.y+o.y,a.width,a.height),h=new J({source:l,frame:c});this.chars[i]={id:i.codePointAt(0),xOffset:a.xOffset,yOffset:a.yOffset,xAdvance:a.xAdvance,kerning:a.kerning??{},texture:h}}),this.baseRenderedFontSize=n.fontSize,this.baseMeasurementFontSize=n.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:n.fontSize},this.baseLineOffset=n.baseLineOffset,this.lineHeight=n.lineHeight,this.fontFamily=n.fontFamily,this.distanceField=n.distanceField??{type:"none",range:0},this.url=r}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){const{texture:r}=this.pages[e];r.destroy(!0)}this.pages=null}static install(e){Wo.install(e)}static uninstall(e){Wo.uninstall(e)}}const Tn={test(t){return typeof t=="string"&&t.startsWith("info face=")},parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const u in e){const f=e[u].match(/^[a-z]+/gm)[0],d=e[u].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),g={};for(const x in d){const m=d[x].split("="),w=m[0],b=m[1].replace(/"/gm,""),A=parseFloat(b),P=isNaN(A)?b:A;g[w]=P}r[f].push(g)}const s={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[n]=r.info,[i]=r.common,[a]=r.distanceField??[];a&&(s.distanceField={range:parseInt(a.distanceRange,10),type:a.fieldType}),s.fontSize=parseInt(n.size,10),s.fontFamily=n.face,s.lineHeight=parseInt(i.lineHeight,10);const o=r.page;for(let u=0;u<o.length;u++)s.pages.push({id:parseInt(o[u].id,10)||0,file:o[u].file});const l={};s.baseLineOffset=s.lineHeight-parseInt(i.base,10);const c=r.char;for(let u=0;u<c.length;u++){const f=c[u],d=parseInt(f.id,10);let g=f.letter??f.char??String.fromCharCode(d);g==="space"&&(g=" "),l[d]=g,s.chars[g]={id:d,page:parseInt(f.page,10)||0,x:parseInt(f.x,10),y:parseInt(f.y,10),width:parseInt(f.width,10),height:parseInt(f.height,10),xOffset:parseInt(f.xoffset,10),yOffset:parseInt(f.yoffset,10),xAdvance:parseInt(f.xadvance,10),kerning:{}}}const h=r.kerning||[];for(let u=0;u<h.length;u++){const f=parseInt(h[u].first,10),d=parseInt(h[u].second,10),g=parseInt(h[u].amount,10);s.chars[l[d]].kerning[l[f]]=g}return s}},Uo={test(t){const e=t;return typeof e!="string"&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(t){const e={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},r=t.getElementsByTagName("info")[0],s=t.getElementsByTagName("common")[0],n=t.getElementsByTagName("distanceField")[0];n&&(e.distanceField={type:n.getAttribute("fieldType"),range:parseInt(n.getAttribute("distanceRange"),10)});const i=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning");e.fontSize=parseInt(r.getAttribute("size"),10),e.fontFamily=r.getAttribute("face"),e.lineHeight=parseInt(s.getAttribute("lineHeight"),10);for(let c=0;c<i.length;c++)e.pages.push({id:parseInt(i[c].getAttribute("id"),10)||0,file:i[c].getAttribute("file")});const l={};e.baseLineOffset=e.lineHeight-parseInt(s.getAttribute("base"),10);for(let c=0;c<a.length;c++){const h=a[c],u=parseInt(h.getAttribute("id"),10);let f=h.getAttribute("letter")??h.getAttribute("char")??String.fromCharCode(u);f==="space"&&(f=" "),l[u]=f,e.chars[f]={id:u,page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xOffset:parseInt(h.getAttribute("xoffset"),10),yOffset:parseInt(h.getAttribute("yoffset"),10),xAdvance:parseInt(h.getAttribute("xadvance"),10),kerning:{}}}for(let c=0;c<o.length;c++){const h=parseInt(o[c].getAttribute("first"),10),u=parseInt(o[c].getAttribute("second"),10),f=parseInt(o[c].getAttribute("amount"),10);e.chars[l[u]].kerning[l[h]]=f}return e}},Vo={test(t){return typeof t=="string"&&t.includes("<font>")?Uo.test(be.get().parseXML(t)):!1},parse(t){return Uo.parse(be.get().parseXML(t))}},Ym=[".xml",".fnt"],Xm={extension:{type:U.CacheParser,name:"cacheBitmapFont"},test:t=>t instanceof Gh,getCacheableAssets(t,e){const r={};return t.forEach(s=>{r[s]=e,r[`${s}-bitmap`]=e}),r[`${e.fontFamily}-bitmap`]=e,r}},Km={extension:{type:U.LoadParser,priority:zt.Normal},name:"loadBitmapFont",test(t){return Ym.includes($e.extname(t).toLowerCase())},async testParse(t){return Tn.test(t)||Vo.test(t)},async parse(t,e,r){const s=Tn.test(t)?Tn.parse(t):Vo.parse(t),{src:n}=e,{pages:i}=s,a=[],o=s.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let u=0;u<i.length;++u){const f=i[u].file;let d=$e.join($e.dirname(n),f);d=_i(d,n),a.push({src:d,data:o})}const l=await r.load(a),c=a.map(u=>l[u.src]);return new Gh({data:s,textures:c},n)},async load(t,e){return await(await be.get().fetch(t)).text()},async unload(t,e,r){await Promise.all(t.pages.map(s=>r.unload(s.texture.source._sourceOrigin))),t.destroy()}};class Zm{constructor(e,r=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=r}add(e){e.forEach(r=>{this._assetList.push(r)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],r=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<r;s++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}const Qm={extension:{type:U.CacheParser,name:"cacheTextureArray"},test:t=>Array.isArray(t)&&t.every(e=>e instanceof J),getCacheableAssets:(t,e)=>{const r={};return t.forEach(s=>{e.forEach((n,i)=>{r[s+(i===0?"":i+1)]=n})}),r}};async function Dh(t){if("Image"in globalThis)return new Promise(e=>{const r=new Image;r.onload=()=>{e(!0)},r.onerror=()=>{e(!1)},r.src=t});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(t)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const Jm={extension:{type:U.DetectionParser,priority:1},test:async()=>Dh("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter(e=>e!=="avif")},qo=["png","jpg","jpeg"],eg={extension:{type:U.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...qo],remove:async t=>t.filter(e=>!qo.includes(e))},tg="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function aa(t){return tg?!1:document.createElement("video").canPlayType(t)!==""}const rg={extension:{type:U.DetectionParser,priority:0},test:async()=>aa("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter(e=>e!=="mp4"&&e!=="m4v")},sg={extension:{type:U.DetectionParser,priority:0},test:async()=>aa("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter(e=>e!=="ogv")},ng={extension:{type:U.DetectionParser,priority:0},test:async()=>aa("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter(e=>e!=="webm")},ig={extension:{type:U.DetectionParser,priority:0},test:async()=>Dh("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter(e=>e!=="webp")};class ag{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,r,s)=>(this._parsersValidated=!1,e[r]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,r){const s={promise:null,parser:null};return s.promise=(async()=>{let n=null,i=null;if(r.loadParser&&(i=this._parserHash[r.loadParser],i||ue(`[Assets] specified load parser "${r.loadParser}" not found while loading ${e}`)),!i){for(let a=0;a<this.parsers.length;a++){const o=this.parsers[a];if(o.load&&o.test?.(e,r,this)){i=o;break}}if(!i)return ue(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await i.load(e,r,this),s.parser=i;for(let a=0;a<this.parsers.length;a++){const o=this.parsers[a];o.parse&&o.parse&&await o.testParse?.(n,r,this)&&(n=await o.parse(n,r,this)||n,s.parser=o)}return n})(),s}async load(e,r){this._parsersValidated||this._validateParsers();let s=0;const n={},i=Rs(e),a=it(e,c=>({alias:[c],src:c,data:{}})),o=a.length,l=a.map(async c=>{const h=$e.toAbsolute(c.src);if(!n[c.src])try{this.promiseCache[h]||(this.promiseCache[h]=this._getLoadPromiseAndParser(h,c)),n[c.src]=await this.promiseCache[h].promise,r&&r(++s/o)}catch(u){throw delete this.promiseCache[h],delete n[c.src],new Error(`[Loader.load] Failed to load ${h}.
${u}`)}});return await Promise.all(l),i?n[a[0].src]:n}async unload(e){const s=it(e,n=>({alias:[n],src:n})).map(async n=>{const i=$e.toAbsolute(n.src),a=this.promiseCache[i];if(a){const o=await a.promise;delete this.promiseCache[i],await a.parser?.unload?.(o,n,this)}});await Promise.all(s)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,r)=>(r.name?e[r.name]&&ue(`[Assets] loadParser name conflict "${r.name}"`):ue("[Assets] loadParser should have a name"),{...e,[r.name]:r}),{})}}function vr(t,e){if(Array.isArray(e)){for(const r of e)if(t.startsWith(`data:${r}`))return!0;return!1}return t.startsWith(`data:${e}`)}function Sr(t,e){const r=t.split("?")[0],s=$e.extname(r).toLowerCase();return Array.isArray(e)?e.includes(s):s===e}const og=".json",lg="application/json",cg={extension:{type:U.LoadParser,priority:zt.Low},name:"loadJson",test(t){return vr(t,lg)||Sr(t,og)},async load(t){return await(await be.get().fetch(t)).json()}},hg=".txt",ug="text/plain",dg={name:"loadTxt",extension:{type:U.LoadParser,priority:zt.Low,name:"loadTxt"},test(t){return vr(t,ug)||Sr(t,hg)},async load(t){return await(await be.get().fetch(t)).text()}},fg=["normal","bold","100","200","300","400","500","600","700","800","900"],pg=[".ttf",".otf",".woff",".woff2"],mg=["font/ttf","font/otf","font/woff","font/woff2"],gg=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function xg(t){const e=$e.extname(t),n=$e.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1));let i=n.length>0;for(const o of n)if(!o.match(gg)){i=!1;break}let a=n.join(" ");return i||(a=`"${a.replace(/[\\"]/g,"\\$&")}"`),a}const yg=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function bg(t){return yg.test(t)?t:encodeURI(t)}const wg={extension:{type:U.LoadParser,priority:zt.Low},name:"loadWebFont",test(t){return vr(t,mg)||Sr(t,pg)},async load(t,e){const r=be.get().getFontFaceSet();if(r){const s=[],n=e.data?.family??xg(t),i=e.data?.weights?.filter(o=>fg.includes(o))??["normal"],a=e.data??{};for(let o=0;o<i.length;o++){const l=i[o],c=new FontFace(n,`url(${bg(t)})`,{...a,weight:l});await c.load(),r.add(c),s.push(c)}return pe.set(`${n}-and-url`,{url:t,fontFaces:s}),s.length===1?s[0]:s}return ue("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach(e=>{pe.remove(`${e.family}-and-url`),be.get().getFontFaceSet().delete(e)})}};function oa(t,e=1){const r=_r.RETINA_PREFIX?.exec(t);return r?parseFloat(r[1]):e}function la(t,e,r){t.label=r,t._sourceOrigin=r;const s=new J({source:t,label:r}),n=()=>{delete e.promiseCache[r],pe.has(r)&&pe.remove(r)};return s.source.once("destroy",()=>{e.promiseCache[r]&&(ue("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),n())}),s.once("destroy",()=>{t.destroyed||(ue("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),s}const _g=".svg",vg="image/svg+xml",Sg={extension:{type:U.LoadParser,priority:zt.Low,name:"loadSVG"},name:"loadSVG",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(t){return vr(t,vg)||Sr(t,_g)},async load(t,e,r){return e.data?.parseAsGraphicsContext??this.config.parseAsGraphicsContext?kg(t):Ag(t,e,r,this.config.crossOrigin)},unload(t){t.destroy(!0)}};async function Ag(t,e,r,s){const i=await(await be.get().fetch(t)).blob(),a=URL.createObjectURL(i),o=new Image;o.src=a,o.crossOrigin=s,await o.decode(),URL.revokeObjectURL(a);const l=document.createElement("canvas"),c=l.getContext("2d"),h=e.data?.resolution||oa(t),u=e.data?.width??o.width,f=e.data?.height??o.height;l.width=u*h,l.height=f*h,c.drawImage(o,0,0,u*h,f*h);const{parseAsGraphicsContext:d,...g}=e.data??{},x=new Xt({resource:l,alphaMode:"premultiply-alpha-on-upload",resolution:h,...g});return la(x,r,t)}async function kg(t){const r=await(await be.get().fetch(t)).text(),s=new $t;return s.svg(r),s}const Cg=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let fr=null,Ei=class{constructor(){fr||(fr=URL.createObjectURL(new Blob([Cg],{type:"application/javascript"}))),this.worker=new Worker(fr)}};Ei.revokeObjectURL=function(){fr&&(URL.revokeObjectURL(fr),fr=null)};const Pg=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let pr=null;class $h{constructor(){pr||(pr=URL.createObjectURL(new Blob([Pg],{type:"application/javascript"}))),this.worker=new Worker(pr)}}$h.revokeObjectURL=function(){pr&&(URL.revokeObjectURL(pr),pr=null)};let Yo=0,En;class Mg{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:r}=new Ei;r.addEventListener("message",s=>{r.terminate(),Ei.revokeObjectURL(),e(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e,r){return this._run("loadImageBitmap",[e,r?.data?.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){En===void 0&&(En=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<En&&(this._createdWorkers++,e=new $h().worker,e.addEventListener("message",r=>{this._complete(r.data),this._returnWorker(r.target),this._next()})),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){e.error!==void 0?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),this._resolveHash[e.uuid]=null}async _run(e,r){await this._initWorkers();const s=new Promise((n,i)=>{this._queue.push({id:e,arguments:r,resolve:n,reject:i})});return this._next(),s}_next(){if(!this._queue.length)return;const e=this._getWorker();if(!e)return;const r=this._queue.pop(),s=r.id;this._resolveHash[Yo]={resolve:r.resolve,reject:r.reject},e.postMessage({data:r.arguments,uuid:Yo++,id:s})}}const Xo=new Mg,Ig=[".jpeg",".jpg",".png",".webp",".avif"],Tg=["image/jpeg","image/png","image/webp","image/avif"];async function Eg(t,e){const r=await be.get().fetch(t);if(!r.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${r.status} ${r.statusText}`);const s=await r.blob();return e?.data?.alphaMode==="premultiplied-alpha"?createImageBitmap(s,{premultiplyAlpha:"none"}):createImageBitmap(s)}const Hh={name:"loadTextures",extension:{type:U.LoadParser,priority:zt.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(t){return vr(t,Tg)||Sr(t,Ig)},async load(t,e,r){let s=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Xo.isImageBitmapSupported()?s=await Xo.loadImageBitmap(t,e):s=await Eg(t,e):s=await new Promise((i,a)=>{s=new Image,s.crossOrigin=this.config.crossOrigin,s.src=t,s.complete?i(s):(s.onload=()=>{i(s)},s.onerror=a)});const n=new Xt({resource:s,alphaMode:"premultiply-alpha-on-upload",resolution:e.data?.resolution||oa(t),...e.data});return la(n,r,t)},unload(t){t.destroy(!0)}},Wh=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],Rg=Wh.map(t=>`video/${t.substring(1)}`);function jg(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=zg(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}function Bg(t){return new Promise((e,r)=>{t.addEventListener("canplaythrough",s),t.addEventListener("error",n),t.load();function s(){i(),e()}function n(a){i(),r(a)}function i(){t.removeEventListener("canplaythrough",s),t.removeEventListener("error",n)}})}function zg(t,e=globalThis.location){if(t.startsWith("data:"))return"";e||(e=globalThis.location);const r=new URL(t,document.baseURI);return r.hostname!==e.hostname||r.port!==e.port||r.protocol!==e.protocol?"anonymous":""}const Fg={name:"loadVideo",extension:{type:U.LoadParser,name:"loadVideo"},test(t){const e=vr(t,Rg),r=Sr(t,Wh);return e||r},async load(t,e,r){const s={...ks.defaultOptions,resolution:e.data?.resolution||oa(t),alphaMode:e.data?.alphaMode||await nh(),...e.data},n=document.createElement("video"),i={preload:s.autoLoad!==!1?"auto":void 0,"webkit-playsinline":s.playsinline!==!1?"":void 0,playsinline:s.playsinline!==!1?"":void 0,muted:s.muted===!0?"":void 0,loop:s.loop===!0?"":void 0,autoplay:s.autoPlay!==!1?"":void 0};Object.keys(i).forEach(l=>{const c=i[l];c!==void 0&&n.setAttribute(l,c)}),s.muted===!0&&(n.muted=!0),jg(n,t,s.crossorigin);const a=document.createElement("source");let o;if(t.startsWith("data:"))o=t.slice(5,t.indexOf(";"));else if(!t.startsWith("blob:")){const l=t.split("?")[0].slice(t.lastIndexOf(".")+1).toLowerCase();o=ks.MIME_TYPES[l]||`video/${l}`}return a.src=t,o&&(a.type=o),new Promise(l=>{const c=async()=>{const h=new ks({...s,resource:n});n.removeEventListener("canplay",c),e.data.preload&&await Bg(n),l(la(h,r,t))};n.addEventListener("canplay",c),n.appendChild(a)})},unload(t){t.destroy(!0)}},Uh={extension:{type:U.ResolveParser,name:"resolveTexture"},test:Hh.test,parse:t=>({resolution:parseFloat(_r.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})},Og={extension:{type:U.ResolveParser,priority:-2,name:"resolveJson"},test:t=>_r.RETINA_PREFIX.test(t)&&t.endsWith(".json"),parse:Uh.parse};class Ng{constructor(){this._detections=[],this._initialized=!1,this.resolver=new _r,this.loader=new ag,this.cache=pe,this._backgroundLoader=new Zm(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){ue("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let i=e.manifest;typeof i=="string"&&(i=await this.load(i)),this.resolver.addManifest(i)}const r=e.texturePreference?.resolution??1,s=typeof r=="number"?[r]:r,n=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:s}}),e.preferences&&this.setPreferences(e.preferences)}add(e){this.resolver.add(e)}async load(e,r){this._initialized||await this.init();const s=Rs(e),n=it(e).map(o=>{if(typeof o!="string"){const l=this.resolver.getAlias(o);return l.some(c=>!this.resolver.hasKey(c))&&this.add(o),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(o)||this.add({alias:o,src:o}),o}),i=this.resolver.resolve(n),a=await this._mapLoadToResolve(i,r);return s?a[n[0]]:a}addBundle(e,r){this.resolver.addBundle(e,r)}async loadBundle(e,r){this._initialized||await this.init();let s=!1;typeof e=="string"&&(s=!0,e=[e]);const n=this.resolver.resolveBundle(e),i={},a=Object.keys(n);let o=0,l=0;const c=()=>{r?.(++o/l)},h=a.map(u=>{const f=n[u];return l+=Object.keys(f).length,this._mapLoadToResolve(f,c).then(d=>{i[u]=d})});return await Promise.all(h),s?i[e[0]]:i}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const r=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(r))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const r=this.resolver.resolveBundle(e);Object.values(r).forEach(s=>{this._backgroundLoader.add(Object.values(s))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return pe.get(e);const r={};for(let s=0;s<e.length;s++)r[s]=pe.get(e[s]);return r}async _mapLoadToResolve(e,r){const s=[...new Set(Object.values(e))];this._backgroundLoader.active=!1;const n=await this.loader.load(s,r);this._backgroundLoader.active=!0;const i={};return s.forEach(a=>{const o=n[a.src],l=[a.src];a.alias&&l.push(...a.alias),l.forEach(c=>{i[c]=o}),pe.set(l,o)}),i}async unload(e){this._initialized||await this.init();const r=it(e).map(n=>typeof n!="string"?n.src:n),s=this.resolver.resolve(r);await this._unloadFromResolved(s)}async unloadBundle(e){this._initialized||await this.init(),e=it(e);const r=this.resolver.resolveBundle(e),s=Object.keys(r).map(n=>this._unloadFromResolved(r[n]));await Promise.all(s)}async _unloadFromResolved(e){const r=Object.values(e);r.forEach(s=>{pe.remove(s.src)}),await this.loader.unload(r)}async _detectFormats(e){let r=[];e.preferredFormats&&(r=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const s of e.detections)e.skipDetections||await s.test()?r=await s.add(r):e.skipDetections||(r=await s.remove(r));return r=r.filter((s,n)=>r.indexOf(s)===n),r}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach(r=>{r.config&&Object.keys(r.config).filter(s=>s in e).forEach(s=>{r.config[s]=e[s]})})}}const Or=new Ng;Be.handleByList(U.LoadParser,Or.loader.parsers).handleByList(U.ResolveParser,Or.resolver.parsers).handleByList(U.CacheParser,Or.cache.parsers).handleByList(U.DetectionParser,Or.detections);Be.add(Qm,eg,Jm,ig,rg,sg,ng,cg,dg,wg,Sg,Hh,Fg,Km,Xm,Uh,Og);const Ko={loader:U.LoadParser,resolver:U.ResolveParser,cache:U.CacheParser,detection:U.DetectionParser};Be.handle(U.Asset,t=>{const e=t.ref;Object.entries(Ko).filter(([r])=>!!e[r]).forEach(([r,s])=>Be.add(Object.assign(e[r],{extension:e[r].extension??s})))},t=>{const e=t.ref;Object.keys(Ko).filter(r=>!!e[r]).forEach(r=>Be.remove(e[r]))});Be.add(yd,bd);const Lg="/assets/sprites-ClwwqWQm.png",Jt=t=>t[Symbol.iterator](),es=["away","towards","left","right"],Gg=["awayRight","towardsRight","towardsLeft","awayLeft"],Dg=[...es,...Gg],$g=t=>t==="away"||t==="towards"?"y":"x",C0=t=>t==="away"?"towards":t==="towards"?"away":t==="left"?"right":"left",P0=t=>Hg($g(t)),Hg=t=>t==="x"?"y":"x",Wr=(t,...e)=>e.reduce((r,s)=>({x:r.x+(s.x??0),y:r.y+(s.y??0)}),t),M0=(t,...e)=>e.reduce((r,s)=>({x:r.x-(s.x??0),y:r.y-(s.y??0)}),t),Vh=(t,e)=>({x:t.x*e,y:t.y*e}),Wg=(t,e)=>({x:t.x*e,y:t.y*e,z:t.z*e}),I0=(t,e)=>({x:t.x*e.x,y:t.y*e.y,z:t.z*e.z}),qh=({x:t,y:e,z:r})=>Math.sqrt(t*t+e*e+r*r),Ug=({x:t,y:e})=>Math.sqrt(t*t+e*e),hr=t=>Wg(t,1/qh(t)),Zo=(...t)=>t.reduce(({x:e,y:r,z:s},{x:n=0,y:i=0,z:a=0})=>({x:e+n,y:r+i,z:s+a}),ur),T0=(t,...e)=>e.reduce((r,s)=>({x:r.x-(s.x??0),y:r.y-(s.y??0),z:r.z-(s.z??0)}),t),Vg=({x:t,y:e,z:r},{x:s,y:n,z:i})=>t===s&&e===n&&r===i,E0=({x:t,y:e},{x:r,y:s})=>t===r&&e===s,R0=({x:t=0,y:e=0,z:r=0})=>Number.isInteger(t)&&Number.isInteger(e)&&Number.isInteger(r),j0=({x:t,y:e,z:r})=>({x:Math.round(t),y:Math.round(e),z:Math.round(r)}),B0=Object.freeze({x:0,y:0}),ur=Object.freeze({x:0,y:0,z:0}),z0=["x","y","z"],qg=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,F0=({x:t,y:e})=>e>t?e>-t?"away":"right":e>-t?"left":"towards",Yg=["right","towardsRight","towards","towardsLeft","left","awayLeft","away","awayRight"],O0=({x:t,y:e})=>{const r=Math.atan2(-e,-t),s=Math.round(8*r/(2*Math.PI))&7;return Yg[s]},N0=({x:t,y:e},{x:r,y:s})=>Math.abs(r-t)**2+Math.abs(s-e)**2;var Rn={exports:{}},jn={exports:{}},Qo;function er(){return Qo||(Qo=1,function(t){function e(r){"@babel/helpers - typeof";return t.exports=e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(jn)),jn.exports}var Jo;function Xg(){return Jo||(Jo=1,function(t){var e=er().default;function r(){t.exports=r=function(){return n},t.exports.__esModule=!0,t.exports.default=t.exports;var s,n={},i=Object.prototype,a=i.hasOwnProperty,o=Object.defineProperty||function(v,_,C){v[_]=C.value},l=typeof Symbol=="function"?Symbol:{},c=l.iterator||"@@iterator",h=l.asyncIterator||"@@asyncIterator",u=l.toStringTag||"@@toStringTag";function f(v,_,C){return Object.defineProperty(v,_,{value:C,enumerable:!0,configurable:!0,writable:!0}),v[_]}try{f({},"")}catch{f=function(C,M,R){return C[M]=R}}function d(v,_,C,M){var R=_&&_.prototype instanceof P?_:P,B=Object.create(R.prototype),G=new S(M||[]);return o(B,"_invoke",{value:Q(v,C,G)}),B}function g(v,_,C){try{return{type:"normal",arg:v.call(_,C)}}catch(M){return{type:"throw",arg:M}}}n.wrap=d;var x="suspendedStart",m="suspendedYield",w="executing",b="completed",A={};function P(){}function E(){}function I(){}var T={};f(T,c,function(){return this});var N=Object.getPrototypeOf,z=N&&N(N(k([])));z&&z!==i&&a.call(z,c)&&(T=z);var j=I.prototype=P.prototype=Object.create(T);function $(v){["next","throw","return"].forEach(function(_){f(v,_,function(C){return this._invoke(_,C)})})}function K(v,_){function C(R,B,G,V){var q=g(v[R],v,B);if(q.type!=="throw"){var Y=q.arg,ie=Y.value;return ie&&e(ie)=="object"&&a.call(ie,"__await")?_.resolve(ie.__await).then(function(X){C("next",X,G,V)},function(X){C("throw",X,G,V)}):_.resolve(ie).then(function(X){Y.value=X,G(Y)},function(X){return C("throw",X,G,V)})}V(q.arg)}var M;o(this,"_invoke",{value:function(B,G){function V(){return new _(function(q,Y){C(B,G,q,Y)})}return M=M?M.then(V,V):V()}})}function Q(v,_,C){var M=x;return function(R,B){if(M===w)throw Error("Generator is already running");if(M===b){if(R==="throw")throw B;return{value:s,done:!0}}for(C.method=R,C.arg=B;;){var G=C.delegate;if(G){var V=ae(G,C);if(V){if(V===A)continue;return V}}if(C.method==="next")C.sent=C._sent=C.arg;else if(C.method==="throw"){if(M===x)throw M=b,C.arg;C.dispatchException(C.arg)}else C.method==="return"&&C.abrupt("return",C.arg);M=w;var q=g(v,_,C);if(q.type==="normal"){if(M=C.done?b:m,q.arg===A)continue;return{value:q.arg,done:C.done}}q.type==="throw"&&(M=b,C.method="throw",C.arg=q.arg)}}}function ae(v,_){var C=_.method,M=v.iterator[C];if(M===s)return _.delegate=null,C==="throw"&&v.iterator.return&&(_.method="return",_.arg=s,ae(v,_),_.method==="throw")||C!=="return"&&(_.method="throw",_.arg=new TypeError("The iterator does not provide a '"+C+"' method")),A;var R=g(M,v.iterator,_.arg);if(R.type==="throw")return _.method="throw",_.arg=R.arg,_.delegate=null,A;var B=R.arg;return B?B.done?(_[v.resultName]=B.value,_.next=v.nextLoc,_.method!=="return"&&(_.method="next",_.arg=s),_.delegate=null,A):B:(_.method="throw",_.arg=new TypeError("iterator result is not an object"),_.delegate=null,A)}function Oe(v){var _={tryLoc:v[0]};1 in v&&(_.catchLoc=v[1]),2 in v&&(_.finallyLoc=v[2],_.afterLoc=v[3]),this.tryEntries.push(_)}function y(v){var _=v.completion||{};_.type="normal",delete _.arg,v.completion=_}function S(v){this.tryEntries=[{tryLoc:"root"}],v.forEach(Oe,this),this.reset(!0)}function k(v){if(v||v===""){var _=v[c];if(_)return _.call(v);if(typeof v.next=="function")return v;if(!isNaN(v.length)){var C=-1,M=function R(){for(;++C<v.length;)if(a.call(v,C))return R.value=v[C],R.done=!1,R;return R.value=s,R.done=!0,R};return M.next=M}}throw new TypeError(e(v)+" is not iterable")}return E.prototype=I,o(j,"constructor",{value:I,configurable:!0}),o(I,"constructor",{value:E,configurable:!0}),E.displayName=f(I,u,"GeneratorFunction"),n.isGeneratorFunction=function(v){var _=typeof v=="function"&&v.constructor;return!!_&&(_===E||(_.displayName||_.name)==="GeneratorFunction")},n.mark=function(v){return Object.setPrototypeOf?Object.setPrototypeOf(v,I):(v.__proto__=I,f(v,u,"GeneratorFunction")),v.prototype=Object.create(j),v},n.awrap=function(v){return{__await:v}},$(K.prototype),f(K.prototype,h,function(){return this}),n.AsyncIterator=K,n.async=function(v,_,C,M,R){R===void 0&&(R=Promise);var B=new K(d(v,_,C,M),R);return n.isGeneratorFunction(_)?B:B.next().then(function(G){return G.done?G.value:B.next()})},$(j),f(j,u,"Generator"),f(j,c,function(){return this}),f(j,"toString",function(){return"[object Generator]"}),n.keys=function(v){var _=Object(v),C=[];for(var M in _)C.push(M);return C.reverse(),function R(){for(;C.length;){var B=C.pop();if(B in _)return R.value=B,R.done=!1,R}return R.done=!0,R}},n.values=k,S.prototype={constructor:S,reset:function(_){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(y),!_)for(var C in this)C.charAt(0)==="t"&&a.call(this,C)&&!isNaN(+C.slice(1))&&(this[C]=s)},stop:function(){this.done=!0;var _=this.tryEntries[0].completion;if(_.type==="throw")throw _.arg;return this.rval},dispatchException:function(_){if(this.done)throw _;var C=this;function M(Y,ie){return G.type="throw",G.arg=_,C.next=Y,ie&&(C.method="next",C.arg=s),!!ie}for(var R=this.tryEntries.length-1;R>=0;--R){var B=this.tryEntries[R],G=B.completion;if(B.tryLoc==="root")return M("end");if(B.tryLoc<=this.prev){var V=a.call(B,"catchLoc"),q=a.call(B,"finallyLoc");if(V&&q){if(this.prev<B.catchLoc)return M(B.catchLoc,!0);if(this.prev<B.finallyLoc)return M(B.finallyLoc)}else if(V){if(this.prev<B.catchLoc)return M(B.catchLoc,!0)}else{if(!q)throw Error("try statement without catch or finally");if(this.prev<B.finallyLoc)return M(B.finallyLoc)}}}},abrupt:function(_,C){for(var M=this.tryEntries.length-1;M>=0;--M){var R=this.tryEntries[M];if(R.tryLoc<=this.prev&&a.call(R,"finallyLoc")&&this.prev<R.finallyLoc){var B=R;break}}B&&(_==="break"||_==="continue")&&B.tryLoc<=C&&C<=B.finallyLoc&&(B=null);var G=B?B.completion:{};return G.type=_,G.arg=C,B?(this.method="next",this.next=B.finallyLoc,A):this.complete(G)},complete:function(_,C){if(_.type==="throw")throw _.arg;return _.type==="break"||_.type==="continue"?this.next=_.arg:_.type==="return"?(this.rval=this.arg=_.arg,this.method="return",this.next="end"):_.type==="normal"&&C&&(this.next=C),A},finish:function(_){for(var C=this.tryEntries.length-1;C>=0;--C){var M=this.tryEntries[C];if(M.finallyLoc===_)return this.complete(M.completion,M.afterLoc),y(M),A}},catch:function(_){for(var C=this.tryEntries.length-1;C>=0;--C){var M=this.tryEntries[C];if(M.tryLoc===_){var R=M.completion;if(R.type==="throw"){var B=R.arg;y(M)}return B}}throw Error("illegal catch attempt")},delegateYield:function(_,C,M){return this.delegate={iterator:k(_),resultName:C,nextLoc:M},this.method==="next"&&(this.arg=s),A}},n}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(Rn)),Rn.exports}var Bn,el;function ts(){if(el)return Bn;el=1;var t=Xg()();Bn=t;try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}return Bn}var Le={},zn={exports:{}},Fn={exports:{}},On={exports:{}},tl;function Kg(){return tl||(tl=1,function(t){var e=er().default;function r(s,n){if(e(s)!="object"||!s)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var a=i.call(s,n||"default");if(e(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(s)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(On)),On.exports}var rl;function Zg(){return rl||(rl=1,function(t){var e=er().default,r=Kg();function s(n){var i=r(n,"string");return e(i)=="symbol"?i:i+""}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports}(Fn)),Fn.exports}var sl;function Qg(){return sl||(sl=1,function(t){var e=Zg();function r(s,n,i){return(n=e(n))in s?Object.defineProperty(s,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[n]=i,s}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(zn)),zn.exports}var Nn={exports:{}},Ln={exports:{}},Gn={exports:{}},nl;function Yh(){return nl||(nl=1,function(t){function e(r,s){(s==null||s>r.length)&&(s=r.length);for(var n=0,i=Array(s);n<s;n++)i[n]=r[n];return i}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Gn)),Gn.exports}var il;function Jg(){return il||(il=1,function(t){var e=Yh();function r(s){if(Array.isArray(s))return e(s)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(Ln)),Ln.exports}var Dn={exports:{}},al;function ex(){return al||(al=1,function(t){function e(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Dn)),Dn.exports}var $n={exports:{}},ol;function Xh(){return ol||(ol=1,function(t){var e=Yh();function r(s,n){if(s){if(typeof s=="string")return e(s,n);var i={}.toString.call(s).slice(8,-1);return i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set"?Array.from(s):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(s,n):void 0}}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}($n)),$n.exports}var Hn={exports:{}},ll;function tx(){return ll||(ll=1,function(t){function e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Hn)),Hn.exports}var cl;function Kh(){return cl||(cl=1,function(t){var e=Jg(),r=ex(),s=Xh(),n=tx();function i(a){return e(a)||r(a)||s(a)||n()}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports}(Nn)),Nn.exports}var Wn={},Un={},hl;function ca(){if(hl)return Un;hl=1;function t(e){return typeof e<"u"}return Un.notUndefined=t,Un}var ul;function Zh(){if(ul)return Wn;ul=1;var t=ca(),e=t.notUndefined;function r(s){return s!=null&&e(s[Symbol.iterator])}return Wn.isIterable=r,Wn}var Vn={},dl;function rx(){return dl||(dl=1,Vn.isLoopable=Zh().isIterable),Vn}var qn={},fl;function sx(){if(fl)return qn;fl=1;var t=ca(),e=t.notUndefined;function r(s){return s==null||e(s[Symbol.iterator])}return qn.isWrappable=r,qn}var fs={},pl;function nx(){if(pl)return fs;pl=1;var t=ts(),e=t.mark(s),r=t.mark(n);function s(i){return t.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.delegateYield(i,"t0",1);case 1:case"end":return o.stop()}},e)}fs.wrap=s;function n(i){return t.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(i==null){o.next=2;break}return o.delegateYield(i,"t0",2);case 2:case"end":return o.stop()}},r)}return fs.nullableWrap=n,fs}var ps={},ml;function ix(){if(ml)return ps;ml=1;var t=Kh();function e(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:n.length,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return i<=l.length?n.apply(void 0,t(a).concat(l)):e(n,i-l.length,[].concat(t(a),l))}}ps.curry=e;function r(n,i){var a=n.fn,o=n.validateArgs,l=n.variadic,c=n.reduces,h=n.growRight,u=n.minArgs,f=n.maxArgs,d=n.isIterable,g=n.iterableType,x=n.applyOnIterableArgs,m=n.IterableClass;if(i.length>u){var w=!0,b=l?i.findIndex(function(z,j){return d(z)&&j>=u}):Math.min(f,i.length-1),A=l?i.length:b+1;if(l)for(var P=b;P<i.length;P++)w=w&&d(i[P]);else w=d(i[b]);if(i.length>f&&(b===-1||!w)){var E=l?"...".concat(g,"s"):g,I="".concat(a.name," takes up to ").concat(f," arguments, followed by ").concat(E,". ")+"You already passed ".concat(i.length," arguments");throw l?new Error("".concat(I," and the following arguments were not all ").concat(g,"s")):new Error("".concat(I," and the last argument was not ").concat(g))}if(b>=0&&w){for(var T=b;T<A;T++)i[T]=x(i[T]);var N=l?i.slice(b):i[b];return i.splice(b),h||i.reverse(),i.unshift(N),o(i),c?a.apply(void 0,t(i)):new m(a,i)}}return s(n,i)}function s(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return function(){for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];if(o.length===0)throw new Error("Cannot make a partial application with no arguments");return o.unshift.apply(o,t(i)),r(n,o)}}return ps.variadicCurryWithValidation=s,ps}var Ir={},gl;function ax(){if(gl)return Ir;gl=1;var t=Symbol.for("_");Ir._=t;var e=Symbol("__iterate");Ir.__iterate=e;var r=Symbol("split");return Ir.split=r,Ir}var xl;function rs(){if(xl)return Le;xl=1;var t=Qg(),e=Kh(),r,s=Zh(),n=s.isIterable,i=rx(),a=i.isLoopable,o=sx(),l=o.isWrappable,c=nx(),h=c.nullableWrap,u=ix(),f=u.variadicCurryWithValidation,d=ax(),g=d._,x=d.__iterate;Le.wrap=h,Le.isIterable=n,Le.isLoopable=a,Le.isWrappable=l;function m(N){if(l(N))return n(N)?N:h(N);throw typeof N.next=="function"?new TypeError("iter-tools received a value that looked like an iterator but was not iterable. Get help fixing this: https://github.com/iter-tools/iter-tools/wiki/Making-iterators-iterable"):new TypeError("Expected an iterable, null, or undefined")}Le.ensureIterable=m;function w(N){"return"in N&&N.return()}Le.callReturn=w;function b(N,z){this[g]={fn:N,args:z,staticIterator:null}}Le.BaseIterableIterator=b,Object.assign(b.prototype,(r={constructor:b},t(r,x,function(){var N=this[g],z=N.fn,j=N.args;return z.apply(void 0,e(j))}),t(r,"next",function(){var z=this[g];return z.staticIterator=z.staticIterator||this[x](),z.staticIterator.next()}),t(r,"return",function(z){var j=this[g];return j.staticIterator=j.staticIterator||this[x](),j.staticIterator.return(z)}),t(r,"throw",function(z){var j=this[g];return j.staticIterator=j.staticIterator||this[x](),j.staticIterator.throw(z)}),r));function A(){for(var N=arguments.length,z=new Array(N),j=0;j<N;j++)z[j]=arguments[j];b.apply(this,z)}Le.IterableIterator=A,A.prototype=Object.assign(Object.create(b.prototype),t({constructor:A},Symbol.iterator,function(){return this[x]()}));function P(N){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},j=z.validateArgs,$=j===void 0?function(B){}:j,K=z.variadic,Q=K===void 0?!1:K,ae=z.reduces,Oe=ae===void 0?!1:ae,y=z.growRight,S=y===void 0?!1:y,k=z.minArgs,v=k===void 0?N.length-1:k,_=z.maxArgs,C=_===void 0?N.length-1:_,M=z.applyOnIterableArgs,R=M===void 0?m:M;return{fn:N,validateArgs:$,variadic:Q,reduces:Oe,growRight:S,minArgs:v,maxArgs:C,isIterable:l,iterableType:"iterable",applyOnIterableArgs:R,IterableClass:A}}function E(N){return e(N)}Le.cache=E;function I(N){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},j=z.validateArgs,$=j===void 0?function(K){return K}:j;return function(){for(var K=arguments.length,Q=new Array(K),ae=0;ae<K;ae++)Q[ae]=arguments[ae];return $(Q),new A(N,Q)}}Le.wrapWithIterableIterator=I;var T=function(z,j){return f(P(z,j))};return Le.iterableCurry=T,Le}var Tr={},yl;function ox(){if(yl)return Tr;yl=1;function t(s){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return typeof s=="number"&&!isNaN(s)&&isFinite(s)&&!(n&&s===0)}Tr.isInteger=t;function e(s){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return t(s)&&(n?s>0:s>=0)}Tr.isPositiveInteger=e;function r(s){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return typeof s=="number"&&!isNaN(s)&&!(n&&s===0)}return Tr.isIntegerOrInfinite=r,Tr}var Yn={exports:{}},Xn={exports:{}},bl;function lx(){return bl||(bl=1,function(t){function e(r){if(Array.isArray(r))return r}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Xn)),Xn.exports}var Kn={exports:{}},wl;function cx(){return wl||(wl=1,function(t){function e(r,s){var n=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(n!=null){var i,a,o,l,c=[],h=!0,u=!1;try{if(o=(n=n.call(r)).next,s===0){if(Object(n)!==n)return;h=!1}else for(;!(h=(i=o.call(n)).done)&&(c.push(i.value),c.length!==s);h=!0);}catch(f){u=!0,a=f}finally{try{if(!h&&n.return!=null&&(l=n.return(),Object(l)!==l))return}finally{if(u)throw a}}return c}}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Kn)),Kn.exports}var Zn={exports:{}},_l;function hx(){return _l||(_l=1,function(t){function e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Zn)),Zn.exports}var vl;function ux(){return vl||(vl=1,function(t){var e=lx(),r=cx(),s=Xh(),n=hx();function i(a,o){return e(a)||r(a,o)||s(a,o)||n()}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports}(Yn)),Yn.exports}var Qn={},Sl;function dx(){if(Sl)return Qn;Sl=1;var t=er();function e(r){return t(r)==="object"&&r!==null}return Qn.isObject=e,Qn}var ms={},Al;function fx(){if(Al)return ms;Al=1;var t=er(),e=ts(),r=e.mark(a),s=rs(),n=s.wrapWithIterableIterator,i=Object.prototype.hasOwnProperty;function a(l){var c;return e.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(l!=null){u.next=2;break}return u.abrupt("return");case 2:u.t0=e.keys(l);case 3:if((u.t1=u.t0()).done){u.next=10;break}if(c=u.t1.value,!i.call(l,c)){u.next=8;break}return u.next=8,[c,l[c]];case 8:u.next=3;break;case 10:case"end":return u.stop()}},r)}ms.__objectEntries=a;var o=n(a,{validateArgs:function(c){if(!(c[0]==null||t(c[0])==="object"))throw new Error("obj argument to objectEntries must be an object, null, or undefined")}});return ms.objectEntries=o,ms}var gs={},kl;function px(){if(kl)return gs;kl=1;var t=er(),e=ts(),r=e.mark(a),s=rs(),n=s.wrapWithIterableIterator,i=Object.prototype.hasOwnProperty;function a(l){var c;return e.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(l!=null){u.next=2;break}return u.abrupt("return");case 2:u.t0=e.keys(l);case 3:if((u.t1=u.t0()).done){u.next=10;break}if(c=u.t1.value,!i.call(l,c)){u.next=8;break}return u.next=8,c;case 8:u.next=3;break;case 10:case"end":return u.stop()}},r)}gs.__objectKeys=a;var o=n(a,{validateArgs:function(c){if(!(c[0]==null||t(c[0])==="object"))throw new Error("obj argument to objectKeys must be an object, null, or undefined")}});return gs.objectKeys=o,gs}var xs={},Cl;function mx(){if(Cl)return xs;Cl=1;var t=er(),e=ts(),r=e.mark(a),s=rs(),n=s.wrapWithIterableIterator,i=Object.prototype.hasOwnProperty;function a(l){var c;return e.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(l!=null){u.next=2;break}return u.abrupt("return");case 2:u.t0=e.keys(l);case 3:if((u.t1=u.t0()).done){u.next=10;break}if(c=u.t1.value,!i.call(l,c)){u.next=8;break}return u.next=8,l[c];case 8:u.next=3;break;case 10:case"end":return u.stop()}},r)}xs.__objectValues=a;var o=n(a,{validateArgs:function(c){if(!(c[0]==null||t(c[0])==="object"))throw new Error("obj argument to objectValues must be an object, null, or undefined")}});return xs.objectValues=o,xs}var ys={},Pl;function gx(){if(Pl)return ys;Pl=1;var t=ux(),e=ts(),r=e.mark(f),s=rs(),n=s.wrapWithIterableIterator,i=ox(),a=i.isInteger,o=i.isIntegerOrInfinite,l=dx(),c=l.isObject,h=ca(),u=h.notUndefined;function f(){var g,x,m,w,b=arguments;return e.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:g=b.length>0&&b[0]!==void 0?b[0]:0,x=b.length>1&&b[1]!==void 0?b[1]:1/0,m=b.length>2&&b[2]!==void 0?b[2]:1,w=g;case 4:if(!(m>0?w<x:w>x)){P.next=10;break}return P.next=7,w;case 7:w+=m,P.next=4;break;case 10:case"end":return P.stop()}},r)}ys.__range=f;var d=n(f,{growRight:!0,validateArgs:function(x){var m=t(x,3),w=m[0],b=m[1],A=b===void 0?1/0:b,P=m[2],E;if(c(w)?(E=w.start,A=w.end,P=w.step):x.length>1?E=w:A=w,u(E)&&!a(E))throw new TypeError("The specified start was not an integer");if(u(A)&&!o(A))throw new TypeError("The specified end was not an integer or infinite");if(u(P)&&!a(P,!0))throw new TypeError("The specified step was not a non-zero integer");x[0]=E,x[1]=A,x[2]=P}});return ys.range=d,ys}var bs={},Ml;function xx(){if(Ml)return bs;Ml=1;function t(o,l){var c;if(typeof Symbol>"u"||o[Symbol.iterator]==null){if(Array.isArray(o)||(c=e(o))||l){c&&(o=c);var h=0,u=function(){};return{s:u,n:function(){return h>=o.length?{done:!0}:{done:!1,value:o[h++]}},e:function(m){throw m},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,d=!1,g;return{s:function(){c=o[Symbol.iterator]()},n:function(){var m=c.next();return f=m.done,m},e:function(m){d=!0,g=m},f:function(){try{!f&&c.return!=null&&c.return()}finally{if(d)throw g}}}}function e(o,l){if(o){if(typeof o=="string")return r(o,l);var c=Object.prototype.toString.call(o).slice(8,-1);if(c==="Object"&&o.constructor&&(c=o.constructor.name),c==="Map"||c==="Set")return Array.from(o);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return r(o,l)}}function r(o,l){(l==null||l>o.length)&&(l=o.length);for(var c=0,h=new Array(l);c<l;c++)h[c]=o[c];return h}var s=rs(),n=s.ensureIterable;function i(o){var l=n(o),c=0,h=t(l),u;try{for(h.s();!(u=h.n()).done;){var f=u.value;c++}}catch(d){h.e(d)}finally{h.f()}return c}bs.__size=i;var a=i;return bs.size=a,bs}var Jn,Il;function yx(){return Il||(Il=1,Jn=fx().objectEntries),Jn}var bx=yx();const wx=rt(bx);var ei,Tl;function _x(){return Tl||(Tl=1,ei=px().objectKeys),ei}var vx=_x();const Sx=rt(vx);var ti,El;function Ax(){return El||(El=1,ti=mx().objectValues),ti}var kx=Ax();const Qh=rt(kx);var ri,Rl;function Cx(){return Rl||(Rl=1,ri=gx().range),ri}var Px=Cx();const Mx=rt(Px);var si,jl;function Ix(){return jl||(jl=1,si=xx().size),si}var Tx=Ix();const Ri=rt(Tx),Ot=(t,{x:e,y:r},s)=>{function*n(){yield[`${t}.left`,{frame:{x:e,y:r,...s}}],yield[`${t}.away`,{frame:{x:e+s.w+1,y:r,...s}}],yield[`${t}.towards`,{frame:{x:e,y:r+s.h+1,...s}}],yield[`${t}.right`,{frame:{x:e+s.w+1,y:r+s.h+1,...s}}]}return Object.fromEntries(n())},se=(t,e,{x:r,y:s},n)=>{function*i(){for(let a=0;a<e;a++)yield[`${t}.${a+1}`,{frame:{x:r+a*(n.w+1),y:s,...n}}]}return Object.fromEntries(i())},Ex=(t,e,r,s)=>({...se(`${t}.left`,e,r,s),...se(`${t}.away`,e,Wr(r,{x:(s.w+1)*e}),s),...se(`${t}.towards`,e,Wr(r,{y:s.h+1}),s),...se(`${t}.right`,e,Wr(r,{x:(s.w+1)*e,y:s.h+1}),s)}),Bl=(t,e)=>[...Jt(Mx(1,e+1)).map(r=>`${t}.${String(r)}`)],Nr={w:32,h:16},pt={w:16,h:56},ne={w:32,h:28},F={w:24,h:24},Vt={w:8,h:8},O=t=>({x:t.x*(F.w+1)+1,y:t.y*(F.h+1)+2}),oe=t=>({x:t.x*(ne.w+1)+1,y:t.y*(ne.h+1)+396}),L0=["yellow","cyan","green","magenta","white"],G0=["basic","dimmed"],Jh=25,D0=1e3/Jh,tr={amigaLowResPal:{x:320,y:256},zxSpectrum:{x:256,y:192},gameboy:{x:160,y:120}},ni=Object.keys(tr),$0={zxRed:"#f00",zxGreen:"#0f0",zxBlue:"#00f",zxYellow:"#ff0",zxWhite:"#fff"},fe=(t,e)=>Object.assign([...t],{animationSpeed:e}),Rx=.5,Er=(t,e)=>{const s=Math.round(5e3/(Jh*4))-3,n=[...new Array(s).fill(`head.walking.${t}.${e}`),`head.blinking.${t}`,`head.walking.${t}.${e}`,`head.blinking.${t}`];return fe(n,.5)};function zl(t){function*e(r,s){yield`${r}.walking.${s}.1`,yield`${r}.walking.${s}.2`,yield`${r}.walking.${s}.3`,yield`${r}.walking.${s}.2`}return Dg.reduce((r,s)=>({...r,[`${t}.walking.${s}`]:fe([...e(t,s)],Rx)}),{})}const jx={...se("bubbles.head",6,O({x:0,y:6}),F),...se("head.walking.towards",3,O({x:1,y:11}),F),...se("head.walking.right",3,O({x:4,y:11}),F),...se("head.walking.left",3,O({x:1,y:9}),F),...se("head.walking.away",3,O({x:4,y:9}),F),...se("head.walking.towardsRight",3,O({x:2,y:12}),F),...se("head.walking.towardsLeft",3,O({x:1,y:10}),F),...se("head.walking.awayRight",3,O({x:4,y:10}),F),...se("head.walking.awayLeft",3,O({x:2,y:8}),F),"head.blinking.towards":{frame:{...O({x:0,y:12}),...F}},"head.blinking.right":{frame:{...O({x:7,y:12}),...F}},"head.blinking.towardsRight":{frame:{...O({x:5,y:12}),...F}},"head.blinking.awayRight":{frame:{...O({x:7,y:9}),...F}},"head.blinking.towardsLeft":{frame:{...O({x:0,y:9}),...F}},"head.falling.left":{frame:{...O({x:1,y:8}),...F}},"head.falling.away":{frame:{...O({x:6,y:8}),...F}},"head.falling.awayLeft":{frame:{...O({x:3,y:7}),...F}},"head.falling.towards":{frame:{...O({x:0,y:11}),...F}},"head.falling.right":{frame:{...O({x:7,y:11}),...F}},"head.falling.towardsRight":{frame:{...O({x:6,y:12}),...F}},"head.falling.awayRight":{frame:{...O({x:7,y:10}),...F}},"head.falling.towardsLeft":{frame:{...O({x:0,y:10}),...F}},...se("bubbles.heels",6,O({x:6,y:6}),F),...se("heels.walking.towards",3,O({x:8,y:11}),F),...se("heels.walking.right",3,O({x:11,y:11}),F),...se("heels.walking.left",3,O({x:8,y:9}),F),...se("heels.walking.away",3,O({x:11,y:9}),F),...se("heels.walking.towardsRight",3,O({x:10,y:12}),F),...se("heels.walking.towardsLeft",3,O({x:8,y:10}),F),...se("heels.walking.awayRight",3,O({x:11,y:10}),F),...se("heels.walking.awayLeft",3,O({x:10,y:8}),F)},eu={frames:jx,animations:{...zl("head"),...zl("heels"),"heels.screenDirections":fe(["heels.walking.towardsRight.2","heels.walking.towardsLeft.2","heels.walking.awayLeft.2","heels.walking.awayRight.2"],1/16),"heels.worldDirections":fe(["heels.walking.towards.2","heels.walking.left.2","heels.walking.away.2","heels.walking.right.2"],1/16),"head.idle.right":Er("right",3),"head.idle.towards":Er("towards",3),"head.idle.towardsRight":Er("towardsRight",2),"head.idle.towardsLeft":Er("towardsLeft",2),"head.idle.awayRight":Er("awayRight",2),"head.fadeOut":fe(["bubbles.head.1","bubbles.head.2","bubbles.head.4","bubbles.head.3","bubbles.head.4","bubbles.head.6","bubbles.head.5","bubbles.head.6","bubbles.head.5"],.5),"heels.fadeOut":fe(["bubbles.heels.1","bubbles.heels.2","bubbles.heels.4","bubbles.heels.3","bubbles.heels.4","bubbles.heels.6","bubbles.heels.5","bubbles.heels.6","bubbles.heels.5"],.5)}},tu={jail:{walls:["bars"]},blacktooth:{walls:["armour","shield","plain"]},bookworld:{walls:["cowboy","book"]},egyptus:{walls:["sarcophagus","hieroglyphics"]},market:{walls:["passage","fruits","more-fruits"]},moonbase:{walls:["window1","window2","window3","coil"]},penitentiary:{walls:["loop","skeleton"]},safari:{walls:["window","shield","wall"]}},H0=Object.keys(tu),Ce=(t,e,r,s)=>{function*n(i,a,o){const{walls:l}=tu[i],{w:c,h}=pt,u=c>>1,f=l.length;let d=0;for(;d<l.length;d++)yield[`${i}${s}.wall.${l[d]}.left`,{frame:{x:a+c*d,y:o-u*d,...pt}}],yield[`${i}${s}.wall.${l[d]}.away`,{frame:{x:a+c*((f<<1)-d-1),y:o-u*d,...pt}}];const g=d-1;yield[`${i}${s}.floor`,{frame:{x:a+g*c,y:o-g*u+h,...Nr}}]}return Object.fromEntries(n(t,e,r))},Fl={w:16,h:13},Ol={w:8,h:9},Bx={...Ce("blacktooth",542,104,".dark"),...Ce("blacktooth",542,29,""),...Ce("bookworld",408,29,".dark"),...Ce("bookworld",408,29,""),...Ce("egyptus",475,29,""),...Ce("egyptus",475,104,".dark"),...Ce("jail",440,104,".dark"),...Ce("jail",440,104,""),...Ce("market",443,356,".dark"),...Ce("market",443,356,""),...Ce("moonbase",453,276,".dark"),...Ce("moonbase",453,204,""),...Ce("penitentiary",376,357,".dark"),...Ce("penitentiary",376,357,""),...Ce("safari",542,357,".dark"),...Ce("safari",542,357,""),"floorEdge.right":{frame:{x:418,y:466,...Fl,pivot:{x:0,y:4}}},"floorEdge.towards":{frame:{x:401,y:466,...Fl,pivot:{x:15,y:4}}},"floorEdge.half.right":{frame:{x:418,y:470,...Ol,pivot:{x:0,y:0}}},"floorEdge.half.towards":{frame:{x:401,y:466,...Ol,pivot:{x:7,y:0}}},"floorOverdraw.cornerNearWall":{frame:{x:435,y:452,w:pt.w,h:Nr.h*2}},"floorOverdraw.behindDoor":{frame:{x:452,y:452,w:pt.w,h:Nr.h*2}},"shadow.wall.y":{frame:{x:432,y:435,w:36,h:16}},"generic.floor.deadly":{frame:{x:407,y:143,...Nr}},"generic.dark.floor.deadly":{frame:{x:407,y:160,...Nr}},"generic.door.legs.pillar":{frame:{x:524,y:476,w:pt.w,h:12}},"generic.door.legs.base":{frame:{x:524,y:488,w:pt.w,h:9}},"generic.door.legs.threshold.double.x":{frame:{x:508,y:452,w:pt.w*2,h:24}},"generic.door.legs.threshold.double.y":{frame:{x:469,y:452,w:pt.w*2,h:24}},"shadowMask.door.legs.threshold.double.y":{frame:{x:469,y:430,w:pt.w*2,h:21,pivot:{x:0,y:21}}},"generic.door.floatingThreshold.x":{frame:{x:496,y:477,w:26,h:19,pivot:{x:18,y:12}}},"generic.door.floatingThreshold.y":{frame:{x:469,y:477,w:26,h:19,pivot:{x:8,y:12}}},"shadowMask.door.floatingThreshold.double.y":{frame:{x:541,y:480,w:42,h:21,pivot:{x:24,y:28}}},"shadow.door.floatingThreshold.double.y":{frame:{x:584,y:480,w:42,h:21,pivot:{x:8,y:20}}}},zx={frames:Bx},W0=Object.entries,ru=wx,ha=Object.keys,Fx=Object.fromEntries,Us=Object.fromEntries,Ox=(t,e)=>{const s=Jt(ru(t)).map(e);return Fx(s)},Nx={" ":"space","'":"singleQuote",":":"colon","<":"lt",">":"gt","`":"backtick"},su=t=>Nx[t]??t,Lx=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9"],Gx=[" ","?","!",".",",",";",":","/","\\","","","'","`","-","+","%","","","","","","","","","(",")","[","]","<",">","","","","EnterFullscreen","ExitFullscreen","Menu","*"],Nl=(t,e)=>{function*r(){for(let s=0;s<t.length;s++){const n=t[s];yield[`hud.char.${su(n)}`,{frame:{x:e.x+s*(Vt.w+1),y:e.y,...Vt}}]}}return Us(r())},Dx={frames:{...Nl(Lx,{x:151,y:2}),...Nl(Gx,{x:151,y:11}),"hud.fastSteps":{frame:{x:475,y:2,...Vt}},"hud.shield":{frame:{x:484,y:2,...Vt}},"hud.bigJumps":{frame:{x:493,y:2,...Vt}},"hud.char.":{frame:{x:502,y:2,...Vt}}}},ir=(t,e,r)=>{const s=({x:i,y:a,w:o,h:l,pivot:c})=>e==="x"?{...Wr(r,{x:-i-o-1,y:a}),w:o,h:l,pivot:{x:o-c.x,y:c.y}}:{...Wr(r,{x:i+2,y:a}),w:o,h:l,pivot:c};function*n(){yield[`door.frame.${t}.${e}.far`,{frame:{...s({x:-18,y:0,w:17,h:57,pivot:{x:9,y:52}})}}],yield[`door.frame.${t}.${e}.near`,{frame:{...s({x:-41,y:6,w:20,h:58,pivot:{x:8,y:58}})}}],yield[`door.frame.${t}.${e}.top`,{frame:{...s({x:-57,y:-1,w:15,h:36,pivot:{x:0,y:36.5}})}}]}return Us(n())},$x={frames:{...ir("generic","y",{x:580,y:415}),...ir("generic","x",{x:582,y:415}),...ir("moonbase","y",{x:451,y:204}),...ir("moonbase","x",{x:582,y:204}),...ir("moonbase.dark","y",{x:451,y:276}),...ir("moonbase.dark","x",{x:582,y:276})}},Hx={...se("dalek",2,O({x:0,y:0}),F),"shadowMask.dalek":{frame:{...O({x:2,y:0}),...F}},...se("bubbles.cold",2,O({x:3,y:0}),F),homingBot:{frame:{...O({x:5,y:0}),...F}},ball:{frame:{...O({x:0,y:1}),...F}},...Ot("cyberman",O({x:1,y:1}),F),...Ot("charles",O({x:4,y:1}),F),...Ot("elephant",O({x:6,y:1}),F),"crown.blacktooth":{frame:{...O({x:8,y:1}),...F}},"crown.safari":{frame:{...O({x:9,y:1}),...F}},"crown.egyptus":{frame:{...O({x:10,y:1}),...F}},"crown.penitentiary":{frame:{...O({x:11,y:1}),...F}},"crown.bookworld":{frame:{...O({x:12,y:1}),...F}},"crown.dark":{frame:{...O({x:13,y:1}),...F}},sticks:{frame:{...O({x:8,y:2}),...F}},cube:{frame:{...O({x:9,y:2}),...F}},drum:{frame:{...O({x:10,y:2}),...F}},hooter:{frame:{...O({x:11,y:2}),...F}},bag:{frame:{...O({x:12,y:2}),...F}},joystick:{frame:{...O({x:13,y:2}),...F}},"shadowMask.joystick":{frame:{...O({x:14,y:2}),...F}},...Ex("turtle",2,O({x:0,y:3}),F),...Ot("monkey",O({x:4,y:3}),F),...Ot("computerBot",O({x:6,y:3}),F),"spring.compressed":{frame:{...O({x:8,y:3}),...F}},"spring.released":{frame:{...O({x:9,y:3}),...F}},"switch.left":{frame:{...O({x:10,y:3}),...F}},"switch.right":{frame:{...O({x:11,y:3}),...F}},"shadowMask.switch":{frame:{...O({x:12,y:3}),...F}},tower:{frame:{...O({x:13,y:3}),...F}},"shadowMask.tower":{frame:{...O({x:14,y:3}),...F}},scroll:{frame:{...O({x:8,y:4}),...F,pivot:{x:17,y:24}}},"shadow.scroll":{frame:{...O({x:9,y:4}),...F,pivot:{x:17,y:24}}},"shadowMask.scroll":{frame:{...O({x:10,y:4}),...F,pivot:{x:17,y:24}}},puck:{frame:{...O({x:11,y:4}),...F}},"puck.deadly":{frame:{...O({x:12,y:4}),...F}},"shadow.smallRound":{frame:{...O({x:13,y:4}),...F}},"shadowMask.smallRound":{frame:{...O({x:14,y:4}),...F}},...se("helicopterBug",4,O({x:0,y:5}),F),"barrier.x":{frame:{...O({x:4,y:5}),...F,pivot:{x:18,y:23}}},"barrier.y":{frame:{...O({x:5,y:5}),...F,pivot:{x:6,y:23}}},"shadow.barrier.y":{frame:{...O({x:6,y:5}),...F,pivot:{x:6,y:22}}},"shadowMask.barrier.y":{frame:{...O({x:7,y:5}),...F,pivot:{x:6,y:22}}},doughnuts:{frame:{...O({x:8,y:5}),...F}},...se("bubbles.taupe",3,O({x:9,y:5}),F),whiteRabbit:{frame:{...O({x:12,y:5}),...F}},...se("bubbles.white",3,O({x:13,y:5}),F),...se("fish",2,O({x:12,y:6}),F),blank:{frame:{...O({x:14,y:6}),...F}},...se("lift",4,O({x:7,y:7}),F),"lift.static":{frame:{...O({x:11,y:7}),...F}},"shadow.smallBlock":{frame:{...O({x:12,y:7}),...F}},"shadowMask.smallBlock":{frame:{...O({x:13,y:7}),...F}},...Ot("skiHead.greenAndPink",{x:1,y:327},{w:24,h:32}),...Ot("skiHead.starsAndStripes",{x:51,y:327},{w:24,h:32}),"block.organic":{frame:{...oe({x:0,y:0}),...ne}},"block.organic.disappearing":{frame:{...oe({x:1,y:0}),...ne}},"block.organic.dark":{frame:{...oe({x:2,y:0}),...ne}},"block.organic.dark.disappearing":{frame:{...oe({x:3,y:0}),...ne}},"block.artificial":{frame:{...oe({x:4,y:0}),...ne}},"block.artificial.disappearing":{frame:{...oe({x:5,y:0}),...ne}},"book.x":{frame:{...oe({x:6,y:0}),...ne}},"book.y":{frame:{...oe({x:7,y:0}),...ne}},"shadow.fullBlock":{frame:{...oe({x:8,y:0}),...ne}},"shadowMask.fullBlock":{frame:{...oe({x:9,y:0}),...ne}},stepStool:{frame:{...oe({x:0,y:1}),...ne}},"shadowMask.stepStool":{frame:{...oe({x:1,y:1}),...ne}},volcano:{frame:{...oe({x:2,y:1}),...ne}},"shadowMask.volcano":{frame:{...oe({x:3,y:1}),...ne}},hushPuppy:{frame:{...oe({x:4,y:1}),...ne}},"shadowMask.hushPuppy":{frame:{...oe({x:5,y:1}),...ne}},toaster:{frame:{...oe({x:6,y:1}),...ne}},sandwich:{frame:{...oe({x:7,y:1}),...ne}},spikes:{frame:{...oe({x:8,y:1}),...ne}},"shadowMask.spikes":{frame:{...oe({x:9,y:1}),...ne}},...se("conveyor.x",7,oe({x:0,y:2}),ne),"shadowMask.conveyor":{frame:{...oe({x:7,y:2}),...ne}},button:{frame:{...oe({x:9,y:2}),...ne}},"button.pressed":{frame:{...oe({x:10,y:2}),...ne}},"button.surfaceMask":{frame:{...oe({x:11,y:2}),...ne}},...se("conveyor.y",7,oe({x:0,y:3}),ne),teleporter:{frame:{...oe({x:7,y:3}),...ne}},...se("teleporter.flashing",2,oe({x:8,y:3}),ne),"shadowMask.teleporter":{frame:{...oe({x:10,y:3}),...ne}}},nu={frames:Hx,animations:{"teleporter.flashing":fe(["teleporter.flashing.1","teleporter.flashing.2"],.5),fish:fe(["fish.1","fish.2"],.25),lift:fe(["lift.1","lift.2","lift.3","lift.4"],.5),dalek:fe(["dalek.1","dalek.2"],.5),"turtle.left":fe(["turtle.left.1","turtle.left.2"],.25),"turtle.away":fe(["turtle.away.1","turtle.away.2"],.25),"turtle.towards":fe(["turtle.towards.1","turtle.towards.2"],.25),"turtle.right":fe(["turtle.right.1","turtle.right.2"],.25),helicopterBug:fe(["helicopterBug.1","helicopterBug.2","helicopterBug.3","helicopterBug.4"],.5),"bubbles.cold":fe(["bubbles.cold.1","bubbles.cold.2"],.25),"bubbles.white":fe(["bubbles.white.1","bubbles.white.2","bubbles.white.3"],.5),"bubbles.doughnut":fe(["bubbles.taupe.1","bubbles.taupe.2"],.5),"conveyor.x":fe(Bl("conveyor.x",7),.5),"conveyor.y":fe(Bl("conveyor.y",7),.5),"spring.bounce":fe(["spring.released","spring.compressed","spring.released","spring.compressed","spring.released"],.5),switch:fe(["switch.left","switch.right"],.02)}},Wx={...nu.frames,...eu.frames,...zx.frames,...Dx.frames,...$x.frames},qt={frames:Wx,animations:{...eu.animations,...nu.animations},meta:{scale:1}};let ji;try{ji=await Or.load(Lg)}catch{ji=J.EMPTY}const Yt=new vi(ji,qt),iu=async()=>(await Yt.parse(),Yt.textureSource.scaleMode="nearest",Yt),Ux=Object.freeze(Object.defineProperty({__proto__:null,load:iu,spriteSheet:Yt},Symbol.toStringTag,{value:"Module"})),Vx=()=>{const[t,e]=L.useState(!1);if(L.useEffect(()=>{(async()=>{await iu(),e(!0)})()}),!t)return null;const r=Object.keys(Yt.textures).sort();return p.jsxs("div",{className:"flex flex-wrap p-[8px] bg-pureBlack",children:[p.jsx("title",{children:"Sprites"}),r.map(s=>{const{frame:n}=Yt.data.frames[s];return p.jsxs("div",{className:"bg-shadow m-[8px] p-[16px]",children:[p.jsx("div",{className:"sprite bg-shadow hover:bg-pink hover:border-white border-shadow border border-4 mb-1 box-content",style:{"--x":`${qt.frames[s].frame.x}px`,"--y":`${qt.frames[s].frame.y}px`,"--h":`${qt.frames[s].frame.h}px`,"--w":`${qt.frames[s].frame.w}px`}}),p.jsx("div",{className:"text-moss",children:s}),p.jsxs("div",{className:"text-lightGrey",children:[n.w,"x",n.h]}),p.jsxs("div",{className:"text-midGrey",children:["(",n.x,",",n.y,")"]})]},s)})]})};var ii={exports:{}},ai={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ll;function qx(){if(Ll)return ai;Ll=1;var t=wr();function e(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var r=typeof Object.is=="function"?Object.is:e,s=t.useSyncExternalStore,n=t.useRef,i=t.useEffect,a=t.useMemo,o=t.useDebugValue;return ai.useSyncExternalStoreWithSelector=function(l,c,h,u,f){var d=n(null);if(d.current===null){var g={hasValue:!1,value:null};d.current=g}else g=d.current;d=a(function(){function m(E){if(!w){if(w=!0,b=E,E=u(E),f!==void 0&&g.hasValue){var I=g.value;if(f(I,E))return A=I}return A=E}if(I=A,r(b,E))return I;var T=u(E);return f!==void 0&&f(I,T)?(b=E,I):(b=E,A=T)}var w=!1,b,A,P=h===void 0?null:h;return[function(){return m(c())},P===null?void 0:function(){return m(P())}]},[c,h,u,f]);var x=s(l,d[0],d[1]);return i(function(){g.hasValue=!0,g.value=x},[x]),o(x),x},ai}var Gl;function Yx(){return Gl||(Gl=1,ii.exports=qx()),ii.exports}var Xx=Yx();function Kx(t){t()}function Zx(){let t=null,e=null;return{clear(){t=null,e=null},notify(){Kx(()=>{let r=t;for(;r;)r.callback(),r=r.next})},get(){const r=[];let s=t;for(;s;)r.push(s),s=s.next;return r},subscribe(r){let s=!0;const n=e={callback:r,next:null,prev:e};return n.prev?n.prev.next=n:t=n,function(){!s||t===null||(s=!1,n.next?n.next.prev=n.prev:e=n.prev,n.prev?n.prev.next=n.next:t=n.next)}}}}var Dl={notify(){},get:()=>[]};function Qx(t,e){let r,s=Dl,n=0,i=!1;function a(x){h();const m=s.subscribe(x);let w=!1;return()=>{w||(w=!0,m(),u())}}function o(){s.notify()}function l(){g.onStateChange&&g.onStateChange()}function c(){return i}function h(){n++,r||(r=t.subscribe(l),s=Zx())}function u(){n--,r&&n===0&&(r(),r=void 0,s.clear(),s=Dl)}function f(){i||(i=!0,h())}function d(){i&&(i=!1,u())}const g={addNestedSub:a,notifyNestedSubs:o,handleChangeWrapper:l,isSubscribed:c,trySubscribe:f,tryUnsubscribe:d,getListeners:()=>s};return g}var Jx=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ey=Jx(),ty=()=>typeof navigator<"u"&&navigator.product==="ReactNative",ry=ty(),sy=()=>ey||ry?L.useLayoutEffect:L.useEffect,ny=sy(),iy=Symbol.for("react-redux-context"),ay=typeof globalThis<"u"?globalThis:{};function oy(){if(!L.createContext)return{};const t=ay[iy]??=new Map;let e=t.get(L.createContext);return e||(e=L.createContext(null),t.set(L.createContext,e)),e}var Bt=oy();function ly(t){const{children:e,context:r,serverState:s,store:n}=t,i=L.useMemo(()=>{const l=Qx(n);return{store:n,subscription:l,getServerState:s?()=>s:void 0}},[n,s]),a=L.useMemo(()=>n.getState(),[n]);ny(()=>{const{subscription:l}=i;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),a!==n.getState()&&l.notifyNestedSubs(),()=>{l.tryUnsubscribe(),l.onStateChange=void 0}},[i,a]);const o=r||Bt;return L.createElement(o.Provider,{value:i},e)}var cy=ly;function ua(t=Bt){return function(){return L.useContext(t)}}var au=ua();function ou(t=Bt){const e=t===Bt?au:ua(t),r=()=>{const{store:s}=e();return s};return Object.assign(r,{withTypes:()=>r}),r}var lu=ou();function hy(t=Bt){const e=t===Bt?lu:ou(t),r=()=>e().dispatch;return Object.assign(r,{withTypes:()=>r}),r}var uy=hy(),dy=(t,e)=>t===e;function fy(t=Bt){const e=t===Bt?au:ua(t),r=(s,n={})=>{const{equalityFn:i=dy}=typeof n=="function"?{equalityFn:n}:n,a=e(),{store:o,subscription:l,getServerState:c}=a;L.useRef(!0);const h=L.useCallback({[s.name](f){return s(f)}}[s.name],[s]),u=Xx.useSyncExternalStoreWithSelector(l.addNestedSub,o.getState,c||o.getState,h,i);return L.useDebugValue(u),u};return Object.assign(r,{withTypes:()=>r}),r}var py=fy(),oi,$l;function my(){if($l)return oi;$l=1;function t(s){if(Array.isArray(s))return!0;var n=s.length;return typeof n=="number"&&n>-1?n?0 in s&&n-1 in s:!0:!1}function e(s){var n=typeof s;return n==="object"?s===null?"null":t(s)?"array":s.constructor===Object?"pure-object":"object":n}function r(s,n){if(s===n||s!==s&&n!==n)return!0;var i=e(s),a=e(n);if(i!==a)return!1;if(i==="pure-object"){if(s===n)return!0;var o=Object.keys(s),l=Object.keys(n).length;if(o.length!==l)return!1;for(var c=0,h=o.length;c<h;c++){var u=o[c];if(!n.hasOwnProperty(o[c]))return!1;var f=s[u],d=n[u];if(f===s||d===n||f===n||d===s)return f===d;if(!r(f,d))return!1}return!0}else if(i==="array"){if(s.length===n.length)for(var g=0;g<s.length;g++){var x=s[g],m=n[g];if(x===s||m===n||x===n||m===s)return x===m;if(!r(x,m))return!1}else return!1;return!0}else if(i==="object"){if(s.valueOf!==Object.prototype.valueOf()&&n.valueOf!==Object.prototype.valueOf())return s.valueOf()===n.valueOf();if(s.toString!==Object.prototype.toString()&&n.toString!==Object.prototype.toString())return s.toString()===n.toString()}return!1}return oi=r,oi}var gy=my();const xy=rt(gy),cu=uy.withTypes(),le=py.withTypes();lu.withTypes();const _e={dPadDown:13,dPadUp:12,dPadLeft:14,dPadRight:15,a:0,b:1,x:2,y:3,lb:4,lt:6,rb:5,rt:7,select:8,start:9,l3:10,r3:11},Hl=Ox(_e,([t,e])=>[e,t]),yy={start:"1",coin:"5",directions:{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},buttons:["Control","Alt"," ","Shift","Z","X"]},by={start:"2",coin:"6",directions:{up:"R",down:"F",left:"D",right:"G"},buttons:["A","S","Q","W","I","K"]},qe={dPadUp:"C",dPadDown:"D",dPadLeft:"E",dPadRight:"F",a:"J",b:"G",y:"H",x:"I",rb:"M",start:"O",select:"N"},hu=["jump","fire","carry","swop","swop.head","swop.heels","hold","toggleColourisation","cycleResolution","toggleShowFps","menu_select","menu_openOrExit","menu_exit",...es],uu=[...hu,...es],Ms={presses:Us(uu.map(t=>[t,{keys:[],gamepadAxes:[],gamepadButtons:[]}])),axes:{x:[],y:[]}},Wl=(t,e)=>Array.from(new Set([...t??[],...e??[]]));function rr(...t){return{presses:t.reduce((e,r)=>{for(const s of uu)e[s]={keys:Wl(e[s]?.keys,r?.presses?.[s]?.keys),gamepadButtons:Wl(e[s]?.gamepadButtons,r?.presses?.[s]?.gamepadButtons)};return e},structuredClone(Ms.presses)),axes:{x:Array.from(new Set([...Ms.axes.x,...t.map(e=>e.axes?.x??[]).flat()])),y:Array.from(new Set([...Ms.axes.y,...t.map(e=>e.axes?.y??[]).flat()]))}}}const sr={presses:{right:{keys:["ArrowRight"],gamepadButtons:[]},towards:{keys:["ArrowDown"]},left:{keys:["ArrowLeft"]},away:{keys:["ArrowUp"]},menu_openOrExit:{keys:["Escape","Tab",""]},menu_exit:{gamepadButtons:[_e.b]},menu_select:{keys:["Enter"],gamepadButtons:[_e.a]},toggleColourisation:{keys:["F10"]},toggleShowFps:{keys:["F9"]},cycleResolution:{keys:["0"]}}},Ar={inputAssignment:rr(sr,{presses:{right:{gamepadButtons:[_e.dPadRight]},towards:{gamepadButtons:[_e.dPadDown]},left:{gamepadButtons:[_e.dPadLeft]},away:{gamepadButtons:[_e.dPadUp]},jump:{gamepadButtons:[_e.a,_e.y]},carry:{gamepadButtons:[_e.x,_e.y]},fire:{gamepadButtons:[_e.b]},swop:{gamepadButtons:[_e.rb]},"swop.head":{gamepadButtons:[_e.l3]},"swop.heels":{gamepadButtons:[_e.r3]},hold:{gamepadButtons:[_e.start]},menu_openOrExit:{gamepadButtons:[_e.select]},toggleColourisation:{gamepadButtons:[_e.lt]}},axes:{x:[0],y:[1]}}),description:"Joysticks/gamepads with at least 4 buttons, but preferably 6 or more. Inc Playstation, xbox etc"},wy={inputAssignment:rr(sr,Ar.inputAssignment,{presses:{right:{keys:["P","7"]},towards:{keys:["A","8"]},left:{keys:["O","6"]},away:{keys:["Q","9"]},jump:{keys:[" ","M","N","B","Alt"]},carry:{keys:[" ","Enter","L","K","J"]},fire:{keys:["Shift","Z","X","C","V"]},swop:{keys:["S","D","F","G"]},hold:{keys:["H"]}}}),description:"closely matches zx spectrum keys"},_y={inputAssignment:rr(sr,Ar.inputAssignment,{presses:{carry:{keys:["F3","F5"]},fire:{keys:[" "]},jump:{keys:["F5"]},swop:{keys:["F1"]},hold:{keys:["H"]}}}),description:"closely matches Amiga version keys - heavy on the F-keys"},vy={inputAssignment:rr(sr,Ar.inputAssignment,{presses:{right:{keys:["P","Numpad6"]},towards:{keys:["A","Numpad5"]},left:{keys:["O","Numpad8"]},away:{keys:["Q","Numpad9"]},jump:{keys:[" ","`","\\","Numpad0","Numpad-"]},carry:{keys:["Shift","`","\\","Numpad1","Numpad-"]},fire:{keys:["D","NumpadEnter"]},swop:{keys:["Enter","S","Numpad+"]},"swop.head":{keys:["["]},"swop.heels":{keys:["]"]},hold:{keys:["F8","H","Numpad."]}}}),description:"Default combined key and joystick/gamepad assignment, should work on most setups"},Sy={inputAssignment:rr(sr,Ar.inputAssignment,{presses:{right:{keys:["D"]},towards:{keys:["S"]},left:{keys:["A"]},away:{keys:["W"]},jump:{keys:[" ","F","P"]},carry:{keys:["Shift","F","I","P"]},fire:{keys:["E","O","Control"]},swop:{keys:["Q"]},hold:{keys:["H"]}}}),description:"Modern, minimalist WASD key layout"},Ay={inputAssignment:rr(sr,Ar.inputAssignment,{presses:{right:{keys:[qe.dPadRight]},towards:{keys:[qe.dPadDown]},left:{keys:[qe.dPadLeft]},away:{keys:[qe.dPadUp]},jump:{keys:[qe.a,qe.y]},carry:{keys:[qe.b,qe.y]},fire:{keys:[qe.x]},swop:{keys:[qe.rb]},hold:{keys:[qe.start]},menu_openOrExit:{keys:[qe.select]}}}),description:"8bitdo controllers in keyboard mode (identifies to OS as a keyboard). They work as controllers even on phones that dont support controllers"},Ul=t=>({presses:{right:{keys:[t.directions.right]},towards:{keys:[t.directions.down]},left:{keys:[t.directions.left]},away:{keys:[t.directions.up]},jump:{keys:[t.buttons[0],t.buttons[3]]},carry:{keys:[t.buttons[1],t.buttons[3]]},fire:{keys:[t.buttons[2]]},swop:{keys:[t.start]},hold:{keys:[t.coin]},menu_openOrExit:{keys:[t.buttons[2]]}}}),ky={inputAssignment:rr(Ms,sr,{presses:{menu_openOrExit:{keys:["`","Tab"]}}},Ul(yy),Ul(by)),description:"MAME key mappings. For arcade-style control panels"},xr={default:vy,"zx spectrum":wy,amiga:_y,mame:ky,wasd:Sy," 8bitdo keyboard mode":Ay," joystick":Ar};function Se(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var Cy=typeof Symbol=="function"&&Symbol.observable||"@@observable",Vl=Cy,li=()=>Math.random().toString(36).substring(7).split("").join("."),Py={INIT:`@@redux/INIT${li()}`,REPLACE:`@@redux/REPLACE${li()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${li()}`},Bs=Py;function da(t){if(typeof t!="object"||t===null)return!1;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e||Object.getPrototypeOf(t)===null}function fa(t,e,r){if(typeof t!="function")throw new Error(Se(2));if(typeof e=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(Se(0));if(typeof e=="function"&&typeof r>"u"&&(r=e,e=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(Se(1));return r(fa)(t,e)}let s=t,n=e,i=new Map,a=i,o=0,l=!1;function c(){a===i&&(a=new Map,i.forEach((m,w)=>{a.set(w,m)}))}function h(){if(l)throw new Error(Se(3));return n}function u(m){if(typeof m!="function")throw new Error(Se(4));if(l)throw new Error(Se(5));let w=!0;c();const b=o++;return a.set(b,m),function(){if(w){if(l)throw new Error(Se(6));w=!1,c(),a.delete(b),i=null}}}function f(m){if(!da(m))throw new Error(Se(7));if(typeof m.type>"u")throw new Error(Se(8));if(typeof m.type!="string")throw new Error(Se(17));if(l)throw new Error(Se(9));try{l=!0,n=s(n,m)}finally{l=!1}return(i=a).forEach(b=>{b()}),m}function d(m){if(typeof m!="function")throw new Error(Se(10));s=m,f({type:Bs.REPLACE})}function g(){const m=u;return{subscribe(w){if(typeof w!="object"||w===null)throw new Error(Se(11));function b(){const P=w;P.next&&P.next(h())}return b(),{unsubscribe:m(b)}},[Vl](){return this}}}return f({type:Bs.INIT}),{dispatch:f,subscribe:u,getState:h,replaceReducer:d,[Vl]:g}}function My(t){Object.keys(t).forEach(e=>{const r=t[e];if(typeof r(void 0,{type:Bs.INIT})>"u")throw new Error(Se(12));if(typeof r(void 0,{type:Bs.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Se(13))})}function Iy(t){const e=Object.keys(t),r={};for(let i=0;i<e.length;i++){const a=e[i];typeof t[a]=="function"&&(r[a]=t[a])}const s=Object.keys(r);let n;try{My(r)}catch(i){n=i}return function(a={},o){if(n)throw n;let l=!1;const c={};for(let h=0;h<s.length;h++){const u=s[h],f=r[u],d=a[u],g=f(d,o);if(typeof g>"u")throw o&&o.type,new Error(Se(14));c[u]=g,l=l||g!==d}return l=l||s.length!==Object.keys(a).length,l?c:a}}function zs(...t){return t.length===0?e=>e:t.length===1?t[0]:t.reduce((e,r)=>(...s)=>e(r(...s)))}function Ty(...t){return e=>(r,s)=>{const n=e(r,s);let i=()=>{throw new Error(Se(15))};const a={getState:n.getState,dispatch:(l,...c)=>i(l,...c)},o=t.map(l=>l(a));return i=zs(...o)(n.dispatch),{...n,dispatch:i}}}function Ey(t){return da(t)&&"type"in t&&typeof t.type=="string"}var du=Symbol.for("immer-nothing"),ql=Symbol.for("immer-draftable"),We=Symbol.for("immer-state");function at(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var yr=Object.getPrototypeOf;function Kt(t){return!!t&&!!t[We]}function It(t){return t?fu(t)||Array.isArray(t)||!!t[ql]||!!t.constructor?.[ql]||qs(t)||Ys(t):!1}var Ry=Object.prototype.constructor.toString();function fu(t){if(!t||typeof t!="object")return!1;const e=yr(t);if(e===null)return!0;const r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Ry}function Fs(t,e){Vs(t)===0?Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)}):t.forEach((r,s)=>e(s,r,t))}function Vs(t){const e=t[We];return e?e.type_:Array.isArray(t)?1:qs(t)?2:Ys(t)?3:0}function Bi(t,e){return Vs(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function pu(t,e,r){const s=Vs(t);s===2?t.set(e,r):s===3?t.add(r):t[e]=r}function jy(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function qs(t){return t instanceof Map}function Ys(t){return t instanceof Set}function Ht(t){return t.copy_||t.base_}function zi(t,e){if(qs(t))return new Map(t);if(Ys(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const r=fu(t);if(e===!0||e==="class_only"&&!r){const s=Object.getOwnPropertyDescriptors(t);delete s[We];let n=Reflect.ownKeys(s);for(let i=0;i<n.length;i++){const a=n[i],o=s[a];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(s[a]={configurable:!0,writable:!0,enumerable:o.enumerable,value:t[a]})}return Object.create(yr(t),s)}else{const s=yr(t);if(s!==null&&r)return{...t};const n=Object.create(s);return Object.assign(n,t)}}function pa(t,e=!1){return Xs(t)||Kt(t)||!It(t)||(Vs(t)>1&&(t.set=t.add=t.clear=t.delete=By),Object.freeze(t),e&&Object.entries(t).forEach(([r,s])=>pa(s,!0))),t}function By(){at(2)}function Xs(t){return Object.isFrozen(t)}var zy={};function Zt(t){const e=zy[t];return e||at(0,t),e}var Xr;function mu(){return Xr}function Fy(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Yl(t,e){e&&(Zt("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function Fi(t){Oi(t),t.drafts_.forEach(Oy),t.drafts_=null}function Oi(t){t===Xr&&(Xr=t.parent_)}function Xl(t){return Xr=Fy(Xr,t)}function Oy(t){const e=t[We];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Kl(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];return t!==void 0&&t!==r?(r[We].modified_&&(Fi(e),at(4)),It(t)&&(t=Os(e,t),e.parent_||Ns(e,t)),e.patches_&&Zt("Patches").generateReplacementPatches_(r[We].base_,t,e.patches_,e.inversePatches_)):t=Os(e,r,[]),Fi(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==du?t:void 0}function Os(t,e,r){if(Xs(e))return e;const s=e[We];if(!s)return Fs(e,(n,i)=>Zl(t,s,e,n,i,r)),e;if(s.scope_!==t)return e;if(!s.modified_)return Ns(t,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;const n=s.copy_;let i=n,a=!1;s.type_===3&&(i=new Set(n),n.clear(),a=!0),Fs(i,(o,l)=>Zl(t,s,n,o,l,r,a)),Ns(t,n,!1),r&&t.patches_&&Zt("Patches").generatePatches_(s,r,t.patches_,t.inversePatches_)}return s.copy_}function Zl(t,e,r,s,n,i,a){if(Kt(n)){const o=i&&e&&e.type_!==3&&!Bi(e.assigned_,s)?i.concat(s):void 0,l=Os(t,n,o);if(pu(r,s,l),Kt(l))t.canAutoFreeze_=!1;else return}else a&&r.add(n);if(It(n)&&!Xs(n)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;Os(t,n),(!e||!e.scope_.parent_)&&typeof s!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,s)&&Ns(t,n)}}function Ns(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&pa(e,r)}function Ny(t,e){const r=Array.isArray(t),s={type_:r?1:0,scope_:e?e.scope_:mu(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let n=s,i=ma;r&&(n=[s],i=Kr);const{revoke:a,proxy:o}=Proxy.revocable(n,i);return s.draft_=o,s.revoke_=a,o}var ma={get(t,e){if(e===We)return t;const r=Ht(t);if(!Bi(r,e))return Ly(t,r,e);const s=r[e];return t.finalized_||!It(s)?s:s===ci(t.base_,e)?(hi(t),t.copy_[e]=Li(s,t)):s},has(t,e){return e in Ht(t)},ownKeys(t){return Reflect.ownKeys(Ht(t))},set(t,e,r){const s=gu(Ht(t),e);if(s?.set)return s.set.call(t.draft_,r),!0;if(!t.modified_){const n=ci(Ht(t),e),i=n?.[We];if(i&&i.base_===r)return t.copy_[e]=r,t.assigned_[e]=!1,!0;if(jy(r,n)&&(r!==void 0||Bi(t.base_,e)))return!0;hi(t),Ni(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_[e]=!0),!0},deleteProperty(t,e){return ci(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,hi(t),Ni(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=Ht(t),s=Reflect.getOwnPropertyDescriptor(r,e);return s&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:s.enumerable,value:r[e]}},defineProperty(){at(11)},getPrototypeOf(t){return yr(t.base_)},setPrototypeOf(){at(12)}},Kr={};Fs(ma,(t,e)=>{Kr[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});Kr.deleteProperty=function(t,e){return Kr.set.call(this,t,e,void 0)};Kr.set=function(t,e,r){return ma.set.call(this,t[0],e,r,t[0])};function ci(t,e){const r=t[We];return(r?Ht(r):t)[e]}function Ly(t,e,r){const s=gu(e,r);return s?"value"in s?s.value:s.get?.call(t.draft_):void 0}function gu(t,e){if(!(e in t))return;let r=yr(t);for(;r;){const s=Object.getOwnPropertyDescriptor(r,e);if(s)return s;r=yr(r)}}function Ni(t){t.modified_||(t.modified_=!0,t.parent_&&Ni(t.parent_))}function hi(t){t.copy_||(t.copy_=zi(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var Gy=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,r,s)=>{if(typeof e=="function"&&typeof r!="function"){const i=r;r=e;const a=this;return function(l=i,...c){return a.produce(l,h=>r.call(this,h,...c))}}typeof r!="function"&&at(6),s!==void 0&&typeof s!="function"&&at(7);let n;if(It(e)){const i=Xl(this),a=Li(e,void 0);let o=!0;try{n=r(a),o=!1}finally{o?Fi(i):Oi(i)}return Yl(i,s),Kl(n,i)}else if(!e||typeof e!="object"){if(n=r(e),n===void 0&&(n=e),n===du&&(n=void 0),this.autoFreeze_&&pa(n,!0),s){const i=[],a=[];Zt("Patches").generateReplacementPatches_(e,n,i,a),s(i,a)}return n}else at(1,e)},this.produceWithPatches=(e,r)=>{if(typeof e=="function")return(a,...o)=>this.produceWithPatches(a,l=>e(l,...o));let s,n;return[this.produce(e,r,(a,o)=>{s=a,n=o}),s,n]},typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof t?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){It(t)||at(8),Kt(t)&&(t=Dy(t));const e=Xl(this),r=Li(t,void 0);return r[We].isManual_=!0,Oi(e),r}finishDraft(t,e){const r=t&&t[We];(!r||!r.isManual_)&&at(9);const{scope_:s}=r;return Yl(s,e),Kl(void 0,s)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let r;for(r=e.length-1;r>=0;r--){const n=e[r];if(n.path.length===0&&n.op==="replace"){t=n.value;break}}r>-1&&(e=e.slice(r+1));const s=Zt("Patches").applyPatches_;return Kt(t)?s(t,e):this.produce(t,n=>s(n,e))}};function Li(t,e){const r=qs(t)?Zt("MapSet").proxyMap_(t,e):Ys(t)?Zt("MapSet").proxySet_(t,e):Ny(t,e);return(e?e.scope_:mu()).drafts_.push(r),r}function Dy(t){return Kt(t)||at(10,t),xu(t)}function xu(t){if(!It(t)||Xs(t))return t;const e=t[We];let r;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=zi(t,e.scope_.immer_.useStrictShallowCopy_)}else r=zi(t,!0);return Fs(r,(s,n)=>{pu(r,s,xu(n))}),e&&(e.finalized_=!1),r}var Ue=new Gy,yu=Ue.produce;Ue.produceWithPatches.bind(Ue);Ue.setAutoFreeze.bind(Ue);Ue.setUseStrictShallowCopy.bind(Ue);Ue.applyPatches.bind(Ue);Ue.createDraft.bind(Ue);Ue.finishDraft.bind(Ue);function bu(t){return({dispatch:r,getState:s})=>n=>i=>typeof i=="function"?i(r,s,t):n(i)}var $y=bu(),Hy=bu,Wy=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?zs:zs.apply(null,arguments)};function Ql(t,e){function r(...s){if(e){let n=e(...s);if(!n)throw new Error(Pt(0));return{type:t,payload:n.payload,..."meta"in n&&{meta:n.meta},..."error"in n&&{error:n.error}}}return{type:t,payload:s[0]}}return r.toString=()=>`${t}`,r.type=t,r.match=s=>Ey(s)&&s.type===t,r}var wu=class Lr extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Lr.prototype)}static get[Symbol.species](){return Lr}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new Lr(...e[0].concat(this)):new Lr(...e.concat(this))}};function Jl(t){return It(t)?yu(t,()=>{}):t}function ec(t,e,r){return t.has(e)?t.get(e):t.set(e,r(e)).get(e)}function Uy(t){return typeof t=="boolean"}var Vy=()=>function(e){const{thunk:r=!0,immutableCheck:s=!0,serializableCheck:n=!0,actionCreatorCheck:i=!0}=e??{};let a=new wu;return r&&(Uy(r)?a.push($y):a.push(Hy(r.extraArgument))),a},qy="RTK_autoBatch",tc=t=>e=>{setTimeout(e,t)},Yy=(t={type:"raf"})=>e=>(...r)=>{const s=e(...r);let n=!0,i=!1,a=!1;const o=new Set,l=t.type==="tick"?queueMicrotask:t.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:tc(10):t.type==="callback"?t.queueNotification:tc(t.timeout),c=()=>{a=!1,i&&(i=!1,o.forEach(h=>h()))};return Object.assign({},s,{subscribe(h){const u=()=>n&&h(),f=s.subscribe(u);return o.add(h),()=>{f(),o.delete(h)}},dispatch(h){try{return n=!h?.meta?.[qy],i=!n,i&&(a||(a=!0,l(c))),s.dispatch(h)}finally{n=!0}}})},Xy=t=>function(r){const{autoBatch:s=!0}=r??{};let n=new wu(t);return s&&n.push(Yy(typeof s=="object"?s:void 0)),n};function Ky(t){const e=Vy(),{reducer:r=void 0,middleware:s,devTools:n=!0,preloadedState:i=void 0,enhancers:a=void 0}=t||{};let o;if(typeof r=="function")o=r;else if(da(r))o=Iy(r);else throw new Error(Pt(1));let l;typeof s=="function"?l=s(e):l=e();let c=zs;n&&(c=Wy({trace:!1,...typeof n=="object"&&n}));const h=Ty(...l),u=Xy(h);let f=typeof a=="function"?a(u):u();const d=c(...f);return fa(o,i,d)}function _u(t){const e={},r=[];let s;const n={addCase(i,a){const o=typeof i=="string"?i:i.type;if(!o)throw new Error(Pt(28));if(o in e)throw new Error(Pt(29));return e[o]=a,n},addMatcher(i,a){return r.push({matcher:i,reducer:a}),n},addDefaultCase(i){return s=i,n}};return t(n),[e,r,s]}function Zy(t){return typeof t=="function"}function Qy(t,e){let[r,s,n]=_u(e),i;if(Zy(t))i=()=>Jl(t());else{const o=Jl(t);i=()=>o}function a(o=i(),l){let c=[r[l.type],...s.filter(({matcher:h})=>h(l)).map(({reducer:h})=>h)];return c.filter(h=>!!h).length===0&&(c=[n]),c.reduce((h,u)=>{if(u)if(Kt(h)){const d=u(h,l);return d===void 0?h:d}else{if(It(h))return yu(h,f=>u(f,l));{const f=u(h,l);if(f===void 0){if(h===null)return h;throw Error("A case reducer on a non-draftable value must not return undefined")}return f}}return h},o)}return a.getInitialState=i,a}var Jy=Symbol.for("rtk-slice-createasyncthunk");function eb(t,e){return`${t}/${e}`}function tb({creators:t}={}){const e=t?.asyncThunk?.[Jy];return function(s){const{name:n,reducerPath:i=n}=s;if(!n)throw new Error(Pt(11));const a=(typeof s.reducers=="function"?s.reducers(nb()):s.reducers)||{},o=Object.keys(a),l={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},c={addCase(b,A){const P=typeof b=="string"?b:b.type;if(!P)throw new Error(Pt(12));if(P in l.sliceCaseReducersByType)throw new Error(Pt(13));return l.sliceCaseReducersByType[P]=A,c},addMatcher(b,A){return l.sliceMatchers.push({matcher:b,reducer:A}),c},exposeAction(b,A){return l.actionCreators[b]=A,c},exposeCaseReducer(b,A){return l.sliceCaseReducersByName[b]=A,c}};o.forEach(b=>{const A=a[b],P={reducerName:b,type:eb(n,b),createNotation:typeof s.reducers=="function"};ab(A)?lb(P,A,c,e):ib(P,A,c)});function h(){const[b={},A=[],P=void 0]=typeof s.extraReducers=="function"?_u(s.extraReducers):[s.extraReducers],E={...b,...l.sliceCaseReducersByType};return Qy(s.initialState,I=>{for(let T in E)I.addCase(T,E[T]);for(let T of l.sliceMatchers)I.addMatcher(T.matcher,T.reducer);for(let T of A)I.addMatcher(T.matcher,T.reducer);P&&I.addDefaultCase(P)})}const u=b=>b,f=new Map;let d;function g(b,A){return d||(d=h()),d(b,A)}function x(){return d||(d=h()),d.getInitialState()}function m(b,A=!1){function P(I){let T=I[b];return typeof T>"u"&&A&&(T=x()),T}function E(I=u){const T=ec(f,A,()=>new WeakMap);return ec(T,I,()=>{const N={};for(const[z,j]of Object.entries(s.selectors??{}))N[z]=rb(j,I,x,A);return N})}return{reducerPath:b,getSelectors:E,get selectors(){return E(P)},selectSlice:P}}const w={name:n,reducer:g,actions:l.actionCreators,caseReducers:l.sliceCaseReducersByName,getInitialState:x,...m(i),injectInto(b,{reducerPath:A,...P}={}){const E=A??i;return b.inject({reducerPath:E,reducer:g},P),{...w,...m(E,!0)}}};return w}}function rb(t,e,r,s){function n(i,...a){let o=e(i);return typeof o>"u"&&s&&(o=r()),t(o,...a)}return n.unwrapped=t,n}var sb=tb();function nb(){function t(e,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...r}}return t.withTypes=()=>t,{reducer(e){return Object.assign({[e.name](...r){return e(...r)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:r}},asyncThunk:t}}function ib({type:t,reducerName:e,createNotation:r},s,n){let i,a;if("reducer"in s){if(r&&!ob(s))throw new Error(Pt(17));i=s.reducer,a=s.prepare}else i=s;n.addCase(t,i).exposeCaseReducer(e,i).exposeAction(e,a?Ql(t,a):Ql(t))}function ab(t){return t._reducerDefinitionType==="asyncThunk"}function ob(t){return t._reducerDefinitionType==="reducerWithPrepare"}function lb({type:t,reducerName:e},r,s,n){if(!n)throw new Error(Pt(18));const{payloadCreator:i,fulfilled:a,pending:o,rejected:l,settled:c,options:h}=r,u=n(t,i,h);s.exposeAction(e,u),a&&s.addCase(u.fulfilled,a),o&&s.addCase(u.pending,o),l&&s.addCase(u.rejected,l),c&&s.addMatcher(u.settled,c),s.exposeCaseReducer(e,{fulfilled:a||ws,pending:o||ws,rejected:l||ws,settled:c||ws})}function ws(){}function Pt(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}const Mt=()=>He()==="mobile"||He()==="tablet",He=()=>{if(typeof globalThis.window>"u")return"server";const t=new URLSearchParams(window.location.search).get("device");if(t!==null)return t;const e=navigator.userAgent;return navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1||/iPad|Tablet|Android(?!.*Mobi)/i.test(e)?"tablet":/Mobi|Android|iPhone|iPod/i.test(e)?"mobile":"desktop"},cb=4,vu=(t,e,r)=>{const s=tr[e],n=Vh(t,r),i=Math.floor(Math.min(n.x/s.x,n.y/s.y)),a={x:Math.floor(n.x/i),y:Math.floor(n.y/i)},o=Math.min(cb,i),l=i/o/r,c={x:Math.ceil(t.x/l),y:Math.ceil(t.y/l)};return{gameEngineUpscale:o,cssUpscale:l,gameEngineScreenSize:a,canvasSize:c}},hb=()=>He()==="server"?tr.zxSpectrum:{x:window.innerWidth,y:window.innerHeight},Su=t=>{const e=He();return vu(hb(),t,e==="server"?1:window.devicePixelRatio)},ub=(t,e)=>e.split(".").reduce((r,s)=>r[s],t),db=(t,e,r)=>{const s=e.split(".");let n=t;for(let i=0;i<s.length-1;i++){const a=s[i];n=n[a]}n[s[s.length-1]]=r},Au=He()!=="server",ui=Au?new URLSearchParams(window.location.search).has("cheats"):!1,ku={blacktooth:!1,bookworld:!1,egyptus:!1,penitentiary:!1,safari:!1},Fe={inputAssignment:xr.default.inputAssignment,infiniteLivesPoke:!1,displaySettings:{showBoundingBoxes:"none",showShadowMasks:!1,crtFilter:!1,uncolourised:!1,emulatedResolution:He()==="mobile"?"gameboy":"zxSpectrum"},showFps:!1,onScreenControls:He()==="mobile"||He()==="tablet",analogueControl:!0,screenRelativeControl:!1},Cu={userSettings:{displaySettings:{}},upscale:vu(Au?{x:globalThis.window.innerWidth,y:globalThis.window.innerHeight}:tr.zxSpectrum,Fe.displaySettings.emulatedResolution,1),planetsLiberated:ku,roomsExplored:{},scrollsRead:{},gameRunning:ui,openMenus:ui?[]:[{menuId:"mainMenu",scrollableSelection:!1}],assigningInput:void 0,cheatsOn:ui},Pu=sb({name:"gameMenus",initialState:Cu,reducers:{setUpscale(t,{payload:e}){t.upscale=e},setEmulatedResolution(t,{payload:e}){let r;if(e===void 0){const s=t.userSettings.displaySettings.emulatedResolution??Fe.displaySettings.emulatedResolution,n=ni.indexOf(s);r=ni[(n+1)%ni.length]}else r=e;t.userSettings.displaySettings.emulatedResolution=r,He()!=="server"&&(t.upscale=Su(r))},scrollRead(t,{payload:e}){t.scrollsRead[e]=!0,t.openMenus=[{menuId:`markdown/${e}`,scrollableSelection:!1}]},inputAddedDuringAssignment(t,{payload:e}){if(t.assigningInput===void 0)throw new Error("reducer called while not assigning keys");const r=(a,o)=>{a.includes(o)||a.push(o)},{presses:s,axes:n,action:i}=t.assigningInput;switch(e.type){case"key":r(s.keys,e.input);break;case"gamepadButtons":r(s.gamepadButtons,e.input);break;case"gamepadAxes":{es.includes(i)&&r(n,e.input);break}}},doneAssigningInput(t){if(t.assigningInput===void 0)throw new Error("illegal action for state");const{action:e,presses:r,axes:s}=t.assigningInput,n=r.keys.length+r.gamepadButtons.length+s.length,i=t.userSettings.inputAssignment===void 0?t.userSettings.inputAssignment=structuredClone(xr.default.inputAssignment):t.userSettings.inputAssignment;n>0&&(i.presses[e]=r,(e==="left"||e==="right")&&(i.axes.x=s),(e==="towards"||e==="away")&&(i.axes.y=s)),t.assigningInput=void 0},menuOpenOrExitPressed(t){if(t.openMenus.length>0){if(t.openMenus.length===1&&!t.gameRunning)return;const[,...e]=t.openMenus;t.openMenus=e}else t.openMenus=[{menuId:"mainMenu",scrollableSelection:!1}]},goToSubmenu(t,{payload:e}){t.openMenus=[{menuId:e,scrollableSelection:!1},...t.openMenus]},gameStarted(t){t.gameRunning?t.openMenus=[]:(t.openMenus=[{menuId:"crowns",scrollableSelection:!1}],t.gameRunning=!0,t.planetsLiberated=ku,t.roomsExplored={},t.scrollsRead={})},backToParentMenu(t){const[,...e]=t.openMenus;t.openMenus=e},assignInputStart(t,{payload:e}){t.assigningInput={action:e,presses:{gamepadButtons:[],keys:[]},axes:[]}},keyAssignmentPresetChosen(t,{payload:e}){const[,...r]=t.openMenus;t.openMenus=r,t.userSettings.inputAssignment=xr[e].inputAssignment},setFocussedMenuItemId(t,{payload:{focussedItemId:e,scrollableSelection:r}}){const[s]=t.openMenus;s.focussedItemId=e,s.scrollableSelection=r},holdPressed(t,{payload:e}){t.openMenus.length>0?t.openMenus[0]?.menuId==="hold"&&e!=="hold"&&(t.openMenus=[]):e!=="unhold"&&(t.openMenus=[{menuId:"hold",scrollableSelection:!1}])},setShowBoundingBoxes(t,{payload:e}){t.userSettings.displaySettings.showBoundingBoxes=e},setShowShadowMasks(t,{payload:e}){t.userSettings.displaySettings.showShadowMasks=e},toggleBoolean(t,{payload:e}){db(t,e,!ub(t,e))},crownCollected(t,{payload:e}){t.planetsLiberated[e]=!0,Object.values(t.planetsLiberated).every(s=>s)?t.openMenus=[{menuId:"proclaimEmperor",scrollableSelection:!1},{menuId:"crowns",scrollableSelection:!1}]:t.openMenus=[{menuId:"crowns",scrollableSelection:!1}]},roomExplored(t,{payload:e}){t.roomsExplored[e]=!0},gameOver(t){t.gameRunning=!1,t.openMenus=[{menuId:"score",scrollableSelection:!1},{menuId:"mainMenu",scrollableSelection:!0}]}}}),{assignInputStart:Ye,backToParentMenu:Te,crownCollected:U0,doneAssigningInput:fb,gameOver:pb,gameStarted:mb,goToSubmenu:mt,holdPressed:gb,inputAddedDuringAssignment:xb,keyAssignmentPresetChosen:yb,menuOpenOrExitPressed:rc,roomExplored:V0,scrollRead:q0,setEmulatedResolution:Mu,setFocussedMenuItemId:ga,setShowBoundingBoxes:Y0,setShowShadowMasks:X0,setUpscale:bb,toggleBoolean:At}=Pu.actions,wb=t=>{const{upscale:{cssUpscale:e,gameEngineUpscale:r}}=t;return e*r},xa=()=>le(wb),Ls=t=>t.userSettings.inputAssignment??Fe.inputAssignment,K0=t=>t.openMenus.length>0,Iu=()=>le(t=>t.cheatsOn),Tu=t=>t.assigningInput!==void 0,Eu=()=>le(Tu),_b=t=>{for(const[e,r]of Jt(ru(xr)))if(xy(r.inputAssignment,t.userSettings.inputAssignment))return e},vb=t=>t.userSettings.showFps??Fe.showFps,ya=t=>t.userSettings.displaySettings.emulatedResolution??Fe.displaySettings.emulatedResolution,Sb=()=>le(ya),Ks=()=>le(t=>t.gameRunning),Ab=t=>!(t.userSettings.displaySettings.uncolourised??Fe.displaySettings.uncolourised),ba=()=>le(Ab),kb=t=>t.userSettings.displaySettings.crtFilter??Fe.displaySettings.crtFilter,Cb=t=>t.userSettings.infiniteLivesPoke??Fe.infiniteLivesPoke,Z0=t=>t.planetsLiberated.egyptus&&t.planetsLiberated.bookworld&&t.planetsLiberated.penitentiary&&t.planetsLiberated.safari,Gs=()=>le(t=>t.userSettings.screenRelativeControl),Gi=()=>le(t=>t.userSettings.analogueControl??Fe.analogueControl),Pb=t=>Ri(Jt(Qh(t.planetsLiberated)).filter(Boolean)),Mb=t=>t.userSettings.displaySettings.showBoundingBoxes??Fe.displaySettings.showBoundingBoxes,Q0=()=>le(Mb),J0=()=>le(t=>t.userSettings.displaySettings.showShadowMasks??Fe.displaySettings.showShadowMasks),Ib=t=>t.userSettings.analogueControl??Fe.analogueControl,Tb=t=>t.userSettings.screenRelativeControl??Fe.screenRelativeControl,Eb=t=>t.userSettings.onScreenControls??Fe.onScreenControls,Rb=()=>le(Eb),Di=({children:t,scaleFactor:e})=>{const r=xa();return p.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??r,"--block":`${(e??r)*8}px`},children:t})},Ru=L.createContext(null),jb=({gameApi:t,children:e})=>p.jsx(Ru,{value:t,children:e}),ev=()=>{const t=L.useContext(Ru);if(t===null)throw new Error("useGameApi must be used within a GameApiProvider");if(t===void 0)throw new Error("useGameApi must be called once we have a GameApi");return t};var Rr={},_s={},vs={},sc;function Bb(){if(sc)return vs;sc=1,vs.__esModule=!0,vs.default=n;function t(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?t=function(o){return typeof o}:t=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},t(i)}function e(){}var r={getItem:e,setItem:e,removeItem:e};function s(i){if((typeof self>"u"?"undefined":t(self))!=="object"||!(i in self))return!1;try{var a=self[i],o="redux-persist ".concat(i," test");a.setItem(o,"test"),a.getItem(o),a.removeItem(o)}catch{return!1}return!0}function n(i){var a="".concat(i,"Storage");return s(a)?self[a]:r}return vs}var nc;function zb(){if(nc)return _s;nc=1,_s.__esModule=!0,_s.default=r;var t=e(Bb());function e(s){return s&&s.__esModule?s:{default:s}}function r(s){var n=(0,t.default)(s);return{getItem:function(a){return new Promise(function(o,l){o(n.getItem(a))})},setItem:function(a,o){return new Promise(function(l,c){l(n.setItem(a,o))})},removeItem:function(a){return new Promise(function(o,l){o(n.removeItem(a))})}}}return _s}var ic;function Fb(){if(ic)return Rr;ic=1,Rr.__esModule=!0,Rr.default=void 0;var t=e(zb());function e(s){return s&&s.__esModule?s:{default:s}}var r=(0,t.default)("local");return Rr.default=r,Rr}var Ob=Fb();const Nb=rt(Ob);var wa="persist:",_a="persist/FLUSH",Zs="persist/REHYDRATE",va="persist/PAUSE",Sa="persist/PERSIST",Aa="persist/PURGE",ka="persist/REGISTER",ju=-1;function Is(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Is=function(r){return typeof r}:Is=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Is(t)}function ac(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function Lb(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ac(r,!0).forEach(function(s){Gb(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ac(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function Gb(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Db(t,e,r,s){s.debug;var n=Lb({},r);return t&&Is(t)==="object"&&Object.keys(t).forEach(function(i){i!=="_persist"&&e[i]===r[i]&&(n[i]=t[i])}),n}function $b(t){var e=t.blacklist||null,r=t.whitelist||null,s=t.transforms||[],n=t.throttle||0,i="".concat(t.keyPrefix!==void 0?t.keyPrefix:wa).concat(t.key),a=t.storage,o;t.serialize===!1?o=function(E){return E}:typeof t.serialize=="function"?o=t.serialize:o=Hb;var l=t.writeFailHandler||null,c={},h={},u=[],f=null,d=null,g=function(E){Object.keys(E).forEach(function(I){w(I)&&c[I]!==E[I]&&u.indexOf(I)===-1&&u.push(I)}),Object.keys(c).forEach(function(I){E[I]===void 0&&w(I)&&u.indexOf(I)===-1&&c[I]!==void 0&&u.push(I)}),f===null&&(f=setInterval(x,n)),c=E};function x(){if(u.length===0){f&&clearInterval(f),f=null;return}var P=u.shift(),E=s.reduce(function(I,T){return T.in(I,P,c)},c[P]);if(E!==void 0)try{h[P]=o(E)}catch(I){console.error("redux-persist/createPersistoid: error serializing state",I)}else delete h[P];u.length===0&&m()}function m(){Object.keys(h).forEach(function(P){c[P]===void 0&&delete h[P]}),d=a.setItem(i,o(h)).catch(b)}function w(P){return!(r&&r.indexOf(P)===-1&&P!=="_persist"||e&&e.indexOf(P)!==-1)}function b(P){l&&l(P)}var A=function(){for(;u.length!==0;)x();return d||Promise.resolve()};return{update:g,flush:A}}function Hb(t){return JSON.stringify(t)}function Wb(t){var e=t.transforms||[],r="".concat(t.keyPrefix!==void 0?t.keyPrefix:wa).concat(t.key),s=t.storage;t.debug;var n;return t.deserialize===!1?n=function(a){return a}:typeof t.deserialize=="function"?n=t.deserialize:n=Ub,s.getItem(r).then(function(i){if(i)try{var a={},o=n(i);return Object.keys(o).forEach(function(l){a[l]=e.reduceRight(function(c,h){return h.out(c,l,o)},n(o[l]))}),a}catch(l){throw l}else return})}function Ub(t){return JSON.parse(t)}function Vb(t){var e=t.storage,r="".concat(t.keyPrefix!==void 0?t.keyPrefix:wa).concat(t.key);return e.removeItem(r,qb)}function qb(t){}function oc(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function _t(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?oc(r,!0).forEach(function(s){Yb(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):oc(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function Yb(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Xb(t,e){if(t==null)return{};var r=Kb(t,e),s,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)s=i[n],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(r[s]=t[s])}return r}function Kb(t,e){if(t==null)return{};var r={},s=Object.keys(t),n,i;for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&(r[n]=t[n]);return r}var Zb=5e3;function Qb(t,e){var r=t.version!==void 0?t.version:ju;t.debug;var s=t.stateReconciler===void 0?Db:t.stateReconciler,n=t.getStoredState||Wb,i=t.timeout!==void 0?t.timeout:Zb,a=null,o=!1,l=!0,c=function(u){return u._persist.rehydrated&&a&&!l&&a.update(u),u};return function(h,u){var f=h||{},d=f._persist,g=Xb(f,["_persist"]),x=g;if(u.type===Sa){var m=!1,w=function(N,z){m||(u.rehydrate(t.key,N,z),m=!0)};if(i&&setTimeout(function(){!m&&w(void 0,new Error('redux-persist: persist timed out for persist key "'.concat(t.key,'"')))},i),l=!1,a||(a=$b(t)),d)return _t({},e(x,u),{_persist:d});if(typeof u.rehydrate!="function"||typeof u.register!="function")throw new Error("redux-persist: either rehydrate or register is not a function on the PERSIST action. This can happen if the action is being replayed. This is an unexplored use case, please open an issue and we will figure out a resolution.");return u.register(t.key),n(t).then(function(T){var N=t.migrate||function(z,j){return Promise.resolve(z)};N(T,r).then(function(z){w(z)},function(z){w(void 0,z)})},function(T){w(void 0,T)}),_t({},e(x,u),{_persist:{version:r,rehydrated:!1}})}else{if(u.type===Aa)return o=!0,u.result(Vb(t)),_t({},e(x,u),{_persist:d});if(u.type===_a)return u.result(a&&a.flush()),_t({},e(x,u),{_persist:d});if(u.type===va)l=!0;else if(u.type===Zs){if(o)return _t({},x,{_persist:_t({},d,{rehydrated:!0})});if(u.key===t.key){var b=e(x,u),A=u.payload,P=s!==!1&&A!==void 0?s(A,h,b,t):b,E=_t({},P,{_persist:_t({},d,{rehydrated:!0})});return c(E)}}}if(!d)return e(h,u);var I=e(x,u);return I===x?h:c(_t({},I,{_persist:d}))}}function lc(t){return tw(t)||ew(t)||Jb()}function Jb(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function ew(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}function tw(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function cc(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function $i(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?cc(r,!0).forEach(function(s){rw(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cc(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function rw(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Bu={registry:[],bootstrapped:!1},sw=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Bu,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case ka:return $i({},e,{registry:[].concat(lc(e.registry),[r.key])});case Zs:var s=e.registry.indexOf(r.key),n=lc(e.registry);return n.splice(s,1),$i({},e,{registry:n,bootstrapped:n.length===0});default:return e}};function nw(t,e,r){var s=fa(sw,Bu,void 0),n=function(l){s.dispatch({type:ka,key:l})},i=function(l,c,h){var u={type:Zs,payload:c,err:h,key:l};t.dispatch(u),s.dispatch(u)},a=$i({},s,{purge:function(){var l=[];return t.dispatch({type:Aa,result:function(h){l.push(h)}}),Promise.all(l)},flush:function(){var l=[];return t.dispatch({type:_a,result:function(h){l.push(h)}}),Promise.all(l)},pause:function(){t.dispatch({type:va})},persist:function(){t.dispatch({type:Sa,register:n,rehydrate:i})}});return a.persist(),a}function iw(t,e){return function(r,s){if(!r)return Promise.resolve(void 0);var n=r._persist&&r._persist.version!==void 0?r._persist.version:ju;if(n===s||n>s)return Promise.resolve(r);var i=Object.keys(t).map(function(o){return parseInt(o)}).filter(function(o){return s>=o&&o>n}).sort(function(o,l){return o-l});try{var a=i.reduce(function(o,l){return t[l](o)},r);return Promise.resolve(a)}catch(o){return Promise.reject(o)}}}const ut=t=>{const e=Cu.userSettings;return console.log("migrating state: persisted is:",t,"am reverting to initial/default state:",e),e},aw={key:"hohol/gameMenus/userSettings",version:10,migrate:iw({1:ut,2:ut,3:ut,4:ut,5:ut,6:ut,7:ut,8:ut,9:ut,10:ut}),storage:Nb,whitelist:["userSettings"]},ow=Qb(aw,Pu.reducer),ye=Ky({reducer:ow,middleware:t=>t({serializableCheck:{ignoredActions:[_a,Zs,va,Sa,Aa,ka]}})});nw(ye);const lw=()=>He()==="desktop"||new URLSearchParams(window.location.search).get("skipOrientation")!==null?"landscape":window.innerHeight>window.innerWidth||window.matchMedia("(display-mode: fullscreen)").matches&&window.innerHeight<screen.width?"portrait":"landscape",cw=()=>{L.useEffect(()=>{let t=!1,e;const r=(s,n=!0)=>{const i=ye.getState().openMenus.at(0)?.menuId,a=lw();if(e!==void 0&&(window.clearTimeout(e),e=void 0),n&&(e=window.setTimeout(()=>{r(void 0,!1)},500)),a==="portrait"&&i!=="wrongOrientation"){ye.dispatch(mt("wrongOrientation")),t=!0;return}a==="landscape"&&i==="wrongOrientation"&&(ye.dispatch(Te()),t=!1)};return screen.orientation.addEventListener("change",r),r(),()=>{screen.orientation.removeEventListener("change",r),t&&ye.dispatch(Te()),e!==void 0&&window.clearTimeout(e)}},[])},hw=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","","","","0","1","2","3","4","5","6","7","8","9","!","@","#","$","%","^","&","*","(",")","-","_","=","+","[","]","{","}",";",":","'",'"',",",".","/","<",">","?","\\","|"," ","Enter","Shift","Control","Alt","Meta","`","~","Tab","Backspace","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","Numpad+","Numpad-","Numpad*","Numpad/","Numpad.","NumpadEnter","Numpad=","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Escape",""],uw=t=>hw.includes(t);let dw=1;const fw=()=>dw++,pw=3,hc=({key:t,location:e,repeat:r})=>{if(r)return;const s=t.length===1?t.toUpperCase():t,n=e===pw?`Numpad${s}`:s;if(uw(n))return n;console.warn("unrecognised key",t)},mw=()=>new Map,gw=t=>{const e=n=>{const i=hc(n);i!==void 0&&t.set(i,fw())},r=n=>{const i=hc(n);i!==void 0&&t.delete(i)},s=()=>{t.clear()};return window.addEventListener("keydown",e,!1),window.addEventListener("keyup",r,!1),window.addEventListener("blur",s,!1),()=>{window.removeEventListener("keydown",e,!1),window.removeEventListener("keyup",r,!1),window.removeEventListener("blur",s,!1)}},zu=t=>t==="left"?{axis:"x",direction:-1}:t==="right"?{axis:"x",direction:1}:t==="towards"?{axis:"y",direction:1}:t==="away"?{axis:"y",direction:-1}:void 0,vt={away:{x:0,y:1,z:0},left:{x:1,y:0,z:0},right:{x:-1,y:0,z:0},towards:{x:0,y:-1,z:0},down:{x:0,y:0,z:-1},up:{x:0,y:0,z:1},awayRight:hr({x:1,y:1,z:0}),towardsRight:hr({x:1,y:-1,z:0}),towardsLeft:hr({x:-1,y:-1,z:0}),awayLeft:hr({x:-1,y:1,z:0})},xw=t=>t.map(e=>e===null?null:{buttons:e.buttons.map(r=>({pressed:r.pressed})),axes:e.axes.map(r=>r)}),uc=-Math.PI/4,yw=t=>{const e=Math.cos(uc),r=Math.sin(uc);return{x:t.x*e-t.y*r,y:t.x*r+t.y*e,z:0}};hr({x:1,y:2,z:0});hr({x:-1,y:2,z:0});const bw=(t,e)=>{const{x:r,y:s}=t,n=Math.sqrt(r*r+s*s);if(n===0)return{x:0,y:0};const i=Math.cos(e),a=r/n,o=s/n,l=Math.abs(a),c=Math.abs(o);if(l>c){if(l>=i)return{x:Math.sign(r)*n,y:0}}else if(c>=i)return{x:0,y:Math.sign(s)*n};return t},Fu=[],Ou=new Set;Ou.add=()=>{throw new Error("emptySet.add")};Ou.clear=()=>{throw new Error("emptySet.clear")};const tv=Object.freeze({}),ww=.2,_w=13*(Math.PI/180),vw=45,Sw=(t,e)=>!!t.keyboardState.has(e),Nu=(t,e)=>{for(const r of t.gamepads)if(!(r===null||r.buttons.length<=e)&&r.buttons[e].pressed)return!0;return!1},Hi=.5,Lu=(t,e,r)=>{for(const s of t.gamepads)if(!(s===null||s.axes.length<=e)){if(r===void 0){if(Math.abs(s.axes[e])>Hi)return!0}else if(s.axes[e]*r>Hi)return!0}return!1},Ss=(t,e,r=!0)=>{const s=Ls(ye.getState()),n=s.presses[e];if(t.hudInputState[e])return!0;for(const i of n.keys)if(Sw(t,i))return!0;for(const i of n.gamepadButtons)if(Nu(t,i))return!0;if(r){const i=zu(e);if(i!==void 0){const a=s.axes[i.axis];for(const o of a)if(Lu(t,o,i.direction))return!0}}return!1};class Aw{constructor(e,r){this.keyboardStateMap=e,this.hudInputState=r}#e=[];#t=ur;actionsHandled=new Set;#s=()=>{let e,r,s,n;switch("tap"){case(e=this.currentActionPress("left")):return vt.left;case(r=this.currentActionPress("right")):return vt.right;case(s=this.currentActionPress("away")):return vt.away;case(n=this.currentActionPress("towards")):return vt.towards}const i=(e!=="released"?1:0)+(r!=="released"?1:0)+(s!=="released"?1:0)+(n!=="released"?1:0);if(i>1)return this.#t;if(i===1)switch("hold"){case e:return vt.left;case r:return vt.right;case s:return vt.away;case n:return vt.towards}return ur};#n(){const e=this.#e.at(0);if(e===void 0)return ur;function*r(a){for(const o of es)Ss(a,o,!1)&&(yield vt[o])}function*s(a){const{axes:{x:o,y:l}}=Ls(ye.getState());for(const c of a.gamepads){if(c===null)continue;let h=0,u=0;for(const d of o)c.axes.length<=d||(h-=c.axes[d]);for(const d of l)c.axes.length<=d||(u-=c.axes[d]);const f={x:h,y:u,z:0};qh(f)>ww&&(yield f)}}let n=[...r(e)],i;if(n.length===1){const[a]=n,o=[...Jt(this.#e).drop(1).map(l=>[...r(l)])];e:for(const l of o){if(l.length>2)break e;if(l.length===2&&l.some(c=>Vg(c,a))){const c=l.find(h=>qg(h,a)<.001);if(c!==void 0){i=c;break e}}}if(!i)for(const l of o)l.length===0&&(n=Fu)}return Zo(i??ur,...n,...s(e))}#r=({lastTime:e})=>{const r=Ib(ye.getState()),i=Tb(ye.getState())&&r?yw:u=>u,a=bw(Zo(i(r?this.#n():this.#s()),this.hudInputState.directionVector),_w),o=Ug(a);this.#t={...o>1?Vh(a,1/o):a,z:0};const l={keyboardState:new Map(this.keyboardStateMap),hudInputState:{...this.hudInputState},gamepads:xw(navigator.getGamepads()),atTime:e};this.#e.unshift(l);const c=e-vw,h=this.#e.findIndex(u=>u.atTime<c);h!==-1&&this.#e.splice(h+1);for(const u of this.actionsHandled)Ss(l,u)||this.actionsHandled.delete(u)};currentActionPress(e){const r=this.#e.at(0);if(r===void 0)return"released";const s=Ss(r,e);if(this.actionsHandled.has(e))return"released";if(s){const n=this.#e.at(1);return(n===void 0?!1:Ss(n,e))?"hold":"tap"}return"released"}inputTap(){const e=this.#e.at(0),r=this.#e.at(1);if(e!==void 0){for(const s of this.keyboardStateMap.keys())if(r===void 0||!r.keyboardState.has(s))return{type:"key",input:s};for(const s of e.gamepads)if(s!==null){for(const[n,i]of s.buttons.entries())if(i.pressed&&(r===void 0||!Nu(r,n)))return{type:"gamepadButtons",input:n};for(const[n,i]of s.axes.entries())if(Math.abs(i)>Hi&&(r===void 0||!Lu(r,n)))return{type:"gamepadAxes",input:n}}}}get directionVector(){return this.#t}startTicking(){gt.shared.add(this.#r,void 0,Es.INTERACTION)}stopTicking(){gt.shared.remove(this.#r)}}const kw=()=>({directionVector:ur,...Us(hu.map(t=>[t,!1]))}),Gu=L.createContext(null),Cw=({children:t})=>{const[e]=L.useState(mw),[r]=L.useState(()=>new Aw(e,kw()));return L.useEffect(()=>{const s=gw(e);return r.startTicking(),()=>{s(),r.stopTicking()}},[r,e]),p.jsx(Gu,{value:r,children:t})},Ca=()=>{const t=L.useContext(Gu);if(t===null)throw new Error("InputStateProvider required to use useInputState");return t},Ze=({handler:t,action:e,disabled:r=!1})=>{const s=L.useMemo(()=>Array.isArray(e)?e:[e],[e]),n=Ca();L.useEffect(()=>{if(r)return;const i=()=>{for(const a of s)if(n.currentActionPress(a)==="tap"){if(!t(a))for(const c of s)n.actionsHandled.add(c);break}};return gt.shared.add(i),()=>{gt.shared.remove(i)}},[s,r,n,t])},Pw=({handler:t,disabled:e=!1})=>{const r=Ca();L.useEffect(()=>{if(e)return;const s=()=>{const n=r.inputTap();n!==void 0&&t(n,r)};return gt.shared.add(s),()=>{gt.shared.remove(s)}},[e,t,r])};function W(t,e){const r=cu();return L.useCallback(()=>{r(t(e))},[t,r,e])}const Mw=()=>{const t=le(r=>r.assigningInput!==void 0),e=le(r=>r.openMenus.length>0);Ze({action:"menu_openOrExit",handler:W(rc),disabled:t}),Ze({action:"menu_exit",handler:W(rc),disabled:!e}),Ze({action:"toggleShowFps",handler:W(At,"userSettings.showFps"),disabled:e}),Ze({action:"hold",handler:W(gb,"toggle"),disabled:t}),L.useEffect(()=>{const r=()=>{};return window.addEventListener("blur",r,!1),()=>{window.removeEventListener("blur",r,!1)}}),Ze({action:"toggleColourisation",handler:W(At,"userSettings.displaySettings.uncolourised"),disabled:t}),Ze({action:"cycleResolution",handler:W(Mu,void 0),disabled:t})},di=()=>{ye.dispatch(bb(Su(ya(ye.getState()))))},Iw=()=>{const t=cu();L.useLayoutEffect(()=>{di()},[]),L.useLayoutEffect(()=>(window.addEventListener("resize",di),()=>window.removeEventListener("resize",di)),[t])},Tw=()=>(Iw(),Mw(),cw(),null),Ew=`## BAG

![](texture-bag)The *bag* may be used to carry small objects around a room. It is essential for
Heels to find and get the bag as it is impossible to get far without it.

The object in the bag will be displayed immediately above the bags icon at the
bottom right of the screen. To pick up an object just stand on top of it and
press the *CARRY* key. 

![](texture-cube)![](texture-drum)![](texture-spring.compressed)![](texture-sticks)

It is not possible to take items through doorways.

*> head over heels manual*

`,Rw=`## BLACKTOOTH

![](texture-blacktooth.wall.armour.left?bg-pureBlack)![](texture-blacktooth.wall.shield.away?bg-pureBlack&float-right)This planet has a large moon with three lunar space stations on it, the larger
of these, *Moon Station HQ*, is the main teleport center for the empire, with a
direct teleport to all the slave planets.

Sometime after the Egyptus episode,
the latest Emperor sent out a craft to find that same strange planet, and after
much exploration, it was finally located, and the craft landed. However, the
crew found the people had changed: instead of pyramids they used castles,
instead of wrapping corpses up in cloth, they wrapped living men in metal and
then tried to turn them into corpses with sharp metal sticks.

![](texture-teleporter)The Emperor, not to be outdone by his ancestor, built a castle on Blacktooth and
used it as his headquarters. The castle is surrounded by a small market, and
then a range of impassable mountains. The only way to leave is via teleport to
one of the three lunar space stations.

*> head over heels manual*`,jw=`## BOOK WORLD

![](texture-bookworld.wall.cowboy.left?bg-pureBlack)![](texture-book.x?float-right&clear-right)![](texture-book.y?float-right&clear-right)The emperor is very keen
on *cowboy books* and has devoted an entire world to a *western library*.

Only the emperor's minions are permitted to read them.
Information is rigorously suppressed in the empire.

*> Head Over Heels Manual*
`,Bw=`## CONVEYOR BELTS

![](texture-animated-heels.walking.right?z-topSprite&relative&ml-centreSmallBlockOnLarge&mr-2)![](texture-animated-conveyor.x?&relative&clear-left&bottom-bottomStackPullup)The rollers on the conveyor simply push you along it. If you wish to go the
opposite direction you have to jump along.

*> head over heels manual*
`,zw=`## CREDITS

Written by Jon Ritman and Bernie Drummond.  
Music and sound effect by Guy Stevens.  
Produced by D.C. Ward.  
1987 Ocean Software Limited.
`,Fw=`## CROWNS

![](texture-crown.blacktooth)![](texture-crown.bookworld?float-right)![](texture-crown.egyptus?clear-left)![](texture-crown.penitentiary?float-right&clear-right)![](texture-crown.safari?clear-left)Find a crown and start a revolution. At the beginning of each game, a screen
showing all five planets with a crown above each will be displayed.

As each
crown is collected this screen will be shown again with the appropriate crowns
in a bright color.

*> head over heels manual*`,Ow=`## CUDDLY STUFFED WHITE RABBITS

![](texture-whiteRabbit?float-right)The *cute toy bunnies* magically enhance your powers. The status display at the
bottom of the screen will keep you informed as to which powers are temporarily
enhanced.

If Head and Heels are connected when they pick up a *Life* or *Iron pill*,
they will both get the enhanced power.

There are four types:

1. ![](texture-hud.char.2?sprite-tinted&text-metallicBlue)**Two extra lives**
2. ![](texture-hud.shield?sprite-tinted&text-metallicBlue)**Iron Pills** (to make you invulnerable)
3. ![](texture-hud.bigJumps?sprite-tinted&text-metallicBlue)**Jump higher bunny** (only works on Heels)
4. ![](texture-hud.fastSteps?sprite-tinted&text-metallicBlue)**Go faster bunny** (only works on slow-moving Head)

*> Head Over Heels Manual*
`,Nw=`## DOUGHNUTS

![](texture-doughnuts)Trays of *six doughnuts* are few and far between, so dont waste shots. Only Head
may pick up doughnuts.

The number of remaining doughnuts will be displayed above
the doughnut icon at the bottom left of the screen.

*> Head Over Heels Manual*
`,Lw=`## EGYPTUS

![](texture-egyptus.wall.sarcophagus.left)![](texture-egyptus.wall.sarcophagus.away?float-right)![](texture-egyptus.wall.hieroglyphics.left?clear-left)![](texture-egyptus.wall.hieroglyphics.away?float-right&clear-right)Once, a long time ago, a craft from Blacktooth got a bit lost while doing a
hyperspace jump and landed on an unknown planet.

Here the crew found a primitive
animal forming a sort of civilization that appeared to revolve around wrapping
corpses in lots of bandages and putting them into huge stone pyramids.

When they
returned to Blacktooth their emperor liked the sound of it so much that he
rebuilt the capital city of one of the slave planets to resemble the story.

*> Head Over Heels Manual*
`,Gw=`## HEAD 
### (HEADUS MOUTHION)

![](texture-animated-head.walking.towards?float-right)This creature is a symbiotic partner to Heels and will normally be found sitting
on top of one.

![](texture-head.falling.right)Head is descended from a breed of flying reptile and still has
rudimentary wings that allow Head to jump up to twice his own height and to
guide himself through the air.

*> Head Over Heels Manual*
`,Dw=`## HEELS 
### (FOOTUS UNDERIUM)

![](texture-animated-heels.walking.towards?float-right)During Heelss evolution, the arms have totally disappeared while the legs have
become very powerful.

Heels can jump his own height and can also run very fast.

*> Head Over Heels Manual*`,$w=`## HINTS AND TIPS

1. **1** *:* Beginners should aim to escape from Blacktooth and get back to Freedom initially. Only the very skillful can hope to liberate a planet or two.
2. **2** *:* ![](texture-animated-head.idle.towards?float-right&relative&z-topSprite)![](texture-heels.walking.towards.2&float-right&clear-right&relative&bottom-bottomStackPullup)When you first get Head and Heels in the same location, practice placing Head on top of Heels and joining them together accurately with the swop key. Both of their icons will light up when they are successfully joined.
3. **3** *:* Remember Head and Heels are a team. Just because both are in the same room does not mean you have to join them together, and in fact, some problems may only be solved by separating Head and Heels.
4. **4** *:* Make sure Head learns to climb ladders; this is an essential skill.
5. **5** *:* ![](texture-bag?float-right)![](texture-hooter?float-right)Both Heelss bag and Heads hooter must be collected at the initial stages for there to be any chance of completing the game.
6. **6** *:* If Head and Heels are in the same room, extra jumping height may be obtained by one jumping off the others back.
7. **7** *:* Find a safe spot and get used to how far Head and Heels may move over the edge of a brick before they fall. This will enable you to make the longest jumps. Both Head and Heels will jump slightly further if they are running as they jump.
8. **8** *:* Learn the difference in distance and control between Heads jumps and Heelss jumps.
9. **9** *:* Make a map.
10. **10** *:* ![](texture-doughnuts?float-right)Do not waste doughnuts; they are not easy to find.
11. **11** *:* Do not get confused; only Heels may carry anything, and only Head may fire.
12. **12** *:* ![](texture-spring.released?float-right&relative&z-topSprite)![](texture-cube?float-right&clear-right&relative&bottom-bottomStackPullup)To discover if there is a room above, pile objects as high as possible and jump from the top. If there is a spring in the room, put it on the top for extra jumping height.
13. **13** *:* If you cant understand a room, try exiting and entering again, watching carefully for any movement in the room as you enter.

*> Head Over Heels Manual*`,Hw=`## HISTORY OF THE BLACKTOOTH EMPIRE

![](texture-crown.blacktooth)Far, far away from our star Sol lies the Blacktooth empire, an evil empire, four
worlds enslaved by the planet Blacktooth.

![](texture-animated-dalek?float-right)All of the slave worlds bubble with
unrest, but due to the oppressive nature of their rulers they never reach
boiling point, they all lack a leader to draw the masses of population together.

![](texture-animated-helicopterBug?float-right)Blacktooth itself is not any better, a world rigidly controlled by its dynastic
leaders for so long that the populace do not ever think about revolution.

![](texture-head.walking.right.2)The peoples of the neighbouring stars are getting very worried about signs of
military expansion from Blacktooth and have sent a spy from the planet Freedom
to see if he can push the slave planets into full rebellion by finding the
crowns lost when Blacktooth took over.

![](texture-heels.walking.right.2)The creatures of *Freedom* are very strange in that they are formed from a pair of
*symbiotic animals* that have adapted to operate either independently or, to their
mutual advantage, join together as one - Head saddled on Heels, and indeed these
ARE their names and both are highly trained spies.

*> head over heels manual*
`,Ww=`## HOOTER

![](texture-hooter)The *hooter* may be used by Head to fire *doughnuts* at attacking monsters.

This will freeze them in place as they lick the doughnut off their faces.

![](texture-doughnuts?float-right&clear-both)The hooter may only be used by Head and requires a tray of doughnuts to be of any use.

*> Head Over Heels Manual*
`,Uw=`## HUSH PUPPIES

![](texture-hushPuppy?float-right)These are a very strange type of beast; they are incredibly 
sleepy. In fact, they never wake up and it is quite normal for them to sleep for 
their entire lives.

They are often used as tables and even used as building bricks. 
They are a native of Freedom, ![](texture-head.walking.right.2?clear-both)and for many thousands of years Head and his ancestors 
have been mistaking them for Heels and causing so much trouble to the poor old hush
puppies that they evolved a defense mechanism they somehow learned to teleport
themselves away.

![](texture-animated-bubbles.white?float-right&clear-both)Nobody knows where they go, but
the instant they see any of Heads race, they disappear and wont return until they are sure the coast is
clear.

*> head over heels manual*
`,Vw=`## PENITENTIARY
### The empire's prison planet

![](texture-penitentiary.wall.skeleton.left)Millions are imprisoned here. A harsh planet, very mountainous, much climbing,
skill required.

The worst place is The Pit, try not to fall into it!

*> Head Over Heels Manual*
`,qw=`## REINCARNATION FISH

![](texture-animated-fish)The strangest animal in the known universe! This fish likes to be eaten! There
have been cases of it jumping onto plates!

But there is more: when you eat one,
its prodigious memory remembers everything about you. Its memory is so good that
if you die at some later date, you will be reincarnated at the very place you
ate the fish, and you will even have its taste still in your mouth!

How a fish
can remember anything when it's been eaten has never been successfully
explained.

![](texture-fish.1)You must be very careful to check that the fish is
alive and wriggling as **dead fish decompose very quickly and it rapidly
turns so poisonous that a single lick can kill.**

### WARNING:

Even living reincarnation fish taste horrible!

*> head over heels manual*
`,Yw=`## SAFARI

![](texture-monkey.right?float-left&relative&z-topSprite)![](texture-homingBot?float-left&clear-left&relative&bottom-bottomStackPullup)![](texture-elephant.towards?float-right&relative&z-topSprite)![](texture-homingBot?float-right&clear-right&relative&bottom-bottomStackPullup)A densely vegetated planet, mainly used for hunting.

The natives live in wooden forts in the jungle, **beware traps!**

*> Head Over Heels Manual*`,Xw=`## SPRINGS

![](texture-spring.compressed)Jumping from a spring will give extra height to your jump.

*> head over heels manual*
`,Kw=`## SWITCHES

![](texture-animated-switch)Simply push the switch to switch things off and on!  
**WARNING**: Switching a deadly monster off will stop him moving but he will
still be **deadly** to touch.

*> head over heels manual*
`,Zw=`## SWOP KEY

If Head is sitting on Heels, the swop key will, on each push, give you control
of:

* *1* Heels.
* *2* Head + Heels.
* *3* Head.
* *4* Head + Heels.

If Head is not on Heels, the swop key will, on each push, give you control of:

* *1* Head.
* *2* Heels.

At all times, the character(s) whose icon is lit is under player control. When
Head and Heels are joined together, all their abilities are combined.

*> head over heels manual*`,Qw=`## Exalted Emperor:

![](texture-teleporter)Sire, I took the liberty of installing this teleporter 
to aid your magnificent return to the moonbase after the daily crown inspections.

![](texture-cyberman.towards)Supplies are running short of teleporters, so I set it up one-way
until more come in.
May I humbly suggest you teleport after inspecting the crown or his grace
will have a long walk (well, ride on a minions back) to get back here.

Of course, those two spies we threw in jail might try to use it to grab the crown and escape.
Just kidding, theyll never get this far!

*> Your humble minion*
`,Jw=`## TELEPORTS

![](texture-teleporter)Standing on a teleport will activate its mechanism, which will sound a warning
siren. Pressing the *jump key* will cause you to teleport.

Not all teleports are two-way; some are linked in a chain.

*> Head Over Heels Manual* `,e_=`## THE EMPERORS GUARDIAN

![](texture-ball?relative&z-topSprite)![](texture-animated-bubbles.cold?relative&clear-both&bottom-bottomStackPullup)The guardian blocks the door to the throne room in Blacktooth castle. He is **very
dangerous**, and he *doesn't like doughnuts*.

Only a true hero may pass the guardian.

*> head over heels manual*
`,t_=`## THE GAME

![](texture-heels.walking.right.2)![](texture-animated-head.idle.towards?float-right&clear-left)Head and Heels have been captured, separated and imprisoned in the castle
headquarters of Blacktooth. Their cells contain keep fit equipment, including
a wall ladder that Head really must learn to climb.

![](texture-market.wall.fruits.left?bg-pureBlack)![](texture-moonbase.wall.window2.away?bg-pureBlack&float-right)Your job is to get them both
out of the castle and into the *marketplace* so they can join up again. From
there, the journey leads to *Moonbase Headquarters*, where you will have to decide
either to try to escape back to *Freedom* or to be a true hero and teleport to one
of the slave planets to search for its lost crown!

![](texture-crown.bookworld)To overthrow the dictatorship on any of the slave planets would be a major blow
to Blacktooth and you could return to Freedom in glory. Of course, Blacktooth
would probably enslave them again eventually but it would slow down any
expansion plans for now.


![](texture-cyberman.towards?float-right&relative&z-topSprite)![](texture-animated-bubbles.cold?float-right&clear-right&relative&bottom-bottomStackPullup)The populace of Blacktooth are so heavily oppressed
that they would have to see all four of the slave planets revolt before the
Blacktooth crown could cause an uprising. ![](texture-animated-turtle.right)This of course would be the ultimate
accolade, and unfortunately, almost certain suicide.

*> Head Over Heels Manual*
`,ce=Object.assign({"./bag.md":Ew,"./blacktooth.md":Rw,"./bookWorld.md":jw,"./conveyorBelts.md":Bw,"./credits.md":zw,"./crowns.md":Fw,"./cuddlyStuffedWhiteRabbits.md":Ow,"./doughnuts.md":Nw,"./egyptus.md":Lw,"./head.md":Gw,"./heels.md":Dw,"./hintsAndTips.md":$w,"./historyOfTheBlacktoothEmpire.md":Hw,"./hooter.md":Ww,"./hushPuppies.md":Uw,"./penitentiary.md":Vw,"./reincarnationFish.md":qw,"./safari.md":Yw,"./springs.md":Xw,"./switches.md":Kw,"./swopKey.md":Zw,"./teleportBack.md":Qw,"./teleports.md":Jw,"./theEmperorsGuardian.md":e_,"./theGame.md":t_}),Pa={historyOfTheBlacktoothEmpire:ce["./historyOfTheBlacktoothEmpire.md"],theGame:ce["./theGame.md"],egyptus:ce["./egyptus.md"],penitentiary:ce["./penitentiary.md"],safari:ce["./safari.md"],bookWorld:ce["./bookWorld.md"],blacktooth:ce["./blacktooth.md"],head:ce["./head.md"],heels:ce["./heels.md"],reincarnationFish:ce["./reincarnationFish.md"],cuddlyStuffedWhiteRabbits:ce["./cuddlyStuffedWhiteRabbits.md"],hooter:ce["./hooter.md"],doughnuts:ce["./doughnuts.md"],bag:ce["./bag.md"],crowns:ce["./crowns.md"],teleports:ce["./teleports.md"],springs:ce["./springs.md"],switches:ce["./switches.md"],conveyorBelts:ce["./conveyorBelts.md"],hushPuppies:ce["./hushPuppies.md"],theEmperorsGuardian:ce["./theEmperorsGuardian.md"],swopKey:ce["./swopKey.md"],hintsAndTips:ce["./hintsAndTips.md"],credits:ce["./credits.md"]},r_={...Pa,teleportBack:ce["./teleportBack.md"]},s_=/^##\s+(.*)$/m,n_=t=>{const e=t.match(s_);if(e===null)return"no title found";const[,r]=e;return r};function Du(t){var e,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(r=Du(t[e]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function $u(){for(var t,e,r=0,s="",n=arguments.length;r<n;r++)(t=arguments[r])&&(e=Du(t))&&(s&&(s+=" "),s+=e);return s}function rv(t){if(!Wi(t))throw new Error(`Invalid textureId: "${t}"`)}function Wi(t){return qt.frames[t]!==void 0}function sv(t){return qt.animations[t]!==void 0}const i_=({className:t,children:e})=>t?p.jsx("div",{className:`contents ${t}`,children:e}):e,D=({children:t,className:e,noSlitWords:r,classnameCycle:s,onClick:n})=>{const i=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(i.length===0)return null;const a=r?[i.toUpperCase()]:i.toUpperCase().split(/\s+/);return p.jsx("span",{className:$u(e),onClick:n,children:a.map((o,l)=>p.jsx("span",{className:Ie("text-nowrap inline-block",l===a.length-1?"":"me-1"),children:Array.from(o).map((c,h)=>{const u=`hud.char.${su(c)}`;return Wi(u)||console.error("no texture for char",c,c.charCodeAt(0),u,"we have:",Object.keys(Yt.textures)),p.jsx("span",{className:`sprite ${Wi(u)?`texture-${u}`:"texture-hud.char.?"}
                  sprite-tinted
                  ${s===void 0?"":s[h%s.length]}`},h)})},l))})},a_=t=>t.props.children!==void 0,Qe=({children:t,className:e})=>p.jsx(i_,{className:e,children:Array.isArray(t)?t.map((r,s)=>p.jsx(Qe,{children:r},s)):typeof t=="number"?p.jsx(D,{children:String(t)}):typeof t=="string"?p.jsx(D,{children:t}):L.isValidElement(t)?t.type===D||t.type===Qe?t:a_(t)?L.cloneElement(t,void 0,typeof t.props.children=="string"?p.jsx(D,{children:`${t.props.children}`}):p.jsx(Qe,{children:t.props.children})):t:t}),o_=({flip:t=!1,focussed:e=!1})=>p.jsx(D,{className:"inline-block col-start-1 w-min mx-auto "+(t?"scale-[-1] relative bottom-oneScaledPix":""),children:e?"":""});var Xe={},ar={},or={},dc;function Qs(){if(dc)return or;dc=1;var t=or&&or.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(or,"__esModule",{value:!0});const r=t(wr()).default.createContext({refs:{},renderItems:{},register:()=>{},unregister:()=>{}});return or.default=r,or}var fc;function l_(){if(fc)return ar;fc=1;var t=ar&&ar.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ar,"__esModule",{value:!0});const e=t(wr()),r=t(Ac()),s=t(Qs()),n=({id:i,children:a})=>{const{refs:o,renderItems:l}=e.default.useContext(s.default),c=o[i],h=l[i];return c?h?r.default.createPortal(h(a),c,i):r.default.createPortal(a,c,i):null};return ar.default=n,ar}var lr={},pc;function c_(){if(pc)return lr;pc=1;var t=lr&&lr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(lr,"__esModule",{value:!0});const e=t(wr()),r=t(Qs()),s=({id:n,renderItem:i=o=>o,className:a})=>{const{register:o,unregister:l}=e.default.useContext(r.default),c=e.default.useRef(null);return e.default.useEffect(()=>(c.current&&o(n,c.current,i),()=>l(n)),[n,c.current]),e.default.createElement("div",{className:[`portal-placeholder-${n}`,a].filter(h=>!!h).join(" "),ref:c})};return lr.default=s,lr}var Et={},mc;function h_(){if(mc)return Et;mc=1;var t=Et&&Et.__rest||function(i,a){var o={};for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&a.indexOf(l)<0&&(o[l]=i[l]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,l=Object.getOwnPropertySymbols(i);c<l.length;c++)a.indexOf(l[c])<0&&Object.prototype.propertyIsEnumerable.call(i,l[c])&&(o[l[c]]=i[l[c]]);return o},e=Et&&Et.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Et,"__esModule",{value:!0});const r=e(wr()),s=e(Qs()),n=({children:i})=>{const[a,o]=r.default.useState({}),[l,c]=r.default.useState({}),h=r.default.useCallback((d,g,x)=>{o(m=>Object.assign(Object.assign({},m),{[d]:g})),c(m=>Object.assign(Object.assign({},m),{[d]:x}))},[]),u=r.default.useCallback(d=>{o(g=>{const x=g,m=d;return x[m],t(x,[typeof m=="symbol"?m:m+""])}),c(g=>{const x=g,m=d;return x[m],t(x,[typeof m=="symbol"?m:m+""])})},[]),f=r.default.useMemo(()=>({refs:a,renderItems:l,register:h,unregister:u}),[a,l,h,u]);return r.default.createElement(s.default.Provider,{value:f},i)};return Et.default=n,Et}var gc;function u_(){if(gc)return Xe;gc=1;var t=Xe&&Xe.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.Context=Xe.Placeholder=Xe.Provider=void 0;const e=t(l_()),r=t(c_()),s=t(h_()),n=t(Qs());Xe.Provider=s.default,Xe.Placeholder=r.default,Xe.Context=n.default;const i=e.default;return i.Context=n.default,i.Placeholder=r.default,i.Provider=s.default,Xe.default=i,Xe}var d_=u_();const kr=rt(d_),Ae="leading-none [&_[class*='texture-hud.char']]:mb-oneScaledPix",f_=["menu_select","swop","jump"],Zr="data-menuitem_id",Hu="data-menuitem_hidden",p_="data-menuitem_disabled",m_=()=>{},te=({id:t,label:e,valueElement:r,flipLeader:s=!1,doubleHeightWhenFocussed:n,onSelect:i=m_,hidden:a=!1,disabled:o=!1,hintInline:l=!1,className:c,hint:h,leader:u})=>{const f=L.useRef(!0),d=le(m=>m.openMenus[0].scrollableSelection),g=le(m=>m.openMenus[0].focussedItemId===t);Ze({action:f_,handler:i,disabled:!g||a||o});const x=p.jsxs("div",{[Zr]:t,[Hu]:a,[p_]:o,tabIndex:0,className:Ie("contents",a?"hidden":"",n&&g?"sprites-double-height":"",g?"selectedMenuItem":"",c),onMouseMove:W(ga,{focussedItemId:t,scrollableSelection:!1}),onClick:o?void 0:i,children:[u||p.jsx(o_,{flip:s,focussed:g}),p.jsx("div",{ref:m=>{g&&d&&m?.scrollIntoView({behavior:f.current?"instant":"smooth",block:"center"}),f.current=!1},className:Ie(r===void 0?"col-span-2":""),children:typeof e=="string"?p.jsx(p.Fragment,{children:p.jsx(D,{children:e})}):e}),r!==void 0&&r,!g||h===void 0||l?null:p.jsx(kr,{children:typeof h=="string"?p.jsx(D,{className:Ae,children:h}):h})]});return l&&h&&g?p.jsxs(p.Fragment,{children:[x,p.jsx("div",{className:"col-span-2 col-start-2",children:h})]}):x},Tt=()=>p.jsx(te,{id:"back",label:"Back",flipLeader:!0,doubleHeightWhenFocussed:!0,onSelect:W(Te)}),br=t=>p.jsx("div",{className:`col-span-3 h-1 ${t}`}),Wu=()=>{const t=document.body.querySelectorAll(`[${Zr}]`);return Array.from(t)},xc=t=>{const e=ye.getState().openMenus[0].focussedItemId;if(e===void 0)return!0;const r=Wu();if(r.length<=1)return!0;const s=r.findIndex(i=>i.getAttribute(Zr)===e);if(s===-1)return!0;let n=s;do n=(n+t+r.length)%r.length;while(r[n].getAttribute(Hu)==="true");return ye.dispatch(ga({focussedItemId:r[n].getAttribute(Zr),scrollableSelection:!0})),!1},g_=t=>{const e=Eu();Ze({action:"away",handler:L.useCallback(()=>{if(t.current!==null)return xc(-1)},[t]),disabled:e}),Ze({action:"towards",handler:L.useCallback(()=>{if(t.current!==null)return xc(1)},[t]),disabled:e})},tt=({className:t="",children:e})=>{const r=L.useRef(null);return L.useEffect(()=>{if(r.current===null||ye.getState().openMenus[0].focussedItemId!==void 0)return;const s=Wu();ye.dispatch(ga({focussedItemId:s[0].getAttribute(Zr),scrollableSelection:!0}))},[]),g_(r),p.jsx("div",{ref:r,className:Ie("grid grid-cols-menuItems gap-x-1 gap-y-oneScaledPix mobile:!gap-y-1 mobile:sprites-double-height",t),children:e})};var Uu=Ac();const nv=rt(Uu),Ve=({children:t})=>Uu.createPortal(p.jsx(Di,{children:t}),document.body),Js=({className:t})=>p.jsxs("div",{className:Ie("text-redShadow zx:text-zxMagenta sprites-double-height flex flex-row gap-1",t),children:[p.jsx(D,{className:"inline-block scale-[-1]",onClick:W(Te),children:""}),p.jsx(D,{className:"inline-block",onClick:W(Te),children:"Back"})]}),x_=({pageName:t})=>{const e=Pa[t],r=n_(e),s=He()==="desktop";return p.jsx(te,{id:`markdown/${t}`,label:r,onSelect:W(mt,`markdown/${t}`),doubleHeightWhenFocussed:s})},y_=()=>p.jsxs(Ve,{children:[p.jsx(st,{className:"bg-midGrey zx:bg-zxCyan",onClick:W(Te)}),p.jsx(ze,{className:"bg-highlightBeige zx:bg-zxCyanDimmed !h-tallDialog resGameboy:!h-full mobile:!h-full max-h-[calc(var(--block)*40)]",children:p.jsxs("div",{className:`text-redShadow zx:text-zxWhite ${Ae} !gap-y-0 selectedMenuItem:text-shadow zx:selectedMenuItem:text-zxBlack overflow-y-scroll scrollbar scrollbar-w-1 scrollbar-thumb-moss scrollbar-track-highlightBeige zx:scrollbar-thumb-zxBlack zx:scrollbar-track-zxCyanDimmed `,children:[Mt()&&p.jsx(Js,{className:"mb-1"}),p.jsxs("div",{className:"text-moss zx:text-zxBlack mx-auto flex flex-row justify-center items-center w-full mb-1",children:[p.jsx("span",{className:"sprite texture-book.x zx:sprite-revert-to-white sprites-normal-height"}),p.jsx(D,{className:"sprites-double-height mx-1",children:"Read the manual"}),p.jsx("span",{className:"sprite texture-book.y zx:sprite-revert-to-white sprites-normal-height"})]}),p.jsxs(tt,{children:[[...Jt(ha(Pa)).map(t=>p.jsx(x_,{pageName:t},t))],p.jsx(br,{}),Mt()||p.jsx(Tt,{})]})]})})]}),b_={"":L.Fragment,pre:"pre",code:"code",ol:"ol",ul:"ul",hr:"hr",blockquote:"blockquote",li:"li",a:"a",img:"img",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",p:"p",em:"em",strong:"strong"},yc=t=>t.replace(RegExp("^"+(t.match(/^(\t| )+/)||"")[0],"gm"),""),w_=t=>t&&typeof t!="string"&&["div","ul","ol","pre","h1","h2","h3","h4","h5","h6"].includes(t.t),fi=t=>t.replace(/^\s+|\s+$/g," "),we=(t,e=[],r={})=>({t,c:Array.isArray(e)?e:[e],p:r}),Gr=(t,e=!1)=>{let r=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,s=0;const n=we("");let i,a;e?(i=we("p"),a=[n,i],n.c.push(i)):(i=n,a=[n]);let o;const l=(u,f=!0)=>(f&&a.push(u),i.c.push(u),f&&(i=u),u),c=u=>{const f=a.findIndex(d=>d.t===u);a=a.slice(0,f),i=a.at(-1)};for(;o=r.exec(t);){const u=t.substring(s,o.index);if(s=r.lastIndex,u!=="")if(i===n&&e){const f=we("p",fi(u));n.c.push(f),a=[n,f],i=f}else i.c.push(fi(u));if(!u.match(/[^\\](\\\\)*\\$/)){if(o[3]||o[4]){const f=we("pre",o[4]?yc(o[4]):we("code",yc(o[3]),o[2]?{language:`language-${o[2].toLowerCase()}`}:{}));n.c.push(f),a=[n],i=n}else if(o[6]){const f=o[6],d=f!==">",g=!!f.match(/\./),x=d?g?"ol":"ul":"blockquote",m=o[5].split(`
`).map(b=>b.replace(/^(\*|-|\+|>|\d+\.)\s+/,"")),w=we(x,d?m.map(b=>we("li",Gr(b).c)):Gr(m.join(`
`)).c);n.c.push(w),a=[n,w],i=n}else if(o[8]){const f=we("img",[],{src:o[8],...o[7]?{alt:o[7]}:{}});if(e&&i===n){const d=we("p",f);n.c.push(d),i=d,a=[n,d]}else l(f,!1)}else if(o[10]){const f=a.find(d=>d.t==="a");f&&(f.p.href=o[11])}else if(o[9])l(we("a"));else if(o[14]){const f="h"+o[14].length;n.c.push(we(f,Gr(o[15]).c)),a=[n],i=n}else if(o[13])n.c.push(we("h1",Gr(o[12]).c)),a=[n],i=n;else if(o[16])l(we("code",o[16]),!1);else if(o[17]?.[0]===`
`||o[17]===`  
`){if(!(a[1]?.t==="p")){const g=n.c;let x;for(x=g.length-1;x>=0&&!w_(g[x]);x--);if(x!==n.c.length-1){const m=n.c.splice(x+1);n.c.push(we("p",m))}}const d=we("p");n.c.push(d),a=[n,d],i=d}else if(o[1])l(we("hr"),!1);else if(o[17]){const f=o[17].length===2?"strong":"em";a.findIndex(g=>g.t===f)===-1?l(we(f)):c(f)}}}const h=fi(t.substring(s));if(h.length){const u=n.c.at(-1);let f;u?.t==="p"?f=u:e?(f=we("p"),n.c.push(f)):f=n,f.c.push(h)}return n.c=n.c.filter(u=>typeof u=="string"||u.t!=="p"||u.c?.length>0),n},__=(t,e={})=>{const r={...b_,...e},s=(n,i=0)=>{const a=n.t===""?L.Fragment:r[n.t];return L.createElement(a,{...n.p,key:i},n.c.length===0?void 0:n.c.map((o,l)=>typeof o=="string"?o:s(o,l)))};return s(Gr(t,!0))},v_=({markdown:t,customComponents:e})=>__(t,e),S_={h2:function({children:e}){return p.jsx("h2",{className:`mb-1 sprites-double-height text-metallicBlue zx:text-zxBlue ${Ae}`,children:p.jsx(Qe,{children:e})})},h3:function({children:e}){return p.jsx("h3",{className:"mt-1 mb-1 text-metallicBlue zx:text-zxBlue",children:p.jsx(Qe,{children:e})})},p:function({children:e}){return p.jsx("div",{className:`mb-1 last:mb-0 ${Ae}`,children:p.jsx(Qe,{children:e})})},li:function({children:e}){return p.jsx("div",{className:`mb-1 clear-left ${Ae}`,children:p.jsx(Qe,{children:e})})},strong:function({children:e}){return p.jsx(Qe,{className:"strong text-midRed zx:text-zxRed",children:e})},em:function({children:e}){return p.jsx(Qe,{className:"em text-moss zx:text-zxBlue",children:e})},img:function({src:e}){const r=xa();if(e===void 0)throw new Error("image without src");const s=e.split(/\?|&/);return p.jsx("span",{style:{"--scale":r*2},children:p.jsx("span",{className:Ie("sprite float-left mr-1 mb-1 zx:sprite-revert-to-two-tone",s.join(" "))})})}},Je=({markdown:t,className:e})=>p.jsx("div",{className:`contents ${e}`,children:p.jsx(v_,{customComponents:S_,markdown:t})}),A_=4,k_=Vt.h,C_=({pageName:t})=>{const e=L.useRef(null),r=xa(),s=r_[t],n=L.useCallback(i=>{if(e.current===null)return;const{scrollTop:a}=e.current,o=a+r*A_*(i==="down"?k_:-8);e.current.scrollTo({top:o,behavior:"instant"})},[r]);return Ze({handler:L.useCallback(()=>{n("down")},[n]),action:"towards"}),Ze({handler:L.useCallback(()=>{n("up")},[n]),action:"away"}),p.jsxs(Ve,{children:[p.jsx(st,{className:"bg-midGrey zx:bg-zxWhiteDimmed",onClick:W(Te)}),p.jsxs(ze,{className:"bg-highlightBeige zx:bg-zxCyan text-shadow zx:text-zxBlack mobile:h-full",onClick:W(Te),children:[p.jsxs("div",{className:Ie("overflow-y-scroll h-full scrollbar  scrollbar-w-1 scrollbar-thumb-midRed scrollbar-track-highlightBeige zx:scrollbar-thumb-zxCyanDimmed zx:scrollbar-track-zxCyan"),ref:e,children:[Mt()&&p.jsx(Js,{className:"pb-1"}),p.jsx(Je,{markdown:s})]}),p.jsx(tt,{className:"hidden",children:p.jsx(Tt,{})})]})]})},bc={egyptus:["text-lightBeige","text-midRed","text-highlightBeige"],blacktooth:["text-midGrey","text-lightGrey","text-moss","text-midRed"],safari:["text-moss","text-midRed","text-highlightBeige"],bookworld:["text-midRed","text-redShadow","text-midGrey"],penitentiary:["text-shadow","text-metallicBlue","text-midGrey"]},P_={egyptus:"texture-crown.egyptus",blacktooth:"texture-crown.blacktooth",bookworld:"texture-crown.bookworld",penitentiary:"texture-crown.penitentiary",safari:"texture-crown.safari"},jr=({planet:t,className:e,label:r=t})=>{const s=le(i=>i.planetsLiberated[t]),n=ba();return p.jsxs("div",{className:`flex flex-col ${e}`,children:[p.jsx("span",{className:`sprite block ${P_[t]} ${s?"zx:sprite-revert-zxYellow":"colourised:brightness-halfBrite zx:sprite-revert-zxMagenta"} mx-auto`}),p.jsx("span",{className:`sprite block texture-ball zx:sprite-revert-zxYellow mx-auto ${s?"":"colourised:brightness-halfBrite"} ${bc[t][0]}`}),p.jsx(D,{classnameCycle:n?bc[t]:void 0,className:`block mx-auto zx:text-zxMagenta ${s?"":"colourised:brightness-halfBrite"}`,children:r})]})},M_=()=>p.jsxs(p.Fragment,{children:[p.jsx(D,{className:"block sprites-double-height text-highlightBeige zx:text-zxYellow mx-auto w-max",children:"The blacktooth empire"}),p.jsxs("div",{className:"mx-auto relative w-0 h-1",children:[p.jsx(jr,{planet:"egyptus",className:"w-12 absolute left-m10 top-1 resGameboy:left-m8 resGameboy:top-m1 translate-x-[-50%]"}),p.jsx(jr,{planet:"penitentiary",className:"w-12 absolute left-10 top-1 resGameboy:left-8 resGameboy:top-m1 translate-x-[-50%]"}),p.jsx(jr,{planet:"safari",className:"w-12 left-m10 top-15 absolute resGameboy:left-m8 resGameboy:top-6 translate-x-[-50%]"}),p.jsx(jr,{planet:"bookworld",label:"book world",className:"w-12 absolute left-10 top-15 resGameboy:left-8 resGameboy:top-6 translate-x-[-50%]"}),p.jsx(jr,{planet:"blacktooth",className:"w-12 absolute left-0 top-8 resGameboy:left-0 ml-[-50%] resGameboy:top-2 translate-x-[-50%]"})]})]}),I_=()=>p.jsxs(Ve,{children:[p.jsx(st,{className:"bg-pureBlack zx:bg-zxBlack"}),p.jsxs(ze,{className:"bg-pureBlack w-zx resGameboy:w-full h-full block p-0",onClick:W(Te),children:[p.jsx(M_,{}),p.jsx(tt,{className:"hidden",children:p.jsx(Tt,{})})]})]}),St=["text-pink zx:text-zxCyan","text-highlightBeige zx:text-zxYellow","text-moss zx:text-zxWhite"],T_=()=>p.jsx(p.Fragment,{children:p.jsxs("div",{className:"flex justify-center gap-2 leading-none",children:[p.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center",children:[p.jsx(D,{className:"text-metallicBlue zx:text-zxBlack",children:"1987 original"}),p.jsxs("div",{className:"flex gap-1",children:[p.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center",children:[p.jsx(D,{classnameCycle:St,children:"Jon"}),p.jsx(D,{classnameCycle:St,children:"Ritman"})]}),p.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center",children:[p.jsx(D,{classnameCycle:St,children:"Bernie"}),p.jsx(D,{classnameCycle:St,children:"Drummand"})]})]})]}),p.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center",children:[p.jsx(D,{className:"text-pink zx:text-zxBlack",children:"2025 remake"}),p.jsx("div",{className:"flex",children:p.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center",children:[p.jsx(D,{classnameCycle:St,children:"Jim"}),p.jsx(D,{classnameCycle:St,children:"Higson"})]})})]})]})}),Ma=({noSubtitle:t,className:e})=>p.jsxs("div",{className:`flex flex-col items-center ${e}`,children:[p.jsxs("div",{className:"flex",children:[p.jsxs("div",{className:"flex flex-col resGameboy:flex-row resGameboy:gap-1 gap-y-oneScaledPix items-center me-1",children:[p.jsx(D,{className:"sprites-double-height text-metallicBlue zx:text-zxYellow resGameboy:mt-1",children:"Head"}),p.jsxs("div",{className:"mt-1 resGameboy:mt-0 relative",children:[p.jsx("span",{className:"sprite zx:sprite-revert-to-white texture-animated-head.idle.right hover:texture-animated-head.walking.right relative z-topSprite"}),p.jsx("span",{className:"sprite zx:hidden texture-shadow.smallRound absolute left-0 top-[calc(var(--scale)*1px)] opacity-halfBrite"})]})]}),p.jsx(D,{classnameCycle:St,className:"mt-1 me-1 resGameboy:mt-2",children:"over"}),p.jsxs("div",{className:"flex flex-col resGameboy:flex-row-reverse resGameboy:gap-1 items-center me-1",children:[p.jsx(D,{className:"sprites-double-height text-pink zx:text-zxYellow resGameboy:mt-1",children:"Heels"}),p.jsxs("div",{className:"mt-1 resGameboy:mt-0 relative",children:[p.jsx("span",{className:"sprite zx:sprite-revert-to-white texture-heels.walking.towards.2 hover:texture-animated-heels.walking.towards relative z-topSprite"}),p.jsx("span",{className:"sprite zx:hidden texture-shadow.smallRound absolute left-0 top-[calc(var(--scale)*1px)] opacity-halfBrite"})]})]})]}),t||p.jsxs("div",{className:"mt-1 w-max resGameboy:hidden",children:[p.jsx(D,{className:"text-pink zx:text-zxCyan",children:"block"}),p.jsx(D,{className:"text-highlightBeige zx:text-zxYellow",children:"stack"}),p.jsx(D,{className:"text-metallicBlue zx:text-zxBlack",children:"."}),p.jsx(D,{className:"text-moss zx:text-zxWhite",children:"ing"}),p.jsx(D,{classnameCycle:St,children:" remake"})]})]}),E_=()=>{const t=Ks();return p.jsx(D,{children:t?"Resume the game":"Play the game"})},R_=t=>{const e=Ks(),r=W(mt,"crowns"),s=W(mt,"score"),n=L.useCallback(()=>{r(),s()},[r,s]);return p.jsxs(Ve,{children:[p.jsx(st,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed"}),p.jsxs(ze,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed gap-y-2 resGameboy:gap-y-1",children:[p.jsx(Ma,{noSubtitle:e,className:e?"resGameboy:hidden":""}),p.jsxs(tt,{className:"text-highlightBeige zx:text-zxCyan selectedMenuItem:text-white",children:[p.jsx(te,{id:"playGame",label:p.jsx(E_,{}),doubleHeightWhenFocussed:!0,onSelect:W(mb)}),p.jsx(te,{id:"viewCrowns",label:"Progress so far",onSelect:n,doubleHeightWhenFocussed:!0,hidden:!e}),He()!=="mobile"&&e&&p.jsx(br,{}),p.jsx(te,{id:"modernisationOptions",label:"Options",doubleHeightWhenFocussed:!0,onSelect:W(mt,"modernisationOptions")}),p.jsx(te,{id:"readTheManual",label:"Read the manual",doubleHeightWhenFocussed:!0,onSelect:W(mt,"readTheManual")}),e&&p.jsx(br,{}),p.jsx(te,{id:"quitGame",label:"Quit this game",className:"text-midRed zx:text-zxYellow",onSelect:W(mt,"quitGameConfirm"),doubleHeightWhenFocussed:!0,hidden:!e})]}),!e&&p.jsx(T_,{})]})]})},en=({className:t})=>p.jsx("div",{className:Ie("contents",t),children:p.jsx(kr.Placeholder,{})}),j_=()=>p.jsxs(Ve,{children:[p.jsx(st,{className:"bg-midRed zx:bg-zxYellow"}),p.jsx(ze,{className:"bg-white zx:bg-zxRed",children:p.jsxs(kr.Provider,{children:[p.jsx(Ma,{noSubtitle:!0}),p.jsx(D,{className:"ml-3 sprites-double-height mt-2 resGameboy:mt-0",classnameCycle:["text-redShadow zx:text-zxWhite","text-midRed zx:text-zxYellow"],children:"Quit the game?"}),p.jsxs(tt,{className:"text-lightGrey zx:text-zxWhite mt-1 resGameboy:mt-0 selectedMenuItem:text-midRed zx:selectedMenuItem:text-zxYellow resGameboy:!gap-y-1",children:[p.jsx(te,{doubleHeightWhenFocussed:!0,id:"no",label:"No",onSelect:W(Te),hint:"Go back to the game"}),p.jsx(te,{doubleHeightWhenFocussed:!0,id:"yes",label:"Yes",onSelect:W(pb),hint:p.jsx(Je,{className:"zx:[&_.strong]:text-zxYellow",markdown:"**Warning!** This game will end!"})})]}),p.jsx(en,{className:"text-midGrey zx:text-zxWhite resGameboy:hidden"})]})})]}),Vu=Qr(()=>Qt(()=>import("./campaign-Cq5Auj03.js"),[])),wc=(t,e)=>t*160+e*1e4,B_=()=>{const{campaign:t}=L.use(Vu()),e=le(Pb),r=le(o=>Ri(Jt(Qh(o.roomsExplored)))),s=wc(r,e),n=Ri(Sx(t.rooms)),i=wc(n,5),a=s<8e3?"dummy":s<2e4?"novice":s<3e4?"spy":s<55e3?"master-spy":s<84e3?"hero":s<i?"liberator":"completionist";return p.jsxs(Ve,{children:[p.jsx(st,{className:"bg-metallicBlue zx:bg-zxCyan"}),p.jsxs(ze,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed w-zx h-full block",onClick:W(Te),children:[p.jsx(Ma,{noSubtitle:!0,className:"resGameboy:hidden"}),p.jsx(D,{classnameCycle:St,className:"mt-2 resGameboy:mt-3 block text-center mx-auto sprites-double-height",children:a}),p.jsxs(D,{className:"mt-2 resGameboy:mt-1 block text-center mx-auto text-highlightBeige zx:text-zxYellow",children:["Score ",s.toLocaleString()]}),p.jsxs(D,{className:"mt-2 resGameboy:mt-1 block text-center mx-auto text-pink zx:text-zxCyan",children:["Explored ",r," / ",n," rooms"," ",`(${(100*r/n).toFixed(1)}%)`]}),p.jsxs(D,{className:"mt-2 resGameboy:mt-1 block text-center mx-auto text-lightGrey zx:text-zxWhite",children:["Liberated ",e," planets"]}),p.jsx(tt,{className:"hidden",children:p.jsx(Tt,{})})]})]})},Wt="text-mossHalfbrite zx:text-zxGreen selectedMenuItem:text-moss zx:selectedMenuItem:text-zxGreen",z_=t=>{const e=/(Numpad|F)(.*)/.exec(t);if(e!==null)return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:Wt,children:e[1]}),e[2]]});switch(t){case" ":return"space";case"ArrowDown":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:Wt,children:"Cursor"}),""]});case"ArrowUp":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:Wt,children:"Cursor"}),""]});case"ArrowLeft":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:Wt,children:"Cursor"}),""]});case"ArrowRight":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:Wt,children:"Cursor"}),""]});default:return t}},F_=t=>t===0?"":t===1?"":`axis${t}`,O_=t=>{switch(Hl[t]){case"dPadDown":return"d-Pad";case"dPadUp":return"d-Pad";case"dPadLeft":return"d-Pad";case"dPadRight":return"d-Pad";case"a":return p.jsx("span",{className:"colourised:text-mossHalfbrite colourised:selectedMenuItem:text-moss zx:text-zxGreen",children:"a"});case"b":return p.jsx("span",{className:"colourised:text-midRedHalfbrite colourised:selectedMenuItem:text-midRed zx:text-zxRed",children:"b"});case"x":return p.jsx("span",{className:"colourised:text-metallicBlueHalfbrite colourised:selectedMenuItem:text-metallicBlue zx:text-zxBlue",children:"x"});case"y":return p.jsx("span",{className:"colourised:text-highlightBeigeHalfbrite colourised:selectedMenuItem:text-highlightBeige zx:text-zxYellow",children:"y"})}return Hl[t]??t},Ia=({action:t,keyClassName:e,className:r,flashingCursor:s=!1})=>{const n=le(a=>a.assigningInput?.action===t?a.assigningInput?.presses:Ls(a).presses[t]),i=le(a=>{const o=zu(t);return o===void 0?Fu:a.assigningInput?.action===t?a.assigningInput.axes:Ls(a).axes[o.axis]});return p.jsxs("div",{className:r,children:[n.keys.map(a=>p.jsx("span",{className:Ie("text-nowrap",e),children:p.jsx(Qe,{children:z_(a)})},`key:${a}`)),i.map(a=>p.jsx("span",{className:Ie("text-nowrap",e),children:p.jsxs(Qe,{children:[p.jsx("span",{className:Wt,children:""}),F_(a)]})},`gamePadAxis:${a}`)),n.gamepadButtons.map(a=>p.jsx("span",{className:Ie("text-nowrap",e),children:p.jsxs(Qe,{children:[p.jsx("span",{className:Wt,children:""}),O_(a)]})},`gamePadButton:${a}`)),s&&p.jsx("span",{className:"sprite texture-hud.char.space bg-[currentColor] animate-flash"})]})},N_=({action:t,className:e,keyClassName:r="text-pink zx:text-zxRed"})=>p.jsxs("div",{className:`${e} bg-zxBlack py-oneScaledPix`,children:[p.jsx(D,{className:"me-1",children:"Press"}),p.jsx(D,{className:Ie("me-1",r),children:t}),p.jsx(D,{children:"to continue"}),p.jsxs("div",{className:"flex flex-row gap-1 w-min mx-auto",children:[p.jsx(D,{children:"("}),p.jsx(Ia,{className:"flex flex-row gap-1",keyClassName:r,action:"hold"}),p.jsx(D,{children:")"})]})]}),L_=()=>p.jsx(Ve,{children:p.jsxs(ze,{className:"!h-min !w-max text-center text-zxBlue p-0",children:[p.jsx(D,{className:"block w-min mx-auto px-1 sprites-double-height bg-zxBlack py-oneScaledPix",children:"hold"}),p.jsx("span",{className:"zx",children:p.jsx(N_,{className:`${Ae} px-1`,action:"hold"})})]})}),dr=({className:t,value:e,onClick:r})=>p.jsx(D,{onClick:s=>r?.(s,!e),className:$u("inline-block w-min h-min",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed",t),noSlitWords:!0,children:e?"  ON":"OFF "}),pi="[&_.em]:text-lightBeige zx:[&_.em]:text-zxCyan",G_=`![](texture-animated-head.walking.towards?float-right)**off**: Original *two-tone* spectrum graphics

**on**: *16-colour* palette with colourised sprites`,D_=`pokes cant be set mid-game

**off**: *8* lives to start; extra life rabbits spread thinly through the game

*A true hero leaves this* **off**`,$_="*select the keys*, etc",H_=()=>p.jsxs(Ve,{children:[p.jsx(st,{className:"bg-moss zx:bg-zxGreenDimmed",onClick:W(Te)}),p.jsx(ze,{className:"bg-pinkHalfbrite zx:bg-zxBlue pb-0",children:p.jsx(kr.Provider,{children:p.jsxs("div",{className:"flex flex-col gap-1 overflow-y-scroll scrollbar scrollbar-w-1 min-h-full scrollbar-thumb-lightGrey scrollbar-track-pinkHalfbrite zx:scrollbar-thumb-zxBlack zx:scrollbar-track-zxBlue ",children:[Mt()&&p.jsx(Js,{className:"text-highlightBeige"}),p.jsx(D,{className:"ml-3 text-moss zx:text-zxGreen sprites-double-height block",children:"Options"}),p.jsxs(tt,{className:"text-lightGrey zx:text-zxWhite selectedMenuItem:text-white disabledMenuItem:text-midGrey zx:selectedMenuItem:text-zxGreen",children:[p.jsx(te,{id:"controlOptions",label:"Control options",doubleHeightWhenFocussed:!0,onSelect:W(mt,"controlOptions"),hint:p.jsx(Je,{className:pi,markdown:$_})}),p.jsx(te,{doubleHeightWhenFocussed:!0,id:"colourise",label:"Colourise",valueElement:p.jsx(dr,{value:ba()}),onSelect:W(At,"userSettings.displaySettings.uncolourised"),hint:p.jsx(Je,{className:pi,markdown:G_})}),p.jsx(te,{doubleHeightWhenFocussed:!0,id:"livesModel",label:"Infinite Lives poke",hint:p.jsx(Je,{className:pi,markdown:D_}),valueElement:p.jsx(dr,{value:le(Cb)}),onSelect:W(At,"userSettings.infiniteLivesPoke"),disabled:Ks()}),p.jsx(te,{doubleHeightWhenFocussed:!0,id:"showFps",label:"Show FPS",valueElement:p.jsx(dr,{value:le(vb)}),onSelect:W(At,"userSettings.showFps"),hint:"show frame rate (frames per second) in the top-right corner"}),p.jsx(te,{doubleHeightWhenFocussed:!0,id:"crtFilter",label:"CRT TV effect",valueElement:p.jsx(dr,{value:le(kb)}),onSelect:W(At,"userSettings.displaySettings.crtFilter"),hint:"Subtle screen glow a bit like an old tv"}),p.jsx(te,{doubleHeightWhenFocussed:!0,id:"emulatedResolution",label:"Emulated resolution",onSelect:W(mt,"emulatedResolution")}),p.jsx(br,{}),Mt()||p.jsx(Tt,{})]}),Mt()||p.jsx(en,{className:"text-moss zx:text-zxGreen"})]})})})]}),Ke=({className:t,action:e})=>{const r=le(s=>s.assigningInput?.action===e);return p.jsx(Ia,{className:Ie("flex flex-wrap gap-y-oneScaledPix gap-x-1",t),action:e,keyClassName:"text-pinkHalfbrite zx:text-zxRed selectedMenuItem:text-pink zx:selectedMenuItem:text-zxRed",flashingCursor:r})},_c="text-pink zx:text-zxCyan",W_=()=>{const t=le(e=>e.assigningInput?.action);return t===void 0?null:p.jsxs("div",{className:`
        bg-metallicBlueHalfbrite text-white
        zx:bg-zxBlueDimmed zx:text-zxCyanDimmed

        ${Ae} inline-block absolute inset-x-0 bottom-0 h-min pt-1 px-1`,children:[p.jsx(D,{children:"Press "}),p.jsx(Ia,{className:`inline ${_c}`,action:"menu_openOrExit",keyClassName:"me-1"}),p.jsx(D,{children:"when done selecting keys for "}),p.jsx(D,{className:_c,children:t})]})},Re="sprite zx:sprite-revert-to-two-tone colourised:brightness-halfBrite selectedMenuItem:filter-none zx:selectedMenuItem:sprite-revert-zxYellow",U_="**world**: Control is relative to directions in the isometric world",V_=`**screen**: Control is relative to the screen.

More intuitive if you find directions confusing in isometric games, but requires inputting diagonals a lot`,q_=({className:t})=>p.jsxs("span",{children:[p.jsx(D,{className:Ie("text-nowrap me-1","text-pinkHalfbrite zx:text-zxRed selectedMenuItem:text-pink zx:selectedMenuItem:text-zxRed",t),children:Gs()?"screen":"world"}),p.jsx(D,{className:Ie("text-nowrap","text-moss zx:text-zxBlue selectedMenuItem:text-mossHalfbrite zx:selectedMenuItem:text-zxBlue",t),children:Gs()?"   ":"   "})]}),Y_=()=>{const t=Gs();return p.jsx(te,{id:"screenRelativeControl",label:"axes",leader:p.jsx("span",{className:`${Re} ${t?"texture-heels.walking.towardsRight.2 selectedMenuItem:texture-animated-heels.screenDirections":"texture-heels.walking.right.2 selectedMenuItem:texture-animated-heels.worldDirections"}`}),valueElement:p.jsx(q_,{}),onSelect:W(At,"userSettings.screenRelativeControl"),hintInline:!0,hint:p.jsx(Je,{className:"text-midGrey zx:text-zxBlack",markdown:t?V_:U_})})},X_="**analogue off**: true to the original with *4-way* movement",K_="**analogue on**: move in *any* direction with analogue stick, or *8-way* with d-pad/keys",Z_=()=>{const t=!Eu();Ze({action:"menu_openOrExit",handler:L.useCallback(()=>{ye.dispatch(fb())},[]),disabled:t}),Pw({handler:L.useCallback((e,r)=>{r.currentActionPress("menu_openOrExit")==="released"&&Tu(ye.getState())&&ye.dispatch(xb(e))},[]),disabled:t})},Q_=({className:t})=>{const e=le(_b);return p.jsx(D,{className:Ie("text-nowrap","text-pinkHalfbrite zx:text-zxRed selectedMenuItem:text-pink zx:selectedMenuItem:text-zxRed",t),children:e??"custom"})},J_=()=>p.jsx(te,{id:"analogueControl",label:"Analogue/ 8-way control",leader:p.jsx("span",{className:`${Re} texture-joystick`}),valueElement:p.jsx(dr,{value:Gi()}),onSelect:W(At,"userSettings.analogueControl"),hintInline:!0,hint:p.jsx(Je,{className:"text-midGrey zx:text-zxBlack",markdown:Gi()?K_:X_})}),e0=()=>p.jsx(te,{id:"controlOptions",label:"on-screen controls",valueElement:p.jsx(dr,{value:Rb()}),onSelect:W(At,"userSettings.onScreenControls")}),t0=({showAll:t})=>p.jsxs("div",{className:"text-metallicBlueHalfbrite zx:text-zxBlue",children:[p.jsx(D,{className:`block mb-1 ${Ae}`,children:"Detected that you are on a phone or tablet"}),p.jsx(D,{className:`block mb-1 ${Ae}`,children:"Additional settings for keys and gamepad buttons are designed for desktop/laptops, but you can use them on phones/tablets if you have a keyboard or gamepad connected"}),p.jsx(D,{className:`block mb-1 text-midRed zx:text-zxRed ${Ae} mb-1`,onClick:t,children:"Tap here to show all settings"})]}),r0=()=>{const t=Gs();return p.jsxs(p.Fragment,{children:[p.jsx(te,{id:"preset",label:p.jsx(D,{className:`inline-block w-6 ${Ae}`,children:"key/ button preset"}),valueElement:p.jsx(Q_,{}),onSelect:W(mt,"inputPreset")}),p.jsx(te,{id:"left",label:`Left ${t?"":""}`,leader:p.jsx("span",{className:`${Re} ${t?"texture-head.walking.towardsLeft.2 selectedMenuItem:texture-animated-head.walking.towardsLeft":"texture-head.walking.left.2 selectedMenuItem:texture-animated-head.walking.left"}`}),valueElement:p.jsx(Ke,{action:"left"}),onSelect:W(Ye,"left")}),p.jsx(te,{id:"right",label:`Right ${t?"":""}`,leader:p.jsx("span",{className:`${Re} ${t?"texture-head.walking.awayRight.2 selectedMenuItem:texture-animated-head.walking.awayRight":"texture-head.walking.right.2 selectedMenuItem:texture-animated-head.walking.right"}`}),valueElement:p.jsx(Ke,{action:"right"}),onSelect:W(Ye,"right")}),p.jsx(te,{id:"up",label:`Up ${t?"":""}`,leader:p.jsx("span",{className:`${Re} ${t?"texture-head.walking.awayLeft.2 selectedMenuItem:texture-animated-head.walking.awayLeft":"texture-head.walking.away.2 selectedMenuItem:texture-animated-head.walking.away"}`}),valueElement:p.jsx(Ke,{action:"away"}),onSelect:W(Ye,"away")}),p.jsx(te,{id:"down",label:`Down ${t?"":""}`,leader:p.jsx("span",{className:`${Re} ${t?"texture-head.walking.towardsRight.2 selectedMenuItem:texture-animated-head.walking.towardsRight":"texture-head.walking.towards.2 selectedMenuItem:texture-animated-head.walking.towards"}`}),valueElement:p.jsx(Ke,{action:"towards"}),onSelect:W(Ye,"towards")}),p.jsxs("div",{className:`${Ae} col-span-3`,children:[p.jsx(D,{className:"text-midRed bg-pureBlack inline-block zx:text-zxRed zx:bg-zxYellow me-1",children:"Note:"}),p.jsx(D,{className:"text-midGrey zx:text-zxBlack",children:"some puzzles require you to jump and pick up simultaneously - assign a key for both jump and carry"})]}),p.jsx(te,{id:"jump",label:"Jump",leader:p.jsx("span",{className:`${Re} texture-spring.released selectedMenuItem:texture-spring.compressed`}),valueElement:p.jsx(Ke,{action:"jump"}),onSelect:W(Ye,"jump")}),p.jsx(te,{id:"carry",label:"Carry",leader:p.jsx("span",{className:`${Re} texture-bag`}),valueElement:p.jsx(Ke,{action:"carry"}),onSelect:W(Ye,"carry"),hint:p.jsx(Je,{className:"text-midGrey zx:text-zxBlack",markdown:"**heels only**. requires the bag"}),hintInline:!0}),p.jsx(te,{id:"fire",label:p.jsx(D,{className:`inline-block w-6 ${Ae}`,children:"fire dough- nuts"}),leader:p.jsx("span",{className:`${Re} texture-doughnuts`}),hint:p.jsx(Je,{className:"text-midGrey zx:text-zxBlack",markdown:"**head only**. requires the hooter"}),hintInline:!0,valueElement:p.jsx(Ke,{action:"fire"}),onSelect:W(Ye,"fire")}),p.jsx(te,{id:"swop",label:"Swop",valueElement:p.jsx(Ke,{action:"swop"}),onSelect:W(Ye,"swop"),hint:p.jsx(Je,{className:"text-midGrey zx:text-zxBlack",markdown:"Like the swop key from the original game; *cycles through* the characters, Moves *in and out of symbiosis* if head is on top of heels"}),hintInline:!0,leader:p.jsxs("span",{className:`${Re} texture-blank relative overflow-hidden`,children:[p.jsx("span",{className:`${Re} texture-head.walking.towardsRight.2 selectedMenuItem:texture-animated-head.walking.towardsRight absolute right-[50%]`}),p.jsx("span",{className:`${Re} texture-heels.walking.towardsRight.2 selectedMenuItem:texture-animated-heels.walking.towardsRight absolute left-[50%]`})]})}),p.jsx(te,{id:"swopHead",label:p.jsx(D,{className:`inline-block w-6 ${Ae}`,children:"Swop to head"}),valueElement:p.jsx(Ke,{action:"swop.head"}),onSelect:W(Ye,"swop.head"),hint:p.jsx(Je,{className:"text-midGrey zx:text-zxBlack",markdown:"**shortcut**: go *directly* to *head*, avoiding cycling if in symbiosis"}),hintInline:!0,leader:p.jsx("span",{className:`${Re} texture-head.walking.towardsRight.2 selectedMenuItem:texture-animated-head.walking.towardsRight`})}),p.jsx(te,{id:"swopHeels",label:p.jsxs("div",{className:`w-6 ${Ae}`,children:[p.jsx(D,{className:"me-1",children:"Swop to"}),p.jsx(D,{className:"text-pinkHalfbrite selectedMenuItem:text-pink",children:"heels"})]}),valueElement:p.jsx(Ke,{action:"swop.heels"}),onSelect:W(Ye,"swop.heels"),hint:p.jsx(Je,{className:"text-midGrey zx:text-zxBlack",markdown:"**shortcut**: go *directly* to *heels*, avoiding cycling if in symbiosis"}),hintInline:!0,leader:p.jsx("span",{className:`${Re} texture-heels.walking.towardsRight.2 selectedMenuItem:texture-animated-heels.walking.towardsRight`})}),p.jsx(te,{id:"hold",label:"Pause",valueElement:p.jsx(Ke,{action:"hold"}),onSelect:W(Ye,"hold")}),p.jsx(te,{id:"toggleColourisation",label:p.jsx(D,{className:`inline-block w-6 ${Ae}`,children:"toggle colour- isation"}),valueElement:p.jsx(Ke,{action:"toggleColourisation"}),onSelect:W(Ye,"toggleColourisation")})]})},vc="text-metallicBlueHalfbrite zx:text-zxBlue selectedMenuItem:text-metallicBlue zx:selectedMenuItem:text-zxGreen !gap-y-1 !sprites-normal-height",s0=()=>{Z_();const[t,e]=L.useState(!Mt()),r=Gi();return p.jsxs(Ve,{children:[p.jsx(st,{className:"bg-lightGrey zx:bg-zxRedDimmed",onClick:W(Te)}),p.jsxs(ze,{className:"bg-white zx:bg-zxWhite pr-0 !h-tallDialog !w-wideDialog max-w-widestDialog resGameboy:!w-full resGameboy:!h-full",children:[p.jsxs("div",{className:"flex flex-col gap-y-1 overflow-y-scroll scrollbar  scrollbar-w-1 scrollbar-thumb-midGrey scrollbar-track-white zx:scrollbar-thumb-zxBlue zx:scrollbar-track-zxWhite ",children:[Mt()&&p.jsx(Js,{className:"mb-1"}),p.jsx(D,{className:"text-midRed zx:text-zxBlue sprites-double-height block",children:"control options"}),p.jsxs(tt,{className:vc,children:[p.jsx(J_,{}),p.jsx(e0,{}),r&&t&&p.jsx(Y_,{})]}),t?p.jsxs(p.Fragment,{children:[p.jsx(D,{className:"text-midRed zx:text-zxBlue sprites-double-height mt-1 block col-span-3",children:"Select the keys"}),p.jsxs(tt,{className:vc,children:[p.jsx(r0,{}),Mt()||p.jsx(Tt,{})]})]}):p.jsx(p.Fragment,{children:p.jsx(t0,{showAll:()=>e(!0)})})]}),p.jsx(W_,{})]})]})},n0=({presetName:t})=>p.jsx(te,{id:t,label:t,doubleHeightWhenFocussed:!0,hint:xr[t].description,onSelect:W(yb,t)},t),i0=()=>p.jsxs(Ve,{children:[p.jsx(st,{className:"bg-midGrey zx:bg-zxWhiteDimmed",onClick:W(Te)}),p.jsx(ze,{className:"bg-white",children:p.jsxs(kr.Provider,{children:[p.jsx(D,{className:"text-midRed zx:text-zxRed sprites-double-height ml-3",children:"Key presets"}),p.jsxs(tt,{className:"text-metallicBlue zx:text-zxBlue selectedMenuItem:text-moss zx:selectedMenuItem:text-zxMagenta",children:[ha(xr).map(t=>p.jsx(n0,{presetName:t},t)),p.jsx(br,{}),p.jsx(Tt,{})]}),p.jsx(en,{className:"text-midGrey zx:text-zxMagenta"})]})})]}),a0=()=>p.jsxs(Ve,{children:[p.jsx(st,{className:"bg-pureBlack zx:bg-zxBlack"}),p.jsx(ze,{className:"bg-pureBlack w-zx h-full block p-0",onClick:W(Te),children:p.jsxs("div",{className:"flex flex-col gap-3 items-center",children:[p.jsxs("div",{className:"flex gap-7",children:[p.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center me-1",children:[p.jsx("span",{className:"sprite texture-crown.blacktooth zx:sprite-revert-zxYellow"}),p.jsx("span",{className:"sprite zx:sprite-revert-zxYellow texture-animated-head.idle.right hover:texture-animated-head.walking.right relative z-topSprite"})]}),p.jsxs("div",{className:"flex flex-col items-center me-1",children:[p.jsx("span",{className:"sprite texture-crown.blacktooth zx:sprite-revert-zxYellow"}),p.jsx("span",{className:"sprite zx:sprite-revert-zxYellow texture-heels.walking.towards.2 hover:texture-animated-heels.walking.towards relative z-topSprite"})]})]}),p.jsxs("div",{className:"flex flex-col gap-1 items-center text-lightGrey zx:text-zxCyan",children:[p.jsx(D,{children:"The people salute your heroism"}),p.jsx(D,{children:"and proclaim you"})]}),p.jsx(D,{className:"text-highlightBeige sprites-double-height",classnameCycle:["text-pink zx:text-zxMagenta","text-metallicBlue zx:text-zxCyan","text-highlightBeige zx:text-zxYellow"],children:"EMPEROR"}),p.jsx(tt,{className:"hidden",children:p.jsx(Tt,{})})]})})]}),o0=t=>t.replace(/([a-z])([A-Z])/g,"$1 $2"),l0=({resolutionName:t})=>{const e=le(ya),r=tr[t];return p.jsx(te,{id:t,label:`${e===t?"* ":""}${o0(t)}`,doubleHeightWhenFocussed:!0,hint:`${r.x} x ${r.y}`,onSelect:W(Mu,t)},t)},c0=()=>p.jsxs(Ve,{children:[p.jsx(st,{className:"bg-midGrey zx:bg-zxWhiteDimmed",onClick:W(Te)}),p.jsx(ze,{className:"bg-white",children:p.jsxs(kr.Provider,{children:[p.jsx(D,{className:"text-midRed zx:text-zxRed sprites-double-height ml-3",children:"Emulated resolution"}),p.jsxs(tt,{className:"text-metallicBlue zx:text-zxBlue selectedMenuItem:text-moss zx:selectedMenuItem:text-zxMagenta",children:[ha(tr).map(t=>p.jsx(l0,{resolutionName:t})),p.jsx(br,{}),p.jsx(Tt,{})]}),p.jsx(en,{className:"text-midGrey zx:text-zxMagenta"})]})})]}),h0=()=>p.jsxs(Ve,{children:[p.jsx(st,{className:"loading-border zx:zx-loading-border"}),p.jsx(ze,{className:"bg-pink zx:bg-zxMagenta text-zxBlack !h-tallDialog !w-wideDialog !py-1",children:p.jsxs("div",{className:`flex flex-col gap-y-1 ${Ae}`,children:[p.jsx(D,{className:"sprites-double-height text-white",children:"Wrong Orientation!"}),p.jsx(D,{children:"Your TV appears to be on its side!"}),p.jsx(D,{children:"Put into landscape to play."}),p.jsx(D,{children:"If already in landscape, sorry, put into portrait and back again."})]})})]}),u0=t=>t.startsWith("markdown/"),d0=t=>{const e=le(r=>r.openMenus.at(0)?.menuId);if(e===void 0)return null;if(u0(e))return p.jsx(C_,{pageName:e.slice(9)});switch(e){case"mainMenu":return p.jsx(R_,{});case"quitGameConfirm":return p.jsx(j_,{});case"readTheManual":return p.jsx(y_,{});case"crowns":return p.jsx(I_,{});case"score":return p.jsx(B_,{});case"hold":return p.jsx(L_,{});case"modernisationOptions":return p.jsx(H_,{});case"emulatedResolution":return p.jsx(c0,{});case"controlOptions":return p.jsx(s0,{});case"inputPreset":return p.jsx(i0,{});case"proclaimEmperor":return p.jsx(a0,{});case"wrongOrientation":return p.jsx(h0,{});default:return p.jsx(ze,{children:p.jsx(D,{children:`unknown dialog ${e}`})})}},f0=Qr(()=>Qt(()=>import("./Cheats-DOLS9EwM.js"),__vite__mapDeps([6,4,5,7]))),p0=Qr(()=>Qt(()=>import("./gameMain-B-ChBClz.js").then(t=>t.g),__vite__mapDeps([8,7,4,5,2]))),m0=Qr(()=>Qt(()=>Promise.resolve().then(()=>Ux),void 0)),g0=Qr(()=>Qt(()=>import("./testCampaign-D0dDCSKu.js"),__vite__mapDeps([9,4,5]))),x0=L.lazy(f0),y0=()=>{const[t,e]=L.useState(),r=Ks(),s=Ca(),n=Iu();return L.useEffect(()=>{if(!r){e(void 0);return}let i=!1,a;return(async()=>{const[l,c,h,u]=await Promise.all([m0(),p0(),Vu(),n?g0():void 0]);await l.load();const f=n?{rooms:{...h.campaign.rooms,...u?.testCampaign.rooms}}:h.campaign;a=await c.default(f,s),i?a.stop():e(a)})(),()=>{a?.stop(),i=!0}},[n,r,s]),t},Sc=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,b0=()=>{const t=Sb();L.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",He())},[]),L.useEffect(()=>{for(const e of Object.keys(tr))document.body.classList.remove(Sc(e));document.body.classList.add(Sc(t))},[t])},w0=()=>{const[t,e]=L.useState(null),r=Iu(),s=y0(),{cssUpscale:n,canvasSize:i}=le(a=>a.upscale);return b0(),L.useEffect(()=>{t===null||s===void 0||(s.renderIn(t),t.addEventListener("touchstart",a=>a.preventDefault(),{passive:!1}))},[s,t]),L.useEffect(()=>{s?.resizeTo(i)},[i,s]),p.jsxs(p.Fragment,{children:[p.jsx("div",{style:{transform:`scale3d(${n}, ${n}, 1)`,width:i.x,height:i.y},className:"origin-top-left",ref:e}),p.jsx(Tw,{}),p.jsxs(jb,{gameApi:s,children:[p.jsx(d0,{}),s&&r&&p.jsx(L.Suspense,{fallback:null,children:p.jsx(x0,{})})]})]})},_0=()=>{const t=ba();return L.useEffect(()=>{document.body.classList.toggle("zx",!t),document.body.classList.toggle("colourised",t)},[t]),p.jsxs(Di,{children:[p.jsx(Na,{path:"/",children:p.jsx(Cw,{children:p.jsx(w0,{})})}),p.jsx(Na,{path:"/sprites",children:p.jsx(Di,{children:p.jsx(Vx,{})})})]})},v0=()=>p.jsx(cy,{store:ye,children:p.jsx(_0,{})}),iv=Object.freeze(Object.defineProperty({__proto__:null,App:v0},Symbol.toStringTag,{value:"Module"}));export{B0 as $,Qi as A,je as B,Jr as C,be as D,U as E,J as F,$t as G,rs as H,T0 as I,I0 as J,Jh as K,ur as L,ee as M,Zo as N,Ou as O,Me as P,vt as Q,Ai as R,ip as S,gt as T,Es as U,ff as V,Wg as W,P0 as X,ye as Y,tv as Z,Jt as _,$g as a,Ug as a$,Qh as a0,W0 as a1,qt as a2,qg as a3,Vg as a4,V0 as a5,Ed as a6,$s as a7,dh as a8,$p as a9,Di as aA,Q0 as aB,J0 as aC,cu as aD,dr as aE,Y0 as aF,X0 as aG,De as aH,Yr as aI,Go as aJ,ts as aK,Us as aL,Fu as aM,Yt as aN,D0 as aO,wb as aP,yw as aQ,qh as aR,ww as aS,O0 as aT,rv as aU,Vt as aV,$0 as aW,U0 as aX,q0 as aY,Z0 as aZ,M0 as a_,kt as aa,Hc as ab,ot as ac,cf as ad,Qa as ae,Ur as af,Bf as ag,xe as ah,ge as ai,eo as aj,pn as ak,ro as al,df as am,ke as an,Vc as ao,up as ap,Tp as aq,Rp as ar,Op as as,Lp as at,Gp as au,Uu as av,ev as aw,nv as ax,$u as ay,Qu as az,H0 as b,hr as b0,E0 as b1,N0 as b2,es as b3,Dg as b4,Gg as b5,ru as b6,At as b7,F as b8,vb as b9,pe as bA,Rd as bB,Ts as bC,Ti as bD,$o as bE,Eh as bF,iv as bG,F0 as ba,C0 as bb,pb as bc,R0 as bd,j0 as be,z0 as bf,wx as bg,Wr as bh,Rx as bi,Wi as bj,sv as bk,Fe as bl,ub as bm,pt as bn,Mb as bo,Ab as bp,K0 as bq,He as br,Eb as bs,Td as bt,Om as bu,Mh as bv,mo as bw,fo as bx,Wo as by,Hm as bz,G0 as c,me as d,xt as e,Be as f,rp as g,po as h,Vr as i,Cs as j,Zi as k,rh as l,yt as m,gh as n,Lo as o,Hg as p,Ip as q,Ud as r,tu as s,Ep as t,zp as u,Pe as v,ue as w,Np as x,yh as y,L0 as z};
