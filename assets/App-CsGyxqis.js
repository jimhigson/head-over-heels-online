const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-DBviOc1Y.js","assets/webworkerAll-D4Bh_Md5.js","assets/Graphics-Bcxt4NpK.js","assets/colorToUniform-KTpA7KSL.js","assets/index-DfSwvxid.js","assets/index-CBEmO78A.css","assets/Cheats-GZhzM3GR.js","assets/swopCharacters-BmlklOFv.js","assets/gameMain-BtT6FEo_.js","assets/testCampaign-B8B8LZQI.js"])))=>i.map(i=>d[i]);
import{b as or,r as D,R as Ru,_ as Wt,g as Ye,j as m,d as uc,i as Xr}from"./index-DfSwvxid.js";function ju(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var r,s,n,i,o=[],a="",l=t.split("/");for(l[0]||l.shift();n=l.shift();)r=n[0],r==="*"?(o.push(r),a+=n[1]==="?"?"(?:/(.*))?":"/(.*)"):r===":"?(s=n.indexOf("?",1),i=n.indexOf(".",1),o.push(n.substring(1,~s?s:~i?i:n.length)),a+=~s&&!~i?"(?:/([^/]+?))?":"/([^/]+?)",~i&&(a+=(~s?"?":"")+"\\"+n.substring(i))):a+="/"+n;return{keys:o,pattern:new RegExp("^"+a+(e?"(?=$|/)":"/?$"),"i")}}var qs={exports:{}},Ys={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Co;function Bu(){if(Co)return Ys;Co=1;var t=or();function e(u,f){return u===f&&(u!==0||1/u===1/f)||u!==u&&f!==f}var r=typeof Object.is=="function"?Object.is:e,s=t.useState,n=t.useEffect,i=t.useLayoutEffect,o=t.useDebugValue;function a(u,f){var d=f(),g=s({inst:{value:d,getSnapshot:f}}),y=g[0].inst,p=g[1];return i(function(){y.value=d,y.getSnapshot=f,l(y)&&p({inst:y})},[u,d,f]),n(function(){return l(y)&&p({inst:y}),u(function(){l(y)&&p({inst:y})})},[u]),o(d),d}function l(u){var f=u.getSnapshot;u=u.value;try{var d=f();return!r(u,d)}catch{return!0}}function c(u,f){return f()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return Ys.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:h,Ys}var Po;function zu(){return Po||(Po=1,qs.exports=Bu()),qs.exports}var Fu=zu();const Ou=Ru.useInsertionEffect,Nu=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Lu=Nu?D.useLayoutEffect:D.useEffect,Du=Ou||Lu,dc=t=>{const e=D.useRef([t,(...r)=>e[0](...r)]).current;return Du(()=>{e[0]=t}),e[1]},Gu="popstate",Oi="pushState",Ni="replaceState",Wu="hashchange",Mo=[Gu,Oi,Ni,Wu],Hu=t=>{for(const e of Mo)addEventListener(e,t);return()=>{for(const e of Mo)removeEventListener(e,t)}},fc=(t,e)=>Fu.useSyncExternalStore(Hu,t,e),$u=()=>location.search,Uu=({ssrSearch:t=""}={})=>fc($u,()=>t),To=()=>location.pathname,Vu=({ssrPath:t}={})=>fc(To,t?()=>t:To),qu=(t,{replace:e=!1,state:r=null}={})=>history[e?Ni:Oi](r,"",t),Yu=(t={})=>[Vu(t),qu],Io=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[Io]>"u"){for(const t of[Oi,Ni]){const e=history[t];history[t]=function(){const r=e.apply(this,arguments),s=new Event(t);return s.arguments=arguments,dispatchEvent(s),r}}Object.defineProperty(window,Io,{value:!0})}const Xu=(t,e)=>e.toLowerCase().indexOf(t.toLowerCase())?"~"+e:e.slice(t.length)||"/",pc=(t="")=>t==="/"?"":t,Ku=(t,e)=>t[0]==="~"?t.slice(1):pc(e)+t,Zu=(t="",e)=>Xu(Eo(pc(t)),Eo(e)),Eo=t=>{try{return decodeURI(t)}catch{return t}},mc={hook:Yu,searchHook:Uu,parser:ju,base:"",ssrPath:void 0,ssrSearch:void 0,hrefs:t=>t},gc=D.createContext(mc),Li=()=>D.useContext(gc),yc={},xc=D.createContext(yc),Qu=()=>D.useContext(xc),bc=t=>{const[e,r]=t.hook(t);return[Zu(t.base,e),dc((s,n)=>r(Ku(s,t.base),n))]},Ju=(t,e,r,s)=>{const{pattern:n,keys:i}=e instanceof RegExp?{keys:!1,pattern:e}:t(e||"*",s),o=n.exec(r)||[],[a,...l]=o;return a!==void 0?[!0,(()=>{const c=i!==!1?Object.fromEntries(i.map((u,f)=>[u,l[f]])):o.groups;let h={...l};return c&&Object.assign(h,c),h})(),...s?[a]:[]]:[!1,null]},ed=({children:t,...e})=>{const r=Li(),s=e.hook?mc:r;let n=s;const[i,o]=e.ssrPath?.split("?")??[];o&&(e.ssrSearch=o,e.ssrPath=i),e.hrefs=e.hrefs??e.hook?.hrefs;let a=D.useRef({}),l=a.current,c=l;for(let h in s){const u=h==="base"?s[h]+(e[h]||""):e[h]||s[h];l===c&&u!==c[h]&&(a.current=c={...c}),c[h]=u,u!==s[h]&&(n=c)}return D.createElement(gc.Provider,{value:n,children:t})},Ro=({children:t,component:e},r)=>e?D.createElement(e,{params:r}):typeof t=="function"?t(r):t,td=t=>{let e=D.useRef(yc),r=e.current;for(const s in t)t[s]!==r[s]&&(r=t);return Object.keys(t).length===0&&(r=t),e.current=r},jo=({path:t,nest:e,match:r,...s})=>{const n=Li(),[i]=bc(n),[o,a,l]=r??Ju(n.parser,t,i,e),c=td({...Qu(),...a});if(!o)return null;const h=l?D.createElement(ed,{base:l},Ro(s,c)):Ro(s,c);return D.createElement(xc.Provider,{value:c,children:h})};D.forwardRef((t,e)=>{const r=Li(),[s,n]=bc(r),{to:i="",href:o=i,onClick:a,asChild:l,children:c,className:h,replace:u,state:f,...d}=t,g=dc(p=>{p.ctrlKey||p.metaKey||p.altKey||p.shiftKey||p.button!==0||(a?.(p),p.defaultPrevented||(p.preventDefault(),n(o,t)))}),y=r.hrefs(o[0]==="~"?o.slice(1):r.base+o,r);return l&&D.isValidElement(c)?D.cloneElement(c,{onClick:g,href:y}):D.createElement("a",{...d,onClick:g,href:y,className:h?.call?h(s===o):h,children:c,ref:e})});var $=(t=>(t.Application="application",t.WebGLPipes="webgl-pipes",t.WebGLPipesAdaptor="webgl-pipes-adaptor",t.WebGLSystem="webgl-system",t.WebGPUPipes="webgpu-pipes",t.WebGPUPipesAdaptor="webgpu-pipes-adaptor",t.WebGPUSystem="webgpu-system",t.CanvasSystem="canvas-system",t.CanvasPipesAdaptor="canvas-pipes-adaptor",t.CanvasPipes="canvas-pipes",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t.MaskEffect="mask-effect",t.BlendMode="blend-mode",t.TextureSource="texture-source",t.Environment="environment",t.ShapeBuilder="shape-builder",t.Batcher="batcher",t))($||{});const ci=t=>{if(typeof t=="function"||typeof t=="object"&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={...typeof t.extension!="object"?{type:t.extension}:t.extension,ref:t}}if(typeof t=="object")t={...t};else throw new Error("Invalid extension type");return typeof t.type=="string"&&(t.type=[t.type]),t},ts=(t,e)=>ci(t).priority??e,We={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(ci).forEach(e=>{e.type.forEach(r=>this._removeHandlers[r]?.(e))}),this},add(...t){return t.map(ci).forEach(e=>{e.type.forEach(r=>{const s=this._addHandlers,n=this._queue;s[r]?s[r]?.(e):(n[r]=n[r]||[],n[r]?.push(e))})}),this},handle(t,e,r){const s=this._addHandlers,n=this._removeHandlers;if(s[t]||n[t])throw new Error(`Extension type ${t} already has a handler`);s[t]=e,n[t]=r;const i=this._queue;return i[t]&&(i[t]?.forEach(o=>e(o)),delete i[t]),this},handleByMap(t,e){return this.handle(t,r=>{r.name&&(e[r.name]=r.ref)},r=>{r.name&&delete e[r.name]})},handleByNamedList(t,e,r=-1){return this.handle(t,s=>{e.findIndex(i=>i.name===s.name)>=0||(e.push({name:s.name,value:s.ref}),e.sort((i,o)=>ts(o.value,r)-ts(i.value,r)))},s=>{const n=e.findIndex(i=>i.name===s.name);n!==-1&&e.splice(n,1)})},handleByList(t,e,r=-1){return this.handle(t,s=>{e.includes(s.ref)||(e.push(s.ref),e.sort((n,i)=>ts(i,r)-ts(n,r)))},s=>{const n=e.indexOf(s.ref);n!==-1&&e.splice(n,1)})}},rd={extension:{type:$.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Wt(()=>import("./browserAll-DBviOc1Y.js"),__vite__mapDeps([0,1,2,3,4,5]))}},sd={extension:{type:$.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await Wt(()=>import("./webworkerAll-D4Bh_Md5.js"),__vite__mapDeps([1,2,3,4,5]))}};class Fe{constructor(e,r,s){this._x=r||0,this._y=s||0,this._observer=e}clone(e){return new Fe(e??this._observer,this._x,this._y)}set(e=0,r=e){return(this._x!==e||this._y!==r)&&(this._x=e,this._y=r,this._observer._onUpdate(this)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this._observer._onUpdate(this)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=0 y=0 scope=${this._observer}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this._observer._onUpdate(this))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this._observer._onUpdate(this))}}var Xs={exports:{}},Bo;function nd(){return Bo||(Bo=1,function(t){var e=Object.prototype.hasOwnProperty,r="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(r=!1));function n(l,c,h){this.fn=l,this.context=c,this.once=h||!1}function i(l,c,h,u,f){if(typeof h!="function")throw new TypeError("The listener must be a function");var d=new n(h,u||l,f),g=r?r+c:c;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],d]:l._events[g].push(d):(l._events[g]=d,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new s:delete l._events[c]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],h,u;if(this._eventsCount===0)return c;for(u in h=this._events)e.call(h,u)&&c.push(r?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},a.prototype.listeners=function(c){var h=r?r+c:c,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var f=0,d=u.length,g=new Array(d);f<d;f++)g[f]=u[f].fn;return g},a.prototype.listenerCount=function(c){var h=r?r+c:c,u=this._events[h];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,h,u,f,d,g){var y=r?r+c:c;if(!this._events[y])return!1;var p=this._events[y],_=arguments.length,b,S;if(p.fn){switch(p.once&&this.removeListener(c,p.fn,void 0,!0),_){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,h),!0;case 3:return p.fn.call(p.context,h,u),!0;case 4:return p.fn.call(p.context,h,u,f),!0;case 5:return p.fn.call(p.context,h,u,f,d),!0;case 6:return p.fn.call(p.context,h,u,f,d,g),!0}for(S=1,b=new Array(_-1);S<_;S++)b[S-1]=arguments[S];p.fn.apply(p.context,b)}else{var P=p.length,E;for(S=0;S<P;S++)switch(p[S].once&&this.removeListener(c,p[S].fn,void 0,!0),_){case 1:p[S].fn.call(p[S].context);break;case 2:p[S].fn.call(p[S].context,h);break;case 3:p[S].fn.call(p[S].context,h,u);break;case 4:p[S].fn.call(p[S].context,h,u,f);break;default:if(!b)for(E=1,b=new Array(_-1);E<_;E++)b[E-1]=arguments[E];p[S].fn.apply(p[S].context,b)}}return!0},a.prototype.on=function(c,h,u){return i(this,c,h,u,!1)},a.prototype.once=function(c,h,u){return i(this,c,h,u,!0)},a.prototype.removeListener=function(c,h,u,f){var d=r?r+c:c;if(!this._events[d])return this;if(!h)return o(this,d),this;var g=this._events[d];if(g.fn)g.fn===h&&(!f||g.once)&&(!u||g.context===u)&&o(this,d);else{for(var y=0,p=[],_=g.length;y<_;y++)(g[y].fn!==h||f&&!g[y].once||u&&g[y].context!==u)&&p.push(g[y]);p.length?this._events[d]=p.length===1?p[0]:p:o(this,d)}return this},a.prototype.removeAllListeners=function(c){var h;return c?(h=r?r+c:c,this._events[h]&&o(this,h)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}(Xs)),Xs.exports}var id=nd();const ot=Ye(id),od=Math.PI*2,ad=180/Math.PI,ld=Math.PI/180;class Pe{constructor(e=0,r=0){this.x=0,this.y=0,this.x=e,this.y=r}clone(){return new Pe(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,r=e){return this.x=e,this.y=r,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return Ks.x=0,Ks.y=0,Ks}}const Ks=new Pe;class re{constructor(e=1,r=0,s=0,n=1,i=0,o=0){this.array=null,this.a=e,this.b=r,this.c=s,this.d=n,this.tx=i,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,r,s,n,i,o){return this.a=e,this.b=r,this.c=s,this.d=n,this.tx=i,this.ty=o,this}toArray(e,r){this.array||(this.array=new Float32Array(9));const s=r||this.array;return e?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(e,r){r=r||new Pe;const s=e.x,n=e.y;return r.x=this.a*s+this.c*n+this.tx,r.y=this.b*s+this.d*n+this.ty,r}applyInverse(e,r){r=r||new Pe;const s=this.a,n=this.b,i=this.c,o=this.d,a=this.tx,l=this.ty,c=1/(s*o+i*-n),h=e.x,u=e.y;return r.x=o*c*h+-i*c*u+(l*i-a*o)*c,r.y=s*c*u+-n*c*h+(-l*s+a*n)*c,r}translate(e,r){return this.tx+=e,this.ty+=r,this}scale(e,r){return this.a*=e,this.d*=r,this.c*=e,this.b*=r,this.tx*=e,this.ty*=r,this}rotate(e){const r=Math.cos(e),s=Math.sin(e),n=this.a,i=this.c,o=this.tx;return this.a=n*r-this.b*s,this.b=n*s+this.b*r,this.c=i*r-this.d*s,this.d=i*s+this.d*r,this.tx=o*r-this.ty*s,this.ty=o*s+this.ty*r,this}append(e){const r=this.a,s=this.b,n=this.c,i=this.d;return this.a=e.a*r+e.b*n,this.b=e.a*s+e.b*i,this.c=e.c*r+e.d*n,this.d=e.c*s+e.d*i,this.tx=e.tx*r+e.ty*n+this.tx,this.ty=e.tx*s+e.ty*i+this.ty,this}appendFrom(e,r){const s=e.a,n=e.b,i=e.c,o=e.d,a=e.tx,l=e.ty,c=r.a,h=r.b,u=r.c,f=r.d;return this.a=s*c+n*u,this.b=s*h+n*f,this.c=i*c+o*u,this.d=i*h+o*f,this.tx=a*c+l*u+r.tx,this.ty=a*h+l*f+r.ty,this}setTransform(e,r,s,n,i,o,a,l,c){return this.a=Math.cos(a+c)*i,this.b=Math.sin(a+c)*i,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(s*this.a+n*this.c),this.ty=r-(s*this.b+n*this.d),this}prepend(e){const r=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const s=this.a,n=this.c;this.a=s*e.a+this.b*e.c,this.b=s*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=r*e.a+this.ty*e.c+e.tx,this.ty=r*e.b+this.ty*e.d+e.ty,this}decompose(e){const r=this.a,s=this.b,n=this.c,i=this.d,o=e.pivot,a=-Math.atan2(-n,i),l=Math.atan2(s,r),c=Math.abs(a+l);return c<1e-5||Math.abs(od-c)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(r*r+s*s),e.scale.y=Math.sqrt(n*n+i*i),e.position.x=this.tx+(o.x*r+o.y*n),e.position.y=this.ty+(o.x*s+o.y*i),e}invert(){const e=this.a,r=this.b,s=this.c,n=this.d,i=this.tx,o=e*n-r*s;return this.a=n/o,this.b=-r/o,this.c=-s/o,this.d=e/o,this.tx=(s*this.ty-n*i)/o,this.ty=-(e*this.ty-r*i)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new re;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}equals(e){return e.a===this.a&&e.b===this.b&&e.c===this.c&&e.d===this.d&&e.tx===this.tx&&e.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return hd.identity()}static get shared(){return cd.identity()}}const cd=new re,hd=new re,Mt=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Tt=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],It=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Et=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],hi=[],_c=[],rs=Math.sign;function ud(){for(let t=0;t<16;t++){const e=[];hi.push(e);for(let r=0;r<16;r++){const s=rs(Mt[t]*Mt[r]+It[t]*Tt[r]),n=rs(Tt[t]*Mt[r]+Et[t]*Tt[r]),i=rs(Mt[t]*It[r]+It[t]*Et[r]),o=rs(Tt[t]*It[r]+Et[t]*Et[r]);for(let a=0;a<16;a++)if(Mt[a]===s&&Tt[a]===n&&It[a]===i&&Et[a]===o){e.push(a);break}}}for(let t=0;t<16;t++){const e=new re;e.set(Mt[t],Tt[t],It[t],Et[t],0,0),_c.push(e)}}ud();const he={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>Mt[t],uY:t=>Tt[t],vX:t=>It[t],vY:t=>Et[t],inv:t=>t&8?t&15:-t&7,add:(t,e)=>hi[t][e],sub:(t,e)=>hi[t][he.inv(e)],rotate180:t=>t^4,isVertical:t=>(t&3)===2,byDirection:(t,e)=>Math.abs(t)*2<=Math.abs(e)?e>=0?he.S:he.N:Math.abs(e)*2<=Math.abs(t)?t>0?he.E:he.W:e>0?t>0?he.SE:he.SW:t>0?he.NE:he.NW,matrixAppendRotationInv:(t,e,r=0,s=0)=>{const n=_c[he.inv(e)];n.tx=r,n.ty=s,t.append(n)}},ss=[new Pe,new Pe,new Pe,new Pe];class me{constructor(e=0,r=0,s=0,n=0){this.type="rectangle",this.x=Number(e),this.y=Number(r),this.width=Number(s),this.height=Number(n)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new me(0,0,0,0)}clone(){return new me(this.x,this.y,this.width,this.height)}copyFromBounds(e){return this.x=e.minX,this.y=e.minY,this.width=e.maxX-e.minX,this.height=e.maxY-e.minY,this}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,r){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&r>=this.y&&r<this.y+this.height}strokeContains(e,r,s,n=.5){const{width:i,height:o}=this;if(i<=0||o<=0)return!1;const a=this.x,l=this.y,c=s*(1-n),h=s-c,u=a-c,f=a+i+c,d=l-c,g=l+o+c,y=a+h,p=a+i-h,_=l+h,b=l+o-h;return e>=u&&e<=f&&r>=d&&r<=g&&!(e>y&&e<p&&r>_&&r<b)}intersects(e,r){if(!r){const z=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=z)return!1;const j=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>j}const s=this.left,n=this.right,i=this.top,o=this.bottom;if(n<=s||o<=i)return!1;const a=ss[0].set(e.left,e.top),l=ss[1].set(e.left,e.bottom),c=ss[2].set(e.right,e.top),h=ss[3].set(e.right,e.bottom);if(c.x<=a.x||l.y<=a.y)return!1;const u=Math.sign(r.a*r.d-r.b*r.c);if(u===0||(r.apply(a,a),r.apply(l,l),r.apply(c,c),r.apply(h,h),Math.max(a.x,l.x,c.x,h.x)<=s||Math.min(a.x,l.x,c.x,h.x)>=n||Math.max(a.y,l.y,c.y,h.y)<=i||Math.min(a.y,l.y,c.y,h.y)>=o))return!1;const f=u*(l.y-a.y),d=u*(a.x-l.x),g=f*s+d*i,y=f*n+d*i,p=f*s+d*o,_=f*n+d*o;if(Math.max(g,y,p,_)<=f*a.x+d*a.y||Math.min(g,y,p,_)>=f*h.x+d*h.y)return!1;const b=u*(a.y-c.y),S=u*(c.x-a.x),P=b*s+S*i,E=b*n+S*i,M=b*s+S*o,I=b*n+S*o;return!(Math.max(P,E,M,I)<=b*a.x+S*a.y||Math.min(P,E,M,I)>=b*h.x+S*h.y)}pad(e=0,r=e){return this.x-=e,this.y-=r,this.width+=e*2,this.height+=r*2,this}fit(e){const r=Math.max(this.x,e.x),s=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),i=Math.min(this.y+this.height,e.y+e.height);return this.x=r,this.width=Math.max(s-r,0),this.y=n,this.height=Math.max(i-n,0),this}ceil(e=1,r=.001){const s=Math.ceil((this.x+this.width-r)*e)/e,n=Math.ceil((this.y+this.height-r)*e)/e;return this.x=Math.floor((this.x+r)*e)/e,this.y=Math.floor((this.y+r)*e)/e,this.width=s-this.x,this.height=n-this.y,this}enlarge(e){const r=Math.min(this.x,e.x),s=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),i=Math.max(this.y+this.height,e.y+e.height);return this.x=r,this.width=s-r,this.y=n,this.height=i-n,this}getBounds(e){return e||(e=new me),e.copyFrom(this),e}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const Zs={default:-1};function ge(t="default"){return Zs[t]===void 0&&(Zs[t]=-1),++Zs[t]}const zo={},Ce="8.0.0",dd="8.3.4";function pe(t,e,r=3){if(zo[e])return;let s=new Error().stack;typeof s>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`):(s=s.split(`
`).splice(r).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${t}`),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`),console.warn(s))),zo[e]=!0}const wc=()=>{};function ks(t){return t+=t===0?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1}function Fo(t){return!(t&t-1)&&!!t}function fd(t){const e={};for(const r in t)t[r]!==void 0&&(e[r]=t[r]);return e}const Oo=Object.create(null);function pd(t){const e=Oo[t];return e===void 0&&(Oo[t]=ge("resource")),e}const vc=class Ac extends ot{constructor(e={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,e={...Ac.defaultOptions,...e},this.addressMode=e.addressMode,this.addressModeU=e.addressModeU??this.addressModeU,this.addressModeV=e.addressModeV??this.addressModeV,this.addressModeW=e.addressModeW??this.addressModeW,this.scaleMode=e.scaleMode,this.magFilter=e.magFilter??this.magFilter,this.minFilter=e.minFilter??this.minFilter,this.mipmapFilter=e.mipmapFilter??this.mipmapFilter,this.lodMinClamp=e.lodMinClamp,this.lodMaxClamp=e.lodMaxClamp,this.compare=e.compare,this.maxAnisotropy=e.maxAnisotropy??1}set addressMode(e){this.addressModeU=e,this.addressModeV=e,this.addressModeW=e}get addressMode(){return this.addressModeU}set wrapMode(e){pe(Ce,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=e}get wrapMode(){return this.addressMode}set scaleMode(e){this.magFilter=e,this.minFilter=e,this.mipmapFilter=e}get scaleMode(){return this.magFilter}set maxAnisotropy(e){this._maxAnisotropy=Math.min(e,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const e=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=pd(e),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};vc.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let md=vc;const Sc=class kc extends ot{constructor(e={}){super(),this.options=e,this.uid=ge("textureSource"),this._resourceType="textureSource",this._resourceId=ge("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,e={...kc.defaultOptions,...e},this.label=e.label??"",this.resource=e.resource,this.autoGarbageCollect=e.autoGarbageCollect,this._resolution=e.resolution,e.width?this.pixelWidth=e.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,e.height?this.pixelHeight=e.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=e.format,this.dimension=e.dimensions,this.mipLevelCount=e.mipLevelCount,this.autoGenerateMipmaps=e.autoGenerateMipmaps,this.sampleCount=e.sampleCount,this.antialias=e.antialias,this.alphaMode=e.alphaMode,this.style=new md(fd(e)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(e){this.style!==e&&(this._style?.off("change",this._onStyleChange,this),this._style=e,this._style?.on("change",this._onStyleChange,this),this._onStyleChange())}get addressMode(){return this._style.addressMode}set addressMode(e){this._style.addressMode=e}get repeatMode(){return this._style.addressMode}set repeatMode(e){this._style.addressMode=e}get magFilter(){return this._style.magFilter}set magFilter(e){this._style.magFilter=e}get minFilter(){return this._style.minFilter}set minFilter(e){this._style.minFilter=e}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(e){this._style.mipmapFilter=e}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(e){this._style.lodMinClamp=e}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(e){this._style.lodMaxClamp=e}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const e=this._resolution;if(this.resize(this.resourceWidth/e,this.resourceHeight/e))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=ge("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:e}=this;return e.naturalWidth||e.videoWidth||e.displayWidth||e.width}get resourceHeight(){const{resource:e}=this;return e.naturalHeight||e.videoHeight||e.displayHeight||e.height}get resolution(){return this._resolution}set resolution(e){this._resolution!==e&&(this._resolution=e,this.width=this.pixelWidth/e,this.height=this.pixelHeight/e)}resize(e,r,s){s||(s=this._resolution),e||(e=this.width),r||(r=this.height);const n=Math.round(e*s),i=Math.round(r*s);return this.width=n/s,this.height=i/s,this._resolution=s,this.pixelWidth===n&&this.pixelHeight===i?!1:(this._refreshPOT(),this.pixelWidth=n,this.pixelHeight=i,this.emit("resize",this),this._resourceId=ge("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(e){this._style.wrapMode=e}get wrapMode(){return this._style.wrapMode}set scaleMode(e){this._style.scaleMode=e}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=Fo(this.pixelWidth)&&Fo(this.pixelHeight)}static test(e){throw new Error("Unimplemented")}};Sc.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let at=Sc;class Di extends at{constructor(e){const r=e.resource||new Float32Array(e.width*e.height*4);let s=e.format;s||(r instanceof Float32Array?s="rgba32float":r instanceof Int32Array||r instanceof Uint32Array?s="rgba32uint":r instanceof Int16Array||r instanceof Uint16Array?s="rgba16uint":(r instanceof Int8Array,s="bgra8unorm")),super({...e,resource:r,format:s}),this.uploadMethodId="buffer"}static test(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}Di.extension=$.TextureSource;const No=new re;class gd{constructor(e,r){this.mapCoord=new re,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof r>"u"?this.clampMargin=e.width<10?0:.5:this.clampMargin=r,this.isSimple=!1,this.texture=e}get texture(){return this._texture}set texture(e){this.texture!==e&&(this._texture?.removeListener("update",this.update,this),this._texture=e,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(e,r){r===void 0&&(r=e);const s=this.mapCoord;for(let n=0;n<e.length;n+=2){const i=e[n],o=e[n+1];r[n]=i*s.a+o*s.c+s.tx,r[n+1]=i*s.b+o*s.d+s.ty}return r}update(){const e=this._texture;this._updateID++;const r=e.uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const s=e.orig,n=e.trim;n&&(No.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(No));const i=e.source,o=this.uClampFrame,a=this.clampMargin/i._resolution,l=this.clampOffset/i._resolution;return o[0]=(e.frame.x+a+l)/i.width,o[1]=(e.frame.y+a+l)/i.height,o[2]=(e.frame.x+e.frame.width-a+l)/i.width,o[3]=(e.frame.y+e.frame.height-a+l)/i.height,this.uClampOffset[0]=this.clampOffset/i.pixelWidth,this.uClampOffset[1]=this.clampOffset/i.pixelHeight,this.isSimple=e.frame.width===i.width&&e.frame.height===i.height&&e.rotate===0,!0}}class ee extends ot{constructor({source:e,label:r,frame:s,orig:n,trim:i,defaultAnchor:o,defaultBorders:a,rotate:l,dynamic:c}={}){if(super(),this.uid=ge("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new me,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=r,this.source=e?.source??new at,this.noFrame=!s,s)this.frame.copyFrom(s);else{const{width:h,height:u}=this._source;this.frame.width=h,this.frame.height=u}this.orig=n||this.frame,this.trim=i,this.rotate=l??0,this.defaultAnchor=o,this.defaultBorders=a,this.destroyed=!1,this.dynamic=c||!1,this.updateUvs()}set source(e){this._source&&this._source.off("resize",this.update,this),this._source=e,e.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new gd(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:e,frame:r}=this,{width:s,height:n}=this._source,i=r.x/s,o=r.y/n,a=r.width/s,l=r.height/n;let c=this.rotate;if(c){const h=a/2,u=l/2,f=i+h,d=o+u;c=he.add(c,he.NW),e.x0=f+h*he.uX(c),e.y0=d+u*he.uY(c),c=he.add(c,2),e.x1=f+h*he.uX(c),e.y1=d+u*he.uY(c),c=he.add(c,2),e.x2=f+h*he.uX(c),e.y2=d+u*he.uY(c),c=he.add(c,2),e.x3=f+h*he.uX(c),e.y3=d+u*he.uY(c)}else e.x0=i,e.y0=o,e.x1=i+a,e.y1=o,e.x2=i+a,e.y2=o+l,e.x3=i,e.y3=o+l}destroy(e=!1){this._source&&e&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return pe(Ce,"Texture.baseTexture is now Texture.source"),this._source}}ee.EMPTY=new ee({label:"EMPTY",source:new at({label:"EMPTY"})});ee.EMPTY.destroy=wc;ee.WHITE=new ee({source:new Di({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});ee.WHITE.destroy=wc;function yd(t,e,r,s){const{width:n,height:i}=r.orig,o=r.trim;if(o){const a=o.width,l=o.height;t.minX=o.x-e._x*n-s,t.maxX=t.minX+a,t.minY=o.y-e._y*i-s,t.maxY=t.minY+l}else t.minX=-e._x*n-s,t.maxX=t.minX+n,t.minY=-e._y*i-s,t.maxY=t.minY+i}const Lo=new re;class it{constructor(e=1/0,r=1/0,s=-1/0,n=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Lo,this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new me);const e=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(e.x=0,e.y=0,e.width=0,e.height=0):e.copyFromBounds(this),e}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Lo,this}set(e,r,s,n){this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}addFrame(e,r,s,n,i){i||(i=this.matrix);const o=i.a,a=i.b,l=i.c,c=i.d,h=i.tx,u=i.ty;let f=this.minX,d=this.minY,g=this.maxX,y=this.maxY,p=o*e+l*r+h,_=a*e+c*r+u;p<f&&(f=p),_<d&&(d=_),p>g&&(g=p),_>y&&(y=_),p=o*s+l*r+h,_=a*s+c*r+u,p<f&&(f=p),_<d&&(d=_),p>g&&(g=p),_>y&&(y=_),p=o*e+l*n+h,_=a*e+c*n+u,p<f&&(f=p),_<d&&(d=_),p>g&&(g=p),_>y&&(y=_),p=o*s+l*n+h,_=a*s+c*n+u,p<f&&(f=p),_<d&&(d=_),p>g&&(g=p),_>y&&(y=_),this.minX=f,this.minY=d,this.maxX=g,this.maxY=y}addRect(e,r){this.addFrame(e.x,e.y,e.x+e.width,e.y+e.height,r)}addBounds(e,r){this.addFrame(e.minX,e.minY,e.maxX,e.maxY,r)}addBoundsMask(e){this.minX=this.minX>e.minX?this.minX:e.minX,this.minY=this.minY>e.minY?this.minY:e.minY,this.maxX=this.maxX<e.maxX?this.maxX:e.maxX,this.maxY=this.maxY<e.maxY?this.maxY:e.maxY}applyMatrix(e){const r=this.minX,s=this.minY,n=this.maxX,i=this.maxY,{a:o,b:a,c:l,d:c,tx:h,ty:u}=e;let f=o*r+l*s+h,d=a*r+c*s+u;this.minX=f,this.minY=d,this.maxX=f,this.maxY=d,f=o*n+l*s+h,d=a*n+c*s+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY,f=o*r+l*i+h,d=a*r+c*i+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY,f=o*n+l*i+h,d=a*n+c*i+u,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY}fit(e){return this.minX<e.left&&(this.minX=e.left),this.maxX>e.right&&(this.maxX=e.right),this.minY<e.top&&(this.minY=e.top),this.maxY>e.bottom&&(this.maxY=e.bottom),this}fitBounds(e,r,s,n){return this.minX<e&&(this.minX=e),this.maxX>r&&(this.maxX=r),this.minY<s&&(this.minY=s),this.maxY>n&&(this.maxY=n),this}pad(e,r=e){return this.minX-=e,this.maxX+=e,this.minY-=r,this.maxY+=r,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new it(this.minX,this.minY,this.maxX,this.maxY)}scale(e,r=e){return this.minX*=e,this.minY*=r,this.maxX*=e,this.maxY*=r,this}get x(){return this.minX}set x(e){const r=this.maxX-this.minX;this.minX=e,this.maxX=e+r}get y(){return this.minY}set y(e){const r=this.maxY-this.minY;this.minY=e,this.maxY=e+r}get width(){return this.maxX-this.minX}set width(e){this.maxX=this.minX+e}get height(){return this.maxY-this.minY}set height(e){this.maxY=this.minY+e}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(e,r,s,n){let i=this.minX,o=this.minY,a=this.maxX,l=this.maxY;n||(n=this.matrix);const c=n.a,h=n.b,u=n.c,f=n.d,d=n.tx,g=n.ty;for(let y=r;y<s;y+=2){const p=e[y],_=e[y+1],b=c*p+u*_+d,S=h*p+f*_+g;i=b<i?b:i,o=S<o?S:o,a=b>a?b:a,l=S>l?S:l}this.minX=i,this.minY=o,this.maxX=a,this.maxY=l}containsPoint(e,r){return this.minX<=e&&this.minY<=r&&this.maxX>=e&&this.maxY>=r}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this}}var xd={grad:.9,turn:360,rad:360/(2*Math.PI)},ct=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},_e=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},Ge=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),t>r?r:t>e?t:e},Cc=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},Do=function(t){return{r:Ge(t.r,0,255),g:Ge(t.g,0,255),b:Ge(t.b,0,255),a:Ge(t.a)}},Qs=function(t){return{r:_e(t.r),g:_e(t.g),b:_e(t.b),a:_e(t.a,3)}},bd=/^#([0-9a-f]{3,8})$/i,ns=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},Pc=function(t){var e=t.r,r=t.g,s=t.b,n=t.a,i=Math.max(e,r,s),o=i-Math.min(e,r,s),a=o?i===e?(r-s)/o:i===r?2+(s-e)/o:4+(e-r)/o:0;return{h:60*(a<0?a+6:a),s:i?o/i*100:0,v:i/255*100,a:n}},Mc=function(t){var e=t.h,r=t.s,s=t.v,n=t.a;e=e/360*6,r/=100,s/=100;var i=Math.floor(e),o=s*(1-r),a=s*(1-(e-i)*r),l=s*(1-(1-e+i)*r),c=i%6;return{r:255*[s,a,o,o,l,s][c],g:255*[l,s,s,a,o,o][c],b:255*[o,o,l,s,s,a][c],a:n}},Go=function(t){return{h:Cc(t.h),s:Ge(t.s,0,100),l:Ge(t.l,0,100),a:Ge(t.a)}},Wo=function(t){return{h:_e(t.h),s:_e(t.s),l:_e(t.l),a:_e(t.a,3)}},Ho=function(t){return Mc((r=(e=t).s,{h:e.h,s:(r*=((s=e.l)<50?s:100-s)/100)>0?2*r/(s+r)*100:0,v:s+r,a:e.a}));var e,r,s},Fr=function(t){return{h:(e=Pc(t)).h,s:(n=(200-(r=e.s))*(s=e.v)/100)>0&&n<200?r*s/100/(n<=100?n:200-n)*100:0,l:n/2,a:e.a};var e,r,s,n},_d=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,wd=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,vd=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ad=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ui={string:[[function(t){var e=bd.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?_e(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?_e(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=vd.exec(t)||Ad.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:Do({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=_d.exec(t)||wd.exec(t);if(!e)return null;var r,s,n=Go({h:(r=e[1],s=e[2],s===void 0&&(s="deg"),Number(r)*(xd[s]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return Ho(n)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,s=t.b,n=t.a,i=n===void 0?1:n;return ct(e)&&ct(r)&&ct(s)?Do({r:Number(e),g:Number(r),b:Number(s),a:Number(i)}):null},"rgb"],[function(t){var e=t.h,r=t.s,s=t.l,n=t.a,i=n===void 0?1:n;if(!ct(e)||!ct(r)||!ct(s))return null;var o=Go({h:Number(e),s:Number(r),l:Number(s),a:Number(i)});return Ho(o)},"hsl"],[function(t){var e=t.h,r=t.s,s=t.v,n=t.a,i=n===void 0?1:n;if(!ct(e)||!ct(r)||!ct(s))return null;var o=function(a){return{h:Cc(a.h),s:Ge(a.s,0,100),v:Ge(a.v,0,100),a:Ge(a.a)}}({h:Number(e),s:Number(r),v:Number(s),a:Number(i)});return Mc(o)},"hsv"]]},$o=function(t,e){for(var r=0;r<e.length;r++){var s=e[r][0](t);if(s)return[s,e[r][1]]}return[null,void 0]},Sd=function(t){return typeof t=="string"?$o(t.trim(),ui.string):typeof t=="object"&&t!==null?$o(t,ui.object):[null,void 0]},Js=function(t,e){var r=Fr(t);return{h:r.h,s:Ge(r.s+100*e,0,100),l:r.l,a:r.a}},en=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Uo=function(t,e){var r=Fr(t);return{h:r.h,s:r.s,l:Ge(r.l+100*e,0,100),a:r.a}},di=function(){function t(e){this.parsed=Sd(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return _e(en(this.rgba),2)},t.prototype.isDark=function(){return en(this.rgba)<.5},t.prototype.isLight=function(){return en(this.rgba)>=.5},t.prototype.toHex=function(){return e=Qs(this.rgba),r=e.r,s=e.g,n=e.b,o=(i=e.a)<1?ns(_e(255*i)):"","#"+ns(r)+ns(s)+ns(n)+o;var e,r,s,n,i,o},t.prototype.toRgb=function(){return Qs(this.rgba)},t.prototype.toRgbString=function(){return e=Qs(this.rgba),r=e.r,s=e.g,n=e.b,(i=e.a)<1?"rgba("+r+", "+s+", "+n+", "+i+")":"rgb("+r+", "+s+", "+n+")";var e,r,s,n,i},t.prototype.toHsl=function(){return Wo(Fr(this.rgba))},t.prototype.toHslString=function(){return e=Wo(Fr(this.rgba)),r=e.h,s=e.s,n=e.l,(i=e.a)<1?"hsla("+r+", "+s+"%, "+n+"%, "+i+")":"hsl("+r+", "+s+"%, "+n+"%)";var e,r,s,n,i},t.prototype.toHsv=function(){return e=Pc(this.rgba),{h:_e(e.h),s:_e(e.s),v:_e(e.v),a:_e(e.a,3)};var e},t.prototype.invert=function(){return tt({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),tt(Js(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),tt(Js(this.rgba,-e))},t.prototype.grayscale=function(){return tt(Js(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),tt(Uo(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),tt(Uo(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?tt({r:(r=this.rgba).r,g:r.g,b:r.b,a:e}):_e(this.rgba.a,3);var r},t.prototype.hue=function(e){var r=Fr(this.rgba);return typeof e=="number"?tt({h:e,s:r.s,l:r.l,a:r.a}):_e(r.h)},t.prototype.isEqual=function(e){return this.toHex()===tt(e).toHex()},t}(),tt=function(t){return t instanceof di?t:new di(t)},Vo=[],kd=function(t){t.forEach(function(e){Vo.indexOf(e)<0&&(e(di,ui),Vo.push(e))})};function Cd(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},s={};for(var n in r)s[r[n]]=n;var i={};t.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,c=s[this.toHex()];if(c)return c;if(o?.closest){var h=this.toRgb(),u=1/0,f="black";if(!i.length)for(var d in r)i[d]=new t(r[d]).toRgb();for(var g in r){var y=(a=h,l=i[g],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));y<u&&(u=y,f=g)}return f}},e.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":r[a];return l?new t(l).toRgb():null},"name"])}kd([Cd]);const tr=class Mr{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof Mr)this._value=this._cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,e))&&(this._value=this._cloneSource(e),this._normalize(this._value))}}get value(){return this._value}_cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}_isSourceEqual(e,r){const s=typeof e;if(s!==typeof r)return!1;if(s==="number"||s==="string"||e instanceof Number)return e===r;if(Array.isArray(e)&&Array.isArray(r)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(r))return e.length!==r.length?!1:e.every((i,o)=>i===r[o]);if(e!==null&&r!==null){const i=Object.keys(e),o=Object.keys(r);return i.length!==o.length?!1:i.every(a=>e[a]===r[a])}return e===r}toRgba(){const[e,r,s,n]=this._components;return{r:e,g:r,b:s,a:n}}toRgb(){const[e,r,s]=this._components;return{r:e,g:r,b:s}}toRgbaString(){const[e,r,s]=this.toUint8RgbArray();return`rgba(${e},${r},${s},${this.alpha})`}toUint8RgbArray(e){const[r,s,n]=this._components;return this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb),e[0]=Math.round(r*255),e[1]=Math.round(s*255),e[2]=Math.round(n*255),e}toArray(e){this._arrayRgba||(this._arrayRgba=[]),e||(e=this._arrayRgba);const[r,s,n,i]=this._components;return e[0]=r,e[1]=s,e[2]=n,e[3]=i,e}toRgbArray(e){this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb);const[r,s,n]=this._components;return e[0]=r,e[1]=s,e[2]=n,e}toNumber(){return this._int}toBgrNumber(){const[e,r,s]=this.toUint8RgbArray();return(s<<16)+(r<<8)+e}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[r,s,n,i]=Mr._temp.setValue(e)._components;return this._components[0]*=r,this._components[1]*=s,this._components[2]*=n,this._components[3]*=i,this._refreshInt(),this._value=null,this}premultiply(e,r=!0){return r&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this._refreshInt(),this._value=null,this}toPremultiplied(e,r=!0){if(e===1)return(255<<24)+this._int;if(e===0)return r?0:this._int;let s=this._int>>16&255,n=this._int>>8&255,i=this._int&255;return r&&(s=s*e+.5|0,n=n*e+.5|0,i=i*e+.5|0),(e*255<<24)+(s<<16)+(n<<8)+i}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const r=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-r.length)+r}setAlpha(e){return this._components[3]=this._clamp(e),this}_normalize(e){let r,s,n,i;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const o=e;r=(o>>16&255)/255,s=(o>>8&255)/255,n=(o&255)/255,i=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[r,s,n,i=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[r,s,n,i=255]=e,r/=255,s/=255,n/=255,i/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const a=Mr.HEX_PATTERN.exec(e);a&&(e=`#${a[2]}`)}const o=tt(e);o.isValid()&&({r,g:s,b:n,a:i}=o.rgba,r/=255,s/=255,n/=255)}if(r!==void 0)this._components[0]=r,this._components[1]=s,this._components[2]=n,this._components[3]=i,this._refreshInt();else throw new Error(`Unable to convert color ${e}`)}_refreshInt(){this._clamp(this._components);const[e,r,s]=this._components;this._int=(e*255<<16)+(r*255<<8)+(s*255|0)}_clamp(e,r=0,s=1){return typeof e=="number"?Math.min(Math.max(e,r),s):(e.forEach((n,i)=>{e[i]=Math.min(Math.max(n,r),s)}),e)}static isColorLike(e){return typeof e=="number"||typeof e=="string"||e instanceof Number||e instanceof Mr||Array.isArray(e)||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e.r!==void 0&&e.g!==void 0&&e.b!==void 0||e.r!==void 0&&e.g!==void 0&&e.b!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0&&e.a!==void 0}};tr.shared=new tr;tr._temp=new tr;tr.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Ae=tr;const Pd={cullArea:null,cullable:!1,cullableChildren:!0};class Gi{constructor(e,r){this._pool=[],this._count=0,this._index=0,this._classType=e,r&&this.prepopulate(r)}prepopulate(e){for(let r=0;r<e;r++)this._pool[this._index++]=new this._classType;this._count+=e}get(e){let r;return this._index>0?r=this._pool[--this._index]:r=new this._classType,r.init?.(e),r}return(e){e.reset?.(),this._pool[this._index++]=e}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){this._pool.length=0,this._index=0}}class Md{constructor(){this._poolsByClass=new Map}prepopulate(e,r){this.getPool(e).prepopulate(r)}get(e,r){return this.getPool(e).get(r)}return(e){this.getPool(e.constructor).return(e)}getPool(e){return this._poolsByClass.has(e)||this._poolsByClass.set(e,new Gi(e)),this._poolsByClass.get(e)}stats(){const e={};return this._poolsByClass.forEach(r=>{const s=e[r._classType.name]?r._classType.name+r._classType.ID:r._classType.name;e[s]={free:r.totalFree,used:r.totalUsed,size:r.totalSize}}),e}}const pt=new Md,Td={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(t){typeof t=="boolean"&&t===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(t===!0?{}:t))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(t){pe("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(t)}};function Id(t,e,r){const s=t.length;let n;if(e>=s||r===0)return;r=e+r>s?s-e:r;const i=s-r;for(n=e;n<i;++n)t[n]=t[n+r];t.length=i}const Ed={allowChildren:!0,removeChildren(t=0,e){const r=e??this.children.length,s=r-t,n=[];if(s>0&&s<=r){for(let o=r-1;o>=t;o--){const a=this.children[o];a&&(n.push(a),a.parent=null)}Id(this.children,t,r);const i=this.renderGroup||this.parentRenderGroup;i&&i.removeChildren(n);for(let o=0;o<n.length;++o)this.emit("childRemoved",n[o],this,o),n[o].emit("removed",this);return n}else if(s===0&&this.children.length===0)return n;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(t){const e=this.getChildAt(t);return this.removeChild(e)},getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]},setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);this.getChildIndex(t),this.addChildAt(t,e)},getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied Container must be a child of the caller");return e},addChildAt(t,e){this.allowChildren||pe(Ce,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:r}=this;if(e<0||e>r.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${r.length}`);if(t.parent){const n=t.parent.children.indexOf(t);if(t.parent===this&&n===e)return t;n!==-1&&t.parent.children.splice(n,1)}e===r.length?r.push(t):r.splice(e,0,t),t.parent=this,t.didChange=!0,t._updateFlags=15;const s=this.renderGroup||this.parentRenderGroup;return s&&s.addChild(t),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",t,this,e),t.emit("added",this),t},swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),s=this.getChildIndex(e);this.children[r]=e,this.children[s]=t;const n=this.renderGroup||this.parentRenderGroup;n&&(n.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...t){return t.length===1?this.reparentChildAt(t[0],this.children.length):(t.forEach(e=>this.reparentChildAt(e,this.children.length)),t[0])},reparentChildAt(t,e){if(t.parent===this)return this.setChildIndex(t,e),t;const r=t.worldTransform.clone();t.removeFromParent(),this.addChildAt(t,e);const s=this.worldTransform.clone();return s.invert(),r.prepend(s),t.setFromMatrix(r),t}};class qo{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let e=0;e<this.filters.length;e++)this.filters[e].destroy();this.filters=null,this.filterArea=null}}class Rd{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(e=>{this.add({test:e.test,maskClass:e})}))}add(e){this._tests.push(e)}getMaskEffect(e){this._initialized||this.init();for(let r=0;r<this._tests.length;r++){const s=this._tests[r];if(s.test(e))return pt.get(s.maskClass,e)}return e}returnMaskEffect(e){pt.return(e)}}const fi=new Rd;We.handleByList($.MaskEffect,fi._effectClasses);const jd={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const t=this.renderGroup||this.parentRenderGroup;t&&(t.structureDidChange=!0)},addEffect(t){this.effects.indexOf(t)===-1&&(this.effects.push(t),this.effects.sort((r,s)=>r.priority-s.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(t){const e=this.effects.indexOf(t);e!==-1&&(this.effects.splice(e,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(t){const e=this._maskEffect;e?.mask!==t&&(e&&(this.removeEffect(e),fi.returnMaskEffect(e),this._maskEffect=null),t!=null&&(this._maskEffect=fi.getMaskEffect(t),this.addEffect(this._maskEffect)))},setMask(t){this._maskOptions={...this._maskOptions,...t},t.mask&&(this.mask=t.mask),this._markStructureAsChanged()},get mask(){return this._maskEffect?.mask},set filters(t){!Array.isArray(t)&&t&&(t=[t]);const e=this._filterEffect||(this._filterEffect=new qo);t=t;const r=t?.length>0,s=e.filters?.length>0,n=r!==s;t=Array.isArray(t)?t.slice(0):t,e.filters=Object.freeze(t),n&&(r?this.addEffect(e):(this.removeEffect(e),e.filters=t??null))},get filters(){return this._filterEffect?.filters},set filterArea(t){this._filterEffect||(this._filterEffect=new qo),this._filterEffect.filterArea=t},get filterArea(){return this._filterEffect?.filterArea}},Bd={label:null,get name(){return pe(Ce,"Container.name property has been removed, use Container.label instead"),this.label},set name(t){pe(Ce,"Container.name property has been removed, use Container.label instead"),this.label=t},getChildByName(t,e=!1){return this.getChildByLabel(t,e)},getChildByLabel(t,e=!1){const r=this.children;for(let s=0;s<r.length;s++){const n=r[s];if(n.label===t||t instanceof RegExp&&t.test(n.label))return n}if(e)for(let s=0;s<r.length;s++){const i=r[s].getChildByLabel(t,!0);if(i)return i}return null},getChildrenByLabel(t,e=!1,r=[]){const s=this.children;for(let n=0;n<s.length;n++){const i=s[n];(i.label===t||t instanceof RegExp&&t.test(i.label))&&r.push(i)}if(e)for(let n=0;n<s.length;n++)s[n].getChildrenByLabel(t,!0,r);return r}},Me=new Gi(re),rr=new Gi(it);function Tc(t,e,r){r.clear();let s,n;return t.parent?e?s=t.parent.worldTransform:(n=Me.get().identity(),s=Wi(t,n)):s=re.IDENTITY,Ic(t,r,s,e),n&&Me.return(n),r.isValid||r.set(0,0,0,0),r}function Ic(t,e,r,s){if(!t.visible||!t.measurable)return;let n;s?n=t.worldTransform:(t.updateLocalTransform(),n=Me.get(),n.appendFrom(t.localTransform,r));const i=e,o=!!t.effects.length;if(o&&(e=rr.get().clear()),t.boundsArea)e.addRect(t.boundsArea,n);else{t.bounds&&(e.matrix=n,e.addBounds(t.bounds));for(let a=0;a<t.children.length;a++)Ic(t.children[a],e,n,s)}if(o){for(let a=0;a<t.effects.length;a++)t.effects[a].addBounds?.(e);i.addBounds(e,re.IDENTITY),rr.return(e)}s||Me.return(n)}function Wi(t,e){const r=t.parent;return r&&(Wi(r,e),r.updateLocalTransform(),e.append(r.localTransform)),e}function Ec(t,e){if(t===16777215||!e)return e;if(e===16777215||!t)return t;const r=t>>16&255,s=t>>8&255,n=t&255,i=e>>16&255,o=e>>8&255,a=e&255,l=r*i/255|0,c=s*o/255|0,h=n*a/255|0;return(l<<16)+(c<<8)+h}const Yo=16777215;function Xo(t,e){return t===Yo?e:e===Yo?t:Ec(t,e)}function _s(t){return((t&255)<<16)+(t&65280)+(t>>16&255)}const zd={getGlobalAlpha(t){if(t)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let e=this.alpha,r=this.parent;for(;r;)e*=r.alpha,r=r.parent;return e},getGlobalTransform(t,e){if(e)return t.copyFrom(this.worldTransform);this.updateLocalTransform();const r=Wi(this,Me.get().identity());return t.appendFrom(this.localTransform,r),Me.return(r),t},getGlobalTint(t){if(t)return this.renderGroup?_s(this.renderGroup.worldColor):this.parentRenderGroup?_s(Xo(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let e=this.localColor,r=this.parent;for(;r;)e=Xo(e,r.localColor),r=r.parent;return _s(e)}};let tn=0;const Ko=500;function fe(...t){tn!==Ko&&(tn++,tn===Ko?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...t))}function Rc(t,e,r){return e.clear(),r||(r=re.IDENTITY),jc(t,e,r,t,!0),e.isValid||e.set(0,0,0,0),e}function jc(t,e,r,s,n){let i;if(n)i=Me.get(),i=r.copyTo(i);else{if(!t.visible||!t.measurable)return;t.updateLocalTransform();const l=t.localTransform;i=Me.get(),i.appendFrom(l,r)}const o=e,a=!!t.effects.length;if(a&&(e=rr.get().clear()),t.boundsArea)e.addRect(t.boundsArea,i);else{t.renderPipeId&&(e.matrix=i,e.addBounds(t.bounds));const l=t.children;for(let c=0;c<l.length;c++)jc(l[c],e,i,s,!1)}if(a){for(let l=0;l<t.effects.length;l++)t.effects[l].addLocalBounds?.(e,s);o.addBounds(e,re.IDENTITY),rr.return(e)}Me.return(i)}function Bc(t,e){const r=t.children;for(let s=0;s<r.length;s++){const n=r[s],i=n.uid,o=(n._didViewChangeTick&65535)<<16|n._didContainerChangeTick&65535,a=e.index;(e.data[a]!==i||e.data[a+1]!==o)&&(e.data[e.index]=i,e.data[e.index+1]=o,e.didChange=!0),e.index=a+2,n.children.length&&Bc(n,e)}return e.didChange}const Fd=new re,Od={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(t,e){const r=Math.sign(this.scale.x)||1;e!==0?this.scale.x=t/e*r:this.scale.x=r},_setHeight(t,e){const r=Math.sign(this.scale.y)||1;e!==0?this.scale.y=t/e*r:this.scale.y=r},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new it});const t=this._localBoundsCacheData;return t.index=1,t.didChange=!1,t.data[0]!==this._didViewChangeTick&&(t.didChange=!0,t.data[0]=this._didViewChangeTick),Bc(this,t),t.didChange&&Rc(this,t.localBounds,Fd),t.localBounds},getBounds(t,e){return Tc(this,t,e||new it)}},Nd={_onRender:null,set onRender(t){const e=this.renderGroup||this.parentRenderGroup;if(!t){this._onRender&&e?.removeOnRender(this),this._onRender=null;return}this._onRender||e?.addOnRender(this),this._onRender=t},get onRender(){return this._onRender}},Ld={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(Dd))}};function Dd(t,e){return t._zIndex-e._zIndex}const Gd={getGlobalPosition(t=new Pe,e=!1){return this.parent?this.parent.toGlobal(this._position,t,e):(t.x=this._position.x,t.y=this._position.y),t},toGlobal(t,e,r=!1){const s=this.getGlobalTransform(Me.get(),r);return e=s.apply(t,e),Me.return(s),e},toLocal(t,e,r,s){e&&(t=e.toGlobal(t,r,s));const n=this.getGlobalTransform(Me.get(),s);return r=n.applyInverse(t,r),Me.return(n),r}};class zc{constructor(){this.uid=ge("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}add(e){this.instructions[this.instructionSize++]=e}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let Wd=0;class Hd{constructor(e){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1}createTexture(e,r,s){const n=new at({...this.textureOptions,width:e,height:r,resolution:1,antialias:s,autoGarbageCollect:!0});return new ee({source:n,label:`texturePool_${Wd++}`})}getOptimalTexture(e,r,s=1,n){let i=Math.ceil(e*s-1e-6),o=Math.ceil(r*s-1e-6);i=ks(i),o=ks(o);const a=(i<<17)+(o<<1)+(n?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let l=this._texturePool[a].pop();return l||(l=this.createTexture(i,o,n)),l.source._resolution=s,l.source.width=i/s,l.source.height=o/s,l.source.pixelWidth=i,l.source.pixelHeight=o,l.frame.x=0,l.frame.y=0,l.frame.width=e,l.frame.height=r,l.updateUvs(),this._poolKeyHash[l.uid]=a,l}getSameSizeTexture(e,r=!1){const s=e.source;return this.getOptimalTexture(e.width,e.height,s._resolution,r)}returnTexture(e){const r=this._poolKeyHash[e.uid];this._texturePool[r].push(e)}clear(e){if(e=e!==!1,e)for(const r in this._texturePool){const s=this._texturePool[r];if(s)for(let n=0;n<s.length;n++)s[n].destroy(!0)}this._texturePool={}}}const $d=new Hd;class Ud{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new re,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new zc,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(e){this.root=e,e._onRender&&this.addOnRender(e),e.didChange=!0;const r=e.children;for(let s=0;s<r.length;s++){const n=r[s];n._updateFlags=15,this.addChild(n)}}enableCacheAsTexture(e={}){this.textureOptions=e,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&($d.returnTexture(this.texture),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0}reset(){this.renderGroupChildren.length=0;for(const e in this.childrenToUpdate){const r=this.childrenToUpdate[e];r.list.fill(null),r.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(e){e.renderGroupParent&&e.renderGroupParent._removeRenderGroupChild(e),e.renderGroupParent=this,this.renderGroupChildren.push(e)}_removeRenderGroupChild(e){const r=this.renderGroupChildren.indexOf(e);r>-1&&this.renderGroupChildren.splice(r,1),e.renderGroupParent=null}addChild(e){if(this.structureDidChange=!0,e.parentRenderGroup=this,e.updateTick=-1,e.parent===this.root?e.relativeRenderGroupDepth=1:e.relativeRenderGroupDepth=e.parent.relativeRenderGroupDepth+1,e.didChange=!0,this.onChildUpdate(e),e.renderGroup){this.addRenderGroupChild(e.renderGroup);return}e._onRender&&this.addOnRender(e);const r=e.children;for(let s=0;s<r.length;s++)this.addChild(r[s])}removeChild(e){if(this.structureDidChange=!0,e._onRender&&(e.renderGroup||this.removeOnRender(e)),e.parentRenderGroup=null,e.renderGroup){this._removeRenderGroupChild(e.renderGroup);return}const r=e.children;for(let s=0;s<r.length;s++)this.removeChild(r[s])}removeChildren(e){for(let r=0;r<e.length;r++)this.removeChild(e[r])}onChildUpdate(e){let r=this.childrenToUpdate[e.relativeRenderGroupDepth];r||(r=this.childrenToUpdate[e.relativeRenderGroupDepth]={index:0,list:[]}),r.list[r.index++]=e}updateRenderable(e){e.globalDisplayStatus<7||(this.instructionSet.renderPipes[e.renderPipeId].updateRenderable(e),e.didViewUpdate=!1)}onChildViewUpdate(e){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=e}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(e){this._onRenderContainers.push(e)}removeOnRender(e){this._onRenderContainers.splice(this._onRenderContainers.indexOf(e),1)}runOnRender(){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender()}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(e=[]){const r=this.root.children;for(let s=0;s<r.length;s++)this._getChildren(r[s],e);return e}_getChildren(e,r=[]){if(r.push(e),e.renderGroup)return r;const s=e.children;for(let n=0;n<s.length;n++)this._getChildren(s[n],r);return r}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return this._matrixDirty&1?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new re),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return this._matrixDirty&2?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new re),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(this._matrixDirty&4))return this._inverseParentTextureTransform;this._matrixDirty&=-5;const e=this._parentCacheAsTextureRenderGroup;return e?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new re),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(e.inverseWorldTransform).translate(-e._textureBounds.x,-e._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function Vd(t,e,r={}){for(const s in e)!r[s]&&e[s]!==void 0&&(t[s]=e[s])}const rn=new Fe(null),sn=new Fe(null),nn=new Fe(null,1,1),Zo=1,qd=2,on=4;class Re extends ot{constructor(e={}){super(),this.uid=ge("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new re,this.relativeGroupTransform=new re,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new Fe(this,0,0),this._scale=nn,this._pivot=sn,this._skew=rn,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],Vd(this,e,{children:!0,parent:!0,effects:!0}),e.children?.forEach(r=>this.addChild(r)),e.parent?.addChild(this)}static mixin(e){Object.defineProperties(Re.prototype,Object.getOwnPropertyDescriptors(e))}set _didChangeId(e){this._didViewChangeTick=e>>12&4095,this._didContainerChangeTick=e&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...e){if(this.allowChildren||pe(Ce,"addChild: Only Containers will be allowed to add children in v8.0.0"),e.length>1){for(let n=0;n<e.length;n++)this.addChild(e[n]);return e[0]}const r=e[0],s=this.renderGroup||this.parentRenderGroup;return r.parent===this?(this.children.splice(this.children.indexOf(r),1),this.children.push(r),s&&(s.structureDidChange=!0),r):(r.parent&&r.parent.removeChild(r),this.children.push(r),this.sortableChildren&&(this.sortDirty=!0),r.parent=this,r.didChange=!0,r._updateFlags=15,s&&s.addChild(r),this.emit("childAdded",r,this,this.children.length-1),r.emit("added",this),this._didViewChangeTick++,r._zIndex!==0&&r.depthOfChildModified(),r)}removeChild(...e){if(e.length>1){for(let n=0;n<e.length;n++)this.removeChild(e[n]);return e[0]}const r=e[0],s=this.children.indexOf(r);return s>-1&&(this._didViewChangeTick++,this.children.splice(s,1),this.renderGroup?this.renderGroup.removeChild(r):this.parentRenderGroup&&this.parentRenderGroup.removeChild(r),r.parent=null,this.emit("childRemoved",r,this,s),r.emit("removed",this)),r}_onUpdate(e){e&&e===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(e){!!this.renderGroup!==e&&(e?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const e=this.parentRenderGroup;e?.removeChild(this),this.renderGroup=pt.get(Ud,this),this.groupTransform=re.IDENTITY,e?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const e=this.parentRenderGroup;e?.removeChild(this),pt.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,e?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new re),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(e){this._position.x=e}get y(){return this._position.y}set y(e){this._position.y=e}get position(){return this._position}set position(e){this._position.copyFrom(e)}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this._skew))}get angle(){return this.rotation*ad}set angle(e){this.rotation=e*ld}get pivot(){return this._pivot===sn&&(this._pivot=new Fe(this,0,0)),this._pivot}set pivot(e){this._pivot===sn&&(this._pivot=new Fe(this,0,0)),typeof e=="number"?this._pivot.set(e):this._pivot.copyFrom(e)}get skew(){return this._skew===rn&&(this._skew=new Fe(this,0,0)),this._skew}set skew(e){this._skew===rn&&(this._skew=new Fe(this,0,0)),this._skew.copyFrom(e)}get scale(){return this._scale===nn&&(this._scale=new Fe(this,1,1)),this._scale}set scale(e){this._scale===nn&&(this._scale=new Fe(this,0,0)),typeof e=="number"?this._scale.set(e):this._scale.copyFrom(e)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(e){const r=this.getLocalBounds().width;this._setWidth(e,r)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(e){const r=this.getLocalBounds().height;this._setHeight(e,r)}getSize(e){e||(e={});const r=this.getLocalBounds();return e.width=Math.abs(this.scale.x*r.width),e.height=Math.abs(this.scale.y*r.height),e}setSize(e,r){const s=this.getLocalBounds();typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,s.width),r!==void 0&&this._setHeight(r,s.height)}_updateSkew(){const e=this._rotation,r=this._skew;this._cx=Math.cos(e+r._y),this._sx=Math.sin(e+r._y),this._cy=-Math.sin(e-r._x),this._sy=Math.cos(e-r._x)}updateTransform(e){return this.position.set(typeof e.x=="number"?e.x:this.position.x,typeof e.y=="number"?e.y:this.position.y),this.scale.set(typeof e.scaleX=="number"?e.scaleX||1:this.scale.x,typeof e.scaleY=="number"?e.scaleY||1:this.scale.y),this.rotation=typeof e.rotation=="number"?e.rotation:this.rotation,this.skew.set(typeof e.skewX=="number"?e.skewX:this.skew.x,typeof e.skewY=="number"?e.skewY:this.skew.y),this.pivot.set(typeof e.pivotX=="number"?e.pivotX:this.pivot.x,typeof e.pivotY=="number"?e.pivotY:this.pivot.y),this}setFromMatrix(e){e.decompose(this)}updateLocalTransform(){const e=this._didContainerChangeTick;if(this._didLocalTransformChangeId===e)return;this._didLocalTransformChangeId=e;const r=this.localTransform,s=this._scale,n=this._pivot,i=this._position,o=s._x,a=s._y,l=n._x,c=n._y;r.a=this._cx*o,r.b=this._sx*o,r.c=this._cy*a,r.d=this._sy*a,r.tx=i._x-(l*r.a+c*r.c),r.ty=i._y-(l*r.b+c*r.d)}set alpha(e){e!==this.localAlpha&&(this.localAlpha=e,this._updateFlags|=Zo,this._onUpdate())}get alpha(){return this.localAlpha}set tint(e){const s=Ae.shared.setValue(e??16777215).toBgrNumber();s!==this.localColor&&(this.localColor=s,this._updateFlags|=Zo,this._onUpdate())}get tint(){return _s(this.localColor)}set blendMode(e){this.localBlendMode!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=qd,this.localBlendMode=e,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(e){const r=e?2:0;(this.localDisplayStatus&2)!==r&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=on,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(e){const r=e?0:4;(this.localDisplayStatus&4)!==r&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=on,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(e){const r=e?1:0;(this.localDisplayStatus&1)!==r&&(this._updateFlags|=on,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(e=!1){if(this.destroyed)return;this.destroyed=!0;let r;if(this.children.length&&(r=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof e=="boolean"?e:e?.children)&&r)for(let n=0;n<r.length;++n)r[n].destroy(e);this.renderGroup?.destroy(),this.renderGroup=null}}Re.mixin(Ed);Re.mixin(Gd);Re.mixin(Nd);Re.mixin(Od);Re.mixin(jd);Re.mixin(Bd);Re.mixin(Ld);Re.mixin(Pd);Re.mixin(Td);Re.mixin(zd);class Yd extends Re{constructor(){super(...arguments),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._bounds=new it(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(e){this._roundPixels=e?1:0}containsPoint(e){const r=this.bounds,{x:s,y:n}=e;return s>=r.minX&&s<=r.maxX&&n>=r.minY&&n<=r.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const e=this.renderGroup||this.parentRenderGroup;e&&e.onChildViewUpdate(this)}destroy(e){super.destroy(e),this._bounds=null}}class Lr extends Yd{constructor(e=ee.EMPTY){e instanceof ee&&(e={texture:e});const{texture:r=ee.EMPTY,anchor:s,roundPixels:n,width:i,height:o,...a}=e;super({label:"Sprite",...a}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new Fe({_onUpdate:()=>{this.onViewUpdate()}}),s?this.anchor=s:r.defaultAnchor&&(this.anchor=r.defaultAnchor),this.texture=r,this.allowChildren=!1,this.roundPixels=n??!1,i!==void 0&&(this.width=i),o!==void 0&&(this.height=o)}static from(e,r=!1){return e instanceof ee?new Lr(e):new Lr(ee.from(e,r))}set texture(e){e||(e=ee.EMPTY);const r=this._texture;r!==e&&(r&&r.dynamic&&r.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return yd(this._visualBounds,this._anchor,this._texture,0),this._visualBounds}get sourceBounds(){return pe("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const e=this._anchor,r=this._texture,s=this._bounds,{width:n,height:i}=r.orig;s.minX=-e._x*n,s.maxX=s.minX+n,s.minY=-e._y*i,s.maxY=s.minY+i}destroy(e=!1){if(super.destroy(e),typeof e=="boolean"?e:e?.texture){const s=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(s)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this._setWidth(e,this._texture.orig.width),this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this._setHeight(e,this._texture.orig.height),this._height=e}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this._texture.orig.width,e.height=Math.abs(this.scale.y)*this._texture.orig.height,e}setSize(e,r){typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,this._texture.orig.width),r!==void 0&&this._setHeight(r,this._texture.orig.height)}}const Xd=new it;function Fc(t,e,r){const s=Xd;t.measurable=!0,Tc(t,r,s),e.addBoundsMask(s),t.measurable=!1}function Oc(t,e,r){const s=rr.get();t.measurable=!0;const n=Me.get().identity(),i=Nc(t,r,n);Rc(t,s,i),t.measurable=!1,e.addBoundsMask(s),Me.return(n),rr.return(s)}function Nc(t,e,r){return t?(t!==e&&(Nc(t.parent,e,r),t.updateLocalTransform(),r.append(t.localTransform)),r):(fe("Mask bounds, renderable is not inside the root container"),r)}class Lc{constructor(e){this.priority=0,this.inverse=!1,this.pipe="alphaMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.renderMaskToTexture=!(e instanceof Lr),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(e,r){this.inverse||Fc(this.mask,e,r)}addLocalBounds(e,r){Oc(this.mask,e,r)}containsPoint(e,r){const s=this.mask;return r(s,e)}destroy(){this.reset()}static test(e){return e instanceof Lr}}Lc.extension=$.MaskEffect;class Dc{constructor(e){this.priority=0,this.pipe="colorMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e}destroy(){}static test(e){return typeof e=="number"}}Dc.extension=$.MaskEffect;class Gc{constructor(e){this.priority=0,this.pipe="stencilMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(e,r){Fc(this.mask,e,r)}addLocalBounds(e,r){Oc(this.mask,e,r)}containsPoint(e,r){const s=this.mask;return r(s,e)}destroy(){this.reset()}static test(e){return e instanceof Re}}Gc.extension=$.MaskEffect;const Kd={createCanvas:(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>new DOMParser().parseFromString(t,"text/xml")};let Qo=Kd;const ye={get(){return Qo},set(t){Qo=t}};class Wc extends at{constructor(e){e.resource||(e.resource=ye.get().createCanvas()),e.width||(e.width=e.resource.width,e.autoDensity||(e.width/=e.resolution)),e.height||(e.height=e.resource.height,e.autoDensity||(e.height/=e.resolution)),super(e),this.uploadMethodId="image",this.autoDensity=e.autoDensity,this.resizeCanvas(),this.transparent=!!e.transparent}resizeCanvas(){this.autoDensity&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(e=this.width,r=this.height,s=this._resolution){const n=super.resize(e,r,s);return n&&this.resizeCanvas(),n}static test(e){return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&e instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}Wc.extension=$.TextureSource;class ar extends at{constructor(e){if(e.resource&&globalThis.HTMLImageElement&&e.resource instanceof HTMLImageElement){const r=ye.get().createCanvas(e.resource.width,e.resource.height);r.getContext("2d").drawImage(e.resource,0,0,e.resource.width,e.resource.height),e.resource=r,fe("ImageSource: Image element passed, converting to canvas. Use CanvasSource instead.")}super(e),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(e){return globalThis.HTMLImageElement&&e instanceof HTMLImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||globalThis.VideoFrame&&e instanceof VideoFrame}}ar.extension=$.TextureSource;var Cs=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Cs||{});class an{constructor(e,r=null,s=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=e,this._context=r,this.priority=s,this._once=n}match(e,r=null){return this._fn===e&&this._context===r}emit(e){this._fn&&(this._context?this._fn.call(this._context,e):this._fn(e));const r=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),r}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const r=this.next;return this.next=e?null:r,this.previous=null,r}}const Hc=class ze{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new an(null,null,1/0),this.deltaMS=1/ze.targetFPMS,this.elapsedMS=1/ze.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,r,s=Cs.NORMAL){return this._addListener(new an(e,r,s))}addOnce(e,r,s=Cs.NORMAL){return this._addListener(new an(e,r,s,!0))}_addListener(e){let r=this._head.next,s=this._head;if(!r)e.connect(s);else{for(;r;){if(e.priority>r.priority){e.connect(s);break}s=r,r=r.next}e.previous||e.connect(s)}return this._startIfPossible(),this}remove(e,r){let s=this._head.next;for(;s;)s.match(e,r)?s=s.destroy():s=s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,r=this._head;for(;r=r.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let r;if(e>this.lastTime){if(r=this.elapsedMS=e-this.lastTime,r>this._maxElapsedMS&&(r=this._maxElapsedMS),r*=this.speed,this._minElapsedMS){const i=e-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=e-i%this._minElapsedMS}this.deltaMS=r,this.deltaTime=this.deltaMS*ze.targetFPMS;const s=this._head;let n=s.next;for(;n;)n=n.emit(this);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const r=Math.min(this.maxFPS,e),s=Math.min(Math.max(0,r)/1e3,ze.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const r=Math.max(this.minFPS,e);this._minElapsedMS=1/(r/1e3)}}static get shared(){if(!ze._shared){const e=ze._shared=new ze;e.autoStart=!0,e._protected=!0}return ze._shared}static get system(){if(!ze._system){const e=ze._system=new ze;e.autoStart=!0,e._protected=!0}return ze._system}};Hc.targetFPMS=.06;let nt=Hc,ln;async function $c(){return ln??(ln=(async()=>{const e=document.createElement("canvas").getContext("webgl");if(!e)return"premultiply-alpha-on-upload";const r=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!r)return"premultiply-alpha-on-upload";const s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);const n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r);const i=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,i),e.deleteFramebuffer(n),e.deleteTexture(s),e.getExtension("WEBGL_lose_context")?.loseContext(),i[0]<=i[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),ln}const Bs=class Uc extends at{constructor(e){super(e),this.isReady=!1,this.uploadMethodId="video",e={...Uc.defaultOptions,...e},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this.alphaMode=e.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const e=nt.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const e=this.resource,r=this.options;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(r.preload||e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlayThrough),e.addEventListener("error",this._onError,!0)),this.alphaMode=await $c(),this._load=new Promise((s,n)=>{this.isValid?s(this):(this._resolve=s,this._reject=n,r.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${r.preloadTimeoutMs}ms`))})),e.load())}),this._load}_onError(e){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.resource;return!e.paused&&!e.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const e=this.resource;this.isValid&&(this.isReady=!0,this.resize(e.videoWidth,e.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const e=this.resource;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlayThrough),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(nt.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(nt.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(nt.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement}};Bs.extension=$.TextureSource;Bs.defaultOptions={...at.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};Bs.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let ws=Bs;const Ue=(t,e,r=!1)=>(Array.isArray(t)||(t=[t]),e?t.map(s=>typeof s=="string"||r?e(s):s):t);class Zd{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const r=this._cache.get(e);return r||fe(`[Assets] Asset id ${e} was not found in the Cache`),r}set(e,r){const s=Ue(e);let n;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.test(r)){n=c.getCacheableAssets(s,r);break}}const i=new Map(Object.entries(n||{}));n||s.forEach(l=>{i.set(l,r)});const o=[...i.keys()],a={cacheKeys:o,keys:s};s.forEach(l=>{this._cacheMap.set(l,a)}),o.forEach(l=>{const c=n?n[l]:r;this._cache.has(l)&&this._cache.get(l)!==c&&fe("[Cache] already has key:",l),this._cache.set(l,i.get(l))})}remove(e){if(!this._cacheMap.has(e)){fe(`[Assets] Asset id ${e} was not found in the Cache`);return}const r=this._cacheMap.get(e);r.cacheKeys.forEach(n=>{this._cache.delete(n)}),r.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const ue=new Zd,pi=[];We.handleByList($.TextureSource,pi);function Vc(t={}){const e=t&&t.resource,r=e?t.resource:t,s=e?t:{resource:t};for(let n=0;n<pi.length;n++){const i=pi[n];if(i.test(r))return new i(s)}throw new Error(`Could not find a source type for resource: ${s.resource}`)}function Qd(t={},e=!1){const r=t&&t.resource,s=r?t.resource:t,n=r?t:{resource:t};if(!e&&ue.has(s))return ue.get(s);const i=new ee({source:Vc(n)});return i.on("destroy",()=>{ue.has(s)&&ue.remove(s)}),e||ue.set(s,i),i}function Jd(t,e=!1){return typeof t=="string"?ue.get(t):t instanceof at?new ee({source:t}):Qd(t,e)}ee.from=Jd;at.from=Vc;We.add(Lc,Dc,Gc,ws,ar,Wc,Di);var kt=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(kt||{});function He(t){if(typeof t!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function pr(t){return t.split("?")[0].split("#")[0]}function ef(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function tf(t,e,r){return t.replace(new RegExp(ef(e),"g"),r)}function rf(t,e){let r="",s=0,n=-1,i=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||i===1))if(n!==a-1&&i===2){if(r.length<2||s!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){const l=r.lastIndexOf("/");if(l!==r.length-1){l===-1?(r="",s=0):(r=r.slice(0,l),s=r.length-1-r.lastIndexOf("/")),n=a,i=0;continue}}else if(r.length===2||r.length===1){r="",s=0,n=a,i=0;continue}}}else r.length>0?r+=`/${t.slice(n+1,a)}`:r=t.slice(n+1,a),s=a-n-1;n=a,i=0}else o===46&&i!==-1?++i:i=-1}return r}const Oe={toPosix(t){return tf(t,"\\","/")},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},isBlobUrl(t){return t.startsWith("blob:")},hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){He(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const r=/^[^/:]+:\/{0,2}/.exec(t);return r?r[0]:""},toAbsolute(t,e,r){if(He(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const s=pr(this.toPosix(e??ye.get().getBaseUrl())),n=pr(this.toPosix(r??this.rootname(s)));return t=this.toPosix(t),t.startsWith("/")?Oe.join(n,t.slice(1)):this.isAbsolute(t)?t:this.join(s,t)},normalize(t){if(He(t),t.length===0)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;t=this.toPosix(t);let e="";const r=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const s=t.endsWith("/");return t=rf(t),t.length>0&&s&&(t+="/"),r?`/${t}`:e+t},isAbsolute(t){return He(t),t=this.toPosix(t),this.hasProtocol(t)?!0:t.startsWith("/")},join(...t){if(t.length===0)return".";let e;for(let r=0;r<t.length;++r){const s=t[r];if(He(s),s.length>0)if(e===void 0)e=s;else{const n=t[r-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?e+=`/../${s}`:e+=`/${s}`}}return e===void 0?".":this.normalize(e)},dirname(t){if(He(t),t.length===0)return".";t=this.toPosix(t);let e=t.charCodeAt(0);const r=e===47;let s=-1,n=!0;const i=this.getProtocol(t),o=t;t=t.slice(i.length);for(let a=t.length-1;a>=1;--a)if(e=t.charCodeAt(a),e===47){if(!n){s=a;break}}else n=!1;return s===-1?r?"/":this.isUrl(o)?i+t:i:r&&s===1?"//":i+t.slice(0,s)},rootname(t){He(t),t=this.toPosix(t);let e="";if(t.startsWith("/")?e="/":e=this.getProtocol(t),this.isUrl(t)){const r=t.indexOf("/",e.length);r!==-1?e=t.slice(0,r):e=t,e.endsWith("/")||(e+="/")}return e},basename(t,e){He(t),e&&He(e),t=pr(this.toPosix(t));let r=0,s=-1,n=!0,i;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(i=t.length-1;i>=0;--i){const l=t.charCodeAt(i);if(l===47){if(!n){r=i+1;break}}else a===-1&&(n=!1,a=i+1),o>=0&&(l===e.charCodeAt(o)?--o===-1&&(s=i):(o=-1,s=a))}return r===s?s=a:s===-1&&(s=t.length),t.slice(r,s)}for(i=t.length-1;i>=0;--i)if(t.charCodeAt(i)===47){if(!n){r=i+1;break}}else s===-1&&(n=!1,s=i+1);return s===-1?"":t.slice(r,s)},extname(t){He(t),t=pr(this.toPosix(t));let e=-1,r=0,s=-1,n=!0,i=0;for(let o=t.length-1;o>=0;--o){const a=t.charCodeAt(o);if(a===47){if(!n){r=o+1;break}continue}s===-1&&(n=!1,s=o+1),a===46?e===-1?e=o:i!==1&&(i=1):e!==-1&&(i=-1)}return e===-1||s===-1||i===0||i===1&&e===s-1&&e===r+1?"":t.slice(e,s)},parse(t){He(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;t=pr(this.toPosix(t));let r=t.charCodeAt(0);const s=this.isAbsolute(t);let n;e.root=this.rootname(t),s||this.hasProtocol(t)?n=1:n=0;let i=-1,o=0,a=-1,l=!0,c=t.length-1,h=0;for(;c>=n;--c){if(r=t.charCodeAt(c),r===47){if(!l){o=c+1;break}continue}a===-1&&(l=!1,a=c+1),r===46?i===-1?i=c:h!==1&&(h=1):i!==-1&&(h=-1)}return i===-1||a===-1||h===0||h===1&&i===a-1&&i===o+1?a!==-1&&(o===0&&s?e.base=e.name=t.slice(1,a):e.base=e.name=t.slice(o,a)):(o===0&&s?(e.name=t.slice(1,i),e.base=t.slice(1,a)):(e.name=t.slice(o,i),e.base=t.slice(o,a)),e.ext=t.slice(i,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":",joinExtensions:[".html"]};function qc(t,e,r,s,n){const i=e[r];for(let o=0;o<i.length;o++){const a=i[o];r<e.length-1?qc(t.replace(s[r],a),e,r+1,s,n):n.push(t.replace(s[r],a))}}function sf(t){const e=/\{(.*?)\}/g,r=t.match(e),s=[];if(r){const n=[];r.forEach(i=>{const o=i.substring(1,i.length-1).split(",");n.push(o)}),qc(t,n,0,r,s)}else s.push(t);return s}const Ps=t=>!Array.isArray(t);class lr{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,r)=>`${e}${this._bundleIdConnector}${r}`,extractAssetIdFromBundle:(e,r)=>r.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const r=e;this._defaultSearchParams=Object.keys(r).map(s=>`${encodeURIComponent(s)}=${encodeURIComponent(r[s])}`).join("&")}}getAlias(e){const{alias:r,src:s}=e;return Ue(r||s,i=>typeof i=="string"?i:Array.isArray(i)?i.map(o=>o?.src??o):i?.src?i.src:i,!0)}addManifest(e){this._manifest&&fe("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(e,r){const s=[];let n=r;Array.isArray(r)||(n=Object.entries(r).map(([i,o])=>typeof o=="string"||Array.isArray(o)?{alias:i,src:o}:{alias:i,...o})),n.forEach(i=>{const o=i.src,a=i.alias;let l;if(typeof a=="string"){const c=this._createBundleAssetId(e,a);s.push(c),l=[a,c]}else{const c=a.map(h=>this._createBundleAssetId(e,h));s.push(...c),l=[...a,...c]}this.add({...i,alias:l,src:o})}),this._bundles[e]=s}add(e){const r=[];Array.isArray(e)?r.push(...e):r.push(e);let s;s=i=>{this.hasKey(i)&&fe(`[Resolver] already has key: ${i} overwriting`)},Ue(r).forEach(i=>{const{src:o}=i;let{data:a,format:l,loadParser:c}=i;const h=Ue(o).map(d=>typeof d=="string"?sf(d):Array.isArray(d)?d:[d]),u=this.getAlias(i);Array.isArray(u)?u.forEach(s):s(u);const f=[];h.forEach(d=>{d.forEach(g=>{let y={};if(typeof g!="object"){y.src=g;for(let p=0;p<this._parsers.length;p++){const _=this._parsers[p];if(_.test(g)){y=_.parse(g);break}}}else a=g.data??a,l=g.format??l,c=g.loadParser??c,y={...y,...g};if(!u)throw new Error(`[Resolver] alias is undefined for this asset: ${y.src}`);y=this._buildResolvedAsset(y,{aliases:u,data:a,format:l,loadParser:c}),f.push(y)})}),u.forEach(d=>{this._assetMap[d]=f})})}resolveBundle(e){const r=Ps(e);e=Ue(e);const s={};return e.forEach(n=>{const i=this._bundles[n];if(i){const o=this.resolve(i),a={};for(const l in o){const c=o[l];a[this._extractAssetIdFromBundle(n,l)]=c}s[n]=a}}),r?s[e[0]]:s}resolveUrl(e){const r=this.resolve(e);if(typeof e!="string"){const s={};for(const n in r)s[n]=r[n].src;return s}return r.src}resolve(e){const r=Ps(e);e=Ue(e);const s={};return e.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let i=this._assetMap[n];const o=this._getPreferredOrder(i);o?.priority.forEach(a=>{o.params[a].forEach(l=>{const c=i.filter(h=>h[a]?h[a]===l:!1);c.length&&(i=c)})}),this._resolverHash[n]=i[0]}else this._resolverHash[n]=this._buildResolvedAsset({alias:[n],src:n},{});s[n]=this._resolverHash[n]}),r?s[e[0]]:s}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let r=0;r<e.length;r++){const s=e[0],n=this._preferredOrder.find(i=>i.params.format.includes(s.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const r=/\?/.test(e)?"&":"?";return`${e}${r}${this._defaultSearchParams}`}_buildResolvedAsset(e,r){const{aliases:s,data:n,loadParser:i,format:o}=r;return(this._basePath||this._rootPath)&&(e.src=Oe.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=s??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...n||{},...e.data},e.loadParser=i??e.loadParser,e.format=o??e.format??nf(e.src),e}}lr.RETINA_PREFIX=/@([0-9\.]+)x/;function nf(t){return t.split(".").pop().split("?").shift().split("#").shift()}const mi=(t,e)=>{const r=e.split("?")[1];return r&&(t+=`?${r}`),t},Yc=class Tr{constructor(e,r){this.linkedSheets=[],this._texture=e instanceof ee?e:null,this.textureSource=e.source,this.textures={},this.animations={},this.data=r;const s=parseFloat(r.meta.scale);s?(this.resolution=s,e.source.resolution=this.resolution):this.resolution=e.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Tr.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let r=e;const s=Tr.BATCH_SIZE;for(;r-e<s&&r<this._frameKeys.length;){const n=this._frameKeys[r],i=this._frames[n],o=i.frame;if(o){let a=null,l=null;const c=i.trimmed!==!1&&i.sourceSize?i.sourceSize:i.frame,h=new me(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);i.rotated?a=new me(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new me(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),i.trimmed!==!1&&i.spriteSourceSize&&(l=new me(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new ee({source:this.textureSource,frame:a,orig:h,trim:l,rotate:i.rotated?2:0,defaultAnchor:i.anchor,defaultBorders:i.borders,label:n.toString()})}r++}}_processAnimations(){const e=this.data.animations||{};for(const r in e){this.animations[r]=[];for(let s=0;s<e[r].length;s++){const n=e[r][s];this.animations[r].push(this.textures[n])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Tr.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Tr.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};Yc.BATCH_SIZE=1e3;let gi=Yc;const of=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function Xc(t,e,r){const s={};if(t.forEach(n=>{s[n]=e}),Object.keys(e.textures).forEach(n=>{s[n]=e.textures[n]}),!r){const n=Oe.dirname(t[0]);e.linkedSheets.forEach((i,o)=>{const a=Xc([`${n}/${e.data.meta.related_multi_packs[o]}`],i,!0);Object.assign(s,a)})}return s}const af={extension:$.Asset,cache:{test:t=>t instanceof gi,getCacheableAssets:(t,e)=>Xc(t,e,!1)},resolver:{extension:{type:$.ResolveParser,name:"resolveSpritesheet"},test:t=>{const r=t.split("?")[0].split("."),s=r.pop(),n=r.pop();return s==="json"&&of.includes(n)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(lr.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:$.LoadParser,priority:kt.Normal,name:"spritesheetLoader"},async testParse(t,e){return Oe.extname(e.src).toLowerCase()===".json"&&!!t.frames},async parse(t,e,r){const{texture:s,imageFilename:n}=e?.data??{};let i=Oe.dirname(e.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let o;if(s instanceof ee)o=s;else{const c=mi(i+(n??t.meta.image),e.src);o=(await r.load([c]))[c]}const a=new gi(o.source,t);await a.parse();const l=t?.meta?.related_multi_packs;if(Array.isArray(l)){const c=[];for(const u of l){if(typeof u!="string")continue;let f=i+u;e.data?.ignoreMultiPack||(f=mi(f,e.src),c.push(r.load({src:f,data:{ignoreMultiPack:!0}})))}const h=await Promise.all(c);a.linkedSheets=h,h.forEach(u=>{u.linkedSheets=[a].concat(a.linkedSheets.filter(f=>f!==u))})}return a},async unload(t,e,r){await r.unload(t.textureSource._sourceOrigin),t.destroy(!1)}}};We.add(af);const cn=Object.create(null),Jo=Object.create(null);function Hi(t,e){let r=Jo[t];return r===void 0&&(cn[e]===void 0&&(cn[e]=1),Jo[t]=r=cn[e]++),r}let is;function Kc(){return(!is||is?.isContextLost())&&(is=ye.get().createCanvas().getContext("webgl",{})),is}let os;function lf(){if(!os){os="mediump";const t=Kc();t&&t.getShaderPrecisionFormat&&(os=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?"highp":"mediump")}return os}function cf(t,e,r){return e?t:r?(t=t.replace("out vec4 finalColor;",""),`
        
        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${t}
        `):`
        
        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${t}
        `}function hf(t,e,r){const s=r?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if(t.substring(0,9)!=="precision"){let n=r?e.requestedFragmentPrecision:e.requestedVertexPrecision;return n==="highp"&&s!=="highp"&&(n="mediump"),`precision ${n} float;
${t}`}else if(s!=="highp"&&t.substring(0,15)==="precision highp")return t.replace("precision highp","precision mediump");return t}function uf(t,e){return e?`#version 300 es
${t}`:t}const df={},ff={};function pf(t,{name:e="pixi-program"},r=!0){e=e.replace(/\s+/g,"-"),e+=r?"-fragment":"-vertex";const s=r?df:ff;return s[e]?(s[e]++,e+=`-${s[e]}`):s[e]=1,t.indexOf("#define SHADER_NAME")!==-1?t:`${`#define SHADER_NAME ${e}`}
${t}`}function mf(t,e){return e?t.replace("#version 300 es",""):t}const hn={stripVersion:mf,ensurePrecision:hf,addProgramDefines:cf,setProgramName:pf,insertVersion:uf},un=Object.create(null),Zc=class yi{constructor(e){e={...yi.defaultOptions,...e};const r=e.fragment.indexOf("#version 300 es")!==-1,s={stripVersion:r,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:lf()},setProgramName:{name:e.name},addProgramDefines:r,insertVersion:r};let n=e.fragment,i=e.vertex;Object.keys(hn).forEach(o=>{const a=s[o];n=hn[o](n,a,!0),i=hn[o](i,a,!1)}),this.fragment=n,this.vertex=i,this.transformFeedbackVaryings=e.transformFeedbackVaryings,this._key=Hi(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(e){const r=`${e.vertex}:${e.fragment}`;return un[r]||(un[r]=new yi(e)),un[r]}};Zc.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let Qc=Zc;const ea={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function gf(t){return ea[t]??ea.float32}const yf={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function xf({source:t,entryPoint:e}){const r={},s=t.indexOf(`fn ${e}`);if(s!==-1){const n=t.indexOf("->",s);if(n!==-1){const i=t.substring(s,n),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let a;for(;(a=o.exec(i))!==null;){const l=yf[a[3]]??"float32";r[a[2]]={location:parseInt(a[1],10),format:l,stride:gf(l).stride,offset:0,instance:!1,start:0}}}}return r}function dn(t){const e=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,r=/@group\((\d+)\)/,s=/@binding\((\d+)\)/,n=/var(<[^>]+>)? (\w+)/,i=/:\s*(\w+)/,o=/struct\s+(\w+)\s*{([^}]+)}/g,a=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,c=t.match(e)?.map(u=>({group:parseInt(u.match(r)[1],10),binding:parseInt(u.match(s)[1],10),name:u.match(n)[2],isUniform:u.match(n)[1]==="<uniform>",type:u.match(i)[1]}));if(!c)return{groups:[],structs:[]};const h=t.match(o)?.map(u=>{const f=u.match(l)[1],d=u.match(a).reduce((g,y)=>{const[p,_]=y.split(":");return g[p.trim()]=_.trim(),g},{});return d?{name:f,members:d}:null}).filter(({name:u})=>c.some(f=>f.type===u))??[];return{groups:c,structs:h}}var Ir=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(Ir||{});function bf({groups:t}){const e=[];for(let r=0;r<t.length;r++){const s=t[r];e[s.group]||(e[s.group]=[]),s.isUniform?e[s.group].push({binding:s.binding,visibility:Ir.VERTEX|Ir.FRAGMENT,buffer:{type:"uniform"}}):s.type==="sampler"?e[s.group].push({binding:s.binding,visibility:Ir.FRAGMENT,sampler:{type:"filtering"}}):s.type==="texture_2d"&&e[s.group].push({binding:s.binding,visibility:Ir.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}function _f({groups:t}){const e=[];for(let r=0;r<t.length;r++){const s=t[r];e[s.group]||(e[s.group]={}),e[s.group][s.name]=s.binding}return e}function wf(t,e){const r=new Set,s=new Set,n=[...t.structs,...e.structs].filter(o=>r.has(o.name)?!1:(r.add(o.name),!0)),i=[...t.groups,...e.groups].filter(o=>{const a=`${o.name}-${o.binding}`;return s.has(a)?!1:(s.add(a),!0)});return{structs:n,groups:i}}const fn=Object.create(null);class zs{constructor(e){this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:r,vertex:s,layout:n,gpuLayout:i,name:o}=e;if(this.name=o,this.fragment=r,this.vertex=s,r.source===s.source){const a=dn(r.source);this.structsAndGroups=a}else{const a=dn(s.source),l=dn(r.source);this.structsAndGroups=wf(a,l)}this.layout=n??_f(this.structsAndGroups),this.gpuLayout=i??bf(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:e,fragment:r}=this,s=e.source+r.source+e.entryPoint+r.entryPoint;this._layoutKey=Hi(s,"program")}get attributeData(){return this._attributeData??(this._attributeData=xf(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(e){const r=`${e.vertex.source}:${e.fragment.source}:${e.fragment.entryPoint}:${e.vertex.entryPoint}`;return fn[r]||(fn[r]=new zs(e)),fn[r]}}const Jc=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],vf=Jc.reduce((t,e)=>(t[e]=!0,t),{});function Af(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const eh=class th{constructor(e,r){this._touched=0,this.uid=ge("uniform"),this._resourceType="uniformGroup",this._resourceId=ge("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,r={...th.defaultOptions,...r},this.uniformStructures=e;const s={};for(const n in e){const i=e[n];if(i.name=n,i.size=i.size??1,!vf[i.type])throw new Error(`Uniform type ${i.type} is not supported. Supported uniform types are: ${Jc.join(", ")}`);i.value??(i.value=Af(i.type,i.size)),s[n]=i.value}this.uniforms=s,this._dirtyId=1,this.ubo=r.ubo,this.isStatic=r.isStatic,this._signature=Hi(Object.keys(s).map(n=>`${n}-${e[n].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};eh.defaultOptions={ubo:!1,isStatic:!1};let rh=eh;class vs{constructor(e){this.resources=Object.create(null),this._dirty=!0;let r=0;for(const s in e){const n=e[s];this.setResource(n,r++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const e=[];let r=0;for(const s in this.resources)e[r++]=this.resources[s]._resourceId;this._key=e.join("|")}setResource(e,r){const s=this.resources[r];e!==s&&(s&&e.off?.("change",this.onResourceChange,this),e.on?.("change",this.onResourceChange,this),this.resources[r]=e,this._dirty=!0)}getResource(e){return this.resources[e]}_touch(e){const r=this.resources;for(const s in r)r[s]._touched=e}destroy(){const e=this.resources;for(const r in e)e[r].off?.("change",this.onResourceChange,this);this.resources=null}onResourceChange(e){if(this._dirty=!0,e.destroyed){const r=this.resources;for(const s in r)r[s]===e&&(r[s]=null)}else this._updateKey()}}var xi=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.BOTH=3]="BOTH",t))(xi||{});class $i extends ot{constructor(e){super(),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:r,glProgram:s,groups:n,resources:i,compatibleRenderers:o,groupMap:a}=e;this.gpuProgram=r,this.glProgram=s,o===void 0&&(o=0,r&&(o|=xi.WEBGPU),s&&(o|=xi.WEBGL)),this.compatibleRenderers=o;const l={};if(!i&&!n&&(i={}),i&&n)throw new Error("[Shader] Cannot have both resources and groups");if(!r&&n&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!r&&n&&a)for(const c in a)for(const h in a[c]){const u=a[c][h];l[u]={group:c,binding:h,name:u}}else if(r&&n&&!a){const c=r.structsAndGroups.groups;a={},c.forEach(h=>{a[h.group]=a[h.group]||{},a[h.group][h.binding]=h.name,l[h.name]=h})}else if(i){n={},a={},r&&r.structsAndGroups.groups.forEach(u=>{a[u.group]=a[u.group]||{},a[u.group][u.binding]=u.name,l[u.name]=u});let c=0;for(const h in i)l[h]||(n[99]||(n[99]=new vs,this._ownedBindGroups.push(n[99])),l[h]={group:99,binding:c,name:h},a[99]=a[99]||{},a[99][c]=h,c++);for(const h in i){const u=h;let f=i[h];!f.source&&!f._resourceType&&(f=new rh(f));const d=l[u];d&&(n[d.group]||(n[d.group]=new vs,this._ownedBindGroups.push(n[d.group])),n[d.group].setResource(f,d.binding))}}this.groups=n,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(n,l)}addResource(e,r,s){var n,i;(n=this._uniformBindMap)[r]||(n[r]={}),(i=this._uniformBindMap[r])[s]||(i[s]=e),this.groups[r]||(this.groups[r]=new vs,this._ownedBindGroups.push(this.groups[r]))}_buildResourceAccessor(e,r){const s={};for(const n in r){const i=r[n];Object.defineProperty(s,i.name,{get(){return e[i.group].getResource(i.binding)},set(o){e[i.group].setResource(o,i.binding)}})}return s}destroy(e=!1){this.emit("destroy",this),e&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(r=>{r.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(e){const{gpu:r,gl:s,...n}=e;let i,o;return r&&(i=zs.from(r)),s&&(o=Qc.from(s)),new $i({gpuProgram:i,glProgram:o,...n})}}var as={exports:{}},ta;function Sf(){if(ta)return as.exports;ta=1,as.exports=t,as.exports.default=t;function t(x,A,C){C=C||2;var v=A&&A.length,w=v?A[0]*C:x.length,k=e(x,0,w,C,!0),T=[];if(!k||k.next===k.prev)return T;var R,B,O,U,V,q,se;if(v&&(k=l(x,A,k,C)),x.length>80*C){R=O=x[0],B=U=x[1];for(var K=C;K<w;K+=C)V=x[K],q=x[K+1],V<R&&(R=V),q<B&&(B=q),V>O&&(O=V),q>U&&(U=q);se=Math.max(O-R,U-B),se=se!==0?32767/se:0}return s(k,T,C,R,B,se,0),T}function e(x,A,C,v,w){var k,T;if(w===Se(x,A,C,v)>0)for(k=A;k<C;k+=v)T=G(k,x[k],x[k+1],T);else for(k=C-v;k>=A;k-=v)T=G(k,x[k],x[k+1],T);return T&&P(T,T.next)&&(X(T),T=T.next),T}function r(x,A){if(!x)return x;A||(A=x);var C=x,v;do if(v=!1,!C.steiner&&(P(C,C.next)||S(C.prev,C,C.next)===0)){if(X(C),C=A=C.prev,C===C.next)break;v=!0}else C=C.next;while(v||C!==A);return A}function s(x,A,C,v,w,k,T){if(x){!T&&k&&d(x,v,w,k);for(var R=x,B,O;x.prev!==x.next;){if(B=x.prev,O=x.next,k?i(x,v,w,k):n(x)){A.push(B.i/C|0),A.push(x.i/C|0),A.push(O.i/C|0),X(x),x=O.next,R=O.next;continue}if(x=O,x===R){T?T===1?(x=o(r(x),A,C),s(x,A,C,v,w,k,2)):T===2&&a(x,A,C,v,w,k):s(r(x),A,C,v,w,k,1);break}}}}function n(x){var A=x.prev,C=x,v=x.next;if(S(A,C,v)>=0)return!1;for(var w=A.x,k=C.x,T=v.x,R=A.y,B=C.y,O=v.y,U=w<k?w<T?w:T:k<T?k:T,V=R<B?R<O?R:O:B<O?B:O,q=w>k?w>T?w:T:k>T?k:T,se=R>B?R>O?R:O:B>O?B:O,K=v.next;K!==A;){if(K.x>=U&&K.x<=q&&K.y>=V&&K.y<=se&&_(w,R,k,B,T,O,K.x,K.y)&&S(K.prev,K,K.next)>=0)return!1;K=K.next}return!0}function i(x,A,C,v){var w=x.prev,k=x,T=x.next;if(S(w,k,T)>=0)return!1;for(var R=w.x,B=k.x,O=T.x,U=w.y,V=k.y,q=T.y,se=R<B?R<O?R:O:B<O?B:O,K=U<V?U<q?U:q:V<q?V:q,lt=R>B?R>O?R:O:B>O?B:O,je=U>V?U>q?U:q:V>q?V:q,Ze=y(se,K,A,C,v),Qe=y(lt,je,A,C,v),Q=x.prevZ,te=x.nextZ;Q&&Q.z>=Ze&&te&&te.z<=Qe;){if(Q.x>=se&&Q.x<=lt&&Q.y>=K&&Q.y<=je&&Q!==w&&Q!==T&&_(R,U,B,V,O,q,Q.x,Q.y)&&S(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,te.x>=se&&te.x<=lt&&te.y>=K&&te.y<=je&&te!==w&&te!==T&&_(R,U,B,V,O,q,te.x,te.y)&&S(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;Q&&Q.z>=Ze;){if(Q.x>=se&&Q.x<=lt&&Q.y>=K&&Q.y<=je&&Q!==w&&Q!==T&&_(R,U,B,V,O,q,Q.x,Q.y)&&S(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;te&&te.z<=Qe;){if(te.x>=se&&te.x<=lt&&te.y>=K&&te.y<=je&&te!==w&&te!==T&&_(R,U,B,V,O,q,te.x,te.y)&&S(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function o(x,A,C){var v=x;do{var w=v.prev,k=v.next.next;!P(w,k)&&E(w,v,v.next,k)&&F(w,k)&&F(k,w)&&(A.push(w.i/C|0),A.push(v.i/C|0),A.push(k.i/C|0),X(v),X(v.next),v=x=k),v=v.next}while(v!==x);return r(v)}function a(x,A,C,v,w,k){var T=x;do{for(var R=T.next.next;R!==T.prev;){if(T.i!==R.i&&b(T,R)){var B=N(T,R);T=r(T,T.next),B=r(B,B.next),s(T,A,C,v,w,k,0),s(B,A,C,v,w,k,0);return}R=R.next}T=T.next}while(T!==x)}function l(x,A,C,v){var w=[],k,T,R,B,O;for(k=0,T=A.length;k<T;k++)R=A[k]*v,B=k<T-1?A[k+1]*v:x.length,O=e(x,R,B,v,!1),O===O.next&&(O.steiner=!0),w.push(p(O));for(w.sort(c),k=0;k<w.length;k++)C=h(w[k],C);return C}function c(x,A){return x.x-A.x}function h(x,A){var C=u(x,A);if(!C)return A;var v=N(C,x);return r(v,v.next),r(C,C.next)}function u(x,A){var C=A,v=x.x,w=x.y,k=-1/0,T;do{if(w<=C.y&&w>=C.next.y&&C.next.y!==C.y){var R=C.x+(w-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(R<=v&&R>k&&(k=R,T=C.x<C.next.x?C:C.next,R===v))return T}C=C.next}while(C!==A);if(!T)return null;var B=T,O=T.x,U=T.y,V=1/0,q;C=T;do v>=C.x&&C.x>=O&&v!==C.x&&_(w<U?v:k,w,O,U,w<U?k:v,w,C.x,C.y)&&(q=Math.abs(w-C.y)/(v-C.x),F(C,x)&&(q<V||q===V&&(C.x>T.x||C.x===T.x&&f(T,C)))&&(T=C,V=q)),C=C.next;while(C!==B);return T}function f(x,A){return S(x.prev,x,A.prev)<0&&S(A.next,x,x.next)<0}function d(x,A,C,v){var w=x;do w.z===0&&(w.z=y(w.x,w.y,A,C,v)),w.prevZ=w.prev,w.nextZ=w.next,w=w.next;while(w!==x);w.prevZ.nextZ=null,w.prevZ=null,g(w)}function g(x){var A,C,v,w,k,T,R,B,O=1;do{for(C=x,x=null,k=null,T=0;C;){for(T++,v=C,R=0,A=0;A<O&&(R++,v=v.nextZ,!!v);A++);for(B=O;R>0||B>0&&v;)R!==0&&(B===0||!v||C.z<=v.z)?(w=C,C=C.nextZ,R--):(w=v,v=v.nextZ,B--),k?k.nextZ=w:x=w,w.prevZ=k,k=w;C=v}k.nextZ=null,O*=2}while(T>1);return x}function y(x,A,C,v,w){return x=(x-C)*w|0,A=(A-v)*w|0,x=(x|x<<8)&16711935,x=(x|x<<4)&252645135,x=(x|x<<2)&858993459,x=(x|x<<1)&1431655765,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,x|A<<1}function p(x){var A=x,C=x;do(A.x<C.x||A.x===C.x&&A.y<C.y)&&(C=A),A=A.next;while(A!==x);return C}function _(x,A,C,v,w,k,T,R){return(w-T)*(A-R)>=(x-T)*(k-R)&&(x-T)*(v-R)>=(C-T)*(A-R)&&(C-T)*(k-R)>=(w-T)*(v-R)}function b(x,A){return x.next.i!==A.i&&x.prev.i!==A.i&&!z(x,A)&&(F(x,A)&&F(A,x)&&j(x,A)&&(S(x.prev,x,A.prev)||S(x,A.prev,A))||P(x,A)&&S(x.prev,x,x.next)>0&&S(A.prev,A,A.next)>0)}function S(x,A,C){return(A.y-x.y)*(C.x-A.x)-(A.x-x.x)*(C.y-A.y)}function P(x,A){return x.x===A.x&&x.y===A.y}function E(x,A,C,v){var w=I(S(x,A,C)),k=I(S(x,A,v)),T=I(S(C,v,x)),R=I(S(C,v,A));return!!(w!==k&&T!==R||w===0&&M(x,C,A)||k===0&&M(x,v,A)||T===0&&M(C,x,v)||R===0&&M(C,A,v))}function M(x,A,C){return A.x<=Math.max(x.x,C.x)&&A.x>=Math.min(x.x,C.x)&&A.y<=Math.max(x.y,C.y)&&A.y>=Math.min(x.y,C.y)}function I(x){return x>0?1:x<0?-1:0}function z(x,A){var C=x;do{if(C.i!==x.i&&C.next.i!==x.i&&C.i!==A.i&&C.next.i!==A.i&&E(C,C.next,x,A))return!0;C=C.next}while(C!==x);return!1}function F(x,A){return S(x.prev,x,x.next)<0?S(x,A,x.next)>=0&&S(x,x.prev,A)>=0:S(x,A,x.prev)<0||S(x,x.next,A)<0}function j(x,A){var C=x,v=!1,w=(x.x+A.x)/2,k=(x.y+A.y)/2;do C.y>k!=C.next.y>k&&C.next.y!==C.y&&w<(C.next.x-C.x)*(k-C.y)/(C.next.y-C.y)+C.x&&(v=!v),C=C.next;while(C!==x);return v}function N(x,A){var C=new J(x.i,x.x,x.y),v=new J(A.i,A.x,A.y),w=x.next,k=A.prev;return x.next=A,A.prev=x,C.next=w,w.prev=C,v.next=C,C.prev=v,k.next=v,v.prev=k,v}function G(x,A,C,v){var w=new J(x,A,C);return v?(w.next=v.next,w.prev=v,v.next.prev=w,v.next=w):(w.prev=w,w.next=w),w}function X(x){x.next.prev=x.prev,x.prev.next=x.next,x.prevZ&&(x.prevZ.nextZ=x.nextZ),x.nextZ&&(x.nextZ.prevZ=x.prevZ)}function J(x,A,C){this.i=x,this.x=A,this.y=C,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}t.deviation=function(x,A,C,v){var w=A&&A.length,k=w?A[0]*C:x.length,T=Math.abs(Se(x,0,k,C));if(w)for(var R=0,B=A.length;R<B;R++){var O=A[R]*C,U=R<B-1?A[R+1]*C:x.length;T-=Math.abs(Se(x,O,U,C))}var V=0;for(R=0;R<v.length;R+=3){var q=v[R]*C,se=v[R+1]*C,K=v[R+2]*C;V+=Math.abs((x[q]-x[K])*(x[se+1]-x[q+1])-(x[q]-x[se])*(x[K+1]-x[q+1]))}return T===0&&V===0?0:Math.abs((V-T)/T)};function Se(x,A,C,v){for(var w=0,k=A,T=C-v;k<C;k+=v)w+=(x[T]-x[k])*(x[k+1]+x[T+1]),T=k;return w}return t.flatten=function(x){for(var A=x[0][0].length,C={vertices:[],holes:[],dimensions:A},v=0,w=0;w<x.length;w++){for(var k=0;k<x[w].length;k++)for(var T=0;T<A;T++)C.vertices.push(x[w][k][T]);w>0&&(v+=x[w-1].length,C.holes.push(v))}return C},as.exports}var kf=Sf();const Cf=Ye(kf);class sh extends ot{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return pe(Ce,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return pe(Ce,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return pe(Ce,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return pe(Ce,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return pe(Ce,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners();for(const r in this.chars)this.chars[r].texture?.destroy();this.chars=null,e&&(this.pages.forEach(r=>r.texture.destroy(!0)),this.pages=null)}}const nh=class bi{constructor(e,r,s,n){this.uid=ge("fillGradient"),this.type="linear",this.gradientStops=[],this._styleKey=null,this.x0=e,this.y0=r,this.x1=s,this.y1=n}addColorStop(e,r){return this.gradientStops.push({offset:e,color:Ae.shared.setValue(r).toHexa()}),this._styleKey=null,this}buildLinearGradient(){if(this.texture)return;const e=bi.defaultTextureSize,{gradientStops:r}=this,s=ye.get().createCanvas();s.width=e,s.height=e;const n=s.getContext("2d"),i=n.createLinearGradient(0,0,bi.defaultTextureSize,1);for(let y=0;y<r.length;y++){const p=r[y];i.addColorStop(p.offset,p.color)}n.fillStyle=i,n.fillRect(0,0,e,e),this.texture=new ee({source:new ar({resource:s,addressModeU:"clamp-to-edge",addressModeV:"repeat"})});const{x0:o,y0:a,x1:l,y1:c}=this,h=new re,u=l-o,f=c-a,d=Math.sqrt(u*u+f*f),g=Math.atan2(f,u);h.translate(-o,-a),h.scale(1/e,1/e),h.rotate(-g),h.scale(256/d,1),this.transform=h,this._styleKey=null}get styleKey(){if(this._styleKey)return this._styleKey;const e=this.gradientStops.map(n=>`${n.offset}-${n.color}`).join("-"),r=this.texture.uid,s=this.transform.toArray().join("-");return`fill-gradient-${this.uid}-${e}-${r}-${s}-${this.x0}-${this.y0}-${this.x1}-${this.y1}`}};nh.defaultTextureSize=256;let Dr=nh;const ra={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Fs{constructor(e,r){this.uid=ge("fillPattern"),this.transform=new re,this._styleKey=null,this.texture=e,this.transform.scale(1/e.frame.width,1/e.frame.height),r&&(e.source.style.addressModeU=ra[r].addressModeU,e.source.style.addressModeV=ra[r].addressModeV)}setTransform(e){const r=this.texture;this.transform.copyFrom(e),this.transform.invert(),this.transform.scale(1/r.frame.width,1/r.frame.height),this._styleKey=null}get styleKey(){return this._styleKey?this._styleKey:(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`,this._styleKey)}}var pn,sa;function Pf(){if(sa)return pn;sa=1,pn=r;var t={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},e=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function r(i){var o=[];return i.replace(e,function(a,l,c){var h=l.toLowerCase();for(c=n(c),h=="m"&&c.length>2&&(o.push([l].concat(c.splice(0,2))),h="l",l=l=="m"?"l":"L");;){if(c.length==t[h])return c.unshift(l),o.push(c);if(c.length<t[h])throw new Error("malformed path data");o.push([l].concat(c.splice(0,t[h])))}}),o}var s=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function n(i){var o=i.match(s);return o?o.map(Number):[]}return pn}var Mf=Pf();const Tf=Ye(Mf);function If(t,e){const r=Tf(t),s=[];let n=null,i=0,o=0;for(let a=0;a<r.length;a++){const l=r[a],c=l[0],h=l;switch(c){case"M":i=h[1],o=h[2],e.moveTo(i,o);break;case"m":i+=h[1],o+=h[2],e.moveTo(i,o);break;case"H":i=h[1],e.lineTo(i,o);break;case"h":i+=h[1],e.lineTo(i,o);break;case"V":o=h[1],e.lineTo(i,o);break;case"v":o+=h[1],e.lineTo(i,o);break;case"L":i=h[1],o=h[2],e.lineTo(i,o);break;case"l":i+=h[1],o+=h[2],e.lineTo(i,o);break;case"C":i=h[5],o=h[6],e.bezierCurveTo(h[1],h[2],h[3],h[4],i,o);break;case"c":e.bezierCurveTo(i+h[1],o+h[2],i+h[3],o+h[4],i+h[5],o+h[6]),i+=h[5],o+=h[6];break;case"S":i=h[3],o=h[4],e.bezierCurveToShort(h[1],h[2],i,o);break;case"s":e.bezierCurveToShort(i+h[1],o+h[2],i+h[3],o+h[4]),i+=h[3],o+=h[4];break;case"Q":i=h[3],o=h[4],e.quadraticCurveTo(h[1],h[2],i,o);break;case"q":e.quadraticCurveTo(i+h[1],o+h[2],i+h[3],o+h[4]),i+=h[3],o+=h[4];break;case"T":i=h[1],o=h[2],e.quadraticCurveToShort(i,o);break;case"t":i+=h[1],o+=h[2],e.quadraticCurveToShort(i,o);break;case"A":i=h[6],o=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],i,o);break;case"a":i+=h[6],o+=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],i,o);break;case"Z":case"z":e.closePath(),s.length>0&&(n=s.pop(),n?(i=n.startX,o=n.startY):(i=0,o=0)),n=null;break;default:fe(`Unknown SVG path command: ${c}`)}c!=="Z"&&c!=="z"&&n===null&&(n={startX:i,startY:o},s.push(n))}return e}class Ui{constructor(e=0,r=0,s=0){this.type="circle",this.x=e,this.y=r,this.radius=s}clone(){return new Ui(this.x,this.y,this.radius)}contains(e,r){if(this.radius<=0)return!1;const s=this.radius*this.radius;let n=this.x-e,i=this.y-r;return n*=n,i*=i,n+i<=s}strokeContains(e,r,s,n=.5){if(this.radius===0)return!1;const i=this.x-e,o=this.y-r,a=this.radius,l=(1-n)*s,c=Math.sqrt(i*i+o*o);return c<=a+l&&c>a-(s-l)}getBounds(e){return e||(e=new me),e.x=this.x-this.radius,e.y=this.y-this.radius,e.width=this.radius*2,e.height=this.radius*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.radius=e.radius,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Vi{constructor(e=0,r=0,s=0,n=0){this.type="ellipse",this.x=e,this.y=r,this.halfWidth=s,this.halfHeight=n}clone(){return new Vi(this.x,this.y,this.halfWidth,this.halfHeight)}contains(e,r){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let s=(e-this.x)/this.halfWidth,n=(r-this.y)/this.halfHeight;return s*=s,n*=n,s+n<=1}strokeContains(e,r,s,n=.5){const{halfWidth:i,halfHeight:o}=this;if(i<=0||o<=0)return!1;const a=s*(1-n),l=s-a,c=i-l,h=o-l,u=i+a,f=o+a,d=e-this.x,g=r-this.y,y=d*d/(c*c)+g*g/(h*h),p=d*d/(u*u)+g*g/(f*f);return y>1&&p<=1}getBounds(e){return e||(e=new me),e.x=this.x-this.halfWidth,e.y=this.y-this.halfHeight,e.width=this.halfWidth*2,e.height=this.halfHeight*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.halfWidth=e.halfWidth,this.halfHeight=e.halfHeight,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function Ef(t,e,r,s,n,i){const o=t-r,a=e-s,l=n-r,c=i-s,h=o*l+a*c,u=l*l+c*c;let f=-1;u!==0&&(f=h/u);let d,g;f<0?(d=r,g=s):f>1?(d=n,g=i):(d=r+f*l,g=s+f*c);const y=t-d,p=e-g;return y*y+p*p}class Or{constructor(...e){this.type="polygon";let r=Array.isArray(e[0])?e[0]:e;if(typeof r[0]!="number"){const s=[];for(let n=0,i=r.length;n<i;n++)s.push(r[n].x,r[n].y);r=s}this.points=r,this.closePath=!0}clone(){const e=this.points.slice(),r=new Or(e);return r.closePath=this.closePath,r}contains(e,r){let s=!1;const n=this.points.length/2;for(let i=0,o=n-1;i<n;o=i++){const a=this.points[i*2],l=this.points[i*2+1],c=this.points[o*2],h=this.points[o*2+1];l>r!=h>r&&e<(c-a)*((r-l)/(h-l))+a&&(s=!s)}return s}strokeContains(e,r,s,n=.5){const i=s*s,o=i*(1-n),a=i-o,{points:l}=this,c=l.length-(this.closePath?0:2);for(let h=0;h<c;h+=2){const u=l[h],f=l[h+1],d=l[(h+2)%l.length],g=l[(h+3)%l.length],y=Ef(e,r,u,f,d,g),p=Math.sign((d-u)*(r-f)-(g-f)*(e-u));if(y<=(p<0?a:o))return!0}return!1}getBounds(e){e||(e=new me);const r=this.points;let s=1/0,n=-1/0,i=1/0,o=-1/0;for(let a=0,l=r.length;a<l;a+=2){const c=r[a],h=r[a+1];s=c<s?c:s,n=c>n?c:n,i=h<i?h:i,o=h>o?h:o}return e.x=s,e.width=n-s,e.y=i,e.height=o-i,e}copyFrom(e){return this.points=e.points.slice(),this.closePath=e.closePath,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((e,r)=>`${e}, ${r}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}const ls=(t,e,r,s,n,i,o)=>{const a=t-r,l=e-s,c=Math.sqrt(a*a+l*l);return c>=n-i&&c<=n+o};class qi{constructor(e=0,r=0,s=0,n=0,i=20){this.type="roundedRectangle",this.x=e,this.y=r,this.width=s,this.height=n,this.radius=i}getBounds(e){return e||(e=new me),e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}clone(){return new qi(this.x,this.y,this.width,this.height,this.radius)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,r){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&r>=this.y&&r<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(r>=this.y+s&&r<=this.y+this.height-s||e>=this.x+s&&e<=this.x+this.width-s)return!0;let n=e-(this.x+s),i=r-(this.y+s);const o=s*s;if(n*n+i*i<=o||(n=e-(this.x+this.width-s),n*n+i*i<=o)||(i=r-(this.y+this.height-s),n*n+i*i<=o)||(n=e-(this.x+s),n*n+i*i<=o))return!0}return!1}strokeContains(e,r,s,n=.5){const{x:i,y:o,width:a,height:l,radius:c}=this,h=s*(1-n),u=s-h,f=i+c,d=o+c,g=a-c*2,y=l-c*2,p=i+a,_=o+l;return(e>=i-h&&e<=i+u||e>=p-u&&e<=p+h)&&r>=d&&r<=d+y||(r>=o-h&&r<=o+u||r>=_-u&&r<=_+h)&&e>=f&&e<=f+g?!0:e<f&&r<d&&ls(e,r,f,d,c,u,h)||e>p-c&&r<d&&ls(e,r,p-c,d,c,u,h)||e>p-c&&r>_-c&&ls(e,r,p-c,_-c,c,u,h)||e<f&&r>_-c&&ls(e,r,f,_-c,c,u,h)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const Rf=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function jf(t){let e="";for(let r=0;r<t;++r)r>0&&(e+=`
else `),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}function Bf(t,e){if(t===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);try{for(;;){const s=Rf.replace(/%forloop%/gi,jf(t));if(e.shaderSource(r,s),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))t=t/2|0;else break}}finally{e.deleteShader(r)}return t}let $t=null;function ih(){if($t)return $t;const t=Kc();return $t=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),$t=Bf($t,t),t.getExtension("WEBGL_lose_context")?.loseContext(),$t}const oh={};function zf(t,e){let r=2166136261;for(let s=0;s<e;s++)r^=t[s].uid,r=Math.imul(r,16777619),r>>>=0;return oh[r]||Ff(t,e,r)}let mn=0;function Ff(t,e,r){const s={};let n=0;mn||(mn=ih());for(let o=0;o<mn;o++){const a=o<e?t[o]:ee.EMPTY.source;s[n++]=a.source,s[n++]=a.style}const i=new vs(s);return oh[r]=i,i}class na{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}function ia(t,e){const r=t.byteLength/8|0,s=new Float64Array(t,0,r);new Float64Array(e,0,r).set(s);const i=t.byteLength-r*8;if(i>0){const o=new Uint8Array(t,r*8,i);new Uint8Array(e,r*8,i).set(o)}}const Of={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var Nf=(t=>(t[t.DISABLED=0]="DISABLED",t[t.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",t[t.MASK_ACTIVE=2]="MASK_ACTIVE",t[t.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",t[t.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",t[t.NONE=5]="NONE",t))(Nf||{});function oa(t,e){return e.alphaMode==="no-premultiply-alpha"&&Of[t]||t}class Lf{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let e=0;e<this.count;e++){const r=this.textures[e];this.textures[e]=null,this.ids[r.uid]=null}this.count=0}}class Df{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new Lf,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const ah=[];let _i=0;function aa(){return _i>0?ah[--_i]:new Df}function la(t){ah[_i++]=t}let mr=0;const lh=class As{constructor(e={}){this.uid=ge("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],As.defaultOptions.maxTextures=As.defaultOptions.maxTextures??ih(),e={...As.defaultOptions,...e};const{maxTextures:r,attributesInitialSize:s,indicesInitialSize:n}=e;this.attributeBuffer=new na(s*4),this.indexBuffer=new Uint16Array(n),this.maxTextures=r}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let e=0;e<this.batchIndex;e++)la(this.batches[e]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(e){this._elements[this.elementSize++]=e,e._indexStart=this.indexSize,e._attributeStart=this.attributeSize,e._batcher=this,this.indexSize+=e.indexSize,this.attributeSize+=e.attributeSize*this.vertexSize}checkAndUpdateTexture(e,r){const s=e._batch.textures.ids[r._source.uid];return!s&&s!==0?!1:(e._textureId=s,e.texture=r,!0)}updateElement(e){this.dirty=!0;const r=this.attributeBuffer;e.packAsQuad?this.packQuadAttributes(e,r.float32View,r.uint32View,e._attributeStart,e._textureId):this.packAttributes(e,r.float32View,r.uint32View,e._attributeStart,e._textureId)}break(e){const r=this._elements;if(!r[this.elementStart])return;let s=aa(),n=s.textures;n.clear();const i=r[this.elementStart];let o=oa(i.blendMode,i.texture._source),a=i.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const l=this.attributeBuffer.float32View,c=this.attributeBuffer.uint32View,h=this.indexBuffer;let u=this._batchIndexSize,f=this._batchIndexStart,d="startBatch";const g=this.maxTextures;for(let y=this.elementStart;y<this.elementSize;++y){const p=r[y];r[y]=null;const b=p.texture._source,S=oa(p.blendMode,b),P=o!==S||a!==p.topology;if(b._batchTick===mr&&!P){p._textureId=b._textureBindLocation,u+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,l,c,p._attributeStart,p._textureId),this.packQuadIndex(h,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,l,c,p._attributeStart,p._textureId),this.packIndex(p,h,p._indexStart,p._attributeStart/this.vertexSize)),p._batch=s;continue}b._batchTick=mr,(n.count>=g||P)&&(this._finishBatch(s,f,u-f,n,o,a,e,d),d="renderBatch",f=u,o=S,a=p.topology,s=aa(),n=s.textures,n.clear(),++mr),p._textureId=b._textureBindLocation=n.count,n.ids[b.uid]=n.count,n.textures[n.count++]=b,p._batch=s,u+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,l,c,p._attributeStart,p._textureId),this.packQuadIndex(h,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,l,c,p._attributeStart,p._textureId),this.packIndex(p,h,p._indexStart,p._attributeStart/this.vertexSize))}n.count>0&&(this._finishBatch(s,f,u-f,n,o,a,e,d),f=u,++mr),this.elementStart=this.elementSize,this._batchIndexStart=f,this._batchIndexSize=u}_finishBatch(e,r,s,n,i,o,a,l){e.gpuBindGroup=null,e.bindGroup=null,e.action=l,e.batcher=this,e.textures=n,e.blendMode=i,e.topology=o,e.start=r,e.size=s,++mr,this.batches[this.batchIndex++]=e,a.add(e)}finish(e){this.break(e)}ensureAttributeBuffer(e){e*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(e*4)}ensureIndexBuffer(e){e<=this.indexBuffer.length||this._resizeIndexBuffer(e)}_resizeAttributeBuffer(e){const r=Math.max(e,this.attributeBuffer.size*2),s=new na(r);ia(this.attributeBuffer.rawBinaryData,s.rawBinaryData),this.attributeBuffer=s}_resizeIndexBuffer(e){const r=this.indexBuffer;let s=Math.max(e,r.length*1.5);s+=s%2;const n=s>65535?new Uint32Array(s):new Uint16Array(s);if(n.BYTES_PER_ELEMENT!==r.BYTES_PER_ELEMENT)for(let i=0;i<r.length;i++)n[i]=r[i];else ia(r.buffer,n.buffer);this.indexBuffer=n}packQuadIndex(e,r,s){e[r]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+3]=s+0,e[r+4]=s+2,e[r+5]=s+3}packIndex(e,r,s,n){const i=e.indices,o=e.indexSize,a=e.indexOffset,l=e.attributeOffset;for(let c=0;c<o;c++)r[s++]=n+i[c+a]-l}destroy(){for(let e=0;e<this.batches.length;e++)la(this.batches[e]);this.batches=null;for(let e=0;e<this._elements.length;e++)this._elements[e]._batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};lh.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let Gf=lh;var Ee=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(Ee||{});class Gr extends ot{constructor(e){let{data:r,size:s}=e;const{usage:n,label:i,shrinkToFit:o}=e;super(),this.uid=ge("buffer"),this._resourceType="buffer",this._resourceId=ge("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,r instanceof Array&&(r=new Float32Array(r)),this._data=r,s??(s=r?.byteLength);const a=!!r;this.descriptor={size:s,usage:n,mappedAtCreation:a,label:i},this.shrinkToFit=o??!0}get data(){return this._data}set data(e){this.setDataWithSize(e,e.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&Ee.STATIC)}set static(e){e?this.descriptor.usage|=Ee.STATIC:this.descriptor.usage&=~Ee.STATIC}setDataWithSize(e,r,s){if(this._updateID++,this._updateSize=r*e.BYTES_PER_ELEMENT,this._data===e){s&&this.emit("update",this);return}const n=this._data;if(this._data=e,this._dataInt32=null,!n||n.length!==e.length){!this.shrinkToFit&&n&&e.byteLength<n.byteLength?s&&this.emit("update",this):(this.descriptor.size=e.byteLength,this._resourceId=ge("resource"),this.emit("change",this));return}s&&this.emit("update",this)}update(e){this._updateSize=e??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function ch(t,e){if(!(t instanceof Gr)){let r=e?Ee.INDEX:Ee.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),r=Ee.INDEX|Ee.COPY_DST):(t=new Float32Array(t),r=Ee.VERTEX|Ee.COPY_DST)),t=new Gr({data:t,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:r})}return t}function Wf(t,e,r){const s=t.getAttribute(e);if(!s)return r.minX=0,r.minY=0,r.maxX=0,r.maxY=0,r;const n=s.buffer.data;let i=1/0,o=1/0,a=-1/0,l=-1/0;const c=n.BYTES_PER_ELEMENT,h=(s.offset||0)/c,u=(s.stride||2*4)/c;for(let f=h;f<n.length;f+=u){const d=n[f],g=n[f+1];d>a&&(a=d),g>l&&(l=g),d<i&&(i=d),g<o&&(o=g)}return r.minX=i,r.minY=o,r.maxX=a,r.maxY=l,r}function Hf(t){return(t instanceof Gr||Array.isArray(t)||t.BYTES_PER_ELEMENT)&&(t={buffer:t}),t.buffer=ch(t.buffer,!1),t}class $f extends ot{constructor(e={}){super(),this.uid=ge("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new it,this._boundsDirty=!0;const{attributes:r,indexBuffer:s,topology:n}=e;if(this.buffers=[],this.attributes={},r)for(const i in r)this.addAttribute(i,r[i]);this.instanceCount=e.instanceCount??1,s&&this.addIndex(s),this.topology=n||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(e){return this.attributes[e]}getIndex(){return this.indexBuffer}getBuffer(e){return this.getAttribute(e).buffer}getSize(){for(const e in this.attributes){const r=this.attributes[e];return r.buffer.data.length/(r.stride/4||r.size)}return 0}addAttribute(e,r){const s=Hf(r);this.buffers.indexOf(s.buffer)===-1&&(this.buffers.push(s.buffer),s.buffer.on("update",this.onBufferUpdate,this),s.buffer.on("change",this.onBufferUpdate,this)),this.attributes[e]=s}addIndex(e){this.indexBuffer=ch(e,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,Wf(this,"aPosition",this._bounds)):this._bounds}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners(),e&&this.buffers.forEach(r=>r.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const Uf=new Float32Array(1),Vf=new Uint32Array(1);class qf extends $f{constructor(){const r=new Gr({data:Uf,label:"attribute-batch-buffer",usage:Ee.VERTEX|Ee.COPY_DST,shrinkToFit:!1}),s=new Gr({data:Vf,label:"index-batch-buffer",usage:Ee.INDEX|Ee.COPY_DST,shrinkToFit:!1}),n=6*4;super({attributes:{aPosition:{buffer:r,format:"float32x2",stride:n,offset:0},aUV:{buffer:r,format:"float32x2",stride:n,offset:2*4},aColor:{buffer:r,format:"unorm8x4",stride:n,offset:4*4},aTextureIdAndRound:{buffer:r,format:"uint16x2",stride:n,offset:5*4}},indexBuffer:s})}}function ca(t,e,r){if(t)for(const s in t){const n=s.toLocaleLowerCase(),i=e[n];if(i){let o=t[s];s==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),r&&i.push(`//----${r}----//`),i.push(o)}else fe(`${s} placement hook does not exist in shader`)}}const Yf=/\{\{(.*?)\}\}/g;function ha(t){const e={};return(t.match(Yf)?.map(s=>s.replace(/[{()}]/g,""))??[]).forEach(s=>{e[s]=[]}),e}function ua(t,e){let r;const s=/@in\s+([^;]+);/g;for(;(r=s.exec(t))!==null;)e.push(r[1])}function da(t,e,r=!1){const s=[];ua(e,s),t.forEach(a=>{a.header&&ua(a.header,s)});const n=s;r&&n.sort();const i=n.map((a,l)=>`       @location(${l}) ${a},`).join(`
`);let o=e.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${i}
`),o}function fa(t,e){let r;const s=/@out\s+([^;]+);/g;for(;(r=s.exec(t))!==null;)e.push(r[1])}function Xf(t){const r=/\b(\w+)\s*:/g.exec(t);return r?r[1]:""}function Kf(t){const e=/@.*?\s+/g;return t.replace(e,"")}function Zf(t,e){const r=[];fa(e,r),t.forEach(l=>{l.header&&fa(l.header,r)});let s=0;const n=r.sort().map(l=>l.indexOf("builtin")>-1?l:`@location(${s++}) ${l}`).join(`,
`),i=r.sort().map(l=>`       var ${Kf(l)};`).join(`
`),o=`return VSOutput(
            ${r.sort().map(l=>` ${Xf(l)}`).join(`,
`)});`;let a=e.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`
${n}
`),a=a.replace("{{start}}",`
${i}
`),a=a.replace("{{return}}",`
${o}
`),a}function pa(t,e){let r=t;for(const s in e){const n=e[s];n.join(`
`).length?r=r.replace(`{{${s}}}`,`//-----${s} START-----//
${n.join(`
`)}
//----${s} FINISH----//`):r=r.replace(`{{${s}}}`,"")}return r}const At=Object.create(null),gn=new Map;let Qf=0;function Jf({template:t,bits:e}){const r=hh(t,e);if(At[r])return At[r];const{vertex:s,fragment:n}=tp(t,e);return At[r]=uh(s,n,e),At[r]}function ep({template:t,bits:e}){const r=hh(t,e);return At[r]||(At[r]=uh(t.vertex,t.fragment,e)),At[r]}function tp(t,e){const r=e.map(o=>o.vertex).filter(o=>!!o),s=e.map(o=>o.fragment).filter(o=>!!o);let n=da(r,t.vertex,!0);n=Zf(r,n);const i=da(s,t.fragment,!0);return{vertex:n,fragment:i}}function hh(t,e){return e.map(r=>(gn.has(r)||gn.set(r,Qf++),gn.get(r))).sort((r,s)=>r-s).join("-")+t.vertex+t.fragment}function uh(t,e,r){const s=ha(t),n=ha(e);return r.forEach(i=>{ca(i.vertex,s,i.name),ca(i.fragment,n,i.name)}),{vertex:pa(t,s),fragment:pa(e,n)}}const rp=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}
        
        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);
       
        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,sp=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;
   
    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {
        
        {{start}}

        var outColor:vec4<f32>;
      
        {{main}}
        
        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,np=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;
        
        {{start}}
        
        vColor = vec4(1.);
        
        {{main}}
        
        vUV = uv;
        
        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,ip=`
   
    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {
        
        {{start}}

        vec4 outColor;
      
        {{main}}
        
        finalColor = outColor * vColor;
        
        {{end}}
    }
`,op={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},ap={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function lp({bits:t,name:e}){const r=Jf({template:{fragment:sp,vertex:rp},bits:[op,...t]});return zs.from({name:e,vertex:{source:r.vertex,entryPoint:"main"},fragment:{source:r.fragment,entryPoint:"main"}})}function cp({bits:t,name:e}){return new Qc({name:e,...ep({template:{vertex:np,fragment:ip},bits:[ap,...t]})})}const hp={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},up={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},yn={};function dp(t){const e=[];if(t===1)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let r=0;for(let s=0;s<t;s++)e.push(`@group(1) @binding(${r++}) var textureSource${s+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${r++}) var textureSampler${s+1}: sampler;`)}return e.join(`
`)}function fp(t){const e=[];if(t===1)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let r=0;r<t;r++)r===t-1?e.push("  default:{"):e.push(`  case ${r}:{`),e.push(`      outColor = textureSampleGrad(textureSource${r+1}, textureSampler${r+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join(`
`)}function pp(t){return yn[t]||(yn[t]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${dp(t)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${fp(t)}
            `}}),yn[t]}const xn={};function mp(t){const e=[];for(let r=0;r<t;r++)r>0&&e.push("else"),r<t-1&&e.push(`if(vTextureId < ${r}.5)`),e.push("{"),e.push(`	outColor = texture(uTextures[${r}], vUV);`),e.push("}");return e.join(`
`)}function gp(t){return xn[t]||(xn[t]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${t}];

            `,main:`

                ${mp(t)}
            `}}),xn[t]}const yp={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32> 
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},xp={name:"round-pixels-bit",vertex:{header:`   
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {       
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},ma={};function bp(t){let e=ma[t];if(e)return e;const r=new Int32Array(t);for(let s=0;s<t;s++)r[s]=s;return e=ma[t]=new rh({uTextures:{value:r,type:"i32",size:t}},{isStatic:!0}),e}class _p extends $i{constructor(e){const r=cp({name:"batch",bits:[up,gp(e),xp]}),s=lp({name:"batch",bits:[hp,pp(e),yp]});super({glProgram:r,gpuProgram:s,resources:{batchSamplers:bp(e)}})}}let ga=null;const dh=class fh extends Gf{constructor(){super(...arguments),this.geometry=new qf,this.shader=ga||(ga=new _p(this.maxTextures)),this.name=fh.extension.name,this.vertexSize=6}packAttributes(e,r,s,n,i){const o=i<<16|e.roundPixels&65535,a=e.transform,l=a.a,c=a.b,h=a.c,u=a.d,f=a.tx,d=a.ty,{positions:g,uvs:y}=e,p=e.color,_=e.attributeOffset,b=_+e.attributeSize;for(let S=_;S<b;S++){const P=S*2,E=g[P],M=g[P+1];r[n++]=l*E+h*M+f,r[n++]=u*M+c*E+d,r[n++]=y[P],r[n++]=y[P+1],s[n++]=p,s[n++]=o}}packQuadAttributes(e,r,s,n,i){const o=e.texture,a=e.transform,l=a.a,c=a.b,h=a.c,u=a.d,f=a.tx,d=a.ty,g=e.bounds,y=g.maxX,p=g.minX,_=g.maxY,b=g.minY,S=o.uvs,P=e.color,E=i<<16|e.roundPixels&65535;r[n+0]=l*p+h*b+f,r[n+1]=u*b+c*p+d,r[n+2]=S.x0,r[n+3]=S.y0,s[n+4]=P,s[n+5]=E,r[n+6]=l*y+h*b+f,r[n+7]=u*b+c*y+d,r[n+8]=S.x1,r[n+9]=S.y1,s[n+10]=P,s[n+11]=E,r[n+12]=l*y+h*_+f,r[n+13]=u*_+c*y+d,r[n+14]=S.x2,r[n+15]=S.y2,s[n+16]=P,s[n+17]=E,r[n+18]=l*p+h*_+f,r[n+19]=u*_+c*p+d,r[n+20]=S.x3,r[n+21]=S.y3,s[n+22]=P,s[n+23]=E}};dh.extension={type:[$.Batcher],name:"default"};let wp=dh;function vp(t,e,r,s,n,i,o,a=null){let l=0;r*=e,n*=i;const c=a.a,h=a.b,u=a.c,f=a.d,d=a.tx,g=a.ty;for(;l<o;){const y=t[r],p=t[r+1];s[n]=c*y+u*p+d,s[n+1]=h*y+f*p+g,n+=i,r+=e,l++}}function Ap(t,e,r,s){let n=0;for(e*=r;n<s;)t[e]=0,t[e+1]=0,e+=r,n++}function ph(t,e,r,s,n){const i=e.a,o=e.b,a=e.c,l=e.d,c=e.tx,h=e.ty;r||(r=0),s||(s=2),n||(n=t.length/s-r);let u=r*s;for(let f=0;f<n;f++){const d=t[u],g=t[u+1];t[u]=i*d+a*g+c,t[u+1]=o*d+l*g+h,u+=s}}const Sp=new re;class mh{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const e=this.baseColor,r=e>>16|e&65280|(e&255)<<16,s=this.renderable;return s?Ec(r,s.groupColor)+(this.alpha*s.groupAlpha*255<<24):r+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||Sp}copyTo(e){e.indexOffset=this.indexOffset,e.indexSize=this.indexSize,e.attributeOffset=this.attributeOffset,e.attributeSize=this.attributeSize,e.baseColor=this.baseColor,e.alpha=this.alpha,e.texture=this.texture,e.geometryData=this.geometryData,e.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}const Wr={extension:{type:$.ShapeBuilder,name:"circle"},build(t,e){let r,s,n,i,o,a;if(t.type==="circle"){const P=t;r=P.x,s=P.y,o=a=P.radius,n=i=0}else if(t.type==="ellipse"){const P=t;r=P.x,s=P.y,o=P.halfWidth,a=P.halfHeight,n=i=0}else{const P=t,E=P.width/2,M=P.height/2;r=P.x+E,s=P.y+M,o=a=Math.max(0,Math.min(P.radius,Math.min(E,M))),n=E-o,i=M-a}if(!(o>=0&&a>=0&&n>=0&&i>=0))return e;const l=Math.ceil(2.3*Math.sqrt(o+a)),c=l*8+(n?4:0)+(i?4:0);if(c===0)return e;if(l===0)return e[0]=e[6]=r+n,e[1]=e[3]=s+i,e[2]=e[4]=r-n,e[5]=e[7]=s-i,e;let h=0,u=l*4+(n?2:0)+2,f=u,d=c,g=n+o,y=i,p=r+g,_=r-g,b=s+y;if(e[h++]=p,e[h++]=b,e[--u]=b,e[--u]=_,i){const P=s-y;e[f++]=_,e[f++]=P,e[--d]=P,e[--d]=p}for(let P=1;P<l;P++){const E=Math.PI/2*(P/l),M=n+Math.cos(E)*o,I=i+Math.sin(E)*a,z=r+M,F=r-M,j=s+I,N=s-I;e[h++]=z,e[h++]=j,e[--u]=j,e[--u]=F,e[f++]=F,e[f++]=N,e[--d]=N,e[--d]=z}g=n,y=i+a,p=r+g,_=r-g,b=s+y;const S=s-y;return e[h++]=p,e[h++]=b,e[--d]=S,e[--d]=p,n&&(e[h++]=_,e[h++]=b,e[--d]=S,e[--d]=_),e},triangulate(t,e,r,s,n,i){if(t.length===0)return;let o=0,a=0;for(let h=0;h<t.length;h+=2)o+=t[h],a+=t[h+1];o/=t.length/2,a/=t.length/2;let l=s;e[l*r]=o,e[l*r+1]=a;const c=l++;for(let h=0;h<t.length;h+=2)e[l*r]=t[h],e[l*r+1]=t[h+1],h>0&&(n[i++]=l,n[i++]=c,n[i++]=l-1),l++;n[i++]=c+1,n[i++]=c,n[i++]=l-1}},kp={...Wr,extension:{...Wr.extension,name:"ellipse"}},Cp={...Wr,extension:{...Wr.extension,name:"roundedRectangle"}},gh=1e-4,ya=1e-4;function Pp(t){const e=t.length;if(e<6)return 1;let r=0;for(let s=0,n=t[e-2],i=t[e-1];s<e;s+=2){const o=t[s],a=t[s+1];r+=(o-n)*(a+i),n=o,i=a}return r<0?-1:1}function xa(t,e,r,s,n,i,o,a){const l=t-r*n,c=e-s*n,h=t+r*i,u=e+s*i;let f,d;o?(f=s,d=-r):(f=-s,d=r);const g=l+f,y=c+d,p=h+f,_=u+d;return a.push(g,y),a.push(p,_),2}function Ct(t,e,r,s,n,i,o,a){const l=r-t,c=s-e;let h=Math.atan2(l,c),u=Math.atan2(n-t,i-e);a&&h<u?h+=Math.PI*2:!a&&h>u&&(u+=Math.PI*2);let f=h;const d=u-h,g=Math.abs(d),y=Math.sqrt(l*l+c*c),p=(15*g*Math.sqrt(y)/Math.PI>>0)+1,_=d/p;if(f+=_,a){o.push(t,e),o.push(r,s);for(let b=1,S=f;b<p;b++,S+=_)o.push(t,e),o.push(t+Math.sin(S)*y,e+Math.cos(S)*y);o.push(t,e),o.push(n,i)}else{o.push(r,s),o.push(t,e);for(let b=1,S=f;b<p;b++,S+=_)o.push(t+Math.sin(S)*y,e+Math.cos(S)*y),o.push(t,e);o.push(n,i),o.push(t,e)}return p*2}function Mp(t,e,r,s,n,i){const o=gh;if(t.length===0)return;const a=e;let l=a.alignment;if(e.alignment!==.5){let v=Pp(t);l=(l-.5)*v+.5}const c=new Pe(t[0],t[1]),h=new Pe(t[t.length-2],t[t.length-1]),u=s,f=Math.abs(c.x-h.x)<o&&Math.abs(c.y-h.y)<o;if(u){t=t.slice(),f&&(t.pop(),t.pop(),h.set(t[t.length-2],t[t.length-1]));const v=(c.x+h.x)*.5,w=(h.y+c.y)*.5;t.unshift(v,w),t.push(v,w)}const d=n,g=t.length/2;let y=t.length;const p=d.length/2,_=a.width/2,b=_*_,S=a.miterLimit*a.miterLimit;let P=t[0],E=t[1],M=t[2],I=t[3],z=0,F=0,j=-(E-I),N=P-M,G=0,X=0,J=Math.sqrt(j*j+N*N);j/=J,N/=J,j*=_,N*=_;const Se=l,x=(1-Se)*2,A=Se*2;u||(a.cap==="round"?y+=Ct(P-j*(x-A)*.5,E-N*(x-A)*.5,P-j*x,E-N*x,P+j*A,E+N*A,d,!0)+2:a.cap==="square"&&(y+=xa(P,E,j,N,x,A,!0,d))),d.push(P-j*x,E-N*x),d.push(P+j*A,E+N*A);for(let v=1;v<g-1;++v){P=t[(v-1)*2],E=t[(v-1)*2+1],M=t[v*2],I=t[v*2+1],z=t[(v+1)*2],F=t[(v+1)*2+1],j=-(E-I),N=P-M,J=Math.sqrt(j*j+N*N),j/=J,N/=J,j*=_,N*=_,G=-(I-F),X=M-z,J=Math.sqrt(G*G+X*X),G/=J,X/=J,G*=_,X*=_;const w=M-P,k=E-I,T=M-z,R=F-I,B=w*T+k*R,O=k*T-R*w,U=O<0;if(Math.abs(O)<.001*Math.abs(B)){d.push(M-j*x,I-N*x),d.push(M+j*A,I+N*A),B>=0&&(a.join==="round"?y+=Ct(M,I,M-j*x,I-N*x,M-G*x,I-X*x,d,!1)+4:y+=2,d.push(M-G*A,I-X*A),d.push(M+G*x,I+X*x));continue}const V=(-j+P)*(-N+I)-(-j+M)*(-N+E),q=(-G+z)*(-X+I)-(-G+M)*(-X+F),se=(w*q-T*V)/O,K=(R*V-k*q)/O,lt=(se-M)*(se-M)+(K-I)*(K-I),je=M+(se-M)*x,Ze=I+(K-I)*x,Qe=M-(se-M)*A,Q=I-(K-I)*A,te=Math.min(w*w+k*k,T*T+R*R),ko=U?x:A,Eu=te+ko*ko*b;lt<=Eu?a.join==="bevel"||lt/b>S?(U?(d.push(je,Ze),d.push(M+j*A,I+N*A),d.push(je,Ze),d.push(M+G*A,I+X*A)):(d.push(M-j*x,I-N*x),d.push(Qe,Q),d.push(M-G*x,I-X*x),d.push(Qe,Q)),y+=2):a.join==="round"?U?(d.push(je,Ze),d.push(M+j*A,I+N*A),y+=Ct(M,I,M+j*A,I+N*A,M+G*A,I+X*A,d,!0)+4,d.push(je,Ze),d.push(M+G*A,I+X*A)):(d.push(M-j*x,I-N*x),d.push(Qe,Q),y+=Ct(M,I,M-j*x,I-N*x,M-G*x,I-X*x,d,!1)+4,d.push(M-G*x,I-X*x),d.push(Qe,Q)):(d.push(je,Ze),d.push(Qe,Q)):(d.push(M-j*x,I-N*x),d.push(M+j*A,I+N*A),a.join==="round"?U?y+=Ct(M,I,M+j*A,I+N*A,M+G*A,I+X*A,d,!0)+2:y+=Ct(M,I,M-j*x,I-N*x,M-G*x,I-X*x,d,!1)+2:a.join==="miter"&&lt/b<=S&&(U?(d.push(Qe,Q),d.push(Qe,Q)):(d.push(je,Ze),d.push(je,Ze)),y+=2),d.push(M-G*x,I-X*x),d.push(M+G*A,I+X*A),y+=2)}P=t[(g-2)*2],E=t[(g-2)*2+1],M=t[(g-1)*2],I=t[(g-1)*2+1],j=-(E-I),N=P-M,J=Math.sqrt(j*j+N*N),j/=J,N/=J,j*=_,N*=_,d.push(M-j*x,I-N*x),d.push(M+j*A,I+N*A),u||(a.cap==="round"?y+=Ct(M-j*(x-A)*.5,I-N*(x-A)*.5,M-j*x,I-N*x,M+j*A,I+N*A,d,!1)+2:a.cap==="square"&&(y+=xa(M,I,j,N,x,A,!1,d)));const C=ya*ya;for(let v=p;v<y+p-2;++v)P=d[v*2],E=d[v*2+1],M=d[(v+1)*2],I=d[(v+1)*2+1],z=d[(v+2)*2],F=d[(v+2)*2+1],!(Math.abs(P*(I-F)+M*(F-E)+z*(E-I))<C)&&i.push(v,v+1,v+2)}function Tp(t,e,r,s){const n=gh;if(t.length===0)return;const i=t[0],o=t[1],a=t[t.length-2],l=t[t.length-1],c=e||Math.abs(i-a)<n&&Math.abs(o-l)<n,h=r,u=t.length/2,f=h.length/2;for(let d=0;d<u;d++)h.push(t[d*2]),h.push(t[d*2+1]);for(let d=0;d<u-1;d++)s.push(f+d,f+d+1);c&&s.push(f+u-1,f)}function yh(t,e,r,s,n,i,o){const a=Cf(t,e,2);if(!a)return;for(let c=0;c<a.length;c+=3)i[o++]=a[c]+n,i[o++]=a[c+1]+n,i[o++]=a[c+2]+n;let l=n*s;for(let c=0;c<t.length;c+=2)r[l]=t[c],r[l+1]=t[c+1],l+=s}const Ip=[],Ep={extension:{type:$.ShapeBuilder,name:"polygon"},build(t,e){for(let r=0;r<t.points.length;r++)e[r]=t.points[r];return e},triangulate(t,e,r,s,n,i){yh(t,Ip,e,r,s,n,i)}},Rp={extension:{type:$.ShapeBuilder,name:"rectangle"},build(t,e){const r=t,s=r.x,n=r.y,i=r.width,o=r.height;return i>=0&&o>=0&&(e[0]=s,e[1]=n,e[2]=s+i,e[3]=n,e[4]=s+i,e[5]=n+o,e[6]=s,e[7]=n+o),e},triangulate(t,e,r,s,n,i){let o=0;s*=r,e[s+o]=t[0],e[s+o+1]=t[1],o+=r,e[s+o]=t[2],e[s+o+1]=t[3],o+=r,e[s+o]=t[6],e[s+o+1]=t[7],o+=r,e[s+o]=t[4],e[s+o+1]=t[5],o+=r;const a=s/r;n[i++]=a,n[i++]=a+1,n[i++]=a+2,n[i++]=a+1,n[i++]=a+3,n[i++]=a+2}},jp={extension:{type:$.ShapeBuilder,name:"triangle"},build(t,e){return e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,e},triangulate(t,e,r,s,n,i){let o=0;s*=r,e[s+o]=t[0],e[s+o+1]=t[1],o+=r,e[s+o]=t[2],e[s+o+1]=t[3],o+=r,e[s+o]=t[4],e[s+o+1]=t[5];const a=s/r;n[i++]=a,n[i++]=a+1,n[i++]=a+2}},Os={};We.handleByMap($.ShapeBuilder,Os);We.add(Rp,Ep,jp,Wr,kp,Cp);const Bp=new me;function zp(t,e){const{geometryData:r,batches:s}=e;s.length=0,r.indices.length=0,r.vertices.length=0,r.uvs.length=0;for(let n=0;n<t.instructions.length;n++){const i=t.instructions[n];if(i.action==="texture")Fp(i.data,s,r);else if(i.action==="fill"||i.action==="stroke"){const o=i.action==="stroke",a=i.data.path.shapePath,l=i.data.style,c=i.data.hole;o&&c&&ba(c.shapePath,l,null,!0,s,r),ba(a,l,c,o,s,r)}}}function Fp(t,e,r){const{vertices:s,uvs:n,indices:i}=r,o=i.length,a=s.length/2,l=[],c=Os.rectangle,h=Bp,u=t.image;h.x=t.dx,h.y=t.dy,h.width=t.dw,h.height=t.dh;const f=t.transform;c.build(h,l),f&&ph(l,f),c.triangulate(l,s,2,a,i,o);const d=u.uvs;n.push(d.x0,d.y0,d.x1,d.y1,d.x3,d.y3,d.x2,d.y2);const g=pt.get(mh);g.indexOffset=o,g.indexSize=i.length-o,g.attributeOffset=a,g.attributeSize=s.length/2-a,g.baseColor=t.style,g.alpha=t.alpha,g.texture=u,g.geometryData=r,e.push(g)}function ba(t,e,r,s,n,i){const{vertices:o,uvs:a,indices:l}=i,c=t.shapePrimitives.length-1;t.shapePrimitives.forEach(({shape:h,transform:u},f)=>{const d=l.length,g=o.length/2,y=[],p=Os[h.type];let _="triangle-list";if(p.build(h,y),u&&ph(y,u),s){const E=h.closePath??!0,M=e;M.pixelLine?(Tp(y,E,o,l),_="line-list"):Mp(y,M,!1,E,o,l)}else if(r&&c===f){c!==0&&console.warn("[Pixi Graphics] only the last shape have be cut out");const E=[],M=y.slice();Op(r.shapePath).forEach(z=>{E.push(M.length/2),M.push(...z)}),yh(M,E,o,2,g,l,d)}else p.triangulate(y,o,2,g,l,d);const b=a.length/2,S=e.texture;if(S!==ee.WHITE){const E=e.matrix;E&&(u&&E.append(u.clone().invert()),vp(o,2,g,a,b,2,o.length/2-g,E))}else Ap(a,b,2,o.length/2-g);const P=pt.get(mh);P.indexOffset=d,P.indexSize=l.length-d,P.attributeOffset=g,P.attributeSize=o.length/2-g,P.baseColor=e.color,P.alpha=e.alpha,P.texture=S,P.geometryData=i,P.topology=_,n.push(P)})}function Op(t){if(!t)return[];const e=t.shapePrimitives,r=[];for(let s=0;s<e.length;s++){const n=e[s].shape,i=[];Os[n.type].build(n,i),r.push(i)}return r}class Np{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class Lp{constructor(){this.batcher=new wp,this.instructions=new zc}init(){this.instructions.reset()}get geometry(){return pe(dd,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const Yi=class wi{constructor(e){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),e.renderableGC.addManagedHash(this,"_gpuContextHash"),e.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(e){wi.defaultOptions.bezierSmoothness=e?.bezierSmoothness??wi.defaultOptions.bezierSmoothness}getContextRenderData(e){return this._graphicsDataContextHash[e.uid]||this._initContextRenderData(e)}updateGpuContext(e){let r=this._gpuContextHash[e.uid]||this._initContext(e);if(e.dirty){r?this._cleanGraphicsContextData(e):r=this._initContext(e),zp(e,r);const s=e.batchMode;e.customShader||s==="no-batch"?r.isBatchable=!1:s==="auto"&&(r.isBatchable=r.geometryData.vertices.length<400),e.dirty=!1}return r}getGpuContext(e){return this._gpuContextHash[e.uid]||this._initContext(e)}_initContextRenderData(e){const r=pt.get(Lp),{batches:s,geometryData:n}=this._gpuContextHash[e.uid],i=n.vertices.length,o=n.indices.length;for(let h=0;h<s.length;h++)s[h].applyTransform=!1;const a=r.batcher;a.ensureAttributeBuffer(i),a.ensureIndexBuffer(o),a.begin();for(let h=0;h<s.length;h++){const u=s[h];a.add(u)}a.finish(r.instructions);const l=a.geometry;l.indexBuffer.setDataWithSize(a.indexBuffer,a.indexSize,!0),l.buffers[0].setDataWithSize(a.attributeBuffer.float32View,a.attributeSize,!0);const c=a.batches;for(let h=0;h<c.length;h++){const u=c[h];u.bindGroup=zf(u.textures.textures,u.textures.count)}return this._graphicsDataContextHash[e.uid]=r,r}_initContext(e){const r=new Np;return r.context=e,this._gpuContextHash[e.uid]=r,e.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]}onGraphicsContextDestroy(e){this._cleanGraphicsContextData(e),e.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]=null}_cleanGraphicsContextData(e){const r=this._gpuContextHash[e.uid];r.isBatchable||this._graphicsDataContextHash[e.uid]&&(pt.return(this.getContextRenderData(e)),this._graphicsDataContextHash[e.uid]=null),r.batches&&r.batches.forEach(s=>{pt.return(s)})}destroy(){for(const e in this._gpuContextHash)this._gpuContextHash[e]&&this.onGraphicsContextDestroy(this._gpuContextHash[e].context)}};Yi.extension={type:[$.WebGLSystem,$.WebGPUSystem,$.CanvasSystem],name:"graphicsContext"};Yi.defaultOptions={bezierSmoothness:.5};let xh=Yi;const Dp=8,cs=11920929e-14,Gp=1;function bh(t,e,r,s,n,i,o,a,l,c){const u=Math.min(.99,Math.max(0,c??xh.defaultOptions.bezierSmoothness));let f=(Gp-u)/1;return f*=f,Wp(e,r,s,n,i,o,a,l,t,f),t}function Wp(t,e,r,s,n,i,o,a,l,c){vi(t,e,r,s,n,i,o,a,l,c,0),l.push(o,a)}function vi(t,e,r,s,n,i,o,a,l,c,h){if(h>Dp)return;const u=(t+r)/2,f=(e+s)/2,d=(r+n)/2,g=(s+i)/2,y=(n+o)/2,p=(i+a)/2,_=(u+d)/2,b=(f+g)/2,S=(d+y)/2,P=(g+p)/2,E=(_+S)/2,M=(b+P)/2;if(h>0){let I=o-t,z=a-e;const F=Math.abs((r-o)*z-(s-a)*I),j=Math.abs((n-o)*z-(i-a)*I);if(F>cs&&j>cs){if((F+j)*(F+j)<=c*(I*I+z*z)){l.push(E,M);return}}else if(F>cs){if(F*F<=c*(I*I+z*z)){l.push(E,M);return}}else if(j>cs){if(j*j<=c*(I*I+z*z)){l.push(E,M);return}}else if(I=E-(t+o)/2,z=M-(e+a)/2,I*I+z*z<=c){l.push(E,M);return}}vi(t,e,u,f,_,b,E,M,l,c,h+1),vi(E,M,S,P,y,p,o,a,l,c,h+1)}const Hp=8,$p=11920929e-14,Up=1;function Vp(t,e,r,s,n,i,o,a){const c=Math.min(.99,Math.max(0,a??xh.defaultOptions.bezierSmoothness));let h=(Up-c)/1;return h*=h,qp(e,r,s,n,i,o,t,h),t}function qp(t,e,r,s,n,i,o,a){Ai(o,t,e,r,s,n,i,a,0),o.push(n,i)}function Ai(t,e,r,s,n,i,o,a,l){if(l>Hp)return;const c=(e+s)/2,h=(r+n)/2,u=(s+i)/2,f=(n+o)/2,d=(c+u)/2,g=(h+f)/2;let y=i-e,p=o-r;const _=Math.abs((s-i)*p-(n-o)*y);if(_>$p){if(_*_<=a*(y*y+p*p)){t.push(d,g);return}}else if(y=d-(e+i)/2,p=g-(r+o)/2,y*y+p*p<=a){t.push(d,g);return}Ai(t,e,r,c,h,d,g,a,l+1),Ai(t,d,g,u,f,i,o,a,l+1)}function _h(t,e,r,s,n,i,o,a){let l=Math.abs(n-i);(!o&&n>i||o&&i>n)&&(l=2*Math.PI-l),a||(a=Math.max(6,Math.floor(6*Math.pow(s,1/3)*(l/Math.PI)))),a=Math.max(a,3);let c=l/a,h=n;c*=o?-1:1;for(let u=0;u<a+1;u++){const f=Math.cos(h),d=Math.sin(h),g=e+f*s,y=r+d*s;t.push(g,y),h+=c}}function Yp(t,e,r,s,n,i){const o=t[t.length-2],l=t[t.length-1]-r,c=o-e,h=n-r,u=s-e,f=Math.abs(l*u-c*h);if(f<1e-8||i===0){(t[t.length-2]!==e||t[t.length-1]!==r)&&t.push(e,r);return}const d=l*l+c*c,g=h*h+u*u,y=l*h+c*u,p=i*Math.sqrt(d)/f,_=i*Math.sqrt(g)/f,b=p*y/d,S=_*y/g,P=p*u+_*c,E=p*h+_*l,M=c*(_+b),I=l*(_+b),z=u*(p+S),F=h*(p+S),j=Math.atan2(I-E,M-P),N=Math.atan2(F-E,z-P);_h(t,P+e,E+r,i,j,N,c*h>u*l)}const Nr=Math.PI*2,bn={centerX:0,centerY:0,ang1:0,ang2:0},_n=({x:t,y:e},r,s,n,i,o,a,l)=>{t*=r,e*=s;const c=n*t-i*e,h=i*t+n*e;return l.x=c+o,l.y=h+a,l};function Xp(t,e){const r=e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),s=e===1.5707963267948966?.551915024494:r,n=Math.cos(t),i=Math.sin(t),o=Math.cos(t+e),a=Math.sin(t+e);return[{x:n-i*s,y:i+n*s},{x:o+a*s,y:a-o*s},{x:o,y:a}]}const _a=(t,e,r,s)=>{const n=t*s-e*r<0?-1:1;let i=t*r+e*s;return i>1&&(i=1),i<-1&&(i=-1),n*Math.acos(i)},Kp=(t,e,r,s,n,i,o,a,l,c,h,u,f)=>{const d=Math.pow(n,2),g=Math.pow(i,2),y=Math.pow(h,2),p=Math.pow(u,2);let _=d*g-d*p-g*y;_<0&&(_=0),_/=d*p+g*y,_=Math.sqrt(_)*(o===a?-1:1);const b=_*n/i*u,S=_*-i/n*h,P=c*b-l*S+(t+r)/2,E=l*b+c*S+(e+s)/2,M=(h-b)/n,I=(u-S)/i,z=(-h-b)/n,F=(-u-S)/i,j=_a(1,0,M,I);let N=_a(M,I,z,F);a===0&&N>0&&(N-=Nr),a===1&&N<0&&(N+=Nr),f.centerX=P,f.centerY=E,f.ang1=j,f.ang2=N};function Zp(t,e,r,s,n,i,o,a=0,l=0,c=0){if(i===0||o===0)return;const h=Math.sin(a*Nr/360),u=Math.cos(a*Nr/360),f=u*(e-s)/2+h*(r-n)/2,d=-h*(e-s)/2+u*(r-n)/2;if(f===0&&d===0)return;i=Math.abs(i),o=Math.abs(o);const g=Math.pow(f,2)/Math.pow(i,2)+Math.pow(d,2)/Math.pow(o,2);g>1&&(i*=Math.sqrt(g),o*=Math.sqrt(g)),Kp(e,r,s,n,i,o,l,c,h,u,f,d,bn);let{ang1:y,ang2:p}=bn;const{centerX:_,centerY:b}=bn;let S=Math.abs(p)/(Nr/4);Math.abs(1-S)<1e-7&&(S=1);const P=Math.max(Math.ceil(S),1);p/=P;let E=t[t.length-2],M=t[t.length-1];const I={x:0,y:0};for(let z=0;z<P;z++){const F=Xp(y,p),{x:j,y:N}=_n(F[0],i,o,u,h,_,b,I),{x:G,y:X}=_n(F[1],i,o,u,h,_,b,I),{x:J,y:Se}=_n(F[2],i,o,u,h,_,b,I);bh(t,E,M,j,N,G,X,J,Se),E=J,M=Se,y+=p}}function Qp(t,e,r){const s=(o,a)=>{const l=a.x-o.x,c=a.y-o.y,h=Math.sqrt(l*l+c*c),u=l/h,f=c/h;return{len:h,nx:u,ny:f}},n=(o,a)=>{o===0?t.moveTo(a.x,a.y):t.lineTo(a.x,a.y)};let i=e[e.length-1];for(let o=0;o<e.length;o++){const a=e[o%e.length],l=a.radius??r;if(l<=0){n(o,a),i=a;continue}const c=e[(o+1)%e.length],h=s(a,i),u=s(a,c);if(h.len<1e-4||u.len<1e-4){n(o,a),i=a;continue}let f=Math.asin(h.nx*u.ny-h.ny*u.nx),d=1,g=!1;h.nx*u.nx-h.ny*-u.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,d=-1,g=!0):f>0&&(d=-1,g=!0);const y=f/2;let p,_=Math.abs(Math.cos(y)*l/Math.sin(y));_>Math.min(h.len/2,u.len/2)?(_=Math.min(h.len/2,u.len/2),p=Math.abs(_*Math.sin(y)/Math.cos(y))):p=l;const b=a.x+u.nx*_+-u.ny*p*d,S=a.y+u.ny*_+u.nx*p*d,P=Math.atan2(h.ny,h.nx)+Math.PI/2*d,E=Math.atan2(u.ny,u.nx)-Math.PI/2*d;o===0&&t.moveTo(b+Math.cos(P)*p,S+Math.sin(P)*p),t.arc(b,S,p,P,E,g),i=a}}function Jp(t,e,r,s){const n=(a,l)=>Math.sqrt((a.x-l.x)**2+(a.y-l.y)**2),i=(a,l,c)=>({x:a.x+(l.x-a.x)*c,y:a.y+(l.y-a.y)*c}),o=e.length;for(let a=0;a<o;a++){const l=e[(a+1)%o],c=l.radius??r;if(c<=0){a===0?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y);continue}const h=e[a],u=e[(a+2)%o],f=n(h,l);let d;if(f<1e-4)d=l;else{const p=Math.min(f/2,c);d=i(l,h,p/f)}const g=n(u,l);let y;if(g<1e-4)y=l;else{const p=Math.min(g/2,c);y=i(l,u,p/g)}a===0?t.moveTo(d.x,d.y):t.lineTo(d.x,d.y),t.quadraticCurveTo(l.x,l.y,y.x,y.y,s)}}const em=new me;class tm{constructor(e){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new it,this._graphicsPath2D=e}moveTo(e,r){return this.startPoly(e,r),this}lineTo(e,r){this._ensurePoly();const s=this._currentPoly.points,n=s[s.length-2],i=s[s.length-1];return(n!==e||i!==r)&&s.push(e,r),this}arc(e,r,s,n,i,o){this._ensurePoly(!1);const a=this._currentPoly.points;return _h(a,e,r,s,n,i,o),this}arcTo(e,r,s,n,i){this._ensurePoly();const o=this._currentPoly.points;return Yp(o,e,r,s,n,i),this}arcToSvg(e,r,s,n,i,o,a){const l=this._currentPoly.points;return Zp(l,this._currentPoly.lastX,this._currentPoly.lastY,o,a,e,r,s,n,i),this}bezierCurveTo(e,r,s,n,i,o,a){this._ensurePoly();const l=this._currentPoly;return bh(this._currentPoly.points,l.lastX,l.lastY,e,r,s,n,i,o,a),this}quadraticCurveTo(e,r,s,n,i){this._ensurePoly();const o=this._currentPoly;return Vp(this._currentPoly.points,o.lastX,o.lastY,e,r,s,n,i),this}closePath(){return this.endPoly(!0),this}addPath(e,r){this.endPoly(),r&&!r.isIdentity()&&(e=e.clone(!0),e.transform(r));for(let s=0;s<e.instructions.length;s++){const n=e.instructions[s];this[n.action](...n.data)}return this}finish(e=!1){this.endPoly(e)}rect(e,r,s,n,i){return this.drawShape(new me(e,r,s,n),i),this}circle(e,r,s,n){return this.drawShape(new Ui(e,r,s),n),this}poly(e,r,s){const n=new Or(e);return n.closePath=r,this.drawShape(n,s),this}regularPoly(e,r,s,n,i=0,o){n=Math.max(n|0,3);const a=-1*Math.PI/2+i,l=Math.PI*2/n,c=[];for(let h=0;h<n;h++){const u=a-h*l;c.push(e+s*Math.cos(u),r+s*Math.sin(u))}return this.poly(c,!0,o),this}roundPoly(e,r,s,n,i,o=0,a){if(n=Math.max(n|0,3),i<=0)return this.regularPoly(e,r,s,n,o);const l=s*Math.sin(Math.PI/n)-.001;i=Math.min(i,l);const c=-1*Math.PI/2+o,h=Math.PI*2/n,u=(n-2)*Math.PI/n/2;for(let f=0;f<n;f++){const d=f*h+c,g=e+s*Math.cos(d),y=r+s*Math.sin(d),p=d+Math.PI+u,_=d-Math.PI-u,b=g+i*Math.cos(p),S=y+i*Math.sin(p),P=g+i*Math.cos(_),E=y+i*Math.sin(_);f===0?this.moveTo(b,S):this.lineTo(b,S),this.quadraticCurveTo(g,y,P,E,a)}return this.closePath()}roundShape(e,r,s=!1,n){return e.length<3?this:(s?Jp(this,e,r,n):Qp(this,e,r),this.closePath())}filletRect(e,r,s,n,i){if(i===0)return this.rect(e,r,s,n);const o=Math.min(s,n)/2,a=Math.min(o,Math.max(-o,i)),l=e+s,c=r+n,h=a<0?-a:0,u=Math.abs(a);return this.moveTo(e,r+u).arcTo(e+h,r+h,e+u,r,u).lineTo(l-u,r).arcTo(l-h,r+h,l,r+u,u).lineTo(l,c-u).arcTo(l-h,c-h,e+s-u,c,u).lineTo(e+u,c).arcTo(e+h,c-h,e,c-u,u).closePath()}chamferRect(e,r,s,n,i,o){if(i<=0)return this.rect(e,r,s,n);const a=Math.min(i,Math.min(s,n)/2),l=e+s,c=r+n,h=[e+a,r,l-a,r,l,r+a,l,c-a,l-a,c,e+a,c,e,c-a,e,r+a];for(let u=h.length-1;u>=2;u-=2)h[u]===h[u-2]&&h[u-1]===h[u-3]&&h.splice(u-1,2);return this.poly(h,!0,o)}ellipse(e,r,s,n,i){return this.drawShape(new Vi(e,r,s,n),i),this}roundRect(e,r,s,n,i,o){return this.drawShape(new qi(e,r,s,n,i),o),this}drawShape(e,r){return this.endPoly(),this.shapePrimitives.push({shape:e,transform:r}),this}startPoly(e,r){let s=this._currentPoly;return s&&this.endPoly(),s=new Or,s.points.push(e,r),this._currentPoly=s,this}endPoly(e=!1){const r=this._currentPoly;return r&&r.points.length>2&&(r.closePath=e,this.shapePrimitives.push({shape:r})),this._currentPoly=null,this}_ensurePoly(e=!0){if(!this._currentPoly&&(this._currentPoly=new Or,e)){const r=this.shapePrimitives[this.shapePrimitives.length-1];if(r){let s=r.shape.x,n=r.shape.y;if(r.transform&&!r.transform.isIdentity()){const i=r.transform,o=s;s=i.a*s+i.c*n+i.tx,n=i.b*o+i.d*n+i.ty}this._currentPoly.points.push(s,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const e=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let r=0;r<e.instructions.length;r++){const s=e.instructions[r];this[s.action](...s.data)}this.finish()}get bounds(){const e=this._bounds;e.clear();const r=this.shapePrimitives;for(let s=0;s<r.length;s++){const n=r[s],i=n.shape.getBounds(em);n.transform?e.addRect(i,n.transform):e.addRect(i)}return e}}class sr{constructor(e){this.instructions=[],this.uid=ge("graphicsPath"),this._dirty=!0,typeof e=="string"?If(e,this):this.instructions=e?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new tm(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(e,r){return e=e.clone(),this.instructions.push({action:"addPath",data:[e,r]}),this._dirty=!0,this}arc(...e){return this.instructions.push({action:"arc",data:e}),this._dirty=!0,this}arcTo(...e){return this.instructions.push({action:"arcTo",data:e}),this._dirty=!0,this}arcToSvg(...e){return this.instructions.push({action:"arcToSvg",data:e}),this._dirty=!0,this}bezierCurveTo(...e){return this.instructions.push({action:"bezierCurveTo",data:e}),this._dirty=!0,this}bezierCurveToShort(e,r,s,n,i){const o=this.instructions[this.instructions.length-1],a=this.getLastPoint(Pe.shared);let l=0,c=0;if(!o||o.action!=="bezierCurveTo")l=a.x,c=a.y;else{l=o.data[2],c=o.data[3];const h=a.x,u=a.y;l=h+(h-l),c=u+(u-c)}return this.instructions.push({action:"bezierCurveTo",data:[l,c,e,r,s,n,i]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...e){return this.instructions.push({action:"ellipse",data:e}),this._dirty=!0,this}lineTo(...e){return this.instructions.push({action:"lineTo",data:e}),this._dirty=!0,this}moveTo(...e){return this.instructions.push({action:"moveTo",data:e}),this}quadraticCurveTo(...e){return this.instructions.push({action:"quadraticCurveTo",data:e}),this._dirty=!0,this}quadraticCurveToShort(e,r,s){const n=this.instructions[this.instructions.length-1],i=this.getLastPoint(Pe.shared);let o=0,a=0;if(!n||n.action!=="quadraticCurveTo")o=i.x,a=i.y;else{o=n.data[0],a=n.data[1];const l=i.x,c=i.y;o=l+(l-o),a=c+(c-a)}return this.instructions.push({action:"quadraticCurveTo",data:[o,a,e,r,s]}),this._dirty=!0,this}rect(e,r,s,n,i){return this.instructions.push({action:"rect",data:[e,r,s,n,i]}),this._dirty=!0,this}circle(e,r,s,n){return this.instructions.push({action:"circle",data:[e,r,s,n]}),this._dirty=!0,this}roundRect(...e){return this.instructions.push({action:"roundRect",data:e}),this._dirty=!0,this}poly(...e){return this.instructions.push({action:"poly",data:e}),this._dirty=!0,this}regularPoly(...e){return this.instructions.push({action:"regularPoly",data:e}),this._dirty=!0,this}roundPoly(...e){return this.instructions.push({action:"roundPoly",data:e}),this._dirty=!0,this}roundShape(...e){return this.instructions.push({action:"roundShape",data:e}),this._dirty=!0,this}filletRect(...e){return this.instructions.push({action:"filletRect",data:e}),this._dirty=!0,this}chamferRect(...e){return this.instructions.push({action:"chamferRect",data:e}),this._dirty=!0,this}star(e,r,s,n,i,o,a){i||(i=n/2);const l=-1*Math.PI/2+o,c=s*2,h=Math.PI*2/c,u=[];for(let f=0;f<c;f++){const d=f%2?i:n,g=f*h+l;u.push(e+d*Math.cos(g),r+d*Math.sin(g))}return this.poly(u,!0,a),this}clone(e=!1){const r=new sr;if(!e)r.instructions=this.instructions.slice();else for(let s=0;s<this.instructions.length;s++){const n=this.instructions[s];r.instructions.push({action:n.action,data:n.data.slice()})}return r}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(e){if(e.isIdentity())return this;const r=e.a,s=e.b,n=e.c,i=e.d,o=e.tx,a=e.ty;let l=0,c=0,h=0,u=0,f=0,d=0,g=0,y=0;for(let p=0;p<this.instructions.length;p++){const _=this.instructions[p],b=_.data;switch(_.action){case"moveTo":case"lineTo":l=b[0],c=b[1],b[0]=r*l+n*c+o,b[1]=s*l+i*c+a;break;case"bezierCurveTo":h=b[0],u=b[1],f=b[2],d=b[3],l=b[4],c=b[5],b[0]=r*h+n*u+o,b[1]=s*h+i*u+a,b[2]=r*f+n*d+o,b[3]=s*f+i*d+a,b[4]=r*l+n*c+o,b[5]=s*l+i*c+a;break;case"quadraticCurveTo":h=b[0],u=b[1],l=b[2],c=b[3],b[0]=r*h+n*u+o,b[1]=s*h+i*u+a,b[2]=r*l+n*c+o,b[3]=s*l+i*c+a;break;case"arcToSvg":l=b[5],c=b[6],g=b[0],y=b[1],b[0]=r*g+n*y,b[1]=s*g+i*y,b[5]=r*l+n*c+o,b[6]=s*l+i*c+a;break;case"circle":b[4]=gr(b[3],e);break;case"rect":b[4]=gr(b[4],e);break;case"ellipse":b[8]=gr(b[8],e);break;case"roundRect":b[5]=gr(b[5],e);break;case"addPath":b[0].transform(e);break;case"poly":b[2]=gr(b[2],e);break;default:fe("unknown transform action",_.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(e){let r=this.instructions.length-1,s=this.instructions[r];if(!s)return e.x=0,e.y=0,e;for(;s.action==="closePath";){if(r--,r<0)return e.x=0,e.y=0,e;s=this.instructions[r]}switch(s.action){case"moveTo":case"lineTo":e.x=s.data[0],e.y=s.data[1];break;case"quadraticCurveTo":e.x=s.data[2],e.y=s.data[3];break;case"bezierCurveTo":e.x=s.data[4],e.y=s.data[5];break;case"arc":case"arcToSvg":e.x=s.data[5],e.y=s.data[6];break;case"addPath":s.data[0].getLastPoint(e);break}return e}}function gr(t,e){return t?t.prepend(e):e.clone()}function rm(t,e){if(typeof t=="string"){const s=document.createElement("div");s.innerHTML=t.trim(),t=s.querySelector("svg")}const r={context:e,path:new sr};return wh(t,r,null,null),e}function wh(t,e,r,s){const n=t.children,{fillStyle:i,strokeStyle:o}=sm(t);i&&r?r={...r,...i}:i&&(r=i),o&&s?s={...s,...o}:o&&(s=o),e.context.fillStyle=r,e.context.strokeStyle=s;let a,l,c,h,u,f,d,g,y,p,_,b,S,P,E,M,I;switch(t.nodeName.toLowerCase()){case"path":P=t.getAttribute("d"),E=new sr(P),e.context.path(E),r&&e.context.fill(),s&&e.context.stroke();break;case"circle":d=be(t,"cx",0),g=be(t,"cy",0),y=be(t,"r",0),e.context.ellipse(d,g,y,y),r&&e.context.fill(),s&&e.context.stroke();break;case"rect":a=be(t,"x",0),l=be(t,"y",0),M=be(t,"width",0),I=be(t,"height",0),p=be(t,"rx",0),_=be(t,"ry",0),p||_?e.context.roundRect(a,l,M,I,p||_):e.context.rect(a,l,M,I),r&&e.context.fill(),s&&e.context.stroke();break;case"ellipse":d=be(t,"cx",0),g=be(t,"cy",0),p=be(t,"rx",0),_=be(t,"ry",0),e.context.beginPath(),e.context.ellipse(d,g,p,_),r&&e.context.fill(),s&&e.context.stroke();break;case"line":c=be(t,"x1",0),h=be(t,"y1",0),u=be(t,"x2",0),f=be(t,"y2",0),e.context.beginPath(),e.context.moveTo(c,h),e.context.lineTo(u,f),s&&e.context.stroke();break;case"polygon":S=t.getAttribute("points"),b=S.match(/\d+/g).map(z=>parseInt(z,10)),e.context.poly(b,!0),r&&e.context.fill(),s&&e.context.stroke();break;case"polyline":S=t.getAttribute("points"),b=S.match(/\d+/g).map(z=>parseInt(z,10)),e.context.poly(b,!1),s&&e.context.stroke();break;case"g":case"svg":break;default:{console.info(`[SVG parser] <${t.nodeName}> elements unsupported`);break}}for(let z=0;z<n.length;z++)wh(n[z],e,r,s)}function be(t,e,r){const s=t.getAttribute(e);return s?Number(s):r}function sm(t){const e=t.getAttribute("style"),r={},s={};let n=!1,i=!1;if(e){const o=e.split(";");for(let a=0;a<o.length;a++){const l=o[a],[c,h]=l.split(":");switch(c){case"stroke":h!=="none"&&(r.color=Ae.shared.setValue(h).toNumber(),i=!0);break;case"stroke-width":r.width=Number(h);break;case"fill":h!=="none"&&(n=!0,s.color=Ae.shared.setValue(h).toNumber());break;case"fill-opacity":s.alpha=Number(h);break;case"stroke-opacity":r.alpha=Number(h);break;case"opacity":s.alpha=Number(h),r.alpha=Number(h);break}}}else{const o=t.getAttribute("stroke");o&&o!=="none"&&(i=!0,r.color=Ae.shared.setValue(o).toNumber(),r.width=be(t,"stroke-width",1));const a=t.getAttribute("fill");a&&a!=="none"&&(n=!0,s.color=Ae.shared.setValue(a).toNumber())}return{strokeStyle:i?r:null,fillStyle:n?s:null}}function nm(t){return Ae.isColorLike(t)}function wa(t){return t instanceof Fs}function va(t){return t instanceof Dr}function im(t,e,r){const s=Ae.shared.setValue(e??0);return t.color=s.toNumber(),t.alpha=s.alpha===1?r.alpha:s.alpha,t.texture=ee.WHITE,{...r,...t}}function Aa(t,e,r){return t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,{...r,...t}}function Sa(t,e,r){return e.buildLinearGradient(),t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,{...r,...t}}function om(t,e){const r={...e,...t};if(r.texture){if(r.texture!==ee.WHITE){const i=r.matrix?.clone().invert()||new re;i.translate(r.texture.frame.x,r.texture.frame.y),i.scale(1/r.texture.source.width,1/r.texture.source.height),r.matrix=i}const n=r.texture.source.style;n.addressMode==="clamp-to-edge"&&(n.addressMode="repeat",n.update())}const s=Ae.shared.setValue(r.color);return r.alpha*=s.alpha,r.color=s.toNumber(),r.matrix=r.matrix?r.matrix.clone():null,r}function Ot(t,e){if(t==null)return null;const r={},s=t;return nm(t)?im(r,t,e):wa(t)?Aa(r,t,e):va(t)?Sa(r,t,e):s.fill&&wa(s.fill)?Aa(s,s.fill,e):s.fill&&va(s.fill)?Sa(s,s.fill,e):om(s,e)}function Ms(t,e){const{width:r,alignment:s,miterLimit:n,cap:i,join:o,pixelLine:a,...l}=e,c=Ot(t,l);return c?{width:r,alignment:s,miterLimit:n,cap:i,join:o,pixelLine:a,...c}:null}const am=new Pe,ka=new re,Xi=class rt extends ot{constructor(){super(...arguments),this.uid=ge("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new sr,this._transform=new re,this._fillStyle={...rt.defaultFillStyle},this._strokeStyle={...rt.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new it,this._boundsDirty=!0}clone(){const e=new rt;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle={...this._fillStyle},e._strokeStyle={...this._strokeStyle},e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=Ot(e,rt.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=Ms(e,rt.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=Ot(e,rt.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=Ot(e,rt.defaultStrokeStyle),this}texture(e,r,s,n,i,o){return this.instructions.push({action:"texture",data:{image:e,dx:s||0,dy:n||0,dw:i||e.frame.width,dh:o||e.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:r?Ae.shared.setValue(r).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new sr,this}fill(e,r){let s;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n&&n.action==="stroke"?s=n.data.path:s=this._activePath.clone(),s?(e!=null&&(r!==void 0&&typeof e=="number"&&(pe(Ce,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:r}),this._fillStyle=Ot(e,rt.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:s}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:e,y:r}=this._activePath.getLastPoint(Pe.shared);this._activePath.clear(),this._activePath.moveTo(e,r)}stroke(e){let r;const s=this.instructions[this.instructions.length-1];return this._tick===0&&s&&s.action==="fill"?r=s.data.path:r=this._activePath.clone(),r?(e!=null&&(this._strokeStyle=Ms(e,rt.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let e=0;e<2;e++){const r=this.instructions[this.instructions.length-1-e],s=this._activePath.clone();if(r&&(r.action==="stroke"||r.action==="fill"))if(r.data.hole)r.data.hole.addPath(s);else{r.data.hole=s;break}}return this._initNextPathLocation(),this}arc(e,r,s,n,i,o){this._tick++;const a=this._transform;return this._activePath.arc(a.a*e+a.c*r+a.tx,a.b*e+a.d*r+a.ty,s,n,i,o),this}arcTo(e,r,s,n,i){this._tick++;const o=this._transform;return this._activePath.arcTo(o.a*e+o.c*r+o.tx,o.b*e+o.d*r+o.ty,o.a*s+o.c*n+o.tx,o.b*s+o.d*n+o.ty,i),this}arcToSvg(e,r,s,n,i,o,a){this._tick++;const l=this._transform;return this._activePath.arcToSvg(e,r,s,n,i,l.a*o+l.c*a+l.tx,l.b*o+l.d*a+l.ty),this}bezierCurveTo(e,r,s,n,i,o,a){this._tick++;const l=this._transform;return this._activePath.bezierCurveTo(l.a*e+l.c*r+l.tx,l.b*e+l.d*r+l.ty,l.a*s+l.c*n+l.tx,l.b*s+l.d*n+l.ty,l.a*i+l.c*o+l.tx,l.b*i+l.d*o+l.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(e,r,s,n){return this._tick++,this._activePath.ellipse(e,r,s,n,this._transform.clone()),this}circle(e,r,s){return this._tick++,this._activePath.circle(e,r,s,this._transform.clone()),this}path(e){return this._tick++,this._activePath.addPath(e,this._transform.clone()),this}lineTo(e,r){this._tick++;const s=this._transform;return this._activePath.lineTo(s.a*e+s.c*r+s.tx,s.b*e+s.d*r+s.ty),this}moveTo(e,r){this._tick++;const s=this._transform,n=this._activePath.instructions,i=s.a*e+s.c*r+s.tx,o=s.b*e+s.d*r+s.ty;return n.length===1&&n[0].action==="moveTo"?(n[0].data[0]=i,n[0].data[1]=o,this):(this._activePath.moveTo(i,o),this)}quadraticCurveTo(e,r,s,n,i){this._tick++;const o=this._transform;return this._activePath.quadraticCurveTo(o.a*e+o.c*r+o.tx,o.b*e+o.d*r+o.ty,o.a*s+o.c*n+o.tx,o.b*s+o.d*n+o.ty,i),this}rect(e,r,s,n){return this._tick++,this._activePath.rect(e,r,s,n,this._transform.clone()),this}roundRect(e,r,s,n,i){return this._tick++,this._activePath.roundRect(e,r,s,n,i,this._transform.clone()),this}poly(e,r){return this._tick++,this._activePath.poly(e,r,this._transform.clone()),this}regularPoly(e,r,s,n,i=0,o){return this._tick++,this._activePath.regularPoly(e,r,s,n,i,o),this}roundPoly(e,r,s,n,i,o){return this._tick++,this._activePath.roundPoly(e,r,s,n,i,o),this}roundShape(e,r,s,n){return this._tick++,this._activePath.roundShape(e,r,s,n),this}filletRect(e,r,s,n,i){return this._tick++,this._activePath.filletRect(e,r,s,n,i),this}chamferRect(e,r,s,n,i,o){return this._tick++,this._activePath.chamferRect(e,r,s,n,i,o),this}star(e,r,s,n,i=0,o=0){return this._tick++,this._activePath.star(e,r,s,n,i,o,this._transform.clone()),this}svg(e){return this._tick++,rm(e,this),this}restore(){const e=this._stateStack.pop();return e&&(this._transform=e.transform,this._fillStyle=e.fillStyle,this._strokeStyle=e.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(e){return this._transform.rotate(e),this}scale(e,r=e){return this._transform.scale(e,r),this}setTransform(e,r,s,n,i,o){return e instanceof re?(this._transform.set(e.a,e.b,e.c,e.d,e.tx,e.ty),this):(this._transform.set(e,r,s,n,i,o),this)}transform(e,r,s,n,i,o){return e instanceof re?(this._transform.append(e),this):(ka.set(e,r,s,n,i,o),this._transform.append(ka),this)}translate(e,r=e){return this._transform.translate(e,r),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const e=this._bounds;e.clear();for(let r=0;r<this.instructions.length;r++){const s=this.instructions[r],n=s.action;if(n==="fill"){const i=s.data;e.addBounds(i.path.bounds)}else if(n==="texture"){const i=s.data;e.addFrame(i.dx,i.dy,i.dx+i.dw,i.dy+i.dh,i.transform)}if(n==="stroke"){const i=s.data,o=i.style.alignment,a=i.style.width*(1-o),l=i.path.bounds;e.addFrame(l.minX-a,l.minY-a,l.maxX+a,l.maxY+a)}}return e}containsPoint(e){if(!this.bounds.containsPoint(e.x,e.y))return!1;const r=this.instructions;let s=!1;for(let n=0;n<r.length;n++){const i=r[n],o=i.data,a=o.path;if(!i.action||!a)continue;const l=o.style,c=a.shapePath.shapePrimitives;for(let h=0;h<c.length;h++){const u=c[h].shape;if(!l||!u)continue;const f=c[h].transform,d=f?f.applyInverse(e,am):e;if(i.action==="fill")s=u.contains(d.x,d.y);else{const y=l;s=u.strokeContains(d.x,d.y,y.width,y.alignment)}const g=o.hole;if(g){const y=g.shapePath?.shapePrimitives;if(y)for(let p=0;p<y.length;p++)y[p].shape.contains(d.x,d.y)&&(s=!1)}if(s)return!0}}return s}destroy(e=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof e=="boolean"?e:e?.texture){const s=typeof e=="boolean"?e:e?.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(s),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(s)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Xi.defaultFillStyle={color:16777215,alpha:1,texture:ee.WHITE,matrix:null,fill:null};Xi.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:ee.WHITE,matrix:null,fill:null,pixelLine:!1};let Rt=Xi;const Ca=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function lm(t){const e=[];let r=0;for(let s=0;s<Ca.length;s++){const n=`_${Ca[s]}`;e[r++]=t[n]}return r=vh(t._fill,e,r),r=cm(t._stroke,e,r),r=hm(t.dropShadow,e,r),e.join("-")}function vh(t,e,r){return t&&(e[r++]=t.color,e[r++]=t.alpha,e[r++]=t.fill?.styleKey),r}function cm(t,e,r){return t&&(r=vh(t,e,r),e[r++]=t.width,e[r++]=t.alignment,e[r++]=t.cap,e[r++]=t.join,e[r++]=t.miterLimit),r}function hm(t,e,r){return t&&(e[r++]=t.alpha,e[r++]=t.angle,e[r++]=t.blur,e[r++]=t.distance,e[r++]=Ae.shared.setValue(t.color).toNumber()),r}const Ki=class Xt extends ot{constructor(e={}){super(),um(e);const r={...Xt.defaultTextStyle,...e};for(const s in r){const n=s;this[n]=r[s]}this.update()}get align(){return this._align}set align(e){this._align=e,this.update()}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords=e,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(e){e!==null&&typeof e=="object"?this._dropShadow=this._createProxy({...Xt.defaultDropShadow,...e}):this._dropShadow=e?this._createProxy({...Xt.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily=e,this.update()}get fontSize(){return this._fontSize}set fontSize(e){typeof e=="string"?this._fontSize=parseInt(e,10):this._fontSize=e,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle=e.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant=e,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight=e,this.update()}get leading(){return this._leading}set leading(e){this._leading=e,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing=e,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight=e,this.update()}get padding(){return this._padding}set padding(e){this._padding=e,this.update()}get trim(){return this._trim}set trim(e){this._trim=e,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline=e,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace=e,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap=e,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth=e,this.update()}get fill(){return this._originalFill}set fill(e){e!==this._originalFill&&(this._originalFill=e,this._isFillStyle(e)&&(this._originalFill=this._createProxy({...Rt.defaultFillStyle,...e},()=>{this._fill=Ot({...this._originalFill},Rt.defaultFillStyle)})),this._fill=Ot(e===0?"black":e,Rt.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(e){e!==this._originalStroke&&(this._originalStroke=e,this._isFillStyle(e)&&(this._originalStroke=this._createProxy({...Rt.defaultStrokeStyle,...e},()=>{this._stroke=Ms({...this._originalStroke},Rt.defaultStrokeStyle)})),this._stroke=Ms(e,Rt.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=lm(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const e=Xt.defaultTextStyle;for(const r in e)this[r]=e[r]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new Xt({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(e=!1){if(this.removeAllListeners(),typeof e=="boolean"?e:e?.texture){const s=typeof e=="boolean"?e:e?.textureSource;this._fill?.texture&&this._fill.texture.destroy(s),this._originalFill?.texture&&this._originalFill.texture.destroy(s),this._stroke?.texture&&this._stroke.texture.destroy(s),this._originalStroke?.texture&&this._originalStroke.texture.destroy(s)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(e,r){return new Proxy(e,{set:(s,n,i)=>(s[n]=i,r?.(n,i),this.update(),!0)})}_isFillStyle(e){return(e??null)!==null&&!(Ae.isColorLike(e)||e instanceof Dr||e instanceof Fs)}};Ki.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};Ki.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Hr=Ki;function um(t){const e=t;if(typeof e.dropShadow=="boolean"&&e.dropShadow){const r=Hr.defaultDropShadow;t.dropShadow={alpha:e.dropShadowAlpha??r.alpha,angle:e.dropShadowAngle??r.angle,blur:e.dropShadowBlur??r.blur,color:e.dropShadowColor??r.color,distance:e.dropShadowDistance??r.distance}}if(e.strokeThickness!==void 0){pe(Ce,"strokeThickness is now a part of stroke");const r=e.stroke;let s={};if(Ae.isColorLike(r))s.color=r;else if(r instanceof Dr||r instanceof Fs)s.fill=r;else if(Object.hasOwnProperty.call(r,"color")||Object.hasOwnProperty.call(r,"fill"))s=r;else throw new Error("Invalid stroke value.");t.stroke={...s,width:e.strokeThickness}}if(Array.isArray(e.fillGradientStops)){pe(Ce,"gradient fill is now a fill pattern: `new FillGradient(...)`");let r;t.fontSize==null?t.fontSize=Hr.defaultTextStyle.fontSize:typeof t.fontSize=="string"?r=parseInt(t.fontSize,10):r=t.fontSize;const s=new Dr(0,0,0,r*1.7),n=e.fillGradientStops.map(i=>Ae.shared.setValue(i).toNumber());n.forEach((i,o)=>{const a=o/(n.length-1);s.addColorStop(a,i)}),t.fill={fill:s}}}class dm{constructor(e){this._canvasPool=Object.create(null),this.canvasOptions=e||{},this.enableFullScreen=!1}_createCanvasAndContext(e,r){const s=ye.get().createCanvas();s.width=e,s.height=r;const n=s.getContext("2d");return{canvas:s,context:n}}getOptimalCanvasAndContext(e,r,s=1){e=Math.ceil(e*s-1e-6),r=Math.ceil(r*s-1e-6),e=ks(e),r=ks(r);const n=(e<<17)+(r<<1);this._canvasPool[n]||(this._canvasPool[n]=[]);let i=this._canvasPool[n].pop();return i||(i=this._createCanvasAndContext(e,r)),i}returnCanvasAndContext(e){const r=e.canvas,{width:s,height:n}=r,i=(s<<17)+(n<<1);e.context.clearRect(0,0,s,n),this._canvasPool[i].push(e)}clear(){this._canvasPool={}}}const Pa=new dm,fm=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Si(t){const e=typeof t.fontSize=="number"?`${t.fontSize}px`:t.fontSize;let r=t.fontFamily;Array.isArray(t.fontFamily)||(r=t.fontFamily.split(","));for(let s=r.length-1;s>=0;s--){let n=r[s].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!fm.includes(n)&&(n=`"${n}"`),r[s]=n}return`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${e} ${r.join(",")}`}const wn={willReadFrequently:!0},Xe=class W{static get experimentalLetterSpacingSupported(){let e=W._experimentalLetterSpacingSupported;if(e!==void 0){const r=ye.get().getCanvasRenderingContext2D().prototype;e=W._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return e}constructor(e,r,s,n,i,o,a,l,c){this.text=e,this.style=r,this.width=s,this.height=n,this.lines=i,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=c}static measureText(e=" ",r,s=W._canvas,n=r.wordWrap){const i=`${e}:${r.styleKey}`;if(W._measurementCache[i])return W._measurementCache[i];const o=Si(r),a=W.measureFont(o);a.fontSize===0&&(a.fontSize=r.fontSize,a.ascent=r.fontSize);const l=W.__context;l.font=o;const h=(n?W._wordWrap(e,r,s):e).split(/(?:\r\n|\r|\n)/),u=new Array(h.length);let f=0;for(let b=0;b<h.length;b++){const S=W._measureText(h[b],r.letterSpacing,l);u[b]=S,f=Math.max(f,S)}const d=r._stroke?.width||0;let g=f+d;r.dropShadow&&(g+=r.dropShadow.distance);const y=r.lineHeight||a.fontSize;let p=Math.max(y,a.fontSize+d)+(h.length-1)*(y+r.leading);return r.dropShadow&&(p+=r.dropShadow.distance),new W(e,r,g,p,h,u,y+r.leading,f,a)}static _measureText(e,r,s){let n=!1;W.experimentalLetterSpacingSupported&&(W.experimentalLetterSpacing?(s.letterSpacing=`${r}px`,s.textLetterSpacing=`${r}px`,n=!0):(s.letterSpacing="0px",s.textLetterSpacing="0px"));const i=s.measureText(e);let o=i.width;const a=-i.actualBoundingBoxLeft;let c=i.actualBoundingBoxRight-a;if(o>0)if(n)o-=r,c-=r;else{const h=(W.graphemeSegmenter(e).length-1)*r;o+=h,c+=h}return Math.max(o,c)}static _wordWrap(e,r,s=W._canvas){const n=s.getContext("2d",wn);let i=0,o="",a="";const l=Object.create(null),{letterSpacing:c,whiteSpace:h}=r,u=W._collapseSpaces(h),f=W._collapseNewlines(h);let d=!u;const g=r.wordWrapWidth+c,y=W._tokenize(e);for(let p=0;p<y.length;p++){let _=y[p];if(W._isNewline(_)){if(!f){a+=W._addLine(o),d=!u,o="",i=0;continue}_=" "}if(u){const S=W.isBreakingSpace(_),P=W.isBreakingSpace(o[o.length-1]);if(S&&P)continue}const b=W._getFromCache(_,c,l,n);if(b>g)if(o!==""&&(a+=W._addLine(o),o="",i=0),W.canBreakWords(_,r.breakWords)){const S=W.wordWrapSplit(_);for(let P=0;P<S.length;P++){let E=S[P],M=E,I=1;for(;S[P+I];){const F=S[P+I];if(!W.canBreakChars(M,F,_,P,r.breakWords))E+=F;else break;M=F,I++}P+=I-1;const z=W._getFromCache(E,c,l,n);z+i>g&&(a+=W._addLine(o),d=!1,o="",i=0),o+=E,i+=z}}else{o.length>0&&(a+=W._addLine(o),o="",i=0);const S=p===y.length-1;a+=W._addLine(_,!S),d=!1,o="",i=0}else b+i>g&&(d=!1,a+=W._addLine(o),o="",i=0),(o.length>0||!W.isBreakingSpace(_)||d)&&(o+=_,i+=b)}return a+=W._addLine(o,!1),a}static _addLine(e,r=!0){return e=W._trimRight(e),e=r?`${e}
`:e,e}static _getFromCache(e,r,s,n){let i=s[e];return typeof i!="number"&&(i=W._measureText(e,r,n)+r,s[e]=i),i}static _collapseSpaces(e){return e==="normal"||e==="pre-line"}static _collapseNewlines(e){return e==="normal"}static _trimRight(e){if(typeof e!="string")return"";for(let r=e.length-1;r>=0;r--){const s=e[r];if(!W.isBreakingSpace(s))break;e=e.slice(0,-1)}return e}static _isNewline(e){return typeof e!="string"?!1:W._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,r){return typeof e!="string"?!1:W._breakingSpaces.includes(e.charCodeAt(0))}static _tokenize(e){const r=[];let s="";if(typeof e!="string")return r;for(let n=0;n<e.length;n++){const i=e[n],o=e[n+1];if(W.isBreakingSpace(i,o)||W._isNewline(i)){s!==""&&(r.push(s),s=""),r.push(i);continue}s+=i}return s!==""&&r.push(s),r}static canBreakWords(e,r){return r}static canBreakChars(e,r,s,n,i){return!0}static wordWrapSplit(e){return W.graphemeSegmenter(e)}static measureFont(e){if(W._fonts[e])return W._fonts[e];const r=W._context;r.font=e;const s=r.measureText(W.METRICS_STRING+W.BASELINE_SYMBOL),n={ascent:s.actualBoundingBoxAscent,descent:s.actualBoundingBoxDescent,fontSize:s.actualBoundingBoxAscent+s.actualBoundingBoxDescent};return W._fonts[e]=n,n}static clearMetrics(e=""){e?delete W._fonts[e]:W._fonts={}}static get _canvas(){if(!W.__canvas){let e;try{const r=new OffscreenCanvas(0,0);if(r.getContext("2d",wn)?.measureText)return W.__canvas=r,r;e=ye.get().createCanvas()}catch{e=ye.get().createCanvas()}e.width=e.height=10,W.__canvas=e}return W.__canvas}static get _context(){return W.__context||(W.__context=W._canvas.getContext("2d",wn)),W.__context}};Xe.METRICS_STRING="|q";Xe.BASELINE_SYMBOL="M";Xe.BASELINE_MULTIPLIER=1.4;Xe.HEIGHT_MULTIPLIER=2;Xe.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map(r=>r.segment)}return t=>[...t]})();Xe.experimentalLetterSpacing=!1;Xe._fonts={};Xe._newlines=[10,13];Xe._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];Xe._measurementCache={};let Ma=Xe;function Ta(t,e){if(t.texture===ee.WHITE&&!t.fill)return Ae.shared.setValue(t.color).setAlpha(t.alpha??1).toHexa();if(t.fill){if(t.fill instanceof Fs){const r=t.fill,s=e.createPattern(r.texture.source.resource,"repeat"),n=r.transform.copyTo(re.shared);return n.scale(r.texture.frame.width,r.texture.frame.height),s.setTransform(n),s}else if(t.fill instanceof Dr){const r=t.fill;if(r.type==="linear"){const s=e.createLinearGradient(r.x0,r.y0,r.x1,r.y1);return r.gradientStops.forEach(n=>{s.addColorStop(n.offset,Ae.shared.setValue(n.color).toHex())}),s}}}else{const r=e.createPattern(t.texture.source.resource,"repeat"),s=t.matrix.copyTo(re.shared);return s.scale(t.texture.frame.width,t.texture.frame.height),r.setTransform(s),r}return fe("FillStyle not recognised",t),"red"}function Ah(t){if(t==="")return[];typeof t=="string"&&(t=[t]);const e=[];for(let r=0,s=t.length;r<s;r++){const n=t[r];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);if(n[0].length===0||n[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const i=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<i)throw new Error("[BitmapFont]: Invalid character range.");for(let a=i,l=o;a<=l;a++)e.push(String.fromCharCode(a))}else e.push(...Array.from(n))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const Sh=class kh extends sh{constructor(e){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentPageIndex=-1,this._skipKerning=!1;const r={...kh.defaultOptions,...e};this._textureSize=r.textureSize,this._mipmap=r.mipmap;const s=r.style.clone();r.overrideFill&&(s._fill.color=16777215,s._fill.alpha=1,s._fill.texture=ee.WHITE,s._fill.fill=null),this.applyFillAsTint=r.overrideFill;const n=s.fontSize;s.fontSize=this.baseMeasurementFontSize;const i=Si(s);r.overrideSize?s._stroke&&(s._stroke.width*=this.baseRenderedFontSize/n):s.fontSize=this.baseRenderedFontSize=n,this._style=s,this._skipKerning=r.skipKerning??!1,this.resolution=r.resolution??1,this._padding=r.padding??4,this.fontMetrics=Ma.measureFont(i),this.lineHeight=s.lineHeight||this.fontMetrics.fontSize||s.fontSize}ensureCharacters(e){const r=Ah(e).filter(p=>!this._currentChars.includes(p)).filter((p,_,b)=>b.indexOf(p)===_);if(!r.length)return;this._currentChars=[...this._currentChars,...r];let s;this._currentPageIndex===-1?s=this._nextPage():s=this.pages[this._currentPageIndex];let{canvas:n,context:i}=s.canvasAndContext,o=s.texture.source;const a=this._style;let l=this._currentX,c=this._currentY;const h=this.baseRenderedFontSize/this.baseMeasurementFontSize,u=this._padding*h;let f=0,d=!1;const g=n.width/this.resolution,y=n.height/this.resolution;for(let p=0;p<r.length;p++){const _=r[p],b=Ma.measureText(_,a,n,!1);b.lineHeight=b.height;const S=b.width*h,P=Math.ceil((a.fontStyle==="italic"?2:1)*S),E=b.height*h,M=P+u*2,I=E+u*2;if(d=!1,_!==`
`&&_!=="\r"&&_!=="	"&&_!==" "&&(d=!0,f=Math.ceil(Math.max(I,f))),l+M>g&&(c+=f,f=I,l=0,c+f>y)){o.update();const F=this._nextPage();n=F.canvasAndContext.canvas,i=F.canvasAndContext.context,o=F.texture.source,c=0}const z=S/h-(a.dropShadow?.distance??0)-(a._stroke?.width??0);if(this.chars[_]={id:_.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:z,kerning:{}},d){this._drawGlyph(i,b,l+u,c+u,h,a);const F=o.width*h,j=o.height*h,N=new me(l/F*o.width,c/j*o.height,M/F*o.width,I/j*o.height);this.chars[_].texture=new ee({source:o,frame:N}),l+=Math.ceil(M)}}o.update(),this._currentX=l,this._currentY=c,this._skipKerning&&this._applyKerning(r,i)}get pageTextures(){return pe(Ce,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(e,r){const s=this._measureCache;for(let n=0;n<e.length;n++){const i=e[n];for(let o=0;o<this._currentChars.length;o++){const a=this._currentChars[o];let l=s[i];l||(l=s[i]=r.measureText(i).width);let c=s[a];c||(c=s[a]=r.measureText(a).width);let h=r.measureText(i+a).width,u=h-(l+c);u&&(this.chars[i].kerning[a]=u),h=r.measureText(i+a).width,u=h-(l+c),u&&(this.chars[a].kerning[i]=u)}}}_nextPage(){this._currentPageIndex++;const e=this.resolution,r=Pa.getOptimalCanvasAndContext(this._textureSize,this._textureSize,e);this._setupContext(r.context,this._style,e);const s=e*(this.baseRenderedFontSize/this.baseMeasurementFontSize),n=new ee({source:new ar({resource:r.canvas,resolution:s,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})}),i={canvasAndContext:r,texture:n};return this.pages[this._currentPageIndex]=i,i}_setupContext(e,r,s){r.fontSize=this.baseRenderedFontSize,e.scale(s,s),e.font=Si(r),r.fontSize=this.baseMeasurementFontSize,e.textBaseline=r.textBaseline;const n=r._stroke,i=n?.width??0;if(n&&(e.lineWidth=i,e.lineJoin=n.join,e.miterLimit=n.miterLimit,e.strokeStyle=Ta(n,e)),r._fill&&(e.fillStyle=Ta(r._fill,e)),r.dropShadow){const o=r.dropShadow,a=Ae.shared.setValue(o.color).toArray(),l=o.blur*s,c=o.distance*s;e.shadowColor=`rgba(${a[0]*255},${a[1]*255},${a[2]*255},${o.alpha})`,e.shadowBlur=l,e.shadowOffsetX=Math.cos(o.angle)*c,e.shadowOffsetY=Math.sin(o.angle)*c}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0}_drawGlyph(e,r,s,n,i,o){const a=r.text,l=r.fontProperties,h=(o._stroke?.width??0)*i,u=s+h/2,f=n-h/2,d=l.descent*i,g=r.lineHeight*i;o.stroke&&h&&e.strokeText(a,u,f+g-d),o._fill&&e.fillText(a,u,f+g-d)}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){const{canvasAndContext:r,texture:s}=this.pages[e];Pa.returnCanvasAndContext(r),s.destroy(!0)}this.pages=null}};Sh.defaultOptions={textureSize:512,style:new Hr,mipmap:!0};let Ia=Sh;function pm(t,e,r,s){const n={width:0,height:0,offsetY:0,scale:e.fontSize/r.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};n.offsetY=r.baseLineOffset;let i=n.lines[0],o=null,a=!0;const l={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},c=g=>{const y=i.width;for(let p=0;p<l.index;p++){const _=g.positions[p];i.chars.push(g.chars[p]),i.charPositions.push(_+y)}i.width+=g.width,a=!1,l.width=0,l.index=0,l.chars.length=0},h=()=>{let g=i.chars.length-1;if(s){let y=i.chars[g];for(;y===" ";)i.width-=r.chars[y].xAdvance,y=i.chars[--g]}n.width=Math.max(n.width,i.width),i={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},a=!0,n.lines.push(i),n.height+=r.lineHeight},u=r.baseMeasurementFontSize/e.fontSize,f=e.letterSpacing*u,d=e.wordWrapWidth*u;for(let g=0;g<t.length+1;g++){let y;const p=g===t.length;p||(y=t[g]);const _=r.chars[y]||r.chars[" "];if(/(?:\s)/.test(y)||y==="\r"||y===`
`||p){if(!a&&e.wordWrap&&i.width+l.width-f>d?(h(),c(l),p||i.charPositions.push(0)):(l.start=i.width,c(l),p||i.charPositions.push(0)),y==="\r"||y===`
`)i.width!==0&&h();else if(!p){const E=_.xAdvance+(_.kerning[o]||0)+f;i.width+=E,i.spaceWidth=E,i.spacesIndex.push(i.charPositions.length),i.chars.push(y)}}else{const P=_.kerning[o]||0,E=_.xAdvance+P+f;l.positions[l.index++]=l.width+P,l.chars.push(y),l.width+=E}o=y}return h(),e.align==="center"?mm(n):e.align==="right"?gm(n):e.align==="justify"&&ym(n),n}function mm(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],s=t.width/2-r.width/2;for(let n=0;n<r.charPositions.length;n++)r.charPositions[n]+=s}}function gm(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],s=t.width-r.width;for(let n=0;n<r.charPositions.length;n++)r.charPositions[n]+=s}}function ym(t){const e=t.width;for(let r=0;r<t.lines.length;r++){const s=t.lines[r];let n=0,i=s.spacesIndex[n++],o=0;const a=s.spacesIndex.length,c=(e-s.width)/a;for(let h=0;h<s.charPositions.length;h++)h===i&&(i=s.spacesIndex[n++],o+=c),s.charPositions[h]+=o}}let hs=0;class xm{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1}}getFont(e,r){let s=`${r.fontFamily}-bitmap`,n=!0;if(r._fill.fill&&!r._stroke)s+=r._fill.fill.styleKey,n=!1;else if(r._stroke||r.dropShadow){let o=r.styleKey;o=o.substring(0,o.lastIndexOf("-")),s=`${o}-bitmap`,n=!1}if(!ue.has(s)){const o=new Ia({style:r,overrideFill:n,overrideSize:!0,...this.defaultOptions});hs++,hs>50&&fe("BitmapText",`You have dynamically created ${hs} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),o.once("destroy",()=>{hs--,ue.remove(s)}),ue.set(s,o)}const i=ue.get(s);return i.ensureCharacters?.(e),i}getLayout(e,r,s=!0){const n=this.getFont(e,r);return pm([...e],r,n,s)}measureText(e,r,s=!0){return this.getLayout(e,r,s)}install(...e){let r=e[0];typeof r=="string"&&(r={name:r,style:e[1],chars:e[2]?.chars,resolution:e[2]?.resolution,padding:e[2]?.padding,skipKerning:e[2]?.skipKerning},pe(Ce,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const s=r?.name;if(!s)throw new Error("[BitmapFontManager] Property `name` is required.");r={...this.defaultOptions,...r};const n=r.style,i=n instanceof Hr?n:new Hr(n),o=i._fill.fill!==null&&i._fill.fill!==void 0,a=new Ia({style:i,overrideFill:o,skipKerning:r.skipKerning,padding:r.padding,resolution:r.resolution,overrideSize:!1}),l=Ah(r.chars);return a.ensureCharacters(l.join("")),ue.set(`${s}-bitmap`,a),a.once("destroy",()=>ue.remove(`${s}-bitmap`)),a}uninstall(e){const r=`${e}-bitmap`,s=ue.get(r);s&&s.destroy()}}const Ea=new xm;class Ch extends sh{constructor(e,r){super();const{textures:s,data:n}=e;Object.keys(n.pages).forEach(i=>{const o=n.pages[parseInt(i,10)],a=s[o.id];this.pages.push({texture:a})}),Object.keys(n.chars).forEach(i=>{const o=n.chars[i],{frame:a,source:l}=s[o.page],c=new me(o.x+a.x,o.y+a.y,o.width,o.height),h=new ee({source:l,frame:c});this.chars[i]={id:i.codePointAt(0),xOffset:o.xOffset,yOffset:o.yOffset,xAdvance:o.xAdvance,kerning:o.kerning??{},texture:h}}),this.baseRenderedFontSize=n.fontSize,this.baseMeasurementFontSize=n.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:n.fontSize},this.baseLineOffset=n.baseLineOffset,this.lineHeight=n.lineHeight,this.fontFamily=n.fontFamily,this.distanceField=n.distanceField??{type:"none",range:0},this.url=r}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){const{texture:r}=this.pages[e];r.destroy(!0)}this.pages=null}static install(e){Ea.install(e)}static uninstall(e){Ea.uninstall(e)}}const vn={test(t){return typeof t=="string"&&t.startsWith("info face=")},parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const u in e){const f=e[u].match(/^[a-z]+/gm)[0],d=e[u].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),g={};for(const y in d){const p=d[y].split("="),_=p[0],b=p[1].replace(/"/gm,""),S=parseFloat(b),P=isNaN(S)?b:S;g[_]=P}r[f].push(g)}const s={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[n]=r.info,[i]=r.common,[o]=r.distanceField;o&&(s.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),s.fontSize=parseInt(n.size,10),s.fontFamily=n.face,s.lineHeight=parseInt(i.lineHeight,10);const a=r.page;for(let u=0;u<a.length;u++)s.pages.push({id:parseInt(a[u].id,10)||0,file:a[u].file});const l={};s.baseLineOffset=s.lineHeight-parseInt(i.base,10);const c=r.char;for(let u=0;u<c.length;u++){const f=c[u],d=parseInt(f.id,10);let g=f.letter??f.char??String.fromCharCode(d);g==="space"&&(g=" "),l[d]=g,s.chars[g]={id:d,page:parseInt(f.page,10)||0,x:parseInt(f.x,10),y:parseInt(f.y,10),width:parseInt(f.width,10),height:parseInt(f.height,10),xOffset:parseInt(f.xoffset,10),yOffset:parseInt(f.yoffset,10),xAdvance:parseInt(f.xadvance,10),kerning:{}}}const h=r.kerning;for(let u=0;u<h.length;u++){const f=parseInt(h[u].first,10),d=parseInt(h[u].second,10),g=parseInt(h[u].amount,10);s.chars[l[d]].kerning[l[f]]=g}return s}},Ra={test(t){const e=t;return typeof e!="string"&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(t){const e={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},r=t.getElementsByTagName("info")[0],s=t.getElementsByTagName("common")[0],n=t.getElementsByTagName("distanceField")[0];n&&(e.distanceField={type:n.getAttribute("fieldType"),range:parseInt(n.getAttribute("distanceRange"),10)});const i=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning");e.fontSize=parseInt(r.getAttribute("size"),10),e.fontFamily=r.getAttribute("face"),e.lineHeight=parseInt(s.getAttribute("lineHeight"),10);for(let c=0;c<i.length;c++)e.pages.push({id:parseInt(i[c].getAttribute("id"),10)||0,file:i[c].getAttribute("file")});const l={};e.baseLineOffset=e.lineHeight-parseInt(s.getAttribute("base"),10);for(let c=0;c<o.length;c++){const h=o[c],u=parseInt(h.getAttribute("id"),10);let f=h.getAttribute("letter")??h.getAttribute("char")??String.fromCharCode(u);f==="space"&&(f=" "),l[u]=f,e.chars[f]={id:u,page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xOffset:parseInt(h.getAttribute("xoffset"),10),yOffset:parseInt(h.getAttribute("yoffset"),10),xAdvance:parseInt(h.getAttribute("xadvance"),10),kerning:{}}}for(let c=0;c<a.length;c++){const h=parseInt(a[c].getAttribute("first"),10),u=parseInt(a[c].getAttribute("second"),10),f=parseInt(a[c].getAttribute("amount"),10);e.chars[l[u]].kerning[l[h]]=f}return e}},ja={test(t){return typeof t=="string"&&t.includes("<font>")?Ra.test(ye.get().parseXML(t)):!1},parse(t){return Ra.parse(ye.get().parseXML(t))}},bm=[".xml",".fnt"],_m={extension:{type:$.CacheParser,name:"cacheBitmapFont"},test:t=>t instanceof Ch,getCacheableAssets(t,e){const r={};return t.forEach(s=>{r[s]=e,r[`${s}-bitmap`]=e}),r[`${e.fontFamily}-bitmap`]=e,r}},wm={extension:{type:$.LoadParser,priority:kt.Normal},name:"loadBitmapFont",test(t){return bm.includes(Oe.extname(t).toLowerCase())},async testParse(t){return vn.test(t)||ja.test(t)},async parse(t,e,r){const s=vn.test(t)?vn.parse(t):ja.parse(t),{src:n}=e,{pages:i}=s,o=[],a=s.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let u=0;u<i.length;++u){const f=i[u].file;let d=Oe.join(Oe.dirname(n),f);d=mi(d,n),o.push({src:d,data:a})}const l=await r.load(o),c=o.map(u=>l[u.src]);return new Ch({data:s,textures:c},n)},async load(t,e){return await(await ye.get().fetch(t)).text()},async unload(t,e,r){await Promise.all(t.pages.map(s=>r.unload(s.texture.source._sourceOrigin))),t.destroy()}};class vm{constructor(e,r=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=r}add(e){e.forEach(r=>{this._assetList.push(r)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],r=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<r;s++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}const Am={extension:{type:$.CacheParser,name:"cacheTextureArray"},test:t=>Array.isArray(t)&&t.every(e=>e instanceof ee),getCacheableAssets:(t,e)=>{const r={};return t.forEach(s=>{e.forEach((n,i)=>{r[s+(i===0?"":i+1)]=n})}),r}};async function Ph(t){if("Image"in globalThis)return new Promise(e=>{const r=new Image;r.onload=()=>{e(!0)},r.onerror=()=>{e(!1)},r.src=t});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(t)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const Sm={extension:{type:$.DetectionParser,priority:1},test:async()=>Ph("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter(e=>e!=="avif")},Ba=["png","jpg","jpeg"],km={extension:{type:$.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...Ba],remove:async t=>t.filter(e=>!Ba.includes(e))},Cm="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Zi(t){return Cm?!1:document.createElement("video").canPlayType(t)!==""}const Pm={extension:{type:$.DetectionParser,priority:0},test:async()=>Zi("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter(e=>e!=="mp4"&&e!=="m4v")},Mm={extension:{type:$.DetectionParser,priority:0},test:async()=>Zi("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter(e=>e!=="ogv")},Tm={extension:{type:$.DetectionParser,priority:0},test:async()=>Zi("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter(e=>e!=="webm")},Im={extension:{type:$.DetectionParser,priority:0},test:async()=>Ph("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter(e=>e!=="webp")};class Em{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,r,s)=>(this._parsersValidated=!1,e[r]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,r){const s={promise:null,parser:null};return s.promise=(async()=>{let n=null,i=null;if(r.loadParser&&(i=this._parserHash[r.loadParser],i||fe(`[Assets] specified load parser "${r.loadParser}" not found while loading ${e}`)),!i){for(let o=0;o<this.parsers.length;o++){const a=this.parsers[o];if(a.load&&a.test?.(e,r,this)){i=a;break}}if(!i)return fe(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await i.load(e,r,this),s.parser=i;for(let o=0;o<this.parsers.length;o++){const a=this.parsers[o];a.parse&&a.parse&&await a.testParse?.(n,r,this)&&(n=await a.parse(n,r,this)||n,s.parser=a)}return n})(),s}async load(e,r){this._parsersValidated||this._validateParsers();let s=0;const n={},i=Ps(e),o=Ue(e,c=>({alias:[c],src:c,data:{}})),a=o.length,l=o.map(async c=>{const h=Oe.toAbsolute(c.src);if(!n[c.src])try{this.promiseCache[h]||(this.promiseCache[h]=this._getLoadPromiseAndParser(h,c)),n[c.src]=await this.promiseCache[h].promise,r&&r(++s/a)}catch(u){throw delete this.promiseCache[h],delete n[c.src],new Error(`[Loader.load] Failed to load ${h}.
${u}`)}});return await Promise.all(l),i?n[o[0].src]:n}async unload(e){const s=Ue(e,n=>({alias:[n],src:n})).map(async n=>{const i=Oe.toAbsolute(n.src),o=this.promiseCache[i];if(o){const a=await o.promise;delete this.promiseCache[i],await o.parser?.unload?.(a,n,this)}});await Promise.all(s)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,r)=>(r.name?e[r.name]&&fe(`[Assets] loadParser name conflict "${r.name}"`):fe("[Assets] loadParser should have a name"),{...e,[r.name]:r}),{})}}function cr(t,e){if(Array.isArray(e)){for(const r of e)if(t.startsWith(`data:${r}`))return!0;return!1}return t.startsWith(`data:${e}`)}function hr(t,e){const r=t.split("?")[0],s=Oe.extname(r).toLowerCase();return Array.isArray(e)?e.includes(s):s===e}const Rm=".json",jm="application/json",Bm={extension:{type:$.LoadParser,priority:kt.Low},name:"loadJson",test(t){return cr(t,jm)||hr(t,Rm)},async load(t){return await(await ye.get().fetch(t)).json()}},zm=".txt",Fm="text/plain",Om={name:"loadTxt",extension:{type:$.LoadParser,priority:kt.Low,name:"loadTxt"},test(t){return cr(t,Fm)||hr(t,zm)},async load(t){return await(await ye.get().fetch(t)).text()}},Nm=["normal","bold","100","200","300","400","500","600","700","800","900"],Lm=[".ttf",".otf",".woff",".woff2"],Dm=["font/ttf","font/otf","font/woff","font/woff2"],Gm=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Wm(t){const e=Oe.extname(t),n=Oe.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let i=n.length>0;for(const a of n)if(!a.match(Gm)){i=!1;break}let o=n.join(" ");return i||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const Hm=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function $m(t){return Hm.test(t)?t:encodeURI(t)}const Um={extension:{type:$.LoadParser,priority:kt.Low},name:"loadWebFont",test(t){return cr(t,Dm)||hr(t,Lm)},async load(t,e){const r=ye.get().getFontFaceSet();if(r){const s=[],n=e.data?.family??Wm(t),i=e.data?.weights?.filter(a=>Nm.includes(a))??["normal"],o=e.data??{};for(let a=0;a<i.length;a++){const l=i[a],c=new FontFace(n,`url(${$m(t)})`,{...o,weight:l});await c.load(),r.add(c),s.push(c)}return ue.set(`${n}-and-url`,{url:t,fontFaces:s}),s.length===1?s[0]:s}return fe("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach(e=>{ue.remove(`${e.family}-and-url`),ye.get().getFontFaceSet().delete(e)})}};function Qi(t,e=1){const r=lr.RETINA_PREFIX?.exec(t);return r?parseFloat(r[1]):e}function Ji(t,e,r){t.label=r,t._sourceOrigin=r;const s=new ee({source:t,label:r}),n=()=>{delete e.promiseCache[r],ue.has(r)&&ue.remove(r)};return s.source.once("destroy",()=>{e.promiseCache[r]&&(fe("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),n())}),s.once("destroy",()=>{t.destroyed||(fe("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),s}const Vm=".svg",qm="image/svg+xml",Ym={extension:{type:$.LoadParser,priority:kt.Low,name:"loadSVG"},name:"loadSVG",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(t){return cr(t,qm)||hr(t,Vm)},async load(t,e,r){return e.data.parseAsGraphicsContext??this.config.parseAsGraphicsContext?Km(t):Xm(t,e,r,this.config.crossOrigin)},unload(t){t.destroy(!0)}};async function Xm(t,e,r,s){const i=await(await ye.get().fetch(t)).blob(),o=URL.createObjectURL(i),a=new Image;a.src=o,a.crossOrigin=s,await a.decode(),URL.revokeObjectURL(o);const l=document.createElement("canvas"),c=l.getContext("2d"),h=e.data?.resolution||Qi(t),u=e.data?.width??a.width,f=e.data?.height??a.height;l.width=u*h,l.height=f*h,c.drawImage(a,0,0,u*h,f*h);const{parseAsGraphicsContext:d,...g}=e.data,y=new ar({resource:l,alphaMode:"premultiply-alpha-on-upload",resolution:h,...g});return Ji(y,r,t)}async function Km(t){const r=await(await ye.get().fetch(t)).text(),s=new Rt;return s.svg(r),s}const Zm=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let Qt=null,ki=class{constructor(){Qt||(Qt=URL.createObjectURL(new Blob([Zm],{type:"application/javascript"}))),this.worker=new Worker(Qt)}};ki.revokeObjectURL=function(){Qt&&(URL.revokeObjectURL(Qt),Qt=null)};const Qm=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let Jt=null;class Mh{constructor(){Jt||(Jt=URL.createObjectURL(new Blob([Qm],{type:"application/javascript"}))),this.worker=new Worker(Jt)}}Mh.revokeObjectURL=function(){Jt&&(URL.revokeObjectURL(Jt),Jt=null)};let za=0,An;class Jm{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:r}=new ki;r.addEventListener("message",s=>{r.terminate(),ki.revokeObjectURL(),e(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e,r){return this._run("loadImageBitmap",[e,r?.data?.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){An===void 0&&(An=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<An&&(this._createdWorkers++,e=new Mh().worker,e.addEventListener("message",r=>{this._complete(r.data),this._returnWorker(r.target),this._next()})),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){e.error!==void 0?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),this._resolveHash[e.uuid]=null}async _run(e,r){await this._initWorkers();const s=new Promise((n,i)=>{this._queue.push({id:e,arguments:r,resolve:n,reject:i})});return this._next(),s}_next(){if(!this._queue.length)return;const e=this._getWorker();if(!e)return;const r=this._queue.pop(),s=r.id;this._resolveHash[za]={resolve:r.resolve,reject:r.reject},e.postMessage({data:r.arguments,uuid:za++,id:s})}}const Fa=new Jm,eg=[".jpeg",".jpg",".png",".webp",".avif"],tg=["image/jpeg","image/png","image/webp","image/avif"];async function rg(t,e){const r=await ye.get().fetch(t);if(!r.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${r.status} ${r.statusText}`);const s=await r.blob();return e?.data?.alphaMode==="premultiplied-alpha"?createImageBitmap(s,{premultiplyAlpha:"none"}):createImageBitmap(s)}const Th={name:"loadTextures",extension:{type:$.LoadParser,priority:kt.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(t){return cr(t,tg)||hr(t,eg)},async load(t,e,r){let s=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Fa.isImageBitmapSupported()?s=await Fa.loadImageBitmap(t,e):s=await rg(t,e):s=await new Promise(i=>{s=new Image,s.crossOrigin=this.config.crossOrigin,s.src=t,s.complete?i(s):s.onload=()=>{i(s)}});const n=new ar({resource:s,alphaMode:"premultiply-alpha-on-upload",resolution:e.data?.resolution||Qi(t),...e.data});return Ji(n,r,t)},unload(t){t.destroy(!0)}},Ih=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],sg=Ih.map(t=>`video/${t.substring(1)}`);function ng(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=og(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}function ig(t){return new Promise((e,r)=>{t.addEventListener("canplaythrough",s),t.addEventListener("error",n),t.load();function s(){i(),e()}function n(o){i(),r(o)}function i(){t.removeEventListener("canplaythrough",s),t.removeEventListener("error",n)}})}function og(t,e=globalThis.location){if(t.startsWith("data:"))return"";e||(e=globalThis.location);const r=new URL(t,document.baseURI);return r.hostname!==e.hostname||r.port!==e.port||r.protocol!==e.protocol?"anonymous":""}const ag={name:"loadVideo",extension:{type:$.LoadParser,name:"loadVideo"},test(t){const e=cr(t,sg),r=hr(t,Ih);return e||r},async load(t,e,r){const s={...ws.defaultOptions,resolution:e.data?.resolution||Qi(t),alphaMode:e.data?.alphaMode||await $c(),...e.data},n=document.createElement("video"),i={preload:s.autoLoad!==!1?"auto":void 0,"webkit-playsinline":s.playsinline!==!1?"":void 0,playsinline:s.playsinline!==!1?"":void 0,muted:s.muted===!0?"":void 0,loop:s.loop===!0?"":void 0,autoplay:s.autoPlay!==!1?"":void 0};Object.keys(i).forEach(l=>{const c=i[l];c!==void 0&&n.setAttribute(l,c)}),s.muted===!0&&(n.muted=!0),ng(n,t,s.crossorigin);const o=document.createElement("source");let a;if(t.startsWith("data:"))a=t.slice(5,t.indexOf(";"));else if(!t.startsWith("blob:")){const l=t.split("?")[0].slice(t.lastIndexOf(".")+1).toLowerCase();a=ws.MIME_TYPES[l]||`video/${l}`}return o.src=t,a&&(o.type=a),new Promise(l=>{const c=async()=>{const h=new ws({...s,resource:n});n.removeEventListener("canplay",c),e.data.preload&&await ig(n),l(Ji(h,r,t))};n.addEventListener("canplay",c),n.appendChild(o)})},unload(t){t.destroy(!0)}},Eh={extension:{type:$.ResolveParser,name:"resolveTexture"},test:Th.test,parse:t=>({resolution:parseFloat(lr.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})},lg={extension:{type:$.ResolveParser,priority:-2,name:"resolveJson"},test:t=>lr.RETINA_PREFIX.test(t)&&t.endsWith(".json"),parse:Eh.parse};class cg{constructor(){this._detections=[],this._initialized=!1,this.resolver=new lr,this.loader=new Em,this.cache=ue,this._backgroundLoader=new vm(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){fe("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let i=e.manifest;typeof i=="string"&&(i=await this.load(i)),this.resolver.addManifest(i)}const r=e.texturePreference?.resolution??1,s=typeof r=="number"?[r]:r,n=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:s}}),e.preferences&&this.setPreferences(e.preferences)}add(e){this.resolver.add(e)}async load(e,r){this._initialized||await this.init();const s=Ps(e),n=Ue(e).map(a=>{if(typeof a!="string"){const l=this.resolver.getAlias(a);return l.some(c=>!this.resolver.hasKey(c))&&this.add(a),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),i=this.resolver.resolve(n),o=await this._mapLoadToResolve(i,r);return s?o[n[0]]:o}addBundle(e,r){this.resolver.addBundle(e,r)}async loadBundle(e,r){this._initialized||await this.init();let s=!1;typeof e=="string"&&(s=!0,e=[e]);const n=this.resolver.resolveBundle(e),i={},o=Object.keys(n);let a=0,l=0;const c=()=>{r?.(++a/l)},h=o.map(u=>{const f=n[u];return l+=Object.keys(f).length,this._mapLoadToResolve(f,c).then(d=>{i[u]=d})});return await Promise.all(h),s?i[e[0]]:i}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const r=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(r))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const r=this.resolver.resolveBundle(e);Object.values(r).forEach(s=>{this._backgroundLoader.add(Object.values(s))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return ue.get(e);const r={};for(let s=0;s<e.length;s++)r[s]=ue.get(e[s]);return r}async _mapLoadToResolve(e,r){const s=[...new Set(Object.values(e))];this._backgroundLoader.active=!1;const n=await this.loader.load(s,r);this._backgroundLoader.active=!0;const i={};return s.forEach(o=>{const a=n[o.src],l=[o.src];o.alias&&l.push(...o.alias),l.forEach(c=>{i[c]=a}),ue.set(l,a)}),i}async unload(e){this._initialized||await this.init();const r=Ue(e).map(n=>typeof n!="string"?n.src:n),s=this.resolver.resolve(r);await this._unloadFromResolved(s)}async unloadBundle(e){this._initialized||await this.init(),e=Ue(e);const r=this.resolver.resolveBundle(e),s=Object.keys(r).map(n=>this._unloadFromResolved(r[n]));await Promise.all(s)}async _unloadFromResolved(e){const r=Object.values(e);r.forEach(s=>{ue.remove(s.src)}),await this.loader.unload(r)}async _detectFormats(e){let r=[];e.preferredFormats&&(r=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const s of e.detections)e.skipDetections||await s.test()?r=await s.add(r):e.skipDetections||(r=await s.remove(r));return r=r.filter((s,n)=>r.indexOf(s)===n),r}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach(r=>{r.config&&Object.keys(r.config).filter(s=>s in e).forEach(s=>{r.config[s]=e[s]})})}}const Er=new cg;We.handleByList($.LoadParser,Er.loader.parsers).handleByList($.ResolveParser,Er.resolver.parsers).handleByList($.CacheParser,Er.cache.parsers).handleByList($.DetectionParser,Er.detections);We.add(Am,km,Sm,Im,Pm,Mm,Tm,Bm,Om,Um,Ym,Th,ag,wm,_m,Eh,lg);const Oa={loader:$.LoadParser,resolver:$.ResolveParser,cache:$.CacheParser,detection:$.DetectionParser};We.handle($.Asset,t=>{const e=t.ref;Object.entries(Oa).filter(([r])=>!!e[r]).forEach(([r,s])=>We.add(Object.assign(e[r],{extension:e[r].extension??s})))},t=>{const e=t.ref;Object.keys(Oa).filter(r=>!!e[r]).forEach(r=>We.remove(e[r]))});We.add(rd,sd);const hg="/assets/sprites-DASD_g2l.png",nr=t=>t[Symbol.iterator]();var Sn={exports:{}},kn={exports:{}},Na;function ur(){return Na||(Na=1,function(t){function e(r){"@babel/helpers - typeof";return t.exports=e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(kn)),kn.exports}var La;function ug(){return La||(La=1,function(t){var e=ur().default;function r(){t.exports=r=function(){return n},t.exports.__esModule=!0,t.exports.default=t.exports;var s,n={},i=Object.prototype,o=i.hasOwnProperty,a=Object.defineProperty||function(v,w,k){v[w]=k.value},l=typeof Symbol=="function"?Symbol:{},c=l.iterator||"@@iterator",h=l.asyncIterator||"@@asyncIterator",u=l.toStringTag||"@@toStringTag";function f(v,w,k){return Object.defineProperty(v,w,{value:k,enumerable:!0,configurable:!0,writable:!0}),v[w]}try{f({},"")}catch{f=function(k,T,R){return k[T]=R}}function d(v,w,k,T){var R=w&&w.prototype instanceof P?w:P,B=Object.create(R.prototype),O=new A(T||[]);return a(B,"_invoke",{value:X(v,k,O)}),B}function g(v,w,k){try{return{type:"normal",arg:v.call(w,k)}}catch(T){return{type:"throw",arg:T}}}n.wrap=d;var y="suspendedStart",p="suspendedYield",_="executing",b="completed",S={};function P(){}function E(){}function M(){}var I={};f(I,c,function(){return this});var z=Object.getPrototypeOf,F=z&&z(z(C([])));F&&F!==i&&o.call(F,c)&&(I=F);var j=M.prototype=P.prototype=Object.create(I);function N(v){["next","throw","return"].forEach(function(w){f(v,w,function(k){return this._invoke(w,k)})})}function G(v,w){function k(R,B,O,U){var V=g(v[R],v,B);if(V.type!=="throw"){var q=V.arg,se=q.value;return se&&e(se)=="object"&&o.call(se,"__await")?w.resolve(se.__await).then(function(K){k("next",K,O,U)},function(K){k("throw",K,O,U)}):w.resolve(se).then(function(K){q.value=K,O(q)},function(K){return k("throw",K,O,U)})}U(V.arg)}var T;a(this,"_invoke",{value:function(B,O){function U(){return new w(function(V,q){k(B,O,V,q)})}return T=T?T.then(U,U):U()}})}function X(v,w,k){var T=y;return function(R,B){if(T===_)throw Error("Generator is already running");if(T===b){if(R==="throw")throw B;return{value:s,done:!0}}for(k.method=R,k.arg=B;;){var O=k.delegate;if(O){var U=J(O,k);if(U){if(U===S)continue;return U}}if(k.method==="next")k.sent=k._sent=k.arg;else if(k.method==="throw"){if(T===y)throw T=b,k.arg;k.dispatchException(k.arg)}else k.method==="return"&&k.abrupt("return",k.arg);T=_;var V=g(v,w,k);if(V.type==="normal"){if(T=k.done?b:p,V.arg===S)continue;return{value:V.arg,done:k.done}}V.type==="throw"&&(T=b,k.method="throw",k.arg=V.arg)}}}function J(v,w){var k=w.method,T=v.iterator[k];if(T===s)return w.delegate=null,k==="throw"&&v.iterator.return&&(w.method="return",w.arg=s,J(v,w),w.method==="throw")||k!=="return"&&(w.method="throw",w.arg=new TypeError("The iterator does not provide a '"+k+"' method")),S;var R=g(T,v.iterator,w.arg);if(R.type==="throw")return w.method="throw",w.arg=R.arg,w.delegate=null,S;var B=R.arg;return B?B.done?(w[v.resultName]=B.value,w.next=v.nextLoc,w.method!=="return"&&(w.method="next",w.arg=s),w.delegate=null,S):B:(w.method="throw",w.arg=new TypeError("iterator result is not an object"),w.delegate=null,S)}function Se(v){var w={tryLoc:v[0]};1 in v&&(w.catchLoc=v[1]),2 in v&&(w.finallyLoc=v[2],w.afterLoc=v[3]),this.tryEntries.push(w)}function x(v){var w=v.completion||{};w.type="normal",delete w.arg,v.completion=w}function A(v){this.tryEntries=[{tryLoc:"root"}],v.forEach(Se,this),this.reset(!0)}function C(v){if(v||v===""){var w=v[c];if(w)return w.call(v);if(typeof v.next=="function")return v;if(!isNaN(v.length)){var k=-1,T=function R(){for(;++k<v.length;)if(o.call(v,k))return R.value=v[k],R.done=!1,R;return R.value=s,R.done=!0,R};return T.next=T}}throw new TypeError(e(v)+" is not iterable")}return E.prototype=M,a(j,"constructor",{value:M,configurable:!0}),a(M,"constructor",{value:E,configurable:!0}),E.displayName=f(M,u,"GeneratorFunction"),n.isGeneratorFunction=function(v){var w=typeof v=="function"&&v.constructor;return!!w&&(w===E||(w.displayName||w.name)==="GeneratorFunction")},n.mark=function(v){return Object.setPrototypeOf?Object.setPrototypeOf(v,M):(v.__proto__=M,f(v,u,"GeneratorFunction")),v.prototype=Object.create(j),v},n.awrap=function(v){return{__await:v}},N(G.prototype),f(G.prototype,h,function(){return this}),n.AsyncIterator=G,n.async=function(v,w,k,T,R){R===void 0&&(R=Promise);var B=new G(d(v,w,k,T),R);return n.isGeneratorFunction(w)?B:B.next().then(function(O){return O.done?O.value:B.next()})},N(j),f(j,u,"Generator"),f(j,c,function(){return this}),f(j,"toString",function(){return"[object Generator]"}),n.keys=function(v){var w=Object(v),k=[];for(var T in w)k.push(T);return k.reverse(),function R(){for(;k.length;){var B=k.pop();if(B in w)return R.value=B,R.done=!1,R}return R.done=!0,R}},n.values=C,A.prototype={constructor:A,reset:function(w){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(x),!w)for(var k in this)k.charAt(0)==="t"&&o.call(this,k)&&!isNaN(+k.slice(1))&&(this[k]=s)},stop:function(){this.done=!0;var w=this.tryEntries[0].completion;if(w.type==="throw")throw w.arg;return this.rval},dispatchException:function(w){if(this.done)throw w;var k=this;function T(q,se){return O.type="throw",O.arg=w,k.next=q,se&&(k.method="next",k.arg=s),!!se}for(var R=this.tryEntries.length-1;R>=0;--R){var B=this.tryEntries[R],O=B.completion;if(B.tryLoc==="root")return T("end");if(B.tryLoc<=this.prev){var U=o.call(B,"catchLoc"),V=o.call(B,"finallyLoc");if(U&&V){if(this.prev<B.catchLoc)return T(B.catchLoc,!0);if(this.prev<B.finallyLoc)return T(B.finallyLoc)}else if(U){if(this.prev<B.catchLoc)return T(B.catchLoc,!0)}else{if(!V)throw Error("try statement without catch or finally");if(this.prev<B.finallyLoc)return T(B.finallyLoc)}}}},abrupt:function(w,k){for(var T=this.tryEntries.length-1;T>=0;--T){var R=this.tryEntries[T];if(R.tryLoc<=this.prev&&o.call(R,"finallyLoc")&&this.prev<R.finallyLoc){var B=R;break}}B&&(w==="break"||w==="continue")&&B.tryLoc<=k&&k<=B.finallyLoc&&(B=null);var O=B?B.completion:{};return O.type=w,O.arg=k,B?(this.method="next",this.next=B.finallyLoc,S):this.complete(O)},complete:function(w,k){if(w.type==="throw")throw w.arg;return w.type==="break"||w.type==="continue"?this.next=w.arg:w.type==="return"?(this.rval=this.arg=w.arg,this.method="return",this.next="end"):w.type==="normal"&&k&&(this.next=k),S},finish:function(w){for(var k=this.tryEntries.length-1;k>=0;--k){var T=this.tryEntries[k];if(T.finallyLoc===w)return this.complete(T.completion,T.afterLoc),x(T),S}},catch:function(w){for(var k=this.tryEntries.length-1;k>=0;--k){var T=this.tryEntries[k];if(T.tryLoc===w){var R=T.completion;if(R.type==="throw"){var B=R.arg;x(T)}return B}}throw Error("illegal catch attempt")},delegateYield:function(w,k,T){return this.delegate={iterator:C(w),resultName:k,nextLoc:T},this.method==="next"&&(this.arg=s),S}},n}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(Sn)),Sn.exports}var Cn,Da;function Ns(){if(Da)return Cn;Da=1;var t=ug()();Cn=t;try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}return Cn}var Be={},Pn={exports:{}},Mn={exports:{}},Tn={exports:{}},Ga;function dg(){return Ga||(Ga=1,function(t){var e=ur().default;function r(s,n){if(e(s)!="object"||!s)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var o=i.call(s,n||"default");if(e(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(s)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(Tn)),Tn.exports}var Wa;function fg(){return Wa||(Wa=1,function(t){var e=ur().default,r=dg();function s(n){var i=r(n,"string");return e(i)=="symbol"?i:i+""}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports}(Mn)),Mn.exports}var Ha;function pg(){return Ha||(Ha=1,function(t){var e=fg();function r(s,n,i){return(n=e(n))in s?Object.defineProperty(s,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[n]=i,s}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(Pn)),Pn.exports}var In={exports:{}},En={exports:{}},Rn={exports:{}},$a;function Rh(){return $a||($a=1,function(t){function e(r,s){(s==null||s>r.length)&&(s=r.length);for(var n=0,i=Array(s);n<s;n++)i[n]=r[n];return i}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Rn)),Rn.exports}var Ua;function mg(){return Ua||(Ua=1,function(t){var e=Rh();function r(s){if(Array.isArray(s))return e(s)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(En)),En.exports}var jn={exports:{}},Va;function gg(){return Va||(Va=1,function(t){function e(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(jn)),jn.exports}var Bn={exports:{}},qa;function jh(){return qa||(qa=1,function(t){var e=Rh();function r(s,n){if(s){if(typeof s=="string")return e(s,n);var i={}.toString.call(s).slice(8,-1);return i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set"?Array.from(s):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(s,n):void 0}}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}(Bn)),Bn.exports}var zn={exports:{}},Ya;function yg(){return Ya||(Ya=1,function(t){function e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(zn)),zn.exports}var Xa;function Bh(){return Xa||(Xa=1,function(t){var e=mg(),r=gg(),s=jh(),n=yg();function i(o){return e(o)||r(o)||s(o)||n()}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports}(In)),In.exports}var Fn={},On={},Ka;function eo(){if(Ka)return On;Ka=1;function t(e){return typeof e<"u"}return On.notUndefined=t,On}var Za;function zh(){if(Za)return Fn;Za=1;var t=eo(),e=t.notUndefined;function r(s){return s!=null&&e(s[Symbol.iterator])}return Fn.isIterable=r,Fn}var Nn={},Qa;function xg(){return Qa||(Qa=1,Nn.isLoopable=zh().isIterable),Nn}var Ln={},Ja;function bg(){if(Ja)return Ln;Ja=1;var t=eo(),e=t.notUndefined;function r(s){return s==null||e(s[Symbol.iterator])}return Ln.isWrappable=r,Ln}var us={},el;function _g(){if(el)return us;el=1;var t=Ns(),e=t.mark(s),r=t.mark(n);function s(i){return t.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.delegateYield(i,"t0",1);case 1:case"end":return a.stop()}},e)}us.wrap=s;function n(i){return t.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(i==null){a.next=2;break}return a.delegateYield(i,"t0",2);case 2:case"end":return a.stop()}},r)}return us.nullableWrap=n,us}var ds={},tl;function wg(){if(tl)return ds;tl=1;var t=Bh();function e(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:n.length,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return function(){for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return i<=l.length?n.apply(void 0,t(o).concat(l)):e(n,i-l.length,[].concat(t(o),l))}}ds.curry=e;function r(n,i){var o=n.fn,a=n.validateArgs,l=n.variadic,c=n.reduces,h=n.growRight,u=n.minArgs,f=n.maxArgs,d=n.isIterable,g=n.iterableType,y=n.applyOnIterableArgs,p=n.IterableClass;if(i.length>u){var _=!0,b=l?i.findIndex(function(F,j){return d(F)&&j>=u}):Math.min(f,i.length-1),S=l?i.length:b+1;if(l)for(var P=b;P<i.length;P++)_=_&&d(i[P]);else _=d(i[b]);if(i.length>f&&(b===-1||!_)){var E=l?"...".concat(g,"s"):g,M="".concat(o.name," takes up to ").concat(f," arguments, followed by ").concat(E,". ")+"You already passed ".concat(i.length," arguments");throw l?new Error("".concat(M," and the following arguments were not all ").concat(g,"s")):new Error("".concat(M," and the last argument was not ").concat(g))}if(b>=0&&_){for(var I=b;I<S;I++)i[I]=y(i[I]);var z=l?i.slice(b):i[b];return i.splice(b),h||i.reverse(),i.unshift(z),a(i),c?o.apply(void 0,t(i)):new p(o,i)}}return s(n,i)}function s(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];if(a.length===0)throw new Error("Cannot make a partial application with no arguments");return a.unshift.apply(a,t(i)),r(n,a)}}return ds.variadicCurryWithValidation=s,ds}var yr={},rl;function vg(){if(rl)return yr;rl=1;var t=Symbol.for("_");yr._=t;var e=Symbol("__iterate");yr.__iterate=e;var r=Symbol("split");return yr.split=r,yr}var sl;function Ls(){if(sl)return Be;sl=1;var t=pg(),e=Bh(),r,s=zh(),n=s.isIterable,i=xg(),o=i.isLoopable,a=bg(),l=a.isWrappable,c=_g(),h=c.nullableWrap,u=wg(),f=u.variadicCurryWithValidation,d=vg(),g=d._,y=d.__iterate;Be.wrap=h,Be.isIterable=n,Be.isLoopable=o,Be.isWrappable=l;function p(z){if(l(z))return n(z)?z:h(z);throw typeof z.next=="function"?new TypeError("iter-tools received a value that looked like an iterator but was not iterable. Get help fixing this: https://github.com/iter-tools/iter-tools/wiki/Making-iterators-iterable"):new TypeError("Expected an iterable, null, or undefined")}Be.ensureIterable=p;function _(z){"return"in z&&z.return()}Be.callReturn=_;function b(z,F){this[g]={fn:z,args:F,staticIterator:null}}Be.BaseIterableIterator=b,Object.assign(b.prototype,(r={constructor:b},t(r,y,function(){var z=this[g],F=z.fn,j=z.args;return F.apply(void 0,e(j))}),t(r,"next",function(){var F=this[g];return F.staticIterator=F.staticIterator||this[y](),F.staticIterator.next()}),t(r,"return",function(F){var j=this[g];return j.staticIterator=j.staticIterator||this[y](),j.staticIterator.return(F)}),t(r,"throw",function(F){var j=this[g];return j.staticIterator=j.staticIterator||this[y](),j.staticIterator.throw(F)}),r));function S(){for(var z=arguments.length,F=new Array(z),j=0;j<z;j++)F[j]=arguments[j];b.apply(this,F)}Be.IterableIterator=S,S.prototype=Object.assign(Object.create(b.prototype),t({constructor:S},Symbol.iterator,function(){return this[y]()}));function P(z){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},j=F.validateArgs,N=j===void 0?function(B){}:j,G=F.variadic,X=G===void 0?!1:G,J=F.reduces,Se=J===void 0?!1:J,x=F.growRight,A=x===void 0?!1:x,C=F.minArgs,v=C===void 0?z.length-1:C,w=F.maxArgs,k=w===void 0?z.length-1:w,T=F.applyOnIterableArgs,R=T===void 0?p:T;return{fn:z,validateArgs:N,variadic:X,reduces:Se,growRight:A,minArgs:v,maxArgs:k,isIterable:l,iterableType:"iterable",applyOnIterableArgs:R,IterableClass:S}}function E(z){return e(z)}Be.cache=E;function M(z){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},j=F.validateArgs,N=j===void 0?function(G){return G}:j;return function(){for(var G=arguments.length,X=new Array(G),J=0;J<G;J++)X[J]=arguments[J];return N(X),new S(z,X)}}Be.wrapWithIterableIterator=M;var I=function(F,j){return f(P(F,j))};return Be.iterableCurry=I,Be}var xr={},nl;function Ag(){if(nl)return xr;nl=1;function t(s){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return typeof s=="number"&&!isNaN(s)&&isFinite(s)&&!(n&&s===0)}xr.isInteger=t;function e(s){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return t(s)&&(n?s>0:s>=0)}xr.isPositiveInteger=e;function r(s){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return typeof s=="number"&&!isNaN(s)&&!(n&&s===0)}return xr.isIntegerOrInfinite=r,xr}var Dn={exports:{}},Gn={exports:{}},il;function Sg(){return il||(il=1,function(t){function e(r){if(Array.isArray(r))return r}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Gn)),Gn.exports}var Wn={exports:{}},ol;function kg(){return ol||(ol=1,function(t){function e(r,s){var n=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(n!=null){var i,o,a,l,c=[],h=!0,u=!1;try{if(a=(n=n.call(r)).next,s===0){if(Object(n)!==n)return;h=!1}else for(;!(h=(i=a.call(n)).done)&&(c.push(i.value),c.length!==s);h=!0);}catch(f){u=!0,o=f}finally{try{if(!h&&n.return!=null&&(l=n.return(),Object(l)!==l))return}finally{if(u)throw o}}return c}}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Wn)),Wn.exports}var Hn={exports:{}},al;function Cg(){return al||(al=1,function(t){function e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(Hn)),Hn.exports}var ll;function Pg(){return ll||(ll=1,function(t){var e=Sg(),r=kg(),s=jh(),n=Cg();function i(o,a){return e(o)||r(o,a)||s(o,a)||n()}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports}(Dn)),Dn.exports}var $n={},cl;function Mg(){if(cl)return $n;cl=1;var t=ur();function e(r){return t(r)==="object"&&r!==null}return $n.isObject=e,$n}var fs={},hl;function Tg(){if(hl)return fs;hl=1;var t=ur(),e=Ns(),r=e.mark(o),s=Ls(),n=s.wrapWithIterableIterator,i=Object.prototype.hasOwnProperty;function o(l){var c;return e.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(l!=null){u.next=2;break}return u.abrupt("return");case 2:u.t0=e.keys(l);case 3:if((u.t1=u.t0()).done){u.next=10;break}if(c=u.t1.value,!i.call(l,c)){u.next=8;break}return u.next=8,[c,l[c]];case 8:u.next=3;break;case 10:case"end":return u.stop()}},r)}fs.__objectEntries=o;var a=n(o,{validateArgs:function(c){if(!(c[0]==null||t(c[0])==="object"))throw new Error("obj argument to objectEntries must be an object, null, or undefined")}});return fs.objectEntries=a,fs}var ps={},ul;function Ig(){if(ul)return ps;ul=1;var t=ur(),e=Ns(),r=e.mark(o),s=Ls(),n=s.wrapWithIterableIterator,i=Object.prototype.hasOwnProperty;function o(l){var c;return e.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(l!=null){u.next=2;break}return u.abrupt("return");case 2:u.t0=e.keys(l);case 3:if((u.t1=u.t0()).done){u.next=10;break}if(c=u.t1.value,!i.call(l,c)){u.next=8;break}return u.next=8,l[c];case 8:u.next=3;break;case 10:case"end":return u.stop()}},r)}ps.__objectValues=o;var a=n(o,{validateArgs:function(c){if(!(c[0]==null||t(c[0])==="object"))throw new Error("obj argument to objectValues must be an object, null, or undefined")}});return ps.objectValues=a,ps}var ms={},dl;function Eg(){if(dl)return ms;dl=1;var t=Pg(),e=Ns(),r=e.mark(f),s=Ls(),n=s.wrapWithIterableIterator,i=Ag(),o=i.isInteger,a=i.isIntegerOrInfinite,l=Mg(),c=l.isObject,h=eo(),u=h.notUndefined;function f(){var g,y,p,_,b=arguments;return e.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:g=b.length>0&&b[0]!==void 0?b[0]:0,y=b.length>1&&b[1]!==void 0?b[1]:1/0,p=b.length>2&&b[2]!==void 0?b[2]:1,_=g;case 4:if(!(p>0?_<y:_>y)){P.next=10;break}return P.next=7,_;case 7:_+=p,P.next=4;break;case 10:case"end":return P.stop()}},r)}ms.__range=f;var d=n(f,{growRight:!0,validateArgs:function(y){var p=t(y,3),_=p[0],b=p[1],S=b===void 0?1/0:b,P=p[2],E;if(c(_)?(E=_.start,S=_.end,P=_.step):y.length>1?E=_:S=_,u(E)&&!o(E))throw new TypeError("The specified start was not an integer");if(u(S)&&!a(S))throw new TypeError("The specified end was not an integer or infinite");if(u(P)&&!o(P,!0))throw new TypeError("The specified step was not a non-zero integer");y[0]=E,y[1]=S,y[2]=P}});return ms.range=d,ms}var gs={},fl;function Rg(){if(fl)return gs;fl=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var h=0,u=function(){};return{s:u,n:function(){return h>=a.length?{done:!0}:{done:!1,value:a[h++]}},e:function(p){throw p},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,d=!1,g;return{s:function(){c=a[Symbol.iterator]()},n:function(){var p=c.next();return f=p.done,p},e:function(p){d=!0,g=p},f:function(){try{!f&&c.return!=null&&c.return()}finally{if(d)throw g}}}}function e(a,l){if(a){if(typeof a=="string")return r(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return r(a,l)}}function r(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,h=new Array(l);c<l;c++)h[c]=a[c];return h}var s=Ls(),n=s.ensureIterable;function i(a){var l=n(a),c=0,h=t(l),u;try{for(h.s();!(u=h.n()).done;){var f=u.value;c++}}catch(d){h.e(d)}finally{h.f()}return c}gs.__size=i;var o=i;return gs.size=o,gs}var Un,pl;function jg(){return pl||(pl=1,Un=Tg().objectEntries),Un}var Bg=jg();const zg=Ye(Bg);var Vn,ml;function Fg(){return ml||(ml=1,Vn=Ig().objectValues),Vn}var Og=Fg();const gl=Ye(Og);var qn,yl;function Ng(){return yl||(yl=1,qn=Eg().range),qn}var Lg=Ng();const Dg=Ye(Lg);var Yn,xl;function Gg(){return xl||(xl=1,Yn=Rg().size),Yn}var Wg=Gg();const bl=Ye(Wg),Pt=(t,{x:e,y:r},s)=>{function*n(){yield[`${t}.left`,{frame:{x:e,y:r,...s}}],yield[`${t}.away`,{frame:{x:e+s.w+1,y:r,...s}}],yield[`${t}.towards`,{frame:{x:e,y:r+s.h+1,...s}}],yield[`${t}.right`,{frame:{x:e+s.w+1,y:r+s.h+1,...s}}]}return Object.fromEntries(n())},le=(t,e,{x:r,y:s},n)=>{function*i(){for(let o=0;o<e;o++)yield[`${t}.${o+1}`,{frame:{x:r+o*(n.w+1),y:s,...n}}]}return Object.fromEntries(i())},_l=(t,e)=>[...nr(Dg(1,e+1)).map(r=>`${t}.${String(r)}`)],Rr={w:32,h:16},st={w:16,h:56},ie={w:32,h:28},L={w:24,h:24},Nt={w:8,h:8},dr=["away","towards","left","right"],Hg=["awayRight","rightTowards","towardsLeft","leftAway"],Yw=[...dr,...Hg],$g=t=>t==="away"||t==="towards"?"y":"x",Xw=t=>t==="away"?"towards":t==="towards"?"away":t==="left"?"right":"left",Kw=t=>Ug($g(t)),Ug=t=>t==="x"?"y":"x",wl=(t,...e)=>e.reduce((r,s)=>({x:r.x+(s.x??0),y:r.y+(s.y??0)}),t),Zw=(t,...e)=>e.reduce((r,s)=>({x:r.x-(s.x??0),y:r.y-(s.y??0)}),t),Vg=(t,e)=>({x:t.x*e,y:t.y*e}),to=(t,e)=>({x:t.x*e,y:t.y*e,z:t.z*e}),$r=({x:t,y:e,z:r})=>Math.sqrt(t*t+e*e+r*r),Qw=({x:t,y:e})=>Math.sqrt(t*t+e*e),Kt=t=>to(t,1/$r(t)),Xn=(...t)=>t.reduce(({x:e,y:r,z:s},{x:n=0,y:i=0,z:o=0})=>({x:e+n,y:r+i,z:s+o}),jr),Jw=(t,...e)=>e.reduce((r,s)=>({x:r.x-(s.x??0),y:r.y-(s.y??0),z:r.z-(s.z??0)}),t),ev=({x:t,y:e,z:r},{x:s,y:n,z:i})=>t===s&&e===n&&r===i,tv=({x:t,y:e},{x:r,y:s})=>t===r&&e===s,Kn=t=>Math.abs(t-Math.round(t))<.001,rv=({x:t=0,y:e=0,z:r=0})=>Kn(t)&&Kn(e)&&Kn(r),sv=({x:t=0,y:e=0,z:r=0})=>Number.isInteger(t)&&Number.isInteger(e)&&Number.isInteger(r),nv=({x:t,y:e,z:r})=>({x:Math.round(t),y:Math.round(e),z:Math.round(r)}),iv=Object.freeze({x:0,y:0}),jr=Object.freeze({x:0,y:0,z:0}),ov=["x","y"],av=["x","y","z"],vl=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,lv=({x:t,y:e})=>e>t?e>-t?"away":"right":e>-t?"left":"towards",cv=({x:t,y:e},{x:r,y:s})=>Math.abs(r-t)**2+Math.abs(s-e)**2,hv=["yellow","cyan","green","magenta","white"],uv=["basic","dimmed"],Fh=25,dv=1e3/Fh,Zn={x:256,y:192},de=(t,e)=>Object.assign([...t],{animationSpeed:e}),qg=.5;function Al(t){function*e(r,s){yield`${r}.walking.${s}.1`,yield`${r}.walking.${s}.2`,yield`${r}.walking.${s}.3`,yield`${r}.walking.${s}.2`}return dr.reduce((r,s)=>({...r,[`${t}.walking.${s}`]:de([...e(t,s)],qg)}),{})}const Yg={...le("head.walking.towards",3,{x:4,y:266},L),...le("head.walking.right",3,{x:80,y:266},L),...le("head.walking.left",3,{x:4,y:240},L),...le("head.walking.away",3,{x:80,y:240},L),"head.blinking.towards":{frame:{x:54,y:291,...L}},"head.blinking.right":{frame:{x:130,y:291,...L}},"head.falling.towards":{frame:{x:29,y:291,...L}},"head.falling.right":{frame:{x:105,y:291,...L}},...le("bubbles.head",6,{x:4,y:215},L),...le("heels.walking.towards",3,{x:159,y:266},L),...le("heels.walking.right",3,{x:235,y:266},L),...le("heels.walking.left",3,{x:159,y:240},L),...le("heels.walking.away",3,{x:235,y:240},L),...le("bubbles.heels",6,{x:159,y:215},L)},Xg=5e3,Sl=Math.round(Xg/(Fh*4))-3,Oh={frames:Yg,animations:{...Al("head"),...Al("heels"),"head.idle.right":de([...new Array(Sl).fill("head.walking.right.3"),"head.blinking.right","head.walking.right.3","head.blinking.right"],.5),"head.idle.towards":de([...new Array(Sl).fill("head.walking.towards.3"),"head.blinking.towards","head.walking.towards.3","head.blinking.towards"],.5),"head.fadeOut":de(["bubbles.head.1","bubbles.head.2","bubbles.head.4","bubbles.head.3","bubbles.head.4","bubbles.head.6","bubbles.head.5","bubbles.head.6","bubbles.head.5"],.5),"heels.fadeOut":de(["bubbles.heels.1","bubbles.heels.2","bubbles.heels.4","bubbles.heels.3","bubbles.heels.4","bubbles.heels.6","bubbles.heels.5","bubbles.heels.6","bubbles.heels.5"],.5)}},Nh={jail:{walls:["bars"]},blacktooth:{walls:["armour","shield","plain"]},bookworld:{walls:["cowboy","book"]},egyptus:{walls:["sarcophagus","hieroglyphics"]},market:{walls:["passage","fruits","more-fruits"]},moonbase:{walls:["window1","window2","window3","coil"]},penitentiary:{walls:["loop","skeleton"]},safari:{walls:["window","shield","wall"]}},fv=Object.keys(Nh),ke=(t,e,r,s)=>{function*n(i,o,a){const{walls:l}=Nh[i],{w:c,h}=st,u=c>>1,f=l.length;let d=0;for(;d<l.length;d++)yield[`${i}${s}.wall.${l[d]}.left`,{frame:{x:o+c*d,y:a-u*d,...st}}],yield[`${i}${s}.wall.${l[d]}.away`,{frame:{x:o+c*((f<<1)-d-1),y:a-u*d,...st}}];const g=d-1;yield[`${i}${s}.floor`,{frame:{x:o+g*c,y:a-g*u+h,...Rr}}]}return Object.fromEntries(n(t,e,r))},Kg={...ke("blacktooth",544,148,".dark"),...ke("blacktooth",544,76,""),...ke("bookworld",382,16,".dark"),...ke("bookworld",382,16,""),...ke("egyptus",447,16,""),...ke("egyptus",447,89,".dark"),...ke("jail",512,76,".dark"),...ke("jail",512,76,""),...ke("market",440,386,".dark"),...ke("market",440,386,""),...ke("moonbase",453,305,".dark"),...ke("moonbase",453,233,""),...ke("penitentiary",372,389,".dark"),...ke("penitentiary",372,389,""),...ke("safari",544,386,".dark"),...ke("safari",544,386,"")},Zg={frames:Kg,animations:{}},pv=Object.entries,Lh=zg,Dh=Object.keys,Qg=Object.fromEntries,ro=Object.fromEntries,Jg=(t,e)=>{const s=nr(Lh(t)).map(e);return Qg(s)},ey={" ":"space","'":"singleQuote",":":"colon","<":"lt",">":"gt","`":"backtick"},Gh=t=>ey[t]??t,ty=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9"],ry=[" ","?","!",".",",",";",":","/","\\","","","'","`","-","+"],sy=["(",")","[","]","<",">"],ny=["","","","","","","",""],iy=["","",""],br=(t,e)=>{function*r(){for(let s=0;s<t.length;s++){const n=t[s];yield[`hud.char.${Gh(n)}`,{frame:{x:e.x+s*(Nt.w+1),y:e.y,...Nt}}]}}return ro(r())},oy={frames:{...br(ty,{x:173,y:0}),"hud.fastSteps":{frame:{x:497,y:0,...Nt}},"hud.shield":{frame:{x:506,y:0,...Nt}},"hud.bigJumps":{frame:{x:515,y:0,...Nt}},"hud.char.":{frame:{x:227,y:27,...Nt}},...br(ry,{x:173,y:9}),...br(ny,{x:173,y:18}),...br(iy,{x:524,y:0}),...br(sy,{x:173,y:27})}},ay={frames:{"shadowMask.fullBlock":{frame:{x:226,y:395,...ie}},"shadow.fullBlock":{frame:{x:259,y:395,...ie}},"shadowMask.smallBlock":{frame:{x:333,y:456,...L}},"shadow.smallBlock":{frame:{x:308,y:456,...L}},"shadowMask.conveyor":{frame:{x:292,y:395,...ie}},"shadow.smallRound":{frame:{x:159,y:291,...L}},"shadowMask.smallRound":{frame:{x:184,y:291,...L}},"shadowMask.tower":{frame:{x:27,y:349,...L}}}},Ut=(t,e,r)=>{const s=({x:i,y:o,w:a,h:l,pivot:c})=>e==="x"?{...wl(r,{x:-i-a-1,y:o}),w:a,h:l,pivot:{x:a-c.x,y:c.y}}:{...wl(r,{x:i+2,y:o}),w:a,h:l,pivot:c};function*n(){yield[`door.frame.${t}.${e}.far`,{frame:{...s({x:-18,y:0,w:17,h:57,pivot:{x:9,y:52}})}}],yield[`door.frame.${t}.${e}.near`,{frame:{...s({x:-41,y:6,w:20,h:58,pivot:{x:8,y:58}})}}],yield[`door.frame.${t}.${e}.top`,{frame:{...s({x:-57,y:-1,w:15,h:36,pivot:{x:0,y:36}})}}]}return ro(n())},ly={frames:{...Ut("generic","y",{x:380,y:147}),...Ut("generic","x",{x:382,y:147}),...Ut("moonbase","y",{x:451,y:232}),...Ut("moonbase","x",{x:582,y:232}),...Ut("moonbase.dark","y",{x:451,y:304}),...Ut("moonbase.dark","x",{x:582,y:304})}},cy={"floorEdge.right":{frame:{x:400,y:502,w:8,h:9}},"floorEdge.towards":{frame:{x:391,y:502,w:8,h:9}},"floorOverdraw.right":{frame:{x:400,y:492,w:8,h:9}},"floorOverdraw.towards":{frame:{x:391,y:492,w:8,h:9}},"generic.floor.overdraw":{frame:{x:180,y:113,w:st.w,h:Rr.h*2}},"generic.wall.overdraw":{frame:{x:197,y:113,w:st.w,h:Rr.h*2}},"shadow.wall.y":{frame:{x:410,y:129,w:36,h:16}},"generic.floor.deadly":{frame:{x:376,y:454,...Rr}},"generic.dark.floor.deadly":{frame:{x:376,y:471,...Rr}},"generic.door.legs.pillar":{frame:{x:237,y:92,w:st.w,h:12}},"generic.door.legs.base":{frame:{x:237,y:104,w:st.w,h:9}},"generic.door.legs.threshold.double.x":{frame:{x:221,y:68,w:st.w*2,h:24}},"generic.door.legs.threshold.double.y":{frame:{x:186,y:68,w:st.w*2,h:24}},"shadowMask.door.legs.threshold.double.y":{frame:{x:254,y:68,w:st.w*2,h:21,pivot:{x:0,y:21}}},"generic.door.floatingThreshold.x":{frame:{x:209,y:93,w:26,h:19}},"generic.door.floatingThreshold.y":{frame:{x:180,y:93,w:26,h:19}},"shadowMask.door.floatingThreshold.double.y":{frame:{x:254,y:90,w:42,h:21,pivot:{x:8,y:20}}},"shadow.door.floatingThreshold.double.y":{frame:{x:297,y:90,w:42,h:21,pivot:{x:8,y:20}}},teleporter:{frame:{x:2,y:478,...ie}},...le("teleporter.flashing",2,{x:35,y:478},ie),"shadowMask.teleporter":{frame:{x:101,y:478,...ie}},"barrier.x":{frame:{x:335,y:241,...L,pivot:{x:18,y:23}}},"barrier.y":{frame:{x:310,y:241,...L,pivot:{x:6,y:23}}},"shadowMask.barrier.y":{frame:{x:310,y:216,...L,pivot:{x:6,y:22}}},"shadow.barrier.y":{frame:{x:310,y:266,...L,pivot:{x:6,y:22}}},"block.organic":{frame:{x:160,y:449,...ie}},"block.organic.dark":{frame:{x:160,y:391,...ie}},"block.organic.disappearing":{frame:{x:160,y:420,...ie}},"block.organic.dark.disappearing":{frame:{x:127,y:391,...ie}},"block.artificial":{frame:{x:127,y:449,...ie}},"block.artificial.disappearing":{frame:{x:127,y:449,...ie}},"block.tower":{frame:{x:27,y:374,...L}},"block.tower.disappearing":{frame:{x:27,y:374,...L}},volcano:{frame:{x:193,y:420,...ie}},"shadowMask.volcano":{frame:{x:193,y:449,...ie}},toaster:{frame:{x:226,y:449,...ie}},spikes:{frame:{x:333,y:427,...ie}},"shadowMask.spikes":{frame:{x:333,y:397,...ie}},...le("conveyor.x",7,{x:409,y:454},ie),...le("conveyor.y",7,{x:409,y:483},ie),bunny:{frame:{x:77,y:349,...L}},scroll:{frame:{x:52,y:324,...L,pivot:{x:19,y:24}}},"shadowMask.scroll":{frame:{x:27,y:324,...L,pivot:{x:19,y:24}}},"shadow.scroll":{frame:{x:2,y:324,...L,pivot:{x:19,y:24}}},doughnuts:{frame:{x:77,y:324,...L}},"crown.blacktooth":{frame:{x:186,y:40,...L}},"crown.safari":{frame:{x:211,y:40,...L}},"crown.egyptus":{frame:{x:236,y:40,...L}},"crown.penitentiary":{frame:{x:261,y:40,...L}},"crown.bookworld":{frame:{x:286,y:40,...L}},"crown.dark":{frame:{x:311,y:40,...L}},hooter:{frame:{x:202,y:349,...L}},bag:{frame:{x:227,y:349,...L}},...le("fish",2,{x:177,y:324},L),"spring.compressed":{frame:{x:2,y:453,...L}},"spring.released":{frame:{x:27,y:453,...L}},...le("lift",4,{x:233,y:481},L),"lift.static":{frame:{x:333,y:481,...L}},...le("dalek",2,{x:4,y:4},L),"shadowMask.dalek":{frame:{x:4,y:29,...L}},homingBot:{frame:{x:93,y:102,...L}},joystick:{frame:{x:2,y:374,...L}},"shadowMask.joystick":{frame:{x:2,y:349,...L}},stepStool:{frame:{x:252,y:366,...ie}},"shadowMask.stepStool":{frame:{x:285,y:366,...ie}},"book.x":{frame:{x:167,y:478,...ie}},"book.y":{frame:{x:200,y:478,...ie}},sandwich:{frame:{x:2,y:399,...ie}},sticks:{frame:{x:2,y:428,...L}},cube:{frame:{x:27,y:428,...L}},drum:{frame:{x:52,y:428,...L}},"switch.left":{frame:{x:52,y:453,...L}},"switch.right":{frame:{x:77,y:453,...L}},"shadowMask.switch":{frame:{x:77,y:428,...L}},...Pt("skiHead.starsAndStripes",{x:274,y:131},{w:24,h:32}),...Pt("skiHead.greenAndPink",{x:224,y:131},{w:24,h:32}),...Pt("charles",{x:118,y:34},L),...Pt("cyberman",{x:29,y:29},L),...Pt("monkey",{x:118,y:90},L),...Pt("elephant",{x:118,y:146},L),...Pt("computerBot",{x:173,y:146},L),...le("bubbles.cold",2,{x:79,y:4},L),...le("bubbles.taupe",3,{x:102,y:324},L),...le("bubbles.white",3,{x:102,y:349},L),...le("bubbles.fish",3,{x:227,y:324},L),...le("turtle.left",2,{x:4,y:137},L),...le("turtle.away",2,{x:55,y:137},L),...le("turtle.towards",2,{x:4,y:163},L),...le("turtle.right",2,{x:55,y:163},L),...le("helicopterBug",4,{x:4,y:188},L),hushPuppy:{frame:{x:209,y:291,...ie}},"shadowMask.hushPuppy":{frame:{x:242,y:291,...ie}},ball:{frame:{x:54,y:4,...L}},puck:{frame:{x:102,y:428,...L}},"puck.deadly":{frame:{x:102,y:453,...L}},...Oh.frames,...Zg.frames,...oy.frames,...ay.frames,...ly.frames},Wh={frames:cy,animations:{"teleporter.flashing":de(["teleporter.flashing.1","teleporter.flashing.2"],.5),fish:de(["fish.1","fish.2"],.25),lift:de(["lift.1","lift.2","lift.3","lift.4"],.5),dalek:de(["dalek.1","dalek.2"],.5),"turtle.left":de(["turtle.left.1","turtle.left.2"],.25),"turtle.away":de(["turtle.away.1","turtle.away.2"],.25),"turtle.towards":de(["turtle.towards.1","turtle.towards.2"],.25),"turtle.right":de(["turtle.right.1","turtle.right.2"],.25),helicopterBug:de(["helicopterBug.1","helicopterBug.2","helicopterBug.3","helicopterBug.4"],.5),"bubbles.cold":de(["bubbles.cold.1","bubbles.cold.2"],.25),"bubbles.white":de(["bubbles.white.1","bubbles.white.2","bubbles.white.3"],.5),"bubbles.doughnut":de(["bubbles.taupe.1","bubbles.taupe.2"],.5),"conveyor.x":de(_l("conveyor.x",7),.5),"conveyor.y":de(_l("conveyor.y",7),.5),"spring.bounce":de(["spring.released","spring.compressed","spring.released","spring.compressed","spring.released"],.5),switch:de(["switch.left","switch.right"],.02),...Oh.animations},meta:{scale:1}};let Ci;try{Ci=await Er.load(hg)}catch{Ci=ee.EMPTY}const Lt=new gi(Ci,Wh),hy=async()=>(await Lt.parse(),Lt.textureSource.scaleMode="nearest",Lt),uy=Object.freeze(Object.defineProperty({__proto__:null,load:hy,spriteSheet:Lt},Symbol.toStringTag,{value:"Module"})),dy=()=>{const t=Object.keys(Lt.textures).sort();return m.jsx("div",{className:"flex flex-wrap p-[8px] bg-pureBlack",children:t.map(e=>{const{frame:r}=Lt.data.frames[e];return m.jsxs("div",{className:"bg-shadow m-[8px] p-[16px]",children:[m.jsx("div",{className:`sprite texture-${e} bg-shadow hover:bg-metallicBlue hover:border-pink border-shadow border border-4 mb-1 box-content`}),m.jsx("div",{className:"text-moss",children:e}),m.jsxs("div",{className:"text-lightGrey",children:[r.w,"x",r.h]}),m.jsxs("div",{className:"text-midGrey",children:["(",r.x,",",r.y,")"]})]},e)})})};var Qn={exports:{}},Jn={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kl;function fy(){if(kl)return Jn;kl=1;var t=or();function e(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var r=typeof Object.is=="function"?Object.is:e,s=t.useSyncExternalStore,n=t.useRef,i=t.useEffect,o=t.useMemo,a=t.useDebugValue;return Jn.useSyncExternalStoreWithSelector=function(l,c,h,u,f){var d=n(null);if(d.current===null){var g={hasValue:!1,value:null};d.current=g}else g=d.current;d=o(function(){function p(E){if(!_){if(_=!0,b=E,E=u(E),f!==void 0&&g.hasValue){var M=g.value;if(f(M,E))return S=M}return S=E}if(M=S,r(b,E))return M;var I=u(E);return f!==void 0&&f(M,I)?(b=E,M):(b=E,S=I)}var _=!1,b,S,P=h===void 0?null:h;return[function(){return p(c())},P===null?void 0:function(){return p(P())}]},[c,h,u,f]);var y=s(l,d[0],d[1]);return i(function(){g.hasValue=!0,g.value=y},[y]),a(y),y},Jn}var Cl;function py(){return Cl||(Cl=1,Qn.exports=fy()),Qn.exports}var my=py();function gy(t){t()}function yy(){let t=null,e=null;return{clear(){t=null,e=null},notify(){gy(()=>{let r=t;for(;r;)r.callback(),r=r.next})},get(){const r=[];let s=t;for(;s;)r.push(s),s=s.next;return r},subscribe(r){let s=!0;const n=e={callback:r,next:null,prev:e};return n.prev?n.prev.next=n:t=n,function(){!s||t===null||(s=!1,n.next?n.next.prev=n.prev:e=n.prev,n.prev?n.prev.next=n.next:t=n.next)}}}}var Pl={notify(){},get:()=>[]};function xy(t,e){let r,s=Pl,n=0,i=!1;function o(y){h();const p=s.subscribe(y);let _=!1;return()=>{_||(_=!0,p(),u())}}function a(){s.notify()}function l(){g.onStateChange&&g.onStateChange()}function c(){return i}function h(){n++,r||(r=t.subscribe(l),s=yy())}function u(){n--,r&&n===0&&(r(),r=void 0,s.clear(),s=Pl)}function f(){i||(i=!0,h())}function d(){i&&(i=!1,u())}const g={addNestedSub:o,notifyNestedSubs:a,handleChangeWrapper:l,isSubscribed:c,trySubscribe:f,tryUnsubscribe:d,getListeners:()=>s};return g}var by=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",_y=by(),wy=()=>typeof navigator<"u"&&navigator.product==="ReactNative",vy=wy(),Ay=()=>_y||vy?D.useLayoutEffect:D.useEffect,Sy=Ay(),ky=Symbol.for("react-redux-context"),Cy=typeof globalThis<"u"?globalThis:{};function Py(){if(!D.createContext)return{};const t=Cy[ky]??=new Map;let e=t.get(D.createContext);return e||(e=D.createContext(null),t.set(D.createContext,e)),e}var St=Py();function My(t){const{children:e,context:r,serverState:s,store:n}=t,i=D.useMemo(()=>{const l=xy(n);return{store:n,subscription:l,getServerState:s?()=>s:void 0}},[n,s]),o=D.useMemo(()=>n.getState(),[n]);Sy(()=>{const{subscription:l}=i;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),o!==n.getState()&&l.notifyNestedSubs(),()=>{l.tryUnsubscribe(),l.onStateChange=void 0}},[i,o]);const a=r||St;return D.createElement(a.Provider,{value:i},e)}var Ty=My;function so(t=St){return function(){return D.useContext(t)}}var Hh=so();function $h(t=St){const e=t===St?Hh:so(t),r=()=>{const{store:s}=e();return s};return Object.assign(r,{withTypes:()=>r}),r}var Uh=$h();function Iy(t=St){const e=t===St?Uh:$h(t),r=()=>e().dispatch;return Object.assign(r,{withTypes:()=>r}),r}var Ey=Iy(),Ry=(t,e)=>t===e;function jy(t=St){const e=t===St?Hh:so(t),r=(s,n={})=>{const{equalityFn:i=Ry}=typeof n=="function"?{equalityFn:n}:n,o=e(),{store:a,subscription:l,getServerState:c}=o;D.useRef(!0);const h=D.useCallback({[s.name](f){return s(f)}}[s.name],[s]),u=my.useSyncExternalStoreWithSelector(l.addNestedSub,a.getState,c||a.getState,h,i);return D.useDebugValue(u),u};return Object.assign(r,{withTypes:()=>r}),r}var By=jy(),ei,Ml;function zy(){if(Ml)return ei;Ml=1;function t(s){if(Array.isArray(s))return!0;var n=s.length;return typeof n=="number"&&n>-1?n?0 in s&&n-1 in s:!0:!1}function e(s){var n=typeof s;return n==="object"?s===null?"null":t(s)?"array":s.constructor===Object?"pure-object":"object":n}function r(s,n){if(s===n||s!==s&&n!==n)return!0;var i=e(s),o=e(n);if(i!==o)return!1;if(i==="pure-object"){if(s===n)return!0;var a=Object.keys(s),l=Object.keys(n).length;if(a.length!==l)return!1;for(var c=0,h=a.length;c<h;c++){var u=a[c];if(!n.hasOwnProperty(a[c]))return!1;var f=s[u],d=n[u];if(f===s||d===n||f===n||d===s)return f===d;if(!r(f,d))return!1}return!0}else if(i==="array"){if(s.length===n.length)for(var g=0;g<s.length;g++){var y=s[g],p=n[g];if(y===s||p===n||y===n||p===s)return y===p;if(!r(y,p))return!1}else return!1;return!0}else if(i==="object"){if(s.valueOf!==Object.prototype.valueOf()&&n.valueOf!==Object.prototype.valueOf())return s.valueOf()===n.valueOf();if(s.toString!==Object.prototype.toString()&&n.toString!==Object.prototype.toString())return s.toString()===n.toString()}return!1}return ei=r,ei}var Fy=zy();const Oy=Ye(Fy),Vh=Ey.withTypes(),ce=By.withTypes();Uh.withTypes();const Ny=["jump","fire","carry","swop","hold","toggleColourisation","toggleShowFps","menu_select","menu_openOrExit","menu_exit",...dr],qh=t=>t==="left"?{axis:"x",direction:-1}:t==="right"?{axis:"x",direction:1}:t==="towards"?{axis:"y",direction:1}:t==="away"?{axis:"y",direction:-1}:void 0,we={dPadDown:13,dPadUp:12,dPadLeft:14,dPadRight:15,a:0,b:1,x:2,y:3,l1:4,r1:5,l2:6,r2:7,select:8,start:9,l3:10,r3:11},Tl=Jg(we,([t,e])=>[e,t]),Ly={start:"1",coin:"5",directions:{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},buttons:["Control","Alt"," ","Shift","Z","X"]},Dy={start:"2",coin:"6",directions:{up:"R",down:"F",left:"D",right:"G"},buttons:["A","S","Q","W","I","K"]},Kr={presses:{menu_openOrExit:{keys:["Escape","Tab",""]},menu_exit:{gamepadButtons:[we.x]},menu_select:{keys:["Enter"],gamepadButtons:[we.a]},toggleColourisation:{keys:["F6"]},toggleShowFps:{keys:["F9"]}},axes:{x:[0],y:[1]}},Yh=[...Ny,...dr],Zr={presses:ro(Yh.map(t=>[t,{keys:[],gamepadAxes:[],gamepadButtons:[]}])),axes:{x:[],y:[]}},Il=(t,e)=>Array.from(new Set([...t??[],...e??[]]));function Qr(t,...e){return{presses:e.reduce((r,s)=>{for(const n of Yh)r[n]={keys:Il(r[n]?.keys,s?.presses?.[n]?.keys),gamepadButtons:Il(r[n]?.gamepadButtons,s?.presses?.[n]?.gamepadButtons)};return r},structuredClone(t.presses)),axes:{x:Array.from(new Set([...t.axes.x,...e.map(r=>r.axes?.x??[]).flat()])),y:Array.from(new Set([...t.axes.y,...e.map(r=>r.axes?.y??[]).flat()]))}}}const Gy={inputAssignment:Qr(Zr,Kr,{presses:{right:{keys:["P","7"]},towards:{keys:["A","8"]},left:{keys:["O","6"]},away:{keys:["Q","9"]},jump:{keys:[" ","M","N","B","Alt"]},carry:{keys:[" ","Enter","L","K","J"]},fire:{keys:["Shift","Z","X","C","V"]},swop:{keys:["S","D","F","G"]},hold:{keys:["H"]}}}),description:"closely matches zx spectrum keys"},Xh={inputAssignment:Qr(Zr,Kr,{presses:{right:{gamepadButtons:[we.dPadRight]},towards:{gamepadButtons:[we.dPadDown]},left:{gamepadButtons:[we.dPadLeft]},away:{gamepadButtons:[we.dPadUp]},jump:{gamepadButtons:[we.a,we.y]},carry:{gamepadButtons:[we.b,we.y]},fire:{gamepadButtons:[we.x]},swop:{gamepadButtons:[we.r1]},hold:{gamepadButtons:[we.start]},menu_openOrExit:{gamepadButtons:[we.l1,we.select]},toggleColourisation:{gamepadButtons:[we.l2]}},axes:{x:[0],y:[1]}}),description:"Joysticks/gamepads with at least 4 buttons, but preferably 6 or more. Inc Playstation, xbox etc"},Wy={inputAssignment:Qr(Zr,Kr,Xh.inputAssignment,{presses:{right:{keys:["ArrowRight","P","Numpad6"]},towards:{keys:["ArrowDown","A","Numpad5"]},left:{keys:["ArrowLeft","O","Numpad8"]},away:{keys:["ArrowUp","Q","Numpad9"]},jump:{keys:[" ","`","\\","Numpad0","Numpad-"]},carry:{keys:["Shift","`","\\","Numpad1","Numpad-"]},fire:{keys:["D","NumpadEnter"]},swop:{keys:["Enter","S","Numpad+"]},hold:{keys:["F8","H","Numpad."]}}}),description:"Default combined key and joystick/gamepad assignment, should work on most setups"},Hy={inputAssignment:Qr(Zr,Kr,{presses:{right:{keys:["D"]},towards:{keys:["S"]},left:{keys:["A"]},away:{keys:["W"]},jump:{keys:[" ","F","P"]},carry:{keys:["Shift","F","I","P"]},fire:{keys:["E","O","Control"]},swop:{keys:["Q"]},hold:{keys:["H"]}}}),description:"Modern, minimalist WASD key layout"},El=t=>({presses:{right:{keys:[t.directions.right]},towards:{keys:[t.directions.down]},left:{keys:[t.directions.left]},away:{keys:[t.directions.up]},jump:{keys:[t.buttons[0],t.buttons[3]]},carry:{keys:[t.buttons[1],t.buttons[3]]},fire:{keys:[t.buttons[2]]},swop:{keys:[t.start]},hold:{keys:[t.coin]},menu_openOrExit:{keys:[t.buttons[5]]}}}),$y={inputAssignment:Qr(Zr,Kr,{presses:{menu_openOrExit:{keys:["`","Tab"]}}},El(Ly),El(Dy)),description:"MAME key mappings. For arcade-style control panels"},Jr={default:Wy,"zx spectrum":Gy,mame:$y,wasd:Hy,"joystick":Xh},no=()=>ce(t=>{const{upscale:{cssUpscale:e,gameEngineUpscale:r}}=t;return e*r}),mv=t=>t.openMenus.length>0,Kh=()=>ce(t=>t.cheatsOn),Zh=t=>t.assigningInput!==void 0,Qh=()=>ce(Zh),Uy=t=>{for(const[e,r]of nr(Lh(Jr)))if(Oy(r.inputAssignment,t.userSettings.inputAssignment))return e},Vy=t=>t.userSettings.showFps,io=()=>ce(t=>t.gameRunning),oo=({children:t})=>{const e=no();return m.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e,"--block":`${e*8}px`},children:t})},Jh=D.createContext(null),qy=({gameApi:t,children:e})=>m.jsx(Jh,{value:t,children:e}),gv=()=>{const t=D.useContext(Jh);if(t===null)throw new Error("useGameApi must be used within a GameApiProvider");return t};function ve(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var Yy=typeof Symbol=="function"&&Symbol.observable||"@@observable",Rl=Yy,ti=()=>Math.random().toString(36).substring(7).split("").join("."),Xy={INIT:`@@redux/INIT${ti()}`,REPLACE:`@@redux/REPLACE${ti()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${ti()}`},Ts=Xy;function ao(t){if(typeof t!="object"||t===null)return!1;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e||Object.getPrototypeOf(t)===null}function lo(t,e,r){if(typeof t!="function")throw new Error(ve(2));if(typeof e=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(ve(0));if(typeof e=="function"&&typeof r>"u"&&(r=e,e=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(ve(1));return r(lo)(t,e)}let s=t,n=e,i=new Map,o=i,a=0,l=!1;function c(){o===i&&(o=new Map,i.forEach((p,_)=>{o.set(_,p)}))}function h(){if(l)throw new Error(ve(3));return n}function u(p){if(typeof p!="function")throw new Error(ve(4));if(l)throw new Error(ve(5));let _=!0;c();const b=a++;return o.set(b,p),function(){if(_){if(l)throw new Error(ve(6));_=!1,c(),o.delete(b),i=null}}}function f(p){if(!ao(p))throw new Error(ve(7));if(typeof p.type>"u")throw new Error(ve(8));if(typeof p.type!="string")throw new Error(ve(17));if(l)throw new Error(ve(9));try{l=!0,n=s(n,p)}finally{l=!1}return(i=o).forEach(b=>{b()}),p}function d(p){if(typeof p!="function")throw new Error(ve(10));s=p,f({type:Ts.REPLACE})}function g(){const p=u;return{subscribe(_){if(typeof _!="object"||_===null)throw new Error(ve(11));function b(){const P=_;P.next&&P.next(h())}return b(),{unsubscribe:p(b)}},[Rl](){return this}}}return f({type:Ts.INIT}),{dispatch:f,subscribe:u,getState:h,replaceReducer:d,[Rl]:g}}function Ky(t){Object.keys(t).forEach(e=>{const r=t[e];if(typeof r(void 0,{type:Ts.INIT})>"u")throw new Error(ve(12));if(typeof r(void 0,{type:Ts.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(ve(13))})}function Zy(t){const e=Object.keys(t),r={};for(let i=0;i<e.length;i++){const o=e[i];typeof t[o]=="function"&&(r[o]=t[o])}const s=Object.keys(r);let n;try{Ky(r)}catch(i){n=i}return function(o={},a){if(n)throw n;let l=!1;const c={};for(let h=0;h<s.length;h++){const u=s[h],f=r[u],d=o[u],g=f(d,a);if(typeof g>"u")throw a&&a.type,new Error(ve(14));c[u]=g,l=l||g!==d}return l=l||s.length!==Object.keys(o).length,l?c:o}}function Is(...t){return t.length===0?e=>e:t.length===1?t[0]:t.reduce((e,r)=>(...s)=>e(r(...s)))}function Qy(...t){return e=>(r,s)=>{const n=e(r,s);let i=()=>{throw new Error(ve(15))};const o={getState:n.getState,dispatch:(l,...c)=>i(l,...c)},a=t.map(l=>l(o));return i=Is(...a)(n.dispatch),{...n,dispatch:i}}}function Jy(t){return ao(t)&&"type"in t&&typeof t.type=="string"}var eu=Symbol.for("immer-nothing"),jl=Symbol.for("immer-draftable"),Ne=Symbol.for("immer-state");function Ve(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var ir=Object.getPrototypeOf;function Dt(t){return!!t&&!!t[Ne]}function yt(t){return t?tu(t)||Array.isArray(t)||!!t[jl]||!!t.constructor?.[jl]||Gs(t)||Ws(t):!1}var ex=Object.prototype.constructor.toString();function tu(t){if(!t||typeof t!="object")return!1;const e=ir(t);if(e===null)return!0;const r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===ex}function Es(t,e){Ds(t)===0?Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)}):t.forEach((r,s)=>e(s,r,t))}function Ds(t){const e=t[Ne];return e?e.type_:Array.isArray(t)?1:Gs(t)?2:Ws(t)?3:0}function Pi(t,e){return Ds(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function ru(t,e,r){const s=Ds(t);s===2?t.set(e,r):s===3?t.add(r):t[e]=r}function tx(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function Gs(t){return t instanceof Map}function Ws(t){return t instanceof Set}function jt(t){return t.copy_||t.base_}function Mi(t,e){if(Gs(t))return new Map(t);if(Ws(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const r=tu(t);if(e===!0||e==="class_only"&&!r){const s=Object.getOwnPropertyDescriptors(t);delete s[Ne];let n=Reflect.ownKeys(s);for(let i=0;i<n.length;i++){const o=n[i],a=s[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(s[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:t[o]})}return Object.create(ir(t),s)}else{const s=ir(t);if(s!==null&&r)return{...t};const n=Object.create(s);return Object.assign(n,t)}}function co(t,e=!1){return Hs(t)||Dt(t)||!yt(t)||(Ds(t)>1&&(t.set=t.add=t.clear=t.delete=rx),Object.freeze(t),e&&Object.entries(t).forEach(([r,s])=>co(s,!0))),t}function rx(){Ve(2)}function Hs(t){return Object.isFrozen(t)}var sx={};function Gt(t){const e=sx[t];return e||Ve(0,t),e}var Ur;function su(){return Ur}function nx(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Bl(t,e){e&&(Gt("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function Ti(t){Ii(t),t.drafts_.forEach(ix),t.drafts_=null}function Ii(t){t===Ur&&(Ur=t.parent_)}function zl(t){return Ur=nx(Ur,t)}function ix(t){const e=t[Ne];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Fl(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];return t!==void 0&&t!==r?(r[Ne].modified_&&(Ti(e),Ve(4)),yt(t)&&(t=Rs(e,t),e.parent_||js(e,t)),e.patches_&&Gt("Patches").generateReplacementPatches_(r[Ne].base_,t,e.patches_,e.inversePatches_)):t=Rs(e,r,[]),Ti(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==eu?t:void 0}function Rs(t,e,r){if(Hs(e))return e;const s=e[Ne];if(!s)return Es(e,(n,i)=>Ol(t,s,e,n,i,r)),e;if(s.scope_!==t)return e;if(!s.modified_)return js(t,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;const n=s.copy_;let i=n,o=!1;s.type_===3&&(i=new Set(n),n.clear(),o=!0),Es(i,(a,l)=>Ol(t,s,n,a,l,r,o)),js(t,n,!1),r&&t.patches_&&Gt("Patches").generatePatches_(s,r,t.patches_,t.inversePatches_)}return s.copy_}function Ol(t,e,r,s,n,i,o){if(Dt(n)){const a=i&&e&&e.type_!==3&&!Pi(e.assigned_,s)?i.concat(s):void 0,l=Rs(t,n,a);if(ru(r,s,l),Dt(l))t.canAutoFreeze_=!1;else return}else o&&r.add(n);if(yt(n)&&!Hs(n)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;Rs(t,n),(!e||!e.scope_.parent_)&&typeof s!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,s)&&js(t,n)}}function js(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&co(e,r)}function ox(t,e){const r=Array.isArray(t),s={type_:r?1:0,scope_:e?e.scope_:su(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let n=s,i=ho;r&&(n=[s],i=Vr);const{revoke:o,proxy:a}=Proxy.revocable(n,i);return s.draft_=a,s.revoke_=o,a}var ho={get(t,e){if(e===Ne)return t;const r=jt(t);if(!Pi(r,e))return ax(t,r,e);const s=r[e];return t.finalized_||!yt(s)?s:s===ri(t.base_,e)?(si(t),t.copy_[e]=Ri(s,t)):s},has(t,e){return e in jt(t)},ownKeys(t){return Reflect.ownKeys(jt(t))},set(t,e,r){const s=nu(jt(t),e);if(s?.set)return s.set.call(t.draft_,r),!0;if(!t.modified_){const n=ri(jt(t),e),i=n?.[Ne];if(i&&i.base_===r)return t.copy_[e]=r,t.assigned_[e]=!1,!0;if(tx(r,n)&&(r!==void 0||Pi(t.base_,e)))return!0;si(t),Ei(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_[e]=!0),!0},deleteProperty(t,e){return ri(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,si(t),Ei(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=jt(t),s=Reflect.getOwnPropertyDescriptor(r,e);return s&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:s.enumerable,value:r[e]}},defineProperty(){Ve(11)},getPrototypeOf(t){return ir(t.base_)},setPrototypeOf(){Ve(12)}},Vr={};Es(ho,(t,e)=>{Vr[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});Vr.deleteProperty=function(t,e){return Vr.set.call(this,t,e,void 0)};Vr.set=function(t,e,r){return ho.set.call(this,t[0],e,r,t[0])};function ri(t,e){const r=t[Ne];return(r?jt(r):t)[e]}function ax(t,e,r){const s=nu(e,r);return s?"value"in s?s.value:s.get?.call(t.draft_):void 0}function nu(t,e){if(!(e in t))return;let r=ir(t);for(;r;){const s=Object.getOwnPropertyDescriptor(r,e);if(s)return s;r=ir(r)}}function Ei(t){t.modified_||(t.modified_=!0,t.parent_&&Ei(t.parent_))}function si(t){t.copy_||(t.copy_=Mi(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var lx=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,r,s)=>{if(typeof e=="function"&&typeof r!="function"){const i=r;r=e;const o=this;return function(l=i,...c){return o.produce(l,h=>r.call(this,h,...c))}}typeof r!="function"&&Ve(6),s!==void 0&&typeof s!="function"&&Ve(7);let n;if(yt(e)){const i=zl(this),o=Ri(e,void 0);let a=!0;try{n=r(o),a=!1}finally{a?Ti(i):Ii(i)}return Bl(i,s),Fl(n,i)}else if(!e||typeof e!="object"){if(n=r(e),n===void 0&&(n=e),n===eu&&(n=void 0),this.autoFreeze_&&co(n,!0),s){const i=[],o=[];Gt("Patches").generateReplacementPatches_(e,n,i,o),s(i,o)}return n}else Ve(1,e)},this.produceWithPatches=(e,r)=>{if(typeof e=="function")return(o,...a)=>this.produceWithPatches(o,l=>e(l,...a));let s,n;return[this.produce(e,r,(o,a)=>{s=o,n=a}),s,n]},typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof t?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){yt(t)||Ve(8),Dt(t)&&(t=cx(t));const e=zl(this),r=Ri(t,void 0);return r[Ne].isManual_=!0,Ii(e),r}finishDraft(t,e){const r=t&&t[Ne];(!r||!r.isManual_)&&Ve(9);const{scope_:s}=r;return Bl(s,e),Fl(void 0,s)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let r;for(r=e.length-1;r>=0;r--){const n=e[r];if(n.path.length===0&&n.op==="replace"){t=n.value;break}}r>-1&&(e=e.slice(r+1));const s=Gt("Patches").applyPatches_;return Dt(t)?s(t,e):this.produce(t,n=>s(n,e))}};function Ri(t,e){const r=Gs(t)?Gt("MapSet").proxyMap_(t,e):Ws(t)?Gt("MapSet").proxySet_(t,e):ox(t,e);return(e?e.scope_:su()).drafts_.push(r),r}function cx(t){return Dt(t)||Ve(10,t),iu(t)}function iu(t){if(!yt(t)||Hs(t))return t;const e=t[Ne];let r;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=Mi(t,e.scope_.immer_.useStrictShallowCopy_)}else r=Mi(t,!0);return Es(r,(s,n)=>{ru(r,s,iu(n))}),e&&(e.finalized_=!1),r}var Le=new lx,ou=Le.produce;Le.produceWithPatches.bind(Le);Le.setAutoFreeze.bind(Le);Le.setUseStrictShallowCopy.bind(Le);Le.applyPatches.bind(Le);Le.createDraft.bind(Le);Le.finishDraft.bind(Le);function au(t){return({dispatch:r,getState:s})=>n=>i=>typeof i=="function"?i(r,s,t):n(i)}var hx=au(),ux=au,dx=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Is:Is.apply(null,arguments)};function Nl(t,e){function r(...s){if(e){let n=e(...s);if(!n)throw new Error(mt(0));return{type:t,payload:n.payload,..."meta"in n&&{meta:n.meta},..."error"in n&&{error:n.error}}}return{type:t,payload:s[0]}}return r.toString=()=>`${t}`,r.type=t,r.match=s=>Jy(s)&&s.type===t,r}var lu=class Br extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Br.prototype)}static get[Symbol.species](){return Br}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new Br(...e[0].concat(this)):new Br(...e.concat(this))}};function Ll(t){return yt(t)?ou(t,()=>{}):t}function Dl(t,e,r){return t.has(e)?t.get(e):t.set(e,r(e)).get(e)}function fx(t){return typeof t=="boolean"}var px=()=>function(e){const{thunk:r=!0,immutableCheck:s=!0,serializableCheck:n=!0,actionCreatorCheck:i=!0}=e??{};let o=new lu;return r&&(fx(r)?o.push(hx):o.push(ux(r.extraArgument))),o},mx="RTK_autoBatch",Gl=t=>e=>{setTimeout(e,t)},gx=(t={type:"raf"})=>e=>(...r)=>{const s=e(...r);let n=!0,i=!1,o=!1;const a=new Set,l=t.type==="tick"?queueMicrotask:t.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Gl(10):t.type==="callback"?t.queueNotification:Gl(t.timeout),c=()=>{o=!1,i&&(i=!1,a.forEach(h=>h()))};return Object.assign({},s,{subscribe(h){const u=()=>n&&h(),f=s.subscribe(u);return a.add(h),()=>{f(),a.delete(h)}},dispatch(h){try{return n=!h?.meta?.[mx],i=!n,i&&(o||(o=!0,l(c))),s.dispatch(h)}finally{n=!0}}})},yx=t=>function(r){const{autoBatch:s=!0}=r??{};let n=new lu(t);return s&&n.push(gx(typeof s=="object"?s:void 0)),n};function xx(t){const e=px(),{reducer:r=void 0,middleware:s,devTools:n=!0,preloadedState:i=void 0,enhancers:o=void 0}=t;let a;if(typeof r=="function")a=r;else if(ao(r))a=Zy(r);else throw new Error(mt(1));let l;typeof s=="function"?l=s(e):l=e();let c=Is;n&&(c=dx({trace:!1,...typeof n=="object"&&n}));const h=Qy(...l),u=yx(h);let f=typeof o=="function"?o(u):u();const d=c(...f);return lo(a,i,d)}function cu(t){const e={},r=[];let s;const n={addCase(i,o){const a=typeof i=="string"?i:i.type;if(!a)throw new Error(mt(28));if(a in e)throw new Error(mt(29));return e[a]=o,n},addMatcher(i,o){return r.push({matcher:i,reducer:o}),n},addDefaultCase(i){return s=i,n}};return t(n),[e,r,s]}function bx(t){return typeof t=="function"}function _x(t,e){let[r,s,n]=cu(e),i;if(bx(t))i=()=>Ll(t());else{const a=Ll(t);i=()=>a}function o(a=i(),l){let c=[r[l.type],...s.filter(({matcher:h})=>h(l)).map(({reducer:h})=>h)];return c.filter(h=>!!h).length===0&&(c=[n]),c.reduce((h,u)=>{if(u)if(Dt(h)){const d=u(h,l);return d===void 0?h:d}else{if(yt(h))return ou(h,f=>u(f,l));{const f=u(h,l);if(f===void 0){if(h===null)return h;throw Error("A case reducer on a non-draftable value must not return undefined")}return f}}return h},a)}return o.getInitialState=i,o}var wx=Symbol.for("rtk-slice-createasyncthunk");function vx(t,e){return`${t}/${e}`}function Ax({creators:t}={}){const e=t?.asyncThunk?.[wx];return function(s){const{name:n,reducerPath:i=n}=s;if(!n)throw new Error(mt(11));const o=(typeof s.reducers=="function"?s.reducers(Cx()):s.reducers)||{},a=Object.keys(o),l={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},c={addCase(b,S){const P=typeof b=="string"?b:b.type;if(!P)throw new Error(mt(12));if(P in l.sliceCaseReducersByType)throw new Error(mt(13));return l.sliceCaseReducersByType[P]=S,c},addMatcher(b,S){return l.sliceMatchers.push({matcher:b,reducer:S}),c},exposeAction(b,S){return l.actionCreators[b]=S,c},exposeCaseReducer(b,S){return l.sliceCaseReducersByName[b]=S,c}};a.forEach(b=>{const S=o[b],P={reducerName:b,type:vx(n,b),createNotation:typeof s.reducers=="function"};Mx(S)?Ix(P,S,c,e):Px(P,S,c)});function h(){const[b={},S=[],P=void 0]=typeof s.extraReducers=="function"?cu(s.extraReducers):[s.extraReducers],E={...b,...l.sliceCaseReducersByType};return _x(s.initialState,M=>{for(let I in E)M.addCase(I,E[I]);for(let I of l.sliceMatchers)M.addMatcher(I.matcher,I.reducer);for(let I of S)M.addMatcher(I.matcher,I.reducer);P&&M.addDefaultCase(P)})}const u=b=>b,f=new Map;let d;function g(b,S){return d||(d=h()),d(b,S)}function y(){return d||(d=h()),d.getInitialState()}function p(b,S=!1){function P(M){let I=M[b];return typeof I>"u"&&S&&(I=y()),I}function E(M=u){const I=Dl(f,S,()=>new WeakMap);return Dl(I,M,()=>{const z={};for(const[F,j]of Object.entries(s.selectors??{}))z[F]=Sx(j,M,y,S);return z})}return{reducerPath:b,getSelectors:E,get selectors(){return E(P)},selectSlice:P}}const _={name:n,reducer:g,actions:l.actionCreators,caseReducers:l.sliceCaseReducersByName,getInitialState:y,...p(i),injectInto(b,{reducerPath:S,...P}={}){const E=S??i;return b.inject({reducerPath:E,reducer:g},P),{..._,...p(E,!0)}}};return _}}function Sx(t,e,r,s){function n(i,...o){let a=e(i);return typeof a>"u"&&s&&(a=r()),t(a,...o)}return n.unwrapped=t,n}var kx=Ax();function Cx(){function t(e,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...r}}return t.withTypes=()=>t,{reducer(e){return Object.assign({[e.name](...r){return e(...r)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:r}},asyncThunk:t}}function Px({type:t,reducerName:e,createNotation:r},s,n){let i,o;if("reducer"in s){if(r&&!Tx(s))throw new Error(mt(17));i=s.reducer,o=s.prepare}else i=s;n.addCase(t,i).exposeCaseReducer(e,i).exposeAction(e,o?Nl(t,o):Nl(t))}function Mx(t){return t._reducerDefinitionType==="asyncThunk"}function Tx(t){return t._reducerDefinitionType==="reducerWithPrepare"}function Ix({type:t,reducerName:e},r,s,n){if(!n)throw new Error(mt(18));const{payloadCreator:i,fulfilled:o,pending:a,rejected:l,settled:c,options:h}=r,u=n(t,i,h);s.exposeAction(e,u),o&&s.addCase(u.fulfilled,o),a&&s.addCase(u.pending,a),l&&s.addCase(u.rejected,l),c&&s.addMatcher(u.settled,c),s.exposeCaseReducer(e,{fulfilled:o||ys,pending:a||ys,rejected:l||ys,settled:c||ys})}function ys(){}function mt(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}const Ex=3,hu=(t,e,r)=>{const s=Vg(t,r),n=Math.floor(Math.min(s.x/e.x,s.y/e.y)),i={x:Math.floor(s.x/n),y:Math.floor(s.y/n)},o=Math.min(Ex,n),a=n/o/r,l={x:Math.ceil(t.x/a),y:Math.ceil(t.y/a)};return{gameEngineUpscale:o,cssUpscale:a,gameEngineScreenSize:i,canvasSize:l}},Rx=(t,e)=>e.split(".").reduce((r,s)=>r[s],t),jx=(t,e,r)=>{const s=e.split(".");let n=t;for(let i=0;i<s.length-1;i++){const o=s[i];n=n[o]}n[s[s.length-1]]=r},uu=typeof globalThis.window<"u",ni=uu?new URLSearchParams(window.location.search).has("cheats"):!1,du={blacktooth:!1,bookworld:!1,egyptus:!1,penitentiary:!1,safari:!1},fu={userSettings:{inputAssignment:Jr.default.inputAssignment,infiniteLivesPoke:!1,displaySettings:{showBoundingBoxes:"none",showShadowMasks:!1,crtFilter:!0,colourise:!0,emulatedResolution:Zn},showFps:!1,analogueControl:!1},upscale:hu(uu?{x:globalThis.window.innerWidth,y:globalThis.window.innerHeight}:Zn,Zn,1),planetsLiberated:du,roomsExplored:{},scrollsRead:{},gameRunning:ni,openMenus:ni?[]:[{menuId:"mainMenu",scrollableSelection:!1}],assigningInput:void 0,cheatsOn:ni},pu=kx({name:"gameMenus",initialState:fu,reducers:{setUpscale(t,{payload:e}){t.upscale=e},setEmulatedResolution(t,{payload:e}){t.userSettings.displaySettings.emulatedResolution=e},scrollRead(t,{payload:e}){t.scrollsRead[e]=!0,t.openMenus=[{menuId:`markdown/${e}`,scrollableSelection:!1}]},inputAddedDuringAssignment(t,{payload:e}){if(t.assigningInput===void 0)throw new Error("reducer called while not assigning keys");const r=(o,a)=>{o.includes(a)||o.push(a)},{presses:s,axes:n,action:i}=t.assigningInput;switch(e.type){case"key":r(s.keys,e.input);break;case"gamepadButtons":r(s.gamepadButtons,e.input);break;case"gamepadAxes":{dr.includes(i)&&r(n,e.input);break}}},doneAssigningInput(t){if(t.assigningInput===void 0)throw new Error("illegal action for state");const{action:e,presses:r,axes:s}=t.assigningInput;r.keys.length+r.gamepadButtons.length+s.length>0&&(t.userSettings.inputAssignment.presses[e]=r,(e==="left"||e==="right")&&(t.userSettings.inputAssignment.axes.x=s),(e==="towards"||e==="away")&&(t.userSettings.inputAssignment.axes.y=s)),t.assigningInput=void 0},menuOpenOrExitPressed(t){if(t.openMenus.length>0){if(t.openMenus.length===1&&!t.gameRunning)return;const[,...e]=t.openMenus;t.openMenus=e}else t.openMenus=[{menuId:"mainMenu",scrollableSelection:!1}]},goToSubmenu(t,{payload:e}){t.openMenus=[{menuId:e,scrollableSelection:!1},...t.openMenus]},gameStarted(t){t.gameRunning?t.openMenus=[]:(t.openMenus=[{menuId:"crowns",scrollableSelection:!1}],t.gameRunning=!0,t.planetsLiberated=du,t.roomsExplored={},t.scrollsRead={})},backToParentMenu(t){const[,...e]=t.openMenus;t.openMenus=e},assignInputStart(t,{payload:e}){t.assigningInput={action:e,presses:{gamepadButtons:[],keys:[]},axes:[]}},keyAssignmentPresetChosen(t,{payload:e}){const[,...r]=t.openMenus;t.openMenus=r,t.userSettings.inputAssignment=Jr[e].inputAssignment},setFocussedMenuItemId(t,{payload:{focussedItemId:e,scrollableSelection:r}}){const[s]=t.openMenus;s.focussedItemId=e,s.scrollableSelection=r},holdPressed(t,{payload:e}){t.openMenus.length>0?t.openMenus[0]?.menuId==="hold"&&e!=="hold"&&(t.openMenus=[]):e!=="unhold"&&(t.openMenus=[{menuId:"hold",scrollableSelection:!1}])},setShowBoundingBoxes(t,{payload:e}){t.userSettings.displaySettings.showBoundingBoxes=e},setShowShadowMasks(t,{payload:e}){t.userSettings.displaySettings.showShadowMasks=e},toggleBoolean(t,{payload:e}){jx(t,e,!Rx(t,e))},crownCollected(t,{payload:e}){t.planetsLiberated[e]=!0,t.openMenus=[{menuId:"crowns",scrollableSelection:!1}]},roomExplored(t,{payload:e}){t.roomsExplored[e]=!0},gameOver(t){t.gameRunning=!1,t.openMenus=[{menuId:"gameOver",scrollableSelection:!1},{menuId:"mainMenu",scrollableSelection:!0}]}}}),{assignInputStart:Je,backToParentMenu:xt,crownCollected:yv,doneAssigningInput:Bx,gameOver:zx,gameStarted:Fx,goToSubmenu:Zt,holdPressed:Wl,inputAddedDuringAssignment:Ox,keyAssignmentPresetChosen:Nx,menuOpenOrExitPressed:Hl,setEmulatedResolution:xv,setFocussedMenuItemId:uo,setShowBoundingBoxes:bv,setShowShadowMasks:_v,setUpscale:Lx,scrollRead:wv,toggleBoolean:Bt,roomExplored:vv}=pu.actions,Dx=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","","","","0","1","2","3","4","5","6","7","8","9","!","@","#","$","%","^","&","*","(",")","-","_","=","+","[","]","{","}",";",":","'",'"',",",".","/","<",">","?","\\","|"," ","Enter","Shift","Control","Alt","`","~","Tab","Backspace","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","Numpad+","Numpad-","Numpad*","Numpad/","Numpad.","NumpadEnter","Numpad=","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Escape",""],Gx=t=>Dx.includes(t);let Wx=1;const Hx=()=>Wx++,$x=3,$l=({key:t,location:e,repeat:r})=>{if(r)return;const s=t.length===1?t.toUpperCase():t,n=e===$x?`Numpad${s}`:s;if(Gx(n))return n;console.warn("unrecognised key",t)},Ux=()=>new Map,Vx=t=>{const e=n=>{const i=$l(n);i!==void 0&&t.set(i,Hx())},r=n=>{const i=$l(n);i!==void 0&&t.delete(i)},s=()=>{t.clear()};return window.addEventListener("keydown",e,!1),window.addEventListener("keyup",r,!1),window.addEventListener("blur",s,!1),()=>{window.removeEventListener("keydown",e,!1),window.removeEventListener("keyup",r,!1),window.removeEventListener("blur",s,!1)}};var _r={},xs={},bs={},Ul;function qx(){if(Ul)return bs;Ul=1,bs.__esModule=!0,bs.default=n;function t(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?t=function(a){return typeof a}:t=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},t(i)}function e(){}var r={getItem:e,setItem:e,removeItem:e};function s(i){if((typeof self>"u"?"undefined":t(self))!=="object"||!(i in self))return!1;try{var o=self[i],a="redux-persist ".concat(i," test");o.setItem(a,"test"),o.getItem(a),o.removeItem(a)}catch{return!1}return!0}function n(i){var o="".concat(i,"Storage");return s(o)?self[o]:r}return bs}var Vl;function Yx(){if(Vl)return xs;Vl=1,xs.__esModule=!0,xs.default=r;var t=e(qx());function e(s){return s&&s.__esModule?s:{default:s}}function r(s){var n=(0,t.default)(s);return{getItem:function(o){return new Promise(function(a,l){a(n.getItem(o))})},setItem:function(o,a){return new Promise(function(l,c){l(n.setItem(o,a))})},removeItem:function(o){return new Promise(function(a,l){a(n.removeItem(o))})}}}return xs}var ql;function Xx(){if(ql)return _r;ql=1,_r.__esModule=!0,_r.default=void 0;var t=e(Yx());function e(s){return s&&s.__esModule?s:{default:s}}var r=(0,t.default)("local");return _r.default=r,_r}var Kx=Xx();const Zx=Ye(Kx);var fo="persist:",po="persist/FLUSH",$s="persist/REHYDRATE",mo="persist/PAUSE",go="persist/PERSIST",yo="persist/PURGE",xo="persist/REGISTER",mu=-1;function Ss(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ss=function(r){return typeof r}:Ss=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Ss(t)}function Yl(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function Qx(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Yl(r,!0).forEach(function(s){Jx(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Yl(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function Jx(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function eb(t,e,r,s){s.debug;var n=Qx({},r);return t&&Ss(t)==="object"&&Object.keys(t).forEach(function(i){i!=="_persist"&&e[i]===r[i]&&(n[i]=t[i])}),n}function tb(t){var e=t.blacklist||null,r=t.whitelist||null,s=t.transforms||[],n=t.throttle||0,i="".concat(t.keyPrefix!==void 0?t.keyPrefix:fo).concat(t.key),o=t.storage,a;t.serialize===!1?a=function(E){return E}:typeof t.serialize=="function"?a=t.serialize:a=rb;var l=t.writeFailHandler||null,c={},h={},u=[],f=null,d=null,g=function(E){Object.keys(E).forEach(function(M){_(M)&&c[M]!==E[M]&&u.indexOf(M)===-1&&u.push(M)}),Object.keys(c).forEach(function(M){E[M]===void 0&&_(M)&&u.indexOf(M)===-1&&c[M]!==void 0&&u.push(M)}),f===null&&(f=setInterval(y,n)),c=E};function y(){if(u.length===0){f&&clearInterval(f),f=null;return}var P=u.shift(),E=s.reduce(function(M,I){return I.in(M,P,c)},c[P]);if(E!==void 0)try{h[P]=a(E)}catch(M){console.error("redux-persist/createPersistoid: error serializing state",M)}else delete h[P];u.length===0&&p()}function p(){Object.keys(h).forEach(function(P){c[P]===void 0&&delete h[P]}),d=o.setItem(i,a(h)).catch(b)}function _(P){return!(r&&r.indexOf(P)===-1&&P!=="_persist"||e&&e.indexOf(P)!==-1)}function b(P){l&&l(P)}var S=function(){for(;u.length!==0;)y();return d||Promise.resolve()};return{update:g,flush:S}}function rb(t){return JSON.stringify(t)}function sb(t){var e=t.transforms||[],r="".concat(t.keyPrefix!==void 0?t.keyPrefix:fo).concat(t.key),s=t.storage;t.debug;var n;return t.deserialize===!1?n=function(o){return o}:typeof t.deserialize=="function"?n=t.deserialize:n=nb,s.getItem(r).then(function(i){if(i)try{var o={},a=n(i);return Object.keys(a).forEach(function(l){o[l]=e.reduceRight(function(c,h){return h.out(c,l,a)},n(a[l]))}),o}catch(l){throw l}else return})}function nb(t){return JSON.parse(t)}function ib(t){var e=t.storage,r="".concat(t.keyPrefix!==void 0?t.keyPrefix:fo).concat(t.key);return e.removeItem(r,ob)}function ob(t){}function Xl(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function ht(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Xl(r,!0).forEach(function(s){ab(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xl(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function ab(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function lb(t,e){if(t==null)return{};var r=cb(t,e),s,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)s=i[n],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(r[s]=t[s])}return r}function cb(t,e){if(t==null)return{};var r={},s=Object.keys(t),n,i;for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&(r[n]=t[n]);return r}var hb=5e3;function ub(t,e){var r=t.version!==void 0?t.version:mu;t.debug;var s=t.stateReconciler===void 0?eb:t.stateReconciler,n=t.getStoredState||sb,i=t.timeout!==void 0?t.timeout:hb,o=null,a=!1,l=!0,c=function(u){return u._persist.rehydrated&&o&&!l&&o.update(u),u};return function(h,u){var f=h||{},d=f._persist,g=lb(f,["_persist"]),y=g;if(u.type===go){var p=!1,_=function(z,F){p||(u.rehydrate(t.key,z,F),p=!0)};if(i&&setTimeout(function(){!p&&_(void 0,new Error('redux-persist: persist timed out for persist key "'.concat(t.key,'"')))},i),l=!1,o||(o=tb(t)),d)return ht({},e(y,u),{_persist:d});if(typeof u.rehydrate!="function"||typeof u.register!="function")throw new Error("redux-persist: either rehydrate or register is not a function on the PERSIST action. This can happen if the action is being replayed. This is an unexplored use case, please open an issue and we will figure out a resolution.");return u.register(t.key),n(t).then(function(I){var z=t.migrate||function(F,j){return Promise.resolve(F)};z(I,r).then(function(F){_(F)},function(F){_(void 0,F)})},function(I){_(void 0,I)}),ht({},e(y,u),{_persist:{version:r,rehydrated:!1}})}else{if(u.type===yo)return a=!0,u.result(ib(t)),ht({},e(y,u),{_persist:d});if(u.type===po)return u.result(o&&o.flush()),ht({},e(y,u),{_persist:d});if(u.type===mo)l=!0;else if(u.type===$s){if(a)return ht({},y,{_persist:ht({},d,{rehydrated:!0})});if(u.key===t.key){var b=e(y,u),S=u.payload,P=s!==!1&&S!==void 0?s(S,h,b,t):b,E=ht({},P,{_persist:ht({},d,{rehydrated:!0})});return c(E)}}}if(!d)return e(h,u);var M=e(y,u);return M===y?h:c(ht({},M,{_persist:d}))}}function Kl(t){return pb(t)||fb(t)||db()}function db(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function fb(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}function pb(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function Zl(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function ji(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Zl(r,!0).forEach(function(s){mb(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zl(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function mb(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var gu={registry:[],bootstrapped:!1},gb=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:gu,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case xo:return ji({},e,{registry:[].concat(Kl(e.registry),[r.key])});case $s:var s=e.registry.indexOf(r.key),n=Kl(e.registry);return n.splice(s,1),ji({},e,{registry:n,bootstrapped:n.length===0});default:return e}};function yb(t,e,r){var s=lo(gb,gu,void 0),n=function(l){s.dispatch({type:xo,key:l})},i=function(l,c,h){var u={type:$s,payload:c,err:h,key:l};t.dispatch(u),s.dispatch(u)},o=ji({},s,{purge:function(){var l=[];return t.dispatch({type:yo,result:function(h){l.push(h)}}),Promise.all(l)},flush:function(){var l=[];return t.dispatch({type:po,result:function(h){l.push(h)}}),Promise.all(l)},pause:function(){t.dispatch({type:mo})},persist:function(){t.dispatch({type:go,register:n,rehydrate:i})}});return o.persist(),o}function xb(t,e){return function(r,s){if(!r)return Promise.resolve(void 0);var n=r._persist&&r._persist.version!==void 0?r._persist.version:mu;if(n===s||n>s)return Promise.resolve(r);var i=Object.keys(t).map(function(a){return parseInt(a)}).filter(function(a){return s>=a&&a>n}).sort(function(a,l){return a-l});try{var o=i.reduce(function(a,l){return t[l](a)},r);return Promise.resolve(o)}catch(a){return Promise.reject(a)}}}const bb=(t,...e)=>{const r={};for(const s of e)r[s]=t[s];return r},Vt=t=>{const e=bb(fu,"userSettings");return console.log("migrating state: persisted is:",t,"am reverting to initial (partial) state:",e),e},_b={key:"hohol/gameMenus/userSettings",version:6,migrate:xb({1:Vt,2:Vt,3:Vt,4:Vt,5:Vt,6:Vt}),storage:Zx,whitelist:["userSettings"]},wb=ub(_b,pu.reducer),Te=xx({reducer:wb,middleware:t=>t({serializableCheck:{ignoredActions:[po,$s,mo,go,yo,xo]}})});yb(Te);const ut={away:{x:0,y:1,z:0},left:{x:1,y:0,z:0},right:{x:-1,y:0,z:0},towards:{x:0,y:-1,z:0},down:{x:0,y:0,z:-1},up:{x:0,y:0,z:1},awayRight:Kt({x:1,y:1,z:0}),rightTowards:Kt({x:1,y:-1,z:0}),towardsLeft:Kt({x:-1,y:-1,z:0}),leftAway:Kt({x:-1,y:1,z:0})},Ql=t=>t.map(e=>e===null?null:{buttons:e.buttons.map(r=>({pressed:r.pressed})),axes:e.axes.map(r=>r)}),vb=Kt({x:1,y:2,z:0}),Ab=Kt({x:-1,y:2,z:0}),Sb=t=>{const e=$r(t);if(e===0)return t;const r={x:vl(t,vb),y:vl(t,Ab),z:0};return to(r,e/$r(r))},kb=(t,e)=>{const{x:r,y:s}=t,n=Math.sqrt(r*r+s*s);if(n===0)return{x:0,y:0};const i=Math.cos(e),o=r/n,a=s/n,l=Math.abs(o),c=Math.abs(a);if(l>c){if(l>=i)return{x:Math.sign(r)*n,y:0}}else if(c>=i)return{x:0,y:Math.sign(s)*n};return t},Cb=.2,Pb=13*(Math.PI/180),Mb=(t,e)=>!!t.keyboardState.has(e),yu=(t,e)=>{for(const r of t.gamepads)if(!(r===null||r.buttons.length<=e)&&r.buttons[e].pressed)return!0;return!1},Bi=.5,xu=(t,e,r)=>{for(const s of t.gamepads)if(!(s===null||s.axes.length<=e)){if(r===void 0){if(Math.abs(s.axes[e])>Bi)return!0}else if(s.axes[e]*r>Bi)return!0}return!1},ii=(t,e,r=!0)=>{const{inputAssignment:s}=Te.getState().userSettings,n=s.presses[e];for(const i of n.keys)if(Mb(t,i))return!0;for(const i of n.gamepadButtons)if(yu(t,i))return!0;if(r){const i=qh(e);if(i!==void 0){const o=s.axes[i.axis];for(const a of o)if(xu(t,a,i.direction))return!0}}return!1};class Tb{constructor(e){this.keyboardStateMap=e,this.#t={keyboardState:new Map(e),gamepads:Ql(navigator.getGamepads())}}#t;#e=void 0;#r=jr;#n=()=>{let e,r,s,n;switch("tap"){case(e=this.currentActionPress("left")):return ut.left;case(r=this.currentActionPress("right")):return ut.right;case(s=this.currentActionPress("away")):return ut.away;case(n=this.currentActionPress("towards")):return ut.towards}const i=(e!=="released"?1:0)+(r!=="released"?1:0)+(s!=="released"?1:0)+(n!=="released"?1:0);if(i>1)return this.#r;if(i===1)switch("hold"){case e:return ut.left;case r:return ut.right;case s:return ut.away;case n:return ut.towards}return jr};#i(){const e=this.#t;function*r(){for(const l of dr)ii(e,l,!1)&&(yield ut[l])}function*s(){const{userSettings:{inputAssignment:{axes:{x:l,y:c}}}}=Te.getState();for(const h of e.gamepads){if(h===null)continue;let u=0,f=0;for(const g of l)h.axes.length<=g||(u-=h.axes[g]);for(const g of c)h.axes.length<=g||(f-=h.axes[g]);const d={x:u,y:f,z:0};$r(d)>Cb&&(yield d)}}const n=Xn(jr,...r()),i=kb(Sb(Xn(jr,...s())),Pb),o=Xn(n,i),a=$r(o);return a>1?to(o,1/a):o}#s=()=>{const{userSettings:{analogueControl:e}}=Te.getState();this.#r=e?this.#i():this.#n(),this.#e=this.#t,this.#t={keyboardState:new Map(this.keyboardStateMap),gamepads:Ql(navigator.getGamepads())}};currentActionPress(e){return ii(this.#t,e)?(this.#e===void 0?!1:ii(this.#e,e))?"hold":"tap":"released"}inputTap(){for(const e of this.keyboardStateMap.keys())if(this.#e===void 0||!this.#e.keyboardState.has(e))return{type:"key",input:e};for(const e of this.#t.gamepads)if(e!==null){for(const[r,s]of e.buttons.entries())if(s.pressed&&(this.#e===void 0||!yu(this.#e,r)))return{type:"gamepadButtons",input:r};for(const[r,s]of e.axes.entries())if(Math.abs(s)>Bi&&(this.#e===void 0||!xu(this.#e,r)))return{type:"gamepadAxes",input:r}}}get directionVector(){return this.#r}startTicking(){nt.shared.add(this.#s,void 0,Cs.UTILITY)}stopTicking(){nt.shared.remove(this.#s)}}const bu=D.createContext(null),Ib=({children:t})=>{const[e]=D.useState(Ux),[r]=D.useState(()=>new Tb(e));return D.useEffect(()=>{const s=Vx(e);return r.startTicking(),()=>{s(),r.stopTicking()}},[r,e]),m.jsx(bu,{value:r,children:t})},bo=()=>{const t=D.useContext(bu);if(t===null)throw new Error("InputStateProvider required to use useInputState");return t},Eb=(t,e)=>{const{current:r}=D.useRef(t);if(r!==t)throw new Error(`Value should not change between renders:  ${r} => ${t}`)},qe=({handler:t,action:e,disabled:r=!1})=>{const s=D.useMemo(()=>Array.isArray(e)?e:[e],[e]),n=bo();D.useEffect(()=>{if(r)return;const i=()=>{for(const o of s)if(n.currentActionPress(o)==="tap"){t(o);break}};return nt.shared.add(i),()=>{nt.shared.remove(i)}},[s,r,n,t])},Rb=({handler:t,disabled:e=!1})=>{Eb(t);const r=bo();D.useEffect(()=>{if(e)return;const s=()=>{const n=r.inputTap();n!==void 0&&t(n,r)};return nt.shared.add(s),()=>{nt.shared.remove(s)}},[e,t,r])};function Z(t,e){const r=Vh();return D.useCallback(()=>{r(t(e))},[t,r,e])}const jb=()=>{const t=ce(r=>r.assigningInput!==void 0),e=ce(r=>r.openMenus.length>0);qe({action:"menu_openOrExit",handler:Z(Hl),disabled:t}),qe({action:"menu_exit",handler:Z(Hl),disabled:!e}),qe({action:"toggleShowFps",handler:Z(Bt,"userSettings.showFps"),disabled:e}),qe({action:"hold",handler:Z(Wl,"toggle"),disabled:t}),D.useEffect(()=>{const r=()=>{Te.dispatch(Wl("hold"))};return window.addEventListener("blur",r,!1),()=>{window.removeEventListener("blur",r,!1)}}),qe({action:"toggleColourisation",handler:Z(Bt,"userSettings.displaySettings.colourise"),disabled:t})},oi=()=>{const{userSettings:{displaySettings:{emulatedResolution:t}}}=Te.getState(),e=hu({x:window.innerWidth,y:window.innerHeight},t,window.devicePixelRatio);console.log(`changing upscale to ${JSON.stringify(e)}x for ${window.innerWidth}x${window.innerHeight} window`),Te.dispatch(Lx(e))},Bb=()=>{const t=Vh();D.useLayoutEffect(()=>{oi()},[]),D.useLayoutEffect(()=>(window.addEventListener("resize",oi),()=>window.removeEventListener("resize",oi)),[t])},zb=()=>(Bb(),jb(),null),_o="-",Fb=t=>{const e=Nb(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:s}=t;return{getClassGroupId:o=>{const a=o.split(_o);return a[0]===""&&a.length!==1&&a.shift(),_u(a,e)||Ob(o)},getConflictingClassGroupIds:(o,a)=>{const l=r[o]||[];return a&&s[o]?[...l,...s[o]]:l}}},_u=(t,e)=>{if(t.length===0)return e.classGroupId;const r=t[0],s=e.nextPart.get(r),n=s?_u(t.slice(1),s):void 0;if(n)return n;if(e.validators.length===0)return;const i=t.join(_o);return e.validators.find(({validator:o})=>o(i))?.classGroupId},Jl=/^\[(.+)\]$/,Ob=t=>{if(Jl.test(t)){const e=Jl.exec(t)[1],r=e?.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},Nb=t=>{const{theme:e,prefix:r}=t,s={nextPart:new Map,validators:[]};return Db(Object.entries(t.classGroups),r).forEach(([i,o])=>{zi(o,s,i,e)}),s},zi=(t,e,r,s)=>{t.forEach(n=>{if(typeof n=="string"){const i=n===""?e:ec(e,n);i.classGroupId=r;return}if(typeof n=="function"){if(Lb(n)){zi(n(s),e,r,s);return}e.validators.push({validator:n,classGroupId:r});return}Object.entries(n).forEach(([i,o])=>{zi(o,ec(e,i),r,s)})})},ec=(t,e)=>{let r=t;return e.split(_o).forEach(s=>{r.nextPart.has(s)||r.nextPart.set(s,{nextPart:new Map,validators:[]}),r=r.nextPart.get(s)}),r},Lb=t=>t.isThemeGetter,Db=(t,e)=>e?t.map(([r,s])=>{const n=s.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,a])=>[e+o,a])):i);return[r,n]}):t,Gb=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,s=new Map;const n=(i,o)=>{r.set(i,o),e++,e>t&&(e=0,s=r,r=new Map)};return{get(i){let o=r.get(i);if(o!==void 0)return o;if((o=s.get(i))!==void 0)return n(i,o),o},set(i,o){r.has(i)?r.set(i,o):n(i,o)}}},wu="!",Wb=t=>{const{separator:e,experimentalParseClassName:r}=t,s=e.length===1,n=e[0],i=e.length,o=a=>{const l=[];let c=0,h=0,u;for(let p=0;p<a.length;p++){let _=a[p];if(c===0){if(_===n&&(s||a.slice(p,p+i)===e)){l.push(a.slice(h,p)),h=p+i;continue}if(_==="/"){u=p;continue}}_==="["?c++:_==="]"&&c--}const f=l.length===0?a:a.substring(h),d=f.startsWith(wu),g=d?f.substring(1):f,y=u&&u>h?u-h:void 0;return{modifiers:l,hasImportantModifier:d,baseClassName:g,maybePostfixModifierPosition:y}};return r?a=>r({className:a,parseClassName:o}):o},Hb=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(s=>{s[0]==="["?(e.push(...r.sort(),s),r=[]):r.push(s)}),e.push(...r.sort()),e},$b=t=>({cache:Gb(t.cacheSize),parseClassName:Wb(t),...Fb(t)}),Ub=/\s+/,Vb=(t,e)=>{const{parseClassName:r,getClassGroupId:s,getConflictingClassGroupIds:n}=e,i=[],o=t.trim().split(Ub);let a="";for(let l=o.length-1;l>=0;l-=1){const c=o[l],{modifiers:h,hasImportantModifier:u,baseClassName:f,maybePostfixModifierPosition:d}=r(c);let g=!!d,y=s(g?f.substring(0,d):f);if(!y){if(!g){a=c+(a.length>0?" "+a:a);continue}if(y=s(f),!y){a=c+(a.length>0?" "+a:a);continue}g=!1}const p=Hb(h).join(":"),_=u?p+wu:p,b=_+y;if(i.includes(b))continue;i.push(b);const S=n(y,g);for(let P=0;P<S.length;++P){const E=S[P];i.push(_+E)}a=c+(a.length>0?" "+a:a)}return a};function qb(){let t=0,e,r,s="";for(;t<arguments.length;)(e=arguments[t++])&&(r=vu(e))&&(s&&(s+=" "),s+=r);return s}const vu=t=>{if(typeof t=="string")return t;let e,r="";for(let s=0;s<t.length;s++)t[s]&&(e=vu(t[s]))&&(r&&(r+=" "),r+=e);return r};function Yb(t,...e){let r,s,n,i=o;function o(l){const c=e.reduce((h,u)=>u(h),t());return r=$b(c),s=r.cache.get,n=r.cache.set,i=a,a(l)}function a(l){const c=s(l);if(c)return c;const h=Vb(l,r);return n(l,h),h}return function(){return i(qb.apply(null,arguments))}}const oe=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},Au=/^\[(?:([a-z-]+):)?(.+)\]$/i,Xb=/^\d+\/\d+$/,Kb=new Set(["px","full","screen"]),Zb=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Qb=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Jb=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,e_=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,t_=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,dt=t=>er(t)||Kb.has(t)||Xb.test(t),wt=t=>fr(t,"length",c_),er=t=>!!t&&!Number.isNaN(Number(t)),ai=t=>fr(t,"number",er),wr=t=>!!t&&Number.isInteger(Number(t)),r_=t=>t.endsWith("%")&&er(t.slice(0,-1)),Y=t=>Au.test(t),vt=t=>Zb.test(t),s_=new Set(["length","size","percentage"]),n_=t=>fr(t,s_,Su),i_=t=>fr(t,"position",Su),o_=new Set(["image","url"]),a_=t=>fr(t,o_,u_),l_=t=>fr(t,"",h_),vr=()=>!0,fr=(t,e,r)=>{const s=Au.exec(t);return s?s[1]?typeof e=="string"?s[1]===e:e.has(s[1]):r(s[2]):!1},c_=t=>Qb.test(t)&&!Jb.test(t),Su=()=>!1,h_=t=>e_.test(t),u_=t=>t_.test(t),d_=()=>{const t=oe("colors"),e=oe("spacing"),r=oe("blur"),s=oe("brightness"),n=oe("borderColor"),i=oe("borderRadius"),o=oe("borderSpacing"),a=oe("borderWidth"),l=oe("contrast"),c=oe("grayscale"),h=oe("hueRotate"),u=oe("invert"),f=oe("gap"),d=oe("gradientColorStops"),g=oe("gradientColorStopPositions"),y=oe("inset"),p=oe("margin"),_=oe("opacity"),b=oe("padding"),S=oe("saturate"),P=oe("scale"),E=oe("sepia"),M=oe("skew"),I=oe("space"),z=oe("translate"),F=()=>["auto","contain","none"],j=()=>["auto","hidden","clip","visible","scroll"],N=()=>["auto",Y,e],G=()=>[Y,e],X=()=>["",dt,wt],J=()=>["auto",er,Y],Se=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],x=()=>["solid","dashed","dotted","double","none"],A=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],C=()=>["start","end","center","between","around","evenly","stretch"],v=()=>["","0",Y],w=()=>["auto","avoid","all","avoid-page","page","left","right","column"],k=()=>[er,Y];return{cacheSize:500,separator:":",theme:{colors:[vr],spacing:[dt,wt],blur:["none","",vt,Y],brightness:k(),borderColor:[t],borderRadius:["none","","full",vt,Y],borderSpacing:G(),borderWidth:X(),contrast:k(),grayscale:v(),hueRotate:k(),invert:v(),gap:G(),gradientColorStops:[t],gradientColorStopPositions:[r_,wt],inset:N(),margin:N(),opacity:k(),padding:G(),saturate:k(),scale:k(),sepia:v(),skew:k(),space:G(),translate:G()},classGroups:{aspect:[{aspect:["auto","square","video",Y]}],container:["container"],columns:[{columns:[vt]}],"break-after":[{"break-after":w()}],"break-before":[{"break-before":w()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Se(),Y]}],overflow:[{overflow:j()}],"overflow-x":[{"overflow-x":j()}],"overflow-y":[{"overflow-y":j()}],overscroll:[{overscroll:F()}],"overscroll-x":[{"overscroll-x":F()}],"overscroll-y":[{"overscroll-y":F()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[y]}],"inset-x":[{"inset-x":[y]}],"inset-y":[{"inset-y":[y]}],start:[{start:[y]}],end:[{end:[y]}],top:[{top:[y]}],right:[{right:[y]}],bottom:[{bottom:[y]}],left:[{left:[y]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",wr,Y]}],basis:[{basis:N()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Y]}],grow:[{grow:v()}],shrink:[{shrink:v()}],order:[{order:["first","last","none",wr,Y]}],"grid-cols":[{"grid-cols":[vr]}],"col-start-end":[{col:["auto",{span:["full",wr,Y]},Y]}],"col-start":[{"col-start":J()}],"col-end":[{"col-end":J()}],"grid-rows":[{"grid-rows":[vr]}],"row-start-end":[{row:["auto",{span:[wr,Y]},Y]}],"row-start":[{"row-start":J()}],"row-end":[{"row-end":J()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Y]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Y]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...C()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...C(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...C(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[b]}],px:[{px:[b]}],py:[{py:[b]}],ps:[{ps:[b]}],pe:[{pe:[b]}],pt:[{pt:[b]}],pr:[{pr:[b]}],pb:[{pb:[b]}],pl:[{pl:[b]}],m:[{m:[p]}],mx:[{mx:[p]}],my:[{my:[p]}],ms:[{ms:[p]}],me:[{me:[p]}],mt:[{mt:[p]}],mr:[{mr:[p]}],mb:[{mb:[p]}],ml:[{ml:[p]}],"space-x":[{"space-x":[I]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[I]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Y,e]}],"min-w":[{"min-w":[Y,e,"min","max","fit"]}],"max-w":[{"max-w":[Y,e,"none","full","min","max","fit","prose",{screen:[vt]},vt]}],h:[{h:[Y,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Y,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Y,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Y,e,"auto","min","max","fit"]}],"font-size":[{text:["base",vt,wt]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ai]}],"font-family":[{font:[vr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Y]}],"line-clamp":[{"line-clamp":["none",er,ai]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",dt,Y]}],"list-image":[{"list-image":["none",Y]}],"list-style-type":[{list:["none","disc","decimal",Y]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[_]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[_]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...x(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",dt,wt]}],"underline-offset":[{"underline-offset":["auto",dt,Y]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:G()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Y]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Y]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[_]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Se(),i_]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",n_]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},a_]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[g]}],"gradient-via-pos":[{via:[g]}],"gradient-to-pos":[{to:[g]}],"gradient-from":[{from:[d]}],"gradient-via":[{via:[d]}],"gradient-to":[{to:[d]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[_]}],"border-style":[{border:[...x(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[_]}],"divide-style":[{divide:x()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...x()]}],"outline-offset":[{"outline-offset":[dt,Y]}],"outline-w":[{outline:[dt,wt]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:X()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[_]}],"ring-offset-w":[{"ring-offset":[dt,wt]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",vt,l_]}],"shadow-color":[{shadow:[vr]}],opacity:[{opacity:[_]}],"mix-blend":[{"mix-blend":[...A(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":A()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[s]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",vt,Y]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[h]}],invert:[{invert:[u]}],saturate:[{saturate:[S]}],sepia:[{sepia:[E]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[s]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[h]}],"backdrop-invert":[{"backdrop-invert":[u]}],"backdrop-opacity":[{"backdrop-opacity":[_]}],"backdrop-saturate":[{"backdrop-saturate":[S]}],"backdrop-sepia":[{"backdrop-sepia":[E]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Y]}],duration:[{duration:k()}],ease:[{ease:["linear","in","out","in-out",Y]}],delay:[{delay:k()}],animate:[{animate:["none","spin","ping","pulse","bounce",Y]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[P]}],"scale-x":[{"scale-x":[P]}],"scale-y":[{"scale-y":[P]}],rotate:[{rotate:[wr,Y]}],"translate-x":[{"translate-x":[z]}],"translate-y":[{"translate-y":[z]}],"skew-x":[{"skew-x":[M]}],"skew-y":[{"skew-y":[M]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Y]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Y]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":G()}],"scroll-mx":[{"scroll-mx":G()}],"scroll-my":[{"scroll-my":G()}],"scroll-ms":[{"scroll-ms":G()}],"scroll-me":[{"scroll-me":G()}],"scroll-mt":[{"scroll-mt":G()}],"scroll-mr":[{"scroll-mr":G()}],"scroll-mb":[{"scroll-mb":G()}],"scroll-ml":[{"scroll-ml":G()}],"scroll-p":[{"scroll-p":G()}],"scroll-px":[{"scroll-px":G()}],"scroll-py":[{"scroll-py":G()}],"scroll-ps":[{"scroll-ps":G()}],"scroll-pe":[{"scroll-pe":G()}],"scroll-pt":[{"scroll-pt":G()}],"scroll-pr":[{"scroll-pr":G()}],"scroll-pb":[{"scroll-pb":G()}],"scroll-pl":[{"scroll-pl":G()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Y]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[dt,wt,ai]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Ie=Yb(d_);var ku=uc();const Av=Ye(ku),Ke=({children:t,className:e,onClick:r})=>ku.createPortal(m.jsx(oo,{children:m.jsx("div",{className:Ie("p-1 w-zx fixed left-[50%] z-50 top-[50%] translate-y-[-50%] translate-x-[-50%] h-zx leading-none flex flex-col gap-y-1",e),onClick:r,children:t})}),document.body),bt=({className:t,onClick:e})=>m.jsx("div",{className:`fixed inset-0 ${t}`,onClick:e}),f_=`## BAG

![](texture-bag)The *bag* may be used to carry small objects around a room. It is essential for
Heels to find and get the bag as it is impossible to get far without it.

The object in the bag will be displayed immediately above the bags icon at the
bottom right of the screen. To pick up an object just stand on top of it and
press the *CARRY* key. 

![](texture-cube)![](texture-drum)![](texture-spring.compressed)![](texture-sticks)

It is not possible to drop an object in a doorway.

*> head over heels manual*

`,p_=`## BLACKTOOTH

![](texture-blacktooth.wall.armour.left?bg-pureBlack)![](texture-blacktooth.wall.shield.away?bg-pureBlack&float-right)This planet has a large moon with three lunar space stations on it, the larger
of these, *Moon Station HQ*, is the main teleport center for the empire, with a
direct teleport to all the slave planets.

Sometime after the Egyptus episode,
the latest Emperor sent out a craft to find that same strange planet, and after
much exploration, it was finally located, and the craft landed. However, the
crew found the people had changed: instead of pyramids they used castles,
instead of wrapping corpses up in cloth, they wrapped living men in metal and
then tried to turn them into corpses with sharp metal sticks.

![](texture-teleporter)The Emperor, not to be outdone by his ancestor, built a castle on Blacktooth and
used it as his headquarters. The castle is surrounded by a small market, and
then a range of impassable mountains. The only way to leave is via teleport to
one of the three lunar space stations.

*> head over heels manual*`,m_=`## BOOK WORLD

![](texture-bookworld.wall.cowboy.left?bg-pureBlack)![](texture-book.x?float-right&clear-right)![](texture-book.y?float-right&clear-right)The emperor is very keen
on *cowboy books* and has devoted an entire world to a *western library*.

Only the emperor's minions are permitted to read them.
Information is rigorously suppressed in the empire.

*> Head Over Heels Manual*
`,g_=`## CONVEYOR BELTS

![](texture-animated-heels.walking.right?z-topSprite&relative&ml-centreSmallBlockOnLarge&mr-2)![](texture-animated-conveyor.x?&relative&clear-left&bottom-bottomStackPullup)The rollers on the conveyor simply push you along it. If you wish to go the
opposite direction you have to jump along.

*> head over heels manual*
`,y_=`## CREDITS

Written by Jon Ritman and Bernie Drummond.  
Music and sound effect by Guy Stevens.  
Produced by D.C. Ward.  
1987 Ocean Software Limited.
`,x_=`## CROWNS

![](texture-crown.blacktooth)![](texture-crown.bookworld?float-right)![](texture-crown.egyptus?clear-left)![](texture-crown.penitentiary?float-right&clear-right)![](texture-crown.safari?clear-left)Find a crown and start a revolution. At the beginning of each game, a screen
showing all five planets with a crown above each will be displayed.

As each
crown is collected this screen will be shown again with the appropriate crowns
in a bright color.

*> head over heels manual*`,b_=`## CUDDLY STUFFED WHITE RABBITS

![](texture-bunny?float-right)The *cute toy bunnies* magically enhance your powers. The status display at the
bottom of the screen will keep you informed as to which powers are temporarily
enhanced.

If Head and Heels are connected when they pick up a *Life* or *Iron pill*,
they will both get the enhanced power.

There are four types:

1. ![](texture-hud.char.2?sprite-tinted&text-metallicBlue)**Two extra lives**
2. ![](texture-hud.shield?sprite-tinted&text-metallicBlue)**Iron Pills** (to make you invulnerable)
3. ![](texture-hud.bigJumps?sprite-tinted&text-metallicBlue)**Jump higher bunny** (only works on Heels)
4. ![](texture-hud.fastSteps?sprite-tinted&text-metallicBlue)**Go faster bunny** (only works on slow-moving Head)

*> Head Over Heels Manual*
`,__=`## DOUGHNUTS

![](texture-doughnuts)Trays of *six doughnuts* are few and far between, so dont waste shots. Only Head
may pick up doughnuts.

The number of remaining doughnuts will be displayed above
the doughnut icon at the bottom left of the screen.

*> Head Over Heels Manual*
`,w_=`## EGYPTUS

![](texture-egyptus.wall.sarcophagus.left)![](texture-egyptus.wall.sarcophagus.away?float-right)![](texture-egyptus.wall.hieroglyphics.left?clear-left)![](texture-egyptus.wall.hieroglyphics.away?float-right&clear-right)Once, a long time ago, a craft from Blacktooth got a bit lost while doing a
hyperspace jump and landed on an unknown planet.

Here the crew found a primitive
animal forming a sort of civilization that appeared to revolve around wrapping
corpses in lots of bandages and putting them into huge stone pyramids.

When they
returned to Blacktooth their emperor liked the sound of it so much that he
rebuilt the capital city of one of the slave planets to resemble the story.

*> Head Over Heels Manual*
`,v_=`## HEAD 
### (HEADUS MOUTHION)

![](texture-animated-head.walking.towards?float-right)This creature is a symbiotic partner to Heels and will normally be found sitting
on top of one.

![](texture-head.falling.right)Head is descended from a breed of flying reptile and still has
rudimentary wings that allow Head to jump up to twice his own height and to
guide himself through the air.

*> Head Over Heels Manual*
`,A_=`## HEELS 
### (FOOTUS UNDERIUM)

![](texture-animated-heels.walking.towards?float-right)During Heelss evolution, the arms have totally disappeared while the legs have
become very powerful.

Heels can jump his own height and can also run very fast.

*> Head Over Heels Manual*`,S_=`## HINTS AND TIPS

1. **1** *:* Beginners should aim to escape from Blacktooth and get back to Freedom initially. Only the very skillful can hope to liberate a planet or two.
2. **2** *:* ![](texture-animated-head.idle.towards?float-right&relative&z-topSprite)![](texture-heels.walking.towards.2&float-right&clear-right&relative&bottom-bottomStackPullup)When you first get Head and Heels in the same location, practice placing Head on top of Heels and joining them together accurately with the swop key. Both of their icons will light up when they are successfully joined.
3. **3** *:* Remember Head and Heels are a team. Just because both are in the same room does not mean you have to join them together, and in fact, some problems may only be solved by separating Head and Heels.
4. **4** *:* Make sure Head learns to climb ladders; this is an essential skill.
5. **5** *:* ![](texture-bag?float-right)![](texture-hooter?float-right)Both Heelss bag and Heads hooter must be collected at the initial stages for there to be any chance of completing the game.
6. **6** *:* If Head and Heels are in the same room, extra jumping height may be obtained by one jumping off the others back.
7. **7** *:* Find a safe spot and get used to how far Head and Heels may move over the edge of a brick before they fall. This will enable you to make the longest jumps. Both Head and Heels will jump slightly further if they are running as they jump.
8. **8** *:* Learn the difference in distance and control between Heads jumps and Heelss jumps.
9. **9** *:* Make a map.
10. **10** *:* ![](texture-doughnuts?float-right)Do not waste doughnuts; they are not easy to find.
11. **11** *:* Do not get confused; only Heels may carry anything, and only Head may fire.
12. **12** *:* ![](texture-spring.released?float-right&relative&z-topSprite)![](texture-cube?float-right&clear-right&relative&bottom-bottomStackPullup)To discover if there is a room above, pile objects as high as possible and jump from the top. If there is a spring in the room, put it on the top for extra jumping height.
13. **13** *:* If you cant understand a room, try exiting and entering again, watching carefully for any movement in the room as you enter.

*> Head Over Heels Manual*`,k_=`## HISTORY OF THE BLACKTOOTH EMPIRE

![](texture-crown.blacktooth)Far, far away from our star Sol lies the Blacktooth empire, an evil empire, four
worlds enslaved by the planet Blacktooth.

![](texture-animated-dalek?float-right)All of the slave worlds bubble with
unrest, but due to the oppressive nature of their rulers they never reach
boiling point, they all lack a leader to draw the masses of population together.

![](texture-animated-helicopterBug?float-right)Blacktooth itself is not any better, a world rigidly controlled by its dynastic
leaders for so long that the populace do not ever think about revolution.

![](texture-head.walking.right.2)The peoples of the neighbouring stars are getting very worried about signs of
military expansion from Blacktooth and have sent a spy from the planet Freedom
to see if he can push the slave planets into full rebellion by finding the
crowns lost when Blacktooth took over.

![](texture-heels.walking.right.2)The creatures of *Freedom* are very strange in that they are formed from a pair of
*symbiotic animals* that have adapted to operate either independently or, to their
mutual advantage, join together as one - Head saddled on Heels, and indeed these
ARE their names and both are highly trained spies.

*> head over heels manual*
`,C_=`## HOOTER

![](texture-hooter)The *hooter* may be used by Head to fire *doughnuts* at attacking monsters.

This will freeze them in place as they lick the doughnut off their faces.

![](texture-doughnuts?float-right&clear-both)The hooter may only be used by Head and requires a tray of doughnuts to be of any use.

*> Head Over Heels Manual*
`,P_=`## HUSH PUPPIES

![](texture-hushPuppy?float-right)These are a very strange type of beast; they are incredibly 
sleepy. In fact, they never wake up and it is quite normal for them to sleep for 
their entire lives.

They are often used as tables and even used as building bricks. 
They are a native of Freedom, ![](texture-head.walking.right.2?clear-both)and for many thousands of years Head and his ancestors 
have been mistaking them for Heels and causing so much trouble to the poor old hush
puppies that they evolved a defense mechanism they somehow learned to teleport
themselves away.

![](texture-animated-bubbles.white?float-right&clear-both)Nobody knows where they go, but
the instant they see any of Heads race, they disappear and wont return until they are sure the coast is
clear.

*> head over heels manual*
`,M_=`## PENITENTIARY
### The empire's prison planet

![](texture-penitentiary.wall.skeleton.left)Millions are imprisoned here. A harsh planet, very mountainous, much climbing,
skill required.

The worst place is The Pit, try not to fall into it!

*> Head Over Heels Manual*
`,T_=`## REINCARNATION FISH

![](texture-animated-fish)The strangest animal in the known universe! This fish likes to be eaten! There
have been cases of it jumping onto plates!

But there is more: when you eat one,
its prodigious memory remembers everything about you. Its memory is so good that
if you die at some later date, you will be reincarnated at the very place you
ate the fish, and you will even have its taste still in your mouth!

How a fish
can remember anything when it's been eaten has never been successfully
explained.

![](texture-fish.1)You must be very careful to check that the fish is
alive and wriggling as **dead fish decompose very quickly and it rapidly
turns so poisonous that a single lick can kill.**

### WARNING:

Even living reincarnation fish taste horrible!

*> head over heels manual*
`,I_=`## SAFARI

![](texture-monkey.right?float-left&relative&z-topSprite)![](texture-homingBot?float-left&clear-left&relative&bottom-bottomStackPullup)![](texture-elephant.towards?float-right&relative&z-topSprite)![](texture-homingBot?float-right&clear-right&relative&bottom-bottomStackPullup)A densely vegetated planet, mainly used for hunting.

The natives live in wooden forts in the jungle, **beware traps!**

*> Head Over Heels Manual*`,E_=`## SPRINGS

![](texture-spring.compressed)Jumping from a spring will give extra height to your jump.

*> head over heels manual*
`,R_=`## SWITCHES

![](texture-animated-switch)Simply push the switch to switch things off and on!  
**WARNING**: Switching a deadly monster off will stop him moving but he will
still be **deadly** to touch.

*> head over heels manual*
`,j_=`## SWOP KEY

If Head is sitting on Heels, the swop key will, on each push, give you control
of:

* *1* Heels.
* *2* Head + Heels.
* *3* Head.
* *4* Head + Heels.

If Head is not on Heels, the swop key will, on each push, give you control of:

* *1* Head.
* *2* Heels.

At all times, the character(s) whose icon is lit is under player control. When
Head and Heels are joined together, all their abilities are combined.

*> head over heels manual*`,B_=`## Exalted Emperor:

![](texture-teleporter)Sire, I took the liberty of installing this teleporter 
to aid your magnificent return to the moonbase after the daily crown inspections.

![](texture-cyberman.towards)Supplies are running short of teleporters, so I set it up one-way
until more come in.
May I humbly suggest you teleport after inspecting the crown or his grace
will have a long walk (well, ride on a minions back) to get back here.

Of course, those two spies we threw in jail might try to use it to grab the crown and escape.
Just kidding, theyll never get this far!

*> Your humble minion*
`,z_=`## TELEPORTS

![](texture-teleporter)Standing on a teleport will activate its mechanism, which will sound a warning
siren. Pressing the *jump key* will cause you to teleport.

Not all teleports are two-way; some are linked in a chain.

*> Head Over Heels Manual* `,F_=`## THE EMPERORS GUARDIAN

![](texture-ball?relative&z-topSprite)![](texture-animated-bubbles.cold?relative&clear-both&bottom-bottomStackPullup)The guardian blocks the door to the throne room in Blacktooth castle. He is **very
dangerous**, and he *doesn't like doughnuts*.

Only a true hero may pass the guardian.

*> head over heels manual*
`,O_=`## THE GAME

![](texture-heels.walking.right.2)![](texture-animated-head.idle.towards?float-right&clear-left)Head and Heels have been captured, separated and imprisoned in the castle
headquarters of Blacktooth. Their cells contain keep fit equipment, including
a wall ladder that Head really must learn to climb.

![](texture-market.wall.fruits.left?bg-pureBlack)![](texture-moonbase.wall.window2.away?bg-pureBlack&float-right)Your job is to get them both
out of the castle and into the *marketplace* so they can join up again. From
there, the journey leads to *Moonbase Headquarters*, where you will have to decide
either to try to escape back to *Freedom* or to be a true hero and teleport to one
of the slave planets to search for its lost crown!

![](texture-crown.bookworld)To overthrow the dictatorship on any of the slave planets would be a major blow
to Blacktooth and you could return to Freedom in glory. Of course, Blacktooth
would probably enslave them again eventually but it would slow down any
expansion plans for now.


![](texture-cyberman.towards?float-right&relative&z-topSprite)![](texture-animated-bubbles.cold?float-right&clear-right&relative&bottom-bottomStackPullup)The populace of Blacktooth are so heavily oppressed
that they would have to see all four of the slave planets revolt before the
Blacktooth crown could cause an uprising. ![](texture-animated-turtle.right)This of course would be the ultimate
accolade, and unfortunately, almost certain suicide.

*> Head Over Heels Manual*
`,ae=Object.assign({"./bag.md":f_,"./blacktooth.md":p_,"./bookWorld.md":m_,"./conveyorBelts.md":g_,"./credits.md":y_,"./crowns.md":x_,"./cuddlyStuffedWhiteRabbits.md":b_,"./doughnuts.md":__,"./egyptus.md":w_,"./head.md":v_,"./heels.md":A_,"./hintsAndTips.md":S_,"./historyOfTheBlacktoothEmpire.md":k_,"./hooter.md":C_,"./hushPuppies.md":P_,"./penitentiary.md":M_,"./reincarnationFish.md":T_,"./safari.md":I_,"./springs.md":E_,"./switches.md":R_,"./swopKey.md":j_,"./teleportBack.md":B_,"./teleports.md":z_,"./theEmperorsGuardian.md":F_,"./theGame.md":O_}),wo={historyOfTheBlacktoothEmpire:ae["./historyOfTheBlacktoothEmpire.md"],theGame:ae["./theGame.md"],egyptus:ae["./egyptus.md"],penitentiary:ae["./penitentiary.md"],safari:ae["./safari.md"],bookWorld:ae["./bookWorld.md"],blacktooth:ae["./blacktooth.md"],head:ae["./head.md"],heels:ae["./heels.md"],reincarnationFish:ae["./reincarnationFish.md"],cuddlyStuffedWhiteRabbits:ae["./cuddlyStuffedWhiteRabbits.md"],hooter:ae["./hooter.md"],doughnuts:ae["./doughnuts.md"],bag:ae["./bag.md"],crowns:ae["./crowns.md"],teleports:ae["./teleports.md"],springs:ae["./springs.md"],switches:ae["./switches.md"],conveyorBelts:ae["./conveyorBelts.md"],hushPuppies:ae["./hushPuppies.md"],theEmperorsGuardian:ae["./theEmperorsGuardian.md"],swopKey:ae["./swopKey.md"],hintsAndTips:ae["./hintsAndTips.md"],credits:ae["./credits.md"]},N_={...wo,teleportBack:ae["./teleportBack.md"]},L_=/^##\s+(.*)$/m,D_=t=>{const e=t.match(L_);if(e===null)return"no title found";const[,r]=e;return r};function Cu(t){var e,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(r=Cu(t[e]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function Pu(){for(var t,e,r=0,s="",n=arguments.length;r<n;r++)(t=arguments[r])&&(e=Cu(t))&&(s&&(s+=" "),s+=e);return s}function Sv(t){if(!Fi(t))throw new Error(`Invalid textureId: "${t}"`)}function Fi(t){return Wh.frames[t]!==void 0}const G_=({className:t,children:e})=>t?m.jsx("div",{className:`contents ${t}`,children:e}):e,qr=({className:t,tint:e})=>m.jsx("span",{className:Ie(`sprite  ${e?"sprite-tinted":""}`,t)}),H=({children:t,className:e,noSlitWords:r,classnameCycle:s})=>{const n=Array.isArray(t)?t.join(" "):t;if(n.length===0)return null;const i=r?[n.toUpperCase()]:n.toUpperCase().split(/\s+/);return m.jsx("span",{className:Pu(e),children:i.map((o,a)=>m.jsx("span",{className:Ie("text-nowrap",a===i.length-1?"":"me-1"),children:Array.from(o).map((l,c)=>{const h=`hud.char.${Gh(l)}`;return Fi(h)||console.error("no texture for char",l,l.charCodeAt(0),h,"we have:",Object.keys(Lt.textures)),m.jsx(qr,{className:`${Fi(h)?`texture-${h}`:"texture-hud.char.?"} ${s===void 0?"":s[c%s.length]}`,tint:!0},c)})},a))})},W_=t=>t.props.children!==void 0,De=({children:t,className:e})=>m.jsx(G_,{className:e,children:Array.isArray(t)?t.map((r,s)=>m.jsx(De,{children:r},s)):typeof t=="number"?m.jsx(H,{children:String(t)}):typeof t=="string"?m.jsx(H,{children:t}):D.isValidElement(t)?t.type===H||t.type===De?t:W_(t)?D.cloneElement(t,void 0,typeof t.props.children=="string"?m.jsx(H,{children:`${t.props.children}`}):m.jsx(De,{children:t.props.children})):t:t}),H_=({flip:t=!1,focussed:e=!1})=>m.jsx(H,{className:`inline-block col-start-1 ${t?"scale-[-1] relative bottom-oneScaledPix":""}`,children:e?"":""});var $e={},Ar={},Sr={},tc;function Us(){if(tc)return Sr;tc=1;var t=Sr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Sr,"__esModule",{value:!0});const r=t(or()).default.createContext({refs:{},renderItems:{},register:()=>{},unregister:()=>{}});return Sr.default=r,Sr}var rc;function $_(){if(rc)return Ar;rc=1;var t=Ar.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ar,"__esModule",{value:!0});const e=t(or()),r=t(uc()),s=t(Us()),n=({id:i,children:o})=>{const{refs:a,renderItems:l}=e.default.useContext(s.default),c=a[i],h=l[i];return c?h?r.default.createPortal(h(o),c,i):r.default.createPortal(o,c,i):null};return Ar.default=n,Ar}var kr={},sc;function U_(){if(sc)return kr;sc=1;var t=kr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(kr,"__esModule",{value:!0});const e=t(or()),r=t(Us()),s=({id:n,renderItem:i=a=>a,className:o})=>{const{register:a,unregister:l}=e.default.useContext(r.default),c=e.default.useRef(null);return e.default.useEffect(()=>(c.current&&a(n,c.current,i),()=>l(n)),[n,c.current]),e.default.createElement("div",{className:[`portal-placeholder-${n}`,o].filter(h=>!!h).join(" "),ref:c})};return kr.default=s,kr}var qt={},nc;function V_(){if(nc)return qt;nc=1;var t=qt.__rest||function(i,o){var a={};for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&o.indexOf(l)<0&&(a[l]=i[l]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,l=Object.getOwnPropertySymbols(i);c<l.length;c++)o.indexOf(l[c])<0&&Object.prototype.propertyIsEnumerable.call(i,l[c])&&(a[l[c]]=i[l[c]]);return a},e=qt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(qt,"__esModule",{value:!0});const r=e(or()),s=e(Us()),n=({children:i})=>{const[o,a]=r.default.useState({}),[l,c]=r.default.useState({}),h=r.default.useCallback((d,g,y)=>{a(p=>Object.assign(Object.assign({},p),{[d]:g})),c(p=>Object.assign(Object.assign({},p),{[d]:y}))},[]),u=r.default.useCallback(d=>{a(g=>{const y=g,p=d;return y[p],t(y,[typeof p=="symbol"?p:p+""])}),c(g=>{const y=g,p=d;return y[p],t(y,[typeof p=="symbol"?p:p+""])})},[]),f=r.default.useMemo(()=>({refs:o,renderItems:l,register:h,unregister:u}),[o,l,h,u]);return r.default.createElement(s.default.Provider,{value:f},i)};return qt.default=n,qt}var ic;function q_(){if(ic)return $e;ic=1;var t=$e.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty($e,"__esModule",{value:!0}),$e.Context=$e.Placeholder=$e.Provider=void 0;const e=t($_()),r=t(U_()),s=t(V_()),n=t(Us());$e.Provider=s.default,$e.Placeholder=r.default,$e.Context=n.default;const i=e.default;return i.Context=n.default,i.Placeholder=r.default,i.Provider=s.default,$e.default=i,$e}var Y_=q_();const es=Ye(Y_),gt="leading-none [&_[class*='texture-hud.char']]:mb-oneScaledPix",X_=["menu_select","jump"],Yr="data-menuitem_id",Mu="data-menuitem_hidden",K_=()=>{},ne=({id:t,label:e,valueElement:r,flipLeader:s=!1,doubleHeightWhenFocussed:n,onSelect:i=K_,hidden:o=!1,className:a,hint:l})=>{const c=ce(u=>u.openMenus[0].scrollableSelection),h=ce(u=>u.openMenus[0].focussedItemId===t);return qe({action:X_,handler:i,disabled:!h||o}),m.jsxs("div",{[Yr]:t,[Mu]:o,tabIndex:0,className:Ie("contents",o?"hidden":"",n&&h?"sprites-double-height":"",h?"selectedMenuItem":"",a),onMouseMove:Z(uo,{focussedItemId:t,scrollableSelection:!1}),onClick:i,children:[m.jsx(H_,{flip:s,focussed:h}),m.jsx("div",{ref:h&&c?u=>u?.scrollIntoView({behavior:"instant",block:"center"}):void 0,className:Ie(r===void 0?"col-span-2":""),children:typeof e=="string"?m.jsx(m.Fragment,{children:m.jsx(H,{children:e})}):e}),r!==void 0&&r,!h||l===void 0?null:m.jsx(es,{children:typeof l=="string"?m.jsx(H,{className:gt,children:l}):l})]})},Ht=()=>m.jsx(ne,{id:"back",label:"Back",flipLeader:!0,doubleHeightWhenFocussed:!0,onSelect:Z(xt)}),Vs=()=>m.jsx("div",{className:"col-span-3 h-1"}),Tu=t=>{const e=t.querySelectorAll(`[${Yr}]`);return Array.from(e)},oc=(t,e)=>{const r=Te.getState().openMenus[0].focussedItemId;if(r===void 0)return;const s=Tu(t);if(s.length===0)return;const n=s.findIndex(o=>o.getAttribute(Yr)===r);if(n===-1)return;let i=n;do i=(i+e+s.length)%s.length;while(s[i].getAttribute(Mu)==="true");Te.dispatch(uo({focussedItemId:s[i].getAttribute(Yr),scrollableSelection:!0}))},Z_=t=>{const e=Qh();qe({action:"away",handler:D.useCallback(()=>{t.current!==null&&oc(t.current,-1)},[t]),disabled:e}),qe({action:"towards",handler:D.useCallback(()=>{t.current!==null&&oc(t.current,1)},[t]),disabled:e})},_t=({className:t="",children:e})=>{const r=D.useRef(null);return D.useEffect(()=>{if(r.current===null||Te.getState().openMenus[0].focussedItemId!==void 0)return;const s=Tu(r.current);Te.dispatch(uo({focussedItemId:s[0].getAttribute(Yr),scrollableSelection:!0}))},[]),Z_(r),m.jsx("div",{ref:r,className:Ie("grid grid-cols-menuItems gap-x-1 gap-y-oneScaledPix",t),children:e})},Q_=({pageName:t})=>{const e=wo[t],r=D_(e);return m.jsx(ne,{id:`markdown/${t}`,label:r,onSelect:Z(Zt,`markdown/${t}`),doubleHeightWhenFocussed:!0})},J_=()=>m.jsxs(m.Fragment,{children:[m.jsx(bt,{className:"bg-midGrey zx:bg-zxCyan",onClick:Z(xt)}),m.jsxs(Ke,{className:"bg-highlightBeige zx:bg-zxCyanDimmed",children:[m.jsx(H,{className:"ml-3 text-moss zx:text-zxBlack sprites-double-height",children:"Read the manual"}),m.jsxs(_t,{className:`text-redShadow zx:text-zxWhite ${gt} !gap-y-0 selectedMenuItem:text-shadow zx:selectedMenuItem:text-zxBlack overflow-y-scroll scrollbar scrollbar-w-1 scrollbar-thumb-moss scrollbar-track-highlightBeige zx:scrollbar-thumb-zxBlack zx:scrollbar-track-zxCyanDimmed`,children:[[...nr(Dh(wo)).map(t=>m.jsx(Q_,{pageName:t},t))],m.jsx(Vs,{}),m.jsx(Ht,{})]})]})]}),ew={"":D.Fragment,pre:"pre",code:"code",ol:"ol",ul:"ul",hr:"hr",blockquote:"blockquote",li:"li",a:"a",img:"img",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",p:"p",em:"em",strong:"strong"},ac=t=>t.replace(RegExp("^"+(t.match(/^(\t| )+/)||"")[0],"gm"),""),tw=t=>t&&typeof t!="string"&&["div","ul","ol","pre","h1","h2","h3","h4","h5","h6"].includes(t.t),li=t=>t.replace(/^\s+|\s+$/g," "),xe=(t,e=[],r={})=>({t,c:Array.isArray(e)?e:[e],p:r}),zr=(t,e=!1)=>{let r=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,s=0;const n=xe("");let i,o;e?(i=xe("p"),o=[n,i],n.c.push(i)):(i=n,o=[n]);let a;const l=(u,f=!0)=>(f&&o.push(u),i.c.push(u),f&&(i=u),u),c=u=>{const f=o.findIndex(d=>d.t===u);o=o.slice(0,f),i=o.at(-1)};for(;a=r.exec(t);){const u=t.substring(s,a.index);if(s=r.lastIndex,u!=="")if(i===n&&e){const f=xe("p",li(u));n.c.push(f),o=[n,f],i=f}else i.c.push(li(u));if(!u.match(/[^\\](\\\\)*\\$/)){if(a[3]||a[4]){const f=xe("pre",a[4]?ac(a[4]):xe("code",ac(a[3]),a[2]?{language:`language-${a[2].toLowerCase()}`}:{}));n.c.push(f),o=[n],i=n}else if(a[6]){const f=a[6],d=f!==">",g=!!f.match(/\./),y=d?g?"ol":"ul":"blockquote",p=a[5].split(`
`).map(b=>b.replace(/^(\*|-|\+|>|\d+\.)\s+/,"")),_=xe(y,d?p.map(b=>xe("li",zr(b).c)):zr(p.join(`
`)).c);n.c.push(_),o=[n,_],i=n}else if(a[8]){const f=xe("img",[],{src:a[8],...a[7]?{alt:a[7]}:{}});if(e&&i===n){const d=xe("p",f);n.c.push(d),i=d,o=[n,d]}else l(f,!1)}else if(a[10]){const f=o.find(d=>d.t==="a");f&&(f.p.href=a[11])}else if(a[9])l(xe("a"));else if(a[14]){const f="h"+a[14].length;n.c.push(xe(f,zr(a[15]).c)),o=[n],i=n}else if(a[13])n.c.push(xe("h1",zr(a[12]).c)),o=[n],i=n;else if(a[16])l(xe("code",a[16]),!1);else if(a[17]?.[0]===`
`||a[17]===`  
`){if(!(o[1]?.t==="p")){const g=n.c;let y;for(y=g.length-1;y>=0&&!tw(g[y]);y--);if(y!==n.c.length-1){const p=n.c.splice(y+1);n.c.push(xe("p",p))}}const d=xe("p");n.c.push(d),o=[n,d],i=d}else if(a[1])l(xe("hr"),!1);else if(a[17]){const f=a[17].length===2?"strong":"em";o.findIndex(g=>g.t===f)===-1?l(xe(f)):c(f)}}}const h=li(t.substring(s));if(h.length){const u=n.c.at(-1);let f;u?.t==="p"?f=u:e?(f=xe("p"),n.c.push(f)):f=n,f.c.push(h)}return n.c=n.c.filter(u=>typeof u=="string"||u.t!=="p"||u.c?.length>0),n},rw=(t,e={})=>{const r={...ew,...e},s=(n,i=0)=>{const o=n.t===""?D.Fragment:r[n.t];return D.createElement(o,{...n.p,key:i},n.c.length===0?void 0:n.c.map((a,l)=>typeof a=="string"?a:s(a,l)))};return s(zr(t,!0))},sw=({markdown:t,customComponents:e})=>rw(t,e),nw={h2:function({children:e}){return m.jsx("h2",{className:"mb-1 sprites-double-height text-metallicBlue zx:text-zxBlue",children:m.jsx(De,{children:e})})},h3:function({children:e}){return m.jsx("h3",{className:"mt-1 mb-1 text-metallicBlue zx:text-zxBlue",children:m.jsx(De,{children:e})})},p:function({children:e}){return m.jsx("div",{className:`mb-1 ${gt}`,children:m.jsx(De,{children:e})})},li:function({children:e}){return m.jsx("div",{className:`mb-1 clear-left ${gt}`,children:m.jsx(De,{children:e})})},strong:function({children:e}){return m.jsx(De,{className:"strong text-midRed zx:text-zxRed",children:e})},em:function({children:e}){return m.jsx(De,{className:"em text-moss zx:text-zxBlue",children:e})},img:function({src:e}){const r=no();if(e===void 0)throw new Error("image without src");const s=e.split(/\?|&/);return m.jsx("span",{style:{"--scale":r*2},children:m.jsx(qr,{className:Ie("float-left mr-1 mb-1 zx:sprite-revert-to-two-tone",s.join(" "))})})}},zt=({markdown:t,className:e})=>m.jsx("div",{className:`contents ${e}`,children:m.jsx(sw,{customComponents:nw,markdown:t})}),iw=4,lc=Nt.h,ow=({pageName:t})=>{const e=D.useRef(null),r=no(),s=N_[t],n=D.useCallback(i=>{if(e.current===null)return;const{scrollTop:o}=e.current,a=o+r*iw*(i==="down"?lc:-lc);e.current.scrollTo({top:a,behavior:"instant"})},[r]);return qe({handler:D.useCallback(()=>{n("down")},[n]),action:"towards"}),qe({handler:D.useCallback(()=>{n("up")},[n]),action:"away"}),m.jsxs(m.Fragment,{children:[m.jsx(bt,{className:"bg-midGrey zx:bg-zxWhiteDimmed",onClick:Z(xt)}),m.jsxs(Ke,{className:"bg-highlightBeige zx:bg-zxCyan text-shadow zx:text-zxBlack",children:[m.jsx("div",{className:Ie("overflow-y-scroll scrollbar  scrollbar-w-1 scrollbar-thumb-midRed scrollbar-track-highlightBeige zx:scrollbar-thumb-zxCyanDimmed zx:scrollbar-track-zxCyan"),ref:e,children:m.jsx(zt,{markdown:s})}),m.jsx(_t,{className:"hidden",children:m.jsx(Ht,{})})]})]})},cc={egyptus:["text-lightBeige zx:text-zxYellowDimmed","text-midRed zx:text-zxRed","text-highlightBeige zx:text-zxYellow"],blacktooth:["text-midGrey zx:text-zxWhiteDimmed","text-lightGrey zx:text-zxWhite","text-moss zx:text-zxGreenDimmed","text-midRed zx:text-zxRed"],safari:["text-moss zx:text-zxGreen","text-midRed zx:text-zxRed","text-highlightBeige zx:text-zxYellowDimmed"],bookworld:["text-midRed zx:text-zxRed","text-redShadow zx:text-zxRedDimmed","text-midGrey zx:text-zxWhiteDimmed"],penitentiary:["text-shadow zx:text-zxWhiteDimmed","text-metallicBlue zx:text-zxBlue","text-midGrey zx:text-zxMagentaDimmed"]},aw={egyptus:"texture-crown.egyptus",blacktooth:"texture-crown.blacktooth",bookworld:"texture-crown.bookworld",penitentiary:"texture-crown.penitentiary",safari:"texture-crown.safari"},Cr=({planet:t,className:e,label:r=t})=>{const s=ce(n=>n.planetsLiberated[t]);return m.jsxs("div",{className:`flex flex-col ${e}`,children:[m.jsx(qr,{className:`block ${s?aw[t]:"texture-crown.dark"} mx-auto`}),m.jsx(qr,{className:`block texture-ball mx-auto ${cc[t][0]}`}),m.jsx(H,{classnameCycle:cc[t],className:"block mx-auto",children:r})]})},lw=()=>m.jsxs(m.Fragment,{children:[m.jsx(H,{className:"block sprites-double-height text-highlightBeige zx:text-zxYellow ml-6",children:"The blacktooth empire"}),m.jsx(Cr,{planet:"egyptus",className:"w-12 absolute left-[calc(var(--block,8px)*0)] top-[calc(var(--block,8px)*3)]"}),m.jsx(Cr,{planet:"penitentiary",className:"w-12 absolute left-[calc(var(--block,8px)*20)] top-[calc(var(--block,8px)*3)]"}),m.jsx(Cr,{planet:"safari",className:"w-12 absolute left-[calc(var(--block,8px)*0)] top-[calc(var(--block,8px)*17)]"}),m.jsx(Cr,{planet:"bookworld",label:"book world",className:"w-12 absolute left-[calc(var(--block,8px)*20)] top-[calc(var(--block,8px)*17)]"}),m.jsx(Cr,{planet:"blacktooth",className:"w-12 absolute left-[calc(var(--block,8px)*10)] top-[calc(var(--block,8px)*10)]"})]}),cw=()=>m.jsxs(m.Fragment,{children:[m.jsx(bt,{className:"bg-pureBlack zx:bg-zxBlack"}),m.jsxs(Ke,{className:"bg-pureBlack w-zx h-full block p-0",onClick:Z(xt),children:[m.jsx(lw,{}),m.jsx(_t,{className:"hidden",children:m.jsx(Ht,{})})]})]}),ft=["text-pink zx:text-zxCyan","text-highlightBeige zx:text-zxYellow","text-moss zx:text-zxWhite"],hw=()=>m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"flex justify-center gap-2 leading-none",children:[m.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center",children:[m.jsx(H,{className:"text-metallicBlue zx:text-zxBlack",children:"1987 original"}),m.jsxs("div",{className:"flex gap-1",children:[m.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center",children:[m.jsx(H,{classnameCycle:ft,children:"Jon"}),m.jsx(H,{classnameCycle:ft,children:"Ritman"})]}),m.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center",children:[m.jsx(H,{classnameCycle:ft,children:"Bernie"}),m.jsx(H,{classnameCycle:ft,children:"Drummand"})]})]})]}),m.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center",children:[m.jsx(H,{className:"text-pink zx:text-zxBlack",children:"2025 remake"}),m.jsx("div",{className:"flex",children:m.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center",children:[m.jsx(H,{classnameCycle:ft,children:"Jim"}),m.jsx(H,{classnameCycle:ft,children:"Higson"})]})})]})]}),m.jsxs("div",{className:"absolute bottom-1",children:[m.jsx(H,{className:"text-metallicBlue zx:text-zxBlack",children:"https://"}),m.jsx(H,{className:"text-pink zx:text-zxCyan",children:"block"}),m.jsx(H,{className:"text-highlightBeige zx:text-zxYellow",children:"stack"}),m.jsx(H,{className:"text-metallicBlue zx:text-zxBlack",children:"."}),m.jsx(H,{className:"text-moss zx:text-zxWhite",children:"ing"})]})]}),vo=()=>m.jsxs("div",{className:"flex  ml-3",children:[m.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center me-1",children:[m.jsx(H,{className:"sprites-double-height text-metallicBlue zx:text-zxYellow",children:"Head"}),m.jsxs("div",{className:"mt-1 relative",children:[m.jsx("span",{className:"sprite zx:sprite-revert-to-white texture-animated-head.idle.right hover:texture-animated-head.walking.right relative z-topSprite"}),m.jsx("span",{className:"sprite zx:hidden texture-shadow.smallRound absolute left-0 top-[calc(var(--scale)*1px)] opacity-halfBrite"})]})]}),m.jsx(H,{classnameCycle:ft,className:"mt-1 me-1",children:"over"}),m.jsxs("div",{className:"flex flex-col items-center me-1",children:[m.jsx(H,{className:"sprites-double-height text-pink zx:text-zxYellow",children:"Heels"}),m.jsxs("div",{className:"mt-1 relative",children:[m.jsx("span",{className:"sprite zx:sprite-revert-to-white texture-heels.walking.towards.2 hover:texture-animated-heels.walking.towards relative z-topSprite"}),m.jsx("span",{className:"sprite zx:hidden texture-shadow.smallRound absolute left-0 top-[calc(var(--scale)*1px)] opacity-halfBrite"})]})]}),m.jsx(H,{classnameCycle:ft,className:"mt-1",children:"online"})]}),uw=()=>{const t=io();return m.jsx(H,{children:t?"Resume the game":"Play the game"})},dw=t=>{const e=io();return m.jsxs(m.Fragment,{children:[m.jsx(bt,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed"}),m.jsxs(Ke,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed gap-y-2",children:[m.jsx(vo,{}),m.jsxs(_t,{className:"text-highlightBeige zx:text-zxCyan selectedMenuItem:text-white",children:[m.jsx(ne,{id:"playGame",label:m.jsx(uw,{}),doubleHeightWhenFocussed:!0,onSelect:Z(Fx)}),m.jsx(ne,{id:"quitGame",label:"Quit this game",onSelect:Z(Zt,"quitGameConfirm"),doubleHeightWhenFocussed:!0,hidden:!e}),m.jsx(ne,{id:"selectKeys",label:"Select the keys",doubleHeightWhenFocussed:!0,onSelect:Z(Zt,"selectKeys")}),m.jsx(ne,{id:"modernisationOptions",label:"Modernisation Options",doubleHeightWhenFocussed:!0,onSelect:Z(Zt,"modernisationOptions")}),m.jsx(ne,{id:"readTheManual",label:"Read the manual",doubleHeightWhenFocussed:!0,onSelect:Z(Zt,"readTheManual")})]}),m.jsx(hw,{})]})]})},Ao=({className:t})=>m.jsx("div",{className:Ie("contents",t),children:m.jsx(es.Placeholder,{})}),fw=()=>m.jsxs(m.Fragment,{children:[m.jsx(bt,{className:"bg-shadow zx:bg-zxYellow"}),m.jsx(Ke,{className:"bg-white zx:bg-zxRed",children:m.jsxs(es.Provider,{children:[m.jsx(vo,{}),m.jsx(H,{className:"ml-3 sprites-double-height",classnameCycle:["text-redShadow zx:text-zxWhite","text-midRed zx:text-zxYellow"],children:"Quit the game?"}),m.jsxs(_t,{className:"text-lightGrey zx:text-zxWhite selectedMenuItem:text-midRed zx:selectedMenuItem:text-zxYellow",children:[m.jsx(Vs,{}),m.jsx(ne,{doubleHeightWhenFocussed:!0,id:"no",label:"No",onSelect:Z(xt),hint:"Go back to the game"}),m.jsx(ne,{doubleHeightWhenFocussed:!0,id:"yes",label:"Yes",onSelect:Z(zx),hint:m.jsx(zt,{className:"zx:[&_.strong]:text-zxYellow",markdown:"**Warning!** This game will end!"})})]}),m.jsx(Ao,{className:"text-shadow zx:text-zxWhite"})]})})]}),pw=()=>{const t=ce(r=>bl(nr(gl(r.planetsLiberated)).filter(Boolean))),e=ce(r=>bl(nr(gl(r.roomsExplored))));return m.jsxs(m.Fragment,{children:[m.jsx(bt,{className:"bg-redShadow zx:bg-zxCyan"}),m.jsxs(Ke,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed w-zx h-full block",onClick:Z(xt),children:[m.jsx(vo,{}),m.jsx(H,{classnameCycle:ft,className:"mt-2 block text-center mx-auto sprites-double-height",children:"Dummy"}),m.jsx(H,{className:"mt-4 block text-center mx-auto text-highlightBeige zx:text-zxYellow",children:"Score -"}),m.jsxs(H,{className:"mt-2 block text-center mx-auto text-pink zx:text-zxCyan",children:["Explored ",String(e)," rooms"]}),m.jsxs(H,{className:"mt-2 block text-center mx-auto text-lightGrey zx:text-zxWhite",children:["Liberated ",String(t)," planets"]}),m.jsx(_t,{className:"hidden",children:m.jsx(Ht,{})})]})]})},mw=[],Iu=new Set;Iu.add=()=>{throw new Error("emptySet.add")};Iu.clear=()=>{throw new Error("emptySet.clear")};const kv=Object.freeze({}),Ft="text-moss zx:text-zxGreen selectedMenuItem:text-mossHalfbrite zx:selectedMenuItem:text-zxGreen",gw=t=>{const e=/(Numpad|F)(.*)/.exec(t);if(e!==null)return m.jsxs(m.Fragment,{children:[m.jsx("span",{className:Ft,children:e[1]}),e[2]]});switch(t){case" ":return"space";case"ArrowDown":return m.jsxs(m.Fragment,{children:[m.jsx("span",{className:Ft,children:"Cursor"}),""]});case"ArrowUp":return m.jsxs(m.Fragment,{children:[m.jsx("span",{className:Ft,children:"Cursor"}),""]});case"ArrowLeft":return m.jsxs(m.Fragment,{children:[m.jsx("span",{className:Ft,children:"Cursor"}),""]});case"ArrowRight":return m.jsxs(m.Fragment,{children:[m.jsx("span",{className:Ft,children:"Cursor"}),""]});default:return t}},yw=t=>t===0?"":t===1?"":`axis${t}`,xw=t=>{switch(Tl[t]){case"dPadDown":return"d-Pad";case"dPadUp":return"d-Pad";case"dPadLeft":return"d-Pad";case"dPadRight":return"d-Pad"}return Tl[t]??t},So=({action:t,keyClassName:e,className:r,flashingCursor:s=!1})=>{const n=ce(o=>o.assigningInput?.action===t?o.assigningInput?.presses:o.userSettings.inputAssignment.presses[t]),i=ce(o=>{const a=qh(t);return a===void 0?mw:o.assigningInput?.action===t?o.assigningInput.axes:o.userSettings.inputAssignment.axes[a.axis]});return m.jsxs("div",{className:r,children:[n.keys.map(o=>m.jsx("span",{className:Ie("text-nowrap",e),children:m.jsx(De,{children:gw(o)})},`key:${o}`)),i.map(o=>m.jsx("span",{className:Ie("text-nowrap",e),children:m.jsxs(De,{children:[m.jsx("span",{className:Ft,children:""}),yw(o)]})},`gamePadAxis:${o}`)),n.gamepadButtons.map(o=>m.jsx("span",{className:Ie("text-nowrap",e),children:m.jsxs(De,{children:[m.jsx("span",{className:Ft,children:""}),xw(o)]})},`gamePadButton:${o}`)),s&&m.jsx(qr,{className:"texture-hud.char.space bg-[currentColor] animate-flash"})]})},bw=({action:t,className:e,keyClassName:r="text-pink zx:text-zxRed"})=>m.jsxs("div",{className:`${e} bg-zxBlack py-oneScaledPix`,children:[m.jsx(H,{className:"me-1",children:"Press"}),m.jsx(H,{className:Ie("me-1",r),children:t}),m.jsx(H,{children:"to continue"}),m.jsxs("div",{className:"flex flex-row gap-1 w-min mx-auto",children:[m.jsx(H,{children:"("}),m.jsx(So,{className:"flex flex-row gap-1",keyClassName:r,action:"hold"}),m.jsx(H,{children:")"})]})]}),_w=()=>m.jsxs(Ke,{className:"!h-min !w-max text-center text-zxBlue p-0",children:[m.jsx(H,{className:"block sprites-double-height bg-zxBlack py-oneScaledPix",children:"hold"}),m.jsx("span",{className:"zx",children:m.jsx(bw,{className:gt,action:"hold"})})]}),Pr="[&_.em]:text-lightBeige zx:[&_.em]:text-zxCyan",ww=`**off**: Original *two-tone* spectrum-like graphics

**on**: *16-colour* palette with colourised sprites`,vw=`cant be changed mid-game

**off**: *8* lives to start; extra life rabbits spread thinly through the game

*A true hero leaves this off*`,Aw=`**off**: *faithful* to the original rooms

**on**: *extra items* slightly modernisess the gameplay.
none of these fundamentally change how the rooms play.`,Sw=`**off**: original *4* walk directions: press: *   * for: *   *

**on**: walk in *any* direction; makes the game easier`,kw=`*zx spectrum* (**256**x**192**)

*Amiga*/*c64*/*Atari-ST* PAL (**320**x**256**)`,Yt=({className:t,value:e})=>m.jsx("div",{children:m.jsx(H,{className:Pu("inline-block",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed",t),noSlitWords:!0,children:e?"  ON":"OFF "})}),Cw=()=>m.jsxs(m.Fragment,{children:[m.jsx(bt,{className:"bg-moss zx:bg-zxGreenDimmed",onClick:Z(xt)}),m.jsx(Ke,{className:"bg-pinkHalfbrite zx:bg-zxBlue",children:m.jsxs(es.Provider,{children:[m.jsx(H,{className:"ml-3 text-moss zx:text-zxGreen sprites-double-height",children:"Modernisation options"}),m.jsxs(_t,{className:"text-lightGrey zx:text-zxWhite selectedMenuItem:text-white zx:selectedMenuItem:text-zxGreen",children:[m.jsx(ne,{doubleHeightWhenFocussed:!0,id:"colourise",label:"Colourise",valueElement:m.jsx(Yt,{value:ce(t=>t.userSettings.displaySettings.colourise)}),onSelect:Z(Bt,"userSettings.displaySettings.colourise"),hint:m.jsx(zt,{className:Pr,markdown:ww})}),m.jsx(ne,{doubleHeightWhenFocussed:!0,id:"livesModel",label:"Infinite Lives poke",hint:m.jsx(zt,{className:Pr,markdown:vw}),valueElement:m.jsx(Yt,{value:ce(t=>t.userSettings.infiniteLivesPoke)}),onSelect:Z(Bt,"userSettings.infiniteLivesPoke")}),m.jsx(ne,{doubleHeightWhenFocussed:!0,id:"extraItems",label:"Extra items",valueElement:m.jsx(Yt,{value:!0}),hint:m.jsx(zt,{className:Pr,markdown:Aw})}),m.jsx(ne,{doubleHeightWhenFocussed:!0,id:"showFps",label:"Show FPS",valueElement:m.jsx(Yt,{value:ce(Vy)}),onSelect:Z(Bt,"userSettings.showFps"),hint:"show frame rate (frames per second) in the top-left corner"}),m.jsx(ne,{doubleHeightWhenFocussed:!0,id:"analogueControl",label:"Analogue control",valueElement:m.jsx(Yt,{value:ce(t=>t.userSettings.analogueControl)}),onSelect:Z(Bt,"userSettings.analogueControl"),hint:m.jsx(zt,{className:Pr,markdown:Sw})}),m.jsx(ne,{doubleHeightWhenFocussed:!0,id:"crtFilter",label:"CRT TV effect",valueElement:m.jsx(Yt,{value:ce(t=>t.userSettings.displaySettings.crtFilter)}),onSelect:Z(Bt,"userSettings.displaySettings.crtFilter"),hint:"Subtle screen glow a bit like an old tv"}),m.jsx(ne,{doubleHeightWhenFocussed:!0,id:"emulatedResolution",label:"Emulated resolution",valueElement:m.jsx(H,{className:"mr-1",children:"specy"}),hint:m.jsx(zt,{className:Pr,markdown:kw})}),m.jsx(Vs,{}),m.jsx(Ht,{})]}),m.jsx(Ao,{className:"text-moss zx:text-zxGreen"})]})})]}),et=({className:t,action:e})=>{const r=ce(s=>s.assigningInput?.action===e);return m.jsx(So,{className:Ie("flex flex-wrap gap-y-oneScaledPix gap-x-1",t),action:e,keyClassName:"text-pink zx:text-zxRed selectedMenuItem:text-pinkHalfbrite zx:selectedMenuItem:text-zxRed",flashingCursor:r})},hc="text-pink zx:text-zxCyan",Pw=()=>{const t=ce(e=>e.assigningInput?.action);return t===void 0?null:m.jsxs("div",{className:`
        bg-metallicBlueHalfbrite text-white
        zx:bg-zxBlueDimmed zx:text-zxCyanDimmed

        ${gt} inline-block absolute inset-x-0 bottom-0 h-min pt-1 px-1`,children:[m.jsx(H,{children:"Press "}),m.jsx(So,{className:`inline ${hc}`,action:"menu_openOrExit",keyClassName:"me-1"}),m.jsx(H,{children:"when done selecting keys for "}),m.jsx(H,{className:hc,children:t})]})},Mw=()=>{const t=!Qh();qe({action:"menu_openOrExit",handler:D.useCallback(()=>{Te.dispatch(Bx())},[]),disabled:t}),Rb({handler:D.useCallback((e,r)=>{console.log("useKeyAssignmentInput:: got input press",e),r.currentActionPress("menu_openOrExit")==="released"&&Zh(Te.getState())&&Te.dispatch(Ox(e))},[]),disabled:t})},Tw=({className:t})=>{const e=ce(Uy);return m.jsx(H,{className:Ie("text-nowrap","text-pink zx:text-zxRed selectedMenuItem:text-pinkHalfbrite zx:selectedMenuItem:text-zxRed",t),children:e??"custom"})},Iw=()=>(Mw(),m.jsxs(m.Fragment,{children:[m.jsx(bt,{className:"bg-lightGrey zx:bg-zxRedDimmed",onClick:Z(xt)}),m.jsxs(Ke,{className:"bg-white zx:bg-zxWhite",children:[m.jsx(H,{className:"text-midRed zx:text-zxBlue sprites-double-height block mx-auto",children:"Select the keys"}),m.jsxs("div",{className:"overflow-y-scroll scrollbar  scrollbar-w-1 scrollbar-thumb-midGrey scrollbar-track-white zx:scrollbar-thumb-zxBlue zx:scrollbar-track-zxWhite ",children:[m.jsxs("div",{className:`mb-1 ${gt}`,children:[m.jsx(H,{className:"text-midRed bg-pureBlack inline-block zx:text-zxRed zx:bg-zxYellow me-1",children:"Note:"}),m.jsx(H,{className:"text-midGrey zx:text-zxBlack",children:"some puzzles require you to jump and pick up simultaneously - assign a key for both jump and carry"})]}),m.jsxs(_t,{className:"text-metallicBlue zx:text-zxBlue !gap-y-1 selectedMenuItem:text-metallicBlueHalfbrite zx:selectedMenuItem:text-zxGreen",children:[m.jsx(ne,{id:"preset",label:"preset:",valueElement:m.jsx(Tw,{}),onSelect:Z(Zt,"inputPreset")}),m.jsx(ne,{id:"left",label:"Left ",valueElement:m.jsx(et,{action:"left"}),onSelect:Z(Je,"left")}),m.jsx(ne,{id:"right",label:"Right ",valueElement:m.jsx(et,{action:"right"}),onSelect:Z(Je,"right")}),m.jsx(ne,{id:"up",label:"Up ",valueElement:m.jsx(et,{action:"away"}),onSelect:Z(Je,"away")}),m.jsx(ne,{id:"down",label:"Down ",valueElement:m.jsx(et,{action:"towards"}),onSelect:Z(Je,"towards")}),m.jsx(ne,{id:"jump",label:"Jump",valueElement:m.jsx(et,{action:"jump"}),onSelect:Z(Je,"jump")}),m.jsx(ne,{id:"carry",label:"Carry",valueElement:m.jsx(et,{action:"carry"}),onSelect:Z(Je,"carry")}),m.jsx(ne,{id:"fire",label:m.jsx(H,{className:`inline-block w-6 ${gt}`,children:"fire dough- nuts"}),valueElement:m.jsx(et,{action:"fire"}),onSelect:Z(Je,"fire")}),m.jsx(ne,{id:"swop",label:"Swop",valueElement:m.jsx(et,{action:"swop"}),onSelect:Z(Je,"swop")}),m.jsx(ne,{id:"hold",label:"Hold",valueElement:m.jsx(et,{action:"hold"}),onSelect:Z(Je,"hold")}),m.jsx(ne,{id:"toggleColourisation",label:m.jsx(H,{className:`inline-block w-6 ${gt}`,children:"toggle colour- isation"}),valueElement:m.jsx(et,{action:"toggleColourisation"}),onSelect:Z(Je,"toggleColourisation")}),m.jsx(Ht,{})]})]}),m.jsx(Pw,{})]})]})),Ew=({presetName:t})=>m.jsx(ne,{id:t,label:t,doubleHeightWhenFocussed:!0,hint:Jr[t].description,onSelect:Z(Nx,t)},t),Rw=()=>m.jsxs(m.Fragment,{children:[m.jsx(bt,{className:"bg-midGrey zx:bg-zxWhiteDimmed",onClick:Z(xt)}),m.jsx(Ke,{className:"bg-white",children:m.jsxs(es.Provider,{children:[m.jsx(H,{className:"text-midRed zx:text-zxRed sprites-double-height ml-3",children:"Key presets"}),m.jsxs(_t,{className:"text-metallicBlue zx:text-zxBlue selectedMenuItem:text-moss zx:selectedMenuItem:text-zxMagenta",children:[Dh(Jr).map(t=>m.jsx(Ew,{presetName:t},t)),m.jsx(Vs,{}),m.jsx(Ht,{})]}),m.jsx(Ao,{className:"text-shadow zx:text-zxMagenta"})]})})]}),jw=t=>t.startsWith("markdown/"),Bw=t=>{const e=ce(r=>r.openMenus.at(0)?.menuId);if(e===void 0)return null;if(jw(e))return m.jsx(ow,{pageName:e.slice(9)});switch(e){case"mainMenu":return m.jsx(dw,{});case"quitGameConfirm":return m.jsx(fw,{});case"readTheManual":return m.jsx(J_,{});case"crowns":return m.jsx(cw,{});case"gameOver":return m.jsx(pw,{});case"hold":return m.jsx(_w,{});case"modernisationOptions":return m.jsx(Cw,{});case"selectKeys":return m.jsx(Iw,{});case"inputPreset":return m.jsx(Rw,{});default:return m.jsx(Ke,{children:m.jsx(H,{children:`unknown dialog ${e}`})})}},zw=Xr(()=>Wt(()=>import("./Cheats-GZhzM3GR.js"),__vite__mapDeps([6,4,5,7]))),Fw=Xr(()=>Wt(()=>import("./gameMain-BtT6FEo_.js").then(t=>t.g),__vite__mapDeps([8,7,4,5,2]))),Ow=Xr(()=>Wt(()=>import("./campaign-gke84wlu.js"),[])),Nw=Xr(()=>Wt(()=>import("./testCampaign-B8B8LZQI.js"),__vite__mapDeps([9,4,5]))),Lw=Xr(()=>Wt(()=>Promise.resolve().then(()=>uy),void 0)),Dw=D.lazy(zw),Gw=()=>{const[t,e]=D.useState(),r=io(),s=bo(),n=Kh();return D.useEffect(()=>{if(!r){e(void 0);return}let i=!1,o;return(async()=>{const[l,c,h,u]=await Promise.all([Lw(),Fw(),Ow(),n?Nw():void 0]);await l.load();const f=n?{rooms:{...h.campaign.rooms,...u?.testCampaign.rooms}}:h.campaign;o=await c.default(f,s),i?o.stop():e(o)})(),()=>{o?.stop(),i=!0}},[n,r,s]),t},Ww=()=>{const[t,e]=D.useState(null),r=Kh(),s=Gw(),{cssUpscale:n,canvasSize:i}=ce(o=>o.upscale);return D.useEffect(()=>{t===null||s===void 0||s.renderIn(t)},[s,t]),D.useEffect(()=>{s?.resizeTo(i)},[i,s]),m.jsxs(m.Fragment,{children:[m.jsx("div",{style:{transform:`scale3d(${n}, ${n}, 1)`,width:i.x,height:i.y},className:"origin-top-left",ref:e}),m.jsx(zb,{}),m.jsx(Bw,{}),s&&m.jsx(qy,{gameApi:s,children:r&&s&&m.jsx(D.Suspense,{fallback:null,children:m.jsx(oo,{children:m.jsx(Dw,{})})})})]})},Hw=()=>{const t=ce(e=>!e.userSettings.displaySettings.colourise);return D.useEffect(()=>{document.body.classList.toggle("zx",t)},[t]),m.jsxs(m.Fragment,{children:[m.jsx(jo,{path:"/",children:m.jsx(Ib,{children:m.jsx(Ww,{})})}),m.jsx(jo,{path:"/sprites",children:m.jsx(oo,{children:m.jsx(dy,{})})})]})},$w=()=>m.jsx(Ty,{store:Te,children:m.jsx(Hw,{})}),Cv=Object.freeze(Object.defineProperty({__proto__:null,App:$w},Symbol.toStringTag,{value:"Module"}));export{iv as $,Ls as A,Ee as B,Re as C,ye as D,$ as E,rv as F,Rt as G,Fh as H,Iu as I,Kw as J,jr as K,Xn as L,re as M,ut as N,Jw as O,Pe as P,to as Q,xi as R,Nf as S,nt as T,Cs as U,Yd as V,Ug as W,Te as X,kv as Y,$g as Z,nr as _,fv as a,Lh as a$,gl as a0,pv as a1,Wh as a2,vv as a3,ev as a4,bb as a5,gd as a6,zs as a7,Qc as a8,wp as a9,Fu as aA,qr as aB,ce as aC,Vh as aD,bv as aE,_v as aF,Ns as aG,ro as aH,Lt as aI,dv as aJ,mw as aK,Nt as aL,L as aM,Vy as aN,Sv as aO,$r as aP,Kt as aQ,tv as aR,vl as aS,yv as aT,wv as aU,Zw as aV,Qw as aW,cv as aX,dr as aY,Yw as aZ,Hg as a_,pt as aa,Tc as ab,$d as ac,it as ad,qo as ae,Lr as af,gf as ag,ge as ah,me as ai,Xo as aj,Zo as ak,qd as al,on as am,Ae as an,Rc as ao,$f as ap,cp as aq,up as ar,gp as as,xp as at,bp as au,ku as av,gv as aw,Av as ax,Ie as ay,Pu as az,uv as b,Bt as b0,lv as b1,Xw as b2,sv as b3,nv as b4,av as b5,wl as b6,qg as b7,ov as b8,Rx as b9,st as ba,zg as bb,mv as bc,md as bd,rr as be,Hr as bf,lm as bg,mh as bh,oa as bi,na as bj,Ea as bk,pm as bl,ue as bm,yd as bn,Ma as bo,Si as bp,Ta as bq,ks as br,xh as bs,Cv as bt,ot as c,pe as d,We as e,ia as f,zf as g,Gr as h,vs as i,Hi as j,Wc as k,at as l,rh as m,Pa as n,lp as o,hp as p,pp as q,Id as r,Nh as s,ih as t,yp as u,Ce as v,fe as w,$i as x,ee as y,hv as z};
