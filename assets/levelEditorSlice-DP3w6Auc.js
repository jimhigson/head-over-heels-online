import{h as E,j as R,k as x,c as J,e as I,l as T,n as p,q as b,r as W,u as k,f as v}from"./App-BqlFHI7H.js";import"./index-DN7_HcAO.js";const A={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","more-fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},P=(o,e)=>{const i=A[o];return i[e%i.length]},f=(o,e)=>new Array(e).fill(0).map((i,t)=>P(o,t)),z={awayWall:{type:"wall",config:{direction:"away",times:{x:8},tiles:f("blacktooth",8)},position:{x:0,y:8,z:0}},leftWall:{type:"wall",config:{direction:"left",times:{y:8},tiles:f("blacktooth",8)},position:{x:8,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:8}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:8}},position:{x:0,y:0,z:0}}},D={planet:"blacktooth",color:{hue:"cyan",shade:"basic"},floor:"blacktooth",items:{...z},size:{x:8,y:8}},d=o=>o.campaignInProgress.rooms[o.currentlyEditingRoomId];function*$(o,e,i){for(const t of x(o)){const[s,c]=t;if(c.type!=="wall"){yield t;continue}if(c.config.direction!==e){yield t;continue}const{position:m,config:g}=c,u={x:1,y:1,...g.times},n=J(I(g.direction)),C=I(g.direction),r=T(i,m);if(r[C]!==0){yield t;continue}if(r[n]<-1){yield t;continue}if(r[n]>u[n]){yield t;continue}if(u[n]===2)continue;r[n]===0&&(yield[s,p(c,a=>{a.position=b(m,{[n]:2});const l=a.config;l.times={[n]:u[n]-2},l.tiles&&(l.tiles=l.tiles.slice(2))})]),r[n]===u[n]-2&&(yield[s,p(c,a=>{const l=a.config;l.times={[n]:u[n]-2},l.tiles&&(l.tiles=l.tiles.slice(0,l.tiles.length-2))})]),yield[`${s}/beforeDoor`,p(c,a=>{const l=a.config;l.times={[n]:r[n]},l.tiles&&(l.tiles=l.tiles.slice(0,r[n]))})],yield[`${s}/afterDoor`,p(c,a=>{a.position={...m,[n]:i[n]+2};const l=a.config;l.times={[n]:u[n]-r[n]-2},l.tiles&&(l.tiles=l.tiles.slice(r[n]+2))})]}}const F=(o,e,i)=>{const t=d(o);t.items=E($(R(t.items),e,i))},y=o=>{const e=structuredClone(R(d(o))),{history:i}=o;i.redo=[],i.undo.push(e)},L={undo(o){const e=o,{campaignInProgress:i,history:{undo:t,redo:s},currentlyEditingRoomId:c}=e;t.length!==0&&(s.push(i.rooms[c]),i.rooms[c]=t.pop())},redo(o){const e=o,{campaignInProgress:i,history:{redo:t,undo:s},currentlyEditingRoomId:c}=e;t.length!==0&&(s.push(i.rooms[c]),i.rooms[c]=t.pop())}},O={selectCanUndo:o=>o.history.undo.length>0,selectCanRedo:o=>o.history.redo.length>0},w=(o,e,i,t)=>{const s=`item(${e})#${o.nextItemId}`,c=d(o);o.nextItemId++,c.items[s]={type:e,config:i,position:t}},U=o=>o.type==="door",X={applyToolToRoomJson(o,{payload:{blockPosition:e,pointedAtItem:i}}){const t=o,{tool:s}=t;switch(s?.type){case"item":{const c=s.item;if(U(c)&&i.type==="wall"){y(t);const m=i.config.direction;F(t,m,e),w(t,s.item.type,{...s.item.config,direction:m},e)}else y(t),w(t,s.item.type,s.item.config,e);t.selectedJsonItemIds=[];break}}}},h="untitledRoom",j={...D,id:h},q={campaignInProgress:{name:"new campaign",rooms:{[h]:j}},nextItemId:0,currentlyEditingRoomId:h,tool:{type:"pointer"},selectedJsonItemIds:[],history:{undo:[],redo:[]}},S=W({name:"levelEditor",initialState:q,reducers:{setTool(o,{payload:e}){const i=o;i.tool=e},changeRoomColour(o,{payload:e}){const i=o,t=i.campaignInProgress.rooms[i.currentlyEditingRoomId].color;Object.assign(t,e)},changeRoomScenery(o,{payload:e}){const i=o,t=i.campaignInProgress.rooms[i.currentlyEditingRoomId];t.planet=e,v.includes(t.floor)&&(t.floor=e);for(const s of Object.values(t.items))s.type==="wall"&&(s.config.direction==="away"||s.config.direction==="left")&&(s.config.tiles=f(e,s.config.tiles.length))},setSelectedItemInRoom(o,{payload:{jsonItemId:e,additive:i}}){if(i)if(e===void 0)o.selectedJsonItemIds=[];else{const t=o.selectedJsonItemIds.indexOf(e);t===-1?o.selectedJsonItemIds.push(e):o.selectedJsonItemIds.splice(t,1)}else o.selectedJsonItemIds=e===void 0?[]:[e]},deleteSelected(o){const e=o,i=d(e);y(e),e.selectedJsonItemIds.forEach(t=>{delete i.items[t]}),e.selectedJsonItemIds=[]},injected(){},...L,...X},selectors:{selectCurrentEditingRoomJson:d,selectCurrentEditingRoomColour:o=>d(o).color,selectCurrentEditingRoomScenery:o=>d(o).planet,selectTool:o=>o.tool,selectSelectedJsonItemIds:o=>o.selectedJsonItemIds,...O}}),{applyToolToRoomJson:K,changeRoomColour:M,changeRoomScenery:Q,deleteSelected:V,injected:Y,setSelectedItemInRoom:Z,setTool:N,undo:oo,redo:eo}=S.actions,{selectCurrentEditingRoomJson:to,selectTool:io,selectCurrentEditingRoomColour:so,selectCurrentEditingRoomScenery:no,selectSelectedJsonItemIds:lo,selectCanRedo:co,selectCanUndo:ro}=S.selectors,ao=k.withTypes();export{K as applyToolToRoomJson,M as changeRoomColour,Q as changeRoomScenery,V as deleteSelected,q as initialLevelEditorSliceState,Y as injected,S as levelEditorSlice,eo as redo,co as selectCanRedo,ro as selectCanUndo,so as selectCurrentEditingRoomColour,to as selectCurrentEditingRoomJson,no as selectCurrentEditingRoomScenery,lo as selectSelectedJsonItemIds,io as selectTool,Z as setSelectedItemInRoom,N as setTool,oo as undo,ao as useAppSelectorWithLevelEditorSlice};
