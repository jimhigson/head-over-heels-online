import{an as S,ao as G,ap as B,aq as K,c as Q,e as J,N as V,ar as b,R as Z,as as N,at as ee,au as re,av as te}from"./App-DbJKx38b.js";import{g as M}from"./index-DMxw9keX.js";var R={},w={},x;function oe(){if(x)return w;x=1;function r(i,a){var e;if(typeof Symbol>"u"||i[Symbol.iterator]==null){if(Array.isArray(i)||(e=t(i))||a){e&&(i=e);var c=0,s=function(){};return{s,n:function(){return c>=i.length?{done:!0}:{done:!1,value:i[c++]}},e:function(d){throw d},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,g=!1,p;return{s:function(){e=i[Symbol.iterator]()},n:function(){var d=e.next();return u=d.done,d},e:function(d){g=!0,p=d},f:function(){try{!u&&e.return!=null&&e.return()}finally{if(g)throw p}}}}function t(i,a){if(i){if(typeof i=="string")return o(i,a);var e=Object.prototype.toString.call(i).slice(8,-1);if(e==="Object"&&i.constructor&&(e=i.constructor.name),e==="Map"||e==="Set")return Array.from(i);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return o(i,a)}}function o(i,a){(a==null||a>i.length)&&(a=i.length);for(var e=0,c=new Array(a);e<a;e++)c[e]=i[e];return c}var n=S(),y=n.ensureIterable;function f(i){var a=[],e=r(i),c;try{for(e.s();!(c=e.n()).done;){var s=c.value;a.push(s)}}catch(u){e.e(u)}finally{e.f()}return a}w.__toArray=f;function m(i){return f(y(i))}return w.toArray=m,w}var $;function ne(){if($)return R;$=1;var r=G(),t=r.mark(m),o=S(),n=o.iterableCurry,y=oe(),f=y.__toArray;function m(a,e){var c;return r.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(c=Array.isArray(a)?a:f(a),c.length){u.next=3;break}return u.abrupt("return");case 3:if(!e--){u.next=7;break}return u.delegateYield(c,"t0",5);case 5:u.next=3;break;case 7:case"end":return u.stop()}},t)}R.__cycleTimes=m;var i=n(m);return R.cycleTimes=i,R}var C={},z;function ie(){if(z)return C;z=1;var r=S(),t=r.iterableCurry,o=ne(),n=o.__cycleTimes;function y(m){return n(m,1/0)}C.__cycle=y;var f=t(y);return C.cycle=f,C}var T={},W;function se(){if(W)return T;W=1;var r=G(),t=r.mark(i);function o(e,c){var s;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=n(e))||c){s&&(e=s);var u=0,g=function(){};return{s:g,n:function(){return u>=e.length?{done:!0}:{done:!1,value:e[u++]}},e:function(I){throw I},f:g}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,l=!1,d;return{s:function(){s=e[Symbol.iterator]()},n:function(){var I=s.next();return p=I.done,I},e:function(I){l=!0,d=I},f:function(){try{!p&&s.return!=null&&s.return()}finally{if(l)throw d}}}}function n(e,c){if(e){if(typeof e=="string")return y(e,c);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return y(e,c)}}function y(e,c){(c==null||c>e.length)&&(c=e.length);for(var s=0,u=new Array(c);s<c;s++)u[s]=e[s];return u}var f=S(),m=f.iterableCurry;function i(e,c){var s,u,g,p;return r.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(c!==0){d.next=2;break}return d.abrupt("return");case 2:s=0,u=o(e),d.prev=4,u.s();case 6:if((g=u.n()).done){d.next=14;break}return p=g.value,d.next=10,p;case 10:if(++s!==c){d.next=12;break}return d.abrupt("break",14);case 12:d.next=6;break;case 14:d.next=19;break;case 16:d.prev=16,d.t0=d.catch(4),u.e(d.t0);case 19:return d.prev=19,u.f(),d.finish(19);case 22:case"end":return d.stop()}},t,null,[[4,16,19,22]])}T.__take=i;var a=m(i);return T.take=a,T}var k,D;function ae(){return D||(D=1,k=ie().cycle),k}var le=ae();const ce=M(le);var A,O;function ue(){return O||(O=1,A=se().take),A}var de=ue();const fe=M(de),ye={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","more-fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},E=(r,t)=>[...fe(t,ce(ye[r]))],me={awayWall:{type:"wall",config:{direction:"away",times:{x:8},tiles:E("blacktooth",8)},position:{x:0,y:8,z:0}},leftWall:{type:"wall",config:{direction:"left",times:{y:8},tiles:E("blacktooth",8)},position:{x:8,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:8}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:8}},position:{x:0,y:0,z:0}}},P={x:8,y:8},H={planet:"blacktooth",color:{hue:"cyan",shade:"basic"},items:{...me,floor:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:P},position:{x:0,y:0,z:0}}},size:P},h=r=>r.campaignInProgress.rooms[r.currentlyEditingRoomId];function*pe(r,t,o){for(const n of K(r)){const[y,f]=n;if(f.type!=="wall"){yield n;continue}if(f.config.direction!==t){yield n;continue}const{position:m,config:i}=f,a={x:1,y:1,...i.times},e=Q(J(i.direction)),c=J(i.direction),s=V(o,m);if(s[c]!==0){yield n;continue}if(s[e]<-1){yield n;continue}if(s[e]>a[e]){yield n;continue}if(a[e]===2)continue;s[e]===0&&(yield[y,b(f,p=>{p.position=Z(m,{[e]:2});const l=p.config;l.times={[e]:a[e]-2},l.tiles&&(l.tiles=l.tiles.slice(2))})]),s[e]===a[e]-2&&(yield[y,b(f,p=>{const l=p.config;l.times={[e]:a[e]-2},l.tiles&&(l.tiles=l.tiles.slice(0,l.tiles.length-2))})]),yield[`${y}/beforeDoor`,b(f,p=>{const l=p.config;l.times={[e]:s[e]},l.tiles&&(l.tiles=l.tiles.slice(0,s[e]))})],yield[`${y}/afterDoor`,b(f,p=>{p.position={...m,[e]:o[e]+2};const l=p.config;l.times={[e]:a[e]-s[e]-2},l.tiles&&(l.tiles=l.tiles.slice(s[e]+2))})]}}const j=(r,t,o)=>{r.items=B(pe(r.items,t,o))},_=r=>{const t=structuredClone(N(h(r))),{history:o}=r;o.redo=[],o.undo.push(t)},ge={undo(r){const t=r,{campaignInProgress:o,history:{undo:n,redo:y},currentlyEditingRoomId:f}=t;n.length!==0&&(y.push(o.rooms[f]),o.rooms[f]=n.pop())},redo(r){const t=r,{campaignInProgress:o,history:{redo:n,undo:y},currentlyEditingRoomId:f}=t;n.length!==0&&(y.push(o.rooms[f]),o.rooms[f]=n.pop())}},he={selectCanUndo:r=>r.history.undo.length>0,selectCanRedo:r=>r.history.redo.length>0},L=(r,t)=>{r.planet=t;for(const o of Object.values(r.items))o.type==="floor"&&o.config.floorType==="standable"&&(o.config.scenery=t),o.type==="wall"&&(o.config.direction==="away"||o.config.direction==="left")&&(o.config.tiles=E(t,o.config.tiles.length))},X=(r,t)=>`${t}#${r.nextItemId++}`,F=(r,t,o,n)=>{const y=X(r,t),f=h(r);r.nextItemId++,f.items[y]={type:t,config:o,position:n}},ve=r=>r.type==="door",Ie={applyToolToRoomJson(r,{payload:{blockPosition:t,pointedAtItem:o}}){const n=r,{tool:y}=n;switch(y?.type){case"item":{const f=y.item;if(ve(f)&&o.type==="wall"){_(n);const m=h(n),i=o.config.direction;j(m,i,t);const a=`room#${n.nextRoomId++}`;console.log(a,"toRoomId"),F(n,f.type,{...y.item.config,toRoom:a,direction:i},t);const e={id:a,...structuredClone(H),color:m.color};L(e,m.planet),n.campaignInProgress.rooms[a]=e;const c=X(n,"door"),s={x:i==="left"?0:i==="right"?e.size.x:Math.floor(e.size.x/2),y:i==="away"?0:i==="towards"?e.size.x:Math.floor(e.size.x/2),z:t.z},u=ee(i),g={type:"door",config:{toRoom:m.id,direction:u},position:s};e.items[c]=g,j(e,u,s)}else _(n),F(n,y.item.type,y.item.config,t);n.selectedJsonItemIds=[];break}}}},q="room#0",be={...structuredClone(H),id:q},U={campaignInProgress:{name:"new campaign",rooms:{[q]:be}},nextRoomId:1,nextItemId:0,currentlyEditingRoomId:q,tool:{type:"pointer"},selectedJsonItemIds:[],halfGridResolution:!1,history:{undo:[],redo:[]}},Y=re({name:"levelEditor",initialState:U,reducers:{setTool(r,{payload:t}){const o=r;o.tool=t},changeRoomColour(r,{payload:t}){const o=r,n=o.campaignInProgress.rooms[o.currentlyEditingRoomId].color;Object.assign(n,t)},changeRoomScenery(r,{payload:t}){const n=h(r);L(n,t)},changeToRoom(r,{payload:t}){const o=r;o.currentlyEditingRoomId=t,o.history=U.history},setSelectedItemInRoom(r,{payload:{jsonItemId:t,additive:o}}){if(o)if(t===void 0)r.selectedJsonItemIds=[];else{const n=r.selectedJsonItemIds.indexOf(t);n===-1?r.selectedJsonItemIds.push(t):r.selectedJsonItemIds.splice(n,1)}else r.selectedJsonItemIds=t===void 0?[]:[t]},deleteSelected(r){const t=r,o=h(t);_(t),t.selectedJsonItemIds.forEach(n=>{delete o.items[n]}),t.selectedJsonItemIds=[]},injected(){},changeGridResolution(r,{payload:t}){const o=r;o.halfGridResolution=t},...ge,...Ie},selectors:{selectCurrentEditingRoomJson:h,selectCurrentEditingRoomColour:r=>h(r).color,selectCurrentEditingRoomScenery:r=>h(r).planet,selectTool:r=>r.tool,selectSelectedJsonItemIds:r=>r.selectedJsonItemIds,...he}}),{applyToolToRoomJson:Ce,changeGridResolution:Te,changeRoomColour:Se,changeRoomScenery:ke,changeToRoom:Ae,deleteSelected:Ee,injected:_e,redo:qe,setSelectedItemInRoom:Je,setTool:xe,undo:$e}=Y.actions,{selectCurrentEditingRoomJson:ze,selectTool:We,selectCurrentEditingRoomColour:De,selectCurrentEditingRoomScenery:Oe,selectSelectedJsonItemIds:Pe,selectCanRedo:je,selectCanUndo:Fe}=Y.selectors,Ue=te.withTypes();export{Ce as applyToolToRoomJson,Te as changeGridResolution,Se as changeRoomColour,ke as changeRoomScenery,Ae as changeToRoom,Ee as deleteSelected,U as initialLevelEditorSliceState,_e as injected,Y as levelEditorSlice,qe as redo,je as selectCanRedo,Fe as selectCanUndo,De as selectCurrentEditingRoomColour,ze as selectCurrentEditingRoomJson,Oe as selectCurrentEditingRoomScenery,Pe as selectSelectedJsonItemIds,We as selectTool,Je as setSelectedItemInRoom,xe as setTool,$e as undo,Ue as useAppSelectorWithLevelEditorSlice};
