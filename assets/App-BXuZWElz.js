const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-Ca6DgVWw.js","assets/webworkerAll-DZty8RK2.js","assets/index-BWiMp7rh.js","assets/index-DVPFdodb.css","assets/campaign-LEH-poZq.js","assets/Cheats-sKiCiaCw.js","assets/pixiContainerToString-C25dflba.js","assets/spritesheetPalette-CzWQoMjj.js","assets/gameMain-BmA0H6lh.js","assets/spectrumLut-C7r_7MCR.js","assets/canvasUtils-BA9Acge-.js","assets/localUniformBit-BOGrcT1E.js","assets/CanvasPool-njU718b8.js","assets/BatchableSprite-qOYjpB38.js","assets/LutPage-BqPyEyg-.js"])))=>i.map(i=>d[i]);
import{a as On,r as v,R as md,j as p,g as Xe,_ as Nn,i as Bn,t as ht,d as rq,D as ke,L as HV,c as Oo}from"./index-BWiMp7rh.js";var cc={exports:{}},uc={};var ip;function WV(){if(ip)return uc;ip=1;var t=On();function e(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var r=typeof Object.is=="function"?Object.is:e,s=t.useSyncExternalStore,n=t.useRef,i=t.useEffect,o=t.useMemo,a=t.useDebugValue;return uc.useSyncExternalStoreWithSelector=function(l,c,u,h,f){var d=n(null);if(d.current===null){var m={hasValue:!1,value:null};d.current=m}else m=d.current;d=o(function(){function A(V){if(!y){if(y=!0,b=V,V=h(V),f!==void 0&&m.hasValue){var _=m.value;if(f(_,V))return q=_}return q=V}if(_=q,r(b,V))return _;var w=h(V);return f!==void 0&&f(_,w)?(b=V,_):(b=V,q=w)}var y=!1,b,q,x=u===void 0?null:u;return[function(){return A(c())},x===null?void 0:function(){return A(x())}]},[c,u,h,f]);var g=s(l,d[0],d[1]);return i(function(){m.hasValue=!0,m.value=g},[g]),a(g),g},uc}var op;function YV(){return op||(op=1,cc.exports=WV()),cc.exports}var KV=YV();function sq(t){t()}function QV(){let t=null,e=null;return{clear(){t=null,e=null},notify(){sq(()=>{let r=t;for(;r;)r.callback(),r=r.next})},get(){const r=[];let s=t;for(;s;)r.push(s),s=s.next;return r},subscribe(r){let s=!0;const n=e={callback:r,next:null,prev:e};return n.prev?n.prev.next=n:t=n,function(){!s||t===null||(s=!1,n.next?n.next.prev=n.prev:e=n.prev,n.prev?n.prev.next=n.next:t=n.next)}}}}var ap={notify(){},get:()=>[]};function XV(t,e){let r,s=ap,n=0,i=!1;function o(g){u();const A=s.subscribe(g);let y=!1;return()=>{y||(y=!0,A(),h())}}function a(){s.notify()}function l(){m.onStateChange&&m.onStateChange()}function c(){return i}function u(){n++,r||(r=t.subscribe(l),s=QV())}function h(){n--,r&&n===0&&(r(),r=void 0,s.clear(),s=ap)}function f(){i||(i=!0,u())}function d(){i&&(i=!1,h())}const m={addNestedSub:o,notifyNestedSubs:a,handleChangeWrapper:l,isSubscribed:c,trySubscribe:f,tryUnsubscribe:d,getListeners:()=>s};return m}var JV=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ZV=JV(),ev=()=>typeof navigator<"u"&&navigator.product==="ReactNative",tv=ev(),rv=()=>ZV||tv?v.useLayoutEffect:v.useEffect,sv=rv();function lp(t,e){return t===e?t!==0||e!==0||1/t===1/e:t!==t&&e!==e}function Pi(t,e){if(lp(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(let n=0;n<r.length;n++)if(!Object.prototype.hasOwnProperty.call(e,r[n])||!lp(t[r[n]],e[r[n]]))return!1;return!0}var nv=Symbol.for("react-redux-context"),iv=typeof globalThis<"u"?globalThis:{};function ov(){if(!v.createContext)return{};const t=iv[nv]??=new Map;let e=t.get(v.createContext);return e||(e=v.createContext(null),t.set(v.createContext,e)),e}var Xr=ov();function av(t){const{children:e,context:r,serverState:s,store:n}=t,i=v.useMemo(()=>{const l=XV(n);return{store:n,subscription:l,getServerState:s?()=>s:void 0}},[n,s]),o=v.useMemo(()=>n.getState(),[n]);sv(()=>{const{subscription:l}=i;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),o!==n.getState()&&l.notifyNestedSubs(),()=>{l.tryUnsubscribe(),l.onStateChange=void 0}},[i,o]);const a=r||Xr;return v.createElement(a.Provider,{value:i},e)}var lv=av;function gd(t=Xr){return function(){return v.useContext(t)}}var nq=gd();function iq(t=Xr){const e=t===Xr?nq:gd(t),r=()=>{const{store:s}=e();return s};return Object.assign(r,{withTypes:()=>r}),r}var Ad=iq();function cv(t=Xr){const e=t===Xr?Ad:iq(t),r=()=>e().dispatch;return Object.assign(r,{withTypes:()=>r}),r}var oq=cv(),uv=(t,e)=>t===e;function hv(t=Xr){const e=t===Xr?nq:gd(t),r=(s,n={})=>{const{equalityFn:i=uv}=typeof n=="function"?{equalityFn:n}:n,o=e(),{store:a,subscription:l,getServerState:c}=o;v.useRef(!0);const u=v.useCallback({[s.name](f){return s(f)}}[s.name],[s]),h=KV.useSyncExternalStoreWithSelector(l.addNestedSub,a.getState,c||a.getState,u,i);return v.useDebugValue(h),h};return Object.assign(r,{withTypes:()=>r}),r}var aq=hv(),dv=sq;function fv(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var r,s,n,i,o=[],a="",l=t.split("/");for(l[0]||l.shift();n=l.shift();)r=n[0],r==="*"?(o.push(r),a+=n[1]==="?"?"(?:/(.*))?":"/(.*)"):r===":"?(s=n.indexOf("?",1),i=n.indexOf(".",1),o.push(n.substring(1,~s?s:~i?i:n.length)),a+=~s&&!~i?"(?:/([^/]+?))?":"/([^/]+?)",~i&&(a+=(~s?"?":"")+"\\"+n.substring(i))):a+="/"+n;return{keys:o,pattern:new RegExp("^"+a+(e?"(?=$|/)":"/?$"),"i")}}var hc={exports:{}},dc={};var cp;function pv(){if(cp)return dc;cp=1;var t=On();function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var r=typeof Object.is=="function"?Object.is:e,s=t.useState,n=t.useEffect,i=t.useLayoutEffect,o=t.useDebugValue;function a(h,f){var d=f(),m=s({inst:{value:d,getSnapshot:f}}),g=m[0].inst,A=m[1];return i(function(){g.value=d,g.getSnapshot=f,l(g)&&A({inst:g})},[h,d,f]),n(function(){return l(g)&&A({inst:g}),h(function(){l(g)&&A({inst:g})})},[h]),o(d),d}function l(h){var f=h.getSnapshot;h=h.value;try{var d=f();return!r(h,d)}catch{return!0}}function c(h,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return dc.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,dc}var up;function mv(){return up||(up=1,hc.exports=pv()),hc.exports}var gv=mv();const Av=md.useInsertionEffect,yv=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",qv=yv?v.useLayoutEffect:v.useEffect,xv=Av||qv,lq=t=>{const e=v.useRef([t,(...r)=>e[0](...r)]).current;return xv(()=>{e[0]=t}),e[1]},bv="popstate",yd="pushState",qd="replaceState",wv="hashchange",hp=[bv,yd,qd,wv],Vv=t=>{for(const e of hp)addEventListener(e,t);return()=>{for(const e of hp)removeEventListener(e,t)}},cq=(t,e)=>gv.useSyncExternalStore(Vv,t,e),dp=()=>location.search,vv=({ssrSearch:t}={})=>cq(dp,t!=null?()=>t:dp),fp=()=>location.pathname,_v=({ssrPath:t}={})=>cq(fp,t!=null?()=>t:fp),Sv=(t,{replace:e=!1,state:r=null}={})=>history[e?qd:yd](r,"",t),kv=(t={})=>[_v(t),Sv],pp=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[pp]>"u"){for(const t of[yd,qd]){const e=history[t];history[t]=function(){const r=e.apply(this,arguments),s=new Event(t);return s.arguments=arguments,dispatchEvent(s),r}}Object.defineProperty(window,pp,{value:!0})}const Cv=(t,e)=>e.toLowerCase().indexOf(t.toLowerCase())?"~"+e:e.slice(t.length)||"/",uq=(t="")=>t==="/"?"":t,Ev=(t,e)=>t[0]==="~"?t.slice(1):uq(e)+t,Tv=(t="",e)=>Cv(mp(uq(t)),mp(e)),mp=t=>{try{return decodeURI(t)}catch{return t}},hq={hook:kv,searchHook:vv,parser:fv,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:t=>t,aroundNav:(t,e,r)=>t(e,r)},dq=v.createContext(hq),Pl=()=>v.useContext(dq),fq={},pq=v.createContext(fq),Pv=()=>v.useContext(pq),xd=t=>{const[e,r]=t.hook(t);return[Tv(t.base,e),lq((s,n)=>t.aroundNav(r,Ev(s,t.base),n))]},mq=(t,e,r,s)=>{const{pattern:n,keys:i}=e instanceof RegExp?{keys:!1,pattern:e}:t(e||"*",s),o=n.exec(r)||[],[a,...l]=o;return a!==void 0?[!0,(()=>{const c=i!==!1?Object.fromEntries(i.map((h,f)=>[h,l[f]])):o.groups;let u={...l};return c&&Object.assign(u,c),u})(),...s?[a]:[]]:[!1,null]},Rv=({children:t,...e})=>{const r=Pl(),s=e.hook?hq:r;let n=s;const[i,o=e.ssrSearch??""]=e.ssrPath?.split("?")??[];i&&(e.ssrSearch=o,e.ssrPath=i),e.hrefs=e.hrefs??e.hook?.hrefs,e.searchHook=e.searchHook??e.hook?.searchHook;let a=v.useRef({}),l=a.current,c=l;for(let u in s){const h=u==="base"?s[u]+(e[u]??""):e[u]??s[u];l===c&&h!==c[u]&&(a.current=c={...c}),c[u]=h,(h!==s[u]||h!==n[u])&&(n=c)}return v.createElement(dq.Provider,{value:n,children:t})},gp=({children:t,component:e},r)=>e?v.createElement(e,{params:r}):typeof t=="function"?t(r):t,Mv=t=>{let e=v.useRef(fq);const r=e.current;return e.current=Object.keys(t).length!==Object.keys(r).length||Object.entries(t).some(([s,n])=>n!==r[s])?t:r},ei=({path:t,nest:e,match:r,...s})=>{const n=Pl(),[i]=xd(n),[o,a,l]=r??mq(n.parser,t,i,e),c=Mv({...Pv(),...a});if(!o)return null;const u=l?v.createElement(Rv,{base:l},gp(s,c)):gp(s,c);return v.createElement(pq.Provider,{value:c,children:u})};v.forwardRef((t,e)=>{const r=Pl(),[s,n]=xd(r),{to:i="",href:o=i,onClick:a,asChild:l,children:c,className:u,replace:h,state:f,transition:d,...m}=t,g=lq(y=>{y.ctrlKey||y.metaKey||y.altKey||y.shiftKey||y.button!==0||(a?.(y),y.defaultPrevented||(y.preventDefault(),n(o,t)))}),A=r.hrefs(o[0]==="~"?o.slice(1):r.base+o,r);return l&&v.isValidElement(c)?v.cloneElement(c,{onClick:g,href:A}):v.createElement("a",{...m,onClick:g,href:A,className:u?.call?u(s===o):u,children:c,ref:e})});const gq=t=>Array.isArray(t)?t.flatMap(e=>gq(e&&e.type===v.Fragment?e.props.children:e)):[t],Iv=({children:t,location:e})=>{const r=Pl(),[s]=xd(r);for(const n of gq(t)){let i=0;if(v.isValidElement(n)&&(i=mq(r.parser,n.props.path,e||s,n.props.nest))[0])return v.cloneElement(n,{match:i})}return null},Wt=(t=typeof globalThis.window>"u"?"":window.location.search)=>new URLSearchParams(t);function tt(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var jv=typeof Symbol=="function"&&Symbol.observable||"@@observable",Ap=jv,fc=()=>Math.random().toString(36).substring(7).split("").join("."),Ov={INIT:`@@redux/INIT${fc()}`,REPLACE:`@@redux/REPLACE${fc()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${fc()}`},Xa=Ov;function Jr(t){if(typeof t!="object"||t===null)return!1;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e||Object.getPrototypeOf(t)===null}function bd(t,e,r){if(typeof t!="function")throw new Error(tt(2));if(typeof e=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(tt(0));if(typeof e=="function"&&typeof r>"u"&&(r=e,e=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(tt(1));return r(bd)(t,e)}let s=t,n=e,i=new Map,o=i,a=0,l=!1;function c(){o===i&&(o=new Map,i.forEach((A,y)=>{o.set(y,A)}))}function u(){if(l)throw new Error(tt(3));return n}function h(A){if(typeof A!="function")throw new Error(tt(4));if(l)throw new Error(tt(5));let y=!0;c();const b=a++;return o.set(b,A),function(){if(y){if(l)throw new Error(tt(6));y=!1,c(),o.delete(b),i=null}}}function f(A){if(!Jr(A))throw new Error(tt(7));if(typeof A.type>"u")throw new Error(tt(8));if(typeof A.type!="string")throw new Error(tt(17));if(l)throw new Error(tt(9));try{l=!0,n=s(n,A)}finally{l=!1}return(i=o).forEach(b=>{b()}),A}function d(A){if(typeof A!="function")throw new Error(tt(10));s=A,f({type:Xa.REPLACE})}function m(){const A=h;return{subscribe(y){if(typeof y!="object"||y===null)throw new Error(tt(11));function b(){const x=y;x.next&&x.next(u())}return b(),{unsubscribe:A(b)}},[Ap](){return this}}}return f({type:Xa.INIT}),{dispatch:f,subscribe:h,getState:u,replaceReducer:d,[Ap]:m}}function Nv(t){Object.keys(t).forEach(e=>{const r=t[e];if(typeof r(void 0,{type:Xa.INIT})>"u")throw new Error(tt(12));if(typeof r(void 0,{type:Xa.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(tt(13))})}function wd(t){const e=Object.keys(t),r={};for(let i=0;i<e.length;i++){const o=e[i];typeof t[o]=="function"&&(r[o]=t[o])}const s=Object.keys(r);let n;try{Nv(r)}catch(i){n=i}return function(o={},a){if(n)throw n;let l=!1;const c={};for(let u=0;u<s.length;u++){const h=s[u],f=r[h],d=o[h],m=f(d,a);if(typeof m>"u")throw a&&a.type,new Error(tt(14));c[h]=m,l=l||m!==d}return l=l||s.length!==Object.keys(o).length,l?c:o}}function Ja(...t){return t.length===0?e=>e:t.length===1?t[0]:t.reduce((e,r)=>(...s)=>e(r(...s)))}function Bv(...t){return e=>(r,s)=>{const n=e(r,s);let i=()=>{throw new Error(tt(15))};const o={getState:n.getState,dispatch:(l,...c)=>i(l,...c)},a=t.map(l=>l(o));return i=Ja(...a)(n.dispatch),{...n,dispatch:i}}}function Vd(t){return Jr(t)&&"type"in t&&typeof t.type=="string"}var vd=Symbol.for("immer-nothing"),Ri=Symbol.for("immer-draftable"),kt=Symbol.for("immer-state");function st(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Is=Object.getPrototypeOf;function mr(t){return!!t&&!!t[kt]}function sr(t){return t?Aq(t)||Array.isArray(t)||!!t[Ri]||!!t.constructor?.[Ri]||xo(t)||bo(t):!1}var Dv=Object.prototype.constructor.toString();function Aq(t){if(!t||typeof t!="object")return!1;const e=Is(t);if(e===null)return!0;const r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Dv}function zv(t){return mr(t)||st(15,t),t[kt].base_}function $i(t,e){js(t)===0?Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)}):t.forEach((r,s)=>e(s,r,t))}function js(t){const e=t[kt];return e?e.type_:Array.isArray(t)?1:xo(t)?2:bo(t)?3:0}function Gi(t,e){return js(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function pc(t,e){return js(t)===2?t.get(e):t[e]}function yq(t,e,r){const s=js(t);s===2?t.set(e,r):s===3?t.add(r):t[e]=r}function Fv(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function xo(t){return t instanceof Map}function bo(t){return t instanceof Set}function ms(t){return t.copy_||t.base_}function th(t,e){if(xo(t))return new Map(t);if(bo(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const r=Aq(t);if(e===!0||e==="class_only"&&!r){const s=Object.getOwnPropertyDescriptors(t);delete s[kt];let n=Reflect.ownKeys(s);for(let i=0;i<n.length;i++){const o=n[i],a=s[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(s[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:t[o]})}return Object.create(Is(t),s)}else{const s=Is(t);if(s!==null&&r)return{...t};const n=Object.create(s);return Object.assign(n,t)}}function _d(t,e=!1){return Rl(t)||mr(t)||!sr(t)||(js(t)>1&&(t.set=t.add=t.clear=t.delete=Lv),Object.freeze(t),e&&Object.entries(t).forEach(([r,s])=>_d(s,!0))),t}function Lv(){st(2)}function Rl(t){return Object.isFrozen(t)}var rh={};function Os(t){const e=rh[t];return e||st(0,t),e}function Uv(t,e){rh[t]||(rh[t]=e)}var Hi;function qq(){return Hi}function $v(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function yp(t,e){e&&(Os("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function sh(t){nh(t),t.drafts_.forEach(Gv),t.drafts_=null}function nh(t){t===Hi&&(Hi=t.parent_)}function qp(t){return Hi=$v(Hi,t)}function Gv(t){const e=t[kt];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function xp(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];return t!==void 0&&t!==r?(r[kt].modified_&&(sh(e),st(4)),sr(t)&&(t=Za(e,t),e.parent_||el(e,t)),e.patches_&&Os("Patches").generateReplacementPatches_(r[kt].base_,t,e.patches_,e.inversePatches_)):t=Za(e,r,[]),sh(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==vd?t:void 0}function Za(t,e,r){if(Rl(e))return e;const s=e[kt];if(!s)return $i(e,(n,i)=>bp(t,s,e,n,i,r)),e;if(s.scope_!==t)return e;if(!s.modified_)return el(t,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;const n=s.copy_;let i=n,o=!1;s.type_===3&&(i=new Set(n),n.clear(),o=!0),$i(i,(a,l)=>bp(t,s,n,a,l,r,o)),el(t,n,!1),r&&t.patches_&&Os("Patches").generatePatches_(s,r,t.patches_,t.inversePatches_)}return s.copy_}function bp(t,e,r,s,n,i,o){if(mr(n)){const a=i&&e&&e.type_!==3&&!Gi(e.assigned_,s)?i.concat(s):void 0,l=Za(t,n,a);if(yq(r,s,l),mr(l))t.canAutoFreeze_=!1;else return}else o&&r.add(n);if(sr(n)&&!Rl(n)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;Za(t,n),(!e||!e.scope_.parent_)&&typeof s!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,s)&&el(t,n)}}function el(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&_d(e,r)}function Hv(t,e){const r=Array.isArray(t),s={type_:r?1:0,scope_:e?e.scope_:qq(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let n=s,i=Sd;r&&(n=[s],i=Wi);const{revoke:o,proxy:a}=Proxy.revocable(n,i);return s.draft_=a,s.revoke_=o,a}var Sd={get(t,e){if(e===kt)return t;const r=ms(t);if(!Gi(r,e))return Wv(t,r,e);const s=r[e];return t.finalized_||!sr(s)?s:s===mc(t.base_,e)?(gc(t),t.copy_[e]=oh(s,t)):s},has(t,e){return e in ms(t)},ownKeys(t){return Reflect.ownKeys(ms(t))},set(t,e,r){const s=xq(ms(t),e);if(s?.set)return s.set.call(t.draft_,r),!0;if(!t.modified_){const n=mc(ms(t),e),i=n?.[kt];if(i&&i.base_===r)return t.copy_[e]=r,t.assigned_[e]=!1,!0;if(Fv(r,n)&&(r!==void 0||Gi(t.base_,e)))return!0;gc(t),ih(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_[e]=!0),!0},deleteProperty(t,e){return mc(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,gc(t),ih(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=ms(t),s=Reflect.getOwnPropertyDescriptor(r,e);return s&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:s.enumerable,value:r[e]}},defineProperty(){st(11)},getPrototypeOf(t){return Is(t.base_)},setPrototypeOf(){st(12)}},Wi={};$i(Sd,(t,e)=>{Wi[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});Wi.deleteProperty=function(t,e){return Wi.set.call(this,t,e,void 0)};Wi.set=function(t,e,r){return Sd.set.call(this,t[0],e,r,t[0])};function mc(t,e){const r=t[kt];return(r?ms(r):t)[e]}function Wv(t,e,r){const s=xq(e,r);return s?"value"in s?s.value:s.get?.call(t.draft_):void 0}function xq(t,e){if(!(e in t))return;let r=Is(t);for(;r;){const s=Object.getOwnPropertyDescriptor(r,e);if(s)return s;r=Is(r)}}function ih(t){t.modified_||(t.modified_=!0,t.parent_&&ih(t.parent_))}function gc(t){t.copy_||(t.copy_=th(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var Yv=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,r,s)=>{if(typeof e=="function"&&typeof r!="function"){const i=r;r=e;const o=this;return function(l=i,...c){return o.produce(l,u=>r.call(this,u,...c))}}typeof r!="function"&&st(6),s!==void 0&&typeof s!="function"&&st(7);let n;if(sr(e)){const i=qp(this),o=oh(e,void 0);let a=!0;try{n=r(o),a=!1}finally{a?sh(i):nh(i)}return yp(i,s),xp(n,i)}else if(!e||typeof e!="object"){if(n=r(e),n===void 0&&(n=e),n===vd&&(n=void 0),this.autoFreeze_&&_d(n,!0),s){const i=[],o=[];Os("Patches").generateReplacementPatches_(e,n,i,o),s(i,o)}return n}else st(1,e)},this.produceWithPatches=(e,r)=>{if(typeof e=="function")return(o,...a)=>this.produceWithPatches(o,l=>e(l,...a));let s,n;return[this.produce(e,r,(o,a)=>{s=o,n=a}),s,n]},typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof t?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){sr(t)||st(8),mr(t)&&(t=Kv(t));const e=qp(this),r=oh(t,void 0);return r[kt].isManual_=!0,nh(e),r}finishDraft(t,e){const r=t&&t[kt];(!r||!r.isManual_)&&st(9);const{scope_:s}=r;return yp(s,e),xp(void 0,s)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let r;for(r=e.length-1;r>=0;r--){const n=e[r];if(n.path.length===0&&n.op==="replace"){t=n.value;break}}r>-1&&(e=e.slice(r+1));const s=Os("Patches").applyPatches_;return mr(t)?s(t,e):this.produce(t,n=>s(n,e))}};function oh(t,e){const r=xo(t)?Os("MapSet").proxyMap_(t,e):bo(t)?Os("MapSet").proxySet_(t,e):Hv(t,e);return(e?e.scope_:qq()).drafts_.push(r),r}function Kv(t){return mr(t)||st(10,t),bq(t)}function bq(t){if(!sr(t)||Rl(t))return t;const e=t[kt];let r;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=th(t,e.scope_.immer_.useStrictShallowCopy_)}else r=th(t,!0);return $i(r,(s,n)=>{yq(r,s,bq(n))}),e&&(e.finalized_=!1),r}function Qv(){const e="replace",s="remove";function n(f,d,m,g){switch(f.type_){case 0:case 2:return o(f,d,m,g);case 1:return i(f,d,m,g);case 3:return a(f,d,m,g)}}function i(f,d,m,g){let{base_:A,assigned_:y}=f,b=f.copy_;b.length<A.length&&([A,b]=[b,A],[m,g]=[g,m]);for(let q=0;q<A.length;q++)if(y[q]&&b[q]!==A[q]){const x=d.concat([q]);m.push({op:e,path:x,value:h(b[q])}),g.push({op:e,path:x,value:h(A[q])})}for(let q=A.length;q<b.length;q++){const x=d.concat([q]);m.push({op:"add",path:x,value:h(b[q])})}for(let q=b.length-1;A.length<=q;--q){const x=d.concat([q]);g.push({op:s,path:x})}}function o(f,d,m,g){const{base_:A,copy_:y}=f;$i(f.assigned_,(b,q)=>{const x=pc(A,b),V=pc(y,b),_=q?Gi(A,b)?e:"add":s;if(x===V&&_===e)return;const w=d.concat(b);m.push(_===s?{op:_,path:w}:{op:_,path:w,value:V}),g.push(_==="add"?{op:s,path:w}:_===s?{op:"add",path:w,value:h(x)}:{op:e,path:w,value:h(x)})})}function a(f,d,m,g){let{base_:A,copy_:y}=f,b=0;A.forEach(q=>{if(!y.has(q)){const x=d.concat([b]);m.push({op:s,path:x,value:q}),g.unshift({op:"add",path:x,value:q})}b++}),b=0,y.forEach(q=>{if(!A.has(q)){const x=d.concat([b]);m.push({op:"add",path:x,value:q}),g.unshift({op:s,path:x,value:q})}b++})}function l(f,d,m,g){m.push({op:e,path:[],value:d===vd?void 0:d}),g.push({op:e,path:[],value:f})}function c(f,d){return d.forEach(m=>{const{path:g,op:A}=m;let y=f;for(let V=0;V<g.length-1;V++){const _=js(y);let w=g[V];typeof w!="string"&&typeof w!="number"&&(w=""+w),(_===0||_===1)&&(w==="__proto__"||w==="constructor")&&st(19),typeof y=="function"&&w==="prototype"&&st(19),y=pc(y,w),typeof y!="object"&&st(18,g.join("/"))}const b=js(y),q=u(m.value),x=g[g.length-1];switch(A){case e:switch(b){case 2:return y.set(x,q);case 3:st(16);default:return y[x]=q}case"add":switch(b){case 1:return x==="-"?y.push(q):y.splice(x,0,q);case 2:return y.set(x,q);case 3:return y.add(q);default:return y[x]=q}case s:switch(b){case 1:return y.splice(x,1);case 2:return y.delete(x);case 3:return y.delete(m.value);default:return delete y[x]}default:st(17,A)}}),f}function u(f){if(!sr(f))return f;if(Array.isArray(f))return f.map(u);if(xo(f))return new Map(Array.from(f.entries()).map(([m,g])=>[m,u(g)]));if(bo(f))return new Set(Array.from(f).map(u));const d=Object.create(Is(f));for(const m in f)d[m]=u(f[m]);return Gi(f,Ri)&&(d[Ri]=f[Ri]),d}function h(f){return mr(f)?u(f):f}Uv("Patches",{applyPatches_:c,generatePatches_:n,generateReplacementPatches_:l})}var Dt=new Yv,Dn=Dt.produce,wq=Dt.produceWithPatches.bind(Dt);Dt.setAutoFreeze.bind(Dt);Dt.setUseStrictShallowCopy.bind(Dt);var wp=Dt.applyPatches.bind(Dt);Dt.createDraft.bind(Dt);Dt.finishDraft.bind(Dt);function Xv(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function Jv(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function Zv(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(r=>typeof r=="function")){const r=t.map(s=>typeof s=="function"?`function ${s.name||"unnamed"}()`:typeof s).join(", ");throw new TypeError(`${e}[${r}]`)}}var Vp=t=>Array.isArray(t)?t:[t];function e0(t){const e=Array.isArray(t[0])?t[0]:t;return Zv(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function t0(t,e){const r=[],{length:s}=t;for(let n=0;n<s;n++)r.push(t[n].apply(null,e));return r}var r0=class{constructor(t){this.value=t}deref(){return this.value}},s0=typeof WeakRef<"u"?WeakRef:r0,n0=0,vp=1;function No(){return{s:n0,v:void 0,o:null,p:null}}function tl(t,e={}){let r=No();const{resultEqualityCheck:s}=e;let n,i=0;function o(){let a=r;const{length:l}=arguments;for(let h=0,f=l;h<f;h++){const d=arguments[h];if(typeof d=="function"||typeof d=="object"&&d!==null){let m=a.o;m===null&&(a.o=m=new WeakMap);const g=m.get(d);g===void 0?(a=No(),m.set(d,a)):a=g}else{let m=a.p;m===null&&(a.p=m=new Map);const g=m.get(d);g===void 0?(a=No(),m.set(d,a)):a=g}}const c=a;let u;if(a.s===vp)u=a.v;else if(u=t.apply(null,arguments),i++,s){const h=n?.deref?.()??n;h!=null&&s(h,u)&&(u=h,i!==0&&i--),n=typeof u=="object"&&u!==null||typeof u=="function"?new s0(u):u}return c.s=vp,c.v=u,u}return o.clearCache=()=>{r=No(),o.resetResultsCount()},o.resultsCount=()=>i,o.resetResultsCount=()=>{i=0},o}function i0(t,...e){const r=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,s=(...n)=>{let i=0,o=0,a,l={},c=n.pop();typeof c=="object"&&(l=c,c=n.pop()),Xv(c,`createSelector expects an output function after the inputs, but received: [${typeof c}]`);const u={...r,...l},{memoize:h,memoizeOptions:f=[],argsMemoize:d=tl,argsMemoizeOptions:m=[]}=u,g=Vp(f),A=Vp(m),y=e0(n),b=h(function(){return i++,c.apply(null,arguments)},...g),q=d(function(){o++;const V=t0(y,arguments);return a=b.apply(null,V),a},...A);return Object.assign(q,{resultFunc:c,memoizedResultFunc:b,dependencies:y,dependencyRecomputations:()=>o,resetDependencyRecomputations:()=>{o=0},lastResult:()=>a,recomputations:()=>i,resetRecomputations:()=>{i=0},memoize:h,argsMemoize:d})};return Object.assign(s,{withTypes:()=>s}),s}var Ml=i0(tl),o0=Object.assign((t,e=Ml)=>{Jv(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const r=Object.keys(t),s=r.map(i=>t[i]);return e(s,(...i)=>i.reduce((o,a,l)=>(o[r[l]]=a,o),{}))},{withTypes:()=>o0});function Vq(t){return({dispatch:r,getState:s})=>n=>i=>typeof i=="function"?i(r,s,t):n(i)}var a0=Vq(),l0=Vq,c0=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Ja:Ja.apply(null,arguments)},u0=t=>t&&typeof t.match=="function";function At(t,e){function r(...s){if(e){let n=e(...s);if(!n)throw new Error(Ke(0));return{type:t,payload:n.payload,..."meta"in n&&{meta:n.meta},..."error"in n&&{error:n.error}}}return{type:t,payload:s[0]}}return r.toString=()=>`${t}`,r.type=t,r.match=s=>Vd(s)&&s.type===t,r}var vq=class bi extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,bi.prototype)}static get[Symbol.species](){return bi}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new bi(...e[0].concat(this)):new bi(...e.concat(this))}};function _p(t){return sr(t)?Dn(t,()=>{}):t}function ah(t,e,r){return t.has(e)?t.get(e):t.set(e,r(e)).get(e)}function h0(t){return typeof t=="boolean"}var d0=()=>function(e){const{thunk:r=!0,immutableCheck:s=!0,serializableCheck:n=!0,actionCreatorCheck:i=!0}=e??{};let o=new vq;return r&&(h0(r)?o.push(a0):o.push(l0(r.extraArgument))),o},Il="RTK_autoBatch",ti=()=>t=>({payload:t,meta:{[Il]:!0}}),Sp=t=>e=>{setTimeout(e,t)},f0=(t={type:"raf"})=>e=>(...r)=>{const s=e(...r);let n=!0,i=!1,o=!1;const a=new Set,l=t.type==="tick"?queueMicrotask:t.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Sp(10):t.type==="callback"?t.queueNotification:Sp(t.timeout),c=()=>{o=!1,i&&(i=!1,a.forEach(u=>u()))};return Object.assign({},s,{subscribe(u){const h=()=>n&&u(),f=s.subscribe(h);return a.add(u),()=>{f(),a.delete(u)}},dispatch(u){try{return n=!u?.meta?.[Il],i=!n,i&&(o||(o=!0,l(c))),s.dispatch(u)}finally{n=!0}}})},p0=t=>function(r){const{autoBatch:s=!0}=r??{};let n=new vq(t);return s&&n.push(f0(typeof s=="object"?s:void 0)),n};function m0(t){const e=d0(),{reducer:r=void 0,middleware:s,devTools:n=!0,preloadedState:i=void 0,enhancers:o=void 0}=t||{};let a;if(typeof r=="function")a=r;else if(Jr(r))a=wd(r);else throw new Error(Ke(1));let l;typeof s=="function"?l=s(e):l=e();let c=Ja;n&&(c=c0({trace:!1,...typeof n=="object"&&n}));const u=Bv(...l),h=p0(u);let f=typeof o=="function"?o(h):h();const d=c(...f);return bd(a,i,d)}function _q(t){const e={},r=[];let s;const n={addCase(i,o){const a=typeof i=="string"?i:i.type;if(!a)throw new Error(Ke(28));if(a in e)throw new Error(Ke(29));return e[a]=o,n},addMatcher(i,o){return r.push({matcher:i,reducer:o}),n},addDefaultCase(i){return s=i,n}};return t(n),[e,r,s]}function g0(t){return typeof t=="function"}function A0(t,e){let[r,s,n]=_q(e),i;if(g0(t))i=()=>_p(t());else{const a=_p(t);i=()=>a}function o(a=i(),l){let c=[r[l.type],...s.filter(({matcher:u})=>u(l)).map(({reducer:u})=>u)];return c.filter(u=>!!u).length===0&&(c=[n]),c.reduce((u,h)=>{if(h)if(mr(u)){const d=h(u,l);return d===void 0?u:d}else{if(sr(u))return Dn(u,f=>h(f,l));{const f=h(u,l);if(f===void 0){if(u===null)return u;throw Error("A case reducer on a non-draftable value must not return undefined")}return f}}return u},a)}return o.getInitialState=i,o}var Sq=(t,e)=>u0(t)?t.match(e):t(e);function gr(...t){return e=>t.some(r=>Sq(r,e))}function Mi(...t){return e=>t.every(r=>Sq(r,e))}function jl(t,e){if(!t||!t.meta)return!1;const r=typeof t.meta.requestId=="string",s=e.indexOf(t.meta.requestStatus)>-1;return r&&s}function wo(t){return typeof t[0]=="function"&&"pending"in t[0]&&"fulfilled"in t[0]&&"rejected"in t[0]}function kd(...t){return t.length===0?e=>jl(e,["pending"]):wo(t)?gr(...t.map(e=>e.pending)):kd()(t[0])}function bn(...t){return t.length===0?e=>jl(e,["rejected"]):wo(t)?gr(...t.map(e=>e.rejected)):bn()(t[0])}function Ol(...t){const e=r=>r&&r.meta&&r.meta.rejectedWithValue;return t.length===0?Mi(bn(...t),e):wo(t)?Mi(bn(...t),e):Ol()(t[0])}function Zr(...t){return t.length===0?e=>jl(e,["fulfilled"]):wo(t)?gr(...t.map(e=>e.fulfilled)):Zr()(t[0])}function lh(...t){return t.length===0?e=>jl(e,["pending","fulfilled","rejected"]):wo(t)?gr(...t.flatMap(e=>[e.pending,e.rejected,e.fulfilled])):lh()(t[0])}var y0="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",Vo=(t=21)=>{let e="",r=t;for(;r--;)e+=y0[Math.random()*64|0];return e},q0=["name","message","stack","code"],Ac=class{constructor(t,e){this.payload=t,this.meta=e}_type},kp=class{constructor(t,e){this.payload=t,this.meta=e}_type},x0=t=>{if(typeof t=="object"&&t!==null){const e={};for(const r of q0)typeof t[r]=="string"&&(e[r]=t[r]);return e}return{message:String(t)}},Cp="External signal was aborted",Ep=(()=>{function t(e,r,s){const n=At(e+"/fulfilled",(l,c,u,h)=>({payload:l,meta:{...h||{},arg:u,requestId:c,requestStatus:"fulfilled"}})),i=At(e+"/pending",(l,c,u)=>({payload:void 0,meta:{...u||{},arg:c,requestId:l,requestStatus:"pending"}})),o=At(e+"/rejected",(l,c,u,h,f)=>({payload:h,error:(s&&s.serializeError||x0)(l||"Rejected"),meta:{...f||{},arg:u,requestId:c,rejectedWithValue:!!h,requestStatus:"rejected",aborted:l?.name==="AbortError",condition:l?.name==="ConditionError"}}));function a(l,{signal:c}={}){return(u,h,f)=>{const d=s?.idGenerator?s.idGenerator(l):Vo(),m=new AbortController;let g,A;function y(q){A=q,m.abort()}c&&(c.aborted?y(Cp):c.addEventListener("abort",()=>y(Cp),{once:!0}));const b=(async function(){let q;try{let V=s?.condition?.(l,{getState:h,extra:f});if(w0(V)&&(V=await V),V===!1||m.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const _=new Promise((w,S)=>{g=()=>{S({name:"AbortError",message:A||"Aborted"})},m.signal.addEventListener("abort",g)});u(i(d,l,s?.getPendingMeta?.({requestId:d,arg:l},{getState:h,extra:f}))),q=await Promise.race([_,Promise.resolve(r(l,{dispatch:u,getState:h,extra:f,requestId:d,signal:m.signal,abort:y,rejectWithValue:(w,S)=>new Ac(w,S),fulfillWithValue:(w,S)=>new kp(w,S)})).then(w=>{if(w instanceof Ac)throw w;return w instanceof kp?n(w.payload,d,l,w.meta):n(w,d,l)})])}catch(V){q=V instanceof Ac?o(null,d,l,V.payload,V.meta):o(V,d,l)}finally{g&&m.signal.removeEventListener("abort",g)}return s&&!s.dispatchConditionRejection&&o.match(q)&&q.meta.condition||u(q),q})();return Object.assign(b,{abort:y,requestId:d,arg:l,unwrap(){return b.then(b0)}})}}return Object.assign(a,{pending:i,rejected:o,fulfilled:n,settled:gr(o,n),typePrefix:e})}return t.withTypes=()=>t,t})();function b0(t){if(t.meta&&t.meta.rejectedWithValue)throw t.payload;if(t.error)throw t.error;return t.payload}function w0(t){return t!==null&&typeof t=="object"&&typeof t.then=="function"}var V0=Symbol.for("rtk-slice-createasyncthunk");function v0(t,e){return`${t}/${e}`}function _0({creators:t}={}){const e=t?.asyncThunk?.[V0];return function(s){const{name:n,reducerPath:i=n}=s;if(!n)throw new Error(Ke(11));const o=(typeof s.reducers=="function"?s.reducers(k0()):s.reducers)||{},a=Object.keys(o),l={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},c={addCase(b,q){const x=typeof b=="string"?b:b.type;if(!x)throw new Error(Ke(12));if(x in l.sliceCaseReducersByType)throw new Error(Ke(13));return l.sliceCaseReducersByType[x]=q,c},addMatcher(b,q){return l.sliceMatchers.push({matcher:b,reducer:q}),c},exposeAction(b,q){return l.actionCreators[b]=q,c},exposeCaseReducer(b,q){return l.sliceCaseReducersByName[b]=q,c}};a.forEach(b=>{const q=o[b],x={reducerName:b,type:v0(n,b),createNotation:typeof s.reducers=="function"};E0(q)?P0(x,q,c,e):C0(x,q,c)});function u(){const[b={},q=[],x=void 0]=typeof s.extraReducers=="function"?_q(s.extraReducers):[s.extraReducers],V={...b,...l.sliceCaseReducersByType};return A0(s.initialState,_=>{for(let w in V)_.addCase(w,V[w]);for(let w of l.sliceMatchers)_.addMatcher(w.matcher,w.reducer);for(let w of q)_.addMatcher(w.matcher,w.reducer);x&&_.addDefaultCase(x)})}const h=b=>b,f=new Map;let d;function m(b,q){return d||(d=u()),d(b,q)}function g(){return d||(d=u()),d.getInitialState()}function A(b,q=!1){function x(_){let w=_[b];return typeof w>"u"&&q&&(w=g()),w}function V(_=h){const w=ah(f,q,()=>new WeakMap);return ah(w,_,()=>{const S={};for(const[k,C]of Object.entries(s.selectors??{}))S[k]=S0(C,_,g,q);return S})}return{reducerPath:b,getSelectors:V,get selectors(){return V(x)},selectSlice:x}}const y={name:n,reducer:m,actions:l.actionCreators,caseReducers:l.sliceCaseReducersByName,getInitialState:g,...A(i),injectInto(b,{reducerPath:q,...x}={}){const V=q??i;return b.inject({reducerPath:V,reducer:m},x),{...y,...A(V,!0)}}};return y}}function S0(t,e,r,s){function n(i,...o){let a=e(i);return typeof a>"u"&&s&&(a=r()),t(a,...o)}return n.unwrapped=t,n}var Sr=_0();function k0(){function t(e,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...r}}return t.withTypes=()=>t,{reducer(e){return Object.assign({[e.name](...r){return e(...r)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:r}},asyncThunk:t}}function C0({type:t,reducerName:e,createNotation:r},s,n){let i,o;if("reducer"in s){if(r&&!T0(s))throw new Error(Ke(17));i=s.reducer,o=s.prepare}else i=s;n.addCase(t,i).exposeCaseReducer(e,i).exposeAction(e,o?At(t,o):At(t))}function E0(t){return t._reducerDefinitionType==="asyncThunk"}function T0(t){return t._reducerDefinitionType==="reducerWithPrepare"}function P0({type:t,reducerName:e},r,s,n){if(!n)throw new Error(Ke(18));const{payloadCreator:i,fulfilled:o,pending:a,rejected:l,settled:c,options:u}=r,h=n(t,i,u);s.exposeAction(e,h),o&&s.addCase(h.fulfilled,o),a&&s.addCase(h.pending,a),l&&s.addCase(h.rejected,l),c&&s.addMatcher(h.settled,c),s.exposeCaseReducer(e,{fulfilled:o||Bo,pending:a||Bo,rejected:l||Bo,settled:c||Bo})}function Bo(){}var R0="task",kq="listener",Cq="completed",Cd="cancelled",M0=`task-${Cd}`,I0=`task-${Cq}`,ch=`${kq}-${Cd}`,j0=`${kq}-${Cq}`,Nl=class{constructor(t){this.code=t,this.message=`${R0} ${Cd} (reason: ${t})`}name="TaskAbortError";message},Ed=(t,e)=>{if(typeof t!="function")throw new TypeError(Ke(32))},rl=()=>{},Eq=(t,e=rl)=>(t.catch(e),t),Tq=(t,e)=>(t.addEventListener("abort",e,{once:!0}),()=>t.removeEventListener("abort",e)),Ps=(t,e)=>{const r=t.signal;r.aborted||("reason"in r||Object.defineProperty(r,"reason",{enumerable:!0,value:e,configurable:!0,writable:!0}),t.abort(e))},Rs=t=>{if(t.aborted){const{reason:e}=t;throw new Nl(e)}};function Pq(t,e){let r=rl;return new Promise((s,n)=>{const i=()=>n(new Nl(t.reason));if(t.aborted){i();return}r=Tq(t,i),e.finally(()=>r()).then(s,n)}).finally(()=>{r=rl})}var O0=async(t,e)=>{try{return await Promise.resolve(),{status:"ok",value:await t()}}catch(r){return{status:r instanceof Nl?"cancelled":"rejected",error:r}}finally{e?.()}},sl=t=>e=>Eq(Pq(t,e).then(r=>(Rs(t),r))),Rq=t=>{const e=sl(t);return r=>e(new Promise(s=>setTimeout(s,r)))},{assign:fn}=Object,Tp={},Bl="listenerMiddleware",N0=(t,e)=>{const r=s=>Tq(t,()=>Ps(s,t.reason));return(s,n)=>{Ed(s);const i=new AbortController;r(i);const o=O0(async()=>{Rs(t),Rs(i.signal);const a=await s({pause:sl(i.signal),delay:Rq(i.signal),signal:i.signal});return Rs(i.signal),a},()=>Ps(i,I0));return n?.autoJoin&&e.push(o.catch(rl)),{result:sl(t)(o),cancel(){Ps(i,M0)}}}},B0=(t,e)=>{const r=async(s,n)=>{Rs(e);let i=()=>{};const a=[new Promise((l,c)=>{let u=t({predicate:s,effect:(h,f)=>{f.unsubscribe(),l([h,f.getState(),f.getOriginalState()])}});i=()=>{u(),c()}})];n!=null&&a.push(new Promise(l=>setTimeout(l,n,null)));try{const l=await Pq(e,Promise.race(a));return Rs(e),l}finally{i()}};return(s,n)=>Eq(r(s,n))},Mq=t=>{let{type:e,actionCreator:r,matcher:s,predicate:n,effect:i}=t;if(e)n=At(e).match;else if(r)e=r.type,n=r.match;else if(s)n=s;else if(!n)throw new Error(Ke(21));return Ed(i),{predicate:n,type:e,effect:i}},Iq=fn(t=>{const{type:e,predicate:r,effect:s}=Mq(t);return{id:Vo(),effect:s,type:e,predicate:r,pending:new Set,unsubscribe:()=>{throw new Error(Ke(22))}}},{withTypes:()=>Iq}),Pp=(t,e)=>{const{type:r,effect:s,predicate:n}=Mq(e);return Array.from(t.values()).find(i=>(typeof r=="string"?i.type===r:i.predicate===n)&&i.effect===s)},uh=t=>{t.pending.forEach(e=>{Ps(e,ch)})},D0=t=>()=>{t.forEach(uh),t.clear()},Rp=(t,e,r)=>{try{t(e,r)}catch(s){setTimeout(()=>{throw s},0)}},jq=fn(At(`${Bl}/add`),{withTypes:()=>jq}),z0=At(`${Bl}/removeAll`),Oq=fn(At(`${Bl}/remove`),{withTypes:()=>Oq}),F0=(...t)=>{console.error(`${Bl}/error`,...t)},L0=(t={})=>{const e=new Map,{extra:r,onError:s=F0}=t;Ed(s);const n=u=>(u.unsubscribe=()=>e.delete(u.id),e.set(u.id,u),h=>{u.unsubscribe(),h?.cancelActive&&uh(u)}),i=u=>{const h=Pp(e,u)??Iq(u);return n(h)};fn(i,{withTypes:()=>i});const o=u=>{const h=Pp(e,u);return h&&(h.unsubscribe(),u.cancelActive&&uh(h)),!!h};fn(o,{withTypes:()=>o});const a=async(u,h,f,d)=>{const m=new AbortController,g=B0(i,m.signal),A=[];try{u.pending.add(m),await Promise.resolve(u.effect(h,fn({},f,{getOriginalState:d,condition:(y,b)=>g(y,b).then(Boolean),take:g,delay:Rq(m.signal),pause:sl(m.signal),extra:r,signal:m.signal,fork:N0(m.signal,A),unsubscribe:u.unsubscribe,subscribe:()=>{e.set(u.id,u)},cancelActiveListeners:()=>{u.pending.forEach((y,b,q)=>{y!==m&&(Ps(y,ch),q.delete(y))})},cancel:()=>{Ps(m,ch),u.pending.delete(m)},throwIfCancelled:()=>{Rs(m.signal)}})))}catch(y){y instanceof Nl||Rp(s,y,{raisedBy:"effect"})}finally{await Promise.all(A),Ps(m,j0),u.pending.delete(m)}},l=D0(e);return{middleware:u=>h=>f=>{if(!Vd(f))return h(f);if(jq.match(f))return i(f.payload);if(z0.match(f)){l();return}if(Oq.match(f))return o(f.payload);let d=u.getState();const m=()=>{if(d===Tp)throw new Error(Ke(23));return d};let g;try{if(g=h(f),e.size>0){const A=u.getState(),y=Array.from(e.values());for(const b of y){let q=!1;try{q=b.predicate(f,A,d)}catch(x){q=!1,Rp(s,x,{raisedBy:"predicate"})}q&&a(b,f,u,m)}}}finally{d=Tp}return g},startListening:i,stopListening:o,clearListeners:l}},U0=t=>"reducerPath"in t&&typeof t.reducerPath=="string",$0=t=>t.flatMap(e=>U0(e)?[[e.reducerPath,e.reducer]]:Object.entries(e)),Td=Symbol.for("rtk-state-proxy-original"),G0=t=>!!t&&!!t[Td],H0=new WeakMap,W0=(t,e)=>ah(H0,t,()=>new Proxy(t,{get:(r,s,n)=>{if(s===Td)return r;const i=Reflect.get(r,s,n);if(typeof i>"u"){const o=e[s.toString()];if(o){const a=o(void 0,{type:Vo()});if(typeof a>"u")throw new Error(Ke(24));return a}}return i}})),Y0=t=>{if(!G0(t))throw new Error(Ke(25));return t[Td]},K0=(t={})=>t;function Q0(...t){const e=Object.fromEntries($0(t)),r=()=>Object.keys(e).length?wd(e):K0;let s=r();function n(a,l){return s(a,l)}n.withLazyLoadedSlices=()=>n;const i=(a,l={})=>{const{reducerPath:c,reducer:u}=a,h=e[c];return!l.overrideExisting&&h&&h!==u||(e[c]=u,s=r()),n},o=Object.assign(function(l,c){return function(h,...f){return l(W0(c?c(h,...f):h,e),...f)}},{original:Y0});return Object.assign(n,{inject:i,selector:o})}function Ke(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}const Pd=v.createContext(null),X0=({gameApi:t,children:e})=>p.jsx(Pd,{value:t,children:e}),zn=()=>{const t=v.useContext(Pd);if(t===null)throw new Error("useGameApi must be used within a GameApiProvider");if(t===void 0)throw new Error("useGameApi must be called once we have a GameApi");return t},Nq=()=>{const t=v.useContext(Pd);if(t===null)throw new Error("useGameApi must be used within a GameApiProvider");return t},Bq=L0(),Rd=Bq.startListening.withTypes();function J0(t){var e="";return r(t),e;function r(n){if(n===null||typeof n!="object"||n.toJSON!=null)e+=JSON.stringify(n);else if(Array.isArray(n)){e+="[";var i=!1;n.forEach(function(a){i&&(e+=","),i=!0,a===void 0&&(a=null),r(a)}),e+="]"}else{e+="{";var o=Object.keys(n).filter(function(a){return n[a]!==void 0}).sort();o.forEach(function(a,l){return s(n,a,l)}),e+="}"}}function s(n,i,o){o>0&&(e+=","),e+=JSON.stringify(i),e+=":",r(n[i])}}var Md="persist:",Id="persist/FLUSH",vo="persist/REHYDRATE",jd="persist/PAUSE",Od="persist/PERSIST",Nd="persist/PURGE",Bd="persist/REGISTER",Dq=-1;function Da(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Da=function(r){return typeof r}:Da=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Da(t)}function Mp(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function Z0(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Mp(r,!0).forEach(function(s){e_(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Mp(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function e_(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function t_(t,e,r,s){s.debug;var n=Z0({},r);return t&&Da(t)==="object"&&Object.keys(t).forEach(function(i){i!=="_persist"&&e[i]===r[i]&&(n[i]=t[i])}),n}function r_(t){var e=t.blacklist||null,r=t.whitelist||null,s=t.transforms||[],n=t.throttle||0,i="".concat(t.keyPrefix!==void 0?t.keyPrefix:Md).concat(t.key),o=t.storage,a;t.serialize===!1?a=function(V){return V}:typeof t.serialize=="function"?a=t.serialize:a=s_;var l=t.writeFailHandler||null,c={},u={},h=[],f=null,d=null,m=function(V){Object.keys(V).forEach(function(_){y(_)&&c[_]!==V[_]&&h.indexOf(_)===-1&&h.push(_)}),Object.keys(c).forEach(function(_){V[_]===void 0&&y(_)&&h.indexOf(_)===-1&&c[_]!==void 0&&h.push(_)}),f===null&&(f=setInterval(g,n)),c=V};function g(){if(h.length===0){f&&clearInterval(f),f=null;return}var x=h.shift(),V=s.reduce(function(_,w){return w.in(_,x,c)},c[x]);if(V!==void 0)try{u[x]=a(V)}catch(_){console.error("redux-persist/createPersistoid: error serializing state",_)}else delete u[x];h.length===0&&A()}function A(){Object.keys(u).forEach(function(x){c[x]===void 0&&delete u[x]}),d=o.setItem(i,a(u)).catch(b)}function y(x){return!(r&&r.indexOf(x)===-1&&x!=="_persist"||e&&e.indexOf(x)!==-1)}function b(x){l&&l(x)}var q=function(){for(;h.length!==0;)g();return d||Promise.resolve()};return{update:m,flush:q}}function s_(t){return JSON.stringify(t)}function n_(t){var e=t.transforms||[],r="".concat(t.keyPrefix!==void 0?t.keyPrefix:Md).concat(t.key),s=t.storage;t.debug;var n;return t.deserialize===!1?n=function(o){return o}:typeof t.deserialize=="function"?n=t.deserialize:n=i_,s.getItem(r).then(function(i){if(i)try{var o={},a=n(i);return Object.keys(a).forEach(function(l){o[l]=e.reduceRight(function(c,u){return u.out(c,l,a)},n(a[l]))}),o}catch(l){throw l}else return})}function i_(t){return JSON.parse(t)}function o_(t){var e=t.storage,r="".concat(t.keyPrefix!==void 0?t.keyPrefix:Md).concat(t.key);return e.removeItem(r,a_)}function a_(t){}function Ip(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function wr(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ip(r,!0).forEach(function(s){l_(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ip(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function l_(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c_(t,e){if(t==null)return{};var r=u_(t,e),s,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)s=i[n],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(r[s]=t[s])}return r}function u_(t,e){if(t==null)return{};var r={},s=Object.keys(t),n,i;for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&(r[n]=t[n]);return r}var h_=5e3;function d_(t,e){var r=t.version!==void 0?t.version:Dq;t.debug;var s=t.stateReconciler===void 0?t_:t.stateReconciler,n=t.getStoredState||n_,i=t.timeout!==void 0?t.timeout:h_,o=null,a=!1,l=!0,c=function(h){return h._persist.rehydrated&&o&&!l&&o.update(h),h};return function(u,h){var f=u||{},d=f._persist,m=c_(f,["_persist"]),g=m;if(h.type===Od){var A=!1,y=function(S,k){A||(h.rehydrate(t.key,S,k),A=!0)};if(i&&setTimeout(function(){!A&&y(void 0,new Error('redux-persist: persist timed out for persist key "'.concat(t.key,'"')))},i),l=!1,o||(o=r_(t)),d)return wr({},e(g,h),{_persist:d});if(typeof h.rehydrate!="function"||typeof h.register!="function")throw new Error("redux-persist: either rehydrate or register is not a function on the PERSIST action. This can happen if the action is being replayed. This is an unexplored use case, please open an issue and we will figure out a resolution.");return h.register(t.key),n(t).then(function(w){var S=t.migrate||function(k,C){return Promise.resolve(k)};S(w,r).then(function(k){y(k)},function(k){y(void 0,k)})},function(w){y(void 0,w)}),wr({},e(g,h),{_persist:{version:r,rehydrated:!1}})}else{if(h.type===Nd)return a=!0,h.result(o_(t)),wr({},e(g,h),{_persist:d});if(h.type===Id)return h.result(o&&o.flush()),wr({},e(g,h),{_persist:d});if(h.type===jd)l=!0;else if(h.type===vo){if(a)return wr({},g,{_persist:wr({},d,{rehydrated:!0})});if(h.key===t.key){var b=e(g,h),q=h.payload,x=s!==!1&&q!==void 0?s(q,u,b,t):b,V=wr({},x,{_persist:wr({},d,{rehydrated:!0})});return c(V)}}}if(!d)return e(u,h);var _=e(g,h);return _===g?u:c(wr({},_,{_persist:d}))}}function jp(t){return m_(t)||p_(t)||f_()}function f_(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function p_(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}function m_(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function Op(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function hh(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Op(r,!0).forEach(function(s){g_(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Op(r).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function g_(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var zq={registry:[],bootstrapped:!1},A_=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:zq,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case Bd:return hh({},e,{registry:[].concat(jp(e.registry),[r.key])});case vo:var s=e.registry.indexOf(r.key),n=jp(e.registry);return n.splice(s,1),hh({},e,{registry:n,bootstrapped:n.length===0});default:return e}};function y_(t,e,r){var s=bd(A_,zq,void 0),n=function(l){s.dispatch({type:Bd,key:l})},i=function(l,c,u){var h={type:vo,payload:c,err:u,key:l};t.dispatch(h),s.dispatch(h)},o=hh({},s,{purge:function(){var l=[];return t.dispatch({type:Nd,result:function(u){l.push(u)}}),Promise.all(l)},flush:function(){var l=[];return t.dispatch({type:Id,result:function(u){l.push(u)}}),Promise.all(l)},pause:function(){t.dispatch({type:jd})},persist:function(){t.dispatch({type:Od,register:n,rehydrate:i})}});return o.persist(),o}function q_(t,e){return function(r,s){if(!r)return Promise.resolve(void 0);var n=r._persist&&r._persist.version!==void 0?r._persist.version:Dq;if(n===s||n>s)return Promise.resolve(r);var i=Object.keys(t).map(function(a){return parseInt(a)}).filter(function(a){return s>=a&&a>n}).sort(function(a,l){return a-l});try{var o=i.reduce(function(a,l){return t[l](a)},r);return Promise.resolve(o)}catch(a){return Promise.reject(a)}}}const Yr=1e-4,rr=(t,e)=>Math.abs(t-e)<Yr,f$=t=>t===0?Yr:Math.abs(t)<Yr?Yr*Math.sign(t):t,pn=["away","towards","left","right"],x_=["awayRight","towardsRight","towardsLeft","awayLeft"],wn=[...pn,...x_],Fq=t=>t==="away"||t==="towards"?"y":"x",p$=t=>t==="away"?"towards":t==="towards"?"away":t==="left"?"right":"left",Lq=t=>Dl(Fq(t)),Dl=t=>t==="x"?"y":"x",Kr=(t,...e)=>{const r={x:t.x,y:t.y};for(const s of e)r.x+=s.x??0,r.y+=s.y??0;return r},b_=(t,...e)=>{const r={x:t.x,y:t.y};for(const s of e)r.x-=s.x??0,r.y-=s.y??0;return r},Uq=(t,e)=>({x:t.x*e,y:t.y*e}),m$=(t,e)=>(t.x*=e,t.y*=e,t),Qt=(t,e)=>({x:t.x*e,y:t.y*e,z:t.z*e}),Np=(t,e,r)=>{const s=t;return s.x=e.x*r,s.y=e.y*r,s.z=e.z*r,s},w_=(t,e)=>(t.x*=e,t.y*=e,t.z*=e,t),V_=(t,e)=>({x:t.x*e.x,y:t.y*e.y,z:t.z*e.z}),Fn=({x:t,y:e,z:r})=>Math.hypot(t,e,r),$q=({x:t,y:e})=>Math.hypot(t,e),v_=({x:t,y:e,z:r})=>t**2+e**2+r**2,__=({x:t,y:e})=>t**2+e**2,S_=t=>{const e=Fn(t);if(e===0)throw new Error("unitVector called with zero length vector");return Qt(t,1/e)},un=t=>{const e=Fn(t);if(e===0)throw new Error("unitVectorInPlace called with zero length vector");return w_(t,1/e)},U=(...t)=>{if(t.length===0)return{x:0,y:0,z:0};const[e,...r]=t,s={x:e.x??0,y:e.y??0,z:e.z??0};for(const n of r)s.x+=n.x??0,s.y+=n.y??0,s.z+=n.z??0;return s},k_=(t,...e)=>{for(const r of e)t.x+=r.x??0,t.y+=r.y??0,t.z+=r.z??0;return t},Gq=(...t)=>t.reduce(({x:e,y:r,z:s},{x:n,y:i,z:o})=>({x:e*n,y:r*i,z:s*o}),_o),jr=(t,...e)=>{const r={x:t.x,y:t.y,z:t.z};for(const s of e)r.x-=s.x??0,r.y-=s.y??0,r.z-=s.z??0;return r},C_=(t,...e)=>{for(const r of e)t.x-=r.x??0,t.y-=r.y??0,t.z-=r.z??0;return t},Dd=({x:t,y:e,z:r},{x:s,y:n,z:i})=>t===s&&e===n&&r===i,E_=({x:t,y:e},{x:r,y:s})=>t===r&&e===s,g$=t=>{const{x:e}=t,r=Math.round(e),s=!Number.isInteger(e)&&rr(e,r),{y:n}=t,i=Math.round(n),o=!Number.isInteger(n)&&rr(n,i),{z:a}=t,l=Math.round(a),c=!Number.isInteger(a)&&rr(t.z,l);return s||o||c?{x:s?r:e,y:o?i:n,z:c?l:a}:t},Hq=Object.freeze({x:0,y:0}),ee=Object.freeze({x:0,y:0,z:0}),_o=Object.freeze({x:1,y:1,z:1}),A$=Object.freeze({x:1,y:1,z:0}),y$=Object.freeze({x:1,y:0,z:1}),q$=Object.freeze({x:0,y:1,z:1}),x$=Object.freeze({x:1,y:0,z:0}),b$=Object.freeze({x:0,y:1,z:0}),T_=["x","y","z"],nl=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,P_=({x:t,y:e})=>{if(!(rr(t,0)&&rr(e,0)))return e>t?e>-t?"away":"right":e>-t?"left":"towards"},R_=["right","towardsRight","towards","towardsLeft","left","awayLeft","away","awayRight"],zd=({x:t,y:e})=>{if(rr(t,0)&&rr(e,0))return;const r=Math.atan2(-e,-t),s=Math.round(8*r/(2*Math.PI))&7;return R_[s]},w$=({x:t,y:e},{x:r,y:s})=>Math.abs(r-t)**2+Math.abs(s-e)**2,V$=(t,e)=>{const r=t.x*e.x+t.y*e.y+t.z*e.z;if(r<=0)return!1;const s=t.x*t.x+t.y*t.y+t.z*t.z,n=e.x*e.x+e.y*e.y+e.z*e.z;return Math.abs(r*r-s*n)<Yr},v$=t=>{t.x=0,t.y=0,t.z=0},Wq=["lookUp","lookDown","lookLeft","lookRight"],Yq=["jump","fire","carry","swop","swop.head","swop.heels","hold","toggleColourisation","toggleCrtFilter","cycleResolution","toggleShowFps","menu_select","menu_openOrExit","menu_exit","map",...pn,"lookShift",...Wq,"pageUp","pageDown","home","end"],Kq=[...Yq];var Tt={},yc={},qc={},Bp;function zl(){if(Bp)return qc;Bp=1;function t(e){return typeof e<"u"}return qc.notUndefined=t,qc}var Dp;function Qq(){if(Dp)return yc;Dp=1;const{notUndefined:t}=zl();function e(r){return r!=null&&t(r[Symbol.iterator])}return yc.isIterable=e,yc}var xc={},zp;function M_(){return zp||(zp=1,xc.isLoopable=Qq().isIterable),xc}var bc={},Fp;function I_(){if(Fp)return bc;Fp=1;const{notUndefined:t}=zl();function e(r){return r==null||t(r[Symbol.iterator])}return bc.isWrappable=e,bc}var Do={},Lp;function j_(){if(Lp)return Do;Lp=1;function*t(r){yield*r}Do.wrap=t;function*e(r){r!=null&&(yield*r)}return Do.nullableWrap=e,Do}var zo={},Up;function O_(){if(Up)return zo;Up=1;function t(s,n=s.length,i=[]){return(...o)=>n<=o.length?s(...i,...o):t(s,n-o.length,[...i,...o])}zo.curry=t;function e(s,n){const{fn:i,validateArgs:o,variadic:a,reduces:l,growRight:c,minArgs:u,maxArgs:h,isIterable:f,iterableType:d,applyOnIterableArgs:m,IterableClass:g}=s;if(n.length>u){let A=!0;const y=a?n.findIndex((q,x)=>f(q)&&x>=u):Math.min(h,n.length-1),b=a?n.length:y+1;if(a)for(let q=y;q<n.length;q++)A=A&&f(n[q]);else A=f(n[y]);if(n.length>h&&(y===-1||!A)){const q=a?`...${d}s`:d,x=`${i.name} takes up to ${h} arguments, followed by ${q}. You already passed ${n.length} arguments`;throw a?new Error(`${x} and the following arguments were not all ${d}s`):new Error(`${x} and the last argument was not ${d}`)}if(y>=0&&A){for(let x=y;x<b;x++)n[x]=m(n[x]);const q=a?n.slice(y):n[y];return n.splice(y),c||n.reverse(),n.unshift(q),o(n),l?i(...n):new g(i,n)}}return r(s,n)}function r(s,n=[]){return(...i)=>{if(i.length===0)throw new Error("Cannot make a partial application with no arguments");return i.unshift(...n),e(s,i)}}return zo.variadicCurryWithValidation=r,zo}var ri={},$p;function N_(){if($p)return ri;$p=1;const t=Symbol.for("_");ri._=t;const e=Symbol("__iterate");ri.__iterate=e;const r=Symbol("split");return ri.split=r,ri}var Gp;function bt(){if(Gp)return Tt;Gp=1;const{isIterable:t}=Qq(),{isLoopable:e}=M_(),{isWrappable:r}=I_(),{nullableWrap:s}=j_(),{variadicCurryWithValidation:n}=O_(),{_:i,__iterate:o}=N_();Tt.wrap=s,Tt.isIterable=t,Tt.isLoopable=e,Tt.isWrappable=r;function a(g){if(r(g))return t(g)?g:s(g);throw typeof g.next=="function"?new TypeError("iter-tools received a value that looked like an iterator but was not iterable. Get help fixing this: https://github.com/iter-tools/iter-tools/wiki/Making-iterators-iterable"):new TypeError("Expected an iterable, null, or undefined")}Tt.ensureIterable=a;function l(g){"return"in g&&g.return()}Tt.callReturn=l;function c(g,A){this[i]={fn:g,args:A,staticIterator:null}}Tt.BaseIterableIterator=c,Object.assign(c.prototype,{constructor:c,[o](){const{fn:g,args:A}=this[i];return g(...A)},next(){const g=this[i];return g.staticIterator=g.staticIterator||this[o](),g.staticIterator.next()},return(g){const A=this[i];return A.staticIterator=A.staticIterator||this[o](),A.staticIterator.return(g)},throw(g){const A=this[i];return A.staticIterator=A.staticIterator||this[o](),A.staticIterator.throw(g)}});function u(...g){c.apply(this,g)}Tt.IterableIterator=u,u.prototype=Object.assign(Object.create(c.prototype),{constructor:u,[Symbol.iterator](){return this[o]()}});function h(g,A={}){const{validateArgs:y=S=>{},variadic:b=!1,reduces:q=!1,growRight:x=!1,minArgs:V=g.length-1,maxArgs:_=g.length-1,applyOnIterableArgs:w=a}=A;return{fn:g,validateArgs:y,variadic:b,reduces:q,growRight:x,minArgs:V,maxArgs:_,isIterable:r,iterableType:"iterable",applyOnIterableArgs:w,IterableClass:u}}function f(g){return[...g]}Tt.cache=f;function d(g,{validateArgs:A=y=>y}={}){return(...y)=>(A(y),new u(g,y))}Tt.wrapWithIterableIterator=d;const m=(g,A)=>n(h(g,A));return Tt.iterableCurry=m,Tt}var wc={},Hp;function B_(){if(Hp)return wc;Hp=1;class t{[Symbol.iterator](){return this}}return wc.IterableIterator=t,wc}var si={},Wp;function Xq(){if(Wp)return si;Wp=1;function t(s,n=!1){return typeof s=="number"&&!isNaN(s)&&isFinite(s)&&!(n&&s===0)}si.isInteger=t;function e(s,n=!1){return t(s)&&(n?s>0:s>=0)}si.isPositiveInteger=e;function r(s,n=!1){return typeof s=="number"&&!isNaN(s)&&!(n&&s===0)}return si.isIntegerOrInfinite=r,si}var Fo={},Yp;function D_(){if(Yp)return Fo;Yp=1;const{iterableCurry:t}=bt();function*e(s,n){let i=0;for(const o of s)yield n(o,i++)}Fo.__map=e;const r=t(e);return Fo.map=r,Fo}var Lo={},Kp;function z_(){if(Kp)return Lo;Kp=1;const{ensureIterable:t}=bt();function e(s){const n=[];for(const i of s)n.push(i);return n}Lo.__toArray=e;function r(s){return e(t(s))}return Lo.toArray=r,Lo}var Vc={},Qp;function Jq(){if(Qp)return Vc;Qp=1;function t(e){return typeof e=="object"&&e!==null}return Vc.isObject=t,Vc}var vc={},Xp;function F_(){if(Xp)return vc;Xp=1;function t(e,r){for(const s of e)r(s)}return vc.parallelEach=t,vc}var _c={},Jp;function L_(){if(Jp)return _c;Jp=1;const{ensureIterable:t,callReturn:e}=bt(),r=Symbol.for("_");class s{constructor(o){this.peekr=o}next(){const{peekr:o}=this,{current:a}=o;return o.advance(),a}return(){return this.peekr.return(),{value:void 0,done:!0}}[Symbol.iterator](){return this}}class n{static from(o,...a){const l=t(o)[Symbol.iterator](),c=l.next();return new this(l,c,...a)}constructor(o,a){this[r]={iterator:o,current:a,index:0}}get current(){return this[r].current}get value(){return this[r].current.value}get done(){return this[r].current.done}get index(){return this[r].index}advance(){const o=this[r];return o.current.done||(o.index++,o.current=o.iterator.next()),this}return(){const o=this[r];return this.done||e(o.iterator),o.current={value:void 0,done:!0},this}asIterator(){return new s(this)}}return _c.Peekerator=n,_c}var Sc={},Zp;function U_(){if(Zp)return Sc;Zp=1;const{isInteger:t}=Xq(),{isObject:e}=Jq(),{notUndefined:r}=zl(),s=n=>function(o){if(e(o[1])){const{start:a,step:l}=o[1];o[1]=a,o[2]=l}if(r(o[2])&&(o[2]=Number(o[2]),!t(o[2],!0)))throw new Error(`step argument to ${n} must be a non-zero integer`)};return Sc.makeValidateArgs=s,Sc}var ni={},em;function $_(){if(em)return ni;em=1;const{iterableCurry:t,callReturn:e}=bt(),{IterableIterator:r}=B_(),{parallelEach:s}=F_(),{Peekerator:n}=L_(),{__map:i}=D_(),{__toArray:o}=z_(),a=Symbol.for("_"),l=Symbol.for("__advance");class c extends n{constructor(A,y,b){super(A,y),this[a].inputSummary=b}advance(){this[a].inputSummary.advanceBuffer(this)}[l](){super.advance()}}class u{constructor(){this.buffers=[],this.notDoneBuffer=null,this.index=0}init(A){this.buffers=A,this.updateNotDone()}updateNotDone(){this.notDoneBuffer=this.buffers.find(A=>!A.done)}advanceBuffer(A){const y=A.done;A[l](),this.index++,!y&&A.done&&this.updateNotDone()}}class h{constructor(A){this[a]=A}advance(){throw new Error("advance() is not supported on an interleave summary")}get current(){return{value:this.value,done:this.done}}get value(){return this[a].notDoneBuffer}get done(){return this[a].notDoneBuffer===void 0}get index(){return this[a].index}}ni.InputSummary=h;class f extends r{constructor(A,y,b){super(),this.sources=A,this.strategy=y,this.options=b,this.initialized=!1,this.inputSummary=new u(A)}init(){this.initialized=!0;const{strategy:A,options:y,inputSummary:b}=this;this.buffers=o(i(this.sources,q=>c.from(q,b))),this.iterator=A(y,new h(b),...this.buffers),b.init(this.buffers)}returnBuffers(){s(this.buffers,A=>A.return())}next(){this.initialized||this.init();const A=this.iterator.next();return A.done&&this.returnBuffers(),A}return(){return e(this.iterator),this.returnBuffers(),{value:void 0,done:!0}}}function d(g,A,y={}){return new f(g,A,y)}ni.__interleave=d;const m=t(d,{variadic:!0,growRight:!0,minArgs:1,maxArgs:2});return ni.interleave=m,ni}var Uo={},tm;function G_(){if(tm)return Uo;tm=1;const{wrapWithIterableIterator:t,ensureIterable:e}=bt();function*r(...n){for(const i of n)yield*e(i)}Uo.__concat=r;const s=t(r);return Uo.concat=s,Uo}var $o={},Go={},rm;function Zq(){if(rm)return Go;rm=1;const{iterableCurry:t,callReturn:e}=bt();function r(n,i){const o=n[Symbol.iterator](),{value:a,done:l}=o.next();return l?i:(e(o),a)}Go.__firstOr=r;const s=t(r,{reduces:!0});return Go.firstOr=s,Go}var sm;function H_(){if(sm)return $o;sm=1;const{iterableCurry:t}=bt(),{__firstOr:e}=Zq();function r(n){return e(n,void 0)}$o.__first=r;const s=t(r,{reduces:!0});return $o.first=s,$o}var Ho={},nm;function W_(){if(nm)return Ho;nm=1;const{iterableCurry:t}=bt(),{__firstOr:e}=Zq(),r=Symbol("none");function s(i){return e(i,r)===r}Ho.__isEmpty=s;const n=t(s,{reduces:!0});return Ho.isEmpty=n,Ho}var Wo={},im;function Y_(){if(im)return Wo;im=1;const{wrapWithIterableIterator:t}=bt(),{hasOwnProperty:e}=Object.prototype;function*r(n){if(n!=null)for(const i in n)e.call(n,i)&&(yield[i,n[i]])}Wo.__objectEntries=r;const s=t(r,{validateArgs(n){if(!(n[0]==null||typeof n[0]=="object"))throw new Error("obj argument to objectEntries must be an object, null, or undefined")}});return Wo.objectEntries=s,Wo}var Yo={},om;function K_(){if(om)return Yo;om=1;const{wrapWithIterableIterator:t}=bt(),{hasOwnProperty:e}=Object.prototype;function*r(n){if(n!=null)for(const i in n)e.call(n,i)&&(yield i)}Yo.__objectKeys=r;const s=t(r,{validateArgs(n){if(!(n[0]==null||typeof n[0]=="object"))throw new Error("obj argument to objectKeys must be an object, null, or undefined")}});return Yo.objectKeys=s,Yo}var Ko={},am;function Q_(){if(am)return Ko;am=1;const{wrapWithIterableIterator:t}=bt(),{hasOwnProperty:e}=Object.prototype;function*r(n){if(n!=null)for(const i in n)e.call(n,i)&&(yield n[i])}Ko.__objectValues=r;const s=t(r,{validateArgs(n){if(!(n[0]==null||typeof n[0]=="object"))throw new Error("obj argument to objectValues must be an object, null, or undefined")}});return Ko.objectValues=s,Ko}var Qo={},lm;function X_(){if(lm)return Qo;lm=1;const{wrapWithIterableIterator:t}=bt(),{isInteger:e,isIntegerOrInfinite:r}=Xq(),{isObject:s}=Jq(),{notUndefined:n}=zl();function*i(a=0,l=1/0,c=1){for(let u=a;c>0?u<l:u>l;u+=c)yield u}Qo.__range=i;const o=t(i,{growRight:!0,validateArgs(a){let[l,c=1/0,u]=a,h;if(s(l)?{start:h,end:c,step:u}=l:a.length>1?h=l:c=l,n(h)&&!e(h))throw new TypeError("The specified start was not an integer");if(n(c)&&!r(c))throw new TypeError("The specified end was not an integer or infinite");if(n(u)&&!e(u,!0))throw new TypeError("The specified step was not a non-zero integer");a[0]=h,a[1]=c,a[2]=u}});return Qo.range=o,Qo}var Xo={},cm;function J_(){if(cm)return Xo;cm=1;const{iterableCurry:t}=bt(),{__interleave:e}=$_(),{makeValidateArgs:r}=U_();function*s({start:o,step:a},l,...c){o=o%c.length;for(let u=o;!l.done;u=(u+a)%c.length){const h=c[u];h.done||(yield h.value,h.advance())}}function n(o,a=1,l=0){return e(o,s,{start:l,step:a})}Xo.__roundRobin=n;const i=t(n,{variadic:!0,minArgs:0,maxArgs:2,validateArgs:r("roundRobin")});return Xo.roundRobin=i,Xo}var Jo={},um;function Z_(){if(um)return Jo;um=1;const{ensureIterable:t}=bt();function e(s){const n=t(s);let i=0;for(const o of n)i++;return i}Jo.__size=e;const r=e;return Jo.size=r,Jo}var Zo={},hm;function eS(){if(hm)return Zo;hm=1;const{iterableCurry:t}=bt();function*e(s,n){if(n===0)return;let i=0;for(const o of s)if(yield o,++i===n)break}Zo.__take=e;const r=t(e);return Zo.take=r,Zo}var kc,dm;function tS(){return dm||(dm=1,kc=G_().concat),kc}var rS=tS();const sS=Xe(rS);var Cc,fm;function nS(){return fm||(fm=1,Cc=H_().first),Cc}var iS=nS();const ex=Xe(iS);var Ec,pm;function oS(){return pm||(pm=1,Ec=W_().isEmpty),Ec}var aS=oS();const mm=Xe(aS);var Tc,gm;function lS(){return gm||(gm=1,Tc=Y_().objectEntries),Tc}var cS=lS();const Fd=Xe(cS);var Pc,Am;function uS(){return Am||(Am=1,Pc=K_().objectKeys),Pc}var hS=uS();const tx=Xe(hS);var Rc,ym;function dS(){return ym||(ym=1,Rc=Q_().objectValues),Rc}var fS=dS();const Dr=Xe(fS);var Mc,qm;function pS(){return qm||(qm=1,Mc=X_().range),Mc}var mS=pS();const rx=Xe(mS);var Ic,xm;function gS(){return xm||(xm=1,Ic=J_().roundRobin),Ic}var AS=gS();const yS=Xe(AS);var jc,bm;function qS(){return bm||(bm=1,jc=Z_().size),jc}var xS=qS();const dh=Xe(xS);var Oc,wm;function bS(){return wm||(wm=1,Oc=eS().take),Oc}var wS=bS();const VS=Xe(wS),Ln=Object.entries,sx=Fd,nx=Object.keys,ix=tx,vS=Object.fromEntries,Un=Object.fromEntries,ox={presses:Un(Kq.map(t=>[t,{keys:[],gamepadButtons:[]}])),axes:{x:[],y:[],xLook:[],yLook:[]},radialAxes:{xy:[]}},ea=(t,e)=>Array.from(new Set([...t??[],...e??[]]));function zs(...t){const e=new Set,r=new Set,s=new Set,n=new Set;return t.reduceRight((i,o)=>{const a=new Set(e),l=new Set(r),c=new Set(s),u=new Set(n);for(const d of Kq){const m=o?.presses?.[d]?.keys??[],g=o?.presses?.[d]?.gamepadButtons??[],A=m.filter(b=>!a.has(b)),y=g.filter(b=>!l.has(b));i.presses[d]={keys:ea(i.presses[d]?.keys,A),gamepadButtons:ea(i.presses[d]?.gamepadButtons,y)};for(const b of m)e.add(b);for(const b of g)r.add(b)}for(const d of["x","y","xLook","yLook"]){const m=o.axes?.[d]??[],g=m.filter(A=>!c.has(A));i.axes[d]=ea(i.axes[d],g);for(const A of m)s.add(A)}const h=o.radialAxes?.xy??[],f=h.filter(d=>!u.has(d));i.radialAxes&&(i.radialAxes.xy=ea(i.radialAxes.xy,f));for(const d of h)n.add(d);return i},structuredClone(ox))}const Qe=t=>t[Symbol.iterator](),Ld=(t,e)=>{const s=Qe(sx(t)).map(e).filter(n=>n!==void 0);return vS(s)},$n={buttons:{dPadDown:13,dPadUp:12,dPadLeft:14,dPadRight:15,a:0,b:1,x:2,y:3,lb:4,lt:6,rb:5,rt:7,select:8,start:9,lPress:10,rPress:11},axes:{lStickX:0,lStickY:1,rStickX:2,rStickY:3},radialAxes:{}},_S={buttons:{a:0,b:1,x:3,y:4,lb:6,lt:8,rb:7,rt:9,select:10,start:11,l3:2,r3:5},axes:{lStickX:0,lStickY:1,rStickX:2,rStickY:5},radialAxes:{xy:9}},Vm=Ld($n.buttons,([t,e])=>[e,t]),SS={start:"1",coin:"5",directions:{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},buttons:["Control","Alt"," ","Shift","Z","X"]},Us={directions:{up:"R",down:"F",left:"D",right:"G"},buttons:["A","S","Q","W","I","K"]},Ft={dPadUp:"C",dPadDown:"D",dPadLeft:"E",dPadRight:"F",a:"J",b:"G",y:"H",x:"I",rb:"M",start:"O",select:"N"},Fs={presses:{right:{keys:["ArrowRight"]},towards:{keys:["ArrowDown"]},left:{keys:["ArrowLeft"]},away:{keys:["ArrowUp"]},jump:{keys:[" ","`","Z","\\"]},carry:{keys:["Shift","`","Z","\\"]},fire:{keys:["D"]},swop:{keys:["Enter"]},"swop.head":{keys:["[","A"]},"swop.heels":{keys:["]","S"]},hold:{keys:["P"]},map:{keys:["M","Tab"]},menu_openOrExit:{keys:["Escape",""]},menu_select:{keys:["Enter"]},toggleCrtFilter:{keys:["F8","T"]},toggleShowFps:{keys:["F9"]},toggleColourisation:{keys:["F10"]},cycleResolution:{keys:["0"]},pageDown:{keys:["PageDown"]},pageUp:{keys:["PageUp"]},home:{keys:["Home"]},end:{keys:["End"]}}},Gn=({buttons:t,axes:e,radialAxes:r})=>{const s=n=>n!==void 0;return{presses:{right:{gamepadButtons:[t.dPadRight].filter(s)},towards:{gamepadButtons:[t.dPadDown].filter(s)},left:{gamepadButtons:[t.dPadLeft].filter(s)},away:{gamepadButtons:[t.dPadUp].filter(s)},jump:{gamepadButtons:[t.a,t.y].filter(s)},carry:{gamepadButtons:[t.x,t.y].filter(s)},fire:{gamepadButtons:[t.b].filter(s)},lookShift:{gamepadButtons:[t.rb].filter(s)},"swop.head":{gamepadButtons:[t.lt].filter(s)},"swop.heels":{gamepadButtons:[t.rt].filter(s)},hold:{gamepadButtons:[t.start].filter(s)},menu_select:{gamepadButtons:[t.a].filter(s)},menu_exit:{gamepadButtons:[t.b].filter(s)},menu_openOrExit:{gamepadButtons:[t.select].filter(s)},map:{gamepadButtons:[t.lb].filter(s)},toggleCrtFilter:{gamepadButtons:[t.l3].filter(s)},toggleShowFps:{gamepadButtons:[t.r3].filter(s)}},axes:{x:[e.lStickX].filter(s),y:[e.lStickY].filter(s),xLook:[e.rStickX].filter(s),yLook:[e.rStickY].filter(s)},radialAxes:{xy:[r.xy].filter(s)}}},kS={inputAssignment:zs(Fs,Gn($n),{presses:{right:{keys:["P","7"]},towards:{keys:["A","8"]},left:{keys:["O","6"]},away:{keys:["Q","9"]},jump:{keys:[" ","M","N","B","Alt"]},carry:{keys:[" ","Enter","L","K","J"]},fire:{keys:["Shift","Z","X","C","V"]},swop:{keys:["S","D","F","G"]},hold:{keys:["H"]}}}),description:"Closely matches the ZX Spectrum original game's keys"},CS={inputAssignment:zs(Fs,Gn($n),{presses:{carry:{keys:["F3","F5"]},fire:{keys:[" "]},jump:{keys:["F5"]},swop:{keys:["F1"]},hold:{keys:["H"]}}}),description:"Closely matches Amiga version keys - heavy on the F-keys"},ES={inputAssignment:zs(Fs,Gn($n),{presses:{lookUp:{keys:["I"]},lookDown:{keys:["K"]},lookLeft:{keys:["J"]},lookRight:{keys:["L"]},lookShift:{keys:["C"]}}}),description:"Combined key and joystick/gamepad assignment, should work on most setups"},TS={inputAssignment:zs(Fs,Gn($n),{presses:{right:{keys:["D"]},towards:{keys:["S"]},left:{keys:["A"]},away:{keys:["W"]},jump:{keys:[" ","F","P"]},carry:{keys:["Shift","F","I","P"]},fire:{keys:["E","O","Control"]},swop:{keys:["Q"]},hold:{keys:["H"]}}}),description:"Modern, minimalist WASD key layout"},PS={inputAssignment:zs(Fs,Gn($n),{presses:{right:{keys:[Ft.dPadRight]},towards:{keys:[Ft.dPadDown]},left:{keys:[Ft.dPadLeft]},away:{keys:[Ft.dPadUp]},jump:{keys:[Ft.a,Ft.y]},carry:{keys:[Ft.b,Ft.y]},fire:{keys:[Ft.x]},swop:{keys:[Ft.rb]},hold:{keys:[Ft.start]},menu_openOrExit:{keys:[Ft.select]}}}),description:"8bitdo controllers in keyboard mode (identifies to OS as a keyboard). They work as controllers even on phones that dont support controllers"},RS={inputAssignment:zs(Fs,Gn(_S)),description:"8Bitdo Ultimate 2c Wired reports in a non-standard way on some systems - use this if you have this controller and it doesn't work as expected"},MS=t=>({presses:{right:{keys:[t.directions.right]},towards:{keys:[t.directions.down]},left:{keys:[t.directions.left]},away:{keys:[t.directions.up]},jump:{keys:[t.buttons[0],t.buttons[3]]},carry:{keys:[t.buttons[1],t.buttons[3]]},fire:{keys:[t.buttons[2]]},swop:{keys:[t.start]},hold:{keys:[t.coin]},menu_openOrExit:{keys:[t.buttons[4]]},lookShift:{keys:[t.buttons[5]]}}}),IS={inputAssignment:zs(ox,Fs,{presses:{menu_openOrExit:{keys:["`","Tab"]}}},MS(SS),{presses:{lookDown:{keys:[Us.directions.down]},lookLeft:{keys:[Us.directions.left]},lookRight:{keys:[Us.directions.right]},lookUp:{keys:[Us.directions.up]},"swop.head":{keys:[Us.buttons[0]]},"swop.heels":{keys:[Us.buttons[1]]}}}),description:"Arcade-style control panels"},Vn={Default:ES,"ZX Spec":kS,Amiga:CS,MAME:IS,WASD:TS," 8b kbd":PS," 8b U2c":RS},Ud=()=>Wt().get("campaignName")?.startsWith("data:");var we=(t=>(t.Application="application",t.WebGLPipes="webgl-pipes",t.WebGLPipesAdaptor="webgl-pipes-adaptor",t.WebGLSystem="webgl-system",t.WebGPUPipes="webgpu-pipes",t.WebGPUPipesAdaptor="webgpu-pipes-adaptor",t.WebGPUSystem="webgpu-system",t.CanvasSystem="canvas-system",t.CanvasPipesAdaptor="canvas-pipes-adaptor",t.CanvasPipes="canvas-pipes",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t.MaskEffect="mask-effect",t.BlendMode="blend-mode",t.TextureSource="texture-source",t.Environment="environment",t.ShapeBuilder="shape-builder",t.Batcher="batcher",t))(we||{});const fh=t=>{if(typeof t=="function"||typeof t=="object"&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={...typeof t.extension!="object"?{type:t.extension}:t.extension,ref:t}}if(typeof t=="object")t={...t};else throw new Error("Invalid extension type");return typeof t.type=="string"&&(t.type=[t.type]),t},ta=(t,e)=>fh(t).priority??e,zt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(fh).forEach(e=>{e.type.forEach(r=>this._removeHandlers[r]?.(e))}),this},add(...t){return t.map(fh).forEach(e=>{e.type.forEach(r=>{const s=this._addHandlers,n=this._queue;s[r]?s[r]?.(e):(n[r]=n[r]||[],n[r]?.push(e))})}),this},handle(t,e,r){const s=this._addHandlers,n=this._removeHandlers;if(s[t]||n[t])throw new Error(`Extension type ${t} already has a handler`);s[t]=e,n[t]=r;const i=this._queue;return i[t]&&(i[t]?.forEach(o=>e(o)),delete i[t]),this},handleByMap(t,e){return this.handle(t,r=>{r.name&&(e[r.name]=r.ref)},r=>{r.name&&delete e[r.name]})},handleByNamedList(t,e,r=-1){return this.handle(t,s=>{e.findIndex(i=>i.name===s.name)>=0||(e.push({name:s.name,value:s.ref}),e.sort((i,o)=>ta(o.value,r)-ta(i.value,r)))},s=>{const n=e.findIndex(i=>i.name===s.name);n!==-1&&e.splice(n,1)})},handleByList(t,e,r=-1){return this.handle(t,s=>{e.includes(s.ref)||(e.push(s.ref),e.sort((n,i)=>ta(i,r)-ta(n,r)))},s=>{const n=e.indexOf(s.ref);n!==-1&&e.splice(n,1)})},mixin(t,...e){for(const r of e)Object.defineProperties(t.prototype,Object.getOwnPropertyDescriptors(r))}},jS={extension:{type:we.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Nn(()=>import("./browserAll-Ca6DgVWw.js"),__vite__mapDeps([0,1,2,3]))}},OS={extension:{type:we.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await Nn(()=>import("./webworkerAll-DZty8RK2.js"),__vite__mapDeps([1,2,3]))}};class ot{constructor(e,r,s){this._x=r||0,this._y=s||0,this._observer=e}clone(e){return new ot(e??this._observer,this._x,this._y)}set(e=0,r=e){return(this._x!==e||this._y!==r)&&(this._x=e,this._y=r,this._observer._onUpdate(this)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this._observer._onUpdate(this)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this._observer._onUpdate(this))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this._observer._onUpdate(this))}}var Nc={exports:{}},vm;function NS(){return vm||(vm=1,(function(t){var e=Object.prototype.hasOwnProperty,r="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(r=!1));function n(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function i(l,c,u,h,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new n(u,h||l,f),m=r?r+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],d]:l._events[m].push(d):(l._events[m]=d,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new s:delete l._events[c]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,h;if(this._eventsCount===0)return c;for(h in u=this._events)e.call(u,h)&&c.push(r?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=r?r+c:c,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,d=h.length,m=new Array(d);f<d;f++)m[f]=h[f].fn;return m},a.prototype.listenerCount=function(c){var u=r?r+c:c,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(c,u,h,f,d,m){var g=r?r+c:c;if(!this._events[g])return!1;var A=this._events[g],y=arguments.length,b,q;if(A.fn){switch(A.once&&this.removeListener(c,A.fn,void 0,!0),y){case 1:return A.fn.call(A.context),!0;case 2:return A.fn.call(A.context,u),!0;case 3:return A.fn.call(A.context,u,h),!0;case 4:return A.fn.call(A.context,u,h,f),!0;case 5:return A.fn.call(A.context,u,h,f,d),!0;case 6:return A.fn.call(A.context,u,h,f,d,m),!0}for(q=1,b=new Array(y-1);q<y;q++)b[q-1]=arguments[q];A.fn.apply(A.context,b)}else{var x=A.length,V;for(q=0;q<x;q++)switch(A[q].once&&this.removeListener(c,A[q].fn,void 0,!0),y){case 1:A[q].fn.call(A[q].context);break;case 2:A[q].fn.call(A[q].context,u);break;case 3:A[q].fn.call(A[q].context,u,h);break;case 4:A[q].fn.call(A[q].context,u,h,f);break;default:if(!b)for(V=1,b=new Array(y-1);V<y;V++)b[V-1]=arguments[V];A[q].fn.apply(A[q].context,b)}}return!0},a.prototype.on=function(c,u,h){return i(this,c,u,h,!1)},a.prototype.once=function(c,u,h){return i(this,c,u,h,!0)},a.prototype.removeListener=function(c,u,h,f){var d=r?r+c:c;if(!this._events[d])return this;if(!u)return o(this,d),this;var m=this._events[d];if(m.fn)m.fn===u&&(!f||m.once)&&(!h||m.context===h)&&o(this,d);else{for(var g=0,A=[],y=m.length;g<y;g++)(m[g].fn!==u||f&&!m[g].once||h&&m[g].context!==h)&&A.push(m[g]);A.length?this._events[d]=A.length===1?A[0]:A:o(this,d)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=r?r+c:c,this._events[u]&&o(this,u)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a})(Nc)),Nc.exports}var BS=NS();const os=Xe(BS),DS=Math.PI*2,zS=180/Math.PI,FS=Math.PI/180;class dt{constructor(e=0,r=0){this.x=0,this.y=0,this.x=e,this.y=r}clone(){return new dt(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,r=e){return this.x=e,this.y=r,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return Bc.x=0,Bc.y=0,Bc}}const Bc=new dt;class pe{constructor(e=1,r=0,s=0,n=1,i=0,o=0){this.array=null,this.a=e,this.b=r,this.c=s,this.d=n,this.tx=i,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,r,s,n,i,o){return this.a=e,this.b=r,this.c=s,this.d=n,this.tx=i,this.ty=o,this}toArray(e,r){this.array||(this.array=new Float32Array(9));const s=r||this.array;return e?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(e,r){r=r||new dt;const s=e.x,n=e.y;return r.x=this.a*s+this.c*n+this.tx,r.y=this.b*s+this.d*n+this.ty,r}applyInverse(e,r){r=r||new dt;const s=this.a,n=this.b,i=this.c,o=this.d,a=this.tx,l=this.ty,c=1/(s*o+i*-n),u=e.x,h=e.y;return r.x=o*c*u+-i*c*h+(l*i-a*o)*c,r.y=s*c*h+-n*c*u+(-l*s+a*n)*c,r}translate(e,r){return this.tx+=e,this.ty+=r,this}scale(e,r){return this.a*=e,this.d*=r,this.c*=e,this.b*=r,this.tx*=e,this.ty*=r,this}rotate(e){const r=Math.cos(e),s=Math.sin(e),n=this.a,i=this.c,o=this.tx;return this.a=n*r-this.b*s,this.b=n*s+this.b*r,this.c=i*r-this.d*s,this.d=i*s+this.d*r,this.tx=o*r-this.ty*s,this.ty=o*s+this.ty*r,this}append(e){const r=this.a,s=this.b,n=this.c,i=this.d;return this.a=e.a*r+e.b*n,this.b=e.a*s+e.b*i,this.c=e.c*r+e.d*n,this.d=e.c*s+e.d*i,this.tx=e.tx*r+e.ty*n+this.tx,this.ty=e.tx*s+e.ty*i+this.ty,this}appendFrom(e,r){const s=e.a,n=e.b,i=e.c,o=e.d,a=e.tx,l=e.ty,c=r.a,u=r.b,h=r.c,f=r.d;return this.a=s*c+n*h,this.b=s*u+n*f,this.c=i*c+o*h,this.d=i*u+o*f,this.tx=a*c+l*h+r.tx,this.ty=a*u+l*f+r.ty,this}setTransform(e,r,s,n,i,o,a,l,c){return this.a=Math.cos(a+c)*i,this.b=Math.sin(a+c)*i,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(s*this.a+n*this.c),this.ty=r-(s*this.b+n*this.d),this}prepend(e){const r=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const s=this.a,n=this.c;this.a=s*e.a+this.b*e.c,this.b=s*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=r*e.a+this.ty*e.c+e.tx,this.ty=r*e.b+this.ty*e.d+e.ty,this}decompose(e){const r=this.a,s=this.b,n=this.c,i=this.d,o=e.pivot,a=-Math.atan2(-n,i),l=Math.atan2(s,r),c=Math.abs(a+l);return c<1e-5||Math.abs(DS-c)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(r*r+s*s),e.scale.y=Math.sqrt(n*n+i*i),e.position.x=this.tx+(o.x*r+o.y*n),e.position.y=this.ty+(o.x*s+o.y*i),e}invert(){const e=this.a,r=this.b,s=this.c,n=this.d,i=this.tx,o=e*n-r*s;return this.a=n/o,this.b=-r/o,this.c=-s/o,this.d=e/o,this.tx=(s*this.ty-n*i)/o,this.ty=-(e*this.ty-r*i)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new pe;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}equals(e){return e.a===this.a&&e.b===this.b&&e.c===this.c&&e.d===this.d&&e.tx===this.tx&&e.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return US.identity()}static get shared(){return LS.identity()}}const LS=new pe,US=new pe,gs=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],As=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ys=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],qs=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],ph=[],ax=[],ra=Math.sign;function $S(){for(let t=0;t<16;t++){const e=[];ph.push(e);for(let r=0;r<16;r++){const s=ra(gs[t]*gs[r]+ys[t]*As[r]),n=ra(As[t]*gs[r]+qs[t]*As[r]),i=ra(gs[t]*ys[r]+ys[t]*qs[r]),o=ra(As[t]*ys[r]+qs[t]*qs[r]);for(let a=0;a<16;a++)if(gs[a]===s&&As[a]===n&&ys[a]===i&&qs[a]===o){e.push(a);break}}}for(let t=0;t<16;t++){const e=new pe;e.set(gs[t],As[t],ys[t],qs[t],0,0),ax.push(e)}}$S();const xe={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>gs[t],uY:t=>As[t],vX:t=>ys[t],vY:t=>qs[t],inv:t=>t&8?t&15:-t&7,add:(t,e)=>ph[t][e],sub:(t,e)=>ph[t][xe.inv(e)],rotate180:t=>t^4,isVertical:t=>(t&3)===2,byDirection:(t,e)=>Math.abs(t)*2<=Math.abs(e)?e>=0?xe.S:xe.N:Math.abs(e)*2<=Math.abs(t)?t>0?xe.E:xe.W:e>0?t>0?xe.SE:xe.SW:t>0?xe.NE:xe.NW,matrixAppendRotationInv:(t,e,r=0,s=0,n=0,i=0)=>{const o=ax[xe.inv(e)],a=o.a,l=o.b,c=o.c,u=o.d,h=r-Math.min(0,a*n,c*i,a*n+c*i),f=s-Math.min(0,l*n,u*i,l*n+u*i),d=t.a,m=t.b,g=t.c,A=t.d;t.a=a*d+l*g,t.b=a*m+l*A,t.c=c*d+u*g,t.d=c*m+u*A,t.tx=h*d+f*g+t.tx,t.ty=h*m+f*A+t.ty},transformRectCoords:(t,e,r,s)=>{const{x:n,y:i,width:o,height:a}=t,{x:l,y:c,width:u,height:h}=e;return r===xe.E?(s.set(n+l,i+c,o,a),s):r===xe.S?s.set(u-i-a+l,n+c,a,o):r===xe.W?s.set(u-n-o+l,h-i-a+c,o,a):r===xe.N?s.set(i+l,h-n-o+c,a,o):s.set(n+l,i+c,o,a)}},sa=[new dt,new dt,new dt,new dt];class Ye{constructor(e=0,r=0,s=0,n=0){this.type="rectangle",this.x=Number(e),this.y=Number(r),this.width=Number(s),this.height=Number(n)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new Ye(0,0,0,0)}clone(){return new Ye(this.x,this.y,this.width,this.height)}copyFromBounds(e){return this.x=e.minX,this.y=e.minY,this.width=e.maxX-e.minX,this.height=e.maxY-e.minY,this}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,r){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&r>=this.y&&r<this.y+this.height}strokeContains(e,r,s,n=.5){const{width:i,height:o}=this;if(i<=0||o<=0)return!1;const a=this.x,l=this.y,c=s*(1-n),u=s-c,h=a-c,f=a+i+c,d=l-c,m=l+o+c,g=a+u,A=a+i-u,y=l+u,b=l+o-u;return e>=h&&e<=f&&r>=d&&r<=m&&!(e>g&&e<A&&r>y&&r<b)}intersects(e,r){if(!r){const S=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=S)return!1;const C=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>C}const s=this.left,n=this.right,i=this.top,o=this.bottom;if(n<=s||o<=i)return!1;const a=sa[0].set(e.left,e.top),l=sa[1].set(e.left,e.bottom),c=sa[2].set(e.right,e.top),u=sa[3].set(e.right,e.bottom);if(c.x<=a.x||l.y<=a.y)return!1;const h=Math.sign(r.a*r.d-r.b*r.c);if(h===0||(r.apply(a,a),r.apply(l,l),r.apply(c,c),r.apply(u,u),Math.max(a.x,l.x,c.x,u.x)<=s||Math.min(a.x,l.x,c.x,u.x)>=n||Math.max(a.y,l.y,c.y,u.y)<=i||Math.min(a.y,l.y,c.y,u.y)>=o))return!1;const f=h*(l.y-a.y),d=h*(a.x-l.x),m=f*s+d*i,g=f*n+d*i,A=f*s+d*o,y=f*n+d*o;if(Math.max(m,g,A,y)<=f*a.x+d*a.y||Math.min(m,g,A,y)>=f*u.x+d*u.y)return!1;const b=h*(a.y-c.y),q=h*(c.x-a.x),x=b*s+q*i,V=b*n+q*i,_=b*s+q*o,w=b*n+q*o;return!(Math.max(x,V,_,w)<=b*a.x+q*a.y||Math.min(x,V,_,w)>=b*u.x+q*u.y)}pad(e=0,r=e){return this.x-=e,this.y-=r,this.width+=e*2,this.height+=r*2,this}fit(e){const r=Math.max(this.x,e.x),s=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),i=Math.min(this.y+this.height,e.y+e.height);return this.x=r,this.width=Math.max(s-r,0),this.y=n,this.height=Math.max(i-n,0),this}ceil(e=1,r=.001){const s=Math.ceil((this.x+this.width-r)*e)/e,n=Math.ceil((this.y+this.height-r)*e)/e;return this.x=Math.floor((this.x+r)*e)/e,this.y=Math.floor((this.y+r)*e)/e,this.width=s-this.x,this.height=n-this.y,this}scale(e,r=e){return this.x*=e,this.y*=r,this.width*=e,this.height*=r,this}enlarge(e){const r=Math.min(this.x,e.x),s=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),i=Math.max(this.y+this.height,e.y+e.height);return this.x=r,this.width=s-r,this.y=n,this.height=i-n,this}getBounds(e){return e||(e=new Ye),e.copyFrom(this),e}containsRect(e){if(this.width<=0||this.height<=0)return!1;const r=e.x,s=e.y,n=e.x+e.width,i=e.y+e.height;return r>=this.x&&r<this.x+this.width&&s>=this.y&&s<this.y+this.height&&n>=this.x&&n<this.x+this.width&&i>=this.y&&i<this.y+this.height}set(e,r,s,n){return this.x=e,this.y=r,this.width=s,this.height=n,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const Dc={default:-1};function Ue(t="default"){return Dc[t]===void 0&&(Dc[t]=-1),++Dc[t]}const _m=new Set,at="8.0.0",GS="8.3.4",hn={quiet:!1,noColor:!1},_e=((t,e,r=3)=>{if(hn.quiet||_m.has(e))return;let s=new Error().stack;const n=`${e}
Deprecated since v${t}`,i=typeof console.groupCollapsed=="function"&&!hn.noColor;typeof s>"u"?console.warn("PixiJS Deprecation Warning: ",n):(s=s.split(`
`).splice(r).join(`
`),i?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",n),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",n),console.warn(s))),_m.add(e)});Object.defineProperties(_e,{quiet:{get:()=>hn.quiet,set:t=>{hn.quiet=t},enumerable:!0,configurable:!1},noColor:{get:()=>hn.noColor,set:t=>{hn.noColor=t},enumerable:!0,configurable:!1}});const lx=()=>{};function Sm(t){return t+=t===0?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1}function km(t){return!(t&t-1)&&!!t}function cx(t){const e={};for(const r in t)t[r]!==void 0&&(e[r]=t[r]);return e}const Cm=Object.create(null);function HS(t){const e=Cm[t];return e===void 0&&(Cm[t]=Ue("resource")),e}const ux=class hx extends os{constructor(e={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,e={...hx.defaultOptions,...e},this.addressMode=e.addressMode,this.addressModeU=e.addressModeU??this.addressModeU,this.addressModeV=e.addressModeV??this.addressModeV,this.addressModeW=e.addressModeW??this.addressModeW,this.scaleMode=e.scaleMode,this.magFilter=e.magFilter??this.magFilter,this.minFilter=e.minFilter??this.minFilter,this.mipmapFilter=e.mipmapFilter??this.mipmapFilter,this.lodMinClamp=e.lodMinClamp,this.lodMaxClamp=e.lodMaxClamp,this.compare=e.compare,this.maxAnisotropy=e.maxAnisotropy??1}set addressMode(e){this.addressModeU=e,this.addressModeV=e,this.addressModeW=e}get addressMode(){return this.addressModeU}set wrapMode(e){_e(at,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=e}get wrapMode(){return this.addressMode}set scaleMode(e){this.magFilter=e,this.minFilter=e,this.mipmapFilter=e}get scaleMode(){return this.magFilter}set maxAnisotropy(e){this._maxAnisotropy=Math.min(e,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this._sharedResourceId=null,this.emit("change",this)}_generateResourceId(){const e=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=HS(e),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};ux.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let dx=ux;const fx=class px extends os{constructor(e={}){super(),this.options=e,this._gpuData=Object.create(null),this._gcLastUsed=-1,this.uid=Ue("textureSource"),this._resourceType="textureSource",this._resourceId=Ue("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.viewDimension="2d",this.arrayLayerCount=1,this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,e={...px.defaultOptions,...e},this.label=e.label??"",this.resource=e.resource,this.autoGarbageCollect=e.autoGarbageCollect,this._resolution=e.resolution,e.width?this.pixelWidth=e.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,e.height?this.pixelHeight=e.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=e.format,this.dimension=e.dimensions,this.viewDimension=e.viewDimension??e.dimensions,this.arrayLayerCount=e.arrayLayerCount,this.mipLevelCount=e.mipLevelCount,this.autoGenerateMipmaps=e.autoGenerateMipmaps,this.sampleCount=e.sampleCount,this.antialias=e.antialias,this.alphaMode=e.alphaMode,this.style=new dx(cx(e)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(e){this.style!==e&&(this._style?.off("change",this._onStyleChange,this),this._style=e,this._style?.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(e){this._style.maxAnisotropy=e}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(e){this._style.addressMode=e}get repeatMode(){return this._style.addressMode}set repeatMode(e){this._style.addressMode=e}get magFilter(){return this._style.magFilter}set magFilter(e){this._style.magFilter=e}get minFilter(){return this._style.minFilter}set minFilter(e){this._style.minFilter=e}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(e){this._style.mipmapFilter=e}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(e){this._style.lodMinClamp=e}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(e){this._style.lodMaxClamp=e}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const e=this._resolution;if(this.resize(this.resourceWidth/e,this.resourceHeight/e))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.unload(),this.emit("destroy",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=Ue("resource"),this.emit("change",this),this.emit("unload",this);for(const e in this._gpuData)this._gpuData[e]?.destroy?.();this._gpuData=Object.create(null)}get resourceWidth(){const{resource:e}=this;return e.naturalWidth||e.videoWidth||e.displayWidth||e.width}get resourceHeight(){const{resource:e}=this;return e.naturalHeight||e.videoHeight||e.displayHeight||e.height}get resolution(){return this._resolution}set resolution(e){this._resolution!==e&&(this._resolution=e,this.width=this.pixelWidth/e,this.height=this.pixelHeight/e)}resize(e,r,s){s||(s=this._resolution),e||(e=this.width),r||(r=this.height);const n=Math.round(e*s),i=Math.round(r*s);return this.width=n/s,this.height=i/s,this._resolution=s,this.pixelWidth===n&&this.pixelHeight===i?!1:(this._refreshPOT(),this.pixelWidth=n,this.pixelHeight=i,this.emit("resize",this),this._resourceId=Ue("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(e){this._style.wrapMode=e}get wrapMode(){return this._style.wrapMode}set scaleMode(e){this._style.scaleMode=e}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=km(this.pixelWidth)&&km(this.pixelHeight)}static test(e){throw new Error("Unimplemented")}};fx.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",viewDimension:"2d",arrayLayerCount:1,mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let Xt=fx;class $d extends Xt{constructor(e){const r=e.resource||new Float32Array(e.width*e.height*4);let s=e.format;s||(r instanceof Float32Array?s="rgba32float":r instanceof Int32Array||r instanceof Uint32Array?s="rgba32uint":r instanceof Int16Array||r instanceof Uint16Array?s="rgba16uint":(r instanceof Int8Array,s="bgra8unorm")),super({...e,resource:r,format:s}),this.uploadMethodId="buffer"}static test(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}$d.extension=we.TextureSource;const Em=new pe;class WS{constructor(e,r){this.mapCoord=new pe,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof r>"u"?this.clampMargin=e.width<10?0:.5:this.clampMargin=r,this.isSimple=!1,this.texture=e}get texture(){return this._texture}set texture(e){this.texture!==e&&(this._texture?.removeListener("update",this.update,this),this._texture=e,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(e,r){r===void 0&&(r=e);const s=this.mapCoord;for(let n=0;n<e.length;n+=2){const i=e[n],o=e[n+1];r[n]=i*s.a+o*s.c+s.tx,r[n+1]=i*s.b+o*s.d+s.ty}return r}update(){const e=this._texture;this._updateID++;const r=e.uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const s=e.orig,n=e.trim;n&&(Em.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Em));const i=e.source,o=this.uClampFrame,a=this.clampMargin/i._resolution,l=this.clampOffset/i._resolution;return o[0]=(e.frame.x+a+l)/i.width,o[1]=(e.frame.y+a+l)/i.height,o[2]=(e.frame.x+e.frame.width-a+l)/i.width,o[3]=(e.frame.y+e.frame.height-a+l)/i.height,this.uClampOffset[0]=this.clampOffset/i.pixelWidth,this.uClampOffset[1]=this.clampOffset/i.pixelHeight,this.isSimple=e.frame.width===i.width&&e.frame.height===i.height&&e.rotate===0,!0}}class Ae extends os{constructor({source:e,label:r,frame:s,orig:n,trim:i,defaultAnchor:o,defaultBorders:a,rotate:l,dynamic:c}={}){if(super(),this.uid=Ue("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new Ye,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=r,this.source=e?.source??new Xt,this.noFrame=!s,s)this.frame.copyFrom(s);else{const{width:u,height:h}=this._source;this.frame.width=u,this.frame.height=h}this.orig=n||this.frame,this.trim=i,this.rotate=l??0,this.defaultAnchor=o,this.defaultBorders=a,this.destroyed=!1,this.dynamic=c||!1,this.updateUvs()}set source(e){this._source&&this._source.off("resize",this.update,this),this._source=e,e.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new WS(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:e,frame:r}=this,{width:s,height:n}=this._source,i=r.x/s,o=r.y/n,a=r.width/s,l=r.height/n;let c=this.rotate;if(c){const u=a/2,h=l/2,f=i+u,d=o+h;c=xe.add(c,xe.NW),e.x0=f+u*xe.uX(c),e.y0=d+h*xe.uY(c),c=xe.add(c,2),e.x1=f+u*xe.uX(c),e.y1=d+h*xe.uY(c),c=xe.add(c,2),e.x2=f+u*xe.uX(c),e.y2=d+h*xe.uY(c),c=xe.add(c,2),e.x3=f+u*xe.uX(c),e.y3=d+h*xe.uY(c)}else e.x0=i,e.y0=o,e.x1=i+a,e.y1=o,e.x2=i+a,e.y2=o+l,e.x3=i,e.y3=o+l}destroy(e=!1){this._source&&(this._source.off("resize",this.update,this),e&&(this._source.destroy(),this._source=null)),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return _e(at,"Texture.baseTexture is now Texture.source"),this._source}}Ae.EMPTY=new Ae({label:"EMPTY",source:new Xt({label:"EMPTY"})});Ae.EMPTY.destroy=lx;Ae.WHITE=new Ae({source:new $d({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});Ae.WHITE.destroy=lx;function YS(t,e,r){const{width:s,height:n}=r.orig,i=r.trim;if(i){const o=i.width,a=i.height;t.minX=i.x-e._x*s,t.maxX=t.minX+o,t.minY=i.y-e._y*n,t.maxY=t.minY+a}else t.minX=-e._x*s,t.maxX=t.minX+s,t.minY=-e._y*n,t.maxY=t.minY+n}const Tm=new pe;class nr{constructor(e=1/0,r=1/0,s=-1/0,n=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Tm,this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new Ye);const e=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(e.x=0,e.y=0,e.width=0,e.height=0):e.copyFromBounds(this),e}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Tm,this}set(e,r,s,n){this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}addFrame(e,r,s,n,i){i||(i=this.matrix);const o=i.a,a=i.b,l=i.c,c=i.d,u=i.tx,h=i.ty;let f=this.minX,d=this.minY,m=this.maxX,g=this.maxY,A=o*e+l*r+u,y=a*e+c*r+h;A<f&&(f=A),y<d&&(d=y),A>m&&(m=A),y>g&&(g=y),A=o*s+l*r+u,y=a*s+c*r+h,A<f&&(f=A),y<d&&(d=y),A>m&&(m=A),y>g&&(g=y),A=o*e+l*n+u,y=a*e+c*n+h,A<f&&(f=A),y<d&&(d=y),A>m&&(m=A),y>g&&(g=y),A=o*s+l*n+u,y=a*s+c*n+h,A<f&&(f=A),y<d&&(d=y),A>m&&(m=A),y>g&&(g=y),this.minX=f,this.minY=d,this.maxX=m,this.maxY=g}addRect(e,r){this.addFrame(e.x,e.y,e.x+e.width,e.y+e.height,r)}addBounds(e,r){this.addFrame(e.minX,e.minY,e.maxX,e.maxY,r)}addBoundsMask(e){this.minX=this.minX>e.minX?this.minX:e.minX,this.minY=this.minY>e.minY?this.minY:e.minY,this.maxX=this.maxX<e.maxX?this.maxX:e.maxX,this.maxY=this.maxY<e.maxY?this.maxY:e.maxY}applyMatrix(e){const r=this.minX,s=this.minY,n=this.maxX,i=this.maxY,{a:o,b:a,c:l,d:c,tx:u,ty:h}=e;let f=o*r+l*s+u,d=a*r+c*s+h;this.minX=f,this.minY=d,this.maxX=f,this.maxY=d,f=o*n+l*s+u,d=a*n+c*s+h,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY,f=o*r+l*i+u,d=a*r+c*i+h,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY,f=o*n+l*i+u,d=a*n+c*i+h,this.minX=f<this.minX?f:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=d>this.maxY?d:this.maxY}fit(e){return this.minX<e.left&&(this.minX=e.left),this.maxX>e.right&&(this.maxX=e.right),this.minY<e.top&&(this.minY=e.top),this.maxY>e.bottom&&(this.maxY=e.bottom),this}fitBounds(e,r,s,n){return this.minX<e&&(this.minX=e),this.maxX>r&&(this.maxX=r),this.minY<s&&(this.minY=s),this.maxY>n&&(this.maxY=n),this}pad(e,r=e){return this.minX-=e,this.maxX+=e,this.minY-=r,this.maxY+=r,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new nr(this.minX,this.minY,this.maxX,this.maxY)}scale(e,r=e){return this.minX*=e,this.minY*=r,this.maxX*=e,this.maxY*=r,this}get x(){return this.minX}set x(e){const r=this.maxX-this.minX;this.minX=e,this.maxX=e+r}get y(){return this.minY}set y(e){const r=this.maxY-this.minY;this.minY=e,this.maxY=e+r}get width(){return this.maxX-this.minX}set width(e){this.maxX=this.minX+e}get height(){return this.maxY-this.minY}set height(e){this.maxY=this.minY+e}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(e,r,s,n){let i=this.minX,o=this.minY,a=this.maxX,l=this.maxY;n||(n=this.matrix);const c=n.a,u=n.b,h=n.c,f=n.d,d=n.tx,m=n.ty;for(let g=r;g<s;g+=2){const A=e[g],y=e[g+1],b=c*A+h*y+d,q=u*A+f*y+m;i=b<i?b:i,o=q<o?q:o,a=b>a?b:a,l=q>l?q:l}this.minX=i,this.minY=o,this.maxX=a,this.maxY=l}containsPoint(e,r){return this.minX<=e&&this.minY<=r&&this.maxX>=e&&this.maxY>=r}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this}}var KS={grad:.9,turn:360,rad:360/(2*Math.PI)},Vr=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},We=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},Gt=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),t>r?r:t>e?t:e},mx=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},Pm=function(t){return{r:Gt(t.r,0,255),g:Gt(t.g,0,255),b:Gt(t.b,0,255),a:Gt(t.a)}},zc=function(t){return{r:We(t.r),g:We(t.g),b:We(t.b),a:We(t.a,3)}},QS=/^#([0-9a-f]{3,8})$/i,na=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},gx=function(t){var e=t.r,r=t.g,s=t.b,n=t.a,i=Math.max(e,r,s),o=i-Math.min(e,r,s),a=o?i===e?(r-s)/o:i===r?2+(s-e)/o:4+(e-r)/o:0;return{h:60*(a<0?a+6:a),s:i?o/i*100:0,v:i/255*100,a:n}},Ax=function(t){var e=t.h,r=t.s,s=t.v,n=t.a;e=e/360*6,r/=100,s/=100;var i=Math.floor(e),o=s*(1-r),a=s*(1-(e-i)*r),l=s*(1-(1-e+i)*r),c=i%6;return{r:255*[s,a,o,o,l,s][c],g:255*[l,s,s,a,o,o][c],b:255*[o,o,l,s,s,a][c],a:n}},Rm=function(t){return{h:mx(t.h),s:Gt(t.s,0,100),l:Gt(t.l,0,100),a:Gt(t.a)}},Mm=function(t){return{h:We(t.h),s:We(t.s),l:We(t.l),a:We(t.a,3)}},Im=function(t){return Ax((r=(e=t).s,{h:e.h,s:(r*=((s=e.l)<50?s:100-s)/100)>0?2*r/(s+r)*100:0,v:s+r,a:e.a}));var e,r,s},Ii=function(t){return{h:(e=gx(t)).h,s:(n=(200-(r=e.s))*(s=e.v)/100)>0&&n<200?r*s/100/(n<=100?n:200-n)*100:0,l:n/2,a:e.a};var e,r,s,n},XS=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,JS=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ZS=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ek=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,mh={string:[[function(t){var e=QS.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?We(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?We(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=ZS.exec(t)||ek.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:Pm({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=XS.exec(t)||JS.exec(t);if(!e)return null;var r,s,n=Rm({h:(r=e[1],s=e[2],s===void 0&&(s="deg"),Number(r)*(KS[s]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return Im(n)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,s=t.b,n=t.a,i=n===void 0?1:n;return Vr(e)&&Vr(r)&&Vr(s)?Pm({r:Number(e),g:Number(r),b:Number(s),a:Number(i)}):null},"rgb"],[function(t){var e=t.h,r=t.s,s=t.l,n=t.a,i=n===void 0?1:n;if(!Vr(e)||!Vr(r)||!Vr(s))return null;var o=Rm({h:Number(e),s:Number(r),l:Number(s),a:Number(i)});return Im(o)},"hsl"],[function(t){var e=t.h,r=t.s,s=t.v,n=t.a,i=n===void 0?1:n;if(!Vr(e)||!Vr(r)||!Vr(s))return null;var o=(function(a){return{h:mx(a.h),s:Gt(a.s,0,100),v:Gt(a.v,0,100),a:Gt(a.a)}})({h:Number(e),s:Number(r),v:Number(s),a:Number(i)});return Ax(o)},"hsv"]]},jm=function(t,e){for(var r=0;r<e.length;r++){var s=e[r][0](t);if(s)return[s,e[r][1]]}return[null,void 0]},tk=function(t){return typeof t=="string"?jm(t.trim(),mh.string):typeof t=="object"&&t!==null?jm(t,mh.object):[null,void 0]},Fc=function(t,e){var r=Ii(t);return{h:r.h,s:Gt(r.s+100*e,0,100),l:r.l,a:r.a}},Lc=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Om=function(t,e){var r=Ii(t);return{h:r.h,s:r.s,l:Gt(r.l+100*e,0,100),a:r.a}},gh=(function(){function t(e){this.parsed=tk(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return We(Lc(this.rgba),2)},t.prototype.isDark=function(){return Lc(this.rgba)<.5},t.prototype.isLight=function(){return Lc(this.rgba)>=.5},t.prototype.toHex=function(){return e=zc(this.rgba),r=e.r,s=e.g,n=e.b,o=(i=e.a)<1?na(We(255*i)):"","#"+na(r)+na(s)+na(n)+o;var e,r,s,n,i,o},t.prototype.toRgb=function(){return zc(this.rgba)},t.prototype.toRgbString=function(){return e=zc(this.rgba),r=e.r,s=e.g,n=e.b,(i=e.a)<1?"rgba("+r+", "+s+", "+n+", "+i+")":"rgb("+r+", "+s+", "+n+")";var e,r,s,n,i},t.prototype.toHsl=function(){return Mm(Ii(this.rgba))},t.prototype.toHslString=function(){return e=Mm(Ii(this.rgba)),r=e.h,s=e.s,n=e.l,(i=e.a)<1?"hsla("+r+", "+s+"%, "+n+"%, "+i+")":"hsl("+r+", "+s+"%, "+n+"%)";var e,r,s,n,i},t.prototype.toHsv=function(){return e=gx(this.rgba),{h:We(e.h),s:We(e.s),v:We(e.v),a:We(e.a,3)};var e},t.prototype.invert=function(){return hr({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),hr(Fc(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),hr(Fc(this.rgba,-e))},t.prototype.grayscale=function(){return hr(Fc(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),hr(Om(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),hr(Om(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?hr({r:(r=this.rgba).r,g:r.g,b:r.b,a:e}):We(this.rgba.a,3);var r},t.prototype.hue=function(e){var r=Ii(this.rgba);return typeof e=="number"?hr({h:e,s:r.s,l:r.l,a:r.a}):We(r.h)},t.prototype.isEqual=function(e){return this.toHex()===hr(e).toHex()},t})(),hr=function(t){return t instanceof gh?t:new gh(t)},Nm=[],rk=function(t){t.forEach(function(e){Nm.indexOf(e)<0&&(e(gh,mh),Nm.push(e))})};function sk(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},s={};for(var n in r)s[r[n]]=n;var i={};t.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,c=s[this.toHex()];if(c)return c;if(o?.closest){var u=this.toRgb(),h=1/0,f="black";if(!i.length)for(var d in r)i[d]=new t(r[d]).toRgb();for(var m in r){var g=(a=u,l=i[m],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));g<h&&(h=g,f=m)}return f}},e.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":r[a];return l?new t(l).toRgb():null},"name"])}rk([sk]);const vn=class wi{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof wi)this._value=this._cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,e))&&(this._value=this._cloneSource(e),this._normalize(this._value))}}get value(){return this._value}_cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}_isSourceEqual(e,r){const s=typeof e;if(s!==typeof r)return!1;if(s==="number"||s==="string"||e instanceof Number)return e===r;if(Array.isArray(e)&&Array.isArray(r)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(r))return e.length!==r.length?!1:e.every((i,o)=>i===r[o]);if(e!==null&&r!==null){const i=Object.keys(e),o=Object.keys(r);return i.length!==o.length?!1:i.every(a=>e[a]===r[a])}return e===r}toRgba(){const[e,r,s,n]=this._components;return{r:e,g:r,b:s,a:n}}toRgb(){const[e,r,s]=this._components;return{r:e,g:r,b:s}}toRgbaString(){const[e,r,s]=this.toUint8RgbArray();return`rgba(${e},${r},${s},${this.alpha})`}toUint8RgbArray(e){const[r,s,n]=this._components;return this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb),e[0]=Math.round(r*255),e[1]=Math.round(s*255),e[2]=Math.round(n*255),e}toArray(e){this._arrayRgba||(this._arrayRgba=[]),e||(e=this._arrayRgba);const[r,s,n,i]=this._components;return e[0]=r,e[1]=s,e[2]=n,e[3]=i,e}toRgbArray(e){this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb);const[r,s,n]=this._components;return e[0]=r,e[1]=s,e[2]=n,e}toNumber(){return this._int}toBgrNumber(){const[e,r,s]=this.toUint8RgbArray();return(s<<16)+(r<<8)+e}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[r,s,n,i]=wi._temp.setValue(e)._components;return this._components[0]*=r,this._components[1]*=s,this._components[2]*=n,this._components[3]*=i,this._refreshInt(),this._value=null,this}premultiply(e,r=!0){return r&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this._refreshInt(),this._value=null,this}toPremultiplied(e,r=!0){if(e===1)return(255<<24)+this._int;if(e===0)return r?0:this._int;let s=this._int>>16&255,n=this._int>>8&255,i=this._int&255;return r&&(s=s*e+.5|0,n=n*e+.5|0,i=i*e+.5|0),(e*255<<24)+(s<<16)+(n<<8)+i}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const r=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-r.length)+r}setAlpha(e){return this._components[3]=this._clamp(e),this}_normalize(e){let r,s,n,i;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const o=e;r=(o>>16&255)/255,s=(o>>8&255)/255,n=(o&255)/255,i=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[r,s,n,i=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[r,s,n,i=255]=e,r/=255,s/=255,n/=255,i/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const a=wi.HEX_PATTERN.exec(e);a&&(e=`#${a[2]}`)}const o=hr(e);o.isValid()&&({r,g:s,b:n,a:i}=o.rgba,r/=255,s/=255,n/=255)}if(r!==void 0)this._components[0]=r,this._components[1]=s,this._components[2]=n,this._components[3]=i,this._refreshInt();else throw new Error(`Unable to convert color ${e}`)}_refreshInt(){this._clamp(this._components);const[e,r,s]=this._components;this._int=(e*255<<16)+(r*255<<8)+(s*255|0)}_clamp(e,r=0,s=1){return typeof e=="number"?Math.min(Math.max(e,r),s):(e.forEach((n,i)=>{e[i]=Math.min(Math.max(n,r),s)}),e)}static isColorLike(e){return typeof e=="number"||typeof e=="string"||e instanceof Number||e instanceof wi||Array.isArray(e)||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e.r!==void 0&&e.g!==void 0&&e.b!==void 0||e.r!==void 0&&e.g!==void 0&&e.b!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0&&e.a!==void 0}};vn.shared=new vn;vn._temp=new vn;vn.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let be=vn;const nk={cullArea:null,cullable:!1,cullableChildren:!0};let Uc=0;const Bm=500;function Nt(...t){Uc!==Bm&&(Uc++,Uc===Bm?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...t))}const Gd={_registeredResources:new Set,register(t){this._registeredResources.add(t)},unregister(t){this._registeredResources.delete(t)},release(){this._registeredResources.forEach(t=>t.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(t){return this._registeredResources.has(t)},reset(){this._registeredResources.clear()}};class ik{constructor(e,r){this._pool=[],this._count=0,this._index=0,this._classType=e,r&&this.prepopulate(r)}prepopulate(e){for(let r=0;r<e;r++)this._pool[this._index++]=new this._classType;this._count+=e}get(e){let r;return this._index>0?r=this._pool[--this._index]:(r=new this._classType,this._count++),r.init?.(e),r}return(e){e.reset?.(),this._pool[this._index++]=e}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let e=0;e<this._index;e++)this._pool[e].destroy();this._pool.length=0,this._count=0,this._index=0}}class ok{constructor(){this._poolsByClass=new Map}prepopulate(e,r){this.getPool(e).prepopulate(r)}get(e,r){return this.getPool(e).get(r)}return(e){this.getPool(e.constructor).return(e)}getPool(e){return this._poolsByClass.has(e)||this._poolsByClass.set(e,new ik(e)),this._poolsByClass.get(e)}stats(){const e={};return this._poolsByClass.forEach(r=>{const s=e[r._classType.name]?r._classType.name+r._classType.ID:r._classType.name;e[s]={free:r.totalFree,used:r.totalUsed,size:r.totalSize}}),e}clear(){this._poolsByClass.forEach(e=>e.clear()),this._poolsByClass.clear()}}const Ct=new ok;Gd.register(Ct);const ak={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(t){typeof t=="boolean"&&t===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(t===!0?{}:t))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(t){_e("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(t)}};function lk(t,e,r){const s=t.length;let n;if(e>=s||r===0)return;r=e+r>s?s-e:r;const i=s-r;for(n=e;n<i;++n)t[n]=t[n+r];t.length=i}const ck={allowChildren:!0,removeChildren(t=0,e){const r=e??this.children.length,s=r-t,n=[];if(s>0&&s<=r){for(let o=r-1;o>=t;o--){const a=this.children[o];a&&(n.push(a),a.parent=null)}lk(this.children,t,r);const i=this.renderGroup||this.parentRenderGroup;i&&i.removeChildren(n);for(let o=0;o<n.length;++o){const a=n[o];a.parentRenderLayer?.detach(a),this.emit("childRemoved",a,this,o),n[o].emit("removed",this)}return n.length>0&&this._didViewChangeTick++,n}else if(s===0&&this.children.length===0)return n;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(t){const e=this.getChildAt(t);return this.removeChild(e)},getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]},setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);this.getChildIndex(t),this.addChildAt(t,e)},getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied Container must be a child of the caller");return e},addChildAt(t,e){this.allowChildren||_e(at,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:r}=this;if(e<0||e>r.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${r.length}`);if(t.parent){const n=t.parent.children.indexOf(t);if(t.parent===this&&n===e)return t;n!==-1&&t.parent.children.splice(n,1)}e===r.length?r.push(t):r.splice(e,0,t),t.parent=this,t.didChange=!0,t._updateFlags=15;const s=this.renderGroup||this.parentRenderGroup;return s&&s.addChild(t),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",t,this,e),t.emit("added",this),t},swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),s=this.getChildIndex(e);this.children[r]=e,this.children[s]=t;const n=this.renderGroup||this.parentRenderGroup;n&&(n.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...t){return t.length===1?this.reparentChildAt(t[0],this.children.length):(t.forEach(e=>this.reparentChildAt(e,this.children.length)),t[0])},reparentChildAt(t,e){if(t.parent===this)return this.setChildIndex(t,e),t;const r=t.worldTransform.clone();t.removeFromParent(),this.addChildAt(t,e);const s=this.worldTransform.clone();return s.invert(),r.prepend(s),t.setFromMatrix(r),t},replaceChild(t,e){t.updateLocalTransform(),this.addChildAt(e,this.getChildIndex(t)),e.setFromMatrix(t.localTransform),e.updateLocalTransform(),this.removeChild(t)}},uk={collectRenderables(t,e,r){this.parentRenderLayer&&this.parentRenderLayer!==r||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(t,e,r):this.renderGroup?e.renderPipes.renderGroup.addRenderGroup(this.renderGroup,t):this.collectRenderablesWithEffects(t,e,r))},collectRenderablesSimple(t,e,r){const s=this.children,n=s.length;for(let i=0;i<n;i++)s[i].collectRenderables(t,e,r)},collectRenderablesWithEffects(t,e,r){const{renderPipes:s}=e;for(let n=0;n<this.effects.length;n++){const i=this.effects[n];s[i.pipe].push(i,this,t)}this.collectRenderablesSimple(t,e,r);for(let n=this.effects.length-1;n>=0;n--){const i=this.effects[n];s[i.pipe].pop(i,this,t)}}};class Dm{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let e=0;e<this.filters.length;e++)this.filters[e].destroy();this.filters=null,this.filterArea=null}}class hk{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(e=>{this.add({test:e.test,maskClass:e})}))}add(e){this._tests.push(e)}getMaskEffect(e){this._initialized||this.init();for(let r=0;r<this._tests.length;r++){const s=this._tests[r];if(s.test(e))return Ct.get(s.maskClass,e)}return e}returnMaskEffect(e){Ct.return(e)}}const Ah=new hk;zt.handleByList(we.MaskEffect,Ah._effectClasses);const dk={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const t=this.renderGroup||this.parentRenderGroup;t&&(t.structureDidChange=!0)},addEffect(t){this.effects.indexOf(t)===-1&&(this.effects.push(t),this.effects.sort((r,s)=>r.priority-s.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(t){const e=this.effects.indexOf(t);e!==-1&&(this.effects.splice(e,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(t){const e=this._maskEffect;e?.mask!==t&&(e&&(this.removeEffect(e),Ah.returnMaskEffect(e),this._maskEffect=null),t!=null&&(this._maskEffect=Ah.getMaskEffect(t),this.addEffect(this._maskEffect)))},get mask(){return this._maskEffect?.mask},setMask(t){this._maskOptions={...this._maskOptions,...t},t.mask&&(this.mask=t.mask),this._markStructureAsChanged()},set filters(t){!Array.isArray(t)&&t&&(t=[t]);const e=this._filterEffect||(this._filterEffect=new Dm);t=t;const r=t?.length>0,s=e.filters?.length>0,n=r!==s;t=Array.isArray(t)?t.slice(0):t,e.filters=Object.freeze(t),n&&(r?this.addEffect(e):(this.removeEffect(e),e.filters=t??null))},get filters(){return this._filterEffect?.filters},set filterArea(t){this._filterEffect||(this._filterEffect=new Dm),this._filterEffect.filterArea=t},get filterArea(){return this._filterEffect?.filterArea}},fk={label:null,get name(){return _e(at,"Container.name property has been removed, use Container.label instead"),this.label},set name(t){_e(at,"Container.name property has been removed, use Container.label instead"),this.label=t},getChildByName(t,e=!1){return this.getChildByLabel(t,e)},getChildByLabel(t,e=!1){const r=this.children;for(let s=0;s<r.length;s++){const n=r[s];if(n.label===t||t instanceof RegExp&&t.test(n.label))return n}if(e)for(let s=0;s<r.length;s++){const i=r[s].getChildByLabel(t,!0);if(i)return i}return null},getChildrenByLabel(t,e=!1,r=[]){const s=this.children;for(let n=0;n<s.length;n++){const i=s[n];(i.label===t||t instanceof RegExp&&t.test(i.label))&&r.push(i)}if(e)for(let n=0;n<s.length;n++)s[n].getChildrenByLabel(t,!0,r);return r}},mt=Ct.getPool(pe),Pr=Ct.getPool(nr),pk=new pe,mk={getFastGlobalBounds(t,e){e||(e=new nr),e.clear(),this._getGlobalBoundsRecursive(!!t,e,this.parentRenderLayer),e.isValid||e.set(0,0,0,0);const r=this.renderGroup||this.parentRenderGroup;return e.applyMatrix(r.worldTransform),e},_getGlobalBoundsRecursive(t,e,r){let s=e;if(t&&this.parentRenderLayer&&this.parentRenderLayer!==r||this.localDisplayStatus!==7||!this.measurable)return;const n=!!this.effects.length;if((this.renderGroup||n)&&(s=Pr.get().clear()),this.boundsArea)e.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const o=this.bounds;s.addFrame(o.minX,o.minY,o.maxX,o.maxY,this.groupTransform)}const i=this.children;for(let o=0;o<i.length;o++)i[o]._getGlobalBoundsRecursive(t,s,r)}if(n){let i=!1;const o=this.renderGroup||this.parentRenderGroup;for(let a=0;a<this.effects.length;a++)this.effects[a].addBounds&&(i||(i=!0,s.applyMatrix(o.worldTransform)),this.effects[a].addBounds(s,!0));i&&s.applyMatrix(o.worldTransform.copyTo(pk).invert()),e.addBounds(s),Pr.return(s)}else this.renderGroup&&(e.addBounds(s,this.relativeGroupTransform),Pr.return(s))}};function yx(t,e,r){r.clear();let s,n;return t.parent?e?s=t.parent.worldTransform:(n=mt.get().identity(),s=Hd(t,n)):s=pe.IDENTITY,qx(t,r,s,e),n&&mt.return(n),r.isValid||r.set(0,0,0,0),r}function qx(t,e,r,s){if(!t.visible||!t.measurable)return;let n;s?n=t.worldTransform:(t.updateLocalTransform(),n=mt.get(),n.appendFrom(t.localTransform,r));const i=e,o=!!t.effects.length;if(o&&(e=Pr.get().clear()),t.boundsArea)e.addRect(t.boundsArea,n);else{const a=t.bounds;a&&!a.isEmpty()&&(e.matrix=n,e.addBounds(a));for(let l=0;l<t.children.length;l++)qx(t.children[l],e,n,s)}if(o){for(let a=0;a<t.effects.length;a++)t.effects[a].addBounds?.(e);i.addBounds(e,pe.IDENTITY),Pr.return(e)}s||mt.return(n)}function Hd(t,e){const r=t.parent;return r&&(Hd(r,e),r.updateLocalTransform(),e.append(r.localTransform)),e}function xx(t,e){if(t===16777215||!e)return e;if(e===16777215||!t)return t;const r=t>>16&255,s=t>>8&255,n=t&255,i=e>>16&255,o=e>>8&255,a=e&255,l=r*i/255|0,c=s*o/255|0,u=n*a/255|0;return(l<<16)+(c<<8)+u}const zm=16777215;function Fm(t,e){return t===zm?e:e===zm?t:xx(t,e)}function za(t){return((t&255)<<16)+(t&65280)+(t>>16&255)}const gk={getGlobalAlpha(t){if(t)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let e=this.alpha,r=this.parent;for(;r;)e*=r.alpha,r=r.parent;return e},getGlobalTransform(t=new pe,e){if(e)return t.copyFrom(this.worldTransform);this.updateLocalTransform();const r=Hd(this,mt.get().identity());return t.appendFrom(this.localTransform,r),mt.return(r),t},getGlobalTint(t){if(t)return this.renderGroup?za(this.renderGroup.worldColor):this.parentRenderGroup?za(Fm(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let e=this.localColor,r=this.parent;for(;r;)e=Fm(e,r.localColor),r=r.parent;return za(e)}};function bx(t,e,r){return e.clear(),r||(r=pe.IDENTITY),wx(t,e,r,t,!0),e.isValid||e.set(0,0,0,0),e}function wx(t,e,r,s,n){let i;if(n)i=mt.get(),i=r.copyTo(i);else{if(!t.visible||!t.measurable)return;t.updateLocalTransform();const l=t.localTransform;i=mt.get(),i.appendFrom(l,r)}const o=e,a=!!t.effects.length;if(a&&(e=Pr.get().clear()),t.boundsArea)e.addRect(t.boundsArea,i);else{t.renderPipeId&&(e.matrix=i,e.addBounds(t.bounds));const l=t.children;for(let c=0;c<l.length;c++)wx(l[c],e,i,s,!1)}if(a){for(let l=0;l<t.effects.length;l++)t.effects[l].addLocalBounds?.(e,s);o.addBounds(e,pe.IDENTITY),Pr.return(e)}mt.return(i)}function Vx(t,e){const r=t.children;for(let s=0;s<r.length;s++){const n=r[s],i=n.uid,o=(n._didViewChangeTick&65535)<<16|n._didContainerChangeTick&65535,a=e.index;(e.data[a]!==i||e.data[a+1]!==o)&&(e.data[e.index]=i,e.data[e.index+1]=o,e.didChange=!0),e.index=a+2,n.children.length&&Vx(n,e)}return e.didChange}const Ak=new pe,yk={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(t,e){const r=Math.sign(this.scale.x)||1;e!==0?this.scale.x=t/e*r:this.scale.x=r},_setHeight(t,e){const r=Math.sign(this.scale.y)||1;e!==0?this.scale.y=t/e*r:this.scale.y=r},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new nr});const t=this._localBoundsCacheData;return t.index=1,t.didChange=!1,t.data[0]!==this._didViewChangeTick&&(t.didChange=!0,t.data[0]=this._didViewChangeTick),Vx(this,t),t.didChange&&bx(this,t.localBounds,Ak),t.localBounds},getBounds(t,e){return yx(this,t,e||new nr)}},qk={_onRender:null,set onRender(t){const e=this.renderGroup||this.parentRenderGroup;if(!t){this._onRender&&e?.removeOnRender(this),this._onRender=null;return}this._onRender||e?.addOnRender(this),this._onRender=t},get onRender(){return this._onRender}},xk={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(bk))}};function bk(t,e){return t._zIndex-e._zIndex}const wk={getGlobalPosition(t=new dt,e=!1){return this.parent?this.parent.toGlobal(this._position,t,e):(t.x=this._position.x,t.y=this._position.y),t},toGlobal(t,e,r=!1){const s=this.getGlobalTransform(mt.get(),r);return e=s.apply(t,e),mt.return(s),e},toLocal(t,e,r,s){e&&(t=e.toGlobal(t,r,s));const n=this.getGlobalTransform(mt.get(),s);return r=n.applyInverse(t,r),mt.return(n),r}};class Wd{constructor(){this.uid=Ue("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(e){this.instructions[this.instructionSize++]=e}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let Vk=0;class vk{constructor(e){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this.textureStyle=new dx(this.textureOptions)}createTexture(e,r,s){const n=new Xt({...this.textureOptions,width:e,height:r,resolution:1,antialias:s,autoGarbageCollect:!1});return new Ae({source:n,label:`texturePool_${Vk++}`})}getOptimalTexture(e,r,s=1,n){let i=Math.ceil(e*s-1e-6),o=Math.ceil(r*s-1e-6);i=Sm(i),o=Sm(o);const a=(i<<17)+(o<<1)+(n?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let l=this._texturePool[a].pop();return l||(l=this.createTexture(i,o,n)),l.source._resolution=s,l.source.width=i/s,l.source.height=o/s,l.source.pixelWidth=i,l.source.pixelHeight=o,l.frame.x=0,l.frame.y=0,l.frame.width=e,l.frame.height=r,l.updateUvs(),this._poolKeyHash[l.uid]=a,l}getSameSizeTexture(e,r=!1){const s=e.source;return this.getOptimalTexture(e.width,e.height,s._resolution,r)}returnTexture(e,r=!1){const s=this._poolKeyHash[e.uid];r&&(e.source.style=this.textureStyle),this._texturePool[s].push(e)}clear(e){if(e=e!==!1,e)for(const r in this._texturePool){const s=this._texturePool[r];if(s)for(let n=0;n<s.length;n++)s[n].destroy(!0)}this._texturePool={}}}const vx=new vk;Gd.register(vx);class _k{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new pe,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new Wd,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(e){this.root=e,e._onRender&&this.addOnRender(e),e.didChange=!0;const r=e.children;for(let s=0;s<r.length;s++){const n=r[s];n._updateFlags=15,this.addChild(n)}}enableCacheAsTexture(e={}){this.textureOptions=e,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(vx.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const e=this._parentCacheAsTextureRenderGroup;e&&!e.textureNeedsUpdate&&e.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const e in this.childrenToUpdate){const r=this.childrenToUpdate[e];r.list.fill(null),r.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(e){e.renderGroupParent&&e.renderGroupParent._removeRenderGroupChild(e),e.renderGroupParent=this,this.renderGroupChildren.push(e)}_removeRenderGroupChild(e){const r=this.renderGroupChildren.indexOf(e);r>-1&&this.renderGroupChildren.splice(r,1),e.renderGroupParent=null}addChild(e){if(this.structureDidChange=!0,e.parentRenderGroup=this,e.updateTick=-1,e.parent===this.root?e.relativeRenderGroupDepth=1:e.relativeRenderGroupDepth=e.parent.relativeRenderGroupDepth+1,e.didChange=!0,this.onChildUpdate(e),e.renderGroup){this.addRenderGroupChild(e.renderGroup);return}e._onRender&&this.addOnRender(e);const r=e.children;for(let s=0;s<r.length;s++)this.addChild(r[s])}removeChild(e){if(this.structureDidChange=!0,e._onRender&&(e.renderGroup||this.removeOnRender(e)),e.parentRenderGroup=null,e.renderGroup){this._removeRenderGroupChild(e.renderGroup);return}const r=e.children;for(let s=0;s<r.length;s++)this.removeChild(r[s])}removeChildren(e){for(let r=0;r<e.length;r++)this.removeChild(e[r])}onChildUpdate(e){let r=this.childrenToUpdate[e.relativeRenderGroupDepth];r||(r=this.childrenToUpdate[e.relativeRenderGroupDepth]={index:0,list:[]}),r.list[r.index++]=e}updateRenderable(e){e.globalDisplayStatus<7||(this.instructionSet.renderPipes[e.renderPipeId].updateRenderable(e),e.didViewUpdate=!1)}onChildViewUpdate(e){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=e}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(e){this._onRenderContainers.push(e)}removeOnRender(e){this._onRenderContainers.splice(this._onRenderContainers.indexOf(e),1)}runOnRender(e){for(let r=0;r<this._onRenderContainers.length;r++)this._onRenderContainers[r]._onRender(e)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(e=[]){const r=this.root.children;for(let s=0;s<r.length;s++)this._getChildren(r[s],e);return e}_getChildren(e,r=[]){if(r.push(e),e.renderGroup)return r;const s=e.children;for(let n=0;n<s.length;n++)this._getChildren(s[n],r);return r}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return(this._matrixDirty&1)===0?this._inverseWorldTransform:(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new pe),this._inverseWorldTransform.copyFrom(this.worldTransform).invert())}get textureOffsetInverseTransform(){return(this._matrixDirty&2)===0?this._textureOffsetInverseTransform:(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new pe),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y))}get inverseParentTextureTransform(){if((this._matrixDirty&4)===0)return this._inverseParentTextureTransform;this._matrixDirty&=-5;const e=this._parentCacheAsTextureRenderGroup;return e?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new pe),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(e.inverseWorldTransform).translate(-e._textureBounds.x,-e._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function Sk(t,e,r={}){for(const s in e)!r[s]&&e[s]!==void 0&&(t[s]=e[s])}const $c=new ot(null),ia=new ot(null),Gc=new ot(null,1,1),oa=new ot(null),Lm=1,kk=2,Hc=4;class Hn extends os{constructor(e={}){super(),this.uid=Ue("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.parentRenderLayer=null,this.updateTick=-1,this.localTransform=new pe,this.relativeGroupTransform=new pe,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new ot(this,0,0),this._scale=Gc,this._pivot=ia,this._origin=oa,this._skew=$c,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],Sk(this,e,{children:!0,parent:!0,effects:!0}),e.children?.forEach(r=>this.addChild(r)),e.parent?.addChild(this)}static mixin(e){_e("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),zt.mixin(Hn,e)}set _didChangeId(e){this._didViewChangeTick=e>>12&4095,this._didContainerChangeTick=e&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...e){if(this.allowChildren||_e(at,"addChild: Only Containers will be allowed to add children in v8.0.0"),e.length>1){for(let n=0;n<e.length;n++)this.addChild(e[n]);return e[0]}const r=e[0],s=this.renderGroup||this.parentRenderGroup;return r.parent===this?(this.children.splice(this.children.indexOf(r),1),this.children.push(r),s&&(s.structureDidChange=!0),r):(r.parent&&r.parent.removeChild(r),this.children.push(r),this.sortableChildren&&(this.sortDirty=!0),r.parent=this,r.didChange=!0,r._updateFlags=15,s&&s.addChild(r),this.emit("childAdded",r,this,this.children.length-1),r.emit("added",this),this._didViewChangeTick++,r._zIndex!==0&&r.depthOfChildModified(),r)}removeChild(...e){if(e.length>1){for(let n=0;n<e.length;n++)this.removeChild(e[n]);return e[0]}const r=e[0],s=this.children.indexOf(r);return s>-1&&(this._didViewChangeTick++,this.children.splice(s,1),this.renderGroup?this.renderGroup.removeChild(r):this.parentRenderGroup&&this.parentRenderGroup.removeChild(r),r.parentRenderLayer&&r.parentRenderLayer.detach(r),r.parent=null,this.emit("childRemoved",r,this,s),r.emit("removed",this)),r}_onUpdate(e){e&&e===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(e){!!this.renderGroup!==e&&(e?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const e=this.parentRenderGroup;e?.removeChild(this),this.renderGroup=Ct.get(_k,this),this.groupTransform=pe.IDENTITY,e?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const e=this.parentRenderGroup;e?.removeChild(this),Ct.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,e?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new pe),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(e){this._position.x=e}get y(){return this._position.y}set y(e){this._position.y=e}get position(){return this._position}set position(e){this._position.copyFrom(e)}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this._skew))}get angle(){return this.rotation*zS}set angle(e){this.rotation=e*FS}get pivot(){return this._pivot===ia&&(this._pivot=new ot(this,0,0)),this._pivot}set pivot(e){this._pivot===ia&&(this._pivot=new ot(this,0,0),this._origin!==oa&&Nt("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof e=="number"?this._pivot.set(e):this._pivot.copyFrom(e)}get skew(){return this._skew===$c&&(this._skew=new ot(this,0,0)),this._skew}set skew(e){this._skew===$c&&(this._skew=new ot(this,0,0)),this._skew.copyFrom(e)}get scale(){return this._scale===Gc&&(this._scale=new ot(this,1,1)),this._scale}set scale(e){this._scale===Gc&&(this._scale=new ot(this,0,0)),typeof e=="string"&&(e=parseFloat(e)),typeof e=="number"?this._scale.set(e):this._scale.copyFrom(e)}get origin(){return this._origin===oa&&(this._origin=new ot(this,0,0)),this._origin}set origin(e){this._origin===oa&&(this._origin=new ot(this,0,0),this._pivot!==ia&&Nt("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof e=="number"?this._origin.set(e):this._origin.copyFrom(e)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(e){const r=this.getLocalBounds().width;this._setWidth(e,r)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(e){const r=this.getLocalBounds().height;this._setHeight(e,r)}getSize(e){e||(e={});const r=this.getLocalBounds();return e.width=Math.abs(this.scale.x*r.width),e.height=Math.abs(this.scale.y*r.height),e}setSize(e,r){const s=this.getLocalBounds();typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,s.width),r!==void 0&&this._setHeight(r,s.height)}_updateSkew(){const e=this._rotation,r=this._skew;this._cx=Math.cos(e+r._y),this._sx=Math.sin(e+r._y),this._cy=-Math.sin(e-r._x),this._sy=Math.cos(e-r._x)}updateTransform(e){return this.position.set(typeof e.x=="number"?e.x:this.position.x,typeof e.y=="number"?e.y:this.position.y),this.scale.set(typeof e.scaleX=="number"?e.scaleX||1:this.scale.x,typeof e.scaleY=="number"?e.scaleY||1:this.scale.y),this.rotation=typeof e.rotation=="number"?e.rotation:this.rotation,this.skew.set(typeof e.skewX=="number"?e.skewX:this.skew.x,typeof e.skewY=="number"?e.skewY:this.skew.y),this.pivot.set(typeof e.pivotX=="number"?e.pivotX:this.pivot.x,typeof e.pivotY=="number"?e.pivotY:this.pivot.y),this.origin.set(typeof e.originX=="number"?e.originX:this.origin.x,typeof e.originY=="number"?e.originY:this.origin.y),this}setFromMatrix(e){e.decompose(this)}updateLocalTransform(){const e=this._didContainerChangeTick;if(this._didLocalTransformChangeId===e)return;this._didLocalTransformChangeId=e;const r=this.localTransform,s=this._scale,n=this._pivot,i=this._origin,o=this._position,a=s._x,l=s._y,c=n._x,u=n._y,h=-i._x,f=-i._y;r.a=this._cx*a,r.b=this._sx*a,r.c=this._cy*l,r.d=this._sy*l,r.tx=o._x-(c*r.a+u*r.c)+(h*r.a+f*r.c)-h,r.ty=o._y-(c*r.b+u*r.d)+(h*r.b+f*r.d)-f}set alpha(e){e!==this.localAlpha&&(this.localAlpha=e,this._updateFlags|=Lm,this._onUpdate())}get alpha(){return this.localAlpha}set tint(e){const s=be.shared.setValue(e??16777215).toBgrNumber();s!==this.localColor&&(this.localColor=s,this._updateFlags|=Lm,this._onUpdate())}get tint(){return za(this.localColor)}set blendMode(e){this.localBlendMode!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=kk,this.localBlendMode=e,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(e){const r=e?2:0;(this.localDisplayStatus&2)!==r&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Hc,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(e){const r=e?0:4;(this.localDisplayStatus&4)!==r&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Hc,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(e){const r=e?1:0;(this.localDisplayStatus&1)!==r&&(this._updateFlags|=Hc,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(e=!1){if(this.destroyed)return;this.destroyed=!0;let r;if(this.children.length&&(r=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof e=="boolean"?e:e?.children)&&r)for(let n=0;n<r.length;++n)r[n].destroy(e);this.renderGroup?.destroy(),this.renderGroup=null}}zt.mixin(Hn,ck,mk,wk,qk,yk,dk,fk,xk,nk,ak,gk,uk);class _x extends Hn{constructor(e){super(e),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this._bounds=new nr(0,1,0,0),this._boundsDirty=!0,this.autoGarbageCollect=e.autoGarbageCollect??!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(e){this._roundPixels=e?1:0}containsPoint(e){const r=this.bounds,{x:s,y:n}=e;return s>=r.minX&&s<=r.maxX&&n>=r.minY&&n<=r.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const e=this.renderGroup||this.parentRenderGroup;e&&e.onChildViewUpdate(this)}unload(){this.emit("unload",this);for(const e in this._gpuData)this._gpuData[e]?.destroy();this._gpuData=Object.create(null),this.onViewUpdate()}destroy(e){this.unload(),super.destroy(e),this._bounds=null}collectRenderablesSimple(e,r,s){const{renderPipes:n}=r;n.blendMode.pushBlendMode(this,this.groupBlendMode,e);const o=n[this.renderPipeId];o?.addRenderable&&o.addRenderable(this,e),this.didViewUpdate=!1;const a=this.children,l=a.length;for(let c=0;c<l;c++)a[c].collectRenderables(e,r,s);n.blendMode.popBlendMode(e)}}class Ns extends _x{constructor(e=Ae.EMPTY){e instanceof Ae&&(e={texture:e});const{texture:r=Ae.EMPTY,anchor:s,roundPixels:n,width:i,height:o,...a}=e;super({label:"Sprite",...a}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new ot({_onUpdate:()=>{this.onViewUpdate()}}),s?this.anchor=s:r.defaultAnchor&&(this.anchor=r.defaultAnchor),this.texture=r,this.allowChildren=!1,this.roundPixels=n??!1,i!==void 0&&(this.width=i),o!==void 0&&(this.height=o)}static from(e,r=!1){return e instanceof Ae?new Ns(e):new Ns(Ae.from(e,r))}set texture(e){e||(e=Ae.EMPTY);const r=this._texture;r!==e&&(r&&r.dynamic&&r.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return YS(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return _e("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const e=this._anchor,r=this._texture,s=this._bounds,{width:n,height:i}=r.orig;s.minX=-e._x*n,s.maxX=s.minX+n,s.minY=-e._y*i,s.maxY=s.minY+i}destroy(e=!1){if(super.destroy(e),typeof e=="boolean"?e:e?.texture){const s=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(s)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this._setWidth(e,this._texture.orig.width),this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this._setHeight(e,this._texture.orig.height),this._height=e}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this._texture.orig.width,e.height=Math.abs(this.scale.y)*this._texture.orig.height,e}setSize(e,r){typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,this._texture.orig.width),r!==void 0&&this._setHeight(r,this._texture.orig.height)}}const Ck=new nr;function Sx(t,e,r){const s=Ck;t.measurable=!0,yx(t,r,s),e.addBoundsMask(s),t.measurable=!1}function kx(t,e,r){const s=Pr.get();t.measurable=!0;const n=mt.get().identity(),i=Cx(t,r,n);bx(t,s,i),t.measurable=!1,e.addBoundsMask(s),mt.return(n),Pr.return(s)}function Cx(t,e,r){return t?(t!==e&&(Cx(t.parent,e,r),t.updateLocalTransform(),r.append(t.localTransform)),r):(Nt("Mask bounds, renderable is not inside the root container"),r)}class Ex{constructor(e){this.priority=0,this.inverse=!1,this.pipe="alphaMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.renderMaskToTexture=!(e instanceof Ns),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask=null)}addBounds(e,r){this.inverse||Sx(this.mask,e,r)}addLocalBounds(e,r){kx(this.mask,e,r)}containsPoint(e,r){const s=this.mask;return r(s,e)}destroy(){this.reset()}static test(e){return e instanceof Ns}}Ex.extension=we.MaskEffect;class Tx{constructor(e){this.priority=0,this.pipe="colorMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e}destroy(){}static test(e){return typeof e=="number"}}Tx.extension=we.MaskEffect;class Px{constructor(e){this.priority=0,this.pipe="stencilMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null)}addBounds(e,r){Sx(this.mask,e,r)}addLocalBounds(e,r){kx(this.mask,e,r)}containsPoint(e,r){const s=this.mask;return r(s,e)}destroy(){this.reset()}static test(e){return e instanceof Hn}}Px.extension=we.MaskEffect;const Ek={createCanvas:(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>new DOMParser().parseFromString(t,"text/xml")};let Um=Ek;const So={get(){return Um},set(t){Um=t}};class Rx extends Xt{constructor(e){e.resource||(e.resource=So.get().createCanvas()),e.width||(e.width=e.resource.width,e.autoDensity||(e.width/=e.resolution)),e.height||(e.height=e.resource.height,e.autoDensity||(e.height/=e.resolution)),super(e),this.uploadMethodId="image",this.autoDensity=e.autoDensity,this.resizeCanvas(),this.transparent=!!e.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(e=this.width,r=this.height,s=this._resolution){const n=super.resize(e,r,s);return n&&this.resizeCanvas(),n}static test(e){return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&e instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}Rx.extension=we.TextureSource;class il extends Xt{constructor(e){super(e),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(e){return globalThis.HTMLImageElement&&e instanceof HTMLImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||globalThis.VideoFrame&&e instanceof VideoFrame}}il.extension=we.TextureSource;var ol=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(ol||{});class Wc{constructor(e,r=null,s=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=e,this._context=r,this.priority=s,this._once=n}match(e,r=null){return this._fn===e&&this._context===r}emit(e){this._fn&&(this._context?this._fn.call(this._context,e):this._fn(e));const r=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),r}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const r=this.next;return this.next=e?null:r,this.previous=null,r}}const Mx=class Pt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Wc(null,null,1/0),this.deltaMS=1/Pt.targetFPMS,this.elapsedMS=1/Pt.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,r,s=ol.NORMAL){return this._addListener(new Wc(e,r,s))}addOnce(e,r,s=ol.NORMAL){return this._addListener(new Wc(e,r,s,!0))}_addListener(e){let r=this._head.next,s=this._head;if(!r)e.connect(s);else{for(;r;){if(e.priority>r.priority){e.connect(s);break}s=r,r=r.next}e.previous||e.connect(s)}return this._startIfPossible(),this}remove(e,r){let s=this._head.next;for(;s;)s.match(e,r)?s=s.destroy():s=s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,r=this._head;for(;r=r.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let r;if(e>this.lastTime){if(r=this.elapsedMS=e-this.lastTime,r>this._maxElapsedMS&&(r=this._maxElapsedMS),r*=this.speed,this._minElapsedMS){const i=e-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=e-i%this._minElapsedMS}this.deltaMS=r,this.deltaTime=this.deltaMS*Pt.targetFPMS;const s=this._head;let n=s.next;for(;n;)n=n.emit(this);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const r=Math.min(this.maxFPS,e),s=Math.min(Math.max(0,r)/1e3,Pt.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const r=Math.max(this.minFPS,e);this._minElapsedMS=1/(r/1e3)}}static get shared(){if(!Pt._shared){const e=Pt._shared=new Pt;e.autoStart=!0,e._protected=!0}return Pt._shared}static get system(){if(!Pt._system){const e=Pt._system=new Pt;e.autoStart=!0,e._protected=!0}return Pt._system}};Mx.targetFPMS=.06;let gt=Mx,Yc;async function Tk(){return Yc??(Yc=(async()=>{const e=So.get().createCanvas(1,1).getContext("webgl");if(!e)return"premultiply-alpha-on-upload";const r=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!r)return"premultiply-alpha-on-upload";const s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);const n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r);const i=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,i),e.deleteFramebuffer(n),e.deleteTexture(s),e.getExtension("WEBGL_lose_context")?.loseContext(),i[0]<=i[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Yc}const Fl=class Ix extends Xt{constructor(e){super(e),this.isReady=!1,this.uploadMethodId="video",e={...Ix.defaultOptions,...e},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this.alphaMode=e.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const e=gt.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const e=this.resource,r=this.options;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(r.preload||e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlayThrough),e.addEventListener("error",this._onError,!0)),this.alphaMode=await Tk(),this._load=new Promise((s,n)=>{this.isValid?s(this):(this._resolve=s,this._reject=n,r.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${r.preloadTimeoutMs}ms`))})),e.load())}),this._load}_onError(e){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.resource;return!e.paused&&!e.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const e=this.resource;this.isValid&&(this.isReady=!0,this.resize(e.videoWidth,e.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const e=this.resource;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlayThrough),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(gt.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(gt.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(gt.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement}};Fl.extension=we.TextureSource;Fl.defaultOptions={...Xt.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};Fl.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Pk=Fl;const sn=(t,e,r=!1)=>(Array.isArray(t)||(t=[t]),e?t.map(s=>typeof s=="string"||r?e(s):s):t);class Rk{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const r=this._cache.get(e);return r||Nt(`[Assets] Asset id ${e} was not found in the Cache`),r}set(e,r){const s=sn(e);let n;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.test(r)){n=c.getCacheableAssets(s,r);break}}const i=new Map(Object.entries(n||{}));n||s.forEach(l=>{i.set(l,r)});const o=[...i.keys()],a={cacheKeys:o,keys:s};s.forEach(l=>{this._cacheMap.set(l,a)}),o.forEach(l=>{const c=n?n[l]:r;this._cache.has(l)&&this._cache.get(l)!==c&&Nt("[Cache] already has key:",l),this._cache.set(l,i.get(l))})}remove(e){if(!this._cacheMap.has(e)){Nt(`[Assets] Asset id ${e} was not found in the Cache`);return}const r=this._cacheMap.get(e);r.cacheKeys.forEach(n=>{this._cache.delete(n)}),r.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const nn=new Rk,yh=[];zt.handleByList(we.TextureSource,yh);function jx(t={}){const e=t&&t.resource,r=e?t.resource:t,s=e?t:{resource:t};for(let n=0;n<yh.length;n++){const i=yh[n];if(i.test(r))return new i(s)}throw new Error(`Could not find a source type for resource: ${s.resource}`)}function Mk(t={},e=!1){const r=t&&t.resource,s=r?t.resource:t,n=r?t:{resource:t};if(!e&&nn.has(s))return nn.get(s);const i=new Ae({source:jx(n)});return i.on("destroy",()=>{nn.has(s)&&nn.remove(s)}),e||nn.set(s,i),i}function Ik(t,e=!1){return typeof t=="string"?nn.get(t):t instanceof Xt?new Ae({source:t}):Mk(t,e)}Ae.from=Ik;Xt.from=jx;zt.add(Ex,Tx,Px,Pk,il,Rx,$d);var Ox=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Ox||{});function Zt(t){if(typeof t!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function ii(t){return t.split("?")[0].split("#")[0]}function jk(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ok(t,e,r){return t.replace(new RegExp(jk(e),"g"),r)}function Nk(t,e){let r="",s=0,n=-1,i=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||i===1))if(n!==a-1&&i===2){if(r.length<2||s!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){const l=r.lastIndexOf("/");if(l!==r.length-1){l===-1?(r="",s=0):(r=r.slice(0,l),s=r.length-1-r.lastIndexOf("/")),n=a,i=0;continue}}else if(r.length===2||r.length===1){r="",s=0,n=a,i=0;continue}}}else r.length>0?r+=`/${t.slice(n+1,a)}`:r=t.slice(n+1,a),s=a-n-1;n=a,i=0}else o===46&&i!==-1?++i:i=-1}return r}const Yi={toPosix(t){return Ok(t,"\\","/")},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},isBlobUrl(t){return t.startsWith("blob:")},hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){Zt(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const r=/^[^/:]+:\/{0,2}/.exec(t);return r?r[0]:""},toAbsolute(t,e,r){if(Zt(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const s=ii(this.toPosix(e??So.get().getBaseUrl())),n=ii(this.toPosix(r??this.rootname(s)));return t=this.toPosix(t),t.startsWith("/")?Yi.join(n,t.slice(1)):this.isAbsolute(t)?t:this.join(s,t)},normalize(t){if(Zt(t),t.length===0)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;t=this.toPosix(t);let e="";const r=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const s=t.endsWith("/");return t=Nk(t),t.length>0&&s&&(t+="/"),r?`/${t}`:e+t},isAbsolute(t){return Zt(t),t=this.toPosix(t),this.hasProtocol(t)?!0:t.startsWith("/")},join(...t){if(t.length===0)return".";let e;for(let r=0;r<t.length;++r){const s=t[r];if(Zt(s),s.length>0)if(e===void 0)e=s;else{const n=t[r-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?e+=`/../${s}`:e+=`/${s}`}}return e===void 0?".":this.normalize(e)},dirname(t){if(Zt(t),t.length===0)return".";t=this.toPosix(t);let e=t.charCodeAt(0);const r=e===47;let s=-1,n=!0;const i=this.getProtocol(t),o=t;t=t.slice(i.length);for(let a=t.length-1;a>=1;--a)if(e=t.charCodeAt(a),e===47){if(!n){s=a;break}}else n=!1;return s===-1?r?"/":this.isUrl(o)?i+t:i:r&&s===1?"//":i+t.slice(0,s)},rootname(t){Zt(t),t=this.toPosix(t);let e="";if(t.startsWith("/")?e="/":e=this.getProtocol(t),this.isUrl(t)){const r=t.indexOf("/",e.length);r!==-1?e=t.slice(0,r):e=t,e.endsWith("/")||(e+="/")}return e},basename(t,e){Zt(t),e&&Zt(e),t=ii(this.toPosix(t));let r=0,s=-1,n=!0,i;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(i=t.length-1;i>=0;--i){const l=t.charCodeAt(i);if(l===47){if(!n){r=i+1;break}}else a===-1&&(n=!1,a=i+1),o>=0&&(l===e.charCodeAt(o)?--o===-1&&(s=i):(o=-1,s=a))}return r===s?s=a:s===-1&&(s=t.length),t.slice(r,s)}for(i=t.length-1;i>=0;--i)if(t.charCodeAt(i)===47){if(!n){r=i+1;break}}else s===-1&&(n=!1,s=i+1);return s===-1?"":t.slice(r,s)},extname(t){Zt(t),t=ii(this.toPosix(t));let e=-1,r=0,s=-1,n=!0,i=0;for(let o=t.length-1;o>=0;--o){const a=t.charCodeAt(o);if(a===47){if(!n){r=o+1;break}continue}s===-1&&(n=!1,s=o+1),a===46?e===-1?e=o:i!==1&&(i=1):e!==-1&&(i=-1)}return e===-1||s===-1||i===0||i===1&&e===s-1&&e===r+1?"":t.slice(e,s)},parse(t){Zt(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;t=ii(this.toPosix(t));let r=t.charCodeAt(0);const s=this.isAbsolute(t);let n;e.root=this.rootname(t),s||this.hasProtocol(t)?n=1:n=0;let i=-1,o=0,a=-1,l=!0,c=t.length-1,u=0;for(;c>=n;--c){if(r=t.charCodeAt(c),r===47){if(!l){o=c+1;break}continue}a===-1&&(l=!1,a=c+1),r===46?i===-1?i=c:u!==1&&(u=1):i!==-1&&(u=-1)}return i===-1||a===-1||u===0||u===1&&i===a-1&&i===o+1?a!==-1&&(o===0&&s?e.base=e.name=t.slice(1,a):e.base=e.name=t.slice(o,a)):(o===0&&s?(e.name=t.slice(1,i),e.base=t.slice(1,a)):(e.name=t.slice(o,i),e.base=t.slice(o,a)),e.ext=t.slice(i,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":",joinExtensions:[".html"]};function Nx(t,e,r,s,n){const i=e[r];for(let o=0;o<i.length;o++){const a=i[o];r<e.length-1?Nx(t.replace(s[r],a),e,r+1,s,n):n.push(t.replace(s[r],a))}}function Bk(t){const e=/\{(.*?)\}/g,r=t.match(e),s=[];if(r){const n=[];r.forEach(i=>{const o=i.substring(1,i.length-1).split(",");n.push(o)}),Nx(t,n,0,r,s)}else s.push(t);return s}const $m=t=>!Array.isArray(t);class Bx{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,r)=>`${e}${this._bundleIdConnector}${r}`,extractAssetIdFromBundle:(e,r)=>r.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const r=e;this._defaultSearchParams=Object.keys(r).map(s=>`${encodeURIComponent(s)}=${encodeURIComponent(r[s])}`).join("&")}}getAlias(e){const{alias:r,src:s}=e;return sn(r||s,i=>typeof i=="string"?i:Array.isArray(i)?i.map(o=>o?.src??o):i?.src?i.src:i,!0)}addManifest(e){this._manifest&&Nt("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(e,r){const s=[];let n=r;Array.isArray(r)||(n=Object.entries(r).map(([i,o])=>typeof o=="string"||Array.isArray(o)?{alias:i,src:o}:{alias:i,...o})),n.forEach(i=>{const o=i.src,a=i.alias;let l;if(typeof a=="string"){const c=this._createBundleAssetId(e,a);s.push(c),l=[a,c]}else{const c=a.map(u=>this._createBundleAssetId(e,u));s.push(...c),l=[...a,...c]}this.add({...i,alias:l,src:o})}),this._bundles[e]=s}add(e){const r=[];Array.isArray(e)?r.push(...e):r.push(e);let s;s=i=>{this.hasKey(i)&&Nt(`[Resolver] already has key: ${i} overwriting`)},sn(r).forEach(i=>{const{src:o}=i;let{data:a,format:l,loadParser:c,parser:u}=i;const h=sn(o).map(g=>typeof g=="string"?Bk(g):Array.isArray(g)?g:[g]),f=this.getAlias(i);Array.isArray(f)?f.forEach(s):s(f);const d=[],m=g=>{const A=this._parsers.find(y=>y.test(g));return{src:g,...A?.parse(g)}};h.forEach(g=>{g.forEach(A=>{let y={};if(typeof A!="object"?y=m(A):(a=A.data??a,l=A.format??l,(A.loadParser||A.parser)&&(c=A.loadParser??c,u=A.parser??u),y={...m(A.src),...A}),!f)throw new Error(`[Resolver] alias is undefined for this asset: ${y.src}`);y=this._buildResolvedAsset(y,{aliases:f,data:a,format:l,loadParser:c,parser:u,progressSize:i.progressSize}),d.push(y)})}),f.forEach(g=>{this._assetMap[g]=d})})}resolveBundle(e){const r=$m(e);e=sn(e);const s={};return e.forEach(n=>{const i=this._bundles[n];if(i){const o=this.resolve(i),a={};for(const l in o){const c=o[l];a[this._extractAssetIdFromBundle(n,l)]=c}s[n]=a}}),r?s[e[0]]:s}resolveUrl(e){const r=this.resolve(e);if(typeof e!="string"){const s={};for(const n in r)s[n]=r[n].src;return s}return r.src}resolve(e){const r=$m(e);e=sn(e);const s={};return e.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let i=this._assetMap[n];const o=this._getPreferredOrder(i);o?.priority.forEach(a=>{o.params[a].forEach(l=>{const c=i.filter(u=>u[a]?u[a]===l:!1);c.length&&(i=c)})}),this._resolverHash[n]=i[0]}else this._resolverHash[n]=this._buildResolvedAsset({alias:[n],src:n},{});s[n]=this._resolverHash[n]}),r?s[e[0]]:s}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let r=0;r<e.length;r++){const s=e[r],n=this._preferredOrder.find(i=>i.params.format.includes(s.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const r=/\?/.test(e)?"&":"?";return`${e}${r}${this._defaultSearchParams}`}_buildResolvedAsset(e,r){const{aliases:s,data:n,loadParser:i,parser:o,format:a,progressSize:l}=r;return(this._basePath||this._rootPath)&&(e.src=Yi.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=s??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...n||{},...e.data},e.loadParser=i??e.loadParser,e.parser=o??e.parser,e.format=a??e.format??Dk(e.src),l!==void 0&&(e.progressSize=l),e}}Bx.RETINA_PREFIX=/@([0-9\.]+)x/;function Dk(t){return t.split(".").pop().split("?").shift().split("#").shift()}const Gm=(t,e)=>{const r=e.split("?")[1];return r&&(t+=`?${r}`),t},Dx=class Vi{constructor(e,r){this.linkedSheets=[];let s=e;e?.source instanceof Xt&&(s={texture:e,data:r});const{texture:n,data:i,cachePrefix:o=""}=s;this.cachePrefix=o,this._texture=n instanceof Ae?n:null,this.textureSource=n.source,this.textures={},this.animations={},this.data=i;const a=parseFloat(i.meta.scale);a?(this.resolution=a,n.source.resolution=this.resolution):this.resolution=n.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Vi.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}parseSync(){return this._processFrames(0,!0),this._processAnimations(),this.textures}_processFrames(e,r=!1){let s=e;const n=r?1/0:Vi.BATCH_SIZE;for(;s-e<n&&s<this._frameKeys.length;){const i=this._frameKeys[s],o=this._frames[i],a=o.frame;if(a){let l=null,c=null;const u=o.trimmed!==!1&&o.sourceSize?o.sourceSize:o.frame,h=new Ye(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);o.rotated?l=new Ye(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):l=new Ye(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),o.trimmed!==!1&&o.spriteSourceSize&&(c=new Ye(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[i]=new Ae({source:this.textureSource,frame:l,orig:h,trim:c,rotate:o.rotated?2:0,defaultAnchor:o.anchor,defaultBorders:o.borders,label:i.toString()})}s++}}_processAnimations(){const e=this.data.animations||{};for(const r in e){this.animations[r]=[];for(let s=0;s<e[r].length;s++){const n=e[r][s];this.animations[r].push(this.textures[n])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Vi.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Vi.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};Dx.BATCH_SIZE=1e3;let qh=Dx;const zk=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function zx(t,e,r){const s={};if(t.forEach(n=>{s[n]=e}),Object.keys(e.textures).forEach(n=>{s[`${e.cachePrefix}${n}`]=e.textures[n]}),!r){const n=Yi.dirname(t[0]);e.linkedSheets.forEach((i,o)=>{const a=zx([`${n}/${e.data.meta.related_multi_packs[o]}`],i,!0);Object.assign(s,a)})}return s}const Fk={extension:we.Asset,cache:{test:t=>t instanceof qh,getCacheableAssets:(t,e)=>zx(t,e,!1)},resolver:{extension:{type:we.ResolveParser,name:"resolveSpritesheet"},test:t=>{const r=t.split("?")[0].split("."),s=r.pop(),n=r.pop();return s==="json"&&zk.includes(n)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(Bx.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:we.LoadParser,priority:Ox.Normal,name:"spritesheetLoader"},async testParse(t,e){return Yi.extname(e.src).toLowerCase()===".json"&&!!t.frames},async parse(t,e,r){const{texture:s,imageFilename:n,textureOptions:i,cachePrefix:o}=e?.data??{};let a=Yi.dirname(e.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let l;if(s instanceof Ae)l=s;else{const h=Gm(a+(n??t.meta.image),e.src);l=(await r.load([{src:h,data:i}]))[h]}const c=new qh({texture:l.source,data:t,cachePrefix:o});await c.parse();const u=t?.meta?.related_multi_packs;if(Array.isArray(u)){const h=[];for(const d of u){if(typeof d!="string")continue;let m=a+d;e.data?.ignoreMultiPack||(m=Gm(m,e.src),h.push(r.load({src:m,data:{textureOptions:i,ignoreMultiPack:!0}})))}const f=await Promise.all(h);c.linkedSheets=f,f.forEach(d=>{d.linkedSheets=[c].concat(c.linkedSheets.filter(m=>m!==d))})}return c},async unload(t,e,r){await r.unload(t.textureSource._sourceOrigin),t.destroy(!1)}}};zt.add(Fk);const Kc=Object.create(null),Hm=Object.create(null);function Yd(t,e){let r=Hm[t];return r===void 0&&(Kc[e]===void 0&&(Kc[e]=1),Hm[t]=r=Kc[e]++),r}let aa;function Fx(){return(!aa||aa?.isContextLost())&&(aa=So.get().createCanvas().getContext("webgl",{})),aa}let la;function Lk(){if(!la){la="mediump";const t=Fx();t&&t.getShaderPrecisionFormat&&(la=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?"highp":"mediump")}return la}function Uk(t,e,r){return e?t:r?(t=t.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${t}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${t}
        `}function $k(t,e,r){const s=r?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if(t.substring(0,9)!=="precision"){let n=r?e.requestedFragmentPrecision:e.requestedVertexPrecision;return n==="highp"&&s!=="highp"&&(n="mediump"),`precision ${n} float;
${t}`}else if(s!=="highp"&&t.substring(0,15)==="precision highp")return t.replace("precision highp","precision mediump");return t}function Gk(t,e){return e?`#version 300 es
${t}`:t}const Hk={},Wk={};function Yk(t,{name:e="pixi-program"},r=!0){e=e.replace(/\s+/g,"-"),e+=r?"-fragment":"-vertex";const s=r?Hk:Wk;return s[e]?(s[e]++,e+=`-${s[e]}`):s[e]=1,t.indexOf("#define SHADER_NAME")!==-1?t:`${`#define SHADER_NAME ${e}`}
${t}`}function Kk(t,e){return e?t.replace("#version 300 es",""):t}const Qc={stripVersion:Kk,ensurePrecision:$k,addProgramDefines:Uk,setProgramName:Yk,insertVersion:Gk},oi=Object.create(null),Lx=class xh{constructor(e){e={...xh.defaultOptions,...e};const r=e.fragment.indexOf("#version 300 es")!==-1,s={stripVersion:r,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:Lk()},setProgramName:{name:e.name},addProgramDefines:r,insertVersion:r};let n=e.fragment,i=e.vertex;Object.keys(Qc).forEach(o=>{const a=s[o];n=Qc[o](n,a,!0),i=Qc[o](i,a,!1)}),this.fragment=n,this.vertex=i,this.transformFeedbackVaryings=e.transformFeedbackVaryings,this._key=Yd(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,oi[this._cacheKey]=null}static from(e){const r=`${e.vertex}:${e.fragment}`;return oi[r]||(oi[r]=new xh(e),oi[r]._cacheKey=r),oi[r]}};Lx.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let Ll=Lx;const Wm={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function Qk(t){return Wm[t]??Wm.float32}const Xk={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"},Ym=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|\)|$)/g;function Km(t,e){let r;for(;(r=Ym.exec(t))!==null;){const s=Xk[r[3]]??"float32";e[r[2]]={location:parseInt(r[1],10),format:s,stride:Qk(s).stride,offset:0,instance:!1,start:0}}Ym.lastIndex=0}function Jk(t){return t.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"")}function Zk({source:t,entryPoint:e}){const r={},s=Jk(t),n=s.indexOf(`fn ${e}(`);if(n===-1)return r;const i=s.indexOf("->",n);if(i===-1)return r;const o=s.substring(n,i);if(Km(o,r),Object.keys(r).length===0){const a=o.match(/\(\s*\w+\s*:\s*(\w+)/);if(a){const l=a[1],c=new RegExp(`struct\\s+${l}\\s*\\{([^}]+)\\}`,"s"),u=s.match(c);u&&Km(u[1],r)}}return r}function Xc(t){const e=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,r=/@group\((\d+)\)/,s=/@binding\((\d+)\)/,n=/var(<[^>]+>)? (\w+)/,i=/:\s*([\w<>]+)/,o=/struct\s+(\w+)\s*{([^}]+)}/g,a=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,c=t.match(e)?.map(h=>({group:parseInt(h.match(r)[1],10),binding:parseInt(h.match(s)[1],10),name:h.match(n)[2],isUniform:h.match(n)[1]==="<uniform>",type:h.match(i)[1]}));if(!c)return{groups:[],structs:[]};const u=t.match(o)?.map(h=>{const f=h.match(l)[1],d=h.match(a).reduce((m,g)=>{const[A,y]=g.split(":");return m[A.trim()]=y.trim(),m},{});return d?{name:f,members:d}:null}).filter(({name:h})=>c.some(f=>f.type===h||f.type.includes(`<${h}>`)))??[];return{groups:c,structs:u}}var xs=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(xs||{});function eC({groups:t}){const e=[];for(let r=0;r<t.length;r++){const s=t[r];e[s.group]||(e[s.group]=[]),s.isUniform?e[s.group].push({binding:s.binding,visibility:xs.VERTEX|xs.FRAGMENT,buffer:{type:"uniform"}}):s.type==="sampler"?e[s.group].push({binding:s.binding,visibility:xs.FRAGMENT,sampler:{type:"filtering"}}):s.type==="texture_2d"||s.type.startsWith("texture_2d<")?e[s.group].push({binding:s.binding,visibility:xs.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}}):s.type==="texture_2d_array"||s.type.startsWith("texture_2d_array<")?e[s.group].push({binding:s.binding,visibility:xs.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d-array",multisampled:!1}}):(s.type==="texture_cube"||s.type.startsWith("texture_cube<"))&&e[s.group].push({binding:s.binding,visibility:xs.FRAGMENT,texture:{sampleType:"float",viewDimension:"cube",multisampled:!1}})}for(let r=0;r<e.length;r++)e[r]||(e[r]=[]);return e}function tC({groups:t}){const e=[];for(let r=0;r<t.length;r++){const s=t[r];e[s.group]||(e[s.group]={}),e[s.group][s.name]=s.binding}return e}function rC(t,e){const r=new Set,s=new Set,n=[...t.structs,...e.structs].filter(o=>r.has(o.name)?!1:(r.add(o.name),!0)),i=[...t.groups,...e.groups].filter(o=>{const a=`${o.name}-${o.binding}`;return s.has(a)?!1:(s.add(a),!0)});return{structs:n,groups:i}}const ai=Object.create(null);class ko{constructor(e){this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:r,vertex:s,layout:n,gpuLayout:i,name:o}=e;if(this.name=o,this.fragment=r,this.vertex=s,r.source===s.source){const a=Xc(r.source);this.structsAndGroups=a}else{const a=Xc(s.source),l=Xc(r.source);this.structsAndGroups=rC(a,l)}this.layout=n??tC(this.structsAndGroups),this.gpuLayout=i??eC(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:e,fragment:r}=this,s=e.source+r.source+e.entryPoint+r.entryPoint;this._layoutKey=Yd(s,"program")}get attributeData(){return this._attributeData??(this._attributeData=Zk(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,ai[this._cacheKey]=null}static from(e){const r=`${e.vertex.source}:${e.fragment.source}:${e.fragment.entryPoint}:${e.vertex.entryPoint}`;return ai[r]||(ai[r]=new ko(e),ai[r]._cacheKey=r),ai[r]}}const Ux=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],sC=Ux.reduce((t,e)=>(t[e]=!0,t),{});function nC(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const $x=class Gx{constructor(e,r){this._touched=0,this.uid=Ue("uniform"),this._resourceType="uniformGroup",this._resourceId=Ue("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,r={...Gx.defaultOptions,...r},this.uniformStructures=e;const s={};for(const n in e){const i=e[n];if(i.name=n,i.size=i.size??1,!sC[i.type]){const o=i.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(o){const[,a,l]=o;throw new Error(`Uniform type ${i.type} is not supported. Use type: '${a}', size: ${l} instead.`)}throw new Error(`Uniform type ${i.type} is not supported. Supported uniform types are: ${Ux.join(", ")}`)}i.value??(i.value=nC(i.type,i.size)),s[n]=i.value}this.uniforms=s,this._dirtyId=1,this.ubo=r.ubo,this.isStatic=r.isStatic,this._signature=Yd(Object.keys(s).map(n=>`${n}-${e[n].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};$x.defaultOptions={ubo:!1,isStatic:!1};let Hx=$x;class Fa{constructor(e){this.resources=Object.create(null),this._dirty=!0;let r=0;for(const s in e){const n=e[s];this.setResource(n,r++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const e=[];let r=0;for(const s in this.resources)e[r++]=this.resources[s]._resourceId;this._key=e.join("|")}setResource(e,r){const s=this.resources[r];e!==s&&(s&&e.off?.("change",this.onResourceChange,this),e.on?.("change",this.onResourceChange,this),this.resources[r]=e,this._dirty=!0)}getResource(e){return this.resources[e]}_touch(e,r){const s=this.resources;for(const n in s)s[n]._gcLastUsed=e,s[n]._touched=r}destroy(){const e=this.resources;for(const r in e)e[r]?.off?.("change",this.onResourceChange,this);this.resources=null}onResourceChange(e){if(this._dirty=!0,e.destroyed){const r=this.resources;for(const s in r)r[s]===e&&(r[s]=null)}else this._updateKey()}}var bh=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.CANVAS=4]="CANVAS",t[t.BOTH=3]="BOTH",t))(bh||{});class Ul extends os{constructor(e){super(),this.uid=Ue("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[],this._destroyed=!1;let{gpuProgram:r,glProgram:s,groups:n,resources:i,compatibleRenderers:o,groupMap:a}=e;this.gpuProgram=r,this.glProgram=s,o===void 0&&(o=0,r&&(o|=bh.WEBGPU),s&&(o|=bh.WEBGL)),this.compatibleRenderers=o;const l={};if(!i&&!n&&(i={}),i&&n)throw new Error("[Shader] Cannot have both resources and groups");if(!r&&n&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!r&&n&&a)for(const c in a)for(const u in a[c]){const h=a[c][u];l[h]={group:c,binding:u,name:h}}else if(r&&n&&!a){const c=r.structsAndGroups.groups;a={},c.forEach(u=>{a[u.group]=a[u.group]||{},a[u.group][u.binding]=u.name,l[u.name]=u})}else if(i){n={},a={},r&&r.structsAndGroups.groups.forEach(h=>{a[h.group]=a[h.group]||{},a[h.group][h.binding]=h.name,l[h.name]=h});let c=0;for(const u in i)l[u]||(n[99]||(n[99]=new Fa,this._ownedBindGroups.push(n[99])),l[u]={group:99,binding:c,name:u},a[99]=a[99]||{},a[99][c]=u,c++);for(const u in i){const h=u;let f=i[u];!f.source&&!f._resourceType&&(f=new Hx(f));const d=l[h];d&&(n[d.group]||(n[d.group]=new Fa,this._ownedBindGroups.push(n[d.group])),n[d.group].setResource(f,d.binding))}}this.groups=n,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(n,l)}addResource(e,r,s){var n,i;(n=this._uniformBindMap)[r]||(n[r]={}),(i=this._uniformBindMap[r])[s]||(i[s]=e),this.groups[r]||(this.groups[r]=new Fa,this._ownedBindGroups.push(this.groups[r]))}_buildResourceAccessor(e,r){const s={};for(const n in r){const i=r[n];Object.defineProperty(s,i.name,{get(){return e[i.group].getResource(i.binding)},set(o){e[i.group].setResource(o,i.binding)}})}return s}destroy(e=!1){this._destroyed||(this._destroyed=!0,this.emit("destroy",this),e&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(r=>{r.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null)}static from(e){const{gpu:r,gl:s,...n}=e;let i,o;return r&&(i=ko.from(r)),s&&(o=Ll.from(s)),new Ul({gpuProgram:i,glProgram:o,...n})}}const iC={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},Jc=0,Zc=1,eu=2,tu=3,ru=4,su=5,wh=class Wx{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Jc)}set blend(e){!!(this.data&1<<Jc)!==e&&(this.data^=1<<Jc)}get offsets(){return!!(this.data&1<<Zc)}set offsets(e){!!(this.data&1<<Zc)!==e&&(this.data^=1<<Zc)}set cullMode(e){if(e==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=e==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<eu)}set culling(e){!!(this.data&1<<eu)!==e&&(this.data^=1<<eu)}get depthTest(){return!!(this.data&1<<tu)}set depthTest(e){!!(this.data&1<<tu)!==e&&(this.data^=1<<tu)}get depthMask(){return!!(this.data&1<<su)}set depthMask(e){!!(this.data&1<<su)!==e&&(this.data^=1<<su)}get clockwiseFrontFace(){return!!(this.data&1<<ru)}set clockwiseFrontFace(e){!!(this.data&1<<ru)!==e&&(this.data^=1<<ru)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!=="none",this._blendMode=e,this._blendModeId=iC[e]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const e=new Wx;return e.depthTest=!1,e.blend=!0,e}};wh.default2d=wh.for2d();let Kd=wh;const Yx=class Vh extends Ul{constructor(e){e={...Vh.defaultOptions,...e},super(e),this.enabled=!0,this._state=Kd.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1),e.blendRequired&&this.addResource("uBackTexture",0,3)}apply(e,r,s,n){e.applyFilter(this,r,s,n)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:r,gl:s,...n}=e;let i,o;return r&&(i=ko.from(r)),s&&(o=Ll.from(s)),new Vh({gpuProgram:i,glProgram:o,...n})}};Yx.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let oC=Yx;function Qm(t,e,r=2){const s=e&&e.length,n=s?e[0]*r:t.length;let i=Kx(t,0,n,r,!0);const o=[];if(!i||i.next===i.prev)return o;let a,l,c;if(s&&(i=hC(t,e,i,r)),t.length>80*r){a=t[0],l=t[1];let u=a,h=l;for(let f=r;f<n;f+=r){const d=t[f],m=t[f+1];d<a&&(a=d),m<l&&(l=m),d>u&&(u=d),m>h&&(h=m)}c=Math.max(u-a,h-l),c=c!==0?32767/c:0}return Ki(i,o,r,a,l,c,0),o}function Kx(t,e,r,s,n){let i;if(n===wC(t,e,r,s)>0)for(let o=e;o<r;o+=s)i=Xm(o/s|0,t[o],t[o+1],i);else for(let o=r-s;o>=e;o-=s)i=Xm(o/s|0,t[o],t[o+1],i);return i&&_n(i,i.next)&&(Xi(i),i=i.next),i}function Bs(t,e){if(!t)return t;e||(e=t);let r=t,s;do if(s=!1,!r.steiner&&(_n(r,r.next)||Pe(r.prev,r,r.next)===0)){if(Xi(r),r=e=r.prev,r===r.next)break;s=!0}else r=r.next;while(s||r!==e);return e}function Ki(t,e,r,s,n,i,o){if(!t)return;!o&&i&&gC(t,s,n,i);let a=t;for(;t.prev!==t.next;){const l=t.prev,c=t.next;if(i?lC(t,s,n,i):aC(t)){e.push(l.i,t.i,c.i),Xi(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=cC(Bs(t),e),Ki(t,e,r,s,n,i,2)):o===2&&uC(t,e,r,s,n,i):Ki(Bs(t),e,r,s,n,i,1);break}}}function aC(t){const e=t.prev,r=t,s=t.next;if(Pe(e,r,s)>=0)return!1;const n=e.x,i=r.x,o=s.x,a=e.y,l=r.y,c=s.y,u=Math.min(n,i,o),h=Math.min(a,l,c),f=Math.max(n,i,o),d=Math.max(a,l,c);let m=s.next;for(;m!==e;){if(m.x>=u&&m.x<=f&&m.y>=h&&m.y<=d&&vi(n,a,i,l,o,c,m.x,m.y)&&Pe(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function lC(t,e,r,s){const n=t.prev,i=t,o=t.next;if(Pe(n,i,o)>=0)return!1;const a=n.x,l=i.x,c=o.x,u=n.y,h=i.y,f=o.y,d=Math.min(a,l,c),m=Math.min(u,h,f),g=Math.max(a,l,c),A=Math.max(u,h,f),y=vh(d,m,e,r,s),b=vh(g,A,e,r,s);let q=t.prevZ,x=t.nextZ;for(;q&&q.z>=y&&x&&x.z<=b;){if(q.x>=d&&q.x<=g&&q.y>=m&&q.y<=A&&q!==n&&q!==o&&vi(a,u,l,h,c,f,q.x,q.y)&&Pe(q.prev,q,q.next)>=0||(q=q.prevZ,x.x>=d&&x.x<=g&&x.y>=m&&x.y<=A&&x!==n&&x!==o&&vi(a,u,l,h,c,f,x.x,x.y)&&Pe(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;q&&q.z>=y;){if(q.x>=d&&q.x<=g&&q.y>=m&&q.y<=A&&q!==n&&q!==o&&vi(a,u,l,h,c,f,q.x,q.y)&&Pe(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;x&&x.z<=b;){if(x.x>=d&&x.x<=g&&x.y>=m&&x.y<=A&&x!==n&&x!==o&&vi(a,u,l,h,c,f,x.x,x.y)&&Pe(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function cC(t,e){let r=t;do{const s=r.prev,n=r.next.next;!_n(s,n)&&Xx(s,r,r.next,n)&&Qi(s,n)&&Qi(n,s)&&(e.push(s.i,r.i,n.i),Xi(r),Xi(r.next),r=t=n),r=r.next}while(r!==t);return Bs(r)}function uC(t,e,r,s,n,i){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&qC(o,a)){let l=Jx(o,a);o=Bs(o,o.next),l=Bs(l,l.next),Ki(o,e,r,s,n,i,0),Ki(l,e,r,s,n,i,0);return}a=a.next}o=o.next}while(o!==t)}function hC(t,e,r,s){const n=[];for(let i=0,o=e.length;i<o;i++){const a=e[i]*s,l=i<o-1?e[i+1]*s:t.length,c=Kx(t,a,l,s,!1);c===c.next&&(c.steiner=!0),n.push(yC(c))}n.sort(dC);for(let i=0;i<n.length;i++)r=fC(n[i],r);return r}function dC(t,e){let r=t.x-e.x;if(r===0&&(r=t.y-e.y,r===0)){const s=(t.next.y-t.y)/(t.next.x-t.x),n=(e.next.y-e.y)/(e.next.x-e.x);r=s-n}return r}function fC(t,e){const r=pC(t,e);if(!r)return e;const s=Jx(r,t);return Bs(s,s.next),Bs(r,r.next)}function pC(t,e){let r=e;const s=t.x,n=t.y;let i=-1/0,o;if(_n(t,r))return r;do{if(_n(t,r.next))return r.next;if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){const h=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=s&&h>i&&(i=h,o=r.x<r.next.x?r:r.next,h===s))return o}r=r.next}while(r!==e);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0;r=o;do{if(s>=r.x&&r.x>=l&&s!==r.x&&Qx(n<c?s:i,n,l,c,n<c?i:s,n,r.x,r.y)){const h=Math.abs(n-r.y)/(s-r.x);Qi(r,t)&&(h<u||h===u&&(r.x>o.x||r.x===o.x&&mC(o,r)))&&(o=r,u=h)}r=r.next}while(r!==a);return o}function mC(t,e){return Pe(t.prev,t,e.prev)<0&&Pe(e.next,t,t.next)<0}function gC(t,e,r,s){let n=t;do n.z===0&&(n.z=vh(n.x,n.y,e,r,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,AC(n)}function AC(t){let e,r=1;do{let s=t,n;t=null;let i=null;for(e=0;s;){e++;let o=s,a=0;for(let c=0;c<r&&(a++,o=o.nextZ,!!o);c++);let l=r;for(;a>0||l>0&&o;)a!==0&&(l===0||!o||s.z<=o.z)?(n=s,s=s.nextZ,a--):(n=o,o=o.nextZ,l--),i?i.nextZ=n:t=n,n.prevZ=i,i=n;s=o}i.nextZ=null,r*=2}while(e>1);return t}function vh(t,e,r,s,n){return t=(t-r)*n|0,e=(e-s)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function yC(t){let e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Qx(t,e,r,s,n,i,o,a){return(n-o)*(e-a)>=(t-o)*(i-a)&&(t-o)*(s-a)>=(r-o)*(e-a)&&(r-o)*(i-a)>=(n-o)*(s-a)}function vi(t,e,r,s,n,i,o,a){return!(t===o&&e===a)&&Qx(t,e,r,s,n,i,o,a)}function qC(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!xC(t,e)&&(Qi(t,e)&&Qi(e,t)&&bC(t,e)&&(Pe(t.prev,t,e.prev)||Pe(t,e.prev,e))||_n(t,e)&&Pe(t.prev,t,t.next)>0&&Pe(e.prev,e,e.next)>0)}function Pe(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function _n(t,e){return t.x===e.x&&t.y===e.y}function Xx(t,e,r,s){const n=ua(Pe(t,e,r)),i=ua(Pe(t,e,s)),o=ua(Pe(r,s,t)),a=ua(Pe(r,s,e));return!!(n!==i&&o!==a||n===0&&ca(t,r,e)||i===0&&ca(t,s,e)||o===0&&ca(r,t,s)||a===0&&ca(r,e,s))}function ca(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function ua(t){return t>0?1:t<0?-1:0}function xC(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Xx(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Qi(t,e){return Pe(t.prev,t,t.next)<0?Pe(t,e,t.next)>=0&&Pe(t,t.prev,e)>=0:Pe(t,e,t.prev)<0||Pe(t,t.next,e)<0}function bC(t,e){let r=t,s=!1;const n=(t.x+e.x)/2,i=(t.y+e.y)/2;do r.y>i!=r.next.y>i&&r.next.y!==r.y&&n<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(s=!s),r=r.next;while(r!==t);return s}function Jx(t,e){const r=_h(t.i,t.x,t.y),s=_h(e.i,e.x,e.y),n=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,s.next=r,r.prev=s,i.next=s,s.prev=i,s}function Xm(t,e,r,s){const n=_h(t,e,r);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function Xi(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function _h(t,e,r){return{i:t,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function wC(t,e,r,s){let n=0;for(let i=e,o=r-s;i<r;i+=s)n+=(t[o]-t[i])*(t[i+1]+t[o+1]),o=i;return n}const VC=Qm.default||Qm;var nu,Jm;function vC(){if(Jm)return nu;Jm=1,nu=r;var t={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},e=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function r(i){var o=[];return i.replace(e,function(a,l,c){var u=l.toLowerCase();for(c=n(c),u=="m"&&c.length>2&&(o.push([l].concat(c.splice(0,2))),u="l",l=l=="m"?"l":"L");;){if(c.length==t[u])return c.unshift(l),o.push(c);if(c.length<t[u])throw new Error("malformed path data");o.push([l].concat(c.splice(0,t[u])))}}),o}var s=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function n(i){var o=i.match(s);return o?o.map(Number):[]}return nu}var _C=vC();const SC=Xe(_C);function kC(t,e){const r=SC(t),s=[];let n=null,i=0,o=0;for(let a=0;a<r.length;a++){const l=r[a],c=l[0],u=l;switch(c){case"M":i=u[1],o=u[2],e.moveTo(i,o);break;case"m":i+=u[1],o+=u[2],e.moveTo(i,o);break;case"H":i=u[1],e.lineTo(i,o);break;case"h":i+=u[1],e.lineTo(i,o);break;case"V":o=u[1],e.lineTo(i,o);break;case"v":o+=u[1],e.lineTo(i,o);break;case"L":i=u[1],o=u[2],e.lineTo(i,o);break;case"l":i+=u[1],o+=u[2],e.lineTo(i,o);break;case"C":i=u[5],o=u[6],e.bezierCurveTo(u[1],u[2],u[3],u[4],i,o);break;case"c":e.bezierCurveTo(i+u[1],o+u[2],i+u[3],o+u[4],i+u[5],o+u[6]),i+=u[5],o+=u[6];break;case"S":i=u[3],o=u[4],e.bezierCurveToShort(u[1],u[2],i,o);break;case"s":e.bezierCurveToShort(i+u[1],o+u[2],i+u[3],o+u[4]),i+=u[3],o+=u[4];break;case"Q":i=u[3],o=u[4],e.quadraticCurveTo(u[1],u[2],i,o);break;case"q":e.quadraticCurveTo(i+u[1],o+u[2],i+u[3],o+u[4]),i+=u[3],o+=u[4];break;case"T":i=u[1],o=u[2],e.quadraticCurveToShort(i,o);break;case"t":i+=u[1],o+=u[2],e.quadraticCurveToShort(i,o);break;case"A":i=u[6],o=u[7],e.arcToSvg(u[1],u[2],u[3],u[4],u[5],i,o);break;case"a":i+=u[6],o+=u[7],e.arcToSvg(u[1],u[2],u[3],u[4],u[5],i,o);break;case"Z":case"z":e.closePath(),s.length>0&&(n=s.pop(),n?(i=n.startX,o=n.startY):(i=0,o=0)),n=null;break;default:Nt(`Unknown SVG path command: ${c}`)}c!=="Z"&&c!=="z"&&n===null&&(n={startX:i,startY:o},s.push(n))}return e}class Qd{constructor(e=0,r=0,s=0){this.type="circle",this.x=e,this.y=r,this.radius=s}clone(){return new Qd(this.x,this.y,this.radius)}contains(e,r){if(this.radius<=0)return!1;const s=this.radius*this.radius;let n=this.x-e,i=this.y-r;return n*=n,i*=i,n+i<=s}strokeContains(e,r,s,n=.5){if(this.radius===0)return!1;const i=this.x-e,o=this.y-r,a=this.radius,l=(1-n)*s,c=Math.sqrt(i*i+o*o);return c<=a+l&&c>a-(s-l)}getBounds(e){return e||(e=new Ye),e.x=this.x-this.radius,e.y=this.y-this.radius,e.width=this.radius*2,e.height=this.radius*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.radius=e.radius,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Xd{constructor(e=0,r=0,s=0,n=0){this.type="ellipse",this.x=e,this.y=r,this.halfWidth=s,this.halfHeight=n}clone(){return new Xd(this.x,this.y,this.halfWidth,this.halfHeight)}contains(e,r){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let s=(e-this.x)/this.halfWidth,n=(r-this.y)/this.halfHeight;return s*=s,n*=n,s+n<=1}strokeContains(e,r,s,n=.5){const{halfWidth:i,halfHeight:o}=this;if(i<=0||o<=0)return!1;const a=s*(1-n),l=s-a,c=i-l,u=o-l,h=i+a,f=o+a,d=e-this.x,m=r-this.y,g=d*d/(c*c)+m*m/(u*u),A=d*d/(h*h)+m*m/(f*f);return g>1&&A<=1}getBounds(e){return e||(e=new Ye),e.x=this.x-this.halfWidth,e.y=this.y-this.halfHeight,e.width=this.halfWidth*2,e.height=this.halfHeight*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.halfWidth=e.halfWidth,this.halfHeight=e.halfHeight,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function CC(t,e,r,s,n,i){const o=t-r,a=e-s,l=n-r,c=i-s,u=o*l+a*c,h=l*l+c*c;let f=-1;h!==0&&(f=u/h);let d,m;f<0?(d=r,m=s):f>1?(d=n,m=i):(d=r+f*l,m=s+f*c);const g=t-d,A=e-m;return g*g+A*A}let EC,TC;class ji{constructor(...e){this.type="polygon";let r=Array.isArray(e[0])?e[0]:e;if(typeof r[0]!="number"){const s=[];for(let n=0,i=r.length;n<i;n++)s.push(r[n].x,r[n].y);r=s}this.points=r,this.closePath=!0}isClockwise(){let e=0;const r=this.points,s=r.length;for(let n=0;n<s;n+=2){const i=r[n],o=r[n+1],a=r[(n+2)%s],l=r[(n+3)%s];e+=(a-i)*(l+o)}return e<0}containsPolygon(e){const r=this.getBounds(EC),s=e.getBounds(TC);if(!r.containsRect(s))return!1;const n=e.points;for(let i=0;i<n.length;i+=2){const o=n[i],a=n[i+1];if(!this.contains(o,a))return!1}return!0}clone(){const e=this.points.slice(),r=new ji(e);return r.closePath=this.closePath,r}contains(e,r){let s=!1;const n=this.points.length/2;for(let i=0,o=n-1;i<n;o=i++){const a=this.points[i*2],l=this.points[i*2+1],c=this.points[o*2],u=this.points[o*2+1];l>r!=u>r&&e<(c-a)*((r-l)/(u-l))+a&&(s=!s)}return s}strokeContains(e,r,s,n=.5){const i=s*s,o=i*(1-n),a=i-o,{points:l}=this,c=l.length-(this.closePath?0:2);for(let u=0;u<c;u+=2){const h=l[u],f=l[u+1],d=l[(u+2)%l.length],m=l[(u+3)%l.length],g=CC(e,r,h,f,d,m),A=Math.sign((d-h)*(r-f)-(m-f)*(e-h));if(g<=(A<0?a:o))return!0}return!1}getBounds(e){e||(e=new Ye);const r=this.points;let s=1/0,n=-1/0,i=1/0,o=-1/0;for(let a=0,l=r.length;a<l;a+=2){const c=r[a],u=r[a+1];s=c<s?c:s,n=c>n?c:n,i=u<i?u:i,o=u>o?u:o}return e.x=s,e.width=n-s,e.y=i,e.height=o-i,e}copyFrom(e){return this.points=e.points.slice(),this.closePath=e.closePath,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((e,r)=>`${e}, ${r}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return _e("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return _e("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const ha=(t,e,r,s,n,i,o)=>{const a=t-r,l=e-s,c=Math.sqrt(a*a+l*l);return c>=n-i&&c<=n+o};class Jd{constructor(e=0,r=0,s=0,n=0,i=20){this.type="roundedRectangle",this.x=e,this.y=r,this.width=s,this.height=n,this.radius=i}getBounds(e){return e||(e=new Ye),e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}clone(){return new Jd(this.x,this.y,this.width,this.height,this.radius)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,r){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&r>=this.y&&r<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(r>=this.y+s&&r<=this.y+this.height-s||e>=this.x+s&&e<=this.x+this.width-s)return!0;let n=e-(this.x+s),i=r-(this.y+s);const o=s*s;if(n*n+i*i<=o||(n=e-(this.x+this.width-s),n*n+i*i<=o)||(i=r-(this.y+this.height-s),n*n+i*i<=o)||(n=e-(this.x+s),n*n+i*i<=o))return!0}return!1}strokeContains(e,r,s,n=.5){const{x:i,y:o,width:a,height:l,radius:c}=this,u=s*(1-n),h=s-u,f=i+c,d=o+c,m=a-c*2,g=l-c*2,A=i+a,y=o+l;return(e>=i-u&&e<=i+h||e>=A-h&&e<=A+u)&&r>=d&&r<=d+g||(r>=o-u&&r<=o+h||r>=y-h&&r<=y+u)&&e>=f&&e<=f+m?!0:e<f&&r<d&&ha(e,r,f,d,c,h,u)||e>A-c&&r<d&&ha(e,r,A-c,d,c,h,u)||e>A-c&&r>y-c&&ha(e,r,A-c,y-c,c,h,u)||e<f&&r>y-c&&ha(e,r,f,y-c,c,h,u)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const Zx={};function PC(t,e,r){let s=2166136261;for(let n=0;n<e;n++)s^=t[n].uid,s=Math.imul(s,16777619),s>>>=0;return Zx[s]||RC(t,e,s,r)}function RC(t,e,r,s){const n={};let i=0;for(let a=0;a<s;a++){const l=a<e?t[a]:Ae.EMPTY.source;n[i++]=l.source,n[i++]=l.style}const o=new Fa(n);return Zx[r]=o,o}class Zm{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this.uint32View=null,this.float32View=null,this.uint16View=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._int32View=null,this._float64Array=null,this._bigUint64Array=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}function eg(t,e,r,s){if(r??(r=0),s??(s=Math.min(t.byteLength-r,e.byteLength)),!(r&7)&&!(s&7)){const n=s/8;new Float64Array(e,0,n).set(new Float64Array(t,r,n))}else if(!(r&3)&&!(s&3)){const n=s/4;new Float32Array(e,0,n).set(new Float32Array(t,r,n))}else new Uint8Array(e).set(new Uint8Array(t,r,s))}const MC={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var IC=(t=>(t[t.DISABLED=0]="DISABLED",t[t.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",t[t.MASK_ACTIVE=2]="MASK_ACTIVE",t[t.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",t[t.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",t[t.NONE=5]="NONE",t))(IC||{});function tg(t,e){return e.alphaMode==="no-premultiply-alpha"&&MC[t]||t}const jC=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function OC(t){let e="";for(let r=0;r<t;++r)r>0&&(e+=`
else `),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}function NC(t,e){if(t===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);try{for(;;){const s=jC.replace(/%forloop%/gi,OC(t));if(e.shaderSource(r,s),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))t=t/2|0;else break}}finally{e.deleteShader(r)}return t}let $s=null;function BC(){if($s)return $s;const t=Fx();return $s=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),$s=NC($s,t),t.getExtension("WEBGL_lose_context")?.loseContext(),$s}class DC{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let e=0;e<this.count;e++){const r=this.textures[e];this.textures[e]=null,this.ids[r.uid]=null}this.count=0}}class zC{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new DC,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null,this.elements=null}}const Oi=[];let al=0;Gd.register({clear:()=>{if(Oi.length>0)for(const t of Oi)t&&t.destroy();Oi.length=0,al=0}});function rg(){return al>0?Oi[--al]:new zC}function sg(t){t.elements=null,Oi[al++]=t}let li=0;const eb=class tb{constructor(e){this.uid=Ue("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],e={...tb.defaultOptions,...e},e.maxTextures||(_e("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),e.maxTextures=BC());const{maxTextures:r,attributesInitialSize:s,indicesInitialSize:n}=e;this.attributeBuffer=new Zm(s*4),this.indexBuffer=new Uint16Array(n),this.maxTextures=r}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let e=0;e<this.batchIndex;e++)sg(this.batches[e]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(e){this._elements[this.elementSize++]=e,e._indexStart=this.indexSize,e._attributeStart=this.attributeSize,e._batcher=this,this.indexSize+=e.indexSize,this.attributeSize+=e.attributeSize*this.vertexSize}checkAndUpdateTexture(e,r){const s=e._batch.textures.ids[r._source.uid];return!s&&s!==0?!1:(e._textureId=s,e.texture=r,!0)}updateElement(e){this.dirty=!0;const r=this.attributeBuffer;e.packAsQuad?this.packQuadAttributes(e,r.float32View,r.uint32View,e._attributeStart,e._textureId):this.packAttributes(e,r.float32View,r.uint32View,e._attributeStart,e._textureId)}break(e){const r=this._elements;if(!r[this.elementStart])return;let s=rg(),n=s.textures;n.clear();const i=r[this.elementStart];let o=tg(i.blendMode,i.texture._source),a=i.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const l=this.attributeBuffer.float32View,c=this.attributeBuffer.uint32View,u=this.indexBuffer;let h=this._batchIndexSize,f=this._batchIndexStart,d="startBatch",m=[];const g=this.maxTextures;for(let A=this.elementStart;A<this.elementSize;++A){const y=r[A];r[A]=null;const q=y.texture._source,x=tg(y.blendMode,q),V=o!==x||a!==y.topology;if(q._batchTick===li&&!V){y._textureId=q._textureBindLocation,h+=y.indexSize,y.packAsQuad?(this.packQuadAttributes(y,l,c,y._attributeStart,y._textureId),this.packQuadIndex(u,y._indexStart,y._attributeStart/this.vertexSize)):(this.packAttributes(y,l,c,y._attributeStart,y._textureId),this.packIndex(y,u,y._indexStart,y._attributeStart/this.vertexSize)),y._batch=s,m.push(y);continue}q._batchTick=li,(n.count>=g||V)&&(this._finishBatch(s,f,h-f,n,o,a,e,d,m),d="renderBatch",f=h,o=x,a=y.topology,s=rg(),n=s.textures,n.clear(),m=[],++li),y._textureId=q._textureBindLocation=n.count,n.ids[q.uid]=n.count,n.textures[n.count++]=q,y._batch=s,m.push(y),h+=y.indexSize,y.packAsQuad?(this.packQuadAttributes(y,l,c,y._attributeStart,y._textureId),this.packQuadIndex(u,y._indexStart,y._attributeStart/this.vertexSize)):(this.packAttributes(y,l,c,y._attributeStart,y._textureId),this.packIndex(y,u,y._indexStart,y._attributeStart/this.vertexSize))}n.count>0&&(this._finishBatch(s,f,h-f,n,o,a,e,d,m),f=h,++li),this.elementStart=this.elementSize,this._batchIndexStart=f,this._batchIndexSize=h}_finishBatch(e,r,s,n,i,o,a,l,c){e.gpuBindGroup=null,e.bindGroup=null,e.action=l,e.batcher=this,e.textures=n,e.blendMode=i,e.topology=o,e.start=r,e.size=s,e.elements=c,++li,this.batches[this.batchIndex++]=e,a.add(e)}finish(e){this.break(e)}ensureAttributeBuffer(e){e*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(e*4)}ensureIndexBuffer(e){e<=this.indexBuffer.length||this._resizeIndexBuffer(e)}_resizeAttributeBuffer(e){const r=Math.max(e,this.attributeBuffer.size*2),s=new Zm(r);eg(this.attributeBuffer.rawBinaryData,s.rawBinaryData),this.attributeBuffer=s}_resizeIndexBuffer(e){const r=this.indexBuffer;let s=Math.max(e,r.length*1.5);s+=s%2;const n=s>65535?new Uint32Array(s):new Uint16Array(s);if(n.BYTES_PER_ELEMENT!==r.BYTES_PER_ELEMENT)for(let i=0;i<r.length;i++)n[i]=r[i];else eg(r.buffer,n.buffer);this.indexBuffer=n}packQuadIndex(e,r,s){e[r]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+3]=s+0,e[r+4]=s+2,e[r+5]=s+3}packIndex(e,r,s,n){const i=e.indices,o=e.indexSize,a=e.indexOffset,l=e.attributeOffset;for(let c=0;c<o;c++)r[s++]=n+i[c+a]-l}destroy(e={}){if(this.batches!==null){for(let r=0;r<this.batchIndex;r++)sg(this.batches[r]);this.batches=null,this.geometry.destroy(!0),this.geometry=null,e.shader&&(this.shader?.destroy(),this.shader=null);for(let r=0;r<this._elements.length;r++)this._elements[r]&&(this._elements[r]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};eb.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let FC=eb;var St=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(St||{});let Ji=class extends os{constructor(e){let{data:r,size:s}=e;const{usage:n,label:i,shrinkToFit:o}=e;super(),this._gpuData=Object.create(null),this._gcLastUsed=-1,this.autoGarbageCollect=!0,this.uid=Ue("buffer"),this._resourceType="buffer",this._resourceId=Ue("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,r instanceof Array&&(r=new Float32Array(r)),this._data=r,s??(s=r?.byteLength);const a=!!r;this.descriptor={size:s,usage:n,mappedAtCreation:a,label:i},this.shrinkToFit=o??!0}get data(){return this._data}set data(e){this.setDataWithSize(e,e.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&St.STATIC)}set static(e){e?this.descriptor.usage|=St.STATIC:this.descriptor.usage&=~St.STATIC}setDataWithSize(e,r,s){if(this._updateID++,this._updateSize=r*e.BYTES_PER_ELEMENT,this._data===e){s&&this.emit("update",this);return}const n=this._data;if(this._data=e,this._dataInt32=null,!n||n.length!==e.length){!this.shrinkToFit&&n&&e.byteLength<n.byteLength?s&&this.emit("update",this):(this.descriptor.size=e.byteLength,this._resourceId=Ue("resource"),this.emit("change",this));return}s&&this.emit("update",this)}update(e){this._updateSize=e??this._updateSize,this._updateID++,this.emit("update",this)}unload(){this.emit("unload",this);for(const e in this._gpuData)this._gpuData[e]?.destroy();this._gpuData=Object.create(null)}destroy(){this.destroyed=!0,this.unload(),this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}};function rb(t,e){if(!(t instanceof Ji)){let r=e?St.INDEX:St.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),r=St.INDEX|St.COPY_DST):(t=new Float32Array(t),r=St.VERTEX|St.COPY_DST)),t=new Ji({data:t,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:r})}return t}function LC(t,e,r){const s=t.getAttribute(e);if(!s)return r.minX=0,r.minY=0,r.maxX=0,r.maxY=0,r;const n=s.buffer.data;let i=1/0,o=1/0,a=-1/0,l=-1/0;const c=n.BYTES_PER_ELEMENT,u=(s.offset||0)/c,h=(s.stride||8)/c;for(let f=u;f<n.length;f+=h){const d=n[f],m=n[f+1];d>a&&(a=d),m>l&&(l=m),d<i&&(i=d),m<o&&(o=m)}return r.minX=i,r.minY=o,r.maxX=a,r.maxY=l,r}function UC(t){return(t instanceof Ji||Array.isArray(t)||t.BYTES_PER_ELEMENT)&&(t={buffer:t}),t.buffer=rb(t.buffer,!1),t}class $C extends os{constructor(e={}){super(),this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this.uid=Ue("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new nr,this._boundsDirty=!0;const{attributes:r,indexBuffer:s,topology:n}=e;if(this.buffers=[],this.attributes={},r)for(const i in r)this.addAttribute(i,r[i]);this.instanceCount=e.instanceCount??1,s&&this.addIndex(s),this.topology=n||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(e){return this.attributes[e]}getIndex(){return this.indexBuffer}getBuffer(e){return this.getAttribute(e).buffer}getSize(){for(const e in this.attributes){const r=this.attributes[e];return r.buffer.data.length/(r.stride/4||r.size)}return 0}addAttribute(e,r){const s=UC(r);this.buffers.indexOf(s.buffer)===-1&&(this.buffers.push(s.buffer),s.buffer.on("update",this.onBufferUpdate,this),s.buffer.on("change",this.onBufferUpdate,this)),this.attributes[e]=s}addIndex(e){this.indexBuffer=rb(e,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,LC(this,"aPosition",this._bounds)):this._bounds}unload(){this.emit("unload",this);for(const e in this._gpuData)this._gpuData[e]?.destroy();this._gpuData=Object.create(null)}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners(),e&&this.buffers.forEach(r=>r.destroy()),this.unload(),this.indexBuffer?.destroy(),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const GC=new Float32Array(1),HC=new Uint32Array(1);class WC extends $C{constructor(){const r=new Ji({data:GC,label:"attribute-batch-buffer",usage:St.VERTEX|St.COPY_DST,shrinkToFit:!1}),s=new Ji({data:HC,label:"index-batch-buffer",usage:St.INDEX|St.COPY_DST,shrinkToFit:!1}),n=24;super({attributes:{aPosition:{buffer:r,format:"float32x2",stride:n,offset:0},aUV:{buffer:r,format:"float32x2",stride:n,offset:8},aColor:{buffer:r,format:"unorm8x4",stride:n,offset:16},aTextureIdAndRound:{buffer:r,format:"uint16x2",stride:n,offset:20}},indexBuffer:s})}}function ng(t,e,r){if(t)for(const s in t){const n=s.toLocaleLowerCase(),i=e[n];if(i){let o=t[s];s==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),r&&i.push(`//----${r}----//`),i.push(o)}else Nt(`${s} placement hook does not exist in shader`)}}const YC=/\{\{(.*?)\}\}/g;function ig(t){const e={};return(t.match(YC)?.map(s=>s.replace(/[{()}]/g,""))??[]).forEach(s=>{e[s]=[]}),e}function og(t,e){let r;const s=/@in\s+([^;]+);/g;for(;(r=s.exec(t))!==null;)e.push(r[1])}function ag(t,e,r=!1){const s=[];og(e,s),t.forEach(a=>{a.header&&og(a.header,s)});const n=s;r&&n.sort();const i=n.map((a,l)=>`       @location(${l}) ${a},`).join(`
`);let o=e.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${i}
`),o}function lg(t,e){let r;const s=/@out\s+([^;]+);/g;for(;(r=s.exec(t))!==null;)e.push(r[1])}function KC(t){const r=/\b(\w+)\s*:/g.exec(t);return r?r[1]:""}function QC(t){const e=/@.*?\s+/g;return t.replace(e,"")}function XC(t,e){const r=[];lg(e,r),t.forEach(l=>{l.header&&lg(l.header,r)});let s=0;const n=r.sort().map(l=>l.indexOf("builtin")>-1?l:`@location(${s++}) ${l}`).join(`,
`),i=r.sort().map(l=>`       var ${QC(l)};`).join(`
`),o=`return VSOutput(
            ${r.sort().map(l=>` ${KC(l)}`).join(`,
`)});`;let a=e.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`
${n}
`),a=a.replace("{{start}}",`
${i}
`),a=a.replace("{{return}}",`
${o}
`),a}function cg(t,e){let r=t;for(const s in e){const n=e[s];n.join(`
`).length?r=r.replace(`{{${s}}}`,`//-----${s} START-----//
${n.join(`
`)}
//----${s} FINISH----//`):r=r.replace(`{{${s}}}`,"")}return r}const Hr=Object.create(null),iu=new Map;let JC=0;function ZC({template:t,bits:e}){const r=sb(t,e);if(Hr[r])return Hr[r];const{vertex:s,fragment:n}=tE(t,e);return Hr[r]=nb(s,n,e),Hr[r]}function eE({template:t,bits:e}){const r=sb(t,e);return Hr[r]||(Hr[r]=nb(t.vertex,t.fragment,e)),Hr[r]}function tE(t,e){const r=e.map(o=>o.vertex).filter(o=>!!o),s=e.map(o=>o.fragment).filter(o=>!!o);let n=ag(r,t.vertex,!0);n=XC(r,n);const i=ag(s,t.fragment,!0);return{vertex:n,fragment:i}}function sb(t,e){return e.map(r=>(iu.has(r)||iu.set(r,JC++),iu.get(r))).sort((r,s)=>r-s).join("-")+t.vertex+t.fragment}function nb(t,e,r){const s=ig(t),n=ig(e);return r.forEach(i=>{ng(i.vertex,s,i.name),ng(i.fragment,n,i.name)}),{vertex:cg(t,s),fragment:cg(e,n)}}const rE=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,sE=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,nE=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,iE=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,oE={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},aE={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function lE({bits:t,name:e}){const r=ZC({template:{fragment:sE,vertex:rE},bits:[oE,...t]});return ko.from({name:e,vertex:{source:r.vertex,entryPoint:"main"},fragment:{source:r.fragment,entryPoint:"main"}})}function cE({bits:t,name:e}){return new Ll({name:e,...eE({template:{vertex:nE,fragment:iE},bits:[aE,...t]})})}const uE={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},hE={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},ou={};function dE(t){const e=[];if(t===1)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let r=0;for(let s=0;s<t;s++)e.push(`@group(1) @binding(${r++}) var textureSource${s+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${r++}) var textureSampler${s+1}: sampler;`)}return e.join(`
`)}function fE(t){const e=[];if(t===1)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let r=0;r<t;r++)r===t-1?e.push("  default:{"):e.push(`  case ${r}:{`),e.push(`      outColor = textureSampleGrad(textureSource${r+1}, textureSampler${r+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join(`
`)}function pE(t){return ou[t]||(ou[t]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${dE(t)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${fE(t)}
            `}}),ou[t]}const au={};function mE(t){const e=[];for(let r=0;r<t;r++)r>0&&e.push("else"),r<t-1&&e.push(`if(vTextureId < ${r}.5)`),e.push("{"),e.push(`	outColor = texture(uTextures[${r}], vUV);`),e.push("}");return e.join(`
`)}function gE(t){return au[t]||(au[t]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${t}];

            `,main:`

                ${mE(t)}
            `}}),au[t]}const AE={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},yE={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},ug={};function qE(t){let e=ug[t];if(e)return e;const r=new Int32Array(t);for(let s=0;s<t;s++)r[s]=s;return e=ug[t]=new Hx({uTextures:{value:r,type:"i32",size:t}},{isStatic:!0}),e}class hg extends Ul{constructor(e){const r=cE({name:"batch",bits:[hE,gE(e),yE]}),s=lE({name:"batch",bits:[uE,pE(e),AE]});super({glProgram:r,gpuProgram:s,resources:{batchSamplers:qE(e)}}),this.maxTextures=e}}let ci=null;const ib=class ob extends FC{constructor(e){super(e),this.geometry=new WC,this.name=ob.extension.name,this.vertexSize=6,ci??(ci=new hg(e.maxTextures)),this.shader=ci}packAttributes(e,r,s,n,i){const o=i<<16|e.roundPixels&65535,a=e.transform,l=a.a,c=a.b,u=a.c,h=a.d,f=a.tx,d=a.ty,{positions:m,uvs:g}=e,A=e.color,y=e.attributeOffset,b=y+e.attributeSize;for(let q=y;q<b;q++){const x=q*2,V=m[x],_=m[x+1];r[n++]=l*V+u*_+f,r[n++]=h*_+c*V+d,r[n++]=g[x],r[n++]=g[x+1],s[n++]=A,s[n++]=o}}packQuadAttributes(e,r,s,n,i){const o=e.texture,a=e.transform,l=a.a,c=a.b,u=a.c,h=a.d,f=a.tx,d=a.ty,m=e.bounds,g=m.maxX,A=m.minX,y=m.maxY,b=m.minY,q=o.uvs,x=e.color,V=i<<16|e.roundPixels&65535;r[n+0]=l*A+u*b+f,r[n+1]=h*b+c*A+d,r[n+2]=q.x0,r[n+3]=q.y0,s[n+4]=x,s[n+5]=V,r[n+6]=l*g+u*b+f,r[n+7]=h*b+c*g+d,r[n+8]=q.x1,r[n+9]=q.y1,s[n+10]=x,s[n+11]=V,r[n+12]=l*g+u*y+f,r[n+13]=h*y+c*g+d,r[n+14]=q.x2,r[n+15]=q.y2,s[n+16]=x,s[n+17]=V,r[n+18]=l*A+u*y+f,r[n+19]=h*y+c*A+d,r[n+20]=q.x3,r[n+21]=q.y3,s[n+22]=x,s[n+23]=V}_updateMaxTextures(e){this.shader.maxTextures!==e&&(ci=new hg(e),this.shader=ci)}destroy(){this.shader=null,super.destroy()}};ib.extension={type:[we.Batcher],name:"default"};let xE=ib;class $l{constructor(e){this.items=Object.create(null);const{renderer:r,type:s,onUnload:n,priority:i,name:o}=e;this._renderer=r,r.gc.addResourceHash(this,"items",s,i??0),this._onUnload=n,this.name=o}add(e){return this.items[e.uid]?!1:(this.items[e.uid]=e,e.once("unload",this.remove,this),e._gcLastUsed=this._renderer.gc.now,!0)}remove(e,...r){if(!this.items[e.uid])return;const s=e._gpuData[this._renderer.uid];s&&(this._onUnload?.(e,...r),s.destroy(),e._gpuData[this._renderer.uid]=null,this.items[e.uid]=null)}removeAll(...e){Object.values(this.items).forEach(r=>r&&this.remove(r,...e))}destroy(...e){this.removeAll(...e),this.items=Object.create(null),this._renderer=null,this._onUnload=null}}function bE(t,e,r,s,n,i,o,a=null){let l=0;r*=e,n*=i;const c=a.a,u=a.b,h=a.c,f=a.d,d=a.tx,m=a.ty;for(;l<o;){const g=t[r],A=t[r+1];s[n]=c*g+h*A+d,s[n+1]=u*g+f*A+m,n+=i,r+=e,l++}}function wE(t,e,r,s){let n=0;for(e*=r;n<s;)t[e]=0,t[e+1]=0,e+=r,n++}function ab(t,e,r,s,n){const i=e.a,o=e.b,a=e.c,l=e.d,c=e.tx,u=e.ty;r||(r=0),s||(s=2),n||(n=t.length/s-r);let h=r*s;for(let f=0;f<n;f++){const d=t[h],m=t[h+1];t[h]=i*d+a*m+c,t[h+1]=o*d+l*m+u,h+=s}}const VE=new pe;class Zd{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const e=this.baseColor,r=e>>16|e&65280|(e&255)<<16,s=this.renderable;return s?xx(r,s.groupColor)+(this.alpha*s.groupAlpha*255<<24):r+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||VE}copyTo(e){e.indexOffset=this.indexOffset,e.indexSize=this.indexSize,e.attributeOffset=this.attributeOffset,e.attributeSize=this.attributeSize,e.baseColor=this.baseColor,e.alpha=this.alpha,e.texture=this.texture,e.geometryData=this.geometryData,e.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const Zi={extension:{type:we.ShapeBuilder,name:"circle"},build(t,e){let r,s,n,i,o,a;if(t.type==="circle"){const x=t;if(o=a=x.radius,o<=0)return!1;r=x.x,s=x.y,n=i=0}else if(t.type==="ellipse"){const x=t;if(o=x.halfWidth,a=x.halfHeight,o<=0||a<=0)return!1;r=x.x,s=x.y,n=i=0}else{const x=t,V=x.width/2,_=x.height/2;r=x.x+V,s=x.y+_,o=a=Math.max(0,Math.min(x.radius,Math.min(V,_))),n=V-o,i=_-a}if(n<0||i<0)return!1;const l=Math.ceil(2.3*Math.sqrt(o+a)),c=l*8+(n?4:0)+(i?4:0);if(c===0)return!1;if(l===0)return e[0]=e[6]=r+n,e[1]=e[3]=s+i,e[2]=e[4]=r-n,e[5]=e[7]=s-i,!0;let u=0,h=l*4+(n?2:0)+2,f=h,d=c,m=n+o,g=i,A=r+m,y=r-m,b=s+g;if(e[u++]=A,e[u++]=b,e[--h]=b,e[--h]=y,i){const x=s-g;e[f++]=y,e[f++]=x,e[--d]=x,e[--d]=A}for(let x=1;x<l;x++){const V=Math.PI/2*(x/l),_=n+Math.cos(V)*o,w=i+Math.sin(V)*a,S=r+_,k=r-_,C=s+w,E=s-w;e[u++]=S,e[u++]=C,e[--h]=C,e[--h]=k,e[f++]=k,e[f++]=E,e[--d]=E,e[--d]=S}m=n,g=i+a,A=r+m,y=r-m,b=s+g;const q=s-g;return e[u++]=A,e[u++]=b,e[--d]=q,e[--d]=A,n&&(e[u++]=y,e[u++]=b,e[--d]=q,e[--d]=y),!0},triangulate(t,e,r,s,n,i){if(t.length===0)return;let o=0,a=0;for(let u=0;u<t.length;u+=2)o+=t[u],a+=t[u+1];o/=t.length/2,a/=t.length/2;let l=s;e[l*r]=o,e[l*r+1]=a;const c=l++;for(let u=0;u<t.length;u+=2)e[l*r]=t[u],e[l*r+1]=t[u+1],u>0&&(n[i++]=l,n[i++]=c,n[i++]=l-1),l++;n[i++]=c+1,n[i++]=c,n[i++]=l-1}},vE={...Zi,extension:{...Zi.extension,name:"ellipse"}},_E={...Zi,extension:{...Zi.extension,name:"roundedRectangle"}},lb=1e-4,dg=1e-4;function SE(t){const e=t.length;if(e<6)return 1;let r=0;for(let s=0,n=t[e-2],i=t[e-1];s<e;s+=2){const o=t[s],a=t[s+1];r+=(o-n)*(a+i),n=o,i=a}return r<0?-1:1}function fg(t,e,r,s,n,i,o,a){const l=t-r*n,c=e-s*n,u=t+r*i,h=e+s*i;let f,d;o?(f=s,d=-r):(f=-s,d=r);const m=l+f,g=c+d,A=u+f,y=h+d;return a.push(m,g),a.push(A,y),2}function ls(t,e,r,s,n,i,o,a){const l=r-t,c=s-e;let u=Math.atan2(l,c),h=Math.atan2(n-t,i-e);a&&u<h?u+=Math.PI*2:!a&&u>h&&(h+=Math.PI*2);let f=u;const d=h-u,m=Math.abs(d),g=Math.sqrt(l*l+c*c),A=(15*m*Math.sqrt(g)/Math.PI>>0)+1,y=d/A;if(f+=y,a){o.push(t,e),o.push(r,s);for(let b=1,q=f;b<A;b++,q+=y)o.push(t,e),o.push(t+Math.sin(q)*g,e+Math.cos(q)*g);o.push(t,e),o.push(n,i)}else{o.push(r,s),o.push(t,e);for(let b=1,q=f;b<A;b++,q+=y)o.push(t+Math.sin(q)*g,e+Math.cos(q)*g),o.push(t,e);o.push(n,i),o.push(t,e)}return A*2}function kE(t,e,r,s,n,i){const o=lb;if(t.length===0)return;const a=e;let l=a.alignment;if(e.alignment!==.5){let F=SE(t);l=(l-.5)*F+.5}const c=new dt(t[0],t[1]),u=new dt(t[t.length-2],t[t.length-1]),h=s,f=Math.abs(c.x-u.x)<o&&Math.abs(c.y-u.y)<o;if(h){t=t.slice(),f&&(t.pop(),t.pop(),u.set(t[t.length-2],t[t.length-1]));const F=(c.x+u.x)*.5,Q=(u.y+c.y)*.5;t.unshift(F,Q),t.push(F,Q)}const d=n,m=t.length/2;let g=t.length;const A=d.length/2,y=a.width/2,b=y*y,q=a.miterLimit*a.miterLimit;let x=t[0],V=t[1],_=t[2],w=t[3],S=0,k=0,C=-(V-w),E=x-_,T=0,R=0,M=Math.sqrt(C*C+E*E);C/=M,E/=M,C*=y,E*=y;const D=l,P=(1-D)*2,I=D*2;h||(a.cap==="round"?g+=ls(x-C*(P-I)*.5,V-E*(P-I)*.5,x-C*P,V-E*P,x+C*I,V+E*I,d,!0)+2:a.cap==="square"&&(g+=fg(x,V,C,E,P,I,!0,d))),d.push(x-C*P,V-E*P),d.push(x+C*I,V+E*I);for(let F=1;F<m-1;++F){x=t[(F-1)*2],V=t[(F-1)*2+1],_=t[F*2],w=t[F*2+1],S=t[(F+1)*2],k=t[(F+1)*2+1],C=-(V-w),E=x-_,M=Math.sqrt(C*C+E*E),C/=M,E/=M,C*=y,E*=y,T=-(w-k),R=_-S,M=Math.sqrt(T*T+R*R),T/=M,R/=M,T*=y,R*=y;const Q=_-x,he=V-w,ie=_-S,se=k-w,J=Q*ie+he*se,Z=he*ie-se*Q,de=Z<0;if(Math.abs(Z)<.001*Math.abs(J)){d.push(_-C*P,w-E*P),d.push(_+C*I,w+E*I),J>=0&&(a.join==="round"?g+=ls(_,w,_-C*P,w-E*P,_-T*P,w-R*P,d,!1)+4:g+=2,d.push(_-T*I,w-R*I),d.push(_+T*P,w+R*P));continue}const Fe=(-C+x)*(-E+w)-(-C+_)*(-E+V),ar=(-T+S)*(-R+w)-(-T+_)*(-R+k),wt=(Q*ar-ie*Fe)/Z,Jt=(se*Fe-he*ar)/Z,xr=(wt-_)*(wt-_)+(Jt-w)*(Jt-w),Et=_+(wt-_)*P,Vt=w+(Jt-w)*P,lr=_-(wt-_)*I,br=w-(Jt-w)*I,$V=Math.min(Q*Q+he*he,ie*ie+se*se),np=de?P:I,GV=$V+np*np*b;xr<=GV?a.join==="bevel"||xr/b>q?(de?(d.push(Et,Vt),d.push(_+C*I,w+E*I),d.push(Et,Vt),d.push(_+T*I,w+R*I)):(d.push(_-C*P,w-E*P),d.push(lr,br),d.push(_-T*P,w-R*P),d.push(lr,br)),g+=2):a.join==="round"?de?(d.push(Et,Vt),d.push(_+C*I,w+E*I),g+=ls(_,w,_+C*I,w+E*I,_+T*I,w+R*I,d,!0)+4,d.push(Et,Vt),d.push(_+T*I,w+R*I)):(d.push(_-C*P,w-E*P),d.push(lr,br),g+=ls(_,w,_-C*P,w-E*P,_-T*P,w-R*P,d,!1)+4,d.push(_-T*P,w-R*P),d.push(lr,br)):(d.push(Et,Vt),d.push(lr,br)):(d.push(_-C*P,w-E*P),d.push(_+C*I,w+E*I),a.join==="round"?de?g+=ls(_,w,_+C*I,w+E*I,_+T*I,w+R*I,d,!0)+2:g+=ls(_,w,_-C*P,w-E*P,_-T*P,w-R*P,d,!1)+2:a.join==="miter"&&xr/b<=q&&(de?(d.push(lr,br),d.push(lr,br)):(d.push(Et,Vt),d.push(Et,Vt)),g+=2),d.push(_-T*P,w-R*P),d.push(_+T*I,w+R*I),g+=2)}x=t[(m-2)*2],V=t[(m-2)*2+1],_=t[(m-1)*2],w=t[(m-1)*2+1],C=-(V-w),E=x-_,M=Math.sqrt(C*C+E*E),C/=M,E/=M,C*=y,E*=y,d.push(_-C*P,w-E*P),d.push(_+C*I,w+E*I),h||(a.cap==="round"?g+=ls(_-C*(P-I)*.5,w-E*(P-I)*.5,_-C*P,w-E*P,_+C*I,w+E*I,d,!1)+2:a.cap==="square"&&(g+=fg(_,w,C,E,P,I,!1,d)));const B=dg*dg;for(let F=A;F<g+A-2;++F)x=d[F*2],V=d[F*2+1],_=d[(F+1)*2],w=d[(F+1)*2+1],S=d[(F+2)*2],k=d[(F+2)*2+1],!(Math.abs(x*(w-k)+_*(k-V)+S*(V-w))<B)&&i.push(F,F+1,F+2)}function CE(t,e,r,s){const n=lb;if(t.length===0)return;const i=t[0],o=t[1],a=t[t.length-2],l=t[t.length-1],c=e||Math.abs(i-a)<n&&Math.abs(o-l)<n,u=r,h=t.length/2,f=u.length/2;for(let d=0;d<h;d++)u.push(t[d*2]),u.push(t[d*2+1]);for(let d=0;d<h-1;d++)s.push(f+d,f+d+1);c&&s.push(f+h-1,f)}function cb(t,e,r,s,n,i,o){const a=VC(t,e,2);if(!a)return;for(let c=0;c<a.length;c+=3)i[o++]=a[c]+n,i[o++]=a[c+1]+n,i[o++]=a[c+2]+n;let l=n*s;for(let c=0;c<t.length;c+=2)r[l]=t[c],r[l+1]=t[c+1],l+=s}const EE=[],TE={extension:{type:we.ShapeBuilder,name:"polygon"},build(t,e){for(let r=0;r<t.points.length;r++)e[r]=t.points[r];return!0},triangulate(t,e,r,s,n,i){cb(t,EE,e,r,s,n,i)}},PE={extension:{type:we.ShapeBuilder,name:"rectangle"},build(t,e){const r=t,s=r.x,n=r.y,i=r.width,o=r.height;return i>0&&o>0?(e[0]=s,e[1]=n,e[2]=s+i,e[3]=n,e[4]=s+i,e[5]=n+o,e[6]=s,e[7]=n+o,!0):!1},triangulate(t,e,r,s,n,i){let o=0;s*=r,e[s+o]=t[0],e[s+o+1]=t[1],o+=r,e[s+o]=t[2],e[s+o+1]=t[3],o+=r,e[s+o]=t[6],e[s+o+1]=t[7],o+=r,e[s+o]=t[4],e[s+o+1]=t[5],o+=r;const a=s/r;n[i++]=a,n[i++]=a+1,n[i++]=a+2,n[i++]=a+1,n[i++]=a+3,n[i++]=a+2}},RE={extension:{type:we.ShapeBuilder,name:"triangle"},build(t,e){return e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,!0},triangulate(t,e,r,s,n,i){let o=0;s*=r,e[s+o]=t[0],e[s+o+1]=t[1],o+=r,e[s+o]=t[2],e[s+o+1]=t[3],o+=r,e[s+o]=t[4],e[s+o+1]=t[5];const a=s/r;n[i++]=a,n[i++]=a+1,n[i++]=a+2}},pg=[{offset:0,color:"white"},{offset:1,color:"black"}],ef=class Sh{constructor(...e){this.uid=Ue("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let r=ME(e);r={...r.type==="radial"?Sh.defaultRadialOptions:Sh.defaultLinearOptions,...cx(r)},this._textureSize=r.textureSize,this._wrapMode=r.wrapMode,r.type==="radial"?(this.center=r.center,this.outerCenter=r.outerCenter??this.center,this.innerRadius=r.innerRadius,this.outerRadius=r.outerRadius,this.scale=r.scale,this.rotation=r.rotation):(this.start=r.start,this.end=r.end),this.textureSpace=r.textureSpace,this.type=r.type,r.colorStops.forEach(n=>{this.addColorStop(n.offset,n.color)})}addColorStop(e,r){return this.colorStops.push({offset:e,color:be.shared.setValue(r).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:e,y:r}=this.start,{x:s,y:n}=this.end,i=s-e,o=n-r;const a=i<0||o<0;if(this._wrapMode==="clamp-to-edge"){if(i<0){const A=e;e=s,s=A,i*=-1}if(o<0){const A=r;r=n,n=A,o*=-1}}const l=this.colorStops.length?this.colorStops:pg,c=this._textureSize,{canvas:u,context:h}=gg(c,1),f=a?h.createLinearGradient(this._textureSize,0,0,0):h.createLinearGradient(0,0,this._textureSize,0);mg(f,l),h.fillStyle=f,h.fillRect(0,0,c,1),this.texture=new Ae({source:new il({resource:u,addressMode:this._wrapMode})});const d=Math.sqrt(i*i+o*o),m=Math.atan2(o,i),g=new pe;g.scale(d/c,1),g.rotate(m),g.translate(e,r),this.textureSpace==="local"&&g.scale(c,c),this.transform=g}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const e=this.colorStops.length?this.colorStops:pg,r=this._textureSize,{canvas:s,context:n}=gg(r,r),{x:i,y:o}=this.center,{x:a,y:l}=this.outerCenter,c=this.innerRadius,u=this.outerRadius,h=a-u,f=l-u,d=r/(u*2),m=(i-h)*d,g=(o-f)*d,A=n.createRadialGradient(m,g,c*d,(a-h)*d,(l-f)*d,u*d);mg(A,e),n.fillStyle=e[e.length-1].color,n.fillRect(0,0,r,r),n.fillStyle=A,n.translate(m,g),n.rotate(this.rotation),n.scale(1,this.scale),n.translate(-m,-g),n.fillRect(0,0,r,r),this.texture=new Ae({source:new il({resource:s,addressMode:this._wrapMode})});const y=new pe;y.scale(1/d,1/d),y.translate(h,f),this.textureSpace==="local"&&y.scale(r,r),this.transform=y}destroy(){this.texture?.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};ef.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};ef.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Co=ef;function mg(t,e){for(let r=0;r<e.length;r++){const s=e[r];t.addColorStop(s.offset,s.color)}}function gg(t,e){const r=So.get().createCanvas(t,e),s=r.getContext("2d");return{canvas:r,context:s}}function ME(t){let e=t[0]??{};return(typeof e=="number"||t[1])&&(_e("8.5.2","use options object instead"),e={type:"linear",start:{x:t[0],y:t[1]},end:{x:t[2],y:t[3]},textureSpace:t[4],textureSize:t[5]??Co.defaultLinearOptions.textureSize}),e}const IE=new pe,jE=new Ye;function OE(t,e,r,s){const n=e.matrix?t.copyFrom(e.matrix).invert():t.identity();if(e.textureSpace==="local"){const o=r.getBounds(jE);e.width&&o.pad(e.width);const{x:a,y:l}=o,c=1/o.width,u=1/o.height,h=-a*c,f=-l*u,d=n.a,m=n.b,g=n.c,A=n.d;n.a*=c,n.b*=c,n.c*=u,n.d*=u,n.tx=h*d+f*g+n.tx,n.ty=h*m+f*A+n.ty}else n.translate(e.texture.frame.x,e.texture.frame.y),n.scale(1/e.texture.source.width,1/e.texture.source.height);const i=e.texture.source.style;return!(e.fill instanceof Co)&&i.addressMode==="clamp-to-edge"&&(i.addressMode="repeat",i.update()),s&&n.append(IE.copyFrom(s).invert()),n}const Gl={};zt.handleByMap(we.ShapeBuilder,Gl);zt.add(PE,TE,RE,Zi,vE,_E);const NE=new Ye,BE=new pe;function DE(t,e){const{geometryData:r,batches:s}=e;s.length=0,r.indices.length=0,r.vertices.length=0,r.uvs.length=0;for(let n=0;n<t.instructions.length;n++){const i=t.instructions[n];if(i.action==="texture")zE(i.data,s,r);else if(i.action==="fill"||i.action==="stroke"){const o=i.action==="stroke",a=i.data.path.shapePath,l=i.data.style,c=i.data.hole;o&&c&&Ag(c.shapePath,l,!0,s,r),c&&(a.shapePrimitives[a.shapePrimitives.length-1].holes=c.shapePath.shapePrimitives),Ag(a,l,o,s,r)}}}function zE(t,e,r){const s=[],n=Gl.rectangle,i=NE;i.x=t.dx,i.y=t.dy,i.width=t.dw,i.height=t.dh;const o=t.transform;if(!n.build(i,s))return;const{vertices:a,uvs:l,indices:c}=r,u=c.length,h=a.length/2;o&&ab(s,o),n.triangulate(s,a,2,h,c,u);const f=t.image,d=f.uvs;l.push(d.x0,d.y0,d.x1,d.y1,d.x3,d.y3,d.x2,d.y2);const m=Ct.get(Zd);m.indexOffset=u,m.indexSize=c.length-u,m.attributeOffset=h,m.attributeSize=a.length/2-h,m.baseColor=t.style,m.alpha=t.alpha,m.texture=f,m.geometryData=r,e.push(m)}function Ag(t,e,r,s,n){const{vertices:i,uvs:o,indices:a}=n;t.shapePrimitives.forEach(({shape:l,transform:c,holes:u})=>{const h=[],f=Gl[l.type];if(!f.build(l,h))return;const d=a.length,m=i.length/2;let g="triangle-list";if(c&&ab(h,c),r){const q=l.closePath??!0,x=e;x.pixelLine?(CE(h,q,i,a),g="line-list"):kE(h,x,!1,q,i,a)}else if(u){const q=[],x=h.slice();FE(u).forEach(_=>{q.push(x.length/2),x.push(..._)}),cb(x,q,i,2,m,a,d)}else f.triangulate(h,i,2,m,a,d);const A=o.length/2,y=e.texture;if(y!==Ae.WHITE){const q=OE(BE,e,l,c);bE(i,2,m,o,A,2,i.length/2-m,q)}else wE(o,A,2,i.length/2-m);const b=Ct.get(Zd);b.indexOffset=d,b.indexSize=a.length-d,b.attributeOffset=m,b.attributeSize=i.length/2-m,b.baseColor=e.color,b.alpha=e.alpha,b.texture=y,b.geometryData=n,b.topology=g,s.push(b)})}function FE(t){const e=[];for(let r=0;r<t.length;r++){const s=t[r].shape,n=[];Gl[s.type].build(s,n)&&e.push(n)}return e}class LE{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}reset(){this.batches&&this.batches.forEach(e=>{Ct.return(e)}),this.graphicsData&&Ct.return(this.graphicsData),this.isBatchable=!1,this.context=null,this.batches.length=0,this.geometryData.indices.length=0,this.geometryData.vertices.length=0,this.geometryData.uvs.length=0,this.graphicsData=null}destroy(){this.reset(),this.batches=null,this.geometryData=null}}class UE{constructor(){this.instructions=new Wd}init(e){const r=e.maxTextures;this.batcher?this.batcher._updateMaxTextures(r):this.batcher=new xE({maxTextures:r}),this.instructions.reset()}get geometry(){return _e(GS,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const tf=class kh{constructor(e){this._renderer=e,this._managedContexts=new $l({renderer:e,type:"resource",name:"graphicsContext"})}init(e){kh.defaultOptions.bezierSmoothness=e?.bezierSmoothness??kh.defaultOptions.bezierSmoothness}getContextRenderData(e){return e._gpuData[this._renderer.uid].graphicsData||this._initContextRenderData(e)}updateGpuContext(e){const r=!!e._gpuData[this._renderer.uid],s=e._gpuData[this._renderer.uid]||this._initContext(e);if(e.dirty||!r){r&&s.reset(),DE(e,s);const n=e.batchMode;e.customShader||n==="no-batch"?s.isBatchable=!1:n==="auto"?s.isBatchable=s.geometryData.vertices.length<400:s.isBatchable=!0,e.dirty=!1}return s}getGpuContext(e){return e._gpuData[this._renderer.uid]||this._initContext(e)}_initContextRenderData(e){const r=Ct.get(UE,{maxTextures:this._renderer.limits.maxBatchableTextures}),s=e._gpuData[this._renderer.uid],{batches:n,geometryData:i}=s;s.graphicsData=r;const o=i.vertices.length,a=i.indices.length;for(let h=0;h<n.length;h++)n[h].applyTransform=!1;const l=r.batcher;l.ensureAttributeBuffer(o),l.ensureIndexBuffer(a),l.begin();for(let h=0;h<n.length;h++){const f=n[h];l.add(f)}l.finish(r.instructions);const c=l.geometry;c.indexBuffer.setDataWithSize(l.indexBuffer,l.indexSize,!0),c.buffers[0].setDataWithSize(l.attributeBuffer.float32View,l.attributeSize,!0);const u=l.batches;for(let h=0;h<u.length;h++){const f=u[h];f.bindGroup=PC(f.textures.textures,f.textures.count,this._renderer.limits.maxBatchableTextures)}return r}_initContext(e){const r=new LE;return r.context=e,e._gpuData[this._renderer.uid]=r,this._managedContexts.add(e),r}destroy(){this._managedContexts.destroy(),this._renderer=null}};tf.extension={type:[we.WebGLSystem,we.WebGPUSystem],name:"graphicsContext"};tf.defaultOptions={bezierSmoothness:.5};let rf=tf;const $E=8,da=11920929e-14,GE=1;function ub(t,e,r,s,n,i,o,a,l,c){const h=Math.min(.99,Math.max(0,c??rf.defaultOptions.bezierSmoothness));let f=(GE-h)/1;return f*=f,HE(e,r,s,n,i,o,a,l,t,f),t}function HE(t,e,r,s,n,i,o,a,l,c){Ch(t,e,r,s,n,i,o,a,l,c,0),l.push(o,a)}function Ch(t,e,r,s,n,i,o,a,l,c,u){if(u>$E)return;const h=(t+r)/2,f=(e+s)/2,d=(r+n)/2,m=(s+i)/2,g=(n+o)/2,A=(i+a)/2,y=(h+d)/2,b=(f+m)/2,q=(d+g)/2,x=(m+A)/2,V=(y+q)/2,_=(b+x)/2;if(u>0){let w=o-t,S=a-e;const k=Math.abs((r-o)*S-(s-a)*w),C=Math.abs((n-o)*S-(i-a)*w);if(k>da&&C>da){if((k+C)*(k+C)<=c*(w*w+S*S)){l.push(V,_);return}}else if(k>da){if(k*k<=c*(w*w+S*S)){l.push(V,_);return}}else if(C>da){if(C*C<=c*(w*w+S*S)){l.push(V,_);return}}else if(w=V-(t+o)/2,S=_-(e+a)/2,w*w+S*S<=c){l.push(V,_);return}}Ch(t,e,h,f,y,b,V,_,l,c,u+1),Ch(V,_,q,x,g,A,o,a,l,c,u+1)}const WE=8,YE=11920929e-14,KE=1;function QE(t,e,r,s,n,i,o,a){const c=Math.min(.99,Math.max(0,a??rf.defaultOptions.bezierSmoothness));let u=(KE-c)/1;return u*=u,XE(e,r,s,n,i,o,t,u),t}function XE(t,e,r,s,n,i,o,a){Eh(o,t,e,r,s,n,i,a,0),o.push(n,i)}function Eh(t,e,r,s,n,i,o,a,l){if(l>WE)return;const c=(e+s)/2,u=(r+n)/2,h=(s+i)/2,f=(n+o)/2,d=(c+h)/2,m=(u+f)/2;let g=i-e,A=o-r;const y=Math.abs((s-i)*A-(n-o)*g);if(y>YE){if(y*y<=a*(g*g+A*A)){t.push(d,m);return}}else if(g=d-(e+i)/2,A=m-(r+o)/2,g*g+A*A<=a){t.push(d,m);return}Eh(t,e,r,c,u,d,m,a,l+1),Eh(t,d,m,h,f,i,o,a,l+1)}function hb(t,e,r,s,n,i,o,a){let l=Math.abs(n-i);(!o&&n>i||o&&i>n)&&(l=2*Math.PI-l),a||(a=Math.max(6,Math.floor(6*Math.pow(s,1/3)*(l/Math.PI)))),a=Math.max(a,3);let c=l/a,u=n;c*=o?-1:1;for(let h=0;h<a+1;h++){const f=Math.cos(u),d=Math.sin(u),m=e+f*s,g=r+d*s;t.push(m,g),u+=c}}function JE(t,e,r,s,n,i){const o=t[t.length-2],l=t[t.length-1]-r,c=o-e,u=n-r,h=s-e,f=Math.abs(l*h-c*u);if(f<1e-8||i===0){(t[t.length-2]!==e||t[t.length-1]!==r)&&t.push(e,r);return}const d=l*l+c*c,m=u*u+h*h,g=l*u+c*h,A=i*Math.sqrt(d)/f,y=i*Math.sqrt(m)/f,b=A*g/d,q=y*g/m,x=A*h+y*c,V=A*u+y*l,_=c*(y+b),w=l*(y+b),S=h*(A+q),k=u*(A+q),C=Math.atan2(w-V,_-x),E=Math.atan2(k-V,S-x);hb(t,x+e,V+r,i,C,E,c*u>h*l)}const Ni=Math.PI*2,lu={centerX:0,centerY:0,ang1:0,ang2:0},cu=({x:t,y:e},r,s,n,i,o,a,l)=>{t*=r,e*=s;const c=n*t-i*e,u=i*t+n*e;return l.x=c+o,l.y=u+a,l};function ZE(t,e){const r=e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),s=e===1.5707963267948966?.551915024494:r,n=Math.cos(t),i=Math.sin(t),o=Math.cos(t+e),a=Math.sin(t+e);return[{x:n-i*s,y:i+n*s},{x:o+a*s,y:a-o*s},{x:o,y:a}]}const yg=(t,e,r,s)=>{const n=t*s-e*r<0?-1:1;let i=t*r+e*s;return i>1&&(i=1),i<-1&&(i=-1),n*Math.acos(i)},e1=(t,e,r,s,n,i,o,a,l,c,u,h,f)=>{const d=Math.pow(n,2),m=Math.pow(i,2),g=Math.pow(u,2),A=Math.pow(h,2);let y=d*m-d*A-m*g;y<0&&(y=0),y/=d*A+m*g,y=Math.sqrt(y)*(o===a?-1:1);const b=y*n/i*h,q=y*-i/n*u,x=c*b-l*q+(t+r)/2,V=l*b+c*q+(e+s)/2,_=(u-b)/n,w=(h-q)/i,S=(-u-b)/n,k=(-h-q)/i,C=yg(1,0,_,w);let E=yg(_,w,S,k);a===0&&E>0&&(E-=Ni),a===1&&E<0&&(E+=Ni),f.centerX=x,f.centerY=V,f.ang1=C,f.ang2=E};function t1(t,e,r,s,n,i,o,a=0,l=0,c=0){if(i===0||o===0)return;const u=Math.sin(a*Ni/360),h=Math.cos(a*Ni/360),f=h*(e-s)/2+u*(r-n)/2,d=-u*(e-s)/2+h*(r-n)/2;if(f===0&&d===0)return;i=Math.abs(i),o=Math.abs(o);const m=Math.pow(f,2)/Math.pow(i,2)+Math.pow(d,2)/Math.pow(o,2);m>1&&(i*=Math.sqrt(m),o*=Math.sqrt(m)),e1(e,r,s,n,i,o,l,c,u,h,f,d,lu);let{ang1:g,ang2:A}=lu;const{centerX:y,centerY:b}=lu;let q=Math.abs(A)/(Ni/4);Math.abs(1-q)<1e-7&&(q=1);const x=Math.max(Math.ceil(q),1);A/=x;let V=t[t.length-2],_=t[t.length-1];const w={x:0,y:0};for(let S=0;S<x;S++){const k=ZE(g,A),{x:C,y:E}=cu(k[0],i,o,h,u,y,b,w),{x:T,y:R}=cu(k[1],i,o,h,u,y,b,w),{x:M,y:D}=cu(k[2],i,o,h,u,y,b,w);ub(t,V,_,C,E,T,R,M,D),V=M,_=D,g+=A}}function r1(t,e,r){const s=(o,a)=>{const l=a.x-o.x,c=a.y-o.y,u=Math.sqrt(l*l+c*c),h=l/u,f=c/u;return{len:u,nx:h,ny:f}},n=(o,a)=>{o===0?t.moveTo(a.x,a.y):t.lineTo(a.x,a.y)};let i=e[e.length-1];for(let o=0;o<e.length;o++){const a=e[o%e.length],l=a.radius??r;if(l<=0){n(o,a),i=a;continue}const c=e[(o+1)%e.length],u=s(a,i),h=s(a,c);if(u.len<1e-4||h.len<1e-4){n(o,a),i=a;continue}let f=Math.asin(u.nx*h.ny-u.ny*h.nx),d=1,m=!1;u.nx*h.nx-u.ny*-h.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,d=-1,m=!0):f>0&&(d=-1,m=!0);const g=f/2;let A,y=Math.abs(Math.cos(g)*l/Math.sin(g));y>Math.min(u.len/2,h.len/2)?(y=Math.min(u.len/2,h.len/2),A=Math.abs(y*Math.sin(g)/Math.cos(g))):A=l;const b=a.x+h.nx*y+-h.ny*A*d,q=a.y+h.ny*y+h.nx*A*d,x=Math.atan2(u.ny,u.nx)+Math.PI/2*d,V=Math.atan2(h.ny,h.nx)-Math.PI/2*d;o===0&&t.moveTo(b+Math.cos(x)*A,q+Math.sin(x)*A),t.arc(b,q,A,x,V,m),i=a}}function s1(t,e,r,s){const n=(a,l)=>Math.sqrt((a.x-l.x)**2+(a.y-l.y)**2),i=(a,l,c)=>({x:a.x+(l.x-a.x)*c,y:a.y+(l.y-a.y)*c}),o=e.length;for(let a=0;a<o;a++){const l=e[(a+1)%o],c=l.radius??r;if(c<=0){a===0?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y);continue}const u=e[a],h=e[(a+2)%o],f=n(u,l);let d;if(f<1e-4)d=l;else{const A=Math.min(f/2,c);d=i(l,u,A/f)}const m=n(h,l);let g;if(m<1e-4)g=l;else{const A=Math.min(m/2,c);g=i(l,h,A/m)}a===0?t.moveTo(d.x,d.y):t.lineTo(d.x,d.y),t.quadraticCurveTo(l.x,l.y,g.x,g.y,s)}}const n1=new Ye;class i1{constructor(e){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new nr,this._graphicsPath2D=e,this.signed=e.checkForHoles}moveTo(e,r){return this.startPoly(e,r),this}lineTo(e,r){this._ensurePoly();const s=this._currentPoly.points,n=s[s.length-2],i=s[s.length-1];return(n!==e||i!==r)&&s.push(e,r),this}arc(e,r,s,n,i,o){this._ensurePoly(!1);const a=this._currentPoly.points;return hb(a,e,r,s,n,i,o),this}arcTo(e,r,s,n,i){this._ensurePoly();const o=this._currentPoly.points;return JE(o,e,r,s,n,i),this}arcToSvg(e,r,s,n,i,o,a){const l=this._currentPoly.points;return t1(l,this._currentPoly.lastX,this._currentPoly.lastY,o,a,e,r,s,n,i),this}bezierCurveTo(e,r,s,n,i,o,a){this._ensurePoly();const l=this._currentPoly;return ub(this._currentPoly.points,l.lastX,l.lastY,e,r,s,n,i,o,a),this}quadraticCurveTo(e,r,s,n,i){this._ensurePoly();const o=this._currentPoly;return QE(this._currentPoly.points,o.lastX,o.lastY,e,r,s,n,i),this}closePath(){return this.endPoly(!0),this}addPath(e,r){this.endPoly(),r&&!r.isIdentity()&&(e=e.clone(!0),e.transform(r));const s=this.shapePrimitives,n=s.length;for(let i=0;i<e.instructions.length;i++){const o=e.instructions[i];this[o.action](...o.data)}if(e.checkForHoles&&s.length-n>1){let i=null;for(let o=n;o<s.length;o++){const a=s[o];if(a.shape.type==="polygon"){const l=a.shape,c=i?.shape;c&&c.containsPolygon(l)?(i.holes||(i.holes=[]),i.holes.push(a),s.copyWithin(o,o+1),s.length--,o--):i=a}}}return this}finish(e=!1){this.endPoly(e)}rect(e,r,s,n,i){return this.drawShape(new Ye(e,r,s,n),i),this}circle(e,r,s,n){return this.drawShape(new Qd(e,r,s),n),this}poly(e,r,s){const n=new ji(e);return n.closePath=r,this.drawShape(n,s),this}regularPoly(e,r,s,n,i=0,o){n=Math.max(n|0,3);const a=-1*Math.PI/2+i,l=Math.PI*2/n,c=[];for(let u=0;u<n;u++){const h=a-u*l;c.push(e+s*Math.cos(h),r+s*Math.sin(h))}return this.poly(c,!0,o),this}roundPoly(e,r,s,n,i,o=0,a){if(n=Math.max(n|0,3),i<=0)return this.regularPoly(e,r,s,n,o);const l=s*Math.sin(Math.PI/n)-.001;i=Math.min(i,l);const c=-1*Math.PI/2+o,u=Math.PI*2/n,h=(n-2)*Math.PI/n/2;for(let f=0;f<n;f++){const d=f*u+c,m=e+s*Math.cos(d),g=r+s*Math.sin(d),A=d+Math.PI+h,y=d-Math.PI-h,b=m+i*Math.cos(A),q=g+i*Math.sin(A),x=m+i*Math.cos(y),V=g+i*Math.sin(y);f===0?this.moveTo(b,q):this.lineTo(b,q),this.quadraticCurveTo(m,g,x,V,a)}return this.closePath()}roundShape(e,r,s=!1,n){return e.length<3?this:(s?s1(this,e,r,n):r1(this,e,r),this.closePath())}filletRect(e,r,s,n,i){if(i===0)return this.rect(e,r,s,n);const o=Math.min(s,n)/2,a=Math.min(o,Math.max(-o,i)),l=e+s,c=r+n,u=a<0?-a:0,h=Math.abs(a);return this.moveTo(e,r+h).arcTo(e+u,r+u,e+h,r,h).lineTo(l-h,r).arcTo(l-u,r+u,l,r+h,h).lineTo(l,c-h).arcTo(l-u,c-u,e+s-h,c,h).lineTo(e+h,c).arcTo(e+u,c-u,e,c-h,h).closePath()}chamferRect(e,r,s,n,i,o){if(i<=0)return this.rect(e,r,s,n);const a=Math.min(i,Math.min(s,n)/2),l=e+s,c=r+n,u=[e+a,r,l-a,r,l,r+a,l,c-a,l-a,c,e+a,c,e,c-a,e,r+a];for(let h=u.length-1;h>=2;h-=2)u[h]===u[h-2]&&u[h-1]===u[h-3]&&u.splice(h-1,2);return this.poly(u,!0,o)}ellipse(e,r,s,n,i){return this.drawShape(new Xd(e,r,s,n),i),this}roundRect(e,r,s,n,i,o){return this.drawShape(new Jd(e,r,s,n,i),o),this}drawShape(e,r){return this.endPoly(),this.shapePrimitives.push({shape:e,transform:r}),this}startPoly(e,r){let s=this._currentPoly;return s&&this.endPoly(),s=new ji,s.points.push(e,r),this._currentPoly=s,this}endPoly(e=!1){const r=this._currentPoly;return r&&r.points.length>2&&(r.closePath=e,this.shapePrimitives.push({shape:r})),this._currentPoly=null,this}_ensurePoly(e=!0){if(!this._currentPoly&&(this._currentPoly=new ji,e)){const r=this.shapePrimitives[this.shapePrimitives.length-1];if(r){let s=r.shape.x,n=r.shape.y;if(r.transform&&!r.transform.isIdentity()){const i=r.transform,o=s;s=i.a*s+i.c*n+i.tx,n=i.b*o+i.d*n+i.ty}this._currentPoly.points.push(s,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const e=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let r=0;r<e.instructions.length;r++){const s=e.instructions[r];this[s.action](...s.data)}this.finish()}get bounds(){const e=this._bounds;e.clear();const r=this.shapePrimitives;for(let s=0;s<r.length;s++){const n=r[s],i=n.shape.getBounds(n1);n.transform?e.addRect(i,n.transform):e.addRect(i)}return e}}class Rr{constructor(e,r=!1){this.instructions=[],this.uid=Ue("graphicsPath"),this._dirty=!0,this.checkForHoles=r,typeof e=="string"?kC(e,this):this.instructions=e?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new i1(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(e,r){return e=e.clone(),this.instructions.push({action:"addPath",data:[e,r]}),this._dirty=!0,this}arc(...e){return this.instructions.push({action:"arc",data:e}),this._dirty=!0,this}arcTo(...e){return this.instructions.push({action:"arcTo",data:e}),this._dirty=!0,this}arcToSvg(...e){return this.instructions.push({action:"arcToSvg",data:e}),this._dirty=!0,this}bezierCurveTo(...e){return this.instructions.push({action:"bezierCurveTo",data:e}),this._dirty=!0,this}bezierCurveToShort(e,r,s,n,i){const o=this.instructions[this.instructions.length-1],a=this.getLastPoint(dt.shared);let l=0,c=0;if(!o||o.action!=="bezierCurveTo")l=a.x,c=a.y;else{l=o.data[2],c=o.data[3];const u=a.x,h=a.y;l=u+(u-l),c=h+(h-c)}return this.instructions.push({action:"bezierCurveTo",data:[l,c,e,r,s,n,i]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...e){return this.instructions.push({action:"ellipse",data:e}),this._dirty=!0,this}lineTo(...e){return this.instructions.push({action:"lineTo",data:e}),this._dirty=!0,this}moveTo(...e){return this.instructions.push({action:"moveTo",data:e}),this}quadraticCurveTo(...e){return this.instructions.push({action:"quadraticCurveTo",data:e}),this._dirty=!0,this}quadraticCurveToShort(e,r,s){const n=this.instructions[this.instructions.length-1],i=this.getLastPoint(dt.shared);let o=0,a=0;if(!n||n.action!=="quadraticCurveTo")o=i.x,a=i.y;else{o=n.data[0],a=n.data[1];const l=i.x,c=i.y;o=l+(l-o),a=c+(c-a)}return this.instructions.push({action:"quadraticCurveTo",data:[o,a,e,r,s]}),this._dirty=!0,this}rect(e,r,s,n,i){return this.instructions.push({action:"rect",data:[e,r,s,n,i]}),this._dirty=!0,this}circle(e,r,s,n){return this.instructions.push({action:"circle",data:[e,r,s,n]}),this._dirty=!0,this}roundRect(...e){return this.instructions.push({action:"roundRect",data:e}),this._dirty=!0,this}poly(...e){return this.instructions.push({action:"poly",data:e}),this._dirty=!0,this}regularPoly(...e){return this.instructions.push({action:"regularPoly",data:e}),this._dirty=!0,this}roundPoly(...e){return this.instructions.push({action:"roundPoly",data:e}),this._dirty=!0,this}roundShape(...e){return this.instructions.push({action:"roundShape",data:e}),this._dirty=!0,this}filletRect(...e){return this.instructions.push({action:"filletRect",data:e}),this._dirty=!0,this}chamferRect(...e){return this.instructions.push({action:"chamferRect",data:e}),this._dirty=!0,this}star(e,r,s,n,i,o,a){i||(i=n/2);const l=-1*Math.PI/2+o,c=s*2,u=Math.PI*2/c,h=[];for(let f=0;f<c;f++){const d=f%2?i:n,m=f*u+l;h.push(e+d*Math.cos(m),r+d*Math.sin(m))}return this.poly(h,!0,a),this}clone(e=!1){const r=new Rr;if(r.checkForHoles=this.checkForHoles,!e)r.instructions=this.instructions.slice();else for(let s=0;s<this.instructions.length;s++){const n=this.instructions[s];r.instructions.push({action:n.action,data:n.data.slice()})}return r}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(e){if(e.isIdentity())return this;const r=e.a,s=e.b,n=e.c,i=e.d,o=e.tx,a=e.ty;let l=0,c=0,u=0,h=0,f=0,d=0,m=0,g=0;for(let A=0;A<this.instructions.length;A++){const y=this.instructions[A],b=y.data;switch(y.action){case"moveTo":case"lineTo":l=b[0],c=b[1],b[0]=r*l+n*c+o,b[1]=s*l+i*c+a;break;case"bezierCurveTo":u=b[0],h=b[1],f=b[2],d=b[3],l=b[4],c=b[5],b[0]=r*u+n*h+o,b[1]=s*u+i*h+a,b[2]=r*f+n*d+o,b[3]=s*f+i*d+a,b[4]=r*l+n*c+o,b[5]=s*l+i*c+a;break;case"quadraticCurveTo":u=b[0],h=b[1],l=b[2],c=b[3],b[0]=r*u+n*h+o,b[1]=s*u+i*h+a,b[2]=r*l+n*c+o,b[3]=s*l+i*c+a;break;case"arcToSvg":l=b[5],c=b[6],m=b[0],g=b[1],b[0]=r*m+n*g,b[1]=s*m+i*g,b[5]=r*l+n*c+o,b[6]=s*l+i*c+a;break;case"circle":b[4]=ui(b[3],e);break;case"rect":b[4]=ui(b[4],e);break;case"ellipse":b[8]=ui(b[8],e);break;case"roundRect":b[5]=ui(b[5],e);break;case"addPath":b[0].transform(e);break;case"poly":b[2]=ui(b[2],e);break;default:Nt("unknown transform action",y.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(e){let r=this.instructions.length-1,s=this.instructions[r];if(!s)return e.x=0,e.y=0,e;for(;s.action==="closePath";){if(r--,r<0)return e.x=0,e.y=0,e;s=this.instructions[r]}switch(s.action){case"moveTo":case"lineTo":e.x=s.data[0],e.y=s.data[1];break;case"quadraticCurveTo":e.x=s.data[2],e.y=s.data[3];break;case"bezierCurveTo":e.x=s.data[4],e.y=s.data[5];break;case"arc":case"arcToSvg":e.x=s.data[5],e.y=s.data[6];break;case"addPath":s.data[0].getLastPoint(e);break}return e}}function ui(t,e){return t?t.prepend(e):e.clone()}function Ie(t,e,r){const s=t.getAttribute(e);return s?Number(s):r}function o1(t,e){const r=t.querySelectorAll("defs");for(let s=0;s<r.length;s++){const n=r[s];for(let i=0;i<n.children.length;i++){const o=n.children[i];switch(o.nodeName.toLowerCase()){case"lineargradient":e.defs[o.id]=a1(o);break;case"radialgradient":e.defs[o.id]=l1();break}}}}function a1(t){const e=Ie(t,"x1",0),r=Ie(t,"y1",0),s=Ie(t,"x2",1),n=Ie(t,"y2",0),i=t.getAttribute("gradientUnits")||"objectBoundingBox",o=new Co(e,r,s,n,i==="objectBoundingBox"?"local":"global");for(let a=0;a<t.children.length;a++){const l=t.children[a],c=Ie(l,"offset",0),u=be.shared.setValue(l.getAttribute("stop-color")).toNumber();o.addColorStop(c,u)}return o}function l1(t){return Nt("[SVG Parser] Radial gradients are not yet supported"),new Co(0,0,1,0)}function qg(t){const e=t.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return e?e[1]:""}const xg={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function db(t,e){const r=t.getAttribute("style"),s={},n={},i={strokeStyle:s,fillStyle:n,useFill:!1,useStroke:!1};for(const o in xg){const a=t.getAttribute(o);a&&bg(e,i,o,a.trim())}if(r){const o=r.split(";");for(let a=0;a<o.length;a++){const l=o[a].trim(),[c,u]=l.split(":");xg[c]&&bg(e,i,c,u.trim())}}return{strokeStyle:i.useStroke?s:null,fillStyle:i.useFill?n:null,useFill:i.useFill,useStroke:i.useStroke}}function bg(t,e,r,s){switch(r){case"stroke":if(s!=="none"){if(s.startsWith("url(")){const n=qg(s);e.strokeStyle.fill=t.defs[n]}else e.strokeStyle.color=be.shared.setValue(s).toNumber();e.useStroke=!0}break;case"stroke-width":e.strokeStyle.width=Number(s);break;case"fill":if(s!=="none"){if(s.startsWith("url(")){const n=qg(s);e.fillStyle.fill=t.defs[n]}else e.fillStyle.color=be.shared.setValue(s).toNumber();e.useFill=!0}break;case"fill-opacity":e.fillStyle.alpha=Number(s);break;case"stroke-opacity":e.strokeStyle.alpha=Number(s);break;case"opacity":e.fillStyle.alpha=Number(s),e.strokeStyle.alpha=Number(s);break}}function c1(t){if(t.length<=2)return!0;const e=t.map(a=>a.area).sort((a,l)=>l-a),[r,s]=e,n=e[e.length-1],i=r/s,o=s/n;return!(i>3&&o<2)}function u1(t){return t.split(/(?=[Mm])/).filter(s=>s.trim().length>0)}function h1(t){const e=t.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!e||e.length<4)return 0;const r=e.map(Number),s=[],n=[];for(let u=0;u<r.length;u+=2)u+1<r.length&&(s.push(r[u]),n.push(r[u+1]));if(s.length===0||n.length===0)return 0;const i=Math.min(...s),o=Math.max(...s),a=Math.min(...n),l=Math.max(...n);return(o-i)*(l-a)}function wg(t,e){const r=new Rr(t,!1);for(const s of r.instructions)e.instructions.push(s)}function d1(t,e){if(typeof t=="string"){const o=document.createElement("div");o.innerHTML=t.trim(),t=o.querySelector("svg")}const r={context:e,defs:{},path:new Rr};o1(t,r);const s=t.children,{fillStyle:n,strokeStyle:i}=db(t,r);for(let o=0;o<s.length;o++){const a=s[o];a.nodeName.toLowerCase()!=="defs"&&fb(a,r,n,i)}return e}function fb(t,e,r,s){const n=t.children,{fillStyle:i,strokeStyle:o}=db(t,e);i&&r?r={...r,...i}:i&&(r=i),o&&s?s={...s,...o}:o&&(s=o);const a=!r&&!s;a&&(r={color:0});let l,c,u,h,f,d,m,g,A,y,b,q,x,V,_,w,S;switch(t.nodeName.toLowerCase()){case"path":{V=t.getAttribute("d");const k=t.getAttribute("fill-rule"),C=u1(V),E=k==="evenodd",T=C.length>1;if(E&&T){const M=C.map(P=>({path:P,area:h1(P)}));if(M.sort((P,I)=>I.area-P.area),C.length>3||!c1(M))for(let P=0;P<M.length;P++){const I=M[P],B=P===0;e.context.beginPath();const F=new Rr(void 0,!0);wg(I.path,F),e.context.path(F),B?(r&&e.context.fill(r),s&&e.context.stroke(s)):e.context.cut()}else for(let P=0;P<M.length;P++){const I=M[P],B=P%2===1;e.context.beginPath();const F=new Rr(void 0,!0);wg(I.path,F),e.context.path(F),B?e.context.cut():(r&&e.context.fill(r),s&&e.context.stroke(s))}}else{const M=k?k==="evenodd":!0;_=new Rr(V,M),e.context.path(_),r&&e.context.fill(r),s&&e.context.stroke(s)}break}case"circle":m=Ie(t,"cx",0),g=Ie(t,"cy",0),A=Ie(t,"r",0),e.context.ellipse(m,g,A,A),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"rect":l=Ie(t,"x",0),c=Ie(t,"y",0),w=Ie(t,"width",0),S=Ie(t,"height",0),y=Ie(t,"rx",0),b=Ie(t,"ry",0),y||b?e.context.roundRect(l,c,w,S,y||b):e.context.rect(l,c,w,S),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"ellipse":m=Ie(t,"cx",0),g=Ie(t,"cy",0),y=Ie(t,"rx",0),b=Ie(t,"ry",0),e.context.beginPath(),e.context.ellipse(m,g,y,b),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"line":u=Ie(t,"x1",0),h=Ie(t,"y1",0),f=Ie(t,"x2",0),d=Ie(t,"y2",0),e.context.beginPath(),e.context.moveTo(u,h),e.context.lineTo(f,d),s&&e.context.stroke(s);break;case"polygon":x=t.getAttribute("points"),q=x.match(/-?\d+/g).map(k=>parseInt(k,10)),e.context.poly(q,!0),r&&e.context.fill(r),s&&e.context.stroke(s);break;case"polyline":x=t.getAttribute("points"),q=x.match(/-?\d+/g).map(k=>parseInt(k,10)),e.context.poly(q,!1),s&&e.context.stroke(s);break;case"g":case"svg":break;default:{Nt(`[SVG parser] <${t.nodeName}> elements unsupported`);break}}a&&(r=null);for(let k=0;k<n.length;k++)fb(n[k],e,r,s)}const Vg={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class f1{constructor(e,r){this.uid=Ue("fillPattern"),this._tick=0,this.transform=new pe,this.texture=e,this.transform.scale(1/e.frame.width,1/e.frame.height),r&&(e.source.style.addressModeU=Vg[r].addressModeU,e.source.style.addressModeV=Vg[r].addressModeV)}setTransform(e){const r=this.texture;this.transform.copyFrom(e),this.transform.invert(),this.transform.scale(1/r.frame.width,1/r.frame.height),this._tick++}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture=e,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}function p1(t){return be.isColorLike(t)}function vg(t){return t instanceof f1}function _g(t){return t instanceof Co}function m1(t){return t instanceof Ae}function g1(t,e,r){const s=be.shared.setValue(e??0);return t.color=s.toNumber(),t.alpha=s.alpha===1?r.alpha:s.alpha,t.texture=Ae.WHITE,{...r,...t}}function A1(t,e,r){return t.texture=e,{...r,...t}}function Sg(t,e,r){return t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,{...r,...t}}function kg(t,e,r){return e.buildGradient(),t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,t.textureSpace=e.textureSpace,{...r,...t}}function y1(t,e){const r={...e,...t},s=be.shared.setValue(r.color);return r.alpha*=s.alpha,r.color=s.toNumber(),r}function _i(t,e){if(t==null)return null;const r={},s=t;return p1(t)?g1(r,t,e):m1(t)?A1(r,t,e):vg(t)?Sg(r,t,e):_g(t)?kg(r,t,e):s.fill&&vg(s.fill)?Sg(s,s.fill,e):s.fill&&_g(s.fill)?kg(s,s.fill,e):y1(s,e)}function Cg(t,e){const{width:r,alignment:s,miterLimit:n,cap:i,join:o,pixelLine:a,...l}=e,c=_i(t,l);return c?{width:r,alignment:s,miterLimit:n,cap:i,join:o,pixelLine:a,...c}:null}const q1=new dt,Eg=new pe,sf=class dr extends os{constructor(){super(...arguments),this._gpuData=Object.create(null),this.autoGarbageCollect=!0,this._gcLastUsed=-1,this.uid=Ue("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this.destroyed=!1,this._activePath=new Rr,this._transform=new pe,this._fillStyle={...dr.defaultFillStyle},this._strokeStyle={...dr.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new nr,this._boundsDirty=!0}clone(){const e=new dr;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle={...this._fillStyle},e._strokeStyle={...this._strokeStyle},e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=_i(e,dr.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=Cg(e,dr.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=_i(e,dr.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=_i(e,dr.defaultStrokeStyle),this}texture(e,r,s,n,i,o){return this.instructions.push({action:"texture",data:{image:e,dx:s||0,dy:n||0,dw:i||e.frame.width,dh:o||e.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:r||r===0?be.shared.setValue(r).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new Rr,this}fill(e,r){let s;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n?.action==="stroke"?s=n.data.path:s=this._activePath.clone(),s?(e!=null&&(r!==void 0&&typeof e=="number"&&(_e(at,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:r}),this._fillStyle=_i(e,dr.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:s}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:e,y:r}=this._activePath.getLastPoint(dt.shared);this._activePath.clear(),this._activePath.moveTo(e,r)}stroke(e){let r;const s=this.instructions[this.instructions.length-1];return this._tick===0&&s?.action==="fill"?r=s.data.path:r=this._activePath.clone(),r?(e!=null&&(this._strokeStyle=Cg(e,dr.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let e=0;e<2;e++){const r=this.instructions[this.instructions.length-1-e],s=this._activePath.clone();if(r&&(r.action==="stroke"||r.action==="fill"))if(r.data.hole)r.data.hole.addPath(s);else{r.data.hole=s;break}}return this._initNextPathLocation(),this}arc(e,r,s,n,i,o){this._tick++;const a=this._transform;return this._activePath.arc(a.a*e+a.c*r+a.tx,a.b*e+a.d*r+a.ty,s,n,i,o),this}arcTo(e,r,s,n,i){this._tick++;const o=this._transform;return this._activePath.arcTo(o.a*e+o.c*r+o.tx,o.b*e+o.d*r+o.ty,o.a*s+o.c*n+o.tx,o.b*s+o.d*n+o.ty,i),this}arcToSvg(e,r,s,n,i,o,a){this._tick++;const l=this._transform;return this._activePath.arcToSvg(e,r,s,n,i,l.a*o+l.c*a+l.tx,l.b*o+l.d*a+l.ty),this}bezierCurveTo(e,r,s,n,i,o,a){this._tick++;const l=this._transform;return this._activePath.bezierCurveTo(l.a*e+l.c*r+l.tx,l.b*e+l.d*r+l.ty,l.a*s+l.c*n+l.tx,l.b*s+l.d*n+l.ty,l.a*i+l.c*o+l.tx,l.b*i+l.d*o+l.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(e,r,s,n){return this._tick++,this._activePath.ellipse(e,r,s,n,this._transform.clone()),this}circle(e,r,s){return this._tick++,this._activePath.circle(e,r,s,this._transform.clone()),this}path(e){return this._tick++,this._activePath.addPath(e,this._transform.clone()),this}lineTo(e,r){this._tick++;const s=this._transform;return this._activePath.lineTo(s.a*e+s.c*r+s.tx,s.b*e+s.d*r+s.ty),this}moveTo(e,r){this._tick++;const s=this._transform,n=this._activePath.instructions,i=s.a*e+s.c*r+s.tx,o=s.b*e+s.d*r+s.ty;return n.length===1&&n[0].action==="moveTo"?(n[0].data[0]=i,n[0].data[1]=o,this):(this._activePath.moveTo(i,o),this)}quadraticCurveTo(e,r,s,n,i){this._tick++;const o=this._transform;return this._activePath.quadraticCurveTo(o.a*e+o.c*r+o.tx,o.b*e+o.d*r+o.ty,o.a*s+o.c*n+o.tx,o.b*s+o.d*n+o.ty,i),this}rect(e,r,s,n){return this._tick++,this._activePath.rect(e,r,s,n,this._transform.clone()),this}roundRect(e,r,s,n,i){return this._tick++,this._activePath.roundRect(e,r,s,n,i,this._transform.clone()),this}poly(e,r){return this._tick++,this._activePath.poly(e,r,this._transform.clone()),this}regularPoly(e,r,s,n,i=0,o){return this._tick++,this._activePath.regularPoly(e,r,s,n,i,o),this}roundPoly(e,r,s,n,i,o){return this._tick++,this._activePath.roundPoly(e,r,s,n,i,o),this}roundShape(e,r,s,n){return this._tick++,this._activePath.roundShape(e,r,s,n),this}filletRect(e,r,s,n,i){return this._tick++,this._activePath.filletRect(e,r,s,n,i),this}chamferRect(e,r,s,n,i,o){return this._tick++,this._activePath.chamferRect(e,r,s,n,i,o),this}star(e,r,s,n,i=0,o=0){return this._tick++,this._activePath.star(e,r,s,n,i,o,this._transform.clone()),this}svg(e){return this._tick++,d1(e,this),this}restore(){const e=this._stateStack.pop();return e&&(this._transform=e.transform,this._fillStyle=e.fillStyle,this._strokeStyle=e.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(e){return this._transform.rotate(e),this}scale(e,r=e){return this._transform.scale(e,r),this}setTransform(e,r,s,n,i,o){return e instanceof pe?(this._transform.set(e.a,e.b,e.c,e.d,e.tx,e.ty),this):(this._transform.set(e,r,s,n,i,o),this)}transform(e,r,s,n,i,o){return e instanceof pe?(this._transform.append(e),this):(Eg.set(e,r,s,n,i,o),this._transform.append(Eg),this)}translate(e,r=e){return this._transform.translate(e,r),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const e=this._bounds;e.clear();for(let r=0;r<this.instructions.length;r++){const s=this.instructions[r],n=s.action;if(n==="fill"){const i=s.data;e.addBounds(i.path.bounds)}else if(n==="texture"){const i=s.data;e.addFrame(i.dx,i.dy,i.dx+i.dw,i.dy+i.dh,i.transform)}if(n==="stroke"){const i=s.data,o=i.style.alignment,a=i.style.width*(1-o),l=i.path.bounds;e.addFrame(l.minX-a,l.minY-a,l.maxX+a,l.maxY+a)}}return e}containsPoint(e){if(!this.bounds.containsPoint(e.x,e.y))return!1;const r=this.instructions;let s=!1;for(let n=0;n<r.length;n++){const i=r[n],o=i.data,a=o.path;if(!i.action||!a)continue;const l=o.style,c=a.shapePath.shapePrimitives;for(let u=0;u<c.length;u++){const h=c[u].shape;if(!l||!h)continue;const f=c[u].transform,d=f?f.applyInverse(e,q1):e;if(i.action==="fill")s=h.contains(d.x,d.y);else{const g=l;s=h.strokeContains(d.x,d.y,g.width,g.alignment)}const m=o.hole;if(m){const g=m.shapePath?.shapePrimitives;if(g)for(let A=0;A<g.length;A++)g[A].shape.contains(d.x,d.y)&&(s=!1)}if(s)return!0}}return s}unload(){this.emit("unload",this);for(const e in this._gpuData)this._gpuData[e]?.destroy();this._gpuData=Object.create(null)}destroy(e=!1){if(this.destroyed)return;if(this.destroyed=!0,this._stateStack.length=0,this._transform=null,this.unload(),this.emit("destroy",this),this.removeAllListeners(),typeof e=="boolean"?e:e?.texture){const s=typeof e=="boolean"?e:e?.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(s)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(s))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};sf.defaultFillStyle={color:16777215,alpha:1,texture:Ae.WHITE,matrix:null,fill:null,textureSpace:"local"};sf.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:Ae.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let hi=sf;var x1=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;class b1{constructor(){this.isBatchable=!1}reset(){this.isBatchable=!1,this.context=null,this.graphicsData&&(this.graphicsData.destroy(),this.graphicsData=null)}destroy(){this.reset()}}class w1{constructor(){this.instructions=new Wd}init(){this.instructions.reset()}destroy(){this.instructions.destroy(),this.instructions=null}}const nf=class Th{constructor(e){this._renderer=e,this._managedContexts=new $l({renderer:e,type:"resource",name:"graphicsContext"})}init(e){Th.defaultOptions.bezierSmoothness=e?.bezierSmoothness??Th.defaultOptions.bezierSmoothness}getContextRenderData(e){return this.getGpuContext(e).graphicsData||this._initContextRenderData(e)}updateGpuContext(e){const r=e._gpuData,s=!!r[this._renderer.uid],n=r[this._renderer.uid]||this._initContext(e);return(e.dirty||!s)&&(s&&n.reset(),n.isBatchable=!1,e.dirty=!1),n}getGpuContext(e){return e._gpuData[this._renderer.uid]||this._initContext(e)}_initContextRenderData(e){const r=new w1,s=this.getGpuContext(e);return s.graphicsData=r,r.init(),r}_initContext(e){const r=new b1;return r.context=e,e._gpuData[this._renderer.uid]=r,this._managedContexts.add(e),r}destroy(){this._managedContexts.destroy(),this._renderer=null}};nf.extension={type:[we.CanvasSystem],name:"graphicsContext"};nf.defaultOptions={bezierSmoothness:.5};let V1=nf;class pb{constructor(e,r){this.state=Kd.for2d(),this.renderer=e,this._adaptor=r,this.renderer.runners.contextChange.add(this),this._managedGraphics=new $l({renderer:e,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(e){return!1}addRenderable(e,r){this._managedGraphics.add(e),this.renderer.renderPipes.batch.break(r),r.add(e)}updateRenderable(e){}execute(e){e.isRenderable&&this._adaptor.execute(this,e)}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null}}pb.extension={type:[we.CanvasPipes],name:"graphics"};function v1(t,e,r){const s=(t>>24&255)/255;e[r++]=(t&255)/255*s,e[r++]=(t>>8&255)/255*s,e[r++]=(t>>16&255)/255*s,e[r++]=s}class _1{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(e=>{Ct.return(e)}),this.batches.length=0}}class mb{constructor(e,r){this.state=Kd.for2d(),this.renderer=e,this._adaptor=r,this.renderer.runners.contextChange.add(this),this._managedGraphics=new $l({renderer:e,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(e){const r=e.context,s=!!e._gpuData,i=this.renderer.graphicsContext.updateGpuContext(r);return!!(i.isBatchable||s!==i.isBatchable)}addRenderable(e,r){const n=this.renderer.graphicsContext.updateGpuContext(e.context);e.didViewUpdate&&this._rebuild(e),n.isBatchable?this._addToBatcher(e,r):(this.renderer.renderPipes.batch.break(r),r.add(e))}updateRenderable(e){const s=this._getGpuDataForRenderable(e).batches;for(let n=0;n<s.length;n++){const i=s[n];i._batcher.updateElement(i)}}execute(e){if(!e.isRenderable)return;const r=this.renderer,s=e.context;if(!r.graphicsContext.getGpuContext(s).batches.length)return;const i=s.customShader||this._adaptor.shader;this.state.blendMode=e.groupBlendMode;const o=i.resources.localUniforms.uniforms;o.uTransformMatrix=e.groupTransform,o.uRound=r._roundPixels|e._roundPixels,v1(e.groupColorAlpha,o.uColor,0),this._adaptor.execute(this,e)}_rebuild(e){const r=this._getGpuDataForRenderable(e),n=this.renderer.graphicsContext.updateGpuContext(e.context);r.destroy(),n.isBatchable&&this._updateBatchesForRenderable(e,r)}_addToBatcher(e,r){const s=this.renderer.renderPipes.batch,n=this._getGpuDataForRenderable(e).batches;for(let i=0;i<n.length;i++){const o=n[i];s.addToBatch(o,r)}}_getGpuDataForRenderable(e){return e._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(e)}_initGpuDataForRenderable(e){const r=new _1;return e._gpuData[this.renderer.uid]=r,this._managedGraphics.add(e),r}_updateBatchesForRenderable(e,r){const s=e.context,i=this.renderer.graphicsContext.getGpuContext(s),o=this.renderer._roundPixels|e._roundPixels;r.batches=i.batches.map(a=>{const l=Ct.get(Zd);return a.copyTo(l),l.renderable=e,l.roundPixels=o,l})}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}mb.extension={type:[we.WebGLPipes,we.WebGPUPipes],name:"graphics"};zt.add(pb);zt.add(mb);zt.add(V1);zt.add(rf);class ll extends _x{constructor(e){e instanceof hi&&(e={context:e});const{context:r,roundPixels:s,...n}=e||{};super({label:"Graphics",...n}),this.renderPipeId="graphics",r?this.context=r:(this.context=this._ownedContext=new hi,this.context.autoGarbageCollect=this.autoGarbageCollect),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=s??!1}set context(e){e!==this._context&&(this._context&&(this._context.off("update",this.onViewUpdate,this),this._context.off("unload",this.unload,this)),this._context=e,this._context.on("update",this.onViewUpdate,this),this._context.on("unload",this.unload,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(e){return this._context.containsPoint(e)}destroy(e){this._ownedContext&&!e?this._ownedContext.destroy(e):(e===!0||e?.context===!0)&&this._context.destroy(e),this._ownedContext=null,this._context=null,super.destroy(e)}_onTouch(e){this._gcLastUsed=e,this._context._gcLastUsed=e}_callContextMethod(e,r){return this.context[e](...r),this}setFillStyle(...e){return this._callContextMethod("setFillStyle",e)}setStrokeStyle(...e){return this._callContextMethod("setStrokeStyle",e)}fill(...e){return this._callContextMethod("fill",e)}stroke(...e){return this._callContextMethod("stroke",e)}texture(...e){return this._callContextMethod("texture",e)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...e){return this._callContextMethod("arc",e)}arcTo(...e){return this._callContextMethod("arcTo",e)}arcToSvg(...e){return this._callContextMethod("arcToSvg",e)}bezierCurveTo(...e){return this._callContextMethod("bezierCurveTo",e)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...e){return this._callContextMethod("ellipse",e)}circle(...e){return this._callContextMethod("circle",e)}path(...e){return this._callContextMethod("path",e)}lineTo(...e){return this._callContextMethod("lineTo",e)}moveTo(...e){return this._callContextMethod("moveTo",e)}quadraticCurveTo(...e){return this._callContextMethod("quadraticCurveTo",e)}rect(...e){return this._callContextMethod("rect",e)}roundRect(...e){return this._callContextMethod("roundRect",e)}poly(...e){return this._callContextMethod("poly",e)}regularPoly(...e){return this._callContextMethod("regularPoly",e)}roundPoly(...e){return this._callContextMethod("roundPoly",e)}roundShape(...e){return this._callContextMethod("roundShape",e)}filletRect(...e){return this._callContextMethod("filletRect",e)}chamferRect(...e){return this._callContextMethod("chamferRect",e)}star(...e){return this._callContextMethod("star",e)}svg(...e){return this._callContextMethod("svg",e)}restore(...e){return this._callContextMethod("restore",e)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...e){return this._callContextMethod("rotate",e)}scaleTransform(...e){return this._callContextMethod("scale",e)}setTransform(...e){return this._callContextMethod("setTransform",e)}transform(...e){return this._callContextMethod("transform",e)}translateTransform(...e){return this._callContextMethod("translate",e)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(e){this._context.fillStyle=e}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(e){this._context.strokeStyle=e}clone(e=!1){return e?new ll(this._context.clone()):(this._ownedContext=null,new ll(this._context))}lineStyle(e,r,s){_e(at,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const n={};return e&&(n.width=e),r&&(n.color=r),s&&(n.alpha=s),this.context.strokeStyle=n,this}beginFill(e,r){_e(at,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const s={};return e!==void 0&&(s.color=e),r!==void 0&&(s.alpha=r),this.context.fillStyle=s,this}endFill(){_e(at,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const e=this.context.strokeStyle;return(e.width!==hi.defaultStrokeStyle.width||e.color!==hi.defaultStrokeStyle.color||e.alpha!==hi.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...e){return _e(at,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",e)}drawEllipse(...e){return _e(at,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",e)}drawPolygon(...e){return _e(at,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",e)}drawRect(...e){return _e(at,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",e)}drawRoundedRect(...e){return _e(at,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",e)}drawStar(...e){return _e(at,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",e)}}class Hl extends Ae{static create(e){const{dynamic:r,...s}=e;return new Hl({source:new Xt(s),dynamic:r??!1})}resize(e,r,s){return this.source.resize(e,r,s),this}}zt.add(jS,OS);const S$=["yellow","cyan","green","magenta","white"],Eo=25,k$=1e3/Eo,Wn={amigaHiResPal:{name:"Amiga Hi-Res PAL",size:{x:640,y:512}},classicMac:{name:"Classic Mac",size:{x:512,y:384}},amigaLowResPal:{name:"Amiga Lo-Res PAL",size:{x:320,y:256}},zxSpectrum:{name:"ZX Spectrum",size:{x:256,y:192}},handheld:{name:"Handheld",size:{x:256,y:141}}},S1=Object.keys(Wn),k1={red:new be("#f00"),green:new be("#0f0"),blue:new be("#00f"),cyan:new be("#0ff"),magenta:new be("#f0f"),yellow:new be("#ff0"),black:new be("#000"),white:new be("#fff")},C1={red:new be("#B00"),green:new be("#0B0"),blue:new be("#00B"),cyan:new be("#0BB"),magenta:new be("#B0B"),yellow:new be("#BB0"),black:new be("#000"),white:new be("#BBB")};function C$(t,e){const{hue:r,shade:s}=typeof t=="object"?t:{hue:t,shade:e??"basic"};return(s==="dimmed"?C1:k1)[r]}const La=()=>yt()==="mobile"||yt()==="tablet",yt=()=>{if(typeof globalThis.window>"u")return"server";const t=Wt().get("device");if(t!==null)return t;const e=navigator.userAgent;return navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1||/iPad|Tablet|Android(?!.*Mobi)/i.test(e)?"tablet":/Mobi|Android|iPhone|iPod/i.test(e)?"mobile":"desktop"},mn=[],gb=new Set,of=new Map;gb.add=()=>{throw new Error("emptySet.add")};gb.clear=()=>{throw new Error("emptySet.clear")};of.set=()=>{throw new Error("emptyMap.set")};of.clear=()=>{throw new Error("emptyMap.clear")};of.delete=()=>{throw new Error("emptyMap.delete")};const me=Object.freeze({}),cl=(t,e)=>e.split(".").reduce((r,s)=>r[s],t),E1=(t,e,r)=>{const s=e.split(".");let n=t;for(let i=0;i<s.length-1;i++){const o=s[i];n=n[o]}n[s[s.length-1]]=r},fa=(t,e)=>{const r=t.indexOf(e);return t[(r+1)%t.length]},eo=(t,...e)=>{const r={};for(const s of e)r[s]=t[s];return r},E$=(t,...e)=>{const r={...t};for(const s of e)delete r[s];return r},es={inputAssignment:Vn.Default.inputAssignment,infiniteLivesPoke:!1,infiniteDoughnutsPoke:!1,displaySettings:{showBoundingBoxes:"none",showShadowMasks:!1,crtFilter:!1,uncolourised:!1,emulatedResolution:yt()==="mobile"?"handheld":"zxSpectrum"},gameSpeed:1.2,showFps:!1,onScreenControls:yt()==="mobile"||yt()==="tablet",inputDirectionMode:"8-way",directionsRelativeTo:"mixed",soundSettings:{mute:!1,noRoomEntryTunes:!0,noFootsteps:!1}},Ab=["world","screen","mixed"],T1={displaySettings:{},soundSettings:navigator.webdriver?{mute:!0}:{}};var uu,Tg;function P1(){if(Tg)return uu;Tg=1;function t(s){if(Array.isArray(s))return!0;var n=s.length;return typeof n=="number"&&n>-1?n?0 in s&&n-1 in s:!0:!1}function e(s){var n=typeof s;return n==="object"?s===null?"null":t(s)?"array":s.constructor===Object?"pure-object":"object":n}function r(s,n){if(s===n||s!==s&&n!==n)return!0;var i=e(s),o=e(n);if(i!==o)return!1;if(i==="pure-object"){if(s===n)return!0;var a=Object.keys(s),l=Object.keys(n).length;if(a.length!==l)return!1;for(var c=0,u=a.length;c<u;c++){var h=a[c];if(!n.hasOwnProperty(a[c]))return!1;var f=s[h],d=n[h];if(f===s||d===n||f===n||d===s)return f===d;if(!r(f,d))return!1}return!0}else if(i==="array"){if(s.length===n.length)for(var m=0;m<s.length;m++){var g=s[m],A=n[m];if(g===s||A===n||g===n||A===s)return g===A;if(!r(g,A))return!1}else return!1;return!0}else if(i==="object"){if(s.valueOf!==Object.prototype.valueOf()&&n.valueOf!==Object.prototype.valueOf())return s.valueOf()===n.valueOf();if(s.toString!==Object.prototype.toString()&&n.toString!==Object.prototype.toString())return s.toString()===n.toString()}return!1}return uu=r,uu}var R1=P1();const M1=Xe(R1),af=oq.withTypes(),X=aq.withTypes();Ad.withTypes();const lf=t=>()=>X(t);var yb=(t=>(t.uninitialized="uninitialized",t.pending="pending",t.fulfilled="fulfilled",t.rejected="rejected",t))(yb||{});function Pg(t){return{status:t,isUninitialized:t==="uninitialized",isLoading:t==="pending",isSuccess:t==="fulfilled",isError:t==="rejected"}}var Rg=Jr;function qb(t,e){if(t===e||!(Rg(t)&&Rg(e)||Array.isArray(t)&&Array.isArray(e)))return e;const r=Object.keys(e),s=Object.keys(t);let n=r.length===s.length;const i=Array.isArray(e)?[]:{};for(const o of r)i[o]=qb(t[o],e[o]),n&&(n=t[o]===i[o]);return n?t:i}function gn(t){let e=0;for(const r in t)e++;return e}var Mg=t=>[].concat(...t);function I1(t){return new RegExp("(^|:)//").test(t)}function j1(){return typeof document>"u"?!0:document.visibilityState!=="hidden"}function ul(t){return t!=null}function O1(){return typeof navigator>"u"||navigator.onLine===void 0?!0:navigator.onLine}var N1=t=>t.replace(/\/$/,""),B1=t=>t.replace(/^\//,"");function D1(t,e){if(!t)return e;if(!e)return t;if(I1(e))return e;const r=t.endsWith("/")||!e.startsWith("?")?"/":"";return t=N1(t),e=B1(e),`${t}${r}${e}`}function z1(t,e,r){return t.has(e)?t.get(e):t.set(e,r).get(e)}var Ig=(...t)=>fetch(...t),F1=t=>t.status>=200&&t.status<=299,L1=t=>/ion\/(vnd\.api\+)?json/.test(t.get("content-type")||"");function jg(t){if(!Jr(t))return t;const e={...t};for(const[r,s]of Object.entries(e))s===void 0&&delete e[r];return e}function U1({baseUrl:t,prepareHeaders:e=h=>h,fetchFn:r=Ig,paramsSerializer:s,isJsonContentType:n=L1,jsonContentType:i="application/json",jsonReplacer:o,timeout:a,responseHandler:l,validateStatus:c,...u}={}){return typeof fetch>"u"&&r===Ig&&console.warn("Warning: `fetch` is not available. Please supply a custom `fetchFn` property to use `fetchBaseQuery` on SSR environments."),async(f,d,m)=>{const{getState:g,extra:A,endpoint:y,forced:b,type:q}=d;let x,{url:V,headers:_=new Headers(u.headers),params:w=void 0,responseHandler:S=l??"json",validateStatus:k=c??F1,timeout:C=a,...E}=typeof f=="string"?{url:f}:f,T,R=d.signal;C&&(T=new AbortController,d.signal.addEventListener("abort",T.abort),R=T.signal);let M={...u,signal:R,...E};_=new Headers(jg(_)),M.headers=await e(_,{getState:g,arg:f,extra:A,endpoint:y,forced:b,type:q,extraOptions:m})||_;const D=J=>typeof J=="object"&&(Jr(J)||Array.isArray(J)||typeof J.toJSON=="function");if(!M.headers.has("content-type")&&D(M.body)&&M.headers.set("content-type",i),D(M.body)&&n(M.headers)&&(M.body=JSON.stringify(M.body,o)),w){const J=~V.indexOf("?")?"&":"?",Z=s?s(w):new URLSearchParams(jg(w));V+=J+Z}V=D1(t,V);const P=new Request(V,M);x={request:new Request(V,M)};let B,F=!1,Q=T&&setTimeout(()=>{F=!0,T.abort()},C);try{B=await r(P)}catch(J){return{error:{status:F?"TIMEOUT_ERROR":"FETCH_ERROR",error:String(J)},meta:x}}finally{Q&&clearTimeout(Q),T?.signal.removeEventListener("abort",T.abort)}const he=B.clone();x.response=he;let ie,se="";try{let J;if(await Promise.all([h(B,S).then(Z=>ie=Z,Z=>J=Z),he.text().then(Z=>se=Z,()=>{})]),J)throw J}catch(J){return{error:{status:"PARSING_ERROR",originalStatus:B.status,data:se,error:String(J)},meta:x}}return k(B,ie)?{data:ie,meta:x}:{error:{status:B.status,data:ie},meta:x}};async function h(f,d){if(typeof d=="function")return d(f);if(d==="content-type"&&(d=n(f.headers)?"json":"text"),d==="json"){const m=await f.text();return m.length?JSON.parse(m):null}return f.text()}}var Og=class{constructor(t,e=void 0){this.value=t,this.meta=e}},cf=At("__rtkq/focused"),xb=At("__rtkq/unfocused"),uf=At("__rtkq/online"),bb=At("__rtkq/offline");function hf(t){return t.type==="query"}function $1(t){return t.type==="mutation"}function df(t){return t.type==="infinitequery"}function ff(t,e,r,s,n,i){return G1(t)?t(e,r,s,n).filter(ul).map(Ph).map(i):Array.isArray(t)?t.map(Ph).map(i):[]}function G1(t){return typeof t=="function"}function Ph(t){return typeof t=="string"?{type:t}:t}function H1(t,e){return t.catch(e)}var to=Symbol("forceQueryFn"),Rh=t=>typeof t[to]=="function";function W1({serializeQueryArgs:t,queryThunk:e,infiniteQueryThunk:r,mutationThunk:s,api:n,context:i}){const o=new Map,a=new Map,{unsubscribeQueryResult:l,removeMutationResult:c,updateSubscriptionOptions:u}=n.internalActions;return{buildInitiateQuery:A,buildInitiateInfiniteQuery:y,buildInitiateMutation:b,getRunningQueryThunk:h,getRunningMutationThunk:f,getRunningQueriesThunk:d,getRunningMutationsThunk:m};function h(q,x){return V=>{const _=i.endpointDefinitions[q],w=t({queryArgs:x,endpointDefinition:_,endpointName:q});return o.get(V)?.[w]}}function f(q,x){return V=>a.get(V)?.[x]}function d(){return q=>Object.values(o.get(q)||{}).filter(ul)}function m(){return q=>Object.values(a.get(q)||{}).filter(ul)}function g(q,x){const V=(_,{subscribe:w=!0,forceRefetch:S,subscriptionOptions:k,[to]:C,...E}={})=>(T,R)=>{const M=t({queryArgs:_,endpointDefinition:x,endpointName:q});let D;const P={...E,type:"query",subscribe:w,forceRefetch:S,subscriptionOptions:k,endpointName:q,originalArgs:_,queryCacheKey:M,[to]:C};if(hf(x))D=e(P);else{const{direction:de,initialPageParam:Fe}=E;D=r({...P,direction:de,initialPageParam:Fe})}const I=n.endpoints[q].select(_),B=T(D),F=I(R()),{requestId:Q,abort:he}=B,ie=F.requestId!==Q,se=o.get(T)?.[M],J=()=>I(R()),Z=Object.assign(C?B.then(J):ie&&!se?Promise.resolve(F):Promise.all([se,B]).then(J),{arg:_,requestId:Q,subscriptionOptions:k,queryCacheKey:M,abort:he,async unwrap(){const de=await Z;if(de.isError)throw de.error;return de.data},refetch:()=>T(V(_,{subscribe:!1,forceRefetch:!0})),unsubscribe(){w&&T(l({queryCacheKey:M,requestId:Q}))},updateSubscriptionOptions(de){Z.subscriptionOptions=de,T(u({endpointName:q,requestId:Q,queryCacheKey:M,options:de}))}});if(!se&&!ie&&!C){const de=z1(o,T,{});de[M]=Z,Z.then(()=>{delete de[M],gn(de)||o.delete(T)})}return Z};return V}function A(q,x){return g(q,x)}function y(q,x){return g(q,x)}function b(q){return(x,{track:V=!0,fixedCacheKey:_}={})=>(w,S)=>{const k=s({type:"mutation",endpointName:q,originalArgs:x,track:V,fixedCacheKey:_}),C=w(k),{requestId:E,abort:T,unwrap:R}=C,M=H1(C.unwrap().then(B=>({data:B})),B=>({error:B})),D=()=>{w(c({requestId:E,fixedCacheKey:_}))},P=Object.assign(M,{arg:C.arg,requestId:E,abort:T,unwrap:R,reset:D}),I=a.get(w)||{};return a.set(w,I),I[E]=P,P.then(()=>{delete I[E],gn(I)||a.delete(w)}),_&&(I[_]=P,P.then(()=>{I[_]===P&&(delete I[_],gn(I)||a.delete(w))})),P}}}function Y1(t){return t}var pa=(t={})=>({...t,[Il]:!0});function K1({reducerPath:t,baseQuery:e,context:{endpointDefinitions:r},serializeQueryArgs:s,api:n,assertTagType:i,selectors:o}){const a=(S,k,C,E)=>(T,R)=>{const M=r[S],D=s({queryArgs:k,endpointDefinition:M,endpointName:S});if(T(n.internalActions.queryResultPatched({queryCacheKey:D,patches:C})),!E)return;const P=n.endpoints[S].select(k)(R()),I=ff(M.providesTags,P.data,void 0,k,{},i);T(n.internalActions.updateProvidedBy({queryCacheKey:D,providedTags:I}))};function l(S,k,C=0){const E=[k,...S];return C&&E.length>C?E.slice(0,-1):E}function c(S,k,C=0){const E=[...S,k];return C&&E.length>C?E.slice(1):E}const u=(S,k,C,E=!0)=>(T,R)=>{const D=n.endpoints[S].select(k)(R()),P={patches:[],inversePatches:[],undo:()=>T(n.util.patchQueryData(S,k,P.inversePatches,E))};if(D.status==="uninitialized")return P;let I;if("data"in D)if(sr(D.data)){const[B,F,Q]=wq(D.data,C);P.patches.push(...F),P.inversePatches.push(...Q),I=B}else I=C(D.data),P.patches.push({op:"replace",path:[],value:I}),P.inversePatches.push({op:"replace",path:[],value:D.data});return P.patches.length===0||T(n.util.patchQueryData(S,k,P.patches,E)),P},h=(S,k,C)=>E=>E(n.endpoints[S].initiate(k,{subscribe:!1,forceRefetch:!0,[to]:()=>({data:C})})),f=(S,k)=>S.query&&S[k]?S[k]:Y1,d=async(S,{signal:k,abort:C,rejectWithValue:E,fulfillWithValue:T,dispatch:R,getState:M,extra:D})=>{const P=r[S.endpointName];try{let I=f(P,"transformResponse");const B={signal:k,abort:C,dispatch:R,getState:M,extra:D,endpoint:S.endpointName,type:S.type,forced:S.type==="query"?m(S,M()):void 0,queryCacheKey:S.type==="query"?S.queryCacheKey:void 0},F=S.type==="query"?S[to]:void 0;let Q;const he=async(se,J,Z,de)=>{if(J==null&&se.pages.length)return Promise.resolve({data:se});const Fe={queryArg:S.originalArgs,pageParam:J},ar=await ie(Fe),wt=de?l:c;return{data:{pages:wt(se.pages,ar.data,Z),pageParams:wt(se.pageParams,J,Z)}}};async function ie(se){let J;const{extraOptions:Z}=P;if(F?J=F():P.query?J=await e(P.query(se),B,Z):J=await P.queryFn(se,B,Z,Fe=>e(Fe,B,Z)),typeof process<"u",J.error)throw new Og(J.error,J.meta);const de=await I(J.data,J.meta,se);return{...J,data:de}}if(S.type==="query"&&"infiniteQueryOptions"in P){const{infiniteQueryOptions:se}=P,{maxPages:J=1/0}=se;let Z;const de={pages:[],pageParams:[]},Fe=o.selectQueryEntry(M(),S.queryCacheKey)?.data,wt=m(S,M())&&!S.direction||!Fe?de:Fe;if("direction"in S&&S.direction&&wt.pages.length){const Jt=S.direction==="backward",Et=(Jt?wb:Mh)(se,wt);Z=await he(wt,Et,J,Jt)}else{const{initialPageParam:Jt=se.initialPageParam}=S,xr=Fe?.pageParams??[],Et=xr[0]??Jt,Vt=xr.length;Z=await he(wt,Et,J),F&&(Z={data:Z.data.pages[0]});for(let lr=1;lr<Vt;lr++){const br=Mh(se,Z.data);Z=await he(Z.data,br,J)}}Q=Z}else Q=await ie(S.originalArgs);return T(Q.data,pa({fulfilledTimeStamp:Date.now(),baseQueryMeta:Q.meta}))}catch(I){let B=I;if(B instanceof Og){let F=f(P,"transformErrorResponse");try{return E(await F(B.value,B.meta,S.originalArgs),pa({baseQueryMeta:B.meta}))}catch(Q){B=Q}}throw console.error(B),B}};function m(S,k){const C=o.selectQueryEntry(k,S.queryCacheKey),E=o.selectConfig(k).refetchOnMountOrArgChange,T=C?.fulfilledTimeStamp,R=S.forceRefetch??(S.subscribe&&E);return R?R===!0||(Number(new Date)-Number(T))/1e3>=R:!1}const g=()=>Ep(`${t}/executeQuery`,d,{getPendingMeta({arg:k}){const C=r[k.endpointName];return pa({startedTimeStamp:Date.now(),...df(C)?{direction:k.direction}:{}})},condition(k,{getState:C}){const E=C(),T=o.selectQueryEntry(E,k.queryCacheKey),R=T?.fulfilledTimeStamp,M=k.originalArgs,D=T?.originalArgs,P=r[k.endpointName],I=k.direction;return Rh(k)?!0:T?.status==="pending"?!1:m(k,E)||hf(P)&&P?.forceRefetch?.({currentArg:M,previousArg:D,endpointState:T,state:E})?!0:!(R&&!I)},dispatchConditionRejection:!0}),A=g(),y=g(),b=Ep(`${t}/executeMutation`,d,{getPendingMeta(){return pa({startedTimeStamp:Date.now()})}}),q=S=>"force"in S,x=S=>"ifOlderThan"in S,V=(S,k,C)=>(E,T)=>{const R=q(C)&&C.force,M=x(C)&&C.ifOlderThan,D=(I=!0)=>{const B={forceRefetch:I,isPrefetch:!0};return n.endpoints[S].initiate(k,B)},P=n.endpoints[S].select(k)(T());if(R)E(D());else if(M){const I=P?.fulfilledTimeStamp;if(!I){E(D());return}(Number(new Date)-Number(new Date(I)))/1e3>=M&&E(D())}else E(D(!1))};function _(S){return k=>k?.meta?.arg?.endpointName===S}function w(S,k){return{matchPending:Mi(kd(S),_(k)),matchFulfilled:Mi(Zr(S),_(k)),matchRejected:Mi(bn(S),_(k))}}return{queryThunk:A,mutationThunk:b,infiniteQueryThunk:y,prefetch:V,updateQueryData:u,upsertQueryData:h,patchQueryData:a,buildMatchThunkActions:w}}function Mh(t,{pages:e,pageParams:r}){const s=e.length-1;return t.getNextPageParam(e[s],e,r[s],r)}function wb(t,{pages:e,pageParams:r}){return t.getPreviousPageParam?.(e[0],e,r[0],r)}function Vb(t,e,r,s){return ff(r[t.meta.arg.endpointName][e],Zr(t)?t.payload:void 0,Ol(t)?t.payload:void 0,t.meta.arg.originalArgs,"baseQueryMeta"in t.meta?t.meta.baseQueryMeta:void 0,s)}function ma(t,e,r){const s=t[e];s&&r(s)}function ro(t){return("arg"in t?t.arg.fixedCacheKey:t.fixedCacheKey)??t.requestId}function Ng(t,e,r){const s=t[ro(e)];s&&r(s)}var di={};function Q1({reducerPath:t,queryThunk:e,mutationThunk:r,serializeQueryArgs:s,context:{endpointDefinitions:n,apiUid:i,extractRehydrationInfo:o,hasRehydrationInfo:a},assertTagType:l,config:c}){const u=At(`${t}/resetApiState`);function h(w,S,k,C){w[S.queryCacheKey]??={status:"uninitialized",endpointName:S.endpointName},ma(w,S.queryCacheKey,E=>{E.status="pending",E.requestId=k&&E.requestId?E.requestId:C.requestId,S.originalArgs!==void 0&&(E.originalArgs=S.originalArgs),E.startedTimeStamp=C.startedTimeStamp;const T=n[C.arg.endpointName];df(T)&&"direction"in S&&(E.direction=S.direction)})}function f(w,S,k,C){ma(w,S.arg.queryCacheKey,E=>{if(E.requestId!==S.requestId&&!C)return;const{merge:T}=n[S.arg.endpointName];if(E.status="fulfilled",T)if(E.data!==void 0){const{fulfilledTimeStamp:R,arg:M,baseQueryMeta:D,requestId:P}=S;let I=Dn(E.data,B=>T(B,k,{arg:M.originalArgs,baseQueryMeta:D,fulfilledTimeStamp:R,requestId:P}));E.data=I}else E.data=k;else E.data=n[S.arg.endpointName].structuralSharing??!0?qb(mr(E.data)?zv(E.data):E.data,k):k;delete E.error,E.fulfilledTimeStamp=S.fulfilledTimeStamp})}const d=Sr({name:`${t}/queries`,initialState:di,reducers:{removeQueryResult:{reducer(w,{payload:{queryCacheKey:S}}){delete w[S]},prepare:ti()},cacheEntriesUpserted:{reducer(w,S){for(const k of S.payload){const{queryDescription:C,value:E}=k;h(w,C,!0,{arg:C,requestId:S.meta.requestId,startedTimeStamp:S.meta.timestamp}),f(w,{arg:C,requestId:S.meta.requestId,fulfilledTimeStamp:S.meta.timestamp,baseQueryMeta:{}},E,!0)}},prepare:w=>({payload:w.map(C=>{const{endpointName:E,arg:T,value:R}=C,M=n[E];return{queryDescription:{type:"query",endpointName:E,originalArgs:C.arg,queryCacheKey:s({queryArgs:T,endpointDefinition:M,endpointName:E})},value:R}}),meta:{[Il]:!0,requestId:Vo(),timestamp:Date.now()}})},queryResultPatched:{reducer(w,{payload:{queryCacheKey:S,patches:k}}){ma(w,S,C=>{C.data=wp(C.data,k.concat())})},prepare:ti()}},extraReducers(w){w.addCase(e.pending,(S,{meta:k,meta:{arg:C}})=>{const E=Rh(C);h(S,C,E,k)}).addCase(e.fulfilled,(S,{meta:k,payload:C})=>{const E=Rh(k.arg);f(S,k,C,E)}).addCase(e.rejected,(S,{meta:{condition:k,arg:C,requestId:E},error:T,payload:R})=>{ma(S,C.queryCacheKey,M=>{if(!k){if(M.requestId!==E)return;M.status="rejected",M.error=R??T}})}).addMatcher(a,(S,k)=>{const{queries:C}=o(k);for(const[E,T]of Object.entries(C))(T?.status==="fulfilled"||T?.status==="rejected")&&(S[E]=T)})}}),m=Sr({name:`${t}/mutations`,initialState:di,reducers:{removeMutationResult:{reducer(w,{payload:S}){const k=ro(S);k in w&&delete w[k]},prepare:ti()}},extraReducers(w){w.addCase(r.pending,(S,{meta:k,meta:{requestId:C,arg:E,startedTimeStamp:T}})=>{E.track&&(S[ro(k)]={requestId:C,status:"pending",endpointName:E.endpointName,startedTimeStamp:T})}).addCase(r.fulfilled,(S,{payload:k,meta:C})=>{C.arg.track&&Ng(S,C,E=>{E.requestId===C.requestId&&(E.status="fulfilled",E.data=k,E.fulfilledTimeStamp=C.fulfilledTimeStamp)})}).addCase(r.rejected,(S,{payload:k,error:C,meta:E})=>{E.arg.track&&Ng(S,E,T=>{T.requestId===E.requestId&&(T.status="rejected",T.error=k??C)})}).addMatcher(a,(S,k)=>{const{mutations:C}=o(k);for(const[E,T]of Object.entries(C))(T?.status==="fulfilled"||T?.status==="rejected")&&E!==T?.requestId&&(S[E]=T)})}}),g=Sr({name:`${t}/invalidation`,initialState:di,reducers:{updateProvidedBy:{reducer(w,S){const{queryCacheKey:k,providedTags:C}=S.payload;for(const E of Object.values(w))for(const T of Object.values(E)){const R=T.indexOf(k);R!==-1&&T.splice(R,1)}for(const{type:E,id:T}of C){const R=(w[E]??={})[T||"__internal_without_id"]??=[];R.includes(k)||R.push(k)}},prepare:ti()}},extraReducers(w){w.addCase(d.actions.removeQueryResult,(S,{payload:{queryCacheKey:k}})=>{for(const C of Object.values(S))for(const E of Object.values(C)){const T=E.indexOf(k);T!==-1&&E.splice(T,1)}}).addMatcher(a,(S,k)=>{const{provided:C}=o(k);for(const[E,T]of Object.entries(C))for(const[R,M]of Object.entries(T)){const D=(S[E]??={})[R||"__internal_without_id"]??=[];for(const P of M)D.includes(P)||D.push(P)}}).addMatcher(gr(Zr(e),Ol(e)),(S,k)=>{A(S,k)}).addMatcher(d.actions.cacheEntriesUpserted.match,(S,k)=>{for(const{queryDescription:C,value:E}of k.payload)A(S,{type:"UNKNOWN",payload:E,meta:{requestStatus:"fulfilled",requestId:"UNKNOWN",arg:C}})})}});function A(w,S){const k=Vb(S,"providesTags",n,l),{queryCacheKey:C}=S.meta.arg;g.caseReducers.updateProvidedBy(w,g.actions.updateProvidedBy({queryCacheKey:C,providedTags:k}))}const y=Sr({name:`${t}/subscriptions`,initialState:di,reducers:{updateSubscriptionOptions(w,S){},unsubscribeQueryResult(w,S){},internal_getRTKQSubscriptions(){}}}),b=Sr({name:`${t}/internalSubscriptions`,initialState:di,reducers:{subscriptionsUpdated:{reducer(w,S){return wp(w,S.payload)},prepare:ti()}}}),q=Sr({name:`${t}/config`,initialState:{online:O1(),focused:j1(),middlewareRegistered:!1,...c},reducers:{middlewareRegistered(w,{payload:S}){w.middlewareRegistered=w.middlewareRegistered==="conflict"||i!==S?"conflict":!0}},extraReducers:w=>{w.addCase(uf,S=>{S.online=!0}).addCase(bb,S=>{S.online=!1}).addCase(cf,S=>{S.focused=!0}).addCase(xb,S=>{S.focused=!1}).addMatcher(a,S=>({...S}))}}),x=wd({queries:d.reducer,mutations:m.reducer,provided:g.reducer,subscriptions:b.reducer,config:q.reducer}),V=(w,S)=>x(u.match(S)?void 0:w,S),_={...q.actions,...d.actions,...y.actions,...b.actions,...m.actions,...g.actions,resetApiState:u};return{reducer:V,actions:_}}var kr=Symbol.for("RTKQ/skipToken"),vb={status:"uninitialized"},Bg=Dn(vb,()=>{}),Dg=Dn(vb,()=>{});function X1({serializeQueryArgs:t,reducerPath:e,createSelector:r}){const s=q=>Bg,n=q=>Dg;return{buildQuerySelector:f,buildInfiniteQuerySelector:d,buildMutationSelector:m,selectInvalidatedBy:g,selectCachedArgsForQuery:A,selectApiState:o,selectQueries:a,selectMutations:c,selectQueryEntry:l,selectConfig:u};function i(q){return{...q,...Pg(q.status)}}function o(q){return q[e]}function a(q){return o(q)?.queries}function l(q,x){return a(q)?.[x]}function c(q){return o(q)?.mutations}function u(q){return o(q)?.config}function h(q,x,V){return _=>{if(_===kr)return r(s,V);const w=t({queryArgs:_,endpointDefinition:x,endpointName:q});return r(k=>l(k,w)??Bg,V)}}function f(q,x){return h(q,x,i)}function d(q,x){const{infiniteQueryOptions:V}=x;function _(w){const S={...w,...Pg(w.status)},{isLoading:k,isError:C,direction:E}=S,T=E==="forward",R=E==="backward";return{...S,hasNextPage:y(V,S.data),hasPreviousPage:b(V,S.data),isFetchingNextPage:k&&T,isFetchingPreviousPage:k&&R,isFetchNextPageError:C&&T,isFetchPreviousPageError:C&&R}}return h(q,x,_)}function m(){return q=>{let x;return typeof q=="object"?x=ro(q)??kr:x=q,r(x===kr?n:w=>o(w)?.mutations?.[x]??Dg,i)}}function g(q,x){const V=q[e],_=new Set;for(const w of x.filter(ul).map(Ph)){const S=V.provided[w.type];if(!S)continue;let k=(w.id!==void 0?S[w.id]:Mg(Object.values(S)))??[];for(const C of k)_.add(C)}return Mg(Array.from(_.values()).map(w=>{const S=V.queries[w];return S?[{queryCacheKey:w,endpointName:S.endpointName,originalArgs:S.originalArgs}]:[]}))}function A(q,x){return Object.values(a(q)).filter(V=>V?.endpointName===x&&V.status!=="uninitialized").map(V=>V.originalArgs)}function y(q,x){return x?Mh(q,x)!=null:!1}function b(q,x){return!x||!q.getPreviousPageParam?!1:wb(q,x)!=null}}var zg=WeakMap?new WeakMap:void 0,Ih=({endpointName:t,queryArgs:e})=>{let r="";const s=zg?.get(e);if(typeof s=="string")r=s;else{const n=JSON.stringify(e,(i,o)=>(o=typeof o=="bigint"?{$bigint:o.toString()}:o,o=Jr(o)?Object.keys(o).sort().reduce((a,l)=>(a[l]=o[l],a),{}):o,o));Jr(e)&&zg?.set(e,n),r=n}return`${t}(${r})`};function _b(...t){return function(r){const s=tl(c=>r.extractRehydrationInfo?.(c,{reducerPath:r.reducerPath??"api"})),n={reducerPath:"api",keepUnusedDataFor:60,refetchOnMountOrArgChange:!1,refetchOnFocus:!1,refetchOnReconnect:!1,invalidationBehavior:"delayed",...r,extractRehydrationInfo:s,serializeQueryArgs(c){let u=Ih;if("serializeQueryArgs"in c.endpointDefinition){const h=c.endpointDefinition.serializeQueryArgs;u=f=>{const d=h(f);return typeof d=="string"?d:Ih({...f,queryArgs:d})}}else r.serializeQueryArgs&&(u=r.serializeQueryArgs);return u(c)},tagTypes:[...r.tagTypes||[]]},i={endpointDefinitions:{},batch(c){c()},apiUid:Vo(),extractRehydrationInfo:s,hasRehydrationInfo:tl(c=>s(c)!=null)},o={injectEndpoints:l,enhanceEndpoints({addTagTypes:c,endpoints:u}){if(c)for(const h of c)n.tagTypes.includes(h)||n.tagTypes.push(h);if(u)for(const[h,f]of Object.entries(u))typeof f=="function"?f(i.endpointDefinitions[h]):Object.assign(i.endpointDefinitions[h]||{},f);return o}},a=t.map(c=>c.init(o,n,i));function l(c){const u=c.endpoints({query:h=>({...h,type:"query"}),mutation:h=>({...h,type:"mutation"}),infiniteQuery:h=>({...h,type:"infinitequery"})});for(const[h,f]of Object.entries(u)){if(c.overrideExisting!==!0&&h in i.endpointDefinitions){if(c.overrideExisting==="throw")throw new Error(Ke(39));continue}i.endpointDefinitions[h]=f;for(const d of a)d.injectEndpoint(h,f)}return o}return o.injectEndpoints({endpoints:r.endpoints})}}function J1(){return function(){throw new Error(Ke(33))}}function vr(t,...e){return Object.assign(t,...e)}var Z1=({api:t,queryThunk:e,internalState:r})=>{const s=`${t.reducerPath}/subscriptions`;let n=null,i=null;const{updateSubscriptionOptions:o,unsubscribeQueryResult:a}=t.internalActions,l=(d,m)=>{if(o.match(m)){const{queryCacheKey:A,requestId:y,options:b}=m.payload;return d?.[A]?.[y]&&(d[A][y]=b),!0}if(a.match(m)){const{queryCacheKey:A,requestId:y}=m.payload;return d[A]&&delete d[A][y],!0}if(t.internalActions.removeQueryResult.match(m))return delete d[m.payload.queryCacheKey],!0;if(e.pending.match(m)){const{meta:{arg:A,requestId:y}}=m,b=d[A.queryCacheKey]??={};return b[`${y}_running`]={},A.subscribe&&(b[y]=A.subscriptionOptions??b[y]??{}),!0}let g=!1;if(e.fulfilled.match(m)||e.rejected.match(m)){const A=d[m.meta.arg.queryCacheKey]||{},y=`${m.meta.requestId}_running`;g||=!!A[y],delete A[y]}if(e.rejected.match(m)){const{meta:{condition:A,arg:y,requestId:b}}=m;if(A&&y.subscribe){const q=d[y.queryCacheKey]??={};q[b]=y.subscriptionOptions??q[b]??{},g=!0}}return g},c=()=>r.currentSubscriptions,f={getSubscriptions:c,getSubscriptionCount:d=>{const g=c()[d]??{};return gn(g)},isRequestSubscribed:(d,m)=>!!c()?.[d]?.[m]};return(d,m)=>{if(n||(n=JSON.parse(JSON.stringify(r.currentSubscriptions))),t.util.resetApiState.match(d))return n=r.currentSubscriptions={},i=null,[!0,!1];if(t.internalActions.internal_getRTKQSubscriptions.match(d))return[!1,f];const g=l(r.currentSubscriptions,d);let A=!0;if(g){i||(i=setTimeout(()=>{const q=JSON.parse(JSON.stringify(r.currentSubscriptions)),[,x]=wq(n,()=>q);m.next(t.internalActions.subscriptionsUpdated(x)),n=q,i=null},500));const y=typeof d.type=="string"&&!!d.type.startsWith(s),b=e.rejected.match(d)&&d.meta.condition&&!!d.meta.arg.subscribe;A=!y&&!b}return[A,!1]}};function eT(t){for(const e in t)return!1;return!0}var tT=2147483647/1e3-1,rT=({reducerPath:t,api:e,queryThunk:r,context:s,internalState:n,selectors:{selectQueryEntry:i,selectConfig:o}})=>{const{removeQueryResult:a,unsubscribeQueryResult:l,cacheEntriesUpserted:c}=e.internalActions,u=gr(l.match,r.fulfilled,r.rejected,c.match);function h(A){const y=n.currentSubscriptions[A];return!!y&&!eT(y)}const f={},d=(A,y,b)=>{const q=y.getState(),x=o(q);if(u(A)){let V;if(c.match(A))V=A.payload.map(_=>_.queryDescription.queryCacheKey);else{const{queryCacheKey:_}=l.match(A)?A.payload:A.meta.arg;V=[_]}m(V,y,x)}if(e.util.resetApiState.match(A))for(const[V,_]of Object.entries(f))_&&clearTimeout(_),delete f[V];if(s.hasRehydrationInfo(A)){const{queries:V}=s.extractRehydrationInfo(A);m(Object.keys(V),y,x)}};function m(A,y,b){const q=y.getState();for(const x of A){const V=i(q,x);g(x,V?.endpointName,y,b)}}function g(A,y,b,q){const V=s.endpointDefinitions[y]?.keepUnusedDataFor??q.keepUnusedDataFor;if(V===1/0)return;const _=Math.max(0,Math.min(V,tT));if(!h(A)){const w=f[A];w&&clearTimeout(w),f[A]=setTimeout(()=>{h(A)||b.dispatch(a({queryCacheKey:A})),delete f[A]},_*1e3)}}return d},Fg=new Error("Promise never resolved before cacheEntryRemoved."),sT=({api:t,reducerPath:e,context:r,queryThunk:s,mutationThunk:n,internalState:i,selectors:{selectQueryEntry:o,selectApiState:a}})=>{const l=lh(s),c=lh(n),u=Zr(s,n),h={};function f(y,b,q){const x=h[y];x?.valueResolved&&(x.valueResolved({data:b,meta:q}),delete x.valueResolved)}function d(y){const b=h[y];b&&(delete h[y],b.cacheEntryRemoved())}const m=(y,b,q)=>{const x=g(y);function V(_,w,S,k){const C=o(q,w),E=o(b.getState(),w);!C&&E&&A(_,k,w,b,S)}if(s.pending.match(y))V(y.meta.arg.endpointName,x,y.meta.requestId,y.meta.arg.originalArgs);else if(t.internalActions.cacheEntriesUpserted.match(y))for(const{queryDescription:_,value:w}of y.payload){const{endpointName:S,originalArgs:k,queryCacheKey:C}=_;V(S,C,y.meta.requestId,k),f(C,w,{})}else if(n.pending.match(y))b.getState()[e].mutations[x]&&A(y.meta.arg.endpointName,y.meta.arg.originalArgs,x,b,y.meta.requestId);else if(u(y))f(x,y.payload,y.meta.baseQueryMeta);else if(t.internalActions.removeQueryResult.match(y)||t.internalActions.removeMutationResult.match(y))d(x);else if(t.util.resetApiState.match(y))for(const _ of Object.keys(h))d(_)};function g(y){return l(y)?y.meta.arg.queryCacheKey:c(y)?y.meta.arg.fixedCacheKey??y.meta.requestId:t.internalActions.removeQueryResult.match(y)?y.payload.queryCacheKey:t.internalActions.removeMutationResult.match(y)?ro(y.payload):""}function A(y,b,q,x,V){const _=r.endpointDefinitions[y],w=_?.onCacheEntryAdded;if(!w)return;const S={},k=new Promise(D=>{S.cacheEntryRemoved=D}),C=Promise.race([new Promise(D=>{S.valueResolved=D}),k.then(()=>{throw Fg})]);C.catch(()=>{}),h[q]=S;const E=t.endpoints[y].select(_.type==="query"?b:q),T=x.dispatch((D,P,I)=>I),R={...x,getCacheEntry:()=>E(x.getState()),requestId:V,extra:T,updateCachedData:_.type==="query"?D=>x.dispatch(t.util.updateQueryData(y,b,D)):void 0,cacheDataLoaded:C,cacheEntryRemoved:k},M=w(b,R);Promise.resolve(M).catch(D=>{if(D!==Fg)throw D})}return m},nT=({api:t,context:{apiUid:e},reducerPath:r})=>(s,n)=>{t.util.resetApiState.match(s)&&n.dispatch(t.internalActions.middlewareRegistered(e))},iT=({reducerPath:t,context:e,context:{endpointDefinitions:r},mutationThunk:s,queryThunk:n,api:i,assertTagType:o,refetchQuery:a,internalState:l})=>{const{removeQueryResult:c}=i.internalActions,u=gr(Zr(s),Ol(s)),h=gr(Zr(s,n),bn(s,n));let f=[];const d=(A,y)=>{u(A)?g(Vb(A,"invalidatesTags",r,o),y):h(A)?g([],y):i.util.invalidateTags.match(A)&&g(ff(A.payload,void 0,void 0,void 0,void 0,o),y)};function m(A){const{queries:y,mutations:b}=A;for(const q of[y,b])for(const x in q)if(q[x]?.status==="pending")return!0;return!1}function g(A,y){const b=y.getState(),q=b[t];if(f.push(...A),q.config.invalidationBehavior==="delayed"&&m(q))return;const x=f;if(f=[],x.length===0)return;const V=i.util.selectInvalidatedBy(b,x);e.batch(()=>{const _=Array.from(V.values());for(const{queryCacheKey:w}of _){const S=q.queries[w],k=l.currentSubscriptions[w]??{};S&&(gn(k)===0?y.dispatch(c({queryCacheKey:w})):S.status!=="uninitialized"&&y.dispatch(a(S)))}})}return d},oT=({reducerPath:t,queryThunk:e,api:r,refetchQuery:s,internalState:n})=>{const i={},o=(f,d)=>{(r.internalActions.updateSubscriptionOptions.match(f)||r.internalActions.unsubscribeQueryResult.match(f))&&l(f.payload,d),(e.pending.match(f)||e.rejected.match(f)&&f.meta.condition)&&l(f.meta.arg,d),(e.fulfilled.match(f)||e.rejected.match(f)&&!f.meta.condition)&&a(f.meta.arg,d),r.util.resetApiState.match(f)&&u()};function a({queryCacheKey:f},d){const m=d.getState()[t],g=m.queries[f],A=n.currentSubscriptions[f];if(!g||g.status==="uninitialized")return;const{lowestPollingInterval:y,skipPollingIfUnfocused:b}=h(A);if(!Number.isFinite(y))return;const q=i[f];q?.timeout&&(clearTimeout(q.timeout),q.timeout=void 0);const x=Date.now()+y;i[f]={nextPollTimestamp:x,pollingInterval:y,timeout:setTimeout(()=>{(m.config.focused||!b)&&d.dispatch(s(g)),a({queryCacheKey:f},d)},y)}}function l({queryCacheKey:f},d){const g=d.getState()[t].queries[f],A=n.currentSubscriptions[f];if(!g||g.status==="uninitialized")return;const{lowestPollingInterval:y}=h(A);if(!Number.isFinite(y)){c(f);return}const b=i[f],q=Date.now()+y;(!b||q<b.nextPollTimestamp)&&a({queryCacheKey:f},d)}function c(f){const d=i[f];d?.timeout&&clearTimeout(d.timeout),delete i[f]}function u(){for(const f of Object.keys(i))c(f)}function h(f={}){let d=!1,m=Number.POSITIVE_INFINITY;for(let g in f)f[g].pollingInterval&&(m=Math.min(f[g].pollingInterval,m),d=f[g].skipPollingIfUnfocused||d);return{lowestPollingInterval:m,skipPollingIfUnfocused:d}}return o},aT=({api:t,context:e,queryThunk:r,mutationThunk:s})=>{const n=kd(r,s),i=bn(r,s),o=Zr(r,s),a={};return(c,u)=>{if(n(c)){const{requestId:h,arg:{endpointName:f,originalArgs:d}}=c.meta,m=e.endpointDefinitions[f],g=m?.onQueryStarted;if(g){const A={},y=new Promise((V,_)=>{A.resolve=V,A.reject=_});y.catch(()=>{}),a[h]=A;const b=t.endpoints[f].select(m.type==="query"?d:h),q=u.dispatch((V,_,w)=>w),x={...u,getCacheEntry:()=>b(u.getState()),requestId:h,extra:q,updateCachedData:m.type==="query"?V=>u.dispatch(t.util.updateQueryData(f,d,V)):void 0,queryFulfilled:y};g(d,x)}}else if(o(c)){const{requestId:h,baseQueryMeta:f}=c.meta;a[h]?.resolve({data:c.payload,meta:f}),delete a[h]}else if(i(c)){const{requestId:h,rejectedWithValue:f,baseQueryMeta:d}=c.meta;a[h]?.reject({error:c.payload??c.error,isUnhandledError:!f,meta:d}),delete a[h]}}},lT=({reducerPath:t,context:e,api:r,refetchQuery:s,internalState:n})=>{const{removeQueryResult:i}=r.internalActions,o=(l,c)=>{cf.match(l)&&a(c,"refetchOnFocus"),uf.match(l)&&a(c,"refetchOnReconnect")};function a(l,c){const u=l.getState()[t],h=u.queries,f=n.currentSubscriptions;e.batch(()=>{for(const d of Object.keys(f)){const m=h[d],g=f[d];if(!g||!m)continue;(Object.values(g).some(y=>y[c]===!0)||Object.values(g).every(y=>y[c]===void 0)&&u.config[c])&&(gn(g)===0?l.dispatch(i({queryCacheKey:d})):m.status!=="uninitialized"&&l.dispatch(s(m)))}})}return o};function cT(t){const{reducerPath:e,queryThunk:r,api:s,context:n}=t,{apiUid:i}=n,o={invalidateTags:At(`${e}/invalidateTags`)},a=h=>h.type.startsWith(`${e}/`),l=[nT,rT,iT,oT,sT,aT];return{middleware:h=>{let f=!1;const m={...t,internalState:{currentSubscriptions:{}},refetchQuery:u,isThisApiSliceAction:a},g=l.map(b=>b(m)),A=Z1(m),y=lT(m);return b=>q=>{if(!Vd(q))return b(q);f||(f=!0,h.dispatch(s.internalActions.middlewareRegistered(i)));const x={...h,next:b},V=h.getState(),[_,w]=A(q,x,V);let S;if(_?S=b(q):S=w,h.getState()[e]&&(y(q,x,V),a(q)||n.hasRehydrationInfo(q)))for(const k of g)k(q,x,V);return S}},actions:o};function u(h){return t.api.endpoints[h.endpointName].initiate(h.originalArgs,{subscribe:!1,forceRefetch:!0})}}var Lg=Symbol(),Sb=({createSelector:t=Ml}={})=>({name:Lg,init(e,{baseQuery:r,tagTypes:s,reducerPath:n,serializeQueryArgs:i,keepUnusedDataFor:o,refetchOnMountOrArgChange:a,refetchOnFocus:l,refetchOnReconnect:c,invalidationBehavior:u},h){Qv();const f=ie=>ie;Object.assign(e,{reducerPath:n,endpoints:{},internalActions:{onOnline:uf,onOffline:bb,onFocus:cf,onFocusLost:xb},util:{}});const d=X1({serializeQueryArgs:i,reducerPath:n,createSelector:t}),{selectInvalidatedBy:m,selectCachedArgsForQuery:g,buildQuerySelector:A,buildInfiniteQuerySelector:y,buildMutationSelector:b}=d;vr(e.util,{selectInvalidatedBy:m,selectCachedArgsForQuery:g});const{queryThunk:q,infiniteQueryThunk:x,mutationThunk:V,patchQueryData:_,updateQueryData:w,upsertQueryData:S,prefetch:k,buildMatchThunkActions:C}=K1({baseQuery:r,reducerPath:n,context:h,api:e,serializeQueryArgs:i,assertTagType:f,selectors:d}),{reducer:E,actions:T}=Q1({context:h,queryThunk:q,mutationThunk:V,serializeQueryArgs:i,reducerPath:n,assertTagType:f,config:{refetchOnFocus:l,refetchOnReconnect:c,refetchOnMountOrArgChange:a,keepUnusedDataFor:o,reducerPath:n,invalidationBehavior:u}});vr(e.util,{patchQueryData:_,updateQueryData:w,upsertQueryData:S,prefetch:k,resetApiState:T.resetApiState,upsertQueryEntries:T.cacheEntriesUpserted}),vr(e.internalActions,T);const{middleware:R,actions:M}=cT({reducerPath:n,context:h,queryThunk:q,mutationThunk:V,infiniteQueryThunk:x,api:e,assertTagType:f,selectors:d});vr(e.util,M),vr(e,{reducer:E,middleware:R});const{buildInitiateQuery:D,buildInitiateInfiniteQuery:P,buildInitiateMutation:I,getRunningMutationThunk:B,getRunningMutationsThunk:F,getRunningQueriesThunk:Q,getRunningQueryThunk:he}=W1({queryThunk:q,mutationThunk:V,infiniteQueryThunk:x,api:e,serializeQueryArgs:i,context:h});return vr(e.util,{getRunningMutationThunk:B,getRunningMutationsThunk:F,getRunningQueryThunk:he,getRunningQueriesThunk:Q}),{name:Lg,injectEndpoint(ie,se){const J=e,Z=J.endpoints[ie]??={};hf(se)&&vr(Z,{name:ie,select:A(ie,se),initiate:D(ie,se)},C(q,ie)),$1(se)&&vr(Z,{name:ie,select:b(),initiate:I(ie)},C(V,ie)),df(se)&&vr(Z,{name:ie,select:y(ie,se),initiate:P(ie,se)},C(q,ie))}}}});Sb();function ga(t){return t.replace(t[0],t[0].toUpperCase())}function uT(t){return t.type==="query"}function hT(t){return t.type==="mutation"}function kb(t){return t.type==="infinitequery"}function fi(t,...e){return Object.assign(t,...e)}var hu=Symbol();function Ug(t,e,r,s){const n=v.useMemo(()=>({queryArgs:t,serialized:typeof t=="object"?e({queryArgs:t,endpointDefinition:r,endpointName:s}):t}),[t,e,r,s]),i=v.useRef(n);return v.useEffect(()=>{i.current.serialized!==n.serialized&&(i.current=n)},[n]),i.current.serialized===n.serialized?i.current.queryArgs:t}function Aa(t){const e=v.useRef(t);return v.useEffect(()=>{Pi(e.current,t)||(e.current=t)},[t]),Pi(e.current,t)?e.current:t}var dT=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",fT=dT(),pT=()=>typeof navigator<"u"&&navigator.product==="ReactNative",mT=pT(),gT=()=>fT||mT?v.useLayoutEffect:v.useEffect,AT=gT(),$g=t=>t.isUninitialized?{...t,isUninitialized:!1,isFetching:!0,isLoading:t.data===void 0,status:yb.pending}:t;function du(t,...e){const r={};return e.forEach(s=>{r[s]=t[s]}),r}var fu=["data","status","isLoading","isSuccess","isError","error"];function yT({api:t,moduleOptions:{batch:e,hooks:{useDispatch:r,useSelector:s,useStore:n},unstable__sideEffectsInRender:i,createSelector:o},serializeQueryArgs:a,context:l}){const c=i?x=>x():v.useEffect;return{buildQueryHooks:y,buildInfiniteQueryHooks:b,buildMutationHook:q,usePrefetch:f};function u(x,V,_){if(V?.endpointName&&x.isUninitialized){const{endpointName:T}=V,R=l.endpointDefinitions[T];_!==kr&&a({queryArgs:V.originalArgs,endpointDefinition:R,endpointName:T})===a({queryArgs:_,endpointDefinition:R,endpointName:T})&&(V=void 0)}let w=x.isSuccess?x.data:V?.data;w===void 0&&(w=x.data);const S=w!==void 0,k=x.isLoading,C=(!V||V.isLoading||V.isUninitialized)&&!S&&k,E=x.isSuccess||S&&(k&&!V?.isError||x.isUninitialized);return{...x,data:w,currentData:x.data,isFetching:k,isLoading:C,isSuccess:E}}function h(x,V,_){if(V?.endpointName&&x.isUninitialized){const{endpointName:T}=V,R=l.endpointDefinitions[T];a({queryArgs:V.originalArgs,endpointDefinition:R,endpointName:T})===a({queryArgs:_,endpointDefinition:R,endpointName:T})&&(V=void 0)}let w=x.isSuccess?x.data:V?.data;w===void 0&&(w=x.data);const S=w!==void 0,k=x.isLoading,C=(!V||V.isLoading||V.isUninitialized)&&!S&&k,E=x.isSuccess||k&&S;return{...x,data:w,currentData:x.data,isFetching:k,isLoading:C,isSuccess:E}}function f(x,V){const _=r(),w=Aa(V);return v.useCallback((S,k)=>_(t.util.prefetch(x,S,{...w,...k})),[x,_,w])}function d(x,V,{refetchOnReconnect:_,refetchOnFocus:w,refetchOnMountOrArgChange:S,skip:k=!1,pollingInterval:C=0,skipPollingIfUnfocused:E=!1,...T}={}){const{initiate:R}=t.endpoints[x],M=r(),D=v.useRef(void 0);if(!D.current){const de=M(t.internalActions.internal_getRTKQSubscriptions());D.current=de}const P=Ug(k?kr:V,Ih,l.endpointDefinitions[x],x),I=Aa({refetchOnReconnect:_,refetchOnFocus:w,pollingInterval:C,skipPollingIfUnfocused:E}),B=v.useRef(!1),F=T.initialPageParam,Q=Aa(F),he=v.useRef(void 0);let{queryCacheKey:ie,requestId:se}=he.current||{},J=!1;ie&&se&&(J=D.current.isRequestSubscribed(ie,se));const Z=!J&&B.current;return c(()=>{B.current=J}),c(()=>{Z&&(he.current=void 0)},[Z]),c(()=>{const de=he.current;if(P===kr){de?.unsubscribe(),he.current=void 0;return}const Fe=he.current?.subscriptionOptions;if(!de||de.arg!==P){de?.unsubscribe();const ar=M(R(P,{subscriptionOptions:I,forceRefetch:S,...kb(l.endpointDefinitions[x])?{initialPageParam:Q}:{}}));he.current=ar}else I!==Fe&&de.updateSubscriptionOptions(I)},[M,R,S,P,I,Z,Q,x]),[he,M,R,I]}function m(x,V){return(w,{skip:S=!1,selectFromResult:k}={})=>{const{select:C}=t.endpoints[x],E=Ug(S?kr:w,a,l.endpointDefinitions[x],x),T=v.useRef(void 0),R=v.useMemo(()=>o([C(E),(B,F)=>F,B=>E],V,{memoizeOptions:{resultEqualityCheck:Pi}}),[C,E]),M=v.useMemo(()=>k?o([R],k,{devModeChecks:{identityFunctionCheck:"never"}}):R,[R,k]),D=s(B=>M(B,T.current),Pi),P=n(),I=R(P.getState(),T.current);return AT(()=>{T.current=I},[I]),D}}function g(x){v.useEffect(()=>()=>{x.current?.unsubscribe?.(),x.current=void 0},[x])}function A(x){if(!x.current)throw new Error(Ke(38));return x.current.refetch()}function y(x){const V=(S,k={})=>{const[C]=d(x,S,k);return g(C),v.useMemo(()=>({refetch:()=>A(C)}),[C])},_=({refetchOnReconnect:S,refetchOnFocus:k,pollingInterval:C=0,skipPollingIfUnfocused:E=!1}={})=>{const{initiate:T}=t.endpoints[x],R=r(),[M,D]=v.useState(hu),P=v.useRef(void 0),I=Aa({refetchOnReconnect:S,refetchOnFocus:k,pollingInterval:C,skipPollingIfUnfocused:E});c(()=>{const he=P.current?.subscriptionOptions;I!==he&&P.current?.updateSubscriptionOptions(I)},[I]);const B=v.useRef(I);c(()=>{B.current=I},[I]);const F=v.useCallback(function(he,ie=!1){let se;return e(()=>{P.current?.unsubscribe(),P.current=se=R(T(he,{subscriptionOptions:B.current,forceRefetch:!ie})),D(he)}),se},[R,T]),Q=v.useCallback(()=>{P.current?.queryCacheKey&&R(t.internalActions.removeQueryResult({queryCacheKey:P.current?.queryCacheKey}))},[R]);return v.useEffect(()=>()=>{P?.current?.unsubscribe()},[]),v.useEffect(()=>{M!==hu&&!P.current&&F(M,!0)},[M,F]),v.useMemo(()=>[F,M,{reset:Q}],[F,M,Q])},w=m(x,u);return{useQueryState:w,useQuerySubscription:V,useLazyQuerySubscription:_,useLazyQuery(S){const[k,C,{reset:E}]=_(S),T=w(C,{...S,skip:C===hu}),R=v.useMemo(()=>({lastArg:C}),[C]);return v.useMemo(()=>[k,{...T,reset:E},R],[k,T,E,R])},useQuery(S,k){const C=V(S,k),E=w(S,{selectFromResult:S===kr||k?.skip?void 0:$g,...k}),T=du(E,...fu);return v.useDebugValue(T),v.useMemo(()=>({...E,...C}),[E,C])}}}function b(x){const V=(w,S={})=>{const[k,C,E,T]=d(x,w,S),R=v.useRef(T);c(()=>{R.current=T},[T]);const M=v.useCallback(function(D,P){let I;return e(()=>{k.current?.unsubscribe(),k.current=I=C(E(D,{subscriptionOptions:R.current,direction:P}))}),I},[k,C,E]);return g(k),v.useMemo(()=>({trigger:M,refetch:()=>A(k),fetchNextPage:()=>M(w,"forward"),fetchPreviousPage:()=>M(w,"backward")}),[k,M,w])},_=m(x,h);return{useInfiniteQueryState:_,useInfiniteQuerySubscription:V,useInfiniteQuery(w,S){const{refetch:k,fetchNextPage:C,fetchPreviousPage:E}=V(w,S),T=_(w,{selectFromResult:w===kr||S?.skip?void 0:$g,...S}),R=du(T,...fu,"hasNextPage","hasPreviousPage");return v.useDebugValue(R),v.useMemo(()=>({...T,fetchNextPage:C,fetchPreviousPage:E,refetch:k}),[T,C,E,k])}}}function q(x){return({selectFromResult:V,fixedCacheKey:_}={})=>{const{select:w,initiate:S}=t.endpoints[x],k=r(),[C,E]=v.useState();v.useEffect(()=>()=>{C?.arg.fixedCacheKey||C?.reset()},[C]);const T=v.useCallback(function(he){const ie=k(S(he,{fixedCacheKey:_}));return E(ie),ie},[k,S,_]),{requestId:R}=C||{},M=v.useMemo(()=>w({fixedCacheKey:_,requestId:C?.requestId}),[_,C,w]),D=v.useMemo(()=>V?o([M],V):M,[V,M]),P=s(D,Pi),I=_==null?C?.arg.originalArgs:void 0,B=v.useCallback(()=>{e(()=>{C&&E(void 0),_&&k(t.internalActions.removeMutationResult({requestId:R,fixedCacheKey:_}))})},[k,_,C,R]),F=du(P,...fu,"endpointName");v.useDebugValue(F);const Q=v.useMemo(()=>({...P,originalArgs:I,reset:B}),[P,I,B]);return v.useMemo(()=>[T,Q],[T,Q])}}}var qT=Symbol(),xT=({batch:t=dv,hooks:e={useDispatch:oq,useSelector:aq,useStore:Ad},createSelector:r=Ml,unstable__sideEffectsInRender:s=!1,...n}={})=>({name:qT,init(i,{serializeQueryArgs:o},a){const l=i,{buildQueryHooks:c,buildInfiniteQueryHooks:u,buildMutationHook:h,usePrefetch:f}=yT({api:i,moduleOptions:{batch:t,hooks:e,unstable__sideEffectsInRender:s,createSelector:r},serializeQueryArgs:o,context:a});return fi(l,{usePrefetch:f}),fi(a,{batch:t}),{injectEndpoint(d,m){if(uT(m)){const{useQuery:g,useLazyQuery:A,useLazyQuerySubscription:y,useQueryState:b,useQuerySubscription:q}=c(d);fi(l.endpoints[d],{useQuery:g,useLazyQuery:A,useLazyQuerySubscription:y,useQueryState:b,useQuerySubscription:q}),i[`use${ga(d)}Query`]=g,i[`useLazy${ga(d)}Query`]=A}if(hT(m)){const g=h(d);fi(l.endpoints[d],{useMutation:g}),i[`use${ga(d)}Mutation`]=g}else if(kb(m)){const{useInfiniteQuery:g,useInfiniteQuerySubscription:A,useInfiniteQueryState:y}=u(d);fi(l.endpoints[d],{useInfiniteQuery:g,useInfiniteQuerySubscription:A,useInfiniteQueryState:y}),i[`use${ga(d)}InfiniteQuery`]=g}}}}}),Cb=_b(Sb(),xT());const bT=Bn(()=>Nn(()=>import("./campaign-LEH-poZq.js"),__vite__mapDeps([4,2,3]))),Wl=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const wT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Si=Array.prototype.slice.call(wT),ya=(t=>{let e={};return t.forEach((r,s)=>e[r]=s),e})(Si),VT=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Ua=String.fromCharCode.bind(String),Gg=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),vT=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),Eb=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),_T=t=>{let e,r,s,n,i="";const o=t.length%3;for(let a=0;a<t.length;){if((r=t.charCodeAt(a++))>255||(s=t.charCodeAt(a++))>255||(n=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=r<<16|s<<8|n,i+=Si[e>>18&63]+Si[e>>12&63]+Si[e>>6&63]+Si[e&63]}return o?i.slice(0,o-3)+"===".substring(o):i},ST=typeof btoa=="function"?t=>btoa(t):Wl?t=>Buffer.from(t,"binary").toString("base64"):_T,Hg=Wl?t=>Buffer.from(t).toString("base64"):t=>{let r=[];for(let s=0,n=t.length;s<n;s+=4096)r.push(Ua.apply(null,t.subarray(s,s+4096)));return ST(r.join(""))},kT=(t,e=!1)=>e?vT(Hg(t)):Hg(t),CT=t=>{if(t=t.replace(/\s+/g,""),!VT.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,r="",s,n;for(let i=0;i<t.length;)e=ya[t.charAt(i++)]<<18|ya[t.charAt(i++)]<<12|(s=ya[t.charAt(i++)])<<6|(n=ya[t.charAt(i++)]),r+=s===64?Ua(e>>16&255):n===64?Ua(e>>16&255,e>>8&255):Ua(e>>16&255,e>>8&255,e&255);return r},ET=typeof atob=="function"?t=>atob(Eb(t)):Wl?t=>Buffer.from(t,"base64").toString("binary"):CT,TT=Wl?t=>Gg(Buffer.from(t,"base64")):t=>Gg(ET(t).split("").map(e=>e.charCodeAt(0))),PT=t=>TT(RT(t)),RT=t=>Eb(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),MT=!0,Tb="gzip",IT=async t=>{const e=JSON.stringify(t),s=new TextEncoder().encode(e),n=new Blob([s]),i=new CompressionStream(Tb),o=n.stream().pipeThrough(i),a=await new Response(o).arrayBuffer(),l=new Uint8Array(a);return kT(l,MT)},Pb=async t=>{try{const e=PT(t),r=new Blob([new Uint8Array(e)]),s=new DecompressionStream(Tb),n=r.stream().pipeThrough(s),i=await new Response(n).text();return JSON.parse(i)}catch(e){throw new Error("error decompressing object",{cause:e})}};var Wg=function(){return Wg=Object.assign||function(e){for(var r,s=1,n=arguments.length;s<n;s++){r=arguments[s];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Wg.apply(this,arguments)};function Yl(t,e){var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(t);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n])&&(r[s[n]]=t[s[n]]);return r}function jT(t,e,r,s){function n(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{c(s.next(u))}catch(h){o(h)}}function l(u){try{c(s.throw(u))}catch(h){o(h)}}function c(u){u.done?i(u.value):n(u.value).then(a,l)}c((s=s.apply(t,e||[])).next())})}function T$(t,e,r){if(r||arguments.length===2)for(var s=0,n=e.length,i;s<n;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))}const OT=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class pf extends Error{constructor(e,r="FunctionsError",s){super(e),this.name=r,this.context=s}}class NT extends pf{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Yg extends pf{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Kg extends pf{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var jh;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(jh||(jh={}));class BT{constructor(e,{headers:r={},customFetch:s,region:n=jh.Any}={}){this.url=e,this.headers=r,this.region=n,this.fetch=OT(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return jT(this,arguments,void 0,function*(r,s={}){var n;let i,o;try{const{headers:a,method:l,body:c,signal:u,timeout:h}=s;let f={},{region:d}=s;d||(d=this.region);const m=new URL(`${this.url}/${r}`);d&&d!=="any"&&(f["x-region"]=d,m.searchParams.set("forceFunctionRegion",d));let g;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",g=c):typeof c=="string"?(f["Content-Type"]="text/plain",g=c):typeof FormData<"u"&&c instanceof FormData?g=c:(f["Content-Type"]="application/json",g=JSON.stringify(c)):c&&typeof c!="string"&&!(typeof Blob<"u"&&c instanceof Blob)&&!(c instanceof ArrayBuffer)&&!(typeof FormData<"u"&&c instanceof FormData)?g=JSON.stringify(c):g=c;let A=u;h&&(o=new AbortController,i=setTimeout(()=>o.abort(),h),u?(A=o.signal,u.addEventListener("abort",()=>o.abort())):A=o.signal);const y=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),a),body:g,signal:A}).catch(V=>{throw new NT(V)}),b=y.headers.get("x-relay-error");if(b&&b==="true")throw new Yg(y);if(!y.ok)throw new Kg(y);let q=((n=y.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),x;return q==="application/json"?x=yield y.json():q==="application/octet-stream"||q==="application/pdf"?x=yield y.blob():q==="text/event-stream"?x=y:q==="multipart/form-data"?x=yield y.formData():x=yield y.text(),{data:x,error:null,response:y}}catch(a){return{data:null,error:a,response:a instanceof Kg||a instanceof Yg?a.context:void 0}}finally{i&&clearTimeout(i)}})}}var DT=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},zT=class{constructor(t){var e,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(r=t.isMaybeSingle)!==null&&r!==void 0?r:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,a=null,l=null,c=i.status,u=i.statusText;if(i.ok){var h,f;if(r.method!=="HEAD"){var d;const y=await i.text();y===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((d=r.headers.get("Accept"))===null||d===void 0)&&d.includes("application/vnd.pgrst.plan+text"))?a=y:a=JSON.parse(y))}const g=(h=r.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),A=(f=i.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");g&&A&&A.length>1&&(l=parseInt(A[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,c=406,u="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var m;const g=await i.text();try{o=JSON.parse(g),Array.isArray(o)&&i.status===404&&(a=[],o=null,c=200,u="OK")}catch{i.status===404&&g===""?(c=204,u="No Content"):o={message:g}}if(o&&r.isMaybeSingle&&(!(o==null||(m=o.details)===null||m===void 0)&&m.includes("0 rows"))&&(o=null,c=200,u="OK"),o&&r.shouldThrowOnError)throw new DT(o)}return{error:o,data:a,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(n=n.catch(i=>{var o;let a="";const l=i?.cause;if(l){var c,u,h,f;const m=(c=l?.message)!==null&&c!==void 0?c:"",g=(u=l?.code)!==null&&u!==void 0?u:"";a=`${(h=i?.name)!==null&&h!==void 0?h:"FetchError"}: ${i?.message}`,a+=`

Caused by: ${(f=l?.name)!==null&&f!==void 0?f:"Error"}: ${m}`,g&&(a+=` (${g})`),l?.stack&&(a+=`
${l.stack}`)}else{var d;a=(d=i?.stack)!==null&&d!==void 0?d:""}return{error:{message:`${(o=i?.name)!==null&&o!==void 0?o:"FetchError"}: ${i?.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),n.then(t,e)}returns(){return this}overrideTypes(){return this}},FT=class extends zT{select(t){let e=!1;const r=(t??"*").split("").map(s=>/\s/.test(s)&&!e?"":(s==='"'&&(e=!e),s)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const i=n?`${n}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,e,{foreignTable:r,referencedTable:s=r}={}){const n=typeof s>"u"?"offset":`${s}.offset`,i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${t}`),this.url.searchParams.set(i,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:i="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const Qg=new RegExp("[,()]");var on=class extends FT{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const r=Array.from(new Set(e)).map(s=>typeof s=="string"&&Qg.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}notIn(t,e){const r=Array.from(new Set(e)).map(s=>typeof s=="string"&&Qg.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`not.in.(${r})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");const i=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${n}fts${i}.${e}`),this}match(t){return Object.entries(t).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(t,e,r){return this.url.searchParams.append(t,`not.${e}.${r}`),this}or(t,{foreignTable:e,referencedTable:r=e}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,e,r){return this.url.searchParams.append(t,`${e}.${r}`),this}},LT=class{constructor(t,{headers:e={},schema:r,fetch:s}){this.url=t,this.headers=new Headers(e),this.schema=r,this.fetch=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:r=!1,count:s}=e??{},n=r?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(c=>/\s/.test(c)&&!i?"":(c==='"'&&(i=!i),c)).join(""),{url:a,headers:l}=this.cloneRequestState();return a.searchParams.set("select",o),s&&l.append("Prefer",`count=${s}`),new on({method:n,url:a,headers:l,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:r=!0}={}){var s;const n="POST",{url:i,headers:o}=this.cloneRequestState();if(e&&o.append("Prefer",`count=${e}`),r||o.append("Prefer","missing=default"),Array.isArray(t)){const a=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(a.length>0){const l=[...new Set(a)].map(c=>`"${c}"`);i.searchParams.set("columns",l.join(","))}}return new on({method:n,url:i,headers:o,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){var i;const o="POST",{url:a,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),e!==void 0&&a.searchParams.set("on_conflict",e),s&&l.append("Prefer",`count=${s}`),n||l.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(c.length>0){const u=[...new Set(c)].map(h=>`"${h}"`);a.searchParams.set("columns",u.join(","))}}return new on({method:o,url:a,headers:l,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:e}={}){var r;const s="PATCH",{url:n,headers:i}=this.cloneRequestState();return e&&i.append("Prefer",`count=${e}`),new on({method:s,url:n,headers:i,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:t}={}){var e;const r="DELETE",{url:s,headers:n}=this.cloneRequestState();return t&&n.append("Prefer",`count=${t}`),new on({method:r,url:s,headers:n,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},UT=class Rb{constructor(e,{headers:r={},schema:s,fetch:n}={}){this.url=e,this.headers=new Headers(r),this.schemaName=s,this.fetch=n}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new LT(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Rb(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,r={},{head:s=!1,get:n=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let c;const u=d=>d!==null&&typeof d=="object"&&(!Array.isArray(d)||d.some(u)),h=s&&Object.values(r).some(u);h?(a="POST",c=r):s||n?(a=s?"HEAD":"GET",Object.entries(r).filter(([d,m])=>m!==void 0).map(([d,m])=>[d,Array.isArray(m)?`{${m.join(",")}}`:`${m}`]).forEach(([d,m])=>{l.searchParams.append(d,m)})):(a="POST",c=r);const f=new Headers(this.headers);return h?f.set("Prefer",i?`count=${i},return=minimal`:"return=minimal"):i&&f.set("Prefer",`count=${i}`),new on({method:a,url:l,headers:f,schema:this.schemaName,body:c,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class $T{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const r=globalThis.process;if(r){const s=r.versions;if(s&&s.node){const n=s.node,i=parseInt(n.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let r=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(r+=`

Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const s=this.getWebSocketConstructor();return new s(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const GT="2.93.1",HT=`realtime-js/${GT}`,WT="1.0.0",Mb="2.0.0",Xg=Mb,Oh=1e4,YT=1e3,KT=100;var Lr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Lr||(Lr={}));var $e;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})($e||($e={}));var tr;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(tr||(tr={}));var Nh;(function(t){t.websocket="websocket"})(Nh||(Nh={}));var ws;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(ws||(ws={}));class QT{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,r){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return r(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var r;return this._isArrayBuffer((r=e.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var r,s;const n=(s=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(e){var r,s;const n=(s=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&s!==void 0?s:{},o=new TextEncoder().encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,r,s){var n,i;const o=e.topic,a=(n=e.ref)!==null&&n!==void 0?n:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",c=e.payload.event,u=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},h=Object.keys(u).length===0?"":JSON.stringify(u);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`metadata length ${h.length} exceeds maximum of 255`);const f=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+c.length+h.length,d=new ArrayBuffer(this.HEADER_LENGTH+f);let m=new DataView(d),g=0;m.setUint8(g++,this.KINDS.userBroadcastPush),m.setUint8(g++,l.length),m.setUint8(g++,a.length),m.setUint8(g++,o.length),m.setUint8(g++,c.length),m.setUint8(g++,h.length),m.setUint8(g++,r),Array.from(l,y=>m.setUint8(g++,y.charCodeAt(0))),Array.from(a,y=>m.setUint8(g++,y.charCodeAt(0))),Array.from(o,y=>m.setUint8(g++,y.charCodeAt(0))),Array.from(c,y=>m.setUint8(g++,y.charCodeAt(0))),Array.from(h,y=>m.setUint8(g++,y.charCodeAt(0)));var A=new Uint8Array(d.byteLength+s.byteLength);return A.set(new Uint8Array(d),0),A.set(new Uint8Array(s),d.byteLength),A.buffer}decode(e,r){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return r(s)}if(typeof e=="string"){const s=JSON.parse(e),[n,i,o,a,l]=s;return r({join_ref:n,ref:i,topic:o,event:a,payload:l})}return r({})}_binaryDecode(e){const r=new DataView(e),s=r.getUint8(0),n=new TextDecoder;if(s===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,r,n)}_decodeUserBroadcast(e,r,s){const n=r.getUint8(1),i=r.getUint8(2),o=r.getUint8(3),a=r.getUint8(4);let l=this.HEADER_LENGTH+4;const c=s.decode(e.slice(l,l+n));l=l+n;const u=s.decode(e.slice(l,l+i));l=l+i;const h=s.decode(e.slice(l,l+o));l=l+o;const f=e.slice(l,e.byteLength),d=a===this.JSON_ENCODING?JSON.parse(s.decode(f)):f,m={type:this.BROADCAST_EVENT,event:u,payload:d};return o>0&&(m.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(e){var r;return e instanceof ArrayBuffer||((r=e?.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(e,r){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([s])=>r.includes(s)))}}class Ib{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ve;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(ve||(ve={}));const Jg=(t,e,r={})=>{var s;const n=(s=r.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=XT(o,t,e,n),i),{}):{}},XT=(t,e,r,s)=>{const n=e.find(a=>a.name===t),i=n?.type,o=r[t];return i&&!s.includes(i)?jb(i,o):Bh(o)},jb=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return tP(e,r)}switch(t){case ve.bool:return JT(e);case ve.float4:case ve.float8:case ve.int2:case ve.int4:case ve.int8:case ve.numeric:case ve.oid:return ZT(e);case ve.json:case ve.jsonb:return eP(e);case ve.timestamp:return rP(e);case ve.abstime:case ve.date:case ve.daterange:case ve.int4range:case ve.int8range:case ve.money:case ve.reltime:case ve.text:case ve.time:case ve.timestamptz:case ve.timetz:case ve.tsrange:case ve.tstzrange:return Bh(e);default:return Bh(e)}},Bh=t=>t,JT=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},ZT=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},eP=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},tP=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,s=t[r];if(t[0]==="{"&&s==="}"){let i;const o=t.slice(1,r);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>jb(e,a))}return t},rP=t=>typeof t=="string"?t.replace(" ","T"):t,Ob=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class pu{constructor(e,r,s={},n=Oh){this.channel=e,this.event=r,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var s;return this._hasReceived(e)&&r((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Zg;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Zg||(Zg={}));class Bi{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Bi.syncState(this.state,n,i,o),this.pendingDiffs.forEach(l=>{this.state=Bi.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Bi.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,s,n){const i=this.cloneDeep(e),o=this.transformState(r),a={},l={};return this.map(i,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const h=i[c];if(h){const f=u.map(A=>A.presence_ref),d=h.map(A=>A.presence_ref),m=u.filter(A=>d.indexOf(A.presence_ref)<0),g=h.filter(A=>f.indexOf(A.presence_ref)<0);m.length>0&&(a[c]=m),g.length>0&&(l[c]=g)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},s,n)}static syncDiff(e,r,s,n){const{joins:i,leaves:o}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const h=e[a].map(d=>d.presence_ref),f=u.filter(d=>h.indexOf(d.presence_ref)<0);e[a].unshift(...f)}s(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=c,n(a,c,l),c.length===0&&delete e[a]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(s=>r(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,s)=>{const n=e[s];return"metas"in n?r[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):r[s]=n,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var eA;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(eA||(eA={}));var Di;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Di||(Di={}));var _r;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(_r||(_r={}));class dn{constructor(e,r={config:{}},s){var n,i;if(this.topic=e,this.params=r,this.socket=s,this.bindings={},this.state=$e.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new pu(this,tr.join,this.params,this.timeout),this.rejoinTimer=new Ib(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=$e.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=$e.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=$e.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=$e.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=$e.errored,this.rejoinTimer.scheduleTimeout())}),this._on(tr.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new Bi(this),this.broadcastEndpointURL=Ob(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,r=this.timeout){var s,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==$e.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(d=>d.filter))!==null&&n!==void 0?n:[],u=!!this.bindings[Di.PRESENCE]&&this.bindings[Di.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},f={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(d=>e?.(_r.CHANNEL_ERROR,d)),this._onClose(()=>e?.(_r.CLOSED)),this.updateJoinPayload(Object.assign({config:f},h)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:d})=>{var m;if(this.socket._isManualToken()||this.socket.setAuth(),d===void 0){e?.(_r.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,A=(m=g?.length)!==null&&m!==void 0?m:0,y=[];for(let b=0;b<A;b++){const q=g[b],{filter:{event:x,schema:V,table:_,filter:w}}=q,S=d&&d[b];if(S&&S.event===x&&dn.isFilterValueEqual(S.schema,V)&&dn.isFilterValueEqual(S.table,_)&&dn.isFilterValueEqual(S.filter,w))y.push(Object.assign(Object.assign({},q),{id:S.id}));else{this.unsubscribe(),this.state=$e.errored,e?.(_r.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(_r.SUBSCRIBED);return}}).receive("error",d=>{this.state=$e.errored,e?.(_r.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e?.(_r.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,s){return this.state===$e.joined&&e===Di.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,r,s)}async httpSend(e,r,s={}){var n;if(r==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:r,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,r={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const c=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=$e.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(tr.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new pu(this,tr.leave,{},e),s.receive("ok",()=>{r(),n("ok")}).receive("timeout",()=>{r(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=$e.closed,this.bindings={}}async _fetchWithTimeout(e,r,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:n.signal}));return clearTimeout(i),o}_push(e,r,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new pu(this,e,r,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>KT){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,s){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,s){var n,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=tr;if(s&&[a,l,c,u].indexOf(o)>=0&&s!==this._joinRef())return;let f=this._onMessage(o,r,s);if(r&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(d=>{var m,g,A;return((m=d.filter)===null||m===void 0?void 0:m.event)==="*"||((A=(g=d.filter)===null||g===void 0?void 0:g.event)===null||A===void 0?void 0:A.toLocaleLowerCase())===o}).map(d=>d.callback(f,s)):(i=this.bindings[o])===null||i===void 0||i.filter(d=>{var m,g,A,y,b,q;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in d){const x=d.id,V=(m=d.filter)===null||m===void 0?void 0:m.event;return x&&((g=r.ids)===null||g===void 0?void 0:g.includes(x))&&(V==="*"||V?.toLocaleLowerCase()===((A=r.data)===null||A===void 0?void 0:A.type.toLocaleLowerCase()))}else{const x=(b=(y=d?.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return x==="*"||x===((q=r?.event)===null||q===void 0?void 0:q.toLocaleLowerCase())}else return d.type.toLocaleLowerCase()===o}).map(d=>{if(typeof f=="object"&&"ids"in f){const m=f.data,{schema:g,table:A,commit_timestamp:y,type:b,errors:q}=m;f=Object.assign(Object.assign({},{schema:g,table:A,commit_timestamp:y,eventType:b,new:{},old:{},errors:q}),this._getPayloadRecords(m))}d.callback(f,s)})}_isClosed(){return this.state===$e.closed}_isJoined(){return this.state===$e.joined}_isJoining(){return this.state===$e.joining}_isLeaving(){return this.state===$e.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,s){const n=e.toLocaleLowerCase(),i={type:n,filter:r,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,r){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&dn.isEqual(n.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(e[s]!==r[s])return!1;return!0}static isFilterValueEqual(e,r){return(e??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(tr.close,{},e)}_onError(e){this._on(tr.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=$e.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=Jg(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=Jg(e.columns,e.old_record)),r}}const mu=()=>{},qa={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},sP=[1e3,2e3,5e3,1e4],nP=1e4,iP=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class oP{constructor(e,r){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Oh,this.transport=null,this.heartbeatIntervalMs=qa.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=mu,this.ref=0,this.reconnectTimer=null,this.vsn=Xg,this.logger=mu,this.conn=null,this.sendBuffer=[],this.serializer=new QT,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=n=>n?(...i)=>n(...i):(...i)=>fetch(...i),!(!((s=r?.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${Nh.websocket}`,this.httpEndpoint=Ob(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=$T.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,s){this.logger(e,r,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Lr.connecting:return ws.Connecting;case Lr.open:return ws.Open;case Lr.closing:return ws.Closing;default:return ws.Closed}}isConnected(){return this.connectionState()===ws.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{const i=new dn(`realtime:${e}`,r,this);return this.channels.push(i),i}}push(e){const{topic:r,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${r} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(YT,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},qa.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply"&&r.ref&&r.ref===this.pendingHeartbeatRef){const c=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error",c)}catch(u){this.log("error","error in heartbeat callback",u)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:s,event:n,payload:i,ref:o}=r,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${s} ${n} ${a}`.trim(),i),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(n,i,o)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Lr.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Lr.open||this.conn.readyState===Lr.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(r){this.log("error","error in heartbeat callback",r)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(tr.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(r);return`${e}${s}${n}`}_workerObjectUrl(e){let r;if(e)r=e;else{const s=new Blob([iP],{type:"application/javascript"});r=URL.createObjectURL(s)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r,s=!1;if(e)r=e,s=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(n){this.log("error","Error fetching access token from callback",n),r=this.accessTokenValue}else r=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const i={access_token:r,version:HT};r&&n.updateJoinPayload(i),n.joinedOnce&&n._isJoined()&&n._push(tr.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(r)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Ib(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},qa.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,s,n,i,o,a,l,c,u,h,f,d;switch(this.transport=(r=e?.transport)!==null&&r!==void 0?r:null,this.timeout=(s=e?.timeout)!==null&&s!==void 0?s:Oh,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:qa.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e?.heartbeatCallback)!==null&&a!==void 0?a:mu,this.vsn=(l=e?.vsn)!==null&&l!==void 0?l:Xg,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e?.reconnectAfterMs)!==null&&c!==void 0?c:(m=>sP[m-1]||nP),this.vsn){case WT:this.encode=(u=e?.encode)!==null&&u!==void 0?u:((m,g)=>g(JSON.stringify(m))),this.decode=(h=e?.decode)!==null&&h!==void 0?h:((m,g)=>g(JSON.parse(m)));break;case Mb:this.encode=(f=e?.encode)!==null&&f!==void 0?f:this.serializer.encode.bind(this.serializer),this.decode=(d=e?.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var so=class extends Error{constructor(t,e){super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function aP(t,e,r){const s=new URL(e,t);if(r)for(const[n,i]of Object.entries(r))i!==void 0&&s.searchParams.set(n,i);return s.toString()}async function lP(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function cP(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:r,path:s,query:n,body:i,headers:o}){const a=aP(t.baseUrl,s,n),l=await lP(t.auth),c=await e(a,{method:r,headers:{...i?{"Content-Type":"application/json"}:{},...l,...o},body:i?JSON.stringify(i):void 0}),u=await c.text(),h=(c.headers.get("content-type")||"").includes("application/json"),f=h&&u?JSON.parse(u):u;if(!c.ok){const d=h?f:void 0,m=d?.error;throw new so(m?.message??`Request failed with status ${c.status}`,{status:c.status,icebergType:m?.type,icebergCode:m?.code,details:d})}return{status:c.status,headers:c.headers,data:f}}}}function xa(t){return t.join("")}var uP=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:xa(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(t,e){const r={namespace:t.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${xa(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${xa(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${xa(t.namespace)}`}),!0}catch(e){if(e instanceof so&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(r){if(r instanceof so&&r.status===409)return;throw r}}};function Gs(t){return t.join("")}var hP=class{constructor(t,e="",r){this.client=t,this.prefix=e,this.accessDelegation=r}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Gs(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Gs(t.namespace)}/tables`,body:e,headers:r})).data.metadata}async updateTable(t,e){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Gs(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Gs(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Gs(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Gs(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(r){if(r instanceof so&&r.status===404)return!1;throw r}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(r){if(r instanceof so&&r.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw r}}},dP=class{constructor(t){let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const r=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=cP({baseUrl:r,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=t.accessDelegation?.join(","),this.namespaceOps=new uP(this.client,e),this.tableOps=new hP(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},Kl=class extends Error{constructor(t,e="storage",r,s){super(t),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=r,this.statusCode=s}};function Ql(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var ba=class extends Kl{constructor(t,e,r,s="storage"){super(t,s,e,r),this.name=s==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Nb=class extends Kl{constructor(t,e,r="storage"){super(t,r),this.name=r==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const fP=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),pP=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Dh=t=>{if(Array.isArray(t))return t.map(r=>Dh(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,s])=>{const n=r.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Dh(s)}),e},mP=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function no(t){"@babel/helpers - typeof";return no=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},no(t)}function gP(t,e){if(no(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e);if(no(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function AP(t){var e=gP(t,"string");return no(e)=="symbol"?e:e+""}function yP(t,e,r){return(e=AP(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function tA(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function K(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?tA(Object(r),!0).forEach(function(s){yP(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tA(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}const rA=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},qP=async(t,e,r,s)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!r?.noResolveJson){const n=t,i=n.status||500;if(typeof n.json=="function")n.json().then(o=>{const a=o?.statusCode||o?.code||i+"";e(new ba(rA(o),i,a,s))}).catch(()=>{if(s==="vectors"){const o=i+"";e(new ba(n.statusText||`HTTP ${i} error`,i,o,s))}else{const o=i+"";e(new ba(n.statusText||`HTTP ${i} error`,i,o,s))}});else{const o=i+"";e(new ba(n.statusText||`HTTP ${i} error`,i,o,s))}}else e(new Nb(rA(t),t,s))},xP=(t,e,r,s)=>{const n={method:t,headers:e?.headers||{}};return t==="GET"||t==="HEAD"||!s?K(K({},n),r):(pP(s)?(n.headers=K({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(s)):n.body=s,e?.duplex&&(n.duplex=e.duplex),K(K({},n),r))};async function pi(t,e,r,s,n,i,o){return new Promise((a,l)=>{t(r,xP(e,s,n,i)).then(c=>{if(!c.ok)throw c;if(s?.noResolveJson)return c;if(o==="vectors"){const u=c.headers.get("content-type");if(!u||!u.includes("application/json"))return{}}return c.json()}).then(c=>a(c)).catch(c=>qP(c,l,s,o))})}function bP(t="storage"){return{get:async(e,r,s,n)=>pi(e,"GET",r,s,n,void 0,t),post:async(e,r,s,n,i)=>pi(e,"POST",r,n,i,s,t),put:async(e,r,s,n,i)=>pi(e,"PUT",r,n,i,s,t),head:async(e,r,s,n)=>pi(e,"HEAD",r,K(K({},s),{},{noResolveJson:!0}),n,void 0,t),remove:async(e,r,s,n,i)=>pi(e,"DELETE",r,n,i,s,t)}}const wP=bP("storage"),{get:io,post:Ce,put:zh,head:VP,remove:mf}=wP;var Yn=class{constructor(t,e={},r,s="storage"){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.fetch=fP(r),this.namespace=s}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(t){var e=this;try{return{data:await t(),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Ql(r))return{data:null,error:r};throw r}}},vP=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Ql(e))return{data:null,error:e};throw e}}};let Bb;Bb=Symbol.toStringTag;var _P=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[Bb]="BlobDownloadBuilder",this.promise=null}asStream(){return new vP(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Ql(e))return{data:null,error:e};throw e}}};const SP={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},sA={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var kP=class extends Yn{constructor(t,e={},r,s){super(t,e,s,"storage"),this.bucketId=r}async uploadOrUpdate(t,e,r,s){var n=this;return n.handleOperation(async()=>{let i;const o=K(K({},sA),s);let a=K(K({},n.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",n.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",n.encodeMetadata(l))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=n.toBase64(n.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),s?.headers&&(a=K(K({},a),s.headers));const c=n._removeEmptyFolders(e),u=n._getFinalPath(c),h=await(t=="PUT"?zh:Ce)(n.fetch,`${n.url}/object/${u}`,i,K({headers:a},o?.duplex?{duplex:o.duplex}:{}));return{path:c,id:h.Id,fullPath:h.Key}})}async upload(t,e,r){return this.uploadOrUpdate("POST",t,e,r)}async uploadToSignedUrl(t,e,r,s){var n=this;const i=n._removeEmptyFolders(t),o=n._getFinalPath(i),a=new URL(n.url+`/object/upload/sign/${o}`);return a.searchParams.set("token",e),n.handleOperation(async()=>{let l;const c=K({upsert:sA.upsert},s),u=K(K({},n.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType),{path:i,fullPath:(await zh(n.fetch,a.toString(),l,{headers:u})).Key}})}async createSignedUploadUrl(t,e){var r=this;return r.handleOperation(async()=>{let s=r._getFinalPath(t);const n=K({},r.headers);e?.upsert&&(n["x-upsert"]="true");const i=await Ce(r.fetch,`${r.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(r.url+i.url),a=o.searchParams.get("token");if(!a)throw new Kl("No token returned by API");return{signedUrl:o.toString(),path:t,token:a}})}async update(t,e,r){return this.uploadOrUpdate("PUT",t,e,r)}async move(t,e,r){var s=this;return s.handleOperation(async()=>await Ce(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:s.headers}))}async copy(t,e,r){var s=this;return s.handleOperation(async()=>({path:(await Ce(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:s.headers})).Key}))}async createSignedUrl(t,e,r){var s=this;return s.handleOperation(async()=>{let n=s._getFinalPath(t),i=await Ce(s.fetch,`${s.url}/object/sign/${n}`,K({expiresIn:e},r?.transform?{transform:r.transform}:{}),{headers:s.headers});const o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{signedUrl:encodeURI(`${s.url}${i.signedURL}${o}`)}})}async createSignedUrls(t,e,r){var s=this;return s.handleOperation(async()=>{const n=await Ce(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:e,paths:t},{headers:s.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return n.map(o=>K(K({},o),{},{signedUrl:o.signedURL?encodeURI(`${s.url}${o.signedURL}${i}`):null}))})}download(t,e){const r=typeof e?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(e?.transform||{}),n=s?`?${s}`:"",i=this._getFinalPath(t),o=()=>io(this.fetch,`${this.url}/${r}/${i}${n}`,{headers:this.headers,noResolveJson:!0});return new _P(o,this.shouldThrowOnError)}async info(t){var e=this;const r=e._getFinalPath(t);return e.handleOperation(async()=>Dh(await io(e.fetch,`${e.url}/object/info/${r}`,{headers:e.headers})))}async exists(t){var e=this;const r=e._getFinalPath(t);try{return await VP(e.fetch,`${e.url}/object/${r}`,{headers:e.headers}),{data:!0,error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(Ql(s)&&s instanceof Nb){const n=s.originalError;if([400,404].includes(n?.status))return{data:!1,error:s}}throw s}}getPublicUrl(t,e){const r=this._getFinalPath(t),s=[],n=e?.download?`download=${e.download===!0?"":e.download}`:"";n!==""&&s.push(n);const i=typeof e?.transform<"u"?"render/image":"object",o=this.transformOptsToQueryString(e?.transform||{});o!==""&&s.push(o);let a=s.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${a}`)}}}async remove(t){var e=this;return e.handleOperation(async()=>await mf(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}))}async list(t,e,r){var s=this;return s.handleOperation(async()=>{const n=K(K(K({},SP),e),{},{prefix:t||""});return await Ce(s.fetch,`${s.url}/object/list/${s.bucketId}`,n,{headers:s.headers},r)})}async listV2(t,e){var r=this;return r.handleOperation(async()=>{const s=K({},t);return await Ce(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,s,{headers:r.headers},e)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const CP="2.93.1",To={"X-Client-Info":`storage-js/${CP}`};var EP=class extends Yn{constructor(t,e={},r,s){const n=new URL(t);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."));const i=n.href.replace(/\/$/,""),o=K(K({},To),e);super(i,o,r,"storage")}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const r=e.listBucketOptionsToQueryString(t);return await io(e.fetch,`${e.url}/bucket${r}`,{headers:e.headers})})}async getBucket(t){var e=this;return e.handleOperation(async()=>await io(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}))}async createBucket(t,e={public:!1}){var r=this;return r.handleOperation(async()=>await Ce(r.fetch,`${r.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async updateBucket(t,e){var r=this;return r.handleOperation(async()=>await zh(r.fetch,`${r.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async emptyBucket(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await mf(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},TP=class extends Yn{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=K(K({},To),e);super(s,n,r,"storage")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}))}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const r=new URLSearchParams;t?.limit!==void 0&&r.set("limit",t.limit.toString()),t?.offset!==void 0&&r.set("offset",t.offset.toString()),t?.sortColumn&&r.set("sortColumn",t.sortColumn),t?.sortOrder&&r.set("sortOrder",t.sortOrder),t?.search&&r.set("search",t.search);const s=r.toString(),n=s?`${e.url}/bucket?${s}`:`${e.url}/bucket`;return await io(e.fetch,n,{headers:e.headers})})}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await mf(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}from(t){var e=this;if(!mP(t))throw new Kl("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new dP({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(r,{get(n,i){const o=n[i];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(n,a),error:null}}catch(l){if(s)throw l;return{data:null,error:l}}}}})}},PP=class extends Yn{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=K(K({},To),{},{"Content-Type":"application/json"},e);super(s,n,r,"vectors")}async createIndex(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{})}async getIndex(t,e){var r=this;return r.handleOperation(async()=>await Ce(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers}))}async listIndexes(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}))}async deleteIndex(t,e){var r=this;return r.handleOperation(async()=>await Ce(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers})||{})}},RP=class extends Yn{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=K(K({},To),{},{"Content-Type":"application/json"},e);super(s,n,r,"vectors")}async putVectors(t){var e=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{})}async getVectors(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}))}async listVectors(t){var e=this;if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}))}async queryVectors(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}))}async deleteVectors(t){var e=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{})}},MP=class extends Yn{constructor(t,e={},r){const s=t.replace(/\/$/,""),n=K(K({},To),{},{"Content-Type":"application/json"},e);super(s,n,r,"vectors")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}async getBucket(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}))}async listBuckets(t={}){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await Ce(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}},IP=class extends MP{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new jP(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,r=this;return e().call(r,t)}async getBucket(t){var e=()=>super.getBucket,r=this;return e().call(r,t)}async listBuckets(t={}){var e=()=>super.listBuckets,r=this;return e().call(r,t)}async deleteBucket(t){var e=()=>super.deleteBucket,r=this;return e().call(r,t)}},jP=class extends PP{constructor(t,e,r,s){super(t,e,s),this.vectorBucketName=r}async createIndex(t){var e=()=>super.createIndex,r=this;return e().call(r,K(K({},t),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,r=this;return e().call(r,K(K({},t),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,r=this;return e().call(r,r.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,r=this;return e().call(r,r.vectorBucketName,t)}index(t){return new OP(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},OP=class extends RP{constructor(t,e,r,s,n){super(t,e,n),this.vectorBucketName=r,this.indexName=s}async putVectors(t){var e=()=>super.putVectors,r=this;return e().call(r,K(K({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(t){var e=()=>super.getVectors,r=this;return e().call(r,K(K({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,r=this;return e().call(r,K(K({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,r=this;return e().call(r,K(K({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,r=this;return e().call(r,K(K({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},NP=class extends EP{constructor(t,e={},r,s){super(t,e,r,s)}from(t){return new kP(this.url,this.headers,t,this.fetch)}get vectors(){return new IP(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new TP(this.url+"/iceberg",this.headers,this.fetch)}};const Db="2.93.1",an=30*1e3,Fh=3,gu=Fh*an,BP="http://localhost:9999",DP="supabase.auth.token",zP={"X-Client-Info":`gotrue-js/${Db}`},Lh="X-Supabase-Api-Version",zb={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},FP=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,LP=600*1e3;class oo extends Error{constructor(e,r,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=s}}function $(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class UP extends oo{constructor(e,r,s){super(e,r,s),this.name="AuthApiError",this.status=r,this.code=s}}function $P(t){return $(t)&&t.name==="AuthApiError"}class Vs extends oo{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class zr extends oo{constructor(e,r,s,n){super(e,s,n),this.name=r,this.status=s}}class Rt extends zr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Au(t){return $(t)&&t.name==="AuthSessionMissingError"}class Hs extends zr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class wa extends zr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Va extends zr{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function GP(t){return $(t)&&t.name==="AuthImplicitGrantRedirectError"}class nA extends zr{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class HP extends zr{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Uh extends zr{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function yu(t){return $(t)&&t.name==="AuthRetryableFetchError"}class iA extends zr{constructor(e,r,s){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=s}}class $h extends zr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const hl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),oA=` 	
\r=`.split(""),WP=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<oA.length;e+=1)t[oA[e].charCodeAt(0)]=-2;for(let e=0;e<hl.length;e+=1)t[hl[e].charCodeAt(0)]=e;return t})();function aA(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;r(hl[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;r(hl[s]),e.queuedBits-=6}}function Fb(t,e,r){const s=WP[t];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function lA(t){const e=[],r=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{QP(o,s,r)};for(let o=0;o<t.length;o+=1)Fb(t.charCodeAt(o),n,i);return e.join("")}function YP(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function KP(t,e){for(let r=0;r<t.length;r+=1){let s=t.charCodeAt(r);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(t.charCodeAt(r+1)-56320&65535|n)+65536,r+=1}YP(s,e)}}function QP(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let s=1;s<6;s+=1)if((t>>7-s&1)===0){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function An(t){const e=[],r={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<t.length;n+=1)Fb(t.charCodeAt(n),r,s);return new Uint8Array(e)}function XP(t){const e=[];return KP(t,r=>e.push(r)),new Uint8Array(e)}function Cs(t){const e=[],r={queue:0,queuedBits:0},s=n=>{e.push(n)};return t.forEach(n=>aA(n,r,s)),aA(null,r,s),e.join("")}function JP(t){return Math.round(Date.now()/1e3)+t}function ZP(){return Symbol("auth-callback")}const et=()=>typeof window<"u"&&typeof document<"u",cs={tested:!1,writable:!1},Lb=()=>{if(!et())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(cs.tested)return cs.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),cs.tested=!0,cs.writable=!0}catch{cs.tested=!0,cs.writable=!1}return cs.writable};function eR(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return r.searchParams.forEach((s,n)=>{e[n]=s}),e}const Ub=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),tR=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",ln=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},us=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Je=async(t,e)=>{await t.removeItem(e)};class Xl{constructor(){this.promise=new Xl.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}Xl.promiseConstructor=Promise;function va(t){const e=t.split(".");if(e.length!==3)throw new $h("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!FP.test(e[s]))throw new $h("JWT not in base64url format");return{header:JSON.parse(lA(e[0])),payload:JSON.parse(lA(e[1])),signature:An(e[2]),raw:{header:e[0],payload:e[1]}}}async function rR(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function sR(t,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function nR(t){return("0"+t.toString(16)).substr(-2)}function iR(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=r.length;let n="";for(let i=0;i<56;i++)n+=r.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,nR).join("")}async function oR(t){const r=new TextEncoder().encode(t),s=await crypto.subtle.digest("SHA-256",r),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function aR(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await oR(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ws(t,e,r=!1){const s=iR();let n=s;r&&(n+="/PASSWORD_RECOVERY"),await ln(t,`${e}-code-verifier`,n);const i=await aR(s);return[i,s===i?"plain":"s256"]}const lR=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function cR(t){const e=t.headers.get(Lh);if(!e||!e.match(lR))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function uR(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function hR(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const dR=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ys(t){if(!dR.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function qu(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const s=r.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function fR(t,e){return new Proxy(t,{get:(r,s,n)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const i=s.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,s,n)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(r,s,n)}})}function cA(t){return JSON.parse(JSON.stringify(t))}const bs=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),pR=[502,503,504];async function uA(t){var e;if(!tR(t))throw new Uh(bs(t),0);if(pR.includes(t.status))throw new Uh(bs(t),t.status);let r;try{r=await t.json()}catch(i){throw new Vs(bs(i),i)}let s;const n=cR(t);if(n&&n.getTime()>=zb["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?s=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(s=r.error_code),s){if(s==="weak_password")throw new iA(bs(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new Rt}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new iA(bs(r),t.status,r.weak_password.reasons);throw new UP(bs(r),t.status||500,s)}const mR=(t,e,r,s)=>{const n={method:t,headers:e?.headers||{}};return t==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))};async function Y(t,e,r,s){var n;const i=Object.assign({},s?.headers);i[Lh]||(i[Lh]=zb["2024-01-01"].name),s?.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(n=s?.query)!==null&&n!==void 0?n:{};s?.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await gR(t,e,r+a,{headers:i,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(l):{data:Object.assign({},l),error:null}}async function gR(t,e,r,s,n,i){const o=mR(e,s,n,i);let a;try{a=await t(r,Object.assign({},o))}catch(l){throw console.error(l),new Uh(bs(l),0)}if(a.ok||await uA(a),s?.noResolveJson)return a;try{return await a.json()}catch(l){await uA(l)}}function er(t){var e;let r=null;qR(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=JP(t.expires_in)));const s=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:s},error:null}}function hA(t){const e=er(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,s)=>r&&typeof s=="string",!0)&&(e.data.weak_password=t.weak_password),e}function $r(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function AR(t){return{data:t,error:null}}function yR(t){const{action_link:e,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i}=t,o=Yl(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function dA(t){return t}function qR(t){return t.access_token&&t.refresh_token&&t.expires_in}const xu=["global","local","others"];class xR{constructor({url:e="",headers:r={},fetch:s}){this.url=e,this.headers=r,this.fetch=Ub(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,r=xu[0]){if(xu.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${xu.join(", ")}`);try{return await Y(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if($(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,r={}){try{return await Y(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:$r})}catch(s){if($(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:r}=e,s=Yl(e,["options"]),n=Object.assign(Object.assign({},s),r);return"newEmail"in s&&(n.new_email=s?.newEmail,delete n.newEmail),await Y(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:yR,redirectTo:r?.redirectTo})}catch(r){if($(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await Y(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:$r})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,s,n,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await Y(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:dA});if(u.error)throw u.error;const h=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,d=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return d.length>0&&(d.forEach(m=>{const g=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),A=JSON.parse(m.split(";")[1].split("=")[1]);c[`${A}Page`]=g}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if($(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Ys(e);try{return await Y(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:$r})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){Ys(e);try{return await Y(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:$r})}catch(s){if($(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,r=!1){Ys(e);try{return await Y(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:$r})}catch(s){if($(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Ys(e.userId);try{const{data:r,error:s}=await Y(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:r,error:s}}catch(r){if($(r))return{data:null,error:r};throw r}}async _deleteFactor(e){Ys(e.userId),Ys(e.id);try{return{data:await Y(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if($(r))return{data:null,error:r};throw r}}async _listOAuthClients(e){var r,s,n,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await Y(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:dA});if(u.error)throw u.error;const h=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,d=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return d.length>0&&(d.forEach(m=>{const g=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),A=JSON.parse(m.split(";")[1].split("=")[1]);c[`${A}Page`]=g}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if($(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await Y(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if($(r))return{data:null,error:r};throw r}}async _getOAuthClient(e){try{return await Y(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if($(r))return{data:null,error:r};throw r}}async _updateOAuthClient(e,r){try{return await Y(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:r,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if($(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await Y(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if($(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(e){try{return await Y(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if($(r))return{data:null,error:r};throw r}}}function fA(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const Ks={debug:!!(globalThis&&Lb()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class $b extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class bR extends $b{}async function wR(t,e,r){Ks.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Ks.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){Ks.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,n.name);try{return await r()}finally{Ks.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,n.name)}}else{if(e===0)throw Ks.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new bR(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Ks.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function VR(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Gb(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function vR(t){return parseInt(t,16)}function _R(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function SR(t){var e;const{chainId:r,domain:s,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:h,version:f}=t;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const d=Gb(t.address),m=u?`${u}://${s}`:s,g=t.statement?`${t.statement}
`:"",A=`${m} wants you to sign in with your Ethereum account:
${d}

${g}`;let y=`URI: ${h}
Version: ${f}
Chain ID: ${r}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(n&&(y+=`
Expiration Time: ${n.toISOString()}`),a&&(y+=`
Not Before: ${a.toISOString()}`),l&&(y+=`
Request ID: ${l}`),c){let b=`
Resources:`;for(const q of c){if(!q||typeof q!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${q}`);b+=`
- ${q}`}y+=b}return`${A}
${y}`}class Le extends Error{constructor({message:e,code:r,cause:s,name:n}){var i;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(i=n??(s instanceof Error?s.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=r}}class dl extends Le{constructor(e,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:e}),this.name="WebAuthnUnknownError",this.originalError=r}}function kR({error:t,options:e}){var r,s,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Le({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Le({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Le({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Le({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new Le({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new Le({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Le({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Le({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(Hb(o)){if(i.rp.id!==o)return new Le({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Le({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Le({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new Le({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Le({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function CR({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Le({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new Le({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const s=window.location.hostname;if(Hb(s)){if(r.rpId!==s)return new Le({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Le({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new Le({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Le({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class ER{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const TR=new ER;function PR(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:r,excludeCredentials:s}=t,n=Yl(t,["challenge","user","excludeCredentials"]),i=An(e).buffer,o=Object.assign(Object.assign({},r),{id:An(r.id).buffer}),a=Object.assign(Object.assign({},n),{challenge:i,user:o});if(s&&s.length>0){a.excludeCredentials=new Array(s.length);for(let l=0;l<s.length;l++){const c=s[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:An(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function RR(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:r}=t,s=Yl(t,["challenge","allowCredentials"]),n=An(e).buffer,i=Object.assign(Object.assign({},s),{challenge:n});if(r&&r.length>0){i.allowCredentials=new Array(r.length);for(let o=0;o<r.length;o++){const a=r[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:An(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function MR(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:Cs(new Uint8Array(t.response.attestationObject)),clientDataJSON:Cs(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function IR(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t,s=t.getClientExtensionResults(),n=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Cs(new Uint8Array(n.authenticatorData)),clientDataJSON:Cs(new Uint8Array(n.clientDataJSON)),signature:Cs(new Uint8Array(n.signature)),userHandle:n.userHandle?Cs(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Hb(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function pA(){var t,e;return!!(et()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function jR(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new dl("Browser returned unexpected credential type",e)}:{data:null,error:new dl("Empty credential response",e)}}catch(e){return{data:null,error:kR({error:e,options:t})}}}async function OR(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new dl("Browser returned unexpected credential type",e)}:{data:null,error:new dl("Empty credential response",e)}}catch(e){return{data:null,error:CR({error:e,options:t})}}}const NR={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},BR={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function fl(...t){const e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),r=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),s={};for(const n of t)if(n)for(const i in n){const o=n[i];if(o!==void 0)if(Array.isArray(o))s[i]=o;else if(r(o))s[i]=o;else if(e(o)){const a=s[i];e(a)?s[i]=fl(a,o):s[i]=fl(o)}else s[i]=o}return s}function DR(t,e){return fl(NR,t,e||{})}function zR(t,e){return fl(BR,t,e||{})}class FR{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:r,friendlyName:s,signal:n},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:r});if(!o)return{data:null,error:a};const l=n??TR.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:c}=o.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${s}`),c.displayName||(c.displayName=c.name)}switch(o.webauthn.type){case"create":{const c=DR(o.webauthn.credential_options.publicKey,i?.create),{data:u,error:h}=await jR({publicKey:c,signal:l});return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}case"request":{const c=zR(o.webauthn.credential_options.publicKey,i?.request),{data:u,error:h}=await OR(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:c,signal:l}));return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}}}catch(o){return $(o)?{data:null,error:o}:{data:null,error:new Vs("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:r,webauthn:s}){return this.client.mfa.verify({factorId:r,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!r)return{data:null,error:new oo("rpId is required for WebAuthn authentication")};try{if(!pA())return{data:null,error:new Vs("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:r,rpOrigins:s},signal:n},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:r,rpOrigins:s,credential_response:l.credential_response}})}catch(o){return $(o)?{data:null,error:o}:{data:null,error:new Vs("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!r)return{data:null,error:new oo("rpId is required for WebAuthn registration")};try{if(!pA())return{data:null,error:new Vs("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(u=>{var h;return(h=u.data)===null||h===void 0?void 0:h.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===e&&f.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u?.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:r,rpOrigins:s},signal:n},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:r,rpOrigins:s,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return $(o)?{data:null,error:o}:{data:null,error:new Vs("Unexpected error in register",o)}}}}VR();const LR={url:BP,storageKey:DP,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:zP,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function mA(t,e,r){return await r()}const Qs={};class ao{get jwks(){var e,r;return(r=(e=Qs[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Qs[this.storageKey]=Object.assign(Object.assign({},Qs[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Qs[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Qs[this.storageKey]=Object.assign(Object.assign({},Qs[this.storageKey]),{cachedAt:e})}constructor(e){var r,s,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},LR),e);if(this.storageKey=i.storageKey,this.instanceID=(r=ao.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,ao.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&et()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new xR({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Ub(i.fetch),this.lock=i.lock||mA,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,this.lockAcquireTimeout=i.lockAcquireTimeout,i.lock?this.lock=i.lock:this.persistSession&&et()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=wR:this.lock=mA,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new FR(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:Lb()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=fA(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=fA(this.memoryStorage)),et()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(a){this._debug("#broadcastChannel","error",a)}})}this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Db}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r={},s="none";if(et()&&(r=eR(window.location.href),this._isImplicitGrantCallback(r)?s="implicit":await this._isPKCECallback(r)&&(s="pkce")),et()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(r,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),GP(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return{error:i}}const{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return $(r)?this._returnResult({error:r}):this._returnResult({error:new Vs("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,s,n;try{const i=await Y(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:er}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if($(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var r,s,n;try{let i;if("email"in e){const{email:u,password:h,options:f}=e;let d=null,m=null;this.flowType==="pkce"&&([d,m]=await Ws(this.storage,this.storageKey)),i=await Y(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:u,password:h,data:(r=f?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:d,code_challenge_method:m},xform:er})}else if("phone"in e){const{phone:u,password:h,options:f}=e;i=await Y(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=f?.data)!==null&&s!==void 0?s:{},channel:(n=f?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:er})}else throw new wa("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return await Je(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let r;if("email"in e){const{email:i,password:o,options:a}=e;r=await Y(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:hA})}else if("phone"in e){const{phone:i,password:o,options:a}=e;r=await Y(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:hA})}else throw new wa("You must provide either an email or phone number and a password");const{data:s,error:n}=r;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!s||!s.session||!s.user){const i=new Hs;return this._returnResult({data:{user:null,session:null},error:i})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(r){if($(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(e){var r,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;switch(r){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(e){var r,s,n,i,o,a,l,c,u,h,f;let d,m;if("message"in e)d=e.message,m=e.signature;else{const{chain:g,wallet:A,statement:y,options:b}=e;let q;if(et())if(typeof A=="object")q=A;else{const k=window;if("ethereum"in k&&typeof k.ethereum=="object"&&"request"in k.ethereum&&typeof k.ethereum.request=="function")q=k.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof A!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");q=A}const x=new URL((r=b?.url)!==null&&r!==void 0?r:window.location.href),V=await q.request({method:"eth_requestAccounts"}).then(k=>k).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!V||V.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const _=Gb(V[0]);let w=(s=b?.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!w){const k=await q.request({method:"eth_chainId"});w=vR(k)}const S={domain:x.host,address:_,statement:y,uri:x.href,version:"1",chainId:w,nonce:(n=b?.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(i=b?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=b?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=b?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=b?.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=b?.signInWithEthereum)===null||u===void 0?void 0:u.resources};d=SR(S),m=await q.request({method:"personal_sign",params:[_R(d),_]})}try{const{data:g,error:A}=await Y(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:d,signature:m},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:er});if(A)throw A;if(!g||!g.session||!g.user){const y=new Hs;return this._returnResult({data:{user:null,session:null},error:y})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:A})}catch(g){if($(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async signInWithSolana(e){var r,s,n,i,o,a,l,c,u,h,f,d;let m,g;if("message"in e)m=e.message,g=e.signature;else{const{chain:A,wallet:y,statement:b,options:q}=e;let x;if(et())if(typeof y=="object")x=y;else{const _=window;if("solana"in _&&typeof _.solana=="object"&&("signIn"in _.solana&&typeof _.solana.signIn=="function"||"signMessage"in _.solana&&typeof _.solana.signMessage=="function"))x=_.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!q?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=y}const V=new URL((r=q?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in x&&x.signIn){const _=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},q?.signInWithSolana),{version:"1",domain:V.host,uri:V.href}),b?{statement:b}:null));let w;if(Array.isArray(_)&&_[0]&&typeof _[0]=="object")w=_[0];else if(_&&typeof _=="object"&&"signedMessage"in _&&"signature"in _)w=_;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in w&&"signature"in w&&(typeof w.signedMessage=="string"||w.signedMessage instanceof Uint8Array)&&w.signature instanceof Uint8Array)m=typeof w.signedMessage=="string"?w.signedMessage:new TextDecoder().decode(w.signedMessage),g=w.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${V.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${V.href}`,`Issued At: ${(n=(s=q?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=q?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${q.signInWithSolana.notBefore}`]:[],...!((o=q?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${q.signInWithSolana.expirationTime}`]:[],...!((a=q?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${q.signInWithSolana.chainId}`]:[],...!((l=q?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${q.signInWithSolana.nonce}`]:[],...!((c=q?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${q.signInWithSolana.requestId}`]:[],...!((h=(u=q?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...q.signInWithSolana.resources.map(w=>`- ${w}`)]:[]].join(`
`);const _=await x.signMessage(new TextEncoder().encode(m),"utf8");if(!_||!(_ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=_}}try{const{data:A,error:y}=await Y(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Cs(g)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(d=e.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:er});if(y)throw y;if(!A||!A.session||!A.user){const b=new Hs;return this._returnResult({data:{user:null,session:null},error:b})}return A.session&&(await this._saveSession(A.session),await this._notifyAllSubscribers("SIGNED_IN",A.session)),this._returnResult({data:Object.assign({},A),error:y})}catch(A){if($(A))return this._returnResult({data:{user:null,session:null},error:A});throw A}}async _exchangeCodeForSession(e){const r=await us(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(r??"").split("/");try{if(!s&&this.flowType==="pkce")throw new HP;const{data:i,error:o}=await Y(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:er});if(await Je(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new Hs;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:r,provider:s,token:n,access_token:i,nonce:o}=e,a=await Y(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:er}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const u=new Hs;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(r){if($(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(e){var r,s,n,i,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Ws(this.storage,this.storageKey));const{error:h}=await Y(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=l?.data)!==null&&r!==void 0?r:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await Y(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c?.message_id},error:u})}throw new wa("You must provide either an email or phone number.")}catch(a){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var r,s;try{let n,i;"options"in e&&(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await Y(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:er});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(n){if($(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(e){var r,s,n,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await Ws(this.storage,this.storageKey));const c=await Y(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:AR});return!((i=c.data)===null||i===void 0)&&i.url&&et()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:s}=e;if(s)throw s;if(!r)throw new Rt;const{error:n}=await Y(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if($(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:o}=await Y(this.fetch,"POST",r,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:o,error:a}=await Y(this.fetch,"POST",r,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:a})}throw new wa("You must provide either an email or phone number and a type")}catch(r){if($(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await r()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=r();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await us(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<gu:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const o=await us(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=qu()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=fR(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const r=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(e){try{return e?await Y(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:$r}):await this._useSession(async r=>{var s,n,i;const{data:o,error:a}=r;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Rt}:await Y(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:$r})})}catch(r){if($(r))return Au(r)&&(await this._removeSession(),await Je(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new Rt;const o=n.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Ws(this.storage,this.storageKey));const{data:c,error:u}=await Y(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:$r});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(s){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Rt;const r=Date.now()/1e3;let s=r,n=!0,i=null;const{payload:o}=va(e.access_token);if(o.exp&&(s=o.exp,n=s<=r),n){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-r,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(r){if($(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var s;if(!e){const{data:o,error:a}=r;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new Rt;const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if($(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(e,r){try{if(!et())throw new Va("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Va(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new nA("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Va("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new nA("No code detected.");const{data:b,error:q}=await this._exchangeCodeForSession(e.code);if(q)throw q;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!i||!a||!o||!c)throw new Va("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let f=u+h;l&&(f=parseInt(l));const d=f-u;d*1e3<=an&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);const m=f-h;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,f,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,f,u);const{data:g,error:A}=await this._getUser(i);if(A)throw A;const y={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:f,refresh_token:o,token_type:c,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:y,redirectType:e.type},error:null})}catch(s){if($(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await us(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var s;const{data:n,error:i}=r;if(i&&!Au(i))return this._returnResult({error:i});const o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!($P(a)&&(a.status===404||a.status===401||a.status===403)||Au(a)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Je(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const r=ZP(),s={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,s),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async r=>{var s,n;try{const{data:{session:i},error:o}=r;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,r={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await Ws(this.storage,this.storageKey,!0));try{return await Y(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(i){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:r,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var r;try{const{data:s,error:n}=await this._useSession(async i=>{var o,a,l,c,u;const{data:h,error:f}=i;if(f)throw f;const d=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await Y(this.fetch,"GET",d,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return et()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(s?.url),this._returnResult({data:{provider:e.provider,url:s?.url},error:null})}catch(s){if($(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async r=>{var s;try{const{error:n,data:{session:i}}=r;if(n)throw n;const{options:o,provider:a,token:l,access_token:c,nonce:u}=e,h=await Y(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=i?.access_token)!==null&&s!==void 0?s:void 0,body:{provider:a,id_token:l,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:er}),{data:f,error:d}=h;return d?this._returnResult({data:{user:null,session:null},error:d}):!f||!f.session||!f.user?this._returnResult({data:{user:null,session:null},error:new Hs}):(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),this._returnResult({data:f,error:d}))}catch(n){if(await Je(this.storage,`${this.storageKey}-code-verifier`),$(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(e){try{return await this._useSession(async r=>{var s,n;const{data:i,error:o}=r;if(o)throw o;return await Y(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const s=Date.now();return await sR(async n=>(n>0&&await rR(200*Math.pow(2,n-1)),this._debug(r,"refreshing attempt",n),await Y(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:er})),(n,i)=>{const o=200*Math.pow(2,n);return i&&yu(i)&&Date.now()+o-s<an})}catch(s){if(this._debug(r,"error",s),$(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",s),et()&&!r.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,r;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await us(this.storage,this.storageKey);if(n&&this.userStorage){let o=await us(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await ln(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o?.user)!==null&&e!==void 0?e:qu()}else if(n&&!n.user&&!n.user){const o=await us(this.storage,this.storageKey+"-user");o&&o?.user?(n.user=o.user,await Je(this.storage,this.storageKey+"-user"),await ln(this.storage,this.storageKey,n)):n.user=qu()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}const i=((r=n.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<gu;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${gu}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),yu(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(n.access_token);!a&&o?.user?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n),console.error(n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var r,s;if(!e)throw new Rt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Xl;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Rt;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(n,"error",i),$(i)){const o={data:null,error:i};return yu(i)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,r,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",r,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:r});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,r)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Je(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},e),s=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&r.user&&await ln(this.userStorage,this.storageKey+"-user",{user:r.user});const n=Object.assign({},r);delete n.user;const i=cA(n);await ln(this.storage,this.storageKey,i)}else{const n=cA(r);await ln(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Je(this.storage,this.storageKey),await Je(this.storage,this.storageKey+"-code-verifier"),await Je(this.storage,this.storageKey+"-user"),this.userStorage&&await Je(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&et()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),an);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const r=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:s}}=r;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/an);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${an}ms, refresh threshold is ${Fh} ticks`),n<=Fh&&await this._callRefreshToken(s.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof $b)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!et()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,s){const n=[`provider=${encodeURIComponent(r)}`];if(s?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await Ws(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(s?.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s?.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var s;const{data:n,error:i}=r;return i?this._returnResult({data:null,error:i}):await Y(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token})})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(e){try{return await this._useSession(async r=>{var s,n;const{data:i,error:o}=r;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await Y(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((n=l?.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var s;const{data:n,error:i}=r;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?MR(e.webauthn.credential_response):IR(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await Y(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var s;const{data:n,error:i}=r;if(i)return this._returnResult({data:null,error:i});const o=await Y(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:PR(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:RR(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(e){const{data:r,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){var e;const{data:{user:r},error:s}=await this.getUser();if(s)return{data:null,error:s};const n={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=r?.factors)!==null&&e!==void 0?e:[])n.all.push(i),i.status==="verified"&&n[i.factor_type].push(i);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(e){var r,s,n,i;if(e)try{const{payload:d}=va(e);let m=null;d.aal&&(m=d.aal);let g=m;const{data:{user:A},error:y}=await this.getUser(e);if(y)return this._returnResult({data:null,error:y});((s=(r=A?.factors)===null||r===void 0?void 0:r.filter(x=>x.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(g="aal2");const q=d.amr||[];return{data:{currentLevel:m,nextLevel:g,currentAuthenticationMethods:q},error:null}}catch(d){if($(d))return this._returnResult({data:null,error:d});throw d}const{data:{session:o},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=va(o.access_token);let c=null;l.aal&&(c=l.aal);let u=c;((i=(n=o.user.factors)===null||n===void 0?void 0:n.filter(d=>d.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(u="aal2");const f=l.amr||[];return{data:{currentLevel:c,nextLevel:u,currentAuthenticationMethods:f},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;return n?this._returnResult({data:null,error:n}):s?await Y(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Rt})})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(e,r){try{return await this._useSession(async s=>{const{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new Rt});const o=await Y(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&et()&&!r?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if($(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,r){try{return await this._useSession(async s=>{const{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new Rt});const o=await Y(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&et()&&!r?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if($(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:r},error:s}=e;return s?this._returnResult({data:null,error:s}):r?await Y(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new Rt})})}catch(e){if($(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;return n?this._returnResult({data:null,error:n}):s?(await Y(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Rt})})}catch(r){if($(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,r={keys:[]}){let s=r.keys.find(a=>a.kid===e);if(s)return s;const n=Date.now();if(s=this.jwks.keys.find(a=>a.kid===e),s&&this.jwks_cached_at+LP>n)return s;const{data:i,error:o}=await Y(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,s=i.keys.find(a=>a.kid===e),!s)?null:s}async getClaims(e,r={}){try{let s=e;if(!s){const{data:d,error:m}=await this.getSession();if(m||!d.session)return this._returnResult({data:null,error:m});s=d.session.access_token}const{header:n,payload:i,signature:o,raw:{header:a,payload:l}}=va(s);r?.allowExpired||uR(i.exp);const c=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!c){const{error:d}=await this.getUser(s);if(d)throw d;return{data:{claims:i,header:n,signature:o},error:null}}const u=hR(n.alg),h=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,o,XP(`${a}.${l}`)))throw new $h("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if($(s))return this._returnResult({data:null,error:s});throw s}}}ao.nextInstanceID={};const UR=ao,$R="2.93.1";let ki="";typeof Deno<"u"?ki="deno":typeof document<"u"?ki="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ki="react-native":ki="node";function GR(){const t=globalThis.process;if(t&&t.platform){const e=t.platform;if(e==="darwin")return"macOS";if(e==="win32")return"Windows";if(e==="linux")return"Linux";if(e==="android")return"Android"}if(typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platform){const e=navigator.userAgentData.platform;if(e==="macOS")return"macOS";if(e==="Windows")return"Windows";if(e==="Linux")return"Linux";if(e==="Android")return"Android";if(e==="iOS")return"iOS"}return null}function HR(){const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node&&typeof window>"u")try{const r=globalThis.require;if(r)return r("os").release()}catch{return null}}if(typeof Deno<"u"&&Deno.osRelease)try{return Deno.osRelease()}catch{return null}return typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platformVersion?navigator.userAgentData.platformVersion:null}function WR(){if(typeof Deno<"u")return"deno";if(typeof Bun<"u")return"bun";const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node)return"node"}return null}function YR(){if(typeof Deno<"u"&&Deno.version)return Deno.version.deno;if(typeof Bun<"u"&&Bun.version)return Bun.version;const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node)return e.node}return null}function KR(){const t={"X-Client-Info":`supabase-js-${ki}/${$R}`},e=GR();e&&(t["X-Supabase-Client-Platform"]=e);const r=HR();r&&(t["X-Supabase-Client-Platform-Version"]=r);const s=WR();s&&(t["X-Supabase-Client-Runtime"]=s);const n=YR();return n&&(t["X-Supabase-Client-Runtime-Version"]=n),t}const QR=KR(),XR={headers:QR},JR={schema:"public"},ZR={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},eM={};function lo(t){"@babel/helpers - typeof";return lo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lo(t)}function tM(t,e){if(lo(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e);if(lo(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function rM(t){var e=tM(t,"string");return lo(e)=="symbol"?e:e+""}function sM(t,e,r){return(e=rM(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function gA(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,s)}return r}function je(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?gA(Object(r),!0).forEach(function(s){sM(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):gA(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}const nM=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),iM=()=>Headers,oM=(t,e,r)=>{const s=nM(r),n=iM();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:t;let c=new n(o?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(i,je(je({},o),{},{headers:c}))}};function aM(t){return t.endsWith("/")?t:t+"/"}function lM(t,e){var r,s;const{db:n,auth:i,realtime:o,global:a}=t,{db:l,auth:c,realtime:u,global:h}=e,f={db:je(je({},l),n),auth:je(je({},c),i),realtime:je(je({},u),o),storage:{},global:je(je(je({},h),a),{},{headers:je(je({},(r=h?.headers)!==null&&r!==void 0?r:{}),(s=a?.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return t.accessToken?f.accessToken=t.accessToken:delete f.accessToken,f}function cM(t){const e=t?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(aM(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var uM=class extends UR{constructor(t){super(t)}},hM=class{constructor(t,e,r){var s,n;this.supabaseUrl=t,this.supabaseKey=e;const i=cM(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a={db:JR,realtime:eM,auth:je(je({},ZR),{},{storageKey:o}),global:XR},l=lM(r??{},a);if(this.storageKey=(s=l.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=l.global.headers)!==null&&n!==void 0?n:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(u,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=oM(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(je({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(u=>this.realtime.setAuth(u)).catch(u=>console.warn("Failed to set initial Realtime auth token:",u)),this.rest=new UT(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new NP(this.storageUrl.href,this.headers,this.fetch,r?.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new BT(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,r)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,r;if(t.accessToken)return await t.accessToken();const{data:s}=await t.auth.getSession();return(e=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,userStorage:n,storageKey:i,flowType:o,lock:a,debug:l,throwOnError:c},u,h){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new uM({url:this.authUrl.href,headers:je(je({},f),u),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,userStorage:n,flowType:o,lock:a,debug:l,throwOnError:c,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(d=>d.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new oP(this.realtimeUrl.href,je(je({},t),{},{params:je(je({},{apikey:this.supabaseKey}),t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e?.access_token)})}_handleTokenChanged(t,e,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const dM=(t,e,r)=>new hM(t,e,r);function fM(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const r=e.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}fM()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const gf=dM("https://pkswdnpftrundnewgnya.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrc3dkbnBmdHJ1bmRuZXdnbnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODI2MzIsImV4cCI6MjA2ODI1ODYzMn0.r_Y1RLOGJ55C0De5SBTVXqO09SMDqgV38sQuE-oDxXE"),pM=async t=>{if(t.locator.campaignName===void 0)throw new Error("can not save a campaign without a name");const e=await gf.rpc("save_campaign_version",{p_name:t.locator.campaignName,p_data:await IT(t),p_published:t.meta?.published??!1});if(e.error)throw new Error(`error saving to db ${e.error.message} ${e.error.details}`,{cause:e.error});return e.data},mM=async t=>{const e=await gf.rpc("get_latest_campaign",{p_campaign_name:t.campaignName,p_user_id:t.userId,p_version:t.version===-1?void 0:t.version});if(e.error)throw new Error("could not get campaign",{cause:e.error});const r=await Pb(e.data.data);return Object.values(r.rooms).forEach(s=>{delete s.size}),r.locator===void 0&&(r.locator={userId:t.userId||"upgraded, unknown",campaignName:t.campaignName,version:e.data.version}),delete r.name,r},gM=async({publishedOnly:t})=>{const e=await gf.rpc("get_all_users_latest_campaigns",{p_published_only:t});if(e.error)throw new Error("could not get user campaigns",{cause:e.error});return e.data},zi=t=>{const e=[];for(let r=t;r!==void 0;r=r instanceof Error?r.cause:void 0)r instanceof Error&&e.push({message:r.message,stack:r.stack});return e},ts=Cb({reducerPath:"campaignsApi",baseQuery:J1(),endpoints:t=>({getCampaign:t.query({async queryFn(e){try{return e.userId==="@@original"&&e.campaignName==="original"?{data:(await bT()).campaign}:e.campaignName.startsWith("data:")?{data:await Pb(e.campaignName.substring(5))}:{data:await mM(e)}}catch(r){return{error:zi(new Error(`getCampaign queryFn( ${JSON.stringify(e)} ) failed: ${r}`))}}}}),getAllUsersLatestCampaigns:t.query({async queryFn({publishedOnly:e}){try{return{data:await gM({publishedOnly:e})}}catch(r){return{error:zi(new Error(`getAllUsersLatestCampaigns queryFn() failed: ${r}`))}}}}),saveCampaign:t.mutation({async queryFn(e){try{return{data:await pM(e)}}catch(r){return{error:zi(new Error(`saveCampaign queryFn( ${JSON.stringify(e)} ) failed: ${r}`))}}}})})}),{useGetAllUsersLatestCampaignsQuery:Wb}=ts,AM=ts.endpoints.getCampaign.select,yM=(t,e)=>AM(e)(t).data,ft=t=>e=>cl(e.gameMenus.userSettings,t)??cl(es,t),pl=ft("inputAssignment"),P$=t=>t.gameMenus.openMenus.length>0,Yb=()=>X(t=>t.gameMenus.cheatsOn),Kb=t=>t.gameMenus.assigningInput!==void 0,Qb=()=>X(Kb),qM=t=>{if(t.gameMenus.userSettings.inputAssignment===void 0)return"Default";for(const[e,r]of Qe(sx(Vn)))if(M1(r.inputAssignment,t.gameMenus.userSettings.inputAssignment))return e},Sn=()=>X(t=>t.gameMenus.gameRunning),xM=ft("showFps"),Jl=ft("displaySettings.emulatedResolution"),Af=ft("gameSpeed"),bM=()=>X(Jl),wM=ft("displaySettings.uncolourised"),yf=()=>X(wM),VM=ft("displaySettings.crtFilter"),Xb=ft("infiniteLivesPoke"),Jb=ft("infiniteDoughnutsPoke"),R$=t=>t.gameMenus.gameInPlay.planetsLiberated.egyptus&&t.gameMenus.gameInPlay.planetsLiberated.bookworld&&t.gameMenus.gameInPlay.planetsLiberated.penitentiary&&t.gameMenus.gameInPlay.planetsLiberated.safari,qf=ft("directionsRelativeTo"),xf=()=>X(qf),bf=ft("inputDirectionMode"),Zb=()=>X(bf),vM=t=>dh(Qe(Dr(t.gameMenus.gameInPlay.planetsLiberated)).filter(Boolean)),_M=ft("displaySettings.showBoundingBoxes"),M$=()=>X(_M),SM=ft("displaySettings.showShadowMasks"),I$=()=>X(SM),kM=ft("onScreenControls"),CM=ft("soundSettings.mute"),EM=ft("soundSettings.noFootsteps"),TM=ft("soundSettings.noRoomEntryTunes"),j$=({gameMenus:t})=>t.userSettings.onScreenControls??es.onScreenControls,PM=()=>X(kM),RM=(t,e)=>!!(cl(t.userSettings,e)??cl(es,e)??!1),MM=()=>X(t=>t.gameMenus.gameInPlay.roomsExplored),ew=t=>{const e=IM(t);if(!e)throw new Error(`No current campaign. Campaign locator is:
${JSON.stringify(t.gameMenus.gameInPlay.campaignLocator,null,2)}`);return e},tw=lf(ew),IM=t=>{const e=t.gameMenus.gameInPlay.campaignLocator;return e===void 0?void 0:yM(t,e)},Gh=[1,1.2,1.5,2],O$=["none","non-wall","all"],mi=t=>J0(eo(t,"userId","campaignName")),rw=["4-way","8-way","analogue"],jM=yt()!=="server",OM=jM?Wt().has("cheats"):!1,NM={blacktooth:!1,bookworld:!1,egyptus:!1,penitentiary:!1,safari:!1},Hh={planetsLiberated:NM,roomsExplored:{},scrollsRead:{},reincarnationPoint:void 0,freeCharacters:{}},Wh={userSettings:T1,gameRunning:!1,gameInPlay:Hh,openMenus:[{menuId:"mainMenu",scrollableSelection:!1,menuParam:me}],assigningInput:void 0,cheatsOn:OM,savedGames:{saves:{}}},Po=Sr({name:"gameMenus",initialState:Wh,reducers:{setEmulatedResolution(t,{payload:e}){let r;e===void 0?r=fa(S1,Jl({gameMenus:t})):r=e,t.userSettings.displaySettings.emulatedResolution=r},setGameSpeed(t,{payload:e}){let r;e===void 0?r=fa(Gh,Af({gameMenus:t})):r=e,t.userSettings.gameSpeed=r},scrollRead(t,{payload:e}){e.source==="manual"?(t.gameInPlay.scrollsRead[e.page]=!0,t.openMenus=[{menuId:`markdown/${e.page}`,scrollableSelection:!1,menuParam:me}]):t.openMenus=[{menuId:"markdown/inline",scrollableSelection:!1,menuParam:{markdown:e.markdown}}]},nextInputDirectionMode(t){t.userSettings.inputDirectionMode=fa(rw,bf({gameMenus:t}))},nextDirectionRelativeTo(t){t.userSettings.directionsRelativeTo=fa(Ab,qf({gameMenus:t}))},inputAddedDuringAssignment(t,{payload:e}){if(t.assigningInput===void 0)throw new Error("reducer called while not assigning keys");const r=(o,a)=>{o.includes(a)||o.push(a)},{presses:s,axes:n,action:i}=t.assigningInput;switch(e.type){case"key":r(s.keys,e.input);break;case"gamepadButtons":r(s.gamepadButtons,e.input);break;case"gamepadAxes":{pn.includes(i)&&r(n,e.input);break}}},doneAssigningInput(t){if(t.assigningInput===void 0)throw new Error("illegal action for state");const{action:e,presses:r,axes:s}=t.assigningInput,n=r.keys.length+r.gamepadButtons.length+s.length,i=t.userSettings.inputAssignment===void 0?t.userSettings.inputAssignment=structuredClone(Vn.Default.inputAssignment):t.userSettings.inputAssignment;n>0&&(i.presses[e]=r,(e==="left"||e==="right")&&(i.axes.x=s),(e==="towards"||e==="away")&&(i.axes.y=s)),t.assigningInput=void 0},menuOpenOrExitPressed(t){if(t.openMenus.length>0){if(t.openMenus.length===1&&!t.gameRunning)return;const[,...e]=t.openMenus;t.openMenus=e}else t.openMenus=[{menuId:"mainMenu",scrollableSelection:!1,menuParam:me}]},goToSubmenu(t,{payload:e}){t.openMenus=[{menuId:e,scrollableSelection:!1,menuParam:{}},...t.openMenus]},closeAllMenus(t){t.openMenus=[]},gameStarted(t,{payload:{campaignLocator:e,noShowCrowns:r}}){if(t.gameRunning)throw new Error("game is already running");t.openMenus=r?[]:[{menuId:"crowns",scrollableSelection:!1,menuParam:{playMusic:!1}}],t.gameRunning=!0,t.gameInPlay={...Hh,campaignLocator:e}},backToParentMenu(t){const[,...e]=t.openMenus;t.openMenus=e},assignInputStart(t,{payload:e}){t.assigningInput={action:e,presses:{gamepadButtons:[],keys:[]},axes:[]}},keyAssignmentPresetChosen(t,{payload:e}){const[,...r]=t.openMenus;t.openMenus=r,t.userSettings.inputAssignment=Vn[e].inputAssignment},setFocussedMenuItemId(t,{payload:{focussedItemId:e,scrollableSelection:r}}){const[s]=t.openMenus;s.focussedItemId=e,s.scrollableSelection=r},holdPressed(t,{payload:e}){t.openMenus.length>0?t.openMenus[0]?.menuId==="hold"&&e!=="hold"&&(t.openMenus=[]):e!=="unhold"&&(t.openMenus=[{menuId:"hold",scrollableSelection:!1,menuParam:me}])},mapPressed(t){const e={menuId:"map",scrollableSelection:!1,menuParam:me};if(t.openMenus.length>=1){const s=t.openMenus.at(0)?.menuId;if(s==="map"){const[,...n]=t.openMenus;t.openMenus=n}else s==="hold"&&(t.openMenus=[e,...t.openMenus])}else t.openMenus=[e]},setShowBoundingBoxes(t,{payload:e}){t.userSettings.displaySettings.showBoundingBoxes=e},setShowShadowMasks(t,{payload:e}){t.userSettings.displaySettings.showShadowMasks=e},toggleUserSetting(t,{payload:{path:e,value:r}}){E1(t.userSettings,e,r??!RM(t,e))},crownCollected(t,{payload:e}){t.gameInPlay.planetsLiberated[e]=!0;const r=Object.values(t.gameInPlay.planetsLiberated).every(i=>i),n={menuId:"crowns",scrollableSelection:!1,menuParam:{playMusic:!(t.userSettings.soundSettings.mute??es.soundSettings.mute)}};r?t.openMenus=[{menuId:"proclaimEmperor",scrollableSelection:!1,menuParam:me},n]:t.openMenus=[n]},roomExplored(t,{payload:e}){t.gameInPlay.roomsExplored[e]=!0},gameOver(t,{payload:{offerReincarnation:e}}){if(e&&t.gameInPlay.reincarnationPoint!==void 0)t.openMenus=[{menuId:"score",scrollableSelection:!1,menuParam:me},{menuId:"offerReincarnation",scrollableSelection:!1,menuParam:me}];else{t.gameRunning=!1,delete t.gameInPlay.reincarnationPoint;const r=t.gameInPlay.campaignLocator,s=r&&mi(r);s&&(delete t.savedGames.saves[s],delete t.savedGames.lastSavedCampaignLocator),t.openMenus=[{menuId:"score",scrollableSelection:!1,menuParam:me},{menuId:"mainMenu",scrollableSelection:!0,menuParam:me}]}},reincarnationFishEaten(t,{payload:e}){t.gameInPlay.reincarnationPoint=e},reincarnationAccepted(t){delete t.gameInPlay.reincarnationPoint,t.openMenus=[{menuId:"reincarnatedRestart",scrollableSelection:!1,menuParam:me}]},saveGame(t,{payload:e}){const r=t.gameInPlay.campaignLocator;if(r===void 0)throw new Error("trying to save a game, but seems like there's no campaign to save against");if(Ud())throw new Error("shouldn't be saving in playtest mode");t.savedGames.saves[mi(r)]=e,t.savedGames.lastSavedCampaignLocator=r},gameRestoreFromSave(t,{payload:e}){t.gameInPlay={freeCharacters:{},...e},e.freeCharacters===void 0&&(t.gameInPlay.freeCharacters={})},errorCaught(t,{payload:e}){t.openMenus=[{menuId:"errorCaught",scrollableSelection:!1,menuParam:e}]},errorDismissed(t,{payload:e}){switch(e){case"ignore":t.openMenus=[];break;case"clearAllData":Object.assign(t,Wh),t.gameRunning=!1;break}},debugItemClicked(t,e){},characterRoomChange(t,e){},lostLife(t,e){},characterReachesFreedom(t,{payload:e}){t.gameInPlay.freeCharacters[e]=!0}},extraReducers(t){t.addCase(vo,(e,r)=>{if(Wt().get("campaignName")?.startsWith("data:"))return;const s=[{menuId:"hold",scrollableSelection:!1,menuParam:me}],n={userId:Wt().get("campaignAuthorUserId")??void 0,campaignName:Wt().get("campaignName")??void 0},i=r.payload?.savedGames;if((c=>c.userId!==void 0&&c.campaignName!==void 0)(n)){e.gameRunning=!0;const c=i?.saves[mi(n)];if(c){e.gameRunning=!0,e.gameInPlay={freeCharacters:{},...c.store.gameMenus.gameInPlay},e.openMenus=s;return}else{e.gameRunning=!0,e.gameInPlay={...Hh,campaignLocator:n},e.openMenus=s;return}}const a=i?.lastSavedCampaignLocator,l=a&&i.saves[mi(a)];l&&(e.gameRunning=!0,e.gameInPlay={freeCharacters:{},...l.store.gameMenus.gameInPlay},e.openMenus=s)})},selectors:{selectHasError(t){return t.openMenus.some(e=>e.menuId==="errorCaught")},selectSaveForCampaign(t,e){return t.savedGames.saves[mi(e)]}}}),{assignInputStart:Ne,backToParentMenu:qt,characterReachesFreedom:N$,characterRoomChange:sw,closeAllMenus:BM,crownCollected:DM,debugItemClicked:zM,doneAssigningInput:FM,errorCaught:wf,errorDismissed:AA,gameOver:Vf,gameRestoreFromSave:B$,gameStarted:co,goToSubmenu:ut,holdPressed:nw,inputAddedDuringAssignment:LM,keyAssignmentPresetChosen:UM,lostLife:$M,mapPressed:GM,menuOpenOrExitPressed:yA,nextDirectionRelativeTo:HM,nextInputDirectionMode:WM,reincarnationAccepted:vf,reincarnationFishEaten:D$,roomExplored:YM,saveGame:KM,scrollRead:z$,setEmulatedResolution:_f,setFocussedMenuItemId:Sf,setGameSpeed:QM,setShowBoundingBoxes:F$,setShowShadowMasks:L$,toggleUserSetting:Yt}=Po.actions,{selectHasError:U$}=Po.selectors,$$=Po.selectors.selectSaveForCampaign,XM=()=>{const{hostname:t}=window.location;if(t==="localhost"||t.endsWith(".local")||t==="::1"||t==="[::1]")return!0;const e=t.startsWith("[")?t.slice(1,-1):t;if(e.toLowerCase().startsWith("fe80:")||e.toLowerCase().startsWith("fc00:")||e.toLowerCase().startsWith("fd00:")||t.startsWith("127.")||t.startsWith("192.168.")||t.startsWith("10."))return!0;if(t.startsWith("172.")){const r=Number.parseInt(t.split(".")[1]);if(r>=16&&r<=31)return!0}return!1},qA="https://cloud.umami.is/script.js",JM="11813495-5844-44e6-acd4-f81e9c955951",ZM=()=>{const e=Wt().get("track");if(e!==null){const s=e==="1";return console.log(s?" tracking explicitly enabled via query param":" tracking explicitly disabled via query param"),s}const r=XM();return console.log(r?" not tracking because running on local network":" tracking enabled based on non-local network hostname"),!r},eI=gr(Vf,vf,$M,wf,co,DM,sw),tI=()=>{const t=Nq();v.useEffect(()=>Rd({matcher:eI,effect(r,{getState:s}){const n=t?.gameState,[,i]=r.type.split("/"),o=s(),a=n?Math.round(n.gameTime/1e3):void 0,l=r.payload===void 0?{}:r.type==="gameMenus/crownCollected"?{crownForPlanet:r.payload}:r.type==="gameMenus/gameStarted"?void 0:r.type==="gameMenus/lostLife"?{position:r.payload.characterLosingLifeItem.state.position}:r.payload,c={gameTimeSeconds:a,cheatsOn:o.gameMenus.cheatsOn,...l,currentCharacter:n?.currentCharacterName,inRoom:n?.characterRooms[n.currentCharacterName]};window.umami?(console.debug(" umami event:",i,c),window.umami.track(i,c)):console.debug(" no umami for event:",i,c)}}),[t])},rI=()=>{if(document.querySelector(`script[src="${qA}"]`))return;const t=document.createElement("script");t.src=qA,t.dataset.websiteId=JM,t.onload=()=>console.log(" umami script dynamically loaded"),document.head.appendChild(t)},sI=()=>(tI(),v.useEffect(rI,[]),null),nI=()=>{const t=v.useRef(null);return t.current===null&&(t.current=ZM()),t.current?p.jsx(sI,{}):null},iI=Bn(()=>Nn(()=>import("./Cheats-sKiCiaCw.js"),__vite__mapDeps([5,2,3,6,7]))),oI=["moonbase"];function*ml(t,e,r){const s=({x:n,y:i,w:o,h:a,pivot:l})=>e==="x"?{...Kr(r,{x:-n-o-1,y:i}),w:o,h:a,pivot:{x:o-l.x,y:l.y}}:{...Kr(r,{x:n+2,y:i}),w:o,h:a,pivot:l};yield[`door.frame.${t}.${e}.whole`,{frame:{...s({x:-41,y:0,w:40,h:64,pivot:{x:9,y:63}})}}],yield[`door.frame.${t}.${e}.far`,{frame:{...s({x:-18,y:0,w:17,h:57,pivot:{x:9,y:52}})}}],yield[`door.frame.${t}.${e}.near`,{frame:{...s({x:-41,y:6,w:20,h:58,pivot:{x:8,y:58}})}}],yield[`door.frame.${t}.${e}.top`,{frame:{...s({x:-57,y:-1,w:15,h:36,pivot:{x:0,y:37}})}}]}const aI={frames:Un(sS(ml("generic","y",{x:580,y:415}),ml("generic","x",{x:582,y:415})))},hs=(t,{x:e,y:r},s)=>{function*n(){yield[`${t}.left`,{frame:{x:e,y:r,...s}}],yield[`${t}.away`,{frame:{x:e+s.w+1,y:r,...s}}],yield[`${t}.towards`,{frame:{x:e,y:r+s.h+1,...s}}],yield[`${t}.right`,{frame:{x:e+s.w+1,y:r+s.h+1,...s}}]}return Object.fromEntries(n())},ye=(t,e,{x:r,y:s},n,i=e)=>{function*o(){for(let a=0;a<e;a++)yield[`${t}.${a+1}`,{frame:{x:r+a%i*(n.w+1),y:s+Math.floor(a/i)*(n.h+1),...n}}]}return Object.fromEntries(o())},xA=(t,{x:e,y:r},s,n=t.length,i)=>{function*o(){for(let a=0;a<t.length;a++)yield[i?`${i}.${t[a]}`:t[a],{frame:{x:e+a%n*(s.w+1),y:r+Math.floor(a/n)*(s.h+1),...s}}]}return Object.fromEntries(o())},lI=(t,e,r,s)=>({...ye(`${t}.left`,e,r,s),...ye(`${t}.away`,e,Kr(r,{x:(s.w+1)*e}),s),...ye(`${t}.towards`,e,Kr(r,{y:s.h+1}),s),...ye(`${t}.right`,e,Kr(r,{x:(s.w+1)*e,y:s.h+1}),s)}),Ur=(t,e)=>[...Qe(rx(1,e+1)).map(r=>`${t}.${String(r)}`)],cI={frames:{...xA(["share","save","open","pointer","eyedropper"],{x:640,y:10},{w:12,h:12},void 0,"editor.tool"),...xA(["single","corridor","double","triple.line","triple.^","quad.square","quad.s","quad.31","quad.t","5.x"],{x:640,y:0},{w:9,h:9},void 0,"editor.addRoom")}},iw={" ":"space",",":"comma",";":"scolon",":":"colon",".":"dot","'":"sQuote","":"lQuote","":"rQuote","`":"backtick","<":"lt",">":"gt","?":"questMk","!":"exclMk","-":"hyph","/":"slash","\\":"bSlash"},Lt=t=>iw[t].toUpperCase(),ow=t=>iw[t]??t,Yh={w:32,h:16},It={w:16,h:56},te={w:32,h:28},N={w:24,h:24},Ci={w:8,h:8},uI={h:10},O=t=>({x:t.x*(N.w+1)+1,y:t.y*(N.h+1)+2}),oe=t=>({x:t.x*(te.w+1)+1,y:t.y*(te.h+1)+682}),aw="",lw="",hI="",dI="",fI="",pI="",mI=[{char:"a",width:8},{char:"b",width:8},{char:"c",width:7},{char:"d",width:8},{char:"e",width:8},{char:"f",width:6},{char:"g",width:8},{char:"h",width:8},{char:"i",width:4},{char:"j",width:5},{char:"k",width:8},{char:"l",width:5},{char:"m",width:9},{char:"n",width:8},{char:"o",width:8},{char:"p",width:8},{char:"q",width:8},{char:"r",width:5},{char:"s",width:6},{char:"t",width:6},{char:"u",width:8},{char:"v",width:8},{char:"w",width:9},{char:"x",width:8},{char:"y",width:8},{char:"z",width:6},{char:"?",width:6},{char:"!",width:4},{char:".",width:4},{char:",",width:4},{char:";",width:4},{char:":",width:3},{char:"/",width:7},{char:"\\",width:7},{char:"",width:4},{char:"",width:4},{char:"'",width:4},{char:"-",width:5}],gI=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9","_","#","","","","",{char:"",width:16},{char:aw,width:16},{char:lw,width:16}],AI=[" ",Lt("?"),Lt("!"),Lt("."),Lt(","),Lt(";"),Lt(":"),Lt("/"),Lt("\\"),Lt(""),Lt(""),Lt("'"),"`",Lt("-"),"+","%","","","","","","","","","(",")","[","]","<",">","","","","EnterFullscreen","ExitFullscreen","","*","@","",hI,dI,fI,pI,"","","^","","","","","&"],bu=(t,e,r=Ci.h)=>{function*s(){let{x:n}=e;for(let i=0;i<t.length;i++){const o=t[i],a=typeof o=="string"?o:o.char,c=(typeof o=="string"?void 0:o.width)??Ci.w;yield[`hud.char.${ow(a)}`,{frame:{x:n,y:e.y,...Ci,w:c,h:r}}],n+=Math.max(c,Ci.w)+1}}return Un(s())},yI={frames:{...bu(mI,{x:1,y:994},10),...bu(gI,{x:1,y:1005}),...bu(AI,{x:1,y:1014})}},re=(t,e)=>Object.assign([...t],{animationSpeed:e});let ue=0,ae=0;const qI={...ye("dalek",2,O({x:0,y:0}),N),...ye("dalek.dark",2,O({x:0,y:1}),N),"shadowMask.dalek":{frame:{...O({x:2,y:0}),...N}},headlessBase:{frame:{...O({x:7,y:0}),...N}},...ye("headlessBase",4,O({x:8,y:0}),N),"headlessBase.all":{frame:{...O({x:12,y:0}),...N}},...lI("turtle",2,O({x:0,y:3}),N),"shadowMask.turtle.away":{frame:{...O({x:4,y:3}),...N}},"shadowMask.turtle.right":{frame:{...O({x:4,y:4}),...N}},...hs("cyberman",O({x:6,y:3}),N),...hs("skiHead.greenAndPink",O({x:9,y:3}),{w:24,h:32}),...hs("skiHead.starsAndStripes",O({x:11,y:3}),{w:24,h:32}),"shadowMask.skiHead.away":{frame:{...O({x:13,y:3}),...N,h:32}},"shadowMask.skiHead.right":{frame:{...O({x:14,y:3}),...N,h:32}},...hs("charles",O({x:0,y:5}),N),"shadowMask.charles.away":{frame:{...O({x:2,y:5}),...N}},"shadowMask.charles.right":{frame:{...O({x:2,y:6}),...N}},...hs("monkey",O({x:0,y:7}),N),...hs("computerBot",O({x:3,y:7}),N),...hs("elephant",O({x:6,y:7}),N),...ye("helicopterBug",4,O({x:9,y:7}),N),"barrier.x.disappearing":{frame:{...O({x:17,y:0}),...N,pivot:{x:18,y:23}}},"barrier.y.disappearing":{frame:{...O({x:18,y:0}),...N,pivot:{x:6,y:23}}},"barrier.x":{frame:{...O({x:19,y:0}),...N,pivot:{x:18,y:23}}},"barrier.y":{frame:{...O({x:20,y:0}),...N,pivot:{x:6,y:23}}},"shadow.barrier.y":{frame:{...O({x:21,y:0}),...N,pivot:{x:6,y:22}}},"shadowMask.barrier.y":{frame:{...O({x:22,y:0}),...N,pivot:{x:6,y:22}}},"joystick.stick":{frame:{...O({x:18,y:1}),...N}},"joystick.ball":{frame:{...O({x:19,y:1}),...N}},"joystick.whole":{frame:{...O({x:20,y:1}),...N}},"shadowMask.joystick":{frame:{...O({x:21,y:1}),...N}},ball:{frame:{...O({x:17,y:2}),...N}},"shadowMask.ball":{frame:{...O({x:18,y:2}),...N}},"ball.uncolourised":{frame:{...O({x:19,y:2}),...N}},"spikyBall.1":{frame:{...O({x:20,y:2}),...N}},"spikyBall.2":{frame:{...O({x:21,y:2}),...N}},tower:{frame:{...O({x:15,y:3}),...N}},"shadowMask.tower":{frame:{...O({x:16,y:3}),...N}},sticks:{frame:{...O({x:18,y:3}),...N}},cube:{frame:{...O({x:19,y:3}),...N}},drum:{frame:{...O({x:21,y:3}),...N}},"shadowMask.drum":{frame:{...O({x:22,y:3}),...N}},puck:{frame:{...O({x:15,y:4}),...N}},"shadow.smallRound":{frame:{...O({x:16,y:4}),...N}},"shadowMask.smallRound":{frame:{...O({x:17,y:4}),...N}},"spring.compressed":{frame:{...O({x:19,y:4}),...N}},"spring.released":{frame:{...O({x:20,y:4}),...N}},"shadowMask.spring.compressed":{frame:{...O({x:21,y:4}),...N}},"shadowMask.spring.released":{frame:{...O({x:22,y:4}),...N}},...ye("fish",2,O({x:16,y:6}),N),doughnuts:{frame:{...O({x:18,y:6}),...N}},"shadowMask.doughnuts":{frame:{...O({x:19,y:6}),...N}},hooter:{frame:{...O({x:21,y:6}),...N}},bag:{frame:{...O({x:22,y:6}),...N}},whiteRabbit:{frame:{...O({x:24,y:6}),...N}},"shadowMask.whiteRabbit":{frame:{...O({x:25,y:6}),...N}},"crown.blacktooth":{frame:{...O({x:ue=16,y:ae=7}),...N}},"crown.safari":{frame:{...O({x:++ue,y:ae}),...N}},"crown.egyptus":{frame:{...O({x:++ue,y:ae}),...N}},"crown.penitentiary":{frame:{...O({x:++ue,y:ae}),...N}},"crown.bookworld":{frame:{...O({x:++ue,y:ae}),...N}},"crown.uncolourised":{frame:{...O({x:++ue,y:ae}),...N}},scroll:{frame:{...O({x:ue=16,y:ae=8}),...N,pivot:{x:17,y:24}}},"shadow.scroll":{frame:{...O({x:++ue,y:ae}),...N,pivot:{x:17,y:24}}},"shadowMask.scroll":{frame:{...O({x:++ue,y:ae}),...N,pivot:{x:17,y:24}}},buttonInGame:{frame:{...O({x:ue=16,y:ae=9}),...N}},"buttonInGame.pressed":{frame:{...O({x:++ue,y:ae}),...N}},"shadowMask.buttonInGame":{frame:{...O({x:++ue,y:ae}),...N}},"switch.left":{frame:{...O({x:++ue,y:ae}),...N}},"switch.right":{frame:{...O({x:++ue,y:ae}),...N}},"shadowMask.switch":{frame:{...O({x:++ue,y:ae}),...N}},"lift.static":{frame:{...O({x:16,y:ae=10}),...N}},...ye("lift",4,O({x:17,y:ae}),N),"shadow.smallBlock":{frame:{...O({x:21,y:ae}),...N}},"shadowMask.smallBlock":{frame:{...O({x:22,y:ae}),...N}},"shadow.wallCorner":{frame:{...O({x:21,y:ae+1}),...N}},...ye("shadow.lift",4,O({x:17,y:11}),N),...ye("bubbles.white",3,O({x:ue=23,y:ae=9}),N),...ye("bubbles.taupe",3,O({x:ue,y:++ae}),N),...ye("bubbles.jetpack",2,O({x:ue,y:++ae}),N),...ye("bubbles.blueGreen",2,O({x:ue,y:++ae}),N),"ball.blueGreen":{frame:{...O({x:ue+2,y:ae}),...N}},...ye("bubbles.cold",2,O({x:ue,y:++ae}),N),"block.organic":{frame:{...oe({x:0,y:0}),...te}},"block.organic.disappearing":{frame:{...oe({x:1,y:0}),...te}},"block.organic.dark":{frame:{...oe({x:2,y:0}),...te}},"block.organic.dark.disappearing":{frame:{...oe({x:3,y:0}),...te}},"shadowMask.organic":{frame:{...oe({x:4,y:0}),...te}},"block.artificial":{frame:{...oe({x:5,y:0}),...te}},"block.artificial.disappearing":{frame:{...oe({x:6,y:0}),...te}},"shadowMask.artificial":{frame:{...oe({x:7,y:0}),...te}},"book.x":{frame:{...oe({x:8,y:0}),...te}},"book.y":{frame:{...oe({x:9,y:0}),...te}},"shadowMask.book":{frame:{...oe({x:10,y:0}),...te}},"shadowMask.fullBlock":{frame:{...oe({x:10,y:0}),...te}},"shadow.fullBlock":{frame:{...oe({x:11,y:0}),...te}},spikes:{frame:{...oe({x:12,y:0}),...te}},"shadowMask.spikes":{frame:{...oe({x:13,y:0}),...te}},stepStool:{frame:{...oe({x:ue=0,y:ae=1}),...te}},"shadowMask.stepStool":{frame:{...oe({x:++ue,y:ae}),...te}},"volcano.1":{frame:{...oe({x:++ue,y:ae}),...te}},"volcano.2":{frame:{...oe({x:++ue,y:ae}),...te}},"shadowMask.volcano":{frame:{...oe({x:++ue,y:ae}),...te}},hushPuppy:{frame:{...oe({x:++ue,y:ae}),...te}},"shadowMask.hushPuppy":{frame:{...oe({x:++ue,y:ae}),...te}},"toaster.on":{frame:{...oe({x:++ue,y:ae}),...te}},"toaster.off":{frame:{...oe({x:++ue,y:ae}),...te}},"toaster.off.1":{frame:{...oe({x:ue,y:ae}),...te}},"toaster.off.2":{frame:{...oe({x:++ue,y:ae}),...te}},"shadowMask.toaster":{frame:{...oe({x:++ue,y:ae}),...te}},sandwich:{frame:{...oe({x:++ue,y:ae}),...te}},"shadowMask.sandwich":{frame:{...oe({x:++ue,y:ae}),...te}},...ye("conveyor.x",7,oe({x:0,y:2}),te),"shadowMask.conveyor":{frame:{...oe({x:7,y:2}),...te}},button:{frame:{...oe({x:9,y:2}),...te}},"button.pressed":{frame:{...oe({x:10,y:2}),...te}},"button.surfaceMask":{frame:{...oe({x:11,y:2}),...te}},...ye("conveyor.y",7,oe({x:0,y:3}),te),teleporter:{frame:{...oe({x:7,y:3}),...te}},...ye("teleporter.flashing",2,oe({x:8,y:3}),te),"shadowMask.teleporter":{frame:{...oe({x:10,y:3}),...te}},"shadowMask.teleporter.flashing":{frame:{...oe({x:11,y:3}),...te}},...ye("particle.head",4,{x:100,y:798},{w:9,h:11}),...ye("particle.heels",4,{x:100,y:856},{w:9,h:11})},cw={frames:qI,animations:{"teleporter.flashing":re(["teleporter.flashing.1","teleporter.flashing.2"],.5),fish:re(["fish.1","fish.2"],.25),lift:re(["lift.1","lift.2","lift.3","lift.4"],.5),"shadow.lift":re(["shadow.lift.1","shadow.lift.2","shadow.lift.3","shadow.lift.4"],.5),dalek:re(["dalek.1","dalek.2"],.5),"dalek.dark":re(["dalek.dark.1","dalek.dark.2"],.5),"turtle.left":re(["turtle.left.1","turtle.left.2"],.25),"turtle.away":re(["turtle.away.1","turtle.away.2"],.25),"turtle.towards":re(["turtle.towards.1","turtle.towards.2"],.25),"turtle.right":re(["turtle.right.1","turtle.right.2"],.25),helicopterBug:re(["helicopterBug.1","helicopterBug.2","helicopterBug.3","helicopterBug.4"],.5),"bubbles.cold":re(["bubbles.cold.1","bubbles.cold.2"],.25),"bubbles.blueGreen":re(["bubbles.blueGreen.1","bubbles.blueGreen.2"],.25),"bubbles.white":re(["bubbles.white.1","bubbles.white.2","bubbles.white.3"],.5),"bubbles.bounce.white":re(["bubbles.white.1","bubbles.white.2","bubbles.white.3","bubbles.white.2"],.5),"bubbles.doughnut":re(["bubbles.taupe.1","bubbles.taupe.2"],.5),"bubbles.jetpack":re(["bubbles.jetpack.1","bubbles.jetpack.2"],.25),"conveyor.x":re(Ur("conveyor.x",7),.5),"conveyor.y":re(Ur("conveyor.y",7),.5),volcano:re(Ur("volcano",2),3/16),"toaster.off":re(Ur("toaster.off",2),3/16),"spring.bounce":re(["spring.released","spring.compressed","spring.released","spring.compressed","spring.released"],.5),"shadowMask.spring.bounce":re(["shadowMask.spring.released","shadowMask.spring.compressed","shadowMask.spring.released","shadowMask.spring.compressed","shadowMask.spring.released"],.5),"headlessBase.scan":re(["headlessBase.4","headlessBase","headlessBase.3","headlessBase","headlessBase.2","headlessBase","headlessBase.1","headlessBase","headlessBase","headlessBase","headlessBase","headlessBase","headlessBase.all","headlessBase","headlessBase","headlessBase","headlessBase"],.25),"headlessBase.flash":re(["headlessBase.all","headlessBase"],.5),switch:re(["switch.left","switch.right"],.02),"particle.head.fade":re(Ur("particle.head",4),.5),"particle.heels.fade":re(Ur("particle.heels",4),.5)}},xI=.5,uw=5e3,bI=uw*2,gi=(t,e)=>{const r=Math.round(uw/(Eo*4)),s=`head.walking.${t}.${e}`,n=`head.blinking.${t}`,i=[...new Array(r-3).fill(s),n,s,n];return re(i,.5)},Ai=(t,e=2)=>{const r=Math.round(bI/(Eo*4)),s=t==="towards"||t==="right"?`heels.standing.${t}`:`heels.walking.${t}.${e}`,n=`heels.blinking.${t}`,i=[...new Array(Math.floor(r*.8)).fill(s),...new Array(Math.ceil(r*.2)).fill(n)];return re(i,.5)},bA=(t,e,r,s={})=>{const n=["awayLeft","away","awayRight","right","towardsRight","towards","towardsLeft","left"];function*i(){for(let o=0;o<wn.length;o++){const a=n[o];if(!r[a]?.noShadowMaskFalling){const c=`shadowMask.${t}.falling.${a}`;yield[c,{frame:{...O({x:e.x,y:e.y+o}),...N,...s[c]}}]}if(!r[a]?.noShadowMask){const c=`shadowMask.${t}.${a}`;yield[c,{frame:{...O({x:e.x+1,y:e.y+o}),...N,...s[c]}}]}for(let c=1;c<=3;c++){const u=`${t}.walking.${a}.${c}`;yield[u,{frame:{...O({x:e.x+c+1,y:e.y+o}),...N,...s[u]}}]}const l=`${t}.falling.${a}`;if(yield[l,{frame:{...O({x:e.x+5,y:e.y+o}),...N,...s[l]}}],!r[a]?.noBlinking){const c=`${t}.blinking.${a}`;yield[c,{frame:{...O({x:e.x+6,y:e.y+o}),...N,...s[c]}}]}if(!r[a]?.noStanding){const c=`${t}.standing.${a}`;yield[c,{frame:{...O({x:e.x+7,y:e.y+o}),...N,...s[c]}}]}}}return Object.fromEntries(i())};function wA(t){function*e(r,s){yield`${r}.walking.${s}.1`,yield`${r}.walking.${s}.2`,yield`${r}.walking.${s}.3`,yield`${r}.walking.${s}.2`}return wn.reduce((r,s)=>({...r,[`${t}.walking.${s}`]:re([...e(t,s)],xI)}),{})}const wI={...ye("bubbles.head",6,O({x:1,y:10}),N),...bA("head",{x:0,y:11},{awayLeft:{noBlinking:!0,noStanding:!0,noShadowMaskFalling:!0},away:{noBlinking:!0,noStanding:!0},awayRight:{noStanding:!0},right:{noStanding:!0},towardsRight:{noStanding:!0},towards:{noShadowMask:!0,noStanding:!0,noShadowMaskFalling:!0},towardsLeft:{noShadowMask:!0,noStanding:!0,noShadowMaskFalling:!0},left:{noBlinking:!0,noShadowMask:!0,noStanding:!0,noShadowMaskFalling:!0}},{"head.falling.awayRight":{pivot:{x:11,y:24}},"head.falling.towardsLeft":{pivot:{x:13,y:24}},"head.falling.awayLeft":{pivot:{x:12,y:25}}}),...ye("bubbles.heels",6,O({x:9,y:10}),N),...bA("heels",{x:8,y:11},{awayLeft:{noBlinking:!0,noStanding:!0,noShadowMaskFalling:!0},away:{noBlinking:!0,noStanding:!0,noShadowMaskFalling:!0},awayRight:{noStanding:!0,noShadowMaskFalling:!0},right:{noShadowMaskFalling:!0},towardsRight:{noStanding:!0,noShadowMaskFalling:!0},towards:{noShadowMask:!0,noShadowMaskFalling:!0},towardsLeft:{noShadowMask:!0,noStanding:!0,noShadowMaskFalling:!0},left:{noBlinking:!0,noShadowMask:!0,noStanding:!0,noShadowMaskFalling:!0}}),...ye("shine.head",6,oe({x:0,y:4}),te,3),...ye("shine.heels",6,oe({x:0,y:6}),te,3),blank:{frame:{...O({x:0,y:2}),...N}},"shadow.playable":{frame:{...O({x:7,y:10}),...N}}},hw={frames:wI,animations:{...wA("head"),...wA("heels"),"heels.screenDirections":re(["heels.walking.towardsRight.2","heels.walking.towardsLeft.2","heels.walking.awayLeft.2","heels.walking.awayRight.2"],1/16),"heels.worldDirections":re(["heels.standing.towards","heels.walking.left.2","heels.walking.away.2","heels.standing.right"],1/16),"heels.mixedDirections":re(["heels.walking.towardsRight.2","heels.standing.towards","heels.walking.towardsLeft.2","heels.walking.left.2","heels.walking.awayLeft.2","heels.walking.away.2","heels.walking.awayRight.2","heels.standing.right"],1/8),"head.idle.right":gi("right",3),"head.idle.towards":gi("towards",3),"head.idle.towardsRight":gi("towardsRight",2),"head.idle.towardsLeft":gi("towardsLeft",3),"head.idle.awayRight":gi("awayRight",3),"heels.idle.right":Ai("right"),"heels.idle.towards":Ai("towards"),"heels.idle.towardsRight":Ai("towardsRight",2),"heels.idle.towardsLeft":Ai("towardsLeft",2),"heels.idle.awayRight":Ai("awayRight",2),"head.fadeOut":re(["bubbles.head.1","bubbles.head.2","bubbles.head.4","bubbles.head.3","bubbles.head.4","bubbles.head.6","bubbles.head.5","bubbles.head.6","bubbles.head.5"],.5),"heels.fadeOut":re(["bubbles.heels.1","bubbles.heels.2","bubbles.heels.4","bubbles.heels.3","bubbles.heels.4","bubbles.heels.6","bubbles.heels.5","bubbles.heels.6","bubbles.heels.5"],.5),"shine.head":re(Ur("shine.head",6),.5),"shine.heels":re(Ur("shine.heels",6),.5),"shine.headInSymbio":re(["shine.head.1","shine.head.2","shine.head.3","blank","blank","blank","blank","blank","blank","shine.head.4","shine.head.5","shine.head.6"],.5),"shine.heelsInSymbio":re(["blank","blank","blank","shine.heels.1","shine.heels.2","shine.heels.3","shine.heels.4","shine.heels.5","shine.heels.6","blank","blank","blank"],.5)}},VI={jail:["bars"],blacktooth:["plain","shield","armour"],bookworld:["book","cowboy"],egyptus:["hieroglyphics","sarcophagus"],market:["more-fruits","fruits","passage"],moonbase:["coil","window3","window2","window1","window-clear"],penitentiary:["skeleton","loop"],safari:["wall","shield","window"]},G$=["blacktooth","penitentiary","bookworld","egyptus","safari"],nt=(t,e,r,s)=>{const n=oI.includes(t);function*i(o,a,l){const c=VI[o],{w:u,h}=It,f=u>>1;for(let d=0;d<c.length;d++)yield[`${o}${s}.wall.${c[d]}.left`,{frame:{x:a-u*(d+1),y:l+f*d,...It}}],yield[`${o}${s}.wall.${c[d]}.away`,{frame:{x:a+u*d,y:l+f*d,...It}}];if(yield[`${o}${s}.floor`,{frame:{x:a-u,y:l+h,...Yh}}],n){const d=l+f*c.length-9;yield*ml(`${o}${s}`,"x",{x:a+u*c.length+1,y:d}),yield*ml(`${o}${s}`,"y",{x:a-u*c.length-2,y:d})}}return Object.fromEntries(i(t,e,r))},VA={w:16,h:13},vA={w:8,h:9},cr=74;let it=53;const vI={...nt("egyptus",834,it,""),...nt("egyptus",834,it+=cr,".dark"),...nt("moonbase",834,it+=cr,""),...nt("moonbase",834,it+=cr,".dark"),...nt("bookworld",834,it+=cr,""),...nt("bookworld",834,it,".dark"),...nt("jail",834,it+=cr,""),...nt("jail",834,it,".dark"),...nt("blacktooth",834,it+=cr,""),...nt("blacktooth",834,it+=cr,".dark"),...nt("penitentiary",834,it+=cr,""),...nt("penitentiary",834,it,".dark"),...nt("market",834,it+=cr,""),...nt("market",834,it,".dark"),...nt("safari",834,it+=cr,""),...nt("safari",834,it,".dark"),"floorEdge.right":{frame:{x:418,y:466,...VA,pivot:{x:0,y:4}}},"floorEdge.towards":{frame:{x:401,y:466,...VA,pivot:{x:15,y:4}}},"floorEdge.half.right":{frame:{x:418,y:470,...vA,pivot:{x:0,y:0}}},"floorEdge.half.towards":{frame:{x:401,y:466,...vA,pivot:{x:7,y:0}}},"floorOverdraw.cornerNearWall":{frame:{x:623,y:452,w:It.w,h:8}},"shadow.wall.y":{frame:{x:432,y:435,w:36,h:16}},"shadow.doorFrame.top.y":{frame:{x:432,y:402,w:36,h:32,pivot:{x:18,y:31.5}}},"generic.floor.deadly":{frame:{x:785,y:462,...Yh}},"generic.dark.floor.deadly":{frame:{x:785,y:479,...Yh}},"generic.door.legs.pillar.y":{frame:{x:508,y:476,w:It.w,h:12}},"generic.door.legs.base.y":{frame:{x:508,y:488,w:It.w,h:9}},"generic.door.legs.pillar.x":{frame:{x:524,y:476,w:It.w,h:12}},"generic.door.legs.base.x":{frame:{x:524,y:488,w:It.w,h:9}},"generic.door.legs.threshold.double.x":{frame:{x:508,y:452,w:It.w*2,h:24}},"generic.door.legs.threshold.double.y":{frame:{x:469,y:452,w:It.w*2,h:24}},"shadowMask.door.legs.threshold.double.y":{frame:{x:469,y:430,w:It.w*2,h:21,pivot:{x:0,y:21}}},"generic.door.floatingThreshold.x":{frame:{x:457,y:492,w:26,h:19,pivot:{x:18,y:12}}},"generic.door.floatingThreshold.y":{frame:{x:430,y:492,w:26,h:19,pivot:{x:8,y:12}}},"shadowMask.door.floatingThreshold.double.y":{frame:{x:541,y:480,w:42,h:21,pivot:{x:8,y:20}}},"shadow.door.floatingThreshold.double.y":{frame:{x:584,y:480,w:42,h:21,pivot:{x:8,y:20}}},...ye("moonbase.wall.screen.window1.away",3,{x:883,y:217},{w:10,h:7}),...ye("moonbase.wall.screen.window2.away",2,{x:867,y:209},{w:10,h:7}),...ye("moonbase.wall.screen.window3.away",4,{x:851,y:201},{w:10,h:7})},dw={frames:vI,animations:{"moonbase.wall.screen.window1.away":re(["moonbase.wall.screen.window1.away.1","moonbase.wall.screen.window1.away.2","moonbase.wall.screen.window1.away.3"],1/16),"moonbase.wall.screen.window2.away":re(["moonbase.wall.screen.window2.away.1","moonbase.wall.screen.window2.away.1","moonbase.wall.screen.window2.away.2"],1/16),"moonbase.wall.screen.window3.away":re(["moonbase.wall.screen.window3.away.1","moonbase.wall.screen.window3.away.2","moonbase.wall.screen.window3.away.3","moonbase.wall.screen.window3.away.4","moonbase.wall.screen.window3.away.4"],1/16)}},_I={...cw.frames,...hw.frames,...dw.frames,...yI.frames,...aI.frames,...cI.frames},ct={frames:_I,animations:{...hw.animations,...cw.animations,...dw.animations},meta:{scale:1}},SI=Object.keys(ct.frames),_a={w:1024,h:1024};function H$(t){if(!Kh(t))throw new Error(`Invalid textureId: "${t}"; textureId  {${Object.keys(ct.frames).sort().map(e=>`"${e}"`).join(`,
`)}}`)}function Kh(t){return ct.frames[t]!==void 0}function W$(t){return ct.animations[t]!==void 0}const fw="/assets/sprites-DicoUlr6.png";var kI=`#version 300 es
precision highp float;in vec2 vTextureCoord;out vec4 finalColor;uniform sampler2D uTexture;uniform sampler2D uMask;void main(void){vec4 c=texture(uTexture,vTextureCoord);float maskVal=texture(uMask,vTextureCoord).r;vec4 shadowColor=vec4(0.0,0.0,0.0,c.a*(1.0-c.r));finalColor=mix(c,shadowColor,maskVal);}`;const CI=Ll.from({vertex:x1,fragment:kI,name:"preprocess-shadow-textures-filter"});class EI extends oC{#e;constructor(e){super({glProgram:CI,resources:{uMask:e.source}}),this.#e=e}destroy(e){const r=e===!0||typeof e=="object"&&e.destroyPrograms;(e===!0||typeof e=="object"&&e.destroyMask)&&this.#e?.destroy(!0),this.#e=null,super.destroy(r)}}const TI=t=>{const e=new DataView(t),r=[];r.push(t.slice(0,8));let s=8;for(;s<t.byteLength;){const a=e.getUint32(s),l=new TextDecoder().decode(new Uint8Array(t,s+4,4)),c=12+a;l!=="iCCP"&&r.push(t.slice(s,s+c)),s+=c}const n=r.reduce((a,l)=>a+l.byteLength,0),i=new Uint8Array(n);let o=0;for(const a of r)i.set(new Uint8Array(a),o),o+=a.byteLength;return i.buffer},PI=new be(0),RI=new be(16777215),MI=t=>typeof t=="function"?Qe(SI).filter(t):t,II=(t,{rects:e,placeholderColoursMasks:r,clearColour:s})=>{const n=new ll,i=new Hn({children:[n]});if(s!==void 0&&n.rect(0,0,_a.w,_a.h).fill(s),e!==void 0){const{textureIds:a,color:l}=e,c=MI(a);for(const u of c){const{frame:{x:h,y:f,w:d,h:m}}=ct.frames[u];n.rect(h,f,d,m).fill(l)}}if(r!==void 0&&r.textureIds.length>0){const{textureIds:a,filter:l,originalSpritesheet:c}=r;for(const u of a){const h=new Ns({texture:c.textures[u],x:c.data.frames[u].frame.x,y:c.data.frames[u].frame.y,filters:l});i.addChild(h)}}const o=Hl.create({width:_a.w,height:_a.h});return t.render({container:i,target:o}),o};let uo,Wr;const jI=async()=>{if(uo!==void 0)return uo;try{const e=await(await fetch(fw)).arrayBuffer(),r=TI(e),s=new Blob([r],{type:"image/png"}),n=await createImageBitmap(s);Wr=Ae.from(n)}catch{console.warn("did not load textures - hopefully we are running under node"),Wr=Ae.EMPTY}},Y$=t=>{if(Wr===void 0)throw new Error("cannot init original spritesheet before texture load");const e=II(t,{rects:{textureIds:o=>o.startsWith("shadow."),color:RI},clearColour:PI}),r=new EI(e),s=new Ns(Wr);s.filters=r;const n=Hl.create({width:Wr.width,height:Wr.height});t.render({container:s,target:n});const i=new qh(n,ct);i.parseSync(),i.textureSource.scaleMode="nearest",uo=i,s.destroy(),e.destroy(!0)},OI=()=>{if(uo===void 0)throw new Error(`spritesheet not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`);return uo},K$=()=>{if(Wr===void 0)throw new Error(`spritesheet not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`);return Wr},NI=({className:t,children:e})=>t?p.jsx("div",{className:`contents ${t}`,children:e}):e,BI=t=>t.replaceAll(/(?<!\.)\./g,"_"),j=({children:t,className:e,noSlitWords:r,classnameCycle:s,onClick:n,noTint:i=!1,TagName:o="span",role:a})=>{const l=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(l.length===0)return null;const c=r?[l]:l.split(/\s+/);return p.jsxs(o,{className:e,onClick:n,children:[p.jsx("span",{className:"sr-only",children:l}),c.map((u,h)=>p.jsx("span",{className:ht("text-nowrap inline-block [&>*]:align-top",h===c.length-1?"":"me-threeQuarters sprites-uppercase:me-1"),children:Array.from(u).map((f,d)=>{const m=`hud.char.${ow(f)}`;return Kh(m)||console.error("no texture for char",f,f.charCodeAt(0),m,"we have:",Object.keys(OI().textures)),p.jsx("span",{role:a,className:`sprite ${Kh(m)?`texture-${BI(m)}`:"texture-hud_char_?"}
                  ${i?"":"sprite-tinted"}
                  ${s===void 0?"":s[d%s.length]}`},d)})},h))]})},DI=t=>t.props.children!==void 0,rt=({children:t,className:e})=>p.jsx(NI,{className:e,children:Array.isArray(t)?t.map((r,s)=>p.jsx(rt,{children:r},s)):typeof t=="number"?p.jsx(j,{children:String(t)}):typeof t=="string"?p.jsx(j,{children:t}):v.isValidElement(t)?t.type===j||t.type===rt?t:DI(t)?v.cloneElement(t,void 0,typeof t.props.children=="string"?p.jsx(j,{children:`${t.props.children}`}):p.jsx(rt,{children:t.props.children})):t:t});var Zl=rq();const zI=Xe(Zl),_A=5,pw=({renderAreaSize:t,emulatedResolutionName:e,devicePixelRatio:r,deviceType:s=yt(),maximumCanvasUpscale:n})=>{const i=Wn[e],{renderAreaSize:o,rotate90:a}=s!=="desktop"&&t.x<t.y?{renderAreaSize:{x:t.y,y:t.x},rotate90:!0}:{renderAreaSize:t,rotate90:!1},l=Uq(o,r),c=Math.max(Math.floor(_A*Math.min(l.x/i.size.x,l.y/i.size.y))/_A,1),u=Math.min(n,c),h=c/u/r,f={x:Math.floor(l.x/c),y:Math.floor(l.y/c)},d={x:Math.ceil(o.x/h),y:Math.ceil(o.y/h)};return{gameEngineUpscale:u,cssUpscale:h,gameEngineScreenSize:f,canvasSize:d,rotate90:a}},FI=t=>yt()==="server"?Wn.zxSpectrum.size:t?{x:t.clientWidth,y:t.clientHeight}:{x:window.innerWidth,y:window.innerHeight},mw=(t,e,r)=>{const s=yt();return{renderAreaSize:FI(r),emulatedResolutionName:t,devicePixelRatio:s==="server"?1:window.devicePixelRatio,maximumCanvasUpscale:e.crtFilter?6:8}},LI={upscale:pw(mw(es.displaySettings.emulatedResolution,es.displaySettings))},gl=Sr({name:"upscale",initialState:LI,reducers:{upscaleToWindow(t,{payload:e}){t.upscale=pw(e)}},selectors:{selectCanvasSize(t){return t.upscale.canvasSize},selectGameEngineUpscale(t){return t.upscale.gameEngineUpscale},selectGameEngineScreenSize(t){return t.upscale.gameEngineScreenSize},selectRot90(t){return t.upscale.rotate90},selectUpscale(t){return t.upscale},selectTotalUpscale({upscale:{cssUpscale:t,gameEngineUpscale:e}}){return t*e}}}),{upscaleToWindow:UI}=gl.actions,{selectCanvasSize:$I,selectRot90:gw,selectUpscale:Aw,selectGameEngineUpscale:Q$,selectTotalUpscale:GI,selectGameEngineScreenSize:X$}=gl.selectors,Ro=()=>X(GI),yn=({children:t,scaleFactor:e})=>{const r=Ro();return p.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??r,"--block":`${(e??r)*8}px`},children:t})},ze=({children:t})=>Zl.createPortal(p.jsx(yn,{children:t}),document.body),HI=({text:t})=>p.jsxs("div",{className:"flex flex-col h-full items-center justify-center gap-y-1",children:[p.jsx("span",{className:"sprite texture-animated-dalek"}),p.jsx(j,{children:t})]}),WI=()=>p.jsx("div",{className:"flex h-full items-center justify-center loading-border zx:zx-loading-border",role:"status","aria-label":"Loading",children:p.jsx("span",{className:"sprite texture-animated-head_walking_right","aria-hidden":!0})});var yi={},Sa={},ka={},SA;function YI(){if(SA)return ka;SA=1,ka.__esModule=!0,ka.default=n;function t(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?t=function(a){return typeof a}:t=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},t(i)}function e(){}var r={getItem:e,setItem:e,removeItem:e};function s(i){if((typeof self>"u"?"undefined":t(self))!=="object"||!(i in self))return!1;try{var o=self[i],a="redux-persist ".concat(i," test");o.setItem(a,"test"),o.getItem(a),o.removeItem(a)}catch{return!1}return!0}function n(i){var o="".concat(i,"Storage");return s(o)?self[o]:r}return ka}var kA;function KI(){if(kA)return Sa;kA=1,Sa.__esModule=!0,Sa.default=r;var t=e(YI());function e(s){return s&&s.__esModule?s:{default:s}}function r(s){var n=(0,t.default)(s);return{getItem:function(o){return new Promise(function(a,l){a(n.getItem(o))})},setItem:function(o,a){return new Promise(function(l,c){l(n.setItem(o,a))})},removeItem:function(o){return new Promise(function(a,l){a(n.removeItem(o))})}}}return Sa}var CA;function QI(){if(CA)return yi;CA=1,yi.__esModule=!0,yi.default=void 0;var t=e(KI());function e(s){return s&&s.__esModule?s:{default:s}}var r=(0,t.default)("local");return yi.default=r,yi}var XI=QI();const JI=Xe(XI),Ze=t=>{const e=Wh.userSettings;return console.log("migrating state: persisted is:",t,"I am not migrating - reverting to initial/default state:",e),e},ZI=q_({1:Ze,2:Ze,3:Ze,4:Ze,5:Ze,6:Ze,7:Ze,8:Ze,9:Ze,10:Ze,11:Ze,12:Ze,13:Ze,14:Ze,15:Ze,16:Ze,17:Ze}),ej=["userSettings","savedGames"],tj=17,rj={key:"hohol/gameMenus/userSettings",version:tj,migrate:ZI,storage:JI,whitelist:ej},sj=d_(rj,Po.reducer),nj={count:0},Al=Sr({name:"gameAssetsLoading",initialState:nj,reducers:{gameAssetsLoadingStarted(t){t.count++},gameAssetsLoadingFinished(t){t.count=Math.max(0,t.count-1)}},selectors:{selectGameAssetsLoadingCount(t){return t.count}}}),{gameAssetsLoadingStarted:ij,gameAssetsLoadingFinished:EA}=Al.actions,{selectGameAssetsLoadingCount:yw}=Al.selectors,yl=Cb({reducerPath:"githubApi",baseQuery:U1({baseUrl:"https://api.github.com"}),endpoints:t=>({getLatestRelease:t.query({query:()=>"/repos/jimhigson/head-over-heels-online/releases/latest"})})}),{useGetLatestReleaseQuery:oj}=yl,ql=(t,e,r,s)=>{t(UI(mw(Jl(e()),e().gameMenus.userSettings.displaySettings,s)))},aj=()=>{yt()!=="server"&&Rd({actionCreator:_f,effect(t,{dispatch:e,getState:r}){ql(e,r)}})},lj=()=>{yt()!=="server"&&Rd({predicate(t,{gameMenus:{userSettings:{displaySettings:e}}},{gameMenus:{userSettings:{displaySettings:r}}}){return e!==r},effect(t,{dispatch:e,getState:r}){ql(e,r)}})},Qh=Q0({[Po.reducerPath]:sj,[gl.reducerPath]:gl.reducer,[ts.reducerPath]:ts.reducer,[yl.reducerPath]:yl.reducer,[Al.reducerPath]:Al.reducer}).withLazyLoadedSlices();Qh.inject;const cj=(t,e)=>e.type==="@@_RESET_FOR_TESTS"?Qh(void 0,e):Qh(t,e),le=m0({reducer:cj,middleware:t=>t({serializableCheck:{ignoredActions:[Id,vo,jd,Od,Nd,Bd,zM.type]}}).prepend(Bq.middleware).concat(ts.middleware).concat(yl.middleware)});typeof window<"u"&&(window._e2e_store=le);aj();lj();const uj=y_(le),TA=t=>{let e=t.parentElement;for(;e!==null;){const{overflowY:r}=window.getComputedStyle(e);if(r==="scroll"||r==="auto")return e;e=e.parentElement}return null},hj=()=>({directionVector:ee,lookVector:{...ee},...Un(Yq.map(t=>[t,!1]))}),wu={x:1,y:0,z:0},Vu={x:-1,y:0,z:0},vu={x:0,y:-1,z:0},_u={x:0,y:1,z:0},fe={away:_u,left:wu,right:Vu,towards:vu,down:{x:0,y:0,z:-1},up:{x:0,y:0,z:1},awayRight:un(U(_u,Vu)),towardsRight:un(U(vu,Vu)),towardsLeft:un(U(vu,wu)),awayLeft:un(U(_u,wu))},dj={left:{axis:"x",plane:"xy",direction:-1},right:{axis:"x",plane:"xy",direction:1},towards:{axis:"y",plane:"xy",direction:1},away:{axis:"y",plane:"xy",direction:-1},lookLeft:{axis:"xLook",plane:"look",direction:-1},lookRight:{axis:"xLook",plane:"look",direction:1},lookUp:{axis:"yLook",plane:"look",direction:1},lookDown:{axis:"yLook",plane:"look",direction:-1}},Xh=t=>dj[t],fj=Math.cos(13*(Math.PI/180)),xl=-Math.PI/4,pj=t=>{const e=Math.cos(xl),r=Math.sin(xl);return{x:t.x*e-t.y*r,y:t.x*r+t.y*e,z:0}},mj=t=>{const e=Math.cos(xl),r=Math.sin(xl),s=t.x;return t.x=s*e-t.y*r,t.y=s*r+t.y*e,t};un({x:1,y:2,z:0});un({x:-1,y:2,z:0});const gj=t=>{const e=P_(t);return e===void 0?ee:fe[e]},Aj=t=>{const e=zd(t);return e===void 0?ee:fe[e]},yj=(t,e=fj)=>{const{x:r,y:s}=t,n=Math.sqrt(r*r+s*s);if(n===0)return ee;const i=r/n,o=s/n,a=Math.abs(i),l=Math.abs(o);if(a>l){if(a>=e)return{x:Math.sign(r)*n,y:0,z:0}}else if(l>=e)return{x:0,y:Math.sign(s)*n,z:0};return t},qj={"4-way":gj,"8-way":Aj,analogue:yj},xj=t=>t.map(e=>e===null?null:{buttons:e.buttons.map(r=>({pressed:r.pressed})),axes:e.axes.map(r=>r)}),bj={lookLeft:fe.left,lookRight:fe.right,lookUp:fe.away,lookDown:fe.towards},wj=[{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1},{x:-1,y:0},{x:-1,y:-1}],Vj=t=>{const e=Math.round((t+1)*3.5);return wj[e]??Hq},vj=.2,_j=45,Sj=(t,e)=>!!t.keyboardState.has(e),qw=(t,e)=>{for(const r of t.gamepads)if(!(r===null||r.buttons.length<=e)&&r.buttons[e].pressed)return!0;return!1},bl=.5,xw=(t,e,r)=>{for(const s of t.gamepads)if(!(s===null||s.axes.length<=e)){if(r===void 0){if(Math.abs(s.axes[e])>bl)return!0}else if(s.axes[e]*r>bl)return!0}return!1},ds=(t,e,r=!0)=>{const s=pl(le.getState()),n=s.presses[e];if(t.hudInputState[e])return!0;for(const o of n.keys)if(Sj(t,o))return!0;for(const o of n.gamepadButtons)if(qw(t,o))return!0;const i=s.radialAxes?.xy??mn;for(const o of i){const a=Xh(e);if(a!==void 0&&a.plane==="xy")for(const l of t.gamepads){if(l===null||l.axes.length<=o)continue;const c=l.axes[o];if(Vj(c)[a.axis]*a.direction>bl)return!0}}if(r){const o=Xh(e);if(o!==void 0){const a=s.axes[o.axis];for(const l of a)if(xw(t,l,o.direction))return!0}}return!1},PA=t=>{const e=$q(t);return e>1?Qt(t,1/e):t},RA=(t,e)=>t?mj(e):e;class kj{constructor(e,r){this.keyboardStateMap=e,this.hudInputState=r}#e=[];#t=ee;#r=ee;#s=new Map;#n=()=>{const e=this.#e.at(0);if(e===void 0||ds(e,"lookShift",!1))return ee;let r,s,n,i;switch("tap"){case(r=this.currentActionPress("left")):return fe.left;case(s=this.currentActionPress("right")):return fe.right;case(n=this.currentActionPress("away")):return fe.away;case(i=this.currentActionPress("towards")):return fe.towards}const o=(r!=="released"?1:0)+(s!=="released"?1:0)+(n!=="released"?1:0)+(i!=="released"?1:0);if(o>1)return this.#t;if(o===1)switch("hold"){case r:return fe.left;case s:return fe.right;case n:return fe.away;case i:return fe.towards}return ee};*#i(e,r,s){for(const n of r)ds(e,n,!1)&&(yield s[n])}*#o(e,r,s,n,i){const o=pl(le.getState()).axes,a=o[r],l=o[s];for(const c of e.gamepads){if(c===null)continue;let u=0,h=0;for(const d of a)c.axes.length<=d||(u+=c.axes[d]*n);for(const d of l)c.axes.length<=d||(h+=c.axes[d]*i);const f={x:u,y:h,z:0};Fn(f)>vj&&(yield f)}}#l(e){const r=this.#e.at(0);if(r===void 0||ds(r,"lookShift",!1))return ee;let s=[...this.#i(r,pn,fe)],n;if(s.length===1){const[c]=s,u=[...Qe(this.#e).drop(1).map(h=>[...this.#i(h,pn,fe)])];e:for(const h of u){if(h.length>2)break e;if(h.length===2&&h.some(f=>Dd(f,c))){const f=h.find(d=>nl(d,c)<.001);if(f!==void 0){n=f;break e}}}if(!n)for(const h of u)h.length===0&&(s=mn)}const i=e==="screen",o=e==="screen"||e==="mixed",a=RA(i,U(...s)),l=RA(o,U(...this.#o(r,"x","y",-1,-1)));return U(n??ee,a,l)}#c(){const e=this.#e.at(0);if(e===void 0)return ee;const r=ds(e,"lookShift",!1);return PA(U(...this.#i(e,Wq,bj),...this.#o(e,"xLook","yLook",-1,-1),...r?this.#i(e,pn,fe):mn,...r?this.#o(e,"x","y",-1,-1):mn))}#a=({lastTime:e})=>{const r=bf(le.getState()),s=qj[r];this.#t=PA(s(U(r==="4-way"?this.#n():this.#l(qf(le.getState())),this.hudInputState.directionVector))),this.#r=this.#c();const n={keyboardState:new Map(this.keyboardStateMap),hudInputState:{...this.hudInputState},gamepads:xj(navigator.getGamepads()),atTime:e};this.#e.unshift(n);const i=e-_j,o=this.#e.findIndex(a=>a.atTime<i);if(o!==-1&&this.#e.splice(o+1),this.#s.size>0){const a=performance.now();for(const[l,c]of this.#s)(!ds(n,l)||a>=c)&&this.#s.delete(l)}};currentActionPress(e,r=!1){const s=this.#e.at(0);if(s===void 0||!r&&this.#s.has(e))return"released";if(ds(s,e)){const i=this.#e.at(1);return(i===void 0?!1:ds(i,e))?"hold":"tap"}return"released"}inputTap(){const e=this.#e.at(0),r=this.#e.at(1);if(e!==void 0){for(const s of this.keyboardStateMap.keys())if(r===void 0||!r.keyboardState.has(s))return{type:"key",input:s};for(const s of e.gamepads)if(s!==null){for(const[n,i]of s.buttons.entries())if(i.pressed&&(r===void 0||!qw(r,n)))return{type:"gamepadButtons",input:n};for(const[n,i]of s.axes.entries())if(Math.abs(i)>bl&&(r===void 0||!xw(r,n)))return{type:"gamepadAxes",input:n}}}}inputWasHandled(e,r=1/0){this.#s.set(e,performance.now()+r)}get directionVector(){return this.#t}get lookVector(){return this.#r}startTicking(){gt.shared.add(this.#a,void 0,ol.INTERACTION)}stopTicking(){gt.shared.remove(this.#a)}}const Cj=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","","","","0","1","2","3","4","5","6","7","8","9","!","@","#","$","%","^","&","*","(",")","-","_","=","+","[","]","{","}",";",":","'",'"',",",".","/","<",">","?","\\","|"," ","Enter","Shift","Control","Alt","Meta","`","~","Tab","Backspace","Delete","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","Numpad+","Numpad-","Numpad*","Numpad/","Numpad.","NumpadEnter","Numpad=","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Escape",""],Ej=t=>Cj.includes(t);let Tj=1;const Pj=()=>Tj++,Rj=3,MA=({key:t,location:e,repeat:r})=>{if(r)return;const s=t.length===1?t.toUpperCase():t,n=e===Rj&&!s.startsWith("Arrow")?`Numpad${s}`:s;if(Ej(n))return n;console.warn("unrecognised key",t)},Mj=()=>new Map,Ij=t=>{const e=n=>{const i=MA(n);i!==void 0&&t.set(i,Pj())},r=n=>{const i=MA(n);i!==void 0&&t.delete(i)},s=()=>{t.clear()};return window.addEventListener("keydown",e,!1),window.addEventListener("keyup",r,!1),window.addEventListener("blur",s,!1),()=>{window.removeEventListener("keydown",e,!1),window.removeEventListener("keyup",r,!1),window.removeEventListener("blur",s,!1)}},bw=v.createContext(null),jj=({children:t})=>{const[e]=v.useState(Mj),[r]=v.useState(()=>new kj(e,hj()));return v.useEffect(()=>{const s=Ij(e);return r.startTicking(),()=>{s(),r.stopTicking()}},[r,e]),p.jsx(bw,{value:r,children:t})},kf=()=>{const t=v.useContext(bw);if(t===null)throw new Error("InputStateProvider required to use useInputState");return t},Se=({handler:t,action:e,disabled:r=!1})=>{const s=v.useMemo(()=>Array.isArray(e)?e:[e],[e]),n=kf();v.useEffect(()=>{if(r)return;const i=()=>{for(const o of s)if(n.currentActionPress(o)==="tap"){if(!t(o))for(const c of s)n.inputWasHandled(c);break}};return gt.shared.add(i),()=>{gt.shared.remove(i)}},[s,r,n,t])},Oj=({handler:t,disabled:e=!1})=>{const r=kf();v.useEffect(()=>{if(e)return;const s=()=>{const n=r.inputTap();n!==void 0&&t(n,r)};return gt.shared.add(s),()=>{gt.shared.remove(s)}},[e,t,r])},kn="data-menuitem_id",$a="data-menuitem_hidden",Ga="data-menuitem_disabled",Nj="grid grid-cols-menuItems gap-x-1 gap-y-oneScaledPix mobile:!gap-y-half mobile:sprites-double-height h-min",ww=()=>{const t=document.body.querySelectorAll(`[${kn}]`);return Array.from(t)},Bj=(t,e)=>{let r=t;for(;r!==null&&r!==e;){const{position:s}=window.getComputedStyle(r);if(s==="sticky")return r;r=r.parentElement}return null},IA=(t,e)=>{const r=t.firstChild,s=r.getBoundingClientRect().top,n=e??document.documentElement;return Bj(t,n)!==null?(e?.firstChild?.getBoundingClientRect().top??0)-r.getBoundingClientRect().height:s},Xs=(t,e)=>{const{gameMenus:{openMenus:[{focussedItemId:r}]}}=le.getState();if(r===void 0)return!0;const s=ww();if(s.length<=1)return!0;const n=s.findIndex(c=>c.getAttribute(kn)===r);if(n===-1)return!0;let i=n;const o=s[n],a=TA(o);switch(e){case"all":{for(i=t===-1?0:s.length-1;s[i].getAttribute($a)==="true"||s[i].getAttribute(Ga)==="true";)if(i+=t,i<0||i>=s.length)return!0;break}case"page":{const c=IA(o,a),u=a?.clientHeight??window.innerHeight,h=c+t*u;let f=n,d=1/0;for(let m=0;m<s.length;m++){if(m===n)continue;const g=s[m];if(g.getAttribute($a)==="true"||g.getAttribute(Ga)==="true")continue;const A=IA(g,a),y=Math.abs(A-h);(t===-1&&A<c||t===1&&A>c)&&y<d&&(d=y,f=m)}i=f;break}case"single":{do i=(i+t+s.length)%s.length;while(s[i].getAttribute($a)==="true"||s[i].getAttribute(Ga)==="true");break}}if(i===n)return!0;const l=s[i];return a!==TA(l)&&a?.scrollTo({top:0,behavior:"smooth"}),le.dispatch(Sf({focussedItemId:s[i].getAttribute(kn),scrollableSelection:!0})),!1},Dj=t=>{const e=Qb();Se({action:"away",handler:v.useCallback(()=>{if(t.current!==null)return Xs(-1,"single")},[t]),disabled:e}),Se({action:"towards",handler:v.useCallback(()=>{if(t.current!==null)return Xs(1,"single")},[t]),disabled:e}),Se({action:"pageUp",handler:v.useCallback(()=>{if(t.current!==null)return Xs(-1,"page")},[t]),disabled:e}),Se({action:"pageDown",handler:v.useCallback(()=>{if(t.current!==null)return Xs(1,"page")},[t]),disabled:e}),Se({action:"home",handler:v.useCallback(()=>{if(t.current!==null)return Xs(-1,"all")},[t]),disabled:e}),Se({action:"end",handler:v.useCallback(()=>{if(t.current!==null)return Xs(1,"all")},[t]),disabled:e})},Re=({className:t="",children:e,inline:r=!1})=>{const s=v.useRef(null);return v.useEffect(()=>{if(s.current===null||le.getState().gameMenus.openMenus[0].focussedItemId!==void 0)return;const n=ww(),i=n.at(0);if(i===void 0){const{openMenus:[{menuId:l}]}=le.getState().gameMenus;throw new Error(`<MenuItems> component mounted with no menu items on the page in store current top menu is "${l}"`)}const o=i.getAttribute(kn),a=o==="back"&&n.length>1?n[1].getAttribute(kn):o;le.dispatch(Sf({focussedItemId:a,scrollableSelection:!0}))},[]),Dj(s),p.jsx("menu",{ref:s,className:ht(r?"":Nj,t),children:e})};function z(t,e){const r=af();return v.useCallback(()=>{r(t(e))},[t,r,e])}const zj=["menu_select","swop","jump"],Fj=()=>{},Vw=({id:t,hidden:e=!1,disabled:r=!1,onSelect:s=Fj})=>{const n=v.useRef(!0),i=X(a=>a.gameMenus.openMenus.at(0)?.scrollableSelection??!1),o=X(a=>a.gameMenus.openMenus.at(0)?.focussedItemId===t);return Se({action:zj,handler:s,disabled:!o||e||r}),{menuItemProps:{[kn]:t,[$a]:e,[Ga]:r,onMouseMove:z(Sf,{focussedItemId:t,scrollableSelection:!1}),onClick:r?void 0:s,tabIndex:0,role:"menuitem"},ref(a){o&&i&&a?.scrollIntoView({behavior:n.current?"instant":"smooth",block:"center"}),n.current=!1},focussed:o}},vw=({className:t})=>{const e=z(qt),{menuItemProps:r,ref:s,focussed:n}=Vw({id:"back",onSelect:e});return p.jsxs("div",{...r,className:ht("sprites-double-height flex flex-row gap-1 cursor-pointer "+(n?"selectedMenuItem":""),t),"data-to-parent-menu":!0,ref:s,children:[p.jsx(j,{className:"inline-block scale-x-[-1]",children:""}),p.jsx(j,{className:"inline-block",children:"Back"})]})},yr=({path:t=mn,className:e})=>{const r=t.at(-1);return p.jsxs("div",{className:ht("flex flex-row sticky top-0 z-slightlyAbove py-oneScaledPix gap-2 pl-2",e),children:[p.jsx(Re,{inline:!0,children:p.jsx(vw,{})}),p.jsxs("div",{className:"flex flex-row items-center",children:[t.slice(0,-1).map((s,n)=>p.jsxs("div",{className:"flex flex-row",children:[p.jsx(j,{className:"text-midGrey zx:text-pureBlack",children:s}),p.jsx(j,{className:"text-midRed zx:text-zxRedDimmed",children:""})]},n)),r&&p.jsx("div",{className:"flex flex-row sprites-double-height text-midRed zx:text-zxBlue",children:p.jsx(j,{TagName:"h1",children:r})})]})]})};var Lj=["second","minute","hour","day","week","month","year"];function Uj(t,e){if(e===0)return["just now","right now"];var r=Lj[Math.floor(e/2)];return t>1&&(r+="s"),[t+" "+r+" ago","in "+t+" "+r]}var $j=["","","","","","",""];function Gj(t,e){if(e===0)return["",""];var r=$j[~~(e/2)];return[t+" "+r+"",t+" "+r+""]}var Jh={},_w=function(t,e){Jh[t]=e},Hj=function(t){return Jh[t]||Jh.en_US},Su=[60,60,24,7,365/7/12,12];function Wj(t){return t instanceof Date?t:!isNaN(t)||/^\d+$/.test(t)?new Date(parseInt(t)):(t=(t||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(t))}function Yj(t,e){var r=t<0?1:0;t=Math.abs(t);for(var s=t,n=0;t>=Su[n]&&n<Su.length;n++)t/=Su[n];return t=Math.floor(t),n*=2,t>(n===0?9:1)&&(n+=1),e(t,n,s)[r].replace("%s",t.toString())}function Kj(t,e){var r=new Date;return(+r-+Wj(t))/1e3}var Qj=function(t,e,r){var s=Kj(t);return Yj(s,Hj(e))};_w("en_US",Uj);_w("zh_CN",Gj);var Ut={},Js={},Zs={},jA;function ec(){if(jA)return Zs;jA=1;var t=Zs&&Zs.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Zs,"__esModule",{value:!0});const r=t(On()).default.createContext({refs:{},renderItems:{},register:()=>{},unregister:()=>{}});return Zs.default=r,Zs}var OA;function Xj(){if(OA)return Js;OA=1;var t=Js&&Js.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Js,"__esModule",{value:!0});const e=t(On()),r=t(rq()),s=t(ec()),n=({id:i,children:o})=>{const{refs:a,renderItems:l}=e.default.useContext(s.default),c=a[i],u=l[i];return c?u?r.default.createPortal(u(o),c,i):r.default.createPortal(o,c,i):null};return Js.default=n,Js}var en={},NA;function Jj(){if(NA)return en;NA=1;var t=en&&en.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(en,"__esModule",{value:!0});const e=t(On()),r=t(ec()),s=({id:n,renderItem:i=a=>a,className:o})=>{const{register:a,unregister:l}=e.default.useContext(r.default),c=e.default.useRef(null);return e.default.useEffect(()=>(c.current&&a(n,c.current,i),()=>l(n)),[n,c.current]),e.default.createElement("div",{className:[`portal-placeholder-${n}`,o].filter(u=>!!u).join(" "),ref:c})};return en.default=s,en}var Fr={},BA;function Zj(){if(BA)return Fr;BA=1;var t=Fr&&Fr.__rest||function(i,o){var a={};for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&o.indexOf(l)<0&&(a[l]=i[l]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,l=Object.getOwnPropertySymbols(i);c<l.length;c++)o.indexOf(l[c])<0&&Object.prototype.propertyIsEnumerable.call(i,l[c])&&(a[l[c]]=i[l[c]]);return a},e=Fr&&Fr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Fr,"__esModule",{value:!0});const r=e(On()),s=e(ec()),n=({children:i})=>{const[o,a]=r.default.useState({}),[l,c]=r.default.useState({}),u=r.default.useCallback((d,m,g)=>{a(A=>Object.assign(Object.assign({},A),{[d]:m})),c(A=>Object.assign(Object.assign({},A),{[d]:g}))},[]),h=r.default.useCallback(d=>{a(m=>{const g=m,A=d;return g[A],t(g,[typeof A=="symbol"?A:A+""])}),c(m=>{const g=m,A=d;return g[A],t(g,[typeof A=="symbol"?A:A+""])})},[]),f=r.default.useMemo(()=>({refs:o,renderItems:l,register:u,unregister:h}),[o,l,u,h]);return r.default.createElement(s.default.Provider,{value:f},i)};return Fr.default=n,Fr}var DA;function eO(){if(DA)return Ut;DA=1;var t=Ut&&Ut.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.Context=Ut.Placeholder=Ut.Provider=void 0;const e=t(Xj()),r=t(Jj()),s=t(Zj()),n=t(ec());Ut.Provider=s.default,Ut.Placeholder=r.default,Ut.Context=n.default;const i=e.default;return i.Context=n.default,i.Placeholder=r.default,i.Provider=s.default,Ut.default=i,Ut}var tO=eO();const tc=Xe(tO),rO=({flip:t=!1,focussed:e=!1,verticalAlignItemsCentre:r=!1})=>p.jsx(j,{className:"inline-block col-start-1 w-min ml-auto "+(t?"scale-x-[-1] relative bottom-oneScaledPix":"")+(r===!0?"flex items-center h-3":""),children:e?"":""}),ce="leading-none [--line-gap:1px] [&_[class*='texture-hud']]:mb-[calc(var(--scale)*var(--line-gap))]",sO=["menu_select","swop","jump"],nO=()=>{},L=({id:t,label:e,valueElement:r,flipLeader:s=!1,doubleHeight:n=!1,doubleHeightWhenFocussed:i,onSelect:o=nO,hidden:a=!1,disabled:l=!1,hintInline:c=!1,className:u,hint:h,leader:f,verticalAlignItemsCentre:d=!1,opensSubMenu:m=!1,toParentMenu:g=!1})=>{const{menuItemProps:A,ref:y,focussed:b}=Vw({id:t,hidden:a,disabled:l,onSelect:o});Se({action:sO,handler:o,disabled:!b||a||l});const q=p.jsxs("li",{...A,"data-opens-submenu":m,"data-to-parent-menu":g,className:ht("contents cursor-pointer",a?"hidden":"",n||i&&b?"sprites-double-height":"",b?"selectedMenuItem":"",u),children:[f||p.jsx(rO,{verticalAlignItemsCentre:d,flip:s,focussed:b}),p.jsx("div",{ref:y,className:ht(r===void 0?"col-span-2":"",d===!0?"flex items-center":""),children:typeof e=="string"?p.jsx(p.Fragment,{children:p.jsx(j,{children:e})}):e}),r&&p.jsx("div",{className:`flex ${d===!0?"items-center":""}`,children:r}),!b||h===void 0||c?null:p.jsx(tc,{children:typeof h=="string"?p.jsx(j,{className:ce,children:h}):h})]});return c&&h?p.jsxs(p.Fragment,{children:[q,p.jsx("div",{className:"col-span-2 col-start-2 mb-1",children:h})]}):q},Ha="text-lightGrey zx:text-zxWhite sprites-normal-height",iO=({userId:t,campaignName:e,label:r,version:s,createdAt:n})=>p.jsx(L,{className:"sprites-double-height",id:`campaign-${t}-${e}`,label:r,doubleHeightWhenFocussed:!0,onSelect:z(co,{campaignLocator:{userId:t,campaignName:e,version:-1}}),hintInline:!0,hint:p.jsx("div",{"data-screenshot-mask":!0,children:p.jsx(j,{className:Ha,children:`v.${s} updated ${Qj(n)}`})})}),oO=({campaigns:t})=>p.jsx(p.Fragment,{children:p.jsx("div",{className:"zx:text-zxCyan  resHandheld:mt-half flex flex-col gap-2",children:Object.values(t).flatMap(e=>p.jsxs("div",{className:"flex flex-col gap-half",children:[p.jsxs(j,{className:"text-metallicBlue zx:text-zxYellow pl-4 sprites-double-height",children:["By ",e.user.username,":"]}),Object.values(e.campaigns).map(r=>p.jsx(p.Fragment,{children:p.jsx(Re,{children:p.jsx(iO,{userId:e.user.id,campaignName:r.name,label:`'${r.name}'`,version:r.version,createdAt:r.created_at})})},r.name))]},e.user.id))})}),aO=t=>{const{data:e,error:r,isLoading:s,refetch:n}=Wb({publishedOnly:!0});return v.useEffect(()=>{n()},[n]),p.jsx(ze,{children:p.jsxs(ke,{fullScreen:!0,className:"bg-metallicBlueHalfbrite text-highlightBeige zx:text-zxCyan selectedMenuItem:text-white zx:bg-zxRed gap-y-2 resHandheld:gap-y-1",dialogId:"communityGames",children:[p.jsx(yr,{path:["Play","Community"],className:"mobile:px-4"}),p.jsxs("div",{className:"flex flex-col gap-1 p-1 overflow-y-scroll scrollbar scrollbar-w-1 scrollbar-thumb-lightGrey scrollbar-track-metallicBlueHalfbrite zx:scrollbar-thumb-zxBlue zx:scrollbar-track-zxWhite mobile:px-3 [--leader-col-width:theme(width.3)] ",children:[r!==void 0?p.jsx(HI,{text:"Failed to load campaigns"}):null,s?p.jsx(WI,{}):null,e!==void 0?p.jsx(oO,{campaigns:e}):null]})]})})},W={x:16,y:16,z:12},Sw=Eo/1e3,J$={head:15e-5,heels:15e-5},Z$=1e3/110,eG=330,lO=2e-4,cO={head:W.z*2/1e3,others:W.z*6/1e3},tG=lO*.13,rG=cO.others*.85,sG=.8,nG=.001,kw={head:1,heels:2,charles:1,dalek:Math.SQRT2,bubbleRobot:(Math.SQRT2+1)/2,cyberman:1,skiHead:1,helicopterBug:1,homingBot:2,monkey:1,elephant:1,elephantHead:0,emperor:1,emperorsGuardian:Math.SQRT2,computerBot:1,turtle:1,ball:2.625,firedDoughnut:2,movingPlatform:1,floatingText:1},iG=Ld(kw,([t,e])=>[t,e*Sw]),uO=Ld(kw,([t,e])=>[t,(e*.8+.4)*Sw]),oG=1.5,hO=(t=1)=>t*Eo/1e3,aG=hO(),lG=2,zA=1.1,cG={head:W.z*2.6+zA,heels:W.z+1+zA},dO=10,uG=6e4,fO=8,hG=750,dG=1500,fG=200,pG=.25,mG=150,pO=8,mO=It.h-It.w/2,Cw=mO+2,Cf=9999,gG=1e3/12,gO=1e3/12,AG=100,yG=120,AO=["head","heels"],yO=[...AO,"headOverHeels"],qn=t=>t==="head"?"heels":"head";W.z;W.x/2;const Ew="@@original",qO="original",Tw={userId:Ew,campaignName:qO,version:-1},xO=t=>{const{queries:e}=t[ts.reducerPath],{mutations:r}=t[ts.reducerPath],s=Object.values(e??{}).some(o=>o?.status==="pending"),n=Object.values(r??{}).some(o=>o?.status==="pending"),i=yw(t)>0;return s||n||i},bO=ts.endpoints.getCampaign.select,wO=t=>{if(yw(t)>0)return!0;const{campaignLocator:r}=t.gameMenus.gameInPlay;return r!==void 0&&r!==Tw&&bO(r)(t).status==="pending"},VO=lf(xO),vO=lf(wO),xt=({className:t,onClick:e})=>VO()?p.jsx(HV,{}):p.jsx("div",{className:`fixed inset-0 z-border ${t??""}`,onClick:e});function Pw(t){var e,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(r=Pw(t[e]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function Ef(){for(var t,e,r=0,s="",n=arguments.length;r<n;r++)(t=arguments[r])&&(e=Pw(t))&&(s&&(s+=" "),s+=e);return s}function Tf(...t){return ht(Ef(t))}const _O=t=>t.replace(/ArrowLeft/g,"").replace(/ArrowRight/g,"").replace(/ArrowUp/g,"").replace(/ArrowDown/g,""),FA=t=>{const e=t.map(_O);return e.length===1?`

key: **${e[0]}**`:`

keys: ${e.map(r=>`**${r}**`).join(" or ")}`},Pf=(t,e)=>e?t?`${t}${FA(e)}`:FA(e):t;function Cr(t,e,{checkForDefaultPrevented:r=!0}={}){return function(n){if(t?.(n),r===!1||!n.defaultPrevented)return e?.(n)}}function LA(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Rw(...t){return e=>{let r=!1;const s=t.map(n=>{const i=LA(n,e);return!r&&typeof i=="function"&&(r=!0),i});if(r)return()=>{for(let n=0;n<s.length;n++){const i=s[n];typeof i=="function"?i():LA(t[n],null)}}}}function Ls(...t){return v.useCallback(Rw(...t),t)}function Mw(t,e=[]){let r=[];function s(i,o){const a=v.createContext(o),l=r.length;r=[...r,o];const c=h=>{const{scope:f,children:d,...m}=h,g=f?.[t]?.[l]||a,A=v.useMemo(()=>m,Object.values(m));return p.jsx(g.Provider,{value:A,children:d})};c.displayName=i+"Provider";function u(h,f){const d=f?.[t]?.[l]||a,m=v.useContext(d);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${i}\``)}return[c,u]}const n=()=>{const i=r.map(o=>v.createContext(o));return function(a){const l=a?.[t]||i;return v.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return n.scopeName=t,[s,SO(n,...e)]}function SO(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const s=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(i){const o=s.reduce((a,{useScope:l,scopeName:c})=>{const h=l(i)[`__scope${c}`];return{...a,...h}},{});return v.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return r.scopeName=e.scopeName,r}function kO(t){const e=CO(t),r=v.forwardRef((s,n)=>{const{children:i,...o}=s,a=v.Children.toArray(i),l=a.find(TO);if(l){const c=l.props.children,u=a.map(h=>h===l?v.Children.count(c)>1?v.Children.only(null):v.isValidElement(c)?c.props.children:null:h);return p.jsx(e,{...o,ref:n,children:v.isValidElement(c)?v.cloneElement(c,void 0,u):null})}return p.jsx(e,{...o,ref:n,children:i})});return r.displayName=`${t}.Slot`,r}function CO(t){const e=v.forwardRef((r,s)=>{const{children:n,...i}=r;if(v.isValidElement(n)){const o=RO(n),a=PO(i,n.props);return n.type!==v.Fragment&&(a.ref=s?Rw(s,o):o),v.cloneElement(n,a)}return v.Children.count(n)>1?v.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Iw=Symbol("radix.slottable");function EO(t){const e=({children:r})=>p.jsx(p.Fragment,{children:r});return e.displayName=`${t}.Slottable`,e.__radixId=Iw,e}function TO(t){return v.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Iw}function PO(t,e){const r={...e};for(const s in e){const n=t[s],i=e[s];/^on[A-Z]/.test(s)?n&&i?r[s]=(...a)=>{const l=i(...a);return n(...a),l}:n&&(r[s]=n):s==="style"?r[s]={...n,...i}:s==="className"&&(r[s]=[n,i].filter(Boolean).join(" "))}return{...t,...r}}function RO(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var MO=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],as=MO.reduce((t,e)=>{const r=kO(`Primitive.${e}`),s=v.forwardRef((n,i)=>{const{asChild:o,...a}=n,l=o?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),p.jsx(l,{...a,ref:i})});return s.displayName=`Primitive.${e}`,{...t,[e]:s}},{});function IO(t,e){t&&Zl.flushSync(()=>t.dispatchEvent(e))}function rc(t){const e=v.useRef(t);return v.useEffect(()=>{e.current=t}),v.useMemo(()=>(...r)=>e.current?.(...r),[])}function jO(t,e=globalThis?.document){const r=rc(t);v.useEffect(()=>{const s=n=>{n.key==="Escape"&&r(n)};return e.addEventListener("keydown",s,{capture:!0}),()=>e.removeEventListener("keydown",s,{capture:!0})},[r,e])}var OO="DismissableLayer",Zh="dismissableLayer.update",NO="dismissableLayer.pointerDownOutside",BO="dismissableLayer.focusOutside",UA,jw=v.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ow=v.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:s,onPointerDownOutside:n,onFocusOutside:i,onInteractOutside:o,onDismiss:a,...l}=t,c=v.useContext(jw),[u,h]=v.useState(null),f=u?.ownerDocument??globalThis?.document,[,d]=v.useState({}),m=Ls(e,w=>h(w)),g=Array.from(c.layers),[A]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),y=g.indexOf(A),b=u?g.indexOf(u):-1,q=c.layersWithOutsidePointerEventsDisabled.size>0,x=b>=y,V=FO(w=>{const S=w.target,k=[...c.branches].some(C=>C.contains(S));!x||k||(n?.(w),o?.(w),w.defaultPrevented||a?.())},f),_=LO(w=>{const S=w.target;[...c.branches].some(C=>C.contains(S))||(i?.(w),o?.(w),w.defaultPrevented||a?.())},f);return jO(w=>{b===c.layers.size-1&&(s?.(w),!w.defaultPrevented&&a&&(w.preventDefault(),a()))},f),v.useEffect(()=>{if(u)return r&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(UA=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),$A(),()=>{r&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=UA)}},[u,f,r,c]),v.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),$A())},[u,c]),v.useEffect(()=>{const w=()=>d({});return document.addEventListener(Zh,w),()=>document.removeEventListener(Zh,w)},[]),p.jsx(as.div,{...l,ref:m,style:{pointerEvents:q?x?"auto":"none":void 0,...t.style},onFocusCapture:Cr(t.onFocusCapture,_.onFocusCapture),onBlurCapture:Cr(t.onBlurCapture,_.onBlurCapture),onPointerDownCapture:Cr(t.onPointerDownCapture,V.onPointerDownCapture)})});Ow.displayName=OO;var DO="DismissableLayerBranch",zO=v.forwardRef((t,e)=>{const r=v.useContext(jw),s=v.useRef(null),n=Ls(e,s);return v.useEffect(()=>{const i=s.current;if(i)return r.branches.add(i),()=>{r.branches.delete(i)}},[r.branches]),p.jsx(as.div,{...t,ref:n})});zO.displayName=DO;function FO(t,e=globalThis?.document){const r=rc(t),s=v.useRef(!1),n=v.useRef(()=>{});return v.useEffect(()=>{const i=a=>{if(a.target&&!s.current){let l=function(){Nw(NO,r,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",n.current),n.current=l,e.addEventListener("click",n.current,{once:!0})):l()}else e.removeEventListener("click",n.current);s.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",i),e.removeEventListener("click",n.current)}},[e,r]),{onPointerDownCapture:()=>s.current=!0}}function LO(t,e=globalThis?.document){const r=rc(t),s=v.useRef(!1);return v.useEffect(()=>{const n=i=>{i.target&&!s.current&&Nw(BO,r,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",n),()=>e.removeEventListener("focusin",n)},[e,r]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function $A(){const t=new CustomEvent(Zh);document.dispatchEvent(t)}function Nw(t,e,r,{discrete:s}){const n=r.originalEvent.target,i=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&n.addEventListener(t,e,{once:!0}),s?IO(n,i):n.dispatchEvent(i)}var rs=globalThis?.document?v.useLayoutEffect:()=>{},UO=md[" useId ".trim().toString()]||(()=>{}),$O=0;function GO(t){const[e,r]=v.useState(UO());return rs(()=>{r(s=>s??String($O++))},[t]),e?`radix-${e}`:""}const HO=["top","right","bottom","left"],ss=Math.min,jt=Math.max,wl=Math.round,Ca=Math.floor,pr=t=>({x:t,y:t}),WO={left:"right",right:"left",bottom:"top",top:"bottom"},YO={start:"end",end:"start"};function ed(t,e,r){return jt(t,ss(e,r))}function Or(t,e){return typeof t=="function"?t(e):t}function Nr(t){return t.split("-")[0]}function Kn(t){return t.split("-")[1]}function Rf(t){return t==="x"?"y":"x"}function Mf(t){return t==="y"?"height":"width"}function ns(t){return["top","bottom"].includes(Nr(t))?"y":"x"}function If(t){return Rf(ns(t))}function KO(t,e,r){r===void 0&&(r=!1);const s=Kn(t),n=If(t),i=Mf(n);let o=n==="x"?s===(r?"end":"start")?"right":"left":s==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(o=Vl(o)),[o,Vl(o)]}function QO(t){const e=Vl(t);return[td(t),e,td(e)]}function td(t){return t.replace(/start|end/g,e=>YO[e])}function XO(t,e,r){const s=["left","right"],n=["right","left"],i=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return r?e?n:s:e?s:n;case"left":case"right":return e?i:o;default:return[]}}function JO(t,e,r,s){const n=Kn(t);let i=XO(Nr(t),r==="start",s);return n&&(i=i.map(o=>o+"-"+n),e&&(i=i.concat(i.map(td)))),i}function Vl(t){return t.replace(/left|right|bottom|top/g,e=>WO[e])}function ZO(t){return{top:0,right:0,bottom:0,left:0,...t}}function Bw(t){return typeof t!="number"?ZO(t):{top:t,right:t,bottom:t,left:t}}function vl(t){const{x:e,y:r,width:s,height:n}=t;return{width:s,height:n,top:r,left:e,right:e+s,bottom:r+n,x:e,y:r}}function GA(t,e,r){let{reference:s,floating:n}=t;const i=ns(e),o=If(e),a=Mf(o),l=Nr(e),c=i==="y",u=s.x+s.width/2-n.width/2,h=s.y+s.height/2-n.height/2,f=s[a]/2-n[a]/2;let d;switch(l){case"top":d={x:u,y:s.y-n.height};break;case"bottom":d={x:u,y:s.y+s.height};break;case"right":d={x:s.x+s.width,y:h};break;case"left":d={x:s.x-n.width,y:h};break;default:d={x:s.x,y:s.y}}switch(Kn(e)){case"start":d[o]-=f*(r&&c?-1:1);break;case"end":d[o]+=f*(r&&c?-1:1);break}return d}const eN=async(t,e,r)=>{const{placement:s="bottom",strategy:n="absolute",middleware:i=[],platform:o}=r,a=i.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:n}),{x:u,y:h}=GA(c,s,l),f=s,d={},m=0;for(let g=0;g<a.length;g++){const{name:A,fn:y}=a[g],{x:b,y:q,data:x,reset:V}=await y({x:u,y:h,initialPlacement:s,placement:f,strategy:n,middlewareData:d,rects:c,platform:o,elements:{reference:t,floating:e}});u=b??u,h=q??h,d={...d,[A]:{...d[A],...x}},V&&m<=50&&(m++,typeof V=="object"&&(V.placement&&(f=V.placement),V.rects&&(c=V.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:n}):V.rects),{x:u,y:h}=GA(c,f,l)),g=-1)}return{x:u,y:h,placement:f,strategy:n,middlewareData:d}};async function ho(t,e){var r;e===void 0&&(e={});const{x:s,y:n,platform:i,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:f=!1,padding:d=0}=Or(e,t),m=Bw(d),A=a[f?h==="floating"?"reference":"floating":h],y=vl(await i.getClippingRect({element:(r=await(i.isElement==null?void 0:i.isElement(A)))==null||r?A:A.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),b=h==="floating"?{x:s,y:n,width:o.floating.width,height:o.floating.height}:o.reference,q=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),x=await(i.isElement==null?void 0:i.isElement(q))?await(i.getScale==null?void 0:i.getScale(q))||{x:1,y:1}:{x:1,y:1},V=vl(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:b,offsetParent:q,strategy:l}):b);return{top:(y.top-V.top+m.top)/x.y,bottom:(V.bottom-y.bottom+m.bottom)/x.y,left:(y.left-V.left+m.left)/x.x,right:(V.right-y.right+m.right)/x.x}}const tN=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:s,placement:n,rects:i,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Or(t,e)||{};if(c==null)return{};const h=Bw(u),f={x:r,y:s},d=If(n),m=Mf(d),g=await o.getDimensions(c),A=d==="y",y=A?"top":"left",b=A?"bottom":"right",q=A?"clientHeight":"clientWidth",x=i.reference[m]+i.reference[d]-f[d]-i.floating[m],V=f[d]-i.reference[d],_=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let w=_?_[q]:0;(!w||!await(o.isElement==null?void 0:o.isElement(_)))&&(w=a.floating[q]||i.floating[m]);const S=x/2-V/2,k=w/2-g[m]/2-1,C=ss(h[y],k),E=ss(h[b],k),T=C,R=w-g[m]-E,M=w/2-g[m]/2+S,D=ed(T,M,R),P=!l.arrow&&Kn(n)!=null&&M!==D&&i.reference[m]/2-(M<T?C:E)-g[m]/2<0,I=P?M<T?M-T:M-R:0;return{[d]:f[d]+I,data:{[d]:D,centerOffset:M-D-I,...P&&{alignmentOffset:I}},reset:P}}}),rN=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,s;const{placement:n,middlewareData:i,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:f,fallbackStrategy:d="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:g=!0,...A}=Or(t,e);if((r=i.arrow)!=null&&r.alignmentOffset)return{};const y=Nr(n),b=ns(a),q=Nr(a)===a,x=await(l.isRTL==null?void 0:l.isRTL(c.floating)),V=f||(q||!g?[Vl(a)]:QO(a)),_=m!=="none";!f&&_&&V.push(...JO(a,g,m,x));const w=[a,...V],S=await ho(e,A),k=[];let C=((s=i.flip)==null?void 0:s.overflows)||[];if(u&&k.push(S[y]),h){const M=KO(n,o,x);k.push(S[M[0]],S[M[1]])}if(C=[...C,{placement:n,overflows:k}],!k.every(M=>M<=0)){var E,T;const M=(((E=i.flip)==null?void 0:E.index)||0)+1,D=w[M];if(D)return{data:{index:M,overflows:C},reset:{placement:D}};let P=(T=C.filter(I=>I.overflows[0]<=0).sort((I,B)=>I.overflows[1]-B.overflows[1])[0])==null?void 0:T.placement;if(!P)switch(d){case"bestFit":{var R;const I=(R=C.filter(B=>{if(_){const F=ns(B.placement);return F===b||F==="y"}return!0}).map(B=>[B.placement,B.overflows.filter(F=>F>0).reduce((F,Q)=>F+Q,0)]).sort((B,F)=>B[1]-F[1])[0])==null?void 0:R[0];I&&(P=I);break}case"initialPlacement":P=a;break}if(n!==P)return{reset:{placement:P}}}return{}}}};function HA(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function WA(t){return HO.some(e=>t[e]>=0)}const sN=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:s="referenceHidden",...n}=Or(t,e);switch(s){case"referenceHidden":{const i=await ho(e,{...n,elementContext:"reference"}),o=HA(i,r.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:WA(o)}}}case"escaped":{const i=await ho(e,{...n,altBoundary:!0}),o=HA(i,r.floating);return{data:{escapedOffsets:o,escaped:WA(o)}}}default:return{}}}}};async function nN(t,e){const{placement:r,platform:s,elements:n}=t,i=await(s.isRTL==null?void 0:s.isRTL(n.floating)),o=Nr(r),a=Kn(r),l=ns(r)==="y",c=["left","top"].includes(o)?-1:1,u=i&&l?-1:1,h=Or(e,t);let{mainAxis:f,crossAxis:d,alignmentAxis:m}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return a&&typeof m=="number"&&(d=a==="end"?m*-1:m),l?{x:d*u,y:f*c}:{x:f*c,y:d*u}}const iN=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,s;const{x:n,y:i,placement:o,middlewareData:a}=e,l=await nN(e,t);return o===((r=a.offset)==null?void 0:r.placement)&&(s=a.arrow)!=null&&s.alignmentOffset?{}:{x:n+l.x,y:i+l.y,data:{...l,placement:o}}}}},oN=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:s,placement:n}=e,{mainAxis:i=!0,crossAxis:o=!1,limiter:a={fn:A=>{let{x:y,y:b}=A;return{x:y,y:b}}},...l}=Or(t,e),c={x:r,y:s},u=await ho(e,l),h=ns(Nr(n)),f=Rf(h);let d=c[f],m=c[h];if(i){const A=f==="y"?"top":"left",y=f==="y"?"bottom":"right",b=d+u[A],q=d-u[y];d=ed(b,d,q)}if(o){const A=h==="y"?"top":"left",y=h==="y"?"bottom":"right",b=m+u[A],q=m-u[y];m=ed(b,m,q)}const g=a.fn({...e,[f]:d,[h]:m});return{...g,data:{x:g.x-r,y:g.y-s,enabled:{[f]:i,[h]:o}}}}}},aN=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:s,placement:n,rects:i,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Or(t,e),u={x:r,y:s},h=ns(n),f=Rf(h);let d=u[f],m=u[h];const g=Or(a,e),A=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const q=f==="y"?"height":"width",x=i.reference[f]-i.floating[q]+A.mainAxis,V=i.reference[f]+i.reference[q]-A.mainAxis;d<x?d=x:d>V&&(d=V)}if(c){var y,b;const q=f==="y"?"width":"height",x=["top","left"].includes(Nr(n)),V=i.reference[h]-i.floating[q]+(x&&((y=o.offset)==null?void 0:y[h])||0)+(x?0:A.crossAxis),_=i.reference[h]+i.reference[q]+(x?0:((b=o.offset)==null?void 0:b[h])||0)-(x?A.crossAxis:0);m<V?m=V:m>_&&(m=_)}return{[f]:d,[h]:m}}}},lN=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var r,s;const{placement:n,rects:i,platform:o,elements:a}=e,{apply:l=()=>{},...c}=Or(t,e),u=await ho(e,c),h=Nr(n),f=Kn(n),d=ns(n)==="y",{width:m,height:g}=i.floating;let A,y;h==="top"||h==="bottom"?(A=h,y=f===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(y=h,A=f==="end"?"top":"bottom");const b=g-u.top-u.bottom,q=m-u.left-u.right,x=ss(g-u[A],b),V=ss(m-u[y],q),_=!e.middlewareData.shift;let w=x,S=V;if((r=e.middlewareData.shift)!=null&&r.enabled.x&&(S=q),(s=e.middlewareData.shift)!=null&&s.enabled.y&&(w=b),_&&!f){const C=jt(u.left,0),E=jt(u.right,0),T=jt(u.top,0),R=jt(u.bottom,0);d?S=m-2*(C!==0||E!==0?C+E:jt(u.left,u.right)):w=g-2*(T!==0||R!==0?T+R:jt(u.top,u.bottom))}await l({...e,availableWidth:S,availableHeight:w});const k=await o.getDimensions(a.floating);return m!==k.width||g!==k.height?{reset:{rects:!0}}:{}}}};function sc(){return typeof window<"u"}function Qn(t){return Dw(t)?(t.nodeName||"").toLowerCase():"#document"}function Bt(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function qr(t){var e;return(e=(Dw(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function Dw(t){return sc()?t instanceof Node||t instanceof Bt(t).Node:!1}function ir(t){return sc()?t instanceof Element||t instanceof Bt(t).Element:!1}function Ar(t){return sc()?t instanceof HTMLElement||t instanceof Bt(t).HTMLElement:!1}function YA(t){return!sc()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Bt(t).ShadowRoot}function Mo(t){const{overflow:e,overflowX:r,overflowY:s,display:n}=or(t);return/auto|scroll|overlay|hidden|clip/.test(e+s+r)&&!["inline","contents"].includes(n)}function cN(t){return["table","td","th"].includes(Qn(t))}function nc(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function jf(t){const e=Of(),r=ir(t)?or(t):t;return["transform","translate","scale","rotate","perspective"].some(s=>r[s]?r[s]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(s=>(r.willChange||"").includes(s))||["paint","layout","strict","content"].some(s=>(r.contain||"").includes(s))}function uN(t){let e=is(t);for(;Ar(e)&&!Cn(e);){if(jf(e))return e;if(nc(e))return null;e=is(e)}return null}function Of(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Cn(t){return["html","body","#document"].includes(Qn(t))}function or(t){return Bt(t).getComputedStyle(t)}function ic(t){return ir(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function is(t){if(Qn(t)==="html")return t;const e=t.assignedSlot||t.parentNode||YA(t)&&t.host||qr(t);return YA(e)?e.host:e}function zw(t){const e=is(t);return Cn(e)?t.ownerDocument?t.ownerDocument.body:t.body:Ar(e)&&Mo(e)?e:zw(e)}function fo(t,e,r){var s;e===void 0&&(e=[]),r===void 0&&(r=!0);const n=zw(t),i=n===((s=t.ownerDocument)==null?void 0:s.body),o=Bt(n);if(i){const a=rd(o);return e.concat(o,o.visualViewport||[],Mo(n)?n:[],a&&r?fo(a):[])}return e.concat(n,fo(n,[],r))}function rd(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Fw(t){const e=or(t);let r=parseFloat(e.width)||0,s=parseFloat(e.height)||0;const n=Ar(t),i=n?t.offsetWidth:r,o=n?t.offsetHeight:s,a=wl(r)!==i||wl(s)!==o;return a&&(r=i,s=o),{width:r,height:s,$:a}}function Nf(t){return ir(t)?t:t.contextElement}function xn(t){const e=Nf(t);if(!Ar(e))return pr(1);const r=e.getBoundingClientRect(),{width:s,height:n,$:i}=Fw(e);let o=(i?wl(r.width):r.width)/s,a=(i?wl(r.height):r.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const hN=pr(0);function Lw(t){const e=Bt(t);return!Of()||!e.visualViewport?hN:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function dN(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==Bt(t)?!1:e}function Ds(t,e,r,s){e===void 0&&(e=!1),r===void 0&&(r=!1);const n=t.getBoundingClientRect(),i=Nf(t);let o=pr(1);e&&(s?ir(s)&&(o=xn(s)):o=xn(t));const a=dN(i,r,s)?Lw(i):pr(0);let l=(n.left+a.x)/o.x,c=(n.top+a.y)/o.y,u=n.width/o.x,h=n.height/o.y;if(i){const f=Bt(i),d=s&&ir(s)?Bt(s):s;let m=f,g=rd(m);for(;g&&s&&d!==m;){const A=xn(g),y=g.getBoundingClientRect(),b=or(g),q=y.left+(g.clientLeft+parseFloat(b.paddingLeft))*A.x,x=y.top+(g.clientTop+parseFloat(b.paddingTop))*A.y;l*=A.x,c*=A.y,u*=A.x,h*=A.y,l+=q,c+=x,m=Bt(g),g=rd(m)}}return vl({width:u,height:h,x:l,y:c})}function Bf(t,e){const r=ic(t).scrollLeft;return e?e.left+r:Ds(qr(t)).left+r}function Uw(t,e,r){r===void 0&&(r=!1);const s=t.getBoundingClientRect(),n=s.left+e.scrollLeft-(r?0:Bf(t,s)),i=s.top+e.scrollTop;return{x:n,y:i}}function fN(t){let{elements:e,rect:r,offsetParent:s,strategy:n}=t;const i=n==="fixed",o=qr(s),a=e?nc(e.floating):!1;if(s===o||a&&i)return r;let l={scrollLeft:0,scrollTop:0},c=pr(1);const u=pr(0),h=Ar(s);if((h||!h&&!i)&&((Qn(s)!=="body"||Mo(o))&&(l=ic(s)),Ar(s))){const d=Ds(s);c=xn(s),u.x=d.x+s.clientLeft,u.y=d.y+s.clientTop}const f=o&&!h&&!i?Uw(o,l,!0):pr(0);return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:r.y*c.y-l.scrollTop*c.y+u.y+f.y}}function pN(t){return Array.from(t.getClientRects())}function mN(t){const e=qr(t),r=ic(t),s=t.ownerDocument.body,n=jt(e.scrollWidth,e.clientWidth,s.scrollWidth,s.clientWidth),i=jt(e.scrollHeight,e.clientHeight,s.scrollHeight,s.clientHeight);let o=-r.scrollLeft+Bf(t);const a=-r.scrollTop;return or(s).direction==="rtl"&&(o+=jt(e.clientWidth,s.clientWidth)-n),{width:n,height:i,x:o,y:a}}function gN(t,e){const r=Bt(t),s=qr(t),n=r.visualViewport;let i=s.clientWidth,o=s.clientHeight,a=0,l=0;if(n){i=n.width,o=n.height;const c=Of();(!c||c&&e==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}return{width:i,height:o,x:a,y:l}}function AN(t,e){const r=Ds(t,!0,e==="fixed"),s=r.top+t.clientTop,n=r.left+t.clientLeft,i=Ar(t)?xn(t):pr(1),o=t.clientWidth*i.x,a=t.clientHeight*i.y,l=n*i.x,c=s*i.y;return{width:o,height:a,x:l,y:c}}function KA(t,e,r){let s;if(e==="viewport")s=gN(t,r);else if(e==="document")s=mN(qr(t));else if(ir(e))s=AN(e,r);else{const n=Lw(t);s={x:e.x-n.x,y:e.y-n.y,width:e.width,height:e.height}}return vl(s)}function $w(t,e){const r=is(t);return r===e||!ir(r)||Cn(r)?!1:or(r).position==="fixed"||$w(r,e)}function yN(t,e){const r=e.get(t);if(r)return r;let s=fo(t,[],!1).filter(a=>ir(a)&&Qn(a)!=="body"),n=null;const i=or(t).position==="fixed";let o=i?is(t):t;for(;ir(o)&&!Cn(o);){const a=or(o),l=jf(o);!l&&a.position==="fixed"&&(n=null),(i?!l&&!n:!l&&a.position==="static"&&!!n&&["absolute","fixed"].includes(n.position)||Mo(o)&&!l&&$w(t,o))?s=s.filter(u=>u!==o):n=a,o=is(o)}return e.set(t,s),s}function qN(t){let{element:e,boundary:r,rootBoundary:s,strategy:n}=t;const o=[...r==="clippingAncestors"?nc(e)?[]:yN(e,this._c):[].concat(r),s],a=o[0],l=o.reduce((c,u)=>{const h=KA(e,u,n);return c.top=jt(h.top,c.top),c.right=ss(h.right,c.right),c.bottom=ss(h.bottom,c.bottom),c.left=jt(h.left,c.left),c},KA(e,a,n));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function xN(t){const{width:e,height:r}=Fw(t);return{width:e,height:r}}function bN(t,e,r){const s=Ar(e),n=qr(e),i=r==="fixed",o=Ds(t,!0,i,e);let a={scrollLeft:0,scrollTop:0};const l=pr(0);if(s||!s&&!i)if((Qn(e)!=="body"||Mo(n))&&(a=ic(e)),s){const f=Ds(e,!0,i,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else n&&(l.x=Bf(n));const c=n&&!s&&!i?Uw(n,a):pr(0),u=o.left+a.scrollLeft-l.x-c.x,h=o.top+a.scrollTop-l.y-c.y;return{x:u,y:h,width:o.width,height:o.height}}function ku(t){return or(t).position==="static"}function QA(t,e){if(!Ar(t)||or(t).position==="fixed")return null;if(e)return e(t);let r=t.offsetParent;return qr(t)===r&&(r=r.ownerDocument.body),r}function Gw(t,e){const r=Bt(t);if(nc(t))return r;if(!Ar(t)){let n=is(t);for(;n&&!Cn(n);){if(ir(n)&&!ku(n))return n;n=is(n)}return r}let s=QA(t,e);for(;s&&cN(s)&&ku(s);)s=QA(s,e);return s&&Cn(s)&&ku(s)&&!jf(s)?r:s||uN(t)||r}const wN=async function(t){const e=this.getOffsetParent||Gw,r=this.getDimensions,s=await r(t.floating);return{reference:bN(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function VN(t){return or(t).direction==="rtl"}const vN={convertOffsetParentRelativeRectToViewportRelativeRect:fN,getDocumentElement:qr,getClippingRect:qN,getOffsetParent:Gw,getElementRects:wN,getClientRects:pN,getDimensions:xN,getScale:xn,isElement:ir,isRTL:VN};function Hw(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function _N(t,e){let r=null,s;const n=qr(t);function i(){var a;clearTimeout(s),(a=r)==null||a.disconnect(),r=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),i();const c=t.getBoundingClientRect(),{left:u,top:h,width:f,height:d}=c;if(a||e(),!f||!d)return;const m=Ca(h),g=Ca(n.clientWidth-(u+f)),A=Ca(n.clientHeight-(h+d)),y=Ca(u),q={rootMargin:-m+"px "+-g+"px "+-A+"px "+-y+"px",threshold:jt(0,ss(1,l))||1};let x=!0;function V(_){const w=_[0].intersectionRatio;if(w!==l){if(!x)return o();w?o(!1,w):s=setTimeout(()=>{o(!1,1e-7)},1e3)}w===1&&!Hw(c,t.getBoundingClientRect())&&o(),x=!1}try{r=new IntersectionObserver(V,{...q,root:n.ownerDocument})}catch{r=new IntersectionObserver(V,q)}r.observe(t)}return o(!0),i}function SN(t,e,r,s){s===void 0&&(s={});const{ancestorScroll:n=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=s,c=Nf(t),u=n||i?[...c?fo(c):[],...fo(e)]:[];u.forEach(y=>{n&&y.addEventListener("scroll",r,{passive:!0}),i&&y.addEventListener("resize",r)});const h=c&&a?_N(c,r):null;let f=-1,d=null;o&&(d=new ResizeObserver(y=>{let[b]=y;b&&b.target===c&&d&&(d.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var q;(q=d)==null||q.observe(e)})),r()}),c&&!l&&d.observe(c),d.observe(e));let m,g=l?Ds(t):null;l&&A();function A(){const y=Ds(t);g&&!Hw(g,y)&&r(),g=y,m=requestAnimationFrame(A)}return r(),()=>{var y;u.forEach(b=>{n&&b.removeEventListener("scroll",r),i&&b.removeEventListener("resize",r)}),h?.(),(y=d)==null||y.disconnect(),d=null,l&&cancelAnimationFrame(m)}}const kN=iN,CN=oN,EN=rN,TN=lN,PN=sN,XA=tN,RN=aN,MN=(t,e,r)=>{const s=new Map,n={platform:vN,...r},i={...n.platform,_c:s};return eN(t,e,{...n,platform:i})};var Wa=typeof document<"u"?v.useLayoutEffect:v.useEffect;function _l(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,s,n;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(s=r;s--!==0;)if(!_l(t[s],e[s]))return!1;return!0}if(n=Object.keys(t),r=n.length,r!==Object.keys(e).length)return!1;for(s=r;s--!==0;)if(!{}.hasOwnProperty.call(e,n[s]))return!1;for(s=r;s--!==0;){const i=n[s];if(!(i==="_owner"&&t.$$typeof)&&!_l(t[i],e[i]))return!1}return!0}return t!==t&&e!==e}function Ww(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function JA(t,e){const r=Ww(t);return Math.round(e*r)/r}function Cu(t){const e=v.useRef(t);return Wa(()=>{e.current=t}),e}function IN(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:s=[],platform:n,elements:{reference:i,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,h]=v.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[f,d]=v.useState(s);_l(f,s)||d(s);const[m,g]=v.useState(null),[A,y]=v.useState(null),b=v.useCallback(B=>{B!==_.current&&(_.current=B,g(B))},[]),q=v.useCallback(B=>{B!==w.current&&(w.current=B,y(B))},[]),x=i||m,V=o||A,_=v.useRef(null),w=v.useRef(null),S=v.useRef(u),k=l!=null,C=Cu(l),E=Cu(n),T=Cu(c),R=v.useCallback(()=>{if(!_.current||!w.current)return;const B={placement:e,strategy:r,middleware:f};E.current&&(B.platform=E.current),MN(_.current,w.current,B).then(F=>{const Q={...F,isPositioned:T.current!==!1};M.current&&!_l(S.current,Q)&&(S.current=Q,Zl.flushSync(()=>{h(Q)}))})},[f,e,r,E,T]);Wa(()=>{c===!1&&S.current.isPositioned&&(S.current.isPositioned=!1,h(B=>({...B,isPositioned:!1})))},[c]);const M=v.useRef(!1);Wa(()=>(M.current=!0,()=>{M.current=!1}),[]),Wa(()=>{if(x&&(_.current=x),V&&(w.current=V),x&&V){if(C.current)return C.current(x,V,R);R()}},[x,V,R,C,k]);const D=v.useMemo(()=>({reference:_,floating:w,setReference:b,setFloating:q}),[b,q]),P=v.useMemo(()=>({reference:x,floating:V}),[x,V]),I=v.useMemo(()=>{const B={position:r,left:0,top:0};if(!P.floating)return B;const F=JA(P.floating,u.x),Q=JA(P.floating,u.y);return a?{...B,transform:"translate("+F+"px, "+Q+"px)",...Ww(P.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:F,top:Q}},[r,a,P.floating,u.x,u.y]);return v.useMemo(()=>({...u,update:R,refs:D,elements:P,floatingStyles:I}),[u,R,D,P,I])}const jN=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:s,padding:n}=typeof t=="function"?t(r):t;return s&&e(s)?s.current!=null?XA({element:s.current,padding:n}).fn(r):{}:s?XA({element:s,padding:n}).fn(r):{}}}},ON=(t,e)=>({...kN(t),options:[t,e]}),NN=(t,e)=>({...CN(t),options:[t,e]}),BN=(t,e)=>({...RN(t),options:[t,e]}),DN=(t,e)=>({...EN(t),options:[t,e]}),zN=(t,e)=>({...TN(t),options:[t,e]}),FN=(t,e)=>({...PN(t),options:[t,e]}),LN=(t,e)=>({...jN(t),options:[t,e]});var UN="Arrow",Yw=v.forwardRef((t,e)=>{const{children:r,width:s=10,height:n=5,...i}=t;return p.jsx(as.svg,{...i,ref:e,width:s,height:n,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:p.jsx("polygon",{points:"0,0 30,0 15,10"})})});Yw.displayName=UN;var $N=Yw;function GN(t){const[e,r]=v.useState(void 0);return rs(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const s=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const i=n[0];let o,a;if("borderBoxSize"in i){const l=i.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=t.offsetWidth,a=t.offsetHeight;r({width:o,height:a})});return s.observe(t,{box:"border-box"}),()=>s.unobserve(t)}else r(void 0)},[t]),e}var Df="Popper",[Kw,Qw]=Mw(Df),[HN,Xw]=Kw(Df),Jw=t=>{const{__scopePopper:e,children:r}=t,[s,n]=v.useState(null);return p.jsx(HN,{scope:e,anchor:s,onAnchorChange:n,children:r})};Jw.displayName=Df;var Zw="PopperAnchor",eV=v.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:s,...n}=t,i=Xw(Zw,r),o=v.useRef(null),a=Ls(e,o);return v.useEffect(()=>{i.onAnchorChange(s?.current||o.current)}),s?null:p.jsx(as.div,{...n,ref:a})});eV.displayName=Zw;var zf="PopperContent",[WN,YN]=Kw(zf),tV=v.forwardRef((t,e)=>{const{__scopePopper:r,side:s="bottom",sideOffset:n=0,align:i="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:h="partial",hideWhenDetached:f=!1,updatePositionStrategy:d="optimized",onPlaced:m,...g}=t,A=Xw(zf,r),[y,b]=v.useState(null),q=Ls(e,Fe=>b(Fe)),[x,V]=v.useState(null),_=GN(x),w=_?.width??0,S=_?.height??0,k=s+(i!=="center"?"-"+i:""),C=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},E=Array.isArray(c)?c:[c],T=E.length>0,R={padding:C,boundary:E.filter(QN),altBoundary:T},{refs:M,floatingStyles:D,placement:P,isPositioned:I,middlewareData:B}=IN({strategy:"fixed",placement:k,whileElementsMounted:(...Fe)=>SN(...Fe,{animationFrame:d==="always"}),elements:{reference:A.anchor},middleware:[ON({mainAxis:n+S,alignmentAxis:o}),l&&NN({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?BN():void 0,...R}),l&&DN({...R}),zN({...R,apply:({elements:Fe,rects:ar,availableWidth:wt,availableHeight:Jt})=>{const{width:xr,height:Et}=ar.reference,Vt=Fe.floating.style;Vt.setProperty("--radix-popper-available-width",`${wt}px`),Vt.setProperty("--radix-popper-available-height",`${Jt}px`),Vt.setProperty("--radix-popper-anchor-width",`${xr}px`),Vt.setProperty("--radix-popper-anchor-height",`${Et}px`)}}),x&&LN({element:x,padding:a}),XN({arrowWidth:w,arrowHeight:S}),f&&FN({strategy:"referenceHidden",...R})]}),[F,Q]=nV(P),he=rc(m);rs(()=>{I&&he?.()},[I,he]);const ie=B.arrow?.x,se=B.arrow?.y,J=B.arrow?.centerOffset!==0,[Z,de]=v.useState();return rs(()=>{y&&de(window.getComputedStyle(y).zIndex)},[y]),p.jsx("div",{ref:M.setFloating,"data-radix-popper-content-wrapper":"",style:{...D,transform:I?D.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Z,"--radix-popper-transform-origin":[B.transformOrigin?.x,B.transformOrigin?.y].join(" "),...B.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:p.jsx(WN,{scope:r,placedSide:F,onArrowChange:V,arrowX:ie,arrowY:se,shouldHideArrow:J,children:p.jsx(as.div,{"data-side":F,"data-align":Q,...g,ref:q,style:{...g.style,animation:I?void 0:"none"}})})})});tV.displayName=zf;var rV="PopperArrow",KN={top:"bottom",right:"left",bottom:"top",left:"right"},sV=v.forwardRef(function(e,r){const{__scopePopper:s,...n}=e,i=YN(rV,s),o=KN[i.placedSide];return p.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:p.jsx($N,{...n,ref:r,style:{...n.style,display:"block"}})})});sV.displayName=rV;function QN(t){return t!==null}var XN=t=>({name:"transformOrigin",options:t,fn(e){const{placement:r,rects:s,middlewareData:n}=e,o=n.arrow?.centerOffset!==0,a=o?0:t.arrowWidth,l=o?0:t.arrowHeight,[c,u]=nV(r),h={start:"0%",center:"50%",end:"100%"}[u],f=(n.arrow?.x??0)+a/2,d=(n.arrow?.y??0)+l/2;let m="",g="";return c==="bottom"?(m=o?h:`${f}px`,g=`${-l}px`):c==="top"?(m=o?h:`${f}px`,g=`${s.floating.height+l}px`):c==="right"?(m=`${-l}px`,g=o?h:`${d}px`):c==="left"&&(m=`${s.floating.width+l}px`,g=o?h:`${d}px`),{data:{x:m,y:g}}}});function nV(t){const[e,r="center"]=t.split("-");return[e,r]}var JN=Jw,ZN=eV,eB=tV,tB=sV,rB="Portal",iV=v.forwardRef((t,e)=>{const{container:r,...s}=t,[n,i]=v.useState(!1);rs(()=>i(!0),[]);const o=r||n&&globalThis?.document?.body;return o?zI.createPortal(p.jsx(as.div,{...s,ref:e}),o):null});iV.displayName=rB;function sB(t,e){return v.useReducer((r,s)=>e[r][s]??r,t)}var Ff=t=>{const{present:e,children:r}=t,s=nB(e),n=typeof r=="function"?r({present:s.isPresent}):v.Children.only(r),i=Ls(s.ref,iB(n));return typeof r=="function"||s.isPresent?v.cloneElement(n,{ref:i}):null};Ff.displayName="Presence";function nB(t){const[e,r]=v.useState(),s=v.useRef(null),n=v.useRef(t),i=v.useRef("none"),o=t?"mounted":"unmounted",[a,l]=sB(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return v.useEffect(()=>{const c=Ea(s.current);i.current=a==="mounted"?c:"none"},[a]),rs(()=>{const c=s.current,u=n.current;if(u!==t){const f=i.current,d=Ea(c);t?l("MOUNT"):d==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&f!==d?"ANIMATION_OUT":"UNMOUNT"),n.current=t}},[t,l]),rs(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,h=d=>{const g=Ea(s.current).includes(d.animationName);if(d.target===e&&g&&(l("ANIMATION_END"),!n.current)){const A=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=A)})}},f=d=>{d.target===e&&(i.current=Ea(s.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:v.useCallback(c=>{s.current=c?getComputedStyle(c):null,r(c)},[])}}function Ea(t){return t?.animationName||"none"}function iB(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var oB=md[" useInsertionEffect ".trim().toString()]||rs;function aB({prop:t,defaultProp:e,onChange:r=()=>{},caller:s}){const[n,i,o]=lB({defaultProp:e,onChange:r}),a=t!==void 0,l=a?t:n;{const u=v.useRef(t!==void 0);v.useEffect(()=>{const h=u.current;h!==a&&console.warn(`${s} is changing from ${h?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,s])}const c=v.useCallback(u=>{if(a){const h=cB(u)?u(t):u;h!==t&&o.current?.(h)}else i(u)},[a,t,i,o]);return[l,c]}function lB({defaultProp:t,onChange:e}){const[r,s]=v.useState(t),n=v.useRef(r),i=v.useRef(e);return oB(()=>{i.current=e},[e]),v.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,s,i]}function cB(t){return typeof t=="function"}var uB=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),hB="VisuallyHidden",oV=v.forwardRef((t,e)=>p.jsx(as.span,{...t,ref:e,style:{...uB,...t.style}}));oV.displayName=hB;var dB=oV,[oc]=Mw("Tooltip",[Qw]),ac=Qw(),fB="TooltipProvider",sd="tooltip.open",[qG,Lf]=oc(fB),po="Tooltip",[pB,Io]=oc(po),aV=t=>{const{__scopeTooltip:e,children:r,open:s,defaultOpen:n,onOpenChange:i,disableHoverableContent:o,delayDuration:a}=t,l=Lf(po,t.__scopeTooltip),c=ac(e),[u,h]=v.useState(null),f=GO(),d=v.useRef(0),m=o??l.disableHoverableContent,g=a??l.delayDuration,A=v.useRef(!1),[y,b]=aB({prop:s,defaultProp:n??!1,onChange:w=>{w?(l.onOpen(),document.dispatchEvent(new CustomEvent(sd))):l.onClose(),i?.(w)},caller:po}),q=v.useMemo(()=>y?A.current?"delayed-open":"instant-open":"closed",[y]),x=v.useCallback(()=>{window.clearTimeout(d.current),d.current=0,A.current=!1,b(!0)},[b]),V=v.useCallback(()=>{window.clearTimeout(d.current),d.current=0,b(!1)},[b]),_=v.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>{A.current=!0,b(!0),d.current=0},g)},[g,b]);return v.useEffect(()=>()=>{d.current&&(window.clearTimeout(d.current),d.current=0)},[]),p.jsx(JN,{...c,children:p.jsx(pB,{scope:e,contentId:f,open:y,stateAttribute:q,trigger:u,onTriggerChange:h,onTriggerEnter:v.useCallback(()=>{l.isOpenDelayedRef.current?_():x()},[l.isOpenDelayedRef,_,x]),onTriggerLeave:v.useCallback(()=>{m?V():(window.clearTimeout(d.current),d.current=0)},[V,m]),onOpen:x,onClose:V,disableHoverableContent:m,children:r})})};aV.displayName=po;var nd="TooltipTrigger",lV=v.forwardRef((t,e)=>{const{__scopeTooltip:r,...s}=t,n=Io(nd,r),i=Lf(nd,r),o=ac(r),a=v.useRef(null),l=Ls(e,a,n.onTriggerChange),c=v.useRef(!1),u=v.useRef(!1),h=v.useCallback(()=>c.current=!1,[]);return v.useEffect(()=>()=>document.removeEventListener("pointerup",h),[h]),p.jsx(ZN,{asChild:!0,...o,children:p.jsx(as.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...s,ref:l,onPointerMove:Cr(t.onPointerMove,f=>{f.pointerType!=="touch"&&!u.current&&!i.isPointerInTransitRef.current&&(n.onTriggerEnter(),u.current=!0)}),onPointerLeave:Cr(t.onPointerLeave,()=>{n.onTriggerLeave(),u.current=!1}),onPointerDown:Cr(t.onPointerDown,()=>{n.open&&n.onClose(),c.current=!0,document.addEventListener("pointerup",h,{once:!0})}),onFocus:Cr(t.onFocus,()=>{c.current||n.onOpen()}),onBlur:Cr(t.onBlur,n.onClose),onClick:Cr(t.onClick,n.onClose)})})});lV.displayName=nd;var Uf="TooltipPortal",[mB,gB]=oc(Uf,{forceMount:void 0}),cV=t=>{const{__scopeTooltip:e,forceMount:r,children:s,container:n}=t,i=Io(Uf,e);return p.jsx(mB,{scope:e,forceMount:r,children:p.jsx(Ff,{present:r||i.open,children:p.jsx(iV,{asChild:!0,container:n,children:s})})})};cV.displayName=Uf;var En="TooltipContent",uV=v.forwardRef((t,e)=>{const r=gB(En,t.__scopeTooltip),{forceMount:s=r.forceMount,side:n="top",...i}=t,o=Io(En,t.__scopeTooltip);return p.jsx(Ff,{present:s||o.open,children:o.disableHoverableContent?p.jsx(hV,{side:n,...i,ref:e}):p.jsx(AB,{side:n,...i,ref:e})})}),AB=v.forwardRef((t,e)=>{const r=Io(En,t.__scopeTooltip),s=Lf(En,t.__scopeTooltip),n=v.useRef(null),i=Ls(e,n),[o,a]=v.useState(null),{trigger:l,onClose:c}=r,u=n.current,{onPointerInTransitChange:h}=s,f=v.useCallback(()=>{a(null),h(!1)},[h]),d=v.useCallback((m,g)=>{const A=m.currentTarget,y={x:m.clientX,y:m.clientY},b=wB(y,A.getBoundingClientRect()),q=VB(y,b),x=vB(g.getBoundingClientRect()),V=SB([...q,...x]);a(V),h(!0)},[h]);return v.useEffect(()=>()=>f(),[f]),v.useEffect(()=>{if(l&&u){const m=A=>d(A,u),g=A=>d(A,l);return l.addEventListener("pointerleave",m),u.addEventListener("pointerleave",g),()=>{l.removeEventListener("pointerleave",m),u.removeEventListener("pointerleave",g)}}},[l,u,d,f]),v.useEffect(()=>{if(o){const m=g=>{const A=g.target,y={x:g.clientX,y:g.clientY},b=l?.contains(A)||u?.contains(A),q=!_B(y,o);b?f():q&&(f(),c())};return document.addEventListener("pointermove",m),()=>document.removeEventListener("pointermove",m)}},[l,u,o,c,f]),p.jsx(hV,{...t,ref:i})}),[yB,qB]=oc(po,{isInside:!1}),xB=EO("TooltipContent"),hV=v.forwardRef((t,e)=>{const{__scopeTooltip:r,children:s,"aria-label":n,onEscapeKeyDown:i,onPointerDownOutside:o,...a}=t,l=Io(En,r),c=ac(r),{onClose:u}=l;return v.useEffect(()=>(document.addEventListener(sd,u),()=>document.removeEventListener(sd,u)),[u]),v.useEffect(()=>{if(l.trigger){const h=f=>{f.target?.contains(l.trigger)&&u()};return window.addEventListener("scroll",h,{capture:!0}),()=>window.removeEventListener("scroll",h,{capture:!0})}},[l.trigger,u]),p.jsx(Ow,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:h=>h.preventDefault(),onDismiss:u,children:p.jsxs(eB,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[p.jsx(xB,{children:s}),p.jsx(yB,{scope:r,isInside:!0,children:p.jsx(dB,{id:l.contentId,role:"tooltip",children:n||s})})]})})});uV.displayName=En;var dV="TooltipArrow",bB=v.forwardRef((t,e)=>{const{__scopeTooltip:r,...s}=t,n=ac(r);return qB(dV,r).isInside?null:p.jsx(tB,{...n,...s,ref:e})});bB.displayName=dV;function wB(t,e){const r=Math.abs(e.top-t.y),s=Math.abs(e.bottom-t.y),n=Math.abs(e.right-t.x),i=Math.abs(e.left-t.x);switch(Math.min(r,s,n,i)){case i:return"left";case n:return"right";case r:return"top";case s:return"bottom";default:throw new Error("unreachable")}}function VB(t,e,r=5){const s=[];switch(e){case"top":s.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":s.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":s.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":s.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return s}function vB(t){const{top:e,right:r,bottom:s,left:n}=t;return[{x:n,y:e},{x:r,y:e},{x:r,y:s},{x:n,y:s}]}function _B(t,e){const{x:r,y:s}=t;let n=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i],l=e[o],c=a.x,u=a.y,h=l.x,f=l.y;u>s!=f>s&&r<(h-c)*(s-u)/(f-u)+c&&(n=!n)}return n}function SB(t){const e=t.slice();return e.sort((r,s)=>r.x<s.x?-1:r.x>s.x?1:r.y<s.y?-1:r.y>s.y?1:0),kB(e)}function kB(t){if(t.length<=1)return t.slice();const e=[];for(let s=0;s<t.length;s++){const n=t[s];for(;e.length>=2;){const i=e[e.length-1],o=e[e.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))e.pop();else break}e.push(n)}e.pop();const r=[];for(let s=t.length-1;s>=0;s--){const n=t[s];for(;r.length>=2;){const i=r[r.length-1],o=r[r.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))r.pop();else break}r.push(n)}return r.pop(),e.length===1&&r.length===1&&e[0].x===r[0].x&&e[0].y===r[0].y?e:e.concat(r)}var CB=aV;const EB={"":v.Fragment,pre:"pre",code:"code",ol:"ol",ul:"ul",hr:"hr",blockquote:"blockquote",li:"li",a:"a",img:"img",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",p:"p",em:"em",strong:"strong"},ZA=t=>t.replace(RegExp("^"+(t.match(/^(\t| )+/)||"")[0],"gm"),""),TB=t=>t&&typeof t!="string"&&["div","ul","ol","pre","h1","h2","h3","h4","h5","h6"].includes(t.t),Eu=t=>t.replace(/^\s+|\s+$/g," "),He=(t,e=[],r={})=>({t,c:Array.isArray(e)?e:[e],p:r}),Ei=(t,e=!1)=>{let r=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,s=0;const n=He("");let i,o;e?(i=He("p"),o=[n,i],n.c.push(i)):(i=n,o=[n]);let a;const l=(h,f=!0)=>(f&&o.push(h),i.c.push(h),f&&(i=h),h),c=h=>{const f=o.findIndex(d=>d.t===h);o=o.slice(0,f),i=o.at(-1)};for(;a=r.exec(t);){const h=t.substring(s,a.index);if(s=r.lastIndex,h!=="")if(i===n&&e){const f=He("p",Eu(h));n.c.push(f),o=[n,f],i=f}else i.c.push(Eu(h));if(!h.match(/[^\\](\\\\)*\\$/)){if(a[3]||a[4]){const f=He("pre",a[4]?ZA(a[4]):He("code",ZA(a[3]),a[2]?{language:`language-${a[2].toLowerCase()}`}:{}));n.c.push(f),o=[n],i=n}else if(a[6]){const f=a[6],d=f!==">",m=!!f.match(/\./),g=d?m?"ol":"ul":"blockquote",A=a[5].split(`
`).map(b=>b.replace(/^(\*|-|\+|>|\d+\.)\s+/,"")).filter(b=>b.trim()!==""),y=He(g,d?A.map(b=>He("li",Ei(b).c)):Ei(A.join(`
`)).c);n.c.push(y),o=[n,y],i=n}else if(a[8]){const f=He("img",[],{src:a[8],...a[7]?{alt:a[7]}:{}});if(e&&i===n){const d=He("p",f);n.c.push(d),i=d,o=[n,d]}else l(f,!1)}else if(a[10]){const f=o.find(d=>d.t==="a");f&&(f.p.href=a[11])}else if(a[9])l(He("a"));else if(a[14]){const f="h"+a[14].length;n.c.push(He(f,Ei(a[15]).c)),o=[n],i=n}else if(a[13])n.c.push(He("h1",Ei(a[12]).c)),o=[n],i=n;else if(a[16])l(He("code",a[16]),!1);else if(a[17]?.[0]===`
`||a[17]===`  
`){if(!(o[1]?.t==="p")){const m=n.c;let g;for(g=m.length-1;g>=0&&!TB(m[g]);g--);if(g!==n.c.length-1){const A=n.c.splice(g+1);n.c.push(He("p",A))}}const d=He("p");n.c.push(d),o=[n,d],i=d}else if(a[1])n.c.push(He("hr")),o=[n],i=n;else if(a[17]){const f=a[17].length===2?"strong":"em";o.findIndex(m=>m.t===f)===-1?l(He(f)):c(f)}}}const u=Eu(t.substring(s));if(u.length){const h=n.c.at(-1);let f;h?.t==="p"?f=h:e?(f=He("p"),n.c.push(f)):f=n,f.c.push(u)}return n.c=n.c.filter(h=>typeof h=="string"||h.t!=="p"||h.c?.length>0),n},PB=(t,e={})=>{const r={...EB,...e},s=(n,i=0)=>{const o=n.t===""?v.Fragment:r[n.t];return v.createElement(o,{...n.p,key:i},n.c.length===0?void 0:n.c.map((a,l)=>typeof a=="string"?a:s(a,l)))};return s(Ei(t,!0))},RB=({markdown:t,customComponents:e})=>PB(t,e),MB={h2:function({children:e}){return p.jsx("h2",{className:`mb-1 sprites-double-height text-metallicBlue zx:text-zxBlue clear-both ${ce}`,children:p.jsx(rt,{children:e})})},h3:function({children:e}){return p.jsx("h3",{className:"mt-1 mb-1 text-metallicBlue zx:text-zxBlue clear-both",children:p.jsx(rt,{children:e})})},blockquote:function({children:e}){return p.jsx("blockquote",{className:`${ce} mt-1 mb-1 text-moss zx:text-zxBlue clear-both`,children:p.jsxs(rt,{children:["> ",e]})})},p:function({children:e}){return p.jsx("div",{className:`mb-1 last:mb-0 ${ce}`,children:p.jsx(rt,{children:e})})},a:function({children:e,href:r}){return p.jsx("a",{className:"bitmap-text-link",href:r,target:"_blank",rel:"noopener noreferrer",children:p.jsx(rt,{children:e})})},li:function({children:e}){return p.jsx("div",{className:`mb-1 clear-both ${ce}`,children:p.jsxs(rt,{children:[p.jsx(j,{className:"text-metallicBlue zx:text-zxYellow",children:""}),e]})})},strong:function({children:e}){return p.jsx(rt,{className:"strong text-midRed zx:text-zxRed",children:e})},em:function({children:e}){return p.jsx(rt,{className:"em text-moss zx:text-zxBlue",children:e})},img:function({src:e}){const r=Ro();if(e===void 0)throw new Error("image without src");const s=e.split(/\?|&/);return p.jsx("span",{style:{"--scale":r*2},children:p.jsx("span",{className:ht("sprite float-left mr-1 mb-1 zx:sprite-revert-to-two-tone",s.join(" "))})})},hr:function(){return p.jsx("hr",{className:"bg-metallicBlue zx:bg-zxWhite h-half mb-half border-none"})}},ge=({markdown:t,className:e})=>p.jsx("div",{className:`contents ${e}`,children:p.jsx(RB,{customComponents:MB,markdown:t})}),$f=({triggerContent:t,tooltipContent:e})=>e?p.jsxs(CB,{children:[p.jsx(lV,{asChild:!0,children:t}),p.jsx(cV,{children:p.jsx(yn,{scaleFactor:2,children:p.jsx(uV,{side:"bottom",align:"end",className:"bg-lightBeige text-white p-1 mt-oneScaledPix drop-shadow-oneBlock z-popups",children:typeof e=="string"?p.jsx("div",{className:"max-w-16",children:p.jsx(ge,{markdown:e})}):e})})})]}):t,IB=/^(?<modifiers>[^]*)(?<key>.+)$/,jB=t=>{const e=new Set;for(const r of t){if(e.has(r))return!0;e.add(r)}return!1},Gf=(t,e,r,s=void 0)=>{const n=t?.join(" ");v.useEffect(()=>{if(!t||t.length===0||s===null)return;const i=s??window,o=a=>{let c=a.target;for(;c&&c!==i;){if(c.classList.contains("no-keyboard-shortcuts"))return;c=c.parentElement}for(const u of t){const h=u.match(IB);if(!h||!h.groups)continue;const{modifiers:f,key:d}=h.groups;if(jB(f)){console.warn(`Invalid shortcut "${u}": duplicate modifiers`);continue}const m=f.includes("^"),g=f.includes(""),A=f.includes(""),y=f.includes(""),b=m||g||A||y,q=m===a.ctrlKey&&g===a.metaKey&&A===a.shiftKey&&y===a.altKey&&(b||!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&!a.altKey);if((y&&a.altKey?a.code.replace(/^Key/,"").toLowerCase():a.key.toLowerCase())===d.toLowerCase()&&q){e||r?.(),a.preventDefault();break}}};return i.addEventListener("keydown",o),()=>{i.removeEventListener("keydown",o)}},[e,r,n,s])},OB=({className:t,selected:e,disabled:r=!1,onClick:s,ref:n,tooltipContent:i,shortcutKeys:o,children:a,...l})=>{Gf(o,r,s);const c=p.jsx("button",{disabled:r,onClick:s,"data-selected":e,className:Tf(`inline-flex items-center justify-center whitespace-nowrap 
          bg-metallicBlue zx:bg-zxBlue border-none border-shadow
          gap-2
           disabled:bg-midGrey disabled:text-lightGrey 
           data-[selected=true]:bg-lightBeige
           [&:not(:disabled):hover:not([data-selected=true])]:bg-pastelBlue 
           `,t),ref:n,...l,children:a}),u=Pf(typeof i=="string"?i:void 0,o)??i;return p.jsx($f,{triggerContent:c,tooltipContent:u})},Xn="bg-white zx:bg-zxWhite py-0 gap-y-0 text-metallicBlueHalfbrite zx:text-zxBlue disabledMenuItem:text-midGrey zx:disabledMenuItem:text-zxYellow selectedMenuItem:text-metallicBlue zx:selectedMenuItem:text-zxGreen [--leader-col-width:theme(width.3)] ",Jn="flex flex-col gap-1 p-1 overflow-y-scroll scrollbar scrollbar-w-1 scrollbar-thumb-midGrey scrollbar-track-white zx:scrollbar-thumb-zxBlue zx:scrollbar-track-zxWhite mobile:px-3",Zn="bg-lightGrey zx:bg-zxWhiteDimmed mobile:px-4",ne=t=>t,NB=t=>{const e=t.length;if(e===1)return[t[0]];let r=0;for(let n=0;n<e-1;n++)r=Math.max(r,t[n].length+n);const s=t[e-1].length+(e-1);return r=Math.max(r,s),t.map((n,i)=>{if(i===e-1){const a=r-n.length;return" ".repeat(a)+n}else{const a=i,l=r-n.length-a;return" ".repeat(a)+n+" ".repeat(l)}})},fV=({label:t})=>p.jsx(j,{className:"inline-block mr-1 text-lightGrey py-half",noSlitWords:!0,children:t}),Mr=({className:t,value:e,onChange:r,trueLabel:s="ON",falseLabel:n="OFF",label:i,shortcutKeys:o,tooltipContent:a})=>{const l=Math.max(s.length,n.length)+1,c=s.padStart(l," "),u=n.padEnd(l," ");Gf(o,!1,()=>{r?.(!e,void 0)});const h=p.jsxs("span",{onClick:d=>r?.(!e,d),className:Tf("inline-flex justify-between leading-none",t),children:[i&&p.jsx(fV,{label:i}),p.jsx(j,{role:"switch",className:Ef("inline-block w-min h-min py-half px-half sprites-uppercase",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:e?c:u})]}),f=Pf(typeof a=="string"?a:void 0,o)??a;return p.jsx($f,{triggerContent:h,tooltipContent:f})},ey=ne(["bg-redShadowHalfbrite text-highlightBeige zx:bg-zxBlack zx:text-zxGreen","bg-metallicBlueHalfbrite text-pastelBlue zx:bg-zxBlack zx:text-zxBlue","bg-pinkHalfbrite text-pink zx:bg-zxBlack zx:text-zxYellow","bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"]),Hf=({className:t,value:e,onChange:r,values:s,valueLabels:n=s.map(l=>`${l}`),label:i,shortcutKeys:o,tooltipContent:a})=>{const l=s.indexOf(e),c=s.length,u=v.useCallback(()=>{const g=(l+1)%c;r?.(s[g],void 0)},[r,l,s,c]);Gf(o,!1,()=>{u()});const h=NB(n),f=c>4?l%4:l,d=p.jsxs("span",{onClick:u,className:Tf("inline-flex justify-between leading-none",t),children:[i&&p.jsx(fV,{label:i}),p.jsx(j,{role:"switch",className:Ef("inline-block w-min h-min py-half px-half sprites-uppercase",ey[f]??ey[0]),noSlitWords:!0,children:h[l]})]}),m=Pf(typeof a=="string"?a:void 0,o)??a;return p.jsx($f,{triggerContent:d,tooltipContent:m})},Ee=ne("[&_.em]:text-moss zx:[&_.em]:text-zxCyan [&_h2]:text-midRed zx:[&_h2]:text-zxBlue text-lightGrey zx:text-zxBlack sprites-normal-height"),qe="sprite zx:sprite-revert-to-two-tone colourised:brightness-halfBrite selectedMenuItem:filter-none zx:selectedMenuItem:sprite-revert-zxYellow sprites-normal-height",BB="**4-way**: True to the 1987 original - move in x directions only",DB="**8-way**: The original with *4-way* movement, plus *diagonals*",zB="**Analogue**: Move in *any* direction with analogue stick",FB=()=>{const t=Zb();return p.jsx(L,{id:"analogueControl",label:"Directions",leader:p.jsx("span",{className:`${qe} texture-joystick_whole sprites-normal-height`}),valueElement:p.jsx(Hf,{className:"ml-auto",values:rw,valueLabels:["4-way","8-way","anlg"],value:t}),onSelect:z(WM),verticalAlignItemsCentre:!0,className:"sprites-double-height",hintInline:!0,hint:p.jsx(ge,{className:Ee,markdown:t==="analogue"?zB:t==="8-way"?DB:BB})})},LB=()=>p.jsx(L,{className:"sprites-double-height",id:"onScreenControls",label:p.jsx(j,{className:`${ce} mobile:w-max`,children:"Touch controls"}),valueElement:p.jsx(Mr,{className:"ml-auto",value:PM()}),onSelect:z(Yt,{path:"onScreenControls"}),verticalAlignItemsCentre:!0,hintInline:!0,hint:p.jsx(ge,{className:Ee,markdown:`Enables on-screen controls: for mobile, tablet, or any device with a touch-screen.

You can turn this off for phones paired with joypads/keyboards`})}),UB="This blockstack.ing remake comes with modern default mappings for keyboard and controller. You can also select presets matching the original game or different systems.",$B=({className:t})=>{const e=X(qM);return p.jsx(j,{className:ht("text-nowrap","ml-auto","text-pinkHalfbrite zx:text-zxRed selectedMenuItem:text-pink zx:selectedMenuItem:text-zxRed",t),children:e??"custom"})},GB=()=>p.jsx(L,{id:"preset",doubleHeight:!0,label:p.jsx(j,{className:`${ce}`,children:"Key/button preset"}),valueElement:p.jsx($B,{}),onSelect:z(ut,"inputPreset"),opensSubMenu:!0,hint:p.jsx(ge,{className:Ee,markdown:UB}),hintInline:!0}),HB={screen:`**Screen**: Control is relative to the *screen*.
More intuitive if you find directions confusing in isometric games, but means hitting diagonals a lot`,world:"**World**: Control is relative to directions in the *isometric world* - like the original",mixed:"**Mixed (default)**: *Analogue sticks* move relative to the *screen*, digital inputs like *keys* and *d-pad* move relative to the *world*"},WB={screen:ne("texture-heels_walking_towardsRight_2 selectedMenuItem:texture-animated-heels_screenDirections"),world:ne("texture-heels_standing_right selectedMenuItem:texture-animated-heels_worldDirections sprites-normal-height"),mixed:ne("texture-heels_standing_right selectedMenuItem:texture-animated-heels_mixedDirections sprites-normal-height")},YB=()=>{const t=xf();return p.jsx(Hf,{className:"ml-auto",values:Ab,value:t})},KB=()=>{const t=xf();return p.jsx(L,{id:"screenRelativeControl",label:"Input axes",leader:p.jsx("span",{className:`${qe} ${WB[t]}`}),valueElement:p.jsx(YB,{}),onSelect:z(HM),hintInline:!0,verticalAlignItemsCentre:!0,className:"sprites-double-height",hint:p.jsx(ge,{className:Ee,markdown:HB[t]})})},vs="text-mossHalfbrite zx:text-zxGreen selectedMenuItem:text-moss zx:selectedMenuItem:text-zxGreen",QB=t=>{const e=r=>r.startsWith("Arrow")?1:r.startsWith("Numpad")?2:0;return t.toSorted((r,s)=>{const n=e(r)-e(s);if(n!==0)return n;const i=r===" "?"Space":r,o=s===" "?"Space":s,a=i.length-o.length;return a!==0?a:i.localeCompare(o)})},XB=t=>{const e=/(Numpad|F)(.*)/.exec(t);if(e!==null)return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:vs,children:e[1]}),e[2]]});switch(t){case" ":return"Space";case"ArrowDown":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:vs,children:"Cursor"}),""]});case"ArrowUp":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:vs,children:"Cursor"}),""]});case"ArrowLeft":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:vs,children:"Cursor"}),""]});case"ArrowRight":return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:vs,children:"Cursor"}),""]});default:return t}},JB=["","","R","R"],ZB=t=>JB[t]??`axis${t}`,eD=t=>{switch(Vm[t]){case"dPadDown":return"D-pad";case"dPadUp":return"D-pad";case"dPadLeft":return"D-pad";case"dPadRight":return"D-pad";case"a":return p.jsx("span",{className:"colourised:text-mossHalfbrite colourised:selectedMenuItem:text-moss zx:text-zxGreen",children:"A"});case"b":return p.jsx("span",{className:"colourised:text-midRedHalfbrite colourised:selectedMenuItem:text-midRed zx:text-zxRed",children:"B"});case"x":return p.jsx("span",{className:"colourised:text-metallicBlueHalfbrite colourised:selectedMenuItem:text-metallicBlue zx:text-zxBlue",children:"X"});case"y":return p.jsx("span",{className:"colourised:text-highlightBeigeHalfbrite colourised:selectedMenuItem:text-highlightBeige zx:text-zxYellow",children:"Y"});case"start":return"Start";case"select":return"Select"}return Vm[t]?.toUpperCase()??t},Sl=({action:t,keyClassName:e,className:r,flashingCursor:s=!1,inline:n=!1})=>{const i=X(c=>c.gameMenus.assigningInput?.action===t?c.gameMenus.assigningInput?.presses:pl(c).presses[t]),o=X(c=>{const u=Xh(t);return u===void 0?mn:c.gameMenus.assigningInput?.action===t?c.gameMenus.assigningInput.axes:pl(c).axes[u.axis]}),a=p.jsxs(p.Fragment,{children:[QB(i.keys).map(c=>p.jsx("span",{className:ht("text-nowrap h-[calc(10px*var(--scale))]",e),children:p.jsx(rt,{children:XB(c)})},`key:${c}`)),s&&p.jsx("span",{className:"sprite texture-hud_char_space bg-[currentColor] animate-flash"})]}),l=p.jsxs(p.Fragment,{children:[o.map(c=>p.jsx("span",{className:ht("text-nowrap h-[calc(10px*var(--scale))]",e),children:p.jsxs(rt,{children:[p.jsx("span",{className:vs,children:""}),ZB(c)]})},`gamePadAxis:${c}`)),i.gamepadButtons.map(c=>p.jsx("span",{className:ht("text-nowrap h-[calc(10px*var(--scale))]",e),children:p.jsxs(rt,{children:[p.jsx("span",{className:vs,children:""}),eD(c)]})},`gamePadButton:${c}`)),s&&p.jsx("span",{className:"sprite texture-hud_char_space bg-[currentColor] animate-flash"})]});return p.jsxs("div",{className:ht(r,n?"inline":"w-full"),children:[n?a:p.jsx("div",{className:"flex flex-col w-[50%] gap-y-oneScaledPix",children:a}),n?l:p.jsx("div",{className:"flex flex-col",children:l})]})},ty="text-pink zx:text-zxCyan",tD=()=>{const t=X(({gameMenus:e})=>e.assigningInput?.action);return t===void 0?null:p.jsxs("div",{className:`
        bg-metallicBlueHalfbrite text-white
        zx:bg-zxBlueDimmed zx:text-zxCyanDimmed

        ${ce} inline-block absolute inset-x-0 bottom-0 h-min pt-1 px-1`,children:[p.jsx(j,{children:"Press: "}),p.jsx(Sl,{inline:!0,className:`${ty}`,action:"menu_openOrExit",keyClassName:"me-1"}),p.jsx(j,{children:"when done selecting keys for "}),p.jsx(j,{className:ty,children:t})]})},rD="text-pinkHalfbrite zx:text-zxRed selectedMenuItem:text-pink zx:selectedMenuItem:text-zxRed",Be=({className:t,action:e})=>{const r=X(s=>s.gameMenus.assigningInput?.action===e);return p.jsx(Sl,{className:ht("flex flex-wrap gap-y-oneScaledPix gap-x-1 ml-2",t),action:e,keyClassName:rD,flashingCursor:r})},sD=()=>{const t=xf()==="screen";return p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"col-span-3",children:p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${ce} pt-1  sprites-double-height`,children:"Movement"})}),p.jsx(L,{id:"left",label:`Left ${t?"":""}`,leader:p.jsx("span",{className:`${qe} ${t?"texture-head_walking_towardsLeft_2 selectedMenuItem:texture-animated-head_walking_towardsLeft":"texture-head_walking_left_2 selectedMenuItem:texture-animated-head_walking_left"}`}),valueElement:p.jsx(Be,{action:"left"}),onSelect:z(Ne,"left")}),p.jsx(L,{id:"right",label:`Right ${t?"":""}`,leader:p.jsx("span",{className:`${qe} ${t?"texture-head_walking_awayRight_2 selectedMenuItem:texture-animated-head_walking_awayRight":"texture-head_walking_right_2 selectedMenuItem:texture-animated-head_walking_right"}`}),valueElement:p.jsx(Be,{action:"right"}),onSelect:z(Ne,"right")}),p.jsx(L,{id:"up",label:`Up ${t?"":""}`,leader:p.jsx("span",{className:`${qe} ${t?"texture-head_walking_awayLeft_2 selectedMenuItem:texture-animated-head_walking_awayLeft":"texture-head_walking_away_2 selectedMenuItem:texture-animated-head_walking_away"}`}),valueElement:p.jsx(Be,{action:"away"}),onSelect:z(Ne,"away")}),p.jsx(L,{id:"down",label:`Down ${t?"":""}`,leader:p.jsx("span",{className:`${qe} ${t?"texture-head_walking_towardsRight_2 selectedMenuItem:texture-animated-head_walking_towardsRight":"texture-head_walking_towards_2 selectedMenuItem:texture-animated-head_walking_towards"}`}),valueElement:p.jsx(Be,{action:"towards"}),onSelect:z(Ne,"towards")}),p.jsx(L,{id:"jump",label:"Jump",leader:p.jsx("span",{className:`${qe} texture-spring_released selectedMenuItem:texture-spring_compressed`}),valueElement:p.jsx(Be,{action:"jump"}),onSelect:z(Ne,"jump")}),p.jsx("div",{className:"col-span-3",children:p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${ce} pt-1  sprites-double-height`,children:"Character-specific Abilities"})}),p.jsx("div",{className:`${ce} col-span-3`,children:p.jsx(ge,{markdown:`**NOTE:** Some puzzles require Heels to jump and pick up/down simultaneously - assign a key to *both jump and carry*
          `,className:Ee})}),p.jsx(L,{id:"carry",label:"Carry",leader:p.jsx("span",{className:`${qe} texture-bag`}),valueElement:p.jsx(Be,{action:"carry"}),onSelect:z(Ne,"carry"),hint:p.jsx(ge,{className:Ee,markdown:"Carrying is **Heels only** and requires the bag"}),hintInline:!0}),p.jsx(L,{id:"fire",label:p.jsx(j,{className:`inline-block w-6 ${ce}`,children:"Fire dough- nuts"}),leader:p.jsx("span",{className:`${qe} texture-doughnuts`}),hint:p.jsx(ge,{className:Ee,markdown:"Firing doughnuts is **Head only** and requires the hooter"}),hintInline:!0,valueElement:p.jsx(Be,{action:"fire"}),onSelect:z(Ne,"fire")}),p.jsx("div",{className:"col-span-3",children:p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${ce} pt-1  sprites-double-height`,children:"Character Swopping"})}),p.jsx(L,{id:"swop",label:"Swop",valueElement:p.jsx(Be,{action:"swop"}),onSelect:z(Ne,"swop"),hint:p.jsx(ge,{className:Ee,markdown:"Works like the original game. *Cycles through* the characters, Moves *in and out of symbiosis* if head is on top of heels"}),hintInline:!0,leader:p.jsxs("span",{className:`${qe} texture-blank relative overflow-hidden`,children:[p.jsx("span",{className:`${qe} texture-head_walking_towardsRight_2 selectedMenuItem:texture-animated-head_walking_towardsRight absolute right-[50%]`}),p.jsx("span",{className:`${qe} texture-heels_walking_towardsRight_2 selectedMenuItem:texture-animated-heels_walking_towardsRight absolute left-[50%]`})]})}),p.jsx(L,{id:"swopHead",label:p.jsx(j,{className:`inline-block w-6 ${ce}`,children:"Swop to head"}),valueElement:p.jsx(Be,{action:"swop.head"}),onSelect:z(Ne,"swop.head"),hint:p.jsx(ge,{className:Ee,markdown:"Go *directly* to *Head*, avoiding cycling if in symbiosis"}),hintInline:!0,leader:p.jsx("span",{className:`${qe} texture-head_walking_towardsRight_2 selectedMenuItem:texture-animated-head_walking_towardsRight`})}),p.jsx(L,{id:"swopHeels",label:p.jsxs("div",{className:`w-6 ${ce}`,children:[p.jsx(j,{className:"me-1",children:"Swop to"}),p.jsx(j,{className:"text-pinkHalfbrite selectedMenuItem:text-pink",children:"heels"})]}),valueElement:p.jsx(Be,{action:"swop.heels"}),onSelect:z(Ne,"swop.heels"),hint:p.jsx(ge,{className:Ee,markdown:"Go *directly* to *Heels*, avoiding cycling if in symbiosis"}),hintInline:!0,leader:p.jsx("span",{className:`${qe} texture-heels_walking_towardsRight_2 selectedMenuItem:texture-animated-heels_walking_towardsRight`})}),p.jsx("div",{className:"col-span-3",children:p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${ce} pt-1  sprites-double-height`,children:"Stopping the Game"})}),p.jsx(L,{id:"map",label:"Map",valueElement:p.jsx(Be,{action:"map"}),onSelect:z(Ne,"map"),leader:p.jsx("span",{className:`${qe} texture-scroll`})}),p.jsx(L,{id:"hold",label:"Pause",valueElement:p.jsx(Be,{action:"hold"}),onSelect:z(Ne,"hold"),leader:p.jsx("span",{className:`${qe} texture-drum`})}),p.jsx(L,{id:"menu",label:"Menu",valueElement:p.jsx(Be,{action:"menu_openOrExit"}),onSelect:z(Ne,"menu_openOrExit")}),p.jsxs("div",{className:"col-span-3",children:[p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${ce} pt-1 sprites-double-height pb-1`,children:"Look controls"}),p.jsx(ge,{markdown:"Look controls are useful for seeing more of larger rooms that dont fit on the screen.",className:Ee})]}),p.jsx(L,{id:"lookShift",label:"Look",valueElement:p.jsx(Be,{action:"lookShift"}),onSelect:z(Ne,"lookShift"),hint:p.jsx(ge,{className:Ee,markdown:"Hold the look key and press a direction to look around the room"}),hintInline:!0}),p.jsx(L,{id:"lookLeft",label:"Look ",valueElement:p.jsx(Be,{action:"lookLeft"}),onSelect:z(Ne,"lookLeft")}),p.jsx(L,{id:"lookRight",label:"Look ",valueElement:p.jsx(Be,{action:"lookRight"}),onSelect:z(Ne,"lookRight")}),p.jsx(L,{id:"lookUp",label:"Look ",valueElement:p.jsx(Be,{action:"lookUp"}),onSelect:z(Ne,"lookUp")}),p.jsx(L,{id:"lookDown",label:"Look ",valueElement:p.jsx(Be,{action:"lookDown"}),onSelect:z(Ne,"lookDown")}),p.jsx("div",{className:"col-span-3",children:p.jsx(j,{TagName:"h2",className:`text-midRed zx:text-zxBlue ${ce} pt-1  sprites-double-height`,children:"Remake Option Toggles"})}),p.jsx(L,{id:"toggleColourisation",label:p.jsx(j,{className:`inline-block w-6 ${ce}`,children:"Toggle colour- isation"}),valueElement:p.jsx(Be,{action:"toggleColourisation"}),onSelect:z(Ne,"toggleColourisation"),leader:p.jsx("span",{className:`${qe} texture-switch_left sprites-normal-height`})}),p.jsx(L,{id:"cycleRes",label:p.jsx(j,{className:`inline-block w-6 ${ce}`,children:"Cycle res- olution"}),valueElement:p.jsx(Be,{action:"cycleResolution"}),onSelect:z(Ne,"cycleResolution"),leader:p.jsx("span",{className:`${qe} texture-switch_left sprites-normal-height`})}),p.jsx(L,{id:"toggleCrt",label:p.jsx(j,{className:`inline-block w-6 ${ce}`,children:"Toggle CRT effect"}),valueElement:p.jsx(Be,{action:"toggleCrtFilter"}),onSelect:z(Ne,"toggleCrtFilter"),leader:p.jsx("span",{className:`${qe} texture-switch_left sprites-normal-height`})})]})},nD=()=>{const t=!Qb();Se({action:"menu_openOrExit",handler:v.useCallback(()=>{le.dispatch(FM())},[]),disabled:t}),Oj({handler:v.useCallback((e,r)=>{r.currentActionPress("menu_openOrExit")==="released"&&Kb(le.getState())&&le.dispatch(LM(e))},[]),disabled:t})},iD=({showAll:t})=>p.jsxs("div",{className:"text-metallicBlueHalfbrite zx:text-zxBlue",children:[p.jsx(j,{className:`block mb-1 ${ce}`,children:"Detected that you are on a phone or tablet"}),p.jsx(j,{className:`block mb-1 ${ce}`,children:"Additional settings for keys and gamepad buttons are designed for desktop/laptops, but you can use them on phones/tablets if you have a keyboard or gamepad connected"}),p.jsx(OB,{className:`block w-full mb-2 text-white p-1 bg-midRed zx:text-zxRed ${ce}`,onClick:t,children:p.jsx(j,{children:"Tap here to show all settings"})})]}),ry=" !gap-y-1 ",oD=()=>{nD();const[t,e]=v.useState(!La()),r=Zb();return p.jsxs(ze,{children:[p.jsx(xt,{className:"bg-lightGrey zx:bg-zxRedDimmed",onClick:z(qt)}),p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"controlOptions",children:[p.jsx(yr,{path:["Options","Controls"],className:Zn}),p.jsxs("div",{className:Jn,children:[p.jsxs(Re,{className:`${ry} w-full`,children:[p.jsx(FB,{}),r!=="4-way"&&t&&p.jsx(KB,{}),p.jsx(LB,{}),t&&p.jsxs(p.Fragment,{children:[p.jsx(GB,{}),p.jsx(j,{TagName:"h1",className:"text-midRed zx:text-zxBlue sprites-double-height mt-1 block col-span-3 text-center sprites-uppercase",children:"Select the Keys"})]})]}),t?p.jsx(p.Fragment,{children:p.jsx(Re,{className:`${ry} !sprites-normal-height`,children:p.jsx(sD,{})})}):p.jsx(p.Fragment,{children:p.jsx(iD,{showAll:()=>e(!0)})})]}),p.jsx(tD,{})]})]})},aD="/assets/rock-C4e7VvX5.mp3",jo=({customLabel:t})=>p.jsx(L,{id:"back",label:t||"Back",flipLeader:!0,doubleHeightWhenFocussed:!0,onSelect:z(qt),toParentMenu:!0}),sy={egyptus:["text-lightBeige","text-midRed","text-highlightBeige"],blacktooth:["text-midGrey","text-lightGrey","text-moss","text-midRed"],safari:["text-moss","text-midRed","text-highlightBeige"],bookworld:["text-midRed","text-redShadow","text-midGrey"],penitentiary:["text-shadow","text-metallicBlue","text-midGrey"]},lD={egyptus:ne("texture-crown_egyptus"),blacktooth:ne("texture-crown_blacktooth"),bookworld:ne("texture-crown_bookworld"),penitentiary:ne("texture-crown_penitentiary"),safari:ne("texture-crown_safari")},qi=({planet:t,className:e,label:r=t})=>{const s=X(i=>i.gameMenus.gameInPlay.planetsLiberated[t]),n=yf();return p.jsxs("div",{className:`flex flex-col ${e}`,children:[p.jsx("span",{className:`sprite block mx-auto
          ${n?"texture-crown_uncolourised sprite-tinted":lD[t]} 
          ${s?"zx:text-zxYellow":"colourised:brightness-halfBrite zx:text-zxMagentaDimmed"}
          `}),p.jsx("span",{className:`sprite block 
          ${n?"texture-ball_uncolourised":"texture-ball"} 
          zx:sprite-tinted mx-auto 
          ${s?"zx:text-zxWhite":"zx:text-zxYellowDimmed colourised:brightness-halfBrite"} 
          ${sy[t][0]}
          `}),p.jsx(j,{classnameCycle:n?void 0:sy[t],className:`block mx-auto ${s?"zx:text-zxMagenta":"zx:text-zxMagentaDimmed colourised:brightness-halfBrite"}`,children:r})]})},cD=()=>p.jsxs(p.Fragment,{children:[p.jsx(j,{className:"block sprites-double-height text-highlightBeige zx:text-zxYellow mx-auto w-max",children:"The Blacktooth Empire"}),p.jsxs("div",{className:"mx-auto relative w-0 h-1",children:[p.jsx(qi,{planet:"egyptus",label:"Egyptus",className:"w-12 absolute left-m10 top-1 resHandheld:left-m8 resHandheld:top-m1 translate-x-[-50%]"}),p.jsx(qi,{planet:"penitentiary",label:"Penitentiary",className:"w-12 absolute left-10 top-1 resHandheld:left-8 resHandheld:top-m1 translate-x-[-50%]"}),p.jsx(qi,{planet:"safari",label:"Safari",className:"w-12 left-m10 top-14 absolute resHandheld:left-m8 resHandheld:top-8 translate-x-[-50%]"}),p.jsx(qi,{planet:"bookworld",label:"Book World",className:"w-12 absolute left-10 top-14 resHandheld:left-8 resHandheld:top-8 translate-x-[-50%]"}),p.jsx(qi,{planet:"blacktooth",label:"Blacktooth",className:"w-12 absolute left-0 top-8 resHandheld:left-0 ml-[-50%] resHandheld:top-3 translate-x-[-50%]"})]})]}),uD=({playMusic:t=!1})=>{const e=vO(),r=z(qt);return p.jsxs(ze,{children:[p.jsx(xt,{className:"bg-pureBlack zx:bg-zxBlack"}),p.jsxs(ke,{className:"bg-pureBlack w-zx h-full block p-0",onClick:e?void 0:r,dialogId:"crowns",children:[t&&p.jsx("audio",{src:aD,autoPlay:!0,loop:!0}),p.jsx(cD,{}),e&&p.jsx("div",{children:p.jsx(j,{className:"animate-flash text-center sprites-double-height block text-midRed zx:text-zxRed bg-white top-4",children:"LOADING"})}),!e&&p.jsx(Re,{className:"hidden",children:p.jsx(jo,{})})]})]})},lc=t=>p.jsx("div",{className:`col-span-3 h-1 ${t}`}),hD=`![](texture-animated-head_walking_towards?float-right&mt-1)**Off**: Original *two-tone* spectrum graphics

**On**: *16-colour* palette with colourised sprites`,dD=`Here for the nostalgia?

Make your fancy new screen look like its 1987 again.`,fD=()=>p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"displayOptions",children:[p.jsx(yr,{path:["Options","Display"],className:Zn}),p.jsx("div",{className:Jn,children:p.jsxs(Re,{children:[p.jsx(L,{hintInline:!0,className:"sprites-double-height",id:"colourise",label:"Colourise",valueElement:p.jsx(Mr,{className:"ml-auto",value:!yf()}),onSelect:z(Yt,{path:"displaySettings.uncolourised"}),hint:p.jsx(ge,{className:Ee,markdown:hD}),verticalAlignItemsCentre:!0}),p.jsx(L,{hintInline:!0,className:"sprites-double-height",id:"crtFilter",verticalAlignItemsCentre:!0,label:p.jsxs("span",{className:"align-top",children:[p.jsxs("span",{className:"bg-shadow zx:bg-pureBlack inline-block",children:[p.jsx(j,{className:"text-midRed zx:text-zxRed",children:"C"}),p.jsx(j,{className:"text-moss zx:text-zxGreen",children:"R"}),p.jsx(j,{className:"text-pastelBlue zx:text-zxBlue",children:"T"})]}),p.jsx(j,{children:" TV Effect"})]}),valueElement:p.jsx(Mr,{className:"ml-auto",value:X(VM)}),onSelect:z(Yt,{path:"displaySettings.crtFilter"}),hint:p.jsx(ge,{className:Ee,markdown:dD})}),p.jsx(L,{hintInline:!0,className:"sprites-double-height",id:"emulatedResolution",label:"Emulated Resolution",onSelect:z(ut,"emulatedResolution"),opensSubMenu:!0,verticalAlignItemsCentre:!0,hint:p.jsx(ge,{className:Ee,markdown:"See more of the room by choosing a higher resolution to emulate."})}),p.jsx(L,{hintInline:!0,className:"sprites-double-height",verticalAlignItemsCentre:!0,id:"showFps",label:"Show FPS",valueElement:p.jsx(Mr,{className:"ml-auto",value:X(xM)}),onSelect:z(Yt,{path:"showFps"}),hint:p.jsx(ge,{className:Ee,markdown:"Frames per second shown during gameplay."})}),p.jsx(lc,{})]})})]}),pD=({resolutionName:t})=>{const e=X(Jl),r=Wn[t];return p.jsx(L,{id:t,label:`${e===t?"* ":""}${r.name}`,doubleHeightWhenFocussed:!0,hintInline:!0,hint:p.jsxs(j,{className:Ee,children:[r.size.x," x ",r.size.y]}),onSelect:z(_f,t)},t)},mD=()=>p.jsx(ze,{children:p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"emulatedResolution",children:[p.jsx(yr,{path:["Options","Display","Res."],className:Zn}),p.jsx("div",{className:Jn,children:p.jsx(Re,{children:nx(Wn).map(t=>p.jsx(pD,{resolutionName:t},t))})})]})}),gD="/Users/jim/dev/hohjs",AD=({children:t})=>{const e=/https?:\/\/[^\s)>\]}]+/gi,r=t.split(e),s=[...t.matchAll(e)],n=[];return r.forEach((i,o)=>{n.push(i);const a=s[o];if(a)try{const[l]=a,c=new URL(l);if(c.pathname.startsWith("/node_modules/.vite/deps/")){n.push(l);return}const u=`${gD}${c.pathname}`,h=l.match(/:(\d+):(\d+)$/),f=h?`:${h[1]}:${h[2]}`:"",d=`vscode://file${u}${f}`;n.push(p.jsx("a",{href:d,target:"_blank",children:c.pathname},o))}catch{n.push(a[0])}}),p.jsx(v.Fragment,{children:n})},yD=t=>{const{message:e,stack:r}=t;if(!r)return{message:e,sanitizedStack:""};const s=/^(?:[A-Z]\w*)?Error:\s*/,n=s.test(r);let i=r;n&&(i=i.replace(s,"")),i.startsWith(e)&&(i=i.slice(e.length),i=i.replace(/^\n/,""));const o=i.indexOf(`
`);if(o!==-1){const a=i.slice(0,o);(a===e||a===`Error: ${e}`)&&(i=i.slice(o+1))}return i=i.split(`
`).map(a=>a.trim()).filter(a=>a.length>0).join(`
`),{message:e,sanitizedStack:i}},qD=`##The game crashed!
You could:

* Open an [issue on Github](https://github.com/jimhigson/head-over-heels-online/issues)
* Email [jim@blockstack.ing](mailto:jim@blockstack.ing)
* Rant on the [Discord server](https://discord.gg/XmV9QNWY)
* Play [the MSX remake](https://www.file-hunter.com/Homebrew/?id=headoverheels) instead`,xD=t=>t.toReversed().map(e=>{const{message:r,sanitizedStack:s}=yD(e);return`
${r}

${s}
  `}).join(`
    

 ERROR        CAUGHT, WRAPPED, & RETHROWN 


`),bD=({errors:t})=>{const e=X(o=>o.gameMenus.gameInPlay.reincarnationPoint!==void 0),[r,s]=v.useState(!1),n=z(vf),i=xD(t);return v.useEffect(()=>{console.error("ErrorCaughtDialog: Showing Report:",i)},[i]),p.jsxs(ze,{children:[p.jsx(xt,{className:"loading-border zx:zx-loading-border"}),p.jsx(ke,{className:"bg-white zx:bg-zxRed gap-y-0 text-redShadow zx:text-zxBlack px-1",tall:!0,wide:!0,dialogId:"errorCaught",children:p.jsxs("div",{className:"overflow-y-scroll h-full scrollbar scrollbar-w-1 pl-1 scrollbar-thumb-midRed scrollbar-track-highlightBeige zx:scrollbar-thumb-zxCyanDimmed zx:scrollbar-track-zxCyan",children:[p.jsx(ge,{markdown:qD}),p.jsx("hr",{className:"bg-pastelBlue zx:bg-zxWhite h-1 my-1 border-none"}),p.jsxs(Re,{className:`text-lightGrey zx:text-zxWhite mt-1 resHandheld:mt-0 selectedMenuItem:text-midRed zx:selectedMenuItem:text-zxYellow resHandheld:!gap-y-1 ${ce}`,children:[p.jsx(L,{doubleHeightWhenFocussed:!0,id:"tryContinue",label:"Ignore, hope it goes away",onSelect:z(AA,"ignore")}),e&&p.jsx(L,{doubleHeightWhenFocussed:!0,id:"reincarnate",label:"Try reincarnating",onSelect:n}),p.jsx(L,{doubleHeightWhenFocussed:!0,id:"clearAllData",label:"Clear all data, reboot game",onSelect:z(AA,"clearAllData")}),r?p.jsx(j,{className:"text-metallicBlue col-span-2 sprites-double-height ml-3",children:"Error report copied"}):p.jsx(L,{doubleHeightWhenFocussed:!0,id:"copyClipboard",label:"Copy error to clipboard",onSelect:()=>navigator.clipboard.writeText(i).then(()=>s(!0))})]}),p.jsx("hr",{className:"bg-pastelBlue zx:bg-zxWhite h-1 my-1 border-none"}),p.jsx(j,{className:"block sprites-double-height my-1 text-midRed zx:text-zxWhite",children:"Error message for nerds:"}),p.jsx("pre",{className:"bg-shadow zx:bg-zxBlack text-white zx:text-zxWhite leading-[1em] [&_a]:text-pastelBlue px-1 w-max min-w-full",children:p.jsx(AD,{children:i})})]})})]})},wD=()=>p.jsx(ze,{children:p.jsxs(ke,{className:"!h-min !w-max text-center text-zxCyan p-0 bg-transparent",onClick:z(qt),dialogId:"hold",children:[p.jsx(j,{className:"block w-min mx-auto px-1 sprites-double-height bg-zxBlack py-oneScaledPix sprites-uppercase",children:"PAUSED"}),p.jsx("span",{className:"zx",children:yt()==="desktop"?p.jsxs("div",{className:"flex flex-col gap-1",children:[p.jsxs("div",{className:`${ce} px-1 bg-zxBlack py-oneScaledPix`,children:[p.jsxs(rt,{children:["Press to ",p.jsx("span",{className:"text-zxWhite",children:"continue"}),":"]}),p.jsx("div",{className:"flex flex-row gap-1 mx-auto",children:p.jsx(Sl,{className:"flex flex-row gap-1",keyClassName:"text-pink zx:text-zxRed",action:"hold"})})]}),p.jsxs("div",{className:`${ce} px-1 bg-zxBlack py-oneScaledPix`,children:[p.jsxs(rt,{children:["Press for ",p.jsx("span",{className:"text-zxWhite",children:"Map"}),":"]}),p.jsx("div",{className:"flex flex-row gap-1 mx-auto",children:p.jsx(Sl,{className:"flex flex-row gap-1",keyClassName:"text-pink zx:text-zxRed",action:"map"})})]})]}):p.jsxs("div",{className:`${ce} px-1 bg-zxBlack py-oneScaledPix`,children:[p.jsx(j,{className:"me-1 text-pink zx:text-zxRed",children:"Tap screen"}),p.jsx(j,{children:"to continue"})]})})]})}),VD=({presetName:t})=>{const{description:e}=Vn[t];return p.jsx(L,{hintInline:!0,id:t,label:t,doubleHeightWhenFocussed:!0,hint:e&&p.jsx(j,{className:Ee,children:e}),onSelect:z(UM,t)},t)},vD=()=>p.jsx(ze,{children:p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"inputPreset",children:[p.jsx(yr,{path:["Options","Controls","Presets"],className:Zn}),p.jsx("div",{className:Jn,children:p.jsx(Re,{children:nx(Vn).map(t=>p.jsx(VD,{presetName:t},t))})})]})}),_D=()=>{const t=Wt().get("deployment");return t!==null?t:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone?"pwa":"browser"},ny="1.18.0",iy={url:"https://github.com/jimhigson/head-over-heels-online"},SD=()=>{const{data:t}=oj(),e=t?.tag_name,r=e===void 0?void 0:e===`v${ny}`;return p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"flex absolute top-oneScaledPix right-1 z-dialog",children:p.jsxs("a",{href:iy.url,className:"bitmap-text-link bg-transparent zx:bg-zxBlack",children:[p.jsx(j,{className:"text-highlightBeige zx:text-zxYellow",children:""}),p.jsxs("span",{className:"text-lightGrey zx:text-whiteHalfbrite",children:[p.jsx(j,{className:"resHandheld:hidden",children:" on"}),p.jsx(j,{children:lw}),p.jsx(j,{className:"resHandheld:hidden",children:"Github"})]})]})}),p.jsx("footer",{className:"flex absolute bottom-0 right-0 z-dialog","data-screenshot-mask":!0,children:p.jsxs("a",{href:`${iy.url}/releases`,target:"_blank",className:"bitmap-text-link bg-pastelBlueHalfbrite text-metallicBlueHalfbrite zx:bg-zxBlack","data-screenshot-mask":!0,children:[p.jsx(j,{children:` ${ny} `}),r===!1&&p.jsx(j,{className:"animate-flash text-midRed zx:text-zxRed",children:" "})]})})]})},fr=["text-midRed zx:text-zxCyan","text-highlightBeige zx:text-zxYellow","text-moss zx:text-zxWhite"],kD=({className:t})=>p.jsxs("footer",{className:`flex justify-center gap-2 resHandheld:gap-1 leading-none ${t??""}`,children:[p.jsxs("div",{className:"flex flex-col items-center",children:[p.jsx(j,{className:"text-pastelBlue zx:text-zxBlack relative left-oneScaledPix",children:"1987 Original"}),p.jsxs("div",{className:"flex gap-1",children:[p.jsxs("address",{className:"flex flex-col items-center relative bottom-oneScaledPix",children:[p.jsx(j,{className:"relative left-[calc(6.5px*var(--scale))]",classnameCycle:fr,children:"Jon"}),p.jsx(j,{className:"relative bottom-[calc(3px*var(--scale))]",classnameCycle:fr,children:"Ritman"})]}),p.jsxs("address",{className:"flex flex-col items-center relative bottom-oneScaledPix",children:[p.jsx(j,{classnameCycle:fr,children:"Bernie"}),p.jsx(j,{className:"relative bottom-[calc(3px*var(--scale))]",classnameCycle:fr,children:"Drummand"})]})]})]}),p.jsxs("div",{className:"flex flex-col items-center",children:[p.jsx(j,{className:"text-pink zx:text-zxBlack",children:"2025 Remake"}),p.jsx("address",{className:"flex relative left-[calc(0.5px*var(--scale))] bottom-oneScaledPix",children:p.jsxs("div",{className:"flex flex-col items-center",children:[p.jsx(j,{className:"relative left-[calc(1.5px*var(--scale))]",classnameCycle:fr,children:"Jim"}),p.jsx(j,{className:"relative bottom-[calc(3px*var(--scale))]",classnameCycle:fr,children:"Higson"})]})})]})]}),Tn=({facingXy8:t,character:e,action:r})=>{switch(e){case"head":{switch(r){case"walking":switch(t){case"away":return ne("texture-animated-head_walking_away");case"towards":return ne("texture-animated-head_walking_towards");case"left":return ne("texture-animated-head_walking_left");case"right":return ne("texture-animated-head_walking_right");case"awayRight":return ne("texture-animated-head_walking_awayRight");case"towardsRight":return ne("texture-animated-head_walking_towardsRight");case"towardsLeft":return ne("texture-animated-head_walking_towardsLeft");case"awayLeft":return ne("texture-animated-head_walking_awayLeft");default:throw new Error(`Invalid facingXy8: ${t}`)}case"idle":switch(t){case"towards":return ne("texture-animated-head_idle_towards");case"right":return ne("texture-animated-head_idle_right");case"awayRight":return ne("texture-animated-head_idle_awayRight");case"towardsRight":return ne("texture-animated-head_idle_towardsRight");case"towardsLeft":return ne("texture-animated-head_idle_towardsLeft");case"away":return ne("texture-head_walking_away_2");case"left":return ne("texture-head_walking_left_2");case"awayLeft":return ne("texture-head_walking_awayLeft_2");default:throw new Error(`Invalid facingXy8: ${t}`)}}break}case"heels":{switch(r){case"walking":switch(t){case"away":return ne("texture-animated-heels_walking_away");case"towards":return ne("texture-animated-heels_walking_towards");case"left":return ne("texture-animated-heels_walking_left");case"right":return ne("texture-animated-heels_walking_right");case"awayRight":return ne("texture-animated-heels_walking_awayRight");case"towardsRight":return ne("texture-animated-heels_walking_towardsRight");case"towardsLeft":return ne("texture-animated-heels_walking_towardsLeft");case"awayLeft":return ne("texture-animated-heels_walking_awayLeft");default:throw new Error(`Invalid facingXy8: ${t}`)}case"idle":switch(t){case"towards":return ne("texture-animated-heels_idle_towards");case"right":return ne("texture-animated-heels_idle_right");case"awayRight":return ne("texture-heels_walking_awayRight_2");case"towardsRight":return ne("texture-animated-heels_idle_towardsRight");case"towardsLeft":return ne("texture-heels_walking_towardsLeft_2");case"away":return ne("texture-heels_walking_away_2");case"left":return ne("texture-heels_walking_left_2");case"awayLeft":return ne("texture-heels_walking_awayLeft_2");default:throw new Error(`Invalid facingXy8: ${t}`)}}break}}},CD=(t,e,r)=>{const s=t.getBoundingClientRect(),n=s.left+s.width/2,i=s.top+s.height/2,o=n-e,a=i-r,c=pj({x:o,y:a});return zd(c)},oy=({character:t,defaultFacing:e,className:r=""})=>{const[s,n]=v.useState(e),[i,o]=v.useState(!1),a=v.useRef(null);v.useEffect(()=>{const f=m=>{a.current&&n(CD(a.current,m.clientX,m.clientY)||"right")},d=()=>{n(e),o(!1)};return window.addEventListener("mousemove",f),document.addEventListener("mouseleave",d),()=>{window.removeEventListener("mousemove",f),document.removeEventListener("mouseleave",d)}},[e,t]);const l=()=>{o(!0)},c=()=>{o(!1)},h=Tn({character:t,facingXy8:s,action:i?"walking":"idle"});return p.jsxs("div",{ref:a,className:`relative ${r}`,onMouseEnter:l,onMouseLeave:c,children:[p.jsx("span",{className:`sprite zx:sprite-revert-to-white ${h} relative z-topSprite`}),p.jsx("span",{className:"sprite zx:hidden texture-shadow_playable sprite-shadow absolute left-0 opacity-halfBrite"})]})},pV=({noSubtitle:t,className:e})=>p.jsxs("div",{className:`flex flex-col items-center ${e}`,children:[p.jsxs("h1",{className:"flex",children:[p.jsxs("div",{className:"flex flex-col resHandheld:flex-row resHandheld:gap-1 gap-y-oneScaledPix items-center me-1 sprites-uppercase",children:[p.jsx(j,{className:"sprites-double-height text-pastelBlue zx:text-zxYellow resHandheld:mt-1",children:"Head"}),p.jsx(oy,{character:"head",defaultFacing:"right",className:"mt-1 resHandheld:mt-0"})]}),p.jsx(j,{classnameCycle:fr,className:"mt-1 me-1 resHandheld:mt-2",children:"over"}),p.jsxs("div",{className:"flex flex-col resHandheld:flex-row-reverse resHandheld:gap-1 items-center sprites-uppercase",children:[p.jsx(j,{className:"sprites-double-height text-pink zx:text-zxYellow resHandheld:mt-1",children:"Heels"}),p.jsx(oy,{character:"heels",defaultFacing:"towards",className:"mt-1 resHandheld:mt-0"})]})]}),t||p.jsxs("h2",{className:"mt-1 w-max resHandheld:hidden",children:[p.jsx(j,{className:"text-midRed zx:text-zxCyan",children:"block"}),p.jsx(j,{className:"text-highlightBeige zx:text-zxYellow",children:"stack"}),p.jsx(j,{className:"text-metallicBlue zx:text-zxBlack",children:"."}),p.jsx(j,{className:"text-moss zx:text-zxWhite",children:"ing"}),p.jsx(j,{classnameCycle:fr,children:" remake"})]})]}),ED=()=>{const t=Sn(),e=z(BM),r=z(ut,"whichGame");return t?p.jsx(L,{id:"playGame",label:p.jsx(j,{children:"Resume the game"}),doubleHeightWhenFocussed:!0,onSelect:e}):p.jsx(L,{id:"playGame",label:p.jsx(j,{children:"Play the game"}),doubleHeightWhenFocussed:!0,onSelect:r,opensSubMenu:!0})},TD=()=>p.jsx(L,{id:"installGuide",label:"Install",doubleHeightWhenFocussed:!0,onSelect:z(ut,"markdown/installGuide"),opensSubMenu:!0}),PD=()=>p.jsx(L,{id:"levelEditor",label:"Level Editor",doubleHeightWhenFocussed:!0,onSelect:z(ut,"sureWantEditor"),opensSubMenu:!0}),RD=()=>{const t=Sn(),e=X(r=>r.gameMenus.gameInPlay.reincarnationPoint!==void 0);return p.jsx(L,{id:"quitGame",label:e?"quit / reincarnate":"quit the game",className:"text-midRed zx:text-zxYellow",onSelect:z(ut,"quitGameConfirm"),doubleHeightWhenFocussed:!0,hidden:!t,opensSubMenu:!0})},ay="https://discord.gg/Se5Jznc2jm",MD=t=>{Wb({publishedOnly:!0});const e=Sn(),r=z(ut,"crowns"),s=z(ut,"score"),n=v.useCallback(()=>{r(),s()},[r,s]),i=_D()==="pwa";return p.jsxs(ze,{children:[p.jsx(xt,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed"}),p.jsxs(ke,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed gap-y-2 resHandheld:gap-y-1 justify-center",dialogId:"mainMenu",children:[p.jsx(pV,{noSubtitle:e,className:e?"resHandheld:hidden":""}),p.jsxs("div",{className:"text-highlightBeige zx:text-zxCyan selectedMenuItem:text-white resHandheld:mt-half flex flex-col gap-1 sprites-uppercase",children:[p.jsxs(Re,{className:"w-24 mx-auto",children:[p.jsx(ED,{}),!e&&yt()==="desktop"&&p.jsx(PD,{}),p.jsx(L,{id:"map",label:"use the Map",onSelect:z(ut,"map"),doubleHeightWhenFocussed:!0,hidden:!e,opensSubMenu:!0}),p.jsx(L,{id:"viewCrowns",label:"Progress so far",onSelect:n,doubleHeightWhenFocussed:!0,hidden:!e,opensSubMenu:!0})]}),p.jsxs("div",{className:"flex flex-row justify-between gap-2 w-24 mx-auto",children:[p.jsxs(Re,{children:[p.jsx(L,{id:"options",label:"Options",doubleHeightWhenFocussed:!0,onSelect:z(ut,"modernisationOptions"),opensSubMenu:!0}),p.jsx(L,{id:"readTheManual",label:"Manual",doubleHeightWhenFocussed:!0,onSelect:z(ut,"readTheManual"),opensSubMenu:!0})]}),p.jsxs(Re,{children:[i?null:p.jsx(TD,{}),p.jsx(L,{id:"discord",leader:p.jsx(j,{children:aw}),label:p.jsx("a",{href:ay,target:"_blank",children:p.jsx(j,{children:"Discord"})}),doubleHeightWhenFocussed:!0,onSelect:v.useCallback(()=>{window.open(ay,"_blank")},[])}),i?p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"h-1"}),p.jsx("div",{className:"h-1"}),p.jsx("div",{className:"h-1"})]}):null]})]}),e&&p.jsx(Re,{className:"w-24 mx-auto",children:p.jsx(RD,{})})]}),!e&&p.jsx(kD,{className:"resHandheld:mt-1"})]}),p.jsx(SD,{})]})};var Tu,ly;function Wf(){if(ly)return Tu;ly=1;function t(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return Tu=t,Tu}var Pu,cy;function ID(){if(cy)return Pu;cy=1;var t=typeof Oo=="object"&&Oo&&Oo.Object===Object&&Oo;return Pu=t,Pu}var Ru,uy;function mV(){if(uy)return Ru;uy=1;var t=ID(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=t||e||Function("return this")();return Ru=r,Ru}var Mu,hy;function jD(){if(hy)return Mu;hy=1;var t=mV(),e=function(){return t.Date.now()};return Mu=e,Mu}var Iu,dy;function OD(){if(dy)return Iu;dy=1;var t=/\s/;function e(r){for(var s=r.length;s--&&t.test(r.charAt(s)););return s}return Iu=e,Iu}var ju,fy;function ND(){if(fy)return ju;fy=1;var t=OD(),e=/^\s+/;function r(s){return s&&s.slice(0,t(s)+1).replace(e,"")}return ju=r,ju}var Ou,py;function gV(){if(py)return Ou;py=1;var t=mV(),e=t.Symbol;return Ou=e,Ou}var Nu,my;function BD(){if(my)return Nu;my=1;var t=gV(),e=Object.prototype,r=e.hasOwnProperty,s=e.toString,n=t?t.toStringTag:void 0;function i(o){var a=r.call(o,n),l=o[n];try{o[n]=void 0;var c=!0}catch{}var u=s.call(o);return c&&(a?o[n]=l:delete o[n]),u}return Nu=i,Nu}var Bu,gy;function DD(){if(gy)return Bu;gy=1;var t=Object.prototype,e=t.toString;function r(s){return e.call(s)}return Bu=r,Bu}var Du,Ay;function zD(){if(Ay)return Du;Ay=1;var t=gV(),e=BD(),r=DD(),s="[object Null]",n="[object Undefined]",i=t?t.toStringTag:void 0;function o(a){return a==null?a===void 0?n:s:i&&i in Object(a)?e(a):r(a)}return Du=o,Du}var zu,yy;function FD(){if(yy)return zu;yy=1;function t(e){return e!=null&&typeof e=="object"}return zu=t,zu}var Fu,qy;function LD(){if(qy)return Fu;qy=1;var t=zD(),e=FD(),r="[object Symbol]";function s(n){return typeof n=="symbol"||e(n)&&t(n)==r}return Fu=s,Fu}var Lu,xy;function UD(){if(xy)return Lu;xy=1;var t=ND(),e=Wf(),r=LD(),s=NaN,n=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt;function l(c){if(typeof c=="number")return c;if(r(c))return s;if(e(c)){var u=typeof c.valueOf=="function"?c.valueOf():c;c=e(u)?u+"":u}if(typeof c!="string")return c===0?c:+c;c=t(c);var h=i.test(c);return h||o.test(c)?a(c.slice(2),h?2:8):n.test(c)?s:+c}return Lu=l,Lu}var Uu,by;function AV(){if(by)return Uu;by=1;var t=Wf(),e=jD(),r=UD(),s="Expected a function",n=Math.max,i=Math.min;function o(a,l,c){var u,h,f,d,m,g,A=0,y=!1,b=!1,q=!0;if(typeof a!="function")throw new TypeError(s);l=r(l)||0,t(c)&&(y=!!c.leading,b="maxWait"in c,f=b?n(r(c.maxWait)||0,l):f,q="trailing"in c?!!c.trailing:q);function x(R){var M=u,D=h;return u=h=void 0,A=R,d=a.apply(D,M),d}function V(R){return A=R,m=setTimeout(S,l),y?x(R):d}function _(R){var M=R-g,D=R-A,P=l-M;return b?i(P,f-D):P}function w(R){var M=R-g,D=R-A;return g===void 0||M>=l||M<0||b&&D>=f}function S(){var R=e();if(w(R))return k(R);m=setTimeout(S,_(R))}function k(R){return m=void 0,q&&u?x(R):(u=h=void 0,d)}function C(){m!==void 0&&clearTimeout(m),A=0,u=g=h=m=void 0}function E(){return m===void 0?d:k(e())}function T(){var R=e(),M=w(R);if(u=arguments,h=this,g=R,M){if(m===void 0)return V(g);if(b)return clearTimeout(m),m=setTimeout(S,l),x(g)}return m===void 0&&(m=setTimeout(S,l)),d}return T.cancel=C,T.flush=E,T}return Uu=o,Uu}var $D=AV();const GD=Xe($D);var $u,wy;function HD(){if(wy)return $u;wy=1;var t=AV(),e=Wf(),r="Expected a function";function s(n,i,o){var a=!0,l=!0;if(typeof n!="function")throw new TypeError(r);return e(o)&&(a="leading"in o?!!o.leading:a,l="trailing"in o?!!o.trailing:l),t(n,i,{leading:a,maxWait:i,trailing:l})}return $u=s,$u}var WD=HD();const YD=Xe(WD),KD=(t,e,r,s)=>{switch(e){case"debounce":return GD(t,r,s);case"throttle":return YD(t,r,s);default:return t}},QD=t=>{const e=v.useRef(t);return v.useEffect(()=>{e.current=t}),v.useMemo(()=>((...r)=>{var s;return(s=e.current)===null||s===void 0?void 0:s.call(e,...r)}),[])},XD=t=>{const[e,r]=v.useState(t?.current||null);return t&&setTimeout(()=>{t.current!==e&&r(t.current)},0),{refProxy:v.useMemo(()=>new Proxy(n=>{n!==e&&r(n)},{get(n,i){return i==="current"?e:n[i]},set(n,i,o){return i==="current"?r(o):n[i]=o,!0}}),[e]),refElement:e,setRefElement:r}},JD=(t,e)=>e==="border-box"?{width:t.borderBoxSize[0].inlineSize,height:t.borderBoxSize[0].blockSize}:e==="content-box"?{width:t.contentBoxSize[0].inlineSize,height:t.contentBoxSize[0].blockSize}:{width:t.contentRect.width,height:t.contentRect.height};function ZD({skipOnMount:t=!1,refreshMode:e,refreshRate:r=1e3,refreshOptions:s,handleWidth:n=!0,handleHeight:i=!0,targetRef:o,observerOptions:a,onResize:l}={}){const c=v.useRef(t),u=QD(l),[h,f]=v.useState({width:void 0,height:void 0}),{refProxy:d,refElement:m}=XD(o),{box:g}=a||{},A=v.useCallback(b=>{if(!n&&!i)return;if(c.current){c.current=!1;return}const q=(x,V)=>n&&x.width!==V.width||i&&x.height!==V.height;b.forEach(x=>{const V=JD(x,g);f(_=>q(_,V)?(u?.({width:V.width,height:V.height,entry:x}),V):_)})},[n,i,c,g]),y=v.useCallback(KD(A,e,r,s),[A,e,r,s]);return v.useEffect(()=>{let b;return m?(b=new window.ResizeObserver(y),b.observe(m,a)):(h.width||h.height)&&(u?.({width:null,height:null,entry:null}),f({width:void 0,height:void 0})),()=>{var q,x,V;(q=b?.disconnect)===null||q===void 0||q.call(b),(V=(x=y).cancel)===null||V===void 0||V.call(x)}},[y,m]),Object.assign({ref:d},h)}const Me=(...t)=>{if(t.length===1){const[e]=t;return r=>r.type===e}return e=>t.includes(e.type)},ez=Me("bubbles","stopAutowalk","firedDoughnut","floatingText","emitter","particle","soundEffect"),tz=(t,e)=>ez(t)||_s(t)&&(e!==void 0&&kl(e)||t.config.direction.z!==0)||VV(t)&&t.config.floorType==="none",Qr=(t,e)=>!tz(t,e),rz=t=>t.type==="movingPlatform"||t.type==="pushableBlock",Yf=(t,e,r=!1)=>Ms(e)&&!(!r&&kl(e)&&e.state.autoWalk)&&!(wV(t)&&rz(e))&&!(Kf(e)&&e.config.which==="cyberman"&&e.state.everActivated===!1),yV=["ball","slidingBlock","slidingDeadly"],sz=Me(...yV),nz=["portableBlock","spring","sceneryPlayer","sceneryCrown","monster","slidingBlock"],iz=["dalek","turtle","elephantHead","homingBot","helicopterBug"],xG=t=>t.type==="slidingBlock"?t.config.style==="puck":t.type==="monster"?iz.includes(t.config.which):nz.includes(t.type),kl=t=>t.type==="head"||t.type==="heels"||t.type==="headOverHeels";function Ms(t){return qV.includes(t.type)}const qV=[...yO,"monster","ball","charles","pushableBlock","movingPlatform","moveableDeadly","pickup","portableBlock","slidingBlock","slidingDeadly","spring","sceneryPlayer","sceneryCrown"],oz=["monster","deadlyBlock","moveableDeadly","slidingDeadly"],az=Me(...oz),Vy=t=>Kf(t)&&!t.state.activated?!1:az(t)||t.type==="floor"&&t.config.floorType==="deadly",lz=t=>t.config.times!==void 0,_s=Me("portal"),bG=Me("teleporter"),xV=Me("heels"),bV=Me("head"),Cl=Me("headOverHeels"),wG=Me("heels","headOverHeels"),VG=Me("head","headOverHeels"),wV=Me("lift"),vG=Me("button"),_G=Me("emitter"),Kf=Me("monster"),VV=Me("floor"),cz=Me("pickup"),SG=t=>t.type==="button"||t.type==="switch"&&t.config.type==="in-room",kG=t=>cz(t)&&t.config.gives==="crown",CG=Me("spring"),uz=Me("joystick"),EG=Me("conveyor"),hz=Me("hushPuppy"),TG=Me("firedDoughnut"),PG=Me("wall","doorFrame"),RG=Me("monster","movingPlatform"),MG=t=>Kf(t)&&t.config.which==="cyberman"&&t.state.everActivated===!1,Br=(t,e)=>t.characterRooms[e]?.items[e],IG=t=>Br(t,t.currentCharacterName),jG=t=>{if(bV(t))return t.state;if(Cl(t))return t.state.head},dz=t=>{if(xV(t))return t.state;if(Cl(t))return t.state.heels},fz=(t,e)=>{const r=Br(t,t.currentCharacterName==="headOverHeels"?"headOverHeels":e);if(r!==void 0){if(e==="head"&&bV(r)||e==="heels"&&xV(r))return r.state;if(e==="head"&&Cl(r))return r.state.head;if(e==="heels"&&Cl(r))return r.state.heels}},OG=fz,pz=t=>{const e=Br(t,"head"),r=Br(t,"heels");return e!==void 0&&r!==void 0&&e.state.action==="idle"&&r.state.action==="idle"&&e.state.standingOnItemId==="heels"},id=(t,e)=>e?.[t],NG=t=>Object.values(t),mz=t=>Dr(t),Ot=t=>Qe(mz(t)),BG=t=>Qe(Fd(t)),DG=t=>({head:t.head,heels:t.heels,headOverHeels:t.headOverHeels}),Ht=Symbol("roomSpatialIndexKey"),pt={x:12,y:12,z:W.z},gz={x:14,y:14,z:W.z},Ss={x:16,y:16,z:W.z},Ya={...pt,z:W.z*2},Qf=t=>{switch(t.type){case"spring":case"portableBlock":case"moveableDeadly":case"slidingDeadly":case"firedDoughnut":return{aabb:pt};case"slidingBlock":return t.config.style==="book"?{aabb:Ss}:{aabb:pt};case"lift":return{aabb:{...pt,z:pt.z}};case"switch":return{aabb:{...pt,z:pt.z}};case"button":return{aabb:{x:15,y:15,z:2}};case"pickup":return t.config.gives==="scroll"?{aabb:{x:16,y:4,z:13}}:{aabb:pt};case"charles":return{aabb:Ya};case"ball":return{aabb:{x:12,y:12,z:12}};case"pushableBlock":case"movingPlatform":return{aabb:Ss};case"block":switch(t.config.style){case"artificial":case"organic":case"book":return{aabb:Ss};case"tower":return{aabb:{x:11,y:11,z:W.z}};default:throw new Error("unknown block style")}case"monster":switch(t.config.which){case"skiHead":return{aabb:{...pt,z:21}};case"bubbleRobot":case"cyberman":case"elephant":case"emperorsGuardian":case"monkey":case"computerBot":return{aabb:Ya};case"helicopterBug":case"dalek":case"emperor":case"homingBot":case"elephantHead":return{aabb:pt};case"turtle":return{aabb:pt};default:throw t.config,new Error("unknown monster type")}case"deadlyBlock":case"spikes":return{aabb:Ss};case"bubbles":return{aabb:pt};case"conveyor":case"hushPuppy":case"teleporter":return{aabb:Ss};case"barrier":return{aabb:t.config.axis==="y"?{x:3,y:15,z:W.z}:{x:15,y:3,z:W.z}};case"sceneryPlayer":return t.config.which==="headOverHeels"?{aabb:Ya}:{aabb:pt};case"emitter":return{aabb:ee};default:return{aabb:gz}}},lt={aabb:pt,castsShadowWhileStoodOn:!1},Pn=t=>({x:t.direction==="away"?t.tiles.length:t.direction==="towards"?t.times?.x??1:1,y:t.direction==="left"?t.tiles.length:t.direction==="right"?t.times?.y??1:1}),zG=t=>t.type==="wall"?Pn(t.config):lz(t)?t.config.times:void 0,mo=(t=_o)=>({x:t.x??1,y:t.y??1,z:t.z??1}),FG=t=>({x:t.x??1,y:t.y??1}),vy=t=>{const e=r=>r.config.times!==void 0;return t.type==="wall"?mo(Pn(t.config)):e(t)?mo(t.config.times):_o},Az=t=>{const e=r=>r.config.times!==void 0;return t.type==="wall"?mo(Pn(t.config)):e(t)?mo(t.config.times):_o},LG=t=>{const e={};let r=!1;return t.x!==1&&(e.x=t.x,r=!0),t.y!==1&&(e.y=t.y,r=!0),t.z!==1&&(e.z=t.z,r=!0),r?e:void 0},go=(t,e={})=>{const r=mo(e),s=jr(W,t);return C_(V_(r,W),s)},UG=1e3,Ir=-2,De=Number.MIN_SAFE_INTEGER,$G=({x:t=0,y:e=0})=>e-t,Oe=({x:t=0,y:e=0,z:r=0})=>({x:e-t,y:-(t+e)/2-r}),Te=({x:t=0,y:e=0,z:r=0})=>({x:t*W.x,y:e*W.y,z:r*W.z}),GG=t=>Oe(Te(t)),od=t=>{const e=Te(t.position),{aabb:r}=Qf(t);if(r===void 0)throw new Error(`item type= ${t.type} config=${JSON.stringify(t.config)} has no bounding box`);return t.type==="wall"?e:U(e,{x:W.x-r.x>>1,y:W.y-r.y>>1})},Ge=()=>({expires:null,stoodOnBy:{},disappearing:null,switchedAtRoomTime:De,stoodOnUntilRoomTime:De,actedOnAt:{roomTime:De,by:me,actedInXY:!1,actedInZ:!1}}),vV=()=>({gravity:ee,movingFloor:ee}),Rn=()=>({vels:vV(),latentMovement:[],collidedWith:{roomTime:De,by:me},controlledWithJoystickAtRoomTime:De,standingOnItemId:null,standingOnUntilRoomTime:De,previousStandingOnItemId:null}),yz=t=>{const e=qV.includes(t.type);return{...Ge(),position:od(t),...e?{...Rn(),vels:{...vV(),...yV.includes(t.type)?{sliding:ee}:{},...t.type==="monster"||t.type==="movingPlatform"?{walking:ee}:{}}}:{},...t.type==="joystick"||t.type==="emitter"||t.type==="lift"||t.type==="conveyor"||t.type==="teleporter"?{...structuredClone(t.config)}:{},...t.type==="monster"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",timeOfLastDirectionChange:Number.NEGATIVE_INFINITY,...t.config.which==="skiHead"||t.config.which==="turtle"||t.config.which==="elephantHead"||t.config.which==="cyberman"?{facing:fe[t.config.startDirection]}:{facing:fe.towards}}:{},...t.type==="pickup"?{disappearing:{on:"touch",byType:t.config.gives==="bag"||t.config.gives==="jumps"?["heels","headOverHeels"]:t.config.gives==="doughnuts"||t.config.gives==="hooter"||t.config.gives==="fast"?["head","headOverHeels"]:["head","heels","headOverHeels"]}}:{},...t.type==="movingPlatform"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",facing:fe[t.config.startDirection]}:{},...t.type==="switch"?{setting:t.config.initialSetting,lastToggledAtRoomTime:De}:{},...t.type==="button"?{pressed:!1}:{},...t.type==="block"?{disappearing:t.config.disappearing??null}:{},...t.type==="conveyor"?{disappearing:t.config.disappearing??null}:{},...t.type==="barrier"?{disappearing:t.config.disappearing??null}:{},...t.type==="lift"?{direction:"up",vels:{lift:ee}}:{},...t.type==="charles"?{facing:fe.towards}:{},...t.type==="emitter"?{lastEmittedAtRoomTime:De,quantityEmitted:0}:{},...t.type==="firedDoughnut"?{disappearing:{on:"touch"},vels:{fired:t.config.direction?Qt(fe[t.config.direction],uO.firedDoughnut):ee}}:{}}},qz=({config:{direction:t},position:e})=>t==="right"&&e.x===0||t==="towards"&&e.y===0,xz=Object.freeze({textureId:"shadow.door.floatingThreshold.double.y",spritesheetVariant:"original"}),bz=Object.freeze({textureId:"shadow.doorFrame.top.y",spritesheetVariant:"original"}),wz=Object.freeze({textureId:"shadow.doorFrame.top.y",flipX:!0,spritesheetVariant:"original"}),Vz=["doorLegs"],vz=Object.freeze({textureId:"shadow.door.floatingThreshold.double.y",flipX:!0,spritesheetVariant:"original"}),Gu=W.z*2,_z=4,Ta=W.z*_z,Sz=2;2*W.x;const kz=.5,_y=2;function*Cz(t,e){const{config:{direction:r},position:s}=t,n=Lq(r),i=Dl(n),o=qz(t),a={...ee,[i]:o?-.5:0},l=1,c={[i]:o?-l:0},u=l*W.x,h={...ee,[i]:u},f=9,d=8,m=8;{const g={[n]:d,[i]:m,z:Ta};yield{...t,...lt,type:"doorFrame",id:`${e}/frameFar`,jsonItemId:e,config:{...t.config,inHiddenWall:o,part:"far"},state:{...Ge(),position:Te(U(s,{[n]:1.5},a,c)),stoodOnBy:me},aabb:U(g,h),renderAabb:g,renderAabbOffset:o?h:void 0}}{const g={[n]:f,[i]:m,z:Ta};yield{...t,...lt,type:"doorFrame",id:`${e}/frameNear`,jsonItemId:e,config:{...t.config,inHiddenWall:o,part:"near"},state:{...Ge(),position:Te(U(s,a,c)),stoodOnBy:me},aabb:U(g,h),renderAabb:g,renderAabbOffset:o?h:void 0}}{const g={[n]:2*W.x-f-d,[i]:m,z:Ta-Gu};yield{...t,...lt,type:"doorFrame",id:`${e}/frameTop`,jsonItemId:e,config:{...t.config,inHiddenWall:o,part:"top"},state:{...Ge(),position:U(Te(U(s,a,c)),{[n]:f,z:Gu}),stoodOnBy:me},aabb:U(g,h),renderAabb:g,renderAabbOffset:o?h:void 0,shadowCastTexture:o?void 0:n==="x"?wz:bz,castsShadowWhileStoodOn:!0,noShadowCastOn:o?void 0:Vz}}yield{...t,...lt,type:"blocker",id:`${e}/blockerAbove`,jsonItemId:e,config:{},renders:!1,state:{...Ge(),position:U(Te(U(s,a,c)),{z:Ta}),stoodOnBy:me},aabb:U(Te({[n]:2,[i]:l}),{[i]:m,z:Cf}),renderAabb:ee,fixedZIndex:Ir},yield{...t,...lt,type:"portal",id:`${e}/portal`,jsonItemId:e,config:{...eo(t.config,"toRoom","toDoor"),inHidden:o,relativePoint:Te({...ee,[i]:o?l+.25:-.25}),direction:fe[r]},fixedZIndex:Ir,state:{...Ge(),position:U(Te(U(s,{[i]:o?-.5-l:.5})),{[n]:f}),stoodOnBy:me},aabb:{[n]:Sz*W.x-f-d,[i]:u,z:Gu}},s.z!==0&&(yield{...t,...lt,type:"doorLegs",id:`${e}/legs`,jsonItemId:e,config:{...t.config,inHiddenWall:o,style:"none",side:"away",height:s.z},renders:!0,shadowCastTexture:o?n==="x"?vz:xz:void 0,castsShadowWhileStoodOn:o,state:{...Ge(),position:{...Te(U(s,a,c)),z:0}},aabb:U(Te({[n]:2,[i]:.5,z:s.z}),h),renderAabb:o?U(Te({[n]:2,[i]:.5,z:.5})):void 0,renderAabbOffset:o?U({[n]:0,[i]:0,z:(s.z-.5)*W.z},{[i]:h[i]}):void 0,shadowOffset:{z:s.z*W.z,[i]:o?h[i]:void 0}}),yield{...lt,type:"stopAutowalk",id:`${e}/stopAutowalk`,jsonItemId:e,aabb:Te({[n]:2,[i]:_y,z:2}),config:{},fixedZIndex:Ir,state:{...Ge(),position:Te(jr(s,Qt(fe[r],kz),o?ee:{[i]:_y})),stoodOnBy:me}}}const Sy=3,ky=10,Cy=.52,Pa=.5,Ez=Object.freeze({textureId:"shadow.fullBlock",spritesheetVariant:"original"}),Tz=(t,e,r)=>{const{config:{times:s},position:n}=e,i=U(n,{z:-Sy}),o={...s,z:Sy};let a=i,l=o;const c=Qe(Dr(r.items)).filter(f=>f.type==="door");if(n.z===0){const f={};for(const d of c){const{position:m,config:{direction:g}}=d;switch(g){case"towards":!f.towards&&m.y===i.y&&m.x>=i.x&&m.x<=i.x+s.x-2&&(l=U(l,{y:Pa}),a=U(a,{y:-Pa}),f.towards=!0);break;case"away":!f.away&&m.y===i.y+s.y&&m.x>=i.x&&m.x<=i.x+s.x-2&&(l=U(l,{y:Cy}),f.away=!0);break;case"right":!f.right&&m.x===i.x&&m.y>=i.y&&m.y<=i.y+s.y-2&&(l=U(l,{x:Pa}),a=U(a,{x:-Pa}),f.right=!0);break;case"left":!f.left&&m.x===i.x+s.x&&m.y>=i.y&&m.y<=i.y+s.y-2&&(l=U(l,{x:Cy}),f.left=!0);break}}}const u=Te(a),h=go(Ss,l);return{...lt,type:"floor",id:t,jsonItemId:t,config:{...e.config,naturalFootprint:{aabb:go(Ss,o),position:Te(i)}},aabb:h,renderAabb:{...h,z:ky},renderAabbOffset:{...ee,z:h.z-ky},shadowCastTexture:Ez,state:{...Ge(),position:u}}},Pz=Object.freeze({animationId:"shadow.lift",spritesheetVariant:"original"}),Ey=Object.freeze({textureId:"shadow.smallBlock",spritesheetVariant:"original"}),tn=Object.freeze({textureId:"shadow.smallRound",spritesheetVariant:"original"}),Ra=Object.freeze({textureId:"shadow.fullBlock",spritesheetVariant:"original"}),Rz=Object.freeze({textureId:"shadow.fullBlock",flipX:!0,spritesheetVariant:"original"}),Mz=Object.freeze({textureId:"shadow.barrier.y",spritesheetVariant:"original"}),Iz=Object.freeze({textureId:"shadow.barrier.y",flipX:!0,spritesheetVariant:"original"}),jz=Object.freeze({textureId:"shadow.scroll",spritesheetVariant:"original"}),Oz=t=>{switch(t.type){case"lift":return Pz;case"switch":return Ey;case"conveyor":return Fq(t.config.direction)==="x"?Rz:Ra;case"barrier":return t.config.axis==="x"?Iz:Mz;case"spring":case"firedDoughnut":case"slidingDeadly":return tn;case"block":return t.config.style==="tower"?tn:Ra;case"pushableBlock":case"movingPlatform":case"hushPuppy":case"deadlyBlock":case"teleporter":case"spikes":return Ra;case"portableBlock":return t.config.style==="drum"?tn:Ey;case"pickup":return t.config.gives==="scroll"?jz:tn;case"ball":case"charles":case"monster":return tn;case"slidingBlock":return t.config.style==="book"?Ra:tn}},Nz=Object.freeze({textureId:"shadow.playable",spritesheetVariant:"original"}),El={config:me,shadowCastTexture:Nz,castsShadowWhileStoodOn:!0,aabb:pt},Ao=()=>{const t=Xb(le.getState());return{action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:fe.towards,visualFacingVector:fe.towards,walkStartFacing:fe.towards,walkDistance:0,vels:{walking:ee,gravity:ee,movingFloor:ee},switchedToAt:De,lastDiedAt:De,gameTime:0,jumpStartTime:De,lives:t?"infinite":fO,jumpStartZ:0}},Bz=(t,e)=>{const r=Jb(le.getState());return t.config.which==="head"?{id:e,jsonItemId:e,type:"head",...lt,...El,state:{...Ge(),...Rn(),...Ao(),hasHooter:!1,gameWalkDistance:0,fastStepsStartedAtDistance:De,shieldCollectedAt:De,doughnuts:r?"infinite":0,position:od(t),stoodOnUntilRoomTime:De}}:{id:e,jsonItemId:e,type:"heels",...lt,...El,state:{...Ge(),...Rn(),...Ao(),carrying:null,hasBag:!1,bigJumps:0,isBigJump:!1,shieldCollectedAt:De,position:od(t),stoodOnUntilRoomTime:De}}},Dz=t=>t==="towards"||t==="right",zz=Object.freeze({textureId:"shadow.wall.y",spritesheetVariant:"original"}),Fz=Object.freeze({textureId:"shadow.wall.y",flipX:!0,spritesheetVariant:"original"}),Xf=1,Lz={x:W.x,y:W.y*Xf,z:Cf},Uz={x:W.x,y:0,z:Cw},$z={x:W.x*Xf,y:W.y,z:Cf},Gz={x:0,y:W.y,z:Cw},Hz=(t,e)=>{const{config:{direction:r},position:s}=e,n=Pn(e.config),i=Lq(r),o=Dl(i),a=Dz(r),l={...ee,[o]:a?-Xf:0};return{type:"wall",id:t,jsonItemId:t,config:e.config,aabb:go(i==="y"?$z:Lz,n),renderAabb:a?ee:go(i==="y"?Gz:Uz,n),fixedZIndex:a?Ir:void 0,state:{...Ge(),position:Te(U(s,l)),stoodOnBy:me},shadowCastTexture:i!=="y"?Fz:zz,castsShadowWhileStoodOn:a}};function*Jf(t,e,r,s=me,n={},i=""){if(!s[t]&&!(e.type==="pickup"&&e.config.gives==="scroll"&&e.config.source==="manual"&&n[e.config.page]))switch(!0){case e.type==="door":return yield*Cz(e,t);case e.type==="player":{yield Bz(e,t);return}case e.type==="wall":{yield Hz(t,e);return}case e.type==="floor":{yield Tz(t,e,r);return}case(e.type==="block"&&e.config.disappearing!==void 0&&Fn(vy(e))>=2):{const o=vy(e);for(let a=0;a<o.x;a++)for(let l=0;l<o.y;l++)for(let c=0;c<o.z;c++){const u=Dn(e,h=>{h.position={x:e.position.x+a,y:e.position.y+l,z:e.position.z+c},h.config.times=_o});yield*Jf(t,u,r,s,n,`${i}_${a}_${l}_${c}`)}break}case(e.type==="sceneryCrown"&&!le.getState().gameMenus.gameInPlay.planetsLiberated[e.config.planet]):return;default:{const o=Qf(e),a=e.config.times!==void 0?{aabb:go(o.aabb,e.config.times),renderAabb:void 0}:o;let l;try{l=yz(e)}catch(c){throw new Error(`loadItemFromJson: error creating initial state for jsonItem ${JSON.stringify(e,null,2)}`,{cause:c})}yield{...e,...lt,...a,id:`${t}${i}`,jsonItemId:t,fixedZIndex:e.type==="emitter"?Ir:void 0,shadowCastTexture:Oz(e),castsShadowWhileStoodOn:e.type==="monster"&&(e.config.which==="emperor"||e.config.which==="emperorsGuardian"||e.config.which==="cyberman"||e.config.which==="turtle"||e.config.which==="helicopterBug")||e.type==="pickup"||e.type==="ball"||e.type==="lift"||e.type==="pushableBlock"||e.type==="sceneryPlayer"||e.type==="slidingDeadly"||e.type==="spring",config:e.config,state:l}}}}const Wz=({gameState:t,room:e,itemType:r,config:s,position:n,additionalIdPart:i})=>{const o={type:r,config:s,position:ee},a=`${r}/${i}`,l=ex(Jf(a,o,e.roomJson,t.pickupsCollected[e.id]??me));if(l===void 0)throw console.error("failed to generate any items for json",a,o),new Error("failed to generate any items");return Mn({room:e,item:l,atPosition:n}),l},Mn=({room:t,item:e,atPosition:r})=>(t.items[e.id]=e,r!==void 0&&(e.state.position=r),t[Ht].addItem(e),e),Yz=(t,e)=>Qe(ix(t)).map(r=>{const s=e.items[r];if(s===void 0)throw new Error(`item ${r} in stoodOnBy is not in the room`);return s});function _V(t,e){return t===null?null:e.items[t]}const HG=(t,{standingOnItemId:e,standingOnUntilRoomTime:r,previousStandingOnItemId:s,jumped:n})=>e!==null?e:!n&&r+gO>t.roomTime&&t.items[s]?s:null,ad=(t,e)=>{if(t.state.standingOnItemId!==null){const r=_V(t.state.standingOnItemId,e);delete r.state.stoodOnBy[t.id],t.state.previousStandingOnItemId=t.state.standingOnItemId,t.state.standingOnItemId=null,r.state.stoodOnUntilRoomTime=e.roomTime,t.state.standingOnUntilRoomTime=e.roomTime}},In=({room:t,item:e})=>{const r=SV({room:t,item:e});t[Ht].removeItem(r)},SV=({room:t,item:e})=>{const r=typeof e=="string"?t.items[e]:e;Ms(r)&&ad(r,t);for(const s of Yz(r.state.stoodOnBy,t))ad(s,t);return typeof e=="string"?delete t.items[e]:delete t.items[r.id],r},Zf=({above:t,below:e})=>{const r=e.state.stoodOnBy;if(!Object.isExtensible(r))throw new Error(`${t.id} can't stand on ${e.id} - its standingOn is not extensible`);t.state.previousStandingOnItemId=t.state.standingOnItemId,t.state.standingOnItemId=e.id,r[t.id]=!0},Kz=t=>{const e={id:"head",type:"head",...lt,...El,state:{...Ge(),...Rn(),...Ao(),...t.state.head,facing:t.state.facing,visualFacingVector:t.state.visualFacingVector,position:U(t.state.position,{z:W.z}),switchedToAt:De,actedOnAt:t.state.actedOnAt,collidedWith:t.state.collidedWith,stoodOnUntilRoomTime:t.state.stoodOnUntilRoomTime}},r={id:"heels",type:"heels",...lt,...El,state:{...Ge(),...Rn(),...Ao(),...t.state.heels,facing:t.state.facing,visualFacingVector:t.state.visualFacingVector,position:U(t.state.position),switchedToAt:De,actedOnAt:t.state.actedOnAt,collidedWith:t.state.collidedWith,stoodOnUntilRoomTime:t.state.stoodOnUntilRoomTime,isBigJump:!1}};return{head:e,heels:r}},Qz=({head:t,heels:e})=>({id:"headOverHeels",type:"headOverHeels",...lt,shadowCastTexture:e.shadowCastTexture,castsShadowWhileStoodOn:e.castsShadowWhileStoodOn,config:me,aabb:Ya,state:{...Ge(),...Rn(),...Ao(),position:e.state.position,action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:e.state.facing,visualFacingVector:e.state.visualFacingVector,actedOnAt:e.state.actedOnAt.roomTime>t.state.actedOnAt.roomTime?e.state.actedOnAt:t.state.actedOnAt,collidedWith:e.state.collidedWith.roomTime>t.state.collidedWith.roomTime?e.state.collidedWith:t.state.collidedWith,stoodOnUntilRoomTime:e.state.stoodOnUntilRoomTime,head:{...eo(t.state,"hasHooter","doughnuts","fastStepsStartedAtDistance","gameWalkDistance","lives","gameTime","shieldCollectedAt","lastDiedAt"),switchedToAt:De},heels:{...eo(e.state,"hasBag","bigJumps","carrying","lives","gameTime","shieldCollectedAt","lastDiedAt"),switchedToAt:De}}}),Xz=t=>{const e=t.characterRooms.head,r=Br(t,"head"),s=Br(t,"heels"),n=Qz({head:r,heels:s});In({room:e,item:"head"}),In({room:e,item:"heels"}),Mn({room:e,item:n}),t.previousPlayable=t.currentCharacterName,t.currentCharacterName="headOverHeels",t.characterRooms={head:void 0,heels:void 0,headOverHeels:e}},Jz=(t,e)=>{const r=t.characterRooms.headOverHeels,s=Br(t,"headOverHeels"),n=e??qn(t.previousPlayable),{head:i,heels:o}=Kz(s);In({room:r,item:"headOverHeels"}),Mn({room:r,item:i}),Mn({room:r,item:o}),Zf({above:i,below:o}),t.currentCharacterName=n,t.previousPlayable=void 0,t.characterRooms={head:r,heels:r,headOverHeels:void 0}},Zz=t=>{const e=Br(t,t.currentCharacterName);e!==void 0&&(e.type==="headOverHeels"?(e.state.head.switchedToAt=e.state.head.gameTime,e.state.heels.switchedToAt=e.state.heels.gameTime):e.state.switchedToAt=e?.state.gameTime)},Ka=(t,e)=>{pz(t)&&(!e||e===t.currentCharacterName)?Xz(t):t.currentCharacterName==="headOverHeels"?Jz(t,e):(!e||e!==t.currentCharacterName)&&Br(t,qn(t.currentCharacterName))!==void 0&&(t.currentCharacterName=qn(t.currentCharacterName)),Zz(t)},Hu=4,Wu=Ci.h,kV=()=>{const t=Ro(),e=v.useRef(null),r=v.useCallback((s,n="lines")=>{if(e.current===null)return;const{scrollTop:i,scrollLeft:o}=e.current,a=fe[s],l=n==="all"?a.y<0?9999:0:n==="lines"?i+t*Hu*-a.y*Wu:i+-a.y*(e.current?.getBoundingClientRect().height-t*Wu*Hu),c=o+t*Hu*a.x*Wu;e.current.scrollTo({left:c,top:l,behavior:"smooth"})},[t]);return Se({handler:v.useCallback(()=>{r("towards")},[r]),action:"towards"}),Se({handler:v.useCallback(()=>{r("away")},[r]),action:"away"}),Se({handler:v.useCallback(()=>{r("towards","pages")},[r]),action:"pageDown"}),Se({handler:v.useCallback(()=>{r("away","pages")},[r]),action:"pageUp"}),Se({handler:v.useCallback(()=>{r("towards","all")},[r]),action:"end"}),Se({handler:v.useCallback(()=>{r("away","all")},[r]),action:"home"}),Se({handler:v.useCallback(()=>{r("left")},[r]),action:"left"}),Se({handler:v.useCallback(()=>{r("right")},[r]),action:"right"}),e},e2=(t,e,r)=>{if(e==="*")return!0;const s=r.meta.subRooms[e];return t.x>=s.physicalPosition.from.x&&t.y>=s.physicalPosition.from.y&&t.x<=s.physicalPosition.to.x&&t.y<=s.physicalPosition.to.y},t2=({position:t},e,r)=>e2(t,e,r),r2=(t,e,r)=>{if(e==="*")return 0;const s=r.meta.subRooms[e],{from:n,to:i}=s.physicalPosition;if(t.x>=n.x&&t.y>=n.y&&t.x<=i.x&&t.y<=i.y)return 0;let o=0,a=0;return t.x<n.x?o=n.x-t.x:t.x>i.x&&(o=t.x-i.x),t.y<n.y?a=n.y-t.y:t.y>i.y&&(a=t.y-i.y),o+a},ep=(t,e,r)=>{const s=r.meta?.subRooms;if(s===void 0)return"*";let n,i=1/0;const o=e==="fine"?{x:t.x/W.x,y:t.y/W.y}:t;for(const a of ix(s)){const l=r2(o,a,r);if(l===0)return a;l<i&&(i=l,n=a)}if(n===void 0)throw new Error(`item not found in any subroom of ${r.id}
      item at  ${JSON.stringify(o)}
      subrooms ${JSON.stringify(r.meta?.subRooms,null,2)}`);return n},H=48,Er=36,yo=.55,_t=H*((1-yo)/2),vt=H-_t,qo=8,Es=128,ks=({mapTitle:t,y:e=0,className:r,textOnly:s=!1})=>{const n=Ro();return p.jsxs("g",{className:r,children:[s||p.jsx("rect",{y:e,width:1e4,height:1e4}),p.jsx("foreignObject",{width:n*(t.length+3)*8,height:n*16*3,x:qo,y:e+16,children:p.jsx(j,{className:`left-2 relative sprites-double-height ${ce}`,children:t})})]})},Gr={blacktooth:{bgClassName:"fill-redShadow zx:fill-zxGreenDimmed text-lightGrey zx:text-zxWhite",containerClassName:"bg-moss zx:bg-zxGreenDimmed scrollbar-track-moss zx:scrollbar-track-zxGreenDimmed scrollbar-thumb-shadow zx:scrollbar-thumb-zxWhite"},bookworld:{bgClassName:"fill-redShadow zx:fill-zxBlue text-highlightBeige zx:text-zxWhite",containerClassName:"bg-redShadow zx:bg-zxBlue scrollbar-track-redShadow zx:scrollbar-track-zxBlue scrollbar-thumb-highlightBeige zx:scrollbar-thumb-zxWhite"},jail:{bgClassName:"fill-shadow zx:fill-zxBlue text-black zx:text-zxWhite",containerClassName:"bg-shadow zx:bg-zxBlue scrollbar-track-shadow zx:scrollbar-track-zxBlue scrollbar-thumb-lightGrey zx:scrollbar-thumb-zxWhite"},egyptus:{bgClassName:"fill-midRed zx:fill-zxRedDimmed text-highlightBeige zx:text-zxYellow",containerClassName:"bg-midRed zx:bg-zxRedDimmed scrollbar-track-midRed zx:scrollbar-track-zxBlue zx:scrollbar-track-zxRedDimmed scrollbar-thumb-highlightBeige zx:scrollbar-thumb-zxYellow"},moonbase:{bgClassName:"fill-pastelBlue zx:fill-zxBlue text-metallicBlue zx:text-zxWhite",containerClassName:"bg-pastelBlue zx:bg-zxBlue scrollbar-track-pastelBlue zx:scrollbar-track-zxBlue scrollbar-thumb-metallicBlue zx:scrollbar-thumb-zxWhite"},market:{bgClassName:"fill-metallicBlueHalfbrite zx:fill-zxCyan text-highlightBeige zx:text-zxBlack",containerClassName:"bg-metallicBlueHalfbrite zx:bg-zxCyan scrollbar-track-metallicBlueHalfbrite zx:scrollbar-track-zxBlue scrollbar-thumb-highlightBeige zx:scrollbar-thumb-zxBlack"},penitentiary:{bgClassName:"fill-shadow zx:fill-zxBlue text-moss zx:text-zxWhite",containerClassName:"bg-shadow zx:bg-zxBlue scrollbar-track-shadow zx:scrollbar-track-zxBlue scrollbar-thumb-moss zx:scrollbar-thumb-zxWhite"},safari:{bgClassName:"fill-redShadow zx:fill-zxBlue text-moss zx:text-zxWhite",containerClassName:"bg-redShadow zx:bg-zxBlue scrollbar-track-redShadow zx:scrollbar-track-zxBlue scrollbar-thumb-moss zx:scrollbar-thumb-zxWhite"},freedom:{bgClassName:"fill-moss zx:fill-zxGreen text-metallicBlue zx:text-zxBlack",containerClassName:"bg-moss zx:bg-zxGreen scrollbar-track-moss zx:scrollbar-track-zxGreen scrollbar-thumb-moss zx:scrollbar-thumb-zxBlack"}},s2=t=>{switch(t.hue){case"cyan":return"[--roomHintColor:theme(colors.pastelBlue)] [--roomHintColorDarker:theme(colors.pastelBlueHalfbrite)] zx:[--roomHintColor:theme(colors.zxCyan)] zx:[--roomHintColorDarker:theme(colors.zxCyanDimmed)]";case"green":return"[--roomHintColor:theme(colors.moss)] [--roomHintColorDarker:theme(colors.mossHalfbrite)] zx:[--roomHintColor:theme(colors.zxGreen)] zx:[--roomHintColorDarker:theme(colors.zxGreenDimmed)]";case"magenta":return"[--roomHintColor:theme(colors.pink)] [--roomHintColorDarker:theme(colors.pinkHalfbrite)] zx:[--roomHintColor:theme(colors.zxMagenta)] zx:[--roomHintColorDarker:theme(colors.zxMagentaDimmed)]";case"white":return"[--roomHintColor:theme(colors.lightGrey)] [--roomHintColorDarker:theme(colors.lightGreyHalfbrite)] zx:[--roomHintColor:theme(colors.zxWhiteDimmed)] zx:[--roomHintColorDarker:theme(colors.zxBlack)]";case"yellow":return"[--roomHintColor:theme(colors.highlightBeige)] [--roomHintColorDarker:theme(colors.highlightBeigeHalfbrite)] zx:[--roomHintColor:theme(colors.zxYellow)] zx:[--roomHintColorDarker:theme(colors.zxYellowDimmed)]";default:throw t.hue,new Error("unknown hue")}},CV=t=>(t&&Gr[t])??{bgClassName:"fill-shadow",containerClassName:""},Kt=t=>({x:(t.x??0)*H,y:(t.y??0)*H,z:(t.z??0)*Er}),jn=t=>Math.round(t*10)/10,tp=t=>{const e=Oe(t);return`translate(${jn(e.x)},${jn(e.y)})`},G=t=>{const e=Oe(t);return Mt(e)},Mt=t=>`${jn(t.x)},${jn(t.y)}`,n2=({originalCampaignPositions:t,mapBounds:e,containerWidth:r})=>{const s=Ro(),n=e.r-e.l+2*qo,i={x:-e.l+qo+(r-n)/2,y:-e.t+Es},o=(q,x=ee)=>Kr(i,Oe(Kt(U(t[q].gridPosition,x)))),a=o("blacktooth44market/*",{x:1,z:1.5}),l=o("blacktooth44market/*",{x:1}),c=o("blacktooth45market/*"),u=o("blacktooth48market/*",{y:1}),h=o("blacktooth53market/*",{x:0,y:0,z:0}),f=o("blacktooth53market/*",{x:0,y:1,z:0}),d=o("blacktooth53market/*",{x:1,y:1,z:0}),m=o("blacktooth52market/*",{x:1,y:.5,z:0}),g=s*8*2,A="Market",y=(A.length+3)*s*8,b=s*8*2+32;return p.jsxs(p.Fragment,{children:[p.jsx("path",{className:`${Gr.market.bgClassName} stroke-metallicBlueHalfbrite zx:stroke-zxCyan`,strokeWidth:12,d:`
M ${Mt({x:g,y:m.y+b})}
L ${Mt({x:y,y:m.y+b})}
L ${Mt({x:y,y:a.y})}
L ${Mt(a)}
L ${Mt(l)}
L ${Mt(c)}
L ${Mt(u)}
L ${Mt(h)}
L ${Mt(f)}
L ${Mt(d)}
L ${Mt(m)}
L ${Mt({...m,x:g})}
z`}),p.jsx(ks,{y:m.y,mapTitle:A,className:Gr.market.bgClassName,textOnly:!0})]})},i2=({gridPositions:t,mapBounds:e,containerWidth:r})=>{const s=t,n=Oe(Kt({x:1,y:1,z:0})).y,i=(o,a)=>{if(s[o]===void 0)throw new Error(`OriginalCampaignMainMapBackground: this campaign does not have any room called "${o}" to use to calculate yBetweenRooms`);if(s[a]===void 0)throw new Error(`OriginalCampaignMainMapBackground: this campaign does not have any room called "${a}" to use to calculate yBetweenRooms`);const l=Oe(Kt(s[o].gridPosition)).y,c=Oe(Kt(s[a].gridPosition)).y+n;return(l+c)/2};return p.jsxs(p.Fragment,{children:[p.jsx(ks,{y:0,mapTitle:"Freedom",className:Gr.freedom.bgClassName}),p.jsx(ks,{y:i("finalroom/*","blacktooth83tofreedom/*")-e.t+Es,mapTitle:"Castle Blacktooth",className:Gr.blacktooth.bgClassName}),p.jsx(ks,{y:i("blacktooth87crown/*","moonbase35/*")-e.t+Es,mapTitle:"Moonbase",className:Gr.moonbase.bgClassName}),p.jsx(ks,{y:i("moonbase4/*","blacktooth62fish/right")-e.t+Es,mapTitle:"Blacktooth escape",className:Gr.blacktooth.bgClassName}),p.jsx(n2,{mapBounds:e,originalCampaignPositions:s,containerWidth:r}),p.jsx(ks,{y:i("blacktooth24/*","blacktooth1head/*")-e.t+Es,mapTitle:"Jail",className:Gr.jail.bgClassName})]})},o2={blacktooth:"Blacktooth",bookworld:"Bookworld",jail:"Blacktooth",egyptus:"Egyptus",moonbase:"Moonbase",market:"Market",penitentiary:"Penitentiary",safari:"Safari"},a2=t=>{const{campaign:e,curRoomId:r}=t,s=e.locator.userId===Ew&&!["penitentiary","bookworld","egyptus","safari"].includes(e.rooms[r].planet),n=CV(t.curRoomScenery);return s?p.jsx(i2,{...t}):p.jsx(ks,{mapTitle:o2[e.rooms[r].planet],className:n.bgClassName})},Ty=t=>k_(Qt(t.aabb,.5),t.state.position),l2={x:1,y:1,z:1},Py=(t,e,r)=>e===r?t===e?.5:t>e?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:(t-e)/(r-e),WG=t=>t,c2=t=>Dr(t.items),u2=t=>Fd(t),rp=t=>Qe(c2(t)),YG=(t,...e)=>{const r=Qe(u2(t));return e.length===0?r:r.filter(([,s])=>e.includes(s.type))},h2={floors:{edgeLeftX:Number.POSITIVE_INFINITY,edgeRightX:Number.NEGATIVE_INFINITY,topEdgeY:Number.POSITIVE_INFINITY,bottomEdgeY:Number.NEGATIVE_INFINITY},allItems:{topEdgeY:Number.POSITIVE_INFINITY}},KG=t=>Ot(t.items).reduce((e,r)=>{if(r.type==="floor"){const{config:{naturalFootprint:s},state:{position:n},renderAabb:i,renderAabbOffset:o,aabb:a}=r,l=Oe(U(s.position,{x:s.aabb.x,z:s.aabb.z})).x,c=Oe(U(s.position,{y:s.aabb.y,z:s.aabb.z})).x,u=Oe(U(s.position,s.aabb)).y,h=Oe(U(n,o??ee,{z:(i??a).z})).y;return{allItems:e.allItems,floors:{edgeLeftX:Math.min(e.floors.edgeLeftX,l),edgeRightX:Math.max(e.floors.edgeRightX,c),topEdgeY:Math.min(e.floors.topEdgeY,u),bottomEdgeY:Math.max(e.floors.bottomEdgeY,h)}}}else{const s=Oe(U(r.state.position,r.renderAabb??r.aabb??ee,r.renderAabbOffset??ee)).y;return{allItems:{topEdgeY:Math.min(e.allItems.topEdgeY,s)},floors:e.floors}}},h2),d2={from:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,z:Number.POSITIVE_INFINITY},to:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY,z:Number.NEGATIVE_INFINITY}},EV=t=>{const e=rp(t).filter(r=>r.type==="floor").reduce((r,s)=>{const{position:n,config:{times:i}}=s;return{from:{x:Math.min(r.from.x,n.x),y:Math.min(r.from.y,n.y),z:Math.min(r.from.z,n.z)},to:{x:Math.max(r.to.x,n.x+i.x),y:Math.max(r.to.y,n.y+i.y),z:Math.max(r.to.z,n.z)}}},d2);if(isFinite(e.from.x))return e},TV=({svg:t=!1,smooth:e=!1})=>{const r=v.useRef(null);return v.useLayoutEffect(()=>{r.current?.scrollIntoView({behavior:e?"smooth":"instant",block:"center"})}),t?p.jsx("g",{ref:r}):p.jsx("div",{ref:r})},Qa=({className:t,scrollTo:e=!1,onClick:r,yAdjust:s=0})=>p.jsxs("foreignObject",{x:-50,y:-100+s,width:100,height:100,className:t,style:{pointerEvents:"none"},children:[p.jsx("div",{className:`sprite zx:sprite-revert-to-two-tone ml-[calc(50px-var(--scale)*var(--w)/2)] mt-[calc(100px-var(--scale)*var(--h))] ${t}`,onClick:r,style:r?{pointerEvents:"all"}:{}}),e&&p.jsx(TV,{})]}),Ti=({characterName:t,facing:e,isCurrent:r=!1,onlyPlayableInRoom:s=!1,yAdjust:n=0,onClick:i})=>p.jsx(Qa,{className:`${s?"[--scale:2.5]":"[--scale:1.5]"}
                ${Tn({character:t,action:r?"walking":"idle",facingXy8:zd(e)??"towards"})}`,scrollTo:r,yAdjust:n,onClick:o=>{i?.(t),o.preventDefault(),o.stopPropagation()}}),f2=({item:t})=>{const r=t.type==="hushPuppy"||t.type==="teleporter"?"[--scale:1.25]":"[--scale:1.5]";if(t.type==="lift")return p.jsxs(p.Fragment,{children:[p.jsx(Qa,{className:`${r} texture-lift_static`}),p.jsx(Qa,{className:`${r} texture-lift_2`})]});const s=t.type==="teleporter"?"texture-teleporter":t.type==="hushPuppy"?"texture-hushPuppy":t.config.gives==="extra-life"||t.config.gives==="fast"||t.config.gives==="jumps"||t.config.gives==="shield"?"texture-whiteRabbit":t.config.gives==="doughnuts"?"texture-doughnuts":t.config.gives==="hooter"?"texture-hooter":t.config.gives==="bag"?"texture-bag":t.config.gives==="reincarnation"?"texture-animated-fish":t.config.gives==="crown"?t.config.planet==="blacktooth"?"texture-crown_blacktooth":t.config.planet==="egyptus"?"texture-crown_egyptus":t.config.planet==="penitentiary"?"texture-crown_penitentiary":t.config.planet==="safari"?"texture-crown_safari":t.config.planet==="bookworld"?"texture-crown_bookworld":"texture-crown_dark":"texture-block_organic";return p.jsx(Qa,{className:`${r} ${s}`})},p2=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:0,y:.5},{x:.5,y:.5},{x:1,y:.5},{x:0,y:1},{x:.5,y:1},{x:1,y:1}],m2=({x:t,y:e},{x:r,y:s})=>(t-r)**2+(e-s)**2,g2=(t,e)=>{const r=t%3,s=Math.floor(t/3),n=e%3,i=Math.floor(e/3);return Math.abs(r-n)<=1&&Math.abs(s-i)<=1&&t!==e},Ry=t=>t.some((e,r)=>t.slice(r+1).some(s=>g2(e,s))),Fi=(t,e)=>{if(e===0)return[[]];if(t.length<e)return[];const[r,...s]=t;return[...Fi(s,e),...Fi(s,e-1).map(n=>[r,...n])]},PV=t=>t.length<=1?[t]:t.flatMap((e,r)=>PV([...t.slice(0,r),...t.slice(r+1)]).map(s=>[e,...s])),My={1:Fi([...Array(9).keys()],1),2:Fi([...Array(9).keys()],2).filter(t=>!Ry(t)),3:Fi([...Array(9).keys()],3).filter(t=>!Ry(t))},ld=3,RV=({items:t,itemNormalisedPosition:e})=>{const r=Ln(t),s=r.length;if(s===0)return me;if(s>ld)throw new Error(`roomItemPositions supports up to ${ld} items, but got ${s}: ${Object.keys(t).join(", ")}`);const n=r.map(([a,l])=>({id:a,pos:e(l)}));let i=me,o=1/0;if(My[s]===void 0)throw new Error(`no precomputed valid grid index combinations for count ${s}`);for(const a of My[s]){const l=a.map(c=>p2[c]);for(const c of PV(l)){const u={};let h=0;for(let f=0;f<s;f++){const{id:d,pos:m}=n[f],g=c[f];u[d]=g,h+=m2(m,g)}h<o&&(o=h,i=u)}}return i},MV=({items:t,positions:e,ItemComponent:r})=>p.jsx("g",{"data-class":"items",children:Ln(e).sort(([s,n],[i,o])=>o.y-n.y+(o.x-n.x)).map(([s,n])=>p.jsx("g",{"data-position":JSON.stringify(n),transform:`${tp(Uq(n,H*.5))} translate(0,-3)`,children:p.jsx(r,{item:t[s]})},s))}),A2=(t,e)=>{if(t==="*"){const r=EV(e);if(r===void 0)throw new Error(`no floors in room ${e.id} when trying to get start and end for subroom ${t}`);return r}else{if(!e.meta?.subRooms)throw new Error(`no subrooms in ${e.id} when trying to get start and end for subroom ${t}`);return e.meta.subRooms[t].physicalPosition}},y2=({items:t,roomJson:e,subRoomId:r})=>{const s=v.useMemo(()=>RV({items:t,itemNormalisedPosition:i=>{const o={...i.config.times??me,...l2},a=Kr(i.position,Qt(o,.5)),l=A2(r,e);return{x:(a.x-l.from.x)/(l.to.x-l.from.x),y:(a.y-l.from.y)/(l.to.y-l.from.y)}}}),[t,e,r]);return p.jsx(MV,{ItemComponent:f2,items:t,positions:s})},q2=({headItemInRoom:t,heelsItemInRoom:e,roomJson:r,currentCharacterName:s,onClick:n})=>{const i=v.useMemo(()=>({item:{type:l,state:{facing:c}}})=>p.jsx(Ti,{characterName:l,facing:c,isCurrent:s===l,onlyPlayableInRoom:!1,onClick:n}),[s,n]),o=v.useMemo(()=>({head:t,heels:e}),[t,e]),a=v.useMemo(()=>RV({items:o,itemNormalisedPosition:c=>{const u=Ty(c),h=Gq(Ty(c),{x:1/W.x,y:1/W.y,z:1}),f=EV(r);if(f===void 0)throw new Error(`no floors in room ${r.id} when trying to get item position`);return{x:Py(h.x,f.from.x,f.to.x),y:Py(u.y,f.from.y,f.to.y)}}}),[o,r]);return p.jsx(MV,{ItemComponent:i,items:o,positions:a})},x2=(t,e,r)=>t2(t,e,r)&&(t.type==="teleporter"||t.type==="hushPuppy"||t.type==="lift"||t.type==="pickup"&&t.config.gives!=="scroll"),b2=(t,e)=>{const r=Object.entries(t);if(r.length<=e)return t;const s=Object.groupBy(r,i=>i[1].type),n=VS(e,yS(...Dr(s)));return Object.fromEntries(n)},w2=(t,e,r)=>v.useMemo(()=>{let s=!1,n=!1;const i=Qe(Ln(t.items)).filter(([o,a])=>!e[o]).filter(([o,a])=>{if(a.type==="hushPuppy"){if(s)return!1;s=!0}if(a.type==="pickup"&&a.config.gives==="crown"){if(n)return!1;n=!0}return!0}).filter(o=>x2(o[1],r,t));return b2(Un(i),ld)},[t,e,r]),IV=.15,Ma=Oe(Kt({x:.5,y:.5,z:0})),Iy=Oe(Kt({x:IV,y:0,z:0})),jy=Oe(Kt({x:IV*1.66,y:0,z:0})),V2=({className:t})=>p.jsxs(p.Fragment,{children:[p.jsx("ellipse",{className:"fill-white",cx:Ma.x,cy:Ma.y,rx:Math.abs(jy.x),ry:Math.abs(jy.y)}),p.jsx("ellipse",{className:t,cx:Ma.x,cy:Ma.y,rx:Math.abs(Iy.x),ry:Math.abs(Iy.y)})]}),$t=3,Oy=$q(Oe({x:H,y:0})),Ia={wall:void 0,open:"0,999",doorway:`${jn(Oy*((1-yo)/2)-$t/2)}, ${jn(Oy*yo+$t)}, 999`},Yu=`
M ${G({})}
L ${G({y:H})}
L ${G({x:H,y:H})}
L ${G({x:H})}
z`,ja=(t,e=yo)=>{const r=H*((1-e)/2),s=H-r,n=t.away!=="wall",i=t.towards!=="wall",o=t.left!=="wall",a=t.right!=="wall";let l=`M${G({x:r,y:r})}`;return a&&(l+=`L${G({x:0,y:r})} L${G({x:0,y:s})}`),l+=`L${G({x:r,y:s})}`,n&&(l+=`L${G({x:r,y:H})} L${G({x:s,y:H})}`),l+=`L${G({x:s,y:s})}`,o&&(l+=`L${G({x:H,y:s})} L${G({x:H,y:r})}`),l+=`L${G({x:s,y:r})}`,i&&(l+=`L${G({x:s,y:0})} L${G({x:r,y:0})}`),l+="z",l},Ku=4,v2=Qe(rx(Ku)).map(t=>`
M${G({x:H*((t+.5)/Ku),y:0})}
L${G({x:H*((t+.5)/Ku),y:H})}`).toArray().join(""),Ny=t=>{const e=`
M${G({x:0,y:H})}
L${G({x:0,y:H,z:Er})}
L${G({x:H,y:H,z:Er})}
L${G({x:H,y:H})}
z
`;return t?e+`
M${G({x:_t,y:H})}
L${G({x:_t,y:H,z:Er})}
L${G({x:vt,y:H,z:Er})}
L${G({x:vt,y:H})}
L${G({x:_t,y:H})}`:e},_2=`            
M${G({x:H,y:H,z:Er})}            
L${G({x:H,y:H})}            
M${G({x:H,y:0,z:Er})}            
L${G({x:H,y:0})}            
M${G({x:0,y:H,z:Er})}            
L${G({x:0,y:H})}            
`,S2=`            
M${G({x:0,y:0,z:Er})}            
L0, 0            
`,k2=({roomGridPositionSpec:{boundaries:t,subRoomId:e},roomPickupsCollected:r,roomJson:s,roomVisited:n,headItemInRoom:i,heelsItemInRoom:o,headOverHeelsItemInRoom:a,currentCharacterName:l,onPlayableClick:c,onRoomClick:u})=>{const{id:h,roomAbove:f,color:d,items:m}=s,g=s.meta?.label,A=u!==void 0,y=w2(s,r,e),b=Object.values(m).filter(V=>V.type==="floor"),q=b.every(V=>V.config.floorType==="none"),x=b.some(V=>V.config.floorType==="deadly");return p.jsxs("g",{"data-room-id":h,strokeWidth:$t,className:`
        ${s2(d)} 
        ${A?`
            group/room
            hover:[--roomHintColor:theme(colors.midRed)] 
            zx:hover:[--roomHintColor:theme(colors.zxRed)]`:""}
        `,children:[q?p.jsxs(p.Fragment,{children:[p.jsx("path",{className:"fill-[var(--roomHintColor)]",fillRule:"evenodd",d:`${Yu} ${ja(t)}`}),p.jsx("path",{className:"fill-white",fillRule:"evenodd",d:`${ja(t)} ${ja(t,yo*.7)}`})]}):p.jsxs(p.Fragment,{children:[p.jsx("path",{className:"fill-[var(--roomHintColor)]",d:Yu}),p.jsx("path",{className:`fill-white
              ${A?`
                  group-hover/room:fill-pastelBlue
                  zx:group-hover/room:fill-zxCyan`:""}
            `,d:ja(t)}),x&&p.jsx("path",{className:"stroke-[var(--roomHintColor)]",strokeDasharray:"1, 12.4",d:v2})]}),s.id==="blacktooth11"?p.jsx("path",{className:"fill-[var(--roomHintColor)]",d:`
M${G({x:_t,y:_t})}
L${G({x:vt,y:_t})}
L${G({x:vt,y:_t-$t*2})}
L${G({x:_t,y:_t-$t*2})}
z
M${G({x:_t,y:vt})}
L${G({x:vt,y:vt})}
L${G({x:vt,y:vt+$t*2})}
L${G({x:_t,y:vt+$t*2})}
z
`}):s.id==="moonbase20"||s.id==="moonbase23"?p.jsx("path",{className:"stroke-[var(--roomHintColor)]",strokeWidth:$t*2,d:`
M${G({x:_t,y:H/2})}
L${G({x:vt,y:H/2})}

M${G({x:H/2,y:_t})}
L${G({x:vt,y:H/2})}

M${G({x:H/2,y:vt})}
L${G({x:vt,y:H/2})}
`}):s.id==="blacktooth77"||s.id==="safari26"?p.jsx("path",{className:"fill-[var(--roomHintColor)]",strokeWidth:1,d:`
M${G({x:H/2-$t,y:0})}
L${G({x:H/2+$t,y:0})}
L${G({x:H/2+$t,y:H})}
L${G({x:H/2-$t,y:H})}
z
`}):null,f&&p.jsxs(p.Fragment,{children:[p.jsx("path",{className:"fill-[var(--roomHintColorDarker)]",fillRule:"evenodd",d:Ny(t.away==="doorway")}),p.jsx("path",{className:"fill-[var(--roomHintColor)]",fillRule:"evenodd",transform:"scale(-1, 1)",d:Ny(t.left==="doorway")})]}),p.jsxs("g",{className:"fill-transparent stroke-midGreyHalfbrite",children:[p.jsx("path",{d:`M${G({x:0,y:H})} L0, 0`,"data-direction":"right","data-boundary":t.right,strokeDasharray:Ia[t.right]}),p.jsx("path",{d:`M${G({x:H,y:0})} L${G({x:H,y:H})}`,"data-direction":"left","data-boundary":t.left,strokeDasharray:Ia[t.left]}),p.jsx("path",{d:`M${G({x:H,y:0})} L0, 0`,"data-direction":"towards","data-boundary":t.towards,strokeDasharray:Ia[t.towards]}),p.jsx("path",{d:`M${G({x:0,y:H})} L${G({x:H,y:H})}`,"data-direction":"away","data-boundary":t.away,strokeDasharray:Ia[t.away]})]}),n&&p.jsx(V2,{className:"fill-[var(--roomHintColor)]"}),f&&p.jsx("path",{className:"fill-transparent stroke-midGreyHalfbrite",d:_2}),i&&o?p.jsx(q2,{roomJson:s,currentCharacterName:l,headItemInRoom:i,heelsItemInRoom:o,onClick:c}):i?p.jsx(Ti,{characterName:"head",isCurrent:l==="head",onlyPlayableInRoom:!0,facing:i.state.facing,yAdjust:-8,onClick:c}):o?p.jsx(Ti,{characterName:"heels",isCurrent:l==="heels",onlyPlayableInRoom:!0,facing:o.state.facing,yAdjust:-8,onClick:c}):a?p.jsxs(p.Fragment,{children:[p.jsx(Ti,{characterName:"heels",onlyPlayableInRoom:!1,facing:a.state.facing,yAdjust:-16,isCurrent:!0}),p.jsx(Ti,{characterName:"head",onlyPlayableInRoom:!1,facing:a.state.facing,isCurrent:!0,yAdjust:-36})]}):p.jsx(y2,{roomJson:s,subRoomId:e,items:y}),f&&p.jsx("path",{className:"fill-transparent stroke-midGreyHalfbrite",d:S2}),g&&p.jsx("g",{transform:tp(Kt(Kr(g.gridOffset,{x:.5,y:.5}))),children:p.jsx("foreignObject",{width:g.text.length*16,height:uI.h*2,y:-8,x:g.align==="left"?0:g.text.length*-16,children:p.jsx(j,{noTint:!0,className:"[--scale:2] [--block:16px]",children:g.text})})}),u?p.jsx("path",{className:"fill-transparent cursor-pointer",d:Yu,onClick:()=>{u(h)}}):null]})},Qu=(t,e,r,s)=>{const n=id(e,t[e]?.items);return n&&r===t[e].roomJson.id&&s===ep(n.state.position,"fine",t[e].roomJson)?n:void 0},C2=t=>{const{campaign:e,pickupsCollected:r,gridPositions:s,currentCharacterName:n,characterRooms:i,mapBounds:o,containerWidth:a,roomsExplored:l,onPlayableClick:c,curRoomId:u,onRoomClick:h}=t;if(a===void 0)return null;const f=o.r-o.l+2*qo,d=o.b-o.t+2*Es,m=Object.values(s);return p.jsxs("svg",{className:"w-full",style:{minWidth:`${f}px`,height:`${d}px`},strokeLinecap:"round",strokeLinejoin:"round",children:[u===void 0?null:p.jsx(a2,{...t,curRoomId:u,containerWidth:a}),p.jsx("g",{transform:`translate(${-o.l+qo+(a-f)/2},${-o.t+ +Es})`,children:m.map(g=>{const{roomId:A,subRoomId:y,gridPosition:b}=g,q=`${A}/${y}`;return p.jsxs("g",{"data-id":q,transform:tp(Kt(b)),children:[p.jsx(k2,{roomGridPositionSpec:g,roomPickupsCollected:r[A]??me,roomJson:e.rooms[A],headItemInRoom:Qu(i,"head",A,y),heelsItemInRoom:Qu(i,"heels",A,y),headOverHeelsItemInRoom:Qu(i,"headOverHeels",A,y),currentCharacterName:n,roomVisited:l[A]??!1,onPlayableClick:c,onRoomClick:h}),u===A?p.jsx(TV,{svg:!0,smooth:!0}):null]},q)})})]})},E2=t=>{const{inputStateTracker:e}=t;return e.currentActionPress("swop")==="tap"?(Ka(t),!0):e.currentActionPress("swop.head")==="tap"?(Ka(t,"head"),!0):e.currentActionPress("swop.heels")==="tap"?(Ka(t,"heels"),!0):!1},T2=()=>{const t=zn(),[e,r]=v.useState(t.gameState.currentCharacterName);return v.useEffect(()=>{const s=()=>{r(t.gameState.currentCharacterName)};return gt.shared.add(s),()=>{gt.shared.remove(s)}},[t.gameState]),e},P2=()=>{const t=zn();v.useEffect(()=>{const e=()=>{E2(t.gameState)};return gt.shared.add(e),()=>{gt.shared.remove(e)}},[t.gameState])},R2=t=>t.characterRooms[t.currentCharacterName],cd=t=>JSON.parse(JSON.stringify(t)),M2=()=>Wt().get("cheats")==="1",I2=(t,e)=>{const r=new URL(e),s=r.hash.substring(1);if(s!==""&&t.rooms[s]!==void 0)return r.hash.substring(1)},j2=t=>Oe(t),O2=(t,e)=>Oe(U(t,{x:e.x,z:e.z})),N2=(t,e)=>Oe(U(t,{y:e.y,z:e.z})),By=(t,e,r)=>{const s=O2(e,r),n=N2(e,r),i=j2(e),o=t;return o.xAxisProjectionMin=n.y-n.x/2,o.xAxisProjectionMax=i.y-i.x/2,o.yAxisProjectionMin=s.y+s.x/2,o.yAxisProjectionMax=i.y+i.x/2,o.zAxisProjectionMin=s.x,o.zAxisProjectionMax=n.x,o},Dy=W.x*2,zy=W.x*2,Fy=W.x*2,Ly=W.x*2;class jV{#e=new Map;#t=new Map;#r=new Map;#s=new Map;#n=new Map;constructor(e){if(e)for(const r of e)this.addItem(r)}#i(e,r,s,n){const i=new Set;for(const o of r)n(o).add(e),i.add(o);s.set(e,i)}#o(e,r,s){const n=s.get(e);if(s.delete(e),!!n)for(const i of n){const o=r.get(i);o&&(o.delete(e),o.size===0&&r.delete(i))}}#l(e,r,s,n,i){const o=n.get(e);if(!o)throw new Error(`Item ${e.id} not in index`);const a=new Set(r);let l=!1,c=!1;for(const u of o)if(!a.has(u)){const h=s.get(u);h&&(l=!0,h.delete(e))}for(const u of a)o.has(u)||(i(u).add(e),c=!0);if(l)for(const u of o){const h=s.get(u);h&&h.size===0&&s.delete(u)}l||c?n.set(e,a):a.clear()}addItem(e){if(this.#r.has(e)){const r=this.#r.get(e);throw new Error(`Item ${e.id} is already in the spatial index at ${[...r].join(" ")}`)}this.#i(e,this.#u(e.state.position,e.aabb),this.#r,r=>this.#a(r)),this.#f(e),this.#i(e,this.#h(e),this.#s,r=>this.#d(r))}#c(e,r){return`${e},${r}`}#a(e){let r=this.#e.get(e);return r||(r=new Set,this.#e.set(e,r)),r}#d(e){let r=this.#t.get(e);return r||(r=new Set,this.#t.set(e,r)),r}*#u(e,r){const s=e,n=U(e,r),i=Math.floor(s.x/zy),o=Math.floor(s.y/Dy),a=Math.floor(n.x/zy),l=Math.floor(n.y/Dy);for(let c=i;c<=a;c++)for(let u=o;u<=l;u++)yield this.#c(c,u)}#f(e){const r=e.renderAabbOffset?U(e.state.position,e.renderAabbOffset):e.state.position,s=e.renderAabb||e.aabb,n=this.#n.get(e);if(n!==void 0)return By(n,r,s),n;{const i=By({},r,s);return this.#n.set(e,i),i}}*#h(e){const r=this.#n.get(e);if(r===void 0)throw new Error("projectionAxes not calculated for "+e.id);const{xAxisProjectionMin:s,xAxisProjectionMax:n,yAxisProjectionMin:i,yAxisProjectionMax:o}=r,a=Math.floor(s/Ly),l=Math.floor(i/Fy),c=Math.floor(n/Ly),u=Math.floor(o/Fy);for(let h=a;h<=c;h++)for(let f=l;f<=u;f++)yield this.#c(h,f)}removeItem(e){if(!this.#r.has(e))throw new Error(`Item ${e.id} is not in the spatial index`);this.#o(e,this.#e,this.#r),this.#o(e,this.#t,this.#s),this.#n.delete(e)}updateItemSpatialIndex(e){this.#l(e,this.#u(e.state.position,e.aabb),this.#e,this.#r,r=>this.#a(r))}updateItemProjectedIndex(e){this.#f(e),this.#l(e,this.#h(e),this.#t,this.#s,r=>this.#d(r))}getCuboidNeighbourhood(e,r,s){const n=new Set;for(const i of this.#u(e,r)){const o=this.#e.get(i);if(o)for(const a of o)a!==s&&n.add(a)}return n}getProjectedNeighbourhood(e,r){const s=new Set;for(const n of this.#h(e)){const i=this.#t.get(n);if(i)for(const o of i)o!==r&&s.add(o)}return s}getItemCuboidNeighbourhood(e){return this.getCuboidNeighbourhood(e.state.position,e.aabb,e)}getItemProjectedNeighbourhood(e){return this.getProjectedNeighbourhood(e,e)}getItemAxesProjections(e){return this.#n.get(e)}debugToString(){const r=Array.from(this.#e.keys()).sort().map(i=>{const o=this.#e.get(i),a=Array.from(o).map(l=>l.id);return`  (${i}) => [${a.join(", ")}]`}),n=Array.from(this.#t.keys()).sort().map(i=>{const o=this.#t.get(i),a=Array.from(o).map(l=>l.id);return`  (${i}) => [${a.join(", ")}]`});return`GridSpatialIndex (${this.#e.size} 2D cells, ${this.#t.size} projected cells, ${this.#r.size} items) {
  2D Cells:
${r.join(`,
`)}
  Projected Cells:
${n.join(`,
`)}
}`}}const OV=(t,e,r,s)=>!(t.x+e.x<=r.x||t.x>=r.x+s.x)&&!(t.y+e.y<=r.y||t.y>=r.y+s.y)&&!(t.z+e.z<=r.z||t.z>=r.z+s.z),sp=({aabb:t,state:{position:e}},{aabb:r,state:{position:s}})=>OV(e,t,s,r),B2=t=>!0;function*Ts(t,e,r=B2){const s=e.getItemCuboidNeighbourhood(t);for(const n of s)r(n)&&sp(t,n)&&(yield n)}const Uy=(t,e)=>({x:t.x>0?e.state.position.x:e.state.position.x+e.aabb.x,y:t.y>0?e.state.position.y:e.state.position.y+e.aabb.y,z:t.z>0?e.state.position.z:e.state.position.z+e.aabb.z}),$y={stopAutowalk:5,portal:5,wall:5,blocker:5,doorLegs:5,sceneryPlayer:5,bubbles:5,switch:10,button:10,doorFrame:15,ball:18,block:20,barrier:20,floor:20,hushPuppy:20,teleporter:20,lift:30,movingPlatform:30,pushableBlock:30,portableBlock:30,sceneryCrown:30,slidingBlock:30,spring:30,joystick:40,charles:40,conveyor:40,head:50,heels:50,headOverHeels:50,pickup:80,firedDoughnut:90,spikes:98,slidingDeadly:100,moveableDeadly:100,deadlyBlock:100,monster:100,floatingText:200,particle:200,emitter:200,soundEffect:200},NV=(t,e)=>$y[t.type]-$y[e.type],D2=(t,e)=>e.toSorted((r,s)=>{const n=NV(r,s);if(n!==0)return n;const i=nl(t,Uy(t,r)),o=nl(t,Uy(t,s));return Math.abs(i-o)<1e-4?r.id<s.id?-1:1:i-o}),z2=(t,e,r,s)=>{const n=Math.max(0,Math.min(t.x+e.x,r.x+s.x)-Math.max(t.x,r.x)),i=Math.max(0,Math.min(t.y+e.y,r.y+s.y)-Math.max(t.y,r.y));return n*i},Gy=({state:{position:t},aabb:e},{state:{position:r},aabb:s})=>z2(t,e,r,s),fs={state:{position:{x:0,y:0,z:0}},aabb:{x:0,y:0,z:0}},ps={state:{position:{x:0,y:0,z:0}},aabb:{x:0,y:0,z:0}},F2=(t,e,r=.001)=>{if(!Qr(e,t)||t.id===e.id)return!1;const{state:{vels:{gravity:{z:s}}}}=t;return s>0?!1:(fs.state.position.x=t.state.position.x,fs.state.position.y=t.state.position.y,fs.state.position.z=t.state.position.z-Yr,fs.aabb.x=t.aabb.x,fs.aabb.y=t.aabb.y,fs.aabb.z=r+Yr,ps.state.position.x=e.state.position.x,ps.state.position.y=e.state.position.y,ps.state.position.z=e.state.position.z+e.aabb.z,ps.aabb.x=e.aabb.x,ps.aabb.y=e.aabb.y,ps.aabb.z=0,sp(fs,ps))},L2=(t,e)=>{const s=[...Qe(e).filter(i=>F2(t,i))];return s.length===0?void 0:s.reduce((i,o)=>{const a=NV(o,i);return a<0||a===0&&Gy(t,o)>Gy(t,i)?o:i})},Oa=W.z,U2=-W.z,$2=t=>{const e=Ot(t).filter(VV).reduce((r,{config:{naturalFootprint:{position:{x:s,y:n},aabb:{x:i,y:o}}}})=>{const a=s+i,l=n+o;return{minX:Math.min(r.minX,s),maxX:Math.max(r.maxX,a),minY:Math.min(r.minY,n),maxY:Math.max(r.maxY,l)}},{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0});if(!(e.minX>e.maxY))return e};function*G2(t,e){const r=$2(e);if(r===void 0)return;const{minX:s,maxX:n,minY:i,maxY:o}=r;t.roomBelow!==void 0&&(yield{...lt,type:"portal",id:"portal/toRoomBelow",fixedZIndex:Ir,config:{toRoom:t.roomBelow,relativePoint:{x:(s+n)/2,y:(i+o)/2,z:Oa+W.z},direction:fe.down},aabb:{x:n-s,y:o-i,z:Oa},state:{...Ge(),position:{x:s,y:i,z:U2-Oa}},renders:!1}),t.roomAbove!==void 0&&(yield{...lt,type:"portal",id:"portal/toRoomAbove",fixedZIndex:Ir,config:{toRoom:t.roomAbove,relativePoint:{...t.ceilingRelativePoint!==void 0?Te(t.ceilingRelativePoint):{x:(s+n)/2,y:(i+o)/2},z:-W.z},direction:fe.up},aabb:{x:n-s,y:o-i,z:Oa},state:{...Ge(),position:U({x:s,y:i},{z:W.z*(t.height??dO)})}})}const H2="data:audio/mpeg;base64,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",W2="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAARAAALSQBAQEBAQFZWVlZWVmNjY2NjY3FxcXFxcX5+fn5+fomJiYmJiZSUlJSUlJ6enp6enqmpqamptLS0tLS0v7+/v7+/ysrKysrK1NTU1NTU39/f39/f6urq6urq9fX19fX1//////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJAZAQQABuAAAC0mIpRnOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uwxAAABGwBW7QAACH6lCs/NvBI1AAbSkgF4ABRZcPlz4Pg+D4IROD74Pn+q3wQ/KOwQOQQBAMAAOJTDmiIJGRsnW4gAAAAGHBw0GGr6h1QsZCJmtI5hYgmsYoAR0Ag4JBUuUZAsPJMg6JJglclhHUckcsioTqgczgUZ3kIHEq4rEwqNkFsLgn2Y+C3J43WE3Xo9BYGhDDkPxFE+X4CQuplOyOZfBxw0udCrX3zOQVmZoMIXhedAAJChVEEU7wAEGTZdNwgH7mWw5DSFJLPdV2KNnLuOzSTEqBeEAdPlZlTEwHqxNqs1LMcxMM1a1djNU425jGjLFpvdlvuYsfO+n1l+gAR6tolOGFYmwQBCMWKqZ1qMDBIZELiWfE5pVNre897tRKIpRXrvmoG1vegftCy+Kzbj//LZEz9fMoQA2aXZklv4AAYkhwMhQNKHAIx0Fw6iMOQxEpgKZZPRYJ8qBGb7ZHoZqcMofVh2ktwoGiAkzC8VF9v2AAkLDsqNzd5lQAV49Xg4qgYi4La1Xx8Tg0zFyPZIkpbTT7GNSxffKqESjUh0B0DZvlpu/0wBWqpZVsm4AAVjWOro4yB/tqpNY8ZjQNFXPky40t8krDdfZpDHvm58XRUg0XCIpf4nF7nTcVfLwQBXeXdXlvCymVErYmUA1UDNKRHROOh7OHcKWss9aNWDMxPfS5VDJocqMY8plQWcUpemgAGiJhlSS8AABLZawwON1FlnaA2kBuSB6H4eRSYmC0sEFJ6AoX2k5armpKStllLC7mA2Ui/iAAsTEyzX/hw2PKNiagjPDYWlUyDk62rR+41nJr50i0hS0p5W1D/+1DE3YBJfKlV/ZQAKOYGqrWNMBWNB1CoYU2F1bm1AEiIiHeP/wAAGeu00cmu3GAFjOSBwqEpNHHeS+xC60FPuHFcS+ddde3vq92QACKzvDvtwGIfpxBPjpjH+mmJx5JgBEY8FLXit5bva+ElTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVEBiZgJkAAAAFhBRpzk2oF9X2Vys7kT6VmBXM0AAAqVgiMgd0ljw7xocqTEFNRTMuMTAwqqqqqqqqqqqq//sgxPgAR1RxXeywY2jRjir9lIldqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqoQSXcAAAAAADsYgVwgUZnVIPsgaXAKRyFrIA7uFp1MQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7IMT3AEcIR1PsvMMoyQ5p/ZYMdVVVVVVVVVVVVVVVVVVVVVUiUAAABiblGtCRdQPwAdAVA2HQVHNLqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqhPQAAAO8d7/+yDE+ABGtHNJ7LBlKLsNKX2GDHRUNQVKqAeAFALgMUhOTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqIoAAABVRRqMgKxqApRNAYEQONA1MQU1FMy4xMDBVVVVV//sQxPwARZQhSewwZmiDgmj894QUVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUwAAABgK0HQWBEQADnZgKHRLExBTUUzLjEwMKqqqqr/+xDE6wDDBBlNxj2AYEQCajjEsAWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqIgAAACRH2BRkK4jAAqJ6MYhqTEFNRTMuMTAwqqqqqv/7EMTlAcJAEUnGMeAoLoJpuLYEFKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqjQAAABWHpJWVawACtQ6Yp1MQU1FMy4xMDBVVVVV//sQxOGBwWQNQoY9YCAsAihQxawEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVWAAAAoBIFQJYcX1UxBTUUzLjEwMFVVVVX/+xDE4AHBgA1Ah72AKB8BaJDGLARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVXCAQAAAAAA4GyRY0NlTjf/5362Fc93KTEFNRTMuMTAwqqqqqv/7EMTgAcE0Cz6HvMAgKQGn0PYkBaqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqq//sQxN8BwTQLOQesQCAhAaeQ9IgEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDE3wHBRA04h6RAIB2BZxC2CASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EMTeAcEoCTEGPAAoGYFmIMeEBKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sQxNuBwPAHKqYcACgMASVCkgAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDE4YACzBk0mYAAAAAAP8OAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EMTWA8AAAf4AAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",Y2="/assets/bonus-CvVo342Z.mp3",K2="/assets/bubblesLoop-B_LY362Z.mp3",Q2="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAHAAAH8ABjY2NjY2NjY2NjY2NjY5SUlJSUlJSUlJSUlJSUsbGxsbGxsbGxsbGxsbHKysrKysrKysrKysrKysre3t7e3t7e3t7e3t7e3u/v7+/v7+/v7+/v7+/v//////////////////8AAAAeTEFNRTMuMTAwBJwAAAAAAAAAABUgJANtQQABrgAAB/B6uTQrAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uwxAAABAgDT7QAACIImOq/MPAAEJBsURDiAAEUBBwIGMEwfNqOB/lKwffKBj+IMoCGJwQmJJWiaVAVBQwskybYBAAAY8mQzeGmHtSaXBy2yKgEkRsibBi3wOGaBGYZPx1okZ53oIk5dk6cA9RSxkJaXahNQ5C2F5WklAbHyfUx3rZ5LKsYXJdSNdDHVLu8B46uyn6pE8OmLHm2qGNUQocvvmmHVL0zvzqW0eHCeeUsxUlA7P39Cs1jJVY1EKWbbhgiQiX6wiPAWU1AApZk08REEoTmCh652bI4C8N40VsJMQ1DzqOd+1+bL/MjxkORqViL86shsxVl2KsI2ujQVC87XDhZD0E4qdOqU/1fRcPNsiseRoFbP2yumR2kY0djbG0v7Q3PLPIbWoFZl/IqHGSSmn8JgeQbVlzBjyNcfeK4s4RY2bV1W1Ib+Pv/w/TGqatTeX7fmABrK38xETIRACEm3QE0SFLFuVZRMgtCqisKyoZ3kin58iaOSqIculpxtPd/6cTf+ktz3OnvyLDKbeX/16pF6d8IUGHQEPNlVOYTkko66Jxhgqq/L1XpkDJTQxJSKToCx1QZCJDQqD0CFk5RtERSkojVt06ns8pWEc1O6g9RT2I5nKGUghNIgm+mzNBN0GBa20LmURYs3dopwomTPuxfMt73nElqpyrtc1Z1RRAaSkwHbB6wSLikGUSIqSnEStIhkahAz2KXOxV1nb8I+CapoNFnlRERljohLG2rOsfbiJYiAKxqBeMERZ8aVro6yTUsJWxUwu53Z5ljBNROQARCYAqDhVkGSgUHkJ5BMUisnaT7gquejBTI4OAAbJv/+3DE3QAURTlh/YeACUYZLrzzDcwliqC4mNiJQCfDS99qMbryA54qW+ii7ZkZlQyBkl9AZnNMB8NAOicSzNKZa+FGAdr+ovEOMbBe9dq3FX7cRbm1DRvLBeSLXdP//9RpjHQzxTdJfo//3QuAKGZzEJy7AAiURgPywUWFIjNsJzXIESDEAphNO0z2YiwwFl3XoCpyhR4RmnnWHzxG0Ywcm59YlMF82DSZw7EogqSAAWuISoVDyEuRLIxThCiircUsheFPYaYG86iSivs+K/XIoyviu+zGnf//zi5MQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqgJZq8BUKgi+IweMHBVwVsI1BWeBaJXdSxgdlXc7LUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVV//tAxPUACiEtdeSEWWEyjO38FIw0VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+zDE9oAHuE1p5JhqoP+GK/yGGJlVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+yDE+wAHdFNd4CRBwNEGKjwApAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQxOUDw7wXOQABIEAAAD/AAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+xDE1gPAAAH+AAAAIAAAP8AAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",X2="/assets/conveyorLoop-CF-OA6qJ.mp3",J2="/assets/conveyorStart-CcCK4MGd.mp3",Z2="/assets/conveyorStop-D5zeg8cv.mp3",eF="/assets/destroy-CZDN4Ktz.mp3",tF="/assets/detect-D_kRR5uD.mp3",rF="/assets/fanfare-B9AO3n4y.mp3",sF="data:audio/mpeg;base64,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",nF="/assets/headFall-rxdxTCeK.mp3",iF="/assets/headJump-GCHlCfni.mp3",oF="/assets/headWalk-B5kQ4tvC.mp3",aF="/assets/heelsFall-IsGtipMw.mp3",lF="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAMAAANvQA8PDw8PDw8PFFRUVFRUVFRYGBgYGBgYGBtbW1tbW1tbW2Dg4ODg4ODg5SUlJSUlJSUpaWlpaWlpaWltra2tra2trbFxcXFxcXFxeTk5OTk5OTk5PX19fX19fX1//////////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJAP3QQABuAAADb3ce6y6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vAxAAABqgBabQAACL+Jyq/M5AAAATd0rslm3BwuD4PvKAgCEMYIAmD4Pg+fiAEDivB//BB2CYP8EPlHQfB8PygIfUcwfD+CAYAAU4EERahmVG1qTLSTRQACHQxwMcMsQaNBDJykQAnheOVsEjpbtBSluhY8aLnhkR3SqInu5pvluoCGSNeIPEP7PIsMVAof8vqJIx+WjoAGziDvEiannoTqQJv+0KPDobqTKkIbRlSwicofK9BcD9jj2flFuRxqG4IZpVoIx+cf3jH3bymJbbxuRDmnwwrxLmpba+3O/ErHaWc5hR9j1FX+EfSxTtJf5Xw7U3zPLtX93P13n8q0H8rc1fcf/2L9C1KBFc4gxM3ZCYJmGinxCyQF6IUdQ+jRISyQlcGwEOLFUWAlRJGCxiiZGykUUUVOsZRsxqgbLdYXQljEukqSpKi1RH0CbCYiMlaKRuVF4rBUmhlRRMaI9x4osiymzPfWyRkizL17nqukpI37b1Ge+cSSMm1qSMlXb1mySRvqU6jZJX5hhAoPEGrCrl7RMBc4xmIkmS2dx0kvlSGcyItAQ7CyS/Im6bufIFqiY2tBakdJ/EMFq2Y8EqwmDkowf3YIWW1NR58qp/W7OkvEWr123iWK4i96wY5eleVa7basASy6Q4hZ3I4etRFgbWA2XHZiHG+y+QF2HYI4TiV1JEWkxrXwwxLraLURInnGvIxrj7qZAZf79rQT06eVSprKvhjzbStl/25YYBkc4lld1tgADlzyqygh+XOi5b8cqWXJOiCP7izoTNBbakKzalazLiaPx0MIQUFDj5qZnDbNvW2IU+d2jMC5bmOa8HfWbaEuoX7/ofcHaTKCaoIKVk2lFU+TQADpM9RDdyAlEXAlK6OnRKRHINRFtwMUFl3Ww9da+P2qv+f9wJyyJoxE4yTEFEzrrqIhw+nan+4Rr4+fSdsUW2CB/VrcgGS3iLl3+/+YAKdlIf/+2DE6IAQdVFb/PaAKUGVLDz0HfSlDIIgrA4H92yr5cAuKkFkhW7a1rZDWricNKm+oQmq25qlRr91S79meUexMW6rst5aLH/u71fzQAASKHmP0cFUb7VH5vUUppI9RQrVs0alF94d2ECivnfDHRKkw9EiSy+l0e9T0ZWd9/+VdAkigRcGdFAl0okAoEAYAGo0SOObDj4QAiD0ej4AgBlyt9sGDiq7XKjYyg9chwAXABM+F9A2wiAZ2BFwwv6A8DLkTGIKBDZQJ/qw48QoSwtg54XyHPC5AKQRD8+M2TQ4BKBASSJMTwOk2E8/zcn0jQuNEZFAQmFpEaFknP+ybn0GZOVxKBb/+0DE9oAKEM1b56BxoUaZ6j2HoHzIsM2LgLJoOP/+yC001MhOmyJkTpkiXjUC/9Px8VpHYGaDBR8uiAKF8r1kDRHDX4oVTRp+YZj9/B+amUqE46DOi2iMgeRvJRI0UbIol0GwSzzNFnNjzwVsLijM2QdMjvDbESjW1pamwzi0XV5/MiX/mmkX/6G5mv9B8w8lZyVnElvL/WTmDRAgheNxEAEpQIGsN80TuDtnMlnLCfqHrw9W6v/7MMT1gAmoqUvsMWkg9hKqfPYcfN6tr/F+M71h8j3JG2a6y9rzqELFmDWmPrNcwiQ3x9Yx5d7yYJeaTwdV93Lez9HjRkfpuBZ9+T4gf8k+Ofwyb/wZcF/jSPK0VRZQmIIVTzbNFgy35L0whBPTi0mVYsmen3JU+67Wsf3+vqmmtSMcfb6BjyXvzl3rN6V+dzRCgGviO9U/CAFSYf/7YMTzgAcggUW1gYAijidqvzUgQMuLnVQWVPiV9H5VjRT+l4F/loQ7f2y/1//HSPI0C6Arwaur2vcIA1LBQ1CmHEbm/92uTTvv7VilrsRcXsK1podo2HzUrH28/H2+s2xDoV7j4OrbvFiq45nCusWz8+uDvOmIzTwab00QnIdiifcX+1rm//wUyqAZ+Y55mmFp3cW+r60EQodkND92jYAHly9vYGehmTdM7jmwO2uF1uEPasNO/xbMbdfbC2q3jC4RpNQZtty5YosXMHWHuWZnGnLj3xjbbDzokInKmkiNVQwC2u+qOiCn+WaVJAHULvSc1/1e5YSQGimpk5emQAJmsIhLFf/7UMT9AAytA2H9hoAhkyVrfPOLzJ5Dq4L0DQ7J62Vxt8JluDcoVZzyxqZ/vK7D0v3Vy3vmW98ZlT8pHDMyplRSBo1RDRa19VLISV72ThYEndXbNx8RnOPmsqocxH+YuO3/+Q5K3pUdP/A++awgAFaY1HlRQE1pyZC4MNyGrFsX1Rk4g8uOQDy8migDCo2qNSQJkdzViTxUPc1as8PHZeyNmD329Pyw+W2dr28AAACXPUDhVn4l8Krv/KY7A1uJOFqxOElu6aP/XB4yPrLtiJn/+1DE9QALhSth56y6YZKdKr2HofzIIFy1rTeWqGGuSgIXr6P3ff/22dn/6/QqeAmgqWaTeECCoYEAIAAAAFx64msnKFFjiqafYSTbc7jgMvUbJcvn2WWYebpAZ1KBr1dlseUBqw4bKBhRfoGjmgWVgZAIGFBc/f8G5geoRACwMPQ//C6gWcHqE4JzEYf/44BZZsaDliC4yf//5qQMiYsggh4Zgihp///5EzhcK9Zd///B8PA+CAADH////0gRAAPWKgvFMiPaNosABEAHoAl0//tQxPIAC+TRTew9TeGBnWi9hJ8MSKp0muQGavaZwAYYcqcx4NWwzRUyBVtEChJaWRYSccwPwYGPXRGDgriBR0rsBHi4miGPAaDyCpmAyZmwBGiik74hC1I0kNEgq0+y0YFAQVFhpSX9SsFcooM3eyd5LciIoQXmEASMEoABlYV0/ADR1PU+P0cRUY/SZLkBAmw2bgB3uSmFZaoKeSPi/FXCCp1cESzkj+R2rWhqnz5q9Tf+qb/1yd39yD3Qy+MyyNy2rlF9Svf8nZnuvqXrH//7QMTvgAf0oUesNKzhBg3n9rCwBPq3U//3dpu3LwPSVTb6tbitOoA2ukN5JkSUlAYEHAkImfuZKXlcalg2WtxgSRyynjiOaVCSKxNdDDxfaS3FUFgWr/1qggwvnORt7jEkVEEK3/fkP/u2Vb/ouhP9cs7yMQ/PWeppkGmHU1dd1YgNOQoHEnhLKEyJ4q2cuajZ1ezv45cQpiPGANEEFppumtSaaA7BL2rOpvbQ4sUXetNNabGJ//uAxP8AEdUxU/maAEN8KSq/NbIAoaDkBwDWbz5s6epY8E1piGSZRghd6ytqAzpb/qd0zMna/6HX/6noGC9vzqDiKkYFYKYBUCQBUFBAGAwAAADvUU0NTsnI/zOjRFNNZI7/EV6cC3lMf9MQEvCS4LEcRMLC6P3JYepIl0TIdxfC6+XhxDGNZNJUT4yNvuXR7D2TOf/pGJqTVP//zpdJFJR1EW/56W2KTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+1DE9AAKYOtn/YUAIamnrD6e0AWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sgxPKADKDVUfmWggAAADSDgAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==",cF="/assets/heelsWalk-Bmk6WOTI.mp3",uF="/assets/helicopter-BYGzJTF2.mp3",hF="data:audio/mpeg;base64,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",dF="/assets/hushPuppyVanish-CZOUg83F.mp3",fF="/assets/iceScrape-DBKqqA21.mp3",pF="data:audio/mpeg;base64,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Jua1SIdWdaWZ7+3Z7eWYEQU4VAXcl3izAQDAQCAYEA7wGviBAo+OjXyI6D38AUeGw29Qd//7CoAYEAQDAQEAAAAAAgItfBWiR8eJV4CgD4FUv4iYy//7cEToABISJVfR7Bm6P0J6/THoCwhwmV9MMGWhBg+r9YYMdP4kHg834qd/10xBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+2BE7wACPypWbTygCEPFSr2njAED8E04mKOAAJsMJ7MaUABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+xBk3Y/wAABpBwAACAAADSDgAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",mF="/assets/jetpackLoop-0RyqqDBh.mp3",gF="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAEAAAHVQCSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpK2tra2tra2tra2tra2tra2tra2tra2tra27e3t7e3t7e3t7e3t7e3t7e3t7e3t7e3t7f////////////////////////////////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJATpQQABuAAAB1VdJF2gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vQxAAABxQBZfQAACPjQav/MUAAAAEShDM7J7pnHA+fECjgDPlAfB8Hz5c+UBDg+fLh/6gxigIf+D//5c35QEHFwfeIDmD8uH///+CAAAkwmpRB0hs1kTclhaJSJjSFpGr7DzDheqXqq6EC8wWUHFZcuhXpdpduxAAvg2bLwYzAeCD9B9B8YRFABSQBgopAZoh47yaIiO4MgihA6YQuOwdBJigxPAog4yGkSJ4iRASySgncgRuxTWo4ekDL50jRgjklIlSVIcaFIxLxGE6RNKT5EikdMDpwiw7i8XCdJshhFCoyZmmWC8Ym6loMkRqEvIIGaZHIktYyLhoaHGOqMECbMluYsWDFZ5EpIqdu6SzhbROF8mygThoZpHDQgZMn0zBZDjpiampeLJmaKU6jWaT5QJg6cIkVCJrKDU////7If///5maqA0aFdlVa5E0QslGN4UBj7Kg9SmJ+lC/GOeJ1JVVRg+AKHzAtEguIqRd5otUltoPNZlypGiIcNo7ZB+OFho4WvaYqPWomGkZbTxPqk0090dVfSxawrTNPxbLHx6VHTLXPX/1Es6RMMs/P/vfz/czLW/W6H3U/FssTCTLm2AJHBCCcIysaPY400CQEOIkKwDK4ehyIqsdWUTY8nCsxBUdeIkszUXA7ebUglyQaNlgKCs6WDSbizxK4We0t90JPcwRXaFg0pVNnv8f7PnRgNKyx5HtW6AYQZXiFdCcckjTXx8lxfljcC8s5YYyhYZHNILmd8LEBLVzUzyMyRkU0NhIiUOLBVLRzjz0A4jCQOyx4JNSLOTET89YxvCS5IW2uZ0emWsQx+8CwVvPFkqBoCB2SlWUWERlOzNugAAAABajznzQcoBnPkxJEqqceWTHEY7UxwMAAt4yYMFh8uRwkFB+pskpBDQMUwj7JSQY5n8daUxWqIfR0mU3H8o00yry0km1XMcRSsQmvVKGqalYFn3OB0uocR5CrCa4ahVCzTD528xf534Vv7WzX////1rnNNe+Pmv8lbZ////xv+lsY3m+d+2dQdW/9t////4+M/Xzjy+2961v/7r64rjdszVkf/8x//XVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVf/7UMT+AA/lk3H89AApUonsvPYYaFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVapFiGAAEwNgPCMqZWrToKnYlHncN/ywcET4iUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+3DE8YAK+Fdd9PGAAtayKn8y8EhVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQxOODw1gRMTzAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",AF="data:audio/mpeg;base64,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",yF="data:audio/mpeg;base64,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v//7MMT6AAkw+XHnmEzhKJ8stMSJdSs8K0xBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7QMTzgAkcVW/mFHChNZWsvPQNpFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxPiACES5ZeeUbmEPGqv+nnAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQxPKABxyHT7jWgAAAADSDgAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",qF="/assets/metalicScraping-BqmM5ys4.mp3",xF="/assets/mojo-D9S1pz9n.mp3",bF="/assets/mojoTurnSound-D3oZPBXv.mp3",wF="/assets/blacktooth-BYOHC98e.mp3",VF="/assets/bookworld-6NK6AVmt.mp3",vF="/assets/egyptus-1cZoCvzN.mp3",_F="/assets/market-BENMZ1qq.mp3",SF="/assets/moonbase-CP-4ct6I.mp3",kF="/assets/penitentiary-UL09l0n7.mp3",CF="/assets/safari-DLrXdFuZ.mp3",EF="/assets/robotBeepingLoop-Cz0TGwJH.mp3",TF="data:audio/mpeg;base64,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",PF="/assets/rollingBallLoop-BUA084C_.mp3",RF="/assets/servosLoop-Bn-haKck.mp3",MF="/assets/servosStart-BgsySGJF.mp3",IF="/assets/servosStop-BR1i0gi5.mp3",jF="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAADAAAF6QCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqrn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+f///////////////////////////////////////////8AAAAoTEFNRTMuMTAwBKUAAAAAAAAAABUgJAV6QQABuAAABel6uP7WAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vAxAAAB9gRZfRgACKqmyl/OYAAAAACI1hbN7r+CemAgACCCAZB8Hwfh/WUBAEAQdggCBcP8Hwf/ggCAYqdlAfD/5AHwff/1AMHwfD8EAQd+CBwAABI1kyRERCWqKVtkgAAA42djFAiNzBQIMQVI5g8aESdUUGkKkOYLCLOCAIGDwArAKAEs8YnDjqLFfhp8lYiODUwghOhrcCurDOSqLUCcyJMM6gPOkeWXTqE5Dk8TaQBI4eiVFWfSch+awwo7sVp5ZG/mv7elVHPw9ekbceU0ip6acrW8MM7E1S3dc1S4WsOZR6/rlcJg4Lzjq0lgLOVCDBIs9nWE0JGbalKA4KIWpSZSJSZv5tDYAAAAPtilTj7SsKZLpm1EpwZwFwYMrkoFPLeJQBYhjQGt9ThSgC2YBdx6EqWEliGKgWRZVRkPUOUCVVR9iyo4vy5gkvMUt5IxbiFNJ+KZrVapeSTt+LVkz6x6PN18lcyxY2czxs41/S+cZ39/+vvPJC7Ve/tEClDL/+CxV6RzS3//SIQDni4i2eXeVYLhGAAAAAAAfmqMy0mLmhWDlAyyLqppdsjlLcX8YA2k7EnTAJDPLFYTz4nr46zX4cZMGHUOZmZabfv0bK7MqAhh4bf1UxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+2DE7gAR8MtP+beQATGN6z8ywkBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+xDE1gPAAAH+HAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",OF="/assets/spring-CP3uOhml.mp3",NF="data:audio/mpeg;base64,//OAZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAADAAAErwBDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0PKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr///////////////////////////////////////////8AAAAyTEFNRTMuMTAwBG4AAAAAAAAAADUIJAL7LQABwgAABK//PX1CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/zkGQAAcwDIACgAAAAAAP8AUAAAP/////////8pD6nHC7yChYKxXdLXLLlcpVcZRKfNIh3joGTm+AAOhvljbRkUtWRrLKfwzRbh9MTGzzP/7BT6LoXH//vG3L5icqgAEIwyGpkSP5f9LCJ6HHUlfbAJYmDMBYOFzaizvh1veOO8cauf4f/f7TmWIOil+DQJftXDPAMIaNZ/X///lQQ45kPMEWZFmWKQgeHHUlZKLNqtNMVCz4KJTUMwq6AiE0ukL1iLKAiZokGW/ypt41ast1Vx7hvt/mcvqc5n3/+BRZmY4UvwzxYCBjREFMkv3LUtX+zgMFFBUyofH9Sr/y/9fjjrLKx/P/z4GThI33zdy/F6JBFQ77e/5jSQO3bcXw+KV+93n3du/zMaAsOSQApEeTGkNFWALiDZnQxIxVqar4ZgpCUJAGUJfJ6tO3jS/jW1KpdbawqaQiIihLZZK5VKXTKXCmv00y1vGxeaWSpx+tLAesCj/GDpc7hl3JhyxKT3jk8lp+DnAAYCMedrU1M8lukvAqaOgEywc4/8tVopLI/FxACHQYRlNCLM0iyy1/yeOuPCoy09e50Wh7CBMvNSgIqpjkxiqm/7/5fLKe3/56sWDKGx4kn214uwHD2QJpgYjl394///Xt2JXPw5H377dl9qlMiNV0EgzNCzmoTEiDeBiIUalUdokZsGYI4BjO8f//1l+sv+XxepYou2LH/z/7zNRYgDDAExYEOGruSrIhMPSZ/14K4eIVAqM//7/LL//////P/53DXM8////v///BTWIQztkEBiwQGhV/N+79JlLKSSVaSxabqH4dniAqgezyMJYFQVUDQwGioK8RA0CoKgry0FVgqdLHlA1BUqGs6Cp3EriJU6JQ1BpQNHip0ShqDRY9Ue4KlQVd/yx4RPWdgrUeUegrBVwiPCIOwVWCrix4RYiUHZVxUFYNKDv4lD+YjkSQaDiUq4RLDYlO4iDqCx4Gnhoso9UeDuIv1xEo9nuCv+CsFfy3UeT/8GlB1TEFNRTMuMTAwVVVVVVVVVf/zgGSlDKADQ4/gAAAL8AZZvcAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",BF="/assets/teleportIn-DZAhHW9-.mp3",DF="/assets/teleportOut-Bra-ABlh.mp3",zF="/assets/teleportWarningSiren-Boo1HoAB.mp3",FF="/assets/toasterPopUp-CNfTxQPs.mp3",LF="/assets/woodScrape-I7O79-d2.mp3",BV={bonus:Y2,bubbleRobotLoop:K2,carry:Q2,conveyorEnd:Z2,conveyorLoop:X2,conveyorStart:J2,destroy:eF,fanfare:rF,detect:tF,drum:W2,glassClink:sF,headFall:nF,headJump:iF,headWalk:oF,fall:aF,heelsJump:lF,heelsWalk:cF,helicopter:uF,hooter:hF,hushPuppyVanish:dF,jetpackLoop:mF,jetpackTurnaround:pF,landing:gF,metalHit:yF,mojoLoop:xF,mojoTurn:bF,robotBeepingLoop:EF,robotWhirLoop:TF,rollingBallLoop:PF,ballHit:H2,servoLoop:RF,servoStart:MF,servoStop:IF,softBump:jF,springBoing:OF,heavyMetalScraping:qF,switchClick:NF,toasterPopUpSoundUrl:FF,teleportIn:BF,teleportOut:DF,teleportWarningSiren:zF,iceScrape:fF,lowHum:AF,woodScrape:LF,"roomEntry.blacktooth":wF,"roomEntry.bookworld":VF,"roomEntry.egyptus":vF,"roomEntry.market":_F,"roomEntry.moonbase":SF,"roomEntry.penitentiary":kF,"roomEntry.safari":CF},UF=t=>t in BV,$F=Te({x:-2,y:-2,z:-2}),GF=(t,e,r)=>{if(e&&rp(t).some(n=>n.type==="player"&&n.config.which==="head"))return"fanfare";if(r)return;const s=`roomEntry.${t.planet}`;return UF(s)?s:void 0},HF=(t,e,r)=>{if(e.soundSettings.mute??es.soundSettings.mute)return;const n=e.soundSettings.noRoomEntryTunes??es.soundSettings.noRoomEntryTunes;if(n)return;const i=GF(t,r,n);if(i)return{id:"roomEntrySound",type:"soundEffect",fixedZIndex:Ir,config:{soundOptions:{soundId:i,gain:.3,playbackRate:1.2}},aabb:ee,castsShadowWhileStoodOn:!1,state:{...Ge(),position:$F,played:!1},noSoundPan:!0}},WF={x:-9/12,y:-9/12},YF=Te({x:9/12,y:9/12,z:1}),Hy=(t,e)=>{const r=`${t.position.x},${t.position.y}`;let s=e.get(r);s===void 0&&(s=new Map,e.set(r,s)),s.set(t.config.direction,t)};function*KF(t){const e=new Map,r=new Map;for(const s of rp(t))switch(s.type){case"wall":Hy(s,e);break;case"door":Hy(s,r);break}for(const[s,n]of e.entries()){const i=n.get("right"),o=n.get("towards");if(!i||!o)continue;const a=U(i.position,Pn(i.config),{x:-1});if(r.get(`${a.x},${a.y}`)?.get("right")===void 0)continue;const l=U(o.position,Pn(o.config),{y:-1});if(r.get(`${l.x},${l.y}`)?.get("towards")===void 0)continue;const c=i.position;yield{id:`extraCornerShadow-${s}`,type:"blocker",state:{...Ge(),position:Te(U(c,WF))},shadowCastTexture:{textureId:"shadow.wallCorner",spritesheetVariant:"original"},castsShadowWhileStoodOn:!0,config:me,aabb:YF,fixedZIndex:Ir}}}function*QF(t,e,r,s){const n=Ln(t.items);for(const[i,o]of n)o.type==="player"&&!s||(yield*Jf(i,o,t,e,r))}const Xu=t=>{const e={};for(const r of t)e[r.id]=r;return e},ud=({roomJson:t,roomPickupsCollected:e,scrollsRead:r,isNewGame:s=!1,userSettings:n})=>{const i=Xu(QF(t,e,r,s)),o=HF(t,n,s),a={...Xu(G2(t,i)),...i,...Xu(KF(t)),...o?{[o.id]:o}:void 0},l=new jV(Ot(a));for(const u of Ot(a)){const f=Ts(u,l).find(d=>Qr(u)&&Qr(d)&&!(u.type==="wall"&&d.type==="wall"));f!==void 0&&console.error(`in room ${t.id} item ${u.id} @${JSON.stringify(u.state.position)} #${JSON.stringify(u.aabb)} is colliding with (solid item) ${f.id} @${JSON.stringify(f.state.position)} #${JSON.stringify(f.aabb)} on loading room ${t.id}`)}for(const u of Ot(a).filter(Ms)){const h=L2(u,Ot(a).filter(f=>f.id!==u.id));h!==void 0&&Zf({above:u,below:h})}return{...t,roomJson:t,items:a,roomTime:0,[Ht]:l}},Tr=(t,e,r)=>{const s=t[Ht];e.state.position=r,s.updateItemSpatialIndex(e)},XF=.5,JF=(t,e,r,s,n,i)=>{if(Fn(n)<1e-4)return Object.assign(i,ee),i;const a=S_(n);if(!OV(t,e,r,s))return Object.assign(i,ee),i;let l=-1/0,c=1/0;for(const u of T_){const h=a[u];if(Math.abs(h)<1e-4){const x=t[u],V=t[u]+e[u],_=r[u],w=r[u]+s[u];if(V<=_||x>=w)return Object.assign(i,ee),i;continue}const f=r[u],d=r[u]+s[u],m=t[u],g=t[u]+e[u],A=(f-g)/h,y=(d-m)/h,b=Math.min(A,y),q=Math.max(A,y);l=Math.max(l,b),c=Math.min(c,q)}return l>c?(Object.assign(i,ee),i):c>0&&(l>=0||c<-l)?Np(i,a,c):l<0?Np(i,a,l):(Object.assign(i,ee),i)},ZF=(t,e,r,s,n)=>JF(t,e,r,s,n,{}),eL=(t,e,r,s,n)=>{const i=r.x+s.x-t.x,o=r.y+s.y-t.y,a=r.z+s.z-t.z,l=t.x+e.x-r.x,c=t.y+e.y-r.y,u=t.z+e.z-r.z,h=Math.abs(i)<Math.abs(l)?i:-l,f=Math.abs(o)<Math.abs(c)?o:-c,d=Math.abs(a)<Math.abs(u)?a:-u,m=Math.abs(h),g=Math.abs(f),A=Math.abs(d)*XF;return m<g&&m<A?(n.x=h,n.y=0,n.z=0,n):g<A?(n.x=0,n.y=f,n.z=0,n):(n.x=0,n.y=0,n.z=d,n)},hd=(t,e,r,s)=>eL(t,e,r,s,{}),Wy=(t,e,r,s,n)=>{const i=e.state.actedOnAt;i!==void 0&&(i.roomTime===r.roomTime?(t&&(i.by[t]=!0),i.actedInXY||=s,i.actedInZ||=n):(i.by=t?{[t]:!0}:{},i.roomTime=r.roomTime,i.actedInXY=s,i.actedInZ=n))},tL=(t,e,r)=>{const s=(n,i)=>{const{collidedWith:o}=n.state;o.roomTime===r.roomTime?o.by[i.id]=!0:(o.by={[i.id]:!0},o.roomTime=r.roomTime)};s(t,e),Ms(e)&&s(e,t)},rL=(t,e,r,s)=>{const n=Yf(t,e,r),i=hd(t.state.position,t.aabb,e.state.position,e.aabb);if(n&&i.z===0){const o=jr(s,t.state.position),a=v_(o),l=nl(i,o)/a;if(o.z=0,l>.44)return ZF(t.state.position,t.aabb,e.state.position,e.aabb,o)}return i},Li=.1,ur={id:"sensor",aabb:{x:0,y:0,z:0},state:{position:{x:0,y:0,z:0}}},rn={id:"sensor",aabb:{x:Li,y:Li,z:Li},state:{position:{x:0,y:0,z:0}}},sL=5/12,nL=6/12,iL=1,oL=1/12,aL=0,lL=1,cL=2,uL=3,Ju=4,Yy=.75,hL=(t,e,r,s,n,i)=>{if(i.length===0)return;const o=t.state.position,a=rr(r.x,0),l=rr(r.y,0);if(a===l)return;const c=jr(o,e),u=__(c)/s;if(!rr(u,0))return;const h=t.state.standingOnItemId===null;ur.state.position.z=o.z,ur.aabb.z=h?Yr:t.aabb.z;const f=a?"y":"x",m=i.some(k=>k.type==="doorFrame")?oL:h?t.state.vels.gravity.z<0?nL:iL:sL;ur.state.position[f]=t.state.position[f]+(r[f]<0?-Li:t.aabb[f]),ur.aabb[f]=Li;const g=Dl(f),A=m*t.aabb[g];ur.aabb[g]=A,ur.state.position[g]=t.state.position[g];const y=(k,C)=>{const E=C===t||!Qr(C)?aL:C.type==="doorFrame"?lL:Yf(t,C)?cL:uz(C)?Ju:uL;return Math.max(k,E)},b=Ts(ur,n[Ht]).reduce(y,0);if(b===Ju)return;rn.state.position.z=t.state.position.z-1,rn.state.position[f]=ur.state.position[f],rn.state.position[g]=t.state.position[g];const q=Ts(rn,n[Ht]).filter(k=>Qr(k)&&!(kl(t)&&Vy(k))),x=h||!mm(q);ur.state.position[g]=t.state.position[g]+t.aabb[g]-A;const V=Ts(ur,n[Ht]).reduce(y,0);if(V===Ju)return;rn.state.position[g]=t.state.position[g]+t.aabb[g]-1;const _=Ts(rn,n[Ht]).filter(k=>Qr(k)&&!(kl(t)&&Vy(k))),w=h||!mm(_);if(b===V)return;const S=b>V;if(S){if(!w)return}else if(!x)return;return{x:a?r.y*(S?1:-1)*(r.y>0?1:-1)*Yy:0,y:l?r.x*(S?1:-1)*(r.x>0?1:-1)*Yy:0,z:0}},Ky=void 0,dL={x:-1,y:-1,z:-1},fL={x:-.6,y:-.6,z:-.4},pL={x:-1,y:-1,z:-.4},dd=({subjectItem:t,posDelta:e,gameState:r,room:s,deltaMS:n,onTouch:i,visited:o=new Set,forceful:a=wV(t)&&o.size===0,isHelpful:l})=>{if(Dd(e,ee))return!1;let c=!1;const{state:{position:u}}=t;Tr(s,t,U(u,e)),o.size===0&&Wy(void 0,t,s,e.x!==0||e.y!==0,e.z!==0);const h=D2(e,Ts(t,s[Ht]).toArray());for(const f of h){if(o.has(f.id)||!sp(t,f))continue;if(Wy(t.id,f,s,e.x!==0||e.y!==0,e.z!==0),i!==void 0&&Ky&&console.group(`handling onTouch() callback for ${t.id} touching ${f.id}`),i?.({movingItem:t,touchedItem:f,movementVector:jr(t.state.position,u),gameState:r,deltaMS:n,room:s}),i!==void 0&&Ky&&console.groupEnd(),s.items[t.id]===void 0)return c;if(s.items[f.id]===void 0||!Qr(f,t)||!Qr(t))continue;const d=Yf(t,f,a),m=rL(t,f,a,u),g=rr(Fn(hd(u,t.aabb,f.state.position,f.aabb)),0);if(d){const A=a?dL:sz(f)?pL:fL,y=Gq(m,A);if(Tr(s,t,U(t.state.position,m,y)),o.size<pO?(c||=dd({subjectItem:f,posDelta:y,gameState:r,room:s,deltaMS:n,forceful:a,visited:o.add(t.id),onTouch:i}),o.delete(t.id)):console.warn("hit recursion depth limit",new Error),s.items[f.id]===void 0)continue;Tr(s,t,U(t.state.position,hd(t.state.position,t.aabb,f.state.position,f.aabb)))}else Tr(s,t,U(t.state.position,m));Ms(t)&&m.z>0&&e.z<0&&(t.state.standingOnItemId===null||!h.includes(_V(t.state.standingOnItemId,s)))&&(ad(t,s),Zf({above:t,below:f})),Ms(t)&&!g&&tL(t,f,s)}if(Ms(t)&&!c&&!l){const f=hL(t,u,e,n,s,h);f&&(dd({subjectItem:t,posDelta:f,gameState:r,room:s,deltaMS:n,forceful:!1,onTouch:i,isHelpful:!0,visited:o.add(t.id)}),o.delete(t.id),c=!0)}return c},fd=({state:{position:t,facing:e,autoWalk:r,action:s,vels:n}})=>({position:t,facing:e,autoWalk:r,action:s,vels:{...n}}),mL=t=>{let e=2166136261;const r=t.length;for(let s=Math.max(0,r-9);s<r;s++)e^=t.charCodeAt(s),e=Math.imul(e,1540483477),e^=e>>>15;return(e>>>0)/4294967295},gL=1e3/25,DV=t=>{const e=ct.animations[t],r=e.length,{animationSpeed:s}=e;return r*gL/s};DV("bubbles.white");const AL=DV("head.fadeOut"),yL=({touchedItem:t,room:e,gameState:r})=>{In({room:e,item:t});const s=Az(t),n=t.type==="pickup"?{type:"pickup",gives:t.config.gives}:t.type==="hushPuppy"?{type:"hushPuppy"}:{type:"disappearing"},i=Qt(Qf(t).aabb,.5);for(let o=0;o<s.x;o++)for(let a=0;a<s.y;a++)for(let l=0;l<s.z;l++){const c=`${t.id}/${o},${a},${l}`,u=Wz({itemType:"bubbles",config:{style:"white",was:n},position:ee,room:e,gameState:r,additionalIdPart:c}),h={x:o*W.x,y:a*W.y,z:l*W.z},f=U(t.state.position,h,i);Tr(e,u,jr(f,Qt(u.aabb,.5)));const d=mL(c)*.5+.75;u.state.expires=e.roomTime+AL*d}},qL=(t,e)=>{const r=Ot(t.items).filter(hz);for(const s of r)yL({touchedItem:s,gameState:e,room:t})},xL=(t,e,{changeType:r,sourceItem:s})=>{switch(r){case"portal":return Ot(t.items).find(n=>_s(n)&&n.config.toRoom===e.id&&(s.config.toDoor===void 0||n.jsonItemId===s.config.toDoor)&&Dd(Qt(s.config.direction,-1),n.config.direction));case"level-select":return Ot(t.items).find(n=>_s(n)&&n.config.toRoom===e.id&&n.config.direction.z===0)??Ot(t.items).find(n=>_s(n)&&n.config.direction.z===0)??Ot(t.items).find(n=>_s(n)&&n.config.direction.z>0)??Ot(t.items).find(_s)}},bL=(t,e,r,s)=>{const n=1*W.x;Tr(s,t,U(t.state.position,Qt(e,n)));for(let i=0;i<n;i++)dd({subjectItem:t,posDelta:Qt(e,-1),gameState:r,room:s,deltaMS:16,forceful:!0,onTouch:void 0})},wL=t=>{const{playableItem:e,gameState:r,toRoomId:s,changeType:n,sourceItem:i}=t,o=r.characterRooms[e.id];if(o===void 0)throw new Error(`${e.id} is not in a room on the gameState`);if(s===o.id)throw new Error(`Can't move ${e.id} to the same room "${s}""`);let a;switch(n){case"portal":{const{config:{relativePoint:m},state:{position:g}}=i;a=jr(e.state.position,U(g,m));break}case"teleport":{const{state:{position:m}}=i;a=jr(e.state.position,m);break}case"level-select":a={x:0,y:0,z:0};break;default:throw new Error}const l=e.type==="headOverHeels"?void 0:r.characterRooms[qn(e.id)],u=ew(le.getState()).rooms[s];if(u===void 0)throw new Error(`room ${s} does not exist in campaign`);const h=l?.id===s?l:ud({roomJson:u,roomPickupsCollected:r.pickupsCollected[s]??me,scrollsRead:le.getState().gameMenus.gameInPlay.scrollsRead,userSettings:le.getState().gameMenus.userSettings}),f=dz(e);if(f!==void 0){const{carrying:m}=f;m!==null&&(Mn({room:o,item:m,atPosition:e.state.position}),f.carrying=null)}if(In({room:o,item:e}),e.state.latentMovement=[],e.state.previousStandingOnItemId=null,e.state.standingOnUntilRoomTime=De,(e.type==="head"||e.type==="headOverHeels")&&qL(h,r),h.items[e.id]!==void 0&&In({room:h,item:e}),Mn({room:h,item:e}),r.characterRooms[e.id]=h,t.changeType==="teleport"){const{state:{toPosition:m}}=t.sourceItem;Tr(h,e,U(Te(m),a))}else{const m=xL(h,o,t);if(m===void 0)if(t.changeType==="level-select")Tr(h,e,Te({x:1,y:1,z:8}));else throw new Error(`trying to move ${e.id} from ${o.id} --to-> ${s} but no destination portal found to locate with`);else{const g=U(m.state.position,m.config.relativePoint,a,n==="portal"&&i.config.direction.z>0?{z:W.z}:{});Tr(h,e,g);const{config:{direction:A}}=m;A.z===0&&(e.state.autoWalk=!0,e.state.facing=e.state.visualFacingVector=Qt(A,-1),e.state.action==="idle"&&(e.state.action="moving"),bL(e,A,r,h))}}const d=ex(Ts(e,h[Ht],m=>!_s(m)));d!==void 0&&console.warn("on entering room",s,"character",e.id,"at",e.state.position,"collides with (at least one; only first is shown) non-portal item:",d),r.entryState[e.id]=fd(e),e.id==="headOverHeels"?(delete r.entryState.head,delete r.entryState.heels):(r.entryState[qn(e.id)]||(r.entryState[qn(e.id)]=r.entryState.headOverHeels),delete r.entryState.headOverHeels),le.dispatch(YM(s)),le.dispatch(sw({characterName:e.type,roomId:s}))},zV=t=>{const e={};for(const r of Object.values(t.rooms))for(const s of Object.values(r.items))if(s.type==="player"){const{which:n}=s.config;if(e[n]!==void 0)throw new Error(`Campaign has duplicate starting rooms for ${n}`);e[n]=r.id}return e},VL=t=>{const e=zV(t),r={...e};if(e.head===void 0&&e.heels===void 0)throw new Error("couldn't find either head or heels in campaign");let s=Wt().get("playAsHeels")==="1"?"heels":e.head!==void 0?"head":"heels";const n=M2()?I2(t,window.location.href):void 0;return n!==void 0&&(r[s]=n),r.head===void 0&&(s="heels"),{campaignStartingRoomIds:e,startingRoomIds:r,startAs:s,changedCharacterRoomFromCampaign:n!==void 0&&e[s]!==r[s]}},vL=t=>{for(const e of Dr(t)){const r=e;r[Ht]===void 0&&(r[Ht]=new jV(Ot(e.items)))}return t},_L=({campaign:t,inputStateTracker:e,savedGame:r,writeInto:s={}})=>{if(r){const m=r.gameState.characterRooms,g=cd(m);return m.head!==void 0&&m.head.id===m.heels?.id&&(g.heels=g.head),Object.assign(s,{inputStateTracker:e,...cd(r.gameState)}),s.characterRooms=vL(g),s}const{startAs:n,startingRoomIds:i,campaignStartingRoomIds:o,changedCharacterRoomFromCampaign:a}=VL(t),l={roomPickupsCollected:me,scrollsRead:me,isNewGame:!0},c=o.head&&ud({roomJson:t.rooms[o.head],...l,userSettings:le.getState().gameMenus.userSettings}),u=o.heels===o.head?c:o.heels&&ud({roomJson:t.rooms[o.heels],...l,userSettings:le.getState().gameMenus.userSettings}),h=c===void 0?void 0:id("head",c?.items),f=u===void 0?void 0:id("heels",u?.items),d=Object.assign(s,{inputStateTracker:e,currentCharacterName:n,entryState:{head:h===void 0?void 0:fd(h),heels:f===void 0?void 0:fd(f)},pickupsCollected:{},gameTime:0,freeCharacters:{},characterRooms:{head:c,heels:u,headOverHeels:void 0}});return a&&wL({changeType:"level-select",gameState:d,playableItem:n==="head"?h:f,toRoomId:i[n],sourceItem:void 0}),d},QG=t=>{try{return _L(t)}catch(e){throw new Error("failed to load game state",{cause:e})}},SL=Oe(Kt({x:1,y:1,z:1})).y,Qy=Oe(Kt({x:0,y:1,z:0})).x,kL=t=>t.reduce((e,{gridPosition:r})=>{const s=Oe(Kt(r));return{t:Math.min(e.t,s.y+SL),b:Math.max(e.b,s.y),l:Math.min(e.l,s.x-Qy),r:Math.max(e.r,s.x+Qy)}},{t:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,l:Number.POSITIVE_INFINITY,r:Number.NEGATIVE_INFINITY}),CL="$$final",Na=(t,e,r,s)=>e.some(n=>n.config.direction===t)?"doorway":r===void 0?"wall":Object.values(r).some(({gridPosition:n})=>E_(fe[t],b_(n,s)))?"open":"wall";function*cn(t){try{yield*EL(t)}catch(e){const r=e;throw new Error(`
  error in recursion ${t.roomId}/${t.subRoomId??"*"}`,{cause:r})}}function*EL({roomId:t,subRoomId:e="*",campaign:r,visited:s={},vectorFromPrevious:n,previousRoomGridPosition:i=ee}){if(t==="nowhere"||s[t]?.[e])return;s[t]===void 0&&(s[t]={}),s[t][e]=!0;const o=r.rooms[t];if(o===void 0)throw new Error(`no room in the campaign with id="${t}"`);const a=[...Qe(Dr(o.items)).filter(d=>d.type==="door").filter(d=>ep(d.position,"block",o)===e)],l=U(i,n===void 0?Hq:n),c=o.meta?.subRooms;if(c){if(e==="*")throw new Error(`subRoomId '*' means 'all' and is not allowed for big rooms. Must be one of the sub-rooms in ${t}: ${Object.keys(c)}`);if(!c[e])throw new Error(`Sub-room ${e} not found in room ${t}. Available sub-rooms: ${Object.keys(c)}`)}const u=c?.[e].gridPosition,h={left:Na("left",a,c,u),right:Na("right",a,c,u),away:Na("away",a,c,u),towards:Na("towards",a,c,u)};if(yield{roomId:t,subRoomId:e,gridPosition:l,boundaries:h},c!==void 0){if(u===void 0)throw new Error(`Sub-room ${e} not found in room ${t}. Available sub-rooms: ${Object.keys(c)}`);for(const[d,{gridPosition:m}]of Qe(Ln(c)))d!==e&&(yield*cn({roomId:t,subRoomId:d,campaign:r,visited:s,vectorFromPrevious:jr({...m,z:0},u),previousRoomGridPosition:l}))}if(o.roomAbove!==void 0){const{roomAbove:d,subRoomAbove:m}=o;yield*cn({roomId:d,subRoomId:m,campaign:r,visited:s,vectorFromPrevious:fe.up,previousRoomGridPosition:l})}if(o.roomBelow!==void 0){const{roomBelow:d,subRoomBelow:m}=o;yield*cn({roomId:d,subRoomId:m,campaign:r,visited:s,vectorFromPrevious:fe.down,previousRoomGridPosition:l})}for(const d of a){const{toRoom:m}=d.config;if(m!==CL)try{yield*cn({roomId:m,campaign:r,visited:s,subRoomId:d.config.meta?.toSubRoom,vectorFromPrevious:fe[d.config.direction],previousRoomGridPosition:l})}catch(g){throw new Error(`error while traversing door ${JSON.stringify(d,null,2)} in room ${t} to room ${m}`,{cause:g})}}const f=o.meta?.nonContiguousRelationship;if(f!==void 0){const{with:{room:d},gridOffset:m}=f;yield*cn({roomId:d,campaign:r,visited:s,subRoomId:"*",vectorFromPrevious:m,previousRoomGridPosition:l})}}const TL=t=>{const r=[...t].sort(({gridPosition:s},{gridPosition:n})=>s.z!==n.z?s.z-n.z:n.x+n.y-(s.x+s.y)).map(s=>[`${s.roomId}/${s.subRoomId}`,s]);return Un(r)},PL=()=>{const t=T2(),e=MM(),{gameState:r}=zn(),s=tw();return v.useMemo(()=>{try{const n=R2(r),i=n?.roomJson.id??zV(s).head;let o;if(!r)o="*";else if(!n?.roomJson.meta?.subRooms)o="*";else{const u=n?.items[t];u?o=ep(u.state.position,"fine",n.roomJson):o="*"}const a=[...cn({campaign:s,roomId:i,subRoomId:o})],l=TL(a);return{mapBounds:kL(a),curRoomId:n?.roomJson.id,gridPositions:l,currentCharacterName:t,pickupsCollected:r.pickupsCollected,characterRooms:r.characterRooms,campaign:s,roomsExplored:e,curRoomScenery:n?.planet}}catch(n){throw new Error("error getting map data",{cause:n})}},[s,t,r,e])},RL=()=>{const{ref:t,width:e}=ZD(),r=kV(),s=Yb(),n=zn(),i=v.useMemo(()=>{if(s)return l=>{n.changeRoom(l)}},[s,n]);P2();const o=PL(),a=CV(o.curRoomScenery);return p.jsx(ze,{children:p.jsx(ke,{ref:t,fullScreen:!0,className:`bg-white zx:bg-zxBlack pr-0 p-0 mobile:pl-0 justify-center ${a.containerClassName}`,onClick:z(qt),dialogId:"map",children:p.jsx("div",{className:"overflow-y-scroll scrollbar scrollbar-w-1 h-min",ref:r,children:p.jsx(C2,{onPlayableClick:l=>Ka(n.gameState,l),containerWidth:e,onRoomClick:i,...o})})})})},ML=`## Bag

![](texture-bag)The *bag* may be used to carry small objects around a room. It is essential for
Heels to find and get the bag as it is impossible to get far without it.

The object in the bag will be displayed immediately above the bags icon at the
bottom right of the screen. To pick up an object, stand on top of it and
press *carry*. 

![](texture-cube)![](texture-drum)![](texture-spring_compressed)![](texture-sticks)

It is not possible to take items through doorways.

> Section adapted from the original Head over Heels manual

`,IL=`## Planet Blacktooth

![](texture-blacktooth_wall_armour_left?bg-pureBlack)![](texture-blacktooth_wall_shield_away?bg-pureBlack&float-right)This planet has a large moon with three lunar space stations on it, the larger
of these, *Moon Station HQ*, is the main teleport center for the empire, with a
direct teleport to all the slave planets.

Sometime after the Egyptus episode,
the latest Emperor sent out a craft to find that same strange planet, and after
much exploration, it was finally located, and the craft landed. However, the
crew found the people had changed: instead of pyramids they used castles,
instead of wrapping corpses up in cloth, they wrapped living men in metal and
then tried to turn them into corpses with sharp metal sticks.

![](texture-teleporter)The Emperor, not to be outdone by his ancestor, built a castle on Blacktooth and
used it as his headquarters. The castle is surrounded by a small market, and
then a range of impassable mountains. The only way to leave is via teleport to
one of the three lunar space stations.

> Section adapted from the original Head over Heels manual`,jL=`## Planet Book World

![](texture-bookworld_wall_cowboy_left?bg-pureBlack)![](texture-book_x?float-right&clear-right)![](texture-book_y?float-right&clear-right)The emperor is very keen
on *cowboy books* and has devoted an entire world to a *western library*.

Only the emperor's minions are permitted to read them.
Information is rigorously suppressed in the empire.

> Section adapted from the original Head over Heels manual
`,OL=`## Conveyor Belts

![](texture-animated-heels_walking_right?z-topSprite&relative&ml-centreSmallBlockOnLarge&mr-2)![](texture-animated-conveyor_x?&relative&clear-left&bottom-bottomStackPullup)The rollers on the conveyor simply push you along it. If you wish to go the
opposite direction you have to jump along.

> Section adapted from the original Head over Heels manual
`,NL=`## Credits

### Original credits

Written by Jon Ritman and Bernie Drummond.  
Music and sound effect by Guy Stevens.  
Produced by D.C. Ward.  
1987 Ocean Software Limited.

### 38 years later, a Remake

* code by Jim Higson
* Playtesting, ideas, map design, and general support by my brother, Tom Higson
* Playtesting, moral support, and constant comms by [Jon Albaugh](https://x.com/fextwolf?s=21&t=PEqxJblCn3JB_NH8AOR6Zg)
* Head over heels [font](https://fontstruct.com/fontstructions/show/996776/head_over_heels)
recreated by [Patrick H. Lauke](http://splintered.co.uk/)

This project is licensed under the GNU Affero General Public License v3.0 (only) - see the LICENSE file for details. All code is original except where indicated otherwise.

2025 Jim Higson`,BL=`## Crowns

![](texture-crown_blacktooth)![](texture-crown_bookworld?float-right)![](texture-crown_egyptus?clear-left)![](texture-crown_penitentiary?float-right&clear-right)![](texture-crown_safari?clear-left)Find a crown and start a revolution. At the beginning of each game, a screen
showing all five planets with a crown above each will be displayed.

As each
crown is collected this screen will be shown again with the appropriate crowns
in a bright color.

> Section adapted from the original Head over Heels manual`,DL=`## Cuddly Stuffed White Rabbits

![](texture-whiteRabbit?float-right)The *cute toy bunnies* magically enhance your powers. The status display at the
bottom of the screen will keep you informed as to which powers are temporarily
enhanced.

If Head and Heels are connected when they pick up a *Life* or *Iron pill*,
they will both get the enhanced power.

There are four types:

## Two extra lives
If you pick them up while head and heels are joined, they get *two each*

##  Iron Pills

![](texture-animated-shine?text-metallicBlue&float-left)To make you invulnerable

##  Jump higher bunny

![](texture-animated-heels_idle_right?text-metallicBlue&float-left)Only works on Heels

##  Go faster bunny
![](texture-animated-head_idle_right?text-metallicBlue&float-left)Only works on slow-moving Head

> Section adapted from the original Head over Heels manual
`,zL=`## Doughnuts

![](texture-doughnuts)Trays of *six doughnuts* are few and far between, so dont waste shots. Only Head
may pick up doughnuts.

The number of remaining doughnuts will be displayed above
the doughnut icon at the bottom left of the screen.

> Section adapted from the original Head over Heels manual
`,FL=`## Planet Egyptus

![](texture-egyptus_wall_sarcophagus_left)![](texture-egyptus_wall_sarcophagus_away?float-right)![](texture-egyptus_wall_hieroglyphics_left?clear-left)![](texture-egyptus_wall_hieroglyphics_away?float-right&clear-right)Once, a long time ago, a craft from Blacktooth got a bit lost while doing a
hyperspace jump and landed on an unknown planet.

Here the crew found a primitive
animal forming a sort of civilization that appeared to revolve around wrapping
corpses in lots of bandages and putting them into huge stone pyramids.

When they
returned to Blacktooth their emperor liked the sound of it so much that he
rebuilt the capital city of one of the slave planets to resemble the story.

> Section adapted from the original Head over Heels manual
`,LL=`## Head 
### (HEADUS MOUTHION)

![](texture-animated-head_walking_towards?float-right)This creature is a symbiotic partner to Heels and will normally be found sitting
on top of one.

![](texture-head_falling_right)Head is descended from a breed of flying reptile and still has
rudimentary wings that allow Head to jump up to twice his own height and to
guide himself through the air.

> Section adapted from the original Head over Heels manual
`,UL=`## Heels 
### (FOOTUS UNDERIUM)

![](texture-animated-heels_walking_towards?float-right)During Heelss evolution, the arms have totally disappeared while the legs have
become very powerful.

Heels can jump their own height and can also run very fast.

> Section adapted from the original Head over Heels manual`,$L=`## Hints and Tips

1. **1** Beginners should aim to escape from Blacktooth and get back to Freedom initially. Only the very skillful can hope to liberate a planet or two.
2. **2** ![](texture-animated-head_idle_towards?float-right&relative&z-topSprite)![](texture-heels_standing_towards&float-right&clear-right&relative&bottom-bottomStackPullup)When you first get Head and Heels in the same location, practice placing Head on top of Heels and joining them together accurately with the swop key. Both of their icons will light up when they are successfully joined.
3. **3** Remember Head and Heels are a team. Just because both are in the same room does not mean you have to join them together, and in fact, some problems may only be solved by separating Head and Heels.
4. **4** Make sure Head learns to climb ladders; this is an essential skill.
5. **5** ![](texture-bag?float-right)![](texture-hooter?float-right)Both Heelss bag and Heads hooter must be collected at the initial stages for there to be any chance of completing the game.
6. **6** If Head and Heels are in the same room, extra jumping height may be obtained by one jumping off the others back.
7. **7** Find a safe spot and get used to how far Head and Heels may move over the edge of a brick before they fall. This will enable you to make the longest jumps. Both Head and Heels will jump slightly further if they are running as they jump.
8. **8** Learn the difference in distance and control between Heads jumps and Heelss jumps.
9. **9** This remake comes with a **map**. Use it!
10. **10** ![](texture-doughnuts?float-right)Do not waste doughnuts; they are not easy to find.
11. **11** Do not get confused; only Heels may carry anything, and only Head may fire.
12. **12** ![](texture-spring_released?float-right&relative&z-topSprite)![](texture-cube?float-right&clear-right&relative&bottom-bottomStackPullup)To discover if there is a room above, pile objects as high as possible and jump from the top. If there is a spring in the room, put it on the top for extra jumping height.
13. **13** If you cant understand a room, try exiting and entering again, watching carefully for any movement in the room as you enter.

> Section adapted from the original Head over Heels manual`,GL=`## The Blacktooth Empire

![](texture-crown_blacktooth)Far, far away from our star Sol lies **The Blacktooth empire**, an evil empire, four
worlds enslaved by the planet Blacktooth.

![](texture-animated-dalek?float-right)All of the slave worlds bubble with
unrest, but due to the oppressive nature of their rulers they never reach
boiling point, they all lack a leader to draw the masses of population together.

![](texture-animated-helicopterBug?float-right)Blacktooth itself is not any better, a world rigidly controlled by its dynastic
leaders for so long that the populace do not ever think about revolution.

![](texture-head_walking_right_2)The peoples of the neighbouring stars are getting very worried about signs of
military expansion from Blacktooth and have sent a spy from the planet Freedom
to see if he can push the slave planets into full rebellion by finding the
crowns lost when Blacktooth took over.

![](texture-heels_standing_right)The creatures of *Freedom* are very strange in that they are formed from a pair of
*symbiotic animals* that have adapted to operate either independently or, to their
mutual advantage, join together as one - **Head** saddled on **Heels**, and indeed these
*are* their names and both are highly trained spies.

> Section adapted from the original Head over Heels manual
`,HL=`## Hooter

![](texture-hooter)The *hooter* may be used by Head to fire *doughnuts* at attacking monsters.

This will freeze them in place as they lick the doughnut off their faces.

![](texture-doughnuts?float-right&clear-both)The hooter may only be used by **Head** and requires a tray of *doughnuts* to be of any use.

> Section adapted from the original Head over Heels manual
`,WL=`## Hush Puppies

![](texture-hushPuppy?float-right)These are a very strange type of beast; they are incredibly 
sleepy. In fact, they never wake up and it is quite normal for them to sleep for 
their entire lives.

They are often used as tables and even used as building bricks. 
They are a native of Freedom, ![](texture-head_walking_right_2?clear-both)and for many thousands of years Head and his ancestors 
have been mistaking them for Heels and causing so much trouble to the poor old hush
puppies that they evolved a defense mechanism they somehow learned to teleport
themselves away.

![](texture-animated-bubbles_white?float-right&clear-both)Nobody knows where they go, but
the instant they see any of Heads race, they disappear and wont return until they are sure the coast is
clear.

> Section adapted from the original Head over Heels manual
`,YL=`
## Planet Penitentiary
### The empires prison planet

![](texture-penitentiary_wall_skeleton_left)Millions are imprisoned here. A harsh planet, very mountainous, much climbing,
skill required.

The worst place is The Pit, try not to fall into it!

> Section adapted from the original Head over Heels manual
`,KL=`## Reincarnation Fish

![](texture-animated-fish)The strangest animal in the known universe! This fish likes to be eaten! There
have been cases of it jumping onto plates!

But there is more: when you eat one,
its prodigious memory remembers everything about you. Its memory is so good that
if you die at some later date, you will be reincarnated at the very place you
ate the fish, and you will even have its taste still in your mouth!

How a fish
can remember anything when it's been eaten has never been successfully
explained.

![](texture-fish_1)You must be very careful to check that the fish is
alive and wriggling as **dead fish decompose very quickly and it rapidly
turns so poisonous that a single lick can kill.**

### WARNING:

Even living reincarnation fish taste horrible!

> Section adapted from the original Head over Heels manual
`,QL=`## Install the game

**> This page also available with normal fonts: [on Github](https://github.com/jimhigson/head-over-heels-online/tree/main/src/manual/remake/installGuide.md)**

You can play the blockstack.ing Head over Heels remake from *any modern web
browser*: phone, desktop, or tablet.

However, It is **highly recommended** to **install the game** as a [P.W.A.](https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps)

----
## Chrome / Chromium

On: **Mac**, **Windows**, **Linux**, **Chromebooks**, **iphone**, or **Android**

To install:

* Go to [blockstack.ing](https://blockstack.ing) if youre not there already
* To the right of the address bar, click the **install icon: **. It might also look like a 'download' icon.
* In the dialog, choose *install*
* **Head over heels** is now installed as an app!

----
## iphone / ipad Safari

To install:

* Go to [blockstack.ing](https://blockstack.ing) if youre not there already
* Tap the **share button **
* The share button is at the bottom of the screen for phones in portrait, or to the right of the address bar on ipad or phones in landscape
* Choose **Add to Home Screen **
* **Head over heels** is now available on your home screen!

----
## Mac Safari

* Go to [blockstack.ing](https://blockstack.ing) if youre not there already
* Click the **share button ** to the right of the address bar
* Choose **Add to Dock **
* **Head over heels** is now installed on your mac
* If you dont want to keep the game in the Dock, right-click the doc icon and uncheck **Options  keep in doc**. It is still available in Applications

---

## Firefox 

* Firefox doesn't support PWAs out of the box, but there is a [browser extension](https://addons.mozilla.org/en-US/firefox/addon/pwas-for-firefox/).
* Probably easier to play in the browser until Mozilla adds support`,XL=`## Supported platforms

Almost anything with an up-to-date browser can play

Heres some Ive tried:

* **Linux** - install using Chromium. Play in-browser using Chromium or Firefox
* **Mac** - install using Safari or Chrome. Play in-browser using Safari, Chrome, or Firefox
* **Windows** - Chrome works for installed and in-browser play. Edge not tested but should work
* **iPhone** - in-browser play works, but there is no way to go full-screen - installing as a an app is better. 60fps cap in Safari. Turning on [Guided access](https://support.apple.com/en-gb/111795) is recommended for gaming.
* **Android** - Default browser has *excellent* PWA support
* **Raspberry Pi** - Pi 5 gets 45-60fps with Chromium and Firefox; 30 in busier rooms.
* **Apple watch** - Not really playable, but it runs if you message yourself the link to open it on the watch!
* **ZX Spectrum** - Currently untested`,JL=`## Planet Safari

![](texture-monkey_right?float-left&relative&z-topSprite)![](texture-homingBot?float-left&clear-left&relative&bottom-bottomStackPullup)![](texture-elephant_towards?float-right&relative&z-topSprite)![](texture-homingBot?float-right&clear-right&relative&bottom-bottomStackPullup)A densely vegetated planet, mainly used for hunting.

The natives live in wooden forts in the jungle, **beware traps!**

> Section adapted from the original Head over Heels manual`,ZL=`## Springs

![](texture-animated-once-spring_bounce)Jumping from a spring will give extra height to your jump.

> Section adapted from the original Head over Heels manual
`,eU=`## Switches

![](texture-animated-switch)Simply push the switch to switch things off and on!

Switching a deadly monster off will make them no longer deadly to touch. Push them or jump on them to reach new areas!

This varies from the original Head over Heels game, where disabled enemies remained deadly.

> Section adapted from the original Head over Heels manual, revised for remake
`,tU=`## Swop Key

If Head is sitting on Heels, the swop key will, on each push, give you control
of:

* *1* Heels.
* *2* Head + Heels.
* *3* Head.
* *4* Head + Heels.

If Head is not on Heels, the swop key will, on each push, give you control of:

* *1* Head.
* *2* Heels.

At all times, the character(s) whose icon is lit is under player control. When
Head and Heels are joined together, all their abilities are combined.

> Section adapted from the original Head over Heels manual`,rU=`## Exalted Emperor:

![](texture-teleporter)Sire, I took the liberty of installing this teleporter 
to aid your magnificent return to the moonbase after the daily crown inspections.

![](texture-cyberman_towards)Supplies are running short of teleporters, so I set it up one-way
until more come in.
May I humbly suggest you teleport after inspecting the crown or his grace
will have a long walk (well, ride on a minions back) to get back here.

Of course, those two spies we threw in jail might try to use it to grab the crown and escape.
Just kidding, theyll never get this far!

*> Your humble minion*
`,sU=`## Teleports

![](texture-teleporter)Standing on a teleport will activate its mechanism, which will sound a warning
siren. Pressing the *jump key* will cause you to teleport.

Not all teleports are two-way; some are linked in a chain.

> Section adapted from the original Head over Heels manual `,nU=`## The Emperors Guardian

![](texture-ball_blueGreen?relative&z-topSprite)![](texture-animated-bubbles_cold?relative&clear-both&bottom-bottomStackPullup)The guardian blocks the door to the throne room in Blacktooth castle. He is **VERY
DANGEROUS**, and he *doesn't like doughnuts*.

Only a true hero may pass the guardian.

> Section adapted from the original Head over Heels manual
`,iU=`## The Game

![](texture-animated-heels_idle_right)![](texture-animated-head_idle_towards?float-right)Head and Heels have been captured, separated and imprisoned in the castle
headquarters of Blacktooth. Their cells contain keep fit equipment, including
a wall ladder that Head really must learn to climb.

![](texture-market_wall_fruits_left?bg-pureBlack)![](texture-moonbase_wall_window2_away?bg-pureBlack&float-right)Your job is to get them both
out of the castle and into the *marketplace* so they can join up again. From
there, the journey leads to *Moonbase Headquarters*, where you will have to decide
either to try to escape back to *Freedom* or to be a true hero and teleport to one
of the slave planets to search for its lost crown!

![](texture-crown_bookworld?clear-left)To overthrow the dictatorship on any of the slave planets would be a major blow
to Blacktooth and you could return to Freedom in glory. Of course, Blacktooth
would probably enslave them again eventually but it would slow down any
expansion plans for now.


![](texture-cyberman_towards?float-right&relative&z-topSprite)![](texture-animated-bubbles_cold?float-right&clear-right&relative&bottom-bottomStackPullup)The populace of Blacktooth are so heavily oppressed
that they would have to see all four of the slave planets revolt before the
Blacktooth crown could cause an uprising. ![](texture-animated-turtle_right)This of course would be the ultimate
accolade, and unfortunately, almost certain suicide.

> Section adapted from the original Head over Heels manual
`,Ve=Object.assign({"./bag.md":ML,"./blacktooth.md":IL,"./bookWorld.md":jL,"./conveyorBelts.md":OL,"./credits.md":NL,"./crowns.md":BL,"./cuddlyStuffedWhiteRabbits.md":DL,"./doughnuts.md":zL,"./egyptus.md":FL,"./head.md":LL,"./heels.md":UL,"./hintsAndTips.md":$L,"./historyOfTheBlacktoothEmpire.md":GL,"./hooter.md":HL,"./hushPuppies.md":WL,"./penitentiary.md":YL,"./reincarnationFish.md":KL,"./remake/installGuide.md":QL,"./remake/supportedPlatforms.md":XL,"./safari.md":JL,"./springs.md":ZL,"./switches.md":eU,"./swopKey.md":tU,"./teleportBack.md":rU,"./teleports.md":sU,"./theEmperorsGuardian.md":nU,"./theGame.md":iU}),Ui={historyOfTheBlacktoothEmpire:Ve["./historyOfTheBlacktoothEmpire.md"],theGame:Ve["./theGame.md"],egyptus:Ve["./egyptus.md"],penitentiary:Ve["./penitentiary.md"],safari:Ve["./safari.md"],bookWorld:Ve["./bookWorld.md"],blacktooth:Ve["./blacktooth.md"],head:Ve["./head.md"],heels:Ve["./heels.md"],reincarnationFish:Ve["./reincarnationFish.md"],cuddlyStuffedWhiteRabbits:Ve["./cuddlyStuffedWhiteRabbits.md"],hooter:Ve["./hooter.md"],doughnuts:Ve["./doughnuts.md"],bag:Ve["./bag.md"],crowns:Ve["./crowns.md"],teleports:Ve["./teleports.md"],springs:Ve["./springs.md"],switches:Ve["./switches.md"],conveyorBelts:Ve["./conveyorBelts.md"],hushPuppies:Ve["./hushPuppies.md"],theEmperorsGuardian:Ve["./theEmperorsGuardian.md"],swopKey:Ve["./swopKey.md"],hintsAndTips:Ve["./hintsAndTips.md"],credits:Ve["./credits.md"],installGuide:Ve["./remake/installGuide.md"]},oU={...Ui,teleportBack:Ve["./teleportBack.md"]},aU=/^##\s+(.*)$/m,pd=t=>{const e=t.match(aU);if(e===null)return"no title found";const[,r]=e;return r},Zu=t=>{const e=t.source==="manual"?oU[t.pageName]:t.markdown,r=kV(),s=X(n=>{const{openMenus:i}=n.gameMenus;return i.some(o=>o.menuId==="readTheManual")});return p.jsxs(ze,{children:[p.jsx(xt,{className:"bg-midGrey zx:bg-zxWhiteDimmed",onClick:z(qt)}),p.jsxs(ke,{tall:!0,className:"bg-highlightBeige zx:bg-zxCyanDimmed text-shadow zx:text-zxWhite !gap-y-0 py-0 selectedMenuItem:text-shadow zx:selectedMenuItem:text-zxBlack ",dialogId:t.dialogId,children:[p.jsx(yr,{className:"pl-1 mobile:px-3 ",path:s?["Manual"]:[]}),p.jsx("div",{className:ht("overflow-y-scroll h-full scrollbar scrollbar-w-1 pl-1 pt-1 scrollbar-thumb-midRed scrollbar-track-highlightBeige zx:scrollbar-thumb-zxCyanDimmed zx:scrollbar-track-zxCyan mobile:px-3"),ref:r,onClick:z(qt),children:p.jsx(ge,{markdown:e})})]})]})},FV=t=>{t.reincarnateFrom(le.getState().gameMenus.gameInPlay.reincarnationPoint),le.dispatch(vf())},lU="![](?sprite&texture-animated-fish&float-left)Ah, But you ate a Reincarnation Fish! Reincarnate?",cU=()=>{const t=zn();return p.jsxs(ze,{children:[p.jsx(xt,{className:"bg-midRed zx:bg-zxYellow"}),p.jsxs(ke,{className:"bg-white zx:bg-zxRed px-1",dialogId:"offerReincarnation",children:[p.jsx(j,{className:"sprites-double-height mt-1 mb-2 resHandheld:mt-0 text-redShadow zx:text-zxWhite",children:"Uh-oh! Game over."}),p.jsx(ge,{markdown:lU,className:"text-redShadow zx:text-zxWhite"}),p.jsxs(Re,{className:"text-lightGrey zx:text-zxWhite mt-1 resHandheld:mt-0 selectedMenuItem:text-midRed zx:selectedMenuItem:text-zxYellow resHandheld:!gap-y-1",children:[p.jsx(L,{doubleHeightWhenFocussed:!0,id:"reincarnate",label:"Reincarnate",onSelect:()=>{FV(t)}}),p.jsx(L,{doubleHeightWhenFocussed:!0,id:"donotreincarnate",label:"Stay dead",onSelect:z(Vf,{offerReincarnation:!1})})]})]})]})},uU="Play at the original **1x** speed, **1.2x (default)** or faster **1.5x** or **2x** speeds",hU=`**Off**: Start with *8 lives*

Extra life rabbits spread thinly through the game`,dU=`**On**: *Live forever*

Extra life rabbits have no effect`,fU="*Select the keys* and other input settings",pU=`##Cheats

Magazines used to print memory locations to *poke* values into so that readers could modify their games; usually to cheat.
                  
A true hero leaves these **off**! Then again, do modern gamers even know what lives are?`,mU=()=>{const t=X(Xb);return p.jsx(ze,{children:p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"modernisationOptions",children:[p.jsx(yr,{path:["Options"],className:Zn}),p.jsx("div",{className:Jn,children:p.jsxs(Re,{className:"gap-y-half",children:[p.jsx(L,{hintInline:!0,id:"controlOptions",label:"Controls",verticalAlignItemsCentre:!0,className:"sprites-double-height",onSelect:z(ut,"controlOptions"),opensSubMenu:!0,hint:p.jsx(ge,{className:Ee,markdown:fU}),leader:p.jsx("span",{className:`${qe} sprite texture-joystick_whole sprites-normal-height zx:sprite-revert-to-white`})}),p.jsx(L,{hintInline:!0,id:"sound",label:"Sounds",className:"sprites-double-height",verticalAlignItemsCentre:!0,onSelect:z(ut,"sound"),opensSubMenu:!0,hint:p.jsx(ge,{className:Ee,markdown:"Footsteps getting annoying?"})}),p.jsx(L,{hintInline:!0,id:"display",label:"Display",className:"sprites-double-height",verticalAlignItemsCentre:!0,onSelect:z(ut,"displayOptions"),opensSubMenu:!0,hint:p.jsx(ge,{className:Ee,markdown:"Change how the game looks"})}),p.jsx(L,{hintInline:!0,id:"gameSpeed",label:"Game Speed",className:"sprites-double-height",valueElement:p.jsx(Hf,{className:"ml-auto",values:Gh,valueLabels:Gh.map(e=>`${e}`),value:X(Af)}),onSelect:z(QM,void 0),hint:p.jsx(ge,{className:Ee,markdown:uU}),verticalAlignItemsCentre:!0}),p.jsx("div",{className:"col-span-3 pb-1",children:p.jsx(ge,{markdown:pU,className:Ee})}),p.jsx(L,{hintInline:!0,className:"sprites-double-height",id:"livesModel",verticalAlignItemsCentre:!0,label:" Lives Poke",leader:p.jsx("span",{className:`${qe} sprite texture-whiteRabbit sprites-normal-height zx:sprite-revert-to-white`}),hint:p.jsx(ge,{className:Ee,markdown:t?dU:hU}),valueElement:p.jsx(Mr,{className:"ml-auto",value:t}),onSelect:z(Yt,{path:"infiniteLivesPoke"}),disabled:Sn()}),p.jsx(L,{hintInline:!0,leader:p.jsx("span",{className:`${qe} sprite texture-doughnuts sprites-normal-height zx:sprite-revert-to-white`}),className:"sprites-double-height",verticalAlignItemsCentre:!0,id:"infiniteDoughnutsPoke",label:" Doughnuts Poke",valueElement:p.jsx(Mr,{className:"ml-auto",value:X(Jb)}),onSelect:z(Yt,{path:"infiniteDoughnutsPoke"}),disabled:Sn()}),p.jsx(lc,{})]})})]})})},Xy="sprite texture-crown_blacktooth zx:texture-crown_uncolourised zx:sprite-tinted zx:text-zxYellow",gU=()=>p.jsxs(ze,{children:[p.jsx(xt,{className:"bg-pureBlack zx:bg-zxBlack"}),p.jsx(ke,{className:"bg-pureBlack w-zx h-full block p-0",onClick:z(qt),dialogId:"proclaimEmperor",children:p.jsxs("div",{className:"flex flex-col gap-3 items-center",children:[p.jsxs("div",{className:"flex gap-7",children:[p.jsxs("div",{className:"flex flex-col gap-y-oneScaledPix items-center me-1",children:[p.jsx("span",{className:Xy}),p.jsx("span",{className:"sprite zx:sprite-revert-zxYellow texture-animated-head_idle_right hover:texture-animated-head_walking_right relative z-topSprite"})]}),p.jsxs("div",{className:"flex flex-col items-center me-1",children:[p.jsx("span",{className:Xy}),p.jsx("span",{className:"sprite zx:sprite-revert-zxYellow texture-animated-heels_idle_towards hover:texture-animated-heels_walking_towards relative z-topSprite"})]})]}),p.jsxs("div",{className:"flex flex-col gap-1 items-center text-lightGrey zx:text-zxCyan",children:[p.jsx(j,{children:"The people salute your heroism"}),p.jsx(j,{children:"and proclaim you"})]}),p.jsx(j,{className:"text-highlightBeige sprites-double-height",classnameCycle:["text-pink zx:text-zxMagenta","text-metallicBlue zx:text-zxCyan","text-highlightBeige zx:text-zxYellow"],children:"EMPEROR"}),p.jsx(Re,{className:"hidden",children:p.jsx(jo,{})})]})})]}),LV=({className:t})=>p.jsx("div",{className:ht("contents",t),children:p.jsx(tc.Placeholder,{})}),AU=()=>{const t=X(r=>r.gameMenus.gameInPlay.reincarnationPoint!==void 0),e=zn();return p.jsxs(ze,{children:[p.jsx(xt,{className:"bg-midRed zx:bg-zxYellowDimmed"}),p.jsx(ke,{className:"bg-white zx:bg-zxRedDimmed px-1",dialogId:"quitGameConfirm",children:p.jsx(tc.Provider,{children:p.jsxs("div",{className:"flex flex-col gap-y-2 mt-1 items-center h-full",children:[p.jsx(j,{className:"sprites-double-height resHandheld:mt-0 text-midRed zx:text-zxWhite",children:"Quit the Game?"}),p.jsxs(Re,{className:"text-lightGrey zx:text-zxWhite resHandheld:mt-0 resHandheld:!gap-y-1",children:[p.jsx(L,{doubleHeightWhenFocussed:!0,id:"no",label:"Back",className:"selectedMenuItem:text-moss zx:selectedMenuItem:text-zxGreen",leader:p.jsx("span",{className:`${qe} sprite texture-head_walking_awayLeft_2 selectedMenuItem:texture-animated-head_walking_towardsRight sprites-normal-height zx:sprite-revert-to-white`}),onSelect:z(qt),hint:"Back to the game",verticalAlignItemsCentre:!0}),t&&p.jsx(L,{doubleHeightWhenFocussed:!0,id:"reincarnate",label:"Reincarnate",className:"selectedMenuItem:text-metallicBlue zx:selectedMenuItem:text-zxBlue",leader:p.jsx("span",{className:`${qe} sprite texture-fish_1 selectedMenuItem:texture-animated-fish sprites-normal-height zx:sprite-revert-to-white`}),onSelect:()=>FV(e),hint:p.jsx(ge,{className:"zx:[&_.strong]:text-zxYellow",markdown:"Go back and continue from the last **Reincarnation Fish** you ate"}),verticalAlignItemsCentre:!0}),p.jsx(L,{doubleHeightWhenFocussed:!0,id:"yes",label:"Quit",className:"selectedMenuItem:text-midRed zx:selectedMenuItem:text-zxYellow",onSelect:z(Vf,{offerReincarnation:!1}),leader:p.jsx("span",{className:`${qe} sprite texture-bubbles_white_1 selectedMenuItem:texture-animated-bubbles_bounce_white sprites-normal-height zx:sprite-revert-to-white`}),hint:p.jsx(ge,{className:"zx:[&_.strong]:text-zxYellow",markdown:"**Warning!** This game will end!"}),verticalAlignItemsCentre:!0})]}),p.jsx(LV,{className:"text-midGrey zx:text-zxWhite resHandheld:hidden"})]})})})]})},yU=({pageName:t})=>{const e=Ui[t],r=pd(e),s=yt()==="desktop";return p.jsx(L,{id:`markdown/${t}`,label:r,onSelect:z(ut,`markdown/${t}`),doubleHeightWhenFocussed:s,opensSubMenu:!0})},qU=Object.keys(Ui).sort((t,e)=>pd(Ui[t]).localeCompare(pd(Ui[e]))),xU=()=>p.jsxs(ze,{children:[p.jsx(xt,{className:"bg-midGrey zx:bg-zxCyan",onClick:z(qt)}),p.jsxs(ke,{tall:!0,className:"bg-highlightBeige zx:bg-zxCyanDimmed max-h-min text-redShadow zx:text-zxWhite !gap-y-0 py-0 selectedMenuItem:text-shadow zx:selectedMenuItem:text-zxBlack ",dialogId:"readTheManual",children:[p.jsx(yr,{className:"pl-1 mobile:px-3 "}),p.jsxs("div",{className:"overflow-y-scroll scrollbar scrollbar-w-1 pl-1 scrollbar-thumb-moss scrollbar-track-highlightBeige zx:scrollbar-thumb-zxBlack zx:scrollbar-track-zxCyanDimmed mobile:px-3 ",children:[p.jsxs("h1",{className:"text-moss zx:text-zxBlack mx-auto flex flex-row justify-center items-center w-full mb-1",children:[p.jsx("span",{className:"sprite texture-book_x zx:sprite-revert-to-white sprites-normal-height"}),p.jsx(j,{className:"sprites-double-height mx-1",children:"Read the manual"}),p.jsx("span",{className:"sprite texture-book_y zx:sprite-revert-to-white sprites-normal-height"})]}),p.jsxs(Re,{children:[[...qU.map(t=>p.jsx(yU,{pageName:t},t))],p.jsx(lc,{})]})]})]})]}),bU=()=>p.jsx(ze,{children:p.jsxs(ke,{className:"!h-min !w-max text-center p-0 bg-transparent",onClick:z(qt),dialogId:"reincarnatedRestart",children:[p.jsx(j,{className:`${ce} text-zxRed block w-24 mx-auto px-1 bg-zxBlack py-oneScaledPix`,children:"You dont go towards the light"}),p.jsx(j,{className:`${ce} block text-zxYellow w-24 mx-auto px-1 bg-zxBlack py-oneScaledPix`,children:"You have a horrible taste in your mouth"}),p.jsx(j,{className:`${ce} block text-zxGreen w-24 mx-auto px-1 sprites-double-height bg-zxBlack py-oneScaledPix`,children:"You have reincarnated!"}),p.jsx(j,{className:`${ce} block text-zxCyan w-24 mx-auto px-1 bg-zxBlack py-oneScaledPix`,children:"Everything is back to how it was when you ate the fish"}),p.jsx("span",{className:"sprite mx-auto  bg-zxBlack texture-animated-fish sprite-revert-to-white"}),p.jsx(Re,{className:"hidden",children:p.jsx(jo,{})})]})}),xi=94e3,Jy=(t,e,r)=>t*160+e*1e4+r*1e4,wU=[{upToProportion:8e3/xi,label:"beginner"},{upToProportion:2e4/xi,label:"novice"},{upToProportion:3e4/xi,label:"spy"},{upToProportion:55e3/xi,label:"master-spy"},{upToProportion:84e3/xi,label:"hero"},{upToProportion:1,label:"liberator"},{upToProportion:1/0,label:"completionist"}],VU=(t,e)=>{const r=t/e;for(const{upToProportion:s,label:n}of wU)if(r<s)return n;return"completionist"},vU=Ml(({gameMenus:{gameInPlay:{freeCharacters:t}}})=>t,t=>Object.keys(t)),_U=()=>{const t=tw(),e=X(vM),r=X(({gameMenus:{gameInPlay:{roomsExplored:l}}})=>dh(Qe(Dr(l)))),s=X(vU),n=Jy(r,e,s.length),i=dh(tx(t.rooms)),o=Jy(i,5,2),a=VU(n,o);return p.jsxs(p.Fragment,{children:[p.jsx(pV,{noSubtitle:!0,className:"resHandheld:hidden"}),p.jsx(j,{classnameCycle:fr,className:"mt-1 resHandheld:mt-3 block text-center mx-auto sprites-double-height sprites-uppercase",children:a}),p.jsxs("div",{className:`contents ${ce}`,children:[p.jsxs(j,{className:"mt-1 block text-center mx-auto text-highlightBeige zx:text-zxYellow",children:["Score ",n.toLocaleString()]}),p.jsx("div",{className:"mt-1",children:s.map(l=>p.jsxs("span",{className:"block text-center mx-auto text-lightGrey zx:text-zxYellow",children:[l==="head"?p.jsx(j,{className:"text-metallicBlue zx:text-zxBlue",children:"Head"}):p.jsx(j,{className:"text-pink zx:text-zxWhite",children:"Heels"}),p.jsx(j,{children:" is"}),p.jsx(j,{classnameCycle:fr,children:" free"})]},l))}),p.jsxs(j,{className:"mt-1 block text-center mx-auto text-pink zx:text-zxCyan",children:["Explored ",r," / ",i," rooms"," ",`(${(100*r/i).toFixed(1)}%)`]}),p.jsxs(j,{className:"mt-1 block text-center mx-auto text-lightGrey zx:text-zxWhite",children:["Liberated ",e," planets"]}),p.jsx(Re,{className:"hidden",children:p.jsx(jo,{})})]})]})},SU=()=>p.jsx(ze,{children:p.jsxs(v.Suspense,{fallback:p.jsxs(p.Fragment,{children:[p.jsx(xt,{className:"bg-metallicBlue zx:bg-zxCyan"}),p.jsx(ke,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed h-full block"})]}),children:[p.jsx(xt,{className:"bg-metallicBlue zx:bg-zxCyan"}),p.jsx(ke,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed w-zx h-full block",onClick:z(qt),dialogId:"score",children:p.jsx(_U,{})})]})}),kU=()=>{const t=X(CM),e=X(EM),r=X(TM);return p.jsxs(ke,{fullScreen:!0,className:Xn,dialogId:"sound",children:[p.jsx(yr,{path:["Options","Sounds"],className:Zn}),p.jsx("div",{className:Jn,children:p.jsxs(Re,{children:[p.jsx(L,{className:"sprites-double-height",id:"mute",label:"Mute",valueElement:p.jsx(Mr,{value:t}),verticalAlignItemsCentre:!0,onSelect:z(Yt,{path:"soundSettings.mute"})}),p.jsx(L,{className:"sprites-double-height",id:"roomEntry",label:"Room entry tunes",valueElement:p.jsx(Mr,{value:!t&&!r}),verticalAlignItemsCentre:!0,onSelect:z(Yt,{path:"soundSettings.noRoomEntryTunes"}),disabled:t}),p.jsx(L,{className:"sprites-double-height",id:"footsteps",label:"Footstep sounds",valueElement:p.jsx(Mr,{value:!t&&!e}),verticalAlignItemsCentre:!0,onSelect:z(Yt,{path:"soundSettings.noFootsteps"}),disabled:t}),p.jsx(lc,{})]})})]})},CU=`##*HohEd * the Level Editor
I built an *editor* so I could make the **sequel levels**

![](texture-headlessBase?float-left)**Make puzzles**!

*Challenge* others to **solve them**!

**In beta**; expect *crashes* and *confusion*!`,EU=()=>{const t=v.useCallback(()=>{window.location.href="/editor/"},[]);return p.jsxs(ze,{children:[p.jsx(xt,{className:"bg-pureBlack zx:bg-zxBlack",onClick:z(qt)}),p.jsx(ke,{className:"bg-shadowHalfbrite zx:bg-zxBlack px-1 py-0",dialogId:"sureWantEditor",children:p.jsx(tc.Provider,{children:p.jsxs("div",{className:"flex flex-col gap-y-2 mt-1 h-full",children:[La()&&p.jsx(vw,{className:"text-midGrey zx:text-zxWhite"}),p.jsx("div",{children:p.jsx(ge,{className:"text-midGrey zx:text-zxWhite",markdown:CU})}),p.jsxs(Re,{className:"text-lightGrey zx:text-zxWhite resHandheld:mt-0 selectedMenuItem:text-metallicBlue zx:selectedMenuItem:text-zxCyan resHandheld:!gap-y-1",children:[p.jsx(L,{doubleHeightWhenFocussed:!0,id:"yes",label:"Edit the levels",onSelect:t}),La()||p.jsx(jo,{customLabel:"Im scared, go back"})]}),La()||p.jsx(LV,{className:"text-midGrey zx:text-zxWhite resHandheld:hidden"})]})})})]})},TU="2924c962-99f1-4dd2-9b9c-fef832dc991b",PU=t=>p.jsxs(ze,{children:[p.jsx(xt,{className:"bg-metallicBlueHalfbrite zx:bg-zxRed",onClick:z(qt)}),p.jsxs(ke,{fullScreen:!0,className:"bg-metallicBlueHalfbrite zx:text-zxCyan text-highlightBeige selectedMenuItem:text-white zx:bg-zxRed gap-y-2 resHandheld:gap-y-1",dialogId:"whichGame",children:[p.jsx(yr,{path:["Select which game"],className:"mobile:px-4"}),p.jsx("div",{className:"flex flex-col gap-1 p-1 overflow-y-scroll scrollbar scrollbar-w-1 scrollbar-thumb-lightGrey scrollbar-track-metallicBlueHalfbrite zx:scrollbar-thumb-zxBlue zx:scrollbar-track-zxWhite mobile:px-3 ",children:p.jsxs(Re,{className:"gap-y-1",children:[p.jsx(L,{className:"sprites-double-height",id:"originalGame",label:"Original Remastered",hintInline:!0,onSelect:z(co,{campaignLocator:Tw}),leader:p.jsx("span",{className:`${qe} sprite texture-head_walking_right_2 selectedMenuItem:texture-animated-head_walking_right sprites-normal-height zx:sprite-revert-to-white`}),hint:p.jsx(ge,{className:Ha,markdown:"*Remaster* of the **300-some** rooms from the original game, lightly updated for modern play"})}),p.jsx(L,{id:"remake",label:"38 Years Later",className:"sprites-double-height",hintInline:!0,onSelect:z(co,{campaignLocator:{userId:TU,campaignName:"sequel",version:-1}}),leader:p.jsx("span",{className:`${qe} sprite texture-heels_standing_right selectedMenuItem:texture-animated-heels_walking_right sprites-normal-height zx:sprite-revert-to-white`}),hint:p.jsx(ge,{className:Ha,markdown:"*Unofficial sequel* - the empire is back! All-new levels designed for the remake. **Work in progress!**"})}),p.jsx(L,{id:"community",label:"Community contributed",className:"sprites-double-height",hintInline:!0,onSelect:z(ut,"communityGames"),opensSubMenu:!0,leader:p.jsx("span",{className:`${qe} sprite texture-charles_right sprites-normal-height zx:sprite-revert-to-white`}),hint:p.jsx(ge,{className:Ha,markdown:"Check out what people have made in the editor"})})]})})]})]}),RU=t=>t.startsWith("markdown/"),MU=t=>{const e=X(r=>r.gameMenus.openMenus.at(0));if(e===void 0)return null;if(RU(e.menuId)){if(e.menuId==="markdown/inline")return p.jsx(Zu,{source:"inline",markdown:e.menuParam.markdown,dialogId:"markdown/inline"});{const r=e.menuId.slice(9);return p.jsx(Zu,{source:"manual",pageName:r,dialogId:e.menuId})}}switch(e.menuId){case"communityGames":return p.jsx(aO,{});case"controlOptions":return p.jsx(oD,{});case"crowns":return p.jsx(uD,{playMusic:e.menuParam.playMusic});case"emulatedResolution":return p.jsx(mD,{});case"errorCaught":return p.jsx(bD,{errors:e.menuParam});case"hold":return p.jsx(wD,{});case"inputPreset":return p.jsx(vD,{});case"installGuide":return p.jsx(Zu,{source:"manual",pageName:"installGuide",dialogId:"installGuide"});case"mainMenu":return p.jsx(MD,{});case"map":return p.jsx(RL,{});case"modernisationOptions":return p.jsx(mU,{});case"offerReincarnation":return p.jsx(cU,{});case"proclaimEmperor":return p.jsx(gU,{});case"quitGameConfirm":return p.jsx(AU,{});case"readTheManual":return p.jsx(xU,{});case"reincarnatedRestart":return p.jsx(bU,{});case"score":return p.jsx(SU,{});case"displayOptions":return p.jsx(fD,{});case"sound":return p.jsx(kU,{});case"sureWantEditor":return p.jsx(EU,{});case"whichGame":return p.jsx(PU,{});default:return e.menuId,p.jsx(ke,{children:p.jsx(j,{children:`unknown dialog ${e}`})})}},IU=Bn(()=>Nn(()=>import("./gameMain-BmA0H6lh.js"),__vite__mapDeps([8,7,9,2,3,6,10,11,12,13]))),eh=new window.AudioContext;let Tl;const jU=async t=>{try{return await eh.decodeAudioData(await(await fetch(t)).arrayBuffer())}catch(e){if(navigator.webdriver===!0)return console.warn(`Audio decode failed for ${t} - running in automated browser`,e),eh.createBuffer(2,1,eh.sampleRate);throw e}},OU=Bn(async()=>{const t={};for(const[e,r]of Ln(BV))t[e]=await jU(r);return t}),NU=async()=>{Tl===void 0&&(Tl=await OU())},XG=()=>{if(Tl===void 0)throw new Error(`sounds not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`);return Tl},BU=(t,e)=>{const r=af();v.useLayoutEffect(()=>{ql(le.dispatch,le.getState,t,e)},[t,e]),v.useLayoutEffect(()=>{const s=()=>ql(le.dispatch,le.getState,t,e);return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[r,e,t])},DU=["characterRooms","currentCharacterName","entryState","gameTime","pickupsCollected","previousPlayable"],zU=(t,e,r)=>{const s=cd({saveTime:Date.now(),gameState:eo(t,...DU),store:{gameMenus:{gameInPlay:e.gameMenus.gameInPlay}}});if(r){const{characterPickingUp:n,pickupId:i}=r,o=s.gameState,a=o.characterRooms[n];if(a===void 0)throw new Error("how are we saving from a pickup if the character picking up is not in any room?");const l=a.id;for(const c of Dr(o.characterRooms))c.id===l&&SV({room:c,item:c.items[i]})}return s},FU=()=>{const t=af(),e=Nq();v.useEffect(()=>{if(e===void 0)return;const r=()=>{Ud()||(t(KM(zU(e.gameState,le.getState()))),uj.flush())},s=()=>{document.visibilityState==="hidden"&&(t(nw("hold")),r())};return document.addEventListener("visibilitychange",s),window.addEventListener("beforeunload",r),()=>{document.removeEventListener("visibilitychange",s),window.removeEventListener("beforeunload",r)}},[t,e])},LU=()=>{const t=X(r=>r.gameMenus.assigningInput!==void 0),e=X(r=>r.gameMenus.openMenus.length>0);Se({action:"menu_openOrExit",handler:v.useCallback(()=>{Ud()&&window.close(),le.dispatch(yA())},[]),disabled:t}),Se({action:"menu_exit",handler:z(yA),disabled:!e}),Se({action:"toggleShowFps",handler:z(Yt,{path:"showFps"}),disabled:e}),Se({action:"hold",handler:z(nw,"toggle"),disabled:t}),Se({action:"map",handler:z(GM),disabled:t}),v.useEffect(()=>{const r=()=>{};return window.addEventListener("blur",r,!1),()=>{window.removeEventListener("blur",r,!1)}}),Se({action:"toggleColourisation",handler:z(Yt,{path:"displaySettings.uncolourised"}),disabled:t}),Se({action:"toggleCrtFilter",handler:z(Yt,{path:"displaySettings.crtFilter"}),disabled:t}),Se({action:"cycleResolution",handler:z(_f,void 0),disabled:t})},UU=()=>(BU(),LU(),FU(),null),$U=t=>e=>(t(e),null),GU=()=>{const t=X(Af);v.useEffect(()=>{gt.shared.speed=t},[t])},HU=$U(GU);class WU extends v.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,r){console.error("Error caught in DispatchingErrorBoundary:",e),le.dispatch(wf(zi(e)))}render(){return this.props.children}}const YU=()=>{const{cssUpscale:t,canvasSize:e,rotate90:r}=X(Aw);return{transform:`scale(${t})`,width:r?e.y:e.x,height:r?e.x:e.y,transformOrigin:"top left"}},KU=()=>{const{canvasSize:t,rotate90:e}=X(Aw);return{transform:e?`rotate(90deg) translate(0, -${t.y}px)`:void 0,transformOrigin:"top left"}},Zy=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,QU=()=>{const t=bM(),e=X(gw);v.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",yt())},[]),v.useEffect(()=>{document.body.classList.remove(...Object.keys(Wn).map(Zy)),document.body.classList.add(Zy(t)),document.body.classList.toggle("portrait-rot",e)},[t,e])},XU=v.lazy(iI),eq=Bn(()=>Promise.all([IU(),jI(),NU()])),JU=()=>{const[t,e]=v.useState(),r=Sn(),s=X(i=>i.gameMenus.gameInPlay.campaignLocator),n=kf();return v.useEffect(()=>{if(!r){e(void 0),window._e2e_gamePageGameAi=void 0,eq();return}let i=!1,o;return(async()=>{let l=!1;try{if(s===void 0)throw new Error("game is marked as running, but we have no campaign locator, no way to know which campaign to load");l=!0,le.dispatch(ij());const[{default:c}]=await eq();le.dispatch(EA()),i||(o=await c(s,n),e(o),window._e2e_gamePageGameAi=o)}catch(c){l&&le.dispatch(EA()),console.error(c),le.dispatch(wf(zi(new Error("error in loading game assets or state",{cause:c}))))}})(),()=>{o?.stop(),i=!0}},[r,n,s]),t},ZU=()=>{const[t,e]=v.useState(null),r=Yb(),s=JU(),n=X($I),i=X(gw),o=YU();return QU(),v.useEffect(()=>{t===null||s===void 0||(s.renderIn(t),t.addEventListener("touchstart",a=>a.preventDefault(),{passive:!1}))},[s,t]),v.useEffect(()=>{s?.resizeTo(n,i)},[n,s,i]),p.jsxs(p.Fragment,{children:[p.jsx("div",{tabIndex:0,className:"fixed top-0",style:o,ref:e}),p.jsxs(X0,{gameApi:s,children:[p.jsxs(WU,{children:[p.jsx(nI,{}),p.jsx(UU,{}),p.jsx(HU,{}),p.jsx("div",{style:KU(),children:p.jsx(MU,{})})]}),s&&r&&p.jsx(v.Suspense,{fallback:null,children:p.jsx(XU,{})})]})]})},e$=Bn(()=>Nn(()=>import("./LutPage-BqPyEyg-.js"),__vite__mapDeps([14,2,3,7,9]))),t$=2,Ba=10,r$=({textureId:t,spritesheetSize:e})=>{const{frame:r}=ct.frames[t];return p.jsx("div",{className:"absolute border hover:bg-white group",style:{left:`${r.x/e.x*100}%`,top:`${r.y/e.y*100}%`,width:`${r.w/e.x*100}%`,height:`${r.h/e.y*100}%`},children:p.jsx("span",{className:"group-hover:inline text-pureBlack hidden",children:t})})},s$=()=>{const[t,e]=v.useState(null),[r,s]=v.useState(null),n=v.useRef(null),i=v.useRef(null);v.useEffect(()=>{const c=()=>{n.current&&s({x:n.current.naturalWidth,y:n.current.naturalHeight})},u=n.current;if(u)if(u.complete)c();else return u.addEventListener("load",c),()=>u.removeEventListener("load",c)},[]);const o=c=>{if(!n.current||!r)return;const u=n.current.getBoundingClientRect(),h=r.x/u.width,f=r.y/u.height,d=Math.floor((c.clientX-u.left)*h),m=Math.floor((c.clientY-u.top)*f);d>=0&&d<r.x&&m>=0&&m<r.y&&e({x:d,y:m})},a=()=>{e(null)};v.useEffect(()=>{console.log("spritesheetData:",ct)},[]);const l=Object.keys(ct.frames).sort();return p.jsxs("div",{ref:i,className:"relative w-full",onMouseMove:o,onMouseLeave:a,children:[p.jsx("img",{ref:n,src:fw,className:"w-full cursor-crosshair [background:repeating-conic-gradient(#999_0_25%,_#888_0_50%)_50%_/_20px_20px] pixelated"}),r&&l.map(c=>p.jsx(r$,{textureId:c,spritesheetSize:r},c)),t&&r&&n.current&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"absolute pointer-events-none border bg-pink outline-2",style:{left:`${t.x/r.x*100}%`,top:`${t.y/r.y*100}%`,width:`${1/r.x*100}%`,height:`${1/r.y*100}%`}}),p.jsxs("div",{className:"absolute pointer-events-none bg-black text-white px-1 text-xs font-mono",style:{left:`${t.x/r.x*100}%`,top:`calc(${t.y/r.y*100}% + 40px)`,transform:"translate(8px, -100%)"},children:[t.x,",",t.y]})]})]})},n$=({scale:t})=>{const e=Object.keys(ct.frames).sort();return p.jsxs("div",{className:"e2e-snapshot-target",children:[p.jsx(s$,{}),p.jsx("title",{children:"Sprites"}),p.jsx("div",{className:"flex flex-wrap p-[8px] bg-pureBlack",children:e.map(r=>{const{frame:s}=ct.frames[r],n=s;return p.jsxs("div",{className:"bg-shadow m-[4px] p-[8px] text-left flex flex-col w-8","data-texture-id":r,children:[p.jsx("div",{className:`
                  sprite bg-pureBlack hover:bg-moss border-shadow 
                  box-content w-min`,style:{"--x":`${ct.frames[r].frame.x}px`,"--y":`${ct.frames[r].frame.y}px`,"--h":`${ct.frames[r].frame.h}px`,"--w":`${ct.frames[r].frame.w}px`},children:n.pivot?p.jsx("div",{className:"bg-midRed relative",style:{width:`${Ba}px`,height:`${Ba}px`,left:`${n.pivot.x*t-Ba/2}px`,top:`${n.pivot.y*t-Ba/2}px`}}):null}),p.jsx("div",{className:"flex-grow"}),p.jsx("div",{className:"text-moss mt-1 flex-wrap flex-row flex",children:r.split(/(\.)/).map(i=>p.jsx("span",{children:i}))}),p.jsxs("div",{className:"text-lightGrey",children:[s.w,"x",s.h]}),n.pivot?p.jsxs("div",{className:"text-midRed",children:["pivot: (",n.pivot.x,",",n.pivot.y,")"]}):p.jsx("div",{className:"text-metallicBlue",children:"no pivot"}),p.jsxs("div",{className:"text-midGrey",children:["@(",s.x,",",s.y,")"]})]},r)})})]})},i$=()=>{const t=Wt().get("scale"),e=t?Number(t):t$;return p.jsx(yn,{scaleFactor:e,children:p.jsx(n$,{scale:e})})},o$=()=>p.jsxs(ze,{children:[p.jsx(xt,{className:"loading-border"}),p.jsxs(ke,{className:"bg-white zx:bg-zxRed gap-y-0 text-redShadow zx:text-zxBlack px-1 flex-row",children:[p.jsx("div",{className:"flex flex-col",children:wn.map(t=>p.jsx("span",{className:`sprite zx:sprite-revert-to-white ${Tn({action:"walking",character:"head",facingXy8:t})}`},t))}),p.jsxs("div",{className:"flex flex-col grow text-center justify-center",children:[p.jsx(j,{className:"sprites-double-height",children:"404 Not found"}),p.jsx(j,{className:`${ce} p-1 pt-2 text-metallicBlue zx:text-zxYellow`,children:"whatever youre looking for, it aint here"})]}),p.jsx("div",{className:"flex flex-col",children:wn.toReversed().map(t=>p.jsx("span",{className:`sprite zx:sprite-revert-to-white ${Tn({action:"walking",character:"heels",facingXy8:t})}`},t))})]})]}),a$=()=>p.jsxs(ze,{children:[p.jsx(xt,{className:"loading-border"}),p.jsxs(ke,{className:"bg-white zx:bg-zxRed gap-y-0 text-redShadow zx:text-zxBlack px-1 flex-row",children:[p.jsx("div",{className:"flex flex-col",children:wn.map(t=>p.jsx("span",{className:`sprite ${Tn({action:"idle",character:"head",facingXy8:t})}`},t))}),p.jsxs("div",{className:"flex flex-col grow text-center justify-center",children:[p.jsx(j,{className:"sprites-double-height mb-1",children:"This is not the editor"}),p.jsxs(rt,{className:`${ce} p-1 pt-2 text-metallicBlue`,children:[p.jsx("p",{children:"If youre seeing this, youre trying to access the level editor, but the web manifest is getting in the way and redirected you to the games client-side routing."}),p.jsxs("p",{className:"pt-1",children:["You could try going to:"," ",p.jsx("a",{href:"/editor/",className:"bitmap-text-link",children:"/editor/"})," ","(with a slash on the end)"]})]})]}),p.jsx("div",{className:"flex flex-col",children:wn.toReversed().map(t=>p.jsx("span",{className:`sprite ${Tn({action:"idle",character:"heels",facingXy8:t})}`},t))})]})]}),l$=v.lazy(e$),UV=Wt(),tq=UV.get("campaignName");tq!==null&&le.dispatch(co({campaignLocator:{userId:UV.get("campaignAuthorUserId")||"editorUser",campaignName:tq,version:-1},noShowCrowns:!0}));const c$=()=>{const t=yf();return v.useEffect(()=>{document.body.classList.toggle("zx",t),document.body.classList.toggle("colourised",!t)},[t]),p.jsxs(Iv,{children:[p.jsx(ei,{path:"/",children:p.jsx(yn,{children:p.jsx(jj,{children:p.jsx(ZU,{})})})}),p.jsx(ei,{path:"/sprites",children:p.jsx(i$,{})}),p.jsx(ei,{path:"/lut",children:p.jsx(l$,{})}),p.jsx(ei,{path:"/editor",children:p.jsx(yn,{children:p.jsx(a$,{})})}),p.jsx(ei,{children:p.jsx(yn,{children:p.jsx(o$,{})})})]})},u$=()=>p.jsx(lv,{store:le,children:p.jsx(c$,{})}),JG=Object.freeze(Object.defineProperty({__proto__:null,App:u$},Symbol.toStringTag,{value:"Module"}));export{xE as $,$l as A,Ji as B,be as C,So as D,os as E,Co as F,Gd as G,eg as H,Fa as I,Yd as J,Xt as K,Hx as L,pe as M,lE as N,uE as O,dt as P,pE as Q,bh as R,IC as S,Ae as T,ol as U,AE as V,Ul as W,oC as X,WS as Y,ko as Z,Ll as _,Qk as a,ix as a$,Ct as a0,yx as a1,nr as a2,vx as a3,Dm as a4,Ns as a5,_k as a6,Fm as a7,Hc as a8,Lm as a9,W as aA,J0 as aB,E$ as aC,LG as aD,G$ as aE,Qe as aF,rx as aG,S$ as aH,ex as aI,YG as aJ,tx as aK,CL as aL,FG as aM,Pn as aN,Dl as aO,Fq as aP,jr as aQ,U as aR,ep as aS,p$ as aT,cn as aU,Dd as aV,fe as aW,Kv as aX,Dr as aY,rp as aZ,Dz as a_,kk as aa,dx as ab,Ye as ac,bx as ad,Hl as ae,v1 as af,bt as ag,z_ as ah,k1 as ai,VS as aj,Ml as ak,Dn as al,Fd as am,ud as an,me as ao,T1 as ap,KG as aq,ee as ar,y$ as as,q$ as at,_o as au,A$ as av,b$ as aw,x$ as ax,Fn as ay,vy as az,St as b,Cg as b$,Qt as b0,Gq as b1,Sr as b2,aq as b3,$C as b4,NC as b5,cE as b6,hE as b7,gE as b8,yE as b9,Rd as bA,sw as bB,zM as bC,Me as bD,Ms as bE,I2 as bF,I$ as bG,Mr as bH,L$ as bI,IG as bJ,R2 as bK,Ht as bL,qn as bM,id as bN,wL as bO,Xz as bP,Br as bQ,Wz as bR,X as bS,QM as bT,x1 as bU,ot as bV,tg as bW,_x as bX,nn as bY,hi as bZ,_i as b_,qE as ba,Zl as bb,zI as bc,Wg as bd,Yl as be,T$ as bf,Tf as bg,IN as bh,ON as bi,NN as bj,DN as bk,zN as bl,LN as bm,FN as bn,BN as bo,SN as bp,OB as bq,j as br,yn as bs,af as bt,M$ as bu,O$ as bv,F$ as bw,C$ as bx,yf as by,zn as bz,za as c,yG as c$,YS as c0,K$ as c1,qh as c2,ct as c3,mn as c4,II as c5,RI as c6,PI as c7,sS as c8,OI as c9,E_ as cA,Hq as cB,V$ as cC,S_ as cD,hd as cE,pn as cF,wn as cG,x_ as cH,v$ as cI,k_ as cJ,cl as cK,bG as cL,AL as cM,cG as cN,lO as cO,zA as cP,lG as cQ,HG as cR,CG as cS,gG as cT,cz as cU,kl as cV,iG as cW,nG as cX,_V as cY,Yr as cZ,De as c_,SI as ca,le as cb,ts as cc,uG as cd,Q$ as ce,mo as cf,GG as cg,k$ as ch,mL as ci,Ci as cj,dh as ck,H$ as cl,ow as cm,xM as cn,dz as co,dG as cp,DG as cq,w$ as cr,Kf as cs,uO as ct,R$ as cu,Qr as cv,b_ as cw,f$ as cx,$q as cy,P_ as cz,we as d,pj as d$,sG as d0,J$ as d1,Vy as d2,F2 as d3,ad as d4,Zf as d5,yL as d6,Yz as d7,gL as d8,Uq as d9,xG as dA,L2 as dB,uz as dC,lz as dD,zG as dE,IM as dF,Lq as dG,Oe as dH,Kr as dI,$G as dJ,PG as dK,Ir as dL,zd as dM,xI as dN,hG as dO,fG as dP,pG as dQ,Kh as dR,W$ as dS,It as dT,RM as dU,MG as dV,N as dW,gb as dX,of as dY,GI as dZ,Wu as d_,Wy as da,ZF as db,__ as dc,nl as dd,un as de,w_ as df,AG as dg,Ot as dh,Yt as di,DM as dj,Mn as dk,zU as dl,D$ as dm,z$ as dn,jG as dp,Ty as dq,Ge as dr,UG as ds,lt as dt,In as du,N$ as dv,Vf as dw,yV as dx,dd as dy,Ts as dz,Ln as e,JG as e$,yj as e0,vj as e1,AO as e2,OG as e3,eh as e4,XG as e5,mm as e6,es as e7,Np as e8,dO as e9,aG as eA,m$ as eB,oG as eC,TG as eD,kG as eE,wG as eF,VG as eG,RG as eH,_G as eI,vG as eJ,BG as eK,NG as eL,E2 as eM,wf as eN,zi as eO,U$ as eP,P$ as eQ,j$ as eR,bf as eS,eG as eT,Z$ as eU,Y$ as eV,$$ as eW,QG as eX,B$ as eY,YM as eZ,WG as e_,SG as ea,Cf as eb,_M as ec,wM as ed,rr as ee,T_ as ef,jV as eg,yt as eh,$M as ei,Kz as ej,fd as ek,sp as el,Qz as em,ew as en,qL as eo,mz as ep,g$ as eq,Tr as er,mG as es,Jf as et,wV as eu,cO as ev,tG as ew,rG as ex,EG as ey,xV as ez,ll as f,xe as g,OE as h,kE as i,f1 as j,Rx as k,zt as l,xx as m,Sm as n,gt as o,Hn as p,_e as q,lk as r,Gl as s,Ld as t,Ue as u,at as v,Nt as w,sx as x,Kd as y,PC as z};
