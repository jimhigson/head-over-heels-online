const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebGPURenderer-CXNnIc3J.js","assets/index-DX-sRscx.js","assets/index-CziJ4dhK.css","assets/colorToUniform-KTpA7KSL.js","assets/SharedSystems-sLAsxfqT.js","assets/Graphics-lk1h6tKs.js","assets/levelEditorSlice-hju0TIcv.js","assets/WebGLRenderer-De7n5ZiD.js","assets/JsonRoomEditor-Nfa_NeQk.js","assets/JsonRoomEditor-Cpm53wG5.css"])))=>i.map(i=>d[i]);
import{a6 as Ka,a5 as _r,a7 as It,s as Mg,x as Gd,y as Ot,e as Xa,E as Yr,a as Lg,C as oe,d as Zr,v as Qr,Z as J,D as ta,az as qt,k as Bg,K as Sr,t as Tt,T as nr,U as Fg,M as Ug,aA as rr,V as qd,aB as Hg,w as na,aC as Wg,aD as Gg,j as qg,aE as An,aF as h,aG as Vd,aH as Vt,aI as m,aJ as Vg,aK as Ss,aL as Kd,aM as Kg,aN as ue,aO as He,aP as Xd,aQ as Xg,aR as Jg,aS as U,aT as Ge,aU as Cr,al as Yg,aV as Zg,aW as Qg,aX as Jd,aY as Yd,ae as de,ai as vn,aa as B,aZ as Zd,a_ as ar,a$ as ey,b0 as Cs,b1 as gn,ag as fr,b2 as co,an as kr,b3 as ty,b4 as ny,b5 as ry,ab as vt,ac as ls,ao as Kt,b6 as Ie,b7 as Qd,b8 as oy,af as sy,b9 as Rn,ap as eh,aq as th,au as cs,ba as us,bb as jt,bc as iy,bd as ay,av as ks,be as Ja,bf as Ya,bg as Vr,ad as lr,bh as nh,as as Za,bi as Qa,bj as ly,at as rh,bk as cy,bl as en,ah as uy,bm as dy,bn as el,bo as Yl,bp as hy,bq as fy,br as py,bs as tl,bt as my,bu as gy,bv as yy,bw as vy,bx as wy,by,bz as xy,bA as _y,bB as Sy,bC as Cy,bD as ky,bE as Ey,bF as Py,bG as Ty}from"./index-DX-sRscx.js";import{r as Ay,u as he,d as Ry,c as Iy,s as mn,a as wn,b as Oy,e as Zl,f as jy,g as $y,h as Ny,i as zy,j as Dy,k as My,l as Ly,m as pr,n as By,o as Fy,p as oh,q as Qs,t as sh,v as Uy,w as Hy,x as Wy,y as Gy,z as qy,A as Ee,B as Vy,C as Ky,D as Xy,E as nl,F as Jy,G as ra,H as mr,I as Yy,J as Zy,K as Qy,L as ih,M as ah,N as ev,O as tv,P as nv,Q as oa,R as uo,S as lh,T as rl,U as ol,V as ch,W as uh,X as rv,Y as Ql,Z as dh,_ as ov,$ as sv,a0 as iv,a1 as hh,a2 as fh,a3 as av,a4 as ei,a5 as lv,a6 as ec,a7 as ph,a8 as sa,a9 as mh,aa as cv,ab as uv,ac as gh}from"./levelEditorSlice-hju0TIcv.js";import{S as dv,G as ht}from"./Graphics-lk1h6tKs.js";function hv(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function fv(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function pv(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(n=>typeof n=="function")){const n=t.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${e}[${n}]`)}}var tc=t=>Array.isArray(t)?t:[t];function mv(t){const e=Array.isArray(t[0])?t[0]:t;return pv(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function gv(t,e){const n=[],{length:r}=t;for(let o=0;o<r;o++)n.push(t[o].apply(null,e));return n}var yv=class{constructor(t){this.value=t}deref(){return this.value}},vv=typeof WeakRef<"u"?WeakRef:yv,wv=0,nc=1;function xo(){return{s:wv,v:void 0,o:null,p:null}}function yh(t,e={}){let n=xo();const{resultEqualityCheck:r}=e;let o,s=0;function i(){let a=n;const{length:l}=arguments;for(let d=0,f=l;d<f;d++){const p=arguments[d];if(typeof p=="function"||typeof p=="object"&&p!==null){let g=a.o;g===null&&(a.o=g=new WeakMap);const y=g.get(p);y===void 0?(a=xo(),g.set(p,a)):a=y}else{let g=a.p;g===null&&(a.p=g=new Map);const y=g.get(p);y===void 0?(a=xo(),g.set(p,a)):a=y}}const c=a;let u;if(a.s===nc)u=a.v;else if(u=t.apply(null,arguments),s++,r){const d=o?.deref?.()??o;d!=null&&r(d,u)&&(u=d,s!==0&&s--),o=typeof u=="object"&&u!==null||typeof u=="function"?new vv(u):u}return c.s=nc,c.v=u,u}return i.clearCache=()=>{n=xo(),i.resetResultsCount()},i.resultsCount=()=>s,i.resetResultsCount=()=>{s=0},i}function bv(t,...e){const n=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,r=(...o)=>{let s=0,i=0,a,l={},c=o.pop();typeof c=="object"&&(l=c,c=o.pop()),hv(c,`createSelector expects an output function after the inputs, but received: [${typeof c}]`);const u={...n,...l},{memoize:d,memoizeOptions:f=[],argsMemoize:p=yh,argsMemoizeOptions:g=[]}=u,y=tc(f),v=tc(g),w=mv(o),_=d(function(){return s++,c.apply(null,arguments)},...y),x=p(function(){i++;const C=gv(w,arguments);return a=_.apply(null,C),a},...v);return Object.assign(x,{resultFunc:c,memoizedResultFunc:_,dependencies:w,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>a,recomputations:()=>s,resetRecomputations:()=>{s=0},memoize:d,argsMemoize:p})};return Object.assign(r,{withTypes:()=>r}),r}var vh=bv(yh),xv=Object.assign((t,e=vh)=>{fv(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const n=Object.keys(t),r=n.map(s=>t[s]);return e(r,(...s)=>s.reduce((i,a,l)=>(i[n[l]]=a,i),{}))},{withTypes:()=>xv}),_o={},rc;function wh(){if(rc)return _o;rc=1;var t=Ka(),e=t.mark(a);function n(c,u){var d;if(typeof Symbol>"u"||c[Symbol.iterator]==null){if(Array.isArray(c)||(d=r(c))||u){d&&(c=d);var f=0,p=function(){};return{s:p,n:function(){return f>=c.length?{done:!0}:{done:!1,value:c[f++]}},e:function(_){throw _},f:p}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var g=!0,y=!1,v;return{s:function(){d=c[Symbol.iterator]()},n:function(){var _=d.next();return g=_.done,_},e:function(_){y=!0,v=_},f:function(){try{!g&&d.return!=null&&d.return()}finally{if(y)throw v}}}}function r(c,u){if(c){if(typeof c=="string")return o(c,u);var d=Object.prototype.toString.call(c).slice(8,-1);if(d==="Object"&&c.constructor&&(d=c.constructor.name),d==="Map"||d==="Set")return Array.from(c);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return o(c,u)}}function o(c,u){(u==null||u>c.length)&&(u=c.length);for(var d=0,f=new Array(u);d<u;d++)f[d]=c[d];return f}var s=_r(),i=s.iterableCurry;function a(c,u){var d,f,p,g;return t.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d=0,f=n(c),v.prev=2,f.s();case 4:if((p=f.n()).done){v.next=10;break}return g=p.value,v.next=8,u(g,d++);case 8:v.next=4;break;case 10:v.next=15;break;case 12:v.prev=12,v.t0=v.catch(2),f.e(v.t0);case 15:return v.prev=15,f.f(),v.finish(15);case 18:case"end":return v.stop()}},e,null,[[2,12,15,18]])}_o.__map=a;var l=i(a);return _o.map=l,_o}var So={},oc;function _v(){if(oc)return So;oc=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,p=!1,g;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return f=v.done,v},e:function(v){p=!0,g=v},f:function(){try{!f&&c.return!=null&&c.return()}finally{if(p)throw g}}}}function e(a,l){if(a){if(typeof a=="string")return n(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return n(a,l)}}function n(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var r=_r(),o=r.iterableCurry;function s(a,l){var c=0,u=t(a),d;try{for(u.s();!(d=u.n()).done;){var f=d.value;if(l(f,c++))return!0}}catch(p){u.e(p)}finally{u.f()}return!1}So.__some=s;var i=o(s,{reduces:!0});return So.some=i,So}var Co={},sc;function Sv(){if(sc)return Co;sc=1;var t=Ka(),e=t.mark(s),n=_r(),r=n.wrapWithIterableIterator,o=n.ensureIterable;function s(){var a,l,c,u,d,f,p=arguments;return t.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:for(a=p.length,l=new Array(a),c=0;c<a;c++)l[c]=p[c];u=0,d=l;case 2:if(!(u<d.length)){y.next=8;break}return f=d[u],y.delegateYield(o(f),"t0",5);case 5:u++,y.next=2;break;case 8:case"end":return y.stop()}},e)}Co.__concat=s;var i=r(s);return Co.concat=i,Co}var ko={},ic;function Cv(){if(ic)return ko;ic=1;var t=Ka(),e=t.mark(c);function n(d,f){var p;if(typeof Symbol>"u"||d[Symbol.iterator]==null){if(Array.isArray(d)||(p=r(d))||f){p&&(d=p);var g=0,y=function(){};return{s:y,n:function(){return g>=d.length?{done:!0}:{done:!1,value:d[g++]}},e:function(b){throw b},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,w=!1,_;return{s:function(){p=d[Symbol.iterator]()},n:function(){var b=p.next();return v=b.done,b},e:function(b){w=!0,_=b},f:function(){try{!v&&p.return!=null&&p.return()}finally{if(w)throw _}}}}function r(d,f){if(d){if(typeof d=="string")return o(d,f);var p=Object.prototype.toString.call(d).slice(8,-1);if(p==="Object"&&d.constructor&&(p=d.constructor.name),p==="Map"||p==="Set")return Array.from(d);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return o(d,f)}}function o(d,f){(f==null||f>d.length)&&(f=d.length);for(var p=0,g=new Array(f);p<f;p++)g[p]=d[p];return g}var s=_r(),i=s.iterableCurry,a=wh(),l=a.__map;function c(d,f){var p,g,y;return t.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:p=n(l(d,f)),w.prev=1,p.s();case 3:if((g=p.n()).done){w.next=8;break}return y=g.value,w.delegateYield(y,"t0",6);case 6:w.next=3;break;case 8:w.next=13;break;case 10:w.prev=10,w.t1=w.catch(1),p.e(w.t1);case 13:return w.prev=13,p.f(),w.finish(13);case 16:case"end":return w.stop()}},e,null,[[1,10,13,16]])}ko.__flatMap=c;var u=i(c);return ko.flatMap=u,ko}var Eo={},ac;function kv(){if(ac)return Eo;ac=1;var t=_r(),e=t.iterableCurry,n=Ay(),r=n.__firstOr,o=Symbol("none");function s(a){return r(a,o)===o}Eo.__isEmpty=s;var i=e(s,{reduces:!0});return Eo.isEmpty=i,Eo}var Po={},lc;function Ev(){if(lc)return Po;lc=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,p=!1,g;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return f=v.done,v},e:function(v){p=!0,g=v},f:function(){try{!f&&c.return!=null&&c.return()}finally{if(p)throw g}}}}function e(a,l){if(a){if(typeof a=="string")return n(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return n(a,l)}}function n(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var r=_r(),o=r.ensureIterable;function s(a){var l=o(a),c=0,u=t(l),d;try{for(u.s();!(d=u.n()).done;){var f=d.value;c++}}catch(p){u.e(p)}finally{u.f()}return c}Po.__size=s;var i=s;return Po.size=i,Po}var ti,cc;function Pv(){return cc||(cc=1,ti=Sv().concat),ti}var Tv=Pv();const uc=It(Tv);var ni,dc;function Av(){return dc||(dc=1,ni=Cv().flatMap),ni}var Rv=Av();const Iv=It(Rv);var ri,hc;function Ov(){return hc||(hc=1,ri=kv().isEmpty),ri}var jv=Ov();const bh=It(jv);var oi,fc;function $v(){return fc||(fc=1,oi=wh().map),oi}var Nv=$v();const pc=It(Nv);var si={},mc;function zv(){if(mc)return si;mc=1;var t=function(r){return r};function e(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return r.length||(r=[t]),r.reduce(function(s,i){return function(){return i(s.apply(void 0,arguments))}})}return si.pipe=e,si}var ii,gc;function Dv(){return gc||(gc=1,ii=zv().pipe),ii}var Mv=Dv();const yc=It(Mv);var ai,vc;function Lv(){return vc||(vc=1,ai=Ev().size),ai}var Bv=Lv();const xh=It(Bv);var li,wc;function Fv(){return wc||(wc=1,li=_v().some),li}var Uv=Fv();const Hv=It(Uv),_h=class ia extends Mg{constructor(e){e={...ia.defaultOptions,...e},super(e),this.enabled=!0,this._state=dv.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(e,n,r,o){e.applyFilter(this,n,r,o)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:n,gl:r,...o}=e;let s,i;return n&&(s=Gd.from(n)),r&&(i=Ot.from(r)),new ia({gpuProgram:s,glProgram:i,...o})}};_h.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let tn=_h;const aa=[];Xa.handleByNamedList(Yr.Environment,aa);async function Wv(t){if(!t)for(let e=0;e<aa.length;e++){const n=aa[e];if(n.value.test()){await n.value.load();return}}}let Or;function Gv(){if(typeof Or=="boolean")return Or;try{Or=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Or=!1}return Or}var Sh=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(Sh||{});class qv{constructor(e){this.items=[],this._name=e}emit(e,n,r,o,s,i,a,l){const{name:c,items:u}=this;for(let d=0,f=u.length;d<f;d++)u[d][c](e,n,r,o,s,i,a,l);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const n=this.items.indexOf(e);return n!==-1&&this.items.splice(n,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const Vv=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Ch=class kh extends Lg{constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;const n=[...Vv,...this.config.runners??[]];this._addRunners(...n),this._unsafeEvalCheck()}async init(e={}){const n=e.skipExtensionImports===!0?!0:e.manageImports===!1;await Wv(n),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const r in this._systemsHash)e={...this._systemsHash[r].constructor.defaultOptions,...e};e={...kh.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let r=0;r<this.runners.init.items.length;r++)await this.runners.init.items[r].init(e);this._initOptions=e}render(e,n){let r=e;if(r instanceof oe&&(r={container:r},n&&(Zr(Qr,"passing a second argument is deprecated, please use render options instead"),r.target=n.renderTexture)),r.target||(r.target=this.view.renderTarget),r.target===this.view.renderTarget&&(this._lastObjectRendered=r.container,r.clearColor??(r.clearColor=this.background.colorRgba),r.clear??(r.clear=this.background.clearBeforeRender)),r.clearColor){const o=Array.isArray(r.clearColor)&&r.clearColor.length===4;r.clearColor=o?r.clearColor:J.shared.setValue(r.clearColor).toArray()}r.transform||(r.container.updateLocalTransform(),r.transform=r.container.localTransform),r.container.enableRenderGroup(),this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r)}resize(e,n,r){const o=this.view.resolution;this.view.resize(e,n,r),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),r!==void 0&&r!==o&&this.runners.resolutionChange.emit(r)}clear(e={}){const n=this;e.target||(e.target=n.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=Sh.ALL);const{clear:r,clearColor:o,target:s}=e;J.shared.setValue(o??this.background.colorRgba),n.renderTarget.clear(s,r,J.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(n=>{this.runners[n]=new qv(n)})}_addSystems(e){let n;for(n in e){const r=e[n];this._addSystem(r.value,r.name)}}_addSystem(e,n){const r=new e(this);if(this[n])throw new Error(`Whoops! The name "${n}" is already in use`);this[n]=r,this._systemsHash[n]=r;for(const o in this.runners)this.runners[o].add(r);return this}_addPipes(e,n){const r=n.reduce((o,s)=>(o[s.name]=s.value,o),{});e.forEach(o=>{const s=o.value,i=o.name,a=r[i];this.renderPipes[i]=new s(this,a?new a:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(n=>{n.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!Gv())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Ch.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Eh=Ch,To;function Kv(t){return To!==void 0||(To=(()=>{const e={stencil:!0,failIfMajorPerformanceCaveat:t??Eh.defaultOptions.failIfMajorPerformanceCaveat};try{if(!ta.get().getWebGLRenderingContext())return!1;let r=ta.get().createCanvas().getContext("webgl",e);const o=!!r?.getContextAttributes()?.stencil;if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,o}catch{return!1}})()),To}let Ao;async function Xv(t={}){return Ao!==void 0||(Ao=await(async()=>{const e=ta.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(t)).requestDevice(),!0}catch{return!1}})()),Ao}const bc=["webgl","webgpu","canvas"];async function Jv(t){let e=[];t.preference?(e.push(t.preference),bc.forEach(s=>{s!==t.preference&&e.push(s)})):e=bc.slice();let n,r={};for(let s=0;s<e.length;s++){const i=e[s];if(i==="webgpu"&&await Xv()){const{WebGPURenderer:a}=await qt(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-CXNnIc3J.js");return{WebGPURenderer:l}},__vite__mapDeps([0,1,2,3,4,5,6]));n=a,r={...t,...t.webgpu};break}else if(i==="webgl"&&Kv(t.failIfMajorPerformanceCaveat??Eh.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await qt(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-De7n5ZiD.js");return{WebGLRenderer:l}},__vite__mapDeps([7,1,2,3,4,5,6]));n=a,r={...t,...t.webgl};break}else if(i==="canvas")throw r={...t},new Error("CanvasRenderer is not yet implemented")}if(delete r.webgpu,delete r.webgl,!n)throw new Error("No available renderer for the current environment");const o=new n;return await o.init(r),o}const Ph="8.8.1";class Th{static init(){globalThis.__PIXI_APP_INIT__?.(this,Ph)}static destroy(){}}Th.extension=Yr.Application;class Yv{constructor(e){this._renderer=e}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,Ph)}destroy(){this._renderer=null}}Yv.extension={type:[Yr.WebGLSystem,Yr.WebGPUSystem],name:"initHook",priority:-10};const Ah=class la{constructor(...e){this.stage=new oe,e[0]!==void 0&&Zr(Qr,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await Jv(e),la._plugins.forEach(n=>{n.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return Zr(Qr,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,n=!1){const r=la._plugins.slice(0);r.reverse(),r.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(n),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Ah._plugins=[];let Rh=Ah;Xa.handleByList(Yr.Application,Rh._plugins);Xa.add(Th);var Zv=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Qv=`
in vec2 vTextureCoord;

out vec4 finalColor;

uniform float uAlpha;
uniform sampler2D uTexture;

void main()
{
    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;
}
`,xc=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
 
    var sample = textureSample(uTexture, uSampler, uv);
    
    return sample * alphaUniforms.uAlpha;
}`;const Ih=class Oh extends tn{constructor(e){e={...Oh.defaultOptions,...e};const n=Gd.from({vertex:{source:xc,entryPoint:"mainVertex"},fragment:{source:xc,entryPoint:"mainFragment"}}),r=Ot.from({vertex:Zv,fragment:Qv,name:"alpha-filter"}),{alpha:o,...s}=e,i=new Bg({uAlpha:{value:o,type:"f32"}});super({...s,gpuProgram:n,glProgram:r,resources:{alphaUniforms:i}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(e){this.resources.alphaUniforms.uniforms.uAlpha=e}};Ih.defaultOptions={alpha:1};let ew=Ih;class eo extends Sr{constructor(...e){let n=e[0];Array.isArray(e[0])&&(n={textures:e[0],autoUpdate:e[1]});const{animationSpeed:r=1,autoPlay:o=!1,autoUpdate:s=!0,loop:i=!0,onComplete:a=null,onFrameChange:l=null,onLoop:c=null,textures:u,updateAnchor:d=!1,...f}=n,[p]=u;super({...f,texture:p instanceof Tt?p:p.texture}),this._textures=null,this._durations=null,this._autoUpdate=s,this._isConnectedToTicker=!1,this.animationSpeed=r,this.loop=i,this.updateAnchor=d,this.onComplete=a,this.onFrameChange=l,this.onLoop=c,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=u,o&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(nr.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(nr.shared.add(this.update,this,Fg.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const n=e.deltaTime,r=this.animationSpeed*n,o=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=r/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*n);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o||this.animationSpeed<0&&this.currentFrame>o)&&this.onLoop(),this._updateTexture())}_updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const n=[];for(let r=0;r<e.length;++r)n.push(Tt.from(e[r]));return new eo(n)}static fromImages(e){const n=[];for(let r=0;r<e.length;++r)n.push(Tt.from(e[r]));return new eo(n)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof Tt)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let n=0;n<e.length;n++)this._textures.push(e[n].texture),this._durations.push(e[n].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const n=this.currentFrame;this._currentTime=e,n!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(nr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(nr.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class tw{constructor({matrix:e,observer:n}={}){this.dirty=!0,this._matrix=e??new Ug,this.observer=n,this.position=new rr(this,0,0),this.scale=new rr(this,1,1),this.pivot=new rr(this,0,0),this.skew=new rr(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}_onUpdate(e){this.dirty=!0,e===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}}const jh=class Xo extends qd{constructor(...e){let n=e[0]||{};n instanceof Tt&&(n={texture:n}),e.length>1&&(Zr(Qr,"use new TilingSprite({ texture, width:100, height:100 }) instead"),n.width=e[1],n.height=e[2]),n={...Xo.defaultOptions,...n};const{texture:r,anchor:o,tilePosition:s,tileScale:i,tileRotation:a,width:l,height:c,applyAnchorToTexture:u,roundPixels:d,...f}=n??{};super({label:"TilingSprite",...f}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new rr({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=u,this.texture=r,this._width=l??r.width,this._height=c??r.height,this._tileTransform=new tw({observer:{_onUpdate:()=>this.onViewUpdate()}}),o&&(this.anchor=o),this.tilePosition=s,this.tileScale=i,this.tileRotation=a,this.roundPixels=d??!1}static from(e,n={}){return typeof e=="string"?new Xo({texture:Hg.get(e),...n}):new Xo({texture:e,...n})}get uvRespectAnchor(){return na("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){na("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){typeof e=="number"?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=Tt.EMPTY);const n=this._texture;n!==e&&(n&&n.dynamic&&n.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,n){typeof e=="object"&&(n=e.height??e.width,e=e.width),this._width=e,this._height=n??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){const e=this._bounds,n=this._anchor,r=this._width,o=this._height;e.minX=-n._x*r,e.maxX=e.minX+r,e.minY=-n._y*o,e.maxY=e.minY+o}containsPoint(e){const n=this._width,r=this._height,o=-n*this._anchor._x;let s=0;return e.x>=o&&e.x<=o+n&&(s=-r*this._anchor._y,e.y>=s&&e.y<=s+r)}destroy(e=!1){if(super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof e=="boolean"?e:e?.texture){const r=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(r)}this._texture=null}};jh.defaultOptions={texture:Tt.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let nw=jh;class rw extends qd{constructor(e,n){const{text:r,resolution:o,style:s,anchor:i,width:a,height:l,roundPixels:c,...u}=e;super({...u}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=n,this.text=r??"",this.style=s,this.resolution=o??null,this.allowChildren=!1,this._anchor=new rr({_onUpdate:()=>{this.onViewUpdate()}}),i&&(this.anchor=i),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){e||(e={}),this._style?.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,n){typeof e=="object"?(n=e.height??e.width,e=e.width):n??(n=e),e!==void 0&&this._setWidth(e,this.bounds.width),n!==void 0&&this._setHeight(n,this.bounds.height)}containsPoint(e){const n=this.bounds.width,r=this.bounds.height,o=-n*this.anchor.x;let s=0;return e.x>=o&&e.x<=o+n&&(s=-r*this.anchor.y,e.y>=s&&e.y<=s+r)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e?.style)&&this._style.destroy(e),this._style=null,this._text=null}}function ow(t,e){let n=t[0]??{};return(typeof n=="string"||t[1])&&(Zr(Qr,`use new ${e}({ text: "hi!", style }) instead`),n={text:n,style:t[1]}),n}class sw extends rw{constructor(...e){const n=ow(e,"Text");super(n,Wg),this.renderPipeId="text"}updateBounds(){const e=this._bounds,n=this._anchor,r=Gg.measureText(this._text,this._style),{width:o,height:s}=r;e.minX=-n._x*o,e.maxX=e.minX+o,e.minY=-n._y*s,e.maxY=e.minY+s}}class sl extends Tt{static create(e){return new sl({source:new qg(e)})}resize(e,n,r){return this.source.resize(e,n,r),this}}const $h=class Nh extends oe{constructor(e={}){e={...Nh.defaultOptions,...e},super(),this.renderLayerChildren=[],this.sortableChildren=e.sortableChildren,this.sortFunction=e.sortFunction}attach(...e){for(let n=0;n<e.length;n++){const r=e[n];if(r.parentRenderLayer){if(r.parentRenderLayer===this)continue;r.parentRenderLayer.detach(r)}this.renderLayerChildren.push(r),r.parentRenderLayer=this;const o=this.renderGroup||this.parentRenderGroup;o&&(o.structureDidChange=!0)}return e[0]}detach(...e){for(let n=0;n<e.length;n++){const r=e[n],o=this.renderLayerChildren.indexOf(r);o!==-1&&this.renderLayerChildren.splice(o,1),r.parentRenderLayer=null;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)}return e[0]}detachAll(){const e=this.renderLayerChildren;for(let n=0;n<e.length;n++)e[n].parentRenderLayer=null;this.renderLayerChildren.length=0}collectRenderables(e,n,r){const o=this.renderLayerChildren,s=o.length;this.sortableChildren&&this.sortRenderLayerChildren();for(let i=0;i<s;i++)o[i].parent||na("Container must be added to both layer and scene graph. Layers only handle render order - the scene graph is required for transforms (addChild)",o[i]),o[i].collectRenderables(e,n,this)}sortRenderLayerChildren(){this.renderLayerChildren.sort(this.sortFunction)}_getGlobalBoundsRecursive(e,n,r){if(!e)return;const o=this.renderLayerChildren;for(let s=0;s<o.length;s++)o[s]._getGlobalBoundsRecursive(!0,n,this)}};$h.defaultOptions={sortableChildren:!1,sortFunction:(t,e)=>t.zIndex-e.zIndex};let iw=$h;const _c=iw,il="-",aw=t=>{const e=cw(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:i=>{const a=i.split(il);return a[0]===""&&a.length!==1&&a.shift(),zh(a,e)||lw(i)},getConflictingClassGroupIds:(i,a)=>{const l=n[i]||[];return a&&r[i]?[...l,...r[i]]:l}}},zh=(t,e)=>{if(t.length===0)return e.classGroupId;const n=t[0],r=e.nextPart.get(n),o=r?zh(t.slice(1),r):void 0;if(o)return o;if(e.validators.length===0)return;const s=t.join(il);return e.validators.find(({validator:i})=>i(s))?.classGroupId},Sc=/^\[(.+)\]$/,lw=t=>{if(Sc.test(t)){const e=Sc.exec(t)[1],n=e?.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},cw=t=>{const{theme:e,prefix:n}=t,r={nextPart:new Map,validators:[]};return dw(Object.entries(t.classGroups),n).forEach(([s,i])=>{ca(i,r,s,e)}),r},ca=(t,e,n,r)=>{t.forEach(o=>{if(typeof o=="string"){const s=o===""?e:Cc(e,o);s.classGroupId=n;return}if(typeof o=="function"){if(uw(o)){ca(o(r),e,n,r);return}e.validators.push({validator:o,classGroupId:n});return}Object.entries(o).forEach(([s,i])=>{ca(i,Cc(e,s),n,r)})})},Cc=(t,e)=>{let n=t;return e.split(il).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},uw=t=>t.isThemeGetter,dw=(t,e)=>e?t.map(([n,r])=>{const o=r.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([i,a])=>[e+i,a])):s);return[n,o]}):t,hw=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,r=new Map;const o=(s,i)=>{n.set(s,i),e++,e>t&&(e=0,r=n,n=new Map)};return{get(s){let i=n.get(s);if(i!==void 0)return i;if((i=r.get(s))!==void 0)return o(s,i),i},set(s,i){n.has(s)?n.set(s,i):o(s,i)}}},Dh="!",fw=t=>{const{separator:e,experimentalParseClassName:n}=t,r=e.length===1,o=e[0],s=e.length,i=a=>{const l=[];let c=0,u=0,d;for(let v=0;v<a.length;v++){let w=a[v];if(c===0){if(w===o&&(r||a.slice(v,v+s)===e)){l.push(a.slice(u,v)),u=v+s;continue}if(w==="/"){d=v;continue}}w==="["?c++:w==="]"&&c--}const f=l.length===0?a:a.substring(u),p=f.startsWith(Dh),g=p?f.substring(1):f,y=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:p,baseClassName:g,maybePostfixModifierPosition:y}};return n?a=>n({className:a,parseClassName:i}):i},pw=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(r=>{r[0]==="["?(e.push(...n.sort(),r),n=[]):n.push(r)}),e.push(...n.sort()),e},mw=t=>({cache:hw(t.cacheSize),parseClassName:fw(t),...aw(t)}),gw=/\s+/,yw=(t,e)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:o}=e,s=[],i=t.trim().split(gw);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:d,baseClassName:f,maybePostfixModifierPosition:p}=n(c);let g=!!p,y=r(g?f.substring(0,p):f);if(!y){if(!g){a=c+(a.length>0?" "+a:a);continue}if(y=r(f),!y){a=c+(a.length>0?" "+a:a);continue}g=!1}const v=pw(u).join(":"),w=d?v+Dh:v,_=w+y;if(s.includes(_))continue;s.push(_);const x=o(y,g);for(let b=0;b<x.length;++b){const C=x[b];s.push(w+C)}a=c+(a.length>0?" "+a:a)}return a};function vw(){let t=0,e,n,r="";for(;t<arguments.length;)(e=arguments[t++])&&(n=Mh(e))&&(r&&(r+=" "),r+=n);return r}const Mh=t=>{if(typeof t=="string")return t;let e,n="";for(let r=0;r<t.length;r++)t[r]&&(e=Mh(t[r]))&&(n&&(n+=" "),n+=e);return n};function ww(t,...e){let n,r,o,s=i;function i(l){const c=e.reduce((u,d)=>d(u),t());return n=mw(c),r=n.cache.get,o=n.cache.set,s=a,a(l)}function a(l){const c=r(l);if(c)return c;const u=yw(l,n);return o(l,u),u}return function(){return s(vw.apply(null,arguments))}}const me=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},Lh=/^\[(?:([a-z-]+):)?(.+)\]$/i,bw=/^\d+\/\d+$/,xw=new Set(["px","full","screen"]),_w=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Sw=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Cw=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,kw=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Ew=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,bt=t=>cr(t)||xw.has(t)||bw.test(t),$t=t=>Er(t,"length",$w),cr=t=>!!t&&!Number.isNaN(Number(t)),ci=t=>Er(t,"number",cr),jr=t=>!!t&&Number.isInteger(Number(t)),Pw=t=>t.endsWith("%")&&cr(t.slice(0,-1)),te=t=>Lh.test(t),Nt=t=>_w.test(t),Tw=new Set(["length","size","percentage"]),Aw=t=>Er(t,Tw,Bh),Rw=t=>Er(t,"position",Bh),Iw=new Set(["image","url"]),Ow=t=>Er(t,Iw,zw),jw=t=>Er(t,"",Nw),$r=()=>!0,Er=(t,e,n)=>{const r=Lh.exec(t);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):n(r[2]):!1},$w=t=>Sw.test(t)&&!Cw.test(t),Bh=()=>!1,Nw=t=>kw.test(t),zw=t=>Ew.test(t),Dw=()=>{const t=me("colors"),e=me("spacing"),n=me("blur"),r=me("brightness"),o=me("borderColor"),s=me("borderRadius"),i=me("borderSpacing"),a=me("borderWidth"),l=me("contrast"),c=me("grayscale"),u=me("hueRotate"),d=me("invert"),f=me("gap"),p=me("gradientColorStops"),g=me("gradientColorStopPositions"),y=me("inset"),v=me("margin"),w=me("opacity"),_=me("padding"),x=me("saturate"),b=me("scale"),C=me("sepia"),k=me("skew"),S=me("space"),$=me("translate"),H=()=>["auto","contain","none"],D=()=>["auto","hidden","clip","visible","scroll"],q=()=>["auto",te,e],O=()=>[te,e],ee=()=>["",bt,$t],M=()=>["auto",cr,te],K=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],X=()=>["solid","dashed","dotted","double","none"],Z=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],F=()=>["start","end","center","between","around","evenly","stretch"],ie=()=>["","0",te],ve=()=>["auto","avoid","all","avoid-page","page","left","right","column"],pe=()=>[cr,te];return{cacheSize:500,separator:":",theme:{colors:[$r],spacing:[bt,$t],blur:["none","",Nt,te],brightness:pe(),borderColor:[t],borderRadius:["none","","full",Nt,te],borderSpacing:O(),borderWidth:ee(),contrast:pe(),grayscale:ie(),hueRotate:pe(),invert:ie(),gap:O(),gradientColorStops:[t],gradientColorStopPositions:[Pw,$t],inset:q(),margin:q(),opacity:pe(),padding:O(),saturate:pe(),scale:pe(),sepia:ie(),skew:pe(),space:O(),translate:O()},classGroups:{aspect:[{aspect:["auto","square","video",te]}],container:["container"],columns:[{columns:[Nt]}],"break-after":[{"break-after":ve()}],"break-before":[{"break-before":ve()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...K(),te]}],overflow:[{overflow:D()}],"overflow-x":[{"overflow-x":D()}],"overflow-y":[{"overflow-y":D()}],overscroll:[{overscroll:H()}],"overscroll-x":[{"overscroll-x":H()}],"overscroll-y":[{"overscroll-y":H()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[y]}],"inset-x":[{"inset-x":[y]}],"inset-y":[{"inset-y":[y]}],start:[{start:[y]}],end:[{end:[y]}],top:[{top:[y]}],right:[{right:[y]}],bottom:[{bottom:[y]}],left:[{left:[y]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",jr,te]}],basis:[{basis:q()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",te]}],grow:[{grow:ie()}],shrink:[{shrink:ie()}],order:[{order:["first","last","none",jr,te]}],"grid-cols":[{"grid-cols":[$r]}],"col-start-end":[{col:["auto",{span:["full",jr,te]},te]}],"col-start":[{"col-start":M()}],"col-end":[{"col-end":M()}],"grid-rows":[{"grid-rows":[$r]}],"row-start-end":[{row:["auto",{span:[jr,te]},te]}],"row-start":[{"row-start":M()}],"row-end":[{"row-end":M()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",te]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",te]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...F()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...F(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...F(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",te,e]}],"min-w":[{"min-w":[te,e,"min","max","fit"]}],"max-w":[{"max-w":[te,e,"none","full","min","max","fit","prose",{screen:[Nt]},Nt]}],h:[{h:[te,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[te,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[te,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[te,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Nt,$t]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ci]}],"font-family":[{font:[$r]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",te]}],"line-clamp":[{"line-clamp":["none",cr,ci]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",bt,te]}],"list-image":[{"list-image":["none",te]}],"list-style-type":[{list:["none","disc","decimal",te]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...X(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",bt,$t]}],"underline-offset":[{"underline-offset":["auto",bt,te]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:O()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",te]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",te]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...K(),Rw]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Aw]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Ow]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[g]}],"gradient-via-pos":[{via:[g]}],"gradient-to-pos":[{to:[g]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[...X(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:X()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...X()]}],"outline-offset":[{"outline-offset":[bt,te]}],"outline-w":[{outline:[bt,$t]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:ee()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[bt,$t]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Nt,jw]}],"shadow-color":[{shadow:[$r]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":[...Z(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Z()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Nt,te]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[x]}],sepia:[{sepia:[C]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[x]}],"backdrop-sepia":[{"backdrop-sepia":[C]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",te]}],duration:[{duration:pe()}],ease:[{ease:["linear","in","out","in-out",te]}],delay:[{delay:pe()}],animate:[{animate:["none","spin","ping","pulse","bounce",te]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[jr,te]}],"translate-x":[{"translate-x":[$]}],"translate-y":[{"translate-y":[$]}],"skew-x":[{"skew-x":[k]}],"skew-y":[{"skew-y":[k]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",te]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",te]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":O()}],"scroll-mx":[{"scroll-mx":O()}],"scroll-my":[{"scroll-my":O()}],"scroll-ms":[{"scroll-ms":O()}],"scroll-me":[{"scroll-me":O()}],"scroll-mt":[{"scroll-mt":O()}],"scroll-mr":[{"scroll-mr":O()}],"scroll-mb":[{"scroll-mb":O()}],"scroll-ml":[{"scroll-ml":O()}],"scroll-p":[{"scroll-p":O()}],"scroll-px":[{"scroll-px":O()}],"scroll-py":[{"scroll-py":O()}],"scroll-ps":[{"scroll-ps":O()}],"scroll-pe":[{"scroll-pe":O()}],"scroll-pt":[{"scroll-pt":O()}],"scroll-pr":[{"scroll-pr":O()}],"scroll-pb":[{"scroll-pb":O()}],"scroll-pl":[{"scroll-pl":O()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",te]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[bt,$t,ci]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},al=ww(Dw);function Fh(t){if(!ds(t))throw new Error(`Invalid textureId: "${t}"; textureId  {${Object.keys(An.frames).sort().map(e=>`"${e}"`).join(`,
`)}}`)}function ds(t){return An.frames[t]!==void 0}function Uh(t){return An.animations[t]!==void 0}const Mw=({className:t,children:e})=>t?h.jsx("div",{className:`contents ${t}`,children:e}):e,Lw=t=>t.replaceAll(".","_"),L=({children:t,className:e,noSlitWords:n,classnameCycle:r,onClick:o,noTint:s=!1,TagName:i="span"})=>{const a=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(a.length===0)return null;const l=n?[a.toUpperCase()]:a.toUpperCase().split(/\s+/);return h.jsxs(i,{className:e,onClick:o,children:[h.jsx("span",{className:"sr-only",children:a}),l.map((c,u)=>h.jsx("span",{className:al("text-nowrap inline-block",u===l.length-1?"":"me-1"),children:Array.from(c).map((d,f)=>{const p=`hud.char.${Vd(d)}`;return ds(p)||console.error("no texture for char",d,d.charCodeAt(0),p,"we have:",Object.keys(Vt().textures)),h.jsx("span",{className:`sprite ${ds(p)?`texture-${Lw(p)}`:"texture-hud_char_?"}
                  ${s?"":"sprite-tinted"}
                  ${r===void 0?"":r[f%r.length]}`},f)})},u))]})},Bw=t=>t.props.children!==void 0,tt=({children:t,className:e})=>h.jsx(Mw,{className:e,children:Array.isArray(t)?t.map((n,r)=>h.jsx(tt,{children:n},r)):typeof t=="number"?h.jsx(L,{children:String(t)}):typeof t=="string"?h.jsx(L,{children:t}):m.isValidElement(t)?t.type===L||t.type===tt?t:Bw(t)?m.cloneElement(t,void 0,typeof t.props.children=="string"?h.jsx(L,{children:`${t.props.children}`}):h.jsx(tt,{children:t.props.children})):t:t});function Ke(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t?.(o),n===!1||!o.defaultPrevented)return e?.(o)}}function kc(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Hh(...t){return e=>{let n=!1;const r=t.map(o=>{const s=kc(o,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():kc(t[o],null)}}}}function at(...t){return m.useCallback(Hh(...t),t)}function Fw(t,e){const n=m.createContext(e),r=s=>{const{children:i,...a}=s,l=m.useMemo(()=>a,Object.values(a));return h.jsx(n.Provider,{value:l,children:i})};r.displayName=t+"Provider";function o(s){const i=m.useContext(n);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[r,o]}function ll(t,e=[]){let n=[];function r(s,i){const a=m.createContext(i),l=n.length;n=[...n,i];const c=d=>{const{scope:f,children:p,...g}=d,y=f?.[t]?.[l]||a,v=m.useMemo(()=>g,Object.values(g));return h.jsx(y.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(d,f){const p=f?.[t]?.[l]||a,g=m.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=n.map(i=>m.createContext(i));return function(a){const l=a?.[t]||s;return m.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[r,Uw(o,...e)]}function Uw(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}var Es=Vg();const Wh=It(Es);var Ps=m.forwardRef((t,e)=>{const{children:n,...r}=t,o=m.Children.toArray(n),s=o.find(Ww);if(s){const i=s.props.children,a=o.map(l=>l===s?m.Children.count(i)>1?m.Children.only(null):m.isValidElement(i)?i.props.children:null:l);return h.jsx(ua,{...r,ref:e,children:m.isValidElement(i)?m.cloneElement(i,void 0,a):null})}return h.jsx(ua,{...r,ref:e,children:n})});Ps.displayName="Slot";var ua=m.forwardRef((t,e)=>{const{children:n,...r}=t;if(m.isValidElement(n)){const o=qw(n),s=Gw(r,n.props);return n.type!==m.Fragment&&(s.ref=e?Hh(e,o):o),m.cloneElement(n,s)}return m.Children.count(n)>1?m.Children.only(null):null});ua.displayName="SlotClone";var Hw=({children:t})=>h.jsx(h.Fragment,{children:t});function Ww(t){return m.isValidElement(t)&&t.type===Hw}function Gw(t,e){const n={...e};for(const r in e){const o=t[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{s(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...t,...n}}function qw(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Vw=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],be=Vw.reduce((t,e)=>{const n=m.forwardRef((r,o)=>{const{asChild:s,...i}=r,a=s?Ps:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(a,{...i,ref:o})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function Kw(t,e){t&&Es.flushSync(()=>t.dispatchEvent(e))}function Xt(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t}),m.useMemo(()=>(...n)=>e.current?.(...n),[])}function Xw(t,e=globalThis?.document){const n=Xt(t);m.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var Jw="DismissableLayer",da="dismissableLayer.update",Yw="dismissableLayer.pointerDownOutside",Zw="dismissableLayer.focusOutside",Ec,Gh=m.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),cl=m.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=m.useContext(Gh),[u,d]=m.useState(null),f=u?.ownerDocument??globalThis?.document,[,p]=m.useState({}),g=at(e,S=>d(S)),y=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),w=y.indexOf(v),_=u?y.indexOf(u):-1,x=c.layersWithOutsidePointerEventsDisabled.size>0,b=_>=w,C=tb(S=>{const $=S.target,H=[...c.branches].some(D=>D.contains($));!b||H||(o?.(S),i?.(S),S.defaultPrevented||a?.())},f),k=nb(S=>{const $=S.target;[...c.branches].some(D=>D.contains($))||(s?.(S),i?.(S),S.defaultPrevented||a?.())},f);return Xw(S=>{_===c.layers.size-1&&(r?.(S),!S.defaultPrevented&&a&&(S.preventDefault(),a()))},f),m.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Ec=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),Pc(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=Ec)}},[u,f,n,c]),m.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),Pc())},[u,c]),m.useEffect(()=>{const S=()=>p({});return document.addEventListener(da,S),()=>document.removeEventListener(da,S)},[]),h.jsx(be.div,{...l,ref:g,style:{pointerEvents:x?b?"auto":"none":void 0,...t.style},onFocusCapture:Ke(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Ke(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Ke(t.onPointerDownCapture,C.onPointerDownCapture)})});cl.displayName=Jw;var Qw="DismissableLayerBranch",eb=m.forwardRef((t,e)=>{const n=m.useContext(Gh),r=m.useRef(null),o=at(e,r);return m.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),h.jsx(be.div,{...t,ref:o})});eb.displayName=Qw;function tb(t,e=globalThis?.document){const n=Xt(t),r=m.useRef(!1),o=m.useRef(()=>{});return m.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){qh(Yw,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function nb(t,e=globalThis?.document){const n=Xt(t),r=m.useRef(!1);return m.useEffect(()=>{const o=s=>{s.target&&!r.current&&qh(Zw,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Pc(){const t=new CustomEvent(da);document.dispatchEvent(t)}function qh(t,e,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?Kw(o,s):o.dispatchEvent(s)}var ui=0;function Vh(){m.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Tc()),document.body.insertAdjacentElement("beforeend",t[1]??Tc()),ui++,()=>{ui===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),ui--}},[])}function Tc(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var di="focusScope.autoFocusOnMount",hi="focusScope.autoFocusOnUnmount",Ac={bubbles:!1,cancelable:!0},rb="FocusScope",ul=m.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=t,[a,l]=m.useState(null),c=Xt(o),u=Xt(s),d=m.useRef(null),f=at(e,y=>l(y)),p=m.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;m.useEffect(()=>{if(r){let y=function(x){if(p.paused||!a)return;const b=x.target;a.contains(b)?d.current=b:Lt(d.current,{select:!0})},v=function(x){if(p.paused||!a)return;const b=x.relatedTarget;b!==null&&(a.contains(b)||Lt(d.current,{select:!0}))},w=function(x){if(document.activeElement===document.body)for(const C of x)C.removedNodes.length>0&&Lt(a)};document.addEventListener("focusin",y),document.addEventListener("focusout",v);const _=new MutationObserver(w);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",v),_.disconnect()}}},[r,a,p.paused]),m.useEffect(()=>{if(a){Ic.add(p);const y=document.activeElement;if(!a.contains(y)){const w=new CustomEvent(di,Ac);a.addEventListener(di,c),a.dispatchEvent(w),w.defaultPrevented||(ob(cb(Kh(a)),{select:!0}),document.activeElement===y&&Lt(a))}return()=>{a.removeEventListener(di,c),setTimeout(()=>{const w=new CustomEvent(hi,Ac);a.addEventListener(hi,u),a.dispatchEvent(w),w.defaultPrevented||Lt(y??document.body,{select:!0}),a.removeEventListener(hi,u),Ic.remove(p)},0)}}},[a,c,u,p]);const g=m.useCallback(y=>{if(!n&&!r||p.paused)return;const v=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,w=document.activeElement;if(v&&w){const _=y.currentTarget,[x,b]=sb(_);x&&b?!y.shiftKey&&w===b?(y.preventDefault(),n&&Lt(x,{select:!0})):y.shiftKey&&w===x&&(y.preventDefault(),n&&Lt(b,{select:!0})):w===_&&y.preventDefault()}},[n,r,p.paused]);return h.jsx(be.div,{tabIndex:-1,...i,ref:f,onKeyDown:g})});ul.displayName=rb;function ob(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(Lt(r,{select:e}),document.activeElement!==n)return}function sb(t){const e=Kh(t),n=Rc(e,t),r=Rc(e.reverse(),t);return[n,r]}function Kh(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Rc(t,e){for(const n of t)if(!ib(n,{upTo:e}))return n}function ib(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function ab(t){return t instanceof HTMLInputElement&&"select"in t}function Lt(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&ab(t)&&e&&t.select()}}var Ic=lb();function lb(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=Oc(t,e),t.unshift(e)},remove(e){t=Oc(t,e),t[0]?.resume()}}}function Oc(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function cb(t){return t.filter(e=>e.tagName!=="A")}var bn=globalThis?.document?m.useLayoutEffect:()=>{},ub=Ss.useId||(()=>{}),db=0;function ft(t){const[e,n]=m.useState(ub());return bn(()=>{n(r=>r??String(db++))},[t]),t||(e?`radix-${e}`:"")}const hb=["top","right","bottom","left"],Jt=Math.min,Ve=Math.max,hs=Math.round,Ro=Math.floor,pt=t=>({x:t,y:t}),fb={left:"right",right:"left",bottom:"top",top:"bottom"},pb={start:"end",end:"start"};function ha(t,e,n){return Ve(t,Jt(e,n))}function At(t,e){return typeof t=="function"?t(e):t}function Rt(t){return t.split("-")[0]}function Pr(t){return t.split("-")[1]}function dl(t){return t==="x"?"y":"x"}function hl(t){return t==="y"?"height":"width"}function Yt(t){return["top","bottom"].includes(Rt(t))?"y":"x"}function fl(t){return dl(Yt(t))}function mb(t,e,n){n===void 0&&(n=!1);const r=Pr(t),o=fl(t),s=hl(o);let i=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(i=fs(i)),[i,fs(i)]}function gb(t){const e=fs(t);return[fa(t),e,fa(e)]}function fa(t){return t.replace(/start|end/g,e=>pb[e])}function yb(t,e,n){const r=["left","right"],o=["right","left"],s=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return n?e?o:r:e?r:o;case"left":case"right":return e?s:i;default:return[]}}function vb(t,e,n,r){const o=Pr(t);let s=yb(Rt(t),n==="start",r);return o&&(s=s.map(i=>i+"-"+o),e&&(s=s.concat(s.map(fa)))),s}function fs(t){return t.replace(/left|right|bottom|top/g,e=>fb[e])}function wb(t){return{top:0,right:0,bottom:0,left:0,...t}}function Xh(t){return typeof t!="number"?wb(t):{top:t,right:t,bottom:t,left:t}}function ps(t){const{x:e,y:n,width:r,height:o}=t;return{width:r,height:o,top:n,left:e,right:e+r,bottom:n+o,x:e,y:n}}function jc(t,e,n){let{reference:r,floating:o}=t;const s=Yt(e),i=fl(e),a=hl(i),l=Rt(e),c=s==="y",u=r.x+r.width/2-o.width/2,d=r.y+r.height/2-o.height/2,f=r[a]/2-o[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-o.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-o.width,y:d};break;default:p={x:r.x,y:r.y}}switch(Pr(e)){case"start":p[i]-=f*(n&&c?-1:1);break;case"end":p[i]+=f*(n&&c?-1:1);break}return p}const bb=async(t,e,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:s=[],platform:i}=n,a=s.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:o}),{x:u,y:d}=jc(c,r,l),f=r,p={},g=0;for(let y=0;y<a.length;y++){const{name:v,fn:w}=a[y],{x:_,y:x,data:b,reset:C}=await w({x:u,y:d,initialPlacement:r,placement:f,strategy:o,middlewareData:p,rects:c,platform:i,elements:{reference:t,floating:e}});u=_??u,d=x??d,p={...p,[v]:{...p[v],...b}},C&&g<=50&&(g++,typeof C=="object"&&(C.placement&&(f=C.placement),C.rects&&(c=C.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:o}):C.rects),{x:u,y:d}=jc(c,f,l)),y=-1)}return{x:u,y:d,placement:f,strategy:o,middlewareData:p}};async function to(t,e){var n;e===void 0&&(e={});const{x:r,y:o,platform:s,rects:i,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:p=0}=At(e,t),g=Xh(p),v=a[f?d==="floating"?"reference":"floating":d],w=ps(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(v)))==null||n?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),_=d==="floating"?{x:r,y:o,width:i.floating.width,height:i.floating.height}:i.reference,x=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),b=await(s.isElement==null?void 0:s.isElement(x))?await(s.getScale==null?void 0:s.getScale(x))||{x:1,y:1}:{x:1,y:1},C=ps(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:x,strategy:l}):_);return{top:(w.top-C.top+g.top)/b.y,bottom:(C.bottom-w.bottom+g.bottom)/b.y,left:(w.left-C.left+g.left)/b.x,right:(C.right-w.right+g.right)/b.x}}const xb=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:o,rects:s,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=At(t,e)||{};if(c==null)return{};const d=Xh(u),f={x:n,y:r},p=fl(o),g=hl(p),y=await i.getDimensions(c),v=p==="y",w=v?"top":"left",_=v?"bottom":"right",x=v?"clientHeight":"clientWidth",b=s.reference[g]+s.reference[p]-f[p]-s.floating[g],C=f[p]-s.reference[p],k=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let S=k?k[x]:0;(!S||!await(i.isElement==null?void 0:i.isElement(k)))&&(S=a.floating[x]||s.floating[g]);const $=b/2-C/2,H=S/2-y[g]/2-1,D=Jt(d[w],H),q=Jt(d[_],H),O=D,ee=S-y[g]-q,M=S/2-y[g]/2+$,K=ha(O,M,ee),X=!l.arrow&&Pr(o)!=null&&M!==K&&s.reference[g]/2-(M<O?D:q)-y[g]/2<0,Z=X?M<O?M-O:M-ee:0;return{[p]:f[p]+Z,data:{[p]:K,centerOffset:M-K-Z,...X&&{alignmentOffset:Z}},reset:X}}}),_b=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:y=!0,...v}=At(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const w=Rt(o),_=Yt(a),x=Rt(a)===a,b=await(l.isRTL==null?void 0:l.isRTL(c.floating)),C=f||(x||!y?[fs(a)]:gb(a)),k=g!=="none";!f&&k&&C.push(...vb(a,y,g,b));const S=[a,...C],$=await to(e,v),H=[];let D=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&H.push($[w]),d){const M=mb(o,i,b);H.push($[M[0]],$[M[1]])}if(D=[...D,{placement:o,overflows:H}],!H.every(M=>M<=0)){var q,O;const M=(((q=s.flip)==null?void 0:q.index)||0)+1,K=S[M];if(K)return{data:{index:M,overflows:D},reset:{placement:K}};let X=(O=D.filter(Z=>Z.overflows[0]<=0).sort((Z,F)=>Z.overflows[1]-F.overflows[1])[0])==null?void 0:O.placement;if(!X)switch(p){case"bestFit":{var ee;const Z=(ee=D.filter(F=>{if(k){const ie=Yt(F.placement);return ie===_||ie==="y"}return!0}).map(F=>[F.placement,F.overflows.filter(ie=>ie>0).reduce((ie,ve)=>ie+ve,0)]).sort((F,ie)=>F[1]-ie[1])[0])==null?void 0:ee[0];Z&&(X=Z);break}case"initialPlacement":X=a;break}if(o!==X)return{reset:{placement:X}}}return{}}}};function $c(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Nc(t){return hb.some(e=>t[e]>=0)}const Sb=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...o}=At(t,e);switch(r){case"referenceHidden":{const s=await to(e,{...o,elementContext:"reference"}),i=$c(s,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:Nc(i)}}}case"escaped":{const s=await to(e,{...o,altBoundary:!0}),i=$c(s,n.floating);return{data:{escapedOffsets:i,escaped:Nc(i)}}}default:return{}}}}};async function Cb(t,e){const{placement:n,platform:r,elements:o}=t,s=await(r.isRTL==null?void 0:r.isRTL(o.floating)),i=Rt(n),a=Pr(n),l=Yt(n)==="y",c=["left","top"].includes(i)?-1:1,u=s&&l?-1:1,d=At(e,t);let{mainAxis:f,crossAxis:p,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(p=a==="end"?g*-1:g),l?{x:p*u,y:f*c}:{x:f*c,y:p*u}}const kb=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:o,y:s,placement:i,middlewareData:a}=e,l=await Cb(e,t);return i===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:o+l.x,y:s+l.y,data:{...l,placement:i}}}}},Eb=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:o}=e,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:v=>{let{x:w,y:_}=v;return{x:w,y:_}}},...l}=At(t,e),c={x:n,y:r},u=await to(e,l),d=Yt(Rt(o)),f=dl(d);let p=c[f],g=c[d];if(s){const v=f==="y"?"top":"left",w=f==="y"?"bottom":"right",_=p+u[v],x=p-u[w];p=ha(_,p,x)}if(i){const v=d==="y"?"top":"left",w=d==="y"?"bottom":"right",_=g+u[v],x=g-u[w];g=ha(_,g,x)}const y=a.fn({...e,[f]:p,[d]:g});return{...y,data:{x:y.x-n,y:y.y-r,enabled:{[f]:s,[d]:i}}}}}},Pb=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:o,rects:s,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=At(t,e),u={x:n,y:r},d=Yt(o),f=dl(d);let p=u[f],g=u[d];const y=At(a,e),v=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(l){const x=f==="y"?"height":"width",b=s.reference[f]-s.floating[x]+v.mainAxis,C=s.reference[f]+s.reference[x]-v.mainAxis;p<b?p=b:p>C&&(p=C)}if(c){var w,_;const x=f==="y"?"width":"height",b=["top","left"].includes(Rt(o)),C=s.reference[d]-s.floating[x]+(b&&((w=i.offset)==null?void 0:w[d])||0)+(b?0:v.crossAxis),k=s.reference[d]+s.reference[x]+(b?0:((_=i.offset)==null?void 0:_[d])||0)-(b?v.crossAxis:0);g<C?g=C:g>k&&(g=k)}return{[f]:p,[d]:g}}}},Tb=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:o,rects:s,platform:i,elements:a}=e,{apply:l=()=>{},...c}=At(t,e),u=await to(e,c),d=Rt(o),f=Pr(o),p=Yt(o)==="y",{width:g,height:y}=s.floating;let v,w;d==="top"||d==="bottom"?(v=d,w=f===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(w=d,v=f==="end"?"top":"bottom");const _=y-u.top-u.bottom,x=g-u.left-u.right,b=Jt(y-u[v],_),C=Jt(g-u[w],x),k=!e.middlewareData.shift;let S=b,$=C;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&($=x),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(S=_),k&&!f){const D=Ve(u.left,0),q=Ve(u.right,0),O=Ve(u.top,0),ee=Ve(u.bottom,0);p?$=g-2*(D!==0||q!==0?D+q:Ve(u.left,u.right)):S=y-2*(O!==0||ee!==0?O+ee:Ve(u.top,u.bottom))}await l({...e,availableWidth:$,availableHeight:S});const H=await i.getDimensions(a.floating);return g!==H.width||y!==H.height?{reset:{rects:!0}}:{}}}};function Ts(){return typeof window<"u"}function Tr(t){return Jh(t)?(t.nodeName||"").toLowerCase():"#document"}function Xe(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function wt(t){var e;return(e=(Jh(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function Jh(t){return Ts()?t instanceof Node||t instanceof Xe(t).Node:!1}function st(t){return Ts()?t instanceof Element||t instanceof Xe(t).Element:!1}function mt(t){return Ts()?t instanceof HTMLElement||t instanceof Xe(t).HTMLElement:!1}function zc(t){return!Ts()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Xe(t).ShadowRoot}function ho(t){const{overflow:e,overflowX:n,overflowY:r,display:o}=it(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(o)}function Ab(t){return["table","td","th"].includes(Tr(t))}function As(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function pl(t){const e=ml(),n=st(t)?it(t):t;return["transform","translate","scale","rotate","perspective"].some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function Rb(t){let e=Zt(t);for(;mt(e)&&!gr(e);){if(pl(e))return e;if(As(e))return null;e=Zt(e)}return null}function ml(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function gr(t){return["html","body","#document"].includes(Tr(t))}function it(t){return Xe(t).getComputedStyle(t)}function Rs(t){return st(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Zt(t){if(Tr(t)==="html")return t;const e=t.assignedSlot||t.parentNode||zc(t)&&t.host||wt(t);return zc(e)?e.host:e}function Yh(t){const e=Zt(t);return gr(e)?t.ownerDocument?t.ownerDocument.body:t.body:mt(e)&&ho(e)?e:Yh(e)}function no(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const o=Yh(t),s=o===((r=t.ownerDocument)==null?void 0:r.body),i=Xe(o);if(s){const a=pa(i);return e.concat(i,i.visualViewport||[],ho(o)?o:[],a&&n?no(a):[])}return e.concat(o,no(o,[],n))}function pa(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Zh(t){const e=it(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=mt(t),s=o?t.offsetWidth:n,i=o?t.offsetHeight:r,a=hs(n)!==s||hs(r)!==i;return a&&(n=s,r=i),{width:n,height:r,$:a}}function gl(t){return st(t)?t:t.contextElement}function ur(t){const e=gl(t);if(!mt(e))return pt(1);const n=e.getBoundingClientRect(),{width:r,height:o,$:s}=Zh(e);let i=(s?hs(n.width):n.width)/r,a=(s?hs(n.height):n.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const Ib=pt(0);function Qh(t){const e=Xe(t);return!ml()||!e.visualViewport?Ib:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Ob(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Xe(t)?!1:e}function xn(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const o=t.getBoundingClientRect(),s=gl(t);let i=pt(1);e&&(r?st(r)&&(i=ur(r)):i=ur(t));const a=Ob(s,n,r)?Qh(s):pt(0);let l=(o.left+a.x)/i.x,c=(o.top+a.y)/i.y,u=o.width/i.x,d=o.height/i.y;if(s){const f=Xe(s),p=r&&st(r)?Xe(r):r;let g=f,y=pa(g);for(;y&&r&&p!==g;){const v=ur(y),w=y.getBoundingClientRect(),_=it(y),x=w.left+(y.clientLeft+parseFloat(_.paddingLeft))*v.x,b=w.top+(y.clientTop+parseFloat(_.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,d*=v.y,l+=x,c+=b,g=Xe(y),y=pa(g)}}return ps({width:u,height:d,x:l,y:c})}function yl(t,e){const n=Rs(t).scrollLeft;return e?e.left+n:xn(wt(t)).left+n}function ef(t,e,n){n===void 0&&(n=!1);const r=t.getBoundingClientRect(),o=r.left+e.scrollLeft-(n?0:yl(t,r)),s=r.top+e.scrollTop;return{x:o,y:s}}function jb(t){let{elements:e,rect:n,offsetParent:r,strategy:o}=t;const s=o==="fixed",i=wt(r),a=e?As(e.floating):!1;if(r===i||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=pt(1);const u=pt(0),d=mt(r);if((d||!d&&!s)&&((Tr(r)!=="body"||ho(i))&&(l=Rs(r)),mt(r))){const p=xn(r);c=ur(r),u.x=p.x+r.clientLeft,u.y=p.y+r.clientTop}const f=i&&!d&&!s?ef(i,l,!0):pt(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:n.y*c.y-l.scrollTop*c.y+u.y+f.y}}function $b(t){return Array.from(t.getClientRects())}function Nb(t){const e=wt(t),n=Rs(t),r=t.ownerDocument.body,o=Ve(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Ve(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let i=-n.scrollLeft+yl(t);const a=-n.scrollTop;return it(r).direction==="rtl"&&(i+=Ve(e.clientWidth,r.clientWidth)-o),{width:o,height:s,x:i,y:a}}function zb(t,e){const n=Xe(t),r=wt(t),o=n.visualViewport;let s=r.clientWidth,i=r.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;const c=ml();(!c||c&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:s,height:i,x:a,y:l}}function Db(t,e){const n=xn(t,!0,e==="fixed"),r=n.top+t.clientTop,o=n.left+t.clientLeft,s=mt(t)?ur(t):pt(1),i=t.clientWidth*s.x,a=t.clientHeight*s.y,l=o*s.x,c=r*s.y;return{width:i,height:a,x:l,y:c}}function Dc(t,e,n){let r;if(e==="viewport")r=zb(t,n);else if(e==="document")r=Nb(wt(t));else if(st(e))r=Db(e,n);else{const o=Qh(t);r={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return ps(r)}function tf(t,e){const n=Zt(t);return n===e||!st(n)||gr(n)?!1:it(n).position==="fixed"||tf(n,e)}function Mb(t,e){const n=e.get(t);if(n)return n;let r=no(t,[],!1).filter(a=>st(a)&&Tr(a)!=="body"),o=null;const s=it(t).position==="fixed";let i=s?Zt(t):t;for(;st(i)&&!gr(i);){const a=it(i),l=pl(i);!l&&a.position==="fixed"&&(o=null),(s?!l&&!o:!l&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||ho(i)&&!l&&tf(t,i))?r=r.filter(u=>u!==i):o=a,i=Zt(i)}return e.set(t,r),r}function Lb(t){let{element:e,boundary:n,rootBoundary:r,strategy:o}=t;const i=[...n==="clippingAncestors"?As(e)?[]:Mb(e,this._c):[].concat(n),r],a=i[0],l=i.reduce((c,u)=>{const d=Dc(e,u,o);return c.top=Ve(d.top,c.top),c.right=Jt(d.right,c.right),c.bottom=Jt(d.bottom,c.bottom),c.left=Ve(d.left,c.left),c},Dc(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Bb(t){const{width:e,height:n}=Zh(t);return{width:e,height:n}}function Fb(t,e,n){const r=mt(e),o=wt(e),s=n==="fixed",i=xn(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=pt(0);if(r||!r&&!s)if((Tr(e)!=="body"||ho(o))&&(a=Rs(e)),r){const f=xn(e,!0,s,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else o&&(l.x=yl(o));const c=o&&!r&&!s?ef(o,a):pt(0),u=i.left+a.scrollLeft-l.x-c.x,d=i.top+a.scrollTop-l.y-c.y;return{x:u,y:d,width:i.width,height:i.height}}function fi(t){return it(t).position==="static"}function Mc(t,e){if(!mt(t)||it(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return wt(t)===n&&(n=n.ownerDocument.body),n}function nf(t,e){const n=Xe(t);if(As(t))return n;if(!mt(t)){let o=Zt(t);for(;o&&!gr(o);){if(st(o)&&!fi(o))return o;o=Zt(o)}return n}let r=Mc(t,e);for(;r&&Ab(r)&&fi(r);)r=Mc(r,e);return r&&gr(r)&&fi(r)&&!pl(r)?n:r||Rb(t)||n}const Ub=async function(t){const e=this.getOffsetParent||nf,n=this.getDimensions,r=await n(t.floating);return{reference:Fb(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Hb(t){return it(t).direction==="rtl"}const Wb={convertOffsetParentRelativeRectToViewportRelativeRect:jb,getDocumentElement:wt,getClippingRect:Lb,getOffsetParent:nf,getElementRects:Ub,getClientRects:$b,getDimensions:Bb,getScale:ur,isElement:st,isRTL:Hb};function rf(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Gb(t,e){let n=null,r;const o=wt(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:f,height:p}=c;if(a||e(),!f||!p)return;const g=Ro(d),y=Ro(o.clientWidth-(u+f)),v=Ro(o.clientHeight-(d+p)),w=Ro(u),x={rootMargin:-g+"px "+-y+"px "+-v+"px "+-w+"px",threshold:Ve(0,Jt(1,l))||1};let b=!0;function C(k){const S=k[0].intersectionRatio;if(S!==l){if(!b)return i();S?i(!1,S):r=setTimeout(()=>{i(!1,1e-7)},1e3)}S===1&&!rf(c,t.getBoundingClientRect())&&i(),b=!1}try{n=new IntersectionObserver(C,{...x,root:o.ownerDocument})}catch{n=new IntersectionObserver(C,x)}n.observe(t)}return i(!0),s}function of(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=gl(t),u=o||s?[...c?no(c):[],...no(e)]:[];u.forEach(w=>{o&&w.addEventListener("scroll",n,{passive:!0}),s&&w.addEventListener("resize",n)});const d=c&&a?Gb(c,n):null;let f=-1,p=null;i&&(p=new ResizeObserver(w=>{let[_]=w;_&&_.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var x;(x=p)==null||x.observe(e)})),n()}),c&&!l&&p.observe(c),p.observe(e));let g,y=l?xn(t):null;l&&v();function v(){const w=xn(t);y&&!rf(y,w)&&n(),y=w,g=requestAnimationFrame(v)}return n(),()=>{var w;u.forEach(_=>{o&&_.removeEventListener("scroll",n),s&&_.removeEventListener("resize",n)}),d?.(),(w=p)==null||w.disconnect(),p=null,l&&cancelAnimationFrame(g)}}const qb=kb,Vb=Eb,Kb=_b,Xb=Tb,Jb=Sb,Lc=xb,Yb=Pb,Zb=(t,e,n)=>{const r=new Map,o={platform:Wb,...n},s={...o.platform,_c:r};return bb(t,e,{...o,platform:s})};var Jo=typeof document<"u"?m.useLayoutEffect:m.useEffect;function ms(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!ms(t[r],e[r]))return!1;return!0}if(o=Object.keys(t),n=o.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,o[r]))return!1;for(r=n;r--!==0;){const s=o[r];if(!(s==="_owner"&&t.$$typeof)&&!ms(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function sf(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Bc(t,e){const n=sf(t);return Math.round(e*n)/n}function pi(t){const e=m.useRef(t);return Jo(()=>{e.current=t}),e}function af(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=m.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[f,p]=m.useState(r);ms(f,r)||p(r);const[g,y]=m.useState(null),[v,w]=m.useState(null),_=m.useCallback(F=>{F!==k.current&&(k.current=F,y(F))},[]),x=m.useCallback(F=>{F!==S.current&&(S.current=F,w(F))},[]),b=s||g,C=i||v,k=m.useRef(null),S=m.useRef(null),$=m.useRef(u),H=l!=null,D=pi(l),q=pi(o),O=pi(c),ee=m.useCallback(()=>{if(!k.current||!S.current)return;const F={placement:e,strategy:n,middleware:f};q.current&&(F.platform=q.current),Zb(k.current,S.current,F).then(ie=>{const ve={...ie,isPositioned:O.current!==!1};M.current&&!ms($.current,ve)&&($.current=ve,Es.flushSync(()=>{d(ve)}))})},[f,e,n,q,O]);Jo(()=>{c===!1&&$.current.isPositioned&&($.current.isPositioned=!1,d(F=>({...F,isPositioned:!1})))},[c]);const M=m.useRef(!1);Jo(()=>(M.current=!0,()=>{M.current=!1}),[]),Jo(()=>{if(b&&(k.current=b),C&&(S.current=C),b&&C){if(D.current)return D.current(b,C,ee);ee()}},[b,C,ee,D,H]);const K=m.useMemo(()=>({reference:k,floating:S,setReference:_,setFloating:x}),[_,x]),X=m.useMemo(()=>({reference:b,floating:C}),[b,C]),Z=m.useMemo(()=>{const F={position:n,left:0,top:0};if(!X.floating)return F;const ie=Bc(X.floating,u.x),ve=Bc(X.floating,u.y);return a?{...F,transform:"translate("+ie+"px, "+ve+"px)",...sf(X.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:ie,top:ve}},[n,a,X.floating,u.x,u.y]);return m.useMemo(()=>({...u,update:ee,refs:K,elements:X,floatingStyles:Z}),[u,ee,K,X,Z])}const Qb=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:o}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?Lc({element:r.current,padding:o}).fn(n):{}:r?Lc({element:r,padding:o}).fn(n):{}}}},lf=(t,e)=>({...qb(t),options:[t,e]}),cf=(t,e)=>({...Vb(t),options:[t,e]}),uf=(t,e)=>({...Yb(t),options:[t,e]}),df=(t,e)=>({...Kb(t),options:[t,e]}),hf=(t,e)=>({...Xb(t),options:[t,e]}),ff=(t,e)=>({...Jb(t),options:[t,e]}),pf=(t,e)=>({...Qb(t),options:[t,e]});var ex="Arrow",mf=m.forwardRef((t,e)=>{const{children:n,width:r=10,height:o=5,...s}=t;return h.jsx(be.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});mf.displayName=ex;var tx=mf;function nx(t){const[e,n]=m.useState(void 0);return bn(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var vl="Popper",[gf,yf]=ll(vl),[rx,vf]=gf(vl),wf=t=>{const{__scopePopper:e,children:n}=t,[r,o]=m.useState(null);return h.jsx(rx,{scope:e,anchor:r,onAnchorChange:o,children:n})};wf.displayName=vl;var bf="PopperAnchor",xf=m.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,s=vf(bf,n),i=m.useRef(null),a=at(e,i);return m.useEffect(()=>{s.onAnchorChange(r?.current||i.current)}),r?null:h.jsx(be.div,{...o,ref:a})});xf.displayName=bf;var wl="PopperContent",[ox,sx]=gf(wl),_f=m.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:p="optimized",onPlaced:g,...y}=t,v=vf(wl,n),[w,_]=m.useState(null),x=at(e,A=>_(A)),[b,C]=m.useState(null),k=nx(b),S=k?.width??0,$=k?.height??0,H=r+(s!=="center"?"-"+s:""),D=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},q=Array.isArray(c)?c:[c],O=q.length>0,ee={padding:D,boundary:q.filter(ax),altBoundary:O},{refs:M,floatingStyles:K,placement:X,isPositioned:Z,middlewareData:F}=af({strategy:"fixed",placement:H,whileElementsMounted:(...A)=>of(...A,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[lf({mainAxis:o+$,alignmentAxis:i}),l&&cf({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?uf():void 0,...ee}),l&&df({...ee}),hf({...ee,apply:({elements:A,rects:z,availableWidth:re,availableHeight:le})=>{const{width:Ne,height:ze}=z.reference,ae=A.floating.style;ae.setProperty("--radix-popper-available-width",`${re}px`),ae.setProperty("--radix-popper-available-height",`${le}px`),ae.setProperty("--radix-popper-anchor-width",`${Ne}px`),ae.setProperty("--radix-popper-anchor-height",`${ze}px`)}}),b&&pf({element:b,padding:a}),lx({arrowWidth:S,arrowHeight:$}),f&&ff({strategy:"referenceHidden",...ee})]}),[ie,ve]=kf(X),pe=Xt(g);bn(()=>{Z&&pe?.()},[Z,pe]);const P=F.arrow?.x,E=F.arrow?.y,R=F.arrow?.centerOffset!==0,[T,I]=m.useState();return bn(()=>{w&&I(window.getComputedStyle(w).zIndex)},[w]),h.jsx("div",{ref:M.setFloating,"data-radix-popper-content-wrapper":"",style:{...K,transform:Z?K.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:T,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:h.jsx(ox,{scope:n,placedSide:ie,onArrowChange:C,arrowX:P,arrowY:E,shouldHideArrow:R,children:h.jsx(be.div,{"data-side":ie,"data-align":ve,...y,ref:x,style:{...y.style,animation:Z?void 0:"none"}})})})});_f.displayName=wl;var Sf="PopperArrow",ix={top:"bottom",right:"left",bottom:"top",left:"right"},Cf=m.forwardRef(function(e,n){const{__scopePopper:r,...o}=e,s=sx(Sf,r),i=ix[s.placedSide];return h.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:h.jsx(tx,{...o,ref:n,style:{...o.style,display:"block"}})})});Cf.displayName=Sf;function ax(t){return t!==null}var lx=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=kf(n),d={start:"0%",center:"50%",end:"100%"}[u],f=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let g="",y="";return c==="bottom"?(g=i?d:`${f}px`,y=`${-l}px`):c==="top"?(g=i?d:`${f}px`,y=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,y=i?d:`${p}px`):c==="left"&&(g=`${r.floating.width+l}px`,y=i?d:`${p}px`),{data:{x:g,y}}}});function kf(t){const[e,n="center"]=t.split("-");return[e,n]}var cx=wf,Ef=xf,ux=_f,dx=Cf,hx="Portal",Pf=m.forwardRef((t,e)=>{const{container:n,...r}=t,[o,s]=m.useState(!1);bn(()=>s(!0),[]);const i=n||o&&globalThis?.document?.body;return i?Wh.createPortal(h.jsx(be.div,{...r,ref:e}),i):null});Pf.displayName=hx;function fx(t,e){return m.useReducer((n,r)=>e[n][r]??n,t)}var fo=t=>{const{present:e,children:n}=t,r=px(e),o=typeof n=="function"?n({present:r.isPresent}):m.Children.only(n),s=at(r.ref,mx(o));return typeof n=="function"||r.isPresent?m.cloneElement(o,{ref:s}):null};fo.displayName="Presence";function px(t){const[e,n]=m.useState(),r=m.useRef({}),o=m.useRef(t),s=m.useRef("none"),i=t?"mounted":"unmounted",[a,l]=fx(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return m.useEffect(()=>{const c=Io(r.current);s.current=a==="mounted"?c:"none"},[a]),bn(()=>{const c=r.current,u=o.current;if(u!==t){const f=s.current,p=Io(c);t?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),bn(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const y=Io(r.current).includes(p.animationName);if(p.target===e&&y&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},f=p=>{p.target===e&&(s.current=Io(r.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:m.useCallback(c=>{c&&(r.current=getComputedStyle(c)),n(c)},[])}}function Io(t){return t?.animationName||"none"}function mx(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function Tf({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,o]=gx({defaultProp:e,onChange:n}),s=t!==void 0,i=s?t:r,a=Xt(n),l=m.useCallback(c=>{if(s){const d=typeof c=="function"?c(t):c;d!==t&&a(d)}else o(c)},[s,t,o,a]);return[i,l]}function gx({defaultProp:t,onChange:e}){const n=m.useState(t),[r]=n,o=m.useRef(r),s=Xt(e);return m.useEffect(()=>{o.current!==r&&(s(r),o.current=r)},[r,o,s]),n}var yx=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},zn=new WeakMap,Oo=new WeakMap,jo={},mi=0,Af=function(t){return t&&(t.host||Af(t.parentNode))},vx=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=Af(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},wx=function(t,e,n,r){var o=vx(e,Array.isArray(t)?t:[t]);jo[n]||(jo[n]=new WeakMap);var s=jo[n],i=[],a=new Set,l=new Set(o),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};o.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(f){if(a.has(f))u(f);else try{var p=f.getAttribute(r),g=p!==null&&p!=="false",y=(zn.get(f)||0)+1,v=(s.get(f)||0)+1;zn.set(f,y),s.set(f,v),i.push(f),y===1&&g&&Oo.set(f,!0),v===1&&f.setAttribute(n,"true"),g||f.setAttribute(r,"true")}catch(w){console.error("aria-hidden: cannot operate on ",f,w)}})};return u(e),a.clear(),mi++,function(){i.forEach(function(d){var f=zn.get(d)-1,p=s.get(d)-1;zn.set(d,f),s.set(d,p),f||(Oo.has(d)||d.removeAttribute(r),Oo.delete(d)),p||d.removeAttribute(n)}),mi--,mi||(zn=new WeakMap,zn=new WeakMap,Oo=new WeakMap,jo={})}},Rf=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),o=yx(t);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live]"))),wx(r,o,n,"aria-hidden")):function(){return null}},dt=function(){return dt=Object.assign||function(e){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},dt.apply(this,arguments)};function If(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function bx(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,s;r<o;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}var Yo="right-scroll-bar-position",Zo="width-before-scroll-bar",xx="with-scroll-bars-hidden",_x="--removed-body-scroll-bar-size";function gi(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function Sx(t,e){var n=m.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var o=n.value;o!==r&&(n.value=r,n.callback(r,o))}}}})[0];return n.callback=e,n.facade}var Cx=typeof window<"u"?m.useLayoutEffect:m.useEffect,Fc=new WeakMap;function kx(t,e){var n=Sx(null,function(r){return t.forEach(function(o){return gi(o,r)})});return Cx(function(){var r=Fc.get(n);if(r){var o=new Set(r),s=new Set(t),i=n.current;o.forEach(function(a){s.has(a)||gi(a,null)}),s.forEach(function(a){o.has(a)||gi(a,i)})}Fc.set(n,t)},[t]),n}function Ex(t){return t}function Px(t,e){e===void 0&&(e=Ex);var n=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var i=e(s,r);return n.push(i),function(){n=n.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(r=!0;n.length;){var i=n;n=[],i.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){r=!0;var i=[];if(n.length){var a=n;n=[],a.forEach(s),i=n}var l=function(){var u=i;i=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),n={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),n}}}};return o}function Tx(t){t===void 0&&(t={});var e=Px(null);return e.options=dt({async:!0,ssr:!1},t),e}var Of=function(t){var e=t.sideCar,n=If(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return m.createElement(r,dt({},n))};Of.isSideCarExport=!0;function Ax(t,e){return t.useMedium(e),Of}var jf=Tx(),yi=function(){},Is=m.forwardRef(function(t,e){var n=m.useRef(null),r=m.useState({onScrollCapture:yi,onWheelCapture:yi,onTouchMoveCapture:yi}),o=r[0],s=r[1],i=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,f=t.sideCar,p=t.noIsolation,g=t.inert,y=t.allowPinchZoom,v=t.as,w=v===void 0?"div":v,_=t.gapMode,x=If(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),b=f,C=kx([n,e]),k=dt(dt({},x),o);return m.createElement(m.Fragment,null,u&&m.createElement(b,{sideCar:jf,removeScrollBar:c,shards:d,noIsolation:p,inert:g,setCallbacks:s,allowPinchZoom:!!y,lockRef:n,gapMode:_}),i?m.cloneElement(m.Children.only(a),dt(dt({},k),{ref:C})):m.createElement(w,dt({},k,{className:l,ref:C}),a))});Is.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Is.classNames={fullWidth:Zo,zeroRight:Yo};var Rx=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Ix(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Rx();return e&&t.setAttribute("nonce",e),t}function Ox(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function jx(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var $x=function(){var t=0,e=null;return{add:function(n){t==0&&(e=Ix())&&(Ox(e,n),jx(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Nx=function(){var t=$x();return function(e,n){m.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},$f=function(){var t=Nx(),e=function(n){var r=n.styles,o=n.dynamic;return t(r,o),null};return e},zx={left:0,top:0,right:0,gap:0},vi=function(t){return parseInt(t||"",10)||0},Dx=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],o=e[t==="padding"?"paddingRight":"marginRight"];return[vi(n),vi(r),vi(o)]},Mx=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return zx;var e=Dx(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},Lx=$f(),dr="data-scroll-locked",Bx=function(t,e,n,r){var o=t.left,s=t.top,i=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(xx,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(dr,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Yo,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Zo,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Yo," .").concat(Yo,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Zo," .").concat(Zo,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(dr,`] {
    `).concat(_x,": ").concat(a,`px;
  }
`)},Uc=function(){var t=parseInt(document.body.getAttribute(dr)||"0",10);return isFinite(t)?t:0},Fx=function(){m.useEffect(function(){return document.body.setAttribute(dr,(Uc()+1).toString()),function(){var t=Uc()-1;t<=0?document.body.removeAttribute(dr):document.body.setAttribute(dr,t.toString())}},[])},Ux=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,o=r===void 0?"margin":r;Fx();var s=m.useMemo(function(){return Mx(o)},[o]);return m.createElement(Lx,{styles:Bx(s,!e,o,n?"":"!important")})},ma=!1;if(typeof window<"u")try{var $o=Object.defineProperty({},"passive",{get:function(){return ma=!0,!0}});window.addEventListener("test",$o,$o),window.removeEventListener("test",$o,$o)}catch{ma=!1}var Dn=ma?{passive:!1}:!1,Hx=function(t){return t.tagName==="TEXTAREA"},Nf=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!Hx(t)&&n[e]==="visible")},Wx=function(t){return Nf(t,"overflowY")},Gx=function(t){return Nf(t,"overflowX")},Hc=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=zf(t,r);if(o){var s=Df(t,r),i=s[1],a=s[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},qx=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},Vx=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},zf=function(t,e){return t==="v"?Wx(e):Gx(e)},Df=function(t,e){return t==="v"?qx(e):Vx(e)},Kx=function(t,e){return t==="h"&&e==="rtl"?-1:1},Xx=function(t,e,n,r,o){var s=Kx(t,window.getComputedStyle(e).direction),i=s*r,a=n.target,l=e.contains(a),c=!1,u=i>0,d=0,f=0;do{var p=Df(t,a),g=p[0],y=p[1],v=p[2],w=y-v-s*g;(g||w)&&zf(t,a)&&(d+=w,f+=g),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(f)<1)&&(c=!0),c},No=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Wc=function(t){return[t.deltaX,t.deltaY]},Gc=function(t){return t&&"current"in t?t.current:t},Jx=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Yx=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Zx=0,Mn=[];function Qx(t){var e=m.useRef([]),n=m.useRef([0,0]),r=m.useRef(),o=m.useState(Zx++)[0],s=m.useState($f)[0],i=m.useRef(t);m.useEffect(function(){i.current=t},[t]),m.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(o));var y=bx([t.lockRef.current],(t.shards||[]).map(Gc),!0).filter(Boolean);return y.forEach(function(v){return v.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),y.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(o))})}}},[t.inert,t.lockRef.current,t.shards]);var a=m.useCallback(function(y,v){if("touches"in y&&y.touches.length===2||y.type==="wheel"&&y.ctrlKey)return!i.current.allowPinchZoom;var w=No(y),_=n.current,x="deltaX"in y?y.deltaX:_[0]-w[0],b="deltaY"in y?y.deltaY:_[1]-w[1],C,k=y.target,S=Math.abs(x)>Math.abs(b)?"h":"v";if("touches"in y&&S==="h"&&k.type==="range")return!1;var $=Hc(S,k);if(!$)return!0;if($?C=S:(C=S==="v"?"h":"v",$=Hc(S,k)),!$)return!1;if(!r.current&&"changedTouches"in y&&(x||b)&&(r.current=C),!C)return!0;var H=r.current||C;return Xx(H,v,y,H==="h"?x:b)},[]),l=m.useCallback(function(y){var v=y;if(!(!Mn.length||Mn[Mn.length-1]!==s)){var w="deltaY"in v?Wc(v):No(v),_=e.current.filter(function(C){return C.name===v.type&&(C.target===v.target||v.target===C.shadowParent)&&Jx(C.delta,w)})[0];if(_&&_.should){v.cancelable&&v.preventDefault();return}if(!_){var x=(i.current.shards||[]).map(Gc).filter(Boolean).filter(function(C){return C.contains(v.target)}),b=x.length>0?a(v,x[0]):!i.current.noIsolation;b&&v.cancelable&&v.preventDefault()}}},[]),c=m.useCallback(function(y,v,w,_){var x={name:y,delta:v,target:w,should:_,shadowParent:e0(w)};e.current.push(x),setTimeout(function(){e.current=e.current.filter(function(b){return b!==x})},1)},[]),u=m.useCallback(function(y){n.current=No(y),r.current=void 0},[]),d=m.useCallback(function(y){c(y.type,Wc(y),y.target,a(y,t.lockRef.current))},[]),f=m.useCallback(function(y){c(y.type,No(y),y.target,a(y,t.lockRef.current))},[]);m.useEffect(function(){return Mn.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",l,Dn),document.addEventListener("touchmove",l,Dn),document.addEventListener("touchstart",u,Dn),function(){Mn=Mn.filter(function(y){return y!==s}),document.removeEventListener("wheel",l,Dn),document.removeEventListener("touchmove",l,Dn),document.removeEventListener("touchstart",u,Dn)}},[]);var p=t.removeScrollBar,g=t.inert;return m.createElement(m.Fragment,null,g?m.createElement(s,{styles:Yx(o)}):null,p?m.createElement(Ux,{gapMode:t.gapMode}):null)}function e0(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const t0=Ax(jf,Qx);var bl=m.forwardRef(function(t,e){return m.createElement(Is,dt({},t,{ref:e,sideCar:t0}))});bl.classNames=Is.classNames;var xl="Popover",[Mf,WR]=ll(xl,[yf]),po=yf(),[n0,In]=Mf(xl),Lf=t=>{const{__scopePopover:e,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!1}=t,a=po(e),l=m.useRef(null),[c,u]=m.useState(!1),[d=!1,f]=Tf({prop:r,defaultProp:o,onChange:s});return h.jsx(cx,{...a,children:h.jsx(n0,{scope:e,contentId:ft(),triggerRef:l,open:d,onOpenChange:f,onOpenToggle:m.useCallback(()=>f(p=>!p),[f]),hasCustomAnchor:c,onCustomAnchorAdd:m.useCallback(()=>u(!0),[]),onCustomAnchorRemove:m.useCallback(()=>u(!1),[]),modal:i,children:n})})};Lf.displayName=xl;var Bf="PopoverAnchor",r0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=In(Bf,n),s=po(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=o;return m.useEffect(()=>(i(),()=>a()),[i,a]),h.jsx(Ef,{...s,...r,ref:e})});r0.displayName=Bf;var Ff="PopoverTrigger",Uf=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=In(Ff,n),s=po(n),i=at(e,o.triggerRef),a=h.jsx(be.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":qf(o.open),...r,ref:i,onClick:Ke(t.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:h.jsx(Ef,{asChild:!0,...s,children:a})});Uf.displayName=Ff;var o0="PopoverPortal",[GR,s0]=Mf(o0,{forceMount:void 0}),yr="PopoverContent",Hf=m.forwardRef((t,e)=>{const n=s0(yr,t.__scopePopover),{forceMount:r=n.forceMount,...o}=t,s=In(yr,t.__scopePopover);return h.jsx(fo,{present:r||s.open,children:s.modal?h.jsx(i0,{...o,ref:e}):h.jsx(a0,{...o,ref:e})})});Hf.displayName=yr;var i0=m.forwardRef((t,e)=>{const n=In(yr,t.__scopePopover),r=m.useRef(null),o=at(e,r),s=m.useRef(!1);return m.useEffect(()=>{const i=r.current;if(i)return Rf(i)},[]),h.jsx(bl,{as:Ps,allowPinchZoom:!0,children:h.jsx(Wf,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ke(t.onCloseAutoFocus,i=>{i.preventDefault(),s.current||n.triggerRef.current?.focus()}),onPointerDownOutside:Ke(t.onPointerDownOutside,i=>{const a=i.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Ke(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),a0=m.forwardRef((t,e)=>{const n=In(yr,t.__scopePopover),r=m.useRef(!1),o=m.useRef(!1);return h.jsx(Wf,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;n.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),Wf=m.forwardRef((t,e)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=t,f=In(yr,n),p=po(n);return Vh(),h.jsx(ul,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:h.jsx(cl,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>f.onOpenChange(!1),children:h.jsx(ux,{"data-state":qf(f.open),role:"dialog",id:f.contentId,...p,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Gf="PopoverClose",l0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=In(Gf,n);return h.jsx(be.button,{type:"button",...r,ref:e,onClick:Ke(t.onClick,()=>o.onOpenChange(!1))})});l0.displayName=Gf;var c0="PopoverArrow",u0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=po(n);return h.jsx(dx,{...o,...r,ref:e})});u0.displayName=c0;function qf(t){return t?"open":"closed"}var d0=Uf;function Vf(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(e=0;e<o;e++)t[e]&&(n=Vf(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function Kf(){for(var t,e,n=0,r="",o=arguments.length;n<o;n++)(t=arguments[n])&&(e=Vf(t))&&(r&&(r+=" "),r+=e);return r}function Te(...t){return al(Kf(t))}const Xf=Lf,Jf=d0,Yf=m.forwardRef(({className:t,align:e="end",...n},r)=>h.jsx(Hf,{ref:r,align:e,className:Te("z-popups drop-shadow-oneBlock p-0 border-shadow outline-none",t),...n,onKeyDown:o=>{o.stopPropagation()}})),Os=({children:t,scaleFactor:e})=>{const n=Kd();return h.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??n,"--block":`${(e??n)*8}px`},children:t})};var qc=1,h0=.9,f0=.8,p0=.17,wi=.1,bi=.999,m0=.9999,g0=.99,y0=/[\\\/_+.#"@\[\(\{&]/,v0=/[\\\/_+.#"@\[\(\{&]/g,w0=/[\s-]/,Zf=/[\s-]/g;function ga(t,e,n,r,o,s,i){if(s===e.length)return o===t.length?qc:g0;var a=`${o},${s}`;if(i[a]!==void 0)return i[a];for(var l=r.charAt(s),c=n.indexOf(l,o),u=0,d,f,p,g;c>=0;)d=ga(t,e,n,r,c+1,s+1,i),d>u&&(c===o?d*=qc:y0.test(t.charAt(c-1))?(d*=f0,p=t.slice(o,c-1).match(v0),p&&o>0&&(d*=Math.pow(bi,p.length))):w0.test(t.charAt(c-1))?(d*=h0,g=t.slice(o,c-1).match(Zf),g&&o>0&&(d*=Math.pow(bi,g.length))):(d*=p0,o>0&&(d*=Math.pow(bi,c-o))),t.charAt(c)!==e.charAt(s)&&(d*=m0)),(d<wi&&n.charAt(c-1)===r.charAt(s+1)||r.charAt(s+1)===r.charAt(s)&&n.charAt(c-1)!==r.charAt(s))&&(f=ga(t,e,n,r,c+1,s+2,i),f*wi>d&&(d=f*wi)),d>u&&(u=d),c=n.indexOf(l,c+1);return i[a]=u,u}function Vc(t){return t.toLowerCase().replace(Zf," ")}function b0(t,e,n){return t=n&&n.length>0?`${t+" "+n.join(" ")}`:t,ga(t,e,Vc(t),Vc(e),0,0,{})}var _l="Dialog",[Qf,qR]=ll(_l),[x0,lt]=Qf(_l),ep=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!0}=t,a=m.useRef(null),l=m.useRef(null),[c=!1,u]=Tf({prop:r,defaultProp:o,onChange:s});return h.jsx(x0,{scope:e,triggerRef:a,contentRef:l,contentId:ft(),titleId:ft(),descriptionId:ft(),open:c,onOpenChange:u,onOpenToggle:m.useCallback(()=>u(d=>!d),[u]),modal:i,children:n})};ep.displayName=_l;var tp="DialogTrigger",_0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(tp,n),s=at(e,o.triggerRef);return h.jsx(be.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":kl(o.open),...r,ref:s,onClick:Ke(t.onClick,o.onOpenToggle)})});_0.displayName=tp;var Sl="DialogPortal",[S0,np]=Qf(Sl,{forceMount:void 0}),rp=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:o}=t,s=lt(Sl,e);return h.jsx(S0,{scope:e,forceMount:n,children:m.Children.map(r,i=>h.jsx(fo,{present:n||s.open,children:h.jsx(Pf,{asChild:!0,container:o,children:i})}))})};rp.displayName=Sl;var gs="DialogOverlay",op=m.forwardRef((t,e)=>{const n=np(gs,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,s=lt(gs,t.__scopeDialog);return s.modal?h.jsx(fo,{present:r||s.open,children:h.jsx(C0,{...o,ref:e})}):null});op.displayName=gs;var C0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(gs,n);return h.jsx(bl,{as:Ps,allowPinchZoom:!0,shards:[o.contentRef],children:h.jsx(be.div,{"data-state":kl(o.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),_n="DialogContent",sp=m.forwardRef((t,e)=>{const n=np(_n,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,s=lt(_n,t.__scopeDialog);return h.jsx(fo,{present:r||s.open,children:s.modal?h.jsx(k0,{...o,ref:e}):h.jsx(E0,{...o,ref:e})})});sp.displayName=_n;var k0=m.forwardRef((t,e)=>{const n=lt(_n,t.__scopeDialog),r=m.useRef(null),o=at(e,n.contentRef,r);return m.useEffect(()=>{const s=r.current;if(s)return Rf(s)},[]),h.jsx(ip,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ke(t.onCloseAutoFocus,s=>{s.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Ke(t.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:Ke(t.onFocusOutside,s=>s.preventDefault())})}),E0=m.forwardRef((t,e)=>{const n=lt(_n,t.__scopeDialog),r=m.useRef(!1),o=m.useRef(!1);return h.jsx(ip,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;n.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),ip=m.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=t,a=lt(_n,n),l=m.useRef(null),c=at(e,l);return Vh(),h.jsxs(h.Fragment,{children:[h.jsx(ul,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:h.jsx(cl,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":kl(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),h.jsxs(h.Fragment,{children:[h.jsx(R0,{titleId:a.titleId}),h.jsx(O0,{contentRef:l,descriptionId:a.descriptionId})]})]})}),Cl="DialogTitle",P0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(Cl,n);return h.jsx(be.h2,{id:o.titleId,...r,ref:e})});P0.displayName=Cl;var ap="DialogDescription",T0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(ap,n);return h.jsx(be.p,{id:o.descriptionId,...r,ref:e})});T0.displayName=ap;var lp="DialogClose",A0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(lp,n);return h.jsx(be.button,{type:"button",...r,ref:e,onClick:Ke(t.onClick,()=>o.onOpenChange(!1))})});A0.displayName=lp;function kl(t){return t?"open":"closed"}var cp="DialogTitleWarning",[VR,up]=Fw(cp,{contentName:_n,titleName:Cl,docsSlug:"dialog"}),R0=({titleId:t})=>{const e=up(cp),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return m.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},I0="DialogDescriptionWarning",O0=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${up(I0).contentName}}.`;return m.useEffect(()=>{const o=t.current?.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},j0=ep,$0=rp,N0=op,z0=sp,xi={exports:{}},_i={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kc;function D0(){if(Kc)return _i;Kc=1;var t=Kg();function e(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,o=t.useEffect,s=t.useLayoutEffect,i=t.useDebugValue;function a(d,f){var p=f(),g=r({inst:{value:p,getSnapshot:f}}),y=g[0].inst,v=g[1];return s(function(){y.value=p,y.getSnapshot=f,l(y)&&v({inst:y})},[d,p,f]),o(function(){return l(y)&&v({inst:y}),d(function(){l(y)&&v({inst:y})})},[d]),i(p),p}function l(d){var f=d.getSnapshot;d=d.value;try{var p=f();return!n(d,p)}catch{return!0}}function c(d,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return _i.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,_i}var Xc;function M0(){return Xc||(Xc=1,xi.exports=D0()),xi.exports}var L0=M0(),Nr='[cmdk-group=""]',Si='[cmdk-group-items=""]',B0='[cmdk-group-heading=""]',El='[cmdk-item=""]',Jc=`${El}:not([aria-disabled="true"])`,ya="cmdk-item-select",dn="data-value",F0=(t,e,n)=>b0(t,e,n),dp=m.createContext(void 0),mo=()=>m.useContext(dp),hp=m.createContext(void 0),Pl=()=>m.useContext(hp),fp=m.createContext(void 0),pp=m.forwardRef((t,e)=>{let n=Zn(()=>{var P,E;return{search:"",value:(E=(P=t.value)!=null?P:t.defaultValue)!=null?E:"",filtered:{count:0,items:new Map,groups:new Set}}}),r=Zn(()=>new Set),o=Zn(()=>new Map),s=Zn(()=>new Map),i=Zn(()=>new Set),a=mp(t),{label:l,children:c,value:u,onValueChange:d,filter:f,shouldFilter:p,loop:g,disablePointerSelection:y=!1,vimBindings:v=!0,...w}=t,_=ft(),x=ft(),b=ft(),C=m.useRef(null),k=Z0();Sn(()=>{if(u!==void 0){let P=u.trim();n.current.value=P,S.emit()}},[u]),Sn(()=>{k(6,ee)},[]);let S=m.useMemo(()=>({subscribe:P=>(i.current.add(P),()=>i.current.delete(P)),snapshot:()=>n.current,setState:(P,E,R)=>{var T,I,A;if(!Object.is(n.current[P],E)){if(n.current[P]=E,P==="search")O(),D(),k(1,q);else if(P==="value"&&(R||k(5,ee),((T=a.current)==null?void 0:T.value)!==void 0)){let z=E??"";(A=(I=a.current).onValueChange)==null||A.call(I,z);return}S.emit()}},emit:()=>{i.current.forEach(P=>P())}}),[]),$=m.useMemo(()=>({value:(P,E,R)=>{var T;E!==((T=s.current.get(P))==null?void 0:T.value)&&(s.current.set(P,{value:E,keywords:R}),n.current.filtered.items.set(P,H(E,R)),k(2,()=>{D(),S.emit()}))},item:(P,E)=>(r.current.add(P),E&&(o.current.has(E)?o.current.get(E).add(P):o.current.set(E,new Set([P]))),k(3,()=>{O(),D(),n.current.value||q(),S.emit()}),()=>{s.current.delete(P),r.current.delete(P),n.current.filtered.items.delete(P);let R=M();k(4,()=>{O(),R?.getAttribute("id")===P&&q(),S.emit()})}),group:P=>(o.current.has(P)||o.current.set(P,new Set),()=>{s.current.delete(P),o.current.delete(P)}),filter:()=>a.current.shouldFilter,label:l||t["aria-label"],getDisablePointerSelection:()=>a.current.disablePointerSelection,listId:_,inputId:b,labelId:x,listInnerRef:C}),[]);function H(P,E){var R,T;let I=(T=(R=a.current)==null?void 0:R.filter)!=null?T:F0;return P?I(P,n.current.search,E):0}function D(){if(!n.current.search||a.current.shouldFilter===!1)return;let P=n.current.filtered.items,E=[];n.current.filtered.groups.forEach(T=>{let I=o.current.get(T),A=0;I.forEach(z=>{let re=P.get(z);A=Math.max(re,A)}),E.push([T,A])});let R=C.current;K().sort((T,I)=>{var A,z;let re=T.getAttribute("id"),le=I.getAttribute("id");return((A=P.get(le))!=null?A:0)-((z=P.get(re))!=null?z:0)}).forEach(T=>{let I=T.closest(Si);I?I.appendChild(T.parentElement===I?T:T.closest(`${Si} > *`)):R.appendChild(T.parentElement===R?T:T.closest(`${Si} > *`))}),E.sort((T,I)=>I[1]-T[1]).forEach(T=>{var I;let A=(I=C.current)==null?void 0:I.querySelector(`${Nr}[${dn}="${encodeURIComponent(T[0])}"]`);A?.parentElement.appendChild(A)})}function q(){let P=K().find(R=>R.getAttribute("aria-disabled")!=="true"),E=P?.getAttribute(dn);S.setState("value",E||void 0)}function O(){var P,E,R,T;if(!n.current.search||a.current.shouldFilter===!1){n.current.filtered.count=r.current.size;return}n.current.filtered.groups=new Set;let I=0;for(let A of r.current){let z=(E=(P=s.current.get(A))==null?void 0:P.value)!=null?E:"",re=(T=(R=s.current.get(A))==null?void 0:R.keywords)!=null?T:[],le=H(z,re);n.current.filtered.items.set(A,le),le>0&&I++}for(let[A,z]of o.current)for(let re of z)if(n.current.filtered.items.get(re)>0){n.current.filtered.groups.add(A);break}n.current.filtered.count=I}function ee(){var P,E,R;let T=M();T&&(((P=T.parentElement)==null?void 0:P.firstChild)===T&&((R=(E=T.closest(Nr))==null?void 0:E.querySelector(B0))==null||R.scrollIntoView({block:"nearest"})),T.scrollIntoView({block:"nearest"}))}function M(){var P;return(P=C.current)==null?void 0:P.querySelector(`${El}[aria-selected="true"]`)}function K(){var P;return Array.from(((P=C.current)==null?void 0:P.querySelectorAll(Jc))||[])}function X(P){let E=K()[P];E&&S.setState("value",E.getAttribute(dn))}function Z(P){var E;let R=M(),T=K(),I=T.findIndex(z=>z===R),A=T[I+P];(E=a.current)!=null&&E.loop&&(A=I+P<0?T[T.length-1]:I+P===T.length?T[0]:T[I+P]),A&&S.setState("value",A.getAttribute(dn))}function F(P){let E=M(),R=E?.closest(Nr),T;for(;R&&!T;)R=P>0?J0(R,Nr):Y0(R,Nr),T=R?.querySelector(Jc);T?S.setState("value",T.getAttribute(dn)):Z(P)}let ie=()=>X(K().length-1),ve=P=>{P.preventDefault(),P.metaKey?ie():P.altKey?F(1):Z(1)},pe=P=>{P.preventDefault(),P.metaKey?X(0):P.altKey?F(-1):Z(-1)};return m.createElement(be.div,{ref:e,tabIndex:-1,...w,"cmdk-root":"",onKeyDown:P=>{var E;if((E=w.onKeyDown)==null||E.call(w,P),!P.defaultPrevented)switch(P.key){case"n":case"j":{v&&P.ctrlKey&&ve(P);break}case"ArrowDown":{ve(P);break}case"p":case"k":{v&&P.ctrlKey&&pe(P);break}case"ArrowUp":{pe(P);break}case"Home":{P.preventDefault(),X(0);break}case"End":{P.preventDefault(),ie();break}case"Enter":if(!P.nativeEvent.isComposing&&P.keyCode!==229){P.preventDefault();let R=M();if(R){let T=new Event(ya);R.dispatchEvent(T)}}}}},m.createElement("label",{"cmdk-label":"",htmlFor:$.inputId,id:$.labelId,style:e_},l),js(t,P=>m.createElement(hp.Provider,{value:S},m.createElement(dp.Provider,{value:$},P))))}),U0=m.forwardRef((t,e)=>{var n,r;let o=ft(),s=m.useRef(null),i=m.useContext(fp),a=mo(),l=mp(t),c=(r=(n=l.current)==null?void 0:n.forceMount)!=null?r:i?.forceMount;Sn(()=>{if(!c)return a.item(o,i?.id)},[c]);let u=gp(o,s,[t.value,t.children,s],t.keywords),d=Pl(),f=Cn(k=>k.value&&k.value===u.current),p=Cn(k=>c||a.filter()===!1?!0:k.search?k.filtered.items.get(o)>0:!0);m.useEffect(()=>{let k=s.current;if(!(!k||t.disabled))return k.addEventListener(ya,g),()=>k.removeEventListener(ya,g)},[p,t.onSelect,t.disabled]);function g(){var k,S;y(),(S=(k=l.current).onSelect)==null||S.call(k,u.current)}function y(){d.setState("value",u.current,!0)}if(!p)return null;let{disabled:v,value:w,onSelect:_,forceMount:x,keywords:b,...C}=t;return m.createElement(be.div,{ref:ro([s,e]),...C,id:o,"cmdk-item":"",role:"option","aria-disabled":!!v,"aria-selected":!!f,"data-disabled":!!v,"data-selected":!!f,onPointerMove:v||a.getDisablePointerSelection()?void 0:y,onClick:v?void 0:g},t.children)}),H0=m.forwardRef((t,e)=>{let{heading:n,children:r,forceMount:o,...s}=t,i=ft(),a=m.useRef(null),l=m.useRef(null),c=ft(),u=mo(),d=Cn(p=>o||u.filter()===!1?!0:p.search?p.filtered.groups.has(i):!0);Sn(()=>u.group(i),[]),gp(i,a,[t.value,t.heading,l]);let f=m.useMemo(()=>({id:i,forceMount:o}),[o]);return m.createElement(be.div,{ref:ro([a,e]),...s,"cmdk-group":"",role:"presentation",hidden:d?void 0:!0},n&&m.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:c},n),js(t,p=>m.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?c:void 0},m.createElement(fp.Provider,{value:f},p))))}),W0=m.forwardRef((t,e)=>{let{alwaysRender:n,...r}=t,o=m.useRef(null),s=Cn(i=>!i.search);return!n&&!s?null:m.createElement(be.div,{ref:ro([o,e]),...r,"cmdk-separator":"",role:"separator"})}),G0=m.forwardRef((t,e)=>{let{onValueChange:n,...r}=t,o=t.value!=null,s=Pl(),i=Cn(u=>u.search),a=Cn(u=>u.value),l=mo(),c=m.useMemo(()=>{var u;let d=(u=l.listInnerRef.current)==null?void 0:u.querySelector(`${El}[${dn}="${encodeURIComponent(a)}"]`);return d?.getAttribute("id")},[]);return m.useEffect(()=>{t.value!=null&&s.setState("search",t.value)},[t.value]),m.createElement(be.input,{ref:e,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":c,id:l.inputId,type:"text",value:o?t.value:i,onChange:u=>{o||s.setState("search",u.target.value),n?.(u.target.value)}})}),q0=m.forwardRef((t,e)=>{let{children:n,label:r="Suggestions",...o}=t,s=m.useRef(null),i=m.useRef(null),a=mo();return m.useEffect(()=>{if(i.current&&s.current){let l=i.current,c=s.current,u,d=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let f=l.offsetHeight;c.style.setProperty("--cmdk-list-height",f.toFixed(1)+"px")})});return d.observe(l),()=>{cancelAnimationFrame(u),d.unobserve(l)}}},[]),m.createElement(be.div,{ref:ro([s,e]),...o,"cmdk-list":"",role:"listbox","aria-label":r,id:a.listId},js(t,l=>m.createElement("div",{ref:ro([i,a.listInnerRef]),"cmdk-list-sizer":""},l)))}),V0=m.forwardRef((t,e)=>{let{open:n,onOpenChange:r,overlayClassName:o,contentClassName:s,container:i,...a}=t;return m.createElement(j0,{open:n,onOpenChange:r},m.createElement($0,{container:i},m.createElement(N0,{"cmdk-overlay":"",className:o}),m.createElement(z0,{"aria-label":t.label,"cmdk-dialog":"",className:s},m.createElement(pp,{ref:e,...a}))))}),K0=m.forwardRef((t,e)=>Cn(n=>n.filtered.count===0)?m.createElement(be.div,{ref:e,...t,"cmdk-empty":"",role:"presentation"}):null),X0=m.forwardRef((t,e)=>{let{progress:n,children:r,label:o="Loading...",...s}=t;return m.createElement(be.div,{ref:e,...s,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},js(t,i=>m.createElement("div",{"aria-hidden":!0},i)))}),We=Object.assign(pp,{List:q0,Item:U0,Input:G0,Group:H0,Separator:W0,Dialog:V0,Empty:K0,Loading:X0});function J0(t,e){let n=t.nextElementSibling;for(;n;){if(n.matches(e))return n;n=n.nextElementSibling}}function Y0(t,e){let n=t.previousElementSibling;for(;n;){if(n.matches(e))return n;n=n.previousElementSibling}}function mp(t){let e=m.useRef(t);return Sn(()=>{e.current=t}),e}var Sn=typeof window>"u"?m.useEffect:m.useLayoutEffect;function Zn(t){let e=m.useRef();return e.current===void 0&&(e.current=t()),e}function ro(t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}function Cn(t){let e=Pl(),n=()=>t(e.snapshot());return L0.useSyncExternalStore(e.subscribe,n,n)}function gp(t,e,n,r=[]){let o=m.useRef(),s=mo();return Sn(()=>{var i;let a=(()=>{var c;for(let u of n){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(c=u.current.textContent)==null?void 0:c.trim():o.current}})(),l=r.map(c=>c.trim());s.value(t,a,l),(i=e.current)==null||i.setAttribute(dn,a),o.current=a}),o}var Z0=()=>{let[t,e]=m.useState(),n=Zn(()=>new Map);return Sn(()=>{n.current.forEach(r=>r()),n.current=new Map},[t]),(r,o)=>{n.current.set(r,o),e({})}};function Q0(t){let e=t.type;return typeof e=="function"?e(t.props):"render"in e?e.render(t.props):t}function js({asChild:t,children:e},n){return t&&m.isValidElement(e)?m.cloneElement(Q0(e),{ref:e.ref},n(e.props.children)):n(e)}var e_={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const yp=m.forwardRef(({className:t,...e},n)=>h.jsx(We,{ref:n,className:Te("flex h-full w-full flex-col overflow-hidden bg-metallicBlue text-popover-foreground",t),...e}));yp.displayName=We.displayName;const vp=m.forwardRef(({className:t,...e},n)=>h.jsxs("div",{className:"flex items-center border-b px-1 pb-1","cmdk-input-wrapper":"",children:[h.jsx("span",{className:"sprite mr-1 texture-hud_char_gt"}),h.jsx(We.Input,{ref:n,className:Te("flex h-1 w-full bg-pastelBlue py-1 outline-none placeholder:text-shadow disabled:cursor-not-allowed",t),...e})]}));vp.displayName=We.Input.displayName;const wp=m.forwardRef(({className:t,...e},n)=>h.jsx(We.List,{ref:n,className:Te("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...e}));wp.displayName=We.List.displayName;const bp=m.forwardRef((t,e)=>h.jsx(We.Empty,{ref:e,className:"pl-1",...t}));bp.displayName=We.Empty.displayName;const xp=m.forwardRef(({className:t,...e},n)=>h.jsx(We.Group,{ref:n,className:Te("overflow-hidden",t),...e}));xp.displayName=We.Group.displayName;const t_=m.forwardRef(({className:t,...e},n)=>h.jsx(We.Separator,{ref:n,className:Te("-mx-1 h-px bg-shadow",t),...e}));t_.displayName=We.Separator.displayName;const $s=m.forwardRef(({className:t,...e},n)=>h.jsx(We.Item,{ref:n,className:Te("relative flex cursor-default select-none items-center text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-midRed hover:bg-pastelBlue data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...e}));$s.displayName=We.Item.displayName;function Et(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t?.(o),n===!1||!o.defaultPrevented)return e?.(o)}}function Yc(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function _p(...t){return e=>{let n=!1;const r=t.map(o=>{const s=Yc(o,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():Yc(t[o],null)}}}}function On(...t){return m.useCallback(_p(...t),t)}function Sp(t,e=[]){let n=[];function r(s,i){const a=m.createContext(i),l=n.length;n=[...n,i];const c=d=>{const{scope:f,children:p,...g}=d,y=f?.[t]?.[l]||a,v=m.useMemo(()=>g,Object.values(g));return h.jsx(y.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(d,f){const p=f?.[t]?.[l]||a,g=m.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=n.map(i=>m.createContext(i));return function(a){const l=a?.[t]||s;return m.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[r,n_(o,...e)]}function n_(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}function r_(t){const e=o_(t),n=m.forwardRef((r,o)=>{const{children:s,...i}=r,a=m.Children.toArray(s),l=a.find(i_);if(l){const c=l.props.children,u=a.map(d=>d===l?m.Children.count(c)>1?m.Children.only(null):m.isValidElement(c)?c.props.children:null:d);return h.jsx(e,{...i,ref:o,children:m.isValidElement(c)?m.cloneElement(c,void 0,u):null})}return h.jsx(e,{...i,ref:o,children:s})});return n.displayName=`${t}.Slot`,n}function o_(t){const e=m.forwardRef((n,r)=>{const{children:o,...s}=n;if(m.isValidElement(o)){const i=l_(o),a=a_(s,o.props);return o.type!==m.Fragment&&(a.ref=r?_p(r,i):i),m.cloneElement(o,a)}return m.Children.count(o)>1?m.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Cp=Symbol("radix.slottable");function s_(t){const e=({children:n})=>h.jsx(h.Fragment,{children:n});return e.displayName=`${t}.Slottable`,e.__radixId=Cp,e}function i_(t){return m.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Cp}function a_(t,e){const n={...e};for(const r in e){const o=t[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{const l=s(...a);return o(...a),l}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...t,...n}}function l_(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var c_=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],nn=c_.reduce((t,e)=>{const n=r_(`Primitive.${e}`),r=m.forwardRef((o,s)=>{const{asChild:i,...a}=o,l=i?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(l,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function u_(t,e){t&&Es.flushSync(()=>t.dispatchEvent(e))}function Ns(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t}),m.useMemo(()=>(...n)=>e.current?.(...n),[])}function d_(t,e=globalThis?.document){const n=Ns(t);m.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var h_="DismissableLayer",va="dismissableLayer.update",f_="dismissableLayer.pointerDownOutside",p_="dismissableLayer.focusOutside",Zc,kp=m.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ep=m.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=m.useContext(kp),[u,d]=m.useState(null),f=u?.ownerDocument??globalThis?.document,[,p]=m.useState({}),g=On(e,S=>d(S)),y=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),w=y.indexOf(v),_=u?y.indexOf(u):-1,x=c.layersWithOutsidePointerEventsDisabled.size>0,b=_>=w,C=y_(S=>{const $=S.target,H=[...c.branches].some(D=>D.contains($));!b||H||(o?.(S),i?.(S),S.defaultPrevented||a?.())},f),k=v_(S=>{const $=S.target;[...c.branches].some(D=>D.contains($))||(s?.(S),i?.(S),S.defaultPrevented||a?.())},f);return d_(S=>{_===c.layers.size-1&&(r?.(S),!S.defaultPrevented&&a&&(S.preventDefault(),a()))},f),m.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Zc=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),Qc(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=Zc)}},[u,f,n,c]),m.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),Qc())},[u,c]),m.useEffect(()=>{const S=()=>p({});return document.addEventListener(va,S),()=>document.removeEventListener(va,S)},[]),h.jsx(nn.div,{...l,ref:g,style:{pointerEvents:x?b?"auto":"none":void 0,...t.style},onFocusCapture:Et(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Et(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Et(t.onPointerDownCapture,C.onPointerDownCapture)})});Ep.displayName=h_;var m_="DismissableLayerBranch",g_=m.forwardRef((t,e)=>{const n=m.useContext(kp),r=m.useRef(null),o=On(e,r);return m.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),h.jsx(nn.div,{...t,ref:o})});g_.displayName=m_;function y_(t,e=globalThis?.document){const n=Ns(t),r=m.useRef(!1),o=m.useRef(()=>{});return m.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){Pp(f_,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function v_(t,e=globalThis?.document){const n=Ns(t),r=m.useRef(!1);return m.useEffect(()=>{const o=s=>{s.target&&!r.current&&Pp(p_,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Qc(){const t=new CustomEvent(va);document.dispatchEvent(t)}function Pp(t,e,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?u_(o,s):o.dispatchEvent(s)}var Qt=globalThis?.document?m.useLayoutEffect:()=>{},w_=Ss[" useId ".trim().toString()]||(()=>{}),b_=0;function x_(t){const[e,n]=m.useState(w_());return Qt(()=>{n(r=>r??String(b_++))},[t]),e?`radix-${e}`:""}var __="Arrow",Tp=m.forwardRef((t,e)=>{const{children:n,width:r=10,height:o=5,...s}=t;return h.jsx(nn.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});Tp.displayName=__;var S_=Tp;function C_(t){const[e,n]=m.useState(void 0);return Qt(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var Tl="Popper",[Ap,Rp]=Sp(Tl),[k_,Ip]=Ap(Tl),Op=t=>{const{__scopePopper:e,children:n}=t,[r,o]=m.useState(null);return h.jsx(k_,{scope:e,anchor:r,onAnchorChange:o,children:n})};Op.displayName=Tl;var jp="PopperAnchor",$p=m.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,s=Ip(jp,n),i=m.useRef(null),a=On(e,i);return m.useEffect(()=>{s.onAnchorChange(r?.current||i.current)}),r?null:h.jsx(nn.div,{...o,ref:a})});$p.displayName=jp;var Al="PopperContent",[E_,P_]=Ap(Al),Np=m.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:p="optimized",onPlaced:g,...y}=t,v=Ip(Al,n),[w,_]=m.useState(null),x=On(e,A=>_(A)),[b,C]=m.useState(null),k=C_(b),S=k?.width??0,$=k?.height??0,H=r+(s!=="center"?"-"+s:""),D=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},q=Array.isArray(c)?c:[c],O=q.length>0,ee={padding:D,boundary:q.filter(A_),altBoundary:O},{refs:M,floatingStyles:K,placement:X,isPositioned:Z,middlewareData:F}=af({strategy:"fixed",placement:H,whileElementsMounted:(...A)=>of(...A,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[lf({mainAxis:o+$,alignmentAxis:i}),l&&cf({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?uf():void 0,...ee}),l&&df({...ee}),hf({...ee,apply:({elements:A,rects:z,availableWidth:re,availableHeight:le})=>{const{width:Ne,height:ze}=z.reference,ae=A.floating.style;ae.setProperty("--radix-popper-available-width",`${re}px`),ae.setProperty("--radix-popper-available-height",`${le}px`),ae.setProperty("--radix-popper-anchor-width",`${Ne}px`),ae.setProperty("--radix-popper-anchor-height",`${ze}px`)}}),b&&pf({element:b,padding:a}),R_({arrowWidth:S,arrowHeight:$}),f&&ff({strategy:"referenceHidden",...ee})]}),[ie,ve]=Mp(X),pe=Ns(g);Qt(()=>{Z&&pe?.()},[Z,pe]);const P=F.arrow?.x,E=F.arrow?.y,R=F.arrow?.centerOffset!==0,[T,I]=m.useState();return Qt(()=>{w&&I(window.getComputedStyle(w).zIndex)},[w]),h.jsx("div",{ref:M.setFloating,"data-radix-popper-content-wrapper":"",style:{...K,transform:Z?K.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:T,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:h.jsx(E_,{scope:n,placedSide:ie,onArrowChange:C,arrowX:P,arrowY:E,shouldHideArrow:R,children:h.jsx(nn.div,{"data-side":ie,"data-align":ve,...y,ref:x,style:{...y.style,animation:Z?void 0:"none"}})})})});Np.displayName=Al;var zp="PopperArrow",T_={top:"bottom",right:"left",bottom:"top",left:"right"},Dp=m.forwardRef(function(e,n){const{__scopePopper:r,...o}=e,s=P_(zp,r),i=T_[s.placedSide];return h.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:h.jsx(S_,{...o,ref:n,style:{...o.style,display:"block"}})})});Dp.displayName=zp;function A_(t){return t!==null}var R_=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=Mp(n),d={start:"0%",center:"50%",end:"100%"}[u],f=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let g="",y="";return c==="bottom"?(g=i?d:`${f}px`,y=`${-l}px`):c==="top"?(g=i?d:`${f}px`,y=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,y=i?d:`${p}px`):c==="left"&&(g=`${r.floating.width+l}px`,y=i?d:`${p}px`),{data:{x:g,y}}}});function Mp(t){const[e,n="center"]=t.split("-");return[e,n]}var I_=Op,O_=$p,j_=Np,$_=Dp,N_="Portal",Lp=m.forwardRef((t,e)=>{const{container:n,...r}=t,[o,s]=m.useState(!1);Qt(()=>s(!0),[]);const i=n||o&&globalThis?.document?.body;return i?Wh.createPortal(h.jsx(nn.div,{...r,ref:e}),i):null});Lp.displayName=N_;function z_(t,e){return m.useReducer((n,r)=>e[n][r]??n,t)}var Rl=t=>{const{present:e,children:n}=t,r=D_(e),o=typeof n=="function"?n({present:r.isPresent}):m.Children.only(n),s=On(r.ref,M_(o));return typeof n=="function"||r.isPresent?m.cloneElement(o,{ref:s}):null};Rl.displayName="Presence";function D_(t){const[e,n]=m.useState(),r=m.useRef(null),o=m.useRef(t),s=m.useRef("none"),i=t?"mounted":"unmounted",[a,l]=z_(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return m.useEffect(()=>{const c=zo(r.current);s.current=a==="mounted"?c:"none"},[a]),Qt(()=>{const c=r.current,u=o.current;if(u!==t){const f=s.current,p=zo(c);t?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),Qt(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const y=zo(r.current).includes(p.animationName);if(p.target===e&&y&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},f=p=>{p.target===e&&(s.current=zo(r.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:m.useCallback(c=>{r.current=c?getComputedStyle(c):null,n(c)},[])}}function zo(t){return t?.animationName||"none"}function M_(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var L_=Ss[" useInsertionEffect ".trim().toString()]||Qt;function B_({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[o,s,i]=F_({defaultProp:e,onChange:n}),a=t!==void 0,l=a?t:o;{const u=m.useRef(t!==void 0);m.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,r])}const c=m.useCallback(u=>{if(a){const d=U_(u)?u(t):u;d!==t&&i.current?.(d)}else s(u)},[a,t,s,i]);return[l,c]}function F_({defaultProp:t,onChange:e}){const[n,r]=m.useState(t),o=m.useRef(n),s=m.useRef(e);return L_(()=>{s.current=e},[e]),m.useEffect(()=>{o.current!==n&&(s.current?.(n),o.current=n)},[n,o]),[n,r,s]}function U_(t){return typeof t=="function"}var H_=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),W_="VisuallyHidden",Bp=m.forwardRef((t,e)=>h.jsx(nn.span,{...t,ref:e,style:{...H_,...t.style}}));Bp.displayName=W_;var G_=Bp,[zs,KR]=Sp("Tooltip",[Rp]),Ds=Rp(),Fp="TooltipProvider",q_=700,wa="tooltip.open",[V_,Il]=zs(Fp),Up=t=>{const{__scopeTooltip:e,delayDuration:n=q_,skipDelayDuration:r=300,disableHoverableContent:o=!1,children:s}=t,i=m.useRef(!0),a=m.useRef(!1),l=m.useRef(0);return m.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),h.jsx(V_,{scope:e,isOpenDelayedRef:i,delayDuration:n,onOpen:m.useCallback(()=>{window.clearTimeout(l.current),i.current=!1},[]),onClose:m.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.current=!0,r)},[r]),isPointerInTransitRef:a,onPointerInTransitChange:m.useCallback(c=>{a.current=c},[]),disableHoverableContent:o,children:s})};Up.displayName=Fp;var oo="Tooltip",[K_,go]=zs(oo),Hp=t=>{const{__scopeTooltip:e,children:n,open:r,defaultOpen:o,onOpenChange:s,disableHoverableContent:i,delayDuration:a}=t,l=Il(oo,t.__scopeTooltip),c=Ds(e),[u,d]=m.useState(null),f=x_(),p=m.useRef(0),g=i??l.disableHoverableContent,y=a??l.delayDuration,v=m.useRef(!1),[w,_]=B_({prop:r,defaultProp:o??!1,onChange:S=>{S?(l.onOpen(),document.dispatchEvent(new CustomEvent(wa))):l.onClose(),s?.(S)},caller:oo}),x=m.useMemo(()=>w?v.current?"delayed-open":"instant-open":"closed",[w]),b=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,v.current=!1,_(!0)},[_]),C=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,_(!1)},[_]),k=m.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{v.current=!0,_(!0),p.current=0},y)},[y,_]);return m.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),h.jsx(I_,{...c,children:h.jsx(K_,{scope:e,contentId:f,open:w,stateAttribute:x,trigger:u,onTriggerChange:d,onTriggerEnter:m.useCallback(()=>{l.isOpenDelayedRef.current?k():b()},[l.isOpenDelayedRef,k,b]),onTriggerLeave:m.useCallback(()=>{g?C():(window.clearTimeout(p.current),p.current=0)},[C,g]),onOpen:b,onClose:C,disableHoverableContent:g,children:n})})};Hp.displayName=oo;var ba="TooltipTrigger",Wp=m.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=go(ba,n),s=Il(ba,n),i=Ds(n),a=m.useRef(null),l=On(e,a,o.onTriggerChange),c=m.useRef(!1),u=m.useRef(!1),d=m.useCallback(()=>c.current=!1,[]);return m.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),h.jsx(O_,{asChild:!0,...i,children:h.jsx(nn.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...r,ref:l,onPointerMove:Et(t.onPointerMove,f=>{f.pointerType!=="touch"&&!u.current&&!s.isPointerInTransitRef.current&&(o.onTriggerEnter(),u.current=!0)}),onPointerLeave:Et(t.onPointerLeave,()=>{o.onTriggerLeave(),u.current=!1}),onPointerDown:Et(t.onPointerDown,()=>{o.open&&o.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:Et(t.onFocus,()=>{c.current||o.onOpen()}),onBlur:Et(t.onBlur,o.onClose),onClick:Et(t.onClick,o.onClose)})})});Wp.displayName=ba;var Ol="TooltipPortal",[X_,J_]=zs(Ol,{forceMount:void 0}),Gp=t=>{const{__scopeTooltip:e,forceMount:n,children:r,container:o}=t,s=go(Ol,e);return h.jsx(X_,{scope:e,forceMount:n,children:h.jsx(Rl,{present:n||s.open,children:h.jsx(Lp,{asChild:!0,container:o,children:r})})})};Gp.displayName=Ol;var vr="TooltipContent",qp=m.forwardRef((t,e)=>{const n=J_(vr,t.__scopeTooltip),{forceMount:r=n.forceMount,side:o="top",...s}=t,i=go(vr,t.__scopeTooltip);return h.jsx(Rl,{present:r||i.open,children:i.disableHoverableContent?h.jsx(Vp,{side:o,...s,ref:e}):h.jsx(Y_,{side:o,...s,ref:e})})}),Y_=m.forwardRef((t,e)=>{const n=go(vr,t.__scopeTooltip),r=Il(vr,t.__scopeTooltip),o=m.useRef(null),s=On(e,o),[i,a]=m.useState(null),{trigger:l,onClose:c}=n,u=o.current,{onPointerInTransitChange:d}=r,f=m.useCallback(()=>{a(null),d(!1)},[d]),p=m.useCallback((g,y)=>{const v=g.currentTarget,w={x:g.clientX,y:g.clientY},_=nS(w,v.getBoundingClientRect()),x=rS(w,_),b=oS(y.getBoundingClientRect()),C=iS([...x,...b]);a(C),d(!0)},[d]);return m.useEffect(()=>()=>f(),[f]),m.useEffect(()=>{if(l&&u){const g=v=>p(v,u),y=v=>p(v,l);return l.addEventListener("pointerleave",g),u.addEventListener("pointerleave",y),()=>{l.removeEventListener("pointerleave",g),u.removeEventListener("pointerleave",y)}}},[l,u,p,f]),m.useEffect(()=>{if(i){const g=y=>{const v=y.target,w={x:y.clientX,y:y.clientY},_=l?.contains(v)||u?.contains(v),x=!sS(w,i);_?f():x&&(f(),c())};return document.addEventListener("pointermove",g),()=>document.removeEventListener("pointermove",g)}},[l,u,i,c,f]),h.jsx(Vp,{...t,ref:s})}),[Z_,Q_]=zs(oo,{isInside:!1}),eS=s_("TooltipContent"),Vp=m.forwardRef((t,e)=>{const{__scopeTooltip:n,children:r,"aria-label":o,onEscapeKeyDown:s,onPointerDownOutside:i,...a}=t,l=go(vr,n),c=Ds(n),{onClose:u}=l;return m.useEffect(()=>(document.addEventListener(wa,u),()=>document.removeEventListener(wa,u)),[u]),m.useEffect(()=>{if(l.trigger){const d=f=>{f.target?.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),h.jsx(Ep,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:h.jsxs(j_,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[h.jsx(eS,{children:r}),h.jsx(Z_,{scope:n,isInside:!0,children:h.jsx(G_,{id:l.contentId,role:"tooltip",children:o||r})})]})})});qp.displayName=vr;var Kp="TooltipArrow",tS=m.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=Ds(n);return Q_(Kp,n).isInside?null:h.jsx($_,{...o,...r,ref:e})});tS.displayName=Kp;function nS(t,e){const n=Math.abs(e.top-t.y),r=Math.abs(e.bottom-t.y),o=Math.abs(e.right-t.x),s=Math.abs(e.left-t.x);switch(Math.min(n,r,o,s)){case s:return"left";case o:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function rS(t,e,n=5){const r=[];switch(e){case"top":r.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":r.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":r.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":r.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return r}function oS(t){const{top:e,right:n,bottom:r,left:o}=t;return[{x:o,y:e},{x:n,y:e},{x:n,y:r},{x:o,y:r}]}function sS(t,e){const{x:n,y:r}=t;let o=!1;for(let s=0,i=e.length-1;s<e.length;i=s++){const a=e[s],l=e[i],c=a.x,u=a.y,d=l.x,f=l.y;u>r!=f>r&&n<(d-c)*(r-u)/(f-u)+c&&(o=!o)}return o}function iS(t){const e=t.slice();return e.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),aS(e)}function aS(t){if(t.length<=1)return t.slice();const e=[];for(let r=0;r<t.length;r++){const o=t[r];for(;e.length>=2;){const s=e[e.length-1],i=e[e.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))e.pop();else break}e.push(o)}e.pop();const n=[];for(let r=t.length-1;r>=0;r--){const o=t[r];for(;n.length>=2;){const s=n[n.length-1],i=n[n.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))n.pop();else break}n.push(o)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}var lS=Up,cS=Hp;const uS={"":m.Fragment,pre:"pre",code:"code",ol:"ol",ul:"ul",hr:"hr",blockquote:"blockquote",li:"li",a:"a",img:"img",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",p:"p",em:"em",strong:"strong"},eu=t=>t.replace(RegExp("^"+(t.match(/^(\t| )+/)||"")[0],"gm"),""),dS=t=>t&&typeof t!="string"&&["div","ul","ol","pre","h1","h2","h3","h4","h5","h6"].includes(t.t),Ci=t=>t.replace(/^\s+|\s+$/g," "),xe=(t,e=[],n={})=>({t,c:Array.isArray(e)?e:[e],p:n}),Br=(t,e=!1)=>{let n=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,r=0;const o=xe("");let s,i;e?(s=xe("p"),i=[o,s],o.c.push(s)):(s=o,i=[o]);let a;const l=(d,f=!0)=>(f&&i.push(d),s.c.push(d),f&&(s=d),d),c=d=>{const f=i.findIndex(p=>p.t===d);i=i.slice(0,f),s=i.at(-1)};for(;a=n.exec(t);){const d=t.substring(r,a.index);if(r=n.lastIndex,d!=="")if(s===o&&e){const f=xe("p",Ci(d));o.c.push(f),i=[o,f],s=f}else s.c.push(Ci(d));if(!d.match(/[^\\](\\\\)*\\$/)){if(a[3]||a[4]){const f=xe("pre",a[4]?eu(a[4]):xe("code",eu(a[3]),a[2]?{language:`language-${a[2].toLowerCase()}`}:{}));o.c.push(f),i=[o],s=o}else if(a[6]){const f=a[6],p=f!==">",g=!!f.match(/\./),y=p?g?"ol":"ul":"blockquote",v=a[5].split(`
`).map(_=>_.replace(/^(\*|-|\+|>|\d+\.)\s+/,"")).filter(_=>_.trim()!==""),w=xe(y,p?v.map(_=>xe("li",Br(_).c)):Br(v.join(`
`)).c);o.c.push(w),i=[o,w],s=o}else if(a[8]){const f=xe("img",[],{src:a[8],...a[7]?{alt:a[7]}:{}});if(e&&s===o){const p=xe("p",f);o.c.push(p),s=p,i=[o,p]}else l(f,!1)}else if(a[10]){const f=i.find(p=>p.t==="a");f&&(f.p.href=a[11])}else if(a[9])l(xe("a"));else if(a[14]){const f="h"+a[14].length;o.c.push(xe(f,Br(a[15]).c)),i=[o],s=o}else if(a[13])o.c.push(xe("h1",Br(a[12]).c)),i=[o],s=o;else if(a[16])l(xe("code",a[16]),!1);else if(a[17]?.[0]===`
`||a[17]===`  
`){if(!(i[1]?.t==="p")){const g=o.c;let y;for(y=g.length-1;y>=0&&!dS(g[y]);y--);if(y!==o.c.length-1){const v=o.c.splice(y+1);o.c.push(xe("p",v))}}const p=xe("p");o.c.push(p),i=[o,p],s=p}else if(a[1])o.c.push(xe("hr")),i=[o],s=o;else if(a[17]){const f=a[17].length===2?"strong":"em";i.findIndex(g=>g.t===f)===-1?l(xe(f)):c(f)}}}const u=Ci(t.substring(r));if(u.length){const d=o.c.at(-1);let f;d?.t==="p"?f=d:e?(f=xe("p"),o.c.push(f)):f=o,f.c.push(u)}return o.c=o.c.filter(d=>typeof d=="string"||d.t!=="p"||d.c?.length>0),o},hS=(t,e={})=>{const n={...uS,...e},r=(o,s=0)=>{const i=o.t===""?m.Fragment:n[o.t];return m.createElement(i,{...o.p,key:s},o.c.length===0?void 0:o.c.map((a,l)=>typeof a=="string"?a:r(a,l)))};return r(Br(t,!0))},fS=({markdown:t,customComponents:e})=>hS(t,e),Do="leading-none [&_[class*='texture-hud']]:mb-oneScaledPix",pS={h2:function({children:e}){return h.jsx("h2",{className:`mb-1 sprites-double-height text-metallicBlue zx:text-zxBlue clear-both ${Do}`,children:h.jsx(tt,{children:e})})},h3:function({children:e}){return h.jsx("h3",{className:"mt-1 mb-1 text-metallicBlue zx:text-zxBlue clear-both",children:h.jsx(tt,{children:e})})},blockquote:function({children:e}){return h.jsx("blockquote",{className:`${Do} mt-1 mb-1 text-moss zx:text-zxBlue clear-both`,children:h.jsxs(tt,{children:["> ",e]})})},p:function({children:e}){return h.jsx("div",{className:`mb-1 last:mb-0 ${Do}`,children:h.jsx(tt,{children:e})})},a:function({children:e,href:n}){return h.jsx("a",{className:"bitmap-text-link",href:n,target:"_blank",rel:"noopener noreferrer",children:h.jsx(tt,{children:e})})},li:function({children:e}){return h.jsx("div",{className:`mb-1 clear-both ${Do}`,children:h.jsxs(tt,{children:[h.jsx(L,{className:"text-metallicBlue zx:text-zxYellow",children:""}),e]})})},strong:function({children:e}){return h.jsx(tt,{className:"strong text-midRed zx:text-zxRed",children:e})},em:function({children:e}){return h.jsx(tt,{className:"em text-moss zx:text-zxBlue",children:e})},img:function({src:e}){const n=Kd();if(e===void 0)throw new Error("image without src");const r=e.split(/\?|&/);return h.jsx("span",{style:{"--scale":n*2},children:h.jsx("span",{className:al("sprite float-left mr-1 mb-1 zx:sprite-revert-to-two-tone",r.join(" "))})})},hr:function(){return h.jsx("hr",{className:"bg-metallicBlue zx:bg-zxWhite h-half mb-half border-none"})}},mS=({markdown:t,className:e})=>h.jsx("div",{className:`contents ${e}`,children:h.jsx(fS,{customComponents:pS,markdown:t})}),Xp=({triggerContent:t,tooltipContent:e})=>e?h.jsxs(cS,{children:[h.jsx(Wp,{asChild:!0,children:t}),h.jsx(Gp,{children:h.jsx(Os,{scaleFactor:2,children:h.jsx(qp,{side:"bottom",align:"end",className:"bg-highlightBeige text-white p-1 mt-oneScaledPix drop-shadow-oneBlock z-popups",children:typeof e=="string"?h.jsx("div",{className:"max-w-16",children:h.jsx(mS,{markdown:e})}):e})})})]}):t,Gt=({className:t,selected:e,disabled:n=!1,onClick:r,ref:o,tooltipContent:s,...i})=>{const a=h.jsx("button",{disabled:n,onClick:r,"data-selected":e,className:Te(`inline-flex items-center justify-center whitespace-nowrap 
          bg-metallicBlue zx:bg-zxBlue border-none border-shadow
          gap-2
           disabled:bg-midGrey disabled:text-lightGrey 
           data-[selected=true]:bg-lightBeige
           [&:not(:disabled):hover:not([data-selected=true])]:bg-pastelBlue 
           `,t),ref:o,...i});return h.jsx(Xp,{triggerContent:a,tooltipContent:s})};var tu=!1,hn,xa,_a,Qo,es,Jp,ts,Sa,Ca,ka,Yp,Ea,Pa,Zp,Qp;function Me(){if(!tu){tu=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),n=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(Ea=/\b(iPhone|iP[ao]d)/.exec(t),Pa=/\b(iP[ao]d)/.exec(t),ka=/Android/i.exec(t),Zp=/FBAN\/\w+;/i.exec(t),Qp=/Mobile/i.exec(t),Yp=!!/Win64/.exec(t),e){hn=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN,hn&&document&&document.documentMode&&(hn=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(t);Jp=r?parseFloat(r[1])+4:hn,xa=e[2]?parseFloat(e[2]):NaN,_a=e[3]?parseFloat(e[3]):NaN,Qo=e[4]?parseFloat(e[4]):NaN,Qo?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),es=e&&e[1]?parseFloat(e[1]):NaN):es=NaN}else hn=xa=_a=es=Qo=NaN;if(n){if(n[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);ts=o?parseFloat(o[1].replace("_",".")):!0}else ts=!1;Sa=!!n[2],Ca=!!n[3]}else ts=Sa=Ca=!1}}var Ta={ie:function(){return Me()||hn},ieCompatibilityMode:function(){return Me()||Jp>hn},ie64:function(){return Ta.ie()&&Yp},firefox:function(){return Me()||xa},opera:function(){return Me()||_a},webkit:function(){return Me()||Qo},safari:function(){return Ta.webkit()},chrome:function(){return Me()||es},windows:function(){return Me()||Sa},osx:function(){return Me()||ts},linux:function(){return Me()||Ca},iphone:function(){return Me()||Ea},mobile:function(){return Me()||Ea||Pa||ka||Qp},nativeApp:function(){return Me()||Zp},android:function(){return Me()||ka},ipad:function(){return Me()||Pa}},gS=Ta,yS=!!(typeof window<"u"&&window.document&&window.document.createElement),vS={canUseDOM:yS},em=vS,tm;em.canUseDOM&&(tm=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);function wS(t,e){if(!em.canUseDOM||e&&!("addEventListener"in document))return!1;var n="on"+t,r=n in document;if(!r){var o=document.createElement("div");o.setAttribute(n,"return;"),r=typeof o[n]=="function"}return!r&&tm&&t==="wheel"&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var bS=wS,nu=10,ru=40,ou=800;function nm(t){var e=0,n=0,r=0,o=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*nu,o=n*nu,"deltaY"in t&&(o=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||o)&&t.deltaMode&&(t.deltaMode==1?(r*=ru,o*=ru):(r*=ou,o*=ou)),r&&!e&&(e=r<1?-1:1),o&&!n&&(n=o<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:o}}nm.getEventType=function(){return gS.firefox()?"DOMMouseScroll":bS("wheel")?"wheel":"mousewheel"};var xS=nm;/**
* Checks if an event is supported in the current execution environment.
*
* NOTE: This will not work correctly for non-generic events such as `change`,
* `reset`, `load`, `error`, and `select`.
*
* Borrows from Modernizr.
*
* @param {string} eventNameSuffix Event name, e.g. "click".
* @param {?boolean} capture Check if the capture phase is supported.
* @return {boolean} True if the event is supported.
* @internal
* @license Modernizr 3.0.0pre (Custom Build) | MIT
*/const _S=(t,e,n=!1)=>{const r=m.useRef(0),o=m.useCallback(s=>{if(n)return;const i=s;i.preventDefault(),i.stopPropagation();const a=xS(i);r.current-=a.spinY,r.current>=1&&(e(1),r.current=0),r.current<=-1&&(e(-1),r.current=0)},[e,n]);m.useEffect(()=>{const s=t.current;if(s!==null)return s.addEventListener("wheel",o,{passive:!1}),()=>{s.removeEventListener("wheel",o)}},[t,o])},rm=(t,e,n,r=!1)=>{const o=m.useRef(0);return _S(t,s=>{if(e.length===0)return;const i=(o.current+s+256*e.length)%e.length;o.current=i,n(e[i],i)},r)},SS=({value:t,onSelect:e})=>h.jsx($s,{value:t,onSelect:e,className:"px-1",children:h.jsx(L,{children:t})}),Ms=t=>{const{value:e,values:n,onSelect:r,triggerButtonClassName:o="",triggerButtonStyle:s=ue,triggerButtonLabel:i="",OptionCommandItem:a=SS,tooltipContent:l}=t,[c,u]=m.useState(!1),d=m.useRef(null);return rm(d,n,f=>{r(f)},!c),h.jsxs(Xf,{open:c,onOpenChange:u,children:[h.jsx(Jf,{asChild:!0,children:h.jsxs(Gt,{className:Te("h-2 px-1 flex flex-row gap-1 justify-start leading-none",o),style:s,ref:d,tooltipContent:!c&&l,children:[typeof i=="string"?h.jsx(L,{className:"grow overflow-hidden text-left",children:i}):i,h.jsx(L,{className:"grow-0",children:c?"X":""})]})}),h.jsx(Yf,{className:"p-0",children:h.jsx(Os,{scaleFactor:2,children:h.jsxs(yp,{value:e,onValueChange:f=>r(f),className:"w-[--radix-popper-anchor-width]",children:[t.disableCommandInput===!0?null:h.jsx(vp,{placeholder:t.placeholder}),h.jsxs(wp,{children:[h.jsx(bp,{children:h.jsx(L,{children:"Nothing found"})}),h.jsx(xp,{children:n.map(f=>h.jsx(a,{value:f,onSelect:p=>{u(!1),r(p)}},f))})]})]})})})]})},CS=()=>{const t=He(),e=Xd();return h.jsx(h.Fragment,{children:h.jsx(Ms,{value:e,values:Xg,onSelect:n=>{t(Jg(n))},disableCommandInput:!0,triggerButtonLabel:e,triggerButtonClassName:"w-13"})})};function om({campaign:t,onSelect:e,headRoomId:n,heelsRoomId:r,value:o,triggerButtonClassName:s,excludeRoomIds:i=[],tooltipContent:a}){const l=Object.keys(t.rooms).filter(c=>!i.includes(c));return h.jsx(Ms,{onSelect:c=>e?.(c),value:o,values:l,triggerButtonClassName:s,placeholder:"search",tooltipContent:a,disableCommandInput:!1,triggerButtonLabel:o??"none",OptionCommandItem:({value:c})=>h.jsxs($s,{value:c,className:"px-1",children:[n===c&&h.jsx("span",{className:"sprite mr-1 my-1 texture-head_walking_towards_2"}),r===c&&h.jsx("span",{className:"sprite mr-1 my-1 texture-heels_walking_towards_2"}),h.jsx(L,{children:c})]})})}const V={w:16,d:16,h:12},su={x:16,y:16,z:12},ge=t=>t,sm="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",kS="h-[calc(2*var(--block)-1px*var(--scale))] w-[calc(2*var(--block)-1px*var(--scale))]",W=ge("[button:not([data-selected=true]):not(:hover)_&]:sprite-revert-to-two-tone-dim"),Ae=ge("flex flex-wrap gap-oneScaledPix w-full"),ES=/^(?<modifiers>[^]*)(?<key>.+)$/,PS=t=>{const e=new Set;for(const n of t){if(e.has(n))return!0;e.add(n)}return!1},im=(t,e,n)=>{const r=t?.join(" ");m.useEffect(()=>{if(!t||t.length===0)return;const o=s=>{if(s.target.closest(".monaco-editor")===null)for(const l of t){const c=l.match(ES);if(!c||!c.groups)continue;const{modifiers:u,key:d}=c.groups;if(PS(u)){console.warn(`Invalid shortcut "${l}": duplicate modifiers`);continue}const f=u.includes("^"),p=u.includes(""),g=u.includes(""),y=f||p||g,v=f===s.ctrlKey&&p===s.metaKey&&g===s.shiftKey&&(y||!s.ctrlKey&&!s.metaKey&&!s.shiftKey);if(s.key.toLowerCase()===d.toLowerCase()&&v){e||n?.(),s.preventDefault();break}}};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e,n,r])},ye=({className:t,onClick:e,children:n,disabled:r=!1,isCurrentTool:o=!1,shortcutKeys:s,small:i=!1,tooltipContent:a})=>(im(s,r,e),h.jsx(Gt,{disabled:r,selected:o,className:`
        ${i?kS:sm} 
        active:pt-oneScaledPix gap-0 inline-flex overflow-hidden 
        
        ${t??""}`,onClick:e,tooltipContent:a,children:n})),TS=()=>{const t=he(e=>e.levelEditor.selectedJsonItemIds.length>0);return h.jsx(ye,{className:"bg-midRed",disabled:!t,onClick:()=>U.dispatch(Ry()),shortcutKeys:["Delete","Backspace"],tooltipContent:`## Delete items
delete selected item(s)`,children:h.jsx("span",{className:"sprite sprite-tinted texture-hud_char_X relative"})})},kn=({className:t,value:e,onChange:n,trueLabel:r="ON",falseLabel:o="OFF",label:s,shortcutKeys:i,tooltipContent:a})=>{const l=Math.max(r.length,o.length)+1,c=r.padStart(l," "),u=o.padEnd(l," ");im(i,!1,()=>{n?.(!e,void 0)});const d=h.jsxs("span",{onClick:f=>n?.(!e,f),className:Te("inline-flex justify-between",t),children:[s&&h.jsx(L,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),h.jsx(L,{className:Kf("inline-block w-min h-min",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:e?c:u})]});return h.jsx(Xp,{triggerContent:d,tooltipContent:a})},AS=({className:t})=>{const e=He();return h.jsx(kn,{className:t,label:"snap",value:he(n=>n.levelEditor.halfGridResolution),onChange:n=>{e(Iy(n))},falseLabel:"Block",trueLabel:"Half",shortcutKeys:["S"],tooltipContent:`snaps to either the grid (like the original game)

or, allows placing on a half-block grid

hotkey: **S**
`})},am=t=>{const e=he(mn);return Ge(e?.type==="item"&&e.item,t)},j=({itemTool:t,children:e,className:n,shortcutKeys:r,tooltipContent:o})=>{const s=am(t);return h.jsx(ye,{isCurrentTool:s,className:n,onClick:()=>U.dispatch(wn({type:"item",item:t})),shortcutKeys:r,tooltipContent:o,children:e})},jl=({main:t,children:e,closeOnSelect:n,ref:r})=>{const[o,s]=m.useState(!1);return h.jsxs(Xf,{open:o,onOpenChange:s,children:[h.jsx("div",{ref:r,className:Te(sm,"relative",{"drop-shadow-oneBlock z-popups":o}),children:h.jsxs("span",{className:"content",children:[t,h.jsx(Jf,{asChild:!0,children:h.jsx(Gt,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:h.jsx(L,{className:"pl-oneScaledPix leading-none py-oneScaledPix",children:o?"X":""})})})]})}),h.jsx(Yf,{children:h.jsx(Os,{scaleFactor:2,children:h.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:e.map((i,a)=>i===null?null:h.jsx("div",{className:"leading-none",onClick:()=>{n&&s(!1)},children:i},a))})})})]})},zr=({children:t})=>{const[e,n]=m.useState(0),r=m.useRef(null);rm(r,t,(s,i)=>{n(i)});const o=t[e];return h.jsx(jl,{main:o,closeOnSelect:!0,ref:r,children:t.map((s,i)=>i===e?null:h.jsx("div",{className:"leading-none",onClick:()=>{n(i)},children:s},i))})},RS=()=>{const e=he(mn)?.type==="pointer";return h.jsx(ye,{onClick:()=>U.dispatch(wn({type:"pointer"})),isCurrentTool:e,shortcutKeys:["Escape","."],tooltipContent:`## Pointer
hotkey: **Esc** or **.**`,children:h.jsx("span",{className:"sprite texture-editor_tool_pointer relative"})})},N={pureBlack:new J("#000000"),shadow:new J("#325149"),midGrey:new J("#7F7773"),lightGrey:new J("#BBB1AB"),white:new J("#FBFEFB"),pastelBlue:new J("#75ACFF"),metallicBlue:new J("#366CAA"),pink:new J("#D68ED1"),moss:new J("#9E9600"),redShadow:new J("#805E50"),midRed:new J("#CA7463"),lightBeige:new J("#DAA78F"),highlightBeige:new J("#EBC690"),alpha:new J("#1E7790"),replaceLight:new J("#08A086"),replaceDark:new J("#0A4730")},Kr=.33,lm=t=>{const[e,n,r]=t.toUint8RgbArray();return new J({r:e*.75,g:n*.75,b:r*.75})},wr=(t,e=Kr)=>{const[n,r,o]=t.toUint8RgbArray();return new J({r:n*e,g:r*e,b:o*e})};function XR(t){t=t.replace(/^#/,"");let e=parseInt(t.substring(0,2),16),n=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16);e=Math.floor(e*Kr),n=Math.floor(n*Kr),r=Math.floor(r*Kr);const o=s=>s.toString(16).padStart(2,"0");return`#${o(e)}${o(n)}${o(r)}`}const Ze={original:new J(Cr.zxWhite),basic:N.white,dimmed:N.lightGrey},Qe={original:new J(Cr.zxYellow),basic:new J(15654246),dimmed:wr(new J(15654246),.5)},cm={original:new J(Cr.zxYellow),basic:N.midRed,dimmed:N.redShadow},ct={original:new J(Cr.zxMagenta),basic:N.pink,dimmed:wr(N.pink,.5)},_e={original:new J(Cr.zxCyan),basic:N.pastelBlue,dimmed:wr(N.pastelBlue,.5)},ut={original:new J(Cr.zxGreen),basic:N.moss,dimmed:wr(N.moss,.5)},Ls={white:{basic:{main:Ze,edges:{towards:{..._e,dimInOriginal:!1},right:{...Qe,dimInOriginal:!0}},hud:{lives:Qe,dimmed:ct,icons:_e}},dimmed:{main:Ze,edges:{towards:{...ut,dimInOriginal:!1},right:{..._e,dimInOriginal:!0}},hud:{lives:cm,dimmed:ct,icons:_e}}},yellow:{basic:{main:Qe,edges:{towards:{...ut,dimInOriginal:!1},right:{...Ze,dimInOriginal:!0}},hud:{lives:_e,dimmed:ct,icons:ut}},dimmed:{main:Qe,edges:{towards:{..._e,dimInOriginal:!0},right:{..._e,dimInOriginal:!1}},hud:{lives:_e,dimmed:ct,icons:ut}}},magenta:{basic:{main:ct,edges:{towards:{...ut,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Ze,dimmed:_e,icons:Qe}},dimmed:{main:ct,edges:{towards:{...ut,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Ze,dimmed:_e,icons:Qe}}},cyan:{basic:{main:_e,edges:{towards:{...ct,dimInOriginal:!1},right:{...Ze,dimInOriginal:!1}},hud:{lives:Ze,dimmed:ut,icons:Qe}},dimmed:{main:_e,edges:{towards:{...ct,dimInOriginal:!0},right:{...Ze,dimInOriginal:!0}},hud:{lives:Ze,dimmed:ut,icons:Qe}}},green:{basic:{main:ut,edges:{towards:{..._e,dimInOriginal:!1},right:{...Qe,dimInOriginal:!1}},hud:{lives:Ze,dimmed:ct,icons:_e}},dimmed:{main:ut,edges:{towards:{..._e,dimInOriginal:!0},right:{...Qe,dimInOriginal:!0}},hud:{lives:Ze,dimmed:ct,icons:_e}}}},ys=t=>Ls[t.hue][t.shade],or={head:N.pastelBlue,heels:N.pink},iu=t=>{const{main:e}=Ls[t].basic;return{backgroundColor:e.basic.toHex(),borderColor:e.dimmed.toHex()}};function IS(){const t=He(),e=he(Oy);return h.jsxs(h.Fragment,{children:[h.jsx(Ms,{value:e.hue,onSelect:n=>{t(Zl({hue:n}))},values:Yg,disableCommandInput:!0,OptionCommandItem:({value:n,onSelect:r})=>h.jsx($s,{value:n,className:"border-l-3 h-2 w-full p-0",style:iu(n),onSelect:r}),triggerButtonLabel:"colour",triggerButtonClassName:Te("w-full",`${e.hue==="white"||e.hue==="yellow"?"text-pureBlack":"text-white"}`),triggerButtonStyle:iu(e.hue),tooltipContent:"Change the colour of this room"}),h.jsx(kn,{className:"",label:"shade",value:e.shade==="basic",onChange:n=>{t(Zl({shade:n?"basic":"dimmed"}))},falseLabel:"dim",trueLabel:"basic"})]})}function OS(){const t=He(),e=he(jy);return h.jsx(Ms,{value:e,onSelect:n=>{t($y(n))},values:Zg,placeholder:"scenery",triggerButtonClassName:"w-full",triggerButtonLabel:e,tooltipContent:"Change this rooms scenery"})}const _t=({iconClasses:t,text:e,className:n=""})=>h.jsxs("div",{className:`relative w-full h-full ${n}`,children:[h.jsx("span",{className:`sprite absolute top-0 left-0 ${t} ${W}`}),h.jsx(L,{className:"bg-moss text-pureBlack absolute top-0 left-0 pl-oneScaledPix py-oneScaledPix block leading-none",children:e})]}),Mo=({iconClassName:t})=>h.jsx(St,{topClasses:ge("texture-bubbles_white_2 [button:hover_&]:texture-animated-bubbles_white"),bottomClasses:t}),St=({topClasses:t,bottomClasses:e="texture-headlessBase"})=>h.jsxs("div",{className:"relative w-full h-full",children:[h.jsx("span",{className:`sprite absolute top-[calc(9px*var(--scale))] left-0 ${e} ${W}`}),h.jsx("span",{className:`sprite absolute top-[calc(-3px*var(--scale))] left-0 ${t} ${W}`})]}),jS="[button:not(:disabled):hover_&]:hidden",$S="hidden [button:not(:disabled):hover_&]:inline mt-quarter",NS="hidden [button:not(:disabled):hover_&]:inline",Aa=({icon:t,topText:e,bottomText:n})=>h.jsxs("span",{className:"w-full h-full flex flex-col items-center justify-center",children:[h.jsx("span",{className:jS,children:t}),h.jsx(L,{className:$S,children:e}),h.jsx(L,{className:NS,children:n})]}),zS=()=>{const t=He(),e=he(Ny),n=he(zy);return h.jsxs("div",{className:"flex flex-row gap-oneScaledPix bg-metallicBlue",children:[h.jsx(ye,{disabled:!e,onClick:()=>{t(Dy())},shortcutKeys:["Z","^Z"],children:h.jsx(Aa,{icon:h.jsx(L,{children:""}),topText:"un",bottomText:"do"})}),h.jsx(ye,{disabled:!n,onClick:()=>{t(My())},shortcutKeys:["Z","^Z"],children:h.jsx(Aa,{icon:h.jsx(L,{children:""}),topText:"re",bottomText:"do"})})]})},DS=({className:t})=>{const e=He();return h.jsx(kn,{className:t,label:"scenery",value:he(n=>n.levelEditor.wallsFloorsLocked),onChange:n=>{e(Ly(n))},falseLabel:"edit",trueLabel:"lock",shortcutKeys:["C"],tooltipContent:`locks walls and floors, to edit their contents

hotkey: **C**
`})};function au(t){return{type:"door",config:{direction:"away",toRoom:t?"+":"nowhere"}}}const MS=()=>{const[t,e]=m.useState(!0),n=he(i=>pr(i).planet),r=ge(n==="moonbase"?"texture-door_frame_moonbase_x_whole":"texture-door_frame_generic_x_whole"),o=au(t),s=am(o);return h.jsx(jl,{main:h.jsx(j,{itemTool:o,shortcutKeys:["D"],children:h.jsx(_t,{iconClasses:`sprite top-[calc(-17px*var(--scale))] left-[calc(-2px*var(--scale))] ${r} ${W}`,text:t?"+":""})}),children:[h.jsx(kn,{className:"w-full",value:t,label:"auto + room",onChange:i=>{e(i),s&&U.dispatch(wn({type:"item",item:au(i)}))}},"autoAddDoor")]})},LS=()=>{const t=he(r=>pr(r).planet),e={type:"wall",config:{direction:"away",tiles:Array.from(By(t,1))}},n=ge(t==="blacktooth"?"texture-blacktooth_wall_plain_away":t==="bookworld"?"texture-bookworld_wall_cowboy_away":t==="jail"?"texture-jail_wall_bars_away":t==="egyptus"?"texture-egyptus_wall_hieroglyphics_away":t==="market"?"texture-market_wall_passage_away":t==="moonbase"?"texture-moonbase_wall_window1_away":t==="penitentiary"?"texture-penitentiary_wall_loop_away":"texture-safari_wall_wall_away");return h.jsx(j,{itemTool:e,children:h.jsx("span",{className:`sprite ${n} ${W}`})})},BS=()=>h.jsx(ye,{className:"bg-midRed",onClick:()=>U.dispatch(Fy()),tooltipContent:`## Clear room

Clears the room out, leaving just walls, floors, and doors`,children:h.jsx(L,{className:"relative leading-none",children:"CLR"})}),um=({currentRoomId:t,direction:e})=>{const n=he(({levelEditor:s})=>s.campaignInProgress),r=he(({levelEditor:s})=>s.currentlyEditingRoomId),o=He();return h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap pt-1",children:[h.jsxs(L,{className:"text-lightGrey leading-none",children:["Room ",e==="above"?"":""]}),h.jsx("div",{className:"flex-grow"}),h.jsxs("div",{className:"flex flex-row gap-oneScaledPix",children:[h.jsx(Gt,{className:"w-2 leading-none bg-moss",tooltipContent:`Add a new room *${e}* this one`,children:h.jsx(L,{onClick:()=>o(Qs({direction:e,createNew:!0})),children:"+"})}),h.jsx(Gt,{className:"w-2 leading-none bg-midRed",tooltipContent:`Break the link with the room *${e}*`,children:h.jsx(L,{onClick:()=>o(Qs({direction:e,createNew:!1,roomId:void 0})),children:"x"})})]})]}),h.jsx("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap",children:h.jsx(om,{value:t,campaign:n,excludeRoomIds:[r],triggerButtonClassName:"w-full",onSelect:s=>{o(Qs({direction:e,createNew:!1,roomId:s}))},tooltipContent:`Select a room to place *${e}* this one`})})]})},FS=()=>{const t=he(({levelEditor:e})=>oh(e).roomAbove);return h.jsx(h.Fragment,{children:h.jsx(um,{currentRoomId:t,direction:"above"})})},US=()=>{const t=he(({levelEditor:e})=>oh(e).roomBelow);return h.jsx(h.Fragment,{children:h.jsx(um,{currentRoomId:t,direction:"below"})})},HS=()=>{const t=he(({levelEditor:e})=>e.tool.type==="eyeDropper");return h.jsx(ye,{shortcutKeys:["I",","],isCurrentTool:t,onClick:()=>U.dispatch(wn({type:"eyeDropper"})),tooltipContent:`## eye-dropper

click on an item in the room to copy it and put a copy down somewhere else
  
hotkey: **I** or **,**`,children:h.jsx("span",{className:"relative sprite texture-editor_tool_eyedropper leading-none"})})},Bs=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const WS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Fr=Array.prototype.slice.call(WS),Lo=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(Fr),GS=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ns=String.fromCharCode.bind(String),lu=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),qS=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),dm=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),VS=t=>{let e,n,r,o,s="";const i=t.length%3;for(let a=0;a<t.length;){if((n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(o=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|o,s+=Fr[e>>18&63]+Fr[e>>12&63]+Fr[e>>6&63]+Fr[e&63]}return i?s.slice(0,i-3)+"===".substring(i):s},KS=typeof btoa=="function"?t=>btoa(t):Bs?t=>Buffer.from(t,"binary").toString("base64"):VS,cu=Bs?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let r=0,o=t.length;r<o;r+=4096)n.push(ns.apply(null,t.subarray(r,r+4096)));return KS(n.join(""))},XS=(t,e=!1)=>e?qS(cu(t)):cu(t),JS=t=>{if(t=t.replace(/\s+/g,""),!GS.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,o;for(let s=0;s<t.length;)e=Lo[t.charAt(s++)]<<18|Lo[t.charAt(s++)]<<12|(r=Lo[t.charAt(s++)])<<6|(o=Lo[t.charAt(s++)]),n+=r===64?ns(e>>16&255):o===64?ns(e>>16&255,e>>8&255):ns(e>>16&255,e>>8&255,e&255);return n},YS=typeof atob=="function"?t=>atob(dm(t)):Bs?t=>Buffer.from(t,"base64").toString("binary"):JS,ZS=Bs?t=>lu(Buffer.from(t,"base64")):t=>lu(YS(t).split("").map(e=>e.charCodeAt(0))),QS=t=>ZS(eC(t)),eC=t=>dm(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),tC=!0,hm="gzip",fm=async t=>{const e=JSON.stringify(t),r=new TextEncoder().encode(e),o=new Blob([r]),s=new CompressionStream(hm),i=o.stream().pipeThrough(s),a=await new Response(i).arrayBuffer(),l=new Uint8Array(a);return XS(l,tC)},nC=async t=>{try{const e=QS(t),n=new Blob([e]),r=new DecompressionStream(hm),o=n.stream().pipeThrough(r),s=await new Response(o).text();return JSON.parse(s)}catch(e){throw new Error("error decompressing object",{cause:e})}},rC=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>qt(async()=>{const{default:r}=await Promise.resolve().then(()=>Ar);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)};class $l extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class oC extends $l{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class uu extends $l{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class du extends $l{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ra;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Ra||(Ra={}));var sC=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class iC{constructor(e,{headers:n={},customFetch:r,region:o=Ra.Any}={}){this.url=e,this.headers=n,this.region=o,this.fetch=rC(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,n={}){var r;return sC(this,void 0,void 0,function*(){try{const{headers:o,method:s,body:i}=n;let a={},{region:l}=n;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(a["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:u}).catch(y=>{throw new oC(y)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new uu(d);if(!d.ok)throw new du(d);let p=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return p==="application/json"?g=yield d.json():p==="application/octet-stream"?g=yield d.blob():p==="text/event-stream"?g=d:p==="multipart/form-data"?g=yield d.formData():g=yield d.text(),{data:g,error:null,response:d}}catch(o){return{data:null,error:o,response:o instanceof du||o instanceof uu?o.context:void 0}}})}}var Se={},Ln={},Bn={},Fn={},Un={},Hn={},aC=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},br=aC();const lC=br.fetch,pm=br.fetch.bind(br),mm=br.Headers,cC=br.Request,uC=br.Response,Ar=Object.freeze(Object.defineProperty({__proto__:null,Headers:mm,Request:cC,Response:uC,default:pm,fetch:lC},Symbol.toStringTag,{value:"Module"})),dC=Qg(Ar);var Bo={},hu;function gm(){if(hu)return Bo;hu=1,Object.defineProperty(Bo,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return Bo.default=t,Bo}var fu;function ym(){if(fu)return Hn;fu=1;var t=Hn&&Hn.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Hn,"__esModule",{value:!0});const e=t(dC),n=t(gm());class r{constructor(s){this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=s.headers,this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=s.shouldThrowOnError,this.signal=s.signal,this.isMaybeSingle=s.isMaybeSingle,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=Object.assign({},this.headers),this.headers[s]=i,this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,f;let p=null,g=null,y=null,v=c.status,w=c.statusText;if(c.ok){if(this.method!=="HEAD"){const C=await c.text();C===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=C:g=JSON.parse(C))}const x=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),b=(d=c.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");x&&b&&b.length>1&&(y=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(p={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,y=null,v=406,w="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const x=await c.text();try{p=JSON.parse(x),Array.isArray(p)&&c.status===404&&(g=[],p=null,v=200,w="OK")}catch{c.status===404&&x===""?(v=204,w="No Content"):p={message:x}}if(p&&this.isMaybeSingle&&(!((f=p?.details)===null||f===void 0)&&f.includes("0 rows"))&&(p=null,v=200,w="OK"),p&&this.shouldThrowOnError)throw new n.default(p)}return{error:p,data:g,count:y,status:v,statusText:w}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,f;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(d=c?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(f=c?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,i)}returns(){return this}overrideTypes(){return this}}return Hn.default=r,Hn}var pu;function vm(){if(pu)return Un;pu=1;var t=Un&&Un.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Un,"__esModule",{value:!0});const e=t(ym());class n extends e.default{select(o){let s=!1;const i=(o??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(o,{ascending:s=!0,nullsFirst:i,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${o}.${s?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:s,referencedTable:i=s}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${o}`),this}range(o,s,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${o}`),this.url.searchParams.set(c,`${s-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:o=!1,verbose:s=!1,settings:i=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[o?"analyze":null,s?"verbose":null,i?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${f}"; options=${d};`,c==="json"?this:this}rollback(){var o;return((o=this.headers.Prefer)!==null&&o!==void 0?o:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Un.default=n,Un}var mu;function Nl(){if(mu)return Fn;mu=1;var t=Fn&&Fn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Fn,"__esModule",{value:!0});const e=t(vm());class n extends e.default{eq(o,s){return this.url.searchParams.append(o,`eq.${s}`),this}neq(o,s){return this.url.searchParams.append(o,`neq.${s}`),this}gt(o,s){return this.url.searchParams.append(o,`gt.${s}`),this}gte(o,s){return this.url.searchParams.append(o,`gte.${s}`),this}lt(o,s){return this.url.searchParams.append(o,`lt.${s}`),this}lte(o,s){return this.url.searchParams.append(o,`lte.${s}`),this}like(o,s){return this.url.searchParams.append(o,`like.${s}`),this}likeAllOf(o,s){return this.url.searchParams.append(o,`like(all).{${s.join(",")}}`),this}likeAnyOf(o,s){return this.url.searchParams.append(o,`like(any).{${s.join(",")}}`),this}ilike(o,s){return this.url.searchParams.append(o,`ilike.${s}`),this}ilikeAllOf(o,s){return this.url.searchParams.append(o,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(o,s){return this.url.searchParams.append(o,`ilike(any).{${s.join(",")}}`),this}is(o,s){return this.url.searchParams.append(o,`is.${s}`),this}in(o,s){const i=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(o,`in.(${i})`),this}contains(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cs.{${s.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(s)}`),this}containedBy(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cd.{${s.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(s)}`),this}rangeGt(o,s){return this.url.searchParams.append(o,`sr.${s}`),this}rangeGte(o,s){return this.url.searchParams.append(o,`nxl.${s}`),this}rangeLt(o,s){return this.url.searchParams.append(o,`sl.${s}`),this}rangeLte(o,s){return this.url.searchParams.append(o,`nxr.${s}`),this}rangeAdjacent(o,s){return this.url.searchParams.append(o,`adj.${s}`),this}overlaps(o,s){return typeof s=="string"?this.url.searchParams.append(o,`ov.${s}`):this.url.searchParams.append(o,`ov.{${s.join(",")}}`),this}textSearch(o,s,{config:i,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=i===void 0?"":`(${i})`;return this.url.searchParams.append(o,`${l}fts${c}.${s}`),this}match(o){return Object.entries(o).forEach(([s,i])=>{this.url.searchParams.append(s,`eq.${i}`)}),this}not(o,s,i){return this.url.searchParams.append(o,`not.${s}.${i}`),this}or(o,{foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${o})`),this}filter(o,s,i){return this.url.searchParams.append(o,`${s}.${i}`),this}}return Fn.default=n,Fn}var gu;function wm(){if(gu)return Bn;gu=1;var t=Bn&&Bn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Bn,"__esModule",{value:!0});const e=t(Nl());class n{constructor(o,{headers:s={},schema:i,fetch:a}){this.url=o,this.headers=s,this.schema=i,this.fetch=a}select(o,{head:s=!1,count:i}={}){const a=s?"HEAD":"GET";let l=!1;const c=(o??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),i&&(this.headers.Prefer=`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(o,{count:s,defaultToNull:i=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(o)){const c=o.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}upsert(o,{onConflict:s,ignoreDuplicates:i=!1,count:a,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${i?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(o)){const d=o.reduce((f,p)=>f.concat(Object.keys(p)),[]);if(d.length>0){const f=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}update(o,{count:s}={}){const i="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}delete({count:o}={}){const s="DELETE",i=[];return o&&i.push(`count=${o}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Bn.default=n,Bn}var Dr={},Mr={},yu;function hC(){return yu||(yu=1,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.version=void 0,Mr.version="0.0.0-automated"),Mr}var vu;function fC(){if(vu)return Dr;vu=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.DEFAULT_HEADERS=void 0;const t=hC();return Dr.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${t.version}`},Dr}var wu;function pC(){if(wu)return Ln;wu=1;var t=Ln&&Ln.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ln,"__esModule",{value:!0});const e=t(wm()),n=t(Nl()),r=fC();class o{constructor(i,{headers:a={},schema:l,fetch:c}={}){this.url=i,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new o(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:l=!1,get:c=!1,count:u}={}){let d;const f=new URL(`${this.url}/rpc/${i}`);let p;l||c?(d=l?"HEAD":"GET",Object.entries(a).filter(([y,v])=>v!==void 0).map(([y,v])=>[y,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([y,v])=>{f.searchParams.append(y,v)})):(d="POST",p=a);const g=Object.assign({},this.headers);return u&&(g.Prefer=`count=${u}`),new n.default({method:d,url:f,headers:g,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return Ln.default=o,Ln}var bu;function mC(){if(bu)return Se;bu=1;var t=Se&&Se.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Se,"__esModule",{value:!0}),Se.PostgrestError=Se.PostgrestBuilder=Se.PostgrestTransformBuilder=Se.PostgrestFilterBuilder=Se.PostgrestQueryBuilder=Se.PostgrestClient=void 0;const e=t(pC());Se.PostgrestClient=e.default;const n=t(wm());Se.PostgrestQueryBuilder=n.default;const r=t(Nl());Se.PostgrestFilterBuilder=r.default;const o=t(vm());Se.PostgrestTransformBuilder=o.default;const s=t(ym());Se.PostgrestBuilder=s.default;const i=t(gm());return Se.PostgrestError=i.default,Se.default={PostgrestClient:e.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:s.default,PostgrestError:i.default},Se}var gC=mC();const yC=It(gC),{PostgrestClient:vC,PostgrestQueryBuilder:JR,PostgrestFilterBuilder:YR,PostgrestTransformBuilder:ZR,PostgrestBuilder:QR,PostgrestError:eI}=yC;function wC(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const bC=wC(),xC="2.11.15",_C=`realtime-js/${xC}`,SC="1.0.0",bm=1e4,CC=1e3;var Xr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Xr||(Xr={}));var Re;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Re||(Re={}));var nt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(nt||(nt={}));var Ia;(function(t){t.websocket="websocket"})(Ia||(Ia={}));var fn;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(fn||(fn={}));class kC{constructor(){this.HEADER_LENGTH=1}decode(e,n){return e.constructor===ArrayBuffer?n(this._binaryDecode(e)):n(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const n=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,n,r)}_decodeBroadcast(e,n,r){const o=n.getUint8(1),s=n.getUint8(2);let i=this.HEADER_LENGTH+2;const a=r.decode(e.slice(i,i+o));i=i+o;const l=r.decode(e.slice(i,i+s));i=i+s;const c=JSON.parse(r.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class xm{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var fe;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(fe||(fe={}));const xu=(t,e,n={})=>{var r;const o=(r=n.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,i)=>(s[i]=EC(i,t,e,o),s),{})},EC=(t,e,n,r)=>{const o=e.find(a=>a.name===t),s=o?.type,i=n[t];return s&&!r.includes(s)?_m(s,i):Oa(i)},_m=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return RC(e,n)}switch(t){case fe.bool:return PC(e);case fe.float4:case fe.float8:case fe.int2:case fe.int4:case fe.int8:case fe.numeric:case fe.oid:return TC(e);case fe.json:case fe.jsonb:return AC(e);case fe.timestamp:return IC(e);case fe.abstime:case fe.date:case fe.daterange:case fe.int4range:case fe.int8range:case fe.money:case fe.reltime:case fe.text:case fe.time:case fe.timestamptz:case fe.timetz:case fe.tsrange:case fe.tstzrange:return Oa(e);default:return Oa(e)}},Oa=t=>t,PC=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},TC=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},AC=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},RC=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let s;const i=t.slice(1,n);try{s=JSON.parse("["+i+"]")}catch{s=i?i.split(","):[]}return s.map(a=>_m(e,a))}return t},IC=t=>typeof t=="string"?t.replace(" ","T"):t,Sm=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class ki{constructor(e,n,r={},o=bm){this.channel=e,this.event=n,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var _u;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(_u||(_u={}));class Jr{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Jr.syncState(this.state,o,s,i),this.pendingDiffs.forEach(l=>{this.state=Jr.syncDiff(this.state,l,s,i)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=Jr.syncDiff(this.state,o,s,i),a())}),this.onJoin((o,s,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:s,newPresences:i})}),this.onLeave((o,s,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:s,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,o){const s=this.cloneDeep(e),i=this.transformState(n),a={},l={};return this.map(s,(c,u)=>{i[c]||(l[c]=u)}),this.map(i,(c,u)=>{const d=s[c];if(d){const f=u.map(v=>v.presence_ref),p=d.map(v=>v.presence_ref),g=u.filter(v=>p.indexOf(v.presence_ref)<0),y=d.filter(v=>f.indexOf(v.presence_ref)<0);g.length>0&&(a[c]=g),y.length>0&&(l[c]=y)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},r,o)}static syncDiff(e,n,r,o){const{joins:s,leaves:i}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(s,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(p=>p.presence_ref),f=u.filter(p=>d.indexOf(p.presence_ref)<0);e[a].unshift(...f)}r(a,u,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,o(a,c,l),c.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const o=e[r];return"metas"in o?n[r]=o.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):n[r]=o,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Su;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Su||(Su={}));var Cu;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Cu||(Cu={}));var kt;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(kt||(kt={}));class zl{constructor(e,n={config:{}},r){this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Re.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new ki(this,nt.join,this.params,this.timeout),this.rejoinTimer=new xm(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Re.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Re.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Re.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Re.errored,this.rejoinTimer.scheduleTimeout())}),this._on(nt.reply,{},(o,s)=>{this._trigger(this._replyEventName(s),o)}),this.presence=new Jr(this),this.broadcastEndpointURL=Sm(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,n=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Re.closed){const{config:{broadcast:s,presence:i,private:a}}=this.params;this._onError(u=>e?.(kt.CHANNEL_ERROR,u)),this._onClose(()=>e?.(kt.CLOSED));const l={},c={broadcast:s,presence:i,postgres_changes:(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){e?.(kt.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,p=(d=f?.length)!==null&&d!==void 0?d:0,g=[];for(let y=0;y<p;y++){const v=f[y],{filter:{event:w,schema:_,table:x,filter:b}}=v,C=u&&u[y];if(C&&C.event===w&&C.schema===_&&C.table===x&&C.filter===b)g.push(Object.assign(Object.assign({},v),{id:C.id}));else{this.unsubscribe(),this.state=Re.errored,e?.(kt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(kt.SUBSCRIBED);return}}).receive("error",u=>{this.state=Re.errored,e?.(kt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e?.(kt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this._on(e,n,r)}async send(e,n={}){var r,o;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var i,a,l;const c=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Re.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(nt.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(o=>{r=new ki(this,nt.leave,{},e),r.receive("ok",()=>{n(),o("ok")}).receive("timeout",()=>{n(),o("timed out")}).receive("error",()=>{o("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,n,r){const o=new AbortController,s=setTimeout(()=>o.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:o.signal}));return clearTimeout(s),i}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new ki(this,e,n,r);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var o,s;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=nt;if(r&&[a,l,c,u].indexOf(i)>=0&&r!==this._joinRef())return;let f=this._onMessage(i,n,r);if(n&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(p=>{var g,y,v;return((g=p.filter)===null||g===void 0?void 0:g.event)==="*"||((v=(y=p.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(p=>p.callback(f,r)):(s=this.bindings[i])===null||s===void 0||s.filter(p=>{var g,y,v,w,_,x;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in p){const b=p.id,C=(g=p.filter)===null||g===void 0?void 0:g.event;return b&&((y=n.ids)===null||y===void 0?void 0:y.includes(b))&&(C==="*"||C?.toLocaleLowerCase()===((v=n.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const b=(_=(w=p?.filter)===null||w===void 0?void 0:w.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return b==="*"||b===((x=n?.event)===null||x===void 0?void 0:x.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===i}).map(p=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:y,table:v,commit_timestamp:w,type:_,errors:x}=g;f=Object.assign(Object.assign({},{schema:y,table:v,commit_timestamp:w,eventType:_,new:{},old:{},errors:x}),this._getPayloadRecords(g))}p.callback(f,r)})}_isClosed(){return this.state===Re.closed}_isJoined(){return this.state===Re.joined}_isJoining(){return this.state===Re.joining}_isLeaving(){return this.state===Re.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const o=e.toLocaleLowerCase(),s={type:o,filter:n,callback:r};return this.bindings[o]?this.bindings[o].push(s):this.bindings[o]=[s],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(o=>{var s;return!(((s=o.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&zl.isEqual(o.filter,n))}),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(nt.close,{},e)}_onError(e){this._on(nt.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Re.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=xu(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=xu(e.columns,e.old_record)),n}}const ku=()=>{},OC=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class jC{constructor(e,n){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=bm,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ku,this.ref=0,this.logger=ku,this.conn=null,this.sendBuffer=[],this.serializer=new kC,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>qt(async()=>{const{default:l}=await Promise.resolve().then(()=>Ar);return{default:l}},void 0).then(({default:l})=>l(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${Ia.websocket}`,this.httpEndpoint=Sm(e),n?.transport?this.transport=n.transport:this.transport=null,n?.params&&(this.params=n.params),n?.timeout&&(this.timeout=n.timeout),n?.logger&&(this.logger=n.logger),(n?.logLevel||n?.log_level)&&(this.logLevel=n.logLevel||n.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),n?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=n.heartbeatIntervalMs);const o=(r=n?.params)===null||r===void 0?void 0:r.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=n?.reconnectAfterMs?n.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=n?.encode?n.encode:(s,i)=>i(JSON.stringify(s)),this.decode=n?.decode?n.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new xm(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(n?.fetch),n?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=n?.worker||!1,this.workerUrl=n?.workerUrl}this.accessToken=n?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=bC),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:SC}))}disconnect(e,n){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,n??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Xr.connecting:return fn.Connecting;case Xr.open:return fn.Open;case Xr.closing:return fn.Closing;default:return fn.Closed}}isConnected(){return this.connectionState()===fn.Open}channel(e,n={config:{}}){const r=`realtime:${e}`,o=this.getChannels().find(s=>s.topic===r);if(o)return o;{const s=new zl(`realtime:${e}`,n,this);return this.channels.push(s),s}}push(e){const{topic:n,event:r,payload:o,ref:s}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${s})`,o),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let n=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const o={access_token:n,version:_C};n&&r.updateJoinPayload(o),r.joinedOnce&&r._isJoined()&&r._push(nt.access_token,{access_token:n})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(CC,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,n=>{let{topic:r,event:o,payload:s,ref:i}=n;r==="phoenix"&&o==="phx_reply"&&this.heartbeatCallback(n.payload.status=="ok"?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${r} ${o} ${i&&"("+i+")"||""}`,s),Array.from(this.channels).filter(a=>a._isMember(r)).forEach(a=>a._trigger(o,s,i)),this.stateChangeCallbacks.message.forEach(a=>a(n))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(n=>n(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(n=>n(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(nt.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",o=new URLSearchParams(n);return`${e}${r}${o}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([OC],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}}class Dl extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ce(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class $C extends Dl{constructor(e,n){super(e),this.name="StorageApiError",this.status=n}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ja extends Dl{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}var NC=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const Cm=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>qt(async()=>{const{default:r}=await Promise.resolve().then(()=>Ar);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},zC=()=>NC(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield qt(()=>Promise.resolve().then(()=>Ar),void 0)).Response:Response}),$a=t=>{if(Array.isArray(t))return t.map(n=>$a(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const o=n.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[o]=$a(r)}),e};var jn=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const Ei=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),DC=(t,e,n)=>jn(void 0,void 0,void 0,function*(){const r=yield zC();t instanceof r&&!n?.noResolveJson?t.json().then(o=>{e(new $C(Ei(o),t.status||500))}).catch(o=>{e(new ja(Ei(o),o))}):e(new ja(Ei(t),t))}),MC=(t,e,n,r)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),r&&(o.body=JSON.stringify(r)),Object.assign(Object.assign({},o),n))};function yo(t,e,n,r,o,s){return jn(this,void 0,void 0,function*(){return new Promise((i,a)=>{t(n,MC(e,r,o,s)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>DC(l,a,r))})})}function vs(t,e,n,r){return jn(this,void 0,void 0,function*(){return yo(t,"GET",e,n,r)})}function Ft(t,e,n,r,o){return jn(this,void 0,void 0,function*(){return yo(t,"POST",e,r,o,n)})}function LC(t,e,n,r,o){return jn(this,void 0,void 0,function*(){return yo(t,"PUT",e,r,o,n)})}function BC(t,e,n,r){return jn(this,void 0,void 0,function*(){return yo(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function km(t,e,n,r,o){return jn(this,void 0,void 0,function*(){return yo(t,"DELETE",e,r,o,n)})}var Le=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const FC={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Eu={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class UC{constructor(e,n={},r,o){this.url=e,this.headers=n,this.bucketId=r,this.fetch=Cm(o)}uploadOrUpdate(e,n,r,o){return Le(this,void 0,void 0,function*(){try{let s;const i=Object.assign(Object.assign({},Eu),o);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=r,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));const c=this._removeEmptyFolders(n),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:s,headers:a},i?.duplex?{duplex:i.duplex}:{})),f=yield d.json();return d.ok?{data:{path:c,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(s){if(Ce(s))return{data:null,error:s};throw s}})}upload(e,n,r){return Le(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,o){return Le(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),i=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",n);try{let l;const c=Object.assign({upsert:Eu.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),f=yield d.json();return d.ok?{data:{path:s,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(Ce(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,n){return Le(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const o=Object.assign({},this.headers);n?.upsert&&(o["x-upsert"]="true");const s=yield Ft(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),i=new URL(this.url+s.url),a=i.searchParams.get("token");if(!a)throw new Dl("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(r){if(Ce(r))return{data:null,error:r};throw r}})}update(e,n,r){return Le(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return Le(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Ce(o))return{data:null,error:o};throw o}})}copy(e,n,r){return Le(this,void 0,void 0,function*(){try{return{data:{path:(yield Ft(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Ce(o))return{data:null,error:o};throw o}})}createSignedUrl(e,n,r){return Le(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),s=yield Ft(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:n},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${i}`)},{data:s,error:null}}catch(o){if(Ce(o))return{data:null,error:o};throw o}})}createSignedUrls(e,n,r){return Le(this,void 0,void 0,function*(){try{const o=yield Ft(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${s}`):null})),error:null}}catch(o){if(Ce(o))return{data:null,error:o};throw o}})}download(e,n){return Le(this,void 0,void 0,function*(){const o=typeof n?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(n?.transform||{}),i=s?`?${s}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield vs(this.fetch,`${this.url}/${o}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Ce(a))return{data:null,error:a};throw a}})}info(e){return Le(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield vs(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:$a(r),error:null}}catch(r){if(Ce(r))return{data:null,error:r};throw r}})}exists(e){return Le(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield BC(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Ce(r)&&r instanceof ja){const o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),o=[],s=n?.download?`download=${n.download===!0?"":n.download}`:"";s!==""&&o.push(s);const a=typeof n?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(n?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return Le(this,void 0,void 0,function*(){try{return{data:yield km(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(Ce(n))return{data:null,error:n};throw n}})}list(e,n,r){return Le(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},FC),n),{prefix:e||""});return{data:yield Ft(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(Ce(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const HC="2.7.1",WC={"X-Client-Info":`storage-js/${HC}`};var Wn=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class GC{constructor(e,n={},r){this.url=e,this.headers=Object.assign(Object.assign({},WC),n),this.fetch=Cm(r)}listBuckets(){return Wn(this,void 0,void 0,function*(){try{return{data:yield vs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Ce(e))return{data:null,error:e};throw e}})}getBucket(e){return Wn(this,void 0,void 0,function*(){try{return{data:yield vs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(Ce(n))return{data:null,error:n};throw n}})}createBucket(e,n={public:!1}){return Wn(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Ce(r))return{data:null,error:r};throw r}})}updateBucket(e,n){return Wn(this,void 0,void 0,function*(){try{return{data:yield LC(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Ce(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Wn(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(Ce(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Wn(this,void 0,void 0,function*(){try{return{data:yield km(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(Ce(n))return{data:null,error:n};throw n}})}}class qC extends GC{constructor(e,n={},r){super(e,n,r)}from(e){return new UC(this.url,this.headers,e,this.fetch)}}const VC="2.51.0";let Ur="";typeof Deno<"u"?Ur="deno":typeof document<"u"?Ur="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ur="react-native":Ur="node";const KC={"X-Client-Info":`supabase-js-${Ur}/${VC}`},XC={headers:KC},JC={schema:"public"},YC={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ZC={};var QC=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const ek=t=>{let e;return t?e=t:typeof fetch>"u"?e=pm:e=fetch,(...n)=>e(...n)},tk=()=>typeof Headers>"u"?mm:Headers,nk=(t,e,n)=>{const r=ek(n),o=tk();return(s,i)=>QC(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:t;let c=new o(i?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(s,Object.assign(Object.assign({},i),{headers:c}))})};var rk=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};function ok(t){return t.endsWith("/")?t:t+"/"}function sk(t,e){var n,r;const{db:o,auth:s,realtime:i,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,f={db:Object.assign(Object.assign({},l),o),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(n=d?.headers)!==null&&n!==void 0?n:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>rk(this,void 0,void 0,function*(){return""})};return t.accessToken?f.accessToken=t.accessToken:delete f.accessToken,f}const Em="2.71.0",Qn=30*1e3,Na=3,Pi=Na*Qn,ik="http://localhost:9999",ak="supabase.auth.token",lk={"X-Client-Info":`gotrue-js/${Em}`},za="X-Supabase-Api-Version",Pm={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},ck=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,uk=10*60*1e3;class Ml extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Q(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class dk extends Ml{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function hk(t){return Q(t)&&t.name==="AuthApiError"}class Tm extends Ml{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class rn extends Ml{constructor(e,n,r,o){super(e,r,o),this.name=n,this.status=r}}class Bt extends rn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function fk(t){return Q(t)&&t.name==="AuthSessionMissingError"}class Fo extends rn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Uo extends rn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ho extends rn{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function pk(t){return Q(t)&&t.name==="AuthImplicitGrantRedirectError"}class Pu extends rn{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Da extends rn{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Ti(t){return Q(t)&&t.name==="AuthRetryableFetchError"}class Tu extends rn{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Ma extends rn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ws="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Au=` 	
\r=`.split(""),mk=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Au.length;e+=1)t[Au[e].charCodeAt(0)]=-2;for(let e=0;e<ws.length;e+=1)t[ws[e].charCodeAt(0)]=e;return t})();function Ru(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(ws[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(ws[r]),e.queuedBits-=6}}function Am(t,e,n){const r=mk[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Iu(t){const e=[],n=i=>{e.push(String.fromCodePoint(i))},r={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},s=i=>{vk(i,r,n)};for(let i=0;i<t.length;i+=1)Am(t.charCodeAt(i),o,s);return e.join("")}function gk(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function yk(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const o=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|o)+65536,n+=1}gk(r,e)}}function vk(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function wk(t){const e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};for(let o=0;o<t.length;o+=1)Am(t.charCodeAt(o),n,r);return new Uint8Array(e)}function bk(t){const e=[];return yk(t,n=>e.push(n)),new Uint8Array(e)}function xk(t){const e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};return t.forEach(o=>Ru(o,n,r)),Ru(null,n,r),e.join("")}function _k(t){return Math.round(Date.now()/1e3)+t}function Sk(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const et=()=>typeof window<"u"&&typeof document<"u",an={tested:!1,writable:!1},Rm=()=>{if(!et())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(an.tested)return an.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),an.tested=!0,an.writable=!0}catch{an.tested=!0,an.writable=!1}return an.writable};function Ck(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((o,s)=>{e[s]=o})}catch{}return n.searchParams.forEach((r,o)=>{e[o]=r}),e}const Im=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>qt(async()=>{const{default:r}=await Promise.resolve().then(()=>Ar);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},kk=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",er=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},ln=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},zt=async(t,e)=>{await t.removeItem(e)};class Fs{constructor(){this.promise=new Fs.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Fs.promiseConstructor=Promise;function Ai(t){const e=t.split(".");if(e.length!==3)throw new Ma("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!ck.test(e[r]))throw new Ma("JWT not in base64url format");return{header:JSON.parse(Iu(e[0])),payload:JSON.parse(Iu(e[1])),signature:wk(e[2]),raw:{header:e[0],payload:e[1]}}}async function Ek(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Pk(t,e){return new Promise((r,o)=>{(async()=>{for(let s=0;s<1/0;s++)try{const i=await t(s);if(!e(s,null,i)){r(i);return}}catch(i){if(!e(s,i)){o(i);return}}})()})}function Tk(t){return("0"+t.toString(16)).substr(-2)}function Ak(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let o="";for(let s=0;s<56;s++)o+=n.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(e),Array.from(e,Tk).join("")}async function Rk(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),o=new Uint8Array(r);return Array.from(o).map(s=>String.fromCharCode(s)).join("")}async function Ik(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await Rk(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Gn(t,e,n=!1){const r=Ak();let o=r;n&&(o+="/PASSWORD_RECOVERY"),await er(t,`${e}-code-verifier`,o);const s=await Ik(r);return[s,r===s?"plain":"s256"]}const Ok=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function jk(t){const e=t.headers.get(za);if(!e||!e.match(Ok))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function $k(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function Nk(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const zk=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function qn(t){if(!zk.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ri(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}var Dk=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n};const un=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Mk=[502,503,504];async function Ou(t){var e;if(!kk(t))throw new Da(un(t),0);if(Mk.includes(t.status))throw new Da(un(t),t.status);let n;try{n=await t.json()}catch(s){throw new Tm(un(s),s)}let r;const o=jk(t);if(o&&o.getTime()>=Pm["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new Tu(un(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Bt}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((s,i)=>s&&typeof i=="string",!0))throw new Tu(un(n),t.status,n.weak_password.reasons);throw new dk(un(n),t.status||500,r)}const Lk=(t,e,n,r)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),n))};async function se(t,e,n,r){var o;const s=Object.assign({},r?.headers);s[za]||(s[za]=Pm["2024-01-01"].name),r?.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const i=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(i.redirect_to=r.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await Bk(t,e,n+a,{headers:s,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function Bk(t,e,n,r,o,s){const i=Lk(e,r,o,s);let a;try{a=await t(n,Object.assign({},i))}catch(l){throw console.error(l),new Da(un(l),0)}if(a.ok||await Ou(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await Ou(l)}}function Ct(t){var e;let n=null;Wk(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=_k(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function ju(t){const e=Ct(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Ut(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function Fk(t){return{data:t,error:null}}function Uk(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s}=t,i=Dk(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function Hk(t){return t}function Wk(t){return t.access_token&&t.refresh_token&&t.expires_in}const Ii=["global","local","others"];var Gk=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n};class qk{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=Im(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,n=Ii[0]){if(Ii.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ii.join(", ")}`);try{return await se(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await se(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Ut})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=Gk(e,["options"]),o=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await se(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:Uk,redirectTo:n?.redirectTo})}catch(n){if(Q(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await se(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ut})}catch(n){if(Q(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,o,s,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await se(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(s=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""},xform:Hk});if(u.error)throw u.error;const d=await u.json(),f=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,p=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(g=>{const y=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);c[`${v}Page`]=y}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(Q(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){qn(e);try{return await se(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ut})}catch(n){if(Q(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){qn(e);try{return await se(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Ut})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){qn(e);try{return await se(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Ut})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){qn(e.userId);try{const{data:n,error:r}=await se(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:n,error:r}}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _deleteFactor(e){qn(e.userId),qn(e.id);try{return{data:await se(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}}function $u(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}function Vk(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Vn={debug:!!(globalThis&&Rm()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Om extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Kk extends Om{}async function Xk(t,e,n){Vn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Vn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){Vn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await n()}finally{Vn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(e===0)throw Vn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Kk(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Vn.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}Vk();const Jk={url:ik,storageKey:ak,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:lk,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Nu(t,e,n){return await n()}const Kn={};class so{constructor(e){var n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=so.nextInstanceID,so.nextInstanceID+=1,this.instanceID>0&&et()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},Jk),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new qk({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Im(o.fetch),this.lock=o.lock||Nu,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:et()&&(!((n=globalThis?.navigator)===null||n===void 0)&&n.locks)?this.lock=Xk:this.lock=Nu,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:Rm()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=$u(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=$u(this.memoryStorage)),et()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,n;return(n=(e=Kn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){Kn[this.storageKey]=Object.assign(Object.assign({},Kn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=Kn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Kn[this.storageKey]=Object.assign(Object.assign({},Kn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Em}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const n=Ck(window.location.href);let r="none";if(this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce"),et()&&this.detectSessionInUrl&&r!=="none"){const{data:o,error:s}=await this._getSessionFromURL(n,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),pk(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:i,redirectType:a}=o;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Q(n)?{error:n}:{error:new Tm("Unexpected error during initialization",n)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,o;try{const s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e?.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:Ct}),{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Q(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var n,r,o;try{let s;if("email"in e){const{email:u,password:d,options:f}=e;let p=null,g=null;this.flowType==="pkce"&&([p,g]=await Gn(this.storage,this.storageKey)),s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:u,password:d,data:(n=f?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:g},xform:Ct})}else if("phone"in e){const{phone:u,password:d,options:f}=e;s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(r=f?.data)!==null&&r!==void 0?r:{},channel:(o=f?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Ct})}else throw new Uo("You must provide either an email or phone number and a password");const{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Q(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let n;if("email"in e){const{email:s,password:i,options:a}=e;n=await se(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:ju})}else if("phone"in e){const{phone:s,password:i,options:a}=e;n=await se(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:ju})}else throw new Uo("You must provide either an email or phone number and a password");const{data:r,error:o}=n;return o?{data:{user:null,session:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Fo}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOAuth(e){var n,r,o,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;if(n==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}async signInWithSolana(e){var n,r,o,s,i,a,l,c,u,d,f,p;let g,y;if("message"in e)g=e.message,y=e.signature;else{const{chain:v,wallet:w,statement:_,options:x}=e;let b;if(et())if(typeof w=="object")b=w;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))b=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!x?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=w}const C=new URL((n=x?.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in b&&b.signIn){const k=await b.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},x?.signInWithSolana),{version:"1",domain:C.host,uri:C.href}),_?{statement:_}:null));let S;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")S=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)S=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)g=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),y=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in b)||typeof b.signMessage!="function"||!("publicKey"in b)||typeof b!="object"||!b.publicKey||!("toBase58"in b.publicKey)||typeof b.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${C.host} wants you to sign in with your Solana account:`,b.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${C.href}`,`Issued At: ${(o=(r=x?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=x?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${x.signInWithSolana.notBefore}`]:[],...!((i=x?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${x.signInWithSolana.expirationTime}`]:[],...!((a=x?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${x.signInWithSolana.chainId}`]:[],...!((l=x?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${x.signInWithSolana.nonce}`]:[],...!((c=x?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${x.signInWithSolana.requestId}`]:[],...!((d=(u=x?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...x.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const k=await b.signMessage(new TextEncoder().encode(g),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=k}}try{const{data:v,error:w}=await se(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:xk(y)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Ct});if(w)throw w;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new Fo}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:w})}catch(v){if(Q(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const n=await ln(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(n??"").split("/");try{const{data:s,error:i}=await se(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Ct});if(await zt(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Fo}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:i})}catch(s){if(Q(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:n,provider:r,token:o,access_token:s,nonce:i}=e,a=await se(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:Ct}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Fo}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOtp(e){var n,r,o,s,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Gn(this.storage,this.storageKey));const{error:d}=await se(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await se(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(o=l?.data)!==null&&o!==void 0?o:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(i=l?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new Uo("You must provide either an email or phone number.")}catch(a){if(Q(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var n,r;try{let o,s;"options"in e&&(o=(n=e.options)===null||n===void 0?void 0:n.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:i,error:a}=await se(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:Ct});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(Q(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var n,r,o;try{let s=null,i=null;return this.flowType==="pkce"&&([s,i]=await Gn(this.storage,this.storageKey)),await se(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:i}),headers:this.headers,xform:Fk})}catch(s){if(Q(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Bt;const{error:o}=await se(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(Q(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:o,options:s}=e,{error:i}=await se(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:r,type:o,options:s}=e,{data:i,error:a}=await se(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:a}}throw new Uo("You must provide either an email or phone number and a type")}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await ln(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Pi:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const i=await ln(this.userStorage,this.storageKey+"-user");i?.user?e.user=i.user:e.user=Ri()}if(this.storage.isServer&&e.user){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await se(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ut}):await this._useSession(async n=>{var r,o,s;const{data:i,error:a}=n;if(a)throw a;return!(!((r=i.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Bt}:await se(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:Ut})})}catch(n){if(Q(n))return fk(n)&&(await this._removeSession(),await zt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:n};throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:o,error:s}=r;if(s)throw s;if(!o.session)throw new Bt;const i=o.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Gn(this.storage,this.storageKey));const{data:c,error:u}=await se(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Ut});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Bt;const n=Date.now()/1e3;let r=n,o=!0,s=null;const{payload:i}=Ai(e.access_token);if(i.exp&&(r=i.exp,o=r<=n),o){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(n){if(Q(n))return{data:{session:null,user:null},error:n};throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:i,error:a}=n;if(a)throw a;e=(r=i.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Bt;const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async _getSessionFromURL(e,n){try{if(!et())throw new Ho("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ho(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Pu("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ho("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Pu("No code detected.");const{data:_,error:x}=await this._exchangeCodeForSession(e.code);if(x)throw x;const b=new URL(window.location.href);return b.searchParams.delete("code"),window.history.replaceState(window.history.state,"",b.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:o,access_token:s,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!i||!c)throw new Ho("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let f=u+d;l&&(f=parseInt(l));const p=f-u;p*1e3<=Qn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const g=f-d;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,u);const{data:y,error:v}=await this._getUser(s);if(v)throw v;const w={provider_token:r,provider_refresh_token:o,access_token:s,expires_in:d,expires_at:f,refresh_token:i,token_type:c,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(r){if(Q(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await ln(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:o,error:s}=n;if(s)return{error:s};const i=(r=o.session)===null||r===void 0?void 0:r.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(hk(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await zt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const n=Sk(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,o;try{const{data:{session:s},error:i}=n;if(i)throw i;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,n={}){let r=null,o=null;this.flowType==="pkce"&&([r,o]=await Gn(this.storage,this.storageKey,!0));try{return await se(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:o,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(s){if(Q(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}async linkIdentity(e){var n;try{const{data:r,error:o}=await this._useSession(async s=>{var i,a,l,c,u;const{data:d,error:f}=s;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await se(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(o)throw o;return et()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(Q(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,o;const{data:s,error:i}=n;if(i)throw i;return await se(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await Pk(async o=>(o>0&&await Ek(200*Math.pow(2,o-1)),this._debug(n,"refreshing attempt",o),await se(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ct})),(o,s)=>{const i=200*Math.pow(2,o);return s&&Ti(s)&&Date.now()+i-r<Qn})}catch(r){if(this._debug(n,"error",r),Q(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),et()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const o=await ln(this.storage,this.storageKey);if(o&&this.userStorage){let i=await ln(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:o.user},await er(this.userStorage,this.storageKey+"-user",i)),o.user=(e=i?.user)!==null&&e!==void 0?e:Ri()}else if(o&&!o.user&&!o.user){const i=await ln(this.storage,this.storageKey+"-user");i&&i?.user?(o.user=i.user,await zt(this.storage,this.storageKey+"-user"),await er(this.storage,this.storageKey,o)):o.user=Ri()}if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}const s=((n=o.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Pi;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${Pi}s`),s){if(this.autoRefreshToken&&o.refresh_token){const{error:i}=await this._callRefreshToken(o.refresh_token);i&&(console.error(i),Ti(i)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:a}=await this._getUser(o.access_token);!a&&i?.user?(o.user=i.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(r,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Bt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Fs;const{data:s,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new Bt;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(o,"error",s),Q(s)){const i={session:null,error:s};return Ti(s)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(i),i}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,n,r=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const s=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){s.push(l)}});if(await Promise.all(i),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await er(this.userStorage,this.storageKey+"-user",{user:n.user});const o=Object.assign({},n);delete o.user;const s=structuredClone(o);await er(this.storage,this.storageKey,s)}else{const o=structuredClone(n);await er(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await zt(this.storage,this.storageKey),await zt(this.storage,this.storageKey+"-code-verifier"),await zt(this.storage,this.storageKey+"-user"),this.userStorage&&await zt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&et()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Qn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((r.expires_at*1e3-e)/Qn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Qn}ms, refresh threshold is ${Na} ticks`),o<=Na&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Om)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!et()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const o=[`provider=${encodeURIComponent(n)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[s,i]=await Gn(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(i)}`});o.push(a.toString())}if(r?.queryParams){const s=new URLSearchParams(r.queryParams);o.push(s.toString())}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;return s?{data:null,error:s}:await se(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,o;const{data:s,error:i}=n;if(i)return{data:null,error:i};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await se(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((o=l?.totp)===null||o===void 0)&&o.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;if(s)return{data:null,error:s};const{data:i,error:a}=await se(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(n){if(Q(n))return{data:null,error:n};throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;return s?{data:null,error:s}:await se(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Q(n))return{data:null,error:n};throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){const{data:{user:e},error:n}=await this.getUser();if(n)return{data:null,error:n};const r=e?.factors||[],o=r.filter(i=>i.factor_type==="totp"&&i.status==="verified"),s=r.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:r,totp:o,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var n,r;const{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Ai(o.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((r=(n=o.user.factors)===null||n===void 0?void 0:n.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;const o=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+uk>o)return r;const{data:s,error:i}=await se(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=o,r=s.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:g}=await this.getSession();if(g||!p.session)return{data:null,error:g};r=p.session.access_token}const{header:o,payload:s,signature:i,raw:{header:a,payload:l}}=Ai(r);n?.allowExpired||$k(s.exp);const c=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,n?.keys?{keys:n.keys}:n?.jwks);if(!c){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:s,header:o,signature:i},error:null}}const u=Nk(o.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,i,bk(`${a}.${l}`)))throw new Ma("Invalid JWT signature");return{data:{claims:s,header:o,signature:i},error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}}so.nextInstanceID=0;const Yk=so;class Zk extends Yk{constructor(e){super(e)}}var Qk=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class eE{constructor(e,n,r){var o,s,i;if(this.supabaseUrl=e,this.supabaseKey=n,!e)throw new Error("supabaseUrl is required.");if(!n)throw new Error("supabaseKey is required.");const a=ok(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:JC,realtime:ZC,auth:Object.assign(Object.assign({},YC),{storageKey:c}),global:XC},d=sk(r??{},u);this.storageKey=(o=d.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(f,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=nk(n,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new vC(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new iC(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new qC(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,n;return Qk(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,storageKey:s,flowType:i,lock:a,debug:l},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Zk({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:s,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,flowType:i,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new jC(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r?.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const tE=(t,e,n)=>new eE(t,e,n),En=tE("https://pkswdnpftrundnewgnya.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrc3dkbnBmdHJ1bmRuZXdnbnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODI2MzIsImV4cCI6MjA2ODI1ODYzMn0.r_Y1RLOGJ55C0De5SBTVXqO09SMDqgV38sQuE-oDxXE"),nE=async(t,e)=>{const n=await En.rpc("save_campaign_version",{p_name:t,p_data:await fm(e)});if(n.error)throw new Error(`error saving to db ${n.error.message} ${n.error.details}`,{cause:n.error});return n.data},rE=async t=>{const e=await En.rpc("get_latest_campaign",{p_name:t.name,p_created_by:t.createdBy,p_version:t.version});if(e.error)throw e.error;return await nC(e.data.data)},jm=()=>{const[t,e]=m.useState(null);return m.useEffect(()=>{En.auth.getUser().then(({data:{user:r}})=>{e(r)});const{data:{subscription:n}}=En.auth.onAuthStateChange((r,o)=>{e(o?.user??null)});return()=>n.unsubscribe()},[]),t},$m=()=>{const[t,e]=m.useState(0);return{justDone:t,doneNow(){e(n=>n+1),setTimeout(()=>e(n=>n-1),oE)}}},oE=2e3,sE=`
## Save

put your campaign on cassette tape, or even floppy disk!

to be shared or worked on later

(really, saves to a cloud database)

hotkey: **Cmd-S**
`,iE=`
## Load

continue working from your last save
`,Nm=()=>he(({levelEditor:{savedCampaign:t,campaignInProgress:e}})=>Ge(t,e)),aE=()=>{const t=jm(),e=Nm(),{doneNow:n,justDone:r}=$m(),o=async()=>{const i=U.getState(),a=sh(i);console.info("saving...",a);const l=await nE("sequel",a);console.info(`...saved as v${l}`),U.dispatch(Uy({campaign:a})),n()},s=async()=>{try{const i=await rE({name:"sequel"});console.info("loaded",i),U.dispatch(Hy({campaign:i}))}catch(i){console.error(i)}};return h.jsxs(h.Fragment,{children:[r>0?h.jsx(ye,{disabled:!0,className:"!bg-moss !text-white",children:h.jsx(L,{className:"relative leading-none",children:"OK!"})}):h.jsx(ye,{disabled:t===null||e,onClick:o,shortcutKeys:["^S","S"],tooltipContent:sE,children:h.jsxs("div",{className:"flex flex-row items-center",children:[h.jsx("span",{className:Te("sprite sprite-tinted text-highlightBeige texture-hud_char_ relative",{"text-lightGrey":t===null})}),h.jsx("span",{className:Te("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})})]})}),h.jsx(ye,{disabled:t===null,onClick:s,tooltipContent:iE,children:h.jsxs("div",{className:"flex flex-row items-center",children:[h.jsx("span",{className:Te("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})}),h.jsx("span",{className:Te("sprite sprite-tinted text-highlightBeige texture-hud_char_ relative",{"text-lightGrey":t===null})})]})})]})},lE=()=>h.jsx(ye,{children:h.jsx(L,{className:"relative leading-none",children:"MAP"})}),cE=()=>{const[t,e]=m.useState(!1),[n,r]=m.useState(!1);return h.jsx(jl,{main:h.jsx(ye,{onClick:async()=>{const o=U.getState(),s=sh(o),i=await fm(s),a=new URL("https://blockstack.ing"),l=a.searchParams;l.set("campaignData",i),l.set("noSaves","1"),l.set("cheats","1"),n&&l.set("playAsHeels","1"),t||(a.hash=o.levelEditor.currentlyEditingRoomId),window.open(a.toString(),"playtest")},shortcutKeys:["P","^P"],children:h.jsx(Aa,{topText:"pl",bottomText:"ay",icon:h.jsx("span",{className:"sprite texture-joystick mt-half"})})}),children:[h.jsx(kn,{className:"w-full",value:t,label:"from",falseLabel:"room",trueLabel:"start",onChange:o=>e(o)},"fromStart"),h.jsx(kn,{className:"w-full",value:n,label:"as",falseLabel:"head",trueLabel:"heels",onChange:o=>r(o)},"playAsHeels")]})},uE=t=>{switch(t){case"github":return Jd;case"discord":return Yd;default:throw new Error}},dE=({className:t})=>{const e=jm(),n=o=>async()=>{const s=new URL(window.location.href);s.hash="";const i=s.toString(),{error:a}=await En.auth.signInWithOAuth({provider:o,options:{redirectTo:i}});a&&console.error("Login error:",a)},r=async()=>{const{error:o}=await En.auth.signOut();o&&console.error("Logout error:",o)};return h.jsx("div",{className:Te(t),children:e?h.jsxs("div",{className:"bg-moss overflow-hidden text-center",children:[h.jsx(L,{noSlitWords:!0,className:"overflow-hidden",children:`${uE(e.app_metadata.provider)}${e.email}`}),h.jsx(Gt,{className:"px-1 w-full",onClick:r,children:h.jsx(L,{children:"Logout"})})]}):h.jsxs("div",{className:"px-1 bg-midRed",children:[h.jsx(L,{className:"block w-full sprites-double-height pb-1",children:"Not logged in"}),h.jsx(L,{className:"block w-full text-highlightBeige",children:"You will not be able to save"}),h.jsxs("div",{className:"pt-1 flex flex-col gap-half",children:[h.jsx(L,{children:"Log in with:"}),h.jsxs(Gt,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:n("github"),children:[h.jsx(L,{children:Jd}),h.jsx(L,{children:"GitHub"})]}),h.jsxs(Gt,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:n("discord"),children:[h.jsx(L,{children:Yd}),h.jsx(L,{children:"Discord"})]})]})]})})},hE=`
## Add room

Add a **new room** to this campaign

Nothing will link to the room so add *doors* and *teleporters* to get into it
`,fE=`
## Delete room

Delete this room
`,pE=()=>{const t=He(),e=he(n=>Object.keys(n.levelEditor.campaignInProgress.rooms).length>1);return h.jsxs(h.Fragment,{children:[h.jsx(ye,{className:"bg-moss",onClick:()=>t(Wy()),tooltipContent:hE,children:h.jsx("span",{className:"sprite texture-hud_char_+ relative"})}),h.jsx(ye,{className:"bg-midRed",onClick:()=>t(Gy()),disabled:!e,tooltipContent:fE,children:h.jsx("span",{className:"sprite texture-hud_char_X relative"})})]})},Oe={x:12,y:12,z:V.h},mE={x:14,y:14,z:V.h},pn={x:16,y:16,z:V.h},Oi={...Oe,z:V.h*2},zm=t=>{switch(t.type){case"spring":case"portableBlock":case"moveableDeadly":case"slidingDeadly":case"firedDoughnut":return{aabb:Oe};case"slidingBlock":return t.config.style==="book"?{aabb:pn}:{aabb:Oe};case"lift":return{aabb:{...Oe,z:Oe.z}};case"switch":return{aabb:{...Oe,z:Oe.z}};case"pickup":return t.config.gives==="scroll"?{aabb:{x:16,y:4,z:13}}:{aabb:Oe};case"charles":return{aabb:Oi};case"ball":return{aabb:{x:12,y:12,z:12}};case"pushableBlock":case"movingPlatform":return{aabb:pn};case"block":switch(t.config.style){case"artificial":case"organic":case"book":return{aabb:pn};case"tower":return{aabb:{x:11,y:11,z:V.h}};default:throw new Error("unknown block style")}case"monster":switch(t.config.which){case"skiHead":return{aabb:{...Oe,z:21}};case"bubbleRobot":case"cyberman":case"elephant":case"emperorsGuardian":case"monkey":case"computerBot":return{aabb:Oi};case"helicopterBug":case"dalek":case"emperor":case"homingBot":case"elephantHead":return{aabb:Oe};case"turtle":return{aabb:Oe};default:throw t.config,new Error("unknown monster type")}case"deadlyBlock":case"spikes":return{aabb:pn};case"bubbles":return{aabb:Oe};case"conveyor":case"hushPuppy":case"teleporter":return{aabb:pn};case"barrier":return{aabb:t.config.axis==="y"?{x:3,y:15,z:V.h}:{x:15,y:3,z:V.h}};case"sceneryPlayer":return t.config.which==="headOverHeels"?{aabb:Oi}:{aabb:Oe};case"emitter":return{aabb:de};default:return{aabb:mE}}},rt={aabb:Oe},gE=({config:{direction:t},position:e})=>t==="right"&&e.x===0||t==="towards"&&e.y===0,yE=({x:t=0,y:e=0})=>e-t,Y=({x:t=0,y:e=0,z:n=0})=>({x:e-t,y:-(t+e)/2-n}),vE=(t,e,n)=>{const r=Y(t),o=vn(n,r);return B(Dm(e,o),t)},Dm=(t,{x:e,y:n})=>{switch(Zd(t)){case"xy":return{x:-e/2-n,y:e/2-n,z:0};case"xz":return{x:-e,y:0,z:e/2-n};case"yz":return{x:0,y:e,z:-e/2-n};default:throw new Error("only axis-aligned planes are supported for unprojection")}},ke=({x:t=0,y:e=0,z:n=0})=>({x:t*V.w,y:e*V.d,z:n*V.h}),rs=({x:t=0,y:e=0,z:n=0})=>({x:t/V.w,y:e/V.d,z:n/V.h}),Pn=t=>Y(ke(t)),La=t=>{const e=ke(t.position),{aabb:n}=zm(t);if(n===void 0)throw new Error(`item type= ${t.type} config=${JSON.stringify(t.config)} has no bounding box`);return t.type==="wall"?e:B(e,{x:V.w-n.x>>1,y:V.d-n.y>>1})},Pe=Number.MIN_SAFE_INTEGER,zu=ey/1e3,Mm={firedDoughnut:2*zu,floatingText:zu},Lm=10,Du=6e4,wE=8,bE=750,xE=2500,Mu=200,_E=.15,SE=ar.h-ar.w/2,Bm=SE+2,Us=9999,Be=()=>({expires:null,stoodOnBy:{},disappearing:null,switchedAtRoomTime:Pe,stoodOnUntilRoomTime:Pe}),Lu=()=>({standingOnItemId:null,vels:{gravity:de,movingFloor:de},latentMovement:[],actedOnAt:{roomTime:Pe,by:ue},collidedWith:{roomTime:Pe,by:ue}}),CE=t=>{const e=qy.includes(t.type);return{...Be(),position:La(t),...e?{standingOnItemId:null,vels:{gravity:de,movingFloor:de,...Vy.includes(t.type)?{sliding:de}:{},...t.type==="monster"||t.type==="movingPlatform"?{walking:de}:{}},latentMovement:[],actedOnAt:{roomTime:Pe,by:ue},collidedWith:{roomTime:Pe,by:ue}}:{},...t.type==="monster"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",timeOfLastDirectionChange:Number.NEGATIVE_INFINITY,...t.config.which==="skiHead"||t.config.which==="turtle"||t.config.which==="elephantHead"||t.config.which==="cyberman"?{facing:Ee[t.config.startDirection]}:{facing:Ee.towards}}:{},...t.type==="pickup"?{disappearing:{on:"touch",byType:t.config.gives==="bag"||t.config.gives==="jumps"?["heels","headOverHeels"]:t.config.gives==="doughnuts"||t.config.gives==="hooter"||t.config.gives==="fast"?["head","headOverHeels"]:["head","heels","headOverHeels"]}}:{},...t.type==="movingPlatform"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",facing:Ee[t.config.startDirection]}:{},...t.type==="switch"?{setting:t.config.initialSetting,touchedOnProgression:-1}:{},...t.type==="block"?{disappearing:t.config.disappearing??null}:{},...t.type==="conveyor"?{disappearing:t.config.disappearing??null}:{},...t.type==="barrier"?{disappearing:t.config.disappearing??null}:{},...t.type==="lift"?{direction:"up",vels:{lift:de}}:{},...t.type==="charles"?{facing:Ee.towards}:{},...t.type==="emitter"?{lastEmittedAtRoomTime:Pe,quantityEmitted:0}:{},...t.type==="firedDoughnut"?{disappearing:{on:"touch"},vels:{fired:t.config.direction?Cs(Ee[t.config.direction],Mm.firedDoughnut):de}}:{}}},ji=V.h*2,kE=4,Hr=V.h*kE,EE=2,PE=2*V.w,TE=.4,Bu=2;function*AE(t,e){const{config:{direction:n},position:r}=t,o=co(n),s=kr(o),i=gE(t),a={...de,[s]:i?-.5:0},l=1,c={[s]:i?-1:0},u=l*V.w,d={...de,[s]:u},f=9,p=8,g=8;{const y={[o]:p,[s]:g,z:Hr};yield{...t,...rt,type:"doorFrame",id:`${e}/frameFar`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"far"},state:{...Be(),position:ke(B(r,{[o]:1.5},a,c)),stoodOnBy:ue},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}{const y={[o]:f,[s]:g,z:Hr};yield{...t,...rt,type:"doorFrame",id:`${e}/frameNear`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"near"},state:{...Be(),position:ke(B(r,a,c)),stoodOnBy:ue},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}{const y={[o]:2*V.w-f-p,[s]:g,z:Hr-ji};yield{...t,...rt,type:"doorFrame",id:`${e}/frameTop`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"top"},state:{...Be(),position:B(ke(B(r,a,c)),{[o]:f,z:ji}),stoodOnBy:ue},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}yield{...t,...rt,type:"blocker",id:`${e}/blockerAbove`,jsonItemId:e,config:{},renders:!1,state:{...Be(),position:B(ke(B(r,a,c)),{z:Hr}),stoodOnBy:ue},aabb:B(ke({[o]:2,[s]:l,z:Us}),{[s]:g}),renderAabb:de,fixedZIndex:gn},yield{...t,...rt,type:"portal",id:`${e}/portal`,jsonItemId:e,config:{...Ky(t.config,"toRoom","toDoor"),inHidden:i,relativePoint:ke({...de,[s]:i?l+.25:-.25}),direction:Ee[n]},fixedZIndex:gn,state:{...Be(),position:B(ke(B(r,{[s]:i?-.5-l:.5})),{[o]:f}),stoodOnBy:ue},aabb:{[o]:EE*V.w-f-p,[s]:u,z:ji}},r.z!==0&&(yield{...t,...rt,type:"doorLegs",id:`${e}/legs`,jsonItemId:e,config:{...t.config,inHiddenWall:i,style:"none",side:"away",height:r.z},renders:!0,shadowCastTexture:i?{textureId:"shadow.door.floatingThreshold.double.y",flipX:o==="x"}:void 0,state:{...Be(),position:{...ke(B(r,a,c)),z:0}},aabb:B(ke({[o]:2,[s]:.5,z:r.z}),d),renderAabb:i?B(ke({[o]:2,[s]:.5,z:.5})):void 0,renderAabbOffset:i?B({[o]:0,[s]:0,z:(r.z-.5)*V.h},{[s]:d[s]}):void 0,shadowOffset:{z:r.z*V.h,[s]:i?d[s]:void 0}}),yield{type:"stopAutowalk",id:`${e}/stopAutowalk`,jsonItemId:e,aabb:ke({[o]:2,[s]:Bu,z:2}),config:{},fixedZIndex:gn,state:{...Be(),position:ke(fr(r,Cs(Ee[n],TE),i?de:{[s]:Bu})),stoodOnBy:ue}}}const Fu={config:ue,shadowCastTexture:"shadow.smallRound",aabb:Oe},Uu=()=>{const t=ny(U.getState());return{action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:Ee.towards,walkStartFacing:Ee.towards,walkDistance:0,vels:{walking:de,gravity:de,movingFloor:de},switchedToAt:Pe,lastDiedAt:Pe,gameTime:0,jumpStartTime:Pe,lives:t?"infinite":wE,jumpStartZ:0}},RE=(t,e)=>{const n=ty(U.getState());return t.config.which==="head"?{id:e,jsonItemId:e,type:"head",...rt,...Fu,state:{...Be(),...Lu(),...Uu(),hasHooter:!1,gameWalkDistance:0,fastStepsStartedAtDistance:Pe,shieldCollectedAt:Pe,doughnuts:n?"infinite":0,position:La(t),stoodOnUntilRoomTime:Pe}}:{id:e,jsonItemId:e,type:"heels",...rt,...Fu,state:{...Be(),...Lu(),...Uu(),carrying:null,hasBag:!1,bigJumps:0,isBigJump:!1,shieldCollectedAt:Pe,position:La(t),stoodOnUntilRoomTime:Pe}}},io=(t,e={})=>{const n=Xy(e),r=fr(su,t);return fr(ry(n,su),r)},Fm=1,IE={x:V.w,y:V.d*Fm,z:Us},OE={x:V.w,y:0,z:Bm},jE={x:V.w*Fm,y:V.d,z:Us},$E={x:0,y:V.d,z:Bm},NE=(t,e)=>{const{config:{direction:n},position:r}=e,o=nl(e.config),s=co(n),i=kr(s),a=Jy(n),l={...de,[i]:a?-1:0};return{type:"wall",id:t,jsonItemId:t,config:e.config,aabb:io(s==="y"?jE:IE,o),renderAabb:a?de:io(s==="y"?$E:OE,o),fixedZIndex:a?gn:void 0,state:{...Be(),position:ke(B(r,l)),stoodOnBy:ue},shadowCastTexture:s==="y"?"shadow.wall.y":{textureId:"shadow.wall.y",flipX:!0}}},zE=3,Hu=10,Wu=.52,Gu=.5,DE=(t,e,n)=>{const{config:{times:r},position:o}=e,s=B(o,{z:-3}),i={...r,z:zE};let a=s,l=i;const c=vt(ls(n.items)).filter(f=>f.type==="door");if(o.z===0){const f={};for(const p of c){const{position:g,config:{direction:y}}=p;switch(y){case"towards":!f.towards&&g.y===s.y&&(l=B(l,{y:Gu}),a=B(a,{y:-.5}),f.towards=!0);break;case"away":!f.away&&g.y===s.y+r.y&&(l=B(l,{y:Wu}),f.away=!0);break;case"right":!f.right&&g.x===s.x&&(l=B(l,{x:Gu}),a=B(a,{x:-.5}),f.right=!0);break;case"left":!f.left&&g.x===s.x+r.x&&(l=B(l,{x:Wu}),f.left=!0);break}}}const u=ke(a),d=io(pn,l);return{type:"floor",id:t,jsonItemId:t,config:{...e.config,naturalFootprint:{aabb:io(pn,i),position:ke(s)}},aabb:d,renderAabb:{...d,z:Hu},renderAabbOffset:{...de,z:d.z-Hu},shadowCastTexture:"shadow.fullBlock",state:{...Be(),position:u}}};function*Ll(t,e,n,r=ue,o={}){if(!r[t]&&!(e.type==="pickup"&&e.config.gives==="scroll"&&o[e.config.page]))switch(e.type){case"door":return yield*AE(e,t);case"player":{yield RE(e,t);return}case"wall":{yield NE(t,e);return}case"floor":{yield DE(t,e,n);return}case"sceneryCrown":if(!U.getState().gameMenus.planetsLiberated[e.config.planet])return;default:{const s=zm(e),i=e.config.times!==void 0?{aabb:io(s.aabb,e.config.times),renderAabb:void 0}:s;let a;try{a=CE(e)}catch(l){throw new Error(`loadItemFromJson: error creating initial state for jsonItem ${JSON.stringify(e,null,2)}`,{cause:l})}yield{...e,...rt,...i,id:t,jsonItemId:t,fixedZIndex:e.type==="emitter"?gn:void 0,shadowCastTexture:ME(e),config:e.config,state:a}}}}const ME=t=>{switch(t.type){case"lift":return"shadow.smallBlock";case"conveyor":return{textureId:"shadow.fullBlock",flipX:Kt(t.config.direction)==="x"};case"barrier":return{textureId:"shadow.barrier.y",flipX:t.config.axis==="x"};case"spring":case"firedDoughnut":case"slidingDeadly":return"shadow.smallRound";case"block":return t.config.style==="tower"?"shadow.smallRound":"shadow.fullBlock";case"pushableBlock":case"movingPlatform":case"hushPuppy":case"deadlyBlock":case"teleporter":case"spikes":return"shadow.fullBlock";case"portableBlock":return t.config.style==="drum"?"shadow.smallRound":"shadow.smallBlock";case"pickup":return t.config.gives==="scroll"?"shadow.scroll":"shadow.smallRound";case"ball":case"charles":case"monster":return"shadow.smallRound";case"slidingBlock":return t.config.style==="book"?"shadow.fullBlock":"shadow.smallRound"}},Hs=({aabb:t,state:{position:e}},{aabb:n,state:{position:r}})=>!(e.x+t.x<=r.x||e.x>=r.x+n.x)&&!(e.y+t.y<=r.y||e.y>=r.y+n.y)&&!(e.z+t.z<=r.z||e.z>=r.z+n.z),LE=(t,e)=>[...vt(e).filter(n=>t.id!==n.id&&Hs(t,n))];function*Ba(t,e){for(const n of e)t.id!==n.id&&Hs(t,n)&&(yield n)}function*BE(t,e){if(t.roomBelow!==void 0)for(const n of Ie(e).filter(ra)){const{config:{naturalFootprint:r}}=n;yield{...rt,type:"portal",id:"floor/portal",fixedZIndex:gn,config:{toRoom:t.roomBelow,relativePoint:{x:r.aabb.x/2,y:r.aabb.y/2,z:r.aabb.z},direction:Ee.down},aabb:r.aabb,state:{...Be(),position:r.position},renders:!1}}if(t.roomAbove!==void 0)for(const n of Ie(e).filter(ra)){const{config:{naturalFootprint:r}}=n;yield{...rt,type:"portal",id:"ceilingPortal",fixedZIndex:gn,config:{toRoom:t.roomAbove,relativePoint:{...t.ceilingRelativePoint!==void 0?ke(t.ceilingRelativePoint):{x:r.aabb.x/2,y:r.aabb.y/2},z:-12},direction:Ee.up},aabb:{...r.aabb,z:V.h},state:{...Be(),position:B(r.position,{z:r.aabb.z},{z:V.h*(t.height??Lm)})}}}}const FE=(t,e,n,r)=>{const o=Math.max(0,Math.min(t.x+e.x,n.x+r.x)-Math.max(t.x,n.x)),s=Math.max(0,Math.min(t.y+e.y,n.y+r.y)-Math.max(t.y,n.y));return o*s},qu=({state:{position:t},aabb:e},{state:{position:n},aabb:r})=>FE(t,e,n,r),Vu={stopAutowalk:5,portal:5,wall:5,blocker:5,doorLegs:5,sceneryPlayer:5,bubbles:5,switch:10,doorFrame:15,ball:18,block:20,barrier:20,floor:20,hushPuppy:20,teleporter:20,lift:30,movingPlatform:30,pushableBlock:30,portableBlock:30,sceneryCrown:30,slidingBlock:30,spring:30,joystick:40,charles:40,conveyor:40,head:50,heels:50,headOverHeels:50,pickup:80,firedDoughnut:90,spikes:98,slidingDeadly:100,moveableDeadly:100,deadlyBlock:100,monster:100,floatingText:200,particle:200,emitter:200},UE=(t,e)=>Vu[t.type]-Vu[e.type],HE=(t,e,n=.001)=>{if(!mr(e,t)||t.id===e.id)return!1;const{state:{vels:{gravity:{z:r}}}}=t;return r>0?!1:Hs({state:{position:B(t.state.position,{x:0,y:0,z:-1e-4})},aabb:{...t.aabb,z:n+Qd},id:t.id},{state:{position:B(e.state.position,{x:0,y:0,z:e.aabb.z})},aabb:{...e.aabb,z:0},id:e.id})},WE=(t,e)=>{const r=[...vt(e).filter(s=>HE(t,s))];return r.length===0?void 0:r.reduce((s,i)=>{const a=UE(i,s);return a<0||a===0&&qu(t,i)>qu(t,s)?i:s})},GE=({above:t,below:e})=>{const n=e.state.stoodOnBy;if(!Object.isExtensible(n))throw new Error(`${t.id} can't stand on ${e.id} - its standingOn is not extensible`);t.state.standingOnItemId=e.id,n[t.id]=!0};function*qE(t,e,n,r){const o=sy(t.items);for(const[s,i]of o)i.type==="player"&&!r||(yield*Ll(s,i,t,e,n))}const Ku=t=>vt(t).reduce((e,n)=>({...e,[n.id]:n}),{}),$i=({roomJson:t,roomPickupsCollected:e,scrollsRead:n,isNewGame:r=!1})=>{const o=Ku(qE(t,e,n,r)),s={...Ku(BE(t,o)),...o};for(const a of Ie(s)){const c=LE(a,oy(s)).find(u=>mr(a)&&mr(u)&&!(a.type==="wall"&&u.type==="wall"));c!==void 0&&console.error(`in room ${t.id} item ${a.id} @${JSON.stringify(a.state.position)} #${JSON.stringify(a.aabb)} is colliding with (solid item) ${c.id} @${JSON.stringify(c.state.position)} #${JSON.stringify(c.aabb)} on loading room ${t.id}`)}for(const a of Ie(s).filter(Yy)){const l=WE(a,Ie(s).filter(c=>c.id!==a.id));l!==void 0&&GE({above:a,below:l})}return{...t,roomJson:t,items:s,roomTime:0}},VE=t=>()=>Rn(t),tI=VE(pr),KE=vh([pr,t=>t.levelEditor.previewedEdits],(t,e)=>eh(t,n=>{const r=th(e);for(const[o,s]of r)s===null?delete n.items[o]:n.items[o]=s})),Bl=m.createContext(null),XE=()=>{const[t,e]=m.useState(()=>$i({roomJson:pr(U.getState()),roomPickupsCollected:ue,scrollsRead:ue,isNewGame:!0})),[n,r]=m.useState(t),o=he(pr),s=he(KE);return m.useEffect(()=>{const i=$i({roomJson:o,roomPickupsCollected:ue,scrollsRead:ue,isNewGame:!0});if(e(i),o===s)r(i);else{const a=$i({roomJson:s,roomPickupsCollected:ue,scrollsRead:ue,isNewGame:!0});r(a)}},[o,s]),{roomState:t,roomStateWithPreviews:n}},JE=({children:t})=>{const e=XE();return h.jsx(Bl,{value:e,children:t})},Um=()=>{const t=m.useContext(Bl);if(t===null)throw new Error("no room state in context, or no context");return t.roomState},Hm=()=>{const t=m.useContext(Bl);if(t===null)throw new Error("no room state in context, or no context");return t.roomStateWithPreviews},YE=t=>Ie(t.items).filter(e=>mr(e)),Wm=(t,e)=>{const n=vt(YE(t));return e==="door"?n.filter(o=>o.type!=="wall"):n},Gm=({roomState:t,jsonItemIds:e,blockPositionDelta:n,timesDelta:r})=>{const o=yc(pc(a=>[a,t.roomJson.items[a]]),pc(([a,l])=>[a,eh(l,c=>{c.position=B(c.position,n),Zy(c,r)})]),Iv(function*([a,l]){for(const c of Ll(a,l,t.roomJson))yield[a,l,c]}),Qy(([,,a])=>mr(a))),s=Array.from(o(e));return yc(Hv(([,a,l])=>{const c=vt(Wm(t,a.type)).filter(u=>u.jsonItemId&&!e.includes(u.jsonItemId));for(const u of Ba(l,c))return console.warn(l.id,"colliding with static item",u.id),!0;for(const u of Ba(l,s.map(([d,f,p])=>p)))return console.warn(l.id,"colliding with other mutating item",u.id),!0;return!1}))(s)},ZE=({roomState:t,blockPosition:e,itemTool:n})=>{const r=Ll("maybeAddedItem",{...n,position:e},t.roomJson),o=Array.from(Wm(t,n.type));return r.some(s=>{const i=Ba(s,o);return!bh(i)})},QE=()=>{const t=He(),e=he(o=>o.levelEditor.selectedJsonItemIds.length>0),n=Um(),r=o=>{if(n===null)return;const s=U.getState().levelEditor,{halfGridResolution:i,selectedJsonItemIds:a}=s,l=i?cs(o,{x:.5,y:.5,z:1}):o;if(Gm({roomState:n,jsonItemIds:a,blockPositionDelta:l})){console.warn("nudge would collide");return}t(ih({jsonItemIds:a,positionDelta:l})),t(ah())};return h.jsxs("div",{className:"flex flex-row flex-wrap gap-x-0 gap-y-oneScaledPix items-center",children:[h.jsx(L,{className:"inline-block mr-1 text-lightGrey leading-none",noSlitWords:!0,children:"move"}),h.jsxs("div",{className:"flex flex-row flex-wrap gap-oneScaledPix items-center",children:[h.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.left)},shortcutKeys:["ArrowLeft"],children:h.jsx(L,{className:"relative leading-none",children:""})}),h.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.right)},shortcutKeys:["ArrowRight"],children:h.jsx(L,{className:"relative leading-none",children:""})}),h.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.away)},shortcutKeys:["ArrowUp"],children:h.jsx(L,{className:"relative leading-none",children:""})}),h.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.towards)},shortcutKeys:["ArrowDown"],children:h.jsx(L,{className:"relative leading-none",children:""})}),h.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.up)},shortcutKeys:["ArrowUp"],children:h.jsx(L,{className:"relative leading-none",children:""})}),h.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.down)},shortcutKeys:["ArrowDown"],children:h.jsx(L,{className:"relative leading-none",children:""})})]})]})},eP=`
## Back

Go back to the previous room

hotkey: **<**
`,tP=`
## Forward

The opposite of back

hotkey: **>**
`,nP=()=>{const t=he(({levelEditor:r})=>{const{editingRoomIdHistory:o}=r;return o.back.length>0}),e=he(({levelEditor:r})=>{const{editingRoomIdHistory:o}=r;return o.forward.length>0}),n=He();return h.jsxs(h.Fragment,{children:[h.jsx(ye,{disabled:!t,onClick:()=>{n(ev())},shortcutKeys:["<"],tooltipContent:eP,children:h.jsx("span",{className:"sprite texture-hud_char_lt relative"})}),h.jsx(ye,{disabled:!e,onClick:()=>{n(tv())},shortcutKeys:[">"],tooltipContent:tP,children:h.jsx("span",{className:"sprite texture-hud_char_gt relative"})})]})},rP=({className:t})=>{const e=He();return h.jsx(kn,{className:t,label:"coalesce",value:he(n=>n.levelEditor.autoCoalesce),onChange:n=>{e(nv(n))},shortcutKeys:["L"],tooltipContent:`optimise blocks into single items while editing, or keep separate?
hotkey: **L**`})},oP=`
## Share

copies a link to the clipboard

anyone with the link can play your game
`,sP=()=>{const t=Nm(),{doneNow:e,justDone:n}=$m();return n>0?h.jsx(ye,{className:"bg-moss",children:h.jsx(L,{className:"relative leading-none",children:"OK!"})}):h.jsx(ye,{disabled:!t,onClick:async()=>{const r=new URL("https://blockstack.ing"),o=r.searchParams,{data:{session:s}}=await En.auth.getSession(),i=s?.user.id;if(i===void 0)throw new Error("no user id on supabase session");o.set("campaignName","sequel"),o.set("campaignAuthor",i),o.set("noSaves","1"),navigator.clipboard.writeText(r.toString()).then(e)},tooltipContent:oP,children:h.jsx("span",{className:"sprite sprite-tinted texture-hud_char_ relative"})})},Wo=()=>h.jsx("div",{className:"w-[calc(var(--block)-1px)]"}),iP=()=>{const t=he(r=>r.levelEditor.campaignInProgress),e=he(r=>r.levelEditor.currentlyEditingRoomId),n=He();return h.jsxs("div",{className:"scale-editor flex w-full h-full text-white bg-metallicBlueHalfbrite pb-1 gap-1 flex-wrap justify-start overflow-auto",children:[h.jsx("div",{className:Ae,children:h.jsx(dE,{className:"w-full mb-1"})}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full",children:"Campaign"}),h.jsx(aE,{}),h.jsx(sP,{}),h.jsx(Wo,{}),h.jsx(lE,{}),h.jsx(cE,{})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full pt-1",children:"Room"}),h.jsx(nP,{}),h.jsx(Wo,{}),h.jsx(pE,{}),h.jsx(Wo,{}),h.jsx(BS,{}),h.jsx(om,{value:e,campaign:t,onSelect:r=>{n(oa(r))},triggerButtonClassName:"w-full",tooltipContent:"Choose the room to view/edit"}),h.jsx("div",{className:"h-1 w-full"}),h.jsx(OS,{}),h.jsx(IS,{}),h.jsx("div",{className:"h-half w-full"}),h.jsx(FS,{}),h.jsx(US,{})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full pt-1",children:"Edit"}),h.jsxs("div",{className:Ae,children:[h.jsx(RS,{}),h.jsx(HS,{})]}),h.jsx(zS,{}),h.jsx(Wo,{}),h.jsx(TS,{}),h.jsx(QE,{}),h.jsx("div",{className:"h-1 w-full"}),h.jsxs("div",{className:"flex flex-row justify-between flex-wrap gap-x-2",children:[h.jsx(AS,{}),h.jsx(DS,{}),h.jsx(rP,{})]})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full pt-1",children:"Blocks"}),h.jsx(j,{itemTool:{type:"block",config:{style:"organic"}},shortcutKeys:["B"],tooltipContent:`## Block 
The basic block            
hotkey: **B**`,children:h.jsx("span",{className:`sprite texture-block_organic ${W}`})}),h.jsx(j,{itemTool:{type:"block",config:{style:"organic",disappearing:{on:"stand"}}},children:h.jsx(Mo,{iconClassName:ge("texture-block_organic_disappearing")})}),h.jsx(j,{itemTool:{type:"block",config:{style:"artificial"}},children:h.jsx("span",{className:`sprite texture-block_artificial ${W}`})}),h.jsx(j,{itemTool:{type:"block",config:{style:"artificial",disappearing:{on:"stand"}}},children:h.jsx(Mo,{iconClassName:ge("texture-block_artificial_disappearing")})}),h.jsx(j,{itemTool:{type:"block",config:{style:"tower"}},children:h.jsx("span",{className:`sprite texture-tower ${W}`})}),h.jsx(j,{itemTool:{type:"block",config:{style:"book"}},children:h.jsx("span",{className:`sprite texture-book_x ${W}`})}),h.jsxs(zr,{children:[h.jsx(j,{itemTool:{type:"barrier",config:{axis:"x"}},children:h.jsx("span",{className:`sprite texture-barrier_x ${W}`})}),h.jsx(j,{itemTool:{type:"barrier",config:{axis:"y"}},children:h.jsx("span",{className:`sprite texture-barrier_y ${W}`})}),h.jsx(j,{itemTool:{type:"barrier",config:{axis:"x",disappearing:{on:"touch"}}},children:h.jsx(Mo,{iconClassName:ge("texture-barrier_x")})}),h.jsx(j,{itemTool:{type:"barrier",config:{axis:"y",disappearing:{on:"touch"}}},children:h.jsx(Mo,{iconClassName:ge("texture-barrier_y")})})]})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full",children:"Monsters"}),h.jsx(j,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},tooltipContent:`## mojo
the emperors worker bots

patrols randomly in a diagonal pattern`,children:h.jsx("span",{className:`sprite texture-dalek_1 [button:hover_&]:texture-animated-dalek" ${W}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},tooltipContent:`## guard
hovers towards the player on the shortest axis

heels can outrun, but not head

place on a toaster to make a charging guard`,children:h.jsx(St,{topClasses:"texture-cyberman_towards [button:hover_&]:texture-cyberman_right",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},tooltipContent:`## monster
moves *back and forth* by default

or can be set to *patrol clockwise*`,children:h.jsx("span",{className:`sprite texture-skiHead_greenAndPink_towards [button:hover_&]:texture-skiHead_greenAndPink_right ${W}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:h.jsx("span",{className:`sprite texture-helicopterBug_1 [button:hover_&]:texture-animated-helicopterBug ${W}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},tooltipContent:`## turtle
plods along in a clockwise pattern`,children:h.jsx("span",{className:`sprite texture-turtle_towards_1 [button:hover_&]:texture-animated-turtle_right ${W}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},tooltipContent:`## homing bot
detects a player in a straight line on an axis and rushes towards them`,children:h.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase_all ${W}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},tooltipContent:`## Computer bot
usually patrols randomly, but can be programmed to move towards the player`,children:h.jsx(St,{topClasses:"texture-computerBot_towards [button:hover_&]:texture-computerBot_right"})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"bubbleRobot",activated:"on",movement:"patrol-randomly-xy8"}},tooltipContent:`## Bubble bot
patrols randomly in 8 directions

fast and dangerous`,children:h.jsx(St,{topClasses:ge("texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"),bottomClasses:ge("texture-headlessBase")})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:h.jsx(St,{topClasses:"texture-monkey_towards [button:hover_&]:texture-monkey_right"})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},children:h.jsx(St,{topClasses:"texture-elephant_towards [button:hover_&]:texture-elephant_right"})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},tooltipContent:`## Elephant head
Things have gone weird

Stationary, but deadly`,children:h.jsx("span",{className:`sprite texture-elephant_towards [button:hover_&]:texture-elephant_right ${W}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",tooltipContent:`## Emperor's Guardian

very dangerous

moves towards the player, unless they have all four planet crowns

does not *like doughnuts*
`,children:h.jsx(St,{topClasses:"texture-ball",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},tooltipContent:`## Emperor
The end boss, usually found guarding his Blacktooth crown`,children:h.jsx("span",{className:`sprite texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold ${W}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full",children:"Pickups"}),h.jsxs(zr,{children:[h.jsx(j,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:h.jsx(_t,{iconClasses:"texture-whiteRabbit",text:"2"})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"shield"}},children:h.jsx(_t,{iconClasses:"texture-whiteRabbit",text:""})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"jumps"}},children:h.jsx(_t,{iconClasses:"texture-whiteRabbit",text:""})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"fast"}},children:h.jsx(_t,{iconClasses:"texture-whiteRabbit",text:""})})]}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"bag"}},children:h.jsx("span",{className:`sprite texture-bag ${W}`})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"hooter"}},tooltipContent:`## hooter

head's doughnut firing hooter`,children:h.jsx("span",{className:`sprite texture-hooter ${W}`})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:h.jsx("span",{className:`sprite texture-doughnuts ${W}`})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"reincarnation"}},children:h.jsx("span",{className:`sprite texture-fish_1 [button:hover_&]:texture-animated-fish ${W}`})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:h.jsx("span",{className:`sprite texture-crown_blacktooth ${W}`})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"scroll",page:"blacktooth"}},children:h.jsx("span",{className:`sprite texture-scroll ${W}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full",children:"deadly"}),h.jsxs(zr,{children:[h.jsx(j,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},children:h.jsx("span",{className:`sprite texture-volcano_1 [button:hover_&]:texture-animated-volcano ${W}`})}),h.jsx(j,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},children:h.jsx("span",{className:`sprite texture-toaster_off ${W}`})})]}),h.jsx(j,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},tooltipContent:`## Spiky ball
rolls fast if pushed

deadly to touch`,children:h.jsx("span",{className:`sprite texture-spikyBall_1 [button:hover_&]:texture-spikyBall_2 ${W}`})}),h.jsx(j,{itemTool:{type:"spikes",config:ue},tooltipContent:`## spikes

deadly to touch on top

safe to run into the sides`,children:h.jsx("span",{className:`sprite texture-spikes ${W}`})}),h.jsx(j,{itemTool:{type:"moveableDeadly",config:{style:"deadFish"}},tooltipContent:`## dead fish

(deadly to touch)

dead fish decompose very quickly and it rapidly
turns so poisonous that a single lick can kill`,children:h.jsx("span",{className:`sprite texture-fish_1 ${W}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full",children:"control"}),h.jsx(j,{itemTool:{type:"charles",config:ue},children:h.jsx(St,{topClasses:"texture-charles_towards [button:hover_&]:texture-charles_right"})}),h.jsx(j,{itemTool:{type:"joystick",config:{controls:["charles"]}},tooltipContent:`## Joystick
Controls one or more Charles bots

Change *which* Charles in the json`,children:h.jsx("span",{className:`sprite texture-joystick ${W}`})}),h.jsx(j,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:us}},tooltipContent:`## Switch
toggles when touched.

edit the json to choose:

* de/activate monsters
* turn on/off moving platforms
* make blocks disappear on touch`,children:h.jsx("span",{className:`sprite texture-switch_left [button:hover_&]:texture-switch_right ${W}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full",children:"movable"}),h.jsx(j,{itemTool:{type:"spring",config:{}},children:h.jsx("span",{className:`sprite texture-spring_released [button:hover_&]:texture-spring_compressed ${W}`})}),h.jsxs(zr,{children:[h.jsx(j,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:h.jsx("span",{className:`sprite texture-cube ${W}`})}),h.jsx(j,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:h.jsx("span",{className:`sprite texture-drum ${W}`})}),h.jsx(j,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:h.jsx("span",{className:`sprite texture-sticks ${W}`})})]}),h.jsx(j,{itemTool:{type:"pushableBlock",config:{}},children:h.jsx("span",{className:`sprite texture-stepStool ${W}`})}),h.jsx(j,{itemTool:{type:"ball",config:ue},children:h.jsx("span",{className:`sprite texture-ball ${W}`})}),h.jsx(j,{itemTool:{type:"slidingBlock",config:{style:"puck"}},tooltipContent:`## Sliding puck

Small item that can be stood on and slides when touched`,children:h.jsx("span",{className:`sprite texture-puck ${W}`})}),h.jsx(j,{itemTool:{type:"slidingBlock",config:{style:"book"}},tooltipContent:`## Sliding book

Why are the books slippery?`,children:h.jsx("span",{className:`sprite texture-book_y ${W}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full",children:"misc."}),h.jsxs(j,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[h.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_static ${W} [button:active_&]:top-oneScaledPix`}),h.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_1 [button:hover_&]:texture-animated-lift ${W} [button:active_&]:top-oneScaledPix`})]}),h.jsxs(zr,{children:[h.jsx(j,{itemTool:{type:"conveyor",config:{direction:"away"}},children:h.jsx(_t,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-conveyor_y",text:""})}),h.jsx(j,{itemTool:{type:"conveyor",config:{direction:"towards"}},children:h.jsx(_t,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-reversed-conveyor_y",text:""})}),h.jsx(j,{itemTool:{type:"conveyor",config:{direction:"left"}},children:h.jsx(_t,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-conveyor_x",text:""})}),h.jsx(j,{itemTool:{type:"conveyor",config:{direction:"right"}},children:h.jsx(_t,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-reversed-conveyor_x",text:""})})]}),h.jsx(j,{itemTool:{type:"teleporter",config:{toRoom:"to?",toPosition:de}},children:h.jsx("span",{className:`sprite texture-teleporter ${W}`})}),h.jsx(j,{itemTool:{type:"movingPlatform",config:{movement:"clockwise",activated:"on",startDirection:"towards"}},tooltipContent:`## Moving Platform
Clockwise or back-and-forth

Can be (de)activated by a switch, or touch 

Why a sandwich?`,children:h.jsx("span",{className:`sprite texture-sandwich ${W}`})}),h.jsx(j,{itemTool:{type:"hushPuppy",config:{}},children:h.jsx("span",{className:`sprite texture-hushPuppy ${W}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full",children:"Structure"}),h.jsx(MS,{}),h.jsx(LS,{}),h.jsx(j,{itemTool:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:{x:1,y:1}}},children:h.jsx("span",{className:`sprite texture-blacktooth_floor ${W}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full",children:"Player"}),h.jsx(j,{itemTool:{type:"player",config:{which:"head"}},tooltipContent:`## Head

Place on of these into one room

This is where head will start the game`,children:h.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${W}`})}),h.jsx(j,{itemTool:{type:"player",config:{which:"heels"}},tooltipContent:`## Heels

Place on of these into one room

This is where head will start the game`,children:h.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${W}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full",children:"NPCs"}),h.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"head",startDirection:"towards"}},tooltipContent:`##NPC head
Citizens of Freedom

stand around not doing much`,children:h.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${W}`})}),h.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"heels",startDirection:"towards"}},tooltipContent:`##NPC heels
Citizens of Freedom

stand around not doing much`,children:h.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${W}`})}),h.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"headOverHeels",startDirection:"towards"}},tooltipContent:`##NPC head over heels
Citizens of Freedom

stand around not doing much`,children:h.jsx(St,{topClasses:"texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right",bottomClasses:"texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right"})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(L,{className:"w-full pt-2",children:"debug"}),h.jsx(CS,{})]})]})},xr=(t,e)=>({get bottomCentre(){return this.c000},get topLeft(){return this.c101},get topRight(){return this.c011},get c000(){return Y(t)},get c001(){return Y(B(t,{z:e.z}))},get c010(){return Y(B(t,{y:e.y}))},get c011(){return Y(B(t,{y:e.y,z:e.z}))},get c100(){return Y(B(t,{x:e.x}))},get c101(){return Y(B(t,{x:e.x,z:e.z}))},get c110(){return Y(B(t,{x:e.x,y:e.y}))},get c111(){return Y(B(t,{x:e.x,y:e.y,z:e.z}))},projectCorner(n){return Y(B(t,{x:n.x*e.x,y:n.y*e.y,z:n.z*e.z}))}}),Ni=1e-5,Xu=-1,Lr=(t,e,n,r,o)=>r-o>t&&n<e-o,aP=0,qm=1,Vm=2,Km=3,lP=(t,e,n,r)=>{const{topLeft:o,topRight:s,bottomCentre:i}=xr(t,e),{topLeft:a,topRight:l,bottomCentre:c}=xr(n,r),u=s.y-s.x/2,d=i.y-i.x/2,f=l.y-l.x/2,p=c.y-c.x/2,g=o.y+o.x/2,y=i.y+i.x/2,v=a.y+a.x/2,w=c.y+c.x/2,_=o.x,x=s.x,b=a.x,C=l.x,k=Lr(u,d,f,p,Ni),S=Lr(g,y,v,w,Ni),$=Lr(_,x,b,C,Ni);return k&&S&&$?qm:S&&$&&Lr(u,d,f,p,Xu)?Vm:k&&$&&Lr(g,y,v,w,Xu)?Km:aP},cP=(t,e,n,r)=>{for(const o of iy){const s=t[o],i=s+e[o],a=n[o],l=a+r[o];if(i<=a)return 1*(o==="z"?-1:1);if(s>=l)return-1*(o==="z"?-1:1)}return Ju(n)-Ju(t)},uP=(t,e)=>{if(t.fixedZIndex!==void 0||e.fixedZIndex!==void 0)return 0;const n=t.renderAabb||t.aabb,r=e.renderAabb||e.aabb,o=t.renderAabbOffset?B(t.state.position,t.renderAabbOffset):t.state.position,s=e.renderAabbOffset?B(e.state.position,e.renderAabbOffset):e.state.position;switch(lP(o,n,s,r)){case qm:return cP(o,n,s,r);case Vm:return jt(o.y,s.y+r.y)&&jt(o.z,s.z+r.z)?1:jt(s.y,o.y+n.y)&&jt(s.z,o.z+n.z)?-1:0;case Km:return jt(o.x,s.x+r.x)&&jt(o.z,s.z+r.z)?1:jt(s.x,o.x+n.x)&&jt(s.z,o.z+n.z)?-1:0;default:return 0}},Ju=t=>t.x+t.y-t.z;class os extends Error{constructor(e,n,r){super(`CyclicDependencyError: .cyclicDependency property of this error has nodes as an array. ${e.join(" -> ")}`,r),this.cyclicDependency=e,this.hasClosedCycle=n}}const dP=t=>{const e=hP(t);let n=e.length,r=n;const o=new Array(n),s={},i=fP(e);for(;r--;)s[r]||a(e[r],r,new Set);return o;function a(l,c,u){if(u.has(l))throw new os([l],!1);if(s[c])return;s[c]=!0;const d=t.get(l)||new Set,f=Array.from(d);if(c=f.length){u.add(l);do{const p=f[--c];try{a(p,i.get(p),u)}catch(g){throw g instanceof os?g.hasClosedCycle?g:new os([l,...g.cyclicDependency],g.cyclicDependency.includes(l)):g}}while(c);u.delete(l)}o[--n]=l}};function hP(t){const e=new Set;for(const[n,r]of t.entries()){e.add(n);for(const o of r)e.add(o)}return Array.from(e)}function fP(t){const e=new Map;for(let n=0,r=t.length;n<r;n++)e.set(t[n],n);return e}const Yu=(t,e,n)=>{t.has(e)||t.set(e,new Set),t.get(e).add(n)},Go=(t,e,n)=>{const r=t.get(e);r!==void 0&&(r?.delete(n),r.size===0&&t.delete(e))},Xm=(t,e=new Set(ls(t)),n=new Map)=>{const r=new Map;for(const[o,s]of n)if(!t[o])n.delete(o);else for(const i of s)t[i]||Go(n,o,i);for(const o of e)if(o.fixedZIndex===void 0)for(const s of ls(t)){if(s.fixedZIndex!==void 0||r.get(s)?.has(o)||o===s)continue;const i=uP(o,s);if(Yu(r,o,s),i===0){Go(n,o.id,s.id),Go(n,s.id,o.id);continue}const a=i>0?o.id:s.id,l=i>0?s.id:o.id;Yu(n,a,l),Go(n,l,a)}return n},Fl=(t,e,n=3)=>{try{return{order:dP(t),impossible:!1}}catch(r){if(r instanceof os){const o=r.cyclicDependency;return t.get(o[0])?.delete(o[1]),console.warn("cyclc dependency detected: ",o.join(" --front-of--> "),`breaking link ${o[0]} --front-of--> ${o[1]}`),{order:Fl(t,e,n-1).order,impossible:!0}}else throw r}};class pP{constructor(e,n){this.renderContext=e,this.appearance=n,this.output=new oe({label:"AppearanceRenderer"})}#e;output;destroy(){this.output.destroy({children:!0})}tick(e){const n=this.appearance({renderContext:this.renderContext,currentRendering:this.#e,tickContext:e});n!=="no-update"&&(this.output.children.at(0)!==n.output&&(this.#e?.output&&this.output.removeChild(this.#e.output),n.output!==void 0&&this.output.addChild(n.output)),this.#e=n)}}class Jm extends pP{}const Zu=(t,e)=>{e.poly([Y({}),Y({x:t.x}),Y({x:t.x,y:t.y}),Y({y:t.y})]).poly([Y({}),Y({z:t.z}),Y({y:t.y,z:t.z}),Y({y:t.y})]).poly([Y({x:t.x}),Y({x:t.x,z:t.z}),Y(t),Y({x:t.x,y:t.y})]).poly([Y({z:t.z}),Y({x:t.x,z:t.z}),Y({x:t.x,y:t.y,z:t.z}),Y({y:t.y,z:t.z})])},Qu=(t,e)=>{const n=new ht;return Zu(t,n),n.stroke({width:.5,color:e,alpha:1}),n.eventMode="static",n.on("pointerenter",()=>{n.fill({color:e,alpha:.5})}),n.on("pointerleave",()=>{n.clear(),Zu(t,n),n.stroke({width:.5,color:e,alpha:1})}),n},mP={head:"rgba(255,184,0)",wall:"rgba(128,200,0)",portal:"rgba(255,0,255)",pickup:"rgba(0,196,255)",emitter:"rgba(0,255,255)",stopAutowalk:"rgba(255,128,128)",floatingText:"rgba(128,0,255)"};class gP{constructor(e){this.renderContext=e;const{item:n}=e,r=mP[n.type]??"rgba(255,255,255)";if(this.#e=new oe({label:`ItemBoundingBoxRenderer ${n.id}`}),uo("portal")(n)){const s=Y(n.config.relativePoint);this.#e.addChild(new ht().circle(s.x,s.y,5).stroke(r)),this.#e.addChild(new ht().circle(s.x,s.y,2).fill(r))}if(this.#e.addChild(new ht({label:"objectOrigin"}).circle(0,0,2).fill(r)),this.#e.addChild(Qu(n.aabb,r)),n.renderAabb){const s="rgba(184, 184, 255)",i=Qu(n.renderAabb,s);if(n.renderAabbOffset){const a=Y(n.renderAabbOffset);i.position.set(a.x,a.y),i.circle(0,0,2).fill(s)}this.#e.addChild(i)}this.#e.eventMode="static";let o;this.#e.on("pointerenter",()=>{if(o!==void 0)return;const s=`${n.id} ${n.type}
@(${n.state.position.x}, ${n.state.position.y}, ${n.state.position.z})}
#(${n.aabb.x}, ${n.aabb.y}, ${n.aabb.z})}`;this.#e.addChild(o=new sw({text:s,style:{fill:r,fontSize:6,fontFamily:"Menlo"}})),o.resolution=4}),this.#e.on("pointerleave",()=>{o!==void 0&&(this.#e.removeChild(o),o=void 0)}),e.frontLayer.attach(this.#e)}#e;tick(){}destroy(){this.#e.destroy({children:!0})}get output(){return this.#e}}class yP{constructor(e,n){this.renderContext=e,this.wrappedRenderer=n,this.#e=new oe({label:`ItemPositionRenderer ${e.item.id}`,children:[n.output]}),this.#t()}#e;#t(){const e=Y(this.renderContext.item.state.position);this.#e.x=e.x,this.#e.y=e.y}tick(e){this.wrappedRenderer?.tick(e),e.movedItems.has(this.renderContext.item)&&this.#t()}destroy(){this.#e.destroy({children:!0}),this.wrappedRenderer?.destroy()}get output(){return this.#e}}const ed={x:.5,y:1},td=t=>typeof t!="string"&&Object.hasOwn(t,"animationId"),Fa=t=>{if(typeof t=="string")return Fa({textureId:t});{const{anchor:e,flipX:n,pivot:r,x:o,y:s,filter:i,times:a,label:l}=t;let c;if(td(t)?c=vP(t):c=new Sr(Vt().textures[t.textureId]),t.hasOwnProperty("times")){const u={x:1,y:1,z:1,...a},d=new oe({label:l??"timesXyz"});for(let{x:f}=u;f>=1;f--)for(let{y:p}=u;p>=1;p--)for(let g=1;g<=u.z;g++){const y={...t,textureId:t.textureId??t.textureIdCallback?.(f-1,p-1,g-1),label:`(${f},${p},${g})`};delete y.times;const v=Fa(y),w=Pn({x:f-1,y:p-1,z:g-1});v.x+=w.x,v.y+=+w.y,d.addChild(v)}return d}if(e===void 0&&r===void 0)if(td(t))c.anchor=ed;else{const u=Vt().data.frames[t.textureId];if(u===void 0)throw new Error(`no spritesheet entry for textureId "${t.textureId}"`);const d=u.frame;d.pivot!==void 0?c.pivot=d.pivot:c.anchor=ed}else e!==void 0&&(c.anchor=e),r!==void 0&&(c.pivot=r);return o!==void 0&&(c.x=o),s!==void 0&&(c.y=s),i!==void 0&&(c.filters=i),l!==void 0&&(c.label=l),c.eventMode="static",n===!0&&(c.scale.x=-1),c}},G=Fa;function vP({animationId:t,reverse:e,playOnce:n,paused:r,randomiseStartFrame:o}){const s=Vt().animations[t],a=(r?[s[0]]:s).map(c=>({texture:c,time:ay}));e&&a.reverse();const l=new eo(a);return l.animationSpeed=An.animations[t].animationSpeed,l.gotoAndPlay(o?Math.floor(Math.random()*a.length):0),n!==void 0&&(l.loop=!1,l.onComplete=()=>{l.stop(),n==="and-destroy"&&(l.visible=!1)}),l}const Ym=(t,e)=>{const n=e.getLocalBounds(),r=sl.create({width:n.maxX-n.minX,height:n.maxY-n.minY});return e.x-=n.minX,e.y-=n.minY,t.render({container:e,target:r}),new Sr({texture:r,label:"shadowMaskSprite (of renderTexture)",pivot:{x:-n.minX,y:-n.minY}})},Ws=(t,e,n)=>{const r=n&&{x:n.x??1,y:n.y??1},o=G({...typeof e=="string"?{textureId:e}:e,times:r});return o instanceof Sr?o:Ym(t,o)},Dt=t=>je(({renderContext:{item:e}})=>lh(e)?G({...typeof t=="string"?{textureId:t}:t,times:rl(e)}):G(t)),Je=t=>je(({renderContext:{item:e,general:{pixiRenderer:n}}})=>{if(lh(e))return Ws(n,t,rl(e));{const r=G(t);return r instanceof Sr?r:Ym(n,r)}}),je=t=>({renderContext:e,currentRendering:n,tickContext:r})=>n===void 0?{output:t({renderContext:e,currentRendering:void 0,tickContext:r}),renderProps:ue}:"no-update",Mt=t=>({renderContext:{general:{pixiRenderer:e},item:n},currentRendering:r})=>{if(r===void 0){const o=rl(n),s={output:Ws(e,t(n.config),o),renderProps:ue};return o&&(s.output.y-=((o.z??1)-1)*V.h),s}else return"no-update"},vo=(t,e)=>vt(ks(t)).map(n=>{const r=e.items[n];if(r===void 0)throw new Error(`item in stoodOnBy "${n}" is not in the room`);return r});uo("head");const wP=uo("heels"),bP=uo("headOverHeels"),xP=t=>{if(wP(t))return t.state;if(bP(t))return t.state.heels},_P=1e3/25,Zm=t=>{const e=An.animations[t],n=e.length,{animationSpeed:r}=e;return n*_P/r};Zm("bubbles.white");Zm("head.fadeOut");const Ul=({config:{activatedOnStoreValue:t}})=>t===void 0?!0:Ja(U.getState(),t),SP=({renderContext:{general:{pixiRenderer:t},item:e,room:n},currentRendering:r})=>{const{state:{stoodOnBy:o},config:{times:s}}=e,i=r?.renderProps,a=Ul(e),l=a&&vo(o,n).find(ol)!==void 0;return i===void 0||a!==i.activated||l!==i.flashing?{output:Ws(t,{textureId:l?"shadowMask.teleporter.flashing":a?"shadowMask.teleporter":"shadowMask.fullBlock"},s),renderProps:{flashing:l,activated:a}}:"no-update"},zi=(t,e=1)=>({renderContext:{item:{state:{facing:n}}},currentRendering:r})=>{const o=r?.renderProps,s=Ya(n)??"towards";if(!(o===void 0||s!==o.facingXy4))return"no-update";const a=G(s==="left"||s==="away"?`shadowMask.${t}.away`:`shadowMask.${t}.right`);return a.y=-(V.h*(e-1)),a.scale.x=s==="away"||s==="right"?1:-1,{output:a,renderProps:{facingXy4:s}}},nd={lift:Je("shadowMask.smallBlock"),conveyor:Mt(({direction:t})=>({textureId:"shadowMask.conveyor",flipX:Kt(t)==="x"})),doorLegs:Mt(({direction:t})=>({textureId:t==="right"||t==="towards"?"shadowMask.door.floatingThreshold.double.y":"shadowMask.door.legs.threshold.double.y",flipX:Kt(t)==="y"})),teleporter:SP,floor:"no-mask",barrier:Mt(({axis:t})=>({textureId:"shadowMask.barrier.y",flipX:t==="x"})),spring:Je("shadowMask.smallRound"),block:Mt(({style:t})=>t==="tower"?"shadowMask.tower":"shadowMask.fullBlock"),pushableBlock:Je("shadowMask.stepStool"),movingPlatform:Je("shadowMask.fullBlock"),hushPuppy:Je("shadowMask.hushPuppy"),portableBlock:Mt(({style:t})=>t==="drum"?"shadowMask.smallRound":"shadowMask.smallBlock"),slidingBlock:Mt(({style:t})=>t==="book"?"shadowMask.fullBlock":"shadowMask.smallRound"),deadlyBlock:Mt(({style:t})=>t==="volcano"?"shadowMask.volcano":"shadowMask.toaster"),spikes:Je("shadowMask.spikes"),switch:Je("shadowMask.switch"),pickup:Mt(({gives:t})=>{switch(t){case"scroll":return"shadowMask.scroll";case"doughnuts":return"shadowMask.doughnuts";case"fast":case"extra-life":case"jumps":case"shield":return"shadowMask.whiteRabbit";default:return"blank"}}),slidingDeadly:Je("shadowMask.smallRound"),ball:Je("shadowMask.ball"),"monster.dalek":Je("shadowMask.dalek"),"monster.turtle":zi("turtle"),"monster.skiHead":zi("skiHead"),"monster.homingBot":Je("shadowMask.smallRound"),joystick:Je("shadowMask.joystick"),charles:zi("charles",2)},CP=t=>{switch(t.type){case"monster":return nd[`monster.${t.config.which}`];case"floor":return t.config.floorType==="none"?void 0:"no-mask";default:return nd[t.type]}},kP=new ew({alpha:1-Kr});class EP{constructor(e,n){if(this.renderContext=e,this.#e.filters=kP,n!=="no-mask")if(this.#n=new Jm(e,n),e.item.shadowOffset===void 0)this.#e.addChild(this.#n.output);else{const r=new oe({label:"shadowMaskOffset",...Y(e.item.shadowOffset),children:[this.#n.output]});this.#e.addChild(r)}this.#e.addChild(this.#t)}#e=new oe({label:"ItemShadowRenderer"});#t=new oe({label:"shadows"});#n;#r={};get#o(){return U.getState().gameMenus.userSettings.displaySettings.showShadowMasks}#s(e){if(this.#n===void 0)return;const n=this.#n.output.children.at(0);this.#n.tick(e);const r=this.#n.output.children.at(0);if(r===void 0||!(r instanceof Sr)){const{item:o}=this.renderContext;throw new Error(`ItemShadowRenderer: this.#shadowMaskRenderer didn't create a sprite for item "${o.id}" of type "${o.type}". Have got ${r}`)}n!==r&&(this.#o?this.renderContext.frontLayer.attach(r):this.#e.mask=r)}destroy(){this.#e.destroy(!0),this.#n?.destroy()}tick(e){if(this.#t.parent===null)throw new Error("shadow container not in scene graph");const{movedItems:n,progression:r}=e,{item:o,general:{pixiRenderer:s},room:i}=this.renderContext,a=n.has(o),l=o.state.position.z+o.aabb.z,c=Ie(i.items).filter(function(g){return g.shadowCastTexture!==void 0}),u={id:o.id,state:{position:{...o.state.position,z:l}},aabb:{...o.aabb,z:Us}},d=Object.groupBy(c,p=>{const g=this.#r[p.id]!==void 0,y=n.has(p);return!a&&!y?g?"keepUnchanged":"noShadow":Hs(u,p)?g?"update":"create":"noShadow"});for(const p of uc(d.keepUnchanged,d.update))this.#r[p.id].renderedOnProgression=r;if(d.create)for(const p of d.create){const{times:g}=p.config,y=Ws(s,p.shadowCastTexture,g);y.label=p.id,this.#t.addChild(y),this.#r[p.id]={sprite:y,renderedOnProgression:r}}for(const p of uc(d.create,d.update)){const{sprite:g}=this.#r[p.id],y=Y({...Vr(vn(p.state.position,o.state.position),p.shadowOffset??lr),z:o.aabb.z});g.x=y.x,g.y=y.y}for(const[p,{sprite:g,renderedOnProgression:y}]of th(this.#r))y!==r&&(g.destroy(),delete this.#r[p]);const f=(d.keepUnchanged?.length??0)+(d.update?.length??0)+(d.create?.length??0)>0;this.#e.visible=f,f&&this.#s(e)}get output(){return this.#e}}const PP=t=>{const e=CP(t.item);return e===void 0?void 0:new EP(t,e)};class TP{constructor(e,n){this.renderContext=e,this.componentRenderers=n,this.output={graphics:n.graphics?.output,sound:n.sound?.output}}output;tick(e){this.componentRenderers.graphics?.tick(e),this.componentRenderers.sound?.tick(e)}destroy(){this.componentRenderers.graphics?.destroy(),this.componentRenderers.sound?.destroy()}}const ce=new window.AudioContext,Ua=()=>{throw new Error(`sounds not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`)},$e=t=>{const e=typeof t=="string"?{soundId:t}:t,{playbackRate:n=1,soundId:r,connectTo:o,loop:s=!1,varyPlaybackRate:i=!1,randomiseStartPoint:a=!1}=e,l=ce.createBufferSource(),c=Ua()[r];return l.buffer=c,l.loop=s,l.playbackRate.value=i?n-.05+Math.random()*.1:n,s&&a?l.start(0,c.duration*Math.random()):l.start(),o!==void 0&&l.connect(o),l},Xn=(t,e,n)=>{const r=ce.createGain();return e!==void 0&&(r.gain.value=e),t.connect(r),r.connect(n),r},Fe=({start:t,change:e,loop:n,stop:r,startAndLoopTogether:o=!1,noStartOnFirstFrame:s=!0},i)=>{let a=!0,l,c;return u=>{if(!!u!=!!c)u?t!==void 0&&!(a&&s)?(l?.stop(),l=$e({...t}),Xn(l,t.gain,i),n!==void 0&&(o?(l=$e({...n,loop:!0}),Xn(l,n.gain,i)):l.onended=()=>{c&&(l=$e({...n,loop:!0}),Xn(l,n.gain,i))})):n!==void 0&&(l=$e({...n,loop:!0}),Xn(l,n.gain,i)):(l&&l.loop&&(l.stop(),l.onended=null),r!==void 0&&(l=$e({...r}),Xn(l,r.gain,i)));else if(c!==u&&e!==void 0){const f=$e({...e});Xn(f,e.gain,i)}a=!1,c=u}};class AP{constructor(e){this.renderContext=e,this.output.gain.value=4}output=ce.createGain();#e=Fe({loop:{soundId:"rollingBallLoop",playbackRate:.5}},this.output);tick(){const{renderContext:{item:{state:{vels:{sliding:e},standingOnItemId:n}}}}=this,r=(e.x!==0||e.y!==0)&&n!==null;this.#e(r)}destroy(){}}class RP{constructor(e){this.renderContext=e;const{item:{config:{was:n}}}=e;switch(n.type){case"pickup":{n.gives!=="scroll"&&$e({soundId:"bonus",connectTo:this.output});break}case"disappearing":{$e({soundId:"destroy",connectTo:this.output});break}case"hushPuppy":{this.output.gain.value=.5,$e({soundId:"hushPuppyVanish",connectTo:this.output});break}}}output=ce.createGain();tick(){}destroy(){}}class Hl{constructor(e,n,r=1){this.renderContext=e,this.#e=Fe({start:n},this.output),this.output.gain.value=r}output=ce.createGain();#e;tick({lastRenderRoomTime:e}){const{renderContext:{item:n}}=this,{state:{collidedWith:{roomTime:r,by:o}}}=n,s=r>(e??Pe)&&!bh(ks(o));this.#e(s)}destroy(){}}class IP{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#e.gain.value=.5,this.#n=new Hl(e,{soundId:"metalHit"},.3),this.#n.output.connect(this.output)}output=ce.createGain();#e=ce.createGain();#t=Fe({start:{soundId:"servoStart",playbackRate:.5},loop:{soundId:"servoLoop",playbackRate:.5},stop:{soundId:"servoStop",playbackRate:.5}},this.#e);#n;tick(e){const{renderContext:{item:n,room:{roomTime:r,items:o}}}=this,{state:{actedOnAt:{roomTime:s,by:i}}}=n,a=r===s&&vt(ks(i)).some(l=>ch(o[l]));this.#t(a),this.#n.tick(e)}destroy(){}}const wo=t=>{for(const e in t)return!0;return!1},Di=2;class OP{constructor(e){this.renderContext=e}output=ce.createGain();#e=Fe({start:{soundId:"conveyorStart",playbackRate:Di},loop:{soundId:"conveyorLoop",playbackRate:Di},stop:{soundId:"conveyorEnd",playbackRate:Di}},this.output);tick(){const{renderContext:{item:{state:{stoodOnBy:e}}}}=this,n=wo(e);this.#e(n)}destroy(){this.#e(!1)}}const jP=3;class $P{constructor(e){this.renderContext=e,this.output.gain.value=.7}output=ce.createGain();#e=$e({soundId:"helicopter",loop:!0,connectTo:this.output});tick(){const{renderContext:{item:{state:{vels:{lift:{z:e}}}}}}=this;this.#e.playbackRate.value=Math.max(.5,1+jP*e)}destroy(){}}const rd={skiHead:{soundId:"softBump"},turtle:{soundId:"softBump"},dalek:{soundId:"metalHit"},homingBot:{soundId:"metalHit"},computerBot:{soundId:"metalHit"}},od={cyberman:{soundId:"jetpackTurnaround",gain:1.2},dalek:{soundId:"mojoTurn",gain:.3}},sd={cyberman:{soundId:"jetpackLoop",gain:.7},emperorsGuardian:{soundId:"jetpackLoop"},dalek:{soundId:"mojoLoop"},bubbleRobot:{soundId:"bubbleRobotLoop"},helicopterBug:{soundId:"helicopter"}},id={homingBot:{start:{soundId:"detect"},loop:{soundId:"robotWhirLoop",gain:4},startAndLoopTogether:!0},computerBot:{loop:{soundId:"robotBeepingLoop",randomiseStartPoint:!0,varyPlaybackRate:!0}}};class NP{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#t.connect(this.output),this.#t.gain.value=.66;const{item:{config:{which:n}}}=e;rd[n]!==void 0&&(this.#o=new Hl(e,rd[n]),this.#o.output.connect(this.output)),od[n]!==void 0&&(this.#n=Fe({change:od[n]},this.#e)),id[n]!==void 0&&(this.#s=Fe(id[n],this.#e)),sd[n]!==void 0&&(this.#r=Fe({loop:sd[n]},this.#t))}output=ce.createGain();#e=ce.createGain();#t=ce.createGain();#n;#r;#o;#s;tick(e){const{renderContext:{item:n}}=this,{state:{facing:r,activated:o,busyLickingDoughnutsOffFace:s,vels:{walking:i}}}=n;if(this.#n){const a=nh(r);this.#n(a)}if(this.#o&&this.#o.tick(e),this.#r){const a=o&&!s;this.#r(a)}if(this.#s){const a=!Za(i,de);this.#s(a)}}destroy(){}}class Mi{constructor(e){this.renderContext=e;const{general:{soundSettings:n},item:{type:r}}=e,{noFootsteps:o}={...Qa.soundSettings,...n};o||(this.#e=ce.createGain(),this.#e.gain.value=2,this.#e.connect(this.output),this.#t=Fe({loop:{soundId:`${r==="headOverHeels"?"heels":r}Walk`}},this.#e)),this.#n.gain.value=.8,this.#n.connect(this.output),this.#i.gain.value=1.2,this.#i.connect(this.output),this.#s.connect(this.output),this.#r=Fe({start:{soundId:`${r==="headOverHeels"?"head":r}Jump`}},this.#n),this.#o=Fe({loop:{soundId:`${r==="headOverHeels"?"head":r}Fall`}},this.#n)}output=ce.createGain();#e;#t;#n=ce.createGain();#r;#o;#s=ce.createGain();#l=Fe({start:{soundId:"landing"},noStartOnFirstFrame:!0},this.#s);#i=ce.createGain();#c=Fe({start:{soundId:"carry",playbackRate:.95},stop:{soundId:"carry",playbackRate:1.05}},this.#i);#a={teleportingPhase:null,positionZ:0};tick({lastRenderRoomTime:e}){const{renderContext:{item:n}}=this,{state:{action:r,teleporting:o,jumpStartZ:s,jumped:i,standingOnItemId:a,position:{z:l},vels:{gravity:{z:c}},collidedWith:{roomTime:u,by:d}}}=n,f=xP(n),{teleportingPhase:p,positionZ:g}=this.#a,y=o?o.phase:null,v=i&&l>s&&l>g&&c>0,w=l<g&&c<0&&a===null;this.#o(w),this.#r(v),this.#t!==void 0&&this.#t(!v&&!w&&r==="moving"),f!==void 0&&this.#c(f.carrying!==null);const _=a!==null&&u>(e??Pe)&&d[a];if(this.#l(_),y!==null&&y!==p)if(y==="in"){const x=Ua().teleportIn,b=ce.createBufferSource();b.buffer=x,b.connect(this.output),b.start()}else{const x=Ua().teleportOut,b=ce.createBufferSource();b.buffer=x,b.connect(this.output),b.start()}this.#a={teleportingPhase:y,positionZ:l}}destroy(){}}class zP{constructor(e){this.renderContext=e}output=ce.createGain();#e=void 0;tick(){const{renderContext:{item:{state:{stoodOnBy:e},config:{style:n}}}}=this;if(n!=="drum")return;const r=this.#e?.stoodOn??!1,o=wo(e);!r&&o&&$e({soundId:"drum",connectTo:this.output}),this.#e={stoodOn:o}}destroy(){}}class DP{constructor(e){this.renderContext=e,this.scrapeBracketed=Fe({loop:{soundId:"stepStoolScraping"}},this.output),this.output.gain.value=.4}output=ce.createGain();scrapeBracketed;tick({movedItems:e}){const{renderContext:{item:n,room:{roomTime:r}}}=this,{state:{actedOnAt:{roomTime:o},standingOnItemId:s}}=n,i=r===o&&s!==null&&e.has(n);this.scrapeBracketed(i)}destroy(){}}class MP{constructor(e){this.renderContext=e}output=ce.createGain();tick({lastRenderRoomTime:e}){const{renderContext:{item:{state:{stoodOnBy:n,stoodOnUntilRoomTime:r}}}}=this,o=wo(n);e!==void 0&&r>e&&!o&&$e({soundId:"springBoing",connectTo:this.output})}destroy(){}}class LP{constructor(e){this.renderContext=e,this.#e.connect(this.output)}output=ce.createGain();#e=ce.createGain();#t=void 0;tick(){const{renderContext:{item:{state:{setting:e},config:n}}}=this,r=n.type==="in-store"?Ja(U.getState(),n.path)?"right":"left":e,o=this.#t?.setting;o!==void 0&&o!==r&&$e({soundId:"switchClick",playbackRate:r==="right"?.95:1.05,connectTo:this.#e}),this.#t={setting:r}}destroy(){}}class BP{constructor(e){this.renderContext=e}output=ce.createGain();#e=Fe({loop:{soundId:"teleportWarningSiren"}},this.output);tick(){const{renderContext:{item:e,room:n}}=this;this.#e(Ul(e)&&vo(e.state.stoodOnBy,n).some(ol))}destroy(){}}class FP{constructor(e){this.renderContext=e,$e({soundId:"hooter",connectTo:this.output})}output=ce.createGain();tick(){}destroy(){}}class UP extends Hl{constructor(e){super(e,{soundId:"glassClink",varyPlaybackRate:!0},.8),this.renderContext=e}}const HP=(t,e)=>xh(vo(t.state.stoodOnBy,e).filter(uh));class WP{constructor(e){this.renderContext=e,this.output.gain.value=2}output=ce.createGain();#e=void 0;tick(e){const{renderContext:{item:n,room:r}}=this,o=HP(n,r);this.#e!==void 0&&o<this.#e&&$e({soundId:"toasterPopUpSoundUrl",connectTo:this.output}),this.#e=o}destroy(){}}const GP={lift:$P,switch:LP,bubbles:RP,head:Mi,heels:Mi,headOverHeels:Mi,teleporter:BP,monster:NP,conveyor:OP,spring:MP,portableBlock:zP,charles:IP,ball:AP,pushableBlock:DP,firedDoughnut:FP,slidingBlock:UP},qP=t=>{if(t.item.type==="deadlyBlock"&&t.item.config.style==="toaster")return new WP(t);const e=GP[t.item.type];if(e)return new e(t)},VP={edgeLeftX:Number.POSITIVE_INFINITY,edgeRightX:Number.NEGATIVE_INFINITY,topEdgeY:Number.POSITIVE_INFINITY,bottomEdgeY:Number.NEGATIVE_INFINITY},KP=t=>Ie(t.items).filter(ra).reduce((e,{config:{naturalFootprint:n},state:{position:r},renderAabb:o,renderAabbOffset:s,aabb:i})=>{const a=Y(B(n.position,{x:n.aabb.x,z:n.aabb.z})).x,l=Y(B(n.position,{y:n.aabb.y,z:n.aabb.z})).x,c=Y(B(n.position,n.aabb)).y,u=Y(B(r,s??de,{z:(o??i).z})).y;return{edgeLeftX:Math.min(e.edgeLeftX,a),edgeRightX:Math.max(e.edgeRightX,l),topEdgeY:Math.min(e.topEdgeY,c),bottomEdgeY:Math.max(e.bottomEdgeY,u)}},VP),ad=V.h*-1,ld=V.h*Lm,XP=0,JP=V.w*16,Li=(t,e,n)=>(t-e)/(n-e)*2-1;class YP{constructor(e,n){this.renderContext=e,this.childRenderer=n,n.output.connect(this.output),this.output.rolloffFactor=2,this.output.maxDistance=5,this.output.distanceModel="exponential";const r=KP(e.room);this.soundPositionMinX=r.edgeLeftX,this.soundPositionMaxX=r.edgeRightX}output=ce.createPanner();soundPositionMinX;soundPositionMaxX;tick(e){this.childRenderer.tick(e);const{item:n}=this.renderContext,r=n.state,o=B(r.position,Cs(n.aabb,.5)),s=Li(yE(o),this.soundPositionMaxX,this.soundPositionMinX),i=Li(o.z,ad,ld);if(!Number.isFinite(i))throw new Error(`y position for sound rendering is not finite;
        positionY = numberInRangeToMinus1To1Range(
          itemCentrePosition = ${o.z},
          ${ad},
          ${ld},
        );
        itemCentrePosition = addXyz(
          itemState.position = ${JSON.stringify(r.position)},
          scaleXyz(${JSON.stringify(n.aabb)}, 0.5),
        )`);const a=Li(o.x+o.y,XP,JP);this.output.positionX.value=s,this.output.positionY.value=i,this.output.positionZ.value=a}destroy(){this.childRenderer.destroy()}}const $n=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,ZP=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // we know c.a is either 0 or 1, so no need to do a step()

    finalColor = mix(c, vec4(uColour, 1), c.a);
}
`;class bs extends tn{constructor(e){const n=Ot.from({vertex:$n,fragment:ZP,name:"oneColour-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uColour:{value:new Float32Array(3),type:"vec3<f32>"}}}});const r=this.resources.colorReplaceUniforms.uniforms,[o,s,i]=e.toArray();r.uColour[0]=o,r.uColour[1]=s,r.uColour[2]=i}}const QP={pureBlack:new J("#000000"),shadow:new J("#1B2D3B"),midGrey:new J("#505A55"),lightGrey:new J("#929981"),white:new J("#F8FEF8"),pastelBlue:new J("#4893FF"),metallicBlue:new J("#1D4E80"),pink:new J("#B973AF"),moss:new J("#6E7B00"),redShadow:new J("#513D40"),midRed:new J("#A7574B"),lightBeige:new J("#BF8E69"),highlightBeige:new J("#DBB269"),alpha:new J("#105A69"),replaceLight:new J("#048662"),replaceDark:new J("#052229")},eT=`#version 300 es
// keep this one at mediump for the hash function's precision
precision mediump float;

in vec2 vTextureCoord;
out vec4 finalColor;

const float LUT_SIZE = 256.0;
const float magicNumber = 31.0; // Small prime number

uniform sampler2D uTexture;
uniform sampler2D uLut;

/** returns in [0, LUT_SIZE] range
this must match the TypeScript version of the hash function*/
float hashColor(vec3 color) {
    vec3 c255 = floor(color * 255.0);
    
    float hash = mod(
        c255.r + c255.g * magicNumber + c255.b * magicNumber * magicNumber, 
        LUT_SIZE
    );
    return hash;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    float h = hashColor(c.rgb);

    // use the hash to look up the replacement in the LUT:
    vec4 replacementColour = texture(
        uLut, 
        vec2(
            // normalise h to [0, 1] range
            (h + 0.5) / LUT_SIZE, 
            0.5
        )
    );
    
    // use original if either: 
    //      original alpha is 0 (because keep transparent)
    //      or lut alpha is 0 (signals nothing in this slot of the LUT)
    finalColor = mix(c, replacementColour, c.a * replacementColour.a);
}
`,Wr=256,Bi=31;function tT(t){const e=Math.floor(t.red*255),n=Math.floor(t.green*255),r=Math.floor(t.blue*255);return(e+n*Bi+r*Bi*Bi)%Wr}function nT(t){const e=new Float32Array(Wr*4);for(const[o,s]of ly(t)){const i=N[o],a=tT(i);if(e[a*4+3]>.5)throw new Error("LUT collision - mess with the hash function or lut size until this goes away");e[a*4+0]=s.red,e[a*4+1]=s.green,e[a*4+2]=s.blue,e[a*4+3]=1}const n=new Uint8Array(Wr*4);for(let o=0;o<Wr*4;o++)n[o]=Math.floor(e[o]*255);return Tt.from({resource:n,width:Wr,height:1,scaleMode:"nearest"})}class on extends tn{#e;constructor(e){const n=Object.keys(e).length,r=Ot.from({vertex:$n,fragment:eT,name:"palette-swop-filter"}),o=nT(e);super({glProgram:r,resources:{colorReplaceUniforms:{uOriginal:{value:new Float32Array(3*n),type:"vec3<f32>",size:n},uReplacement:{value:new Float32Array(3*n),type:"vec3<f32>",size:n}},uLut:o.source}}),this.#e=o;const s=this.resources.colorReplaceUniforms.uniforms;Object.entries(e).forEach(([i,a],l)=>{N[i].toArray().forEach((c,u)=>{s.uOriginal[l*3+u]=c}),a.toArray().forEach((c,u)=>{s.uReplacement[l*3+u]=c})})}destroy(e){this.#e?.destroy(!0),this.#e=null,super.destroy(e)}}const rT=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uTargetColor;

vec4 black = vec4(0.0, 0.0, 0.0, 1.0);

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // 1 if black, 0 if non-black
    float isBlack = step(length(c.rgb), 0.01);

    // keep original if either:
    //      * black
    //      * transparent

    finalColor = mix(    
        vec4(uTargetColor, 1),    
        c, 
        max(isBlack, 1.0 - c.a)
    );
}
`;class Ue extends tn{uniforms;constructor(e="white"){const n=Ot.from({vertex:$n,fragment:rT,name:"revert-colourise-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[n,r,o]=new J(e).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}}const oT=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    finalColor = vec4(c.rgb * 0.5, c.a);
}
`;class sT extends tn{constructor(){const e=Ot.from({vertex:$n,fragment:oT,name:"halfbrite-filter"});super({glProgram:e,resources:{}})}}const Qm=({basic:t,dimmed:e})=>({replaceLight:t,replaceDark:e}),eg=({color:{hue:t,shade:e},planet:n})=>{const r=t==="yellow"?e==="dimmed"||n==="jail"?cm:Qe:Ls[t][e].main;return Qm(r)},iT=t=>new on({lightBeige:N.lightGrey,redShadow:N.shadow,pink:N.lightGrey,moss:N.lightGrey,midRed:N.midGrey,highlightBeige:N.lightGrey,...t&&eg(t)}),aT=new on({midGrey:N.midRed,lightGrey:N.lightBeige,white:N.highlightBeige,metallicBlue:N.redShadow,pink:N.midRed,moss:N.midRed,replaceDark:N.midRed,replaceLight:N.lightBeige}),cd=(t,e)=>{const n=ys(t.color).edges[e],r=n.original;return n.dimInOriginal?lm(r):r},tg=(t,e,n)=>n?new on(Qm(Ls[t.color.hue][t.color.shade].edges[e])):new Ue(ys(t.color).edges[e].original),gt=t=>new on(eg(t)),lT=t=>{switch(t.color.hue){case"white":return new on({replaceLight:N.lightGrey,replaceDark:N.midGrey});default:return gt(t)}},ng=t=>{switch(t.color.hue){case"white":return new on({replaceLight:N.lightBeige,replaceDark:N.midRed,shadow:N.redShadow});case"yellow":return gt({planet:t.planet,color:{hue:"yellow",shade:"dimmed"}});default:return gt(t)}};new sT;const sn=us,cT=new on(QP),uT=[new bs(N.midRed)],dT=[new bs(N.moss)],hT=75;class fT{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output)}output=new oe({label:"ItemFlashOnSwitchedRenderer"});tick(e){const{renderContext:{item:{state:{switchedAtRoomTime:n,switchedSetting:r}},room:{roomTime:o}}}=this;this.output.filters=o-n<hT?r==="left"?dT:uT:sn,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const pT=(t,e,n)=>{const o=Vt().textures[`door.frame.${t.planet}.${e}.near`]!==void 0?t.planet:"generic",s=t.color.shade==="dimmed"&&Vt().textures[`door.frame.${o}.dark.${e}.${n}`]!==void 0;return`door.frame.${o}${s?".dark":""}.${e}.${n}`};function Gs(t,e){const n=e||new oe;for(const r of t)n.addChild(r);return n}function*mT({config:{direction:t,inHiddenWall:e,height:n}},r){const o=co(t),s=o==="y"?1:16;function*i(a){if(e){if(n!==0){const l=G({textureId:`generic.door.floatingThreshold.${o}`,...Vr(a,{y:-12*n})});l.filters=tg(r,o==="x"?"towards":"right",!0),yield l}}else{yield G({pivot:{x:s,y:9},textureId:`generic.door.legs.base.${o}`,...Vr(a,{})});for(let l=1;l<n;l++)yield G({pivot:{x:s,y:9},textureId:`generic.door.legs.pillar.${o}`,...Vr(a,{y:-l*V.h})})}}yield*i(Pn({...lr,[o]:1})),yield*i(lr),e||(yield G({pivot:{x:16,y:V.h*n+13},textureId:`generic.door.legs.threshold.double.${o}`,...Pn({...lr,[o]:1})}))}const rg=(t,e)=>{const n=co(t),r=kr(n),o=8;return t==="towards"||t==="right"?Y({[r]:e[r]-o}):lr},gT=je(({renderContext:{item:t,room:e}})=>Gs(mT(t,e),new oe({filters:gt(e),...rg(t.config.direction,t.aabb)}))),yT=je(({renderContext:{item:{config:{direction:t,part:e,toRoom:n},aabb:r},room:o,general:{gameState:s}}})=>{const i=co(t),a=s===void 0?o:s.campaign.rooms[n];return G({textureId:pT(o,i,e),filter:gt(a),...rg(t,r)})}),Fi={animationId:"bubbles.cold"},sr=({top:t,bottom:e="headlessBase",filter:n})=>{const r=new oe({filters:n}),o=G(e);r.addChild(o);const s=G(t);return s.y=-12,r.addChild(s),r[qs]=s,r[Wl]=o,r},qs=Symbol(),Wl=Symbol(),vT=({top:t,bottom:e})=>{const n=new oe;return n.addChild(e),t.y=-12,n.addChild(t),n[qs]=t,n[Wl]=e,n},wT=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform vec2 uTextureSize;
uniform sampler2D uTexture;
uniform vec3 uOutline;
uniform float uOutlineWidth;

void main(void) {
    vec2 scaledTexelSize = vec2(1.0f) / vec2(textureSize(uTexture, 0)) * uOutlineWidth;    
    
    // Calculate offset coordinates
    vec2 rightCoord = vec2(vTextureCoord.x + scaledTexelSize.x, vTextureCoord.y);
    vec2 leftCoord = vec2(vTextureCoord.x - scaledTexelSize.x, vTextureCoord.y);
    vec2 belowCoord = vec2(vTextureCoord.x, vTextureCoord.y + scaledTexelSize.y);
    vec2 aboveCoord = vec2(vTextureCoord.x, vTextureCoord.y - scaledTexelSize.y);
    
    // Create boundary masks (1.0 if within bounds, 0.0 if out of bounds)
    // seems to work fine without this, but could multiply colourToX by this to get zero'd out when OOB
    // float rightInBounds = step(rightCoord.x, 1.0);
    // float leftInBounds = step(0.0, leftCoord.x);
    // float belowInBounds = step(belowCoord.y, 1.0);
    // float aboveInBounds = step(0.0, aboveCoord.y);
    
    vec4 colourToRight = texture(uTexture, rightCoord);
    vec4 colourToLeft = texture(uTexture, leftCoord);
    vec4 colourBelow = texture(uTexture, belowCoord);
    vec4 colourAbove = texture(uTexture, aboveCoord);
    
    // Check if any neighbor is opaque (combine all alpha values)
    float hasOpaqueNeighbor = max(max(colourToRight.a, colourToLeft.a), 
                                  max(colourBelow.a, colourAbove.a));

    vec4 originalColour = texture(uTexture, vTextureCoord);
        
    finalColor = mix(
        originalColour, 
        vec4(uOutline, 1), 
        // 1 if: original colour is transparent and has an opaque neighbour - use outline colour
        // 0 if: original colour is opaque or has no opaque neighbour - use original colour (transparent or sprite)
        (1.0 - originalColour.a) * hasOpaqueNeighbor
    );
}
`;class yt extends tn{constructor({outlineColor:e,upscale:n,lowRes:r}){const o=Ot.from({vertex:$n,fragment:wT,name:"outline-filter"});super({glProgram:o,padding:n,resources:{colorReplaceUniforms:{uOutline:{value:new Float32Array(3),type:"vec3<f32>"},uOutlineWidth:{value:new Float32Array(1),type:"f32"}}}});const s=this.resources.colorReplaceUniforms.uniforms,[i,a,l]=e.toArray();s.uOutline[0]=i,s.uOutline[1]=a,s.uOutline[2]=l,s.uOutlineWidth[0]=n,r&&(this.resolution=1/n,this.padding=n,s.uOutlineWidth[0]=1)}}const bT=t=>{const{gameTime:e,lastDiedAt:n}=t.type==="headOverHeels"?t.state.head:t.state;return e-n<xE},Ui=t=>{if(t===void 0)return 0;const{shieldCollectedAt:e,gameTime:n}=t;return e!==null&&e+Du>n?100-Math.ceil((n-e)/(Du/100)):0},xT=t=>t.type==="headOverHeels"?Ui(t.state.head)>0||Ui(t.state.heels)>0:Ui(t.state)>0,Vs=t=>t,Ha=.02,_T=({name:t,action:e,facingXy8:n,teleportingPhase:r,gravityZ:o,paused:s})=>{if(e==="death")return{animationId:`${t}.fadeOut`,paused:s};if(r==="out")return{animationId:`${t}.fadeOut`,paused:s};if(r==="in")return{animationId:`${t}.fadeOut`,paused:s};if(e==="moving")return{animationId:`${t}.walking.${n}`,paused:s};if(e==="jumping")return{textureId:o<Ha?`${t}.walking.${n}.2`:`${t}.walking.${n}.1`};if(e==="falling"){const a=`${t}.falling.${n}`;if(ds(a))return{textureId:a}}const i=`${t}.idle.${n}`;return Uh(i)?{animationId:i,paused:s}:{textureId:`${t}.walking.${n}.2`}},Wa=Symbol(),Ga=Symbol(),ST=(t,e)=>{t[Wa].removeChildren(),t[Wa].addChild(G(_T(e)))},og=new on({pastelBlue:N.pink}),Hi=(t,e,n)=>{const r=new oe,o=new oe;r[Wa]=o,r.addChild(o);const s=G({animationId:e?`shine.${t}InSymbio`:"shine",paused:n,filter:t==="heels"?og:sn,flipX:t==="heels"});return r[Ga]=s,r},ud=({gameTime:t,switchedToAt:e},n,r)=>(n==="headOverHeels"||n===r)&&e+bE>t,CT=t=>{if(!bT(t))return!1;const{gameTime:e,lastDiedAt:n}=t.type==="headOverHeels"?t.state.head:t.state;return(e-n)%Mu<Mu*_E},dd=(t,e)=>{t.filters?Array.isArray(t.filters)?t.filters=[...t.filters,e]:t.filters=[t.filters,e].flat():t.filters=e},hd=(t,e)=>{t.filters=Array.isArray(t.filters)?t.filters.filter(n=>!(n instanceof e)):t.filters instanceof e?sn:[...t.filters]},kT=(t,{highlighted:e,flashing:n},r,o)=>{const s=r?.highlighted??!1;e&&!s?dd(o,new yt({outlineColor:or[t],upscale:en(U.getState()),lowRes:!1})):!e&&s&&hd(o,yt);const i=r?.flashing??!1;n&&!i?dd(o,new bs(or[t])):!n&&i&&hd(o,bs)},ET=(t,e,n)=>{e&&!n?t.addChild(t[Ga]):!e&&n&&t.removeChild(t[Ga])},Wi=(t,e,n,r,o,s)=>{n&&ST(e,{name:t,...r,paused:o}),kT(t,r,s,e),ET(e,r.shining,s?.shining??!1)},PT=({renderContext:{item:t,general:{gameState:e,paused:n}},currentRendering:r})=>{const{type:o,state:{action:s,facing:i,teleporting:a,vels:{gravity:{z:l}}}}=t,c=r?.renderProps,u=r?.output,d=nh(i)??"towards",f=e!==void 0&&(t.type==="headOverHeels"?ud(t.state.head,"headOverHeels","headOverHeels"):ud(t.state,t.type,e.currentCharacterName)),p=CT(t),g=xT(t),y=rh(i),v=a?.phase??null,w={action:s,facingXy8:d,teleportingPhase:v,flashing:p,highlighted:f,shining:g,gravityZ:l},_=c===void 0||c.action!==s||c.facingXy8!==d||c.teleportingPhase!==v||c?.gravityZ>Ha!=l>Ha;let x;if(o==="headOverHeels"){x=u??vT({top:Hi("head",!0,n),bottom:Hi("heels",!0,n)});const b=x;Wi("head",b[qs],_,w,n,c),Wi("heels",b[Wl],_,w,n,c)}else x=u??Hi(o,!1,n),Wi(o,x,_,w,n,c);return s==="moving"&&u instanceof eo&&(u.animationSpeed=y*cy),{output:x,renderProps:w}},Gi=Vs(PT),fd=t=>t-Math.floor(t),TT=({state:{position:t}},e)=>{const n=o=>o.config.direction==="away"||o.config.direction==="left";return Gs(Ie(e.items).filter(o=>o.type==="wall"||o.type==="doorLegs").filter(n).map(o=>{const{id:s,config:{direction:i},state:{position:a}}=o;return G({textureId:"floorOverdraw.cornerNearWall",label:s,...Y(fr(a,t)),times:o.type==="wall"?nl(o.config):{[kr(Kt(i))]:2},anchor:{x:0,y:1},flipX:i==="away"})}),new oe({label:"floorOverdraws"}))},AT=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    finalColor = texture(uTexture, vTextureCoord);
}
`;class RT extends tn{constructor(){const e=Ot.from({vertex:$n,fragment:AT,name:"null-filter"});super({glProgram:e,resources:{}})}}const IT=`#version 300 es
precision lowp float;

out vec4 finalColor;

in vec2 vTextureCoord;
uniform sampler2D uBackBuffer;
uniform vec3 uTargetColor;
// do not use uTexture in this frag - for some reason it causes pixi's render pipeline
// to take away the backbuffer, which we rely on sampling from

void main() {
    vec3 bg = texture(uBackBuffer, vTextureCoord).rgb;

    float isBlack = step(length(bg), 0.001f); // 1 if black, 0 otherwise
    finalColor = mix(vec4(uTargetColor, 1.0f), vec4(0, 0, 0, 0), isBlack);


}`;class pd extends tn{uniforms;constructor(e="white"){const n=Ot.from({vertex:$n,fragment:IT,name:"colour-clash-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}},blendRequired:!0}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[n,r,o]=new J(e).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}}const md=({colourised:t,direction:e,room:n,times:r,position:o,colourSwap:s})=>G({label:`floorEdge(${e})`,textureId:`floorEdge.${e}`,times:r,filter:s?tg(n,e,t):void 0,...Y(o)}),OT=({room:t,xSize:e,ySize:n,y:r})=>{const o=new oe({label:"floorColourClash"}),s=cd(t,"right");for(let a=0;a<=n;a++){const l=Pn({x:0,y:a,z:0}),c=new ht().rect(l.x-(a===0?0:8),l.y,8*3,8).fill(s);c.filters=new pd(s),o.addChild(c)}const i=cd(t,"towards");for(let a=0;a<=e;a++){const l=Pn({x:a,y:0,z:0}),c=new ht().rect(l.x-16,l.y,8*(a===0?2:3),8).fill(i);c.filters=new pd(i),o.addChild(c)}return o.y=r,o},jT=je(({renderContext:{room:t,item:e,general:{colourised:n},colourClashLayer:r}})=>{const{color:{shade:o}}=t,{config:s,state:{position:i},aabb:a}=e,{floorType:l,naturalFootprint:c}=s,u=new oe({label:"floorAppearance"}),d=Y({...a,y:0}),f=Y({...a,x:0,y:0}),p=Y({...a,x:0}),g=Y(a);if(l!=="none"){const y=new oe({label:"tiles"}),v=l==="deadly"?`generic${o==="dimmed"?".dark":""}.floor.deadly`:`${s.scenery}${o==="dimmed"?".dark":""}.floor`,w=Vt().textures[v];try{Fh(v)}catch(O){throw new Error(`no floor textureId for floorType: ${l}, shade: ${o}`,{cause:O})}const _=vn(c.position,i),x={x:fd(_.x/V.w),y:fd(_.y/V.w)},b=8,C={x:d.x,y:g.y-b,width:p.x-d.x,height:f.y-g.y+2*b},k=vn(Pn(Vr(x,{x:.5,y:.5})),{y:a.z},C),S=new nw({texture:w,tilePosition:k,...C});y.addChild(S),y.addChild(TT(e,t));const $=new ht().moveTo(g.x,g.y).lineTo(p.x,p.y).lineTo(p.x,p.y+3).lineTo(f.x,f.y+3).lineTo(d.x,d.y+3).lineTo(d.x,d.y).fill({color:16711680,alpha:.5});y.addChild($),y.mask=$,y.filters=[lT(t)];const H=new oe({children:[y]});H.filters=new yt({outlineColor:N.pureBlack,upscale:1,lowRes:!1});const D=new oe({children:[H]}),q=new RT;q.enabled=!1,D.filters=q,D.cacheAsTexture(!0),u.addChild(D),u.addChild(G({textureId:"blank",x:p.x,y:f.y+8}))}{const y=new oe({label:"edges"});l==="none"&&y.addChild(new ht().moveTo(p.x,p.y+8).lineTo(p.x,p.y+100).lineTo(d.x,d.y+100).lineTo(d.x,d.y+8).lineTo(f.x,f.y+8).fill(0));const v=Math.ceil(a.y/V.w);y.addChild(md({colourised:n,direction:"right",room:t,times:{y:v},position:{z:a.z},colourSwap:n}));const w=Math.ceil(a.x/V.w);if(y.addChild(md({colourised:n,direction:"towards",room:t,times:{x:w},position:{z:a.z},colourSwap:n})),u.addChild(y),!n){const _=OT({xSize:w,ySize:v,y:-a.z+1,room:t});u.addChild(_),r.attach(_)}}return u}),$T=["cyberman","dalek","skiHead","bubbleRobot","computerBot","turtle","homingBot"],NT=t=>{let e=2166136261;const n=t.length;for(let r=Math.max(0,n-9);r<n;r++)e^=t.charCodeAt(r),e=Math.imul(e,1540483477),e^=e>>>15;return(e>>>0)/4294967295},zT=200,DT=1,MT=(t,e)=>{const n=NT(e);return Math.sin((t+n*2e4)/zT)*DT},gd=({id:t,config:{which:e},state:n},r,o)=>{if((e==="cyberman"||e==="bubbleRobot")&&n.activated||e==="emperorsGuardian"){const s=o;s[qs].y=-12+MT(r.roomTime,t)}},LT=({renderContext:{item:t,room:e,general:{paused:n}},currentRendering:r})=>{const{config:o,state:s}=t,i=r?.renderProps,{activated:a,busyLickingDoughnutsOffFace:l}=s,c=l?aT:a?void 0:$T.includes(o.which)?iT(e):void 0;switch(o.which){case"skiHead":case"turtle":case"cyberman":case"computerBot":case"elephant":case"elephantHead":case"monkey":{const u=Ya(s.facing)??"towards";if(!(i===void 0||a!==i.activated||l!==i.busyLickingDoughnutsOffFace||u!==i.facingXy4))return gd(t,e,r.output),"no-update";const f={facingXy4:u,activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"skiHead":return{output:G({textureId:`${o.which}.${o.style}.${u}`,filter:c}),renderProps:f};case"elephantHead":return{output:G({textureId:`elephant.${u}`,filter:c}),renderProps:f};case"turtle":return{output:G(a&&!l?{animationId:`${o.which}.${u}`,filter:c,paused:n}:{textureId:`${o.which}.${u}.1`,filter:c}),renderProps:f};case"cyberman":return{output:s.activated||s.busyLickingDoughnutsOffFace?sr({top:{textureId:`${o.which}.${u}`,filter:c||gt(e)},bottom:{...Fi,paused:n}}):G({textureId:`${o.which}.${u}`,filter:c}),renderProps:f};case"computerBot":case"elephant":case"monkey":return{output:sr({top:`${o.which}.${u}`,bottom:{animationId:"headlessBase.flash",playOnce:"and-stop"},filter:c}),renderProps:f};default:throw new Error(`unexpected monster ${o}`)}break}case"homingBot":{const u=!uy(s.vels.walking,lr);return i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated||u!==i.walking?{filter:c,output:G(a&&!l?{animationId:u?"headlessBase.flash":"headlessBase.scan",filter:c}:{textureId:"headlessBase",filter:c}),renderProps:{activated:a,busyLickingDoughnutsOffFace:l,walking:u}}:"no-update"}case"helicopterBug":case"emperor":case"dalek":case"bubbleRobot":case"emperorsGuardian":{if(!(i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated))return gd(t,e,r.output),"no-update";const d={activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"helicopterBug":case"dalek":return{output:G(a&&!l?{animationId:o.which,filter:c,paused:n}:{textureId:`${o.which}.1`,filter:c}),renderProps:d};case"bubbleRobot":return{output:sr({top:{...Fi,paused:n},filter:c}),renderProps:d};case"emperorsGuardian":return{output:sr({top:"ball",bottom:{...Fi,paused:n},filter:c}),renderProps:d};case"emperor":return{output:G({animationId:"bubbles.cold",filter:c,paused:n}),renderProps:d};default:throw new Error(`unexpected monster ${o}`)}break}default:throw new Error(`unexpected monster ${o}`)}},qo=new yt({outlineColor:N.pureBlack,upscale:en(U.getState()),lowRes:!0});new Ue;new Ue;new Ue;new Ue(N.moss);new Ue;new Ue(or.head),new Ue(wr(or.head)),new Ue(or.heels),new Ue(wr(or.heels));function*BT(t){const e=typeof t=="string"?t==="infinite"?"":t:t.toString(),n=xh(e);let r=0;for(const o of e){const s=`hud.char.${Vd(o)}`;try{Fh(s)}catch(i){throw new Error(`no texture id for char "${o}": ${i.message}`,{cause:i})}yield G({textureId:s,x:(r+.5-n/2)*dy.w}),r++}}const sg=(t,e)=>{t.removeChildren();try{Gs(BT(e),t)}catch(n){throw console.error("invalid string is",e,"and on window as window.invalid"),console.error(n),window.invalid=e,new Error(`could not show text "${e}" in container because: "${n.message}"`,{cause:n})}return t},FT=Mm.floatingText,UT=12,yd=V.h*3,vd=[N.shadow,N.midGrey,N.redShadow,N.metallicBlue,N.midRed,N.moss,N.pink,N.lightBeige,N.pastelBlue,N.lightGrey,N.highlightBeige],wd=[...vd,...new Array(20).fill(N.white),...vd.toReversed()],HT=({renderContext:{item:{config:{textLines:t,appearanceRoomTime:e}},room:{roomTime:n},general:{displaySettings:{uncolourised:r}},frontLayer:o},currentRendering:s})=>{const i=s?.output;let a;const c=(n-e)*FT;if(i===void 0){a=new oe({filters:new yt({outlineColor:N.pureBlack,upscale:en(U.getState()),lowRes:!1})}),o?.attach(a);for(let d=0;d<t.length;d++){const f=t[d],p=sg(new oe({label:f,y:d*UT,filters:r?sn:new Ue(N.pink)}),f.toUpperCase());a.addChild(p)}}else a=i;let u=!1;for(let d=0;d<t.length;d++){const f=a.children[d],[p]=f.filters,g=c+d*-12,y=g>0&&g<yd;if(f.visible=y,u||=y,y&&p){const v=Math.floor(g/yd*wd.length);p.targetColor=wd[v]}}return a.visible=u,a.y=-c,{output:a,renderProps:ue}},bd=500,WT=An.animations["conveyor.x"].animationSpeed,xd=An.animations["conveyor.x"].length,GT=t=>1-(1-t)**2,qT=(t,e)=>{for(let n=0;n<t.children.length;n++){const r=t.children[n],o=n%xd;r.gotoAndStop(e?xd-o-1:o)}return t},VT=({renderContext:{item:{config:{direction:t,times:e},state:{stoodOnBy:n}},room:{roomTime:r}},currentRendering:o})=>{const s=o?.renderProps,i=wo(n),a=(!i&&s?.moving?r:s?.roomTimeStoppedMoving)??Pe,l=Kt(t),c=o?.output??qT(G({animationId:`conveyor.${l}`,reverse:t==="towards"||t==="right",times:e}),t==="towards"||t==="right"),u=i?0:Math.min(r-a,bd),d=Math.max(0,1-u/bd);for(const f of c.children)if(d===0)f.stop();else{const p=WT*GT(d);f.play(),f.animationSpeed=p}return{output:c,renderProps:{moving:i,roomTimeStoppedMoving:a}}},KT=Vs(VT),XT=({renderContext:{item:t,room:e,general:{paused:n}},currentRendering:r})=>{const{state:{stoodOnBy:o},config:{times:s}}=t,i=r?.renderProps,a=Ul(t),l=a&&vo(o,e).some(ol);return i===void 0||a!==i.activated||l!==i.flashing?{output:l?new oe({children:[G({textureId:"teleporter",times:s}),G({animationId:"teleporter.flashing",times:s,paused:n})]}):G({textureId:a?"teleporter":"block.artificial",times:s}),renderProps:{flashing:l,activated:a}}:"no-update"},JT=({renderContext:{item:{state:{facing:t,actedOnAt:{roomTime:e,by:n}}},room:{roomTime:r,items:o}},currentRendering:s})=>{const i=s?.renderProps,a=Ya(t)??"towards",l=r===e&&vt(ks(n)).some(u=>ch(o[u]));return i===void 0||a!==i.facingXy4||l!==i.controlledByJoystick?{output:sr({top:`charles.${a}`,bottom:l?"headlessBase.all":"headlessBase"}),renderProps:{facingXy4:a,controlledByJoystick:l}}:"no-update"},YT=({renderContext:{item:{state:{stoodOnBy:t,stoodOnUntilRoomTime:e}},general:{paused:n}},tickContext:{lastRenderRoomTime:r},currentRendering:o})=>{const s=o?.renderProps,i=wo(t);let a;return o?.output?a=o?.output:(a=G({animationId:"spring.bounce"}),a.loop=!1,a.gotoAndStop(0)),r!==void 0&&e>r&&!i&&!n?a.gotoAndPlay(0):i&&!(s?.compressed??!1)&&a.gotoAndStop(1),{output:a,renderProps:{compressed:i}}},ZT=Vs(YT),QT=({renderContext:{item:{config:{which:t,startDirection:e}}},currentRendering:n})=>n?.renderProps===void 0?{output:t==="headOverHeels"?sr({top:{textureId:`head.walking.${e}.2`},bottom:{textureId:`heels.walking.${e}.2`}}):G({textureId:`${t}.walking.${e}.2`}),renderProps:ue}:"no-update",eA=({renderContext:{item:{state:{vels:{sliding:t}},config:{startingPhase:e}},general:{paused:n}},tickContext:{deltaMS:r},currentRendering:o})=>{const i=(o?.renderProps?.distanceTravelled??0)+el(t)*(n?0:r),l=o?.output??G("spikyBall.1"),u=(Math.floor(i*2/ar.w)+e)%2+1;return l.texture=Vt().textures[`spikyBall.${u}`],{output:l,renderProps:{distanceTravelled:i}}},tA=Vs(eA),nA=(t,e,n,r)=>`${t}${r?".dark":""}.wall.${e}.${n}`,rA=je(({renderContext:{item:{id:t,config:e},room:n}})=>{if(e.direction==="right"||e.direction==="towards")throw new Error(`wall is near: ${t}`);const{direction:r,tiles:o}=e,s=kr(Kt(r)),i=new oe({label:"wallTiles"});for(let a=0;a<e.tiles.length;a++){let l=G({textureId:nA(n.planet,o[a],r,n.color.shade==="dimmed"),y:1,pivot:r==="away"?{x:ar.w,y:ar.h+1}:{x:0,y:ar.h+1}});const c=Pn({[s]:a});if(n.planet==="moonbase"){const u=`moonbase.wall.screen.${o[a]}.away`;Uh(u)&&(l=new oe({children:[l]}),l.addChild(G({animationId:u,randomiseStartFrame:!0,flipX:r==="left",x:r==="away"?-8:8,y:-23})))}l.x+=c.x,l.y+=c.y,i.addChild(l),i.filters=gt(n)}return i}),oA=({renderContext:{item:{state:{setting:t},config:e}},currentRendering:n})=>{const r=n?.renderProps,o=e.type==="in-store"?Ja(U.getState(),e.path)?"right":"left":t;return r===void 0||o!==r.setting?{output:G(`switch.${o}`),renderProps:{setting:o}}:"no-update"},sA=(t,e,n)=>e==="tower"?"tower":e==="book"?"book.x":e==="organic"&&t?`block.organic.dark${n?".disappearing":""}`:`block.${e}${n?".disappearing":""}`,iA=({renderContext:{item:{config:{style:t,times:e},state:{disappearing:n}},room:r},currentRendering:o})=>{const s=o?.renderProps,i=n!==null;return s===void 0||s.isDissapearing!==i?{output:G({textureId:sA(r.color.shade==="dimmed",t,i),filter:t==="organic"?gt(r):t==="book"?ng(r):void 0,times:e}),renderProps:{isDissapearing:i}}:"no-update"},aA=({state:{stoodOnBy:t,position:e},config:{times:n}},r)=>{const o=new Array(n?.x??1).fill(null).map(()=>new Array(n?.y??1));return vo(t,r).filter(uh).forEach(({id:s,state:{position:i}})=>{const a=vn(i,e),l={x:Math.floor(a.x/V.w),y:Math.floor(a.y/V.d)};l.x<0||l.x>=(n?.x??1)||l.y<0||l.y>=(n?.y??1)||(o[l.x][l.y]=s)}),o},lA=(t,e)=>{let n=0,r=1;for(const o of e)for(const s of o)s!==void 0&&t.items[s]?.state.activated&&(n|=r),r<<=1;return n},cA=({renderContext:{item:t,room:e},currentRendering:n})=>{const{config:{times:r}}=t,o=n===void 0?aA(t,e):n.renderProps.chargePositions,s=lA(e,o);return s!==n?.renderProps.cybermanActivationBitmask?{output:G({textureIdCallback(a,l){const c=o[a][l];return c===void 0||e.items[c]?.state.everActivated?"toaster.off":"toaster.on"},times:r??ue}),renderProps:{chargePositions:o,cybermanActivationBitmask:s}}:"no-update"},uA={head:Gi,heels:Gi,headOverHeels:Gi,doorFrame:yT,doorLegs:gT,monster:LT,floatingText:HT,barrier:je(({renderContext:{item:{config:{axis:t,times:e}}}})=>G({textureId:`barrier.${t}`,times:e})),deadlyBlock:je(({renderContext:{item:{config:t},room:e}})=>{switch(t.style){case"volcano":return G({animationId:"volcano",filter:gt(e),times:t.times,randomiseStartFrame:!0});case"toaster":throw new Error("use the special toaster appearance instead");default:throw t.style,new Error("unknown deadly block style")}}),spikes:Dt("spikes"),slidingDeadly:tA,slidingBlock:je(({renderContext:{item:{config:{style:t}},room:e}})=>G(t==="book"?{textureId:"book.y",filter:ng(e)}:t)),block:iA,switch:oA,conveyor:KT,lift:je(({renderContext:{general:{paused:t}}})=>{const e=new oe,n={x:Yl.w/2,y:Yl.h};return e.addChild(G({animationId:"lift",pivot:n,paused:t})),e.addChild(G({textureId:"lift.static",pivot:n})),e}),teleporter:XT,sceneryCrown:je(({renderContext:{item:{config:{planet:t}}}})=>G({textureId:`crown.${t}`})),pickup:je(({renderContext:{item:{config:t},room:e,general:{paused:n}}})=>{if(t.gives==="crown")return G({textureId:`crown.${t.planet}`});const o={shield:"whiteRabbit",jumps:"whiteRabbit",fast:"whiteRabbit","extra-life":"whiteRabbit",bag:"bag",doughnuts:"doughnuts",hooter:"hooter",scroll:{textureId:"scroll",filter:gt(e)},reincarnation:{animationId:"fish",paused:n}}[t.gives];return G(o)}),moveableDeadly:Dt("fish.1"),charles:JT,joystick:Dt("joystick"),movingPlatform:Dt("sandwich"),pushableBlock:Dt("stepStool"),portableBlock:je(({renderContext:{item:{config:{style:t}}}})=>G(t)),spring:ZT,sceneryPlayer:QT,hushPuppy:Dt("hushPuppy"),bubbles:je(({renderContext:{item:{config:{style:t}},general:{paused:e}}})=>G({animationId:`bubbles.${t}`,paused:e})),firedDoughnut:Dt({animationId:"bubbles.doughnut"}),ball:Dt("ball"),floor:jT,particle:je(({renderContext:{item:{config:{forCharacter:t}}}})=>G({animationId:"particle.fade",anchor:{x:.5,y:.5},filter:t==="heels"?og:sn}))},dA=t=>{if(t.type==="wall"){const{direction:e}=t.config;return e==="right"||e==="towards"?void 0:rA}return t.type==="deadlyBlock"&&t.config.style==="toaster"?cA:uA[t.type]},hA=N.moss,fA=()=>new yt({outlineColor:hA,lowRes:!1,upscale:en(U.getState())});class pA{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output)}output=new oe({label:"PortableItemPickUpNextHighlightRenderer"});#e=!1;tick(e){const{wouldPickUpNext:n}=this.renderContext.item.state;n!==!this.#e&&(this.output.filters=n?[fA()]:sn),this.#e=n,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const mA=(t,e,n)=>rv(t)?new pA(e,n):n,gA=N.pastelBlue,yA=N.highlightBeige,vA=N.midRed,wA=N.white,_d=new yt({outlineColor:yA,upscale:en(U.getState()),lowRes:!1}),Sd=new yt({outlineColor:vA,upscale:en(U.getState()),lowRes:!1}),bA=new yt({outlineColor:wA,upscale:en(U.getState()),lowRes:!1}),Cd=new Ue(gA),kd={left:"",away:"",right:"",towards:""},Ed=(t,e)=>{switch(t){case"back-forth":switch(e){case"left":return"";case"right":return"";case"away":return"";case"towards":return"";default:throw new Error("Unexpected startDirection")}case"clockwise":switch(e){case"left":return"";case"right":return"";case"away":return"";case"towards":return"";default:throw new Error("Unexpected startDirection")}case"towards-analogue":return"."}return""};class xA{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output),this.#e()}output=new oe({label:"EditorAnnotationsRenderer"});#e(){const e=this.renderContext.item;switch(e.type){case"pickup":if(e.config.gives==="shield"||e.config.gives==="extra-life"||e.config.gives==="jumps"||e.config.gives==="fast"){const n={shield:"",jumps:"",fast:"","extra-life":"+2"};this.#t({annotationText:n[e.config.gives],yAdj:-16})}break;case"doorFrame":if(e.config.part==="near"){const{rooms:n}=U.getState().levelEditor.campaignInProgress,{config:{toRoom:r,direction:o}}=e,s=!!n[r],i=r.toUpperCase(),a=kd[o],l=o==="away"||o==="right"?`${i}${a}`:`${a}${i}`;this.#t({annotationText:l,yAdj:o==="left"||o==="away"?-48:0,error:!s,clickDispatch:s?()=>oa(r):void 0})}break;case"teleporter":{const{rooms:n}=U.getState().levelEditor.campaignInProgress,{config:{toRoom:r}}=e,o=!!n[r];this.#t({annotationText:`${r.toUpperCase()}`,yAdj:-12,error:!o,clickDispatch:o?()=>oa(r):void 0})}break;case"conveyor":{const{config:{direction:n}}=e,r=kd[n];this.#t({annotationText:r,yAdj:-12})}break;case"movingPlatform":{const{config:{movement:n,startDirection:r}}=e;this.#t({annotationText:Ed(n,r),yAdj:-12})}break;case"monster":{const{config:n}=e;(n.which==="turtle"||n.which==="skiHead")&&this.#t({annotationText:Ed(n.movement,n.startDirection),yAdj:-12})}break}}#t({annotationText:e,yAdj:n=0,error:r=!1,clickDispatch:o}){const{renderContext:{frontLayer:s}}=this,i=new Ue(r?N.midRed:N.white),a=sg(new oe({label:"EditorAnnotationTextContainer",filters:[i,new yt({lowRes:!0,outlineColor:N.pureBlack,upscale:en(U.getState())})]}),e);a.y=n,o!==void 0&&(a.eventMode="static",a.on("click",()=>{U.dispatch(o())}),a.on("mouseover",()=>{U.getState().levelEditor.tool.type==="pointer"&&(U.dispatch(Ql(!0)),i.targetColor=N.pastelBlue)}),a.on("mouseout",()=>{U.dispatch(Ql(!1)),i.targetColor=N.white}),a.cursor="pointer"),this.output.addChild(a),s.attach(a)}tick(e){this.#n(),this.childRenderer.tick(e)}#n(){const{renderContext:{item:e,room:n}}=this,{clickableAnnotationHovered:r}=U.getState().levelEditor,{jsonItemId:o}=e,s=U.getState(),i=dh(s),a=ov(s),l=mn(s),c=o&&i?.jsonItemId===o&&!r,u=o&&a.includes(o),d=()=>o!==void 0&&(Ie(n.items).some(f=>f.jsonItemId===i?.jsonItemId&&f.type==="switch"&&f.config.type==="in-room"&&f.config.modifies.some(p=>p.targets.includes(o)))||e.type==="switch"&&Ie(n.items).some(({jsonItemId:f})=>f!==void 0&&f===i?.jsonItemId&&e.config.type==="in-room"&&e.config.modifies.some(p=>p.targets.includes(f)))||e.type==="charles"&&Ie(n.items).some(f=>f.jsonItemId===i?.jsonItemId&&f.type==="joystick"&&f.config.controls.some(p=>p===o))||e.type==="joystick"&&e.config.controls.some(f=>i?.jsonItemId===f));this.output.filters=c&&u?[Cd,l.type==="eyeDropper"?Sd:_d]:c?l.type==="eyeDropper"?Sd:_d:u?Cd:d()?bA:sn}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const _A=(t,e,n)=>e.general.editor?new xA(e,n):n,SA=(t,e)=>{e!==void 0&&U.getState().gameMenus.cheatsOn&&(e.eventMode="static",e.on("pointertap",()=>{U.dispatch(py({item:t}))}))},CA=t=>{const e=U.getState(),n=hy(e),r=!fy(e),{item:o}=t,s=n==="all"||n==="non-wall"&&t.item.type!=="wall",i=[],a=dA(o);if(a!==void 0){const f=new Jm(t,a),p=new fT(t,f);i.push(_A(o,t,mA(o,t,p)))}if(r){const f=PP(t);f!==void 0&&i.push(f)}s&&i.push(new gP(t));let l;if(i.length===0)l=void 0;else{const f=i.length===1?i[0]:new kA(i,t);SA(o,f.output),l=new yP(t,f)}const c=t.general.soundSettings.mute??Qa.soundSettings.mute,u=t.general.paused||c?void 0:qP(t),d=u===void 0?void 0:new YP(t,u);return new TP(t,{graphics:l,sound:d})};class kA{constructor(e,n){this.renderContext=n,this.#e=e,this.#t.addChild(...e.map(r=>r.output))}#e;#t=new oe({label:"CompositeRenderer"});tick(e){for(const n of this.#e)n.tick(e)}destroy(){for(const e of this.#e)e.destroy()}get output(){return this.#t}}const EA=uo("wall","doorFrame"),Pd=256;function*PA(t){const{left:e,right:n}=Ie(t.items).filter(EA).reduce((r,{aabb:o,renderAabb:s,renderAabbOffset:i,state:{position:a}})=>{const l=s??o,c=B(a,i??de),u=Y(B(c,{x:l.x})).x,d=Y(B(c,{y:l.y})).x;return{left:Math.min(r.left,u),right:Math.max(r.right,d)}},{left:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY});e!==Number.POSITIVE_INFINITY&&(yield new ht().rect(e-100,-256,100,Pd).fill(0)),n!==Number.NEGATIVE_INFINITY&&(yield new ht().rect(n,-256,100,Pd).fill(0))}class TA{constructor(e){this.renderContext=e;const{general:{colourised:n,soundSettings:r},room:o}=e;this.initFilters(n,e.room.color);const i=r.mute??Qa.soundSettings.mute?void 0:ce.createGain();Gs(PA(o),this.#o),this.output={sound:i,graphics:new oe({label:`RoomRenderer(${e.room.id})`})},this.output.graphics.addChild(this.#t),n||(this.#n=new _c({sortableChildren:!1}),this.output.graphics.addChild(this.#n)),this.output.graphics.addChild(this.#o),this.output.graphics.addChild(this.#r)}#e=!1;#t=new oe({label:"items"});#n;#r=new _c({sortableChildren:!1});#o=new oe({label:"occlusion"});output;#s=void 0;#l=new Map;#i=new Map;initFilters(e,n){this.#t.filters=e?n.shade==="dimmed"?cT:sn:new Ue(n.shade==="dimmed"?lm(ys(n).main.original):ys(n).main.original)}#c(e){const{room:n}=this.renderContext,r={...e,lastRenderRoomTime:this.#s};for(const s of Ie(n.items)){let i=this.#i.get(s.id);if(i===void 0){i=CA({...this.renderContext,colourClashLayer:this.#n,frontLayer:this.#r,item:s}),this.#i.set(s.id,i);const{graphics:a,sound:l}=i.output;if(a&&(this.#t.addChild(a),s.fixedZIndex&&(a.zIndex=s.fixedZIndex)),l){if(!this.output.sound)throw new Error("item renderer has sound, but room renderer does not - this probably means that they disagree on if the user has sound muted");l.connect(this.output.sound)}}try{i.tick(r)}catch(a){throw new Error(`RoomRenderer for room ${this.renderContext.room.id} caught error while ticking Renderer for item "${s.id}" - item in play object is:
           ${JSON.stringify(s,null,2)}`,{cause:a})}}let o=!1;for(const[s,i]of this.#i.entries())n.items[s]===void 0&&(i.destroy(),this.#i.delete(s),o=!0);o&&this.#a()}#a(){if(this.#n)for(const e of this.#n.renderLayerChildren)e.parent===null&&this.#n.detach(e);for(const e of this.#r.renderLayerChildren)e.parent===null&&this.#r.detach(e)}#d(e){const n=Xm(this.renderContext.room.items,e.movedItems,this.#l),{order:r}=Fl(n,this.renderContext.room.items);for(let o=0;o<r.length;o++){const s=this.#i.get(r[o]);if(s===void 0)throw new Error(`Item id=${r[o]} does not have a renderer - cannot assign a z-index`);const i=s.output.graphics;if(i)i.zIndex=r.length-o;else throw new Error(`order ${r[o]} was given a z-order by sorting, but item has no graphics`)}}get#u(){return this.#s!==void 0}tick(e){const n=this.#u?e:{...e,movedItems:new Set(Ie(this.renderContext.room.items))};this.#c(n),(!this.#u||n.movedItems.size>0)&&this.#d(n),this.#s=this.renderContext.room.roomTime}destroy(){this.output.graphics.label=this.output.graphics.label+"DESTROYED",this.output.graphics.destroy({children:!0}),this.output.sound?.disconnect(),this.#i.forEach(e=>{e.destroy()}),this.#e=!0}get destroyed(){return this.#e}}const AA=t=>{t.ticker.remove(t.render,t)},ig=m.createContext(null),RA=({children:t})=>{const[e,n]=m.useState(null);return m.useEffect(()=>{const r=new Rh;return r.init({background:N.pureBlack,sharedTicker:!0}).then(()=>{AA(r),n(r)}),()=>{}},[]),e===null?null:h.jsx(ig,{value:e,children:t})},Nn=()=>m.useContext(ig),IA=(t,e)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:e},soundSettings:{mute:!0},pixiRenderer:t,gameState:void 0,paused:!1,colourised:!0,upscale:tl(U.getState()),editor:!0}),Td=(t,e,n)=>new TA({room:t,general:IA(e,n)}),OA=()=>{const{renderer:t}=Nn(),e=Xd();if(!t)throw new Error("this should never be falsey (typescript violation)");const n=Hm(),[r,o]=m.useState(()=>Td(n,t,e));return m.useEffect(()=>{const s=Td(n,t,e);return o(s),()=>{s.destroy()}},[n,t,e]),r},Ad=(t,e,n)=>{const{world:{onItem:{face:r},position:o,itemId:s}}=t;if(r.z>Qd)return rs(o);if(n.type==="door"){const i=e.items[s];if(i.type!=="wall")return;const{config:a,aabb:l,state:{position:c}}=i,u=sv(nl(a)),d=kr(Kt(a.direction)),f=Kt(a.direction);if(u[d]<2)return;const p=c[d],g=c[d]+l[d]-PE,y=c.z,v=c.z+l.z-Hr,w={[d]:Math.max(Math.min(o[d],g),p),[f]:o[f],z:Math.max(Math.min(o.z,v),y)};return rs(w)}return B(rs(o),r)},jA={z:1,x:0,y:0},$A={z:0,x:0,y:-1},Rd={z:0,x:-1,y:0},NA=(t,{x:e,y:n},r)=>{if(r.type==="item"&&r.item.type==="door"&&t.type==="wall"){const l=t.config.direction;return Cs(Ee[l],-1)}const{bottomCentre:o,topLeft:s,topRight:i}=xr(t.state.position,t.aabb);return n<s.y-(s.x-e)/2?n<i.y-(e-i.x)/2?jA:Rd:e<o.x?$A:Rd},zA=3,DA=(t,{x:e,y:n},r)=>{const o=xr(t.state.position,t.aabb);return my.find(s=>{const i=o.projectCorner(s);return el(vn(i,{x:e,y:n}))<zA})},Jn=3,qi=1.5;function xt({x:t,y:e},n,r){const o={x:t-n.x,y:e-n.y},s=o.x*r.y-o.y*r.x;return Math.abs(s)/gy(Math.hypot(r.x,r.y))}const ag={point:{x:-1,y:-1,z:0},normal:{x:0,y:0,z:1}},lg={point:{x:-1,y:0,z:1},normal:{x:0,y:1,z:0}},cg={point:{x:0,y:-1,z:1},normal:{x:1,y:0,z:0}},ug={point:{x:0,y:1,z:1},normal:{x:1,y:0,z:0}},dg={point:{x:1,y:0,z:1},normal:{x:0,y:1,z:0}},hg={point:{x:1,y:-1,z:0},normal:{x:0,y:0,z:1}},fg={point:{x:0,y:-1,z:-1},normal:{x:1,y:0,z:0}},pg={point:{x:-1,y:1,z:0},normal:{x:0,y:0,z:1}},mg={point:{x:-1,y:0,z:-1},normal:{x:0,y:1,z:0}},MA=(t,e,n,r)=>{const o=xr(t.state.position,t.aabb),s=n.x<0,i=n.y<0,a=n.z>0;if((s||i)&&xt(e,o.bottomCentre,{x:0,y:-1})<qi)return ag;if((s||a)&&xt(e,o.topRight,{x:2,y:-1})<qi)return lg;if((i||a)&&xt(e,o.topLeft,{x:2,y:1})<qi)return cg;switch(!0){case a:{const l=o.c111;if(xt(e,l,{x:2,y:1})<Jn)return ug;if(xt(e,l,{x:-2,y:1})<Jn)return dg;break}case i:{const l=o.c100;if(xt(e,l,{x:0,y:-1})<Jn)return hg;if(xt(e,l,{x:2,y:1})<Jn)return fg;break}case s:{const l=o.c010;if(xt(e,l,{x:0,y:-1})<Jn)return pg;if(xt(e,l,{x:-2,y:1})<Jn)return mg;break}}},Id=(t,e,n)=>n?{position:t.state.position,aabb:t.aabb}:{position:B(t.state.position,t.renderAabbOffset??de),aabb:t.renderAabb??t.aabb},Od=({x:t,y:e},n,r)=>{const{bottomCentre:o,topLeft:s,topRight:i}=xr(n,r);return!(t<s.x||t>i.x||e<i.y-(i.x-t)/2||e<s.y-(t-s.x)/2||e>o.y-(t-o.x)/2||e>o.y-(o.x-t)/2)},LA=(t,e,n)=>{const{position:r,aabb:o}=Id(n,e,!1);if(Od(t,r,o))return"intersects-rendered";if(e.type==="item"&&n.type==="wall"){const{position:i,aabb:a}=Id(n,e,!0);if(Od(t,i,a))return"intersects-unrendered"}return"non-intersecting"},jd=t=>t.fixedZIndex!==void 0,BA=t=>{const n=t.some(([,a])=>a==="intersects-rendered")?t.filter(([,a])=>a==="intersects-rendered").map(([a])=>a):t.map(([a])=>a);if(n.every(jd))return n.toSorted((a,l)=>l.fixedZIndex-a.fixedZIndex).at(0);const r=n.filter(a=>!jd(a));if(r.length===0)return;if(r.length===1)return r[0];const o=Object.fromEntries(r.map(a=>[a.id,a])),s=Xm(o),{order:i}=Fl(s,o);return o[i[0]]},gg=(t,e,n,r)=>{const o=!r||n.type==="item"&&n.item.type==="door",s=o?V.w:V.w/2,i=V.h,a=o?0:s/2,l=i/2,c=Zd(e);return{x:c==="yz"?Math.round(t.x/s)*s:Math.floor((t.x-a)/s)*s,y:c==="xz"?Math.round(t.y/s)*s:Math.floor((t.y-a)/s)*s,z:c==="xy"?Math.round(t.z/i)*i:Math.floor((t.z+l)/i)*i}},FA=({state:{position:t},aabb:e},n,r,o,s)=>{const i={x:t.x+(n.x<0?0:e.x),y:t.y+(n.y<0?0:e.y),z:t.z+(n.z<0?0:e.z)},a=vE(i,n,r);return gg(a,n,o,s)},UA=t=>e=>{const n=mr(e);return t.type==="item"&&t.item.type==="door"?n&&e.type==="wall":n},Vi=(t,e,n,r)=>{const o=Ie(e.items).filter(UA(n)).map(a=>[a,LA(t,n,a)]).filter(a=>a[1]!=="non-intersecting"),s=BA(Array.from(o)),i=e.id;if(s){const a=NA(s,t,n);if(!(a.z>0&&!Object.isExtensible(s.state.stoodOnBy)))return{roomId:i,scrXy:t,world:{itemId:s.id,onItem:{face:a,corner:DA(s,t),edge:MA(s,t,a)},position:FA(s,a,t,n,r)}}}return{roomId:i,scrXy:t,world:void 0}},HA=(t,e=console.error)=>(...n)=>{try{return t(...n)}catch(r){e(r);return}},WA=t=>fh(e=>e>0?e:e>-1?1:-e+1,t),GA=({jsonItem:t,blockDragAccVec:e,resizeEdgeDirection:n})=>{const r=t.position,o=iv(t),s=cs(e,n,hh(t)),i=B(o,s),a=WA(i),l=fh((c,u,d,f,p)=>{const g=u<1;return c<0!==g?g?d-p+1:d+f-p:g?d+f-1:d},n,i,r,o,a);return{timesDelta:fr(a,o),positionDelta:fr(l,r)}},Ki=(t,e)=>{const n=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const r=e.target.getBoundingClientRect(),o=e.clientX-r.left,s=e.clientY-r.top;return{x:o/n-t.gameEngineScreenSize.x/2,y:s/n-t.gameEngineScreenSize.y+16}},qA=(t,e)=>{const n=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const r=e.movementX,o=e.movementY;return{x:r/n,y:o/n}},VA=5,KA=(t,e,n)=>{const r=t.world?.onItem.edge,o=cs(...vt(n).map(i=>hh(i))),s=cs(r?.point??de,o);return rh(s)>0?r.normal:e?{x:1,y:0,z:0}:{x:0,y:0,z:1}},XA=(t,e,n,r,o,s)=>{if(t===void 0)return;const i=vn(e,t.scrXy),a=el(i);if(!(o||a>VA))return;const c=KA(t,r,s),u=Dm(c,n);return r?{x:0,y:0,z:u.z}:u},$d=(t,e=!1)=>{const n=U.getState().levelEditor;return gg(t,{x:0,y:0,z:1},n.tool,!e&&n.halfGridResolution)},Vo=({levelEditor:t},e,n)=>{const r=e.items[n]?.jsonItemId;if(r===void 0)return;const o=mh(t,r);if(o!==void 0)return[r,o]},ss=(t,...e)=>t.levelEditor.wallsFloorsLocked&&e.some(n=>n.type==="wall"||n.type==="floor"),Xi=(t,e)=>{const n=U.getState();let r;if(e.world){const o=e.world.itemId,s=o&&t.items[o],i=ss(n,s)?void 0:s.jsonItemId;r=i===void 0?void 0:{jsonItemId:i,pointingAtOnItem:e.world.onItem}}else r=void 0;Ge(dh(n),r)||U.dispatch(ph(r))},JA=(t,e,n)=>{const r=n?.world?.itemId;if(r===void 0)return us;const o=e.items[r].jsonItemId;if(o===void 0)return us;const{selectedJsonItemIds:s}=t.levelEditor;return s.includes(o)?s:[o]},YA=t=>{const e=Nn(),n=Rn(tl),r=He(),o=Um(),s=m.useRef(void 0),i=m.useRef(void 0),a=m.useRef(void 0);m.useEffect(()=>{if(t===null)return;const l=p=>{const g=Ki(n,p),y=qA(n,p),v=U.getState(),w=mn(v),_=Vi(g,o,w,v.levelEditor.halfGridResolution),x=!Ge(_.world,s.current?.world);switch(w.type){case"item":{if(!x||(r(sa()),_.world===void 0))break;const b=Vo(v,o,_.world.itemId);if(b===void 0)break;const[,C]=b,k=Ad(_,o,w.item);if(k===void 0||ZE({roomState:o,blockPosition:k,itemTool:w.item}))break;r(ec({blockPosition:k,pointedAtItemJson:C,preview:!0}));break}case"pointer":{const b=JA(v,o,i.current);if(b.length===0){Xi(o,_);break}const C=b.map(Z=>cv(v,Z));if(ss(v,...C))break;const S=_.roomId===i.current?.roomId?XA(i.current,g,y,p.metaKey||p.shiftKey,a.current!==void 0,C):void 0;if(!S){Xi(o,_);break}b.length===1&&!uv(v,b[0])&&U.dispatch(ei({jsonItemIds:b}));const $=i.current?.world?.onItem.edge,H=$&&C.every(Z=>gh(Z)),D=a.current??de,q=B(D,S),O=$d(q,H);if(a.current=q,Za($d(D,H),O))break;const ee=rs(O);let M,K;if(H){const[,Z]=Vo(v,o,i.current.world.itemId);({timesDelta:K,positionDelta:M}=GA({jsonItem:Z,blockDragAccVec:ee,resizeEdgeDirection:$.point}))}else M=ee;if(Gm({roomState:o,jsonItemIds:b,blockPositionDelta:M,timesDelta:K}))break;r(ih({jsonItemIds:b,positionDelta:M,timesDelta:K}));break}case"eyeDropper":Xi(o,_);break}s.current=_},c=p=>{const g=U.getState();if(o.id!==g.levelEditor.currentlyEditingRoomId)return;const y=Ki(n,p),v=mn(U.getState()),w=Vi(y,o,v,g.levelEditor.halfGridResolution),_=a.current!==void 0,x=!_&&w.roomId===i.current?.roomId&&w.world?.itemId===i.current?.world?.itemId;if(a.current=void 0,i.current=void 0,U.dispatch(av(!1)),!x&&!_){console.log("mouseUp - not a click or drag end - skipping");return}switch(v.type){case"item":{if(w.world===void 0){r(wn({type:"pointer"}));break}const b=Vo(g,o,w.world.itemId);if(b===void 0)break;const[,C]=b;r(ec({blockPosition:Ad(w,o,v.item),pointedAtItemJson:C,preview:!1}));break}case"pointer":{if(x){const b=w.world===void 0?void 0:o.items[w.world.itemId];if(b?.jsonItemId===void 0||ss(g,b)){r(ei({jsonItemIds:[]}));break}r(p.ctrlKey||p.metaKey?lv({jsonItemId:b.jsonItemId}):ei({jsonItemIds:[b.jsonItemId]}))}else _&&r(ah());break}case"eyeDropper":{if(x){const b=w.world?.itemId;if(b===void 0){console.warn("no itemId");break}const C=o.items[b];if(ss(g,C))break;const k=Vo(g,o,b);if(k===void 0)break;const[,S]=k;r(wn({type:"item",item:{type:S.type,config:S.config}}))}break}}},u=p=>{const g=mn(U.getState());switch(a.current=void 0,i.current=void 0,g.type){case"item":{r(sa());break}case"pointer":{r(ph(void 0));break}}},d=p=>{const g=Ki(n,p),y=U.getState(),v=mn(y),w=Vi(g,o,v,y.levelEditor.halfGridResolution);console.log("setting mouseDownPointingAtRef to",w),i.current=w},f=HA(l);return t.addEventListener("mousemove",f),t.addEventListener("mouseup",c),t.addEventListener("mousedown",d),t.addEventListener("mouseleave",u),t.tabIndex=0,()=>{t.removeEventListener("mousemove",f),t.removeEventListener("mouseup",c),t.removeEventListener("mousedown",d),t.removeEventListener("mouseleave",u)}},[e.stage,n,t,r,o])},ZA=()=>{const{cssUpscale:t,canvasSize:e,rotate90:n}=Rn(tl);return{transform:n?`scale(${t}) rotate(90deg) translate(0, -${e.y}px)`:`scale(${t})`,width:e.x,height:e.y,transformOrigin:"top left"}},QA=t=>{const e=Hm(),n=Nn();m.useEffect(()=>{let r=0;const o=({deltaMS:s})=>{if(t.destroyed)return;t.renderContext.room!==e&&console.warn("room renderer does not have the current room");const i=new Set(ls(e.items));e.roomTime+=s,t.tick({deltaMS:s,movedItems:i,progression:r++}),n.render()};return nr.shared.add(o),()=>{nr.shared.remove(o)}},[t,e,n])},eR=t=>{const e=Nn();m.useEffect(()=>{if(t)return t.appendChild(e.canvas),()=>{t.removeChild(e.canvas)}},[t,e])},tR=()=>{const t=Nn(),e=Rn(n=>n.upscale.upscale.gameEngineUpscale);t.stage.scale=e},nR=()=>{const t=Nn(),e=Rn(yy);m.useEffect(()=>{t.renderer?.resize(e.x,e.y)},[t.renderer,e])},rR=t=>{const e=Nn(),[n]=m.useState(()=>new oe),r=Rn(vy);m.useEffect(()=>{if(t.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return n.addChild(t.output.graphics),e.stage.addChild(n),()=>{e.stage.removeChild(n),n.removeChild(t.output.graphics)}},[t,e,n]),m.useEffect(()=>{n.x=r.x/2,n.y=r.y-16},[n,r])},Nd=(t,e)=>{U.dispatch(wy(by(t??xy(U.getState()),e)))},oR=(t,e)=>{const n=He();m.useLayoutEffect(()=>{Nd()},[]),m.useLayoutEffect(()=>{const r=()=>Nd(t,e);if(e){const o=new ResizeObserver(r);return o.observe(e),()=>o.disconnect()}else return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[n,e,t])},sR=()=>{m.useEffect(()=>_y({actionCreator:wn,effect(t,{dispatch:e}){e(sa())}}))},iR=({levelEditor:t})=>{const{dragInProgress:e,clickableAnnotationHovered:n,hoveredItem:r,selectedJsonItemIds:o}=t;if(e)return ge("cursor-grabbing");if(n)return ge("cursor-pointer");if(r){const s=mh(t,r.jsonItemId);if(s!==void 0&&gh(s))if(r.pointingAtOnItem.corner){if(Za(r.pointingAtOnItem.corner,{x:1,y:1,z:1}))return ge("cursor-n-resize")}else{const{edge:i}=r.pointingAtOnItem;if(i){if(Ge(i,pg))return ge("cursor-e-resize");if(Ge(i,ag))return ge("cursor-s-resize");if(Ge(i,hg))return ge("cursor-w-resize");if(Ge(i,lg)||Ge(i,ug))return ge("cursor-ne-resize");if(Ge(i,cg)||Ge(i,dg))return ge("cursor-nw-resize");if(Ge(i,mg))return ge("cursor-se-resize");if(Ge(i,fg))return ge("cursor-sw-resize")}}return o.includes(r.jsonItemId)?ge("cursor-grab"):ge("cursor-default")}return ge("cursor-crosshair")},aR=()=>he(iR);Sy.defaultOptions.scaleMode="nearest";const lR=()=>{const t=OA(),[e,n]=m.useState(null),[r,o]=m.useState(null),s=aR();oR("amigaLowResPal",r??void 0),nR(),rR(t),QA(t),YA(e),eR(e),tR(),sR();const i=ZA();return h.jsx("div",{className:`w-full h-full overflow-hidden ${s}`,ref:o,children:h.jsx("div",{style:i,ref:n})})},zd=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,cR=()=>{const t=Cy(),e=Rn(ky);m.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",Ey())},[]),m.useEffect(()=>{document.body.classList.remove(...Object.keys(Py).map(zd)),document.body.classList.add(zd(t)),document.body.classList.toggle("portrait-rot",e)},[t,e])},Ks=m.createContext(null);Ks.displayName="PanelGroupContext";const we={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},Gl=10,yn=m.useLayoutEffect,Dd=Ss.useId,uR=typeof Dd=="function"?Dd:()=>null;let dR=0;function ql(t=null){const e=uR(),n=m.useRef(t||e||null);return n.current===null&&(n.current=""+dR++),t??n.current}function yg({children:t,className:e="",collapsedSize:n,collapsible:r,defaultSize:o,forwardedRef:s,id:i,maxSize:a,minSize:l,onCollapse:c,onExpand:u,onResize:d,order:f,style:p,tagName:g="div",...y}){const v=m.useContext(Ks);if(v===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:w,expandPanel:_,getPanelSize:x,getPanelStyle:b,groupId:C,isPanelCollapsed:k,reevaluatePanelConstraints:S,registerPanel:$,resizePanel:H,unregisterPanel:D}=v,q=ql(i),O=m.useRef({callbacks:{onCollapse:c,onExpand:u,onResize:d},constraints:{collapsedSize:n,collapsible:r,defaultSize:o,maxSize:a,minSize:l},id:q,idIsFromProps:i!==void 0,order:f});m.useRef({didLogMissingDefaultSizeWarning:!1}),yn(()=>{const{callbacks:M,constraints:K}=O.current,X={...K};O.current.id=q,O.current.idIsFromProps=i!==void 0,O.current.order=f,M.onCollapse=c,M.onExpand=u,M.onResize=d,K.collapsedSize=n,K.collapsible=r,K.defaultSize=o,K.maxSize=a,K.minSize=l,(X.collapsedSize!==K.collapsedSize||X.collapsible!==K.collapsible||X.maxSize!==K.maxSize||X.minSize!==K.minSize)&&S(O.current,X)}),yn(()=>{const M=O.current;return $(M),()=>{D(M)}},[f,q,$,D]),m.useImperativeHandle(s,()=>({collapse:()=>{w(O.current)},expand:M=>{_(O.current,M)},getId(){return q},getSize(){return x(O.current)},isCollapsed(){return k(O.current)},isExpanded(){return!k(O.current)},resize:M=>{H(O.current,M)}}),[w,_,x,k,q,H]);const ee=b(O.current,o);return m.createElement(g,{...y,children:t,className:e,id:q,style:{...ee,...p},[we.groupId]:C,[we.panel]:"",[we.panelCollapsible]:r||void 0,[we.panelId]:q,[we.panelSize]:parseFloat(""+ee.flexGrow).toFixed(1)})}const is=m.forwardRef((t,e)=>m.createElement(yg,{...t,forwardedRef:e}));yg.displayName="Panel";is.displayName="forwardRef(Panel)";let qa=null,as=-1,Ht=null;function hR(t,e){if(e){const n=(e&_g)!==0,r=(e&Sg)!==0,o=(e&Cg)!==0,s=(e&kg)!==0;if(n)return o?"se-resize":s?"ne-resize":"e-resize";if(r)return o?"sw-resize":s?"nw-resize":"w-resize";if(o)return"s-resize";if(s)return"n-resize"}switch(t){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function fR(){Ht!==null&&(document.head.removeChild(Ht),qa=null,Ht=null,as=-1)}function Ji(t,e){var n,r;const o=hR(t,e);if(qa!==o){if(qa=o,Ht===null&&(Ht=document.createElement("style"),document.head.appendChild(Ht)),as>=0){var s;(s=Ht.sheet)===null||s===void 0||s.removeRule(as)}as=(n=(r=Ht.sheet)===null||r===void 0?void 0:r.insertRule(`*{cursor: ${o} !important;}`))!==null&&n!==void 0?n:-1}}function vg(t){return t.type==="keydown"}function wg(t){return t.type.startsWith("pointer")}function bg(t){return t.type.startsWith("mouse")}function Xs(t){if(wg(t)){if(t.isPrimary)return{x:t.clientX,y:t.clientY}}else if(bg(t))return{x:t.clientX,y:t.clientY};return{x:1/0,y:1/0}}function pR(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function mR(t,e,n){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function gR(t,e){if(t===e)throw new Error("Cannot compare node with itself");const n={a:Bd(t),b:Bd(e)};let r;for(;n.a.at(-1)===n.b.at(-1);)t=n.a.pop(),e=n.b.pop(),r=t;ne(r,"Stacking order can only be calculated for elements with a common ancestor");const o={a:Ld(Md(n.a)),b:Ld(Md(n.b))};if(o.a===o.b){const s=r.childNodes,i={a:n.a.at(-1),b:n.b.at(-1)};let a=s.length;for(;a--;){const l=s[a];if(l===i.a)return 1;if(l===i.b)return-1}}return Math.sign(o.a-o.b)}const yR=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function vR(t){var e;const n=getComputedStyle((e=xg(t))!==null&&e!==void 0?e:t).display;return n==="flex"||n==="inline-flex"}function wR(t){const e=getComputedStyle(t);return!!(e.position==="fixed"||e.zIndex!=="auto"&&(e.position!=="static"||vR(t))||+e.opacity<1||"transform"in e&&e.transform!=="none"||"webkitTransform"in e&&e.webkitTransform!=="none"||"mixBlendMode"in e&&e.mixBlendMode!=="normal"||"filter"in e&&e.filter!=="none"||"webkitFilter"in e&&e.webkitFilter!=="none"||"isolation"in e&&e.isolation==="isolate"||yR.test(e.willChange)||e.webkitOverflowScrolling==="touch")}function Md(t){let e=t.length;for(;e--;){const n=t[e];if(ne(n,"Missing node"),wR(n))return n}return null}function Ld(t){return t&&Number(getComputedStyle(t).zIndex)||0}function Bd(t){const e=[];for(;t;)e.push(t),t=xg(t);return e}function xg(t){const{parentNode:e}=t;return e&&e instanceof ShadowRoot?e.host:e}const _g=1,Sg=2,Cg=4,kg=8,bR=pR()==="coarse";let ot=[],hr=!1,Wt=new Map,Js=new Map;const ao=new Set;function xR(t,e,n,r,o){var s;const{ownerDocument:i}=e,a={direction:n,element:e,hitAreaMargins:r,setResizeHandlerState:o},l=(s=Wt.get(i))!==null&&s!==void 0?s:0;return Wt.set(i,l+1),ao.add(a),xs(),function(){var u;Js.delete(t),ao.delete(a);const d=(u=Wt.get(i))!==null&&u!==void 0?u:1;if(Wt.set(i,d-1),xs(),d===1&&Wt.delete(i),ot.includes(a)){const f=ot.indexOf(a);f>=0&&ot.splice(f,1),Kl(),o("up",!0,null)}}}function _R(t){const{target:e}=t,{x:n,y:r}=Xs(t);hr=!0,Vl({target:e,x:n,y:r}),xs(),ot.length>0&&(_s("down",t),t.preventDefault(),Eg(e)||t.stopImmediatePropagation())}function Yi(t){const{x:e,y:n}=Xs(t);if(hr&&t.buttons===0&&(hr=!1,_s("up",t)),!hr){const{target:r}=t;Vl({target:r,x:e,y:n})}_s("move",t),Kl(),ot.length>0&&t.preventDefault()}function Zi(t){const{target:e}=t,{x:n,y:r}=Xs(t);Js.clear(),hr=!1,ot.length>0&&(t.preventDefault(),Eg(e)||t.stopImmediatePropagation()),_s("up",t),Vl({target:e,x:n,y:r}),Kl(),xs()}function Eg(t){let e=t;for(;e;){if(e.hasAttribute(we.resizeHandle))return!0;e=e.parentElement}return!1}function Vl({target:t,x:e,y:n}){ot.splice(0);let r=null;(t instanceof HTMLElement||t instanceof SVGElement)&&(r=t),ao.forEach(o=>{const{element:s,hitAreaMargins:i}=o,a=s.getBoundingClientRect(),{bottom:l,left:c,right:u,top:d}=a,f=bR?i.coarse:i.fine;if(e>=c-f&&e<=u+f&&n>=d-f&&n<=l+f){if(r!==null&&document.contains(r)&&s!==r&&!s.contains(r)&&!r.contains(s)&&gR(r,s)>0){let g=r,y=!1;for(;g&&!g.contains(s);){if(mR(g.getBoundingClientRect(),a)){y=!0;break}g=g.parentElement}if(y)return}ot.push(o)}})}function Qi(t,e){Js.set(t,e)}function Kl(){let t=!1,e=!1;ot.forEach(r=>{const{direction:o}=r;o==="horizontal"?t=!0:e=!0});let n=0;Js.forEach(r=>{n|=r}),t&&e?Ji("intersection",n):t?Ji("horizontal",n):e?Ji("vertical",n):fR()}let ea;function xs(){var t;(t=ea)===null||t===void 0||t.abort(),ea=new AbortController;const e={capture:!0,signal:ea.signal};ao.size&&(hr?(ot.length>0&&Wt.forEach((n,r)=>{const{body:o}=r;n>0&&(o.addEventListener("contextmenu",Zi,e),o.addEventListener("pointerleave",Yi,e),o.addEventListener("pointermove",Yi,e))}),Wt.forEach((n,r)=>{const{body:o}=r;o.addEventListener("pointerup",Zi,e),o.addEventListener("pointercancel",Zi,e)})):Wt.forEach((n,r)=>{const{body:o}=r;n>0&&(o.addEventListener("pointerdown",_R,e),o.addEventListener("pointermove",Yi,e))}))}function _s(t,e){ao.forEach(n=>{const{setResizeHandlerState:r}=n,o=ot.includes(n);r(t,o,e)})}function SR(){const[t,e]=m.useState(0);return m.useCallback(()=>e(n=>n+1),[])}function ne(t,e){if(!t)throw console.error(e),Error(e)}function Tn(t,e,n=Gl){return t.toFixed(n)===e.toFixed(n)?0:t>e?1:-1}function Pt(t,e,n=Gl){return Tn(t,e,n)===0}function qe(t,e,n){return Tn(t,e,n)===0}function CR(t,e,n){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const o=t[r],s=e[r];if(!qe(o,s,n))return!1}return!0}function ir({panelConstraints:t,panelIndex:e,size:n}){const r=t[e];ne(r!=null,`Panel constraints not found for index ${e}`);let{collapsedSize:o=0,collapsible:s,maxSize:i=100,minSize:a=0}=r;if(Tn(n,a)<0)if(s){const l=(o+a)/2;Tn(n,l)<0?n=o:n=a}else n=a;return n=Math.min(i,n),n=parseFloat(n.toFixed(Gl)),n}function Gr({delta:t,initialLayout:e,panelConstraints:n,pivotIndices:r,prevLayout:o,trigger:s}){if(qe(t,0))return e;const i=[...e],[a,l]=r;ne(a!=null,"Invalid first pivot index"),ne(l!=null,"Invalid second pivot index");let c=0;if(s==="keyboard"){{const d=t<0?l:a,f=n[d];ne(f,`Panel constraints not found for index ${d}`);const{collapsedSize:p=0,collapsible:g,minSize:y=0}=f;if(g){const v=e[d];if(ne(v!=null,`Previous layout not found for panel index ${d}`),qe(v,p)){const w=y-v;Tn(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}{const d=t<0?a:l,f=n[d];ne(f,`No panel constraints found for index ${d}`);const{collapsedSize:p=0,collapsible:g,minSize:y=0}=f;if(g){const v=e[d];if(ne(v!=null,`Previous layout not found for panel index ${d}`),qe(v,y)){const w=v-p;Tn(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}}{const d=t<0?1:-1;let f=t<0?l:a,p=0;for(;;){const y=e[f];ne(y!=null,`Previous layout not found for panel index ${f}`);const w=ir({panelConstraints:n,panelIndex:f,size:100})-y;if(p+=w,f+=d,f<0||f>=n.length)break}const g=Math.min(Math.abs(t),Math.abs(p));t=t<0?0-g:g}{let f=t<0?a:l;for(;f>=0&&f<n.length;){const p=Math.abs(t)-Math.abs(c),g=e[f];ne(g!=null,`Previous layout not found for panel index ${f}`);const y=g-p,v=ir({panelConstraints:n,panelIndex:f,size:y});if(!qe(g,v)&&(c+=g-v,i[f]=v,c.toPrecision(3).localeCompare(Math.abs(t).toPrecision(3),void 0,{numeric:!0})>=0))break;t<0?f--:f++}}if(CR(o,i))return o;{const d=t<0?l:a,f=e[d];ne(f!=null,`Previous layout not found for panel index ${d}`);const p=f+c,g=ir({panelConstraints:n,panelIndex:d,size:p});if(i[d]=g,!qe(g,p)){let y=p-g,w=t<0?l:a;for(;w>=0&&w<n.length;){const _=i[w];ne(_!=null,`Previous layout not found for panel index ${w}`);const x=_+y,b=ir({panelConstraints:n,panelIndex:w,size:x});if(qe(_,b)||(y-=b-_,i[w]=b),qe(y,0))break;t>0?w--:w++}}}const u=i.reduce((d,f)=>f+d,0);return qe(u,100)?i:o}function kR({layout:t,panelsArray:e,pivotIndices:n}){let r=0,o=100,s=0,i=0;const a=n[0];ne(a!=null,"No pivot index found"),e.forEach((d,f)=>{const{constraints:p}=d,{maxSize:g=100,minSize:y=0}=p;f===a?(r=y,o=g):(s+=y,i+=g)});const l=Math.min(o,100-s),c=Math.max(r,100-i),u=t[a];return{valueMax:l,valueMin:c,valueNow:u}}function lo(t,e=document){return Array.from(e.querySelectorAll(`[${we.resizeHandleId}][data-panel-group-id="${t}"]`))}function Pg(t,e,n=document){const o=lo(t,n).findIndex(s=>s.getAttribute(we.resizeHandleId)===e);return o??null}function Tg(t,e,n){const r=Pg(t,e,n);return r!=null?[r,r+1]:[-1,-1]}function ER(t){return t instanceof HTMLElement?!0:typeof t=="object"&&t!==null&&"tagName"in t&&"getAttribute"in t}function Ag(t,e=document){if(ER(e)&&e.dataset.panelGroupId==t)return e;const n=e.querySelector(`[data-panel-group][data-panel-group-id="${t}"]`);return n||null}function Ys(t,e=document){const n=e.querySelector(`[${we.resizeHandleId}="${t}"]`);return n||null}function PR(t,e,n,r=document){var o,s,i,a;const l=Ys(e,r),c=lo(t,r),u=l?c.indexOf(l):-1,d=(o=(s=n[u])===null||s===void 0?void 0:s.id)!==null&&o!==void 0?o:null,f=(i=(a=n[u+1])===null||a===void 0?void 0:a.id)!==null&&i!==void 0?i:null;return[d,f]}function TR({committedValuesRef:t,eagerValuesRef:e,groupId:n,layout:r,panelDataArray:o,panelGroupElement:s,setLayout:i}){m.useRef({didWarnAboutMissingResizeHandle:!1}),yn(()=>{if(!s)return;const a=lo(n,s);for(let l=0;l<o.length-1;l++){const{valueMax:c,valueMin:u,valueNow:d}=kR({layout:r,panelsArray:o,pivotIndices:[l,l+1]}),f=a[l];if(f!=null){const p=o[l];ne(p,`No panel data found for index "${l}"`),f.setAttribute("aria-controls",p.id),f.setAttribute("aria-valuemax",""+Math.round(c)),f.setAttribute("aria-valuemin",""+Math.round(u)),f.setAttribute("aria-valuenow",d!=null?""+Math.round(d):"")}}return()=>{a.forEach((l,c)=>{l.removeAttribute("aria-controls"),l.removeAttribute("aria-valuemax"),l.removeAttribute("aria-valuemin"),l.removeAttribute("aria-valuenow")})}},[n,r,o,s]),m.useEffect(()=>{if(!s)return;const a=e.current;ne(a,"Eager values not found");const{panelDataArray:l}=a,c=Ag(n,s);ne(c!=null,`No group found for id "${n}"`);const u=lo(n,s);ne(u,`No resize handles found for group id "${n}"`);const d=u.map(f=>{const p=f.getAttribute(we.resizeHandleId);ne(p,"Resize handle element has no handle id attribute");const[g,y]=PR(n,p,l,s);if(g==null||y==null)return()=>{};const v=w=>{if(!w.defaultPrevented)switch(w.key){case"Enter":{w.preventDefault();const _=l.findIndex(x=>x.id===g);if(_>=0){const x=l[_];ne(x,`No panel data found for index ${_}`);const b=r[_],{collapsedSize:C=0,collapsible:k,minSize:S=0}=x.constraints;if(b!=null&&k){const $=Gr({delta:qe(b,C)?S-C:C-b,initialLayout:r,panelConstraints:l.map(H=>H.constraints),pivotIndices:Tg(n,p,s),prevLayout:r,trigger:"keyboard"});r!==$&&i($)}}break}}};return f.addEventListener("keydown",v),()=>{f.removeEventListener("keydown",v)}});return()=>{d.forEach(f=>f())}},[s,t,e,n,r,o,i])}function Fd(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Rg(t,e){const n=t==="horizontal",{x:r,y:o}=Xs(e);return n?r:o}function AR(t,e,n,r,o){const s=n==="horizontal",i=Ys(e,o);ne(i,`No resize handle element found for id "${e}"`);const a=i.getAttribute(we.groupId);ne(a,"Resize handle element has no group id attribute");let{initialCursorPosition:l}=r;const c=Rg(n,t),u=Ag(a,o);ne(u,`No group element found for id "${a}"`);const d=u.getBoundingClientRect(),f=s?d.width:d.height;return(c-l)/f*100}function RR(t,e,n,r,o,s){if(vg(t)){const i=n==="horizontal";let a=0;t.shiftKey?a=100:o!=null?a=o:a=10;let l=0;switch(t.key){case"ArrowDown":l=i?0:a;break;case"ArrowLeft":l=i?-a:0;break;case"ArrowRight":l=i?a:0;break;case"ArrowUp":l=i?0:-a;break;case"End":l=100;break;case"Home":l=-100;break}return l}else return r==null?0:AR(t,e,n,r,s)}function IR({panelDataArray:t}){const e=Array(t.length),n=t.map(s=>s.constraints);let r=0,o=100;for(let s=0;s<t.length;s++){const i=n[s];ne(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;a!=null&&(r++,e[s]=a,o-=a)}for(let s=0;s<t.length;s++){const i=n[s];ne(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;if(a!=null)continue;const l=t.length-r,c=o/l;r++,e[s]=c,o-=c}return e}function Yn(t,e,n){e.forEach((r,o)=>{const s=t[o];ne(s,`Panel data not found for index ${o}`);const{callbacks:i,constraints:a,id:l}=s,{collapsedSize:c=0,collapsible:u}=a,d=n[l];if(d==null||r!==d){n[l]=r;const{onCollapse:f,onExpand:p,onResize:g}=i;g&&g(r,d),u&&(f||p)&&(p&&(d==null||Pt(d,c))&&!Pt(r,c)&&p(),f&&(d==null||!Pt(d,c))&&Pt(r,c)&&f())}})}function Ko(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!=e[n])return!1;return!0}function OR({defaultSize:t,dragState:e,layout:n,panelData:r,panelIndex:o,precision:s=3}){const i=n[o];let a;return i==null?a=t!=null?t.toPrecision(s):"1":r.length===1?a="1":a=i.toPrecision(s),{flexBasis:0,flexGrow:a,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function jR(t,e=10){let n=null;return(...o)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{t(...o)},e)}}function Ud(t){try{if(typeof localStorage<"u")t.getItem=e=>localStorage.getItem(e),t.setItem=(e,n)=>{localStorage.setItem(e,n)};else throw new Error("localStorage not supported in this environment")}catch(e){console.error(e),t.getItem=()=>null,t.setItem=()=>{}}}function Ig(t){return`react-resizable-panels:${t}`}function Og(t){return t.map(e=>{const{constraints:n,id:r,idIsFromProps:o,order:s}=e;return o?r:s?`${s}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((e,n)=>e.localeCompare(n)).join(",")}function jg(t,e){try{const n=Ig(t),r=e.getItem(n);if(r){const o=JSON.parse(r);if(typeof o=="object"&&o!=null)return o}}catch{}return null}function $R(t,e,n){var r,o;const s=(r=jg(t,n))!==null&&r!==void 0?r:{},i=Og(e);return(o=s[i])!==null&&o!==void 0?o:null}function NR(t,e,n,r,o){var s;const i=Ig(t),a=Og(e),l=(s=jg(t,o))!==null&&s!==void 0?s:{};l[a]={expandToSizes:Object.fromEntries(n.entries()),layout:r};try{o.setItem(i,JSON.stringify(l))}catch(c){console.error(c)}}function Hd({layout:t,panelConstraints:e}){const n=[...t],r=n.reduce((s,i)=>s+i,0);if(n.length!==e.length)throw Error(`Invalid ${e.length} panel layout: ${n.map(s=>`${s}%`).join(", ")}`);if(!qe(r,100)&&n.length>0)for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=100/r*i;n[s]=a}let o=0;for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=ir({panelConstraints:e,panelIndex:s,size:i});i!=a&&(o+=i-a,n[s]=a)}if(!qe(o,0))for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=i+o,l=ir({panelConstraints:e,panelIndex:s,size:a});if(i!==l&&(o-=l-i,n[s]=l,qe(o,0)))break}return n}const zR=100,qr={getItem:t=>(Ud(qr),qr.getItem(t)),setItem:(t,e)=>{Ud(qr),qr.setItem(t,e)}},Wd={};function $g({autoSaveId:t=null,children:e,className:n="",direction:r,forwardedRef:o,id:s=null,onLayout:i=null,keyboardResizeBy:a=null,storage:l=qr,style:c,tagName:u="div",...d}){const f=ql(s),p=m.useRef(null),[g,y]=m.useState(null),[v,w]=m.useState([]),_=SR(),x=m.useRef({}),b=m.useRef(new Map),C=m.useRef(0),k=m.useRef({autoSaveId:t,direction:r,dragState:g,id:f,keyboardResizeBy:a,onLayout:i,storage:l}),S=m.useRef({layout:v,panelDataArray:[],panelDataArrayChanged:!1});m.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),m.useImperativeHandle(o,()=>({getId:()=>k.current.id,getLayout:()=>{const{layout:E}=S.current;return E},setLayout:E=>{const{onLayout:R}=k.current,{layout:T,panelDataArray:I}=S.current,A=Hd({layout:E,panelConstraints:I.map(z=>z.constraints)});Fd(T,A)||(w(A),S.current.layout=A,R&&R(A),Yn(I,A,x.current))}}),[]),yn(()=>{k.current.autoSaveId=t,k.current.direction=r,k.current.dragState=g,k.current.id=f,k.current.onLayout=i,k.current.storage=l}),TR({committedValuesRef:k,eagerValuesRef:S,groupId:f,layout:v,panelDataArray:S.current.panelDataArray,setLayout:w,panelGroupElement:p.current}),m.useEffect(()=>{const{panelDataArray:E}=S.current;if(t){if(v.length===0||v.length!==E.length)return;let R=Wd[t];R==null&&(R=jR(NR,zR),Wd[t]=R);const T=[...E],I=new Map(b.current);R(t,T,I,v,l)}},[t,v,l]),m.useEffect(()=>{});const $=m.useCallback(E=>{const{onLayout:R}=k.current,{layout:T,panelDataArray:I}=S.current;if(E.constraints.collapsible){const A=I.map(Ne=>Ne.constraints),{collapsedSize:z=0,panelSize:re,pivotIndices:le}=cn(I,E,T);if(ne(re!=null,`Panel size not found for panel "${E.id}"`),!Pt(re,z)){b.current.set(E.id,re);const ze=tr(I,E)===I.length-1?re-z:z-re,ae=Gr({delta:ze,initialLayout:T,panelConstraints:A,pivotIndices:le,prevLayout:T,trigger:"imperative-api"});Ko(T,ae)||(w(ae),S.current.layout=ae,R&&R(ae),Yn(I,ae,x.current))}}},[]),H=m.useCallback((E,R)=>{const{onLayout:T}=k.current,{layout:I,panelDataArray:A}=S.current;if(E.constraints.collapsible){const z=A.map(Ye=>Ye.constraints),{collapsedSize:re=0,panelSize:le=0,minSize:Ne=0,pivotIndices:ze}=cn(A,E,I),ae=R??Ne;if(Pt(le,re)){const Ye=b.current.get(E.id),Rr=Ye!=null&&Ye>=ae?Ye:ae,Zs=tr(A,E)===A.length-1?le-Rr:Rr-le,De=Gr({delta:Zs,initialLayout:I,panelConstraints:z,pivotIndices:ze,prevLayout:I,trigger:"imperative-api"});Ko(I,De)||(w(De),S.current.layout=De,T&&T(De),Yn(A,De,x.current))}}},[]),D=m.useCallback(E=>{const{layout:R,panelDataArray:T}=S.current,{panelSize:I}=cn(T,E,R);return ne(I!=null,`Panel size not found for panel "${E.id}"`),I},[]),q=m.useCallback((E,R)=>{const{panelDataArray:T}=S.current,I=tr(T,E);return OR({defaultSize:R,dragState:g,layout:v,panelData:T,panelIndex:I})},[g,v]),O=m.useCallback(E=>{const{layout:R,panelDataArray:T}=S.current,{collapsedSize:I=0,collapsible:A,panelSize:z}=cn(T,E,R);return ne(z!=null,`Panel size not found for panel "${E.id}"`),A===!0&&Pt(z,I)},[]),ee=m.useCallback(E=>{const{layout:R,panelDataArray:T}=S.current,{collapsedSize:I=0,collapsible:A,panelSize:z}=cn(T,E,R);return ne(z!=null,`Panel size not found for panel "${E.id}"`),!A||Tn(z,I)>0},[]),M=m.useCallback(E=>{const{panelDataArray:R}=S.current;R.push(E),R.sort((T,I)=>{const A=T.order,z=I.order;return A==null&&z==null?0:A==null?-1:z==null?1:A-z}),S.current.panelDataArrayChanged=!0,_()},[_]);yn(()=>{if(S.current.panelDataArrayChanged){S.current.panelDataArrayChanged=!1;const{autoSaveId:E,onLayout:R,storage:T}=k.current,{layout:I,panelDataArray:A}=S.current;let z=null;if(E){const le=$R(E,A,T);le&&(b.current=new Map(Object.entries(le.expandToSizes)),z=le.layout)}z==null&&(z=IR({panelDataArray:A}));const re=Hd({layout:z,panelConstraints:A.map(le=>le.constraints)});Fd(I,re)||(w(re),S.current.layout=re,R&&R(re),Yn(A,re,x.current))}}),yn(()=>{const E=S.current;return()=>{E.layout=[]}},[]);const K=m.useCallback(E=>{let R=!1;const T=p.current;return T&&window.getComputedStyle(T,null).getPropertyValue("direction")==="rtl"&&(R=!0),function(A){A.preventDefault();const z=p.current;if(!z)return()=>null;const{direction:re,dragState:le,id:Ne,keyboardResizeBy:ze,onLayout:ae}=k.current,{layout:Ye,panelDataArray:Rr}=S.current,{initialLayout:bo}=le??{},Zs=Tg(Ne,E,z);let De=RR(A,E,re,le,ze,z);const Xl=re==="horizontal";Xl&&R&&(De=-De);const zg=Rr.map(Dg=>Dg.constraints),Ir=Gr({delta:De,initialLayout:bo??Ye,panelConstraints:zg,pivotIndices:Zs,prevLayout:Ye,trigger:vg(A)?"keyboard":"mouse-or-touch"}),Jl=!Ko(Ye,Ir);(wg(A)||bg(A))&&C.current!=De&&(C.current=De,!Jl&&De!==0?Xl?Qi(E,De<0?_g:Sg):Qi(E,De<0?Cg:kg):Qi(E,0)),Jl&&(w(Ir),S.current.layout=Ir,ae&&ae(Ir),Yn(Rr,Ir,x.current))}},[]),X=m.useCallback((E,R)=>{const{onLayout:T}=k.current,{layout:I,panelDataArray:A}=S.current,z=A.map(Ye=>Ye.constraints),{panelSize:re,pivotIndices:le}=cn(A,E,I);ne(re!=null,`Panel size not found for panel "${E.id}"`);const ze=tr(A,E)===A.length-1?re-R:R-re,ae=Gr({delta:ze,initialLayout:I,panelConstraints:z,pivotIndices:le,prevLayout:I,trigger:"imperative-api"});Ko(I,ae)||(w(ae),S.current.layout=ae,T&&T(ae),Yn(A,ae,x.current))},[]),Z=m.useCallback((E,R)=>{const{layout:T,panelDataArray:I}=S.current,{collapsedSize:A=0,collapsible:z}=R,{collapsedSize:re=0,collapsible:le,maxSize:Ne=100,minSize:ze=0}=E.constraints,{panelSize:ae}=cn(I,E,T);ae!=null&&(z&&le&&Pt(ae,A)?Pt(A,re)||X(E,re):ae<ze?X(E,ze):ae>Ne&&X(E,Ne))},[X]),F=m.useCallback((E,R)=>{const{direction:T}=k.current,{layout:I}=S.current;if(!p.current)return;const A=Ys(E,p.current);ne(A,`Drag handle element not found for id "${E}"`);const z=Rg(T,R);y({dragHandleId:E,dragHandleRect:A.getBoundingClientRect(),initialCursorPosition:z,initialLayout:I})},[]),ie=m.useCallback(()=>{y(null)},[]),ve=m.useCallback(E=>{const{panelDataArray:R}=S.current,T=tr(R,E);T>=0&&(R.splice(T,1),delete x.current[E.id],S.current.panelDataArrayChanged=!0,_())},[_]),pe=m.useMemo(()=>({collapsePanel:$,direction:r,dragState:g,expandPanel:H,getPanelSize:D,getPanelStyle:q,groupId:f,isPanelCollapsed:O,isPanelExpanded:ee,reevaluatePanelConstraints:Z,registerPanel:M,registerResizeHandle:K,resizePanel:X,startDragging:F,stopDragging:ie,unregisterPanel:ve,panelGroupElement:p.current}),[$,g,r,H,D,q,f,O,ee,Z,M,K,X,F,ie,ve]),P={display:"flex",flexDirection:r==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return m.createElement(Ks.Provider,{value:pe},m.createElement(u,{...d,children:e,className:n,id:s,ref:p,style:{...P,...c},[we.group]:"",[we.groupDirection]:r,[we.groupId]:f}))}const Ng=m.forwardRef((t,e)=>m.createElement($g,{...t,forwardedRef:e}));$g.displayName="PanelGroup";Ng.displayName="forwardRef(PanelGroup)";function tr(t,e){return t.findIndex(n=>n===e||n.id===e.id)}function cn(t,e,n){const r=tr(t,e),s=r===t.length-1?[r-1,r]:[r,r+1],i=n[r];return{...e.constraints,panelSize:i,pivotIndices:s}}function DR({disabled:t,handleId:e,resizeHandler:n,panelGroupElement:r}){m.useEffect(()=>{if(t||n==null||r==null)return;const o=Ys(e,r);if(o==null)return;const s=i=>{if(!i.defaultPrevented)switch(i.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{i.preventDefault(),n(i);break}case"F6":{i.preventDefault();const a=o.getAttribute(we.groupId);ne(a,`No group element found for id "${a}"`);const l=lo(a,r),c=Pg(a,e,r);ne(c!==null,`No resize element found for id "${e}"`);const u=i.shiftKey?c>0?c-1:l.length-1:c+1<l.length?c+1:0;l[u].focus();break}}};return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}},[r,t,e,n])}function Va({children:t=null,className:e="",disabled:n=!1,hitAreaMargins:r,id:o,onBlur:s,onClick:i,onDragging:a,onFocus:l,onPointerDown:c,onPointerUp:u,style:d={},tabIndex:f=0,tagName:p="div",...g}){var y,v;const w=m.useRef(null),_=m.useRef({onClick:i,onDragging:a,onPointerDown:c,onPointerUp:u});m.useEffect(()=>{_.current.onClick=i,_.current.onDragging=a,_.current.onPointerDown=c,_.current.onPointerUp=u});const x=m.useContext(Ks);if(x===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:b,groupId:C,registerResizeHandle:k,startDragging:S,stopDragging:$,panelGroupElement:H}=x,D=ql(o),[q,O]=m.useState("inactive"),[ee,M]=m.useState(!1),[K,X]=m.useState(null),Z=m.useRef({state:q});yn(()=>{Z.current.state=q}),m.useEffect(()=>{if(n)X(null);else{const pe=k(D);X(()=>pe)}},[n,D,k]);const F=(y=r?.coarse)!==null&&y!==void 0?y:15,ie=(v=r?.fine)!==null&&v!==void 0?v:5;m.useEffect(()=>{if(n||K==null)return;const pe=w.current;ne(pe,"Element ref not attached");let P=!1;return xR(D,pe,b,{coarse:F,fine:ie},(R,T,I)=>{if(!T){O("inactive");return}switch(R){case"down":{O("drag"),P=!1,ne(I,'Expected event to be defined for "down" action'),S(D,I);const{onDragging:A,onPointerDown:z}=_.current;A?.(!0),z?.();break}case"move":{const{state:A}=Z.current;P=!0,A!=="drag"&&O("hover"),ne(I,'Expected event to be defined for "move" action'),K(I);break}case"up":{O("hover"),$();const{onClick:A,onDragging:z,onPointerUp:re}=_.current;z?.(!1),re?.(),P||A?.();break}}})},[F,b,n,ie,k,D,K,S,$]),DR({disabled:n,handleId:D,resizeHandler:K,panelGroupElement:H});const ve={touchAction:"none",userSelect:"none"};return m.createElement(p,{...g,children:t,className:e,id:o,onBlur:()=>{M(!1),s?.()},onFocus:()=>{M(!0),l?.()},ref:w,role:"separator",style:{...ve,...d},tabIndex:f,[we.groupDirection]:b,[we.groupId]:C,[we.resizeHandle]:"",[we.resizeHandleActive]:q==="drag"?"pointer":ee?"keyboard":void 0,[we.resizeHandleEnabled]:!n,[we.resizeHandleId]:D,[we.resizeHandleState]:q})}Va.displayName="PanelResizeHandle";const MR=Ty(()=>qt(()=>import("./JsonRoomEditor-Nfa_NeQk.js").then(t=>t.J),__vite__mapDeps([8,1,2,6,9]))),LR=m.lazy(MR),BR=()=>{cR();const t=h.jsx("div",{className:"flex h-full items-center justify-center bg-pureBlack",children:h.jsx("span",{className:"sprite texture-animated-head_walking_right"})});return h.jsx(h.Fragment,{children:h.jsx(JE,{children:h.jsx(Os,{children:h.jsxs(Ng,{direction:"horizontal",className:"w-full h-full",children:[h.jsx(is,{id:"jsonEditor",defaultSize:18,minSize:12,collapsible:!0,children:h.jsx(m.Suspense,{fallback:t,children:h.jsx(LR,{})})}),h.jsx(Va,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-r-[calc(1px*var(--scale))] border-metallicBlue"}),h.jsx(is,{id:"editingArea",children:h.jsx(RA,{children:h.jsx(lR,{})})}),h.jsx(Va,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-l-[calc(1px*var(--scale))] border-metallicBlue"}),h.jsx(is,{id:"toolbar",defaultSize:20,maxSize:33,minSize:10,children:h.jsx(lS,{children:h.jsx(iP,{})})})]})})})})},nI=Object.freeze(Object.defineProperty({__proto__:null,default:BR},Symbol.toStringTag,{value:"Module"}));export{Eh as A,Sh as C,tn as F,nI as L,sl as R,qv as S,Ph as V,Yv as a,tI as b,XR as h,ge as t,Gv as u};
