import{$ as R,a0 as te,a1 as L,a2 as qe,a3 as Pe,a4 as Ee,a5 as We,a6 as O,a7 as V,a8 as De,a9 as Fe,aa as Je,ab as se,ac as $,ad as K,ae as He,af as Be,ag as z,ah as ae,ai as Le,aj as Ce,ak as Me,al as Ue}from"./index-D7JFJSKA.js";var q={},P={},ce;function Xe(){if(ce)return P;ce=1;function e(d,y){var i;if(typeof Symbol>"u"||d[Symbol.iterator]==null){if(Array.isArray(d)||(i=t(d))||y){i&&(d=i);var a=0,s=function(){};return{s,n:function(){return a>=d.length?{done:!0}:{done:!1,value:d[a++]}},e:function(f){throw f},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l=!0,g=!1,m;return{s:function(){i=d[Symbol.iterator]()},n:function(){var f=i.next();return l=f.done,f},e:function(f){g=!0,m=f},f:function(){try{!l&&i.return!=null&&i.return()}finally{if(g)throw m}}}}function t(d,y){if(d){if(typeof d=="string")return r(d,y);var i=Object.prototype.toString.call(d).slice(8,-1);if(i==="Object"&&d.constructor&&(i=d.constructor.name),i==="Map"||i==="Set")return Array.from(d);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return r(d,y)}}function r(d,y){(y==null||y>d.length)&&(y=d.length);for(var i=0,a=new Array(y);i<y;i++)a[i]=d[i];return a}var n=R(),o=n.ensureIterable;function c(d){var y=[],i=e(d),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;y.push(s)}}catch(l){i.e(l)}finally{i.f()}return y}P.__toArray=c;function u(d){return c(o(d))}return P.toArray=u,P}var le;function Ge(){if(le)return q;le=1;var e=te(),t=e.mark(u),r=R(),n=r.iterableCurry,o=Xe(),c=o.__toArray;function u(y,i){var a;return e.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(a=Array.isArray(y)?y:c(y),a.length){l.next=3;break}return l.abrupt("return");case 3:if(!i--){l.next=7;break}return l.delegateYield(a,"t0",5);case 5:l.next=3;break;case 7:case"end":return l.stop()}},t)}q.__cycleTimes=u;var d=n(u);return q.cycleTimes=d,q}var W={},de;function Ne(){if(de)return W;de=1;var e=R(),t=e.iterableCurry,r=Ge(),n=r.__cycleTimes;function o(u){return n(u,1/0)}W.__cycle=o;var c=t(o);return W.cycle=c,W}var D={},fe;function je(){if(fe)return D;fe=1;var e=te(),t=e.mark(d);function r(i,a){var s;if(typeof Symbol>"u"||i[Symbol.iterator]==null){if(Array.isArray(i)||(s=n(i))||a){s&&(i=s);var l=0,g=function(){};return{s:g,n:function(){return l>=i.length?{done:!0}:{done:!1,value:i[l++]}},e:function(v){throw v},f:g}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,h=!1,f;return{s:function(){s=i[Symbol.iterator]()},n:function(){var v=s.next();return m=v.done,v},e:function(v){h=!0,f=v},f:function(){try{!m&&s.return!=null&&s.return()}finally{if(h)throw f}}}}function n(i,a){if(i){if(typeof i=="string")return o(i,a);var s=Object.prototype.toString.call(i).slice(8,-1);if(s==="Object"&&i.constructor&&(s=i.constructor.name),s==="Map"||s==="Set")return Array.from(i);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return o(i,a)}}function o(i,a){(a==null||a>i.length)&&(a=i.length);for(var s=0,l=new Array(a);s<a;s++)l[s]=i[s];return l}var c=R(),u=c.iterableCurry;function d(i,a){var s,l,g,m;return e.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:s=0,l=r(i),f.prev=2,l.s();case 4:if((g=l.n()).done){f.next=11;break}if(m=g.value,!(s++>=a)){f.next=9;break}return f.next=9,m;case 9:f.next=4;break;case 11:f.next=16;break;case 13:f.prev=13,f.t0=f.catch(2),l.e(f.t0);case 16:return f.prev=16,l.f(),f.finish(16);case 19:case"end":return f.stop()}},t,null,[[2,13,16,19]])}D.__drop=d;var y=u(d);return D.drop=y,D}var F={},J={},ue;function Ve(){if(ue)return J;ue=1;var e=R(),t=e.iterableCurry,r=e.callReturn;function n(c,u){var d=c[Symbol.iterator](),y=d.next(),i=y.value,a=y.done;return a?u:(r(d),i)}J.__firstOr=n;var o=t(n,{reduces:!0});return J.firstOr=o,J}var ye;function Ke(){if(ye)return F;ye=1;var e=R(),t=e.iterableCurry,r=Ve(),n=r.__firstOr;function o(u){return n(u,void 0)}F.__first=o;var c=t(o,{reduces:!0});return F.first=c,F}var H={},pe;function Qe(){if(pe)return H;pe=1;var e=te(),t=e.mark(d);function r(i,a){var s;if(typeof Symbol>"u"||i[Symbol.iterator]==null){if(Array.isArray(i)||(s=n(i))||a){s&&(i=s);var l=0,g=function(){};return{s:g,n:function(){return l>=i.length?{done:!0}:{done:!1,value:i[l++]}},e:function(v){throw v},f:g}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,h=!1,f;return{s:function(){s=i[Symbol.iterator]()},n:function(){var v=s.next();return m=v.done,v},e:function(v){h=!0,f=v},f:function(){try{!m&&s.return!=null&&s.return()}finally{if(h)throw f}}}}function n(i,a){if(i){if(typeof i=="string")return o(i,a);var s=Object.prototype.toString.call(i).slice(8,-1);if(s==="Object"&&i.constructor&&(s=i.constructor.name),s==="Map"||s==="Set")return Array.from(i);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return o(i,a)}}function o(i,a){(a==null||a>i.length)&&(a=i.length);for(var s=0,l=new Array(a);s<a;s++)l[s]=i[s];return l}var c=R(),u=c.iterableCurry;function d(i,a){var s,l,g,m;return e.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(a!==0){f.next=2;break}return f.abrupt("return");case 2:s=0,l=r(i),f.prev=4,l.s();case 6:if((g=l.n()).done){f.next=14;break}return m=g.value,f.next=10,m;case 10:if(++s!==a){f.next=12;break}return f.abrupt("break",14);case 12:f.next=6;break;case 14:f.next=19;break;case 16:f.prev=16,f.t0=f.catch(4),l.e(f.t0);case 19:return f.prev=19,l.f(),f.finish(19);case 22:case"end":return f.stop()}},t,null,[[4,16,19,22]])}H.__take=d;var y=u(d);return H.take=y,H}var X,me;function Ye(){return me||(me=1,X=Ne().cycle),X}var Ze=Ye();const et=L(Ze);var G,ge;function tt(){return ge||(ge=1,G=je().drop),G}var rt=tt();const ot=L(rt);var N,he;function nt(){return he||(he=1,N=Ke().first),N}var it=nt();const st=L(it);var j,ve;function at(){return ve||(ve=1,j=Qe().take),j}var ct=at();const lt=L(ct),dt={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},T=(e,t,r=0)=>{const n=et(dt[e]);return ot(r,lt(t+r,n))},ft=e=>({awayWall:{type:"wall",config:{direction:"away",tiles:Array.from(T("blacktooth",e.x))},position:{x:0,y:e.y,z:0}},leftWall:{type:"wall",config:{direction:"left",tiles:Array.from(T("blacktooth",e.y))},position:{x:e.x,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:e.x}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:e.y}},position:{x:0,y:0,z:0}}}),Ae=e=>({planet:"blacktooth",color:{hue:"cyan",shade:"basic"},size:e,items:{floor:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:e},position:{x:0,y:0,z:0}},...ft(e)}}),w=e=>e.campaignInProgress.rooms[e.currentlyEditingRoomId],Q=(e,t)=>e.campaignInProgress.rooms[t],ze=(e,t,r)=>e.campaignInProgress.rooms[r??e.currentlyEditingRoomId]?.items[t],S=e=>{const t=structuredClone(qe(w(e))),{history:r}=e;r.redo=[],r.undo.push(t)},ut={undo(e){const t=e,{campaignInProgress:r,history:{undo:n,redo:o},currentlyEditingRoomId:c}=t;n.length!==0&&(o.push(r.rooms[c]),r.rooms[c]=n.pop())},redo(e){const t=e,{campaignInProgress:r,history:{redo:n,undo:o},currentlyEditingRoomId:c}=t;n.length!==0&&(o.push(r.rooms[c]),r.rooms[c]=n.pop())}},yt={selectCanUndo:e=>e.history.undo.length>0,selectCanRedo:e=>e.history.redo.length>0},Se=(e,t)=>{e.planet=t;for(const r of Object.values(e.items))r.type==="floor"&&r.config.floorType==="standable"&&(r.config.scenery=t),r.type==="wall"&&(r.config.direction==="away"||r.config.direction==="left")&&(r.config.tiles=Array.from(T(t,r.config.tiles.length))),r.type==="pickup"&&r.config.gives==="crown"&&Pe.includes(t)&&(r.config.planet=t)},_e=(e,t,r)=>{const o=`room_${Ee(We({start:0})).find(u=>e.campaignInProgress.rooms[`room_${u}`]===void 0)}`,c={id:o,...structuredClone(Ae({x:8,y:8})),color:r};return Se(c,t),e.campaignInProgress.rooms[o]=c,c},re=(e,t,r)=>{if(t.type==="player"){const{which:o}=t.config;return r?`preview-${o}`:o}const n=t.type==="monster"?t.config.which:t.type;for(let o=1;;o++){const c=o===1?n:`${n}_${o}`;if(!e.items[c])return c}},Y=(e,t,r,n)=>{const o=w(e),c=re(o,t,n),u=Oe(e,n);u[c]={type:t.type,config:t.config,position:r}},Oe=(e,t,r=e.currentlyEditingRoomId)=>t?e.previewedEdits:e.campaignInProgress.rooms[r].items,Tr={w:16,d:16,h:12},Ie={x:16,y:16,z:12},pt=["head","heels"],mt=[...pt,"headOverHeels"],I=(...e)=>t=>e.includes(t.type),gt=I("bubbles","stopAutowalk","firedDoughnut","floatingText","emitter","particle"),ht=(e,t)=>gt(e)||Et(e)&&(t!==void 0&&wt(t)||e.config.direction.z!==0)||At(e)&&e.config.floorType==="none",$r=(e,t)=>!ht(e,t),vt=["ball","slidingBlock","slidingDeadly"];I(...vt);const It=["portableBlock","spring","sceneryPlayer","sceneryCrown","monster","slidingBlock"],bt=["dalek","turtle","elephantHead","homingBot","helicopterBug"],qr=e=>e.type==="slidingBlock"?e.config.style==="puck":e.type==="monster"?bt.includes(e.config.which):It.includes(e.type),wt=e=>e.type==="head"||e.type==="heels"||e.type==="headOverHeels";function Pr(e){return xt.includes(e.type)}const xt=[...mt,"monster","ball","charles","pushableBlock","movingPlatform","moveableDeadly","pickup","portableBlock","slidingBlock","slidingDeadly","spring","sceneryPlayer","sceneryCrown"],kt=["monster","deadlyBlock","moveableDeadly","slidingDeadly"];I(...kt);const Rt=e=>e.config.times!==void 0,Et=I("portal");I("teleporter");I("heels");I("head");I("heels","headOverHeels");I("head","headOverHeels");I("lift");I("emitter");const Ct=I("monster"),At=I("floor");I("pickup");I("spring");const Wr=I("joystick");I("monster","movingPlatform");const Dr=e=>Ct(e)&&e.config.which==="cyberman"&&e.state.everActivated===!1,Fr=(e,t={})=>{const r=Z(t),n=V(Ie,e);return V(De(r,Ie),n)},M=e=>({x:e.direction==="away"?e.tiles.length:e.direction==="towards"?e.times?.x:1,y:e.direction==="left"?e.tiles.length:e.direction==="right"?e.times?.y:1}),Jr=e=>e.type==="wall"?M(e.config):Rt(e)?e.config.times:void 0,Z=(e=O)=>({x:e.x??1,y:e.y??1,z:e.z??1}),zt=e=>({x:e.x??1,y:e.y??1});function*St(e,t,r){for(const n of Fe(e)){const[o,c]=n;if(c.type!=="wall"||c.config.direction!==t)continue;const{position:u,config:d}=c,y=zt(M(d)),i=Je(se(d.direction)),a=se(d.direction),s=V(r,u);if(s[a]!==0||s[i]<-1||s[i]>y[i])continue;if(y[i]===2){console.log("yielding for for removal (complete replace) of ",o),yield[o,null];continue}const l=s[i]===0;if(l){const m=$(c,h=>{h.position=K(u,{[i]:2});const f=h.config;switch(f.direction){case"towards":case"right":f.times[i]=y[i]-2;break;default:f.tiles=f.tiles.slice(2)}});yield[o,m]}const g=s[i]===y[i]-2;if(g){const m=$(c,h=>{const f=h.config;switch(f.direction){case"towards":case"right":f.times[i]=y[i]-2;break;default:f.tiles=f.tiles.slice(0,-2)}});yield[o,m]}if(!l&&!g){const m=$(c,f=>{const p=f.config;switch(p.direction){case"towards":case"right":p.times[i]=s[i];break;default:p.tiles=p.tiles.slice(0,s[i])}});yield[`${o}/beforeDoor`,m];const h=$(c,f=>{f.position={...u,[i]:r[i]+2};const p=f.config;switch(p.direction){case"towards":case"right":p.times[i]=y[i]-s[i]-2;break;default:console.log("cutting tiles down in ",o),p.tiles=p.tiles.slice(s[i]+2)}});yield[`${o}/afterDoor`,h],console.log("yielding for removal (after splitting) of ",o),yield[o,null]}}}const be=(e,t,r,n,o)=>{const c=Q(e,t);if(c===void 0)throw new Error("can't cut hole in walls for a room that does not exist");const u=Oe(e,o,t);for(const[d,y]of St(c.items,r,n))o?u[d]=y:y===null?delete u[d]:u[d]=y},_t=(e,t,r,n,o)=>{const c=w(e),u=r;be(e,c.id,u,t,o);const d=o?void 0:_e(e,c.planet,c.color);if(Y(e,{type:n.type,config:{...n.config,toRoom:d?d.id:"nowhere",direction:u}},t,o),d){const y=re(d,n,o),i={x:u==="left"?0:u==="right"?d.size.x:t.x,y:u==="away"?0:u==="towards"?d.size.x:t.y,z:t.z},a=He(u),s={type:"door",config:{toRoom:c.id,direction:a},position:i};d.items[y]=s,be(e,d.id,a,i,!1)}},Ot=e=>e.type==="door",Tt=e=>e.type==="monster"&&e.config.which==="cyberman",$t={applyItemTool(e,{payload:{blockPosition:t,pointedAtItemJson:r,preview:n}}){const o=e,{tool:c}=o;if(c.type!=="item")throw new Error("applying item tool reducer while the current tool is not an item tool");switch(n||(S(o),o.previewedEdits={}),o.selectedJsonItemIds=[],!0){case Ot(c.item):{if(r.type!=="wall")throw new Error("doors can only be added on walls");_t(o,t,r.config.direction,c.item,n);break}case(Tt(c.item)&&r.type==="deadlyBlock"&&r.config.style==="toaster"&&r.position.z+1===t.z):{Y(o,{...c.item,config:{...c.item.config,activated:"off"}},t,n);break}default:Y(o,c.item,t,n)}}},qt={changeDragInProgress(e,{payload:t}){const r=e;r.dragInProgress=t}},Pt={changeGridResolution(e,{payload:t}){const r=e;r.halfGridResolution=t},changeWallsFloorsLocked(e,{payload:t}){const r=e;r.wallsFloorsLocked=t}},Wt={setSelectedItemInRoom(e,{payload:{jsonItemId:t,additive:r=!1}}){if(r)if(t===void 0)e.selectedJsonItemIds=[];else{const n=e.selectedJsonItemIds.indexOf(t);n===-1?e.selectedJsonItemIds.push(t):e.selectedJsonItemIds.splice(n,1)}else e.selectedJsonItemIds=t===void 0?[]:[t]},setHoveredItemInRoom(e,t){e.hoveredItem=t.payload},setClickableAnnotationHovered(e,t){e.clickableAnnotationHovered=t.payload}},Dt=e=>Be(e.items),Te=e=>Ee(Dt(e)),we=(e,t,r)=>{const n=r-e.length;n>0?e.push(...T(t,n,e.length)):n<0&&e.splice(r)},Ft=(e,t,r,n)=>{Te(e).filter(o=>o.type==="wall").forEach(o=>{if(o.position.z!==t.position.z)return;const c=M(o.config);switch(o.config.direction){case"towards":ae(o.position,t.position)&&c.x===t.config.times.x&&(o.position=r,n&&(o.config.times={x:n.x}));break;case"right":ae(o.position,t.position)&&c.y===t.config.times.y&&(o.position=r,n&&(o.config.times={y:n.y}));break;case"away":o.position.x===t.position.x&&o.position.y===t.position.y+t.config.times.y&&c.x===t.config.times.x&&(o.position=K(r,n?{y:n.y}:z),n&&we(o.config.tiles,e.planet,n.x));break;case"left":o.position.x===t.position.x+t.config.times.x&&o.position.y===t.position.y&&c.y===t.config.times.y&&(o.position=K(r,n?{x:n.x}:z),n&&we(o.config.tiles,e.planet,n.y));break;default:o.config;break}})},Jt={moveOrResizeItem(e,{payload:{jsonItemId:t,newTimes:r,newPosition:n,startOfGesture:o}}){const c=e;o&&S(c);const u=ze(c,t);if(u===void 0){console.warn("no json item found for resize",t);return}if(u.type==="floor"&&Ft(w(c),u,n,r),r!==void 0){const{config:d}=u;d.times={...r.x===1?{}:{x:r.x},...r.y===1?{}:{y:r.y},...r.z===1?{}:{z:r.z}}}n!==void 0&&(u.position=n)}},Ht=e=>e==="towards"||e==="right";function xe(e){var t="";return r(e),t;function r(o){if(o===null||typeof o!="object"||o.toJSON!=null)t+=JSON.stringify(o);else if(Array.isArray(o)){t+="[";var c=!1;o.forEach(function(d){c&&(t+=","),c=!0,d===void 0&&(d=null),r(d)}),t+="]"}else{t+="{";var u=Object.keys(o).filter(function(d){return o[d]!==void 0}).sort();u.forEach(function(d,y){return n(o,d,y)}),t+="}"}}function n(o,c,u){u>0&&(t+=","),t+=JSON.stringify(c),t+=":",r(o[c])}}const Bt=(e,...t)=>{const r={...e};for(const n of t)delete r[n];return r},Lt=e=>Le($e(e))>0,$e=e=>{switch(e.type){case"deadlyBlock":return O;case"conveyor":if(e.config.disappearing)return z;switch(e.config.direction){case"left":case"right":return{x:1,y:0,z:0};case"away":case"towards":return{x:0,y:1,z:0};default:throw e.config.direction,new Error}case"hushPuppy":return O;case"teleporter":return{x:1,y:1,z:0};case"floor":case"spikes":return{x:1,y:1,z:0};case"block":return e.config.disappearing?z:O;case"barrier":if(e.config.disappearing)return z;switch(e.config.axis){case"x":return{x:1,y:0,z:1};case"y":return{x:0,y:1,z:1};default:throw e.config.axis,new Error}case"wall":switch(e.config.direction){case"left":case"right":return{x:0,y:1,z:1};case"away":case"towards":return{x:1,y:0,z:1};default:throw e.config,new Error}default:return z}},ke=e=>{const t=r=>r.config.times!==void 0;return e.type==="wall"?Z(M(e.config)):t(e)?Z(e.config.times):O},k=e=>e.type==="wall"?`wall/${e.config.direction}`:e.type==="teleporter"?xe({type:e.type,config:Bt(e.config,"toPosition")}):xe({type:e.type,config:e.config}),Mt=e=>Lt(e[1]),Ut=e=>{const t=[];let r=0,n=0,o=0;for(const[,u]of e){const{x:d,y,z:i}=u.position,a=ke(u),s=a.x,l=a.y,g=a.z;r=Math.max(r,d+s-1),n=Math.max(n,y+l-1),o=Math.max(o,i+g-1)}const c=Array.from({length:r+1},()=>Array.from({length:n+1},()=>Array.from({length:o+1},()=>new Set)));for(const u of e)if(!Mt(u))t.push(u);else{const[,d]=u,{x:y,y:i,z:a}=d.position,s=ke(d),l=s.x,g=s.y,m=s.z;for(let h=0;h<l;h++)for(let f=0;f<g;f++)for(let p=0;p<m;p++){const v=y+h,b=i+f,x=a+p;v<c.length&&b<c[v].length&&x<c[v][b].length&&c[v][b][x].add(u)}}return{consolidatableGrid:c,nonConsolidatable:t}},Xt=e=>{const t=[],r=new Set;for(const n of e)for(const o of n)for(const c of o)for(const u of c){const[d]=u;r.has(d)||(r.add(d),t.push(u))}return t},Gt=e=>{const{consolidatableGrid:t,nonConsolidatable:r}=Ut(e),n={x:t.length,y:t[0].length,z:t[0][0].length},o=new Map,c=new Map;for(let a=0;a<n.x;a++)for(let s=0;s<n.y;s++)for(let l=0;l<n.z;l++)for(const[,g]of t[a][s][l]){const m=k(g);c.has(m)||c.set(m,g)}for(const[a]of c)o.set(a,Array.from({length:n.x},()=>Array.from({length:n.y},()=>Array(n.z).fill(!1))));const u=({x:a,y:s,z:l},g)=>{const m=k(g);return!o.get(m)[a][s][l]&&Array.from(t[a][s][l]).some(([,h])=>k(h)===k(g))},d=(a,s)=>{const l={...a},g=$e(s);if(g.x>0)for(;l.x+1<n.x&&u({...l,x:l.x+1},s);)l.x++;if(g.y>0)for(let m=a.x;m<=l.x;m++)for(;l.y+1<n.y&&Array.from({length:l.x-a.x+1}).every((h,f)=>u({x:a.x+f,y:l.y+1,z:a.z},s));)l.y++;if(g.z>0)for(let m=a.x;m<=l.x;m++)for(let h=a.y;h<=l.y;h++)for(;l.z+1<n.z&&Array.from({length:l.x-a.x+1}).every((f,p)=>Array.from({length:l.y-a.y+1}).every((v,b)=>u({x:a.x+p,y:a.y+b,z:l.z+1},s)));)l.z++;return l},y=(a,s)=>{if(a.type==="wall"){if(s.type!=="wall")throw new Error("only walls can join walls");if(a.config.direction!==s.config.direction)throw new Error("walls must have the same direction to join");if(a.config.direction==="right"||a.config.direction==="towards")return;a.config.tiles=[...a.config.tiles,...s.config.tiles]}},i=({x:a,y:s,z:l},{x:g,y:m,z:h},f)=>{const[,p]=f,v=k(p),b=g-a+1,x=m-s+1,U=h-l+1;if(b+x+U>3)if(p.type==="wall")switch(p.config.direction){case"away":case"left":break;case"towards":b!==1&&(p.config.times={x:b});break;case"right":x!==1&&(p.config.times={y:x});break}else b!==1&&(p.config.times={...p.config.times,x:b}),x!==1&&(p.config.times={...p.config.times,y:x}),U!==1&&(p.config.times={...p.config.times,z:U});for(let E=a;E<=g;E++)for(let C=s;C<=m;C++)for(let A=l;A<=h;A++)if(o.get(v)[E][C][A]=!0,E!==a||C!==s||A!==l){const ne=t[E][C][A];e:for(const ie of ne){const[,_]=ie;if(k(_)===v){_.position.x===E&&_.position.y===C&&_.position.z===A&&y(p,_),ne.delete(ie);break e}}}};for(let a=0;a<n.x;a++)for(let s=0;s<n.y;s++)for(let l=0;l<n.z;l++)for(const g of t[a][s][l]){const[,m]=g;if(m.position.x===a&&m.position.y===s&&m.position.z===l){const h=k(m),f=o.get(h);if(f&&!f[a][s][l]){const p=d({x:a,y:s,z:l},m);i({x:a,y:s,z:l},p,g)}}}return[...Xt(t),...r]},Nt=e=>Object.fromEntries(Gt(Object.entries(e))),Re=(e,t)=>{Te(e).filter(r=>r.type==="floor").filter(r=>r.position.z===0).forEach(r=>{r.config={...r.config,floorType:t,scenery:t==="standable"?e.planet:void 0}})},jt=(e,t)=>{const r=e.items[t];if(r.type==="door"){const n={type:"wall",config:Ht(r.config.direction)?r.config.direction==="towards"?{direction:r.config.direction,times:{x:2}}:{direction:r.config.direction,times:{y:2}}:{direction:r.config.direction,tiles:[...T(e.planet,2,r.position[r.config.direction==="away"?"x":"y"])]},position:{...r.position,z:0}},o=re(e,n,!1);e.items[o]=n,e.items=Nt(e.items)}delete e.items[t]},Vt={changeRoomColour(e,{payload:t}){const r=e,n=r.campaignInProgress.rooms[r.currentlyEditingRoomId].color;S(r),Object.assign(n,t)},changeRoomScenery(e,{payload:t}){const r=e,n=w(r);S(r),Se(n,t)},roomJsonEdited(e,{payload:t}){const r=e;r.campaignInProgress.rooms[r.currentlyEditingRoomId]=t},deleteSelected(e){const t=e,r=w(t);S(t),t.selectedJsonItemIds.forEach(n=>{jt(r,n)}),t.selectedJsonItemIds=[]},clearRoom(e){const t=e,r=w(t);S(t);for(const n of Ce(r.items)){const o=r.items[n];o.type!=="floor"&&o.type!=="wall"&&o.type!=="door"&&(delete r.items[n],t.selectedJsonItemIds=t.selectedJsonItemIds.filter(c=>c!==n))}},setRoomAboveOrBelow(e,{payload:t}){const r=e,n=t.direction,o=n==="roomAbove"?"roomBelow":"roomAbove",c=w(r),u=t.createNew?_e(r,c.planet,c.color).id:t.roomId,d=c[n]&&Q(r,c[n]);d?.[o]===r.currentlyEditingRoomId&&(d[o]=void 0),c[n]=u;const y=u&&Q(r,u);y!==void 0&&(y[o]=c.id),y?Re(n==="roomBelow"?c:y,"none"):Re(n==="roomBelow"?c:d,"standable")}},Kt={resetPreviewedEdits(e){e.previewedEdits={}}},ee="room_0",Qt={id:ee,...Ae({x:8,y:8})},B={campaignInProgress:{name:"new campaign",rooms:{[ee]:Qt}},currentlyEditingRoomId:ee,previewedEdits:{},tool:{type:"pointer"},hoveredItem:void 0,clickableAnnotationHovered:!1,selectedJsonItemIds:[],halfGridResolution:!1,wallsFloorsLocked:!0,dragInProgress:!1,history:{undo:[],redo:[]}},oe=Me({name:"levelEditor",initialState:B,reducers:{setTool(e,{payload:t}){const r=e;t.type==="item"&&(r.selectedJsonItemIds=[]),r.tool=t},changeToRoom(e,{payload:t}){const r=e;if(!r.campaignInProgress.rooms[t]){console.warn(`can't change to room ${t} - it doesn't exist`);return}r.currentlyEditingRoomId=t,r.clickableAnnotationHovered=!1,r.hoveredItem=void 0,r.selectedJsonItemIds=[],r.history=B.history},loadCampaign(e,{payload:{campaign:t}}){const r=e;r.campaignInProgress=t,r.hoveredItem=void 0,r.selectedJsonItemIds=[],r.clickableAnnotationHovered=!1,r.dragInProgress=!1,r.history=B.history;const n=st(Ce(t.rooms));if(n===void 0)throw new Error("could not find any rooms in this campaign");r.currentlyEditingRoomId=n},injected(){},...Pt,...ut,...$t,...qt,...Wt,...Vt,...Jt,...Kt},selectors:{selectCurrentCampaignInProgress:e=>e.campaignInProgress,selectCurrentEditingRoomJson:w,selectItem:ze,selectCurrentEditingRoomColour:e=>w(e).color,selectCurrentEditingRoomScenery:e=>w(e).planet,selectTool:e=>e.tool,selectSelectedJsonItemIds:e=>e.selectedJsonItemIds,selectHoveredItem:e=>e.hoveredItem,...yt}}),{applyItemTool:Yt,changeDragInProgress:Zt,changeGridResolution:er,changeRoomColour:tr,changeRoomScenery:rr,changeToRoom:or,changeWallsFloorsLocked:nr,clearRoom:ir,deleteSelected:sr,injected:ar,loadCampaign:cr,moveOrResizeItem:lr,redo:dr,resetPreviewedEdits:fr,roomJsonEdited:ur,setClickableAnnotationHovered:yr,setHoveredItemInRoom:pr,setRoomAboveOrBelow:mr,setSelectedItemInRoom:gr,setTool:hr,undo:vr}=oe.actions,{selectCanRedo:Ir,selectCanUndo:br,selectCurrentCampaignInProgress:wr,selectCurrentEditingRoomColour:xr,selectCurrentEditingRoomJson:kr,selectCurrentEditingRoomScenery:Rr,selectHoveredItem:Er,selectItem:Cr,selectSelectedJsonItemIds:Ar,selectTool:zr}=oe.selectors,Sr=Ue.withTypes(),Hr=Object.freeze(Object.defineProperty({__proto__:null,applyItemTool:Yt,changeDragInProgress:Zt,changeGridResolution:er,changeRoomColour:tr,changeRoomScenery:rr,changeToRoom:or,changeWallsFloorsLocked:nr,clearRoom:ir,deleteSelected:sr,initialLevelEditorSliceState:B,injected:ar,levelEditorSlice:oe,loadCampaign:cr,moveOrResizeItem:lr,redo:dr,resetPreviewedEdits:fr,roomJsonEdited:ur,selectCanRedo:Ir,selectCanUndo:br,selectCurrentCampaignInProgress:wr,selectCurrentEditingRoomColour:xr,selectCurrentEditingRoomJson:kr,selectCurrentEditingRoomScenery:Rr,selectHoveredItem:Er,selectItem:Cr,selectSelectedJsonItemIds:Ar,selectTool:zr,setClickableAnnotationHovered:yr,setHoveredItemInRoom:pr,setRoomAboveOrBelow:mr,setSelectedItemInRoom:gr,setTool:hr,undo:vr,useAppSelectorWithLevelEditorSlice:Sr},Symbol.toStringTag,{value:"Module"}));export{ur as $,Jr as A,xt as B,vt as C,M as D,Fr as E,Ht as F,$r as G,Pr as H,wt as I,Wr as J,Dr as K,qr as L,yr as M,Er as N,Ar as O,zt as P,$e as Q,Zt as R,Cr as S,gr as T,Yt as U,pr as V,fr as W,Z as X,Lt as Y,lr as Z,ze as _,hr as a,Hr as a0,xr as b,er as c,sr as d,tr as e,Rr as f,rr as g,br as h,Ir as i,vr as j,dr as k,nr as l,kr as m,T as n,ir as o,w as p,mr as q,Ve as r,zr as s,wr as t,Sr as u,cr as v,or as w,Tr as x,I as y,Rt as z};
