const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebGPURenderer-BAfJpt7A.js","assets/index-BYxVC5ml.js","assets/index-BzaUB_Hz.css","assets/colorToUniform-KTpA7KSL.js","assets/SharedSystems-CIOoiarV.js","assets/Graphics-L4jhkacx.js","assets/levelEditorSlice-BqKqxN-m.js","assets/WebGLRenderer-DrzpnH4c.js","assets/JsonRoomEditor-B9W_rmOO.js","assets/JsonRoomEditor-Cpm53wG5.css"])))=>i.map(i=>d[i]);
import{a6 as el,a5 as Sr,a7 as Ot,s as qg,x as tl,y as It,e as nl,E as Qr,a as Vg,C as re,d as eo,v as to,Z as G,D as ia,az as qt,k as th,K as Tn,t as Tt,T as tr,U as Kg,M as Xg,aA as nr,V as nh,aB as Jg,w as aa,aC as Yg,aD as Zg,j as Qg,aE as An,aF as f,aG as rh,aH as Vt,aI as m,aJ as ey,aK as ks,aL as oh,aM as ty,aN as de,aO as He,aP as sh,aQ as ny,aR as ry,aS as U,aT as Ge,aU as kr,al as oy,aV as sy,aW as iy,aX as ih,aY as ah,ae as ue,ai as Kt,aa as B,aZ as lh,a_ as ir,a$ as ay,b0 as Es,b1 as yn,ag as hr,b2 as uo,an as Er,b3 as ly,b4 as cy,b5 as uy,ab as vt,ac as cs,at as Ps,ap as rl,am as dy,ao as Xt,b6 as $e,b7 as ch,b8 as hy,af as fy,b9 as Rn,aq as uh,au as us,ba as ds,bb as jt,bc as py,bd as la,be as my,av as Ts,bf as ol,bg as sl,bh as Xr,ad as ar,bi as dh,as as il,bj as al,bk as gy,bl as yy,bm as tn,ah as vy,bn as wy,bo as ll,bp as sc,bq as by,br as xy,bs as _y,bt as cl,bu as Cy,bv as Sy,bw as ky,bx as Ey,by as Py,bz as Ty,bA as Ay,bB as Ry,bC as Oy,bD as Iy,bE as jy,bF as $y,bG as Ny,bH as My}from"./index-BYxVC5ml.js";import{r as zy,u as he,d as Dy,g as Ly,c as By,s as gn,a as wn,b as Fy,e as ic,f as Uy,h as Hy,i as Wy,j as Gy,k as qy,l as Vy,m as Ky,n as fr,o as Xy,p as Jy,q as hh,t as oi,v as fh,w as Yy,x as Zy,y as Qy,z as ev,A as K,B as tv,C as Ee,D as nv,E as rv,F as ph,G as ac,H as ul,I as ov,J as ca,K as lc,L as pr,M as sv,N as iv,O as av,P as mh,Q as gh,R as lv,S as cv,T as uv,U as ua,V as ho,W as yh,X as dl,Y as hl,Z as vh,_ as wh,$ as dv,a0 as cc,a1 as bh,a2 as hv,a3 as fv,a4 as xh,a5 as _h,a6 as pv,a7 as si,a8 as mv,a9 as uc,aa as Ch,ab as da,ac as Sh,ad as gv,ae as yv,af as kh}from"./levelEditorSlice-BqKqxN-m.js";import{S as vv,G as ht}from"./Graphics-L4jhkacx.js";function wv(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function bv(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function xv(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(n=>typeof n=="function")){const n=t.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${e}[${n}]`)}}var dc=t=>Array.isArray(t)?t:[t];function _v(t){const e=Array.isArray(t[0])?t[0]:t;return xv(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function Cv(t,e){const n=[],{length:r}=t;for(let o=0;o<r;o++)n.push(t[o].apply(null,e));return n}var Sv=class{constructor(t){this.value=t}deref(){return this.value}},kv=typeof WeakRef<"u"?WeakRef:Sv,Ev=0,hc=1;function Co(){return{s:Ev,v:void 0,o:null,p:null}}function Eh(t,e={}){let n=Co();const{resultEqualityCheck:r}=e;let o,s=0;function i(){let a=n;const{length:l}=arguments;for(let d=0,h=l;d<h;d++){const p=arguments[d];if(typeof p=="function"||typeof p=="object"&&p!==null){let g=a.o;g===null&&(a.o=g=new WeakMap);const y=g.get(p);y===void 0?(a=Co(),g.set(p,a)):a=y}else{let g=a.p;g===null&&(a.p=g=new Map);const y=g.get(p);y===void 0?(a=Co(),g.set(p,a)):a=y}}const c=a;let u;if(a.s===hc)u=a.v;else if(u=t.apply(null,arguments),s++,r){const d=o?.deref?.()??o;d!=null&&r(d,u)&&(u=d,s!==0&&s--),o=typeof u=="object"&&u!==null||typeof u=="function"?new kv(u):u}return c.s=hc,c.v=u,u}return i.clearCache=()=>{n=Co(),i.resetResultsCount()},i.resultsCount=()=>s,i.resetResultsCount=()=>{s=0},i}function Pv(t,...e){const n=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,r=(...o)=>{let s=0,i=0,a,l={},c=o.pop();typeof c=="object"&&(l=c,c=o.pop()),wv(c,`createSelector expects an output function after the inputs, but received: [${typeof c}]`);const u={...n,...l},{memoize:d,memoizeOptions:h=[],argsMemoize:p=Eh,argsMemoizeOptions:g=[]}=u,y=dc(h),v=dc(g),w=_v(o),_=d(function(){return s++,c.apply(null,arguments)},...y),b=p(function(){i++;const S=Cv(w,arguments);return a=_.apply(null,S),a},...v);return Object.assign(b,{resultFunc:c,memoizedResultFunc:_,dependencies:w,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>a,recomputations:()=>s,resetRecomputations:()=>{s=0},memoize:d,argsMemoize:p})};return Object.assign(r,{withTypes:()=>r}),r}var Ph=Pv(Eh),Tv=Object.assign((t,e=Ph)=>{bv(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const n=Object.keys(t),r=n.map(s=>t[s]);return e(r,(...s)=>s.reduce((i,a,l)=>(i[n[l]]=a,i),{}))},{withTypes:()=>Tv}),So={},fc;function Th(){if(fc)return So;fc=1;var t=el(),e=t.mark(a);function n(c,u){var d;if(typeof Symbol>"u"||c[Symbol.iterator]==null){if(Array.isArray(c)||(d=r(c))||u){d&&(c=d);var h=0,p=function(){};return{s:p,n:function(){return h>=c.length?{done:!0}:{done:!1,value:c[h++]}},e:function(_){throw _},f:p}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var g=!0,y=!1,v;return{s:function(){d=c[Symbol.iterator]()},n:function(){var _=d.next();return g=_.done,_},e:function(_){y=!0,v=_},f:function(){try{!g&&d.return!=null&&d.return()}finally{if(y)throw v}}}}function r(c,u){if(c){if(typeof c=="string")return o(c,u);var d=Object.prototype.toString.call(c).slice(8,-1);if(d==="Object"&&c.constructor&&(d=c.constructor.name),d==="Map"||d==="Set")return Array.from(c);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return o(c,u)}}function o(c,u){(u==null||u>c.length)&&(u=c.length);for(var d=0,h=new Array(u);d<u;d++)h[d]=c[d];return h}var s=Sr(),i=s.iterableCurry;function a(c,u){var d,h,p,g;return t.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d=0,h=n(c),v.prev=2,h.s();case 4:if((p=h.n()).done){v.next=10;break}return g=p.value,v.next=8,u(g,d++);case 8:v.next=4;break;case 10:v.next=15;break;case 12:v.prev=12,v.t0=v.catch(2),h.e(v.t0);case 15:return v.prev=15,h.f(),v.finish(15);case 18:case"end":return v.stop()}},e,null,[[2,12,15,18]])}So.__map=a;var l=i(a);return So.map=l,So}var ko={},pc;function Av(){if(pc)return ko;pc=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,p=!1,g;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return h=v.done,v},e:function(v){p=!0,g=v},f:function(){try{!h&&c.return!=null&&c.return()}finally{if(p)throw g}}}}function e(a,l){if(a){if(typeof a=="string")return n(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return n(a,l)}}function n(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var r=Sr(),o=r.iterableCurry;function s(a,l){var c=0,u=t(a),d;try{for(u.s();!(d=u.n()).done;){var h=d.value;if(l(h,c++))return!0}}catch(p){u.e(p)}finally{u.f()}return!1}ko.__some=s;var i=o(s,{reduces:!0});return ko.some=i,ko}var Eo={},mc;function Rv(){if(mc)return Eo;mc=1;var t=el(),e=t.mark(s),n=Sr(),r=n.wrapWithIterableIterator,o=n.ensureIterable;function s(){var a,l,c,u,d,h,p=arguments;return t.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:for(a=p.length,l=new Array(a),c=0;c<a;c++)l[c]=p[c];u=0,d=l;case 2:if(!(u<d.length)){y.next=8;break}return h=d[u],y.delegateYield(o(h),"t0",5);case 5:u++,y.next=2;break;case 8:case"end":return y.stop()}},e)}Eo.__concat=s;var i=r(s);return Eo.concat=i,Eo}var Po={},gc;function Ov(){if(gc)return Po;gc=1;var t=el(),e=t.mark(c);function n(d,h){var p;if(typeof Symbol>"u"||d[Symbol.iterator]==null){if(Array.isArray(d)||(p=r(d))||h){p&&(d=p);var g=0,y=function(){};return{s:y,n:function(){return g>=d.length?{done:!0}:{done:!1,value:d[g++]}},e:function(x){throw x},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,w=!1,_;return{s:function(){p=d[Symbol.iterator]()},n:function(){var x=p.next();return v=x.done,x},e:function(x){w=!0,_=x},f:function(){try{!v&&p.return!=null&&p.return()}finally{if(w)throw _}}}}function r(d,h){if(d){if(typeof d=="string")return o(d,h);var p=Object.prototype.toString.call(d).slice(8,-1);if(p==="Object"&&d.constructor&&(p=d.constructor.name),p==="Map"||p==="Set")return Array.from(d);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return o(d,h)}}function o(d,h){(h==null||h>d.length)&&(h=d.length);for(var p=0,g=new Array(h);p<h;p++)g[p]=d[p];return g}var s=Sr(),i=s.iterableCurry,a=Th(),l=a.__map;function c(d,h){var p,g,y;return t.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:p=n(l(d,h)),w.prev=1,p.s();case 3:if((g=p.n()).done){w.next=8;break}return y=g.value,w.delegateYield(y,"t0",6);case 6:w.next=3;break;case 8:w.next=13;break;case 10:w.prev=10,w.t1=w.catch(1),p.e(w.t1);case 13:return w.prev=13,p.f(),w.finish(13);case 16:case"end":return w.stop()}},e,null,[[1,10,13,16]])}Po.__flatMap=c;var u=i(c);return Po.flatMap=u,Po}var To={},yc;function Iv(){if(yc)return To;yc=1;var t=Sr(),e=t.iterableCurry,n=zy(),r=n.__firstOr,o=Symbol("none");function s(a){return r(a,o)===o}To.__isEmpty=s;var i=e(s,{reduces:!0});return To.isEmpty=i,To}var Ao={},vc;function jv(){if(vc)return Ao;vc=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,p=!1,g;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return h=v.done,v},e:function(v){p=!0,g=v},f:function(){try{!h&&c.return!=null&&c.return()}finally{if(p)throw g}}}}function e(a,l){if(a){if(typeof a=="string")return n(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return n(a,l)}}function n(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var r=Sr(),o=r.ensureIterable;function s(a){var l=o(a),c=0,u=t(l),d;try{for(u.s();!(d=u.n()).done;){var h=d.value;c++}}catch(p){u.e(p)}finally{u.f()}return c}Ao.__size=s;var i=s;return Ao.size=i,Ao}var ii,wc;function $v(){return wc||(wc=1,ii=Rv().concat),ii}var Nv=$v();const bc=Ot(Nv);var ai,xc;function Mv(){return xc||(xc=1,ai=Ov().flatMap),ai}var zv=Mv();const Dv=Ot(zv);var li,_c;function Lv(){return _c||(_c=1,li=Iv().isEmpty),li}var Bv=Lv();const Ah=Ot(Bv);var ci,Cc;function Fv(){return Cc||(Cc=1,ci=Th().map),ci}var Uv=Fv();const Sc=Ot(Uv);var ui={},kc;function Hv(){if(kc)return ui;kc=1;var t=function(r){return r};function e(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return r.length||(r=[t]),r.reduce(function(s,i){return function(){return i(s.apply(void 0,arguments))}})}return ui.pipe=e,ui}var di,Ec;function Wv(){return Ec||(Ec=1,di=Hv().pipe),di}var Gv=Wv();const Pc=Ot(Gv);var hi,Tc;function qv(){return Tc||(Tc=1,hi=jv().size),hi}var Vv=qv();const Rh=Ot(Vv);var fi,Ac;function Kv(){return Ac||(Ac=1,fi=Av().some),fi}var Xv=Kv();const Jv=Ot(Xv),Oh=class ha extends qg{constructor(e){e={...ha.defaultOptions,...e},super(e),this.enabled=!0,this._state=vv.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(e,n,r,o){e.applyFilter(this,n,r,o)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:n,gl:r,...o}=e;let s,i;return n&&(s=tl.from(n)),r&&(i=It.from(r)),new ha({gpuProgram:s,glProgram:i,...o})}};Oh.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let nn=Oh;const fa=[];nl.handleByNamedList(Qr.Environment,fa);async function Yv(t){if(!t)for(let e=0;e<fa.length;e++){const n=fa[e];if(n.value.test()){await n.value.load();return}}}let $r;function Zv(){if(typeof $r=="boolean")return $r;try{$r=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{$r=!1}return $r}var Ih=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(Ih||{});class Qv{constructor(e){this.items=[],this._name=e}emit(e,n,r,o,s,i,a,l){const{name:c,items:u}=this;for(let d=0,h=u.length;d<h;d++)u[d][c](e,n,r,o,s,i,a,l);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const n=this.items.indexOf(e);return n!==-1&&this.items.splice(n,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const ew=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],jh=class $h extends Vg{constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;const n=[...ew,...this.config.runners??[]];this._addRunners(...n),this._unsafeEvalCheck()}async init(e={}){const n=e.skipExtensionImports===!0?!0:e.manageImports===!1;await Yv(n),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const r in this._systemsHash)e={...this._systemsHash[r].constructor.defaultOptions,...e};e={...$h.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let r=0;r<this.runners.init.items.length;r++)await this.runners.init.items[r].init(e);this._initOptions=e}render(e,n){let r=e;if(r instanceof re&&(r={container:r},n&&(eo(to,"passing a second argument is deprecated, please use render options instead"),r.target=n.renderTexture)),r.target||(r.target=this.view.renderTarget),r.target===this.view.renderTarget&&(this._lastObjectRendered=r.container,r.clearColor??(r.clearColor=this.background.colorRgba),r.clear??(r.clear=this.background.clearBeforeRender)),r.clearColor){const o=Array.isArray(r.clearColor)&&r.clearColor.length===4;r.clearColor=o?r.clearColor:G.shared.setValue(r.clearColor).toArray()}r.transform||(r.container.updateLocalTransform(),r.transform=r.container.localTransform),r.container.enableRenderGroup(),this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r)}resize(e,n,r){const o=this.view.resolution;this.view.resize(e,n,r),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),r!==void 0&&r!==o&&this.runners.resolutionChange.emit(r)}clear(e={}){const n=this;e.target||(e.target=n.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=Ih.ALL);const{clear:r,clearColor:o,target:s}=e;G.shared.setValue(o??this.background.colorRgba),n.renderTarget.clear(s,r,G.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(n=>{this.runners[n]=new Qv(n)})}_addSystems(e){let n;for(n in e){const r=e[n];this._addSystem(r.value,r.name)}}_addSystem(e,n){const r=new e(this);if(this[n])throw new Error(`Whoops! The name "${n}" is already in use`);this[n]=r,this._systemsHash[n]=r;for(const o in this.runners)this.runners[o].add(r);return this}_addPipes(e,n){const r=n.reduce((o,s)=>(o[s.name]=s.value,o),{});e.forEach(o=>{const s=o.value,i=o.name,a=r[i];this.renderPipes[i]=new s(this,a?new a:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(n=>{n.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!Zv())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};jh.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Nh=jh,Ro;function tw(t){return Ro!==void 0||(Ro=(()=>{const e={stencil:!0,failIfMajorPerformanceCaveat:t??Nh.defaultOptions.failIfMajorPerformanceCaveat};try{if(!ia.get().getWebGLRenderingContext())return!1;let r=ia.get().createCanvas().getContext("webgl",e);const o=!!r?.getContextAttributes()?.stencil;if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,o}catch{return!1}})()),Ro}let Oo;async function nw(t={}){return Oo!==void 0||(Oo=await(async()=>{const e=ia.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(t)).requestDevice(),!0}catch{return!1}})()),Oo}const Rc=["webgl","webgpu","canvas"];async function rw(t){let e=[];t.preference?(e.push(t.preference),Rc.forEach(s=>{s!==t.preference&&e.push(s)})):e=Rc.slice();let n,r={};for(let s=0;s<e.length;s++){const i=e[s];if(i==="webgpu"&&await nw()){const{WebGPURenderer:a}=await qt(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-BAfJpt7A.js");return{WebGPURenderer:l}},__vite__mapDeps([0,1,2,3,4,5,6]));n=a,r={...t,...t.webgpu};break}else if(i==="webgl"&&tw(t.failIfMajorPerformanceCaveat??Nh.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await qt(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-DrzpnH4c.js");return{WebGLRenderer:l}},__vite__mapDeps([7,1,2,3,4,5,6]));n=a,r={...t,...t.webgl};break}else if(i==="canvas")throw r={...t},new Error("CanvasRenderer is not yet implemented")}if(delete r.webgpu,delete r.webgl,!n)throw new Error("No available renderer for the current environment");const o=new n;return await o.init(r),o}const Mh="8.8.1";class zh{static init(){globalThis.__PIXI_APP_INIT__?.(this,Mh)}static destroy(){}}zh.extension=Qr.Application;class ow{constructor(e){this._renderer=e}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,Mh)}destroy(){this._renderer=null}}ow.extension={type:[Qr.WebGLSystem,Qr.WebGPUSystem],name:"initHook",priority:-10};const Dh=class pa{constructor(...e){this.stage=new re,e[0]!==void 0&&eo(to,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await rw(e),pa._plugins.forEach(n=>{n.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return eo(to,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,n=!1){const r=pa._plugins.slice(0);r.reverse(),r.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(n),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Dh._plugins=[];let Lh=Dh;nl.handleByList(Qr.Application,Lh._plugins);nl.add(zh);var Bh=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,sw=`
in vec2 vTextureCoord;

out vec4 finalColor;

uniform float uAlpha;
uniform sampler2D uTexture;

void main()
{
    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;
}
`,Oc=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
 
    var sample = textureSample(uTexture, uSampler, uv);
    
    return sample * alphaUniforms.uAlpha;
}`;const Fh=class Uh extends nn{constructor(e){e={...Uh.defaultOptions,...e};const n=tl.from({vertex:{source:Oc,entryPoint:"mainVertex"},fragment:{source:Oc,entryPoint:"mainFragment"}}),r=It.from({vertex:Bh,fragment:sw,name:"alpha-filter"}),{alpha:o,...s}=e,i=new th({uAlpha:{value:o,type:"f32"}});super({...s,gpuProgram:n,glProgram:r,resources:{alphaUniforms:i}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(e){this.resources.alphaUniforms.uniforms.uAlpha=e}};Fh.defaultOptions={alpha:1};let iw=Fh;var aw=`
in vec2 vTextureCoord;
in vec4 vColor;

out vec4 finalColor;

uniform float uColorMatrix[20];
uniform float uAlpha;

uniform sampler2D uTexture;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture(uTexture, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * 0.2);
    float diff = (randomValue - 0.5) *  0.5;

    if (uAlpha == 0.0) {
        finalColor = color;
        return;
    }

    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    vec4 result;

    result.r = (uColorMatrix[0] * color.r);
        result.r += (uColorMatrix[1] * color.g);
        result.r += (uColorMatrix[2] * color.b);
        result.r += (uColorMatrix[3] * color.a);
        result.r += uColorMatrix[4];

    result.g = (uColorMatrix[5] * color.r);
        result.g += (uColorMatrix[6] * color.g);
        result.g += (uColorMatrix[7] * color.b);
        result.g += (uColorMatrix[8] * color.a);
        result.g += uColorMatrix[9];

    result.b = (uColorMatrix[10] * color.r);
       result.b += (uColorMatrix[11] * color.g);
       result.b += (uColorMatrix[12] * color.b);
       result.b += (uColorMatrix[13] * color.a);
       result.b += uColorMatrix[14];

    result.a = (uColorMatrix[15] * color.r);
       result.a += (uColorMatrix[16] * color.g);
       result.a += (uColorMatrix[17] * color.b);
       result.a += (uColorMatrix[18] * color.a);
       result.a += uColorMatrix[19];

    vec3 rgb = mix(color.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    finalColor = vec4(rgb, result.a);
}
`,Ic=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct ColorMatrixUniforms {
  uColorMatrix:array<vec4<f32>, 5>,
  uAlpha:f32,
};


@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;
@group(1) @binding(0) var<uniform> colorMatrixUniforms : ColorMatrixUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
  };
  
fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
  );
}


@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
) -> @location(0) vec4<f32> {


  var c = textureSample(uTexture, uSampler, uv);
  
  if (colorMatrixUniforms.uAlpha == 0.0) {
    return c;
  }

 
    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.r /= c.a;
      c.g /= c.a;
      c.b /= c.a;
    }

    var cm = colorMatrixUniforms.uColorMatrix;


    var result = vec4<f32>(0.);

    result.r = (cm[0][0] * c.r);
    result.r += (cm[0][1] * c.g);
    result.r += (cm[0][2] * c.b);
    result.r += (cm[0][3] * c.a);
    result.r += cm[1][0];

    result.g = (cm[1][1] * c.r);
    result.g += (cm[1][2] * c.g);
    result.g += (cm[1][3] * c.b);
    result.g += (cm[2][0] * c.a);
    result.g += cm[2][1];

    result.b = (cm[2][2] * c.r);
    result.b += (cm[2][3] * c.g);
    result.b += (cm[3][0] * c.b);
    result.b += (cm[3][1] * c.a);
    result.b += cm[3][2];

    result.a = (cm[3][3] * c.r);
    result.a += (cm[4][0] * c.g);
    result.a += (cm[4][1] * c.b);
    result.a += (cm[4][2] * c.a);
    result.a += cm[4][3];

    var rgb = mix(c.rgb, result.rgb, colorMatrixUniforms.uAlpha);

    rgb.r *= result.a;
    rgb.g *= result.a;
    rgb.b *= result.a;

    return vec4(rgb, result.a);
}`;class lw extends nn{constructor(e={}){const n=new th({uColorMatrix:{value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],type:"f32",size:20},uAlpha:{value:1,type:"f32"}}),r=tl.from({vertex:{source:Ic,entryPoint:"mainVertex"},fragment:{source:Ic,entryPoint:"mainFragment"}}),o=It.from({vertex:Bh,fragment:aw,name:"color-matrix-filter"});super({...e,gpuProgram:r,glProgram:o,resources:{colorMatrixUniforms:n}}),this.alpha=1}_loadMatrix(e,n=!1){let r=e;n&&(this._multiply(r,this.matrix,e),r=this._colorMatrix(r)),this.resources.colorMatrixUniforms.uniforms.uColorMatrix=r,this.resources.colorMatrixUniforms.update()}_multiply(e,n,r){return e[0]=n[0]*r[0]+n[1]*r[5]+n[2]*r[10]+n[3]*r[15],e[1]=n[0]*r[1]+n[1]*r[6]+n[2]*r[11]+n[3]*r[16],e[2]=n[0]*r[2]+n[1]*r[7]+n[2]*r[12]+n[3]*r[17],e[3]=n[0]*r[3]+n[1]*r[8]+n[2]*r[13]+n[3]*r[18],e[4]=n[0]*r[4]+n[1]*r[9]+n[2]*r[14]+n[3]*r[19]+n[4],e[5]=n[5]*r[0]+n[6]*r[5]+n[7]*r[10]+n[8]*r[15],e[6]=n[5]*r[1]+n[6]*r[6]+n[7]*r[11]+n[8]*r[16],e[7]=n[5]*r[2]+n[6]*r[7]+n[7]*r[12]+n[8]*r[17],e[8]=n[5]*r[3]+n[6]*r[8]+n[7]*r[13]+n[8]*r[18],e[9]=n[5]*r[4]+n[6]*r[9]+n[7]*r[14]+n[8]*r[19]+n[9],e[10]=n[10]*r[0]+n[11]*r[5]+n[12]*r[10]+n[13]*r[15],e[11]=n[10]*r[1]+n[11]*r[6]+n[12]*r[11]+n[13]*r[16],e[12]=n[10]*r[2]+n[11]*r[7]+n[12]*r[12]+n[13]*r[17],e[13]=n[10]*r[3]+n[11]*r[8]+n[12]*r[13]+n[13]*r[18],e[14]=n[10]*r[4]+n[11]*r[9]+n[12]*r[14]+n[13]*r[19]+n[14],e[15]=n[15]*r[0]+n[16]*r[5]+n[17]*r[10]+n[18]*r[15],e[16]=n[15]*r[1]+n[16]*r[6]+n[17]*r[11]+n[18]*r[16],e[17]=n[15]*r[2]+n[16]*r[7]+n[17]*r[12]+n[18]*r[17],e[18]=n[15]*r[3]+n[16]*r[8]+n[17]*r[13]+n[18]*r[18],e[19]=n[15]*r[4]+n[16]*r[9]+n[17]*r[14]+n[18]*r[19]+n[19],e}_colorMatrix(e){const n=new Float32Array(e);return n[4]/=255,n[9]/=255,n[14]/=255,n[19]/=255,n}brightness(e,n){const r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,n)}tint(e,n){const[r,o,s]=G.shared.setValue(e).toArray(),i=[r,0,0,0,0,0,o,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(i,n)}greyscale(e,n){const r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,n)}grayscale(e,n){this.greyscale(e,n)}blackAndWhite(e){const n=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(n,e)}hue(e,n){e=(e||0)/180*Math.PI;const r=Math.cos(e),o=Math.sin(e),s=Math.sqrt,i=1/3,a=s(i),l=r+(1-r)*i,c=i*(1-r)-a*o,u=i*(1-r)+a*o,d=i*(1-r)+a*o,h=r+i*(1-r),p=i*(1-r)-a*o,g=i*(1-r)-a*o,y=i*(1-r)+a*o,v=r+i*(1-r),w=[l,c,u,0,0,d,h,p,0,0,g,y,v,0,0,0,0,0,1,0];this._loadMatrix(w,n)}contrast(e,n){const r=(e||0)+1,o=-.5*(r-1),s=[r,0,0,0,o,0,r,0,0,o,0,0,r,0,o,0,0,0,1,0];this._loadMatrix(s,n)}saturate(e=0,n){const r=e*2/3+1,o=(r-1)*-.5,s=[r,o,o,0,0,o,r,o,0,0,o,o,r,0,0,0,0,0,1,0];this._loadMatrix(s,n)}desaturate(){this.saturate(-1)}negative(e){const n=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(n,e)}sepia(e){const n=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(n,e)}technicolor(e){const n=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(n,e)}polaroid(e){const n=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(n,e)}toBGR(e){const n=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(n,e)}kodachrome(e){const n=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(n,e)}browni(e){const n=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(n,e)}vintage(e){const n=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(n,e)}colorTone(e,n,r,o,s){e||(e=.2),n||(n=.15),r||(r=16770432),o||(o=3375104);const i=G.shared,[a,l,c]=i.setValue(r).toArray(),[u,d,h]=i.setValue(o).toArray(),p=[.3,.59,.11,0,0,a,l,c,e,0,u,d,h,n,0,a-u,l-d,c-h,0,0];this._loadMatrix(p,s)}night(e,n){e||(e=.1);const r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,n)}predator(e,n){const r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,n)}lsd(e){const n=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(n,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.resources.colorMatrixUniforms.uniforms.uColorMatrix}set matrix(e){this.resources.colorMatrixUniforms.uniforms.uColorMatrix=e}get alpha(){return this.resources.colorMatrixUniforms.uniforms.uAlpha}set alpha(e){this.resources.colorMatrixUniforms.uniforms.uAlpha=e}}class mr extends Tn{constructor(...e){let n=e[0];Array.isArray(e[0])&&(n={textures:e[0],autoUpdate:e[1]});const{animationSpeed:r=1,autoPlay:o=!1,autoUpdate:s=!0,loop:i=!0,onComplete:a=null,onFrameChange:l=null,onLoop:c=null,textures:u,updateAnchor:d=!1,...h}=n,[p]=u;super({...h,texture:p instanceof Tt?p:p.texture}),this._textures=null,this._durations=null,this._autoUpdate=s,this._isConnectedToTicker=!1,this.animationSpeed=r,this.loop=i,this.updateAnchor=d,this.onComplete=a,this.onFrameChange=l,this.onLoop=c,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=u,o&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(tr.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(tr.shared.add(this.update,this,Kg.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const n=e.deltaTime,r=this.animationSpeed*n,o=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=r/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*n);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o||this.animationSpeed<0&&this.currentFrame>o)&&this.onLoop(),this._updateTexture())}_updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const n=[];for(let r=0;r<e.length;++r)n.push(Tt.from(e[r]));return new mr(n)}static fromImages(e){const n=[];for(let r=0;r<e.length;++r)n.push(Tt.from(e[r]));return new mr(n)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof Tt)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let n=0;n<e.length;n++)this._textures.push(e[n].texture),this._durations.push(e[n].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const n=this.currentFrame;this._currentTime=e,n!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(tr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(tr.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class cw{constructor({matrix:e,observer:n}={}){this.dirty=!0,this._matrix=e??new Xg,this.observer=n,this.position=new nr(this,0,0),this.scale=new nr(this,1,1),this.pivot=new nr(this,0,0),this.skew=new nr(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}_onUpdate(e){this.dirty=!0,e===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}}const Hh=class Yo extends nh{constructor(...e){let n=e[0]||{};n instanceof Tt&&(n={texture:n}),e.length>1&&(eo(to,"use new TilingSprite({ texture, width:100, height:100 }) instead"),n.width=e[1],n.height=e[2]),n={...Yo.defaultOptions,...n};const{texture:r,anchor:o,tilePosition:s,tileScale:i,tileRotation:a,width:l,height:c,applyAnchorToTexture:u,roundPixels:d,...h}=n??{};super({label:"TilingSprite",...h}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new nr({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=u,this.texture=r,this._width=l??r.width,this._height=c??r.height,this._tileTransform=new cw({observer:{_onUpdate:()=>this.onViewUpdate()}}),o&&(this.anchor=o),this.tilePosition=s,this.tileScale=i,this.tileRotation=a,this.roundPixels=d??!1}static from(e,n={}){return typeof e=="string"?new Yo({texture:Jg.get(e),...n}):new Yo({texture:e,...n})}get uvRespectAnchor(){return aa("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){aa("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){typeof e=="number"?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=Tt.EMPTY);const n=this._texture;n!==e&&(n&&n.dynamic&&n.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,n){typeof e=="object"&&(n=e.height??e.width,e=e.width),this._width=e,this._height=n??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){const e=this._bounds,n=this._anchor,r=this._width,o=this._height;e.minX=-n._x*r,e.maxX=e.minX+r,e.minY=-n._y*o,e.maxY=e.minY+o}containsPoint(e){const n=this._width,r=this._height,o=-n*this._anchor._x;let s=0;return e.x>=o&&e.x<=o+n&&(s=-r*this._anchor._y,e.y>=s&&e.y<=s+r)}destroy(e=!1){if(super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof e=="boolean"?e:e?.texture){const r=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(r)}this._texture=null}};Hh.defaultOptions={texture:Tt.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let uw=Hh;class dw extends nh{constructor(e,n){const{text:r,resolution:o,style:s,anchor:i,width:a,height:l,roundPixels:c,...u}=e;super({...u}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=n,this.text=r??"",this.style=s,this.resolution=o??null,this.allowChildren=!1,this._anchor=new nr({_onUpdate:()=>{this.onViewUpdate()}}),i&&(this.anchor=i),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){e||(e={}),this._style?.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,n){typeof e=="object"?(n=e.height??e.width,e=e.width):n??(n=e),e!==void 0&&this._setWidth(e,this.bounds.width),n!==void 0&&this._setHeight(n,this.bounds.height)}containsPoint(e){const n=this.bounds.width,r=this.bounds.height,o=-n*this.anchor.x;let s=0;return e.x>=o&&e.x<=o+n&&(s=-r*this.anchor.y,e.y>=s&&e.y<=s+r)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e?.style)&&this._style.destroy(e),this._style=null,this._text=null}}function hw(t,e){let n=t[0]??{};return(typeof n=="string"||t[1])&&(eo(to,`use new ${e}({ text: "hi!", style }) instead`),n={text:n,style:t[1]}),n}class fw extends dw{constructor(...e){const n=hw(e,"Text");super(n,Yg),this.renderPipeId="text"}updateBounds(){const e=this._bounds,n=this._anchor,r=Zg.measureText(this._text,this._style),{width:o,height:s}=r;e.minX=-n._x*o,e.maxX=e.minX+o,e.minY=-n._y*s,e.maxY=e.minY+s}}class As extends Tt{static create(e){return new As({source:new Qg(e)})}resize(e,n,r){return this.source.resize(e,n,r),this}}const Wh=class Gh extends re{constructor(e={}){e={...Gh.defaultOptions,...e},super(),this.renderLayerChildren=[],this.sortableChildren=e.sortableChildren,this.sortFunction=e.sortFunction}attach(...e){for(let n=0;n<e.length;n++){const r=e[n];if(r.parentRenderLayer){if(r.parentRenderLayer===this)continue;r.parentRenderLayer.detach(r)}this.renderLayerChildren.push(r),r.parentRenderLayer=this;const o=this.renderGroup||this.parentRenderGroup;o&&(o.structureDidChange=!0)}return e[0]}detach(...e){for(let n=0;n<e.length;n++){const r=e[n],o=this.renderLayerChildren.indexOf(r);o!==-1&&this.renderLayerChildren.splice(o,1),r.parentRenderLayer=null;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)}return e[0]}detachAll(){const e=this.renderLayerChildren;for(let n=0;n<e.length;n++)e[n].parentRenderLayer=null;this.renderLayerChildren.length=0}collectRenderables(e,n,r){const o=this.renderLayerChildren,s=o.length;this.sortableChildren&&this.sortRenderLayerChildren();for(let i=0;i<s;i++)o[i].parent||aa("Container must be added to both layer and scene graph. Layers only handle render order - the scene graph is required for transforms (addChild)",o[i]),o[i].collectRenderables(e,n,this)}sortRenderLayerChildren(){this.renderLayerChildren.sort(this.sortFunction)}_getGlobalBoundsRecursive(e,n,r){if(!e)return;const o=this.renderLayerChildren;for(let s=0;s<o.length;s++)o[s]._getGlobalBoundsRecursive(!0,n,this)}};Wh.defaultOptions={sortableChildren:!1,sortFunction:(t,e)=>t.zIndex-e.zIndex};let pw=Wh;const jc=pw,fl="-",mw=t=>{const e=yw(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:i=>{const a=i.split(fl);return a[0]===""&&a.length!==1&&a.shift(),qh(a,e)||gw(i)},getConflictingClassGroupIds:(i,a)=>{const l=n[i]||[];return a&&r[i]?[...l,...r[i]]:l}}},qh=(t,e)=>{if(t.length===0)return e.classGroupId;const n=t[0],r=e.nextPart.get(n),o=r?qh(t.slice(1),r):void 0;if(o)return o;if(e.validators.length===0)return;const s=t.join(fl);return e.validators.find(({validator:i})=>i(s))?.classGroupId},$c=/^\[(.+)\]$/,gw=t=>{if($c.test(t)){const e=$c.exec(t)[1],n=e?.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},yw=t=>{const{theme:e,prefix:n}=t,r={nextPart:new Map,validators:[]};return ww(Object.entries(t.classGroups),n).forEach(([s,i])=>{ma(i,r,s,e)}),r},ma=(t,e,n,r)=>{t.forEach(o=>{if(typeof o=="string"){const s=o===""?e:Nc(e,o);s.classGroupId=n;return}if(typeof o=="function"){if(vw(o)){ma(o(r),e,n,r);return}e.validators.push({validator:o,classGroupId:n});return}Object.entries(o).forEach(([s,i])=>{ma(i,Nc(e,s),n,r)})})},Nc=(t,e)=>{let n=t;return e.split(fl).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},vw=t=>t.isThemeGetter,ww=(t,e)=>e?t.map(([n,r])=>{const o=r.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([i,a])=>[e+i,a])):s);return[n,o]}):t,bw=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,r=new Map;const o=(s,i)=>{n.set(s,i),e++,e>t&&(e=0,r=n,n=new Map)};return{get(s){let i=n.get(s);if(i!==void 0)return i;if((i=r.get(s))!==void 0)return o(s,i),i},set(s,i){n.has(s)?n.set(s,i):o(s,i)}}},Vh="!",xw=t=>{const{separator:e,experimentalParseClassName:n}=t,r=e.length===1,o=e[0],s=e.length,i=a=>{const l=[];let c=0,u=0,d;for(let v=0;v<a.length;v++){let w=a[v];if(c===0){if(w===o&&(r||a.slice(v,v+s)===e)){l.push(a.slice(u,v)),u=v+s;continue}if(w==="/"){d=v;continue}}w==="["?c++:w==="]"&&c--}const h=l.length===0?a:a.substring(u),p=h.startsWith(Vh),g=p?h.substring(1):h,y=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:p,baseClassName:g,maybePostfixModifierPosition:y}};return n?a=>n({className:a,parseClassName:i}):i},_w=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(r=>{r[0]==="["?(e.push(...n.sort(),r),n=[]):n.push(r)}),e.push(...n.sort()),e},Cw=t=>({cache:bw(t.cacheSize),parseClassName:xw(t),...mw(t)}),Sw=/\s+/,kw=(t,e)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:o}=e,s=[],i=t.trim().split(Sw);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:p}=n(c);let g=!!p,y=r(g?h.substring(0,p):h);if(!y){if(!g){a=c+(a.length>0?" "+a:a);continue}if(y=r(h),!y){a=c+(a.length>0?" "+a:a);continue}g=!1}const v=_w(u).join(":"),w=d?v+Vh:v,_=w+y;if(s.includes(_))continue;s.push(_);const b=o(y,g);for(let x=0;x<b.length;++x){const S=b[x];s.push(w+S)}a=c+(a.length>0?" "+a:a)}return a};function Ew(){let t=0,e,n,r="";for(;t<arguments.length;)(e=arguments[t++])&&(n=Kh(e))&&(r&&(r+=" "),r+=n);return r}const Kh=t=>{if(typeof t=="string")return t;let e,n="";for(let r=0;r<t.length;r++)t[r]&&(e=Kh(t[r]))&&(n&&(n+=" "),n+=e);return n};function Pw(t,...e){let n,r,o,s=i;function i(l){const c=e.reduce((u,d)=>d(u),t());return n=Cw(c),r=n.cache.get,o=n.cache.set,s=a,a(l)}function a(l){const c=r(l);if(c)return c;const u=kw(l,n);return o(l,u),u}return function(){return s(Ew.apply(null,arguments))}}const me=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},Xh=/^\[(?:([a-z-]+):)?(.+)\]$/i,Tw=/^\d+\/\d+$/,Aw=new Set(["px","full","screen"]),Rw=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ow=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Iw=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,jw=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,$w=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,bt=t=>lr(t)||Aw.has(t)||Tw.test(t),$t=t=>Pr(t,"length",Uw),lr=t=>!!t&&!Number.isNaN(Number(t)),pi=t=>Pr(t,"number",lr),Nr=t=>!!t&&Number.isInteger(Number(t)),Nw=t=>t.endsWith("%")&&lr(t.slice(0,-1)),te=t=>Xh.test(t),Nt=t=>Rw.test(t),Mw=new Set(["length","size","percentage"]),zw=t=>Pr(t,Mw,Jh),Dw=t=>Pr(t,"position",Jh),Lw=new Set(["image","url"]),Bw=t=>Pr(t,Lw,Ww),Fw=t=>Pr(t,"",Hw),Mr=()=>!0,Pr=(t,e,n)=>{const r=Xh.exec(t);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):n(r[2]):!1},Uw=t=>Ow.test(t)&&!Iw.test(t),Jh=()=>!1,Hw=t=>jw.test(t),Ww=t=>$w.test(t),Gw=()=>{const t=me("colors"),e=me("spacing"),n=me("blur"),r=me("brightness"),o=me("borderColor"),s=me("borderRadius"),i=me("borderSpacing"),a=me("borderWidth"),l=me("contrast"),c=me("grayscale"),u=me("hueRotate"),d=me("invert"),h=me("gap"),p=me("gradientColorStops"),g=me("gradientColorStopPositions"),y=me("inset"),v=me("margin"),w=me("opacity"),_=me("padding"),b=me("saturate"),x=me("scale"),S=me("sepia"),k=me("skew"),C=me("space"),N=me("translate"),H=()=>["auto","contain","none"],L=()=>["auto","hidden","clip","visible","scroll"],X=()=>["auto",te,e],I=()=>[te,e],ee=()=>["",bt,$t],D=()=>["auto",lr,te],J=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Y=()=>["solid","dashed","dotted","double","none"],Z=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],F=()=>["start","end","center","between","around","evenly","stretch"],ie=()=>["","0",te],ve=()=>["auto","avoid","all","avoid-page","page","left","right","column"],pe=()=>[lr,te];return{cacheSize:500,separator:":",theme:{colors:[Mr],spacing:[bt,$t],blur:["none","",Nt,te],brightness:pe(),borderColor:[t],borderRadius:["none","","full",Nt,te],borderSpacing:I(),borderWidth:ee(),contrast:pe(),grayscale:ie(),hueRotate:pe(),invert:ie(),gap:I(),gradientColorStops:[t],gradientColorStopPositions:[Nw,$t],inset:X(),margin:X(),opacity:pe(),padding:I(),saturate:pe(),scale:pe(),sepia:ie(),skew:pe(),space:I(),translate:I()},classGroups:{aspect:[{aspect:["auto","square","video",te]}],container:["container"],columns:[{columns:[Nt]}],"break-after":[{"break-after":ve()}],"break-before":[{"break-before":ve()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...J(),te]}],overflow:[{overflow:L()}],"overflow-x":[{"overflow-x":L()}],"overflow-y":[{"overflow-y":L()}],overscroll:[{overscroll:H()}],"overscroll-x":[{"overscroll-x":H()}],"overscroll-y":[{"overscroll-y":H()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[y]}],"inset-x":[{"inset-x":[y]}],"inset-y":[{"inset-y":[y]}],start:[{start:[y]}],end:[{end:[y]}],top:[{top:[y]}],right:[{right:[y]}],bottom:[{bottom:[y]}],left:[{left:[y]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Nr,te]}],basis:[{basis:X()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",te]}],grow:[{grow:ie()}],shrink:[{shrink:ie()}],order:[{order:["first","last","none",Nr,te]}],"grid-cols":[{"grid-cols":[Mr]}],"col-start-end":[{col:["auto",{span:["full",Nr,te]},te]}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":[Mr]}],"row-start-end":[{row:["auto",{span:[Nr,te]},te]}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",te]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",te]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...F()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...F(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...F(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[C]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[C]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",te,e]}],"min-w":[{"min-w":[te,e,"min","max","fit"]}],"max-w":[{"max-w":[te,e,"none","full","min","max","fit","prose",{screen:[Nt]},Nt]}],h:[{h:[te,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[te,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[te,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[te,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Nt,$t]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",pi]}],"font-family":[{font:[Mr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",te]}],"line-clamp":[{"line-clamp":["none",lr,pi]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",bt,te]}],"list-image":[{"list-image":["none",te]}],"list-style-type":[{list:["none","disc","decimal",te]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Y(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",bt,$t]}],"underline-offset":[{"underline-offset":["auto",bt,te]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",te]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",te]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...J(),Dw]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",zw]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Bw]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[g]}],"gradient-via-pos":[{via:[g]}],"gradient-to-pos":[{to:[g]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[...Y(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:Y()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...Y()]}],"outline-offset":[{"outline-offset":[bt,te]}],"outline-w":[{outline:[bt,$t]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:ee()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[bt,$t]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Nt,Fw]}],"shadow-color":[{shadow:[Mr]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":[...Z(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Z()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Nt,te]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[b]}],sepia:[{sepia:[S]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[S]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",te]}],duration:[{duration:pe()}],ease:[{ease:["linear","in","out","in-out",te]}],delay:[{delay:pe()}],animate:[{animate:["none","spin","ping","pulse","bounce",te]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[x]}],"scale-x":[{"scale-x":[x]}],"scale-y":[{"scale-y":[x]}],rotate:[{rotate:[Nr,te]}],"translate-x":[{"translate-x":[N]}],"translate-y":[{"translate-y":[N]}],"skew-x":[{"skew-x":[k]}],"skew-y":[{"skew-y":[k]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",te]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",te]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",te]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[bt,$t,pi]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},pl=Pw(Gw);function Yh(t){if(!hs(t))throw new Error(`Invalid textureId: "${t}"; textureId ∋ {${Object.keys(An.frames).sort().map(e=>`"${e}"`).join(`,
`)}}`)}function hs(t){return An.frames[t]!==void 0}function Zh(t){return An.animations[t]!==void 0}const qw=({className:t,children:e})=>t?f.jsx("div",{className:`contents ${t}`,children:e}):e,Vw=t=>t.replaceAll(/(?<!\.)\./g,"_"),z=({children:t,className:e,noSlitWords:n,classnameCycle:r,onClick:o,noTint:s=!1,TagName:i="span"})=>{const a=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(a.length===0)return null;const l=n?[a.toUpperCase()]:a.toUpperCase().split(/\s+/);return f.jsxs(i,{className:e,onClick:o,children:[f.jsx("span",{className:"sr-only",children:a}),l.map((c,u)=>f.jsx("span",{className:pl("text-nowrap inline-block",u===l.length-1?"":"me-1"),children:Array.from(c).map((d,h)=>{const p=`hud.char.${rh(d)}`;return hs(p)||console.error("no texture for char",d,d.charCodeAt(0),p,"we have:",Object.keys(Vt().textures)),f.jsx("span",{className:`sprite ${hs(p)?`texture-${Vw(p)}`:"texture-hud_char_?"}
                  ${s?"":"sprite-tinted"}
                  ${r===void 0?"":r[h%r.length]}`},h)})},u))]})},Kw=t=>t.props.children!==void 0,tt=({children:t,className:e})=>f.jsx(qw,{className:e,children:Array.isArray(t)?t.map((n,r)=>f.jsx(tt,{children:n},r)):typeof t=="number"?f.jsx(z,{children:String(t)}):typeof t=="string"?f.jsx(z,{children:t}):m.isValidElement(t)?t.type===z||t.type===tt?t:Kw(t)?m.cloneElement(t,void 0,typeof t.props.children=="string"?f.jsx(z,{children:`${t.props.children}`}):f.jsx(tt,{children:t.props.children})):t:t});function Ke(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t?.(o),n===!1||!o.defaultPrevented)return e?.(o)}}function Mc(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Qh(...t){return e=>{let n=!1;const r=t.map(o=>{const s=Mc(o,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():Mc(t[o],null)}}}}function at(...t){return m.useCallback(Qh(...t),t)}function Xw(t,e){const n=m.createContext(e),r=s=>{const{children:i,...a}=s,l=m.useMemo(()=>a,Object.values(a));return f.jsx(n.Provider,{value:l,children:i})};r.displayName=t+"Provider";function o(s){const i=m.useContext(n);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[r,o]}function ml(t,e=[]){let n=[];function r(s,i){const a=m.createContext(i),l=n.length;n=[...n,i];const c=d=>{const{scope:h,children:p,...g}=d,y=h?.[t]?.[l]||a,v=m.useMemo(()=>g,Object.values(g));return f.jsx(y.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(d,h){const p=h?.[t]?.[l]||a,g=m.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=n.map(i=>m.createContext(i));return function(a){const l=a?.[t]||s;return m.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[r,Jw(o,...e)]}function Jw(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}var Rs=ey();const ef=Ot(Rs);var Os=m.forwardRef((t,e)=>{const{children:n,...r}=t,o=m.Children.toArray(n),s=o.find(Zw);if(s){const i=s.props.children,a=o.map(l=>l===s?m.Children.count(i)>1?m.Children.only(null):m.isValidElement(i)?i.props.children:null:l);return f.jsx(ga,{...r,ref:e,children:m.isValidElement(i)?m.cloneElement(i,void 0,a):null})}return f.jsx(ga,{...r,ref:e,children:n})});Os.displayName="Slot";var ga=m.forwardRef((t,e)=>{const{children:n,...r}=t;if(m.isValidElement(n)){const o=eb(n),s=Qw(r,n.props);return n.type!==m.Fragment&&(s.ref=e?Qh(e,o):o),m.cloneElement(n,s)}return m.Children.count(n)>1?m.Children.only(null):null});ga.displayName="SlotClone";var Yw=({children:t})=>f.jsx(f.Fragment,{children:t});function Zw(t){return m.isValidElement(t)&&t.type===Yw}function Qw(t,e){const n={...e};for(const r in e){const o=t[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{s(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...t,...n}}function eb(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var tb=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],be=tb.reduce((t,e)=>{const n=m.forwardRef((r,o)=>{const{asChild:s,...i}=r,a=s?Os:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),f.jsx(a,{...i,ref:o})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function nb(t,e){t&&Rs.flushSync(()=>t.dispatchEvent(e))}function Jt(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t}),m.useMemo(()=>(...n)=>e.current?.(...n),[])}function rb(t,e=globalThis?.document){const n=Jt(t);m.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var ob="DismissableLayer",ya="dismissableLayer.update",sb="dismissableLayer.pointerDownOutside",ib="dismissableLayer.focusOutside",zc,tf=m.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),gl=m.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=m.useContext(tf),[u,d]=m.useState(null),h=u?.ownerDocument??globalThis?.document,[,p]=m.useState({}),g=at(e,C=>d(C)),y=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),w=y.indexOf(v),_=u?y.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,x=_>=w,S=cb(C=>{const N=C.target,H=[...c.branches].some(L=>L.contains(N));!x||H||(o?.(C),i?.(C),C.defaultPrevented||a?.())},h),k=ub(C=>{const N=C.target;[...c.branches].some(L=>L.contains(N))||(s?.(C),i?.(C),C.defaultPrevented||a?.())},h);return rb(C=>{_===c.layers.size-1&&(r?.(C),!C.defaultPrevented&&a&&(C.preventDefault(),a()))},h),m.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(zc=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),Dc(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=zc)}},[u,h,n,c]),m.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),Dc())},[u,c]),m.useEffect(()=>{const C=()=>p({});return document.addEventListener(ya,C),()=>document.removeEventListener(ya,C)},[]),f.jsx(be.div,{...l,ref:g,style:{pointerEvents:b?x?"auto":"none":void 0,...t.style},onFocusCapture:Ke(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Ke(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Ke(t.onPointerDownCapture,S.onPointerDownCapture)})});gl.displayName=ob;var ab="DismissableLayerBranch",lb=m.forwardRef((t,e)=>{const n=m.useContext(tf),r=m.useRef(null),o=at(e,r);return m.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),f.jsx(be.div,{...t,ref:o})});lb.displayName=ab;function cb(t,e=globalThis?.document){const n=Jt(t),r=m.useRef(!1),o=m.useRef(()=>{});return m.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){nf(sb,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function ub(t,e=globalThis?.document){const n=Jt(t),r=m.useRef(!1);return m.useEffect(()=>{const o=s=>{s.target&&!r.current&&nf(ib,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Dc(){const t=new CustomEvent(ya);document.dispatchEvent(t)}function nf(t,e,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?nb(o,s):o.dispatchEvent(s)}var mi=0;function rf(){m.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Lc()),document.body.insertAdjacentElement("beforeend",t[1]??Lc()),mi++,()=>{mi===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),mi--}},[])}function Lc(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var gi="focusScope.autoFocusOnMount",yi="focusScope.autoFocusOnUnmount",Bc={bubbles:!1,cancelable:!0},db="FocusScope",yl=m.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=t,[a,l]=m.useState(null),c=Jt(o),u=Jt(s),d=m.useRef(null),h=at(e,y=>l(y)),p=m.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;m.useEffect(()=>{if(r){let y=function(b){if(p.paused||!a)return;const x=b.target;a.contains(x)?d.current=x:Lt(d.current,{select:!0})},v=function(b){if(p.paused||!a)return;const x=b.relatedTarget;x!==null&&(a.contains(x)||Lt(d.current,{select:!0}))},w=function(b){if(document.activeElement===document.body)for(const S of b)S.removedNodes.length>0&&Lt(a)};document.addEventListener("focusin",y),document.addEventListener("focusout",v);const _=new MutationObserver(w);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",v),_.disconnect()}}},[r,a,p.paused]),m.useEffect(()=>{if(a){Uc.add(p);const y=document.activeElement;if(!a.contains(y)){const w=new CustomEvent(gi,Bc);a.addEventListener(gi,c),a.dispatchEvent(w),w.defaultPrevented||(hb(yb(of(a)),{select:!0}),document.activeElement===y&&Lt(a))}return()=>{a.removeEventListener(gi,c),setTimeout(()=>{const w=new CustomEvent(yi,Bc);a.addEventListener(yi,u),a.dispatchEvent(w),w.defaultPrevented||Lt(y??document.body,{select:!0}),a.removeEventListener(yi,u),Uc.remove(p)},0)}}},[a,c,u,p]);const g=m.useCallback(y=>{if(!n&&!r||p.paused)return;const v=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,w=document.activeElement;if(v&&w){const _=y.currentTarget,[b,x]=fb(_);b&&x?!y.shiftKey&&w===x?(y.preventDefault(),n&&Lt(b,{select:!0})):y.shiftKey&&w===b&&(y.preventDefault(),n&&Lt(x,{select:!0})):w===_&&y.preventDefault()}},[n,r,p.paused]);return f.jsx(be.div,{tabIndex:-1,...i,ref:h,onKeyDown:g})});yl.displayName=db;function hb(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(Lt(r,{select:e}),document.activeElement!==n)return}function fb(t){const e=of(t),n=Fc(e,t),r=Fc(e.reverse(),t);return[n,r]}function of(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Fc(t,e){for(const n of t)if(!pb(n,{upTo:e}))return n}function pb(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function mb(t){return t instanceof HTMLInputElement&&"select"in t}function Lt(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&mb(t)&&e&&t.select()}}var Uc=gb();function gb(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=Hc(t,e),t.unshift(e)},remove(e){t=Hc(t,e),t[0]?.resume()}}}function Hc(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function yb(t){return t.filter(e=>e.tagName!=="A")}var bn=globalThis?.document?m.useLayoutEffect:()=>{},vb=ks.useId||(()=>{}),wb=0;function ft(t){const[e,n]=m.useState(vb());return bn(()=>{n(r=>r??String(wb++))},[t]),t||(e?`radix-${e}`:"")}const bb=["top","right","bottom","left"],Yt=Math.min,Ve=Math.max,fs=Math.round,Io=Math.floor,pt=t=>({x:t,y:t}),xb={left:"right",right:"left",bottom:"top",top:"bottom"},_b={start:"end",end:"start"};function va(t,e,n){return Ve(t,Yt(e,n))}function At(t,e){return typeof t=="function"?t(e):t}function Rt(t){return t.split("-")[0]}function Tr(t){return t.split("-")[1]}function vl(t){return t==="x"?"y":"x"}function wl(t){return t==="y"?"height":"width"}function Zt(t){return["top","bottom"].includes(Rt(t))?"y":"x"}function bl(t){return vl(Zt(t))}function Cb(t,e,n){n===void 0&&(n=!1);const r=Tr(t),o=bl(t),s=wl(o);let i=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(i=ps(i)),[i,ps(i)]}function Sb(t){const e=ps(t);return[wa(t),e,wa(e)]}function wa(t){return t.replace(/start|end/g,e=>_b[e])}function kb(t,e,n){const r=["left","right"],o=["right","left"],s=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return n?e?o:r:e?r:o;case"left":case"right":return e?s:i;default:return[]}}function Eb(t,e,n,r){const o=Tr(t);let s=kb(Rt(t),n==="start",r);return o&&(s=s.map(i=>i+"-"+o),e&&(s=s.concat(s.map(wa)))),s}function ps(t){return t.replace(/left|right|bottom|top/g,e=>xb[e])}function Pb(t){return{top:0,right:0,bottom:0,left:0,...t}}function sf(t){return typeof t!="number"?Pb(t):{top:t,right:t,bottom:t,left:t}}function ms(t){const{x:e,y:n,width:r,height:o}=t;return{width:r,height:o,top:n,left:e,right:e+r,bottom:n+o,x:e,y:n}}function Wc(t,e,n){let{reference:r,floating:o}=t;const s=Zt(e),i=bl(e),a=wl(i),l=Rt(e),c=s==="y",u=r.x+r.width/2-o.width/2,d=r.y+r.height/2-o.height/2,h=r[a]/2-o[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-o.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-o.width,y:d};break;default:p={x:r.x,y:r.y}}switch(Tr(e)){case"start":p[i]-=h*(n&&c?-1:1);break;case"end":p[i]+=h*(n&&c?-1:1);break}return p}const Tb=async(t,e,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:s=[],platform:i}=n,a=s.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:o}),{x:u,y:d}=Wc(c,r,l),h=r,p={},g=0;for(let y=0;y<a.length;y++){const{name:v,fn:w}=a[y],{x:_,y:b,data:x,reset:S}=await w({x:u,y:d,initialPlacement:r,placement:h,strategy:o,middlewareData:p,rects:c,platform:i,elements:{reference:t,floating:e}});u=_??u,d=b??d,p={...p,[v]:{...p[v],...x}},S&&g<=50&&(g++,typeof S=="object"&&(S.placement&&(h=S.placement),S.rects&&(c=S.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:o}):S.rects),{x:u,y:d}=Wc(c,h,l)),y=-1)}return{x:u,y:d,placement:h,strategy:o,middlewareData:p}};async function no(t,e){var n;e===void 0&&(e={});const{x:r,y:o,platform:s,rects:i,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=At(e,t),g=sf(p),v=a[h?d==="floating"?"reference":"floating":d],w=ms(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(v)))==null||n?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),_=d==="floating"?{x:r,y:o,width:i.floating.width,height:i.floating.height}:i.reference,b=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),x=await(s.isElement==null?void 0:s.isElement(b))?await(s.getScale==null?void 0:s.getScale(b))||{x:1,y:1}:{x:1,y:1},S=ms(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:b,strategy:l}):_);return{top:(w.top-S.top+g.top)/x.y,bottom:(S.bottom-w.bottom+g.bottom)/x.y,left:(w.left-S.left+g.left)/x.x,right:(S.right-w.right+g.right)/x.x}}const Ab=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:o,rects:s,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=At(t,e)||{};if(c==null)return{};const d=sf(u),h={x:n,y:r},p=bl(o),g=wl(p),y=await i.getDimensions(c),v=p==="y",w=v?"top":"left",_=v?"bottom":"right",b=v?"clientHeight":"clientWidth",x=s.reference[g]+s.reference[p]-h[p]-s.floating[g],S=h[p]-s.reference[p],k=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let C=k?k[b]:0;(!C||!await(i.isElement==null?void 0:i.isElement(k)))&&(C=a.floating[b]||s.floating[g]);const N=x/2-S/2,H=C/2-y[g]/2-1,L=Yt(d[w],H),X=Yt(d[_],H),I=L,ee=C-y[g]-X,D=C/2-y[g]/2+N,J=va(I,D,ee),Y=!l.arrow&&Tr(o)!=null&&D!==J&&s.reference[g]/2-(D<I?L:X)-y[g]/2<0,Z=Y?D<I?D-I:D-ee:0;return{[p]:h[p]+Z,data:{[p]:J,centerOffset:D-J-Z,...Y&&{alignmentOffset:Z}},reset:Y}}}),Rb=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:y=!0,...v}=At(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const w=Rt(o),_=Zt(a),b=Rt(a)===a,x=await(l.isRTL==null?void 0:l.isRTL(c.floating)),S=h||(b||!y?[ps(a)]:Sb(a)),k=g!=="none";!h&&k&&S.push(...Eb(a,y,g,x));const C=[a,...S],N=await no(e,v),H=[];let L=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&H.push(N[w]),d){const D=Cb(o,i,x);H.push(N[D[0]],N[D[1]])}if(L=[...L,{placement:o,overflows:H}],!H.every(D=>D<=0)){var X,I;const D=(((X=s.flip)==null?void 0:X.index)||0)+1,J=C[D];if(J)return{data:{index:D,overflows:L},reset:{placement:J}};let Y=(I=L.filter(Z=>Z.overflows[0]<=0).sort((Z,F)=>Z.overflows[1]-F.overflows[1])[0])==null?void 0:I.placement;if(!Y)switch(p){case"bestFit":{var ee;const Z=(ee=L.filter(F=>{if(k){const ie=Zt(F.placement);return ie===_||ie==="y"}return!0}).map(F=>[F.placement,F.overflows.filter(ie=>ie>0).reduce((ie,ve)=>ie+ve,0)]).sort((F,ie)=>F[1]-ie[1])[0])==null?void 0:ee[0];Z&&(Y=Z);break}case"initialPlacement":Y=a;break}if(o!==Y)return{reset:{placement:Y}}}return{}}}};function Gc(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function qc(t){return bb.some(e=>t[e]>=0)}const Ob=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...o}=At(t,e);switch(r){case"referenceHidden":{const s=await no(e,{...o,elementContext:"reference"}),i=Gc(s,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:qc(i)}}}case"escaped":{const s=await no(e,{...o,altBoundary:!0}),i=Gc(s,n.floating);return{data:{escapedOffsets:i,escaped:qc(i)}}}default:return{}}}}};async function Ib(t,e){const{placement:n,platform:r,elements:o}=t,s=await(r.isRTL==null?void 0:r.isRTL(o.floating)),i=Rt(n),a=Tr(n),l=Zt(n)==="y",c=["left","top"].includes(i)?-1:1,u=s&&l?-1:1,d=At(e,t);let{mainAxis:h,crossAxis:p,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(p=a==="end"?g*-1:g),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}const jb=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:o,y:s,placement:i,middlewareData:a}=e,l=await Ib(e,t);return i===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:o+l.x,y:s+l.y,data:{...l,placement:i}}}}},$b=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:o}=e,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:v=>{let{x:w,y:_}=v;return{x:w,y:_}}},...l}=At(t,e),c={x:n,y:r},u=await no(e,l),d=Zt(Rt(o)),h=vl(d);let p=c[h],g=c[d];if(s){const v=h==="y"?"top":"left",w=h==="y"?"bottom":"right",_=p+u[v],b=p-u[w];p=va(_,p,b)}if(i){const v=d==="y"?"top":"left",w=d==="y"?"bottom":"right",_=g+u[v],b=g-u[w];g=va(_,g,b)}const y=a.fn({...e,[h]:p,[d]:g});return{...y,data:{x:y.x-n,y:y.y-r,enabled:{[h]:s,[d]:i}}}}}},Nb=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:o,rects:s,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=At(t,e),u={x:n,y:r},d=Zt(o),h=vl(d);let p=u[h],g=u[d];const y=At(a,e),v=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(l){const b=h==="y"?"height":"width",x=s.reference[h]-s.floating[b]+v.mainAxis,S=s.reference[h]+s.reference[b]-v.mainAxis;p<x?p=x:p>S&&(p=S)}if(c){var w,_;const b=h==="y"?"width":"height",x=["top","left"].includes(Rt(o)),S=s.reference[d]-s.floating[b]+(x&&((w=i.offset)==null?void 0:w[d])||0)+(x?0:v.crossAxis),k=s.reference[d]+s.reference[b]+(x?0:((_=i.offset)==null?void 0:_[d])||0)-(x?v.crossAxis:0);g<S?g=S:g>k&&(g=k)}return{[h]:p,[d]:g}}}},Mb=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:o,rects:s,platform:i,elements:a}=e,{apply:l=()=>{},...c}=At(t,e),u=await no(e,c),d=Rt(o),h=Tr(o),p=Zt(o)==="y",{width:g,height:y}=s.floating;let v,w;d==="top"||d==="bottom"?(v=d,w=h===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(w=d,v=h==="end"?"top":"bottom");const _=y-u.top-u.bottom,b=g-u.left-u.right,x=Yt(y-u[v],_),S=Yt(g-u[w],b),k=!e.middlewareData.shift;let C=x,N=S;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(N=b),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(C=_),k&&!h){const L=Ve(u.left,0),X=Ve(u.right,0),I=Ve(u.top,0),ee=Ve(u.bottom,0);p?N=g-2*(L!==0||X!==0?L+X:Ve(u.left,u.right)):C=y-2*(I!==0||ee!==0?I+ee:Ve(u.top,u.bottom))}await l({...e,availableWidth:N,availableHeight:C});const H=await i.getDimensions(a.floating);return g!==H.width||y!==H.height?{reset:{rects:!0}}:{}}}};function Is(){return typeof window<"u"}function Ar(t){return af(t)?(t.nodeName||"").toLowerCase():"#document"}function Xe(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function wt(t){var e;return(e=(af(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function af(t){return Is()?t instanceof Node||t instanceof Xe(t).Node:!1}function st(t){return Is()?t instanceof Element||t instanceof Xe(t).Element:!1}function mt(t){return Is()?t instanceof HTMLElement||t instanceof Xe(t).HTMLElement:!1}function Vc(t){return!Is()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Xe(t).ShadowRoot}function fo(t){const{overflow:e,overflowX:n,overflowY:r,display:o}=it(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(o)}function zb(t){return["table","td","th"].includes(Ar(t))}function js(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function xl(t){const e=_l(),n=st(t)?it(t):t;return["transform","translate","scale","rotate","perspective"].some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function Db(t){let e=Qt(t);for(;mt(e)&&!gr(e);){if(xl(e))return e;if(js(e))return null;e=Qt(e)}return null}function _l(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function gr(t){return["html","body","#document"].includes(Ar(t))}function it(t){return Xe(t).getComputedStyle(t)}function $s(t){return st(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Qt(t){if(Ar(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Vc(t)&&t.host||wt(t);return Vc(e)?e.host:e}function lf(t){const e=Qt(t);return gr(e)?t.ownerDocument?t.ownerDocument.body:t.body:mt(e)&&fo(e)?e:lf(e)}function ro(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const o=lf(t),s=o===((r=t.ownerDocument)==null?void 0:r.body),i=Xe(o);if(s){const a=ba(i);return e.concat(i,i.visualViewport||[],fo(o)?o:[],a&&n?ro(a):[])}return e.concat(o,ro(o,[],n))}function ba(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function cf(t){const e=it(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=mt(t),s=o?t.offsetWidth:n,i=o?t.offsetHeight:r,a=fs(n)!==s||fs(r)!==i;return a&&(n=s,r=i),{width:n,height:r,$:a}}function Cl(t){return st(t)?t:t.contextElement}function cr(t){const e=Cl(t);if(!mt(e))return pt(1);const n=e.getBoundingClientRect(),{width:r,height:o,$:s}=cf(e);let i=(s?fs(n.width):n.width)/r,a=(s?fs(n.height):n.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const Lb=pt(0);function uf(t){const e=Xe(t);return!_l()||!e.visualViewport?Lb:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Bb(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Xe(t)?!1:e}function xn(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const o=t.getBoundingClientRect(),s=Cl(t);let i=pt(1);e&&(r?st(r)&&(i=cr(r)):i=cr(t));const a=Bb(s,n,r)?uf(s):pt(0);let l=(o.left+a.x)/i.x,c=(o.top+a.y)/i.y,u=o.width/i.x,d=o.height/i.y;if(s){const h=Xe(s),p=r&&st(r)?Xe(r):r;let g=h,y=ba(g);for(;y&&r&&p!==g;){const v=cr(y),w=y.getBoundingClientRect(),_=it(y),b=w.left+(y.clientLeft+parseFloat(_.paddingLeft))*v.x,x=w.top+(y.clientTop+parseFloat(_.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,d*=v.y,l+=b,c+=x,g=Xe(y),y=ba(g)}}return ms({width:u,height:d,x:l,y:c})}function Sl(t,e){const n=$s(t).scrollLeft;return e?e.left+n:xn(wt(t)).left+n}function df(t,e,n){n===void 0&&(n=!1);const r=t.getBoundingClientRect(),o=r.left+e.scrollLeft-(n?0:Sl(t,r)),s=r.top+e.scrollTop;return{x:o,y:s}}function Fb(t){let{elements:e,rect:n,offsetParent:r,strategy:o}=t;const s=o==="fixed",i=wt(r),a=e?js(e.floating):!1;if(r===i||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=pt(1);const u=pt(0),d=mt(r);if((d||!d&&!s)&&((Ar(r)!=="body"||fo(i))&&(l=$s(r)),mt(r))){const p=xn(r);c=cr(r),u.x=p.x+r.clientLeft,u.y=p.y+r.clientTop}const h=i&&!d&&!s?df(i,l,!0):pt(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:n.y*c.y-l.scrollTop*c.y+u.y+h.y}}function Ub(t){return Array.from(t.getClientRects())}function Hb(t){const e=wt(t),n=$s(t),r=t.ownerDocument.body,o=Ve(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Ve(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let i=-n.scrollLeft+Sl(t);const a=-n.scrollTop;return it(r).direction==="rtl"&&(i+=Ve(e.clientWidth,r.clientWidth)-o),{width:o,height:s,x:i,y:a}}function Wb(t,e){const n=Xe(t),r=wt(t),o=n.visualViewport;let s=r.clientWidth,i=r.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;const c=_l();(!c||c&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:s,height:i,x:a,y:l}}function Gb(t,e){const n=xn(t,!0,e==="fixed"),r=n.top+t.clientTop,o=n.left+t.clientLeft,s=mt(t)?cr(t):pt(1),i=t.clientWidth*s.x,a=t.clientHeight*s.y,l=o*s.x,c=r*s.y;return{width:i,height:a,x:l,y:c}}function Kc(t,e,n){let r;if(e==="viewport")r=Wb(t,n);else if(e==="document")r=Hb(wt(t));else if(st(e))r=Gb(e,n);else{const o=uf(t);r={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return ms(r)}function hf(t,e){const n=Qt(t);return n===e||!st(n)||gr(n)?!1:it(n).position==="fixed"||hf(n,e)}function qb(t,e){const n=e.get(t);if(n)return n;let r=ro(t,[],!1).filter(a=>st(a)&&Ar(a)!=="body"),o=null;const s=it(t).position==="fixed";let i=s?Qt(t):t;for(;st(i)&&!gr(i);){const a=it(i),l=xl(i);!l&&a.position==="fixed"&&(o=null),(s?!l&&!o:!l&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||fo(i)&&!l&&hf(t,i))?r=r.filter(u=>u!==i):o=a,i=Qt(i)}return e.set(t,r),r}function Vb(t){let{element:e,boundary:n,rootBoundary:r,strategy:o}=t;const i=[...n==="clippingAncestors"?js(e)?[]:qb(e,this._c):[].concat(n),r],a=i[0],l=i.reduce((c,u)=>{const d=Kc(e,u,o);return c.top=Ve(d.top,c.top),c.right=Yt(d.right,c.right),c.bottom=Yt(d.bottom,c.bottom),c.left=Ve(d.left,c.left),c},Kc(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Kb(t){const{width:e,height:n}=cf(t);return{width:e,height:n}}function Xb(t,e,n){const r=mt(e),o=wt(e),s=n==="fixed",i=xn(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=pt(0);if(r||!r&&!s)if((Ar(e)!=="body"||fo(o))&&(a=$s(e)),r){const h=xn(e,!0,s,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else o&&(l.x=Sl(o));const c=o&&!r&&!s?df(o,a):pt(0),u=i.left+a.scrollLeft-l.x-c.x,d=i.top+a.scrollTop-l.y-c.y;return{x:u,y:d,width:i.width,height:i.height}}function vi(t){return it(t).position==="static"}function Xc(t,e){if(!mt(t)||it(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return wt(t)===n&&(n=n.ownerDocument.body),n}function ff(t,e){const n=Xe(t);if(js(t))return n;if(!mt(t)){let o=Qt(t);for(;o&&!gr(o);){if(st(o)&&!vi(o))return o;o=Qt(o)}return n}let r=Xc(t,e);for(;r&&zb(r)&&vi(r);)r=Xc(r,e);return r&&gr(r)&&vi(r)&&!xl(r)?n:r||Db(t)||n}const Jb=async function(t){const e=this.getOffsetParent||ff,n=this.getDimensions,r=await n(t.floating);return{reference:Xb(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Yb(t){return it(t).direction==="rtl"}const Zb={convertOffsetParentRelativeRectToViewportRelativeRect:Fb,getDocumentElement:wt,getClippingRect:Vb,getOffsetParent:ff,getElementRects:Jb,getClientRects:Ub,getDimensions:Kb,getScale:cr,isElement:st,isRTL:Yb};function pf(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Qb(t,e){let n=null,r;const o=wt(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:h,height:p}=c;if(a||e(),!h||!p)return;const g=Io(d),y=Io(o.clientWidth-(u+h)),v=Io(o.clientHeight-(d+p)),w=Io(u),b={rootMargin:-g+"px "+-y+"px "+-v+"px "+-w+"px",threshold:Ve(0,Yt(1,l))||1};let x=!0;function S(k){const C=k[0].intersectionRatio;if(C!==l){if(!x)return i();C?i(!1,C):r=setTimeout(()=>{i(!1,1e-7)},1e3)}C===1&&!pf(c,t.getBoundingClientRect())&&i(),x=!1}try{n=new IntersectionObserver(S,{...b,root:o.ownerDocument})}catch{n=new IntersectionObserver(S,b)}n.observe(t)}return i(!0),s}function mf(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=Cl(t),u=o||s?[...c?ro(c):[],...ro(e)]:[];u.forEach(w=>{o&&w.addEventListener("scroll",n,{passive:!0}),s&&w.addEventListener("resize",n)});const d=c&&a?Qb(c,n):null;let h=-1,p=null;i&&(p=new ResizeObserver(w=>{let[_]=w;_&&_.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var b;(b=p)==null||b.observe(e)})),n()}),c&&!l&&p.observe(c),p.observe(e));let g,y=l?xn(t):null;l&&v();function v(){const w=xn(t);y&&!pf(y,w)&&n(),y=w,g=requestAnimationFrame(v)}return n(),()=>{var w;u.forEach(_=>{o&&_.removeEventListener("scroll",n),s&&_.removeEventListener("resize",n)}),d?.(),(w=p)==null||w.disconnect(),p=null,l&&cancelAnimationFrame(g)}}const ex=jb,tx=$b,nx=Rb,rx=Mb,ox=Ob,Jc=Ab,sx=Nb,ix=(t,e,n)=>{const r=new Map,o={platform:Zb,...n},s={...o.platform,_c:r};return Tb(t,e,{...o,platform:s})};var Zo=typeof document<"u"?m.useLayoutEffect:m.useEffect;function gs(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!gs(t[r],e[r]))return!1;return!0}if(o=Object.keys(t),n=o.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,o[r]))return!1;for(r=n;r--!==0;){const s=o[r];if(!(s==="_owner"&&t.$$typeof)&&!gs(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function gf(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Yc(t,e){const n=gf(t);return Math.round(e*n)/n}function wi(t){const e=m.useRef(t);return Zo(()=>{e.current=t}),e}function yf(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=m.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=m.useState(r);gs(h,r)||p(r);const[g,y]=m.useState(null),[v,w]=m.useState(null),_=m.useCallback(F=>{F!==k.current&&(k.current=F,y(F))},[]),b=m.useCallback(F=>{F!==C.current&&(C.current=F,w(F))},[]),x=s||g,S=i||v,k=m.useRef(null),C=m.useRef(null),N=m.useRef(u),H=l!=null,L=wi(l),X=wi(o),I=wi(c),ee=m.useCallback(()=>{if(!k.current||!C.current)return;const F={placement:e,strategy:n,middleware:h};X.current&&(F.platform=X.current),ix(k.current,C.current,F).then(ie=>{const ve={...ie,isPositioned:I.current!==!1};D.current&&!gs(N.current,ve)&&(N.current=ve,Rs.flushSync(()=>{d(ve)}))})},[h,e,n,X,I]);Zo(()=>{c===!1&&N.current.isPositioned&&(N.current.isPositioned=!1,d(F=>({...F,isPositioned:!1})))},[c]);const D=m.useRef(!1);Zo(()=>(D.current=!0,()=>{D.current=!1}),[]),Zo(()=>{if(x&&(k.current=x),S&&(C.current=S),x&&S){if(L.current)return L.current(x,S,ee);ee()}},[x,S,ee,L,H]);const J=m.useMemo(()=>({reference:k,floating:C,setReference:_,setFloating:b}),[_,b]),Y=m.useMemo(()=>({reference:x,floating:S}),[x,S]),Z=m.useMemo(()=>{const F={position:n,left:0,top:0};if(!Y.floating)return F;const ie=Yc(Y.floating,u.x),ve=Yc(Y.floating,u.y);return a?{...F,transform:"translate("+ie+"px, "+ve+"px)",...gf(Y.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:ie,top:ve}},[n,a,Y.floating,u.x,u.y]);return m.useMemo(()=>({...u,update:ee,refs:J,elements:Y,floatingStyles:Z}),[u,ee,J,Y,Z])}const ax=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:o}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?Jc({element:r.current,padding:o}).fn(n):{}:r?Jc({element:r,padding:o}).fn(n):{}}}},vf=(t,e)=>({...ex(t),options:[t,e]}),wf=(t,e)=>({...tx(t),options:[t,e]}),bf=(t,e)=>({...sx(t),options:[t,e]}),xf=(t,e)=>({...nx(t),options:[t,e]}),_f=(t,e)=>({...rx(t),options:[t,e]}),Cf=(t,e)=>({...ox(t),options:[t,e]}),Sf=(t,e)=>({...ax(t),options:[t,e]});var lx="Arrow",kf=m.forwardRef((t,e)=>{const{children:n,width:r=10,height:o=5,...s}=t;return f.jsx(be.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:f.jsx("polygon",{points:"0,0 30,0 15,10"})})});kf.displayName=lx;var cx=kf;function ux(t){const[e,n]=m.useState(void 0);return bn(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var kl="Popper",[Ef,Pf]=ml(kl),[dx,Tf]=Ef(kl),Af=t=>{const{__scopePopper:e,children:n}=t,[r,o]=m.useState(null);return f.jsx(dx,{scope:e,anchor:r,onAnchorChange:o,children:n})};Af.displayName=kl;var Rf="PopperAnchor",Of=m.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,s=Tf(Rf,n),i=m.useRef(null),a=at(e,i);return m.useEffect(()=>{s.onAnchorChange(r?.current||i.current)}),r?null:f.jsx(be.div,{...o,ref:a})});Of.displayName=Rf;var El="PopperContent",[hx,fx]=Ef(El),If=m.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:g,...y}=t,v=Tf(El,n),[w,_]=m.useState(null),b=at(e,A=>_(A)),[x,S]=m.useState(null),k=ux(x),C=k?.width??0,N=k?.height??0,H=r+(s!=="center"?"-"+s:""),L=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},X=Array.isArray(c)?c:[c],I=X.length>0,ee={padding:L,boundary:X.filter(mx),altBoundary:I},{refs:D,floatingStyles:J,placement:Y,isPositioned:Z,middlewareData:F}=yf({strategy:"fixed",placement:H,whileElementsMounted:(...A)=>mf(...A,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[vf({mainAxis:o+N,alignmentAxis:i}),l&&wf({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?bf():void 0,...ee}),l&&xf({...ee}),_f({...ee,apply:({elements:A,rects:M,availableWidth:oe,availableHeight:le})=>{const{width:Ne,height:Me}=M.reference,ae=A.floating.style;ae.setProperty("--radix-popper-available-width",`${oe}px`),ae.setProperty("--radix-popper-available-height",`${le}px`),ae.setProperty("--radix-popper-anchor-width",`${Ne}px`),ae.setProperty("--radix-popper-anchor-height",`${Me}px`)}}),x&&Sf({element:x,padding:a}),gx({arrowWidth:C,arrowHeight:N}),h&&Cf({strategy:"referenceHidden",...ee})]}),[ie,ve]=Nf(Y),pe=Jt(g);bn(()=>{Z&&pe?.()},[Z,pe]);const P=F.arrow?.x,E=F.arrow?.y,R=F.arrow?.centerOffset!==0,[T,O]=m.useState();return bn(()=>{w&&O(window.getComputedStyle(w).zIndex)},[w]),f.jsx("div",{ref:D.setFloating,"data-radix-popper-content-wrapper":"",style:{...J,transform:Z?J.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:T,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:f.jsx(hx,{scope:n,placedSide:ie,onArrowChange:S,arrowX:P,arrowY:E,shouldHideArrow:R,children:f.jsx(be.div,{"data-side":ie,"data-align":ve,...y,ref:b,style:{...y.style,animation:Z?void 0:"none"}})})})});If.displayName=El;var jf="PopperArrow",px={top:"bottom",right:"left",bottom:"top",left:"right"},$f=m.forwardRef(function(e,n){const{__scopePopper:r,...o}=e,s=fx(jf,r),i=px[s.placedSide];return f.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:f.jsx(cx,{...o,ref:n,style:{...o.style,display:"block"}})})});$f.displayName=jf;function mx(t){return t!==null}var gx=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=Nf(n),d={start:"0%",center:"50%",end:"100%"}[u],h=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let g="",y="";return c==="bottom"?(g=i?d:`${h}px`,y=`${-l}px`):c==="top"?(g=i?d:`${h}px`,y=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,y=i?d:`${p}px`):c==="left"&&(g=`${r.floating.width+l}px`,y=i?d:`${p}px`),{data:{x:g,y}}}});function Nf(t){const[e,n="center"]=t.split("-");return[e,n]}var yx=Af,Mf=Of,vx=If,wx=$f,bx="Portal",zf=m.forwardRef((t,e)=>{const{container:n,...r}=t,[o,s]=m.useState(!1);bn(()=>s(!0),[]);const i=n||o&&globalThis?.document?.body;return i?ef.createPortal(f.jsx(be.div,{...r,ref:e}),i):null});zf.displayName=bx;function xx(t,e){return m.useReducer((n,r)=>e[n][r]??n,t)}var po=t=>{const{present:e,children:n}=t,r=_x(e),o=typeof n=="function"?n({present:r.isPresent}):m.Children.only(n),s=at(r.ref,Cx(o));return typeof n=="function"||r.isPresent?m.cloneElement(o,{ref:s}):null};po.displayName="Presence";function _x(t){const[e,n]=m.useState(),r=m.useRef({}),o=m.useRef(t),s=m.useRef("none"),i=t?"mounted":"unmounted",[a,l]=xx(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return m.useEffect(()=>{const c=jo(r.current);s.current=a==="mounted"?c:"none"},[a]),bn(()=>{const c=r.current,u=o.current;if(u!==t){const h=s.current,p=jo(c);t?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&h!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),bn(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const y=jo(r.current).includes(p.animationName);if(p.target===e&&y&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},h=p=>{p.target===e&&(s.current=jo(r.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:m.useCallback(c=>{c&&(r.current=getComputedStyle(c)),n(c)},[])}}function jo(t){return t?.animationName||"none"}function Cx(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function Df({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,o]=Sx({defaultProp:e,onChange:n}),s=t!==void 0,i=s?t:r,a=Jt(n),l=m.useCallback(c=>{if(s){const d=typeof c=="function"?c(t):c;d!==t&&a(d)}else o(c)},[s,t,o,a]);return[i,l]}function Sx({defaultProp:t,onChange:e}){const n=m.useState(t),[r]=n,o=m.useRef(r),s=Jt(e);return m.useEffect(()=>{o.current!==r&&(s(r),o.current=r)},[r,o,s]),n}var kx=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Nn=new WeakMap,$o=new WeakMap,No={},bi=0,Lf=function(t){return t&&(t.host||Lf(t.parentNode))},Ex=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=Lf(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},Px=function(t,e,n,r){var o=Ex(e,Array.isArray(t)?t:[t]);No[n]||(No[n]=new WeakMap);var s=No[n],i=[],a=new Set,l=new Set(o),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};o.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var p=h.getAttribute(r),g=p!==null&&p!=="false",y=(Nn.get(h)||0)+1,v=(s.get(h)||0)+1;Nn.set(h,y),s.set(h,v),i.push(h),y===1&&g&&$o.set(h,!0),v===1&&h.setAttribute(n,"true"),g||h.setAttribute(r,"true")}catch(w){console.error("aria-hidden: cannot operate on ",h,w)}})};return u(e),a.clear(),bi++,function(){i.forEach(function(d){var h=Nn.get(d)-1,p=s.get(d)-1;Nn.set(d,h),s.set(d,p),h||($o.has(d)||d.removeAttribute(r),$o.delete(d)),p||d.removeAttribute(n)}),bi--,bi||(Nn=new WeakMap,Nn=new WeakMap,$o=new WeakMap,No={})}},Bf=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),o=kx(t);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live]"))),Px(r,o,n,"aria-hidden")):function(){return null}},dt=function(){return dt=Object.assign||function(e){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},dt.apply(this,arguments)};function Ff(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function Tx(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,s;r<o;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}var Qo="right-scroll-bar-position",es="width-before-scroll-bar",Ax="with-scroll-bars-hidden",Rx="--removed-body-scroll-bar-size";function xi(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function Ox(t,e){var n=m.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var o=n.value;o!==r&&(n.value=r,n.callback(r,o))}}}})[0];return n.callback=e,n.facade}var Ix=typeof window<"u"?m.useLayoutEffect:m.useEffect,Zc=new WeakMap;function jx(t,e){var n=Ox(null,function(r){return t.forEach(function(o){return xi(o,r)})});return Ix(function(){var r=Zc.get(n);if(r){var o=new Set(r),s=new Set(t),i=n.current;o.forEach(function(a){s.has(a)||xi(a,null)}),s.forEach(function(a){o.has(a)||xi(a,i)})}Zc.set(n,t)},[t]),n}function $x(t){return t}function Nx(t,e){e===void 0&&(e=$x);var n=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var i=e(s,r);return n.push(i),function(){n=n.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(r=!0;n.length;){var i=n;n=[],i.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){r=!0;var i=[];if(n.length){var a=n;n=[],a.forEach(s),i=n}var l=function(){var u=i;i=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),n={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),n}}}};return o}function Mx(t){t===void 0&&(t={});var e=Nx(null);return e.options=dt({async:!0,ssr:!1},t),e}var Uf=function(t){var e=t.sideCar,n=Ff(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return m.createElement(r,dt({},n))};Uf.isSideCarExport=!0;function zx(t,e){return t.useMedium(e),Uf}var Hf=Mx(),_i=function(){},Ns=m.forwardRef(function(t,e){var n=m.useRef(null),r=m.useState({onScrollCapture:_i,onWheelCapture:_i,onTouchMoveCapture:_i}),o=r[0],s=r[1],i=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,h=t.sideCar,p=t.noIsolation,g=t.inert,y=t.allowPinchZoom,v=t.as,w=v===void 0?"div":v,_=t.gapMode,b=Ff(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=h,S=jx([n,e]),k=dt(dt({},b),o);return m.createElement(m.Fragment,null,u&&m.createElement(x,{sideCar:Hf,removeScrollBar:c,shards:d,noIsolation:p,inert:g,setCallbacks:s,allowPinchZoom:!!y,lockRef:n,gapMode:_}),i?m.cloneElement(m.Children.only(a),dt(dt({},k),{ref:S})):m.createElement(w,dt({},k,{className:l,ref:S}),a))});Ns.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Ns.classNames={fullWidth:es,zeroRight:Qo};var Dx=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Lx(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Dx();return e&&t.setAttribute("nonce",e),t}function Bx(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function Fx(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Ux=function(){var t=0,e=null;return{add:function(n){t==0&&(e=Lx())&&(Bx(e,n),Fx(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Hx=function(){var t=Ux();return function(e,n){m.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},Wf=function(){var t=Hx(),e=function(n){var r=n.styles,o=n.dynamic;return t(r,o),null};return e},Wx={left:0,top:0,right:0,gap:0},Ci=function(t){return parseInt(t||"",10)||0},Gx=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],o=e[t==="padding"?"paddingRight":"marginRight"];return[Ci(n),Ci(r),Ci(o)]},qx=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Wx;var e=Gx(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},Vx=Wf(),ur="data-scroll-locked",Kx=function(t,e,n,r){var o=t.left,s=t.top,i=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(Ax,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(ur,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Qo,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(es,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Qo," .").concat(Qo,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(es," .").concat(es,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(ur,`] {
    `).concat(Rx,": ").concat(a,`px;
  }
`)},Qc=function(){var t=parseInt(document.body.getAttribute(ur)||"0",10);return isFinite(t)?t:0},Xx=function(){m.useEffect(function(){return document.body.setAttribute(ur,(Qc()+1).toString()),function(){var t=Qc()-1;t<=0?document.body.removeAttribute(ur):document.body.setAttribute(ur,t.toString())}},[])},Jx=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,o=r===void 0?"margin":r;Xx();var s=m.useMemo(function(){return qx(o)},[o]);return m.createElement(Vx,{styles:Kx(s,!e,o,n?"":"!important")})},xa=!1;if(typeof window<"u")try{var Mo=Object.defineProperty({},"passive",{get:function(){return xa=!0,!0}});window.addEventListener("test",Mo,Mo),window.removeEventListener("test",Mo,Mo)}catch{xa=!1}var Mn=xa?{passive:!1}:!1,Yx=function(t){return t.tagName==="TEXTAREA"},Gf=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!Yx(t)&&n[e]==="visible")},Zx=function(t){return Gf(t,"overflowY")},Qx=function(t){return Gf(t,"overflowX")},eu=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=qf(t,r);if(o){var s=Vf(t,r),i=s[1],a=s[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},e0=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},t0=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},qf=function(t,e){return t==="v"?Zx(e):Qx(e)},Vf=function(t,e){return t==="v"?e0(e):t0(e)},n0=function(t,e){return t==="h"&&e==="rtl"?-1:1},r0=function(t,e,n,r,o){var s=n0(t,window.getComputedStyle(e).direction),i=s*r,a=n.target,l=e.contains(a),c=!1,u=i>0,d=0,h=0;do{var p=Vf(t,a),g=p[0],y=p[1],v=p[2],w=y-v-s*g;(g||w)&&qf(t,a)&&(d+=w,h+=g),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},zo=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},tu=function(t){return[t.deltaX,t.deltaY]},nu=function(t){return t&&"current"in t?t.current:t},o0=function(t,e){return t[0]===e[0]&&t[1]===e[1]},s0=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},i0=0,zn=[];function a0(t){var e=m.useRef([]),n=m.useRef([0,0]),r=m.useRef(),o=m.useState(i0++)[0],s=m.useState(Wf)[0],i=m.useRef(t);m.useEffect(function(){i.current=t},[t]),m.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(o));var y=Tx([t.lockRef.current],(t.shards||[]).map(nu),!0).filter(Boolean);return y.forEach(function(v){return v.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),y.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(o))})}}},[t.inert,t.lockRef.current,t.shards]);var a=m.useCallback(function(y,v){if("touches"in y&&y.touches.length===2||y.type==="wheel"&&y.ctrlKey)return!i.current.allowPinchZoom;var w=zo(y),_=n.current,b="deltaX"in y?y.deltaX:_[0]-w[0],x="deltaY"in y?y.deltaY:_[1]-w[1],S,k=y.target,C=Math.abs(b)>Math.abs(x)?"h":"v";if("touches"in y&&C==="h"&&k.type==="range")return!1;var N=eu(C,k);if(!N)return!0;if(N?S=C:(S=C==="v"?"h":"v",N=eu(C,k)),!N)return!1;if(!r.current&&"changedTouches"in y&&(b||x)&&(r.current=S),!S)return!0;var H=r.current||S;return r0(H,v,y,H==="h"?b:x)},[]),l=m.useCallback(function(y){var v=y;if(!(!zn.length||zn[zn.length-1]!==s)){var w="deltaY"in v?tu(v):zo(v),_=e.current.filter(function(S){return S.name===v.type&&(S.target===v.target||v.target===S.shadowParent)&&o0(S.delta,w)})[0];if(_&&_.should){v.cancelable&&v.preventDefault();return}if(!_){var b=(i.current.shards||[]).map(nu).filter(Boolean).filter(function(S){return S.contains(v.target)}),x=b.length>0?a(v,b[0]):!i.current.noIsolation;x&&v.cancelable&&v.preventDefault()}}},[]),c=m.useCallback(function(y,v,w,_){var b={name:y,delta:v,target:w,should:_,shadowParent:l0(w)};e.current.push(b),setTimeout(function(){e.current=e.current.filter(function(x){return x!==b})},1)},[]),u=m.useCallback(function(y){n.current=zo(y),r.current=void 0},[]),d=m.useCallback(function(y){c(y.type,tu(y),y.target,a(y,t.lockRef.current))},[]),h=m.useCallback(function(y){c(y.type,zo(y),y.target,a(y,t.lockRef.current))},[]);m.useEffect(function(){return zn.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Mn),document.addEventListener("touchmove",l,Mn),document.addEventListener("touchstart",u,Mn),function(){zn=zn.filter(function(y){return y!==s}),document.removeEventListener("wheel",l,Mn),document.removeEventListener("touchmove",l,Mn),document.removeEventListener("touchstart",u,Mn)}},[]);var p=t.removeScrollBar,g=t.inert;return m.createElement(m.Fragment,null,g?m.createElement(s,{styles:s0(o)}):null,p?m.createElement(Jx,{gapMode:t.gapMode}):null)}function l0(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const c0=zx(Hf,a0);var Pl=m.forwardRef(function(t,e){return m.createElement(Ns,dt({},t,{ref:e,sideCar:c0}))});Pl.classNames=Ns.classNames;var Tl="Popover",[Kf,rR]=ml(Tl,[Pf]),mo=Pf(),[u0,On]=Kf(Tl),Xf=t=>{const{__scopePopover:e,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!1}=t,a=mo(e),l=m.useRef(null),[c,u]=m.useState(!1),[d=!1,h]=Df({prop:r,defaultProp:o,onChange:s});return f.jsx(yx,{...a,children:f.jsx(u0,{scope:e,contentId:ft(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:m.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:c,onCustomAnchorAdd:m.useCallback(()=>u(!0),[]),onCustomAnchorRemove:m.useCallback(()=>u(!1),[]),modal:i,children:n})})};Xf.displayName=Tl;var Jf="PopoverAnchor",d0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=On(Jf,n),s=mo(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=o;return m.useEffect(()=>(i(),()=>a()),[i,a]),f.jsx(Mf,{...s,...r,ref:e})});d0.displayName=Jf;var Yf="PopoverTrigger",Zf=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=On(Yf,n),s=mo(n),i=at(e,o.triggerRef),a=f.jsx(be.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":np(o.open),...r,ref:i,onClick:Ke(t.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:f.jsx(Mf,{asChild:!0,...s,children:a})});Zf.displayName=Yf;var h0="PopoverPortal",[oR,f0]=Kf(h0,{forceMount:void 0}),yr="PopoverContent",Qf=m.forwardRef((t,e)=>{const n=f0(yr,t.__scopePopover),{forceMount:r=n.forceMount,...o}=t,s=On(yr,t.__scopePopover);return f.jsx(po,{present:r||s.open,children:s.modal?f.jsx(p0,{...o,ref:e}):f.jsx(m0,{...o,ref:e})})});Qf.displayName=yr;var p0=m.forwardRef((t,e)=>{const n=On(yr,t.__scopePopover),r=m.useRef(null),o=at(e,r),s=m.useRef(!1);return m.useEffect(()=>{const i=r.current;if(i)return Bf(i)},[]),f.jsx(Pl,{as:Os,allowPinchZoom:!0,children:f.jsx(ep,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ke(t.onCloseAutoFocus,i=>{i.preventDefault(),s.current||n.triggerRef.current?.focus()}),onPointerDownOutside:Ke(t.onPointerDownOutside,i=>{const a=i.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Ke(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),m0=m.forwardRef((t,e)=>{const n=On(yr,t.__scopePopover),r=m.useRef(!1),o=m.useRef(!1);return f.jsx(ep,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;n.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),ep=m.forwardRef((t,e)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=t,h=On(yr,n),p=mo(n);return rf(),f.jsx(yl,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:f.jsx(gl,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1),children:f.jsx(vx,{"data-state":np(h.open),role:"dialog",id:h.contentId,...p,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),tp="PopoverClose",g0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=On(tp,n);return f.jsx(be.button,{type:"button",...r,ref:e,onClick:Ke(t.onClick,()=>o.onOpenChange(!1))})});g0.displayName=tp;var y0="PopoverArrow",v0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=mo(n);return f.jsx(wx,{...o,...r,ref:e})});v0.displayName=y0;function np(t){return t?"open":"closed"}var w0=Zf;function rp(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(e=0;e<o;e++)t[e]&&(n=rp(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function Al(){for(var t,e,n=0,r="",o=arguments.length;n<o;n++)(t=arguments[n])&&(e=rp(t))&&(r&&(r+=" "),r+=e);return r}function Te(...t){return pl(Al(t))}const op=Xf,sp=w0,ip=m.forwardRef(({className:t,align:e="end",...n},r)=>f.jsx(Qf,{ref:r,align:e,className:Te("z-popups drop-shadow-oneBlock p-0 border-shadow outline-none",t),...n,onKeyDown:o=>{o.stopPropagation()}})),Ms=({children:t,scaleFactor:e})=>{const n=oh();return f.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??n,"--block":`${(e??n)*8}px`},children:t})};var ru=1,b0=.9,x0=.8,_0=.17,Si=.1,ki=.999,C0=.9999,S0=.99,k0=/[\\\/_+.#"@\[\(\{&]/,E0=/[\\\/_+.#"@\[\(\{&]/g,P0=/[\s-]/,ap=/[\s-]/g;function _a(t,e,n,r,o,s,i){if(s===e.length)return o===t.length?ru:S0;var a=`${o},${s}`;if(i[a]!==void 0)return i[a];for(var l=r.charAt(s),c=n.indexOf(l,o),u=0,d,h,p,g;c>=0;)d=_a(t,e,n,r,c+1,s+1,i),d>u&&(c===o?d*=ru:k0.test(t.charAt(c-1))?(d*=x0,p=t.slice(o,c-1).match(E0),p&&o>0&&(d*=Math.pow(ki,p.length))):P0.test(t.charAt(c-1))?(d*=b0,g=t.slice(o,c-1).match(ap),g&&o>0&&(d*=Math.pow(ki,g.length))):(d*=_0,o>0&&(d*=Math.pow(ki,c-o))),t.charAt(c)!==e.charAt(s)&&(d*=C0)),(d<Si&&n.charAt(c-1)===r.charAt(s+1)||r.charAt(s+1)===r.charAt(s)&&n.charAt(c-1)!==r.charAt(s))&&(h=_a(t,e,n,r,c+1,s+2,i),h*Si>d&&(d=h*Si)),d>u&&(u=d),c=n.indexOf(l,c+1);return i[a]=u,u}function ou(t){return t.toLowerCase().replace(ap," ")}function T0(t,e,n){return t=n&&n.length>0?`${t+" "+n.join(" ")}`:t,_a(t,e,ou(t),ou(e),0,0,{})}var Rl="Dialog",[lp,sR]=ml(Rl),[A0,lt]=lp(Rl),cp=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!0}=t,a=m.useRef(null),l=m.useRef(null),[c=!1,u]=Df({prop:r,defaultProp:o,onChange:s});return f.jsx(A0,{scope:e,triggerRef:a,contentRef:l,contentId:ft(),titleId:ft(),descriptionId:ft(),open:c,onOpenChange:u,onOpenToggle:m.useCallback(()=>u(d=>!d),[u]),modal:i,children:n})};cp.displayName=Rl;var up="DialogTrigger",R0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(up,n),s=at(e,o.triggerRef);return f.jsx(be.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":jl(o.open),...r,ref:s,onClick:Ke(t.onClick,o.onOpenToggle)})});R0.displayName=up;var Ol="DialogPortal",[O0,dp]=lp(Ol,{forceMount:void 0}),hp=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:o}=t,s=lt(Ol,e);return f.jsx(O0,{scope:e,forceMount:n,children:m.Children.map(r,i=>f.jsx(po,{present:n||s.open,children:f.jsx(zf,{asChild:!0,container:o,children:i})}))})};hp.displayName=Ol;var ys="DialogOverlay",fp=m.forwardRef((t,e)=>{const n=dp(ys,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,s=lt(ys,t.__scopeDialog);return s.modal?f.jsx(po,{present:r||s.open,children:f.jsx(I0,{...o,ref:e})}):null});fp.displayName=ys;var I0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(ys,n);return f.jsx(Pl,{as:Os,allowPinchZoom:!0,shards:[o.contentRef],children:f.jsx(be.div,{"data-state":jl(o.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),_n="DialogContent",pp=m.forwardRef((t,e)=>{const n=dp(_n,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,s=lt(_n,t.__scopeDialog);return f.jsx(po,{present:r||s.open,children:s.modal?f.jsx(j0,{...o,ref:e}):f.jsx($0,{...o,ref:e})})});pp.displayName=_n;var j0=m.forwardRef((t,e)=>{const n=lt(_n,t.__scopeDialog),r=m.useRef(null),o=at(e,n.contentRef,r);return m.useEffect(()=>{const s=r.current;if(s)return Bf(s)},[]),f.jsx(mp,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ke(t.onCloseAutoFocus,s=>{s.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Ke(t.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:Ke(t.onFocusOutside,s=>s.preventDefault())})}),$0=m.forwardRef((t,e)=>{const n=lt(_n,t.__scopeDialog),r=m.useRef(!1),o=m.useRef(!1);return f.jsx(mp,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;n.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),mp=m.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=t,a=lt(_n,n),l=m.useRef(null),c=at(e,l);return rf(),f.jsxs(f.Fragment,{children:[f.jsx(yl,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:f.jsx(gl,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":jl(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),f.jsxs(f.Fragment,{children:[f.jsx(D0,{titleId:a.titleId}),f.jsx(B0,{contentRef:l,descriptionId:a.descriptionId})]})]})}),Il="DialogTitle",N0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(Il,n);return f.jsx(be.h2,{id:o.titleId,...r,ref:e})});N0.displayName=Il;var gp="DialogDescription",M0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(gp,n);return f.jsx(be.p,{id:o.descriptionId,...r,ref:e})});M0.displayName=gp;var yp="DialogClose",z0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(yp,n);return f.jsx(be.button,{type:"button",...r,ref:e,onClick:Ke(t.onClick,()=>o.onOpenChange(!1))})});z0.displayName=yp;function jl(t){return t?"open":"closed"}var vp="DialogTitleWarning",[iR,wp]=Xw(vp,{contentName:_n,titleName:Il,docsSlug:"dialog"}),D0=({titleId:t})=>{const e=wp(vp),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return m.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},L0="DialogDescriptionWarning",B0=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${wp(L0).contentName}}.`;return m.useEffect(()=>{const o=t.current?.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},F0=cp,U0=hp,H0=fp,W0=pp,Ei={exports:{}},Pi={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var su;function G0(){if(su)return Pi;su=1;var t=ty();function e(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,o=t.useEffect,s=t.useLayoutEffect,i=t.useDebugValue;function a(d,h){var p=h(),g=r({inst:{value:p,getSnapshot:h}}),y=g[0].inst,v=g[1];return s(function(){y.value=p,y.getSnapshot=h,l(y)&&v({inst:y})},[d,p,h]),o(function(){return l(y)&&v({inst:y}),d(function(){l(y)&&v({inst:y})})},[d]),i(p),p}function l(d){var h=d.getSnapshot;d=d.value;try{var p=h();return!n(d,p)}catch{return!0}}function c(d,h){return h()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return Pi.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,Pi}var iu;function q0(){return iu||(iu=1,Ei.exports=G0()),Ei.exports}var V0=q0(),zr='[cmdk-group=""]',Ti='[cmdk-group-items=""]',K0='[cmdk-group-heading=""]',$l='[cmdk-item=""]',au=`${$l}:not([aria-disabled="true"])`,Ca="cmdk-item-select",hn="data-value",X0=(t,e,n)=>T0(t,e,n),bp=m.createContext(void 0),go=()=>m.useContext(bp),xp=m.createContext(void 0),Nl=()=>m.useContext(xp),_p=m.createContext(void 0),Cp=m.forwardRef((t,e)=>{let n=Yn(()=>{var P,E;return{search:"",value:(E=(P=t.value)!=null?P:t.defaultValue)!=null?E:"",filtered:{count:0,items:new Map,groups:new Set}}}),r=Yn(()=>new Set),o=Yn(()=>new Map),s=Yn(()=>new Map),i=Yn(()=>new Set),a=Sp(t),{label:l,children:c,value:u,onValueChange:d,filter:h,shouldFilter:p,loop:g,disablePointerSelection:y=!1,vimBindings:v=!0,...w}=t,_=ft(),b=ft(),x=ft(),S=m.useRef(null),k=i_();Cn(()=>{if(u!==void 0){let P=u.trim();n.current.value=P,C.emit()}},[u]),Cn(()=>{k(6,ee)},[]);let C=m.useMemo(()=>({subscribe:P=>(i.current.add(P),()=>i.current.delete(P)),snapshot:()=>n.current,setState:(P,E,R)=>{var T,O,A;if(!Object.is(n.current[P],E)){if(n.current[P]=E,P==="search")I(),L(),k(1,X);else if(P==="value"&&(R||k(5,ee),((T=a.current)==null?void 0:T.value)!==void 0)){let M=E??"";(A=(O=a.current).onValueChange)==null||A.call(O,M);return}C.emit()}},emit:()=>{i.current.forEach(P=>P())}}),[]),N=m.useMemo(()=>({value:(P,E,R)=>{var T;E!==((T=s.current.get(P))==null?void 0:T.value)&&(s.current.set(P,{value:E,keywords:R}),n.current.filtered.items.set(P,H(E,R)),k(2,()=>{L(),C.emit()}))},item:(P,E)=>(r.current.add(P),E&&(o.current.has(E)?o.current.get(E).add(P):o.current.set(E,new Set([P]))),k(3,()=>{I(),L(),n.current.value||X(),C.emit()}),()=>{s.current.delete(P),r.current.delete(P),n.current.filtered.items.delete(P);let R=D();k(4,()=>{I(),R?.getAttribute("id")===P&&X(),C.emit()})}),group:P=>(o.current.has(P)||o.current.set(P,new Set),()=>{s.current.delete(P),o.current.delete(P)}),filter:()=>a.current.shouldFilter,label:l||t["aria-label"],getDisablePointerSelection:()=>a.current.disablePointerSelection,listId:_,inputId:x,labelId:b,listInnerRef:S}),[]);function H(P,E){var R,T;let O=(T=(R=a.current)==null?void 0:R.filter)!=null?T:X0;return P?O(P,n.current.search,E):0}function L(){if(!n.current.search||a.current.shouldFilter===!1)return;let P=n.current.filtered.items,E=[];n.current.filtered.groups.forEach(T=>{let O=o.current.get(T),A=0;O.forEach(M=>{let oe=P.get(M);A=Math.max(oe,A)}),E.push([T,A])});let R=S.current;J().sort((T,O)=>{var A,M;let oe=T.getAttribute("id"),le=O.getAttribute("id");return((A=P.get(le))!=null?A:0)-((M=P.get(oe))!=null?M:0)}).forEach(T=>{let O=T.closest(Ti);O?O.appendChild(T.parentElement===O?T:T.closest(`${Ti} > *`)):R.appendChild(T.parentElement===R?T:T.closest(`${Ti} > *`))}),E.sort((T,O)=>O[1]-T[1]).forEach(T=>{var O;let A=(O=S.current)==null?void 0:O.querySelector(`${zr}[${hn}="${encodeURIComponent(T[0])}"]`);A?.parentElement.appendChild(A)})}function X(){let P=J().find(R=>R.getAttribute("aria-disabled")!=="true"),E=P?.getAttribute(hn);C.setState("value",E||void 0)}function I(){var P,E,R,T;if(!n.current.search||a.current.shouldFilter===!1){n.current.filtered.count=r.current.size;return}n.current.filtered.groups=new Set;let O=0;for(let A of r.current){let M=(E=(P=s.current.get(A))==null?void 0:P.value)!=null?E:"",oe=(T=(R=s.current.get(A))==null?void 0:R.keywords)!=null?T:[],le=H(M,oe);n.current.filtered.items.set(A,le),le>0&&O++}for(let[A,M]of o.current)for(let oe of M)if(n.current.filtered.items.get(oe)>0){n.current.filtered.groups.add(A);break}n.current.filtered.count=O}function ee(){var P,E,R;let T=D();T&&(((P=T.parentElement)==null?void 0:P.firstChild)===T&&((R=(E=T.closest(zr))==null?void 0:E.querySelector(K0))==null||R.scrollIntoView({block:"nearest"})),T.scrollIntoView({block:"nearest"}))}function D(){var P;return(P=S.current)==null?void 0:P.querySelector(`${$l}[aria-selected="true"]`)}function J(){var P;return Array.from(((P=S.current)==null?void 0:P.querySelectorAll(au))||[])}function Y(P){let E=J()[P];E&&C.setState("value",E.getAttribute(hn))}function Z(P){var E;let R=D(),T=J(),O=T.findIndex(M=>M===R),A=T[O+P];(E=a.current)!=null&&E.loop&&(A=O+P<0?T[T.length-1]:O+P===T.length?T[0]:T[O+P]),A&&C.setState("value",A.getAttribute(hn))}function F(P){let E=D(),R=E?.closest(zr),T;for(;R&&!T;)R=P>0?o_(R,zr):s_(R,zr),T=R?.querySelector(au);T?C.setState("value",T.getAttribute(hn)):Z(P)}let ie=()=>Y(J().length-1),ve=P=>{P.preventDefault(),P.metaKey?ie():P.altKey?F(1):Z(1)},pe=P=>{P.preventDefault(),P.metaKey?Y(0):P.altKey?F(-1):Z(-1)};return m.createElement(be.div,{ref:e,tabIndex:-1,...w,"cmdk-root":"",onKeyDown:P=>{var E;if((E=w.onKeyDown)==null||E.call(w,P),!P.defaultPrevented)switch(P.key){case"n":case"j":{v&&P.ctrlKey&&ve(P);break}case"ArrowDown":{ve(P);break}case"p":case"k":{v&&P.ctrlKey&&pe(P);break}case"ArrowUp":{pe(P);break}case"Home":{P.preventDefault(),Y(0);break}case"End":{P.preventDefault(),ie();break}case"Enter":if(!P.nativeEvent.isComposing&&P.keyCode!==229){P.preventDefault();let R=D();if(R){let T=new Event(Ca);R.dispatchEvent(T)}}}}},m.createElement("label",{"cmdk-label":"",htmlFor:N.inputId,id:N.labelId,style:l_},l),zs(t,P=>m.createElement(xp.Provider,{value:C},m.createElement(bp.Provider,{value:N},P))))}),J0=m.forwardRef((t,e)=>{var n,r;let o=ft(),s=m.useRef(null),i=m.useContext(_p),a=go(),l=Sp(t),c=(r=(n=l.current)==null?void 0:n.forceMount)!=null?r:i?.forceMount;Cn(()=>{if(!c)return a.item(o,i?.id)},[c]);let u=kp(o,s,[t.value,t.children,s],t.keywords),d=Nl(),h=Sn(k=>k.value&&k.value===u.current),p=Sn(k=>c||a.filter()===!1?!0:k.search?k.filtered.items.get(o)>0:!0);m.useEffect(()=>{let k=s.current;if(!(!k||t.disabled))return k.addEventListener(Ca,g),()=>k.removeEventListener(Ca,g)},[p,t.onSelect,t.disabled]);function g(){var k,C;y(),(C=(k=l.current).onSelect)==null||C.call(k,u.current)}function y(){d.setState("value",u.current,!0)}if(!p)return null;let{disabled:v,value:w,onSelect:_,forceMount:b,keywords:x,...S}=t;return m.createElement(be.div,{ref:oo([s,e]),...S,id:o,"cmdk-item":"",role:"option","aria-disabled":!!v,"aria-selected":!!h,"data-disabled":!!v,"data-selected":!!h,onPointerMove:v||a.getDisablePointerSelection()?void 0:y,onClick:v?void 0:g},t.children)}),Y0=m.forwardRef((t,e)=>{let{heading:n,children:r,forceMount:o,...s}=t,i=ft(),a=m.useRef(null),l=m.useRef(null),c=ft(),u=go(),d=Sn(p=>o||u.filter()===!1?!0:p.search?p.filtered.groups.has(i):!0);Cn(()=>u.group(i),[]),kp(i,a,[t.value,t.heading,l]);let h=m.useMemo(()=>({id:i,forceMount:o}),[o]);return m.createElement(be.div,{ref:oo([a,e]),...s,"cmdk-group":"",role:"presentation",hidden:d?void 0:!0},n&&m.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:c},n),zs(t,p=>m.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?c:void 0},m.createElement(_p.Provider,{value:h},p))))}),Z0=m.forwardRef((t,e)=>{let{alwaysRender:n,...r}=t,o=m.useRef(null),s=Sn(i=>!i.search);return!n&&!s?null:m.createElement(be.div,{ref:oo([o,e]),...r,"cmdk-separator":"",role:"separator"})}),Q0=m.forwardRef((t,e)=>{let{onValueChange:n,...r}=t,o=t.value!=null,s=Nl(),i=Sn(u=>u.search),a=Sn(u=>u.value),l=go(),c=m.useMemo(()=>{var u;let d=(u=l.listInnerRef.current)==null?void 0:u.querySelector(`${$l}[${hn}="${encodeURIComponent(a)}"]`);return d?.getAttribute("id")},[]);return m.useEffect(()=>{t.value!=null&&s.setState("search",t.value)},[t.value]),m.createElement(be.input,{ref:e,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":c,id:l.inputId,type:"text",value:o?t.value:i,onChange:u=>{o||s.setState("search",u.target.value),n?.(u.target.value)}})}),e_=m.forwardRef((t,e)=>{let{children:n,label:r="Suggestions",...o}=t,s=m.useRef(null),i=m.useRef(null),a=go();return m.useEffect(()=>{if(i.current&&s.current){let l=i.current,c=s.current,u,d=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let h=l.offsetHeight;c.style.setProperty("--cmdk-list-height",h.toFixed(1)+"px")})});return d.observe(l),()=>{cancelAnimationFrame(u),d.unobserve(l)}}},[]),m.createElement(be.div,{ref:oo([s,e]),...o,"cmdk-list":"",role:"listbox","aria-label":r,id:a.listId},zs(t,l=>m.createElement("div",{ref:oo([i,a.listInnerRef]),"cmdk-list-sizer":""},l)))}),t_=m.forwardRef((t,e)=>{let{open:n,onOpenChange:r,overlayClassName:o,contentClassName:s,container:i,...a}=t;return m.createElement(F0,{open:n,onOpenChange:r},m.createElement(U0,{container:i},m.createElement(H0,{"cmdk-overlay":"",className:o}),m.createElement(W0,{"aria-label":t.label,"cmdk-dialog":"",className:s},m.createElement(Cp,{ref:e,...a}))))}),n_=m.forwardRef((t,e)=>Sn(n=>n.filtered.count===0)?m.createElement(be.div,{ref:e,...t,"cmdk-empty":"",role:"presentation"}):null),r_=m.forwardRef((t,e)=>{let{progress:n,children:r,label:o="Loading...",...s}=t;return m.createElement(be.div,{ref:e,...s,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},zs(t,i=>m.createElement("div",{"aria-hidden":!0},i)))}),We=Object.assign(Cp,{List:e_,Item:J0,Input:Q0,Group:Y0,Separator:Z0,Dialog:t_,Empty:n_,Loading:r_});function o_(t,e){let n=t.nextElementSibling;for(;n;){if(n.matches(e))return n;n=n.nextElementSibling}}function s_(t,e){let n=t.previousElementSibling;for(;n;){if(n.matches(e))return n;n=n.previousElementSibling}}function Sp(t){let e=m.useRef(t);return Cn(()=>{e.current=t}),e}var Cn=typeof window>"u"?m.useEffect:m.useLayoutEffect;function Yn(t){let e=m.useRef();return e.current===void 0&&(e.current=t()),e}function oo(t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}function Sn(t){let e=Nl(),n=()=>t(e.snapshot());return V0.useSyncExternalStore(e.subscribe,n,n)}function kp(t,e,n,r=[]){let o=m.useRef(),s=go();return Cn(()=>{var i;let a=(()=>{var c;for(let u of n){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(c=u.current.textContent)==null?void 0:c.trim():o.current}})(),l=r.map(c=>c.trim());s.value(t,a,l),(i=e.current)==null||i.setAttribute(hn,a),o.current=a}),o}var i_=()=>{let[t,e]=m.useState(),n=Yn(()=>new Map);return Cn(()=>{n.current.forEach(r=>r()),n.current=new Map},[t]),(r,o)=>{n.current.set(r,o),e({})}};function a_(t){let e=t.type;return typeof e=="function"?e(t.props):"render"in e?e.render(t.props):t}function zs({asChild:t,children:e},n){return t&&m.isValidElement(e)?m.cloneElement(a_(e),{ref:e.ref},n(e.props.children)):n(e)}var l_={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Ep=m.forwardRef(({className:t,...e},n)=>f.jsx(We,{ref:n,className:Te("flex h-full w-full flex-col overflow-hidden bg-metallicBlue text-popover-foreground",t),...e}));Ep.displayName=We.displayName;const Pp=m.forwardRef(({className:t,...e},n)=>f.jsxs("div",{className:"flex items-center border-b px-1 pb-1","cmdk-input-wrapper":"",children:[f.jsx("span",{className:"sprite mr-1 texture-hud_char_gt"}),f.jsx(We.Input,{ref:n,className:Te("flex h-1 w-full bg-pastelBlue py-1 outline-none placeholder:text-shadow disabled:cursor-not-allowed",t),...e})]}));Pp.displayName=We.Input.displayName;const Tp=m.forwardRef(({className:t,...e},n)=>f.jsx(We.List,{ref:n,className:Te("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...e}));Tp.displayName=We.List.displayName;const Ap=m.forwardRef((t,e)=>f.jsx(We.Empty,{ref:e,className:"pl-1",...t}));Ap.displayName=We.Empty.displayName;const Rp=m.forwardRef(({className:t,...e},n)=>f.jsx(We.Group,{ref:n,className:Te("overflow-hidden",t),...e}));Rp.displayName=We.Group.displayName;const c_=m.forwardRef(({className:t,...e},n)=>f.jsx(We.Separator,{ref:n,className:Te("-mx-1 h-px bg-shadow",t),...e}));c_.displayName=We.Separator.displayName;const Ds=m.forwardRef(({className:t,...e},n)=>f.jsx(We.Item,{ref:n,className:Te("relative flex cursor-default select-none items-center text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-midRed hover:bg-pastelBlue data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...e}));Ds.displayName=We.Item.displayName;function Et(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t?.(o),n===!1||!o.defaultPrevented)return e?.(o)}}function lu(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Op(...t){return e=>{let n=!1;const r=t.map(o=>{const s=lu(o,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():lu(t[o],null)}}}}function In(...t){return m.useCallback(Op(...t),t)}function Ip(t,e=[]){let n=[];function r(s,i){const a=m.createContext(i),l=n.length;n=[...n,i];const c=d=>{const{scope:h,children:p,...g}=d,y=h?.[t]?.[l]||a,v=m.useMemo(()=>g,Object.values(g));return f.jsx(y.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(d,h){const p=h?.[t]?.[l]||a,g=m.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=n.map(i=>m.createContext(i));return function(a){const l=a?.[t]||s;return m.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[r,u_(o,...e)]}function u_(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}function d_(t){const e=h_(t),n=m.forwardRef((r,o)=>{const{children:s,...i}=r,a=m.Children.toArray(s),l=a.find(p_);if(l){const c=l.props.children,u=a.map(d=>d===l?m.Children.count(c)>1?m.Children.only(null):m.isValidElement(c)?c.props.children:null:d);return f.jsx(e,{...i,ref:o,children:m.isValidElement(c)?m.cloneElement(c,void 0,u):null})}return f.jsx(e,{...i,ref:o,children:s})});return n.displayName=`${t}.Slot`,n}function h_(t){const e=m.forwardRef((n,r)=>{const{children:o,...s}=n;if(m.isValidElement(o)){const i=g_(o),a=m_(s,o.props);return o.type!==m.Fragment&&(a.ref=r?Op(r,i):i),m.cloneElement(o,a)}return m.Children.count(o)>1?m.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var jp=Symbol("radix.slottable");function f_(t){const e=({children:n})=>f.jsx(f.Fragment,{children:n});return e.displayName=`${t}.Slottable`,e.__radixId=jp,e}function p_(t){return m.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===jp}function m_(t,e){const n={...e};for(const r in e){const o=t[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{const l=s(...a);return o(...a),l}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...t,...n}}function g_(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var y_=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],rn=y_.reduce((t,e)=>{const n=d_(`Primitive.${e}`),r=m.forwardRef((o,s)=>{const{asChild:i,...a}=o,l=i?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),f.jsx(l,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function v_(t,e){t&&Rs.flushSync(()=>t.dispatchEvent(e))}function Ls(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t}),m.useMemo(()=>(...n)=>e.current?.(...n),[])}function w_(t,e=globalThis?.document){const n=Ls(t);m.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var b_="DismissableLayer",Sa="dismissableLayer.update",x_="dismissableLayer.pointerDownOutside",__="dismissableLayer.focusOutside",cu,$p=m.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Np=m.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=m.useContext($p),[u,d]=m.useState(null),h=u?.ownerDocument??globalThis?.document,[,p]=m.useState({}),g=In(e,C=>d(C)),y=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),w=y.indexOf(v),_=u?y.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,x=_>=w,S=k_(C=>{const N=C.target,H=[...c.branches].some(L=>L.contains(N));!x||H||(o?.(C),i?.(C),C.defaultPrevented||a?.())},h),k=E_(C=>{const N=C.target;[...c.branches].some(L=>L.contains(N))||(s?.(C),i?.(C),C.defaultPrevented||a?.())},h);return w_(C=>{_===c.layers.size-1&&(r?.(C),!C.defaultPrevented&&a&&(C.preventDefault(),a()))},h),m.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(cu=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),uu(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=cu)}},[u,h,n,c]),m.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),uu())},[u,c]),m.useEffect(()=>{const C=()=>p({});return document.addEventListener(Sa,C),()=>document.removeEventListener(Sa,C)},[]),f.jsx(rn.div,{...l,ref:g,style:{pointerEvents:b?x?"auto":"none":void 0,...t.style},onFocusCapture:Et(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Et(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Et(t.onPointerDownCapture,S.onPointerDownCapture)})});Np.displayName=b_;var C_="DismissableLayerBranch",S_=m.forwardRef((t,e)=>{const n=m.useContext($p),r=m.useRef(null),o=In(e,r);return m.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),f.jsx(rn.div,{...t,ref:o})});S_.displayName=C_;function k_(t,e=globalThis?.document){const n=Ls(t),r=m.useRef(!1),o=m.useRef(()=>{});return m.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){Mp(x_,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function E_(t,e=globalThis?.document){const n=Ls(t),r=m.useRef(!1);return m.useEffect(()=>{const o=s=>{s.target&&!r.current&&Mp(__,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function uu(){const t=new CustomEvent(Sa);document.dispatchEvent(t)}function Mp(t,e,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?v_(o,s):o.dispatchEvent(s)}var en=globalThis?.document?m.useLayoutEffect:()=>{},P_=ks[" useId ".trim().toString()]||(()=>{}),T_=0;function A_(t){const[e,n]=m.useState(P_());return en(()=>{n(r=>r??String(T_++))},[t]),e?`radix-${e}`:""}var R_="Arrow",zp=m.forwardRef((t,e)=>{const{children:n,width:r=10,height:o=5,...s}=t;return f.jsx(rn.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:f.jsx("polygon",{points:"0,0 30,0 15,10"})})});zp.displayName=R_;var O_=zp;function I_(t){const[e,n]=m.useState(void 0);return en(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var Ml="Popper",[Dp,Lp]=Ip(Ml),[j_,Bp]=Dp(Ml),Fp=t=>{const{__scopePopper:e,children:n}=t,[r,o]=m.useState(null);return f.jsx(j_,{scope:e,anchor:r,onAnchorChange:o,children:n})};Fp.displayName=Ml;var Up="PopperAnchor",Hp=m.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,s=Bp(Up,n),i=m.useRef(null),a=In(e,i);return m.useEffect(()=>{s.onAnchorChange(r?.current||i.current)}),r?null:f.jsx(rn.div,{...o,ref:a})});Hp.displayName=Up;var zl="PopperContent",[$_,N_]=Dp(zl),Wp=m.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:g,...y}=t,v=Bp(zl,n),[w,_]=m.useState(null),b=In(e,A=>_(A)),[x,S]=m.useState(null),k=I_(x),C=k?.width??0,N=k?.height??0,H=r+(s!=="center"?"-"+s:""),L=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},X=Array.isArray(c)?c:[c],I=X.length>0,ee={padding:L,boundary:X.filter(z_),altBoundary:I},{refs:D,floatingStyles:J,placement:Y,isPositioned:Z,middlewareData:F}=yf({strategy:"fixed",placement:H,whileElementsMounted:(...A)=>mf(...A,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[vf({mainAxis:o+N,alignmentAxis:i}),l&&wf({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?bf():void 0,...ee}),l&&xf({...ee}),_f({...ee,apply:({elements:A,rects:M,availableWidth:oe,availableHeight:le})=>{const{width:Ne,height:Me}=M.reference,ae=A.floating.style;ae.setProperty("--radix-popper-available-width",`${oe}px`),ae.setProperty("--radix-popper-available-height",`${le}px`),ae.setProperty("--radix-popper-anchor-width",`${Ne}px`),ae.setProperty("--radix-popper-anchor-height",`${Me}px`)}}),x&&Sf({element:x,padding:a}),D_({arrowWidth:C,arrowHeight:N}),h&&Cf({strategy:"referenceHidden",...ee})]}),[ie,ve]=Vp(Y),pe=Ls(g);en(()=>{Z&&pe?.()},[Z,pe]);const P=F.arrow?.x,E=F.arrow?.y,R=F.arrow?.centerOffset!==0,[T,O]=m.useState();return en(()=>{w&&O(window.getComputedStyle(w).zIndex)},[w]),f.jsx("div",{ref:D.setFloating,"data-radix-popper-content-wrapper":"",style:{...J,transform:Z?J.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:T,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:f.jsx($_,{scope:n,placedSide:ie,onArrowChange:S,arrowX:P,arrowY:E,shouldHideArrow:R,children:f.jsx(rn.div,{"data-side":ie,"data-align":ve,...y,ref:b,style:{...y.style,animation:Z?void 0:"none"}})})})});Wp.displayName=zl;var Gp="PopperArrow",M_={top:"bottom",right:"left",bottom:"top",left:"right"},qp=m.forwardRef(function(e,n){const{__scopePopper:r,...o}=e,s=N_(Gp,r),i=M_[s.placedSide];return f.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:f.jsx(O_,{...o,ref:n,style:{...o.style,display:"block"}})})});qp.displayName=Gp;function z_(t){return t!==null}var D_=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=Vp(n),d={start:"0%",center:"50%",end:"100%"}[u],h=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let g="",y="";return c==="bottom"?(g=i?d:`${h}px`,y=`${-l}px`):c==="top"?(g=i?d:`${h}px`,y=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,y=i?d:`${p}px`):c==="left"&&(g=`${r.floating.width+l}px`,y=i?d:`${p}px`),{data:{x:g,y}}}});function Vp(t){const[e,n="center"]=t.split("-");return[e,n]}var L_=Fp,B_=Hp,F_=Wp,U_=qp,H_="Portal",Kp=m.forwardRef((t,e)=>{const{container:n,...r}=t,[o,s]=m.useState(!1);en(()=>s(!0),[]);const i=n||o&&globalThis?.document?.body;return i?ef.createPortal(f.jsx(rn.div,{...r,ref:e}),i):null});Kp.displayName=H_;function W_(t,e){return m.useReducer((n,r)=>e[n][r]??n,t)}var Dl=t=>{const{present:e,children:n}=t,r=G_(e),o=typeof n=="function"?n({present:r.isPresent}):m.Children.only(n),s=In(r.ref,q_(o));return typeof n=="function"||r.isPresent?m.cloneElement(o,{ref:s}):null};Dl.displayName="Presence";function G_(t){const[e,n]=m.useState(),r=m.useRef(null),o=m.useRef(t),s=m.useRef("none"),i=t?"mounted":"unmounted",[a,l]=W_(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return m.useEffect(()=>{const c=Do(r.current);s.current=a==="mounted"?c:"none"},[a]),en(()=>{const c=r.current,u=o.current;if(u!==t){const h=s.current,p=Do(c);t?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&h!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),en(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const y=Do(r.current).includes(p.animationName);if(p.target===e&&y&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},h=p=>{p.target===e&&(s.current=Do(r.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:m.useCallback(c=>{r.current=c?getComputedStyle(c):null,n(c)},[])}}function Do(t){return t?.animationName||"none"}function q_(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var V_=ks[" useInsertionEffect ".trim().toString()]||en;function K_({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[o,s,i]=X_({defaultProp:e,onChange:n}),a=t!==void 0,l=a?t:o;{const u=m.useRef(t!==void 0);m.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,r])}const c=m.useCallback(u=>{if(a){const d=J_(u)?u(t):u;d!==t&&i.current?.(d)}else s(u)},[a,t,s,i]);return[l,c]}function X_({defaultProp:t,onChange:e}){const[n,r]=m.useState(t),o=m.useRef(n),s=m.useRef(e);return V_(()=>{s.current=e},[e]),m.useEffect(()=>{o.current!==n&&(s.current?.(n),o.current=n)},[n,o]),[n,r,s]}function J_(t){return typeof t=="function"}var Y_=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Z_="VisuallyHidden",Xp=m.forwardRef((t,e)=>f.jsx(rn.span,{...t,ref:e,style:{...Y_,...t.style}}));Xp.displayName=Z_;var Q_=Xp,[Bs,aR]=Ip("Tooltip",[Lp]),Fs=Lp(),Jp="TooltipProvider",eC=700,ka="tooltip.open",[tC,Ll]=Bs(Jp),Yp=t=>{const{__scopeTooltip:e,delayDuration:n=eC,skipDelayDuration:r=300,disableHoverableContent:o=!1,children:s}=t,i=m.useRef(!0),a=m.useRef(!1),l=m.useRef(0);return m.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),f.jsx(tC,{scope:e,isOpenDelayedRef:i,delayDuration:n,onOpen:m.useCallback(()=>{window.clearTimeout(l.current),i.current=!1},[]),onClose:m.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.current=!0,r)},[r]),isPointerInTransitRef:a,onPointerInTransitChange:m.useCallback(c=>{a.current=c},[]),disableHoverableContent:o,children:s})};Yp.displayName=Jp;var so="Tooltip",[nC,yo]=Bs(so),Zp=t=>{const{__scopeTooltip:e,children:n,open:r,defaultOpen:o,onOpenChange:s,disableHoverableContent:i,delayDuration:a}=t,l=Ll(so,t.__scopeTooltip),c=Fs(e),[u,d]=m.useState(null),h=A_(),p=m.useRef(0),g=i??l.disableHoverableContent,y=a??l.delayDuration,v=m.useRef(!1),[w,_]=K_({prop:r,defaultProp:o??!1,onChange:C=>{C?(l.onOpen(),document.dispatchEvent(new CustomEvent(ka))):l.onClose(),s?.(C)},caller:so}),b=m.useMemo(()=>w?v.current?"delayed-open":"instant-open":"closed",[w]),x=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,v.current=!1,_(!0)},[_]),S=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,_(!1)},[_]),k=m.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{v.current=!0,_(!0),p.current=0},y)},[y,_]);return m.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),f.jsx(L_,{...c,children:f.jsx(nC,{scope:e,contentId:h,open:w,stateAttribute:b,trigger:u,onTriggerChange:d,onTriggerEnter:m.useCallback(()=>{l.isOpenDelayedRef.current?k():x()},[l.isOpenDelayedRef,k,x]),onTriggerLeave:m.useCallback(()=>{g?S():(window.clearTimeout(p.current),p.current=0)},[S,g]),onOpen:x,onClose:S,disableHoverableContent:g,children:n})})};Zp.displayName=so;var Ea="TooltipTrigger",Qp=m.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=yo(Ea,n),s=Ll(Ea,n),i=Fs(n),a=m.useRef(null),l=In(e,a,o.onTriggerChange),c=m.useRef(!1),u=m.useRef(!1),d=m.useCallback(()=>c.current=!1,[]);return m.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),f.jsx(B_,{asChild:!0,...i,children:f.jsx(rn.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...r,ref:l,onPointerMove:Et(t.onPointerMove,h=>{h.pointerType!=="touch"&&!u.current&&!s.isPointerInTransitRef.current&&(o.onTriggerEnter(),u.current=!0)}),onPointerLeave:Et(t.onPointerLeave,()=>{o.onTriggerLeave(),u.current=!1}),onPointerDown:Et(t.onPointerDown,()=>{o.open&&o.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:Et(t.onFocus,()=>{c.current||o.onOpen()}),onBlur:Et(t.onBlur,o.onClose),onClick:Et(t.onClick,o.onClose)})})});Qp.displayName=Ea;var Bl="TooltipPortal",[rC,oC]=Bs(Bl,{forceMount:void 0}),em=t=>{const{__scopeTooltip:e,forceMount:n,children:r,container:o}=t,s=yo(Bl,e);return f.jsx(rC,{scope:e,forceMount:n,children:f.jsx(Dl,{present:n||s.open,children:f.jsx(Kp,{asChild:!0,container:o,children:r})})})};em.displayName=Bl;var vr="TooltipContent",tm=m.forwardRef((t,e)=>{const n=oC(vr,t.__scopeTooltip),{forceMount:r=n.forceMount,side:o="top",...s}=t,i=yo(vr,t.__scopeTooltip);return f.jsx(Dl,{present:r||i.open,children:i.disableHoverableContent?f.jsx(nm,{side:o,...s,ref:e}):f.jsx(sC,{side:o,...s,ref:e})})}),sC=m.forwardRef((t,e)=>{const n=yo(vr,t.__scopeTooltip),r=Ll(vr,t.__scopeTooltip),o=m.useRef(null),s=In(e,o),[i,a]=m.useState(null),{trigger:l,onClose:c}=n,u=o.current,{onPointerInTransitChange:d}=r,h=m.useCallback(()=>{a(null),d(!1)},[d]),p=m.useCallback((g,y)=>{const v=g.currentTarget,w={x:g.clientX,y:g.clientY},_=uC(w,v.getBoundingClientRect()),b=dC(w,_),x=hC(y.getBoundingClientRect()),S=pC([...b,...x]);a(S),d(!0)},[d]);return m.useEffect(()=>()=>h(),[h]),m.useEffect(()=>{if(l&&u){const g=v=>p(v,u),y=v=>p(v,l);return l.addEventListener("pointerleave",g),u.addEventListener("pointerleave",y),()=>{l.removeEventListener("pointerleave",g),u.removeEventListener("pointerleave",y)}}},[l,u,p,h]),m.useEffect(()=>{if(i){const g=y=>{const v=y.target,w={x:y.clientX,y:y.clientY},_=l?.contains(v)||u?.contains(v),b=!fC(w,i);_?h():b&&(h(),c())};return document.addEventListener("pointermove",g),()=>document.removeEventListener("pointermove",g)}},[l,u,i,c,h]),f.jsx(nm,{...t,ref:s})}),[iC,aC]=Bs(so,{isInside:!1}),lC=f_("TooltipContent"),nm=m.forwardRef((t,e)=>{const{__scopeTooltip:n,children:r,"aria-label":o,onEscapeKeyDown:s,onPointerDownOutside:i,...a}=t,l=yo(vr,n),c=Fs(n),{onClose:u}=l;return m.useEffect(()=>(document.addEventListener(ka,u),()=>document.removeEventListener(ka,u)),[u]),m.useEffect(()=>{if(l.trigger){const d=h=>{h.target?.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),f.jsx(Np,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:f.jsxs(F_,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[f.jsx(lC,{children:r}),f.jsx(iC,{scope:n,isInside:!0,children:f.jsx(Q_,{id:l.contentId,role:"tooltip",children:o||r})})]})})});tm.displayName=vr;var rm="TooltipArrow",cC=m.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=Fs(n);return aC(rm,n).isInside?null:f.jsx(U_,{...o,...r,ref:e})});cC.displayName=rm;function uC(t,e){const n=Math.abs(e.top-t.y),r=Math.abs(e.bottom-t.y),o=Math.abs(e.right-t.x),s=Math.abs(e.left-t.x);switch(Math.min(n,r,o,s)){case s:return"left";case o:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function dC(t,e,n=5){const r=[];switch(e){case"top":r.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":r.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":r.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":r.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return r}function hC(t){const{top:e,right:n,bottom:r,left:o}=t;return[{x:o,y:e},{x:n,y:e},{x:n,y:r},{x:o,y:r}]}function fC(t,e){const{x:n,y:r}=t;let o=!1;for(let s=0,i=e.length-1;s<e.length;i=s++){const a=e[s],l=e[i],c=a.x,u=a.y,d=l.x,h=l.y;u>r!=h>r&&n<(d-c)*(r-u)/(h-u)+c&&(o=!o)}return o}function pC(t){const e=t.slice();return e.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),mC(e)}function mC(t){if(t.length<=1)return t.slice();const e=[];for(let r=0;r<t.length;r++){const o=t[r];for(;e.length>=2;){const s=e[e.length-1],i=e[e.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))e.pop();else break}e.push(o)}e.pop();const n=[];for(let r=t.length-1;r>=0;r--){const o=t[r];for(;n.length>=2;){const s=n[n.length-1],i=n[n.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))n.pop();else break}n.push(o)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}var gC=Yp,yC=Zp;const vC={"":m.Fragment,pre:"pre",code:"code",ol:"ol",ul:"ul",hr:"hr",blockquote:"blockquote",li:"li",a:"a",img:"img",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",p:"p",em:"em",strong:"strong"},du=t=>t.replace(RegExp("^"+(t.match(/^(\t| )+/)||"")[0],"gm"),""),wC=t=>t&&typeof t!="string"&&["div","ul","ol","pre","h1","h2","h3","h4","h5","h6"].includes(t.t),Ai=t=>t.replace(/^\s+|\s+$/g," "),xe=(t,e=[],n={})=>({t,c:Array.isArray(e)?e:[e],p:n}),Ur=(t,e=!1)=>{let n=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,r=0;const o=xe("");let s,i;e?(s=xe("p"),i=[o,s],o.c.push(s)):(s=o,i=[o]);let a;const l=(d,h=!0)=>(h&&i.push(d),s.c.push(d),h&&(s=d),d),c=d=>{const h=i.findIndex(p=>p.t===d);i=i.slice(0,h),s=i.at(-1)};for(;a=n.exec(t);){const d=t.substring(r,a.index);if(r=n.lastIndex,d!=="")if(s===o&&e){const h=xe("p",Ai(d));o.c.push(h),i=[o,h],s=h}else s.c.push(Ai(d));if(!d.match(/[^\\](\\\\)*\\$/)){if(a[3]||a[4]){const h=xe("pre",a[4]?du(a[4]):xe("code",du(a[3]),a[2]?{language:`language-${a[2].toLowerCase()}`}:{}));o.c.push(h),i=[o],s=o}else if(a[6]){const h=a[6],p=h!==">",g=!!h.match(/\./),y=p?g?"ol":"ul":"blockquote",v=a[5].split(`
`).map(_=>_.replace(/^(\*|-|\+|>|\d+\.)\s+/,"")).filter(_=>_.trim()!==""),w=xe(y,p?v.map(_=>xe("li",Ur(_).c)):Ur(v.join(`
`)).c);o.c.push(w),i=[o,w],s=o}else if(a[8]){const h=xe("img",[],{src:a[8],...a[7]?{alt:a[7]}:{}});if(e&&s===o){const p=xe("p",h);o.c.push(p),s=p,i=[o,p]}else l(h,!1)}else if(a[10]){const h=i.find(p=>p.t==="a");h&&(h.p.href=a[11])}else if(a[9])l(xe("a"));else if(a[14]){const h="h"+a[14].length;o.c.push(xe(h,Ur(a[15]).c)),i=[o],s=o}else if(a[13])o.c.push(xe("h1",Ur(a[12]).c)),i=[o],s=o;else if(a[16])l(xe("code",a[16]),!1);else if(a[17]?.[0]===`
`||a[17]===`  
`){if(!(i[1]?.t==="p")){const g=o.c;let y;for(y=g.length-1;y>=0&&!wC(g[y]);y--);if(y!==o.c.length-1){const v=o.c.splice(y+1);o.c.push(xe("p",v))}}const p=xe("p");o.c.push(p),i=[o,p],s=p}else if(a[1])o.c.push(xe("hr")),i=[o],s=o;else if(a[17]){const h=a[17].length===2?"strong":"em";i.findIndex(g=>g.t===h)===-1?l(xe(h)):c(h)}}}const u=Ai(t.substring(r));if(u.length){const d=o.c.at(-1);let h;d?.t==="p"?h=d:e?(h=xe("p"),o.c.push(h)):h=o,h.c.push(u)}return o.c=o.c.filter(d=>typeof d=="string"||d.t!=="p"||d.c?.length>0),o},bC=(t,e={})=>{const n={...vC,...e},r=(o,s=0)=>{const i=o.t===""?m.Fragment:n[o.t];return m.createElement(i,{...o.p,key:s},o.c.length===0?void 0:o.c.map((a,l)=>typeof a=="string"?a:r(a,l)))};return r(Ur(t,!0))},xC=({markdown:t,customComponents:e})=>bC(t,e),Lo="leading-none [&_[class*='texture-hud']]:mb-oneScaledPix",_C={h2:function({children:e}){return f.jsx("h2",{className:`mb-1 sprites-double-height text-metallicBlue zx:text-zxBlue clear-both ${Lo}`,children:f.jsx(tt,{children:e})})},h3:function({children:e}){return f.jsx("h3",{className:"mt-1 mb-1 text-metallicBlue zx:text-zxBlue clear-both",children:f.jsx(tt,{children:e})})},blockquote:function({children:e}){return f.jsx("blockquote",{className:`${Lo} mt-1 mb-1 text-moss zx:text-zxBlue clear-both`,children:f.jsxs(tt,{children:["> ",e]})})},p:function({children:e}){return f.jsx("div",{className:`mb-1 last:mb-0 ${Lo}`,children:f.jsx(tt,{children:e})})},a:function({children:e,href:n}){return f.jsx("a",{className:"bitmap-text-link",href:n,target:"_blank",rel:"noopener noreferrer",children:f.jsx(tt,{children:e})})},li:function({children:e}){return f.jsx("div",{className:`mb-1 clear-both ${Lo}`,children:f.jsxs(tt,{children:[f.jsx(z,{className:"text-metallicBlue zx:text-zxYellow",children:"•"}),e]})})},strong:function({children:e}){return f.jsx(tt,{className:"strong text-midRed zx:text-zxRed",children:e})},em:function({children:e}){return f.jsx(tt,{className:"em text-moss zx:text-zxBlue",children:e})},img:function({src:e}){const n=oh();if(e===void 0)throw new Error("image without src");const r=e.split(/\?|&/);return f.jsx("span",{style:{"--scale":n*2},children:f.jsx("span",{className:pl("sprite float-left mr-1 mb-1 zx:sprite-revert-to-two-tone",r.join(" "))})})},hr:function(){return f.jsx("hr",{className:"bg-metallicBlue zx:bg-zxWhite h-half mb-half border-none"})}},CC=({markdown:t,className:e})=>f.jsx("div",{className:`contents ${e}`,children:f.jsx(xC,{customComponents:_C,markdown:t})}),Fl=({triggerContent:t,tooltipContent:e})=>e?f.jsxs(yC,{children:[f.jsx(Qp,{asChild:!0,children:t}),f.jsx(em,{children:f.jsx(Ms,{scaleFactor:2,children:f.jsx(tm,{side:"bottom",align:"end",className:"bg-highlightBeige text-white p-1 mt-oneScaledPix drop-shadow-oneBlock z-popups",children:typeof e=="string"?f.jsx("div",{className:"max-w-16",children:f.jsx(CC,{markdown:e})}):e})})})]}):t,Gt=({className:t,selected:e,disabled:n=!1,onClick:r,ref:o,tooltipContent:s,...i})=>{const a=f.jsx("button",{disabled:n,onClick:r,"data-selected":e,className:Te(`inline-flex items-center justify-center whitespace-nowrap 
          bg-metallicBlue zx:bg-zxBlue border-none border-shadow
          gap-2
           disabled:bg-midGrey disabled:text-lightGrey 
           data-[selected=true]:bg-lightBeige
           [&:not(:disabled):hover:not([data-selected=true])]:bg-pastelBlue 
           `,t),ref:o,...i});return f.jsx(Fl,{triggerContent:a,tooltipContent:s})};var hu=!1,fn,Pa,Ta,ts,ns,om,rs,Aa,Ra,Oa,sm,Ia,ja,im,am;function De(){if(!hu){hu=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),n=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(Ia=/\b(iPhone|iP[ao]d)/.exec(t),ja=/\b(iP[ao]d)/.exec(t),Oa=/Android/i.exec(t),im=/FBAN\/\w+;/i.exec(t),am=/Mobile/i.exec(t),sm=!!/Win64/.exec(t),e){fn=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN,fn&&document&&document.documentMode&&(fn=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(t);om=r?parseFloat(r[1])+4:fn,Pa=e[2]?parseFloat(e[2]):NaN,Ta=e[3]?parseFloat(e[3]):NaN,ts=e[4]?parseFloat(e[4]):NaN,ts?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),ns=e&&e[1]?parseFloat(e[1]):NaN):ns=NaN}else fn=Pa=Ta=ns=ts=NaN;if(n){if(n[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);rs=o?parseFloat(o[1].replace("_",".")):!0}else rs=!1;Aa=!!n[2],Ra=!!n[3]}else rs=Aa=Ra=!1}}var $a={ie:function(){return De()||fn},ieCompatibilityMode:function(){return De()||om>fn},ie64:function(){return $a.ie()&&sm},firefox:function(){return De()||Pa},opera:function(){return De()||Ta},webkit:function(){return De()||ts},safari:function(){return $a.webkit()},chrome:function(){return De()||ns},windows:function(){return De()||Aa},osx:function(){return De()||rs},linux:function(){return De()||Ra},iphone:function(){return De()||Ia},mobile:function(){return De()||Ia||ja||Oa||am},nativeApp:function(){return De()||im},android:function(){return De()||Oa},ipad:function(){return De()||ja}},SC=$a,kC=!!(typeof window<"u"&&window.document&&window.document.createElement),EC={canUseDOM:kC},lm=EC,cm;lm.canUseDOM&&(cm=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);function PC(t,e){if(!lm.canUseDOM||e&&!("addEventListener"in document))return!1;var n="on"+t,r=n in document;if(!r){var o=document.createElement("div");o.setAttribute(n,"return;"),r=typeof o[n]=="function"}return!r&&cm&&t==="wheel"&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var TC=PC,fu=10,pu=40,mu=800;function um(t){var e=0,n=0,r=0,o=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*fu,o=n*fu,"deltaY"in t&&(o=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||o)&&t.deltaMode&&(t.deltaMode==1?(r*=pu,o*=pu):(r*=mu,o*=mu)),r&&!e&&(e=r<1?-1:1),o&&!n&&(n=o<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:o}}um.getEventType=function(){return SC.firefox()?"DOMMouseScroll":TC("wheel")?"wheel":"mousewheel"};var AC=um;/**
* Checks if an event is supported in the current execution environment.
*
* NOTE: This will not work correctly for non-generic events such as `change`,
* `reset`, `load`, `error`, and `select`.
*
* Borrows from Modernizr.
*
* @param {string} eventNameSuffix Event name, e.g. "click".
* @param {?boolean} capture Check if the capture phase is supported.
* @return {boolean} True if the event is supported.
* @internal
* @license Modernizr 3.0.0pre (Custom Build) | MIT
*/const RC=(t,e,n=!1)=>{const r=m.useRef(0),o=m.useCallback(s=>{if(n)return;const i=s;i.preventDefault(),i.stopPropagation();const a=AC(i);r.current-=a.spinY,r.current>=1&&(e(1),r.current=0),r.current<=-1&&(e(-1),r.current=0)},[e,n]);m.useEffect(()=>{const s=t.current;if(s!==null)return s.addEventListener("wheel",o,{passive:!1}),()=>{s.removeEventListener("wheel",o)}},[t,o])},dm=(t,e,n,r=!1)=>{const o=m.useRef(0);return RC(t,s=>{if(e.length===0)return;const i=(o.current+s+256*e.length)%e.length;o.current=i,n(e[i],i)},r)},OC=({value:t,onSelect:e})=>f.jsx(Ds,{value:t,onSelect:e,className:"px-1",children:f.jsx(z,{children:t})}),Us=t=>{const{value:e,values:n,onSelect:r,triggerButtonClassName:o="",triggerButtonStyle:s=de,triggerButtonLabel:i="",OptionCommandItem:a=OC,tooltipContent:l}=t,[c,u]=m.useState(!1),d=m.useRef(null);return dm(d,n,h=>{r(h)},!c),f.jsxs(op,{open:c,onOpenChange:u,children:[f.jsx(sp,{asChild:!0,children:f.jsxs(Gt,{className:Te("h-2 px-1 flex flex-row gap-1 justify-start leading-none",o),style:s,ref:d,tooltipContent:!c&&l,children:[typeof i=="string"?f.jsx(z,{className:"grow overflow-hidden text-left",children:i}):i,f.jsx(z,{className:"grow-0",children:c?"X":"⬇"})]})}),f.jsx(ip,{className:"p-0",children:f.jsx(Ms,{scaleFactor:2,children:f.jsxs(Ep,{value:e,className:"w-[--radix-popper-anchor-width]",children:[t.disableCommandInput===!0?null:f.jsx(Pp,{placeholder:t.placeholder}),f.jsxs(Tp,{children:[f.jsx(Ap,{children:f.jsx(z,{children:"Nothing found"})}),f.jsx(Rp,{children:n.map(h=>f.jsx(a,{value:h,onSelect:p=>{u(!1),r(p)}},h))})]})]})})})]})},IC=()=>{const t=He(),e=sh();return f.jsx(f.Fragment,{children:f.jsx(Us,{value:e,values:ny,onSelect:n=>{t(ry(n))},disableCommandInput:!0,triggerButtonLabel:e,triggerButtonClassName:"w-13"})})};function hm({campaign:t,onSelect:e,headRoomId:n,heelsRoomId:r,value:o,triggerButtonClassName:s,excludeRoomIds:i=[],tooltipContent:a}){const l=Object.keys(t.rooms).filter(c=>!i.includes(c));return f.jsx(Us,{onSelect:c=>e?.(c),value:o,values:l,triggerButtonClassName:s,placeholder:"search",tooltipContent:a,disableCommandInput:!1,triggerButtonLabel:o??"none",OptionCommandItem:({value:c,onSelect:u})=>f.jsxs(Ds,{value:c,onSelect:u,className:"px-1",children:[n===c&&f.jsx("span",{className:"sprite mr-1 my-1 texture-head_walking_towards_2"}),r===c&&f.jsx("span",{className:"sprite mr-1 my-1 texture-heels_walking_towards_2"}),f.jsx(z,{children:c})]})})}const ge=t=>t,fm="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",jC="h-[calc(2*var(--block)-1px*var(--scale))] w-[calc(2*var(--block)-1px*var(--scale))]",W=ge("[button:not([data-selected=true]):not(:hover)_&]:sprite-revert-to-two-tone-dim"),Ae=ge("flex flex-wrap gap-oneScaledPix w-full"),$C=/^(?<modifiers>[⇧⌘^⌥]*)(?<key>.+)$/,NC=t=>{const e=new Set;for(const n of t){if(e.has(n))return!0;e.add(n)}return!1},Ul=(t,e,n)=>{const r=t?.join(" ");m.useEffect(()=>{if(!t||t.length===0)return;const o=s=>{if(s.target.closest(".monaco-editor")===null)for(const l of t){const c=l.match($C);if(!c||!c.groups)continue;const{modifiers:u,key:d}=c.groups;if(NC(u)){console.warn(`Invalid shortcut "${l}": duplicate modifiers`);continue}const h=u.includes("^"),p=u.includes("⌘"),g=u.includes("⇧"),y=u.includes("⌥"),v=h||p||g||y,w=h===s.ctrlKey&&p===s.metaKey&&g===s.shiftKey&&y===s.altKey&&(v||!s.ctrlKey&&!s.metaKey&&!s.shiftKey&&!s.altKey);if((y&&s.altKey?s.code.replace(/^Key/,"").toLowerCase():s.key.toLowerCase())===d.toLowerCase()&&w){e||n?.(),s.preventDefault();break}}};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e,n,r])},ye=({className:t,onClick:e,children:n,disabled:r=!1,isCurrentTool:o=!1,shortcutKeys:s,small:i=!1,tooltipContent:a})=>(Ul(s,r,e),f.jsx(Gt,{disabled:r,selected:o,className:`
        ${i?jC:fm} 
        active:pt-oneScaledPix gap-0 inline-flex overflow-hidden 
        
        ${t??""}`,onClick:e,tooltipContent:a,children:n})),MC=()=>{const t=he(e=>e.levelEditor.selectedJsonItemIds.length>0);return f.jsx(ye,{className:"bg-midRed",disabled:!t,onClick:()=>U.dispatch(Dy()),shortcutKeys:["Delete","Backspace"],tooltipContent:`## Delete items
delete selected item(s)

Hotkey: **Delete** or **Backspace**`,children:f.jsx("span",{className:"sprite sprite-tinted texture-hud_char_X relative"})})},wr=({className:t,value:e,onChange:n,trueLabel:r="ON",falseLabel:o="OFF",label:s,shortcutKeys:i,tooltipContent:a})=>{const l=Math.max(r.length,o.length)+1,c=r.padStart(l," "),u=o.padEnd(l," ");Ul(i,!1,()=>{n?.(!e,void 0)});const d=f.jsxs("span",{onClick:h=>n?.(!e,h),className:Te("inline-flex justify-between",t),children:[s&&f.jsx(z,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),f.jsx(z,{className:Al("inline-block w-min h-min",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:e?c:u})]});return f.jsx(Fl,{triggerContent:d,tooltipContent:a})},zC=({className:t,value:e,onChange:n,values:r,valueLabels:o=[`${r[0]}`,`${r[1]}`,`${r[2]}`],label:s,shortcutKeys:i,tooltipContent:a})=>{const l=r.indexOf(e),c=Math.max(o[0].length,o[1].length+2,o[2].length)+1,u=m.useCallback(()=>{const h=(l+1)%3;n?.(r[h],void 0)},[n,l,r]);Ul(i,!1,()=>{u()});const d=f.jsxs("span",{onClick:u,className:Te("inline-flex justify-between",t),children:[s&&f.jsx(z,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),f.jsx(z,{className:Al("inline-block w-min h-min",l===0?"bg-redShadowHalfbrite text-highlightBeige zx:bg-zxBlack zx:text-zxGreen":l===1?"bg-metallicBlueHalfbrite text-pastelBlue zx:bg-zxBlack zx:text-zxBlue":"bg-pinkHalfbrite text-pink zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:l===0?o[0].padEnd(c," "):l===1?` ${o[1].padStart(Math.floor((c-o[1].length-2)/2)+o[1].length," ").padEnd(c-1," ")} `:o[2].padStart(c," ")})]});return f.jsx(Fl,{triggerContent:d,tooltipContent:a})},DC=({className:t})=>{const e=He();return f.jsx(zC,{className:t,label:"snap",values:Ly,value:he(n=>n.levelEditor.gridResolution),onChange:n=>{e(By(n))},valueLabels:["block","half","2px"],shortcutKeys:["S"],tooltipContent:`snaps to either the grid (like the original game)

or, allows placing on a half-block grid, or to 2px resolution

hotkey: **S**
`})},pm=t=>{const e=he(gn);return Ge(e?.type==="item"&&e.item,t)},j=({itemTool:t,children:e,className:n,shortcutKeys:r,tooltipContent:o})=>{const s=pm(t);return f.jsx(ye,{isCurrentTool:s,className:n,onClick:()=>U.dispatch(wn({type:"item",item:t})),shortcutKeys:r,tooltipContent:o,children:e})},Hl=({main:t,children:e,closeOnSelect:n,ref:r})=>{const[o,s]=m.useState(!1);return f.jsxs(op,{open:o,onOpenChange:s,children:[f.jsx("div",{ref:r,className:Te(fm,"relative",{"drop-shadow-oneBlock z-popups":o}),children:f.jsxs("span",{className:"content",children:[t,f.jsx(sp,{asChild:!0,children:f.jsx(Gt,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:f.jsx(z,{className:"pl-oneScaledPix leading-none py-oneScaledPix",children:o?"X":"⬇"})})})]})}),f.jsx(ip,{children:f.jsx(Ms,{scaleFactor:2,children:f.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:e.map((i,a)=>i===null?null:f.jsx("div",{className:"leading-none",onClick:()=>{n&&s(!1)},children:i},a))})})})]})},Dr=({children:t})=>{const[e,n]=m.useState(0),r=m.useRef(null);dm(r,t,(s,i)=>{n(i)});const o=t[e];return f.jsx(Hl,{main:o,closeOnSelect:!0,ref:r,children:t.map((s,i)=>i===e?null:f.jsx("div",{className:"leading-none",onClick:()=>{n(i)},children:s},i))})},LC=()=>{const e=he(gn)?.type==="pointer";return f.jsx(ye,{onClick:()=>U.dispatch(wn({type:"pointer"})),isCurrentTool:e,shortcutKeys:["Escape","."],tooltipContent:`## Pointer
hotkey: **Esc** or **.**`,children:f.jsx("span",{className:"sprite texture-editor_tool_pointer relative"})})},$={pureBlack:new G("#000000"),shadow:new G("#325149"),midGrey:new G("#7F7773"),lightGrey:new G("#BBB1AB"),white:new G("#FBFEFB"),pastelBlue:new G("#75ACFF"),metallicBlue:new G("#366CAA"),pink:new G("#D68ED1"),moss:new G("#9E9600"),redShadow:new G("#805E50"),midRed:new G("#CA7463"),lightBeige:new G("#DAA78F"),highlightBeige:new G("#EBC690"),alpha:new G("#1E7790"),replaceLight:new G("#08A086"),replaceDark:new G("#0A4730")},Jr=.4,mm=t=>{const[e,n,r]=t.toUint8RgbArray();return new G({r:e*.75,g:n*.75,b:r*.75})},br=(t,e=Jr)=>{const[n,r,o]=t.toUint8RgbArray();return new G({r:n*e,g:r*e,b:o*e})};function lR(t){t=t.replace(/^#/,"");let e=parseInt(t.substring(0,2),16),n=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16);e=Math.floor(e*Jr),n=Math.floor(n*Jr),r=Math.floor(r*Jr);const o=s=>s.toString(16).padStart(2,"0");return`#${o(e)}${o(n)}${o(r)}`}const Ze={original:new G(kr.zxWhite),basic:$.white,dimmed:$.lightGrey},Qe={original:new G(kr.zxYellow),basic:new G(15654246),dimmed:br(new G(15654246),.5)},gm={original:new G(kr.zxYellow),basic:$.midRed,dimmed:$.redShadow},ct={original:new G(kr.zxMagenta),basic:$.pink,dimmed:br($.pink,.5)},_e={original:new G(kr.zxCyan),basic:$.pastelBlue,dimmed:br($.pastelBlue,.5)},ut={original:new G(kr.zxGreen),basic:$.moss,dimmed:br($.moss,.5)},Hs={white:{basic:{main:Ze,edges:{towards:{..._e,dimInOriginal:!1},right:{...Qe,dimInOriginal:!0}},hud:{lives:Qe,dimmed:ct,icons:_e}},dimmed:{main:Ze,edges:{towards:{...ut,dimInOriginal:!1},right:{..._e,dimInOriginal:!0}},hud:{lives:gm,dimmed:ct,icons:_e}}},yellow:{basic:{main:Qe,edges:{towards:{...ut,dimInOriginal:!1},right:{...Ze,dimInOriginal:!0}},hud:{lives:_e,dimmed:ct,icons:ut}},dimmed:{main:Qe,edges:{towards:{..._e,dimInOriginal:!0},right:{..._e,dimInOriginal:!1}},hud:{lives:_e,dimmed:ct,icons:ut}}},magenta:{basic:{main:ct,edges:{towards:{...ut,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Ze,dimmed:_e,icons:Qe}},dimmed:{main:ct,edges:{towards:{...ut,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Ze,dimmed:_e,icons:Qe}}},cyan:{basic:{main:_e,edges:{towards:{...ct,dimInOriginal:!1},right:{...Ze,dimInOriginal:!1}},hud:{lives:Ze,dimmed:ut,icons:Qe}},dimmed:{main:_e,edges:{towards:{...ct,dimInOriginal:!0},right:{...Ze,dimInOriginal:!0}},hud:{lives:Ze,dimmed:ut,icons:Qe}}},green:{basic:{main:ut,edges:{towards:{..._e,dimInOriginal:!1},right:{...Qe,dimInOriginal:!1}},hud:{lives:Ze,dimmed:ct,icons:_e}},dimmed:{main:ut,edges:{towards:{..._e,dimInOriginal:!0},right:{...Qe,dimInOriginal:!0}},hud:{lives:Ze,dimmed:ct,icons:_e}}}},vs=t=>Hs[t.hue][t.shade],rr={head:$.pastelBlue,heels:$.pink},gu=t=>{const{main:e}=Hs[t].basic;return{backgroundColor:e.basic.toHex(),borderColor:e.dimmed.toHex()}};function BC(){const t=He(),e=he(Fy);return f.jsxs(f.Fragment,{children:[f.jsx(Us,{value:e.hue,onSelect:n=>{t(ic({hue:n}))},values:oy,disableCommandInput:!0,OptionCommandItem:({value:n,onSelect:r})=>f.jsx(Ds,{value:n,className:"border-l-3 h-2 w-full p-0",style:gu(n),onSelect:r}),triggerButtonLabel:"colour",triggerButtonClassName:Te("w-full",`${e.hue==="white"||e.hue==="yellow"?"text-pureBlack":"text-white"}`),triggerButtonStyle:gu(e.hue),tooltipContent:"Change the colour of this room"}),f.jsx(wr,{className:"",label:"shade",value:e.shade==="basic",onChange:n=>{t(ic({shade:n?"basic":"dimmed"}))},falseLabel:"dim",trueLabel:"basic"})]})}function FC(){const t=He(),e=he(Uy);return f.jsx(Us,{value:e,onSelect:n=>{t(Hy(n))},values:sy,placeholder:"scenery",triggerButtonClassName:"w-full",triggerButtonLabel:e,tooltipContent:"Change this room’s scenery"})}const _t=({iconClasses:t,text:e,className:n=""})=>f.jsxs("div",{className:`relative w-full h-full ${n}`,children:[f.jsx("span",{className:`sprite absolute top-0 left-0 ${t} ${W}`}),f.jsx(z,{className:"bg-moss text-pureBlack absolute top-0 left-0 pl-oneScaledPix py-oneScaledPix block leading-none",children:e})]}),Bo=({iconClassName:t})=>f.jsx(Ct,{topClasses:ge("texture-bubbles_white_2 [button:hover_&]:texture-animated-bubbles_white"),bottomClasses:t}),Ct=({topClasses:t,bottomClasses:e="texture-headlessBase"})=>f.jsxs("div",{className:"relative w-full h-full",children:[f.jsx("span",{className:`sprite absolute top-[calc(9px*var(--scale))] left-0 ${e} ${W}`}),f.jsx("span",{className:`sprite absolute top-[calc(-3px*var(--scale))] left-0 ${t} ${W}`})]}),UC="[button:not(:disabled):hover_&]:hidden",HC="hidden [button:not(:disabled):hover_&]:inline mt-quarter",WC="hidden [button:not(:disabled):hover_&]:inline",Na=({icon:t,topText:e,bottomText:n})=>f.jsxs("span",{className:"w-full h-full flex flex-col items-center justify-center",children:[f.jsx("span",{className:UC,children:t}),f.jsx(z,{className:HC,children:e}),f.jsx(z,{className:WC,children:n})]}),GC=()=>{const t=He(),e=he(Wy),n=he(Gy);return f.jsxs("div",{className:"flex flex-row gap-oneScaledPix bg-metallicBlue",children:[f.jsx(ye,{disabled:!e,onClick:()=>{t(qy())},shortcutKeys:["⌘Z","^Z"],children:f.jsx(Na,{icon:f.jsx(z,{children:"⬅"}),topText:"un",bottomText:"do"})}),f.jsx(ye,{disabled:!n,onClick:()=>{t(Vy())},shortcutKeys:["⌘⇧Z","^⇧Z"],children:f.jsx(Na,{icon:f.jsx(z,{children:"➡"}),topText:"re",bottomText:"do"})})]})},qC=({className:t})=>{const e=He();return f.jsx(wr,{className:t,label:"scenery",value:he(n=>n.levelEditor.wallsFloorsLocked),onChange:n=>{e(Ky(n))},falseLabel:"edit",trueLabel:"lock",shortcutKeys:["C"],tooltipContent:`locks walls and floors, to edit their contents

hotkey: **C**
`})};function yu(t){return{type:"door",config:{direction:"away",toRoom:t?"+":"nowhere"}}}const VC=()=>{const[t,e]=m.useState(!0),n=he(i=>fr(i).planet),r=ge(n==="moonbase"?"texture-door_frame_moonbase_x_whole":"texture-door_frame_generic_x_whole"),o=yu(t),s=pm(o);return f.jsx(Hl,{main:f.jsx(j,{itemTool:o,shortcutKeys:["D"],children:f.jsx(_t,{iconClasses:`sprite top-[calc(-17px*var(--scale))] left-[calc(-2px*var(--scale))] ${r} ${W}`,text:t?"+":""})}),children:[f.jsx(wr,{className:"w-full",value:t,label:"auto + room",onChange:i=>{e(i),s&&U.dispatch(wn({type:"item",item:yu(i)}))}},"autoAddDoor")]})},KC=()=>{const t=he(r=>fr(r).planet),e={type:"wall",config:{direction:"away",tiles:Array.from(Xy(t,1))}},n=ge(t==="blacktooth"?"texture-blacktooth_wall_plain_away":t==="bookworld"?"texture-bookworld_wall_cowboy_away":t==="jail"?"texture-jail_wall_bars_away":t==="egyptus"?"texture-egyptus_wall_hieroglyphics_away":t==="market"?"texture-market_wall_passage_away":t==="moonbase"?"texture-moonbase_wall_window1_away":t==="penitentiary"?"texture-penitentiary_wall_loop_away":"texture-safari_wall_wall_away");return f.jsx(j,{itemTool:e,children:f.jsx("span",{className:`sprite ${n} ${W}`})})},XC=()=>f.jsx(ye,{className:"bg-midRed",onClick:()=>U.dispatch(Jy()),tooltipContent:`## Clear room

Clears the room out, leaving just walls, floors, and doors`,children:f.jsx(z,{className:"relative leading-none",children:"CLR"})}),ym=({currentRoomId:t,direction:e})=>{const n=he(({levelEditor:s})=>s.campaignInProgress),r=he(({levelEditor:s})=>s.currentlyEditingRoomId),o=He();return f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap pt-1",children:[f.jsxs(z,{className:"text-lightGrey leading-none",children:["Room ",e==="above"?"⬆":"⬇"]}),f.jsx("div",{className:"flex-grow"}),f.jsxs("div",{className:"flex flex-row gap-oneScaledPix",children:[f.jsx(Gt,{className:"w-2 leading-none bg-moss",tooltipContent:`Add a new room *${e}* this one`,children:f.jsx(z,{onClick:()=>o(oi({direction:e,createNew:!0})),children:"+"})}),f.jsx(Gt,{className:"w-2 leading-none bg-midRed",tooltipContent:`Break the link with the room *${e}*`,children:f.jsx(z,{onClick:()=>o(oi({direction:e,createNew:!1,roomId:void 0})),children:"x"})})]})]}),f.jsx("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap",children:f.jsx(hm,{value:t,campaign:n,excludeRoomIds:[r],triggerButtonClassName:"w-full",onSelect:s=>{o(oi({direction:e,createNew:!1,roomId:s}))},tooltipContent:`Select a room to place *${e}* this one`})})]})},JC=()=>{const t=he(({levelEditor:e})=>hh(e).roomAbove);return f.jsx(f.Fragment,{children:f.jsx(ym,{currentRoomId:t,direction:"above"})})},YC=()=>{const t=he(({levelEditor:e})=>hh(e).roomBelow);return f.jsx(f.Fragment,{children:f.jsx(ym,{currentRoomId:t,direction:"below"})})},ZC=()=>{const t=he(({levelEditor:e})=>e.tool.type==="eyeDropper");return f.jsx(ye,{shortcutKeys:["I",","],isCurrentTool:t,onClick:()=>U.dispatch(wn({type:"eyeDropper"})),tooltipContent:`## eye-dropper

click on an item in the room to copy it and put a copy down somewhere else
  
hotkey: **I** or **,**`,children:f.jsx("span",{className:"relative sprite texture-editor_tool_eyedropper leading-none"})})},Ws=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const QC="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Hr=Array.prototype.slice.call(QC),Fo=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(Hr),eS=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,os=String.fromCharCode.bind(String),vu=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),tS=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),vm=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),nS=t=>{let e,n,r,o,s="";const i=t.length%3;for(let a=0;a<t.length;){if((n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(o=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|o,s+=Hr[e>>18&63]+Hr[e>>12&63]+Hr[e>>6&63]+Hr[e&63]}return i?s.slice(0,i-3)+"===".substring(i):s},rS=typeof btoa=="function"?t=>btoa(t):Ws?t=>Buffer.from(t,"binary").toString("base64"):nS,wu=Ws?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let r=0,o=t.length;r<o;r+=4096)n.push(os.apply(null,t.subarray(r,r+4096)));return rS(n.join(""))},oS=(t,e=!1)=>e?tS(wu(t)):wu(t),sS=t=>{if(t=t.replace(/\s+/g,""),!eS.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,o;for(let s=0;s<t.length;)e=Fo[t.charAt(s++)]<<18|Fo[t.charAt(s++)]<<12|(r=Fo[t.charAt(s++)])<<6|(o=Fo[t.charAt(s++)]),n+=r===64?os(e>>16&255):o===64?os(e>>16&255,e>>8&255):os(e>>16&255,e>>8&255,e&255);return n},iS=typeof atob=="function"?t=>atob(vm(t)):Ws?t=>Buffer.from(t,"base64").toString("binary"):sS,aS=Ws?t=>vu(Buffer.from(t,"base64")):t=>vu(iS(t).split("").map(e=>e.charCodeAt(0))),lS=t=>aS(cS(t)),cS=t=>vm(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),uS=!0,wm="gzip",bm=async t=>{const e=JSON.stringify(t),r=new TextEncoder().encode(e),o=new Blob([r]),s=new CompressionStream(wm),i=o.stream().pipeThrough(s),a=await new Response(i).arrayBuffer(),l=new Uint8Array(a);return oS(l,uS)},dS=async t=>{try{const e=lS(t),n=new Blob([e]),r=new DecompressionStream(wm),o=n.stream().pipeThrough(r),s=await new Response(o).text();return JSON.parse(s)}catch(e){throw new Error("error decompressing object",{cause:e})}},hS=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>qt(async()=>{const{default:r}=await Promise.resolve().then(()=>Rr);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)};class Wl extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class fS extends Wl{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class bu extends Wl{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class xu extends Wl{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ma;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Ma||(Ma={}));var pS=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class mS{constructor(e,{headers:n={},customFetch:r,region:o=Ma.Any}={}){this.url=e,this.headers=n,this.region=o,this.fetch=hS(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,n={}){var r;return pS(this,void 0,void 0,function*(){try{const{headers:o,method:s,body:i}=n;let a={},{region:l}=n;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(a["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:u}).catch(y=>{throw new fS(y)}),h=d.headers.get("x-relay-error");if(h&&h==="true")throw new bu(d);if(!d.ok)throw new xu(d);let p=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return p==="application/json"?g=yield d.json():p==="application/octet-stream"?g=yield d.blob():p==="text/event-stream"?g=d:p==="multipart/form-data"?g=yield d.formData():g=yield d.text(),{data:g,error:null,response:d}}catch(o){return{data:null,error:o,response:o instanceof xu||o instanceof bu?o.context:void 0}}})}}var Ce={},Dn={},Ln={},Bn={},Fn={},Un={},gS=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},xr=gS();const yS=xr.fetch,xm=xr.fetch.bind(xr),_m=xr.Headers,vS=xr.Request,wS=xr.Response,Rr=Object.freeze(Object.defineProperty({__proto__:null,Headers:_m,Request:vS,Response:wS,default:xm,fetch:yS},Symbol.toStringTag,{value:"Module"})),bS=iy(Rr);var Uo={},_u;function Cm(){if(_u)return Uo;_u=1,Object.defineProperty(Uo,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return Uo.default=t,Uo}var Cu;function Sm(){if(Cu)return Un;Cu=1;var t=Un&&Un.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Un,"__esModule",{value:!0});const e=t(bS),n=t(Cm());class r{constructor(s){this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=s.headers,this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=s.shouldThrowOnError,this.signal=s.signal,this.isMaybeSingle=s.isMaybeSingle,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=Object.assign({},this.headers),this.headers[s]=i,this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,h;let p=null,g=null,y=null,v=c.status,w=c.statusText;if(c.ok){if(this.method!=="HEAD"){const S=await c.text();S===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=S:g=JSON.parse(S))}const b=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),x=(d=c.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");b&&x&&x.length>1&&(y=parseInt(x[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(p={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,y=null,v=406,w="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const b=await c.text();try{p=JSON.parse(b),Array.isArray(p)&&c.status===404&&(g=[],p=null,v=200,w="OK")}catch{c.status===404&&b===""?(v=204,w="No Content"):p={message:b}}if(p&&this.isMaybeSingle&&(!((h=p?.details)===null||h===void 0)&&h.includes("0 rows"))&&(p=null,v=200,w="OK"),p&&this.shouldThrowOnError)throw new n.default(p)}return{error:p,data:g,count:y,status:v,statusText:w}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,h;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(d=c?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(h=c?.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,i)}returns(){return this}overrideTypes(){return this}}return Un.default=r,Un}var Su;function km(){if(Su)return Fn;Su=1;var t=Fn&&Fn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Fn,"__esModule",{value:!0});const e=t(Sm());class n extends e.default{select(o){let s=!1;const i=(o??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(o,{ascending:s=!0,nullsFirst:i,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${o}.${s?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:s,referencedTable:i=s}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${o}`),this}range(o,s,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${o}`),this.url.searchParams.set(c,`${s-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:o=!1,verbose:s=!1,settings:i=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[o?"analyze":null,s?"verbose":null,i?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),h=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${h}"; options=${d};`,c==="json"?this:this}rollback(){var o;return((o=this.headers.Prefer)!==null&&o!==void 0?o:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Fn.default=n,Fn}var ku;function Gl(){if(ku)return Bn;ku=1;var t=Bn&&Bn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Bn,"__esModule",{value:!0});const e=t(km());class n extends e.default{eq(o,s){return this.url.searchParams.append(o,`eq.${s}`),this}neq(o,s){return this.url.searchParams.append(o,`neq.${s}`),this}gt(o,s){return this.url.searchParams.append(o,`gt.${s}`),this}gte(o,s){return this.url.searchParams.append(o,`gte.${s}`),this}lt(o,s){return this.url.searchParams.append(o,`lt.${s}`),this}lte(o,s){return this.url.searchParams.append(o,`lte.${s}`),this}like(o,s){return this.url.searchParams.append(o,`like.${s}`),this}likeAllOf(o,s){return this.url.searchParams.append(o,`like(all).{${s.join(",")}}`),this}likeAnyOf(o,s){return this.url.searchParams.append(o,`like(any).{${s.join(",")}}`),this}ilike(o,s){return this.url.searchParams.append(o,`ilike.${s}`),this}ilikeAllOf(o,s){return this.url.searchParams.append(o,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(o,s){return this.url.searchParams.append(o,`ilike(any).{${s.join(",")}}`),this}is(o,s){return this.url.searchParams.append(o,`is.${s}`),this}in(o,s){const i=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(o,`in.(${i})`),this}contains(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cs.{${s.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(s)}`),this}containedBy(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cd.{${s.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(s)}`),this}rangeGt(o,s){return this.url.searchParams.append(o,`sr.${s}`),this}rangeGte(o,s){return this.url.searchParams.append(o,`nxl.${s}`),this}rangeLt(o,s){return this.url.searchParams.append(o,`sl.${s}`),this}rangeLte(o,s){return this.url.searchParams.append(o,`nxr.${s}`),this}rangeAdjacent(o,s){return this.url.searchParams.append(o,`adj.${s}`),this}overlaps(o,s){return typeof s=="string"?this.url.searchParams.append(o,`ov.${s}`):this.url.searchParams.append(o,`ov.{${s.join(",")}}`),this}textSearch(o,s,{config:i,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=i===void 0?"":`(${i})`;return this.url.searchParams.append(o,`${l}fts${c}.${s}`),this}match(o){return Object.entries(o).forEach(([s,i])=>{this.url.searchParams.append(s,`eq.${i}`)}),this}not(o,s,i){return this.url.searchParams.append(o,`not.${s}.${i}`),this}or(o,{foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${o})`),this}filter(o,s,i){return this.url.searchParams.append(o,`${s}.${i}`),this}}return Bn.default=n,Bn}var Eu;function Em(){if(Eu)return Ln;Eu=1;var t=Ln&&Ln.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ln,"__esModule",{value:!0});const e=t(Gl());class n{constructor(o,{headers:s={},schema:i,fetch:a}){this.url=o,this.headers=s,this.schema=i,this.fetch=a}select(o,{head:s=!1,count:i}={}){const a=s?"HEAD":"GET";let l=!1;const c=(o??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),i&&(this.headers.Prefer=`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(o,{count:s,defaultToNull:i=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(o)){const c=o.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}upsert(o,{onConflict:s,ignoreDuplicates:i=!1,count:a,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${i?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(o)){const d=o.reduce((h,p)=>h.concat(Object.keys(p)),[]);if(d.length>0){const h=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}update(o,{count:s}={}){const i="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}delete({count:o}={}){const s="DELETE",i=[];return o&&i.push(`count=${o}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Ln.default=n,Ln}var Lr={},Br={},Pu;function xS(){return Pu||(Pu=1,Object.defineProperty(Br,"__esModule",{value:!0}),Br.version=void 0,Br.version="0.0.0-automated"),Br}var Tu;function _S(){if(Tu)return Lr;Tu=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.DEFAULT_HEADERS=void 0;const t=xS();return Lr.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${t.version}`},Lr}var Au;function CS(){if(Au)return Dn;Au=1;var t=Dn&&Dn.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Dn,"__esModule",{value:!0});const e=t(Em()),n=t(Gl()),r=_S();class o{constructor(i,{headers:a={},schema:l,fetch:c}={}){this.url=i,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new o(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:l=!1,get:c=!1,count:u}={}){let d;const h=new URL(`${this.url}/rpc/${i}`);let p;l||c?(d=l?"HEAD":"GET",Object.entries(a).filter(([y,v])=>v!==void 0).map(([y,v])=>[y,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([y,v])=>{h.searchParams.append(y,v)})):(d="POST",p=a);const g=Object.assign({},this.headers);return u&&(g.Prefer=`count=${u}`),new n.default({method:d,url:h,headers:g,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return Dn.default=o,Dn}var Ru;function SS(){if(Ru)return Ce;Ru=1;var t=Ce&&Ce.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.PostgrestError=Ce.PostgrestBuilder=Ce.PostgrestTransformBuilder=Ce.PostgrestFilterBuilder=Ce.PostgrestQueryBuilder=Ce.PostgrestClient=void 0;const e=t(CS());Ce.PostgrestClient=e.default;const n=t(Em());Ce.PostgrestQueryBuilder=n.default;const r=t(Gl());Ce.PostgrestFilterBuilder=r.default;const o=t(km());Ce.PostgrestTransformBuilder=o.default;const s=t(Sm());Ce.PostgrestBuilder=s.default;const i=t(Cm());return Ce.PostgrestError=i.default,Ce.default={PostgrestClient:e.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:s.default,PostgrestError:i.default},Ce}var kS=SS();const ES=Ot(kS),{PostgrestClient:PS,PostgrestQueryBuilder:cR,PostgrestFilterBuilder:uR,PostgrestTransformBuilder:dR,PostgrestBuilder:hR,PostgrestError:fR}=ES;function TS(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const AS=TS(),RS="2.11.15",OS=`realtime-js/${RS}`,IS="1.0.0",Pm=1e4,jS=1e3;var Yr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Yr||(Yr={}));var Re;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Re||(Re={}));var nt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(nt||(nt={}));var za;(function(t){t.websocket="websocket"})(za||(za={}));var pn;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(pn||(pn={}));class $S{constructor(){this.HEADER_LENGTH=1}decode(e,n){return e.constructor===ArrayBuffer?n(this._binaryDecode(e)):n(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const n=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,n,r)}_decodeBroadcast(e,n,r){const o=n.getUint8(1),s=n.getUint8(2);let i=this.HEADER_LENGTH+2;const a=r.decode(e.slice(i,i+o));i=i+o;const l=r.decode(e.slice(i,i+s));i=i+s;const c=JSON.parse(r.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class Tm{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var fe;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(fe||(fe={}));const Ou=(t,e,n={})=>{var r;const o=(r=n.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,i)=>(s[i]=NS(i,t,e,o),s),{})},NS=(t,e,n,r)=>{const o=e.find(a=>a.name===t),s=o?.type,i=n[t];return s&&!r.includes(s)?Am(s,i):Da(i)},Am=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return LS(e,n)}switch(t){case fe.bool:return MS(e);case fe.float4:case fe.float8:case fe.int2:case fe.int4:case fe.int8:case fe.numeric:case fe.oid:return zS(e);case fe.json:case fe.jsonb:return DS(e);case fe.timestamp:return BS(e);case fe.abstime:case fe.date:case fe.daterange:case fe.int4range:case fe.int8range:case fe.money:case fe.reltime:case fe.text:case fe.time:case fe.timestamptz:case fe.timetz:case fe.tsrange:case fe.tstzrange:return Da(e);default:return Da(e)}},Da=t=>t,MS=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},zS=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},DS=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},LS=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let s;const i=t.slice(1,n);try{s=JSON.parse("["+i+"]")}catch{s=i?i.split(","):[]}return s.map(a=>Am(e,a))}return t},BS=t=>typeof t=="string"?t.replace(" ","T"):t,Rm=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ri{constructor(e,n,r={},o=Pm){this.channel=e,this.event=n,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Iu;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Iu||(Iu={}));class Zr{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Zr.syncState(this.state,o,s,i),this.pendingDiffs.forEach(l=>{this.state=Zr.syncDiff(this.state,l,s,i)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=Zr.syncDiff(this.state,o,s,i),a())}),this.onJoin((o,s,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:s,newPresences:i})}),this.onLeave((o,s,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:s,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,o){const s=this.cloneDeep(e),i=this.transformState(n),a={},l={};return this.map(s,(c,u)=>{i[c]||(l[c]=u)}),this.map(i,(c,u)=>{const d=s[c];if(d){const h=u.map(v=>v.presence_ref),p=d.map(v=>v.presence_ref),g=u.filter(v=>p.indexOf(v.presence_ref)<0),y=d.filter(v=>h.indexOf(v.presence_ref)<0);g.length>0&&(a[c]=g),y.length>0&&(l[c]=y)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},r,o)}static syncDiff(e,n,r,o){const{joins:s,leaves:i}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(s,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(p=>p.presence_ref),h=u.filter(p=>d.indexOf(p.presence_ref)<0);e[a].unshift(...h)}r(a,u,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,o(a,c,l),c.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const o=e[r];return"metas"in o?n[r]=o.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):n[r]=o,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ju;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(ju||(ju={}));var $u;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})($u||($u={}));var kt;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(kt||(kt={}));class ql{constructor(e,n={config:{}},r){this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Re.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Ri(this,nt.join,this.params,this.timeout),this.rejoinTimer=new Tm(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Re.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Re.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Re.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Re.errored,this.rejoinTimer.scheduleTimeout())}),this._on(nt.reply,{},(o,s)=>{this._trigger(this._replyEventName(s),o)}),this.presence=new Zr(this),this.broadcastEndpointURL=Rm(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,n=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Re.closed){const{config:{broadcast:s,presence:i,private:a}}=this.params;this._onError(u=>e?.(kt.CHANNEL_ERROR,u)),this._onClose(()=>e?.(kt.CLOSED));const l={},c={broadcast:s,presence:i,postgres_changes:(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){e?.(kt.SUBSCRIBED);return}else{const h=this.bindings.postgres_changes,p=(d=h?.length)!==null&&d!==void 0?d:0,g=[];for(let y=0;y<p;y++){const v=h[y],{filter:{event:w,schema:_,table:b,filter:x}}=v,S=u&&u[y];if(S&&S.event===w&&S.schema===_&&S.table===b&&S.filter===x)g.push(Object.assign(Object.assign({},v),{id:S.id}));else{this.unsubscribe(),this.state=Re.errored,e?.(kt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(kt.SUBSCRIBED);return}}).receive("error",u=>{this.state=Re.errored,e?.(kt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e?.(kt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this._on(e,n,r)}async send(e,n={}){var r,o;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var i,a,l;const c=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Re.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(nt.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(o=>{r=new Ri(this,nt.leave,{},e),r.receive("ok",()=>{n(),o("ok")}).receive("timeout",()=>{n(),o("timed out")}).receive("error",()=>{o("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,n,r){const o=new AbortController,s=setTimeout(()=>o.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:o.signal}));return clearTimeout(s),i}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Ri(this,e,n,r);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var o,s;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=nt;if(r&&[a,l,c,u].indexOf(i)>=0&&r!==this._joinRef())return;let h=this._onMessage(i,n,r);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(p=>{var g,y,v;return((g=p.filter)===null||g===void 0?void 0:g.event)==="*"||((v=(y=p.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(p=>p.callback(h,r)):(s=this.bindings[i])===null||s===void 0||s.filter(p=>{var g,y,v,w,_,b;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in p){const x=p.id,S=(g=p.filter)===null||g===void 0?void 0:g.event;return x&&((y=n.ids)===null||y===void 0?void 0:y.includes(x))&&(S==="*"||S?.toLocaleLowerCase()===((v=n.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const x=(_=(w=p?.filter)===null||w===void 0?void 0:w.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return x==="*"||x===((b=n?.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===i}).map(p=>{if(typeof h=="object"&&"ids"in h){const g=h.data,{schema:y,table:v,commit_timestamp:w,type:_,errors:b}=g;h=Object.assign(Object.assign({},{schema:y,table:v,commit_timestamp:w,eventType:_,new:{},old:{},errors:b}),this._getPayloadRecords(g))}p.callback(h,r)})}_isClosed(){return this.state===Re.closed}_isJoined(){return this.state===Re.joined}_isJoining(){return this.state===Re.joining}_isLeaving(){return this.state===Re.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const o=e.toLocaleLowerCase(),s={type:o,filter:n,callback:r};return this.bindings[o]?this.bindings[o].push(s):this.bindings[o]=[s],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(o=>{var s;return!(((s=o.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&ql.isEqual(o.filter,n))}),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(nt.close,{},e)}_onError(e){this._on(nt.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Re.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Ou(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Ou(e.columns,e.old_record)),n}}const Nu=()=>{},FS=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class US{constructor(e,n){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Pm,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Nu,this.ref=0,this.logger=Nu,this.conn=null,this.sendBuffer=[],this.serializer=new $S,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>qt(async()=>{const{default:l}=await Promise.resolve().then(()=>Rr);return{default:l}},void 0).then(({default:l})=>l(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${za.websocket}`,this.httpEndpoint=Rm(e),n?.transport?this.transport=n.transport:this.transport=null,n?.params&&(this.params=n.params),n?.timeout&&(this.timeout=n.timeout),n?.logger&&(this.logger=n.logger),(n?.logLevel||n?.log_level)&&(this.logLevel=n.logLevel||n.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),n?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=n.heartbeatIntervalMs);const o=(r=n?.params)===null||r===void 0?void 0:r.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=n?.reconnectAfterMs?n.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=n?.encode?n.encode:(s,i)=>i(JSON.stringify(s)),this.decode=n?.decode?n.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Tm(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(n?.fetch),n?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=n?.worker||!1,this.workerUrl=n?.workerUrl}this.accessToken=n?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=AS),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:IS}))}disconnect(e,n){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,n??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Yr.connecting:return pn.Connecting;case Yr.open:return pn.Open;case Yr.closing:return pn.Closing;default:return pn.Closed}}isConnected(){return this.connectionState()===pn.Open}channel(e,n={config:{}}){const r=`realtime:${e}`,o=this.getChannels().find(s=>s.topic===r);if(o)return o;{const s=new ql(`realtime:${e}`,n,this);return this.channels.push(s),s}}push(e){const{topic:n,event:r,payload:o,ref:s}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${s})`,o),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let n=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const o={access_token:n,version:OS};n&&r.updateJoinPayload(o),r.joinedOnce&&r._isJoined()&&r._push(nt.access_token,{access_token:n})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(jS,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,n=>{let{topic:r,event:o,payload:s,ref:i}=n;r==="phoenix"&&o==="phx_reply"&&this.heartbeatCallback(n.payload.status=="ok"?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${r} ${o} ${i&&"("+i+")"||""}`,s),Array.from(this.channels).filter(a=>a._isMember(r)).forEach(a=>a._trigger(o,s,i)),this.stateChangeCallbacks.message.forEach(a=>a(n))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(n=>n(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(n=>n(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(nt.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",o=new URLSearchParams(n);return`${e}${r}${o}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([FS],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}}class Vl extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Se(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class HS extends Vl{constructor(e,n){super(e),this.name="StorageApiError",this.status=n}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class La extends Vl{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}var WS=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const Om=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>qt(async()=>{const{default:r}=await Promise.resolve().then(()=>Rr);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},GS=()=>WS(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield qt(()=>Promise.resolve().then(()=>Rr),void 0)).Response:Response}),Ba=t=>{if(Array.isArray(t))return t.map(n=>Ba(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const o=n.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[o]=Ba(r)}),e};var jn=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const Oi=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),qS=(t,e,n)=>jn(void 0,void 0,void 0,function*(){const r=yield GS();t instanceof r&&!n?.noResolveJson?t.json().then(o=>{e(new HS(Oi(o),t.status||500))}).catch(o=>{e(new La(Oi(o),o))}):e(new La(Oi(t),t))}),VS=(t,e,n,r)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),r&&(o.body=JSON.stringify(r)),Object.assign(Object.assign({},o),n))};function vo(t,e,n,r,o,s){return jn(this,void 0,void 0,function*(){return new Promise((i,a)=>{t(n,VS(e,r,o,s)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>qS(l,a,r))})})}function ws(t,e,n,r){return jn(this,void 0,void 0,function*(){return vo(t,"GET",e,n,r)})}function Ft(t,e,n,r,o){return jn(this,void 0,void 0,function*(){return vo(t,"POST",e,r,o,n)})}function KS(t,e,n,r,o){return jn(this,void 0,void 0,function*(){return vo(t,"PUT",e,r,o,n)})}function XS(t,e,n,r){return jn(this,void 0,void 0,function*(){return vo(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function Im(t,e,n,r,o){return jn(this,void 0,void 0,function*(){return vo(t,"DELETE",e,r,o,n)})}var Le=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const JS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Mu={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class YS{constructor(e,n={},r,o){this.url=e,this.headers=n,this.bucketId=r,this.fetch=Om(o)}uploadOrUpdate(e,n,r,o){return Le(this,void 0,void 0,function*(){try{let s;const i=Object.assign(Object.assign({},Mu),o);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=r,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));const c=this._removeEmptyFolders(n),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:s,headers:a},i?.duplex?{duplex:i.duplex}:{})),h=yield d.json();return d.ok?{data:{path:c,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(s){if(Se(s))return{data:null,error:s};throw s}})}upload(e,n,r){return Le(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,o){return Le(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),i=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",n);try{let l;const c=Object.assign({upsert:Mu.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),h=yield d.json();return d.ok?{data:{path:s,fullPath:h.Key},error:null}:{data:null,error:h}}catch(l){if(Se(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,n){return Le(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const o=Object.assign({},this.headers);n?.upsert&&(o["x-upsert"]="true");const s=yield Ft(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),i=new URL(this.url+s.url),a=i.searchParams.get("token");if(!a)throw new Vl("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}update(e,n,r){return Le(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return Le(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}copy(e,n,r){return Le(this,void 0,void 0,function*(){try{return{data:{path:(yield Ft(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrl(e,n,r){return Le(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),s=yield Ft(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:n},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${i}`)},{data:s,error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrls(e,n,r){return Le(this,void 0,void 0,function*(){try{const o=yield Ft(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${s}`):null})),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}download(e,n){return Le(this,void 0,void 0,function*(){const o=typeof n?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(n?.transform||{}),i=s?`?${s}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield ws(this.fetch,`${this.url}/${o}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Se(a))return{data:null,error:a};throw a}})}info(e){return Le(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield ws(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:Ba(r),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}exists(e){return Le(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield XS(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Se(r)&&r instanceof La){const o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),o=[],s=n?.download?`download=${n.download===!0?"":n.download}`:"";s!==""&&o.push(s);const a=typeof n?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(n?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return Le(this,void 0,void 0,function*(){try{return{data:yield Im(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}list(e,n,r){return Le(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},JS),n),{prefix:e||""});return{data:yield Ft(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const ZS="2.7.1",QS={"X-Client-Info":`storage-js/${ZS}`};var Hn=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class ek{constructor(e,n={},r){this.url=e,this.headers=Object.assign(Object.assign({},QS),n),this.fetch=Om(r)}listBuckets(){return Hn(this,void 0,void 0,function*(){try{return{data:yield ws(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Se(e))return{data:null,error:e};throw e}})}getBucket(e){return Hn(this,void 0,void 0,function*(){try{return{data:yield ws(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}createBucket(e,n={public:!1}){return Hn(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}updateBucket(e,n){return Hn(this,void 0,void 0,function*(){try{return{data:yield KS(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Hn(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Hn(this,void 0,void 0,function*(){try{return{data:yield Im(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}}class tk extends ek{constructor(e,n={},r){super(e,n,r)}from(e){return new YS(this.url,this.headers,e,this.fetch)}}const nk="2.51.0";let Wr="";typeof Deno<"u"?Wr="deno":typeof document<"u"?Wr="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Wr="react-native":Wr="node";const rk={"X-Client-Info":`supabase-js-${Wr}/${nk}`},ok={headers:rk},sk={schema:"public"},ik={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ak={};var lk=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const ck=t=>{let e;return t?e=t:typeof fetch>"u"?e=xm:e=fetch,(...n)=>e(...n)},uk=()=>typeof Headers>"u"?_m:Headers,dk=(t,e,n)=>{const r=ck(n),o=uk();return(s,i)=>lk(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:t;let c=new o(i?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(s,Object.assign(Object.assign({},i),{headers:c}))})};var hk=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};function fk(t){return t.endsWith("/")?t:t+"/"}function pk(t,e){var n,r;const{db:o,auth:s,realtime:i,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,h={db:Object.assign(Object.assign({},l),o),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(n=d?.headers)!==null&&n!==void 0?n:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>hk(this,void 0,void 0,function*(){return""})};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}const jm="2.71.0",Zn=30*1e3,Fa=3,Ii=Fa*Zn,mk="http://localhost:9999",gk="supabase.auth.token",yk={"X-Client-Info":`gotrue-js/${jm}`},Ua="X-Supabase-Api-Version",$m={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},vk=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,wk=10*60*1e3;class Kl extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Q(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class bk extends Kl{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function xk(t){return Q(t)&&t.name==="AuthApiError"}class Nm extends Kl{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class on extends Kl{constructor(e,n,r,o){super(e,r,o),this.name=n,this.status=r}}class Bt extends on{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function _k(t){return Q(t)&&t.name==="AuthSessionMissingError"}class Ho extends on{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Wo extends on{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Go extends on{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Ck(t){return Q(t)&&t.name==="AuthImplicitGrantRedirectError"}class zu extends on{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ha extends on{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function ji(t){return Q(t)&&t.name==="AuthRetryableFetchError"}class Du extends on{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Wa extends on{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const bs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Lu=` 	
\r=`.split(""),Sk=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Lu.length;e+=1)t[Lu[e].charCodeAt(0)]=-2;for(let e=0;e<bs.length;e+=1)t[bs[e].charCodeAt(0)]=e;return t})();function Bu(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(bs[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(bs[r]),e.queuedBits-=6}}function Mm(t,e,n){const r=Sk[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Fu(t){const e=[],n=i=>{e.push(String.fromCodePoint(i))},r={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},s=i=>{Pk(i,r,n)};for(let i=0;i<t.length;i+=1)Mm(t.charCodeAt(i),o,s);return e.join("")}function kk(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Ek(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const o=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|o)+65536,n+=1}kk(r,e)}}function Pk(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function Tk(t){const e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};for(let o=0;o<t.length;o+=1)Mm(t.charCodeAt(o),n,r);return new Uint8Array(e)}function Ak(t){const e=[];return Ek(t,n=>e.push(n)),new Uint8Array(e)}function Rk(t){const e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};return t.forEach(o=>Bu(o,n,r)),Bu(null,n,r),e.join("")}function Ok(t){return Math.round(Date.now()/1e3)+t}function Ik(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const et=()=>typeof window<"u"&&typeof document<"u",ln={tested:!1,writable:!1},zm=()=>{if(!et())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ln.tested)return ln.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),ln.tested=!0,ln.writable=!0}catch{ln.tested=!0,ln.writable=!1}return ln.writable};function jk(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((o,s)=>{e[s]=o})}catch{}return n.searchParams.forEach((r,o)=>{e[o]=r}),e}const Dm=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>qt(async()=>{const{default:r}=await Promise.resolve().then(()=>Rr);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},$k=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Qn=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},cn=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Mt=async(t,e)=>{await t.removeItem(e)};class Gs{constructor(){this.promise=new Gs.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Gs.promiseConstructor=Promise;function $i(t){const e=t.split(".");if(e.length!==3)throw new Wa("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!vk.test(e[r]))throw new Wa("JWT not in base64url format");return{header:JSON.parse(Fu(e[0])),payload:JSON.parse(Fu(e[1])),signature:Tk(e[2]),raw:{header:e[0],payload:e[1]}}}async function Nk(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Mk(t,e){return new Promise((r,o)=>{(async()=>{for(let s=0;s<1/0;s++)try{const i=await t(s);if(!e(s,null,i)){r(i);return}}catch(i){if(!e(s,i)){o(i);return}}})()})}function zk(t){return("0"+t.toString(16)).substr(-2)}function Dk(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let o="";for(let s=0;s<56;s++)o+=n.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(e),Array.from(e,zk).join("")}async function Lk(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),o=new Uint8Array(r);return Array.from(o).map(s=>String.fromCharCode(s)).join("")}async function Bk(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await Lk(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Wn(t,e,n=!1){const r=Dk();let o=r;n&&(o+="/PASSWORD_RECOVERY"),await Qn(t,`${e}-code-verifier`,o);const s=await Bk(r);return[s,r===s?"plain":"s256"]}const Fk=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Uk(t){const e=t.headers.get(Ua);if(!e||!e.match(Fk))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Hk(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function Wk(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Gk=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Gn(t){if(!Gk.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ni(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}var qk=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n};const dn=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Vk=[502,503,504];async function Uu(t){var e;if(!$k(t))throw new Ha(dn(t),0);if(Vk.includes(t.status))throw new Ha(dn(t),t.status);let n;try{n=await t.json()}catch(s){throw new Nm(dn(s),s)}let r;const o=Uk(t);if(o&&o.getTime()>=$m["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new Du(dn(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Bt}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((s,i)=>s&&typeof i=="string",!0))throw new Du(dn(n),t.status,n.weak_password.reasons);throw new bk(dn(n),t.status||500,r)}const Kk=(t,e,n,r)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),n))};async function se(t,e,n,r){var o;const s=Object.assign({},r?.headers);s[Ua]||(s[Ua]=$m["2024-01-01"].name),r?.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const i=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(i.redirect_to=r.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await Xk(t,e,n+a,{headers:s,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function Xk(t,e,n,r,o,s){const i=Kk(e,r,o,s);let a;try{a=await t(n,Object.assign({},i))}catch(l){throw console.error(l),new Ha(dn(l),0)}if(a.ok||await Uu(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await Uu(l)}}function St(t){var e;let n=null;Qk(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=Ok(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function Hu(t){const e=St(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Ut(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function Jk(t){return{data:t,error:null}}function Yk(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s}=t,i=qk(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function Zk(t){return t}function Qk(t){return t.access_token&&t.refresh_token&&t.expires_in}const Mi=["global","local","others"];var e1=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n};class t1{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=Dm(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,n=Mi[0]){if(Mi.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Mi.join(", ")}`);try{return await se(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await se(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Ut})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=e1(e,["options"]),o=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await se(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:Yk,redirectTo:n?.redirectTo})}catch(n){if(Q(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await se(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ut})}catch(n){if(Q(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,o,s,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await se(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(s=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""},xform:Zk});if(u.error)throw u.error;const d=await u.json(),h=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,p=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(g=>{const y=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);c[`${v}Page`]=y}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(Q(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Gn(e);try{return await se(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ut})}catch(n){if(Q(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){Gn(e);try{return await se(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Ut})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){Gn(e);try{return await se(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Ut})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Gn(e.userId);try{const{data:n,error:r}=await se(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:n,error:r}}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _deleteFactor(e){Gn(e.userId),Gn(e.id);try{return{data:await se(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}}function Wu(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}function n1(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const qn={debug:!!(globalThis&&zm()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Lm extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class r1 extends Lm{}async function o1(t,e,n){qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),qn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await n()}finally{qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(e===0)throw qn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new r1(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(qn.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}n1();const s1={url:mk,storageKey:gk,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:yk,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Gu(t,e,n){return await n()}const Vn={};class io{constructor(e){var n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=io.nextInstanceID,io.nextInstanceID+=1,this.instanceID>0&&et()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},s1),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new t1({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Dm(o.fetch),this.lock=o.lock||Gu,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:et()&&(!((n=globalThis?.navigator)===null||n===void 0)&&n.locks)?this.lock=o1:this.lock=Gu,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:zm()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Wu(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=Wu(this.memoryStorage)),et()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,n;return(n=(e=Vn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){Vn[this.storageKey]=Object.assign(Object.assign({},Vn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=Vn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Vn[this.storageKey]=Object.assign(Object.assign({},Vn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${jm}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const n=jk(window.location.href);let r="none";if(this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce"),et()&&this.detectSessionInUrl&&r!=="none"){const{data:o,error:s}=await this._getSessionFromURL(n,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),Ck(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:i,redirectType:a}=o;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Q(n)?{error:n}:{error:new Nm("Unexpected error during initialization",n)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,o;try{const s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e?.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:St}),{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Q(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var n,r,o;try{let s;if("email"in e){const{email:u,password:d,options:h}=e;let p=null,g=null;this.flowType==="pkce"&&([p,g]=await Wn(this.storage,this.storageKey)),s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h?.emailRedirectTo,body:{email:u,password:d,data:(n=h?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:p,code_challenge_method:g},xform:St})}else if("phone"in e){const{phone:u,password:d,options:h}=e;s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(r=h?.data)!==null&&r!==void 0?r:{},channel:(o=h?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:St})}else throw new Wo("You must provide either an email or phone number and a password");const{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Q(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let n;if("email"in e){const{email:s,password:i,options:a}=e;n=await se(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Hu})}else if("phone"in e){const{phone:s,password:i,options:a}=e;n=await se(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Hu})}else throw new Wo("You must provide either an email or phone number and a password");const{data:r,error:o}=n;return o?{data:{user:null,session:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ho}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOAuth(e){var n,r,o,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;if(n==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}async signInWithSolana(e){var n,r,o,s,i,a,l,c,u,d,h,p;let g,y;if("message"in e)g=e.message,y=e.signature;else{const{chain:v,wallet:w,statement:_,options:b}=e;let x;if(et())if(typeof w=="object")x=w;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))x=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=w}const S=new URL((n=b?.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in x&&x.signIn){const k=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b?.signInWithSolana),{version:"1",domain:S.host,uri:S.href}),_?{statement:_}:null));let C;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")C=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)C=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in C&&"signature"in C&&(typeof C.signedMessage=="string"||C.signedMessage instanceof Uint8Array)&&C.signature instanceof Uint8Array)g=typeof C.signedMessage=="string"?C.signedMessage:new TextDecoder().decode(C.signedMessage),y=C.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${S.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${S.href}`,`Issued At: ${(o=(r=b?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=b?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((i=b?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((a=b?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((c=b?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((d=(u=b?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...b.signInWithSolana.resources.map(C=>`- ${C}`)]:[]].join(`
`);const k=await x.signMessage(new TextEncoder().encode(g),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=k}}try{const{data:v,error:w}=await se(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Rk(y)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:St});if(w)throw w;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new Ho}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:w})}catch(v){if(Q(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const n=await cn(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(n??"").split("/");try{const{data:s,error:i}=await se(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:St});if(await Mt(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Ho}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:i})}catch(s){if(Q(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:n,provider:r,token:o,access_token:s,nonce:i}=e,a=await se(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:St}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Ho}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOtp(e){var n,r,o,s,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Wn(this.storage,this.storageKey));const{error:d}=await se(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await se(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(o=l?.data)!==null&&o!==void 0?o:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(i=l?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new Wo("You must provide either an email or phone number.")}catch(a){if(Q(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var n,r;try{let o,s;"options"in e&&(o=(n=e.options)===null||n===void 0?void 0:n.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:i,error:a}=await se(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:St});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(Q(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var n,r,o;try{let s=null,i=null;return this.flowType==="pkce"&&([s,i]=await Wn(this.storage,this.storageKey)),await se(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:i}),headers:this.headers,xform:Jk})}catch(s){if(Q(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Bt;const{error:o}=await se(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(Q(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:o,options:s}=e,{error:i}=await se(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:r,type:o,options:s}=e,{data:i,error:a}=await se(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:a}}throw new Wo("You must provide either an email or phone number and a type")}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await cn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Ii:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const i=await cn(this.userStorage,this.storageKey+"-user");i?.user?e.user=i.user:e.user=Ni()}if(this.storage.isServer&&e.user){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await se(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ut}):await this._useSession(async n=>{var r,o,s;const{data:i,error:a}=n;if(a)throw a;return!(!((r=i.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Bt}:await se(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:Ut})})}catch(n){if(Q(n))return _k(n)&&(await this._removeSession(),await Mt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:n};throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:o,error:s}=r;if(s)throw s;if(!o.session)throw new Bt;const i=o.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Wn(this.storage,this.storageKey));const{data:c,error:u}=await se(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Ut});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Bt;const n=Date.now()/1e3;let r=n,o=!0,s=null;const{payload:i}=$i(e.access_token);if(i.exp&&(r=i.exp,o=r<=n),o){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(n){if(Q(n))return{data:{session:null,user:null},error:n};throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:i,error:a}=n;if(a)throw a;e=(r=i.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Bt;const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async _getSessionFromURL(e,n){try{if(!et())throw new Go("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Go(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new zu("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Go("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new zu("No code detected.");const{data:_,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:o,access_token:s,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!i||!c)throw new Go("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let h=u+d;l&&(h=parseInt(l));const p=h-u;p*1e3<=Zn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const g=h-d;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,h,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,h,u);const{data:y,error:v}=await this._getUser(s);if(v)throw v;const w={provider_token:r,provider_refresh_token:o,access_token:s,expires_in:d,expires_at:h,refresh_token:i,token_type:c,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(r){if(Q(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await cn(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:o,error:s}=n;if(s)return{error:s};const i=(r=o.session)===null||r===void 0?void 0:r.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(xk(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Mt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const n=Ik(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,o;try{const{data:{session:s},error:i}=n;if(i)throw i;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,n={}){let r=null,o=null;this.flowType==="pkce"&&([r,o]=await Wn(this.storage,this.storageKey,!0));try{return await se(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:o,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(s){if(Q(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}async linkIdentity(e){var n;try{const{data:r,error:o}=await this._useSession(async s=>{var i,a,l,c,u;const{data:d,error:h}=s;if(h)throw h;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await se(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(o)throw o;return et()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(Q(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,o;const{data:s,error:i}=n;if(i)throw i;return await se(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await Mk(async o=>(o>0&&await Nk(200*Math.pow(2,o-1)),this._debug(n,"refreshing attempt",o),await se(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:St})),(o,s)=>{const i=200*Math.pow(2,o);return s&&ji(s)&&Date.now()+i-r<Zn})}catch(r){if(this._debug(n,"error",r),Q(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),et()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const o=await cn(this.storage,this.storageKey);if(o&&this.userStorage){let i=await cn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:o.user},await Qn(this.userStorage,this.storageKey+"-user",i)),o.user=(e=i?.user)!==null&&e!==void 0?e:Ni()}else if(o&&!o.user&&!o.user){const i=await cn(this.storage,this.storageKey+"-user");i&&i?.user?(o.user=i.user,await Mt(this.storage,this.storageKey+"-user"),await Qn(this.storage,this.storageKey,o)):o.user=Ni()}if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}const s=((n=o.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Ii;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${Ii}s`),s){if(this.autoRefreshToken&&o.refresh_token){const{error:i}=await this._callRefreshToken(o.refresh_token);i&&(console.error(i),ji(i)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:a}=await this._getUser(o.access_token);!a&&i?.user?(o.user=i.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(r,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Bt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Gs;const{data:s,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new Bt;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(o,"error",s),Q(s)){const i={session:null,error:s};return ji(s)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(i),i}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,n,r=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const s=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){s.push(l)}});if(await Promise.all(i),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await Qn(this.userStorage,this.storageKey+"-user",{user:n.user});const o=Object.assign({},n);delete o.user;const s=structuredClone(o);await Qn(this.storage,this.storageKey,s)}else{const o=structuredClone(n);await Qn(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await Mt(this.storage,this.storageKey),await Mt(this.storage,this.storageKey+"-code-verifier"),await Mt(this.storage,this.storageKey+"-user"),this.userStorage&&await Mt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&et()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Zn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((r.expires_at*1e3-e)/Zn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Zn}ms, refresh threshold is ${Fa} ticks`),o<=Fa&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Lm)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!et()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const o=[`provider=${encodeURIComponent(n)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[s,i]=await Wn(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(i)}`});o.push(a.toString())}if(r?.queryParams){const s=new URLSearchParams(r.queryParams);o.push(s.toString())}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;return s?{data:null,error:s}:await se(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,o;const{data:s,error:i}=n;if(i)return{data:null,error:i};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await se(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((o=l?.totp)===null||o===void 0)&&o.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;if(s)return{data:null,error:s};const{data:i,error:a}=await se(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(n){if(Q(n))return{data:null,error:n};throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;return s?{data:null,error:s}:await se(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Q(n))return{data:null,error:n};throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){const{data:{user:e},error:n}=await this.getUser();if(n)return{data:null,error:n};const r=e?.factors||[],o=r.filter(i=>i.factor_type==="totp"&&i.status==="verified"),s=r.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:r,totp:o,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var n,r;const{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=$i(o.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((r=(n=o.user.factors)===null||n===void 0?void 0:n.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;const o=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+wk>o)return r;const{data:s,error:i}=await se(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=o,r=s.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:g}=await this.getSession();if(g||!p.session)return{data:null,error:g};r=p.session.access_token}const{header:o,payload:s,signature:i,raw:{header:a,payload:l}}=$i(r);n?.allowExpired||Hk(s.exp);const c=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,n?.keys?{keys:n.keys}:n?.jwks);if(!c){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:s,header:o,signature:i},error:null}}const u=Wk(o.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,i,Ak(`${a}.${l}`)))throw new Wa("Invalid JWT signature");return{data:{claims:s,header:o,signature:i},error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}}io.nextInstanceID=0;const i1=io;class a1 extends i1{constructor(e){super(e)}}var l1=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class c1{constructor(e,n,r){var o,s,i;if(this.supabaseUrl=e,this.supabaseKey=n,!e)throw new Error("supabaseUrl is required.");if(!n)throw new Error("supabaseKey is required.");const a=fk(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:sk,realtime:ak,auth:Object.assign(Object.assign({},ik),{storageKey:c}),global:ok},d=pk(r??{},u);this.storageKey=(o=d.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=dk(n,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new PS(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new mS(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new tk(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,n;return l1(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,storageKey:s,flowType:i,lock:a,debug:l},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new a1({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:s,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,flowType:i,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new US(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r?.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const u1=(t,e,n)=>new c1(t,e,n),kn=u1("https://pkswdnpftrundnewgnya.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrc3dkbnBmdHJ1bmRuZXdnbnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODI2MzIsImV4cCI6MjA2ODI1ODYzMn0.r_Y1RLOGJ55C0De5SBTVXqO09SMDqgV38sQuE-oDxXE"),d1=async(t,e)=>{const n=await kn.rpc("save_campaign_version",{p_name:t,p_data:await bm(e)});if(n.error)throw new Error(`error saving to db ${n.error.message} ${n.error.details}`,{cause:n.error});return n.data},h1=async t=>{const e=await kn.rpc("get_latest_campaign",{p_name:t.name,p_created_by:t.createdBy,p_version:t.version});if(e.error)throw new Error("could not get campaign",{cause:e.error});const n=await dS(e.data.data);return Object.values(n.rooms).forEach(r=>{delete r.size}),n},Bm=()=>{const[t,e]=m.useState(null);return m.useEffect(()=>{kn.auth.getUser().then(({data:{user:r}})=>{e(r)});const{data:{subscription:n}}=kn.auth.onAuthStateChange((r,o)=>{e(o?.user??null)});return()=>n.unsubscribe()},[]),t},Fm=()=>{const[t,e]=m.useState(0);return{justDone:t,doneNow(){e(n=>n+1),setTimeout(()=>e(n=>n-1),f1)}}},f1=2e3,p1=`
## Save

put your campaign on cassette tape, or even floppy disk!

to be shared or worked on later

(really, saves to a cloud database)

hotkey: **Cmd-S**
`,m1=`
## Load

continue working from your last save
`,Um=()=>he(({levelEditor:{savedCampaign:t,campaignInProgress:e}})=>Ge(t,e)),g1=()=>{const t=Bm(),e=Um(),{doneNow:n,justDone:r}=Fm(),o=async()=>{const i=U.getState(),a=fh(i);console.info("saving...",a);const l=await d1("sequel",a);console.info(`...saved as v${l}`),U.dispatch(Yy({campaign:a})),n()},s=async()=>{try{const i=await h1({name:"sequel"});console.info("loaded",i),U.dispatch(Zy({campaign:i}))}catch(i){console.error(i)}};return f.jsxs(f.Fragment,{children:[r>0?f.jsx(ye,{disabled:!0,className:"!bg-moss !text-white",children:f.jsx(z,{className:"relative leading-none",children:"OK!"})}):f.jsx(ye,{disabled:t===null||e,onClick:o,shortcutKeys:["^S","⌘S"],tooltipContent:p1,children:f.jsxs("div",{className:"flex flex-row items-center",children:[f.jsx("span",{className:Te("sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative",{"text-lightGrey":t===null})}),f.jsx("span",{className:Te("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})})]})}),f.jsx(ye,{disabled:t===null,onClick:s,tooltipContent:m1,children:f.jsxs("div",{className:"flex flex-row items-center",children:[f.jsx("span",{className:Te("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})}),f.jsx("span",{className:Te("sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative",{"text-lightGrey":t===null})})]})})]})},y1=()=>f.jsx(ye,{children:f.jsx(z,{className:"relative leading-none",children:"MAP"})}),v1=()=>{const[t,e]=m.useState(!1),[n,r]=m.useState(!1);return f.jsx(Hl,{main:f.jsx(ye,{onClick:async()=>{const o=U.getState(),s=fh(o),i=await bm(s),a=new URL("https://blockstack.ing"),l=a.searchParams;l.set("campaignData",i),l.set("noSaves","1"),l.set("cheats","1"),n&&l.set("playAsHeels","1"),t||(a.hash=o.levelEditor.currentlyEditingRoomId),window.open(a.toString(),"playtest")},shortcutKeys:["⌘P","^P"],children:f.jsx(Na,{topText:"pl",bottomText:"ay",icon:f.jsx("span",{className:"sprite texture-joystick mt-half"})})}),children:[f.jsx(wr,{className:"w-full",value:t,label:"from",falseLabel:"room",trueLabel:"start",onChange:o=>e(o)},"fromStart"),f.jsx(wr,{className:"w-full",value:n,label:"as",falseLabel:"head",trueLabel:"heels",onChange:o=>r(o)},"playAsHeels")]})},w1=t=>{switch(t){case"github":return ih;case"discord":return ah;default:throw new Error}},b1=({className:t})=>{const e=Bm(),n=o=>async()=>{const s=new URL(window.location.href);s.hash="";const i=s.toString(),{error:a}=await kn.auth.signInWithOAuth({provider:o,options:{redirectTo:i}});a&&console.error("Login error:",a)},r=async()=>{const{error:o}=await kn.auth.signOut();o&&console.error("Logout error:",o)};return f.jsx("div",{className:Te(t),children:e?f.jsxs("div",{className:"bg-moss overflow-hidden text-center",children:[f.jsx(z,{noSlitWords:!0,className:"overflow-hidden",children:`${w1(e.app_metadata.provider)}${e.email}`}),f.jsx(Gt,{className:"px-1 w-full",onClick:r,children:f.jsx(z,{children:"Logout"})})]}):f.jsxs("div",{className:"px-1 bg-midRed",children:[f.jsx(z,{className:"block w-full sprites-double-height pb-1",children:"Not logged in"}),f.jsx(z,{className:"block w-full text-highlightBeige",children:"You will not be able to save"}),f.jsxs("div",{className:"pt-1 flex flex-col gap-half",children:[f.jsx(z,{children:"Log in with:"}),f.jsxs(Gt,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:n("github"),children:[f.jsx(z,{children:ih}),f.jsx(z,{children:"GitHub"})]}),f.jsxs(Gt,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:n("discord"),children:[f.jsx(z,{children:ah}),f.jsx(z,{children:"Discord"})]})]})]})})},x1=`
## Add room

Add a **new room** to this campaign

Nothing will link to the room so add *doors* and *teleporters* to get into it
`,_1=`
## Delete room

Delete this room
`,C1=()=>{const t=He(),e=he(n=>Object.keys(n.levelEditor.campaignInProgress.rooms).length>1);return f.jsxs(f.Fragment,{children:[f.jsx(ye,{className:"bg-moss",onClick:()=>t(Qy()),tooltipContent:x1,children:f.jsx("span",{className:"sprite texture-hud_char_+ relative"})}),f.jsx(ye,{className:"bg-midRed",onClick:()=>t(ev()),disabled:!e,tooltipContent:_1,children:f.jsx("span",{className:"sprite texture-hud_char_X relative"})})]})},Oe={x:12,y:12,z:K.h},S1={x:14,y:14,z:K.h},mn={x:16,y:16,z:K.h},zi={...Oe,z:K.h*2},Hm=t=>{switch(t.type){case"spring":case"portableBlock":case"moveableDeadly":case"slidingDeadly":case"firedDoughnut":return{aabb:Oe};case"slidingBlock":return t.config.style==="book"?{aabb:mn}:{aabb:Oe};case"lift":return{aabb:{...Oe,z:Oe.z}};case"switch":return{aabb:{...Oe,z:Oe.z}};case"pickup":return t.config.gives==="scroll"?{aabb:{x:16,y:4,z:13}}:{aabb:Oe};case"charles":return{aabb:zi};case"ball":return{aabb:{x:12,y:12,z:12}};case"pushableBlock":case"movingPlatform":return{aabb:mn};case"block":switch(t.config.style){case"artificial":case"organic":case"book":return{aabb:mn};case"tower":return{aabb:{x:11,y:11,z:K.h}};default:throw new Error("unknown block style")}case"monster":switch(t.config.which){case"skiHead":return{aabb:{...Oe,z:21}};case"bubbleRobot":case"cyberman":case"elephant":case"emperorsGuardian":case"monkey":case"computerBot":return{aabb:zi};case"helicopterBug":case"dalek":case"emperor":case"homingBot":case"elephantHead":return{aabb:Oe};case"turtle":return{aabb:Oe};default:throw t.config,new Error("unknown monster type")}case"deadlyBlock":case"spikes":return{aabb:mn};case"bubbles":return{aabb:Oe};case"conveyor":case"hushPuppy":case"teleporter":return{aabb:mn};case"barrier":return{aabb:t.config.axis==="y"?{x:3,y:15,z:K.h}:{x:15,y:3,z:K.h}};case"sceneryPlayer":return t.config.which==="headOverHeels"?{aabb:zi}:{aabb:Oe};case"emitter":return{aabb:ue};default:return{aabb:S1}}},rt={aabb:Oe},k1=({config:{direction:t},position:e})=>t==="right"&&e.x===0||t==="towards"&&e.y===0,E1=({x:t=0,y:e=0})=>e-t,q=({x:t=0,y:e=0,z:n=0})=>({x:e-t,y:-(t+e)/2-n}),P1=(t,e,n)=>{const r=q(t),o=Kt(n,r);return B(Wm(e,o),t)},Wm=(t,{x:e,y:n})=>{switch(lh(t)){case"xy":return{x:-e/2-n,y:e/2-n,z:0};case"xz":return{x:-e,y:0,z:e/2-n};case"yz":return{x:0,y:e,z:-e/2-n};default:throw new Error("only axis-aligned planes are supported for unprojection")}},ke=({x:t=0,y:e=0,z:n=0})=>({x:t*K.w,y:e*K.d,z:n*K.h}),ss=({x:t=0,y:e=0,z:n=0})=>({x:t/K.w,y:e/K.d,z:n/K.h}),En=t=>q(ke(t)),Ga=t=>{const e=ke(t.position),{aabb:n}=Hm(t);if(n===void 0)throw new Error(`item type= ${t.type} config=${JSON.stringify(t.config)} has no bounding box`);return t.type==="wall"?e:B(e,{x:K.w-n.x>>1,y:K.d-n.y>>1})},Pe=Number.MIN_SAFE_INTEGER,qu=ay/1e3,Gm={firedDoughnut:2*qu,floatingText:qu},qm=10,Vu=6e4,T1=8,A1=750,R1=2500,Ku=200,O1=.15,I1=ir.h-ir.w/2,Vm=I1+2,qs=9999,Be=()=>({expires:null,stoodOnBy:{},disappearing:null,switchedAtRoomTime:Pe,stoodOnUntilRoomTime:Pe}),Xu=()=>({standingOnItemId:null,vels:{gravity:ue,movingFloor:ue},latentMovement:[],actedOnAt:{roomTime:Pe,by:de},collidedWith:{roomTime:Pe,by:de}}),j1=t=>{const e=tv.includes(t.type);return{...Be(),position:Ga(t),...e?{standingOnItemId:null,vels:{gravity:ue,movingFloor:ue,...nv.includes(t.type)?{sliding:ue}:{},...t.type==="monster"||t.type==="movingPlatform"?{walking:ue}:{}},latentMovement:[],actedOnAt:{roomTime:Pe,by:de},collidedWith:{roomTime:Pe,by:de}}:{},...t.type==="monster"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",timeOfLastDirectionChange:Number.NEGATIVE_INFINITY,...t.config.which==="skiHead"||t.config.which==="turtle"||t.config.which==="elephantHead"||t.config.which==="cyberman"?{facing:Ee[t.config.startDirection]}:{facing:Ee.towards}}:{},...t.type==="pickup"?{disappearing:{on:"touch",byType:t.config.gives==="bag"||t.config.gives==="jumps"?["heels","headOverHeels"]:t.config.gives==="doughnuts"||t.config.gives==="hooter"||t.config.gives==="fast"?["head","headOverHeels"]:["head","heels","headOverHeels"]}}:{},...t.type==="movingPlatform"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",facing:Ee[t.config.startDirection]}:{},...t.type==="switch"?{setting:t.config.initialSetting,touchedOnProgression:-1}:{},...t.type==="block"?{disappearing:t.config.disappearing??null}:{},...t.type==="conveyor"?{disappearing:t.config.disappearing??null}:{},...t.type==="barrier"?{disappearing:t.config.disappearing??null}:{},...t.type==="lift"?{direction:"up",vels:{lift:ue}}:{},...t.type==="charles"?{facing:Ee.towards}:{},...t.type==="emitter"?{lastEmittedAtRoomTime:Pe,quantityEmitted:0}:{},...t.type==="firedDoughnut"?{disappearing:{on:"touch"},vels:{fired:t.config.direction?Es(Ee[t.config.direction],Gm.firedDoughnut):ue}}:{}}},Di=K.h*2,$1=4,Gr=K.h*$1,N1=2,M1=2*K.w,z1=.5,Ju=2;function*D1(t,e){const{config:{direction:n},position:r}=t,o=uo(n),s=Er(o),i=k1(t),a={...ue,[s]:i?-.5:0},l=1,c={[s]:i?-1:0},u=l*K.w,d={...ue,[s]:u},h=9,p=8,g=8;{const y={[o]:p,[s]:g,z:Gr};yield{...t,...rt,type:"doorFrame",id:`${e}/frameFar`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"far"},state:{...Be(),position:ke(B(r,{[o]:1.5},a,c)),stoodOnBy:de},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}{const y={[o]:h,[s]:g,z:Gr};yield{...t,...rt,type:"doorFrame",id:`${e}/frameNear`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"near"},state:{...Be(),position:ke(B(r,a,c)),stoodOnBy:de},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}{const y={[o]:2*K.w-h-p,[s]:g,z:Gr-Di};yield{...t,...rt,type:"doorFrame",id:`${e}/frameTop`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"top"},state:{...Be(),position:B(ke(B(r,a,c)),{[o]:h,z:Di}),stoodOnBy:de},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}yield{...t,...rt,type:"blocker",id:`${e}/blockerAbove`,jsonItemId:e,config:{},renders:!1,state:{...Be(),position:B(ke(B(r,a,c)),{z:Gr}),stoodOnBy:de},aabb:B(ke({[o]:2,[s]:l,z:qs}),{[s]:g}),renderAabb:ue,fixedZIndex:yn},yield{...t,...rt,type:"portal",id:`${e}/portal`,jsonItemId:e,config:{...rv(t.config,"toRoom","toDoor"),inHidden:i,relativePoint:ke({...ue,[s]:i?l+.25:-.25}),direction:Ee[n]},fixedZIndex:yn,state:{...Be(),position:B(ke(B(r,{[s]:i?-.5-l:.5})),{[o]:h}),stoodOnBy:de},aabb:{[o]:N1*K.w-h-p,[s]:u,z:Di}},r.z!==0&&(yield{...t,...rt,type:"doorLegs",id:`${e}/legs`,jsonItemId:e,config:{...t.config,inHiddenWall:i,style:"none",side:"away",height:r.z},renders:!0,shadowCastTexture:i?{textureId:"shadow.door.floatingThreshold.double.y",flipX:o==="x"}:void 0,state:{...Be(),position:{...ke(B(r,a,c)),z:0}},aabb:B(ke({[o]:2,[s]:.5,z:r.z}),d),renderAabb:i?B(ke({[o]:2,[s]:.5,z:.5})):void 0,renderAabbOffset:i?B({[o]:0,[s]:0,z:(r.z-.5)*K.h},{[s]:d[s]}):void 0,shadowOffset:{z:r.z*K.h,[s]:i?d[s]:void 0}}),yield{type:"stopAutowalk",id:`${e}/stopAutowalk`,jsonItemId:e,aabb:ke({[o]:2,[s]:Ju,z:2}),config:{},fixedZIndex:yn,state:{...Be(),position:ke(hr(r,Es(Ee[n],z1),i?ue:{[s]:Ju})),stoodOnBy:de}}}const Yu={config:de,shadowCastTexture:"shadow.smallRound",aabb:Oe},Zu=()=>{const t=cy(U.getState());return{action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:Ee.towards,walkStartFacing:Ee.towards,walkDistance:0,vels:{walking:ue,gravity:ue,movingFloor:ue},switchedToAt:Pe,lastDiedAt:Pe,gameTime:0,jumpStartTime:Pe,lives:t?"infinite":T1,jumpStartZ:0}},L1=(t,e)=>{const n=ly(U.getState());return t.config.which==="head"?{id:e,jsonItemId:e,type:"head",...rt,...Yu,state:{...Be(),...Xu(),...Zu(),hasHooter:!1,gameWalkDistance:0,fastStepsStartedAtDistance:Pe,shieldCollectedAt:Pe,doughnuts:n?"infinite":0,position:Ga(t),stoodOnUntilRoomTime:Pe}}:{id:e,jsonItemId:e,type:"heels",...rt,...Yu,state:{...Be(),...Xu(),...Zu(),carrying:null,hasBag:!1,bigJumps:0,isBigJump:!1,shieldCollectedAt:Pe,position:Ga(t),stoodOnUntilRoomTime:Pe}}},ao=(t,e={})=>{const n=ph(e),r=hr(ac,t);return hr(uy(n,ac),r)},Km=1,B1={x:K.w,y:K.d*Km,z:qs},F1={x:K.w,y:0,z:Vm},U1={x:K.w*Km,y:K.d,z:qs},H1={x:0,y:K.d,z:Vm},W1=(t,e)=>{const{config:{direction:n},position:r}=e,o=ul(e.config),s=uo(n),i=Er(s),a=ov(n),l={...ue,[i]:a?-1:0};return{type:"wall",id:t,jsonItemId:t,config:e.config,aabb:ao(s==="y"?U1:B1,o),renderAabb:a?ue:ao(s==="y"?H1:F1,o),fixedZIndex:a?yn:void 0,state:{...Be(),position:ke(B(r,l)),stoodOnBy:de},shadowCastTexture:s==="y"?"shadow.wall.y":{textureId:"shadow.wall.y",flipX:!0}}},G1=3,Qu=10,ed=.52,td=.5,q1=(t,e,n)=>{const{config:{times:r},position:o}=e,s=B(o,{z:-3}),i={...r,z:G1};let a=s,l=i;const c=vt(cs(n.items)).filter(h=>h.type==="door");if(o.z===0){const h={};for(const p of c){const{position:g,config:{direction:y}}=p;switch(y){case"towards":!h.towards&&g.y===s.y&&(l=B(l,{y:td}),a=B(a,{y:-.5}),h.towards=!0);break;case"away":!h.away&&g.y===s.y+r.y&&(l=B(l,{y:ed}),h.away=!0);break;case"right":!h.right&&g.x===s.x&&(l=B(l,{x:td}),a=B(a,{x:-.5}),h.right=!0);break;case"left":!h.left&&g.x===s.x+r.x&&(l=B(l,{x:ed}),h.left=!0);break}}}const u=ke(a),d=ao(mn,l);return{type:"floor",id:t,jsonItemId:t,config:{...e.config,naturalFootprint:{aabb:ao(mn,i),position:ke(s)}},aabb:d,renderAabb:{...d,z:Qu},renderAabbOffset:{...ue,z:d.z-Qu},shadowCastTexture:"shadow.fullBlock",state:{...Be(),position:u}}};function*Vs(t,e,n,r=de,o={},s=""){if(!r[t]&&!(e.type==="pickup"&&e.config.gives==="scroll"&&o[e.config.page]))switch(!0){case e.type==="door":return yield*D1(e,t);case e.type==="player":{yield L1(e,t);return}case e.type==="wall":{yield W1(t,e);return}case e.type==="floor":{yield q1(t,e,n);return}case(e.type==="block"&&e.config.disappearing!==void 0&&Ps(ca(e))>=2):{const i=ca(e);for(let a=0;a<i.x;a++)for(let l=0;l<i.y;l++)for(let c=0;c<i.z;c++){const u=rl(e,d=>{d.position={x:e.position.x+a,y:e.position.y+l,z:e.position.z+c},d.config.times=dy});yield*Vs(t,u,n,r,o,`${s}_${a}_${l}_${c}`)}break}case(e.type==="sceneryCrown"&&!U.getState().gameMenus.planetsLiberated[e.config.planet]):return;default:{const i=Hm(e),a=e.config.times!==void 0?{aabb:ao(i.aabb,e.config.times),renderAabb:void 0}:i;let l;try{l=j1(e)}catch(c){throw new Error(`loadItemFromJson: error creating initial state for jsonItem ${JSON.stringify(e,null,2)}`,{cause:c})}yield{...e,...rt,...a,id:`${t}${s}`,jsonItemId:t,fixedZIndex:e.type==="emitter"?yn:void 0,shadowCastTexture:V1(e),config:e.config,state:l}}}}const V1=t=>{switch(t.type){case"lift":return"shadow.smallBlock";case"conveyor":return{textureId:"shadow.fullBlock",flipX:Xt(t.config.direction)==="x"};case"barrier":return{textureId:"shadow.barrier.y",flipX:t.config.axis==="x"};case"spring":case"firedDoughnut":case"slidingDeadly":return"shadow.smallRound";case"block":return t.config.style==="tower"?"shadow.smallRound":"shadow.fullBlock";case"pushableBlock":case"movingPlatform":case"hushPuppy":case"deadlyBlock":case"teleporter":case"spikes":return"shadow.fullBlock";case"portableBlock":return t.config.style==="drum"?"shadow.smallRound":"shadow.smallBlock";case"pickup":return t.config.gives==="scroll"?"shadow.scroll":"shadow.smallRound";case"ball":case"charles":case"monster":return"shadow.smallRound";case"slidingBlock":return t.config.style==="book"?"shadow.fullBlock":"shadow.smallRound"}},Ks=({aabb:t,state:{position:e}},{aabb:n,state:{position:r}})=>!(e.x+t.x<=r.x||e.x>=r.x+n.x)&&!(e.y+t.y<=r.y||e.y>=r.y+n.y)&&!(e.z+t.z<=r.z||e.z>=r.z+n.z),K1=(t,e)=>[...vt(e).filter(n=>t.id!==n.id&&Ks(t,n))];function*qa(t,e){for(const n of e)t.id!==n.id&&Ks(t,n)&&(yield n)}function*X1(t,e){if(t.roomBelow!==void 0)for(const n of $e(e).filter(lc)){const{config:{naturalFootprint:r}}=n;yield{...rt,type:"portal",id:"floor/portal",fixedZIndex:yn,config:{toRoom:t.roomBelow,relativePoint:{x:r.aabb.x/2,y:r.aabb.y/2,z:r.aabb.z},direction:Ee.down},aabb:r.aabb,state:{...Be(),position:r.position},renders:!1}}if(t.roomAbove!==void 0)for(const n of $e(e).filter(lc)){const{config:{naturalFootprint:r}}=n;yield{...rt,type:"portal",id:"ceilingPortal",fixedZIndex:yn,config:{toRoom:t.roomAbove,relativePoint:{...t.ceilingRelativePoint!==void 0?ke(t.ceilingRelativePoint):{x:r.aabb.x/2,y:r.aabb.y/2},z:-12},direction:Ee.up},aabb:{...r.aabb,z:K.h},state:{...Be(),position:B(r.position,{z:r.aabb.z},{z:K.h*(t.height??qm)})}}}}const J1=(t,e,n,r)=>{const o=Math.max(0,Math.min(t.x+e.x,n.x+r.x)-Math.max(t.x,n.x)),s=Math.max(0,Math.min(t.y+e.y,n.y+r.y)-Math.max(t.y,n.y));return o*s},nd=({state:{position:t},aabb:e},{state:{position:n},aabb:r})=>J1(t,e,n,r),rd={stopAutowalk:5,portal:5,wall:5,blocker:5,doorLegs:5,sceneryPlayer:5,bubbles:5,switch:10,doorFrame:15,ball:18,block:20,barrier:20,floor:20,hushPuppy:20,teleporter:20,lift:30,movingPlatform:30,pushableBlock:30,portableBlock:30,sceneryCrown:30,slidingBlock:30,spring:30,joystick:40,charles:40,conveyor:40,head:50,heels:50,headOverHeels:50,pickup:80,firedDoughnut:90,spikes:98,slidingDeadly:100,moveableDeadly:100,deadlyBlock:100,monster:100,floatingText:200,particle:200,emitter:200},Y1=(t,e)=>rd[t.type]-rd[e.type],Z1=(t,e,n=.001)=>{if(!pr(e,t)||t.id===e.id)return!1;const{state:{vels:{gravity:{z:r}}}}=t;return r>0?!1:Ks({state:{position:B(t.state.position,{x:0,y:0,z:-1e-4})},aabb:{...t.aabb,z:n+ch},id:t.id},{state:{position:B(e.state.position,{x:0,y:0,z:e.aabb.z})},aabb:{...e.aabb,z:0},id:e.id})},Q1=(t,e)=>{const r=[...vt(e).filter(s=>Z1(t,s))];return r.length===0?void 0:r.reduce((s,i)=>{const a=Y1(i,s);return a<0||a===0&&nd(t,i)>nd(t,s)?i:s})},eE=({above:t,below:e})=>{const n=e.state.stoodOnBy;if(!Object.isExtensible(n))throw new Error(`${t.id} can't stand on ${e.id} - its standingOn is not extensible`);t.state.standingOnItemId=e.id,n[t.id]=!0};function*tE(t,e,n,r){const o=fy(t.items);for(const[s,i]of o)i.type==="player"&&!r||(yield*Vs(s,i,t,e,n))}const od=t=>vt(t).reduce((e,n)=>({...e,[n.id]:n}),{}),Li=({roomJson:t,roomPickupsCollected:e,scrollsRead:n,isNewGame:r=!1})=>{const o=od(tE(t,e,n,r)),s={...od(X1(t,o)),...o};for(const a of $e(s)){const c=K1(a,hy(s)).find(u=>pr(a)&&pr(u)&&!(a.type==="wall"&&u.type==="wall"));c!==void 0&&console.error(`in room ${t.id} item ${a.id} @${JSON.stringify(a.state.position)} #${JSON.stringify(a.aabb)} is colliding with (solid item) ${c.id} @${JSON.stringify(c.state.position)} #${JSON.stringify(c.aabb)} on loading room ${t.id}`)}for(const a of $e(s).filter(sv)){const l=Q1(a,$e(s).filter(c=>c.id!==a.id));l!==void 0&&eE({above:a,below:l})}return{...t,roomJson:t,items:s,roomTime:0}},nE=t=>()=>Rn(t),pR=nE(fr),rE=Ph([fr,t=>t.levelEditor.previewedEdits],(t,e)=>rl(t,n=>{const r=uh(e);for(const[o,s]of r)s===null?delete n.items[o]:n.items[o]=s})),Xl=m.createContext(null),oE=()=>{const[t,e]=m.useState(()=>Li({roomJson:fr(U.getState()),roomPickupsCollected:de,scrollsRead:de,isNewGame:!0})),[n,r]=m.useState(t),o=he(fr),s=he(rE);return m.useEffect(()=>{const i=Li({roomJson:o,roomPickupsCollected:de,scrollsRead:de,isNewGame:!0});if(e(i),o===s)r(i);else{const a=Li({roomJson:s,roomPickupsCollected:de,scrollsRead:de,isNewGame:!0});r(a)}},[o,s]),{roomState:t,roomStateWithPreviews:n}},sE=({children:t})=>{const e=oE();return f.jsx(Xl,{value:e,children:t})},Xm=()=>{const t=m.useContext(Xl);if(t===null)throw new Error("no room state in context, or no context");return t.roomState},Jm=()=>{const t=m.useContext(Xl);if(t===null)throw new Error("no room state in context, or no context");return t.roomStateWithPreviews},iE=t=>$e(t.items).filter(e=>pr(e)),Ym=(t,e)=>{const n=vt(iE(t));return e==="door"?n.filter(o=>o.type!=="wall"):n},Zm=({roomState:t,jsonItemIds:e,blockPositionDelta:n,timesDelta:r})=>{const o=Pc(Sc(a=>[a,t.roomJson.items[a]]),Sc(([a,l])=>[a,rl(l,c=>{c.position=B(c.position,n),iv(c,r)})]),Dv(function*([a,l]){for(const c of Vs(a,l,t.roomJson))yield[a,l,c]}),av(([,,a])=>pr(a))),s=Array.from(o(e));return Pc(Jv(([,a,l])=>{const c=vt(Ym(t,a.type)).filter(u=>u.jsonItemId&&!e.includes(u.jsonItemId));for(const u of qa(l,c))return console.warn(l.id,"colliding with static item",u.id),!0;for(const u of qa(l,s.map(([d,h,p])=>p)))return console.warn(l.id,"colliding with other mutating item",u.id),!0;return!1}))(s)},aE=({roomState:t,blockPosition:e,itemTool:n})=>{const r=Vs("maybeAddedItem",{...n,position:e},t.roomJson),o=Array.from(Ym(t,n.type));return r.some(s=>{const i=qa(s,o);return!Ah(i)})},lE=()=>{const t=He(),e=he(o=>o.levelEditor.selectedJsonItemIds.length>0),n=Xm(),r=o=>{if(n===null)return;const s=U.getState().levelEditor,{gridResolution:i,selectedJsonItemIds:a}=s,l=us(o,{x:i,y:i,z:1});if(Zm({roomState:n,jsonItemIds:a,blockPositionDelta:l})){console.warn("nudge would collide");return}t(mh({jsonItemIds:a,positionDelta:l})),t(gh())};return f.jsxs("div",{className:"flex flex-row flex-wrap gap-x-0 gap-y-oneScaledPix items-center",children:[f.jsx(z,{className:"inline-block mr-1 text-lightGrey leading-none",noSlitWords:!0,children:"move"}),f.jsxs("div",{className:"flex flex-row flex-wrap gap-oneScaledPix items-center",children:[f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.left)},shortcutKeys:["ArrowLeft"],tooltipContent:"Hotkey: **⬅**",children:f.jsx(z,{className:"relative leading-none",children:"↖"})}),f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.right)},shortcutKeys:["ArrowRight"],tooltipContent:"Hotkey: **➡**",children:f.jsx(z,{className:"relative leading-none",children:"↘"})}),f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.away)},shortcutKeys:["ArrowUp"],tooltipContent:"Hotkey: **⬆**",children:f.jsx(z,{className:"relative leading-none",children:"↗"})}),f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.towards)},shortcutKeys:["ArrowDown"],tooltipContent:"Hotkey: **⬇**",children:f.jsx(z,{className:"relative leading-none",children:"↙"})}),f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.up)},shortcutKeys:["⇧ArrowUp"],tooltipContent:"Hotkey: **shift-⬆**",children:f.jsx(z,{className:"relative leading-none",children:"⬆"})}),f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.down)},shortcutKeys:["⇧ArrowDown"],tooltipContent:"Hotkey: **shift-⬇**",children:f.jsx(z,{className:"relative leading-none",children:"⬇"})})]})]})},cE=`
## Back

Go back to the previous room

hotkey: **<**
`,uE=`
## Forward

The opposite of back

hotkey: **>**
`,dE=()=>{const t=he(({levelEditor:r})=>{const{editingRoomIdHistory:o}=r;return o.back.length>0}),e=he(({levelEditor:r})=>{const{editingRoomIdHistory:o}=r;return o.forward.length>0}),n=He();return f.jsxs(f.Fragment,{children:[f.jsx(ye,{disabled:!t,onClick:()=>{n(lv())},shortcutKeys:["⇧<"],tooltipContent:cE,children:f.jsx("span",{className:"sprite texture-hud_char_lt relative"})}),f.jsx(ye,{disabled:!e,onClick:()=>{n(cv())},shortcutKeys:["⇧>"],tooltipContent:uE,children:f.jsx("span",{className:"sprite texture-hud_char_gt relative"})})]})},hE=({className:t})=>{const e=He();return f.jsx(wr,{className:t,label:"coalesce",value:he(n=>n.levelEditor.autoCoalesce),onChange:n=>{e(uv(n))},shortcutKeys:["L"],tooltipContent:`optimise blocks into single items while editing, or keep separate?
hotkey: **L**`})},fE=`
## Share

copies a link to the clipboard

anyone with the link can play your game
`,pE=()=>{const t=Um(),{doneNow:e,justDone:n}=Fm();return n>0?f.jsx(ye,{className:"bg-moss",children:f.jsx(z,{className:"relative leading-none",children:"OK!"})}):f.jsx(ye,{disabled:!t,onClick:async()=>{const r=new URL("https://blockstack.ing"),o=r.searchParams,{data:{session:s}}=await kn.auth.getSession(),i=s?.user.id;if(i===void 0)throw new Error("no user id on supabase session");o.set("campaignName","sequel"),o.set("campaignAuthor",i),o.set("noSaves","1"),navigator.clipboard.writeText(r.toString()).then(e)},tooltipContent:fE,children:f.jsx("span",{className:"sprite sprite-tinted texture-hud_char_ relative"})})},qo=()=>f.jsx("div",{className:"w-[calc(var(--block)-1px)]"}),mE=()=>{const t=he(r=>r.levelEditor.campaignInProgress),e=he(r=>r.levelEditor.currentlyEditingRoomId),n=He();return f.jsxs("div",{className:"scale-editor flex w-full h-full text-white bg-metallicBlueHalfbrite pb-1 gap-1 flex-wrap justify-start overflow-auto",children:[f.jsx("div",{className:Ae,children:f.jsx(b1,{className:"w-full mb-1"})}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full",children:"Campaign"}),f.jsx(g1,{}),f.jsx(pE,{}),f.jsx(qo,{}),f.jsx(y1,{}),f.jsx(v1,{})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full pt-1",children:"Room"}),f.jsx(dE,{}),f.jsx(qo,{}),f.jsx(C1,{}),f.jsx(qo,{}),f.jsx(XC,{}),f.jsx(hm,{value:e,campaign:t,onSelect:r=>{n(ua(r))},triggerButtonClassName:"w-full",tooltipContent:"Choose the room to view/edit"}),f.jsx("div",{className:"h-1 w-full"}),f.jsx(FC,{}),f.jsx(BC,{}),f.jsx("div",{className:"h-half w-full"}),f.jsx(JC,{}),f.jsx(YC,{})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full pt-1",children:"Edit"}),f.jsxs("div",{className:Ae,children:[f.jsx(LC,{}),f.jsx(ZC,{})]}),f.jsx(GC,{}),f.jsx(qo,{}),f.jsx(MC,{}),f.jsx(lE,{}),f.jsx("div",{className:"h-1 w-full"}),f.jsxs("div",{className:"flex flex-row justify-between flex-wrap gap-x-2",children:[f.jsx(DC,{}),f.jsx(qC,{}),f.jsx(hE,{})]})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full pt-1",children:"Blocks"}),f.jsx(j,{itemTool:{type:"block",config:{style:"organic"}},shortcutKeys:["B"],tooltipContent:`## Block 
The basic block            
hotkey: **B**`,children:f.jsx("span",{className:`sprite texture-block_organic ${W}`})}),f.jsx(j,{itemTool:{type:"block",config:{style:"organic",disappearing:{on:"stand"}}},shortcutKeys:["⇧B"],tooltipContent:`## Block 
Disappearing basic block

hotkey: **Shift B**`,children:f.jsx(Bo,{iconClassName:ge("texture-block_organic_disappearing")})}),f.jsx(j,{itemTool:{type:"block",config:{style:"artificial"}},shortcutKeys:["⌥B"],tooltipContent:`## Block 
Basic block with a metallic look

hotkey: **Alt B**`,children:f.jsx("span",{className:`sprite texture-block_artificial ${W}`})}),f.jsx(j,{itemTool:{type:"block",config:{style:"artificial",disappearing:{on:"stand"}}},shortcutKeys:["⌥⇧B"],tooltipContent:`## Block 
Disappearing metallic look block

hotkey: **Alt Shift B**`,children:f.jsx(Bo,{iconClassName:ge("texture-block_artificial_disappearing")})}),f.jsx(j,{itemTool:{type:"block",config:{style:"tower"}},shortcutKeys:["T"],tooltipContent:`## Tower
Hotkey: **T**`,children:f.jsx("span",{className:`sprite texture-tower ${W}`})}),f.jsx(j,{itemTool:{type:"block",config:{style:"book"}},children:f.jsx("span",{className:`sprite texture-book_x ${W}`})}),f.jsxs(Dr,{children:[f.jsx(j,{itemTool:{type:"barrier",config:{axis:"x"}},children:f.jsx("span",{className:`sprite texture-barrier_x ${W}`})}),f.jsx(j,{itemTool:{type:"barrier",config:{axis:"y"}},children:f.jsx("span",{className:`sprite texture-barrier_y ${W}`})}),f.jsx(j,{itemTool:{type:"barrier",config:{axis:"x",disappearing:{on:"touch"}}},children:f.jsx(Bo,{iconClassName:ge("texture-barrier_x")})}),f.jsx(j,{itemTool:{type:"barrier",config:{axis:"y",disappearing:{on:"touch"}}},children:f.jsx(Bo,{iconClassName:ge("texture-barrier_y")})})]})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full",children:"Monsters"}),f.jsx(j,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},tooltipContent:`## mojo
the emperor’s worker bots

patrols randomly in a diagonal pattern`,children:f.jsx("span",{className:`sprite texture-dalek_1 [button:hover_&]:texture-animated-dalek" ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},tooltipContent:`## guard
hovers towards the player on the shortest axis

heels can outrun, but not head

place on a toaster to make a charging guard`,children:f.jsx(Ct,{topClasses:"texture-cyberman_towards [button:hover_&]:texture-cyberman_right",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},tooltipContent:`## monster
moves *back and forth* by default

or can be set to *patrol clockwise*`,children:f.jsx("span",{className:`sprite texture-skiHead_greenAndPink_towards [button:hover_&]:texture-skiHead_greenAndPink_right ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:f.jsx("span",{className:`sprite texture-helicopterBug_1 [button:hover_&]:texture-animated-helicopterBug ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},tooltipContent:`## turtle
plods along in a clockwise pattern`,children:f.jsx("span",{className:`sprite texture-turtle_towards_1 [button:hover_&]:texture-animated-turtle_right ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},tooltipContent:`## homing bot
detects a player in a straight line on an axis and rushes towards them`,children:f.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase_all ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},tooltipContent:`## Computer bot
usually patrols randomly, but can be programmed to move towards the player`,children:f.jsx(Ct,{topClasses:"texture-computerBot_towards [button:hover_&]:texture-computerBot_right"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"bubbleRobot",activated:"on",movement:"patrol-randomly-xy8"}},tooltipContent:`## Bubble bot
patrols randomly in 8 directions

fast and dangerous`,children:f.jsx(Ct,{topClasses:ge("texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"),bottomClasses:ge("texture-headlessBase")})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:f.jsx(Ct,{topClasses:"texture-monkey_towards [button:hover_&]:texture-monkey_right"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},children:f.jsx(Ct,{topClasses:"texture-elephant_towards [button:hover_&]:texture-elephant_right"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},tooltipContent:`## Elephant head
Things have gone weird

Stationary, but deadly`,children:f.jsx("span",{className:`sprite texture-elephant_towards [button:hover_&]:texture-elephant_right ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",tooltipContent:`## Emperor's Guardian

very dangerous

moves towards the player, unless they have all four planet crowns

does not *like doughnuts*
`,children:f.jsx(Ct,{topClasses:"texture-ball",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},tooltipContent:`## Emperor
The end boss, usually found guarding his Blacktooth crown`,children:f.jsx("span",{className:`sprite texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full",children:"Pickups"}),f.jsxs(Dr,{children:[f.jsx(j,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:f.jsx(_t,{iconClasses:"texture-whiteRabbit",text:"2"})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"shield"}},children:f.jsx(_t,{iconClasses:"texture-whiteRabbit",text:"🛡"})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"jumps"}},children:f.jsx(_t,{iconClasses:"texture-whiteRabbit",text:"♨"})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"fast"}},children:f.jsx(_t,{iconClasses:"texture-whiteRabbit",text:"⚡"})})]}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"bag"}},children:f.jsx("span",{className:`sprite texture-bag ${W}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"hooter"}},tooltipContent:`## hooter

head's doughnut firing hooter`,children:f.jsx("span",{className:`sprite texture-hooter ${W}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:f.jsx("span",{className:`sprite texture-doughnuts ${W}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"reincarnation"}},children:f.jsx("span",{className:`sprite texture-fish_1 [button:hover_&]:texture-animated-fish ${W}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:f.jsx("span",{className:`sprite texture-crown_blacktooth ${W}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"scroll",page:"blacktooth"}},children:f.jsx("span",{className:`sprite texture-scroll ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full",children:"deadly"}),f.jsxs(Dr,{children:[f.jsx(j,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},children:f.jsx("span",{className:`sprite texture-volcano_1 [button:hover_&]:texture-animated-volcano ${W}`})}),f.jsx(j,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},children:f.jsx("span",{className:`sprite texture-toaster_off ${W}`})})]}),f.jsx(j,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},tooltipContent:`## Spiky ball
rolls fast if pushed

deadly to touch`,children:f.jsx("span",{className:`sprite texture-spikyBall_1 [button:hover_&]:texture-spikyBall_2 ${W}`})}),f.jsx(j,{itemTool:{type:"spikes",config:de},tooltipContent:`## spikes

deadly to touch on top

safe to run into the sides`,children:f.jsx("span",{className:`sprite texture-spikes ${W}`})}),f.jsx(j,{itemTool:{type:"moveableDeadly",config:{style:"deadFish"}},tooltipContent:`## dead fish

(deadly to touch)

dead fish decompose very quickly and it rapidly
turns so poisonous that a single lick can kill`,children:f.jsx("span",{className:`sprite texture-fish_1 ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full",children:"control"}),f.jsx(j,{itemTool:{type:"charles",config:de},children:f.jsx(Ct,{topClasses:"texture-charles_towards [button:hover_&]:texture-charles_right"})}),f.jsx(j,{itemTool:{type:"joystick",config:{controls:["charles"]}},tooltipContent:`## Joystick
Controls one or more Charles bots

Change *which* Charles in the json`,children:f.jsx("span",{className:`sprite texture-joystick ${W}`})}),f.jsx(j,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:ds}},tooltipContent:`## Switch
toggles when touched.

edit the json to choose:

* de/activate monsters
* turn on/off moving platforms
* make blocks disappear on touch`,children:f.jsx("span",{className:`sprite texture-switch_left [button:hover_&]:texture-switch_right ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full",children:"movable"}),f.jsx(j,{itemTool:{type:"spring",config:{}},children:f.jsx("span",{className:`sprite texture-spring_released [button:hover_&]:texture-spring_compressed ${W}`})}),f.jsxs(Dr,{children:[f.jsx(j,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:f.jsx("span",{className:`sprite texture-cube ${W}`})}),f.jsx(j,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:f.jsx("span",{className:`sprite texture-drum ${W}`})}),f.jsx(j,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:f.jsx("span",{className:`sprite texture-sticks ${W}`})})]}),f.jsx(j,{itemTool:{type:"pushableBlock",config:{}},children:f.jsx("span",{className:`sprite texture-stepStool ${W}`})}),f.jsx(j,{itemTool:{type:"ball",config:de},children:f.jsx("span",{className:`sprite texture-ball ${W}`})}),f.jsx(j,{itemTool:{type:"slidingBlock",config:{style:"puck"}},tooltipContent:`## Sliding puck

Small item that can be stood on and slides when touched`,children:f.jsx("span",{className:`sprite texture-puck ${W}`})}),f.jsx(j,{itemTool:{type:"slidingBlock",config:{style:"book"}},tooltipContent:`## Sliding book

Why are the books slippery?`,children:f.jsx("span",{className:`sprite texture-book_y ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full",children:"misc."}),f.jsxs(j,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[f.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_static ${W} [button:active_&]:top-oneScaledPix`}),f.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_1 [button:hover_&]:texture-animated-lift ${W} [button:active_&]:top-oneScaledPix`})]}),f.jsxs(Dr,{children:[f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"away"}},children:f.jsx(_t,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-conveyor_y",text:"↗"})}),f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"towards"}},children:f.jsx(_t,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-reversed-conveyor_y",text:"↙"})}),f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"left"}},children:f.jsx(_t,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-conveyor_x",text:"↖"})}),f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"right"}},children:f.jsx(_t,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-reversed-conveyor_x",text:"↘"})})]}),f.jsx(j,{itemTool:{type:"teleporter",config:{toRoom:"to?",toPosition:ue}},children:f.jsx("span",{className:`sprite texture-teleporter ${W}`})}),f.jsx(j,{itemTool:{type:"movingPlatform",config:{movement:"clockwise",activated:"on",startDirection:"towards"}},tooltipContent:`## Moving Platform
Clockwise or back-and-forth

Can be (de)activated by a switch, or touch 

Why a sandwich?`,children:f.jsx("span",{className:`sprite texture-sandwich ${W}`})}),f.jsx(j,{itemTool:{type:"hushPuppy",config:{}},children:f.jsx("span",{className:`sprite texture-hushPuppy ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full",children:"Structure"}),f.jsx(VC,{}),f.jsx(KC,{}),f.jsx(j,{itemTool:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:{x:1,y:1}}},children:f.jsx("span",{className:`sprite texture-blacktooth_floor ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full",children:"Player"}),f.jsx(j,{itemTool:{type:"player",config:{which:"head"}},tooltipContent:`## Head

Place on of these into one room

This is where head will start the game`,children:f.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${W}`})}),f.jsx(j,{itemTool:{type:"player",config:{which:"heels"}},tooltipContent:`## Heels

Place on of these into one room

This is where head will start the game`,children:f.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full",children:"NPC’s"}),f.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"head",startDirection:"towards"}},tooltipContent:`##NPC head
Citizens of Freedom

stand around not doing much`,children:f.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${W}`})}),f.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"heels",startDirection:"towards"}},tooltipContent:`##NPC heels
Citizens of Freedom

stand around not doing much`,children:f.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${W}`})}),f.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"headOverHeels",startDirection:"towards"}},tooltipContent:`##NPC head over heels
Citizens of Freedom

stand around not doing much`,children:f.jsx(Ct,{topClasses:"texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right",bottomClasses:"texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right"})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(z,{className:"w-full pt-2",children:"debug"}),f.jsx(IC,{})]})]})},_r=(t,e)=>({get bottomCentre(){return this.c000},get topLeft(){return this.c101},get topRight(){return this.c011},get c000(){return q(t)},get c001(){return q(B(t,{z:e.z}))},get c010(){return q(B(t,{y:e.y}))},get c011(){return q(B(t,{y:e.y,z:e.z}))},get c100(){return q(B(t,{x:e.x}))},get c101(){return q(B(t,{x:e.x,z:e.z}))},get c110(){return q(B(t,{x:e.x,y:e.y}))},get c111(){return q(B(t,{x:e.x,y:e.y,z:e.z}))},projectCorner(n){return q(B(t,{x:n.x*e.x,y:n.y*e.y,z:n.z*e.z}))}}),Bi=1e-5,sd=-1,Fr=(t,e,n,r,o)=>r-o>t&&n<e-o,gE=0,Qm=1,eg=2,tg=3,yE=(t,e,n,r)=>{const{topLeft:o,topRight:s,bottomCentre:i}=_r(t,e),{topLeft:a,topRight:l,bottomCentre:c}=_r(n,r),u=s.y-s.x/2,d=i.y-i.x/2,h=l.y-l.x/2,p=c.y-c.x/2,g=o.y+o.x/2,y=i.y+i.x/2,v=a.y+a.x/2,w=c.y+c.x/2,_=o.x,b=s.x,x=a.x,S=l.x,k=Fr(u,d,h,p,Bi),C=Fr(g,y,v,w,Bi),N=Fr(_,b,x,S,Bi);return k&&C&&N?Qm:C&&N&&Fr(u,d,h,p,sd)?eg:k&&N&&Fr(g,y,v,w,sd)?tg:gE},vE=(t,e,n,r)=>{for(const o of py){const s=t[o],i=s+e[o],a=n[o],l=a+r[o];if(i<=a)return 1*(o==="z"?-1:1);if(s>=l)return-1*(o==="z"?-1:1)}return id(n)-id(t)},wE=(t,e)=>{if(t.fixedZIndex!==void 0||e.fixedZIndex!==void 0)return 0;const n=t.renderAabb||t.aabb,r=e.renderAabb||e.aabb,o=t.renderAabbOffset?B(t.state.position,t.renderAabbOffset):t.state.position,s=e.renderAabbOffset?B(e.state.position,e.renderAabbOffset):e.state.position;switch(yE(o,n,s,r)){case Qm:return vE(o,n,s,r);case eg:return jt(o.y,s.y+r.y)&&jt(o.z,s.z+r.z)?1:jt(s.y,o.y+n.y)&&jt(s.z,o.z+n.z)?-1:0;case tg:return jt(o.x,s.x+r.x)&&jt(o.z,s.z+r.z)?1:jt(s.x,o.x+n.x)&&jt(s.z,o.z+n.z)?-1:0;default:return 0}},id=t=>t.x+t.y-t.z,bE=(t,e,n,r)=>(t.has(e)||t.set(e,new Map),t.get(e).set(n,r),t),Vo=(t,e,n)=>{const r=t.get(e);return r!==void 0&&(r.delete(n),r.size===0&&t.delete(e)),t},ng=(t,e=new Set(cs(t)),n=new Map)=>{const r=new Map;for(const[o,s]of n)if(!t[o])n.delete(o);else for(const[i]of s)t[i]||Vo(n,o,i);for(const o of e)if(o.fixedZIndex===void 0)for(const s of cs(t)){if(s.fixedZIndex!==void 0||r.get(s)?.has(o)||o===s)continue;const i=wE(o,s);if(r.has(o)||r.set(o,new Set),r.get(o).add(s),i===0){Vo(n,o.id,s.id),Vo(n,s.id,o.id);continue}const a=i>0?o.id:s.id,l=i>0?s.id:o.id;bE(n,l,a,!1),Vo(n,a,l)}return n},rg=t=>{for(const[,l]of t)for(const[c]of l)l.set(c,!1);const e=Array.from(xE(t));let n=e.length,r=n;const o=new Array(n),s={},i=_E(e);for(;r--;)s[r]||a(e[r],r,new Set,null);return o;function a(l,c,u,d){if(u.has(l)){if(d!==null){const g=t.get(d);g?.has(l)&&g.set(l,!0)}return}if(s[c])return;s[c]=!0;const h=t.get(l),p=Array.from(h?.entries()??la);if(c=p.length){u.add(l);do{const[g,y]=p[--c];y||a(g,i.get(g),u,l)}while(c);u.delete(l)}o[--n]=l}};function xE(t){const e=new Set;for(const[n,r]of t.entries()){e.add(n);for(const o of r.keys())e.add(o)}return e}function _E(t){const e=new Map;for(let n=0,r=t.length;n<r;n++)e.set(t[n],n);return e}class CE{constructor(e,n){this.renderContext=e,this.appearance=n,this.output=new re({label:"AppearanceRenderer"})}#e;output;destroy(){this.output.destroy({children:!0})}tick(e){const n=this.appearance({renderContext:this.renderContext,currentRendering:this.#e,tickContext:e});n!=="no-update"&&(this.output.children.at(0)!==n.output&&(this.#e?.output&&(this.output.removeChild(this.#e.output),this.#e.output.destroy({texture:!0,children:!0})),n.output!==void 0&&this.output.addChild(n.output)),this.#e=n)}}class og extends CE{}const ad=(t,e)=>{e.poly([q({}),q({x:t.x}),q({x:t.x,y:t.y}),q({y:t.y})]).poly([q({}),q({z:t.z}),q({y:t.y,z:t.z}),q({y:t.y})]).poly([q({x:t.x}),q({x:t.x,z:t.z}),q(t),q({x:t.x,y:t.y})]).poly([q({z:t.z}),q({x:t.x,z:t.z}),q({x:t.x,y:t.y,z:t.z}),q({y:t.y,z:t.z})])},ld=(t,e)=>{const n=new ht;return ad(t,n),n.stroke({width:.5,color:e,alpha:1}),n.eventMode="static",n.on("pointerenter",()=>{n.fill({color:e,alpha:.5})}),n.on("pointerleave",()=>{n.clear(),ad(t,n),n.stroke({width:.5,color:e,alpha:1})}),n},SE={head:"rgba(255,184,0)",wall:"rgba(128,200,0)",portal:"rgba(255,0,255)",pickup:"rgba(0,196,255)",emitter:"rgba(0,255,255)",stopAutowalk:"rgba(255,128,128)",floatingText:"rgba(128,0,255)"};class kE{constructor(e){this.renderContext=e;const{item:n}=e,r=SE[n.type]??"rgba(255,255,255)";if(this.#e=new re({label:`ItemBoundingBoxRenderer ${n.id}`}),ho("portal")(n)){const s=q(n.config.relativePoint);this.#e.addChild(new ht().circle(s.x,s.y,5).stroke(r)),this.#e.addChild(new ht().circle(s.x,s.y,2).fill(r))}if(this.#e.addChild(new ht({label:"objectOrigin"}).circle(0,0,2).fill(r)),this.#e.addChild(ld(n.aabb,r)),n.renderAabb){const s="rgba(184, 184, 255)",i=ld(n.renderAabb,s);if(n.renderAabbOffset){const a=q(n.renderAabbOffset);i.position.set(a.x,a.y),i.circle(0,0,2).fill(s)}this.#e.addChild(i)}this.#e.eventMode="static";let o;this.#e.on("pointerenter",()=>{if(o!==void 0)return;const s=`${n.id} ${n.type}
@(${n.state.position.x}, ${n.state.position.y}, ${n.state.position.z})}
#(${n.aabb.x}, ${n.aabb.y}, ${n.aabb.z})}`;this.#e.addChild(o=new fw({text:s,style:{fill:r,fontSize:6,fontFamily:"Menlo"}})),o.resolution=4}),this.#e.on("pointerleave",()=>{o!==void 0&&(this.#e.removeChild(o),o=void 0)}),e.frontLayer.attach(this.#e)}#e;tick(){}destroy(){this.#e.destroy({children:!0})}get output(){return this.#e}}class EE extends Tn{constructor(...e){const[n]=e;super(n)}destroy(e){const n=this.texture!==null;typeof e=="boolean"?super.destroy({texture:n,textureSource:e,children:e}):super.destroy({...e,texture:n})}}const PE={Container:"📦",Sprite:"🖼️",UniqueTextureSprite:"✨",Graphics:"🎨",Text:"📝",AnimatedSprite:"🎬",TilingSprite:"🔲",BitmapText:"🔤",Mesh:"🔺",NineSliceSprite:"🔳"},xs=(t,e="",n=!0,r=!0,o=[])=>{const s=[];r&&s.push("");const i=t.constructor.name,a=i.startsWith("_")?i.slice(1):i;let l=PE[a]||"📌";o.forEach((p,g)=>{p.mask===t&&(g===0?l+="😷":l+=`😷^${g+1}`)});const c=t.label&&t.label!==a?` "${t.label}"`:"",u=[];try{(t.x!==0||t.y!==0)&&u.push(`@(${t.x}, ${t.y})`)}catch{u.push("@(ERROR)")}if(t.children.length>2&&u.push(`children: ${t.children.length}`),t.visible||u.push("hidden"),t.alpha<1&&u.push(`alpha: ${t.alpha.toFixed(2)}`),t.mask&&u.push("😷 masked"),t instanceof Tn){const p=t;if(p.texture===null||p.texture===void 0)u.push("texture: NO TEXTURE");else{const g=p.texture.label||"(anon texture)";u.push(`texture: "${g}"`)}}const d=r?"":e+(n?"└── ":"├── ");if(s.push(`${d}${l} ${a}${c}`),u.length>0){const p=t.children.length>0,g=r?p?"│  ":"   ":e+(n?"    ":"│   ")+(p?"│  ":"   ");u.forEach(y=>{s.push(`${g}→ ${y}`)})}const h=r?"":e+(n?"    ":"│   ");return t.children.forEach((p,g)=>{const y=g===t.children.length-1;s.push(xs(p,h,y,!1,[t,...o]))}),s.join(`
`)+(r?`
`:"")},TE=(t,e,n)=>{const r=e.getLocalBounds(),o=Math.ceil(r.maxX-r.minX),s=Math.ceil(r.maxY-r.minY),i=n!==void 0?n.width===o&&n.height===s:!1,a=i?n:As.create({width:o,height:s,antialias:!1,autoGenerateMipmaps:!1});a.label=`renderTexture of ${e.label??"(anon)"}`,n&&!i&&n.destroy();const{x:l,y:c}=e;e.x-=r.minX,e.y-=r.minY;try{t.render({container:e,target:a,clear:i})}catch(u){throw new Error(`renderContainerToTexture: failed to render to texture. Container:
 ${xs(e)}`,{cause:u})}return e.x=l,e.y=c,a},Cr=(t,e,n,r)=>{const o=e.getLocalBounds(),s=n?.texture&&n?.texture instanceof As?n.texture:void 0,i=TE(t,e,s),a=n||new EE;return a.texture=i,a.label=r??`sprite of container (${e.label})`,a.pivot={x:Math.floor(-o.minX),y:Math.floor(-o.minY)},a},wo=(t,e)=>e instanceof Tn?e:Cr(t,e),sg=new lw;sg.matrix=[0,0,0,1,0,0,.3,0,0,0,0,0,.3,0,0,0,0,0,1,0];class AE{constructor(e,n){this.renderContext=e,this.wrappedRenderer=n,this.output=new re({label:`ItemPositionRenderer ${e.item.id}`,children:[n.output]}),this.#t()}output;#e=new Map;#t(){const e=q(this.renderContext.item.state.position);this.output.x=e.x,this.output.y=e.y}tick(e){this.wrappedRenderer?.tick(e),e.movedItems.has(this.renderContext.item)&&this.#t(),this.#s()}#n(){const e=this.renderContext.item.id,n=this.renderContext.zEdges.get(e);if(!n)return la;let r;for(const[o,s]of n)s&&(r||(r=new Set),r.add(o));return r??la}#r(e,n){const r=new re({label:`maskWith: ${e}`,children:[n,this.output.children[0]]});return this.output.addChild(r),r.setMask({mask:n,inverse:!0}),this.#e.set(e,r),r}#o(e,n){const[r,o]=n.children,s=n.parent;s.removeChild(n),s.addChild(o),n.mask=null,r.destroy(),n.destroy(),this.#e.delete(e)}#s(){const{pixiRenderer:e}=this.renderContext.general,n=this.#n();for(const r of this.#e.keys())if(!n.has(r)){const o=this.#e.get(r);if(o)try{this.#o(r,o)}catch(s){throw new Error(`error while destroying masking container ${xs(o)} 
              for our rendering: ${xs(this.output)}`,{cause:s})}}for(const r of n){const o=this.#e.get(r),s=o?.children[0],i=this.renderContext.getItemRenderPipeline(r)?.itemAppearanceRenderer?.output;if(i===void 0)throw new Error("nothing to use as a mask");const a=i.filters;i.filters=sg;const l=Cr(e,i,s,`red mask: ${r}`);i.filters=a,o===void 0&&this.#r(r,l);const c=this.renderContext.room.items[r],u=Kt(q(c.state.position),q(this.renderContext.item.state.position));l.x=u.x,l.y=u.y}}destroy(){this.output.destroy({children:!0}),this.wrappedRenderer?.destroy()}}const cd={x:.5,y:1},ud=t=>typeof t!="string"&&Object.hasOwn(t,"animationId"),Va=t=>{if(typeof t=="string")return Va({textureId:t});{const{anchor:e,flipX:n,pivot:r,x:o,y:s,filter:i,times:a,label:l}=t;if(t.times){const u=ph(a);if(Ps(u)>=2){const h=new re({label:l??"timesXyz"});for(let{x:p}=u;p>=1;p--)for(let{y:g}=u;g>=1;g--)for(let y=1;y<=u.z;y++){const v={...t,textureId:t.textureId??t.textureIdCallback?.(p-1,g-1,y-1),label:`(${p},${g},${y})`};delete v.times;const w=Va(v),_=En({x:p-1,y:g-1,z:y-1});w.x+=_.x,w.y+=+_.y,h.addChild(w)}return h}}let c;if(ud(t))c=RE(t);else{const u=t.textureId??t.textureIdCallback?.(0,0,0);c=new Tn(Vt().textures[u])}if(e===void 0&&r===void 0)if(ud(t))c.anchor=cd;else{const u=t.textureId??t.textureIdCallback?.(0,0,0),d=Vt().data.frames[u];if(d===void 0)throw new Error(`no spritesheet entry for textureId "${u}"`);const h=d.frame;h.pivot!==void 0?c.pivot=h.pivot:c.anchor=cd}else e!==void 0&&(c.anchor=e),r!==void 0&&(c.pivot=r);return o!==void 0&&(c.x=o),s!==void 0&&(c.y=s),i!==void 0&&(c.filters=i),l!==void 0&&(c.label=l),c.eventMode="static",n===!0&&(c.scale.x=-1),c}},V=Va;function RE({animationId:t,reverse:e,playOnce:n,paused:r,randomiseStartFrame:o}){const s=Vt().animations[t],a=(r?[s[0]]:s).map(c=>({texture:c,time:my}));e&&a.reverse();const l=new mr(a);return l.animationSpeed=An.animations[t].animationSpeed,l.gotoAndPlay(o?Math.floor(Math.random()*a.length):0),n!==void 0&&(l.loop=!1,l.onComplete=()=>{l.stop(),n==="and-destroy"&&(l.visible=!1)}),l}const Xs=(t,e)=>{const n=e&&{x:e.x??1,y:e.y??1};return V({...typeof t=="string"?{textureId:t}:t,times:n})},zt=t=>Ie(({renderContext:{item:e}})=>yh(e)?V({...typeof t=="string"?{textureId:t}:t,times:dl(e)}):V(t)),Je=t=>Ie(({renderContext:{item:e,general:{pixiRenderer:n}}})=>{if(yh(e))return wo(n,Xs(t,dl(e)));{const r=V(t);return r instanceof Tn?r:Cr(n,r)}}),Ie=t=>({renderContext:e,currentRendering:n,tickContext:r})=>n===void 0?{output:t({renderContext:e,currentRendering:void 0,tickContext:r}),renderProps:de}:"no-update",Dt=t=>({renderContext:{general:{pixiRenderer:e},item:n},currentRendering:r})=>{if(r===void 0){const o=dl(n),s={output:wo(e,Xs(t(n.config),o)),renderProps:de};return o&&(s.output.y-=((o.z??1)-1)*K.h),s}else return"no-update"},bo=(t,e)=>vt(Ts(t)).map(n=>{const r=e.items[n];if(r===void 0)throw new Error(`item in stoodOnBy "${n}" is not in the room`);return r});ho("head");const OE=ho("heels"),IE=ho("headOverHeels"),jE=t=>{if(OE(t))return t.state;if(IE(t))return t.state.heels},$E=1e3/25,ig=t=>{const e=An.animations[t],n=e.length,{animationSpeed:r}=e;return n*$E/r};ig("bubbles.white");ig("head.fadeOut");const Jl=({config:{activatedOnStoreValue:t}})=>t===void 0?!0:ol(U.getState(),t),NE=({renderContext:{general:{pixiRenderer:t},item:e,room:n},currentRendering:r})=>{const{state:{stoodOnBy:o},config:{times:s}}=e,i=r?.renderProps,a=Jl(e),l=a&&bo(o,n).find(hl)!==void 0;return i===void 0||a!==i.activated||l!==i.flashing?{output:wo(t,Xs({textureId:l?"shadowMask.teleporter.flashing":a?"shadowMask.teleporter":"shadowMask.fullBlock"},s)),renderProps:{flashing:l,activated:a}}:"no-update"},Fi=(t,e=1)=>({renderContext:{item:{state:{facing:n}}},currentRendering:r})=>{const o=r?.renderProps,s=sl(n)??"towards";if(!(o===void 0||s!==o.facingXy4))return"no-update";const a=V(s==="left"||s==="away"?`shadowMask.${t}.away`:`shadowMask.${t}.right`);return a.y=-(K.h*(e-1)),a.scale.x=s==="away"||s==="right"?1:-1,{output:a,renderProps:{facingXy4:s}}},dd={lift:Je("shadowMask.smallBlock"),conveyor:Dt(({direction:t})=>({textureId:"shadowMask.conveyor",flipX:Xt(t)==="x"})),doorLegs:Dt(({direction:t})=>({textureId:t==="right"||t==="towards"?"shadowMask.door.floatingThreshold.double.y":"shadowMask.door.legs.threshold.double.y",flipX:Xt(t)==="y"})),teleporter:NE,floor:"no-mask",barrier:Dt(({axis:t})=>({textureId:"shadowMask.barrier.y",flipX:t==="x"})),spring:Je("shadowMask.smallRound"),block:Dt(({style:t})=>t==="tower"?"shadowMask.tower":"shadowMask.fullBlock"),pushableBlock:Je("shadowMask.stepStool"),movingPlatform:Je("shadowMask.fullBlock"),hushPuppy:Je("shadowMask.hushPuppy"),portableBlock:Dt(({style:t})=>t==="drum"?"shadowMask.smallRound":"shadowMask.smallBlock"),slidingBlock:Dt(({style:t})=>t==="book"?"shadowMask.fullBlock":"shadowMask.smallRound"),deadlyBlock:Dt(({style:t})=>t==="volcano"?"shadowMask.volcano":"shadowMask.toaster"),spikes:Je("shadowMask.spikes"),switch:Je("shadowMask.switch"),pickup:Dt(({gives:t})=>{switch(t){case"scroll":return"shadowMask.scroll";case"doughnuts":return"shadowMask.doughnuts";case"fast":case"extra-life":case"jumps":case"shield":return"shadowMask.whiteRabbit";default:return"blank"}}),slidingDeadly:Je("shadowMask.smallRound"),ball:Je("shadowMask.ball"),"monster.dalek":Je("shadowMask.dalek"),"monster.turtle":Fi("turtle"),"monster.skiHead":Fi("skiHead"),"monster.homingBot":Je("shadowMask.smallRound"),joystick:Je("shadowMask.joystick"),charles:Fi("charles",2)},ME=t=>{switch(t.type){case"monster":return dd[`monster.${t.config.which}`];case"floor":return t.config.floorType==="none"?void 0:"no-mask";default:return dd[t.type]}},zE=new iw({alpha:1-Jr});class DE{constructor(e,n){if(this.renderContext=e,this.#e.filters=zE,n!=="no-mask")if(this.#n=new og(e,n),e.item.shadowOffset===void 0)this.#e.addChild(this.#n.output);else{const r=new re({label:"shadowMaskOffset",...q(e.item.shadowOffset),children:[this.#n.output]});this.#e.addChild(r)}this.#e.addChild(this.#t)}#e=new re({label:"ItemShadowRenderer"});#t=new re({label:"shadows"});#n;#r={};get#o(){return U.getState().gameMenus.userSettings.displaySettings.showShadowMasks}#s(e){if(this.#n===void 0)return;const n=this.#n.output.children.at(0);this.#n.tick(e);const r=this.#n.output.children.at(0);if(r===void 0||!(r instanceof Tn)){const{item:o}=this.renderContext;throw new Error(`ItemShadowRenderer: this.#shadowMaskRenderer didn't create a sprite for item "${o.id}" of type "${o.type}". Have got ${r}`)}n!==r&&(this.#o?this.renderContext.frontLayer.attach(r):this.#e.mask=r)}destroy(){this.#e.destroy(!0),this.#n?.destroy();for(const e of Object.values(this.#r))e.sprite.destroy()}tick(e){if(this.#t.parent===null)throw new Error("shadow container not in scene graph");const{movedItems:n,progression:r}=e,{item:o,general:{pixiRenderer:s},room:i}=this.renderContext,a=n.has(o),l=o.state.position.z+o.aabb.z,c=$e(i.items).filter(function(g){return g.shadowCastTexture!==void 0}),u={id:o.id,state:{position:{...o.state.position,z:l}},aabb:{...o.aabb,z:qs}},d=Object.groupBy(c,p=>{const g=this.#r[p.id]!==void 0,y=n.has(p);return!a&&!y?g?"keepUnchanged":"noShadow":Ks(u,p)?g?"update":"create":"noShadow"});for(const p of bc(d.keepUnchanged,d.update))this.#r[p.id].renderedOnProgression=r;if(d.create)for(const p of d.create){const{times:g}=p.config,y=wo(s,Xs(p.shadowCastTexture,g));y.label=p.id,this.#t.addChild(y),this.#r[p.id]={sprite:y,renderedOnProgression:r}}for(const p of bc(d.create,d.update)){const{sprite:g}=this.#r[p.id],y=q({...Xr(Kt(p.state.position,o.state.position),p.shadowOffset??ar),z:o.aabb.z});g.x=y.x,g.y=y.y}for(const[p,{sprite:g,renderedOnProgression:y}]of uh(this.#r))y!==r&&(g.destroy(),delete this.#r[p]);const h=(d.keepUnchanged?.length??0)+(d.update?.length??0)+(d.create?.length??0)>0;this.#e.visible=h,h&&this.#s(e)}get output(){return this.#e}}const LE=t=>{const e=ME(t.item);return e===void 0?void 0:new DE(t,e)};class BE{constructor(e,n){this.renderContext=e,this.componentRenderers=n,this.output={graphics:n.graphics?.output,sound:n.sound?.output}}output;tick(e){this.componentRenderers.graphics?.tick(e),this.componentRenderers.sound?.tick(e)}destroy(){this.componentRenderers.graphics?.destroy(),this.componentRenderers.sound?.destroy()}}const ce=new window.AudioContext,Ka=()=>{throw new Error(`sounds not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`)},je=t=>{const e=typeof t=="string"?{soundId:t}:t,{playbackRate:n=1,soundId:r,connectTo:o,loop:s=!1,varyPlaybackRate:i=!1,randomiseStartPoint:a=!1}=e,l=ce.createBufferSource(),c=Ka()[r];return l.buffer=c,l.loop=s,l.playbackRate.value=i?n-.05+Math.random()*.1:n,s&&a?l.start(0,c.duration*Math.random()):l.start(),o!==void 0&&l.connect(o),l},Kn=(t,e,n)=>{const r=ce.createGain();return e!==void 0&&(r.gain.value=e),t.connect(r),r.connect(n),r},Fe=({start:t,change:e,loop:n,stop:r,startAndLoopTogether:o=!1,noStartOnFirstFrame:s=!0},i)=>{let a=!0,l,c;return u=>{if(!!u!=!!c)u?t!==void 0&&!(a&&s)?(l?.stop(),l=je({...t}),Kn(l,t.gain,i),n!==void 0&&(o?(l=je({...n,loop:!0}),Kn(l,n.gain,i)):l.onended=()=>{c&&(l=je({...n,loop:!0}),Kn(l,n.gain,i))})):n!==void 0&&(l=je({...n,loop:!0}),Kn(l,n.gain,i)):(l&&l.loop&&(l.stop(),l.onended=null),r!==void 0&&(l=je({...r}),Kn(l,r.gain,i)));else if(c!==u&&e!==void 0){const h=je({...e});Kn(h,e.gain,i)}a=!1,c=u}};class FE{constructor(e){this.renderContext=e,this.output.gain.value=4}output=ce.createGain();#e=Fe({loop:{soundId:"rollingBallLoop",playbackRate:.5}},this.output);tick(){const{renderContext:{item:{state:{vels:{sliding:e},standingOnItemId:n}}}}=this,r=(e.x!==0||e.y!==0)&&n!==null;this.#e(r)}destroy(){}}class UE{constructor(e){this.renderContext=e;const{item:{config:{was:n}}}=e;switch(n.type){case"pickup":{n.gives!=="scroll"&&je({soundId:"bonus",connectTo:this.output});break}case"disappearing":{je({soundId:"destroy",connectTo:this.output});break}case"hushPuppy":{this.output.gain.value=.5,je({soundId:"hushPuppyVanish",connectTo:this.output});break}}}output=ce.createGain();tick(){}destroy(){}}class Yl{constructor(e,n,r=1){this.renderContext=e,this.#e=Fe({start:n},this.output),this.output.gain.value=r}output=ce.createGain();#e;tick({lastRenderRoomTime:e}){const{renderContext:{item:n}}=this,{state:{collidedWith:{roomTime:r,by:o}}}=n,s=r>(e??Pe)&&!Ah(Ts(o));this.#e(s)}destroy(){}}class HE{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#e.gain.value=.5,this.#n=new Yl(e,{soundId:"metalHit"},.3),this.#n.output.connect(this.output)}output=ce.createGain();#e=ce.createGain();#t=Fe({start:{soundId:"servoStart",playbackRate:.5},loop:{soundId:"servoLoop",playbackRate:.5},stop:{soundId:"servoStop",playbackRate:.5}},this.#e);#n;tick(e){const{renderContext:{item:n,room:{roomTime:r,items:o}}}=this,{state:{actedOnAt:{roomTime:s,by:i}}}=n,a=r===s&&vt(Ts(i)).some(l=>vh(o[l]));this.#t(a),this.#n.tick(e)}destroy(){}}const xo=t=>{for(const e in t)return!0;return!1},Ui=2;class WE{constructor(e){this.renderContext=e}output=ce.createGain();#e=Fe({start:{soundId:"conveyorStart",playbackRate:Ui},loop:{soundId:"conveyorLoop",playbackRate:Ui},stop:{soundId:"conveyorEnd",playbackRate:Ui}},this.output);tick(){const{renderContext:{item:{state:{stoodOnBy:e}}}}=this,n=xo(e);this.#e(n)}destroy(){this.#e(!1)}}const GE=3;class qE{constructor(e){this.renderContext=e,this.output.gain.value=.7}output=ce.createGain();#e=je({soundId:"helicopter",loop:!0,connectTo:this.output});tick(){const{renderContext:{item:{state:{vels:{lift:{z:e}}}}}}=this;this.#e.playbackRate.value=Math.max(.5,1+GE*e)}destroy(){}}const hd={skiHead:{soundId:"softBump"},turtle:{soundId:"softBump"},dalek:{soundId:"metalHit"},homingBot:{soundId:"metalHit"},computerBot:{soundId:"metalHit"}},fd={cyberman:{soundId:"jetpackTurnaround",gain:1.2},dalek:{soundId:"mojoTurn",gain:.3}},pd={cyberman:{soundId:"jetpackLoop",gain:.7},emperorsGuardian:{soundId:"jetpackLoop"},dalek:{soundId:"mojoLoop"},bubbleRobot:{soundId:"bubbleRobotLoop"},helicopterBug:{soundId:"helicopter"}},md={homingBot:{start:{soundId:"detect"},loop:{soundId:"robotWhirLoop",gain:4},startAndLoopTogether:!0},computerBot:{loop:{soundId:"robotBeepingLoop",randomiseStartPoint:!0,varyPlaybackRate:!0}}};class VE{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#t.connect(this.output),this.#t.gain.value=.66;const{item:{config:{which:n}}}=e;hd[n]!==void 0&&(this.#o=new Yl(e,hd[n]),this.#o.output.connect(this.output)),fd[n]!==void 0&&(this.#n=Fe({change:fd[n]},this.#e)),md[n]!==void 0&&(this.#s=Fe(md[n],this.#e)),pd[n]!==void 0&&(this.#r=Fe({loop:pd[n]},this.#t))}output=ce.createGain();#e=ce.createGain();#t=ce.createGain();#n;#r;#o;#s;tick(e){const{renderContext:{item:n}}=this,{state:{facing:r,activated:o,busyLickingDoughnutsOffFace:s,vels:{walking:i}}}=n;if(this.#n){const a=dh(r);this.#n(a)}if(this.#o&&this.#o.tick(e),this.#r){const a=o&&!s;this.#r(a)}if(this.#s){const a=!il(i,ue);this.#s(a)}}destroy(){}}class Hi{constructor(e){this.renderContext=e;const{general:{soundSettings:n},item:{type:r}}=e,{noFootsteps:o}={...al.soundSettings,...n};o||(this.#e=ce.createGain(),this.#e.gain.value=2,this.#e.connect(this.output),this.#t=Fe({loop:{soundId:`${r==="headOverHeels"?"heels":r}Walk`}},this.#e)),this.#n.gain.value=.8,this.#n.connect(this.output),this.#i.gain.value=1.2,this.#i.connect(this.output),this.#s.connect(this.output),this.#r=Fe({start:{soundId:`${r==="headOverHeels"?"head":r}Jump`}},this.#n),this.#o=Fe({loop:{soundId:`${r==="headOverHeels"?"head":r}Fall`}},this.#n)}output=ce.createGain();#e;#t;#n=ce.createGain();#r;#o;#s=ce.createGain();#a=Fe({start:{soundId:"landing"},noStartOnFirstFrame:!0},this.#s);#i=ce.createGain();#c=Fe({start:{soundId:"carry",playbackRate:.95},stop:{soundId:"carry",playbackRate:1.05}},this.#i);#l={teleportingPhase:null,positionZ:0};tick({lastRenderRoomTime:e}){const{renderContext:{item:n}}=this,{state:{action:r,teleporting:o,jumpStartZ:s,jumped:i,standingOnItemId:a,position:{z:l},vels:{gravity:{z:c}},collidedWith:{roomTime:u,by:d}}}=n,h=jE(n),{teleportingPhase:p,positionZ:g}=this.#l,y=o?o.phase:null,v=i&&l>s&&l>g&&c>0,w=l<g&&c<0&&a===null;this.#o(w),this.#r(v),this.#t!==void 0&&this.#t(!v&&!w&&r==="moving"),h!==void 0&&this.#c(h.carrying!==null);const _=a!==null&&u>(e??Pe)&&d[a];if(this.#a(_),y!==null&&y!==p)if(y==="in"){const b=Ka().teleportIn,x=ce.createBufferSource();x.buffer=b,x.connect(this.output),x.start()}else{const b=Ka().teleportOut,x=ce.createBufferSource();x.buffer=b,x.connect(this.output),x.start()}this.#l={teleportingPhase:y,positionZ:l}}destroy(){}}class KE{constructor(e){this.renderContext=e}output=ce.createGain();#e=void 0;tick(){const{renderContext:{item:{state:{stoodOnBy:e},config:{style:n}}}}=this;if(n!=="drum")return;const r=this.#e?.stoodOn??!1,o=xo(e);!r&&o&&je({soundId:"drum",connectTo:this.output}),this.#e={stoodOn:o}}destroy(){}}class XE{constructor(e){this.renderContext=e,this.scrapeBracketed=Fe({loop:{soundId:"stepStoolScraping"}},this.output),this.output.gain.value=.4}output=ce.createGain();scrapeBracketed;tick({movedItems:e}){const{renderContext:{item:n,room:{roomTime:r}}}=this,{state:{actedOnAt:{roomTime:o},standingOnItemId:s}}=n,i=r===o&&s!==null&&e.has(n);this.scrapeBracketed(i)}destroy(){}}class JE{constructor(e){this.renderContext=e}output=ce.createGain();tick({lastRenderRoomTime:e}){const{renderContext:{item:{state:{stoodOnBy:n,stoodOnUntilRoomTime:r}}}}=this,o=xo(n);e!==void 0&&r>e&&!o&&je({soundId:"springBoing",connectTo:this.output})}destroy(){}}class YE{constructor(e){this.renderContext=e,this.#e.connect(this.output)}output=ce.createGain();#e=ce.createGain();#t=void 0;tick(){const{renderContext:{item:{state:{setting:e},config:n}}}=this,r=n.type==="in-store"?ol(U.getState(),n.path)?"right":"left":e,o=this.#t?.setting;o!==void 0&&o!==r&&je({soundId:"switchClick",playbackRate:r==="right"?.95:1.05,connectTo:this.#e}),this.#t={setting:r}}destroy(){}}class ZE{constructor(e){this.renderContext=e}output=ce.createGain();#e=Fe({loop:{soundId:"teleportWarningSiren"}},this.output);tick(){const{renderContext:{item:e,room:n}}=this;this.#e(Jl(e)&&bo(e.state.stoodOnBy,n).some(hl))}destroy(){}}class QE{constructor(e){this.renderContext=e,je({soundId:"hooter",connectTo:this.output})}output=ce.createGain();tick(){}destroy(){}}class eP extends Yl{constructor(e){super(e,{soundId:"glassClink",varyPlaybackRate:!0},.8),this.renderContext=e}}const tP=(t,e)=>Rh(bo(t.state.stoodOnBy,e).filter(wh));class nP{constructor(e){this.renderContext=e,this.output.gain.value=2}output=ce.createGain();#e=void 0;tick(e){const{renderContext:{item:n,room:r}}=this,o=tP(n,r);this.#e!==void 0&&o<this.#e&&je({soundId:"toasterPopUpSoundUrl",connectTo:this.output}),this.#e=o}destroy(){}}const rP={lift:qE,switch:YE,bubbles:UE,head:Hi,heels:Hi,headOverHeels:Hi,teleporter:ZE,monster:VE,conveyor:WE,spring:JE,portableBlock:KE,charles:HE,ball:FE,pushableBlock:XE,firedDoughnut:QE,slidingBlock:eP},oP=t=>{if(t.item.type==="deadlyBlock"&&t.item.config.style==="toaster")return new nP(t);const e=rP[t.item.type];if(e)return new e(t)},sP={floors:{edgeLeftX:Number.POSITIVE_INFINITY,edgeRightX:Number.NEGATIVE_INFINITY,topEdgeY:Number.POSITIVE_INFINITY,bottomEdgeY:Number.NEGATIVE_INFINITY},allItems:{topEdgeY:Number.POSITIVE_INFINITY}},iP=t=>$e(t.items).reduce((e,n)=>{if(n.type==="floor"){const{config:{naturalFootprint:r},state:{position:o},renderAabb:s,renderAabbOffset:i,aabb:a}=n,l=q(B(r.position,{x:r.aabb.x,z:r.aabb.z})).x,c=q(B(r.position,{y:r.aabb.y,z:r.aabb.z})).x,u=q(B(r.position,r.aabb)).y,d=q(B(o,i??ue,{z:(s??a).z})).y;return{allItems:e.allItems,floors:{edgeLeftX:Math.min(e.floors.edgeLeftX,l),edgeRightX:Math.max(e.floors.edgeRightX,c),topEdgeY:Math.min(e.floors.topEdgeY,u),bottomEdgeY:Math.max(e.floors.bottomEdgeY,d)}}}else{const r=q(B(n.state.position,n.renderAabb??ue,n.renderAabbOffset??ue)).y;return{allItems:{topEdgeY:Math.min(e.allItems.topEdgeY,r)},floors:e.floors}}},sP),gd=K.h*-1,yd=K.h*qm,aP=0,lP=K.w*16,Wi=(t,e,n)=>(t-e)/(n-e)*2-1;class cP{constructor(e,n){this.renderContext=e,this.childRenderer=n,n.output.connect(this.output),this.output.rolloffFactor=2,this.output.maxDistance=5,this.output.distanceModel="exponential";const r=iP(e.room).floors;this.soundPositionMinX=r.edgeLeftX,this.soundPositionMaxX=r.edgeRightX}output=ce.createPanner();soundPositionMinX;soundPositionMaxX;tick(e){this.childRenderer.tick(e);const{item:n}=this.renderContext,r=n.state,o=B(r.position,Es(n.aabb,.5)),s=Wi(E1(o),this.soundPositionMaxX,this.soundPositionMinX),i=Wi(o.z,gd,yd);if(!Number.isFinite(i))throw new Error(`y position for sound rendering is not finite;
        positionY = numberInRangeToMinus1To1Range(
          itemCentrePosition = ${o.z},
          ${gd},
          ${yd},
        );
        itemCentrePosition = addXyz(
          itemState.position = ${JSON.stringify(r.position)},
          scaleXyz(${JSON.stringify(n.aabb)}, 0.5),
        )`);const a=Wi(o.x+o.y,aP,lP);this.output.positionX.value=s,this.output.positionY.value=i,this.output.positionZ.value=a}destroy(){this.childRenderer.destroy()}}const Or=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,uP=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // we know c.a is either 0 or 1, so no need to do a step()

    finalColor = mix(c, vec4(uColour, 1), c.a);
}
`;class _s extends nn{constructor(e){const n=It.from({vertex:Or,fragment:uP,name:"oneColour-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uColour:{value:new Float32Array(3),type:"vec3<f32>"}}}});const r=this.resources.colorReplaceUniforms.uniforms,[o,s,i]=e.toArray();r.uColour[0]=o,r.uColour[1]=s,r.uColour[2]=i}}const dP={pureBlack:new G("#000000"),shadow:new G("#1B2D3B"),midGrey:new G("#505A55"),lightGrey:new G("#929981"),white:new G("#F8FEF8"),pastelBlue:new G("#4893FF"),metallicBlue:new G("#1D4E80"),pink:new G("#B973AF"),moss:new G("#6E7B00"),redShadow:new G("#513D40"),midRed:new G("#A7574B"),lightBeige:new G("#BF8E69"),highlightBeige:new G("#DBB269"),alpha:new G("#105A69"),replaceLight:new G("#048662"),replaceDark:new G("#052229")},hP=`#version 300 es
// keep this one at mediump for the hash function's precision
precision mediump float;

in vec2 vTextureCoord;
out vec4 finalColor;

const float LUT_SIZE = 256.0;
const float magicNumber = 31.0; // Small prime number

uniform sampler2D uTexture;
uniform sampler2D uLut;

/** returns in [0, LUT_SIZE] range
this must match the TypeScript version of the hash function*/
float hashColor(vec3 color) {
    vec3 c255 = floor(color * 255.0);
    
    float hash = mod(
        c255.r + c255.g * magicNumber + c255.b * magicNumber * magicNumber, 
        LUT_SIZE
    );
    return hash;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    float h = hashColor(c.rgb);

    // use the hash to look up the replacement in the LUT:
    vec4 replacementColour = texture(
        uLut, 
        vec2(
            // normalise h to [0, 1] range
            (h + 0.5) / LUT_SIZE, 
            0.5
        )
    );
    
    // use original if either: 
    //      original alpha is 0 (because keep transparent)
    //      or lut alpha is 0 (signals nothing in this slot of the LUT)
    finalColor = mix(c, replacementColour, c.a * replacementColour.a);
}
`,qr=256,Gi=31,vd=new Map;function fP(t){const e=Math.floor(t.red*255),n=Math.floor(t.green*255),r=Math.floor(t.blue*255);return(e+n*Gi+r*Gi*Gi)%qr}function pP(t){const e=new Float32Array(qr*4);for(const[o,s]of gy(t)){const i=$[o],a=fP(i);if(e[a*4+3]>.5)throw new Error("LUT collision - mess with the hash function or lut size until this goes away");e[a*4+0]=s.red,e[a*4+1]=s.green,e[a*4+2]=s.blue,e[a*4+3]=1}const n=new Uint8Array(qr*4);for(let o=0;o<qr*4;o++)n[o]=Math.floor(e[o]*255);return Tt.from({resource:n,width:qr,height:1,scaleMode:"nearest"})}class mP extends nn{#e;constructor(e){const n=Object.keys(e).length,r=It.from({vertex:Or,fragment:hP,name:"palette-swop-filter"}),o=pP(e);super({glProgram:r,resources:{colorReplaceUniforms:{uOriginal:{value:new Float32Array(3*n),type:"vec3<f32>",size:n},uReplacement:{value:new Float32Array(3*n),type:"vec3<f32>",size:n}},uLut:o.source}}),this.#e=o;const s=this.resources.colorReplaceUniforms.uniforms;Object.entries(e).forEach(([i,a],l)=>{$[i].toArray().forEach((c,u)=>{s.uOriginal[l*3+u]=c}),a.toArray().forEach((c,u)=>{s.uReplacement[l*3+u]=c})})}destroy(e){this.#e?.destroy(!0),this.#e=null,super.destroy(e)}}const gP=t=>Object.entries(t).sort(([e],[n])=>e.localeCompare(n)).map(([e,n])=>`${e}:${n.toHex()}`).join("|"),sn=t=>{const e=gP(t);let n=vd.get(e);return n||(n=new mP(t),vd.set(e,n)),n},yP=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uTargetColor;

vec4 black = vec4(0.0, 0.0, 0.0, 1.0);

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // 1 if black, 0 if non-black
    float isBlack = step(length(c.rgb), 0.01);

    // keep original if either:
    //      * black
    //      * transparent

    finalColor = mix(    
        vec4(uTargetColor, 1),    
        c, 
        max(isBlack, 1.0 - c.a)
    );
}
`;class Ue extends nn{uniforms;constructor(e="white"){const n=It.from({vertex:Or,fragment:yP,name:"revert-colourise-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[n,r,o]=new G(e).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}}const vP=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    finalColor = vec4(c.rgb * 0.5, c.a);
}
`;class wP extends nn{constructor(){const e=It.from({vertex:Or,fragment:vP,name:"halfbrite-filter"});super({glProgram:e,resources:{}})}}const ag=({basic:t,dimmed:e})=>({replaceLight:t,replaceDark:e}),lg=({color:{hue:t,shade:e},planet:n})=>{const r=t==="yellow"?e==="dimmed"||n==="jail"?gm:Qe:Hs[t][e].main;return ag(r)},bP=t=>sn({lightBeige:$.lightGrey,redShadow:$.shadow,pink:$.lightGrey,moss:$.lightGrey,midRed:$.midGrey,highlightBeige:$.lightGrey,...t&&lg(t)}),xP=sn({midGrey:$.midRed,lightGrey:$.lightBeige,white:$.highlightBeige,metallicBlue:$.redShadow,pink:$.midRed,moss:$.midRed,replaceDark:$.midRed,replaceLight:$.lightBeige}),wd=(t,e)=>{const n=vs(t.color).edges[e],r=n.original;return n.dimInOriginal?mm(r):r},cg=(t,e,n)=>n?sn(ag(Hs[t.color.hue][t.color.shade].edges[e])):new Ue(vs(t.color).edges[e].original),gt=t=>sn(lg(t)),_P=t=>{switch(t.color.hue){case"white":return sn({replaceLight:$.lightGrey,replaceDark:$.midGrey});default:return gt(t)}},ug=t=>{switch(t.color.hue){case"white":return sn({replaceLight:$.lightBeige,replaceDark:$.midRed,shadow:$.redShadow});case"yellow":return gt({planet:t.planet,color:{hue:"yellow",shade:"dimmed"}});default:return gt(t)}};new wP;const an=ds,CP=sn(dP),SP=[new _s($.midRed)],kP=[new _s($.moss)],EP=75;class PP{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output)}output=new re({label:"ItemFlashOnSwitchedRenderer"});tick(e){const{renderContext:{item:{state:{switchedAtRoomTime:n,switchedSetting:r}},room:{roomTime:o}}}=this;this.output.filters=o-n<EP?r==="left"?kP:SP:an,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const TP=(t,e,n)=>{const o=Vt().textures[`door.frame.${t.planet}.${e}.near`]!==void 0?t.planet:"generic",s=t.color.shade==="dimmed"&&Vt().textures[`door.frame.${o}.dark.${e}.${n}`]!==void 0;return`door.frame.${o}${s?".dark":""}.${e}.${n}`};function Js(t,e){const n=e||new re;for(const r of t)n.addChild(r);return n}function*AP({config:{direction:t,inHiddenWall:e,height:n}},r){const o=uo(t),s=o==="y"?1:16;function*i(a){if(e){if(n!==0){const l=V({textureId:`generic.door.floatingThreshold.${o}`,...Xr(a,{y:-12*n})});l.filters=cg(r,o==="x"?"towards":"right",!0),yield l}}else{yield V({pivot:{x:s,y:9},textureId:`generic.door.legs.base.${o}`,...Xr(a,{})});for(let l=1;l<n;l++)yield V({pivot:{x:s,y:9},textureId:`generic.door.legs.pillar.${o}`,...Xr(a,{y:-l*K.h})})}}yield*i(En({...ar,[o]:1})),yield*i(ar),e||(yield V({pivot:{x:16,y:K.h*n+13},textureId:`generic.door.legs.threshold.double.${o}`,...En({...ar,[o]:1})}))}const dg=(t,e)=>{const n=uo(t),r=Er(n),o=8;return t==="towards"||t==="right"?q({[r]:e[r]-o}):ar},RP=Ie(({renderContext:{item:t,room:e}})=>Js(AP(t,e),new re({filters:gt(e),...dg(t.config.direction,t.aabb)}))),OP=Ie(({renderContext:{item:{config:{direction:t,part:e,toRoom:n},aabb:r},room:o,general:{gameState:s}}})=>{const i=uo(t),a=s===void 0?o:s.campaign.rooms[n];return V({textureId:TP(o,i,e),filter:gt(a),...dg(t,r)})}),qi={animationId:"bubbles.cold"},or=({top:t,bottom:e="headlessBase",filter:n})=>{const r=new re({filters:n}),o=V(e);r.addChild(o);const s=V(t);return s.y=-12,r.addChild(s),r[Ys]=s,r[Zl]=o,r},Ys=Symbol(),Zl=Symbol(),IP=({top:t,bottom:e})=>{const n=new re;return n.addChild(e),t.y=-12,n.addChild(t),n[Ys]=t,n[Zl]=e,n},jP=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform vec2 uTextureSize;
uniform sampler2D uTexture;
uniform vec3 uOutline;
uniform float uOutlineWidth;

void main(void) {
    vec2 scaledTexelSize = vec2(1.0f) / vec2(textureSize(uTexture, 0)) * uOutlineWidth;    
    
    // Calculate offset coordinates
    vec2 rightCoord = vec2(vTextureCoord.x + scaledTexelSize.x, vTextureCoord.y);
    vec2 leftCoord = vec2(vTextureCoord.x - scaledTexelSize.x, vTextureCoord.y);
    vec2 belowCoord = vec2(vTextureCoord.x, vTextureCoord.y + scaledTexelSize.y);
    vec2 aboveCoord = vec2(vTextureCoord.x, vTextureCoord.y - scaledTexelSize.y);
    
    // Create boundary masks (1.0 if within bounds, 0.0 if out of bounds)
    // seems to work fine without this, but could multiply colourToX by this to get zero'd out when OOB
    // float rightInBounds = step(rightCoord.x, 1.0);
    // float leftInBounds = step(0.0, leftCoord.x);
    // float belowInBounds = step(belowCoord.y, 1.0);
    // float aboveInBounds = step(0.0, aboveCoord.y);
    
    vec4 colourToRight = texture(uTexture, rightCoord);
    vec4 colourToLeft = texture(uTexture, leftCoord);
    vec4 colourBelow = texture(uTexture, belowCoord);
    vec4 colourAbove = texture(uTexture, aboveCoord);
    
    // Check if any neighbor is opaque (combine all alpha values)
    float hasOpaqueNeighbor = max(max(colourToRight.a, colourToLeft.a), 
                                  max(colourBelow.a, colourAbove.a));

    vec4 originalColour = texture(uTexture, vTextureCoord);
        
    finalColor = mix(
        originalColour, 
        vec4(uOutline, 1), 
        // 1 if: original colour is transparent and has an opaque neighbour - use outline colour
        // 0 if: original colour is opaque or has no opaque neighbour - use original colour (transparent or sprite)
        (1.0 - originalColour.a) * hasOpaqueNeighbor
    );
}
`;class yt extends nn{constructor({outlineColor:e,upscale:n,lowRes:r}){const o=It.from({vertex:Or,fragment:jP,name:"outline-filter"});super({glProgram:o,padding:n,resources:{colorReplaceUniforms:{uOutline:{value:new Float32Array(3),type:"vec3<f32>"},uOutlineWidth:{value:new Float32Array(1),type:"f32"}}}});const s=this.resources.colorReplaceUniforms.uniforms,[i,a,l]=e.toArray();s.uOutline[0]=i,s.uOutline[1]=a,s.uOutline[2]=l,s.uOutlineWidth[0]=n,r&&(this.resolution=1/n,this.padding=n,s.uOutlineWidth[0]=1)}}const $P=t=>{const{gameTime:e,lastDiedAt:n}=t.type==="headOverHeels"?t.state.head:t.state;return e-n<R1},Vi=t=>{if(t===void 0)return 0;const{shieldCollectedAt:e,gameTime:n}=t;return e!==null&&e+Vu>n?100-Math.ceil((n-e)/(Vu/100)):0},NP=t=>t.type==="headOverHeels"?Vi(t.state.head)>0||Vi(t.state.heels)>0:Vi(t.state)>0,Zs=t=>t,Xa=.02,MP=({name:t,action:e,facingXy8:n,teleportingPhase:r,gravityZ:o,paused:s})=>{if(e==="death")return{animationId:`${t}.fadeOut`,paused:s};if(r==="out")return{animationId:`${t}.fadeOut`,paused:s};if(r==="in")return{animationId:`${t}.fadeOut`,paused:s};if(e==="moving")return{animationId:`${t}.walking.${n}`,paused:s};if(e==="jumping")return{textureId:o<Xa?`${t}.walking.${n}.2`:`${t}.walking.${n}.1`};if(e==="falling"){const a=`${t}.falling.${n}`;if(hs(a))return{textureId:a}}const i=`${t}.idle.${n}`;return Zh(i)?{animationId:i,paused:s}:{textureId:`${t}.walking.${n}.2`}},Ja=Symbol(),Ya=Symbol(),zP=(t,e)=>{t[Ja].removeChildren(),t[Ja].addChild(V(MP(e)))},hg=sn({pastelBlue:$.pink}),Ki=(t,e,n)=>{const r=new re,o=new re;r[Ja]=o,r.addChild(o);const s=V({animationId:e?`shine.${t}InSymbio`:"shine",paused:n,filter:t==="heels"?hg:an,flipX:t==="heels"});return r[Ya]=s,r},bd=({gameTime:t,switchedToAt:e},n,r)=>(n==="headOverHeels"||n===r)&&e+A1>t,DP=t=>{if(!$P(t))return!1;const{gameTime:e,lastDiedAt:n}=t.type==="headOverHeels"?t.state.head:t.state;return(e-n)%Ku<Ku*O1},xd=(t,e)=>{t.filters?Array.isArray(t.filters)?t.filters=[...t.filters,e]:t.filters=[t.filters,e].flat():t.filters=e},_d=(t,e)=>{t.filters=Array.isArray(t.filters)?t.filters.filter(n=>!(n instanceof e)):t.filters instanceof e?an:[...t.filters]},LP=(t,{highlighted:e,flashing:n},r,o)=>{const s=r?.highlighted??!1;e&&!s?xd(o,new yt({outlineColor:rr[t],upscale:tn(U.getState()),lowRes:!1})):!e&&s&&_d(o,yt);const i=r?.flashing??!1;n&&!i?xd(o,new _s(rr[t])):!n&&i&&_d(o,_s)},BP=(t,e,n)=>{e&&!n?t.addChild(t[Ya]):!e&&n&&t.removeChild(t[Ya])},Xi=(t,e,n,r,o,s)=>{n&&zP(e,{name:t,...r,paused:o}),LP(t,r,s,e),BP(e,r.shining,s?.shining??!1)},FP=({renderContext:{item:t,general:{gameState:e,paused:n}},currentRendering:r})=>{const{type:o,state:{action:s,facing:i,teleporting:a,vels:{gravity:{z:l}}}}=t,c=r?.renderProps,u=r?.output,d=dh(i)??"towards",h=e!==void 0&&(t.type==="headOverHeels"?bd(t.state.head,"headOverHeels","headOverHeels"):bd(t.state,t.type,e.currentCharacterName)),p=DP(t),g=NP(t),y=Ps(i),v=a?.phase??null,w={action:s,facingXy8:d,teleportingPhase:v,flashing:p,highlighted:h,shining:g,gravityZ:l},_=c===void 0||c.action!==s||c.facingXy8!==d||c.teleportingPhase!==v||c?.gravityZ>Xa!=l>Xa;let b;if(o==="headOverHeels"){b=u??IP({top:Ki("head",!0,n),bottom:Ki("heels",!0,n)});const x=b;Xi("head",x[Ys],_,w,n,c),Xi("heels",x[Zl],_,w,n,c)}else b=u??Ki(o,!1,n),Xi(o,b,_,w,n,c);return s==="moving"&&u instanceof mr&&(u.animationSpeed=y*yy),{output:b,renderProps:w}},Ji=Zs(FP),Cd=t=>t-Math.floor(t),UP=({state:{position:t}},e)=>{const n=o=>o.config.direction==="away"||o.config.direction==="left";return Js($e(e.items).filter(o=>o.type==="wall"||o.type==="doorLegs").filter(n).map(o=>{const{id:s,config:{direction:i},state:{position:a}}=o;return V({textureId:"floorOverdraw.cornerNearWall",label:s,...q(hr(a,t)),times:o.type==="wall"?ul(o.config):{[Er(Xt(i))]:2},anchor:{x:0,y:1},flipX:i==="away"})}),new re({label:"floorOverdraws"}))},HP=`#version 300 es
precision lowp float;

out vec4 finalColor;

in vec2 vTextureCoord;
uniform sampler2D uBackBuffer;
uniform vec3 uTargetColor;
// do not use uTexture in this frag - for some reason it causes pixi's render pipeline
// to take away the backbuffer, which we rely on sampling from

void main() {
    vec3 bg = texture(uBackBuffer, vTextureCoord).rgb;

    float isBlack = step(length(bg), 0.001f); // 1 if black, 0 otherwise
    finalColor = mix(vec4(uTargetColor, 1.0f), vec4(0, 0, 0, 0), isBlack);


}`;class Sd extends nn{uniforms;constructor(e="white"){const n=It.from({vertex:Or,fragment:HP,name:"colour-clash-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}},blendRequired:!0}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[n,r,o]=new G(e).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}}const kd=({colourised:t,direction:e,room:n,times:r,position:o,colourSwap:s})=>V({label:`floorEdge(${e})`,textureId:`floorEdge.${e}`,times:r,filter:s?cg(n,e,t):void 0,...q(o)}),WP=({room:t,xSize:e,ySize:n,y:r})=>{const o=new re({label:"floorColourClash"}),s=wd(t,"right");for(let a=0;a<=n;a++){const l=En({x:0,y:a,z:0}),c=new ht().rect(l.x-(a===0?0:8),l.y,8*3,8).fill(s);c.filters=new Sd(s),o.addChild(c)}const i=wd(t,"towards");for(let a=0;a<=e;a++){const l=En({x:a,y:0,z:0}),c=new ht().rect(l.x-16,l.y,8*(a===0?2:3),8).fill(i);c.filters=new Sd(i),o.addChild(c)}return o.y=r,o},GP=Ie(({renderContext:{room:t,item:e,general:{colourised:n,pixiRenderer:r},colourClashLayer:o}})=>{const{color:{shade:s}}=t,{config:i,state:{position:a},aabb:l}=e,{floorType:c,naturalFootprint:u}=i,d=new re({label:"floorAppearance"}),h=q({...l,y:0}),p=q({...l,x:0,y:0}),g=q({...l,x:0}),y=q(l);if(c!=="none"){const v=new re({label:"tiles"}),w=c==="deadly"?`generic${s==="dimmed"?".dark":""}.floor.deadly`:`${i.scenery}${s==="dimmed"?".dark":""}.floor`,_=Vt().textures[w];try{Yh(w)}catch(X){throw new Error(`no floor textureId for floorType: ${c}, shade: ${s}`,{cause:X})}const b=Kt(u.position,a),x={x:Cd(b.x/K.w),y:Cd(b.y/K.w)},S=8,k={x:h.x,y:y.y-S,width:g.x-h.x,height:p.y-y.y+2*S},C=Kt(En(Xr(x,{x:.5,y:.5})),{y:l.z},k),N=new uw({texture:_,tilePosition:C,...k});v.addChild(N),v.addChild(UP(e,t));const H=new ht().moveTo(y.x,y.y).lineTo(g.x,g.y).lineTo(g.x,g.y+3).lineTo(p.x,p.y+3).lineTo(h.x,h.y+3).lineTo(h.x,h.y).fill({color:16711680,alpha:.5});v.addChild(H),v.mask=H,v.filters=[_P(t)];const L=new re({children:[v]});L.filters=new yt({outlineColor:$.pureBlack,upscale:1,lowRes:!1}),d.addChild(Cr(r,L))}{const v=new re({label:"edges"});c==="none"&&v.addChild(new ht().moveTo(g.x,g.y+8).lineTo(g.x,g.y+100).lineTo(h.x,h.y+100).lineTo(h.x,h.y+8).lineTo(p.x,p.y+8).fill(0));const w=Math.ceil(l.y/K.w);v.addChild(kd({colourised:n,direction:"right",room:t,times:{y:w},position:{z:l.z},colourSwap:n}));const _=Math.ceil(l.x/K.w);if(v.addChild(kd({colourised:n,direction:"towards",room:t,times:{x:_},position:{z:l.z},colourSwap:n})),d.addChild(Cr(r,v)),!n){const b=WP({xSize:_,ySize:w,y:-l.z+1,room:t});d.addChild(b),o.attach(b)}}return d}),qP=["cyberman","dalek","skiHead","bubbleRobot","computerBot","turtle","homingBot"],VP=t=>{let e=2166136261;const n=t.length;for(let r=Math.max(0,n-9);r<n;r++)e^=t.charCodeAt(r),e=Math.imul(e,1540483477),e^=e>>>15;return(e>>>0)/4294967295},KP=200,XP=1,JP=(t,e)=>{const n=VP(e);return Math.sin((t+n*2e4)/KP)*XP},Ed=({id:t,config:{which:e},state:n},r,o)=>{if((e==="cyberman"||e==="bubbleRobot")&&n.activated||e==="emperorsGuardian"){const s=o;s[Ys].y=-12+JP(r.roomTime,t)}},YP=({renderContext:{item:t,room:e,general:{paused:n}},currentRendering:r})=>{const{config:o,state:s}=t,i=r?.renderProps,{activated:a,busyLickingDoughnutsOffFace:l}=s,c=l?xP:a?void 0:qP.includes(o.which)?bP(e):void 0;switch(o.which){case"skiHead":case"turtle":case"cyberman":case"computerBot":case"elephant":case"elephantHead":case"monkey":{const u=sl(s.facing)??"towards";if(!(i===void 0||a!==i.activated||l!==i.busyLickingDoughnutsOffFace||u!==i.facingXy4))return Ed(t,e,r.output),"no-update";const h={facingXy4:u,activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"skiHead":return{output:V({textureId:`${o.which}.${o.style}.${u}`,filter:c}),renderProps:h};case"elephantHead":return{output:V({textureId:`elephant.${u}`,filter:c}),renderProps:h};case"turtle":return{output:V(a&&!l?{animationId:`${o.which}.${u}`,filter:c,paused:n}:{textureId:`${o.which}.${u}.1`,filter:c}),renderProps:h};case"cyberman":return{output:s.activated||s.busyLickingDoughnutsOffFace?or({top:{textureId:`${o.which}.${u}`,filter:c||gt(e)},bottom:{...qi,paused:n}}):V({textureId:`${o.which}.${u}`,filter:c}),renderProps:h};case"computerBot":case"elephant":case"monkey":return{output:or({top:`${o.which}.${u}`,bottom:{animationId:"headlessBase.flash",playOnce:"and-stop"},filter:c}),renderProps:h};default:throw new Error(`unexpected monster ${o}`)}break}case"homingBot":{const u=!vy(s.vels.walking,ar);return i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated||u!==i.walking?{filter:c,output:V(a&&!l?{animationId:u?"headlessBase.flash":"headlessBase.scan",filter:c}:{textureId:"headlessBase",filter:c}),renderProps:{activated:a,busyLickingDoughnutsOffFace:l,walking:u}}:"no-update"}case"helicopterBug":case"emperor":case"dalek":case"bubbleRobot":case"emperorsGuardian":{if(!(i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated))return Ed(t,e,r.output),"no-update";const d={activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"helicopterBug":case"dalek":return{output:V(a&&!l?{animationId:o.which,filter:c,paused:n}:{textureId:`${o.which}.1`,filter:c}),renderProps:d};case"bubbleRobot":return{output:or({top:{...qi,paused:n},filter:c}),renderProps:d};case"emperorsGuardian":return{output:or({top:"ball",bottom:{...qi,paused:n},filter:c}),renderProps:d};case"emperor":return{output:V({animationId:"bubbles.cold",filter:c,paused:n}),renderProps:d};default:throw new Error(`unexpected monster ${o}`)}break}default:throw new Error(`unexpected monster ${o}`)}},Ko=new yt({outlineColor:$.pureBlack,upscale:tn(U.getState()),lowRes:!0});new Ue;new Ue;new Ue;new Ue($.moss);new Ue;new Ue(rr.head),new Ue(br(rr.head)),new Ue(rr.heels),new Ue(br(rr.heels));function*ZP(t){const e=typeof t=="string"?t==="infinite"?"":t:t.toString(),n=Rh(e);let r=0;for(const o of e){const s=`hud.char.${rh(o)}`;try{Yh(s)}catch(i){throw new Error(`no texture id for char "${o}": ${i.message}`,{cause:i})}yield V({textureId:s,x:(r+.5-n/2)*wy.w}),r++}}const fg=(t,e)=>{t.removeChildren();try{Js(ZP(e),t)}catch(n){throw console.error("invalid string is",e,"and on window as window.invalid"),console.error(n),window.invalid=e,new Error(`could not show text "${e}" in container because: "${n.message}"`,{cause:n})}return t},QP=Gm.floatingText,eT=12,Pd=K.h*3,Td=[$.shadow,$.midGrey,$.redShadow,$.metallicBlue,$.midRed,$.moss,$.pink,$.lightBeige,$.pastelBlue,$.lightGrey,$.highlightBeige],Ad=[...Td,...new Array(20).fill($.white),...Td.toReversed()],tT=({renderContext:{item:{config:{textLines:t,appearanceRoomTime:e}},room:{roomTime:n},general:{displaySettings:{uncolourised:r}},frontLayer:o},currentRendering:s})=>{const i=s?.output;let a;const c=(n-e)*QP;if(i===void 0){a=new re({filters:new yt({outlineColor:$.pureBlack,upscale:tn(U.getState()),lowRes:!1})}),o?.attach(a);for(let d=0;d<t.length;d++){const h=t[d],p=fg(new re({label:h,y:d*eT,filters:r?an:new Ue($.pink)}),h.toUpperCase());a.addChild(p)}}else a=i;let u=!1;for(let d=0;d<t.length;d++){const h=a.children[d],[p]=h.filters,g=c+d*-12,y=g>0&&g<Pd;if(h.visible=y,u||=y,y&&p){const v=Math.floor(g/Pd*Ad.length);p.targetColor=Ad[v]}}return a.visible=u,a.y=-c,{output:a,renderProps:de}},Rd=500,nT=An.animations["conveyor.x"].animationSpeed,Od=An.animations["conveyor.x"].length,rT=t=>1-(1-t)**2,oT=(t,e)=>{for(let n=0;n<t.children.length;n++){const r=t.children[n],o=n%Od;r.gotoAndStop(e?Od-o-1:o)}},sT=(t,e)=>{const n=Xt(t),r=V({animationId:`conveyor.${n}`,reverse:t==="towards"||t==="right",times:e}),o=r instanceof mr?new re({children:[r]}):r;return oT(o,t==="towards"||t==="right"),o},iT=({renderContext:{item:{config:{direction:t,times:e},state:{stoodOnBy:n}},room:{roomTime:r}},currentRendering:o})=>{const s=o?.renderProps,i=xo(n),a=(!i&&s?.moving?r:s?.roomTimeStoppedMoving)??Pe,l=o?.output??sT(t,e),c=i?0:Math.min(r-a,Rd),u=Math.max(0,1-c/Rd);for(const d of l.children)if(u===0)d.stop();else{const h=nT*rT(u);d.play(),d.animationSpeed=h}return{output:l,renderProps:{moving:i,roomTimeStoppedMoving:a}}},aT=Zs(iT),lT=({renderContext:{item:t,room:e,general:{paused:n}},currentRendering:r})=>{const{state:{stoodOnBy:o},config:{times:s}}=t,i=r?.renderProps,a=Jl(t),l=a&&bo(o,e).some(hl);return i===void 0||a!==i.activated||l!==i.flashing?{output:l?new re({children:[V({textureId:"teleporter",times:s}),V({animationId:"teleporter.flashing",times:s,paused:n})]}):V({textureId:a?"teleporter":"block.artificial",times:s}),renderProps:{flashing:l,activated:a}}:"no-update"},cT=({renderContext:{item:{state:{facing:t,actedOnAt:{roomTime:e,by:n}}},room:{roomTime:r,items:o}},currentRendering:s})=>{const i=s?.renderProps,a=sl(t)??"towards",l=r===e&&vt(Ts(n)).some(u=>vh(o[u]));return i===void 0||a!==i.facingXy4||l!==i.controlledByJoystick?{output:or({top:`charles.${a}`,bottom:l?"headlessBase.all":"headlessBase"}),renderProps:{facingXy4:a,controlledByJoystick:l}}:"no-update"},uT=({renderContext:{item:{state:{stoodOnBy:t,stoodOnUntilRoomTime:e}},general:{paused:n}},tickContext:{lastRenderRoomTime:r},currentRendering:o})=>{const s=o?.renderProps,i=xo(t);let a;return o?.output?a=o?.output:(a=V({animationId:"spring.bounce"}),a.loop=!1,a.gotoAndStop(0)),r!==void 0&&e>r&&!i&&!n?a.gotoAndPlay(0):i&&!(s?.compressed??!1)&&a.gotoAndStop(1),{output:a,renderProps:{compressed:i}}},dT=Zs(uT),hT=({renderContext:{item:{config:{which:t,startDirection:e}}},currentRendering:n})=>n?.renderProps===void 0?{output:t==="headOverHeels"?or({top:{textureId:`head.walking.${e}.2`},bottom:{textureId:`heels.walking.${e}.2`}}):V({textureId:`${t}.walking.${e}.2`}),renderProps:de}:"no-update",fT=({renderContext:{item:{state:{vels:{sliding:t}},config:{startingPhase:e}},general:{paused:n}},tickContext:{deltaMS:r},currentRendering:o})=>{const i=(o?.renderProps?.distanceTravelled??0)+ll(t)*(n?0:r),l=o?.output??V("spikyBall.1"),u=(Math.floor(i*2/ir.w)+e)%2+1;return l.texture=Vt().textures[`spikyBall.${u}`],{output:l,renderProps:{distanceTravelled:i}}},pT=Zs(fT),mT=(t,e,n,r)=>`${t}${r?".dark":""}.wall.${e}.${n}`,gT=Ie(({renderContext:{general:{pixiRenderer:t},item:{id:e,config:n},room:r}})=>{if(n.direction==="right"||n.direction==="towards")throw new Error(`wall is near: ${e}`);const{direction:o,tiles:s}=n,i=Er(Xt(o)),a=new re({label:"wallTiles"}),l=new re({label:"wallAnimations"});for(let u=0;u<n.tiles.length;u++){const d=En({[i]:u});if(a.addChild(V({textureId:mT(r.planet,s[u],o,r.color.shade==="dimmed"),...d,pivot:o==="away"?{x:ir.w,y:ir.h}:{x:0,y:ir.h}})),r.planet==="moonbase"){const h=`moonbase.wall.screen.${s[u]}.away`;Zh(h)&&l.addChild(V({animationId:h,randomiseStartFrame:!0,flipX:o==="left",x:d.x+(o==="away"?-8:8),y:d.y-23}))}}const c=new re({label:"wallAppearance"});return c.addChild(Cr(t,a)),l.children.length>0&&c.addChild(l),c.filters=gt(r),c}),yT=({renderContext:{item:{state:{setting:t},config:e}},currentRendering:n})=>{const r=n?.renderProps,o=e.type==="in-store"?ol(U.getState(),e.path)?"right":"left":t;return r===void 0||o!==r.setting?{output:V(`switch.${o}`),renderProps:{setting:o}}:"no-update"},vT=(t,e,n)=>e==="tower"?"tower":e==="book"?"book.x":e==="organic"&&t?`block.organic.dark${n?".disappearing":""}`:`block.${e}${n?".disappearing":""}`,wT=({renderContext:{general:{pixiRenderer:t},item:{config:{style:e,times:n},state:{disappearing:r}},room:o},currentRendering:s})=>{const i=s?.renderProps,a=r!==null;return i===void 0||i.isDissapearing!==a?{output:wo(t,V({textureId:vT(o.color.shade==="dimmed",e,a),filter:e==="organic"?gt(o):e==="book"?ug(o):void 0,times:n})),renderProps:{isDissapearing:a}}:"no-update"},bT=({state:{stoodOnBy:t,position:e},config:{times:n}},r)=>{const o=new Array(n?.x??1).fill(null).map(()=>new Array(n?.y??1));return bo(t,r).filter(wh).forEach(({id:s,state:{position:i}})=>{const a=Kt(i,e),l={x:Math.floor(a.x/K.w),y:Math.floor(a.y/K.d)};l.x<0||l.x>=(n?.x??1)||l.y<0||l.y>=(n?.y??1)||(o[l.x][l.y]=s)}),o},xT=(t,e)=>{let n=0,r=1;for(const o of e)for(const s of o)s!==void 0&&t.items[s]?.state.activated&&(n|=r),r<<=1;return n},_T=({renderContext:{item:t,room:e},currentRendering:n})=>{const{config:{times:r}}=t,o=n===void 0?bT(t,e):n.renderProps.chargePositions,s=xT(e,o);return s!==n?.renderProps.cybermanActivationBitmask?{output:V({textureIdCallback(a,l){const c=o[a][l];return c===void 0||e.items[c]?.state.everActivated?"toaster.off":"toaster.on"},times:r??de}),renderProps:{chargePositions:o,cybermanActivationBitmask:s}}:"no-update"},CT={head:Ji,heels:Ji,headOverHeels:Ji,doorFrame:OP,doorLegs:RP,monster:YP,floatingText:tT,barrier:Ie(({renderContext:{item:{config:{axis:t,times:e}}}})=>V({textureId:`barrier.${t}`,times:e})),deadlyBlock:Ie(({renderContext:{item:{config:t},room:e}})=>{switch(t.style){case"volcano":return V({animationId:"volcano",filter:gt(e),times:t.times,randomiseStartFrame:!0});case"toaster":throw new Error("use the special toaster appearance instead");default:throw t.style,new Error("unknown deadly block style")}}),spikes:zt("spikes"),slidingDeadly:pT,slidingBlock:Ie(({renderContext:{item:{config:{style:t}},room:e}})=>V(t==="book"?{textureId:"book.y",filter:ug(e)}:t)),block:wT,switch:yT,conveyor:aT,lift:Ie(({renderContext:{general:{paused:t}}})=>{const e=new re,n={x:sc.w/2,y:sc.h};return e.addChild(V({animationId:"lift",pivot:n,paused:t})),e.addChild(V({textureId:"lift.static",pivot:n})),e}),teleporter:lT,sceneryCrown:Ie(({renderContext:{item:{config:{planet:t}}}})=>V({textureId:`crown.${t}`})),pickup:Ie(({renderContext:{item:{config:t},room:e,general:{paused:n}}})=>{if(t.gives==="crown")return V({textureId:`crown.${t.planet}`});const o={shield:"whiteRabbit",jumps:"whiteRabbit",fast:"whiteRabbit","extra-life":"whiteRabbit",bag:"bag",doughnuts:"doughnuts",hooter:"hooter",scroll:{textureId:"scroll",filter:gt(e)},reincarnation:{animationId:"fish",paused:n}}[t.gives];return V(o)}),moveableDeadly:zt("fish.1"),charles:cT,joystick:zt("joystick"),movingPlatform:zt("sandwich"),pushableBlock:zt("stepStool"),portableBlock:Ie(({renderContext:{item:{config:{style:t}}}})=>V(t)),spring:dT,sceneryPlayer:hT,hushPuppy:zt("hushPuppy"),bubbles:Ie(({renderContext:{item:{config:{style:t}},general:{paused:e}}})=>V({animationId:`bubbles.${t}`,paused:e})),firedDoughnut:zt({animationId:"bubbles.doughnut"}),ball:zt("ball"),floor:GP,particle:Ie(({renderContext:{item:{config:{forCharacter:t}}}})=>V({animationId:"particle.fade",anchor:{x:.5,y:.5},filter:t==="heels"?hg:an}))},ST=t=>{if(t.type==="wall"){const{direction:e}=t.config;return e==="right"||e==="towards"?void 0:gT}return t.type==="deadlyBlock"&&t.config.style==="toaster"?_T:CT[t.type]},kT=$.moss,ET=()=>new yt({outlineColor:kT,lowRes:!1,upscale:tn(U.getState())});class PT{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output)}output=new re({label:"PortableItemPickUpNextHighlightRenderer"});#e=!1;tick(e){const{wouldPickUpNext:n}=this.renderContext.item.state;n!==!this.#e&&(this.output.filters=n?[ET()]:an),this.#e=n,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const TT=(t,e,n)=>dv(t)?new PT(e,n):n,AT=$.pastelBlue,RT=$.highlightBeige,OT=$.midRed,IT=$.white,Id=new yt({outlineColor:RT,upscale:tn(U.getState()),lowRes:!1}),jd=new yt({outlineColor:OT,upscale:tn(U.getState()),lowRes:!1}),jT=new yt({outlineColor:IT,upscale:tn(U.getState()),lowRes:!1}),$d=new Ue(AT),Nd={left:"↖",away:"↗",right:"↘",towards:"↙"},Md=(t,e)=>{switch(t){case"back-forth":switch(e){case"left":return"↖↘";case"right":return"↘↖";case"away":return"↗↙";case"towards":return"↙↗";default:throw new Error("Unexpected startDirection")}case"clockwise":switch(e){case"left":return"↖↗↘↙";case"right":return"↘↙↖↘";case"away":return"↗↘↙↖";case"towards":return"↙↖↗↘";default:throw new Error("Unexpected startDirection")}case"towards-analogue":return"➡.⬅"}return""};class $T{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output),this.#e()}output=new re({label:"EditorAnnotationsRenderer"});#e(){const e=this.renderContext.item;switch(e.type){case"pickup":if(e.config.gives==="shield"||e.config.gives==="extra-life"||e.config.gives==="jumps"||e.config.gives==="fast"){const n={shield:"🛡",jumps:"♨",fast:"⚡","extra-life":"+2"};this.#t({annotationText:n[e.config.gives],yAdj:-16})}break;case"doorFrame":if(e.config.part==="near"){const{rooms:n}=U.getState().levelEditor.campaignInProgress,{config:{toRoom:r,direction:o}}=e,s=!!n[r],i=r.toUpperCase(),a=Nd[o],l=o==="away"||o==="right"?`${i}${a}`:`${a}${i}`;this.#t({annotationText:l,yAdj:o==="left"||o==="away"?-48:0,error:!s,clickDispatch:s?()=>ua(r):void 0})}break;case"teleporter":{const{rooms:n}=U.getState().levelEditor.campaignInProgress,{config:{toRoom:r}}=e,o=!!n[r];this.#t({annotationText:`➡${r.toUpperCase()}`,yAdj:-12,error:!o,clickDispatch:o?()=>ua(r):void 0})}break;case"conveyor":{const{config:{direction:n}}=e,r=Nd[n];this.#t({annotationText:r,yAdj:-12})}break;case"movingPlatform":{const{config:{movement:n,startDirection:r}}=e;this.#t({annotationText:Md(n,r),yAdj:-12})}break;case"monster":{const{config:n}=e;(n.which==="turtle"||n.which==="skiHead")&&this.#t({annotationText:Md(n.movement,n.startDirection),yAdj:-12})}break}}#t({annotationText:e,yAdj:n=0,error:r=!1,clickDispatch:o}){const{renderContext:{frontLayer:s}}=this,i=new Ue(r?$.midRed:$.white),a=fg(new re({label:"EditorAnnotationTextContainer",filters:[i,new yt({lowRes:!0,outlineColor:$.pureBlack,upscale:tn(U.getState())})]}),e);a.y=n,o!==void 0&&(a.eventMode="static",a.on("click",()=>{U.dispatch(o())}),a.on("mouseover",()=>{U.getState().levelEditor.tool.type==="pointer"&&(U.dispatch(cc(!0)),i.targetColor=$.pastelBlue)}),a.on("mouseout",()=>{U.dispatch(cc(!1)),i.targetColor=$.white}),a.cursor="pointer"),this.output.addChild(a),s.attach(a)}tick(e){this.#n(),this.childRenderer.tick(e)}#n(){const{renderContext:{item:e,room:n}}=this,{clickableAnnotationHovered:r}=U.getState().levelEditor,{jsonItemId:o}=e,s=U.getState(),i=bh(s),a=hv(s),l=gn(s),c=o&&i?.jsonItemId===o&&!r,u=o&&a.includes(o),d=()=>o!==void 0&&($e(n.items).some(h=>h.jsonItemId===i?.jsonItemId&&h.type==="switch"&&h.config.type==="in-room"&&h.config.modifies.some(p=>p.targets.includes(o)))||e.type==="switch"&&$e(n.items).some(({jsonItemId:h})=>h!==void 0&&h===i?.jsonItemId&&e.config.type==="in-room"&&e.config.modifies.some(p=>p.targets.includes(h)))||e.type==="charles"&&$e(n.items).some(h=>h.jsonItemId===i?.jsonItemId&&h.type==="joystick"&&h.config.controls.some(p=>p===o))||e.type==="joystick"&&e.config.controls.some(h=>i?.jsonItemId===h));this.output.filters=c&&u?[$d,l.type==="eyeDropper"?jd:Id]:c?l.type==="eyeDropper"?jd:Id:u?$d:d()?jT:an}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const NT=(t,e,n)=>e.general.editor?new $T(e,n):n,MT=(t,e)=>{e!==void 0&&U.getState().gameMenus.cheatsOn&&(e.eventMode="static",e.on("pointertap",()=>{U.dispatch(_y({item:t,pixiContainer:e}))}))},zT=t=>{const e=U.getState(),n=by(e),r=!xy(e),{item:o}=t,s=n==="all"||n==="non-wall"&&t.item.type!=="wall",i=[],a=ST(o);let l;if(a!==void 0){l=new og(t,a);const p=new PP(t,l);i.push(NT(o,t,TT(o,t,p)))}if(r){const p=LE(t);p!==void 0&&i.push(p)}s&&i.push(new kE(t));let c;if(i.length===0)c=void 0;else{const p=i.length===1?i[0]:new DT(i,t);c=new AE(t,p),MT(o,c.output)}const u=t.general.soundSettings.mute??al.soundSettings.mute,d=t.general.paused||u?void 0:oP(t),h=d===void 0?void 0:new cP(t,d);return{top:new BE(t,{graphics:c,sound:h}),itemAppearanceRenderer:l}};class DT{constructor(e,n){this.renderContext=n,this.#e=e,this.#t.addChild(...e.map(r=>r.output))}#e;#t=new re({label:"CompositeRenderer"});tick(e){for(const n of this.#e)n.tick(e)}destroy(){for(const e of this.#e)e.destroy()}get output(){return this.#t}}const LT=ho("wall","doorFrame"),zd=256;function*BT(t){const{left:e,right:n}=$e(t.items).filter(LT).reduce((r,{aabb:o,renderAabb:s,renderAabbOffset:i,state:{position:a}})=>{const l=s??o,c=B(a,i??ue),u=q(B(c,{x:l.x})).x,d=q(B(c,{y:l.y})).x;return{left:Math.min(r.left,u),right:Math.max(r.right,d)}},{left:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY});e!==Number.POSITIVE_INFINITY&&(yield new ht().rect(e-100,-256,100,zd).fill(0)),n!==Number.NEGATIVE_INFINITY&&(yield new ht().rect(n,-256,100,zd).fill(0))}class FT{constructor(e){this.renderContext=e;const{general:{colourised:n,soundSettings:r},room:o}=e;this.initFilters(n,e.room.color);const i=r.mute??al.soundSettings.mute?void 0:ce.createGain();Js(BT(o),this.#o),this.output={sound:i,graphics:new re({label:`RoomRenderer(${e.room.id})`})},this.output.graphics.addChild(this.#t),n||(this.#n=new jc({sortableChildren:!1}),this.output.graphics.addChild(this.#n)),this.output.graphics.addChild(this.#o),this.output.graphics.addChild(this.#r)}#e=!1;#t=new re({label:"items"});#n;#r=new jc({sortableChildren:!1});#o=new re({label:"occlusion"});output;#s=void 0;#a=new Map;#i=new Map;initFilters(e,n){this.#t.filters=e?n.shade==="dimmed"?CP:an:new Ue(n.shade==="dimmed"?mm(vs(n).main.original):vs(n).main.original)}#c=e=>this.#i.get(e);#l(e,n){let r=this.#i.get(n.id);if(r===void 0){r=zT({...this.renderContext,colourClashLayer:this.#n,frontLayer:this.#r,item:n,zEdges:this.#a,getItemRenderPipeline:this.#c}),this.#i.set(n.id,r);const{graphics:o,sound:s}=r.top.output;if(o&&(this.#t.addChild(o),n.fixedZIndex&&(o.zIndex=n.fixedZIndex)),s){if(!this.output.sound)throw new Error("item renderer has sound, but room renderer does not - this probably means that they disagree on if the user has sound muted");s.connect(this.output.sound)}}try{r.top.tick(e)}catch(o){throw new Error(`RoomRenderer: error while ticking item "${n.id}"
in room "${this.renderContext.room.id}"
item in play object is:
           
${JSON.stringify(n,null,2)}`,{cause:o})}}#d(e){const{room:n}=this.renderContext,r={...e,lastRenderRoomTime:this.#s},o=new Set,s=a=>{if(o.has(a))return;const l=this.#a.get(a);if(l)for(const[c,u]of l.entries())u&&s(c);this.#l(r,n.items[a]),o.add(a)};for(const a in n.items)s(a);let i=!1;for(const[a,l]of this.#i.entries())n.items[a]===void 0&&(l.top.destroy(),this.#i.delete(a),i=!0);i&&this.#h()}#h(){if(this.#n)for(const e of this.#n.renderLayerChildren)e.parent===null&&this.#n.detach(e);for(const e of this.#r.renderLayerChildren)e.parent===null&&this.#r.detach(e)}#f(e){for(let n=0;n<e.length;n++){const r=this.#i.get(e[n]);if(r===void 0)throw new Error(`Item id=${e[n]} does not have a renderer - cannot assign a z-index`);const o=r.top.output.graphics;if(!o)throw new Error(`order ${e[n]} was given a z-order by sorting, but item has no graphics`);o.zIndex=n}}get#u(){return this.#s!==void 0}tick(e){const n=this.#u?e:{...e,movedItems:new Set($e(this.renderContext.room.items))};ng(this.renderContext.room.items,n.movedItems,this.#a);const r=rg(this.#a);this.#d(n),(!this.#u||n.movedItems.size>0)&&this.#f(r),this.#s=this.renderContext.room.roomTime}destroy(){this.output.graphics.label=this.output.graphics.label+"DESTROYED",this.output.graphics.destroy({children:!0}),this.output.sound?.disconnect(),this.#i.forEach(e=>{e.top.destroy()}),this.#e=!0}get destroyed(){return this.#e}}const UT=t=>{t.ticker.remove(t.render,t)},pg=m.createContext(null),HT=({children:t})=>{const[e,n]=m.useState(null);return m.useEffect(()=>{const r=new Lh;return r.init({background:$.pureBlack,sharedTicker:!0}).then(()=>{UT(r),n(r)}),()=>{}},[]),e===null?null:f.jsx(pg,{value:e,children:t})},$n=()=>m.useContext(pg),WT=(t,e)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:e},soundSettings:{mute:!0},pixiRenderer:t,gameState:void 0,paused:!1,colourised:!0,upscale:cl(U.getState()),editor:!0}),Dd=(t,e,n)=>new FT({room:t,general:WT(e,n)}),GT=()=>{const{renderer:t}=$n(),e=sh();if(!t)throw new Error("this should never be falsey (typescript violation)");const n=Jm(),[r,o]=m.useState(()=>Dd(n,t,e));return m.useEffect(()=>{const s=Dd(n,t,e);return o(s),()=>{s.destroy()}},[n,t,e]),r},Ld=(t,e,n)=>{const{world:{onItem:{face:r},position:o,itemId:s}}=t;if(r.z>ch)return ss(o);if(n.type==="door"){const i=e.items[s];if(i.type!=="wall")return;const{config:a,aabb:l,state:{position:c}}=i,u=fv(ul(a)),d=Er(Xt(a.direction)),h=Xt(a.direction);if(u[d]<2)return;const p=c[d],g=c[d]+l[d]-M1,y=c.z,v=c.z+l.z-Gr,w={[d]:Math.max(Math.min(o[d],g),p),[h]:o[h],z:Math.max(Math.min(o.z,v),y)};return ss(w)}return B(ss(o),r)},qT={z:1,x:0,y:0},VT={z:0,x:0,y:-1},Bd={z:0,x:-1,y:0},KT=(t,{x:e,y:n},r)=>{if(r.type==="item"&&r.item.type==="door"&&t.type==="wall"){const l=t.config.direction;return Es(Ee[l],-1)}const{bottomCentre:o,topLeft:s,topRight:i}=_r(t.state.position,t.aabb);return n<s.y-(s.x-e)/2?n<i.y-(e-i.x)/2?qT:Bd:e<o.x?VT:Bd},XT=3,JT=(t,{x:e,y:n},r)=>{const o=_r(t.state.position,t.aabb);return Cy.find(s=>{const i=o.projectCorner(s);return ll(Kt(i,{x:e,y:n}))<XT})},Xn=3,Yi=1.5;function xt({x:t,y:e},n,r){const o={x:t-n.x,y:e-n.y},s=o.x*r.y-o.y*r.x;return Math.abs(s)/Sy(Math.hypot(r.x,r.y))}const mg={point:{x:-1,y:-1,z:0},normal:{x:0,y:0,z:1}},gg={point:{x:-1,y:0,z:1},normal:{x:0,y:1,z:0}},yg={point:{x:0,y:-1,z:1},normal:{x:1,y:0,z:0}},vg={point:{x:0,y:1,z:1},normal:{x:1,y:0,z:0}},wg={point:{x:1,y:0,z:1},normal:{x:0,y:1,z:0}},bg={point:{x:1,y:-1,z:0},normal:{x:0,y:0,z:1}},xg={point:{x:0,y:-1,z:-1},normal:{x:1,y:0,z:0}},_g={point:{x:-1,y:1,z:0},normal:{x:0,y:0,z:1}},Cg={point:{x:-1,y:0,z:-1},normal:{x:0,y:1,z:0}},YT=(t,e,n,r)=>{const o=_r(t.state.position,t.aabb),s=n.x<0,i=n.y<0,a=n.z>0;if((s||i)&&xt(e,o.bottomCentre,{x:0,y:-1})<Yi)return mg;if((s||a)&&xt(e,o.topRight,{x:2,y:-1})<Yi)return gg;if((i||a)&&xt(e,o.topLeft,{x:2,y:1})<Yi)return yg;switch(!0){case a:{const l=o.c111;if(xt(e,l,{x:2,y:1})<Xn)return vg;if(xt(e,l,{x:-2,y:1})<Xn)return wg;break}case i:{const l=o.c100;if(xt(e,l,{x:0,y:-1})<Xn)return bg;if(xt(e,l,{x:2,y:1})<Xn)return xg;break}case s:{const l=o.c010;if(xt(e,l,{x:0,y:-1})<Xn)return _g;if(xt(e,l,{x:-2,y:1})<Xn)return Cg;break}}},Fd=(t,e,n)=>n?{position:t.state.position,aabb:t.aabb}:{position:B(t.state.position,t.renderAabbOffset??ue),aabb:t.renderAabb??t.aabb},Ud=({x:t,y:e},n,r)=>{const{bottomCentre:o,topLeft:s,topRight:i}=_r(n,r);return!(t<s.x||t>i.x||e<i.y-(i.x-t)/2||e<s.y-(t-s.x)/2||e>o.y-(t-o.x)/2||e>o.y-(o.x-t)/2)},ZT=(t,e,n)=>{const{position:r,aabb:o}=Fd(n,e,!1);if(Ud(t,r,o))return"intersects-rendered";if(e.type==="item"&&n.type==="wall"){const{position:i,aabb:a}=Fd(n,e,!0);if(Ud(t,i,a))return"intersects-unrendered"}return"non-intersecting"},Hd=t=>t.fixedZIndex!==void 0,QT=t=>{const n=t.some(([,a])=>a==="intersects-rendered")?t.filter(([,a])=>a==="intersects-rendered").map(([a])=>a):t.map(([a])=>a);if(n.every(Hd))return n.toSorted((a,l)=>l.fixedZIndex-a.fixedZIndex).at(0);const r=n.filter(a=>!Hd(a));if(r.length===0)return;if(r.length===1)return r[0];const o=Object.fromEntries(r.map(a=>[a.id,a])),s=ng(o),i=rg(s);return o[i.at(-1)]},Sg=(t,e,n,r)=>{const o=n.type==="item"&&n.item.type==="door"?1:r,s=K.w*o,i=K.h,a=o===1?0:K.w/2,l=i/2,c=lh(e);return{x:c==="yz"?Math.round(t.x/s)*s:Math.floor((t.x-a)/s)*s,y:c==="xz"?Math.round(t.y/s)*s:Math.floor((t.y-a)/s)*s,z:c==="xy"?Math.round(t.z/i)*i:Math.floor((t.z+l)/i)*i}},eA=({state:{position:t},aabb:e},n,r,o,s)=>{const i={x:t.x+(n.x<0?0:e.x),y:t.y+(n.y<0?0:e.y),z:t.z+(n.z<0?0:e.z)},a=P1(i,n,r);return Sg(a,n,o,s)},tA=t=>e=>{const n=pr(e);return t.type==="item"&&t.item.type==="door"?n&&e.type==="wall":n},Zi=(t,e,n,r)=>{const o=$e(e.items).filter(tA(n)).map(a=>[a,ZT(t,n,a)]).filter(a=>a[1]!=="non-intersecting"),s=QT(Array.from(o)),i=e.id;if(s){const a=KT(s,t,n);if(!(a.z>0&&!Object.isExtensible(s.state.stoodOnBy)))return{roomId:i,scrXy:t,world:{itemId:s.id,onItem:{face:a,corner:JT(s,t),edge:YT(s,t,a)},position:eA(s,a,t,n,r)}}}return{roomId:i,scrXy:t,world:void 0}},nA=(t,e=console.error)=>(...n)=>{try{return t(...n)}catch(r){e(r);return}},rA=t=>_h(e=>e>0?e:e>-1?1:-e+1,t),oA=({jsonItem:t,blockDragAccVec:e,resizeEdgeDirection:n})=>{const r=t.position,o=ca(t),s=us(e,n,xh(t)),i=B(o,s),a=rA(i),l=_h((c,u,d,h,p)=>{const g=u<1;return c<0!==g?g?d-p+1:d+h-p:g?d+h-1:d},n,i,r,o,a);return{timesDelta:hr(a,o),positionDelta:hr(l,r)}},Qi=(t,e)=>{const n=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const r=e.target.getBoundingClientRect(),o=e.clientX-r.left,s=e.clientY-r.top;return{x:o/n-t.gameEngineScreenSize.x/2,y:s/n-t.gameEngineScreenSize.y+16}},sA=(t,e)=>{const n=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const r=e.movementX,o=e.movementY;return{x:r/n,y:o/n}},iA=5,aA=(t,e,n)=>{const r=t.world?.onItem.edge,o=us(...vt(n).map(i=>xh(i))),s=us(r?.point??ue,o);return Ps(s)>0?r.normal:e?{x:1,y:0,z:0}:{x:0,y:0,z:1}},lA=(t,e,n,r,o,s)=>{if(t===void 0)return;const i=Kt(e,t.scrXy),a=ll(i);if(!(o||a>iA))return;const c=aA(t,r,s),u=Wm(c,n);return r?{x:0,y:0,z:u.z}:u},Wd=(t,e=!1)=>{const n=U.getState().levelEditor;return Sg(t,{x:0,y:0,z:1},n.tool,e?1:n.gridResolution)},Xo=({levelEditor:t},e,n)=>{const r=e.items[n]?.jsonItemId;if(r===void 0)return;const o=Sh(t,r);if(o!==void 0)return[r,o]},is=(t,...e)=>t.levelEditor.wallsFloorsLocked&&e.some(n=>n.type==="wall"||n.type==="floor"),ea=(t,e)=>{const n=U.getState();let r;if(e.world){const o=e.world.itemId,s=o&&t.items[o],i=is(n,s)?void 0:s.jsonItemId;r=i===void 0?void 0:{jsonItemId:i,pointingAtOnItem:e.world.onItem}}else r=void 0;Ge(bh(n),r)||U.dispatch(Ch(r))},cA=(t,e,n)=>{const r=n?.world?.itemId;if(r===void 0)return ds;const o=e.items[r].jsonItemId;if(o===void 0)return ds;const{selectedJsonItemIds:s}=t.levelEditor;return s.includes(o)?s:[o]},uA=t=>{const e=$n(),n=Rn(cl),r=He(),o=Xm(),s=m.useRef(void 0),i=m.useRef(void 0),a=m.useRef(void 0);m.useEffect(()=>{if(t===null)return;const l=p=>{const g=Qi(n,p),y=sA(n,p),v=U.getState(),w=gn(v),_=Zi(g,o,w,v.levelEditor.gridResolution),b=!Ge(_.world,s.current?.world);switch(w.type){case"item":{if(!b||(r(da()),_.world===void 0))break;const x=Xo(v,o,_.world.itemId);if(x===void 0)break;const[,S]=x,k=Ld(_,o,w.item);if(k===void 0||aE({roomState:o,blockPosition:k,itemTool:w.item}))break;r(uc({blockPosition:k,pointedAtItemJson:S,preview:!0}));break}case"pointer":{const x=cA(v,o,i.current);if(x.length===0){ea(o,_);break}const S=x.map(Z=>gv(v,Z));if(is(v,...S))break;const C=_.roomId===i.current?.roomId?lA(i.current,g,y,p.metaKey||p.shiftKey,a.current!==void 0,S):void 0;if(!C){ea(o,_);break}x.length===1&&!yv(v,x[0])&&U.dispatch(si({jsonItemIds:x}));const N=i.current?.world?.onItem.edge,H=N&&S.every(Z=>kh(Z)),L=a.current??ue,X=B(L,C),I=Wd(X,H);if(a.current=X,il(Wd(L,H),I))break;const ee=ss(I);let D,J;if(H){const[,Z]=Xo(v,o,i.current.world.itemId);({timesDelta:J,positionDelta:D}=oA({jsonItem:Z,blockDragAccVec:ee,resizeEdgeDirection:N.point}))}else D=ee;if(Zm({roomState:o,jsonItemIds:x,blockPositionDelta:D,timesDelta:J}))break;r(mh({jsonItemIds:x,positionDelta:D,timesDelta:J}));break}case"eyeDropper":ea(o,_);break}s.current=_},c=p=>{const g=U.getState();if(o.id!==g.levelEditor.currentlyEditingRoomId)return;const y=Qi(n,p),v=gn(U.getState()),w=Zi(y,o,v,g.levelEditor.gridResolution),_=a.current!==void 0,b=!_&&w.roomId===i.current?.roomId&&w.world?.itemId===i.current?.world?.itemId;if(a.current=void 0,i.current=void 0,U.dispatch(pv(!1)),!b&&!_){console.log("mouseUp - not a click or drag end - skipping");return}switch(v.type){case"item":{if(w.world===void 0){r(wn({type:"pointer"}));break}const x=Xo(g,o,w.world.itemId);if(x===void 0)break;const[,S]=x;r(uc({blockPosition:Ld(w,o,v.item),pointedAtItemJson:S,preview:!1}));break}case"pointer":{if(b){const x=w.world===void 0?void 0:o.items[w.world.itemId];if(x?.jsonItemId===void 0||is(g,x)){r(si({jsonItemIds:[]}));break}r(p.ctrlKey||p.metaKey?mv({jsonItemId:x.jsonItemId}):si({jsonItemIds:[x.jsonItemId]}))}else _&&r(gh());break}case"eyeDropper":{if(b){const x=w.world?.itemId;if(x===void 0){console.warn("no itemId");break}const S=o.items[x];if(is(g,S))break;const k=Xo(g,o,x);if(k===void 0)break;const[,C]=k;r(wn({type:"item",item:{type:C.type,config:C.config}}))}break}}},u=p=>{const g=gn(U.getState());switch(a.current=void 0,i.current=void 0,g.type){case"item":{r(da());break}case"pointer":{r(Ch(void 0));break}}},d=p=>{const g=Qi(n,p),y=U.getState(),v=gn(y),w=Zi(g,o,v,y.levelEditor.gridResolution);console.log("setting mouseDownPointingAtRef to",w),i.current=w},h=nA(l);return t.addEventListener("mousemove",h),t.addEventListener("mouseup",c),t.addEventListener("mousedown",d),t.addEventListener("mouseleave",u),t.tabIndex=0,()=>{t.removeEventListener("mousemove",h),t.removeEventListener("mouseup",c),t.removeEventListener("mousedown",d),t.removeEventListener("mouseleave",u)}},[e.stage,n,t,r,o])},dA=()=>{const{cssUpscale:t,canvasSize:e,rotate90:n}=Rn(cl);return{transform:n?`scale(${t}) rotate(90deg) translate(0, -${e.y}px)`:`scale(${t})`,width:e.x,height:e.y,transformOrigin:"top left"}},hA=t=>{const e=Jm(),n=$n();m.useEffect(()=>{let r=0;const o=({deltaMS:s})=>{if(t.destroyed)return;t.renderContext.room!==e&&console.warn("room renderer does not have the current room");const i=new Set(cs(e.items));e.roomTime+=s,t.tick({deltaMS:s,movedItems:i,progression:r++}),n.render()};return tr.shared.add(o),()=>{tr.shared.remove(o)}},[t,e,n])},fA=t=>{const e=$n();m.useEffect(()=>{if(t)return t.appendChild(e.canvas),()=>{t.removeChild(e.canvas)}},[t,e])},pA=()=>{const t=$n(),e=Rn(n=>n.upscale.upscale.gameEngineUpscale);t.stage.scale=e},mA=()=>{const t=$n(),e=Rn(ky);m.useEffect(()=>{t.renderer?.resize(e.x,e.y)},[t.renderer,e])},gA=t=>{const e=$n(),[n]=m.useState(()=>new re),r=Rn(Ey);m.useEffect(()=>{if(t.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return n.addChild(t.output.graphics),e.stage.addChild(n),()=>{e.stage.removeChild(n),n.removeChild(t.output.graphics)}},[t,e,n]),m.useEffect(()=>{n.x=r.x/2,n.y=r.y-16},[n,r])},Gd=(t,e)=>{U.dispatch(Py(Ty(t??Ay(U.getState()),e)))},yA=(t,e)=>{const n=He();m.useLayoutEffect(()=>{Gd()},[]),m.useLayoutEffect(()=>{const r=()=>Gd(t,e);if(e){const o=new ResizeObserver(r);return o.observe(e),()=>o.disconnect()}else return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[n,e,t])},vA=()=>{m.useEffect(()=>Ry({actionCreator:wn,effect(t,{dispatch:e}){e(da())}}))},wA=({levelEditor:t})=>{const{dragInProgress:e,clickableAnnotationHovered:n,hoveredItem:r,selectedJsonItemIds:o}=t;if(e)return ge("cursor-grabbing");if(n)return ge("cursor-pointer");if(r){const s=Sh(t,r.jsonItemId);if(s!==void 0&&kh(s))if(r.pointingAtOnItem.corner){if(il(r.pointingAtOnItem.corner,{x:1,y:1,z:1}))return ge("cursor-n-resize")}else{const{edge:i}=r.pointingAtOnItem;if(i){if(Ge(i,_g))return ge("cursor-e-resize");if(Ge(i,mg))return ge("cursor-s-resize");if(Ge(i,bg))return ge("cursor-w-resize");if(Ge(i,gg)||Ge(i,vg))return ge("cursor-ne-resize");if(Ge(i,yg)||Ge(i,wg))return ge("cursor-nw-resize");if(Ge(i,Cg))return ge("cursor-se-resize");if(Ge(i,xg))return ge("cursor-sw-resize")}}return o.includes(r.jsonItemId)?ge("cursor-grab"):ge("cursor-default")}return ge("cursor-crosshair")},bA=()=>he(wA);Oy.defaultOptions.scaleMode="nearest";const xA=()=>{const t=GT(),[e,n]=m.useState(null),[r,o]=m.useState(null),s=bA();yA("amigaLowResPal",r??void 0),mA(),gA(t),hA(t),uA(e),fA(e),pA(),vA();const i=dA();return f.jsx("div",{className:`w-full h-full overflow-hidden ${s}`,ref:o,children:f.jsx("div",{style:i,ref:n})})},qd=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,_A=()=>{const t=Iy(),e=Rn(jy);m.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",$y())},[]),m.useEffect(()=>{document.body.classList.remove(...Object.keys(Ny).map(qd)),document.body.classList.add(qd(t)),document.body.classList.toggle("portrait-rot",e)},[t,e])},Qs=m.createContext(null);Qs.displayName="PanelGroupContext";const we={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},Ql=10,vn=m.useLayoutEffect,Vd=ks.useId,CA=typeof Vd=="function"?Vd:()=>null;let SA=0;function ec(t=null){const e=CA(),n=m.useRef(t||e||null);return n.current===null&&(n.current=""+SA++),t??n.current}function kg({children:t,className:e="",collapsedSize:n,collapsible:r,defaultSize:o,forwardedRef:s,id:i,maxSize:a,minSize:l,onCollapse:c,onExpand:u,onResize:d,order:h,style:p,tagName:g="div",...y}){const v=m.useContext(Qs);if(v===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:w,expandPanel:_,getPanelSize:b,getPanelStyle:x,groupId:S,isPanelCollapsed:k,reevaluatePanelConstraints:C,registerPanel:N,resizePanel:H,unregisterPanel:L}=v,X=ec(i),I=m.useRef({callbacks:{onCollapse:c,onExpand:u,onResize:d},constraints:{collapsedSize:n,collapsible:r,defaultSize:o,maxSize:a,minSize:l},id:X,idIsFromProps:i!==void 0,order:h});m.useRef({didLogMissingDefaultSizeWarning:!1}),vn(()=>{const{callbacks:D,constraints:J}=I.current,Y={...J};I.current.id=X,I.current.idIsFromProps=i!==void 0,I.current.order=h,D.onCollapse=c,D.onExpand=u,D.onResize=d,J.collapsedSize=n,J.collapsible=r,J.defaultSize=o,J.maxSize=a,J.minSize=l,(Y.collapsedSize!==J.collapsedSize||Y.collapsible!==J.collapsible||Y.maxSize!==J.maxSize||Y.minSize!==J.minSize)&&C(I.current,Y)}),vn(()=>{const D=I.current;return N(D),()=>{L(D)}},[h,X,N,L]),m.useImperativeHandle(s,()=>({collapse:()=>{w(I.current)},expand:D=>{_(I.current,D)},getId(){return X},getSize(){return b(I.current)},isCollapsed(){return k(I.current)},isExpanded(){return!k(I.current)},resize:D=>{H(I.current,D)}}),[w,_,b,k,X,H]);const ee=x(I.current,o);return m.createElement(g,{...y,children:t,className:e,id:X,style:{...ee,...p},[we.groupId]:S,[we.panel]:"",[we.panelCollapsible]:r||void 0,[we.panelId]:X,[we.panelSize]:parseFloat(""+ee.flexGrow).toFixed(1)})}const as=m.forwardRef((t,e)=>m.createElement(kg,{...t,forwardedRef:e}));kg.displayName="Panel";as.displayName="forwardRef(Panel)";let Za=null,ls=-1,Ht=null;function kA(t,e){if(e){const n=(e&Rg)!==0,r=(e&Og)!==0,o=(e&Ig)!==0,s=(e&jg)!==0;if(n)return o?"se-resize":s?"ne-resize":"e-resize";if(r)return o?"sw-resize":s?"nw-resize":"w-resize";if(o)return"s-resize";if(s)return"n-resize"}switch(t){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function EA(){Ht!==null&&(document.head.removeChild(Ht),Za=null,Ht=null,ls=-1)}function ta(t,e){var n,r;const o=kA(t,e);if(Za!==o){if(Za=o,Ht===null&&(Ht=document.createElement("style"),document.head.appendChild(Ht)),ls>=0){var s;(s=Ht.sheet)===null||s===void 0||s.removeRule(ls)}ls=(n=(r=Ht.sheet)===null||r===void 0?void 0:r.insertRule(`*{cursor: ${o} !important;}`))!==null&&n!==void 0?n:-1}}function Eg(t){return t.type==="keydown"}function Pg(t){return t.type.startsWith("pointer")}function Tg(t){return t.type.startsWith("mouse")}function ei(t){if(Pg(t)){if(t.isPrimary)return{x:t.clientX,y:t.clientY}}else if(Tg(t))return{x:t.clientX,y:t.clientY};return{x:1/0,y:1/0}}function PA(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function TA(t,e,n){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function AA(t,e){if(t===e)throw new Error("Cannot compare node with itself");const n={a:Jd(t),b:Jd(e)};let r;for(;n.a.at(-1)===n.b.at(-1);)t=n.a.pop(),e=n.b.pop(),r=t;ne(r,"Stacking order can only be calculated for elements with a common ancestor");const o={a:Xd(Kd(n.a)),b:Xd(Kd(n.b))};if(o.a===o.b){const s=r.childNodes,i={a:n.a.at(-1),b:n.b.at(-1)};let a=s.length;for(;a--;){const l=s[a];if(l===i.a)return 1;if(l===i.b)return-1}}return Math.sign(o.a-o.b)}const RA=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function OA(t){var e;const n=getComputedStyle((e=Ag(t))!==null&&e!==void 0?e:t).display;return n==="flex"||n==="inline-flex"}function IA(t){const e=getComputedStyle(t);return!!(e.position==="fixed"||e.zIndex!=="auto"&&(e.position!=="static"||OA(t))||+e.opacity<1||"transform"in e&&e.transform!=="none"||"webkitTransform"in e&&e.webkitTransform!=="none"||"mixBlendMode"in e&&e.mixBlendMode!=="normal"||"filter"in e&&e.filter!=="none"||"webkitFilter"in e&&e.webkitFilter!=="none"||"isolation"in e&&e.isolation==="isolate"||RA.test(e.willChange)||e.webkitOverflowScrolling==="touch")}function Kd(t){let e=t.length;for(;e--;){const n=t[e];if(ne(n,"Missing node"),IA(n))return n}return null}function Xd(t){return t&&Number(getComputedStyle(t).zIndex)||0}function Jd(t){const e=[];for(;t;)e.push(t),t=Ag(t);return e}function Ag(t){const{parentNode:e}=t;return e&&e instanceof ShadowRoot?e.host:e}const Rg=1,Og=2,Ig=4,jg=8,jA=PA()==="coarse";let ot=[],dr=!1,Wt=new Map,ti=new Map;const lo=new Set;function $A(t,e,n,r,o){var s;const{ownerDocument:i}=e,a={direction:n,element:e,hitAreaMargins:r,setResizeHandlerState:o},l=(s=Wt.get(i))!==null&&s!==void 0?s:0;return Wt.set(i,l+1),lo.add(a),Cs(),function(){var u;ti.delete(t),lo.delete(a);const d=(u=Wt.get(i))!==null&&u!==void 0?u:1;if(Wt.set(i,d-1),Cs(),d===1&&Wt.delete(i),ot.includes(a)){const h=ot.indexOf(a);h>=0&&ot.splice(h,1),nc(),o("up",!0,null)}}}function NA(t){const{target:e}=t,{x:n,y:r}=ei(t);dr=!0,tc({target:e,x:n,y:r}),Cs(),ot.length>0&&(Ss("down",t),t.preventDefault(),$g(e)||t.stopImmediatePropagation())}function na(t){const{x:e,y:n}=ei(t);if(dr&&t.buttons===0&&(dr=!1,Ss("up",t)),!dr){const{target:r}=t;tc({target:r,x:e,y:n})}Ss("move",t),nc(),ot.length>0&&t.preventDefault()}function ra(t){const{target:e}=t,{x:n,y:r}=ei(t);ti.clear(),dr=!1,ot.length>0&&(t.preventDefault(),$g(e)||t.stopImmediatePropagation()),Ss("up",t),tc({target:e,x:n,y:r}),nc(),Cs()}function $g(t){let e=t;for(;e;){if(e.hasAttribute(we.resizeHandle))return!0;e=e.parentElement}return!1}function tc({target:t,x:e,y:n}){ot.splice(0);let r=null;(t instanceof HTMLElement||t instanceof SVGElement)&&(r=t),lo.forEach(o=>{const{element:s,hitAreaMargins:i}=o,a=s.getBoundingClientRect(),{bottom:l,left:c,right:u,top:d}=a,h=jA?i.coarse:i.fine;if(e>=c-h&&e<=u+h&&n>=d-h&&n<=l+h){if(r!==null&&document.contains(r)&&s!==r&&!s.contains(r)&&!r.contains(s)&&AA(r,s)>0){let g=r,y=!1;for(;g&&!g.contains(s);){if(TA(g.getBoundingClientRect(),a)){y=!0;break}g=g.parentElement}if(y)return}ot.push(o)}})}function oa(t,e){ti.set(t,e)}function nc(){let t=!1,e=!1;ot.forEach(r=>{const{direction:o}=r;o==="horizontal"?t=!0:e=!0});let n=0;ti.forEach(r=>{n|=r}),t&&e?ta("intersection",n):t?ta("horizontal",n):e?ta("vertical",n):EA()}let sa;function Cs(){var t;(t=sa)===null||t===void 0||t.abort(),sa=new AbortController;const e={capture:!0,signal:sa.signal};lo.size&&(dr?(ot.length>0&&Wt.forEach((n,r)=>{const{body:o}=r;n>0&&(o.addEventListener("contextmenu",ra,e),o.addEventListener("pointerleave",na,e),o.addEventListener("pointermove",na,e))}),Wt.forEach((n,r)=>{const{body:o}=r;o.addEventListener("pointerup",ra,e),o.addEventListener("pointercancel",ra,e)})):Wt.forEach((n,r)=>{const{body:o}=r;n>0&&(o.addEventListener("pointerdown",NA,e),o.addEventListener("pointermove",na,e))}))}function Ss(t,e){lo.forEach(n=>{const{setResizeHandlerState:r}=n,o=ot.includes(n);r(t,o,e)})}function MA(){const[t,e]=m.useState(0);return m.useCallback(()=>e(n=>n+1),[])}function ne(t,e){if(!t)throw console.error(e),Error(e)}function Pn(t,e,n=Ql){return t.toFixed(n)===e.toFixed(n)?0:t>e?1:-1}function Pt(t,e,n=Ql){return Pn(t,e,n)===0}function qe(t,e,n){return Pn(t,e,n)===0}function zA(t,e,n){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const o=t[r],s=e[r];if(!qe(o,s,n))return!1}return!0}function sr({panelConstraints:t,panelIndex:e,size:n}){const r=t[e];ne(r!=null,`Panel constraints not found for index ${e}`);let{collapsedSize:o=0,collapsible:s,maxSize:i=100,minSize:a=0}=r;if(Pn(n,a)<0)if(s){const l=(o+a)/2;Pn(n,l)<0?n=o:n=a}else n=a;return n=Math.min(i,n),n=parseFloat(n.toFixed(Ql)),n}function Vr({delta:t,initialLayout:e,panelConstraints:n,pivotIndices:r,prevLayout:o,trigger:s}){if(qe(t,0))return e;const i=[...e],[a,l]=r;ne(a!=null,"Invalid first pivot index"),ne(l!=null,"Invalid second pivot index");let c=0;if(s==="keyboard"){{const d=t<0?l:a,h=n[d];ne(h,`Panel constraints not found for index ${d}`);const{collapsedSize:p=0,collapsible:g,minSize:y=0}=h;if(g){const v=e[d];if(ne(v!=null,`Previous layout not found for panel index ${d}`),qe(v,p)){const w=y-v;Pn(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}{const d=t<0?a:l,h=n[d];ne(h,`No panel constraints found for index ${d}`);const{collapsedSize:p=0,collapsible:g,minSize:y=0}=h;if(g){const v=e[d];if(ne(v!=null,`Previous layout not found for panel index ${d}`),qe(v,y)){const w=v-p;Pn(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}}{const d=t<0?1:-1;let h=t<0?l:a,p=0;for(;;){const y=e[h];ne(y!=null,`Previous layout not found for panel index ${h}`);const w=sr({panelConstraints:n,panelIndex:h,size:100})-y;if(p+=w,h+=d,h<0||h>=n.length)break}const g=Math.min(Math.abs(t),Math.abs(p));t=t<0?0-g:g}{let h=t<0?a:l;for(;h>=0&&h<n.length;){const p=Math.abs(t)-Math.abs(c),g=e[h];ne(g!=null,`Previous layout not found for panel index ${h}`);const y=g-p,v=sr({panelConstraints:n,panelIndex:h,size:y});if(!qe(g,v)&&(c+=g-v,i[h]=v,c.toPrecision(3).localeCompare(Math.abs(t).toPrecision(3),void 0,{numeric:!0})>=0))break;t<0?h--:h++}}if(zA(o,i))return o;{const d=t<0?l:a,h=e[d];ne(h!=null,`Previous layout not found for panel index ${d}`);const p=h+c,g=sr({panelConstraints:n,panelIndex:d,size:p});if(i[d]=g,!qe(g,p)){let y=p-g,w=t<0?l:a;for(;w>=0&&w<n.length;){const _=i[w];ne(_!=null,`Previous layout not found for panel index ${w}`);const b=_+y,x=sr({panelConstraints:n,panelIndex:w,size:b});if(qe(_,x)||(y-=x-_,i[w]=x),qe(y,0))break;t>0?w--:w++}}}const u=i.reduce((d,h)=>h+d,0);return qe(u,100)?i:o}function DA({layout:t,panelsArray:e,pivotIndices:n}){let r=0,o=100,s=0,i=0;const a=n[0];ne(a!=null,"No pivot index found"),e.forEach((d,h)=>{const{constraints:p}=d,{maxSize:g=100,minSize:y=0}=p;h===a?(r=y,o=g):(s+=y,i+=g)});const l=Math.min(o,100-s),c=Math.max(r,100-i),u=t[a];return{valueMax:l,valueMin:c,valueNow:u}}function co(t,e=document){return Array.from(e.querySelectorAll(`[${we.resizeHandleId}][data-panel-group-id="${t}"]`))}function Ng(t,e,n=document){const o=co(t,n).findIndex(s=>s.getAttribute(we.resizeHandleId)===e);return o??null}function Mg(t,e,n){const r=Ng(t,e,n);return r!=null?[r,r+1]:[-1,-1]}function LA(t){return t instanceof HTMLElement?!0:typeof t=="object"&&t!==null&&"tagName"in t&&"getAttribute"in t}function zg(t,e=document){if(LA(e)&&e.dataset.panelGroupId==t)return e;const n=e.querySelector(`[data-panel-group][data-panel-group-id="${t}"]`);return n||null}function ni(t,e=document){const n=e.querySelector(`[${we.resizeHandleId}="${t}"]`);return n||null}function BA(t,e,n,r=document){var o,s,i,a;const l=ni(e,r),c=co(t,r),u=l?c.indexOf(l):-1,d=(o=(s=n[u])===null||s===void 0?void 0:s.id)!==null&&o!==void 0?o:null,h=(i=(a=n[u+1])===null||a===void 0?void 0:a.id)!==null&&i!==void 0?i:null;return[d,h]}function FA({committedValuesRef:t,eagerValuesRef:e,groupId:n,layout:r,panelDataArray:o,panelGroupElement:s,setLayout:i}){m.useRef({didWarnAboutMissingResizeHandle:!1}),vn(()=>{if(!s)return;const a=co(n,s);for(let l=0;l<o.length-1;l++){const{valueMax:c,valueMin:u,valueNow:d}=DA({layout:r,panelsArray:o,pivotIndices:[l,l+1]}),h=a[l];if(h!=null){const p=o[l];ne(p,`No panel data found for index "${l}"`),h.setAttribute("aria-controls",p.id),h.setAttribute("aria-valuemax",""+Math.round(c)),h.setAttribute("aria-valuemin",""+Math.round(u)),h.setAttribute("aria-valuenow",d!=null?""+Math.round(d):"")}}return()=>{a.forEach((l,c)=>{l.removeAttribute("aria-controls"),l.removeAttribute("aria-valuemax"),l.removeAttribute("aria-valuemin"),l.removeAttribute("aria-valuenow")})}},[n,r,o,s]),m.useEffect(()=>{if(!s)return;const a=e.current;ne(a,"Eager values not found");const{panelDataArray:l}=a,c=zg(n,s);ne(c!=null,`No group found for id "${n}"`);const u=co(n,s);ne(u,`No resize handles found for group id "${n}"`);const d=u.map(h=>{const p=h.getAttribute(we.resizeHandleId);ne(p,"Resize handle element has no handle id attribute");const[g,y]=BA(n,p,l,s);if(g==null||y==null)return()=>{};const v=w=>{if(!w.defaultPrevented)switch(w.key){case"Enter":{w.preventDefault();const _=l.findIndex(b=>b.id===g);if(_>=0){const b=l[_];ne(b,`No panel data found for index ${_}`);const x=r[_],{collapsedSize:S=0,collapsible:k,minSize:C=0}=b.constraints;if(x!=null&&k){const N=Vr({delta:qe(x,S)?C-S:S-x,initialLayout:r,panelConstraints:l.map(H=>H.constraints),pivotIndices:Mg(n,p,s),prevLayout:r,trigger:"keyboard"});r!==N&&i(N)}}break}}};return h.addEventListener("keydown",v),()=>{h.removeEventListener("keydown",v)}});return()=>{d.forEach(h=>h())}},[s,t,e,n,r,o,i])}function Yd(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Dg(t,e){const n=t==="horizontal",{x:r,y:o}=ei(e);return n?r:o}function UA(t,e,n,r,o){const s=n==="horizontal",i=ni(e,o);ne(i,`No resize handle element found for id "${e}"`);const a=i.getAttribute(we.groupId);ne(a,"Resize handle element has no group id attribute");let{initialCursorPosition:l}=r;const c=Dg(n,t),u=zg(a,o);ne(u,`No group element found for id "${a}"`);const d=u.getBoundingClientRect(),h=s?d.width:d.height;return(c-l)/h*100}function HA(t,e,n,r,o,s){if(Eg(t)){const i=n==="horizontal";let a=0;t.shiftKey?a=100:o!=null?a=o:a=10;let l=0;switch(t.key){case"ArrowDown":l=i?0:a;break;case"ArrowLeft":l=i?-a:0;break;case"ArrowRight":l=i?a:0;break;case"ArrowUp":l=i?0:-a;break;case"End":l=100;break;case"Home":l=-100;break}return l}else return r==null?0:UA(t,e,n,r,s)}function WA({panelDataArray:t}){const e=Array(t.length),n=t.map(s=>s.constraints);let r=0,o=100;for(let s=0;s<t.length;s++){const i=n[s];ne(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;a!=null&&(r++,e[s]=a,o-=a)}for(let s=0;s<t.length;s++){const i=n[s];ne(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;if(a!=null)continue;const l=t.length-r,c=o/l;r++,e[s]=c,o-=c}return e}function Jn(t,e,n){e.forEach((r,o)=>{const s=t[o];ne(s,`Panel data not found for index ${o}`);const{callbacks:i,constraints:a,id:l}=s,{collapsedSize:c=0,collapsible:u}=a,d=n[l];if(d==null||r!==d){n[l]=r;const{onCollapse:h,onExpand:p,onResize:g}=i;g&&g(r,d),u&&(h||p)&&(p&&(d==null||Pt(d,c))&&!Pt(r,c)&&p(),h&&(d==null||!Pt(d,c))&&Pt(r,c)&&h())}})}function Jo(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!=e[n])return!1;return!0}function GA({defaultSize:t,dragState:e,layout:n,panelData:r,panelIndex:o,precision:s=3}){const i=n[o];let a;return i==null?a=t!=null?t.toPrecision(s):"1":r.length===1?a="1":a=i.toPrecision(s),{flexBasis:0,flexGrow:a,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function qA(t,e=10){let n=null;return(...o)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{t(...o)},e)}}function Zd(t){try{if(typeof localStorage<"u")t.getItem=e=>localStorage.getItem(e),t.setItem=(e,n)=>{localStorage.setItem(e,n)};else throw new Error("localStorage not supported in this environment")}catch(e){console.error(e),t.getItem=()=>null,t.setItem=()=>{}}}function Lg(t){return`react-resizable-panels:${t}`}function Bg(t){return t.map(e=>{const{constraints:n,id:r,idIsFromProps:o,order:s}=e;return o?r:s?`${s}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((e,n)=>e.localeCompare(n)).join(",")}function Fg(t,e){try{const n=Lg(t),r=e.getItem(n);if(r){const o=JSON.parse(r);if(typeof o=="object"&&o!=null)return o}}catch{}return null}function VA(t,e,n){var r,o;const s=(r=Fg(t,n))!==null&&r!==void 0?r:{},i=Bg(e);return(o=s[i])!==null&&o!==void 0?o:null}function KA(t,e,n,r,o){var s;const i=Lg(t),a=Bg(e),l=(s=Fg(t,o))!==null&&s!==void 0?s:{};l[a]={expandToSizes:Object.fromEntries(n.entries()),layout:r};try{o.setItem(i,JSON.stringify(l))}catch(c){console.error(c)}}function Qd({layout:t,panelConstraints:e}){const n=[...t],r=n.reduce((s,i)=>s+i,0);if(n.length!==e.length)throw Error(`Invalid ${e.length} panel layout: ${n.map(s=>`${s}%`).join(", ")}`);if(!qe(r,100)&&n.length>0)for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=100/r*i;n[s]=a}let o=0;for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=sr({panelConstraints:e,panelIndex:s,size:i});i!=a&&(o+=i-a,n[s]=a)}if(!qe(o,0))for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=i+o,l=sr({panelConstraints:e,panelIndex:s,size:a});if(i!==l&&(o-=l-i,n[s]=l,qe(o,0)))break}return n}const XA=100,Kr={getItem:t=>(Zd(Kr),Kr.getItem(t)),setItem:(t,e)=>{Zd(Kr),Kr.setItem(t,e)}},eh={};function Ug({autoSaveId:t=null,children:e,className:n="",direction:r,forwardedRef:o,id:s=null,onLayout:i=null,keyboardResizeBy:a=null,storage:l=Kr,style:c,tagName:u="div",...d}){const h=ec(s),p=m.useRef(null),[g,y]=m.useState(null),[v,w]=m.useState([]),_=MA(),b=m.useRef({}),x=m.useRef(new Map),S=m.useRef(0),k=m.useRef({autoSaveId:t,direction:r,dragState:g,id:h,keyboardResizeBy:a,onLayout:i,storage:l}),C=m.useRef({layout:v,panelDataArray:[],panelDataArrayChanged:!1});m.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),m.useImperativeHandle(o,()=>({getId:()=>k.current.id,getLayout:()=>{const{layout:E}=C.current;return E},setLayout:E=>{const{onLayout:R}=k.current,{layout:T,panelDataArray:O}=C.current,A=Qd({layout:E,panelConstraints:O.map(M=>M.constraints)});Yd(T,A)||(w(A),C.current.layout=A,R&&R(A),Jn(O,A,b.current))}}),[]),vn(()=>{k.current.autoSaveId=t,k.current.direction=r,k.current.dragState=g,k.current.id=h,k.current.onLayout=i,k.current.storage=l}),FA({committedValuesRef:k,eagerValuesRef:C,groupId:h,layout:v,panelDataArray:C.current.panelDataArray,setLayout:w,panelGroupElement:p.current}),m.useEffect(()=>{const{panelDataArray:E}=C.current;if(t){if(v.length===0||v.length!==E.length)return;let R=eh[t];R==null&&(R=qA(KA,XA),eh[t]=R);const T=[...E],O=new Map(x.current);R(t,T,O,v,l)}},[t,v,l]),m.useEffect(()=>{});const N=m.useCallback(E=>{const{onLayout:R}=k.current,{layout:T,panelDataArray:O}=C.current;if(E.constraints.collapsible){const A=O.map(Ne=>Ne.constraints),{collapsedSize:M=0,panelSize:oe,pivotIndices:le}=un(O,E,T);if(ne(oe!=null,`Panel size not found for panel "${E.id}"`),!Pt(oe,M)){x.current.set(E.id,oe);const Me=er(O,E)===O.length-1?oe-M:M-oe,ae=Vr({delta:Me,initialLayout:T,panelConstraints:A,pivotIndices:le,prevLayout:T,trigger:"imperative-api"});Jo(T,ae)||(w(ae),C.current.layout=ae,R&&R(ae),Jn(O,ae,b.current))}}},[]),H=m.useCallback((E,R)=>{const{onLayout:T}=k.current,{layout:O,panelDataArray:A}=C.current;if(E.constraints.collapsible){const M=A.map(Ye=>Ye.constraints),{collapsedSize:oe=0,panelSize:le=0,minSize:Ne=0,pivotIndices:Me}=un(A,E,O),ae=R??Ne;if(Pt(le,oe)){const Ye=x.current.get(E.id),Ir=Ye!=null&&Ye>=ae?Ye:ae,ri=er(A,E)===A.length-1?le-Ir:Ir-le,ze=Vr({delta:ri,initialLayout:O,panelConstraints:M,pivotIndices:Me,prevLayout:O,trigger:"imperative-api"});Jo(O,ze)||(w(ze),C.current.layout=ze,T&&T(ze),Jn(A,ze,b.current))}}},[]),L=m.useCallback(E=>{const{layout:R,panelDataArray:T}=C.current,{panelSize:O}=un(T,E,R);return ne(O!=null,`Panel size not found for panel "${E.id}"`),O},[]),X=m.useCallback((E,R)=>{const{panelDataArray:T}=C.current,O=er(T,E);return GA({defaultSize:R,dragState:g,layout:v,panelData:T,panelIndex:O})},[g,v]),I=m.useCallback(E=>{const{layout:R,panelDataArray:T}=C.current,{collapsedSize:O=0,collapsible:A,panelSize:M}=un(T,E,R);return ne(M!=null,`Panel size not found for panel "${E.id}"`),A===!0&&Pt(M,O)},[]),ee=m.useCallback(E=>{const{layout:R,panelDataArray:T}=C.current,{collapsedSize:O=0,collapsible:A,panelSize:M}=un(T,E,R);return ne(M!=null,`Panel size not found for panel "${E.id}"`),!A||Pn(M,O)>0},[]),D=m.useCallback(E=>{const{panelDataArray:R}=C.current;R.push(E),R.sort((T,O)=>{const A=T.order,M=O.order;return A==null&&M==null?0:A==null?-1:M==null?1:A-M}),C.current.panelDataArrayChanged=!0,_()},[_]);vn(()=>{if(C.current.panelDataArrayChanged){C.current.panelDataArrayChanged=!1;const{autoSaveId:E,onLayout:R,storage:T}=k.current,{layout:O,panelDataArray:A}=C.current;let M=null;if(E){const le=VA(E,A,T);le&&(x.current=new Map(Object.entries(le.expandToSizes)),M=le.layout)}M==null&&(M=WA({panelDataArray:A}));const oe=Qd({layout:M,panelConstraints:A.map(le=>le.constraints)});Yd(O,oe)||(w(oe),C.current.layout=oe,R&&R(oe),Jn(A,oe,b.current))}}),vn(()=>{const E=C.current;return()=>{E.layout=[]}},[]);const J=m.useCallback(E=>{let R=!1;const T=p.current;return T&&window.getComputedStyle(T,null).getPropertyValue("direction")==="rtl"&&(R=!0),function(A){A.preventDefault();const M=p.current;if(!M)return()=>null;const{direction:oe,dragState:le,id:Ne,keyboardResizeBy:Me,onLayout:ae}=k.current,{layout:Ye,panelDataArray:Ir}=C.current,{initialLayout:_o}=le??{},ri=Mg(Ne,E,M);let ze=HA(A,E,oe,le,Me,M);const rc=oe==="horizontal";rc&&R&&(ze=-ze);const Wg=Ir.map(Gg=>Gg.constraints),jr=Vr({delta:ze,initialLayout:_o??Ye,panelConstraints:Wg,pivotIndices:ri,prevLayout:Ye,trigger:Eg(A)?"keyboard":"mouse-or-touch"}),oc=!Jo(Ye,jr);(Pg(A)||Tg(A))&&S.current!=ze&&(S.current=ze,!oc&&ze!==0?rc?oa(E,ze<0?Rg:Og):oa(E,ze<0?Ig:jg):oa(E,0)),oc&&(w(jr),C.current.layout=jr,ae&&ae(jr),Jn(Ir,jr,b.current))}},[]),Y=m.useCallback((E,R)=>{const{onLayout:T}=k.current,{layout:O,panelDataArray:A}=C.current,M=A.map(Ye=>Ye.constraints),{panelSize:oe,pivotIndices:le}=un(A,E,O);ne(oe!=null,`Panel size not found for panel "${E.id}"`);const Me=er(A,E)===A.length-1?oe-R:R-oe,ae=Vr({delta:Me,initialLayout:O,panelConstraints:M,pivotIndices:le,prevLayout:O,trigger:"imperative-api"});Jo(O,ae)||(w(ae),C.current.layout=ae,T&&T(ae),Jn(A,ae,b.current))},[]),Z=m.useCallback((E,R)=>{const{layout:T,panelDataArray:O}=C.current,{collapsedSize:A=0,collapsible:M}=R,{collapsedSize:oe=0,collapsible:le,maxSize:Ne=100,minSize:Me=0}=E.constraints,{panelSize:ae}=un(O,E,T);ae!=null&&(M&&le&&Pt(ae,A)?Pt(A,oe)||Y(E,oe):ae<Me?Y(E,Me):ae>Ne&&Y(E,Ne))},[Y]),F=m.useCallback((E,R)=>{const{direction:T}=k.current,{layout:O}=C.current;if(!p.current)return;const A=ni(E,p.current);ne(A,`Drag handle element not found for id "${E}"`);const M=Dg(T,R);y({dragHandleId:E,dragHandleRect:A.getBoundingClientRect(),initialCursorPosition:M,initialLayout:O})},[]),ie=m.useCallback(()=>{y(null)},[]),ve=m.useCallback(E=>{const{panelDataArray:R}=C.current,T=er(R,E);T>=0&&(R.splice(T,1),delete b.current[E.id],C.current.panelDataArrayChanged=!0,_())},[_]),pe=m.useMemo(()=>({collapsePanel:N,direction:r,dragState:g,expandPanel:H,getPanelSize:L,getPanelStyle:X,groupId:h,isPanelCollapsed:I,isPanelExpanded:ee,reevaluatePanelConstraints:Z,registerPanel:D,registerResizeHandle:J,resizePanel:Y,startDragging:F,stopDragging:ie,unregisterPanel:ve,panelGroupElement:p.current}),[N,g,r,H,L,X,h,I,ee,Z,D,J,Y,F,ie,ve]),P={display:"flex",flexDirection:r==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return m.createElement(Qs.Provider,{value:pe},m.createElement(u,{...d,children:e,className:n,id:s,ref:p,style:{...P,...c},[we.group]:"",[we.groupDirection]:r,[we.groupId]:h}))}const Hg=m.forwardRef((t,e)=>m.createElement(Ug,{...t,forwardedRef:e}));Ug.displayName="PanelGroup";Hg.displayName="forwardRef(PanelGroup)";function er(t,e){return t.findIndex(n=>n===e||n.id===e.id)}function un(t,e,n){const r=er(t,e),s=r===t.length-1?[r-1,r]:[r,r+1],i=n[r];return{...e.constraints,panelSize:i,pivotIndices:s}}function JA({disabled:t,handleId:e,resizeHandler:n,panelGroupElement:r}){m.useEffect(()=>{if(t||n==null||r==null)return;const o=ni(e,r);if(o==null)return;const s=i=>{if(!i.defaultPrevented)switch(i.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{i.preventDefault(),n(i);break}case"F6":{i.preventDefault();const a=o.getAttribute(we.groupId);ne(a,`No group element found for id "${a}"`);const l=co(a,r),c=Ng(a,e,r);ne(c!==null,`No resize element found for id "${e}"`);const u=i.shiftKey?c>0?c-1:l.length-1:c+1<l.length?c+1:0;l[u].focus();break}}};return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}},[r,t,e,n])}function Qa({children:t=null,className:e="",disabled:n=!1,hitAreaMargins:r,id:o,onBlur:s,onClick:i,onDragging:a,onFocus:l,onPointerDown:c,onPointerUp:u,style:d={},tabIndex:h=0,tagName:p="div",...g}){var y,v;const w=m.useRef(null),_=m.useRef({onClick:i,onDragging:a,onPointerDown:c,onPointerUp:u});m.useEffect(()=>{_.current.onClick=i,_.current.onDragging=a,_.current.onPointerDown=c,_.current.onPointerUp=u});const b=m.useContext(Qs);if(b===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:x,groupId:S,registerResizeHandle:k,startDragging:C,stopDragging:N,panelGroupElement:H}=b,L=ec(o),[X,I]=m.useState("inactive"),[ee,D]=m.useState(!1),[J,Y]=m.useState(null),Z=m.useRef({state:X});vn(()=>{Z.current.state=X}),m.useEffect(()=>{if(n)Y(null);else{const pe=k(L);Y(()=>pe)}},[n,L,k]);const F=(y=r?.coarse)!==null&&y!==void 0?y:15,ie=(v=r?.fine)!==null&&v!==void 0?v:5;m.useEffect(()=>{if(n||J==null)return;const pe=w.current;ne(pe,"Element ref not attached");let P=!1;return $A(L,pe,x,{coarse:F,fine:ie},(R,T,O)=>{if(!T){I("inactive");return}switch(R){case"down":{I("drag"),P=!1,ne(O,'Expected event to be defined for "down" action'),C(L,O);const{onDragging:A,onPointerDown:M}=_.current;A?.(!0),M?.();break}case"move":{const{state:A}=Z.current;P=!0,A!=="drag"&&I("hover"),ne(O,'Expected event to be defined for "move" action'),J(O);break}case"up":{I("hover"),N();const{onClick:A,onDragging:M,onPointerUp:oe}=_.current;M?.(!1),oe?.(),P||A?.();break}}})},[F,x,n,ie,k,L,J,C,N]),JA({disabled:n,handleId:L,resizeHandler:J,panelGroupElement:H});const ve={touchAction:"none",userSelect:"none"};return m.createElement(p,{...g,children:t,className:e,id:o,onBlur:()=>{D(!1),s?.()},onFocus:()=>{D(!0),l?.()},ref:w,role:"separator",style:{...ve,...d},tabIndex:h,[we.groupDirection]:x,[we.groupId]:S,[we.resizeHandle]:"",[we.resizeHandleActive]:X==="drag"?"pointer":ee?"keyboard":void 0,[we.resizeHandleEnabled]:!n,[we.resizeHandleId]:L,[we.resizeHandleState]:X})}Qa.displayName="PanelResizeHandle";const YA=My(()=>qt(()=>import("./JsonRoomEditor-B9W_rmOO.js").then(t=>t.J),__vite__mapDeps([8,1,2,6,9]))),ZA=m.lazy(YA),QA=()=>{_A();const t=f.jsx("div",{className:"flex h-full items-center justify-center bg-pureBlack",children:f.jsx("span",{className:"sprite texture-animated-head_walking_right"})});return f.jsx(f.Fragment,{children:f.jsx(sE,{children:f.jsx(Ms,{children:f.jsxs(Hg,{direction:"horizontal",className:"w-full h-full",children:[f.jsx(as,{id:"jsonEditor",defaultSize:18,minSize:12,collapsible:!0,children:f.jsx(m.Suspense,{fallback:t,children:f.jsx(ZA,{})})}),f.jsx(Qa,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-r-[calc(1px*var(--scale))] border-metallicBlue"}),f.jsx(as,{id:"editingArea",children:f.jsx(HT,{children:f.jsx(xA,{})})}),f.jsx(Qa,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-l-[calc(1px*var(--scale))] border-metallicBlue"}),f.jsx(as,{id:"toolbar",defaultSize:20,maxSize:33,minSize:10,children:f.jsx(gC,{children:f.jsx(mE,{})})})]})})})})},mR=Object.freeze(Object.defineProperty({__proto__:null,default:QA},Symbol.toStringTag,{value:"Module"}));export{Nh as A,Ih as C,nn as F,mR as L,As as R,Qv as S,Mh as V,ow as a,pR as b,lR as h,ge as t,Zv as u};
