import{b as x,c as G,g as K,s as _,p as ee,f as te,h as oe,i as re,j as W,k as R,l as $,m as ne,n as se,o as ie,q as ae,t as le,u as ce,x as de}from"./index-DKnC_Q4Y.js";var T={},C={},j;function ue(){if(j)return C;j=1;function e(l,a){var r;if(typeof Symbol>"u"||l[Symbol.iterator]==null){if(Array.isArray(l)||(r=t(l))||a){r&&(l=r);var u=0,s=function(){};return{s,n:function(){return u>=l.length?{done:!0}:{done:!1,value:l[u++]}},e:function(f){throw f},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y=!0,h=!1,p;return{s:function(){r=l[Symbol.iterator]()},n:function(){var f=r.next();return y=f.done,f},e:function(f){h=!0,p=f},f:function(){try{!y&&r.return!=null&&r.return()}finally{if(h)throw p}}}}function t(l,a){if(l){if(typeof l=="string")return o(l,a);var r=Object.prototype.toString.call(l).slice(8,-1);if(r==="Object"&&l.constructor&&(r=l.constructor.name),r==="Map"||r==="Set")return Array.from(l);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(l,a)}}function o(l,a){(a==null||a>l.length)&&(a=l.length);for(var r=0,u=new Array(a);r<a;r++)u[r]=l[r];return u}var n=x(),i=n.ensureIterable;function d(l){var a=[],r=e(l),u;try{for(r.s();!(u=r.n()).done;){var s=u.value;a.push(s)}}catch(y){r.e(y)}finally{r.f()}return a}C.__toArray=d;function m(l){return d(i(l))}return C.toArray=m,C}var H;function ye(){if(H)return T;H=1;var e=G(),t=e.mark(m),o=x(),n=o.iterableCurry,i=ue(),d=i.__toArray;function m(a,r){var u;return e.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(u=Array.isArray(a)?a:d(a),u.length){y.next=3;break}return y.abrupt("return");case 3:if(!r--){y.next=7;break}return y.delegateYield(u,"t0",5);case 5:y.next=3;break;case 7:case"end":return y.stop()}},t)}T.__cycleTimes=m;var l=n(m);return T.cycleTimes=l,T}var S={},O;function fe(){if(O)return S;O=1;var e=x(),t=e.iterableCurry,o=ye(),n=o.__cycleTimes;function i(m){return n(m,1/0)}S.__cycle=i;var d=t(i);return S.cycle=d,S}var A={},B;function me(){if(B)return A;B=1;var e=G(),t=e.mark(l);function o(r,u){var s;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(s=n(r))||u){s&&(r=s);var y=0,h=function(){};return{s:h,n:function(){return y>=r.length?{done:!0}:{done:!1,value:r[y++]}},e:function(w){throw w},f:h}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,c=!1,f;return{s:function(){s=r[Symbol.iterator]()},n:function(){var w=s.next();return p=w.done,w},e:function(w){c=!0,f=w},f:function(){try{!p&&s.return!=null&&s.return()}finally{if(c)throw f}}}}function n(r,u){if(r){if(typeof r=="string")return i(r,u);var s=Object.prototype.toString.call(r).slice(8,-1);if(s==="Object"&&r.constructor&&(s=r.constructor.name),s==="Map"||s==="Set")return Array.from(r);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return i(r,u)}}function i(r,u){(u==null||u>r.length)&&(u=r.length);for(var s=0,y=new Array(u);s<u;s++)y[s]=r[s];return y}var d=x(),m=d.iterableCurry;function l(r,u){var s,y,h,p;return e.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(u!==0){f.next=2;break}return f.abrupt("return");case 2:s=0,y=o(r),f.prev=4,y.s();case 6:if((h=y.n()).done){f.next=14;break}return p=h.value,f.next=10,p;case 10:if(++s!==u){f.next=12;break}return f.abrupt("break",14);case 12:f.next=6;break;case 14:f.next=19;break;case 16:f.prev=16,f.t0=f.catch(4),y.e(f.t0);case 19:return f.prev=19,y.f(),f.finish(19);case 22:case"end":return f.stop()}},t,null,[[4,16,19,22]])}A.__take=l;var a=m(l);return A.take=a,A}var z,F;function pe(){return F||(F=1,z=fe().cycle),z}var ge=pe();const he=K(ge);var E,M;function ve(){return M||(M=1,E=me().take),E}var Ie=ve();const be=K(Ie),we={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},P=(e,t)=>[...be(t,he(we[e]))],ke=e=>({awayWall:{type:"wall",config:{direction:"away",tiles:P("blacktooth",e.x)},position:{x:0,y:e.y,z:0}},leftWall:{type:"wall",config:{direction:"left",tiles:P("blacktooth",e.y)},position:{x:e.x,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:e.x}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:e.y}},position:{x:0,y:0,z:0}}}),N=e=>({planet:"blacktooth",color:{hue:"cyan",shade:"basic"},size:e,items:{floor:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:e},position:{x:0,y:0,z:0}},...ke(e)}}),v=e=>e.campaignInProgress.rooms[e.currentlyEditingRoomId],k={w:16,d:16,h:12},L={x:16,y:16,z:12},Re=["head","heels"],Te=[...Re,"headOverHeels"],g=(...e)=>t=>e.includes(t.type),Ce=g("bubbles","stopAutowalk","firedDoughnut","floatingText","emitter","particle"),Se=(e,t)=>Ce(e)||Xe(e)&&(t!==void 0&&Ee(t)||e.config.direction.z!==0)||$e(e)&&e.config.floorType==="none",Rt=(e,t)=>!Se(e,t),Ae=["ball","slidingBlock","slidingDeadly"];g(...Ae);const xe=["portableBlock","spring","sceneryPlayer","sceneryCrown","monster","slidingBlock"],ze=["dalek","turtle","elephantHead","homingBot","helicopterBug"],Tt=e=>e.type==="slidingBlock"?e.config.style==="puck":e.type==="monster"?ze.includes(e.config.which):xe.includes(e.type),Ee=e=>e.type==="head"||e.type==="heels"||e.type==="headOverHeels";function Ct(e){return Je.includes(e.type)}const Je=[...Te,"monster","ball","charles","pushableBlock","movingPlatform","moveableDeadly","pickup","portableBlock","slidingBlock","slidingDeadly","spring","sceneryPlayer","sceneryCrown"],_e=["monster","deadlyBlock","moveableDeadly","slidingDeadly"];g(..._e);const Pe=e=>e.config.times!==void 0,Xe=g("portal");g("teleporter");g("heels");g("head");g("heels","headOverHeels");g("head","headOverHeels");g("lift");g("emitter");const qe=g("monster"),$e=g("floor");g("pickup");g("spring");const St=g("joystick");g("monster","movingPlatform");const At=e=>qe(e)&&e.config.which==="cyberman"&&e.state.everActivated===!1,xt=(e,t={})=>{const o=De(t),n=_(L,e);return _(ee(o,L),n)},Q=e=>({x:e.direction==="away"?e.tiles.length:e.direction==="towards"?e.times?.x:1,y:e.direction==="left"?e.tiles.length:e.direction==="right"?e.times?.y:1}),zt=e=>Pe(e)?e.type==="wall"?Q(e.config):e.config.times:void 0,De=e=>({x:e.x??1,y:e.y??1,z:e.z??1}),We=e=>({x:e.x??1,y:e.y??1});function*je(e,t,o){for(const n of oe(e)){const[i,d]=n;if(d.type!=="wall"){yield n;continue}if(d.config.direction!==t){yield n;continue}const{position:m,config:l}=d,a=We(Q(l)),r=re(W(l.direction)),u=W(l.direction),s=_(o,m);if(s[u]!==0){yield n;continue}if(s[r]<-1){yield n;continue}if(s[r]>a[r]){yield n;continue}if(a[r]===2)continue;const y=s[r]===0;y&&(yield[i,R(d,p=>{p.position=$(m,{[r]:2});const c=p.config;switch(c.direction){case"towards":c.times={x:a[r]-2};break;case"right":c.times={y:a[r]-2};break;default:c.tiles=c.tiles.slice(2)}})]);const h=s[r]===a[r]-2;h&&(yield[i,R(d,p=>{const c=p.config;switch(c.direction){case"towards":c.times={x:a[r]-2};break;case"right":c.times={y:a[r]-2};break;default:c.tiles=c.tiles.slice(0,-2)}})]),!y&&!h&&(yield[`${i}/beforeDoor`,R(d,p=>{const c=p.config;switch(c.direction){case"towards":c.times={x:s[r]};break;case"right":c.times={y:s[r]};break;default:c.tiles=c.tiles.slice(0,s[r])}})],yield[`${i}/afterDoor`,R(d,p=>{p.position={...m,[r]:o[r]+2};const c=p.config;switch(c.direction){case"towards":c.times={x:a[r]-s[r]-2};break;case"right":c.times={y:a[r]-s[r]-2};break;default:c.tiles=c.tiles.slice(s[r]+2)}})])}}const U=(e,t,o)=>{e.items=te(je(e.items,t,o))},I=e=>{const t=structuredClone(ne(v(e))),{history:o}=e;o.redo=[],o.undo.push(t)},He={undo(e){const t=e,{campaignInProgress:o,history:{undo:n,redo:i},currentlyEditingRoomId:d}=t;n.length!==0&&(i.push(o.rooms[d]),o.rooms[d]=n.pop())},redo(e){const t=e,{campaignInProgress:o,history:{redo:n,undo:i},currentlyEditingRoomId:d}=t;n.length!==0&&(i.push(o.rooms[d]),o.rooms[d]=n.pop())}},Oe={selectCanUndo:e=>e.history.undo.length>0,selectCanRedo:e=>e.history.redo.length>0},V=(e,t)=>{e.planet=t;for(const o of Object.values(e.items))o.type==="floor"&&o.config.floorType==="standable"&&(o.config.scenery=t),o.type==="wall"&&(o.config.direction==="away"||o.config.direction==="left")&&(o.config.tiles=P(t,o.config.tiles.length)),o.type==="pickup"&&o.config.gives==="crown"&&se.includes(t)&&(o.config.planet=t)},Et=({x:e=0,y:t=0})=>t-e,Y=({x:e=0,y:t=0,z:o=0})=>({x:t-e,y:-(e+t)/2-o}),Jt=(e,t,o)=>{const n=Y(t),i=ie(e,n);return $(Be(i,o),t)},Be=({x:e,y:t},o)=>{switch(o){case"xy":return{x:-(e/2+t),y:e/2-t,z:0};case"xz":return{x:-e,y:0,z:e/2-t};case"yz":return{x:0,y:e,z:-e/2-t};default:throw new Error(`unknown plane ${o}`)}},Fe=({x:e=0,y:t=0,z:o=0})=>({x:e*k.w,y:t*k.d,z:o*k.h}),Me=({x:e=0,y:t=0,z:o=0})=>({x:e/k.w,y:t/k.d,z:o/k.h}),_t=e=>Y(Fe(e)),Z=(e,t)=>{const o=t.type==="monster"?t.config.which:t.type;for(let n=1;;n++){const i=n===1?o:`${o}_${n}`;if(!e.items[i])return i}},J=(e,t,o)=>{const n=v(e),i=Z(n,t);n.items[i]={type:t.type,config:t.config,position:o}},Le=e=>e.type==="door",Ue=e=>e.type==="monster"&&e.config.which==="cyberman",Ge={applyToolToRoomJson(e,{payload:{blockPosition:t,pointedAtItem:o}}){const n=e,{tool:i}=n;switch(i?.type){case"item":{if(Le(i.item)&&o.type==="wall"){I(n);const d=v(n),m=o.config.direction;U(d,m,t);const l=`room_${n.nextRoomId++}`;J(n,{...i.item,config:{...i.item.config,toRoom:l,direction:m}},t);const a={id:l,...structuredClone(N({x:8,y:8})),color:d.color};V(a,d.planet),n.campaignInProgress.rooms[l]=a;const r=Z(a,i.item),u={x:m==="left"?0:m==="right"?a.size.x:Math.floor(a.size.x/2),y:m==="away"?0:m==="towards"?a.size.x:Math.floor(a.size.x/2),z:t.z},s=ae(m),y={type:"door",config:{toRoom:d.id,direction:s},position:u};a.items[r]=y,U(a,s,u)}else Ue(i.item)&&o.type==="deadlyBlock"&&o.config.style==="toaster"&&Me(o.state.position).z+1===t.z?(I(n),J(n,{...i.item,config:{...i.item.config,activated:"off"}},t)):(I(n),J(n,i.item,t));n.selectedJsonItemIds=[];break}}}},X="room_0",Ke={id:X,...N({x:8,y:8})},q={campaignInProgress:{name:"new campaign",rooms:{[X]:Ke}},nextRoomId:1,currentlyEditingRoomId:X,tool:{type:"pointer"},hoveredJsonItemId:void 0,clickableAnnotationHovered:!1,selectedJsonItemIds:[],halfGridResolution:!1,wallsFloorsLocked:!0,dragInProgress:!1,history:{undo:[],redo:[]}},D=le({name:"levelEditor",initialState:q,reducers:{setTool(e,{payload:t}){const o=e;t.type==="item"&&(o.selectedJsonItemIds=[]),o.tool=t},changeRoomColour(e,{payload:t}){const o=e,n=o.campaignInProgress.rooms[o.currentlyEditingRoomId].color;I(o),Object.assign(n,t)},changeRoomScenery(e,{payload:t}){const o=e,n=v(o);I(o),V(n,t)},changeToRoom(e,{payload:t}){const o=e;if(!o.campaignInProgress.rooms[t]){console.warn(`can't change to room ${t} - it doesn't exist`);return}o.currentlyEditingRoomId=t,o.clickableAnnotationHovered=!1,o.hoveredJsonItemId=void 0,o.selectedJsonItemIds=[],o.history=q.history},roomJsonEdited(e,{payload:t}){const o=e;o.campaignInProgress.rooms[o.currentlyEditingRoomId]=t},setHoveredItemInRoom(e,t){e.hoveredJsonItemId=t.payload},setClickableAnnotationHovered(e,t){e.clickableAnnotationHovered=t.payload},setSelectedItemInRoom(e,{payload:{jsonItemId:t,additive:o=!1}}){if(o)if(t===void 0)e.selectedJsonItemIds=[];else{const n=e.selectedJsonItemIds.indexOf(t);n===-1?e.selectedJsonItemIds.push(t):e.selectedJsonItemIds.splice(n,1)}else e.selectedJsonItemIds=t===void 0?[]:[t]},moveItemInRoom(e,{payload:{jsonItemId:t,positionDelta:o}}){const n=e,i=v(n);I(n);const d=i.items[t];d.position=$(i.items[t].position,o)},deleteSelected(e){const t=e,o=v(t);I(t),t.selectedJsonItemIds.forEach(n=>{delete o.items[n]}),t.selectedJsonItemIds=[]},clearRoom(e){const t=e,o=v(t);I(t);for(const n of de(o.items)){const i=o.items[n];i.type!=="floor"&&i.type!=="wall"&&i.type!=="door"&&(delete o.items[n],t.selectedJsonItemIds=t.selectedJsonItemIds.filter(d=>d!==n))}},injected(){},changeGridResolution(e,{payload:t}){const o=e;o.halfGridResolution=t},changeWallsFloorsLocked(e,{payload:t}){const o=e;o.wallsFloorsLocked=t},changeDragInProgress(e,{payload:t}){const o=e;o.dragInProgress=t},...He,...Ge},selectors:{selectCurrentEditingRoomJson:v,selectCurrentEditingRoomColour:e=>v(e).color,selectCurrentEditingRoomScenery:e=>v(e).planet,selectTool:e=>e.tool,selectSelectedJsonItemIds:e=>e.selectedJsonItemIds,selectHoveredJsonItemId:e=>e.hoveredJsonItemId,...Oe}}),{applyToolToRoomJson:Ne,changeDragInProgress:Qe,changeGridResolution:Ve,changeRoomColour:Ye,changeRoomScenery:Ze,changeToRoom:et,changeWallsFloorsLocked:tt,clearRoom:ot,deleteSelected:rt,injected:nt,moveItemInRoom:st,redo:it,roomJsonEdited:at,setClickableAnnotationHovered:lt,setHoveredItemInRoom:ct,setSelectedItemInRoom:dt,setTool:ut,undo:yt}=D.actions,{selectCanRedo:ft,selectCanUndo:mt,selectCurrentEditingRoomColour:pt,selectCurrentEditingRoomJson:gt,selectCurrentEditingRoomScenery:ht,selectHoveredJsonItemId:vt,selectSelectedJsonItemIds:It,selectTool:bt}=D.selectors,wt=ce.withTypes(),Pt=Object.freeze(Object.defineProperty({__proto__:null,applyToolToRoomJson:Ne,changeDragInProgress:Qe,changeGridResolution:Ve,changeRoomColour:Ye,changeRoomScenery:Ze,changeToRoom:et,changeWallsFloorsLocked:tt,clearRoom:ot,deleteSelected:rt,initialLevelEditorSliceState:q,injected:nt,levelEditorSlice:D,moveItemInRoom:st,redo:it,roomJsonEdited:at,selectCanRedo:ft,selectCanUndo:mt,selectCurrentEditingRoomColour:pt,selectCurrentEditingRoomJson:gt,selectCurrentEditingRoomScenery:ht,selectHoveredJsonItemId:vt,selectSelectedJsonItemIds:It,selectTool:bt,setClickableAnnotationHovered:lt,setHoveredItemInRoom:ct,setSelectedItemInRoom:dt,setTool:ut,undo:yt,useAppSelectorWithLevelEditorSlice:wt},Symbol.toStringTag,{value:"Module"}));export{Ae as A,Q as B,xt as C,Rt as D,Ct as E,Ee as F,St as G,At as H,Et as I,Tt as J,lt as K,vt as L,It as M,Me as N,We as O,Jt as P,st as Q,Qe as R,dt as S,Ne as T,ct as U,Be as V,at as W,Pt as X,ut as a,pt as b,Ve as c,rt as d,Ye as e,ht as f,Ze as g,mt as h,ft as i,yt as j,tt as k,gt as l,P as m,ot as n,et as o,Y as p,g as q,it as r,bt as s,_t as t,wt as u,Pe as v,zt as w,k as x,Fe as y,Je as z};
