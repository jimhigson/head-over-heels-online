import{b as A,c as U,g as G,s as _,p as Z,f as ee,h as te,i as re,j as D,k,l as K,m as oe,n as ne,o as se,q as ie,u as ae}from"./index-CcuPu2Lc.js";var R={},C={},$;function le(){if($)return C;$=1;function e(a,i){var o;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(o=t(a))||i){o&&(a=o);var d=0,s=function(){};return{s,n:function(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function(f){throw f},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,h=!1,p;return{s:function(){o=a[Symbol.iterator]()},n:function(){var f=o.next();return u=f.done,f},e:function(f){h=!0,p=f},f:function(){try{!u&&o.return!=null&&o.return()}finally{if(h)throw p}}}}function t(a,i){if(a){if(typeof a=="string")return r(a,i);var o=Object.prototype.toString.call(a).slice(8,-1);if(o==="Object"&&a.constructor&&(o=a.constructor.name),o==="Map"||o==="Set")return Array.from(a);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return r(a,i)}}function r(a,i){(i==null||i>a.length)&&(i=a.length);for(var o=0,d=new Array(i);o<i;o++)d[o]=a[o];return d}var n=A(),c=n.ensureIterable;function y(a){var i=[],o=e(a),d;try{for(o.s();!(d=o.n()).done;){var s=d.value;i.push(s)}}catch(u){o.e(u)}finally{o.f()}return i}C.__toArray=y;function m(a){return y(c(a))}return C.toArray=m,C}var H;function ce(){if(H)return R;H=1;var e=U(),t=e.mark(m),r=A(),n=r.iterableCurry,c=le(),y=c.__toArray;function m(i,o){var d;return e.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(d=Array.isArray(i)?i:y(i),d.length){u.next=3;break}return u.abrupt("return");case 3:if(!o--){u.next=7;break}return u.delegateYield(d,"t0",5);case 5:u.next=3;break;case 7:case"end":return u.stop()}},t)}R.__cycleTimes=m;var a=n(m);return R.cycleTimes=a,R}var T={},O;function de(){if(O)return T;O=1;var e=A(),t=e.iterableCurry,r=ce(),n=r.__cycleTimes;function c(m){return n(m,1/0)}T.__cycle=c;var y=t(c);return T.cycle=y,T}var S={},W;function ue(){if(W)return S;W=1;var e=U(),t=e.mark(a);function r(o,d){var s;if(typeof Symbol>"u"||o[Symbol.iterator]==null){if(Array.isArray(o)||(s=n(o))||d){s&&(o=s);var u=0,h=function(){};return{s:h,n:function(){return u>=o.length?{done:!0}:{done:!1,value:o[u++]}},e:function(b){throw b},f:h}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,l=!1,f;return{s:function(){s=o[Symbol.iterator]()},n:function(){var b=s.next();return p=b.done,b},e:function(b){l=!0,f=b},f:function(){try{!p&&s.return!=null&&s.return()}finally{if(l)throw f}}}}function n(o,d){if(o){if(typeof o=="string")return c(o,d);var s=Object.prototype.toString.call(o).slice(8,-1);if(s==="Object"&&o.constructor&&(s=o.constructor.name),s==="Map"||s==="Set")return Array.from(o);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return c(o,d)}}function c(o,d){(d==null||d>o.length)&&(d=o.length);for(var s=0,u=new Array(d);s<d;s++)u[s]=o[s];return u}var y=A(),m=y.iterableCurry;function a(o,d){var s,u,h,p;return e.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(d!==0){f.next=2;break}return f.abrupt("return");case 2:s=0,u=r(o),f.prev=4,u.s();case 6:if((h=u.n()).done){f.next=14;break}return p=h.value,f.next=10,p;case 10:if(++s!==d){f.next=12;break}return f.abrupt("break",14);case 12:f.next=6;break;case 14:f.next=19;break;case 16:f.prev=16,f.t0=f.catch(4),u.e(f.t0);case 19:return f.prev=19,u.f(),f.finish(19);case 22:case"end":return f.stop()}},t,null,[[4,16,19,22]])}S.__take=a;var i=m(a);return S.take=i,S}var E,B;function ye(){return B||(B=1,E=de().cycle),E}var fe=ye();const me=G(fe);var J,F;function pe(){return F||(F=1,J=ue().take),J}var ge=pe();const he=G(ge),ve={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},x=(e,t)=>[...he(t,me(ve[e]))],Ie={awayWall:{type:"wall",config:{direction:"away",tiles:x("blacktooth",8)},position:{x:0,y:8,z:0}},leftWall:{type:"wall",config:{direction:"left",tiles:x("blacktooth",8)},position:{x:8,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:8}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:8}},position:{x:0,y:0,z:0}}},j={x:8,y:8},N={planet:"blacktooth",color:{hue:"cyan",shade:"basic"},size:j,items:{floor:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:j},position:{x:0,y:0,z:0}},...Ie}},v=e=>e.campaignInProgress.rooms[e.currentlyEditingRoomId],pt={w:16,d:16,h:12},M={x:16,y:16,z:12},be=["head","heels"],we=[...be,"headOverHeels"],g=(...e)=>t=>e.includes(t.type),ke=g("bubbles","stopAutowalk","firedDoughnut","floatingText","emitter","particle"),Re=(e,t)=>ke(e)||xe(e)&&(t!==void 0&&Ae(t)||e.config.direction.z!==0)||ze(e)&&e.config.floorType==="none",gt=(e,t)=>!Re(e,t),Ce=["ball","slidingBlock","slidingDeadly"];g(...Ce);const Te=["portableBlock","spring","sceneryPlayer","sceneryCrown","monster","slidingBlock"],Se=["dalek","turtle","elephantHead","homingBot","helicopterBug"],ht=e=>e.type==="slidingBlock"?e.config.style==="puck":e.type==="monster"?Se.includes(e.config.which):Te.includes(e.type),Ae=e=>e.type==="head"||e.type==="heels"||e.type==="headOverHeels";function vt(e){return Ee.includes(e.type)}const Ee=[...we,"monster","ball","charles","pushableBlock","movingPlatform","moveableDeadly","pickup","portableBlock","slidingBlock","slidingDeadly","spring","sceneryPlayer","sceneryCrown"],Je=["monster","deadlyBlock","moveableDeadly","slidingDeadly"];g(...Je);const _e=e=>e.config.times!==void 0,xe=g("portal");g("teleporter");g("heels");g("head");g("heels","headOverHeels");g("head","headOverHeels");g("lift");g("emitter");const Pe=g("monster"),ze=g("floor");g("pickup");g("spring");const It=g("joystick");g("monster","movingPlatform");const bt=e=>Pe(e)&&e.config.which==="cyberman"&&e.state.everActivated===!1,wt=(e,t={})=>{const r=qe(t),n=_(M,e);return _(Z(r,M),n)},Y=e=>({x:e.direction==="away"?e.tiles.length:e.direction==="towards"?e.times?.x:1,y:e.direction==="left"?e.tiles.length:e.direction==="right"?e.times?.y:1}),kt=e=>_e(e)?e.type==="wall"?Y(e.config):e.config.times:void 0,qe=e=>({x:e.x??1,y:e.y??1,z:e.z??1}),De=e=>({x:e.x??1,y:e.y??1});function*$e(e,t,r){for(const n of te(e)){const[c,y]=n;if(y.type!=="wall"){yield n;continue}if(y.config.direction!==t){yield n;continue}const{position:m,config:a}=y,i=De(Y(a)),o=re(D(a.direction)),d=D(a.direction),s=_(r,m);if(s[d]!==0){yield n;continue}if(s[o]<-1){yield n;continue}if(s[o]>i[o]){yield n;continue}if(i[o]===2)continue;const u=s[o]===0;u&&(yield[c,k(y,p=>{p.position=K(m,{[o]:2});const l=p.config;switch(l.direction){case"towards":l.times={x:i[o]-2};break;case"right":l.times={y:i[o]-2};break;default:l.tiles=l.tiles.slice(2)}})]);const h=s[o]===i[o]-2;h&&(yield[c,k(y,p=>{const l=p.config;switch(l.direction){case"towards":l.times={x:i[o]-2};break;case"right":l.times={y:i[o]-2};break;default:l.tiles=l.tiles.slice(0,-2)}})]),!u&&!h&&(yield[`${c}/beforeDoor`,k(y,p=>{const l=p.config;switch(l.direction){case"towards":l.times={x:s[o]};break;case"right":l.times={y:s[o]};break;default:l.tiles=l.tiles.slice(0,s[o])}})],yield[`${c}/afterDoor`,k(y,p=>{p.position={...m,[o]:r[o]+2};const l=p.config;switch(l.direction){case"towards":l.times={x:i[o]-s[o]-2};break;case"right":l.times={y:i[o]-s[o]-2};break;default:l.tiles=l.tiles.slice(s[o]+2)}})])}}const L=(e,t,r)=>{e.items=ee($e(e.items,t,r))},w=e=>{const t=structuredClone(oe(v(e))),{history:r}=e;r.redo=[],r.undo.push(t)},He={undo(e){const t=e,{campaignInProgress:r,history:{undo:n,redo:c},currentlyEditingRoomId:y}=t;n.length!==0&&(c.push(r.rooms[y]),r.rooms[y]=n.pop())},redo(e){const t=e,{campaignInProgress:r,history:{redo:n,undo:c},currentlyEditingRoomId:y}=t;n.length!==0&&(c.push(r.rooms[y]),r.rooms[y]=n.pop())}},Oe={selectCanUndo:e=>e.history.undo.length>0,selectCanRedo:e=>e.history.redo.length>0},Q=(e,t)=>{e.planet=t;for(const r of Object.values(e.items))r.type==="floor"&&r.config.floorType==="standable"&&(r.config.scenery=t),r.type==="wall"&&(r.config.direction==="away"||r.config.direction==="left")&&(r.config.tiles=x(t,r.config.tiles.length)),r.type==="pickup"&&r.config.gives==="crown"&&ne.includes(t)&&(r.config.planet=t)},V=(e,t)=>{const r=t.type==="monster"?t.config.which:t.type;for(let n=1;;n++){const c=n===1?r:`${r}_${n}`;if(!e.items[c])return c}},X=(e,t,r)=>{const n=v(e),c=V(n,t);n.items[c]={type:t.type,config:t.config,position:r}},We=e=>e.type==="door",Be={applyToolToRoomJson(e,{payload:{blockPosition:t,pointedAtItem:r}}){const n=e,{tool:c}=n;switch(c?.type){case"item":{if(We(c.item)&&r.type==="wall"){w(n);const y=v(n),m=r.config.direction;L(y,m,t);const a=`room_${n.nextRoomId++}`;X(n,{...c.item,config:{...c.item.config,toRoom:a,direction:m}},t);const i={id:a,...structuredClone(N),color:y.color};Q(i,y.planet),n.campaignInProgress.rooms[a]=i;const o=V(i,c.item),d={x:m==="left"?0:m==="right"?i.size.x:Math.floor(i.size.x/2),y:m==="away"?0:m==="towards"?i.size.x:Math.floor(i.size.x/2),z:t.z},s=se(m),u={type:"door",config:{toRoom:y.id,direction:s},position:d};i.items[o]=u,L(i,s,d)}else w(n),X(n,c.item,t);n.selectedJsonItemIds=[];break}}}},P="room_0",Fe={id:P,...structuredClone(N)},z={campaignInProgress:{name:"new campaign",rooms:{[P]:Fe}},nextRoomId:1,currentlyEditingRoomId:P,tool:{type:"pointer"},hoveredJsonItemId:void 0,clickableAnnotationHovered:!1,selectedJsonItemIds:[],halfGridResolution:!1,wallsFloorsLocked:!0,dragInProgress:!1,history:{undo:[],redo:[]}},q=ie({name:"levelEditor",initialState:z,reducers:{setTool(e,{payload:t}){const r=e;t.type==="item"&&(r.selectedJsonItemIds=[]),r.tool=t},changeRoomColour(e,{payload:t}){const r=e,n=r.campaignInProgress.rooms[r.currentlyEditingRoomId].color;w(r),Object.assign(n,t)},changeRoomScenery(e,{payload:t}){const r=e,n=v(r);w(r),Q(n,t)},changeToRoom(e,{payload:t}){const r=e;if(!r.campaignInProgress.rooms[t]){console.warn(`can't change to room ${t} - it doesn't exist`);return}r.currentlyEditingRoomId=t,r.clickableAnnotationHovered=!1,r.hoveredJsonItemId=void 0,r.selectedJsonItemIds=[],r.history=z.history},roomJsonEdited(e,{payload:t}){const r=e;r.campaignInProgress.rooms[r.currentlyEditingRoomId]=t},setHoveredItemInRoom(e,t){e.hoveredJsonItemId=t.payload},setClickableAnnotationHovered(e,t){e.clickableAnnotationHovered=t.payload},setSelectedItemInRoom(e,{payload:{jsonItemId:t,additive:r=!1}}){if(r)if(t===void 0)e.selectedJsonItemIds=[];else{const n=e.selectedJsonItemIds.indexOf(t);n===-1?e.selectedJsonItemIds.push(t):e.selectedJsonItemIds.splice(n,1)}else e.selectedJsonItemIds=t===void 0?[]:[t]},moveItemInRoom(e,{payload:{jsonItemId:t,positionDelta:r}}){const n=e,c=v(n);w(n);const y=c.items[t];y.position=K(c.items[t].position,r)},deleteSelected(e){const t=e,r=v(t);w(t),t.selectedJsonItemIds.forEach(n=>{delete r.items[n]}),t.selectedJsonItemIds=[]},injected(){},changeGridResolution(e,{payload:t}){const r=e;r.halfGridResolution=t},changeWallsFloorsLocked(e,{payload:t}){const r=e;r.wallsFloorsLocked=t},changeDragInProgress(e,{payload:t}){const r=e;r.dragInProgress=t},...He,...Be},selectors:{selectCurrentEditingRoomJson:v,selectCurrentEditingRoomColour:e=>v(e).color,selectCurrentEditingRoomScenery:e=>v(e).planet,selectTool:e=>e.tool,selectSelectedJsonItemIds:e=>e.selectedJsonItemIds,selectHoveredJsonItemId:e=>e.hoveredJsonItemId,...Oe}}),{applyToolToRoomJson:je,changeDragInProgress:Me,changeGridResolution:Le,changeRoomColour:Xe,changeRoomScenery:Ue,changeToRoom:Ge,changeWallsFloorsLocked:Ke,deleteSelected:Ne,injected:Ye,moveItemInRoom:Qe,redo:Ve,roomJsonEdited:Ze,setClickableAnnotationHovered:et,setHoveredItemInRoom:tt,setSelectedItemInRoom:rt,setTool:ot,undo:nt}=q.actions,{selectCanRedo:st,selectCanUndo:it,selectCurrentEditingRoomColour:at,selectCurrentEditingRoomJson:lt,selectCurrentEditingRoomScenery:ct,selectHoveredJsonItemId:dt,selectSelectedJsonItemIds:ut,selectTool:yt}=q.selectors,ft=ae.withTypes(),Rt=Object.freeze(Object.defineProperty({__proto__:null,applyToolToRoomJson:je,changeDragInProgress:Me,changeGridResolution:Le,changeRoomColour:Xe,changeRoomScenery:Ue,changeToRoom:Ge,changeWallsFloorsLocked:Ke,deleteSelected:Ne,initialLevelEditorSliceState:z,injected:Ye,levelEditorSlice:q,moveItemInRoom:Qe,redo:Ve,roomJsonEdited:Ze,selectCanRedo:st,selectCanUndo:it,selectCurrentEditingRoomColour:at,selectCurrentEditingRoomJson:lt,selectCurrentEditingRoomScenery:ct,selectHoveredJsonItemId:dt,selectSelectedJsonItemIds:ut,selectTool:yt,setClickableAnnotationHovered:et,setHoveredItemInRoom:tt,setSelectedItemInRoom:rt,setTool:ot,undo:nt,useAppSelectorWithLevelEditorSlice:ft},Symbol.toStringTag,{value:"Module"}));export{vt as A,Ae as B,It as C,bt as D,ht as E,et as F,dt as G,ut as H,De as I,Qe as J,Me as K,rt as L,je as M,tt as N,Ze as O,Rt as P,ot as a,at as b,Le as c,Ne as d,Xe as e,ct as f,Ue as g,it as h,st as i,nt as j,Ke as k,lt as l,x as m,Ge as n,pt as o,g as p,_e as q,Ve as r,yt as s,kt as t,ft as u,Ee as v,Ce as w,Y as x,wt as y,gt as z};
