import{S as tt,G as et,a as nt,V as rt,b as T,d as x,v as p,D as ot,n as U,R as L,C as v,c as W,f as st,e as it,h as q}from"./index-DX2RepLW.js";const at={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},y=0,P=1,F=2,O=3,G=4,R=5,V=class Y{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<y)}set blend(t){!!(this.data&1<<y)!==t&&(this.data^=1<<y)}get offsets(){return!!(this.data&1<<P)}set offsets(t){!!(this.data&1<<P)!==t&&(this.data^=1<<P)}set cullMode(t){if(t==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=t==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<F)}set culling(t){!!(this.data&1<<F)!==t&&(this.data^=1<<F)}get depthTest(){return!!(this.data&1<<O)}set depthTest(t){!!(this.data&1<<O)!==t&&(this.data^=1<<O)}get depthMask(){return!!(this.data&1<<R)}set depthMask(t){!!(this.data&1<<R)!==t&&(this.data^=1<<R)}get clockwiseFrontFace(){return!!(this.data&1<<G)}set clockwiseFrontFace(t){!!(this.data&1<<G)!==t&&(this.data^=1<<G)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!=="none",this._blendMode=t,this._blendModeId=at[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Y;return t.depthTest=!1,t.blend=!0,t}};V.default2d=V.for2d();let lt=V;const j=class z extends tt{constructor(t){t={...z.defaultOptions,...t},super(t),this.enabled=!0,this._state=lt.for2d(),this.blendMode=t.blendMode,this.padding=t.padding,typeof t.antialias=="boolean"?this.antialias=t.antialias?"on":"off":this.antialias=t.antialias,this.resolution=t.resolution,this.blendRequired=t.blendRequired,this.clipToViewport=t.clipToViewport,this.addResource("uTexture",0,1),t.blendRequired&&this.addResource("uBackTexture",0,3)}apply(t,e,n,r){t.applyFilter(this,e,n,r)}get blendMode(){return this._state.blendMode}set blendMode(t){this._state.blendMode=t}static from(t){const{gpu:e,gl:n,...r}=t;let s,l;return e&&(s=et.from(e)),n&&(l=nt.from(n)),new z({gpuProgram:s,glProgram:l,...r})}};j.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let ft=j;var xt=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;class D extends rt{constructor(t){t instanceof T&&(t={context:t});const{context:e,roundPixels:n,...r}=t||{};super({label:"Graphics",...r}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new T,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=n??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||t?.context===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new D(this._context.clone()):(this._ownedContext=null,new D(this._context))}lineStyle(t,e,n){x(p,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const r={};return t&&(r.width=t),e&&(r.color=e),n&&(r.alpha=n),this.context.strokeStyle=r,this}beginFill(t,e){x(p,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const n={};return t!==void 0&&(n.color=t),e!==void 0&&(n.alpha=e),this.context.fillStyle=n,this}endFill(){x(p,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==T.defaultStrokeStyle.width||t.color!==T.defaultStrokeStyle.color||t.alpha!==T.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return x(p,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return x(p,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return x(p,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return x(p,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return x(p,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return x(p,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}let S=null,g=null;function ht(f,t){S||(S=ot.get().createCanvas(256,128),g=S.getContext("2d",{willReadFrequently:!0}),g.globalCompositeOperation="copy",g.globalAlpha=1),(S.width<f||S.height<t)&&(S.width=U(f),S.height=U(t))}function $(f,t,e){for(let n=0,r=4*e*t;n<t;++n,r+=4)if(f[r+3]!==0)return!1;return!0}function H(f,t,e,n,r){const s=4*t;for(let l=n,o=n*s+4*e;l<=r;++l,o+=s)if(f[o+3]!==0)return!1;return!0}function ct(...f){let t=f[0];t.canvas||(t={canvas:f[0],resolution:f[1]});const{canvas:e}=t,n=Math.min(t.resolution??1,1),r=t.width??e.width,s=t.height??e.height;let l=t.output;if(ht(r,s),!g)throw new TypeError("Failed to get canvas 2D context");g.drawImage(e,0,0,r,s,0,0,r*n,s*n);const c=g.getImageData(0,0,r,s).data;let i=0,a=0,d=r-1,u=s-1;for(;a<s&&$(c,r,a);)++a;if(a===s)return L.EMPTY;for(;$(c,r,u);)--u;for(;H(c,r,i,a,u);)++i;for(;H(c,r,d,a,u);)--d;return++d,++u,g.globalCompositeOperation="source-over",g.strokeRect(i,a,d-i,u-a),g.globalCompositeOperation="copy",l??(l=new L),l.set(i/n,a/n,(d-i)/n,(u-a)/n),l}const N=new L;class dt{getCanvasAndContext(t){const{text:e,style:n,resolution:r=1}=t,s=n._getFinalPadding(),l=v.measureText(e||" ",n),o=Math.ceil(Math.ceil(Math.max(1,l.width)+s*2)*r),c=Math.ceil(Math.ceil(Math.max(1,l.height)+s*2)*r),i=W.getOptimalCanvasAndContext(o,c);this._renderTextToCanvas(e,n,s,r,i);const a=n.trim?ct({canvas:i.canvas,width:o,height:c,resolution:1,output:N}):N.set(0,0,o,c);return{canvasAndContext:i,frame:a}}returnCanvasAndContext(t){W.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,n,r,s){const{canvas:l,context:o}=s,c=st(e),i=v.measureText(t||" ",e),a=i.lines,d=i.lineHeight,u=i.lineWidths,M=i.maxLineWidth,C=i.fontProperties,b=l.height;if(o.resetTransform(),o.scale(r,r),o.textBaseline=e.textBaseline,e._stroke?.width){const w=e._stroke;o.lineWidth=w.width,o.miterLimit=w.miterLimit,o.lineJoin=w.join,o.lineCap=w.cap}o.font=c;let _,m;const X=e.dropShadow?2:1;for(let w=0;w<X;++w){const I=e.dropShadow&&w===0,k=I?Math.ceil(Math.max(1,b)+n*2):0,J=k*r;if(I){o.fillStyle="black",o.strokeStyle="black";const h=e.dropShadow,K=h.color,Q=h.alpha;o.shadowColor=it.shared.setValue(K).setAlpha(Q).toRgbaString();const Z=h.blur*r,B=h.distance*r;o.shadowBlur=Z,o.shadowOffsetX=Math.cos(h.angle)*B,o.shadowOffsetY=Math.sin(h.angle)*B+J}else{if(o.fillStyle=e._fill?q(e._fill,o,i,n*2):null,e._stroke?.width){const h=e._stroke.width*.5+n*2;o.strokeStyle=q(e._stroke,o,i,h)}o.shadowColor="black"}let E=(d-C.fontSize)/2;d-C.fontSize<0&&(E=0);const A=e._stroke?.width??0;for(let h=0;h<a.length;h++)_=A/2,m=A/2+h*d+C.ascent+E,e.align==="right"?_+=M-u[h]:e.align==="center"&&(_+=(M-u[h])/2),e._stroke?.width&&this._drawLetterSpacing(a[h],e,s,_+n,m+n-k,!0),e._fill!==void 0&&this._drawLetterSpacing(a[h],e,s,_+n,m+n-k)}}_drawLetterSpacing(t,e,n,r,s,l=!1){const{context:o}=n,c=e.letterSpacing;let i=!1;if(v.experimentalLetterSpacingSupported&&(v.experimentalLetterSpacing?(o.letterSpacing=`${c}px`,o.textLetterSpacing=`${c}px`,i=!0):(o.letterSpacing="0px",o.textLetterSpacing="0px")),c===0||i){l?o.strokeText(t,r,s):o.fillText(t,r,s);return}let a=r;const d=v.graphemeSegmenter(t);let u=o.measureText(t).width,M=0;for(let C=0;C<d.length;++C){const b=d[C];l?o.strokeText(b,a,s):o.fillText(b,a,s);let _="";for(let m=C+1;m<d.length;++m)_+=d[m];M=o.measureText(_).width,a+=u-M+c,u=M}}}const pt=new dt;export{pt as C,ft as F,D as G,lt as S,xt as v};
