const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebGPURenderer-B-sC3nmz.js","assets/index-Bz-YgbyK.js","assets/index-t4iX262i.css","assets/colorToUniform-KTpA7KSL.js","assets/SharedSystems-D7zJADY-.js","assets/Graphics-DhuGgMmu.js","assets/levelEditorSlice-CWVlKj8H.js","assets/WebGLRenderer-CMO-G8T7.js","assets/JsonRoomEditor-CnM0g8OX.js","assets/JsonRoomEditor-Cpm53wG5.css"])))=>i.map(i=>d[i]);
import{x as Fp,u as ya,y as Jn,s as Up,a5 as Gu,a6 as Et,e as va,E as Ln,a as Hp,C as te,d as Dn,v as Mn,al as q,D as Ti,at as Ft,k as Wp,ad as ln,t as _t,T as Gr,U as Gp,M as qp,au as qr,V as qu,av as Vp,w as Ri,aw as Kp,ax as Xp,j as Jp,ay as wr,az as h,aA as Vu,aB as Ut,aC as p,aD as Yp,aE as Ku,aF as Zp,aG as Qp,aH as pe,aI as pt,aJ as Xu,aK as eg,aL as tg,aM as M,aN as Ge,aO as cn,aP as rg,aQ as ng,aR as og,aS as Ju,$ as le,N as B,aT as At,aU as sg,_ as Wo,Z as Xt,aV as ig,aW as ag,aX as lo,aY as ke,aZ as os,a_ as cr,A as Yu,a$ as Yn,J as un,b0 as lg,b1 as cg,K as Ht,b2 as ur,b3 as Zu,b4 as Qe,b5 as ug,I as dg,a1 as ss,b6 as wa,b7 as ba,b8 as In,Q as en,b9 as hg,ba as Qu,bb as jn,bc as xa,bd as fg,be as _a,bf as pg,bg as br,a0 as gg,bh as mg,bi as Sa,bj as Ro,bk as yl,bl as yg,bm as vg,bn as wg,bo as ka,bp as bg,W as xg,z as As,L as _g,bq as ed,br as dn,bs as Sg,bt as kg,bu as Cg,bv as Pg,bw as Eg,bx as Ag,by as Tg,bz as Rg,bA as Og,bB as Ig,bC as jg,bD as $g}from"./index-Bz-YgbyK.js";import{r as zg,u as be,d as td,c as Ng,s as lr,a as Wt,b as Lg,e as vl,f as Dg,g as Mg,h as Bg,i as Fg,j as rd,k as nd,l as Ug,m as Go,n as Hg,o as Wg,p as od,q as Ts,t as sd,v as Gg,w as Oi,x as ee,y as Zn,z as hr,A as id,B as Ca,C as X,D as we,E as qg,F as Vg,G as Pa,H as Bn,I as Fn,J as Kg,K as Ea,L as ad,M as ld,N as Rs,O as Xg,P as wl,Q as cd,R as Jg,S as Oo,T as Yg,U as Zg,V as bl,W as Qg,X as Os,Y as em,Z as ud,_ as xl,$ as tm,a0 as rm,a1 as nm}from"./levelEditorSlice-CWVlKj8H.js";import{S as om,G as ct}from"./Graphics-DhuGgMmu.js";var co={},_l;function sm(){if(_l)return co;_l=1;var t=Fp(),e=t.mark(s),r=ya(),n=r.wrapWithIterableIterator,o=r.ensureIterable;function s(){var a,l,c,u,d,f,g=arguments;return t.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:for(a=g.length,l=new Array(a),c=0;c<a;c++)l[c]=g[c];u=0,d=l;case 2:if(!(u<d.length)){m.next=8;break}return f=d[u],m.delegateYield(o(f),"t0",5);case 5:u++,m.next=2;break;case 8:case"end":return m.stop()}},e)}co.__concat=s;var i=n(s);return co.concat=i,co}var uo={},Sl;function im(){if(Sl)return uo;Sl=1;var t=ya(),e=t.iterableCurry,r=zg(),n=r.__firstOr,o=Symbol("none");function s(a){return n(a,o)===o}uo.__isEmpty=s;var i=e(s,{reduces:!0});return uo.isEmpty=i,uo}var ho={},kl;function am(){if(kl)return ho;kl=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,g=!1,y;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return f=v.done,v},e:function(v){g=!0,y=v},f:function(){try{!f&&c.return!=null&&c.return()}finally{if(g)throw y}}}}function e(a,l){if(a){if(typeof a=="string")return r(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return r(a,l)}}function r(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var n=ya(),o=n.ensureIterable;function s(a){var l=o(a),c=0,u=t(l),d;try{for(u.s();!(d=u.n()).done;){var f=d.value;c++}}catch(g){u.e(g)}finally{u.f()}return c}ho.__size=s;var i=s;return ho.size=i,ho}var Is,Cl;function lm(){return Cl||(Cl=1,Is=sm().concat),Is}var cm=lm();const Pl=Jn(cm);var js,El;function um(){return El||(El=1,js=im().isEmpty),js}var dm=um();const Aa=Jn(dm);var $s,Al;function hm(){return Al||(Al=1,$s=am().size),$s}var fm=hm();const dd=Jn(fm),hd=class Ii extends Up{constructor(e){e={...Ii.defaultOptions,...e},super(e),this.enabled=!0,this._state=om.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(e,r,n,o){e.applyFilter(this,r,n,o)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:r,gl:n,...o}=e;let s,i;return r&&(s=Gu.from(r)),n&&(i=Et.from(n)),new Ii({gpuProgram:s,glProgram:i,...o})}};hd.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let Jt=hd;const ji=[];va.handleByNamedList(Ln.Environment,ji);async function pm(t){if(!t)for(let e=0;e<ji.length;e++){const r=ji[e];if(r.value.test()){await r.value.load();return}}}let vn;function gm(){if(typeof vn=="boolean")return vn;try{vn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{vn=!1}return vn}var fd=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(fd||{});class mm{constructor(e){this.items=[],this._name=e}emit(e,r,n,o,s,i,a,l){const{name:c,items:u}=this;for(let d=0,f=u.length;d<f;d++)u[d][c](e,r,n,o,s,i,a,l);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const r=this.items.indexOf(e);return r!==-1&&this.items.splice(r,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const ym=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],pd=class gd extends Hp{constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;const r=[...ym,...this.config.runners??[]];this._addRunners(...r),this._unsafeEvalCheck()}async init(e={}){const r=e.skipExtensionImports===!0?!0:e.manageImports===!1;await pm(r),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const n in this._systemsHash)e={...this._systemsHash[n].constructor.defaultOptions,...e};e={...gd.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let n=0;n<this.runners.init.items.length;n++)await this.runners.init.items[n].init(e);this._initOptions=e}render(e,r){let n=e;if(n instanceof te&&(n={container:n},r&&(Dn(Mn,"passing a second argument is deprecated, please use render options instead"),n.target=r.renderTexture)),n.target||(n.target=this.view.renderTarget),n.target===this.view.renderTarget&&(this._lastObjectRendered=n.container,n.clearColor??(n.clearColor=this.background.colorRgba),n.clear??(n.clear=this.background.clearBeforeRender)),n.clearColor){const o=Array.isArray(n.clearColor)&&n.clearColor.length===4;n.clearColor=o?n.clearColor:q.shared.setValue(n.clearColor).toArray()}n.transform||(n.container.updateLocalTransform(),n.transform=n.container.localTransform),n.container.enableRenderGroup(),this.runners.prerender.emit(n),this.runners.renderStart.emit(n),this.runners.render.emit(n),this.runners.renderEnd.emit(n),this.runners.postrender.emit(n)}resize(e,r,n){const o=this.view.resolution;this.view.resize(e,r,n),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),n!==void 0&&n!==o&&this.runners.resolutionChange.emit(n)}clear(e={}){const r=this;e.target||(e.target=r.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=fd.ALL);const{clear:n,clearColor:o,target:s}=e;q.shared.setValue(o??this.background.colorRgba),r.renderTarget.clear(s,n,q.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(r=>{this.runners[r]=new mm(r)})}_addSystems(e){let r;for(r in e){const n=e[r];this._addSystem(n.value,n.name)}}_addSystem(e,r){const n=new e(this);if(this[r])throw new Error(`Whoops! The name "${r}" is already in use`);this[r]=n,this._systemsHash[r]=n;for(const o in this.runners)this.runners[o].add(n);return this}_addPipes(e,r){const n=r.reduce((o,s)=>(o[s.name]=s.value,o),{});e.forEach(o=>{const s=o.value,i=o.name,a=n[i];this.renderPipes[i]=new s(this,a?new a:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(r=>{r.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!gm())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};pd.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let md=pd,fo;function vm(t){return fo!==void 0||(fo=(()=>{const e={stencil:!0,failIfMajorPerformanceCaveat:t??md.defaultOptions.failIfMajorPerformanceCaveat};try{if(!Ti.get().getWebGLRenderingContext())return!1;let n=Ti.get().createCanvas().getContext("webgl",e);const o=!!n?.getContextAttributes()?.stencil;if(n){const s=n.getExtension("WEBGL_lose_context");s&&s.loseContext()}return n=null,o}catch{return!1}})()),fo}let po;async function wm(t={}){return po!==void 0||(po=await(async()=>{const e=Ti.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(t)).requestDevice(),!0}catch{return!1}})()),po}const Tl=["webgl","webgpu","canvas"];async function bm(t){let e=[];t.preference?(e.push(t.preference),Tl.forEach(s=>{s!==t.preference&&e.push(s)})):e=Tl.slice();let r,n={};for(let s=0;s<e.length;s++){const i=e[s];if(i==="webgpu"&&await wm()){const{WebGPURenderer:a}=await Ft(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-B-sC3nmz.js");return{WebGPURenderer:l}},__vite__mapDeps([0,1,2,3,4,5,6]));r=a,n={...t,...t.webgpu};break}else if(i==="webgl"&&vm(t.failIfMajorPerformanceCaveat??md.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await Ft(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-CMO-G8T7.js");return{WebGLRenderer:l}},__vite__mapDeps([7,1,2,3,4,5,6]));r=a,n={...t,...t.webgl};break}else if(i==="canvas")throw n={...t},new Error("CanvasRenderer is not yet implemented")}if(delete n.webgpu,delete n.webgl,!r)throw new Error("No available renderer for the current environment");const o=new r;return await o.init(n),o}const yd="8.8.1";class vd{static init(){globalThis.__PIXI_APP_INIT__?.(this,yd)}static destroy(){}}vd.extension=Ln.Application;class xm{constructor(e){this._renderer=e}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,yd)}destroy(){this._renderer=null}}xm.extension={type:[Ln.WebGLSystem,Ln.WebGPUSystem],name:"initHook",priority:-10};const wd=class $i{constructor(...e){this.stage=new te,e[0]!==void 0&&Dn(Mn,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await bm(e),$i._plugins.forEach(r=>{r.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return Dn(Mn,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,r=!1){const n=$i._plugins.slice(0);n.reverse(),n.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(r),this.stage=null,this.renderer.destroy(e),this.renderer=null}};wd._plugins=[];let bd=wd;va.handleByList(Ln.Application,bd._plugins);va.add(vd);var _m=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Sm=`
in vec2 vTextureCoord;

out vec4 finalColor;

uniform float uAlpha;
uniform sampler2D uTexture;

void main()
{
    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;
}
`,Rl=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
 
    var sample = textureSample(uTexture, uSampler, uv);
    
    return sample * alphaUniforms.uAlpha;
}`;const xd=class _d extends Jt{constructor(e){e={..._d.defaultOptions,...e};const r=Gu.from({vertex:{source:Rl,entryPoint:"mainVertex"},fragment:{source:Rl,entryPoint:"mainFragment"}}),n=Et.from({vertex:_m,fragment:Sm,name:"alpha-filter"}),{alpha:o,...s}=e,i=new Wp({uAlpha:{value:o,type:"f32"}});super({...s,gpuProgram:r,glProgram:n,resources:{alphaUniforms:i}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(e){this.resources.alphaUniforms.uniforms.uAlpha=e}};xd.defaultOptions={alpha:1};let km=xd;class Un extends ln{constructor(...e){let r=e[0];Array.isArray(e[0])&&(r={textures:e[0],autoUpdate:e[1]});const{animationSpeed:n=1,autoPlay:o=!1,autoUpdate:s=!0,loop:i=!0,onComplete:a=null,onFrameChange:l=null,onLoop:c=null,textures:u,updateAnchor:d=!1,...f}=r,[g]=u;super({...f,texture:g instanceof _t?g:g.texture}),this._textures=null,this._durations=null,this._autoUpdate=s,this._isConnectedToTicker=!1,this.animationSpeed=n,this.loop=i,this.updateAnchor=d,this.onComplete=a,this.onFrameChange=l,this.onLoop=c,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=u,o&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Gr.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Gr.shared.add(this.update,this,Gp.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const r=e.deltaTime,n=this.animationSpeed*r,o=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=n/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*r);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=n;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o||this.animationSpeed<0&&this.currentFrame>o)&&this.onLoop(),this._updateTexture())}_updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const r=[];for(let n=0;n<e.length;++n)r.push(_t.from(e[n]));return new Un(r)}static fromImages(e){const r=[];for(let n=0;n<e.length;++n)r.push(_t.from(e[n]));return new Un(r)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof _t)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let r=0;r<e.length;r++)this._textures.push(e[r].texture),this._durations.push(e[r].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const r=this.currentFrame;this._currentTime=e,r!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Gr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Gr.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class Cm{constructor({matrix:e,observer:r}={}){this.dirty=!0,this._matrix=e??new qp,this.observer=r,this.position=new qr(this,0,0),this.scale=new qr(this,1,1),this.pivot=new qr(this,0,0),this.skew=new qr(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}_onUpdate(e){this.dirty=!0,e===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}}const Sd=class Io extends qu{constructor(...e){let r=e[0]||{};r instanceof _t&&(r={texture:r}),e.length>1&&(Dn(Mn,"use new TilingSprite({ texture, width:100, height:100 }) instead"),r.width=e[1],r.height=e[2]),r={...Io.defaultOptions,...r};const{texture:n,anchor:o,tilePosition:s,tileScale:i,tileRotation:a,width:l,height:c,applyAnchorToTexture:u,roundPixels:d,...f}=r??{};super({label:"TilingSprite",...f}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new qr({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=u,this.texture=n,this._width=l??n.width,this._height=c??n.height,this._tileTransform=new Cm({observer:{_onUpdate:()=>this.onViewUpdate()}}),o&&(this.anchor=o),this.tilePosition=s,this.tileScale=i,this.tileRotation=a,this.roundPixels=d??!1}static from(e,r={}){return typeof e=="string"?new Io({texture:Vp.get(e),...r}):new Io({texture:e,...r})}get uvRespectAnchor(){return Ri("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){Ri("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){typeof e=="number"?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=_t.EMPTY);const r=this._texture;r!==e&&(r&&r.dynamic&&r.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,r){typeof e=="object"&&(r=e.height??e.width,e=e.width),this._width=e,this._height=r??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){const e=this._bounds,r=this._anchor,n=this._width,o=this._height;e.minX=-r._x*n,e.maxX=e.minX+n,e.minY=-r._y*o,e.maxY=e.minY+o}containsPoint(e){const r=this._width,n=this._height,o=-r*this._anchor._x;let s=0;return e.x>=o&&e.x<=o+r&&(s=-n*this._anchor._y,e.y>=s&&e.y<=s+n)}destroy(e=!1){if(super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof e=="boolean"?e:e?.texture){const n=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(n)}this._texture=null}};Sd.defaultOptions={texture:_t.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let Pm=Sd;class Em extends qu{constructor(e,r){const{text:n,resolution:o,style:s,anchor:i,width:a,height:l,roundPixels:c,...u}=e;super({...u}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=r,this.text=n??"",this.style=s,this.resolution=o??null,this.allowChildren=!1,this._anchor=new qr({_onUpdate:()=>{this.onViewUpdate()}}),i&&(this.anchor=i),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){e||(e={}),this._style?.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,r){typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,this.bounds.width),r!==void 0&&this._setHeight(r,this.bounds.height)}containsPoint(e){const r=this.bounds.width,n=this.bounds.height,o=-r*this.anchor.x;let s=0;return e.x>=o&&e.x<=o+r&&(s=-n*this.anchor.y,e.y>=s&&e.y<=s+n)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e?.style)&&this._style.destroy(e),this._style=null,this._text=null}}function Am(t,e){let r=t[0]??{};return(typeof r=="string"||t[1])&&(Dn(Mn,`use new ${e}({ text: "hi!", style }) instead`),r={text:r,style:t[1]}),r}class Tm extends Em{constructor(...e){const r=Am(e,"Text");super(r,Kp),this.renderPipeId="text"}updateBounds(){const e=this._bounds,r=this._anchor,n=Xp.measureText(this._text,this._style),{width:o,height:s}=n;e.minX=-r._x*o,e.maxX=e.minX+o,e.minY=-r._y*s,e.maxY=e.minY+s}}class Ta extends _t{static create(e){return new Ta({source:new Jp(e)})}resize(e,r,n){return this.source.resize(e,r,n),this}}const kd=class Cd extends te{constructor(e={}){e={...Cd.defaultOptions,...e},super(),this.renderLayerChildren=[],this.sortableChildren=e.sortableChildren,this.sortFunction=e.sortFunction}attach(...e){for(let r=0;r<e.length;r++){const n=e[r];if(n.parentRenderLayer){if(n.parentRenderLayer===this)continue;n.parentRenderLayer.detach(n)}this.renderLayerChildren.push(n),n.parentRenderLayer=this;const o=this.renderGroup||this.parentRenderGroup;o&&(o.structureDidChange=!0)}return e[0]}detach(...e){for(let r=0;r<e.length;r++){const n=e[r],o=this.renderLayerChildren.indexOf(n);o!==-1&&this.renderLayerChildren.splice(o,1),n.parentRenderLayer=null;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)}return e[0]}detachAll(){const e=this.renderLayerChildren;for(let r=0;r<e.length;r++)e[r].parentRenderLayer=null;this.renderLayerChildren.length=0}collectRenderables(e,r,n){const o=this.renderLayerChildren,s=o.length;this.sortableChildren&&this.sortRenderLayerChildren();for(let i=0;i<s;i++)o[i].parent||Ri("Container must be added to both layer and scene graph. Layers only handle render order - the scene graph is required for transforms (addChild)",o[i]),o[i].collectRenderables(e,r,this)}sortRenderLayerChildren(){this.renderLayerChildren.sort(this.sortFunction)}_getGlobalBoundsRecursive(e,r,n){if(!e)return;const o=this.renderLayerChildren;for(let s=0;s<o.length;s++)o[s]._getGlobalBoundsRecursive(!0,r,this)}};kd.defaultOptions={sortableChildren:!1,sortFunction:(t,e)=>t.zIndex-e.zIndex};let Rm=kd;const Ol=Rm,Ra="-",Om=t=>{const e=jm(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:i=>{const a=i.split(Ra);return a[0]===""&&a.length!==1&&a.shift(),Pd(a,e)||Im(i)},getConflictingClassGroupIds:(i,a)=>{const l=r[i]||[];return a&&n[i]?[...l,...n[i]]:l}}},Pd=(t,e)=>{if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),o=n?Pd(t.slice(1),n):void 0;if(o)return o;if(e.validators.length===0)return;const s=t.join(Ra);return e.validators.find(({validator:i})=>i(s))?.classGroupId},Il=/^\[(.+)\]$/,Im=t=>{if(Il.test(t)){const e=Il.exec(t)[1],r=e?.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},jm=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return zm(Object.entries(t.classGroups),r).forEach(([s,i])=>{zi(i,n,s,e)}),n},zi=(t,e,r,n)=>{t.forEach(o=>{if(typeof o=="string"){const s=o===""?e:jl(e,o);s.classGroupId=r;return}if(typeof o=="function"){if($m(o)){zi(o(n),e,r,n);return}e.validators.push({validator:o,classGroupId:r});return}Object.entries(o).forEach(([s,i])=>{zi(i,jl(e,s),r,n)})})},jl=(t,e)=>{let r=t;return e.split(Ra).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},$m=t=>t.isThemeGetter,zm=(t,e)=>e?t.map(([r,n])=>{const o=n.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([i,a])=>[e+i,a])):s);return[r,o]}):t,Nm=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const o=(s,i)=>{r.set(s,i),e++,e>t&&(e=0,n=r,r=new Map)};return{get(s){let i=r.get(s);if(i!==void 0)return i;if((i=n.get(s))!==void 0)return o(s,i),i},set(s,i){r.has(s)?r.set(s,i):o(s,i)}}},Ed="!",Lm=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,o=e[0],s=e.length,i=a=>{const l=[];let c=0,u=0,d;for(let v=0;v<a.length;v++){let w=a[v];if(c===0){if(w===o&&(n||a.slice(v,v+s)===e)){l.push(a.slice(u,v)),u=v+s;continue}if(w==="/"){d=v;continue}}w==="["?c++:w==="]"&&c--}const f=l.length===0?a:a.substring(u),g=f.startsWith(Ed),y=g?f.substring(1):f,m=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:g,baseClassName:y,maybePostfixModifierPosition:m}};return r?a=>r({className:a,parseClassName:i}):i},Dm=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},Mm=t=>({cache:Nm(t.cacheSize),parseClassName:Lm(t),...Om(t)}),Bm=/\s+/,Fm=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:o}=e,s=[],i=t.trim().split(Bm);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:d,baseClassName:f,maybePostfixModifierPosition:g}=r(c);let y=!!g,m=n(y?f.substring(0,g):f);if(!m){if(!y){a=c+(a.length>0?" "+a:a);continue}if(m=n(f),!m){a=c+(a.length>0?" "+a:a);continue}y=!1}const v=Dm(u).join(":"),w=d?v+Ed:v,S=w+m;if(s.includes(S))continue;s.push(S);const b=o(m,y);for(let x=0;x<b.length;++x){const k=b[x];s.push(w+k)}a=c+(a.length>0?" "+a:a)}return a};function Um(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=Ad(e))&&(n&&(n+=" "),n+=r);return n}const Ad=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=Ad(t[n]))&&(r&&(r+=" "),r+=e);return r};function Hm(t,...e){let r,n,o,s=i;function i(l){const c=e.reduce((u,d)=>d(u),t());return r=Mm(c),n=r.cache.get,o=r.cache.set,s=a,a(l)}function a(l){const c=n(l);if(c)return c;const u=Fm(l,r);return o(l,u),u}return function(){return s(Um.apply(null,arguments))}}const ge=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},Td=/^\[(?:([a-z-]+):)?(.+)\]$/i,Wm=/^\d+\/\d+$/,Gm=new Set(["px","full","screen"]),qm=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Vm=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Km=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Xm=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Jm=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,mt=t=>Jr(t)||Gm.has(t)||Wm.test(t),Tt=t=>hn(t,"length",oy),Jr=t=>!!t&&!Number.isNaN(Number(t)),zs=t=>hn(t,"number",Jr),wn=t=>!!t&&Number.isInteger(Number(t)),Ym=t=>t.endsWith("%")&&Jr(t.slice(0,-1)),Y=t=>Td.test(t),Rt=t=>qm.test(t),Zm=new Set(["length","size","percentage"]),Qm=t=>hn(t,Zm,Rd),ey=t=>hn(t,"position",Rd),ty=new Set(["image","url"]),ry=t=>hn(t,ty,iy),ny=t=>hn(t,"",sy),bn=()=>!0,hn=(t,e,r)=>{const n=Td.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},oy=t=>Vm.test(t)&&!Km.test(t),Rd=()=>!1,sy=t=>Xm.test(t),iy=t=>Jm.test(t),ay=()=>{const t=ge("colors"),e=ge("spacing"),r=ge("blur"),n=ge("brightness"),o=ge("borderColor"),s=ge("borderRadius"),i=ge("borderSpacing"),a=ge("borderWidth"),l=ge("contrast"),c=ge("grayscale"),u=ge("hueRotate"),d=ge("invert"),f=ge("gap"),g=ge("gradientColorStops"),y=ge("gradientColorStopPositions"),m=ge("inset"),v=ge("margin"),w=ge("opacity"),S=ge("padding"),b=ge("saturate"),x=ge("scale"),k=ge("sepia"),C=ge("skew"),_=ge("space"),j=ge("translate"),U=()=>["auto","contain","none"],N=()=>["auto","hidden","clip","visible","scroll"],H=()=>["auto",Y,e],I=()=>[Y,e],re=()=>["",mt,Tt],D=()=>["auto",Jr,Y],K=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],W=()=>["solid","dashed","dotted","double","none"],se=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],V=()=>["start","end","center","between","around","evenly","stretch"],ie=()=>["","0",Y],ue=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ce=()=>[Jr,Y];return{cacheSize:500,separator:":",theme:{colors:[bn],spacing:[mt,Tt],blur:["none","",Rt,Y],brightness:ce(),borderColor:[t],borderRadius:["none","","full",Rt,Y],borderSpacing:I(),borderWidth:re(),contrast:ce(),grayscale:ie(),hueRotate:ce(),invert:ie(),gap:I(),gradientColorStops:[t],gradientColorStopPositions:[Ym,Tt],inset:H(),margin:H(),opacity:ce(),padding:I(),saturate:ce(),scale:ce(),sepia:ie(),skew:ce(),space:I(),translate:I()},classGroups:{aspect:[{aspect:["auto","square","video",Y]}],container:["container"],columns:[{columns:[Rt]}],"break-after":[{"break-after":ue()}],"break-before":[{"break-before":ue()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...K(),Y]}],overflow:[{overflow:N()}],"overflow-x":[{"overflow-x":N()}],"overflow-y":[{"overflow-y":N()}],overscroll:[{overscroll:U()}],"overscroll-x":[{"overscroll-x":U()}],"overscroll-y":[{"overscroll-y":U()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[m]}],"inset-x":[{"inset-x":[m]}],"inset-y":[{"inset-y":[m]}],start:[{start:[m]}],end:[{end:[m]}],top:[{top:[m]}],right:[{right:[m]}],bottom:[{bottom:[m]}],left:[{left:[m]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",wn,Y]}],basis:[{basis:H()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Y]}],grow:[{grow:ie()}],shrink:[{shrink:ie()}],order:[{order:["first","last","none",wn,Y]}],"grid-cols":[{"grid-cols":[bn]}],"col-start-end":[{col:["auto",{span:["full",wn,Y]},Y]}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":[bn]}],"row-start-end":[{row:["auto",{span:[wn,Y]},Y]}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Y]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Y]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...V()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...V(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...V(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[S]}],px:[{px:[S]}],py:[{py:[S]}],ps:[{ps:[S]}],pe:[{pe:[S]}],pt:[{pt:[S]}],pr:[{pr:[S]}],pb:[{pb:[S]}],pl:[{pl:[S]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[_]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[_]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Y,e]}],"min-w":[{"min-w":[Y,e,"min","max","fit"]}],"max-w":[{"max-w":[Y,e,"none","full","min","max","fit","prose",{screen:[Rt]},Rt]}],h:[{h:[Y,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Y,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Y,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Y,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Rt,Tt]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",zs]}],"font-family":[{font:[bn]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Y]}],"line-clamp":[{"line-clamp":["none",Jr,zs]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",mt,Y]}],"list-image":[{"list-image":["none",Y]}],"list-style-type":[{list:["none","disc","decimal",Y]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...W(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",mt,Tt]}],"underline-offset":[{"underline-offset":["auto",mt,Y]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Y]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Y]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...K(),ey]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Qm]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},ry]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[g]}],"gradient-via":[{via:[g]}],"gradient-to":[{to:[g]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[...W(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:W()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...W()]}],"outline-offset":[{"outline-offset":[mt,Y]}],"outline-w":[{outline:[mt,Tt]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:re()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[mt,Tt]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Rt,ny]}],"shadow-color":[{shadow:[bn]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":[...se(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":se()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Rt,Y]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[b]}],sepia:[{sepia:[k]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[k]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Y]}],duration:[{duration:ce()}],ease:[{ease:["linear","in","out","in-out",Y]}],delay:[{delay:ce()}],animate:[{animate:["none","spin","ping","pulse","bounce",Y]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[x]}],"scale-x":[{"scale-x":[x]}],"scale-y":[{"scale-y":[x]}],rotate:[{rotate:[wn,Y]}],"translate-x":[{"translate-x":[j]}],"translate-y":[{"translate-y":[j]}],"skew-x":[{"skew-x":[C]}],"skew-y":[{"skew-y":[C]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Y]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Y]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Y]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[mt,Tt,zs]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Od=Hm(ay);function Id(t){if(!qo(t))throw new Error(`Invalid textureId: "${t}"; textureId âˆ‹ {${Object.keys(wr.frames).sort().map(e=>`"${e}"`).join(`,
`)}}`)}function qo(t){return wr.frames[t]!==void 0}function jd(t){return wr.animations[t]!==void 0}const ly=t=>t.replaceAll(".","_"),Z=({children:t,className:e,noSlitWords:r,classnameCycle:n,onClick:o,noTint:s=!1,TagName:i="span"})=>{const a=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(a.length===0)return null;const l=r?[a.toUpperCase()]:a.toUpperCase().split(/\s+/);return h.jsxs(i,{className:e,onClick:o,children:[h.jsx("span",{className:"sr-only",children:a}),l.map((c,u)=>h.jsx("span",{className:Od("text-nowrap inline-block",u===l.length-1?"":"me-1"),children:Array.from(c).map((d,f)=>{const g=`hud.char.${Vu(d)}`;return qo(g)||console.error("no texture for char",d,d.charCodeAt(0),g,"we have:",Object.keys(Ut().textures)),h.jsx("span",{className:`sprite ${qo(g)?`texture-${ly(g)}`:"texture-hud_char_?"}
                  ${s?"":"sprite-tinted"}
                  ${n===void 0?"":n[f%n.length]}`},f)})},u))]})};function Be(t,e,{checkForDefaultPrevented:r=!0}={}){return function(o){if(t?.(o),r===!1||!o.defaultPrevented)return e?.(o)}}function $l(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function $d(...t){return e=>{let r=!1;const n=t.map(o=>{const s=$l(o,e);return!r&&typeof s=="function"&&(r=!0),s});if(r)return()=>{for(let o=0;o<n.length;o++){const s=n[o];typeof s=="function"?s():$l(t[o],null)}}}}function ot(...t){return p.useCallback($d(...t),t)}function cy(t,e){const r=p.createContext(e),n=s=>{const{children:i,...a}=s,l=p.useMemo(()=>a,Object.values(a));return h.jsx(r.Provider,{value:l,children:i})};n.displayName=t+"Provider";function o(s){const i=p.useContext(r);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[n,o]}function Oa(t,e=[]){let r=[];function n(s,i){const a=p.createContext(i),l=r.length;r=[...r,i];const c=d=>{const{scope:f,children:g,...y}=d,m=f?.[t]?.[l]||a,v=p.useMemo(()=>y,Object.values(y));return h.jsx(m.Provider,{value:v,children:g})};c.displayName=s+"Provider";function u(d,f){const g=f?.[t]?.[l]||a,y=p.useContext(g);if(y)return y;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=r.map(i=>p.createContext(i));return function(a){const l=a?.[t]||s;return p.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[n,uy(o,...e)]}function uy(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=n.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return p.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return r.scopeName=e.scopeName,r}var Ia=Yp();const dy=Jn(Ia);var is=p.forwardRef((t,e)=>{const{children:r,...n}=t,o=p.Children.toArray(r),s=o.find(fy);if(s){const i=s.props.children,a=o.map(l=>l===s?p.Children.count(i)>1?p.Children.only(null):p.isValidElement(i)?i.props.children:null:l);return h.jsx(Ni,{...n,ref:e,children:p.isValidElement(i)?p.cloneElement(i,void 0,a):null})}return h.jsx(Ni,{...n,ref:e,children:r})});is.displayName="Slot";var Ni=p.forwardRef((t,e)=>{const{children:r,...n}=t;if(p.isValidElement(r)){const o=gy(r),s=py(n,r.props);return r.type!==p.Fragment&&(s.ref=e?$d(e,o):o),p.cloneElement(r,s)}return p.Children.count(r)>1?p.Children.only(null):null});Ni.displayName="SlotClone";var hy=({children:t})=>h.jsx(h.Fragment,{children:t});function fy(t){return p.isValidElement(t)&&t.type===hy}function py(t,e){const r={...e};for(const n in e){const o=t[n],s=e[n];/^on[A-Z]/.test(n)?o&&s?r[n]=(...a)=>{s(...a),o(...a)}:o&&(r[n]=o):n==="style"?r[n]={...o,...s}:n==="className"&&(r[n]=[o,s].filter(Boolean).join(" "))}return{...t,...r}}function gy(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var my=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ve=my.reduce((t,e)=>{const r=p.forwardRef((n,o)=>{const{asChild:s,...i}=n,a=s?is:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(a,{...i,ref:o})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function yy(t,e){t&&Ia.flushSync(()=>t.dispatchEvent(e))}function Gt(t){const e=p.useRef(t);return p.useEffect(()=>{e.current=t}),p.useMemo(()=>(...r)=>e.current?.(...r),[])}function vy(t,e=globalThis?.document){const r=Gt(t);p.useEffect(()=>{const n=o=>{o.key==="Escape"&&r(o)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[r,e])}var wy="DismissableLayer",Li="dismissableLayer.update",by="dismissableLayer.pointerDownOutside",xy="dismissableLayer.focusOutside",zl,zd=p.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),ja=p.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=p.useContext(zd),[u,d]=p.useState(null),f=u?.ownerDocument??globalThis?.document,[,g]=p.useState({}),y=ot(e,_=>d(_)),m=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),w=m.indexOf(v),S=u?m.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,x=S>=w,k=ky(_=>{const j=_.target,U=[...c.branches].some(N=>N.contains(j));!x||U||(o?.(_),i?.(_),_.defaultPrevented||a?.())},f),C=Cy(_=>{const j=_.target;[...c.branches].some(N=>N.contains(j))||(s?.(_),i?.(_),_.defaultPrevented||a?.())},f);return vy(_=>{S===c.layers.size-1&&(n?.(_),!_.defaultPrevented&&a&&(_.preventDefault(),a()))},f),p.useEffect(()=>{if(u)return r&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(zl=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),Nl(),()=>{r&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=zl)}},[u,f,r,c]),p.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),Nl())},[u,c]),p.useEffect(()=>{const _=()=>g({});return document.addEventListener(Li,_),()=>document.removeEventListener(Li,_)},[]),h.jsx(ve.div,{...l,ref:y,style:{pointerEvents:b?x?"auto":"none":void 0,...t.style},onFocusCapture:Be(t.onFocusCapture,C.onFocusCapture),onBlurCapture:Be(t.onBlurCapture,C.onBlurCapture),onPointerDownCapture:Be(t.onPointerDownCapture,k.onPointerDownCapture)})});ja.displayName=wy;var _y="DismissableLayerBranch",Sy=p.forwardRef((t,e)=>{const r=p.useContext(zd),n=p.useRef(null),o=ot(e,n);return p.useEffect(()=>{const s=n.current;if(s)return r.branches.add(s),()=>{r.branches.delete(s)}},[r.branches]),h.jsx(ve.div,{...t,ref:o})});Sy.displayName=_y;function ky(t,e=globalThis?.document){const r=Gt(t),n=p.useRef(!1),o=p.useRef(()=>{});return p.useEffect(()=>{const s=a=>{if(a.target&&!n.current){let l=function(){Nd(by,r,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);n.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,r]),{onPointerDownCapture:()=>n.current=!0}}function Cy(t,e=globalThis?.document){const r=Gt(t),n=p.useRef(!1);return p.useEffect(()=>{const o=s=>{s.target&&!n.current&&Nd(xy,r,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function Nl(){const t=new CustomEvent(Li);document.dispatchEvent(t)}function Nd(t,e,r,{discrete:n}){const o=r.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&o.addEventListener(t,e,{once:!0}),n?yy(o,s):o.dispatchEvent(s)}var Ns=0;function Ld(){p.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Ll()),document.body.insertAdjacentElement("beforeend",t[1]??Ll()),Ns++,()=>{Ns===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Ns--}},[])}function Ll(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Ls="focusScope.autoFocusOnMount",Ds="focusScope.autoFocusOnUnmount",Dl={bubbles:!1,cancelable:!0},Py="FocusScope",$a=p.forwardRef((t,e)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=t,[a,l]=p.useState(null),c=Gt(o),u=Gt(s),d=p.useRef(null),f=ot(e,m=>l(m)),g=p.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;p.useEffect(()=>{if(n){let m=function(b){if(g.paused||!a)return;const x=b.target;a.contains(x)?d.current=x:zt(d.current,{select:!0})},v=function(b){if(g.paused||!a)return;const x=b.relatedTarget;x!==null&&(a.contains(x)||zt(d.current,{select:!0}))},w=function(b){if(document.activeElement===document.body)for(const k of b)k.removedNodes.length>0&&zt(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",v);const S=new MutationObserver(w);return a&&S.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",v),S.disconnect()}}},[n,a,g.paused]),p.useEffect(()=>{if(a){Bl.add(g);const m=document.activeElement;if(!a.contains(m)){const w=new CustomEvent(Ls,Dl);a.addEventListener(Ls,c),a.dispatchEvent(w),w.defaultPrevented||(Ey(Iy(Dd(a)),{select:!0}),document.activeElement===m&&zt(a))}return()=>{a.removeEventListener(Ls,c),setTimeout(()=>{const w=new CustomEvent(Ds,Dl);a.addEventListener(Ds,u),a.dispatchEvent(w),w.defaultPrevented||zt(m??document.body,{select:!0}),a.removeEventListener(Ds,u),Bl.remove(g)},0)}}},[a,c,u,g]);const y=p.useCallback(m=>{if(!r&&!n||g.paused)return;const v=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,w=document.activeElement;if(v&&w){const S=m.currentTarget,[b,x]=Ay(S);b&&x?!m.shiftKey&&w===x?(m.preventDefault(),r&&zt(b,{select:!0})):m.shiftKey&&w===b&&(m.preventDefault(),r&&zt(x,{select:!0})):w===S&&m.preventDefault()}},[r,n,g.paused]);return h.jsx(ve.div,{tabIndex:-1,...i,ref:f,onKeyDown:y})});$a.displayName=Py;function Ey(t,{select:e=!1}={}){const r=document.activeElement;for(const n of t)if(zt(n,{select:e}),document.activeElement!==r)return}function Ay(t){const e=Dd(t),r=Ml(e,t),n=Ml(e.reverse(),t);return[r,n]}function Dd(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const o=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||o?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function Ml(t,e){for(const r of t)if(!Ty(r,{upTo:e}))return r}function Ty(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Ry(t){return t instanceof HTMLInputElement&&"select"in t}function zt(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&Ry(t)&&e&&t.select()}}var Bl=Oy();function Oy(){let t=[];return{add(e){const r=t[0];e!==r&&r?.pause(),t=Fl(t,e),t.unshift(e)},remove(e){t=Fl(t,e),t[0]?.resume()}}}function Fl(t,e){const r=[...t],n=r.indexOf(e);return n!==-1&&r.splice(n,1),r}function Iy(t){return t.filter(e=>e.tagName!=="A")}var fr=globalThis?.document?p.useLayoutEffect:()=>{},jy=Ku.useId||(()=>{}),$y=0;function ut(t){const[e,r]=p.useState(jy());return fr(()=>{r(n=>n??String($y++))},[t]),t||(e?`radix-${e}`:"")}const zy=["top","right","bottom","left"],qt=Math.min,Me=Math.max,Vo=Math.round,go=Math.floor,dt=t=>({x:t,y:t}),Ny={left:"right",right:"left",bottom:"top",top:"bottom"},Ly={start:"end",end:"start"};function Di(t,e,r){return Me(t,qt(e,r))}function kt(t,e){return typeof t=="function"?t(e):t}function Ct(t){return t.split("-")[0]}function fn(t){return t.split("-")[1]}function za(t){return t==="x"?"y":"x"}function Na(t){return t==="y"?"height":"width"}function Vt(t){return["top","bottom"].includes(Ct(t))?"y":"x"}function La(t){return za(Vt(t))}function Dy(t,e,r){r===void 0&&(r=!1);const n=fn(t),o=La(t),s=Na(o);let i=o==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(i=Ko(i)),[i,Ko(i)]}function My(t){const e=Ko(t);return[Mi(t),e,Mi(e)]}function Mi(t){return t.replace(/start|end/g,e=>Ly[e])}function By(t,e,r){const n=["left","right"],o=["right","left"],s=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return r?e?o:n:e?n:o;case"left":case"right":return e?s:i;default:return[]}}function Fy(t,e,r,n){const o=fn(t);let s=By(Ct(t),r==="start",n);return o&&(s=s.map(i=>i+"-"+o),e&&(s=s.concat(s.map(Mi)))),s}function Ko(t){return t.replace(/left|right|bottom|top/g,e=>Ny[e])}function Uy(t){return{top:0,right:0,bottom:0,left:0,...t}}function Md(t){return typeof t!="number"?Uy(t):{top:t,right:t,bottom:t,left:t}}function Xo(t){const{x:e,y:r,width:n,height:o}=t;return{width:n,height:o,top:r,left:e,right:e+n,bottom:r+o,x:e,y:r}}function Ul(t,e,r){let{reference:n,floating:o}=t;const s=Vt(e),i=La(e),a=Na(i),l=Ct(e),c=s==="y",u=n.x+n.width/2-o.width/2,d=n.y+n.height/2-o.height/2,f=n[a]/2-o[a]/2;let g;switch(l){case"top":g={x:u,y:n.y-o.height};break;case"bottom":g={x:u,y:n.y+n.height};break;case"right":g={x:n.x+n.width,y:d};break;case"left":g={x:n.x-o.width,y:d};break;default:g={x:n.x,y:n.y}}switch(fn(e)){case"start":g[i]-=f*(r&&c?-1:1);break;case"end":g[i]+=f*(r&&c?-1:1);break}return g}const Hy=async(t,e,r)=>{const{placement:n="bottom",strategy:o="absolute",middleware:s=[],platform:i}=r,a=s.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:o}),{x:u,y:d}=Ul(c,n,l),f=n,g={},y=0;for(let m=0;m<a.length;m++){const{name:v,fn:w}=a[m],{x:S,y:b,data:x,reset:k}=await w({x:u,y:d,initialPlacement:n,placement:f,strategy:o,middlewareData:g,rects:c,platform:i,elements:{reference:t,floating:e}});u=S??u,d=b??d,g={...g,[v]:{...g[v],...x}},k&&y<=50&&(y++,typeof k=="object"&&(k.placement&&(f=k.placement),k.rects&&(c=k.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:o}):k.rects),{x:u,y:d}=Ul(c,f,l)),m=-1)}return{x:u,y:d,placement:f,strategy:o,middlewareData:g}};async function Hn(t,e){var r;e===void 0&&(e={});const{x:n,y:o,platform:s,rects:i,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:g=0}=kt(e,t),y=Md(g),v=a[f?d==="floating"?"reference":"floating":d],w=Xo(await s.getClippingRect({element:(r=await(s.isElement==null?void 0:s.isElement(v)))==null||r?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),S=d==="floating"?{x:n,y:o,width:i.floating.width,height:i.floating.height}:i.reference,b=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),x=await(s.isElement==null?void 0:s.isElement(b))?await(s.getScale==null?void 0:s.getScale(b))||{x:1,y:1}:{x:1,y:1},k=Xo(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:S,offsetParent:b,strategy:l}):S);return{top:(w.top-k.top+y.top)/x.y,bottom:(k.bottom-w.bottom+y.bottom)/x.y,left:(w.left-k.left+y.left)/x.x,right:(k.right-w.right+y.right)/x.x}}const Wy=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:n,placement:o,rects:s,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=kt(t,e)||{};if(c==null)return{};const d=Md(u),f={x:r,y:n},g=La(o),y=Na(g),m=await i.getDimensions(c),v=g==="y",w=v?"top":"left",S=v?"bottom":"right",b=v?"clientHeight":"clientWidth",x=s.reference[y]+s.reference[g]-f[g]-s.floating[y],k=f[g]-s.reference[g],C=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let _=C?C[b]:0;(!_||!await(i.isElement==null?void 0:i.isElement(C)))&&(_=a.floating[b]||s.floating[y]);const j=x/2-k/2,U=_/2-m[y]/2-1,N=qt(d[w],U),H=qt(d[S],U),I=N,re=_-m[y]-H,D=_/2-m[y]/2+j,K=Di(I,D,re),W=!l.arrow&&fn(o)!=null&&D!==K&&s.reference[y]/2-(D<I?N:H)-m[y]/2<0,se=W?D<I?D-I:D-re:0;return{[g]:f[g]+se,data:{[g]:K,centerOffset:D-K-se,...W&&{alignmentOffset:se}},reset:W}}}),Gy=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,n;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:g="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:m=!0,...v}=kt(t,e);if((r=s.arrow)!=null&&r.alignmentOffset)return{};const w=Ct(o),S=Vt(a),b=Ct(a)===a,x=await(l.isRTL==null?void 0:l.isRTL(c.floating)),k=f||(b||!m?[Ko(a)]:My(a)),C=y!=="none";!f&&C&&k.push(...Fy(a,m,y,x));const _=[a,...k],j=await Hn(e,v),U=[];let N=((n=s.flip)==null?void 0:n.overflows)||[];if(u&&U.push(j[w]),d){const D=Dy(o,i,x);U.push(j[D[0]],j[D[1]])}if(N=[...N,{placement:o,overflows:U}],!U.every(D=>D<=0)){var H,I;const D=(((H=s.flip)==null?void 0:H.index)||0)+1,K=_[D];if(K)return{data:{index:D,overflows:N},reset:{placement:K}};let W=(I=N.filter(se=>se.overflows[0]<=0).sort((se,V)=>se.overflows[1]-V.overflows[1])[0])==null?void 0:I.placement;if(!W)switch(g){case"bestFit":{var re;const se=(re=N.filter(V=>{if(C){const ie=Vt(V.placement);return ie===S||ie==="y"}return!0}).map(V=>[V.placement,V.overflows.filter(ie=>ie>0).reduce((ie,ue)=>ie+ue,0)]).sort((V,ie)=>V[1]-ie[1])[0])==null?void 0:re[0];se&&(W=se);break}case"initialPlacement":W=a;break}if(o!==W)return{reset:{placement:W}}}return{}}}};function Hl(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Wl(t){return zy.some(e=>t[e]>=0)}const qy=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:n="referenceHidden",...o}=kt(t,e);switch(n){case"referenceHidden":{const s=await Hn(e,{...o,elementContext:"reference"}),i=Hl(s,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:Wl(i)}}}case"escaped":{const s=await Hn(e,{...o,altBoundary:!0}),i=Hl(s,r.floating);return{data:{escapedOffsets:i,escaped:Wl(i)}}}default:return{}}}}};async function Vy(t,e){const{placement:r,platform:n,elements:o}=t,s=await(n.isRTL==null?void 0:n.isRTL(o.floating)),i=Ct(r),a=fn(r),l=Vt(r)==="y",c=["left","top"].includes(i)?-1:1,u=s&&l?-1:1,d=kt(e,t);let{mainAxis:f,crossAxis:g,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof y=="number"&&(g=a==="end"?y*-1:y),l?{x:g*u,y:f*c}:{x:f*c,y:g*u}}const Ky=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,n;const{x:o,y:s,placement:i,middlewareData:a}=e,l=await Vy(e,t);return i===((r=a.offset)==null?void 0:r.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:o+l.x,y:s+l.y,data:{...l,placement:i}}}}},Xy=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:n,placement:o}=e,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:v=>{let{x:w,y:S}=v;return{x:w,y:S}}},...l}=kt(t,e),c={x:r,y:n},u=await Hn(e,l),d=Vt(Ct(o)),f=za(d);let g=c[f],y=c[d];if(s){const v=f==="y"?"top":"left",w=f==="y"?"bottom":"right",S=g+u[v],b=g-u[w];g=Di(S,g,b)}if(i){const v=d==="y"?"top":"left",w=d==="y"?"bottom":"right",S=y+u[v],b=y-u[w];y=Di(S,y,b)}const m=a.fn({...e,[f]:g,[d]:y});return{...m,data:{x:m.x-r,y:m.y-n,enabled:{[f]:s,[d]:i}}}}}},Jy=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:n,placement:o,rects:s,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=kt(t,e),u={x:r,y:n},d=Vt(o),f=za(d);let g=u[f],y=u[d];const m=kt(a,e),v=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const b=f==="y"?"height":"width",x=s.reference[f]-s.floating[b]+v.mainAxis,k=s.reference[f]+s.reference[b]-v.mainAxis;g<x?g=x:g>k&&(g=k)}if(c){var w,S;const b=f==="y"?"width":"height",x=["top","left"].includes(Ct(o)),k=s.reference[d]-s.floating[b]+(x&&((w=i.offset)==null?void 0:w[d])||0)+(x?0:v.crossAxis),C=s.reference[d]+s.reference[b]+(x?0:((S=i.offset)==null?void 0:S[d])||0)-(x?v.crossAxis:0);y<k?y=k:y>C&&(y=C)}return{[f]:g,[d]:y}}}},Yy=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var r,n;const{placement:o,rects:s,platform:i,elements:a}=e,{apply:l=()=>{},...c}=kt(t,e),u=await Hn(e,c),d=Ct(o),f=fn(o),g=Vt(o)==="y",{width:y,height:m}=s.floating;let v,w;d==="top"||d==="bottom"?(v=d,w=f===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(w=d,v=f==="end"?"top":"bottom");const S=m-u.top-u.bottom,b=y-u.left-u.right,x=qt(m-u[v],S),k=qt(y-u[w],b),C=!e.middlewareData.shift;let _=x,j=k;if((r=e.middlewareData.shift)!=null&&r.enabled.x&&(j=b),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(_=S),C&&!f){const N=Me(u.left,0),H=Me(u.right,0),I=Me(u.top,0),re=Me(u.bottom,0);g?j=y-2*(N!==0||H!==0?N+H:Me(u.left,u.right)):_=m-2*(I!==0||re!==0?I+re:Me(u.top,u.bottom))}await l({...e,availableWidth:j,availableHeight:_});const U=await i.getDimensions(a.floating);return y!==U.width||m!==U.height?{reset:{rects:!0}}:{}}}};function as(){return typeof window<"u"}function pn(t){return Bd(t)?(t.nodeName||"").toLowerCase():"#document"}function Fe(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function gt(t){var e;return(e=(Bd(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function Bd(t){return as()?t instanceof Node||t instanceof Fe(t).Node:!1}function tt(t){return as()?t instanceof Element||t instanceof Fe(t).Element:!1}function ht(t){return as()?t instanceof HTMLElement||t instanceof Fe(t).HTMLElement:!1}function Gl(t){return!as()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Fe(t).ShadowRoot}function Qn(t){const{overflow:e,overflowX:r,overflowY:n,display:o}=rt(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+r)&&!["inline","contents"].includes(o)}function Zy(t){return["table","td","th"].includes(pn(t))}function ls(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function Da(t){const e=Ma(),r=tt(t)?rt(t):t;return["transform","translate","scale","rotate","perspective"].some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(n=>(r.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(r.contain||"").includes(n))}function Qy(t){let e=Kt(t);for(;ht(e)&&!tn(e);){if(Da(e))return e;if(ls(e))return null;e=Kt(e)}return null}function Ma(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function tn(t){return["html","body","#document"].includes(pn(t))}function rt(t){return Fe(t).getComputedStyle(t)}function cs(t){return tt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Kt(t){if(pn(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Gl(t)&&t.host||gt(t);return Gl(e)?e.host:e}function Fd(t){const e=Kt(t);return tn(e)?t.ownerDocument?t.ownerDocument.body:t.body:ht(e)&&Qn(e)?e:Fd(e)}function Wn(t,e,r){var n;e===void 0&&(e=[]),r===void 0&&(r=!0);const o=Fd(t),s=o===((n=t.ownerDocument)==null?void 0:n.body),i=Fe(o);if(s){const a=Bi(i);return e.concat(i,i.visualViewport||[],Qn(o)?o:[],a&&r?Wn(a):[])}return e.concat(o,Wn(o,[],r))}function Bi(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Ud(t){const e=rt(t);let r=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const o=ht(t),s=o?t.offsetWidth:r,i=o?t.offsetHeight:n,a=Vo(r)!==s||Vo(n)!==i;return a&&(r=s,n=i),{width:r,height:n,$:a}}function Ba(t){return tt(t)?t:t.contextElement}function Yr(t){const e=Ba(t);if(!ht(e))return dt(1);const r=e.getBoundingClientRect(),{width:n,height:o,$:s}=Ud(e);let i=(s?Vo(r.width):r.width)/n,a=(s?Vo(r.height):r.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const ev=dt(0);function Hd(t){const e=Fe(t);return!Ma()||!e.visualViewport?ev:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function tv(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==Fe(t)?!1:e}function pr(t,e,r,n){e===void 0&&(e=!1),r===void 0&&(r=!1);const o=t.getBoundingClientRect(),s=Ba(t);let i=dt(1);e&&(n?tt(n)&&(i=Yr(n)):i=Yr(t));const a=tv(s,r,n)?Hd(s):dt(0);let l=(o.left+a.x)/i.x,c=(o.top+a.y)/i.y,u=o.width/i.x,d=o.height/i.y;if(s){const f=Fe(s),g=n&&tt(n)?Fe(n):n;let y=f,m=Bi(y);for(;m&&n&&g!==y;){const v=Yr(m),w=m.getBoundingClientRect(),S=rt(m),b=w.left+(m.clientLeft+parseFloat(S.paddingLeft))*v.x,x=w.top+(m.clientTop+parseFloat(S.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,d*=v.y,l+=b,c+=x,y=Fe(m),m=Bi(y)}}return Xo({width:u,height:d,x:l,y:c})}function Fa(t,e){const r=cs(t).scrollLeft;return e?e.left+r:pr(gt(t)).left+r}function Wd(t,e,r){r===void 0&&(r=!1);const n=t.getBoundingClientRect(),o=n.left+e.scrollLeft-(r?0:Fa(t,n)),s=n.top+e.scrollTop;return{x:o,y:s}}function rv(t){let{elements:e,rect:r,offsetParent:n,strategy:o}=t;const s=o==="fixed",i=gt(n),a=e?ls(e.floating):!1;if(n===i||a&&s)return r;let l={scrollLeft:0,scrollTop:0},c=dt(1);const u=dt(0),d=ht(n);if((d||!d&&!s)&&((pn(n)!=="body"||Qn(i))&&(l=cs(n)),ht(n))){const g=pr(n);c=Yr(n),u.x=g.x+n.clientLeft,u.y=g.y+n.clientTop}const f=i&&!d&&!s?Wd(i,l,!0):dt(0);return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:r.y*c.y-l.scrollTop*c.y+u.y+f.y}}function nv(t){return Array.from(t.getClientRects())}function ov(t){const e=gt(t),r=cs(t),n=t.ownerDocument.body,o=Me(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),s=Me(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+Fa(t);const a=-r.scrollTop;return rt(n).direction==="rtl"&&(i+=Me(e.clientWidth,n.clientWidth)-o),{width:o,height:s,x:i,y:a}}function sv(t,e){const r=Fe(t),n=gt(t),o=r.visualViewport;let s=n.clientWidth,i=n.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;const c=Ma();(!c||c&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:s,height:i,x:a,y:l}}function iv(t,e){const r=pr(t,!0,e==="fixed"),n=r.top+t.clientTop,o=r.left+t.clientLeft,s=ht(t)?Yr(t):dt(1),i=t.clientWidth*s.x,a=t.clientHeight*s.y,l=o*s.x,c=n*s.y;return{width:i,height:a,x:l,y:c}}function ql(t,e,r){let n;if(e==="viewport")n=sv(t,r);else if(e==="document")n=ov(gt(t));else if(tt(e))n=iv(e,r);else{const o=Hd(t);n={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return Xo(n)}function Gd(t,e){const r=Kt(t);return r===e||!tt(r)||tn(r)?!1:rt(r).position==="fixed"||Gd(r,e)}function av(t,e){const r=e.get(t);if(r)return r;let n=Wn(t,[],!1).filter(a=>tt(a)&&pn(a)!=="body"),o=null;const s=rt(t).position==="fixed";let i=s?Kt(t):t;for(;tt(i)&&!tn(i);){const a=rt(i),l=Da(i);!l&&a.position==="fixed"&&(o=null),(s?!l&&!o:!l&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||Qn(i)&&!l&&Gd(t,i))?n=n.filter(u=>u!==i):o=a,i=Kt(i)}return e.set(t,n),n}function lv(t){let{element:e,boundary:r,rootBoundary:n,strategy:o}=t;const i=[...r==="clippingAncestors"?ls(e)?[]:av(e,this._c):[].concat(r),n],a=i[0],l=i.reduce((c,u)=>{const d=ql(e,u,o);return c.top=Me(d.top,c.top),c.right=qt(d.right,c.right),c.bottom=qt(d.bottom,c.bottom),c.left=Me(d.left,c.left),c},ql(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function cv(t){const{width:e,height:r}=Ud(t);return{width:e,height:r}}function uv(t,e,r){const n=ht(e),o=gt(e),s=r==="fixed",i=pr(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=dt(0);if(n||!n&&!s)if((pn(e)!=="body"||Qn(o))&&(a=cs(e)),n){const f=pr(e,!0,s,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else o&&(l.x=Fa(o));const c=o&&!n&&!s?Wd(o,a):dt(0),u=i.left+a.scrollLeft-l.x-c.x,d=i.top+a.scrollTop-l.y-c.y;return{x:u,y:d,width:i.width,height:i.height}}function Ms(t){return rt(t).position==="static"}function Vl(t,e){if(!ht(t)||rt(t).position==="fixed")return null;if(e)return e(t);let r=t.offsetParent;return gt(t)===r&&(r=r.ownerDocument.body),r}function qd(t,e){const r=Fe(t);if(ls(t))return r;if(!ht(t)){let o=Kt(t);for(;o&&!tn(o);){if(tt(o)&&!Ms(o))return o;o=Kt(o)}return r}let n=Vl(t,e);for(;n&&Zy(n)&&Ms(n);)n=Vl(n,e);return n&&tn(n)&&Ms(n)&&!Da(n)?r:n||Qy(t)||r}const dv=async function(t){const e=this.getOffsetParent||qd,r=this.getDimensions,n=await r(t.floating);return{reference:uv(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function hv(t){return rt(t).direction==="rtl"}const fv={convertOffsetParentRelativeRectToViewportRelativeRect:rv,getDocumentElement:gt,getClippingRect:lv,getOffsetParent:qd,getElementRects:dv,getClientRects:nv,getDimensions:cv,getScale:Yr,isElement:tt,isRTL:hv};function Vd(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function pv(t,e){let r=null,n;const o=gt(t);function s(){var a;clearTimeout(n),(a=r)==null||a.disconnect(),r=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:f,height:g}=c;if(a||e(),!f||!g)return;const y=go(d),m=go(o.clientWidth-(u+f)),v=go(o.clientHeight-(d+g)),w=go(u),b={rootMargin:-y+"px "+-m+"px "+-v+"px "+-w+"px",threshold:Me(0,qt(1,l))||1};let x=!0;function k(C){const _=C[0].intersectionRatio;if(_!==l){if(!x)return i();_?i(!1,_):n=setTimeout(()=>{i(!1,1e-7)},1e3)}_===1&&!Vd(c,t.getBoundingClientRect())&&i(),x=!1}try{r=new IntersectionObserver(k,{...b,root:o.ownerDocument})}catch{r=new IntersectionObserver(k,b)}r.observe(t)}return i(!0),s}function gv(t,e,r,n){n===void 0&&(n={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=Ba(t),u=o||s?[...c?Wn(c):[],...Wn(e)]:[];u.forEach(w=>{o&&w.addEventListener("scroll",r,{passive:!0}),s&&w.addEventListener("resize",r)});const d=c&&a?pv(c,r):null;let f=-1,g=null;i&&(g=new ResizeObserver(w=>{let[S]=w;S&&S.target===c&&g&&(g.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var b;(b=g)==null||b.observe(e)})),r()}),c&&!l&&g.observe(c),g.observe(e));let y,m=l?pr(t):null;l&&v();function v(){const w=pr(t);m&&!Vd(m,w)&&r(),m=w,y=requestAnimationFrame(v)}return r(),()=>{var w;u.forEach(S=>{o&&S.removeEventListener("scroll",r),s&&S.removeEventListener("resize",r)}),d?.(),(w=g)==null||w.disconnect(),g=null,l&&cancelAnimationFrame(y)}}const mv=Ky,yv=Xy,vv=Gy,wv=Yy,bv=qy,Kl=Wy,xv=Jy,_v=(t,e,r)=>{const n=new Map,o={platform:fv,...r},s={...o.platform,_c:n};return Hy(t,e,{...o,platform:s})};var jo=typeof document<"u"?p.useLayoutEffect:p.useEffect;function Jo(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,n,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(n=r;n--!==0;)if(!Jo(t[n],e[n]))return!1;return!0}if(o=Object.keys(t),r=o.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(e,o[n]))return!1;for(n=r;n--!==0;){const s=o[n];if(!(s==="_owner"&&t.$$typeof)&&!Jo(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Kd(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Xl(t,e){const r=Kd(t);return Math.round(e*r)/r}function Bs(t){const e=p.useRef(t);return jo(()=>{e.current=t}),e}function Sv(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:n=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=p.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[f,g]=p.useState(n);Jo(f,n)||g(n);const[y,m]=p.useState(null),[v,w]=p.useState(null),S=p.useCallback(V=>{V!==C.current&&(C.current=V,m(V))},[]),b=p.useCallback(V=>{V!==_.current&&(_.current=V,w(V))},[]),x=s||y,k=i||v,C=p.useRef(null),_=p.useRef(null),j=p.useRef(u),U=l!=null,N=Bs(l),H=Bs(o),I=Bs(c),re=p.useCallback(()=>{if(!C.current||!_.current)return;const V={placement:e,strategy:r,middleware:f};H.current&&(V.platform=H.current),_v(C.current,_.current,V).then(ie=>{const ue={...ie,isPositioned:I.current!==!1};D.current&&!Jo(j.current,ue)&&(j.current=ue,Ia.flushSync(()=>{d(ue)}))})},[f,e,r,H,I]);jo(()=>{c===!1&&j.current.isPositioned&&(j.current.isPositioned=!1,d(V=>({...V,isPositioned:!1})))},[c]);const D=p.useRef(!1);jo(()=>(D.current=!0,()=>{D.current=!1}),[]),jo(()=>{if(x&&(C.current=x),k&&(_.current=k),x&&k){if(N.current)return N.current(x,k,re);re()}},[x,k,re,N,U]);const K=p.useMemo(()=>({reference:C,floating:_,setReference:S,setFloating:b}),[S,b]),W=p.useMemo(()=>({reference:x,floating:k}),[x,k]),se=p.useMemo(()=>{const V={position:r,left:0,top:0};if(!W.floating)return V;const ie=Xl(W.floating,u.x),ue=Xl(W.floating,u.y);return a?{...V,transform:"translate("+ie+"px, "+ue+"px)",...Kd(W.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:ie,top:ue}},[r,a,W.floating,u.x,u.y]);return p.useMemo(()=>({...u,update:re,refs:K,elements:W,floatingStyles:se}),[u,re,K,W,se])}const kv=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:n,padding:o}=typeof t=="function"?t(r):t;return n&&e(n)?n.current!=null?Kl({element:n.current,padding:o}).fn(r):{}:n?Kl({element:n,padding:o}).fn(r):{}}}},Cv=(t,e)=>({...mv(t),options:[t,e]}),Pv=(t,e)=>({...yv(t),options:[t,e]}),Ev=(t,e)=>({...xv(t),options:[t,e]}),Av=(t,e)=>({...vv(t),options:[t,e]}),Tv=(t,e)=>({...wv(t),options:[t,e]}),Rv=(t,e)=>({...bv(t),options:[t,e]}),Ov=(t,e)=>({...kv(t),options:[t,e]});var Iv="Arrow",Xd=p.forwardRef((t,e)=>{const{children:r,width:n=10,height:o=5,...s}=t;return h.jsx(ve.svg,{...s,ref:e,width:n,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});Xd.displayName=Iv;var jv=Xd;function $v(t){const[e,r]=p.useState(void 0);return fr(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;r({width:i,height:a})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else r(void 0)},[t]),e}var Ua="Popper",[Jd,Yd]=Oa(Ua),[zv,Zd]=Jd(Ua),Qd=t=>{const{__scopePopper:e,children:r}=t,[n,o]=p.useState(null);return h.jsx(zv,{scope:e,anchor:n,onAnchorChange:o,children:r})};Qd.displayName=Ua;var eh="PopperAnchor",th=p.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:n,...o}=t,s=Zd(eh,r),i=p.useRef(null),a=ot(e,i);return p.useEffect(()=>{s.onAnchorChange(n?.current||i.current)}),n?null:h.jsx(ve.div,{...o,ref:a})});th.displayName=eh;var Ha="PopperContent",[Nv,Lv]=Jd(Ha),rh=p.forwardRef((t,e)=>{const{__scopePopper:r,side:n="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:g="optimized",onPlaced:y,...m}=t,v=Zd(Ha,r),[w,S]=p.useState(null),b=ot(e,T=>S(T)),[x,k]=p.useState(null),C=$v(x),_=C?.width??0,j=C?.height??0,U=n+(s!=="center"?"-"+s:""),N=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},H=Array.isArray(c)?c:[c],I=H.length>0,re={padding:N,boundary:H.filter(Mv),altBoundary:I},{refs:D,floatingStyles:K,placement:W,isPositioned:se,middlewareData:V}=Sv({strategy:"fixed",placement:U,whileElementsMounted:(...T)=>gv(...T,{animationFrame:g==="always"}),elements:{reference:v.anchor},middleware:[Cv({mainAxis:o+j,alignmentAxis:i}),l&&Pv({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?Ev():void 0,...re}),l&&Av({...re}),Tv({...re,apply:({elements:T,rects:L,availableWidth:ne,availableHeight:de})=>{const{width:Ue,height:He}=L.reference,he=T.floating.style;he.setProperty("--radix-popper-available-width",`${ne}px`),he.setProperty("--radix-popper-available-height",`${de}px`),he.setProperty("--radix-popper-anchor-width",`${Ue}px`),he.setProperty("--radix-popper-anchor-height",`${He}px`)}}),x&&Ov({element:x,padding:a}),Bv({arrowWidth:_,arrowHeight:j}),f&&Rv({strategy:"referenceHidden",...re})]}),[ie,ue]=sh(W),ce=Gt(y);fr(()=>{se&&ce?.()},[se,ce]);const E=V.arrow?.x,P=V.arrow?.y,R=V.arrow?.centerOffset!==0,[A,O]=p.useState();return fr(()=>{w&&O(window.getComputedStyle(w).zIndex)},[w]),h.jsx("div",{ref:D.setFloating,"data-radix-popper-content-wrapper":"",style:{...K,transform:se?K.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:A,"--radix-popper-transform-origin":[V.transformOrigin?.x,V.transformOrigin?.y].join(" "),...V.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:h.jsx(Nv,{scope:r,placedSide:ie,onArrowChange:k,arrowX:E,arrowY:P,shouldHideArrow:R,children:h.jsx(ve.div,{"data-side":ie,"data-align":ue,...m,ref:b,style:{...m.style,animation:se?void 0:"none"}})})})});rh.displayName=Ha;var nh="PopperArrow",Dv={top:"bottom",right:"left",bottom:"top",left:"right"},oh=p.forwardRef(function(e,r){const{__scopePopper:n,...o}=e,s=Lv(nh,n),i=Dv[s.placedSide];return h.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:h.jsx(jv,{...o,ref:r,style:{...o.style,display:"block"}})})});oh.displayName=nh;function Mv(t){return t!==null}var Bv=t=>({name:"transformOrigin",options:t,fn(e){const{placement:r,rects:n,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=sh(r),d={start:"0%",center:"50%",end:"100%"}[u],f=(o.arrow?.x??0)+a/2,g=(o.arrow?.y??0)+l/2;let y="",m="";return c==="bottom"?(y=i?d:`${f}px`,m=`${-l}px`):c==="top"?(y=i?d:`${f}px`,m=`${n.floating.height+l}px`):c==="right"?(y=`${-l}px`,m=i?d:`${g}px`):c==="left"&&(y=`${n.floating.width+l}px`,m=i?d:`${g}px`),{data:{x:y,y:m}}}});function sh(t){const[e,r="center"]=t.split("-");return[e,r]}var Fv=Qd,ih=th,Uv=rh,Hv=oh,Wv="Portal",ah=p.forwardRef((t,e)=>{const{container:r,...n}=t,[o,s]=p.useState(!1);fr(()=>s(!0),[]);const i=r||o&&globalThis?.document?.body;return i?dy.createPortal(h.jsx(ve.div,{...n,ref:e}),i):null});ah.displayName=Wv;function Gv(t,e){return p.useReducer((r,n)=>e[r][n]??r,t)}var eo=t=>{const{present:e,children:r}=t,n=qv(e),o=typeof r=="function"?r({present:n.isPresent}):p.Children.only(r),s=ot(n.ref,Vv(o));return typeof r=="function"||n.isPresent?p.cloneElement(o,{ref:s}):null};eo.displayName="Presence";function qv(t){const[e,r]=p.useState(),n=p.useRef({}),o=p.useRef(t),s=p.useRef("none"),i=t?"mounted":"unmounted",[a,l]=Gv(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return p.useEffect(()=>{const c=mo(n.current);s.current=a==="mounted"?c:"none"},[a]),fr(()=>{const c=n.current,u=o.current;if(u!==t){const f=s.current,g=mo(c);t?l("MOUNT"):g==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&f!==g?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),fr(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=g=>{const m=mo(n.current).includes(g.animationName);if(g.target===e&&m&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},f=g=>{g.target===e&&(s.current=mo(n.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:p.useCallback(c=>{c&&(n.current=getComputedStyle(c)),r(c)},[])}}function mo(t){return t?.animationName||"none"}function Vv(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function lh({prop:t,defaultProp:e,onChange:r=()=>{}}){const[n,o]=Kv({defaultProp:e,onChange:r}),s=t!==void 0,i=s?t:n,a=Gt(r),l=p.useCallback(c=>{if(s){const d=typeof c=="function"?c(t):c;d!==t&&a(d)}else o(c)},[s,t,o,a]);return[i,l]}function Kv({defaultProp:t,onChange:e}){const r=p.useState(t),[n]=r,o=p.useRef(n),s=Gt(e);return p.useEffect(()=>{o.current!==n&&(s(n),o.current=n)},[n,o,s]),r}var Xv=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Cr=new WeakMap,yo=new WeakMap,vo={},Fs=0,ch=function(t){return t&&(t.host||ch(t.parentNode))},Jv=function(t,e){return e.map(function(r){if(t.contains(r))return r;var n=ch(r);return n&&t.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},Yv=function(t,e,r,n){var o=Jv(e,Array.isArray(t)?t:[t]);vo[r]||(vo[r]=new WeakMap);var s=vo[r],i=[],a=new Set,l=new Set(o),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};o.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(f){if(a.has(f))u(f);else try{var g=f.getAttribute(n),y=g!==null&&g!=="false",m=(Cr.get(f)||0)+1,v=(s.get(f)||0)+1;Cr.set(f,m),s.set(f,v),i.push(f),m===1&&y&&yo.set(f,!0),v===1&&f.setAttribute(r,"true"),y||f.setAttribute(n,"true")}catch(w){console.error("aria-hidden: cannot operate on ",f,w)}})};return u(e),a.clear(),Fs++,function(){i.forEach(function(d){var f=Cr.get(d)-1,g=s.get(d)-1;Cr.set(d,f),s.set(d,g),f||(yo.has(d)||d.removeAttribute(n),yo.delete(d)),g||d.removeAttribute(r)}),Fs--,Fs||(Cr=new WeakMap,Cr=new WeakMap,yo=new WeakMap,vo={})}},uh=function(t,e,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(t)?t:[t]),o=Xv(t);return o?(n.push.apply(n,Array.from(o.querySelectorAll("[aria-live]"))),Yv(n,o,r,"aria-hidden")):function(){return null}},lt=function(){return lt=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},lt.apply(this,arguments)};function dh(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r}function Zv(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))}var $o="right-scroll-bar-position",zo="width-before-scroll-bar",Qv="with-scroll-bars-hidden",ew="--removed-body-scroll-bar-size";function Us(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function tw(t,e){var r=p.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(n){var o=r.value;o!==n&&(r.value=n,r.callback(n,o))}}}})[0];return r.callback=e,r.facade}var rw=typeof window<"u"?p.useLayoutEffect:p.useEffect,Jl=new WeakMap;function nw(t,e){var r=tw(null,function(n){return t.forEach(function(o){return Us(o,n)})});return rw(function(){var n=Jl.get(r);if(n){var o=new Set(n),s=new Set(t),i=r.current;o.forEach(function(a){s.has(a)||Us(a,null)}),s.forEach(function(a){o.has(a)||Us(a,i)})}Jl.set(r,t)},[t]),r}function ow(t){return t}function sw(t,e){e===void 0&&(e=ow);var r=[],n=!1,o={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(s){var i=e(s,n);return r.push(i),function(){r=r.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(n=!0;r.length;){var i=r;r=[],i.forEach(s)}r={push:function(a){return s(a)},filter:function(){return r}}},assignMedium:function(s){n=!0;var i=[];if(r.length){var a=r;r=[],a.forEach(s),i=r}var l=function(){var u=i;i=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),r={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),r}}}};return o}function iw(t){t===void 0&&(t={});var e=sw(null);return e.options=lt({async:!0,ssr:!1},t),e}var hh=function(t){var e=t.sideCar,r=dh(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return p.createElement(n,lt({},r))};hh.isSideCarExport=!0;function aw(t,e){return t.useMedium(e),hh}var fh=iw(),Hs=function(){},us=p.forwardRef(function(t,e){var r=p.useRef(null),n=p.useState({onScrollCapture:Hs,onWheelCapture:Hs,onTouchMoveCapture:Hs}),o=n[0],s=n[1],i=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,f=t.sideCar,g=t.noIsolation,y=t.inert,m=t.allowPinchZoom,v=t.as,w=v===void 0?"div":v,S=t.gapMode,b=dh(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=f,k=nw([r,e]),C=lt(lt({},b),o);return p.createElement(p.Fragment,null,u&&p.createElement(x,{sideCar:fh,removeScrollBar:c,shards:d,noIsolation:g,inert:y,setCallbacks:s,allowPinchZoom:!!m,lockRef:r,gapMode:S}),i?p.cloneElement(p.Children.only(a),lt(lt({},C),{ref:k})):p.createElement(w,lt({},C,{className:l,ref:k}),a))});us.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};us.classNames={fullWidth:zo,zeroRight:$o};var lw=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function cw(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=lw();return e&&t.setAttribute("nonce",e),t}function uw(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function dw(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var hw=function(){var t=0,e=null;return{add:function(r){t==0&&(e=cw())&&(uw(e,r),dw(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},fw=function(){var t=hw();return function(e,r){p.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},ph=function(){var t=fw(),e=function(r){var n=r.styles,o=r.dynamic;return t(n,o),null};return e},pw={left:0,top:0,right:0,gap:0},Ws=function(t){return parseInt(t||"",10)||0},gw=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],n=e[t==="padding"?"paddingTop":"marginTop"],o=e[t==="padding"?"paddingRight":"marginRight"];return[Ws(r),Ws(n),Ws(o)]},mw=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return pw;var e=gw(t),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-r+e[2]-e[0])}},yw=ph(),Zr="data-scroll-locked",vw=function(t,e,r,n){var o=t.left,s=t.top,i=t.right,a=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(Qv,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(a,"px ").concat(n,`;
  }
  body[`).concat(Zr,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(a,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat($o,` {
    right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(zo,` {
    margin-right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat($o," .").concat($o,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(zo," .").concat(zo,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Zr,`] {
    `).concat(ew,": ").concat(a,`px;
  }
`)},Yl=function(){var t=parseInt(document.body.getAttribute(Zr)||"0",10);return isFinite(t)?t:0},ww=function(){p.useEffect(function(){return document.body.setAttribute(Zr,(Yl()+1).toString()),function(){var t=Yl()-1;t<=0?document.body.removeAttribute(Zr):document.body.setAttribute(Zr,t.toString())}},[])},bw=function(t){var e=t.noRelative,r=t.noImportant,n=t.gapMode,o=n===void 0?"margin":n;ww();var s=p.useMemo(function(){return mw(o)},[o]);return p.createElement(yw,{styles:vw(s,!e,o,r?"":"!important")})},Fi=!1;if(typeof window<"u")try{var wo=Object.defineProperty({},"passive",{get:function(){return Fi=!0,!0}});window.addEventListener("test",wo,wo),window.removeEventListener("test",wo,wo)}catch{Fi=!1}var Pr=Fi?{passive:!1}:!1,xw=function(t){return t.tagName==="TEXTAREA"},gh=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!xw(t)&&r[e]==="visible")},_w=function(t){return gh(t,"overflowY")},Sw=function(t){return gh(t,"overflowX")},Zl=function(t,e){var r=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var o=mh(t,n);if(o){var s=yh(t,n),i=s[1],a=s[2];if(i>a)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},kw=function(t){var e=t.scrollTop,r=t.scrollHeight,n=t.clientHeight;return[e,r,n]},Cw=function(t){var e=t.scrollLeft,r=t.scrollWidth,n=t.clientWidth;return[e,r,n]},mh=function(t,e){return t==="v"?_w(e):Sw(e)},yh=function(t,e){return t==="v"?kw(e):Cw(e)},Pw=function(t,e){return t==="h"&&e==="rtl"?-1:1},Ew=function(t,e,r,n,o){var s=Pw(t,window.getComputedStyle(e).direction),i=s*n,a=r.target,l=e.contains(a),c=!1,u=i>0,d=0,f=0;do{var g=yh(t,a),y=g[0],m=g[1],v=g[2],w=m-v-s*y;(y||w)&&mh(t,a)&&(d+=w,f+=y),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(f)<1)&&(c=!0),c},bo=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Ql=function(t){return[t.deltaX,t.deltaY]},ec=function(t){return t&&"current"in t?t.current:t},Aw=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Tw=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Rw=0,Er=[];function Ow(t){var e=p.useRef([]),r=p.useRef([0,0]),n=p.useRef(),o=p.useState(Rw++)[0],s=p.useState(ph)[0],i=p.useRef(t);p.useEffect(function(){i.current=t},[t]),p.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(o));var m=Zv([t.lockRef.current],(t.shards||[]).map(ec),!0).filter(Boolean);return m.forEach(function(v){return v.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),m.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(o))})}}},[t.inert,t.lockRef.current,t.shards]);var a=p.useCallback(function(m,v){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!i.current.allowPinchZoom;var w=bo(m),S=r.current,b="deltaX"in m?m.deltaX:S[0]-w[0],x="deltaY"in m?m.deltaY:S[1]-w[1],k,C=m.target,_=Math.abs(b)>Math.abs(x)?"h":"v";if("touches"in m&&_==="h"&&C.type==="range")return!1;var j=Zl(_,C);if(!j)return!0;if(j?k=_:(k=_==="v"?"h":"v",j=Zl(_,C)),!j)return!1;if(!n.current&&"changedTouches"in m&&(b||x)&&(n.current=k),!k)return!0;var U=n.current||k;return Ew(U,v,m,U==="h"?b:x)},[]),l=p.useCallback(function(m){var v=m;if(!(!Er.length||Er[Er.length-1]!==s)){var w="deltaY"in v?Ql(v):bo(v),S=e.current.filter(function(k){return k.name===v.type&&(k.target===v.target||v.target===k.shadowParent)&&Aw(k.delta,w)})[0];if(S&&S.should){v.cancelable&&v.preventDefault();return}if(!S){var b=(i.current.shards||[]).map(ec).filter(Boolean).filter(function(k){return k.contains(v.target)}),x=b.length>0?a(v,b[0]):!i.current.noIsolation;x&&v.cancelable&&v.preventDefault()}}},[]),c=p.useCallback(function(m,v,w,S){var b={name:m,delta:v,target:w,should:S,shadowParent:Iw(w)};e.current.push(b),setTimeout(function(){e.current=e.current.filter(function(x){return x!==b})},1)},[]),u=p.useCallback(function(m){r.current=bo(m),n.current=void 0},[]),d=p.useCallback(function(m){c(m.type,Ql(m),m.target,a(m,t.lockRef.current))},[]),f=p.useCallback(function(m){c(m.type,bo(m),m.target,a(m,t.lockRef.current))},[]);p.useEffect(function(){return Er.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",l,Pr),document.addEventListener("touchmove",l,Pr),document.addEventListener("touchstart",u,Pr),function(){Er=Er.filter(function(m){return m!==s}),document.removeEventListener("wheel",l,Pr),document.removeEventListener("touchmove",l,Pr),document.removeEventListener("touchstart",u,Pr)}},[]);var g=t.removeScrollBar,y=t.inert;return p.createElement(p.Fragment,null,y?p.createElement(s,{styles:Tw(o)}):null,g?p.createElement(bw,{gapMode:t.gapMode}):null)}function Iw(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const jw=aw(fh,Ow);var Wa=p.forwardRef(function(t,e){return p.createElement(us,lt({},t,{ref:e,sideCar:jw}))});Wa.classNames=us.classNames;var Ga="Popover",[vh,BP]=Oa(Ga,[Yd]),to=Yd(),[$w,xr]=vh(Ga),wh=t=>{const{__scopePopover:e,children:r,open:n,defaultOpen:o,onOpenChange:s,modal:i=!1}=t,a=to(e),l=p.useRef(null),[c,u]=p.useState(!1),[d=!1,f]=lh({prop:n,defaultProp:o,onChange:s});return h.jsx(Fv,{...a,children:h.jsx($w,{scope:e,contentId:ut(),triggerRef:l,open:d,onOpenChange:f,onOpenToggle:p.useCallback(()=>f(g=>!g),[f]),hasCustomAnchor:c,onCustomAnchorAdd:p.useCallback(()=>u(!0),[]),onCustomAnchorRemove:p.useCallback(()=>u(!1),[]),modal:i,children:r})})};wh.displayName=Ga;var bh="PopoverAnchor",zw=p.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=xr(bh,r),s=to(r),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=o;return p.useEffect(()=>(i(),()=>a()),[i,a]),h.jsx(ih,{...s,...n,ref:e})});zw.displayName=bh;var xh="PopoverTrigger",_h=p.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=xr(xh,r),s=to(r),i=ot(e,o.triggerRef),a=h.jsx(ve.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Ph(o.open),...n,ref:i,onClick:Be(t.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:h.jsx(ih,{asChild:!0,...s,children:a})});_h.displayName=xh;var Nw="PopoverPortal",[FP,Lw]=vh(Nw,{forceMount:void 0}),rn="PopoverContent",Sh=p.forwardRef((t,e)=>{const r=Lw(rn,t.__scopePopover),{forceMount:n=r.forceMount,...o}=t,s=xr(rn,t.__scopePopover);return h.jsx(eo,{present:n||s.open,children:s.modal?h.jsx(Dw,{...o,ref:e}):h.jsx(Mw,{...o,ref:e})})});Sh.displayName=rn;var Dw=p.forwardRef((t,e)=>{const r=xr(rn,t.__scopePopover),n=p.useRef(null),o=ot(e,n),s=p.useRef(!1);return p.useEffect(()=>{const i=n.current;if(i)return uh(i)},[]),h.jsx(Wa,{as:is,allowPinchZoom:!0,children:h.jsx(kh,{...t,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Be(t.onCloseAutoFocus,i=>{i.preventDefault(),s.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Be(t.onPointerDownOutside,i=>{const a=i.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Be(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),Mw=p.forwardRef((t,e)=>{const r=xr(rn,t.__scopePopover),n=p.useRef(!1),o=p.useRef(!1);return h.jsx(kh,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(n.current||r.triggerRef.current?.focus(),s.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(n.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;r.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),kh=p.forwardRef((t,e)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=t,f=xr(rn,r),g=to(r);return Ld(),h.jsx($a,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:s,children:h.jsx(ja,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>f.onOpenChange(!1),children:h.jsx(Uv,{"data-state":Ph(f.open),role:"dialog",id:f.contentId,...g,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Ch="PopoverClose",Bw=p.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=xr(Ch,r);return h.jsx(ve.button,{type:"button",...n,ref:e,onClick:Be(t.onClick,()=>o.onOpenChange(!1))})});Bw.displayName=Ch;var Fw="PopoverArrow",Uw=p.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=to(r);return h.jsx(Hv,{...o,...n,ref:e})});Uw.displayName=Fw;function Ph(t){return t?"open":"closed"}var Hw=_h;function Eh(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(e=0;e<o;e++)t[e]&&(r=Eh(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function Ah(){for(var t,e,r=0,n="",o=arguments.length;r<o;r++)(t=arguments[r])&&(e=Eh(t))&&(n&&(n+=" "),n+=e);return n}function Ce(...t){return Od(Ah(t))}const Th=wh,Rh=Hw,Oh=p.forwardRef(({className:t,align:e="end",...r},n)=>h.jsx(Sh,{ref:n,align:e,className:Ce("z-popups drop-shadow-oneBlock p-0 border-shadow outline-none",t),...r,onKeyDown:o=>{o.stopPropagation()}})),qa=({children:t,scaleFactor:e})=>{const r=Zp();return h.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??r,"--block":`${(e??r)*8}px`},children:t})};var tc=1,Ww=.9,Gw=.8,qw=.17,Gs=.1,qs=.999,Vw=.9999,Kw=.99,Xw=/[\\\/_+.#"@\[\(\{&]/,Jw=/[\\\/_+.#"@\[\(\{&]/g,Yw=/[\s-]/,Ih=/[\s-]/g;function Ui(t,e,r,n,o,s,i){if(s===e.length)return o===t.length?tc:Kw;var a=`${o},${s}`;if(i[a]!==void 0)return i[a];for(var l=n.charAt(s),c=r.indexOf(l,o),u=0,d,f,g,y;c>=0;)d=Ui(t,e,r,n,c+1,s+1,i),d>u&&(c===o?d*=tc:Xw.test(t.charAt(c-1))?(d*=Gw,g=t.slice(o,c-1).match(Jw),g&&o>0&&(d*=Math.pow(qs,g.length))):Yw.test(t.charAt(c-1))?(d*=Ww,y=t.slice(o,c-1).match(Ih),y&&o>0&&(d*=Math.pow(qs,y.length))):(d*=qw,o>0&&(d*=Math.pow(qs,c-o))),t.charAt(c)!==e.charAt(s)&&(d*=Vw)),(d<Gs&&r.charAt(c-1)===n.charAt(s+1)||n.charAt(s+1)===n.charAt(s)&&r.charAt(c-1)!==n.charAt(s))&&(f=Ui(t,e,r,n,c+1,s+2,i),f*Gs>d&&(d=f*Gs)),d>u&&(u=d),c=r.indexOf(l,c+1);return i[a]=u,u}function rc(t){return t.toLowerCase().replace(Ih," ")}function Zw(t,e,r){return t=r&&r.length>0?`${t+" "+r.join(" ")}`:t,Ui(t,e,rc(t),rc(e),0,0,{})}var Va="Dialog",[jh,UP]=Oa(Va),[Qw,st]=jh(Va),$h=t=>{const{__scopeDialog:e,children:r,open:n,defaultOpen:o,onOpenChange:s,modal:i=!0}=t,a=p.useRef(null),l=p.useRef(null),[c=!1,u]=lh({prop:n,defaultProp:o,onChange:s});return h.jsx(Qw,{scope:e,triggerRef:a,contentRef:l,contentId:ut(),titleId:ut(),descriptionId:ut(),open:c,onOpenChange:u,onOpenToggle:p.useCallback(()=>u(d=>!d),[u]),modal:i,children:r})};$h.displayName=Va;var zh="DialogTrigger",eb=p.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=st(zh,r),s=ot(e,o.triggerRef);return h.jsx(ve.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Ja(o.open),...n,ref:s,onClick:Be(t.onClick,o.onOpenToggle)})});eb.displayName=zh;var Ka="DialogPortal",[tb,Nh]=jh(Ka,{forceMount:void 0}),Lh=t=>{const{__scopeDialog:e,forceMount:r,children:n,container:o}=t,s=st(Ka,e);return h.jsx(tb,{scope:e,forceMount:r,children:p.Children.map(n,i=>h.jsx(eo,{present:r||s.open,children:h.jsx(ah,{asChild:!0,container:o,children:i})}))})};Lh.displayName=Ka;var Yo="DialogOverlay",Dh=p.forwardRef((t,e)=>{const r=Nh(Yo,t.__scopeDialog),{forceMount:n=r.forceMount,...o}=t,s=st(Yo,t.__scopeDialog);return s.modal?h.jsx(eo,{present:n||s.open,children:h.jsx(rb,{...o,ref:e})}):null});Dh.displayName=Yo;var rb=p.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=st(Yo,r);return h.jsx(Wa,{as:is,allowPinchZoom:!0,shards:[o.contentRef],children:h.jsx(ve.div,{"data-state":Ja(o.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),gr="DialogContent",Mh=p.forwardRef((t,e)=>{const r=Nh(gr,t.__scopeDialog),{forceMount:n=r.forceMount,...o}=t,s=st(gr,t.__scopeDialog);return h.jsx(eo,{present:n||s.open,children:s.modal?h.jsx(nb,{...o,ref:e}):h.jsx(ob,{...o,ref:e})})});Mh.displayName=gr;var nb=p.forwardRef((t,e)=>{const r=st(gr,t.__scopeDialog),n=p.useRef(null),o=ot(e,r.contentRef,n);return p.useEffect(()=>{const s=n.current;if(s)return uh(s)},[]),h.jsx(Bh,{...t,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Be(t.onCloseAutoFocus,s=>{s.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:Be(t.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:Be(t.onFocusOutside,s=>s.preventDefault())})}),ob=p.forwardRef((t,e)=>{const r=st(gr,t.__scopeDialog),n=p.useRef(!1),o=p.useRef(!1);return h.jsx(Bh,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(n.current||r.triggerRef.current?.focus(),s.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(n.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;r.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),Bh=p.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=t,a=st(gr,r),l=p.useRef(null),c=ot(e,l);return Ld(),h.jsxs(h.Fragment,{children:[h.jsx($a,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:s,children:h.jsx(ja,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":Ja(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),h.jsxs(h.Fragment,{children:[h.jsx(lb,{titleId:a.titleId}),h.jsx(ub,{contentRef:l,descriptionId:a.descriptionId})]})]})}),Xa="DialogTitle",sb=p.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=st(Xa,r);return h.jsx(ve.h2,{id:o.titleId,...n,ref:e})});sb.displayName=Xa;var Fh="DialogDescription",ib=p.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=st(Fh,r);return h.jsx(ve.p,{id:o.descriptionId,...n,ref:e})});ib.displayName=Fh;var Uh="DialogClose",ab=p.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=st(Uh,r);return h.jsx(ve.button,{type:"button",...n,ref:e,onClick:Be(t.onClick,()=>o.onOpenChange(!1))})});ab.displayName=Uh;function Ja(t){return t?"open":"closed"}var Hh="DialogTitleWarning",[HP,Wh]=cy(Hh,{contentName:gr,titleName:Xa,docsSlug:"dialog"}),lb=({titleId:t})=>{const e=Wh(Hh),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return p.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},cb="DialogDescriptionWarning",ub=({contentRef:t,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Wh(cb).contentName}}.`;return p.useEffect(()=>{const o=t.current?.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(n))},[n,t,e]),null},db=$h,hb=Lh,fb=Dh,pb=Mh,Vs={exports:{}},Ks={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nc;function gb(){if(nc)return Ks;nc=1;var t=Qp();function e(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var r=typeof Object.is=="function"?Object.is:e,n=t.useState,o=t.useEffect,s=t.useLayoutEffect,i=t.useDebugValue;function a(d,f){var g=f(),y=n({inst:{value:g,getSnapshot:f}}),m=y[0].inst,v=y[1];return s(function(){m.value=g,m.getSnapshot=f,l(m)&&v({inst:m})},[d,g,f]),o(function(){return l(m)&&v({inst:m}),d(function(){l(m)&&v({inst:m})})},[d]),i(g),g}function l(d){var f=d.getSnapshot;d=d.value;try{var g=f();return!r(d,g)}catch{return!0}}function c(d,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return Ks.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,Ks}var oc;function mb(){return oc||(oc=1,Vs.exports=gb()),Vs.exports}var yb=mb(),xn='[cmdk-group=""]',Xs='[cmdk-group-items=""]',vb='[cmdk-group-heading=""]',Ya='[cmdk-item=""]',sc=`${Ya}:not([aria-disabled="true"])`,Hi="cmdk-item-select",or="data-value",wb=(t,e,r)=>Zw(t,e,r),Gh=p.createContext(void 0),ro=()=>p.useContext(Gh),qh=p.createContext(void 0),Za=()=>p.useContext(qh),Vh=p.createContext(void 0),Kh=p.forwardRef((t,e)=>{let r=Fr(()=>{var E,P;return{search:"",value:(P=(E=t.value)!=null?E:t.defaultValue)!=null?P:"",filtered:{count:0,items:new Map,groups:new Set}}}),n=Fr(()=>new Set),o=Fr(()=>new Map),s=Fr(()=>new Map),i=Fr(()=>new Set),a=Xh(t),{label:l,children:c,value:u,onValueChange:d,filter:f,shouldFilter:g,loop:y,disablePointerSelection:m=!1,vimBindings:v=!0,...w}=t,S=ut(),b=ut(),x=ut(),k=p.useRef(null),C=Rb();mr(()=>{if(u!==void 0){let E=u.trim();r.current.value=E,_.emit()}},[u]),mr(()=>{C(6,re)},[]);let _=p.useMemo(()=>({subscribe:E=>(i.current.add(E),()=>i.current.delete(E)),snapshot:()=>r.current,setState:(E,P,R)=>{var A,O,T;if(!Object.is(r.current[E],P)){if(r.current[E]=P,E==="search")I(),N(),C(1,H);else if(E==="value"&&(R||C(5,re),((A=a.current)==null?void 0:A.value)!==void 0)){let L=P??"";(T=(O=a.current).onValueChange)==null||T.call(O,L);return}_.emit()}},emit:()=>{i.current.forEach(E=>E())}}),[]),j=p.useMemo(()=>({value:(E,P,R)=>{var A;P!==((A=s.current.get(E))==null?void 0:A.value)&&(s.current.set(E,{value:P,keywords:R}),r.current.filtered.items.set(E,U(P,R)),C(2,()=>{N(),_.emit()}))},item:(E,P)=>(n.current.add(E),P&&(o.current.has(P)?o.current.get(P).add(E):o.current.set(P,new Set([E]))),C(3,()=>{I(),N(),r.current.value||H(),_.emit()}),()=>{s.current.delete(E),n.current.delete(E),r.current.filtered.items.delete(E);let R=D();C(4,()=>{I(),R?.getAttribute("id")===E&&H(),_.emit()})}),group:E=>(o.current.has(E)||o.current.set(E,new Set),()=>{s.current.delete(E),o.current.delete(E)}),filter:()=>a.current.shouldFilter,label:l||t["aria-label"],getDisablePointerSelection:()=>a.current.disablePointerSelection,listId:S,inputId:x,labelId:b,listInnerRef:k}),[]);function U(E,P){var R,A;let O=(A=(R=a.current)==null?void 0:R.filter)!=null?A:wb;return E?O(E,r.current.search,P):0}function N(){if(!r.current.search||a.current.shouldFilter===!1)return;let E=r.current.filtered.items,P=[];r.current.filtered.groups.forEach(A=>{let O=o.current.get(A),T=0;O.forEach(L=>{let ne=E.get(L);T=Math.max(ne,T)}),P.push([A,T])});let R=k.current;K().sort((A,O)=>{var T,L;let ne=A.getAttribute("id"),de=O.getAttribute("id");return((T=E.get(de))!=null?T:0)-((L=E.get(ne))!=null?L:0)}).forEach(A=>{let O=A.closest(Xs);O?O.appendChild(A.parentElement===O?A:A.closest(`${Xs} > *`)):R.appendChild(A.parentElement===R?A:A.closest(`${Xs} > *`))}),P.sort((A,O)=>O[1]-A[1]).forEach(A=>{var O;let T=(O=k.current)==null?void 0:O.querySelector(`${xn}[${or}="${encodeURIComponent(A[0])}"]`);T?.parentElement.appendChild(T)})}function H(){let E=K().find(R=>R.getAttribute("aria-disabled")!=="true"),P=E?.getAttribute(or);_.setState("value",P||void 0)}function I(){var E,P,R,A;if(!r.current.search||a.current.shouldFilter===!1){r.current.filtered.count=n.current.size;return}r.current.filtered.groups=new Set;let O=0;for(let T of n.current){let L=(P=(E=s.current.get(T))==null?void 0:E.value)!=null?P:"",ne=(A=(R=s.current.get(T))==null?void 0:R.keywords)!=null?A:[],de=U(L,ne);r.current.filtered.items.set(T,de),de>0&&O++}for(let[T,L]of o.current)for(let ne of L)if(r.current.filtered.items.get(ne)>0){r.current.filtered.groups.add(T);break}r.current.filtered.count=O}function re(){var E,P,R;let A=D();A&&(((E=A.parentElement)==null?void 0:E.firstChild)===A&&((R=(P=A.closest(xn))==null?void 0:P.querySelector(vb))==null||R.scrollIntoView({block:"nearest"})),A.scrollIntoView({block:"nearest"}))}function D(){var E;return(E=k.current)==null?void 0:E.querySelector(`${Ya}[aria-selected="true"]`)}function K(){var E;return Array.from(((E=k.current)==null?void 0:E.querySelectorAll(sc))||[])}function W(E){let P=K()[E];P&&_.setState("value",P.getAttribute(or))}function se(E){var P;let R=D(),A=K(),O=A.findIndex(L=>L===R),T=A[O+E];(P=a.current)!=null&&P.loop&&(T=O+E<0?A[A.length-1]:O+E===A.length?A[0]:A[O+E]),T&&_.setState("value",T.getAttribute(or))}function V(E){let P=D(),R=P?.closest(xn),A;for(;R&&!A;)R=E>0?Ab(R,xn):Tb(R,xn),A=R?.querySelector(sc);A?_.setState("value",A.getAttribute(or)):se(E)}let ie=()=>W(K().length-1),ue=E=>{E.preventDefault(),E.metaKey?ie():E.altKey?V(1):se(1)},ce=E=>{E.preventDefault(),E.metaKey?W(0):E.altKey?V(-1):se(-1)};return p.createElement(ve.div,{ref:e,tabIndex:-1,...w,"cmdk-root":"",onKeyDown:E=>{var P;if((P=w.onKeyDown)==null||P.call(w,E),!E.defaultPrevented)switch(E.key){case"n":case"j":{v&&E.ctrlKey&&ue(E);break}case"ArrowDown":{ue(E);break}case"p":case"k":{v&&E.ctrlKey&&ce(E);break}case"ArrowUp":{ce(E);break}case"Home":{E.preventDefault(),W(0);break}case"End":{E.preventDefault(),ie();break}case"Enter":if(!E.nativeEvent.isComposing&&E.keyCode!==229){E.preventDefault();let R=D();if(R){let A=new Event(Hi);R.dispatchEvent(A)}}}}},p.createElement("label",{"cmdk-label":"",htmlFor:j.inputId,id:j.labelId,style:Ib},l),ds(t,E=>p.createElement(qh.Provider,{value:_},p.createElement(Gh.Provider,{value:j},E))))}),bb=p.forwardRef((t,e)=>{var r,n;let o=ut(),s=p.useRef(null),i=p.useContext(Vh),a=ro(),l=Xh(t),c=(n=(r=l.current)==null?void 0:r.forceMount)!=null?n:i?.forceMount;mr(()=>{if(!c)return a.item(o,i?.id)},[c]);let u=Jh(o,s,[t.value,t.children,s],t.keywords),d=Za(),f=yr(C=>C.value&&C.value===u.current),g=yr(C=>c||a.filter()===!1?!0:C.search?C.filtered.items.get(o)>0:!0);p.useEffect(()=>{let C=s.current;if(!(!C||t.disabled))return C.addEventListener(Hi,y),()=>C.removeEventListener(Hi,y)},[g,t.onSelect,t.disabled]);function y(){var C,_;m(),(_=(C=l.current).onSelect)==null||_.call(C,u.current)}function m(){d.setState("value",u.current,!0)}if(!g)return null;let{disabled:v,value:w,onSelect:S,forceMount:b,keywords:x,...k}=t;return p.createElement(ve.div,{ref:Gn([s,e]),...k,id:o,"cmdk-item":"",role:"option","aria-disabled":!!v,"aria-selected":!!f,"data-disabled":!!v,"data-selected":!!f,onPointerMove:v||a.getDisablePointerSelection()?void 0:m,onClick:v?void 0:y},t.children)}),xb=p.forwardRef((t,e)=>{let{heading:r,children:n,forceMount:o,...s}=t,i=ut(),a=p.useRef(null),l=p.useRef(null),c=ut(),u=ro(),d=yr(g=>o||u.filter()===!1?!0:g.search?g.filtered.groups.has(i):!0);mr(()=>u.group(i),[]),Jh(i,a,[t.value,t.heading,l]);let f=p.useMemo(()=>({id:i,forceMount:o}),[o]);return p.createElement(ve.div,{ref:Gn([a,e]),...s,"cmdk-group":"",role:"presentation",hidden:d?void 0:!0},r&&p.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:c},r),ds(t,g=>p.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?c:void 0},p.createElement(Vh.Provider,{value:f},g))))}),_b=p.forwardRef((t,e)=>{let{alwaysRender:r,...n}=t,o=p.useRef(null),s=yr(i=>!i.search);return!r&&!s?null:p.createElement(ve.div,{ref:Gn([o,e]),...n,"cmdk-separator":"",role:"separator"})}),Sb=p.forwardRef((t,e)=>{let{onValueChange:r,...n}=t,o=t.value!=null,s=Za(),i=yr(u=>u.search),a=yr(u=>u.value),l=ro(),c=p.useMemo(()=>{var u;let d=(u=l.listInnerRef.current)==null?void 0:u.querySelector(`${Ya}[${or}="${encodeURIComponent(a)}"]`);return d?.getAttribute("id")},[]);return p.useEffect(()=>{t.value!=null&&s.setState("search",t.value)},[t.value]),p.createElement(ve.input,{ref:e,...n,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":c,id:l.inputId,type:"text",value:o?t.value:i,onChange:u=>{o||s.setState("search",u.target.value),r?.(u.target.value)}})}),kb=p.forwardRef((t,e)=>{let{children:r,label:n="Suggestions",...o}=t,s=p.useRef(null),i=p.useRef(null),a=ro();return p.useEffect(()=>{if(i.current&&s.current){let l=i.current,c=s.current,u,d=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let f=l.offsetHeight;c.style.setProperty("--cmdk-list-height",f.toFixed(1)+"px")})});return d.observe(l),()=>{cancelAnimationFrame(u),d.unobserve(l)}}},[]),p.createElement(ve.div,{ref:Gn([s,e]),...o,"cmdk-list":"",role:"listbox","aria-label":n,id:a.listId},ds(t,l=>p.createElement("div",{ref:Gn([i,a.listInnerRef]),"cmdk-list-sizer":""},l)))}),Cb=p.forwardRef((t,e)=>{let{open:r,onOpenChange:n,overlayClassName:o,contentClassName:s,container:i,...a}=t;return p.createElement(db,{open:r,onOpenChange:n},p.createElement(hb,{container:i},p.createElement(fb,{"cmdk-overlay":"",className:o}),p.createElement(pb,{"aria-label":t.label,"cmdk-dialog":"",className:s},p.createElement(Kh,{ref:e,...a}))))}),Pb=p.forwardRef((t,e)=>yr(r=>r.filtered.count===0)?p.createElement(ve.div,{ref:e,...t,"cmdk-empty":"",role:"presentation"}):null),Eb=p.forwardRef((t,e)=>{let{progress:r,children:n,label:o="Loading...",...s}=t;return p.createElement(ve.div,{ref:e,...s,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},ds(t,i=>p.createElement("div",{"aria-hidden":!0},i)))}),Le=Object.assign(Kh,{List:kb,Item:bb,Input:Sb,Group:xb,Separator:_b,Dialog:Cb,Empty:Pb,Loading:Eb});function Ab(t,e){let r=t.nextElementSibling;for(;r;){if(r.matches(e))return r;r=r.nextElementSibling}}function Tb(t,e){let r=t.previousElementSibling;for(;r;){if(r.matches(e))return r;r=r.previousElementSibling}}function Xh(t){let e=p.useRef(t);return mr(()=>{e.current=t}),e}var mr=typeof window>"u"?p.useEffect:p.useLayoutEffect;function Fr(t){let e=p.useRef();return e.current===void 0&&(e.current=t()),e}function Gn(t){return e=>{t.forEach(r=>{typeof r=="function"?r(e):r!=null&&(r.current=e)})}}function yr(t){let e=Za(),r=()=>t(e.snapshot());return yb.useSyncExternalStore(e.subscribe,r,r)}function Jh(t,e,r,n=[]){let o=p.useRef(),s=ro();return mr(()=>{var i;let a=(()=>{var c;for(let u of r){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(c=u.current.textContent)==null?void 0:c.trim():o.current}})(),l=n.map(c=>c.trim());s.value(t,a,l),(i=e.current)==null||i.setAttribute(or,a),o.current=a}),o}var Rb=()=>{let[t,e]=p.useState(),r=Fr(()=>new Map);return mr(()=>{r.current.forEach(n=>n()),r.current=new Map},[t]),(n,o)=>{r.current.set(n,o),e({})}};function Ob(t){let e=t.type;return typeof e=="function"?e(t.props):"render"in e?e.render(t.props):t}function ds({asChild:t,children:e},r){return t&&p.isValidElement(e)?p.cloneElement(Ob(e),{ref:e.ref},r(e.props.children)):r(e)}var Ib={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Yh=p.forwardRef(({className:t,...e},r)=>h.jsx(Le,{ref:r,className:Ce("flex h-full w-full flex-col overflow-hidden bg-metallicBlue text-popover-foreground",t),...e}));Yh.displayName=Le.displayName;const Zh=p.forwardRef(({className:t,...e},r)=>h.jsxs("div",{className:"flex items-center border-b px-1 pb-1","cmdk-input-wrapper":"",children:[h.jsx("span",{className:"sprite mr-1 texture-hud_char_gt"}),h.jsx(Le.Input,{ref:r,className:Ce("flex h-1 w-full bg-pastelBlue py-1 outline-none placeholder:text-shadow disabled:cursor-not-allowed",t),...e})]}));Zh.displayName=Le.Input.displayName;const Qh=p.forwardRef(({className:t,...e},r)=>h.jsx(Le.List,{ref:r,className:Ce("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...e}));Qh.displayName=Le.List.displayName;const ef=p.forwardRef((t,e)=>h.jsx(Le.Empty,{ref:e,className:"pl-1",...t}));ef.displayName=Le.Empty.displayName;const tf=p.forwardRef(({className:t,...e},r)=>h.jsx(Le.Group,{ref:r,className:Ce("overflow-hidden",t),...e}));tf.displayName=Le.Group.displayName;const jb=p.forwardRef(({className:t,...e},r)=>h.jsx(Le.Separator,{ref:r,className:Ce("-mx-1 h-px bg-shadow",t),...e}));jb.displayName=Le.Separator.displayName;const hs=p.forwardRef(({className:t,...e},r)=>h.jsx(Le.Item,{ref:r,className:Ce("relative flex cursor-default select-none items-center text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-midRed hover:bg-pastelBlue data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...e}));hs.displayName=Le.Item.displayName;const St=p.forwardRef(({className:t,selected:e,...r},n)=>h.jsx("button",{"data-selected":e,className:Ce(`inline-flex items-center justify-center whitespace-nowrap 
          bg-metallicBlue zx:bg-zxBlue border-none border-shadow
          gap-2
           disabled:bg-midGrey disabled:text-lightGrey 
           data-[selected=true]:bg-lightBeige
           [&:not(:disabled):hover:not([data-selected=true])]:bg-pastelBlue 
           `,t),ref:n,...r}));St.displayName="Button";var ic=!1,sr,Wi,Gi,No,Lo,rf,Do,qi,Vi,Ki,nf,Xi,Ji,of,sf;function Ie(){if(!ic){ic=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),r=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(Xi=/\b(iPhone|iP[ao]d)/.exec(t),Ji=/\b(iP[ao]d)/.exec(t),Ki=/Android/i.exec(t),of=/FBAN\/\w+;/i.exec(t),sf=/Mobile/i.exec(t),nf=!!/Win64/.exec(t),e){sr=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN,sr&&document&&document.documentMode&&(sr=document.documentMode);var n=/(?:Trident\/(\d+.\d+))/.exec(t);rf=n?parseFloat(n[1])+4:sr,Wi=e[2]?parseFloat(e[2]):NaN,Gi=e[3]?parseFloat(e[3]):NaN,No=e[4]?parseFloat(e[4]):NaN,No?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),Lo=e&&e[1]?parseFloat(e[1]):NaN):Lo=NaN}else sr=Wi=Gi=Lo=No=NaN;if(r){if(r[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);Do=o?parseFloat(o[1].replace("_",".")):!0}else Do=!1;qi=!!r[2],Vi=!!r[3]}else Do=qi=Vi=!1}}var Yi={ie:function(){return Ie()||sr},ieCompatibilityMode:function(){return Ie()||rf>sr},ie64:function(){return Yi.ie()&&nf},firefox:function(){return Ie()||Wi},opera:function(){return Ie()||Gi},webkit:function(){return Ie()||No},safari:function(){return Yi.webkit()},chrome:function(){return Ie()||Lo},windows:function(){return Ie()||qi},osx:function(){return Ie()||Do},linux:function(){return Ie()||Vi},iphone:function(){return Ie()||Xi},mobile:function(){return Ie()||Xi||Ji||Ki||sf},nativeApp:function(){return Ie()||of},android:function(){return Ie()||Ki},ipad:function(){return Ie()||Ji}},$b=Yi,zb=!!(typeof window<"u"&&window.document&&window.document.createElement),Nb={canUseDOM:zb},af=Nb,lf;af.canUseDOM&&(lf=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);function Lb(t,e){if(!af.canUseDOM||e&&!("addEventListener"in document))return!1;var r="on"+t,n=r in document;if(!n){var o=document.createElement("div");o.setAttribute(r,"return;"),n=typeof o[r]=="function"}return!n&&lf&&t==="wheel"&&(n=document.implementation.hasFeature("Events.wheel","3.0")),n}var Db=Lb,ac=10,lc=40,cc=800;function cf(t){var e=0,r=0,n=0,o=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),n=e*ac,o=r*ac,"deltaY"in t&&(o=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||o)&&t.deltaMode&&(t.deltaMode==1?(n*=lc,o*=lc):(n*=cc,o*=cc)),n&&!e&&(e=n<1?-1:1),o&&!r&&(r=o<1?-1:1),{spinX:e,spinY:r,pixelX:n,pixelY:o}}cf.getEventType=function(){return $b.firefox()?"DOMMouseScroll":Db("wheel")?"wheel":"mousewheel"};var Mb=cf;/**
* Checks if an event is supported in the current execution environment.
*
* NOTE: This will not work correctly for non-generic events such as `change`,
* `reset`, `load`, `error`, and `select`.
*
* Borrows from Modernizr.
*
* @param {string} eventNameSuffix Event name, e.g. "click".
* @param {?boolean} capture Check if the capture phase is supported.
* @return {boolean} True if the event is supported.
* @internal
* @license Modernizr 3.0.0pre (Custom Build) | MIT
*/const Bb=(t,e)=>{const r=p.useRef(0),n=p.useCallback(o=>{const s=o;s.preventDefault(),s.stopPropagation();const i=Mb(s);r.current-=i.spinY,r.current>=1&&(e(1),r.current=0),r.current<=-1&&(e(-1),r.current=0)},[e]);p.useEffect(()=>{const o=t.current;if(o!==null)return o.addEventListener("wheel",n,{passive:!1}),()=>{o.removeEventListener("wheel",n)}},[t,n])},uf=(t,e,r)=>{const n=p.useRef(0);return Bb(t,o=>{const s=(n.current+o+256*e.length)%e.length;n.current=s,r(e[s],s)})},Fb=({value:t,onSelect:e})=>h.jsx(hs,{value:t,onSelect:e,className:"px-1",children:h.jsx(Z,{children:t})}),fs=t=>{const{values:e,onSelect:r,triggerButtonClassName:n="",triggerButtonStyle:o=pe,triggerButtonLabel:s="",OptionCommandItem:i=Fb}=t,[a,l]=p.useState(!1),c=p.useRef(null);return uf(c,e,u=>{r(u)}),h.jsxs(Th,{open:a,onOpenChange:l,children:[h.jsx(Rh,{asChild:!0,children:h.jsxs(St,{className:Ce("h-2 px-1 flex flex-row gap-1 justify-start leading-none",n),style:o,ref:c,children:[typeof s=="string"?h.jsx(Z,{className:"grow overflow-hidden text-left",children:s}):s,h.jsx(Z,{className:"grow-0",children:a?"X":"â¬‡"})]})}),h.jsx(Oh,{className:"p-0",children:h.jsx(qa,{scaleFactor:2,children:h.jsxs(Yh,{className:"w-[--radix-popper-anchor-width]",children:[t.disableCommandInput===!0?null:h.jsx(Zh,{placeholder:t.placeholder}),h.jsxs(Qh,{children:[h.jsx(ef,{children:h.jsx(Z,{children:"Nothing found"})}),h.jsx(tf,{children:e.map(u=>h.jsx(i,{value:u,onSelect:d=>{l(!1),r(d)}},u))})]})]})})})]})},Ub=()=>{const t=pt(),e=Xu();return h.jsx(h.Fragment,{children:h.jsx(fs,{value:e,values:eg,onSelect:r=>{t(tg(r))},disableCommandInput:!0,triggerButtonLabel:e,triggerButtonClassName:"w-13"})})};function df({campaign:t,onSelect:e,headRoomId:r,heelsRoomId:n,value:o,triggerButtonClassName:s,excludeRoomIds:i=[]}){const a=Object.keys(t.rooms).filter(l=>!i.includes(l));return h.jsx(fs,{onSelect:l=>e?.(l),value:o,values:a,triggerButtonClassName:s,placeholder:"search",disableCommandInput:!1,triggerButtonLabel:o??"none",OptionCommandItem:({value:l,onSelect:c})=>h.jsxs(hs,{value:l,onSelect:c,className:"px-1",children:[r===l&&h.jsx("span",{className:"sprite mr-1 my-1 texture-head_walking_towards_2"}),n===l&&h.jsx("span",{className:"sprite mr-1 my-1 texture-heels_walking_towards_2"}),h.jsx(Z,{children:l})]})})}const me=t=>t,Zi="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",G=me("[button:not([data-selected=true]):not(:hover)_&]:sprite-revert-to-two-tone-dim"),Pe=me("flex flex-wrap gap-oneScaledPix w-full"),nt=({className:t,onClick:e,children:r,disabled:n=!1,isCurrentTool:o=!1})=>h.jsx(St,{disabled:n,selected:o,className:`
        ${Zi} 
        active:pt-oneScaledPix  gap-0 inline-flex overflow-hidden 
        
        ${t??""}`,onClick:e,children:r}),Hb=()=>{const t=be(e=>e.levelEditor.selectedJsonItemIds.length>0);return h.jsx(nt,{className:"bg-midRed",disabled:!t,onClick:()=>M.dispatch(td()),children:h.jsx("span",{className:"sprite sprite-tinted texture-hud_char_X relative"})})},Qa=({className:t,value:e,onClick:r,trueLabel:n="ON",falseLabel:o="OFF",label:s})=>{const i=Math.max(n.length,o.length)+1,a=n.padStart(i," "),l=o.padEnd(i," ");return h.jsxs("span",{onClick:c=>r?.(c,!e),className:Ce("inline-flex justify-between",t),children:[s&&h.jsx(Z,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),h.jsx(Z,{className:Ah("inline-block w-min h-min",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:e?a:l})]})},Wb=()=>{const t=pt();return h.jsx(Qa,{className:"w-full",label:"snap",value:be(e=>e.levelEditor.halfGridResolution),onClick:(e,r)=>{t(Ng(r))},falseLabel:"Block",trueLabel:"Half"})},$=({itemTool:t,children:e,className:r})=>{const n=be(lr),o=Ge(n?.type==="item"&&n.item,t);return h.jsx(nt,{isCurrentTool:o,className:r,onClick:()=>M.dispatch(Wt({type:"item",item:t})),children:e})},_n=({children:t})=>{const[e,r]=p.useState(!1),[n,o]=p.useState(0),s=p.useRef(null);uf(s,t,(a,l)=>{o(l)});const i=t[n];return h.jsxs(Th,{open:e,onOpenChange:r,children:[h.jsx("div",{className:Ce(Zi,"relative",{"drop-shadow-oneBlock z-popups":e}),children:h.jsxs("span",{className:"content",ref:s,children:[i,h.jsx(Rh,{asChild:!0,children:h.jsx(St,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:h.jsx(Z,{className:"pl-oneScaledPix",children:e?"X":"â¬‡"})})})]})}),h.jsx(Oh,{children:h.jsx(qa,{scaleFactor:2,children:h.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:t.map((a,l)=>l===n?null:h.jsx("div",{className:Zi,onClick:()=>{o(l),r(!1)},children:a},l))})})})]})},Gb=()=>{const e=be(lr)?.type==="pointer";return h.jsx(nt,{onClick:()=>M.dispatch(Wt({type:"pointer"})),isCurrentTool:e,children:h.jsx("span",{className:"sprite texture-editor_tool_pointer relative"})})},z={pureBlack:new q("#000000"),shadow:new q("#325149"),midGrey:new q("#7F7773"),lightGrey:new q("#BBB1AB"),white:new q("#FBFEFB"),pastelBlue:new q("#75ACFF"),metallicBlue:new q("#366CAA"),pink:new q("#D68ED1"),moss:new q("#9E9600"),redShadow:new q("#805E50"),midRed:new q("#CA7463"),lightBeige:new q("#DAA78F"),highlightBeige:new q("#EBC690"),alpha:new q("#1E7790"),replaceLight:new q("#08A086"),replaceDark:new q("#0A4730")},$n=.33,hf=t=>{const[e,r,n]=t.toUint8RgbArray();return new q({r:e*.75,g:r*.75,b:n*.75})},nn=(t,e=$n)=>{const[r,n,o]=t.toUint8RgbArray();return new q({r:r*e,g:n*e,b:o*e})};function WP(t){t=t.replace(/^#/,"");let e=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),n=parseInt(t.substring(4,6),16);e=Math.floor(e*$n),r=Math.floor(r*$n),n=Math.floor(n*$n);const o=s=>s.toString(16).padStart(2,"0");return`#${o(e)}${o(r)}${o(n)}`}const Ke={original:new q(cn.zxWhite),basic:z.white,dimmed:z.lightGrey},Xe={original:new q(cn.zxYellow),basic:new q(15654246),dimmed:nn(new q(15654246),.5)},ff={original:new q(cn.zxYellow),basic:z.midRed,dimmed:z.redShadow},it={original:new q(cn.zxMagenta),basic:z.pink,dimmed:nn(z.pink,.5)},xe={original:new q(cn.zxCyan),basic:z.pastelBlue,dimmed:nn(z.pastelBlue,.5)},at={original:new q(cn.zxGreen),basic:z.moss,dimmed:nn(z.moss,.5)},ps={white:{basic:{main:Ke,edges:{towards:{...xe,dimInOriginal:!1},right:{...Xe,dimInOriginal:!0}},hud:{lives:Xe,dimmed:it,icons:xe}},dimmed:{main:Ke,edges:{towards:{...at,dimInOriginal:!1},right:{...xe,dimInOriginal:!0}},hud:{lives:ff,dimmed:it,icons:xe}}},yellow:{basic:{main:Xe,edges:{towards:{...at,dimInOriginal:!1},right:{...Ke,dimInOriginal:!0}},hud:{lives:xe,dimmed:it,icons:at}},dimmed:{main:Xe,edges:{towards:{...xe,dimInOriginal:!0},right:{...xe,dimInOriginal:!1}},hud:{lives:xe,dimmed:it,icons:at}}},magenta:{basic:{main:it,edges:{towards:{...at,dimInOriginal:!0},right:{...xe,dimInOriginal:!0}},hud:{lives:Ke,dimmed:xe,icons:Xe}},dimmed:{main:it,edges:{towards:{...at,dimInOriginal:!0},right:{...xe,dimInOriginal:!0}},hud:{lives:Ke,dimmed:xe,icons:Xe}}},cyan:{basic:{main:xe,edges:{towards:{...it,dimInOriginal:!1},right:{...Ke,dimInOriginal:!1}},hud:{lives:Ke,dimmed:at,icons:Xe}},dimmed:{main:xe,edges:{towards:{...it,dimInOriginal:!0},right:{...Ke,dimInOriginal:!0}},hud:{lives:Ke,dimmed:at,icons:Xe}}},green:{basic:{main:at,edges:{towards:{...xe,dimInOriginal:!1},right:{...Xe,dimInOriginal:!1}},hud:{lives:Ke,dimmed:it,icons:xe}},dimmed:{main:at,edges:{towards:{...xe,dimInOriginal:!0},right:{...Xe,dimInOriginal:!0}},hud:{lives:Ke,dimmed:it,icons:xe}}}},Zo=t=>ps[t.hue][t.shade],Vr={head:z.pastelBlue,heels:z.pink},uc=t=>{const{main:e}=ps[t].basic;return{backgroundColor:e.basic.toHex(),borderColor:e.dimmed.toHex()}};function qb(){const t=pt(),e=be(Lg);return h.jsxs(h.Fragment,{children:[h.jsx(fs,{value:e.hue,onSelect:r=>{t(vl({hue:r}))},values:rg,disableCommandInput:!0,OptionCommandItem:({value:r,onSelect:n})=>h.jsx(hs,{value:r,className:"border-l-3 h-2 w-full p-0",style:uc(r),onSelect:n}),triggerButtonLabel:"colour",triggerButtonClassName:Ce("w-full",`${e.hue==="white"||e.hue==="yellow"?"text-pureBlack":"text-white"}`),triggerButtonStyle:uc(e.hue)}),h.jsx(Qa,{className:"w-full",label:"shade",value:e.shade==="basic",onClick:(r,n)=>{t(vl({shade:n?"basic":"dimmed"}))},falseLabel:"dim",trueLabel:"basic"})]})}function Vb(){const t=pt(),e=be(Dg);return h.jsx(fs,{value:e,onSelect:r=>{t(Mg(r))},values:ng,disableCommandInput:!0,triggerButtonClassName:"w-full",triggerButtonLabel:e})}const Ot=({iconClasses:t,text:e})=>h.jsxs("div",{className:"relative w-full h-full",children:[h.jsx("span",{className:`sprite absolute top-0 left-0 ${t} ${G}`}),h.jsx(Z,{className:"bg-metallicBlueHalfbrite absolute top-0 right-0 pl-oneScaledPix block",children:e})]}),xo=({iconClassName:t})=>h.jsx(vt,{topClasses:me("texture-bubbles_white_2 [button:hover_&]:texture-animated-bubbles_white"),bottomClasses:t}),vt=({topClasses:t,bottomClasses:e="texture-headlessBase"})=>h.jsxs("div",{className:"relative w-full h-full",children:[h.jsx("span",{className:`sprite absolute top-[calc(9px*var(--scale))] left-0 ${e} ${G}`}),h.jsx("span",{className:`sprite absolute top-[calc(-3px*var(--scale))] left-0 ${t} ${G}`})]}),Kb="[button:not(:disabled):hover_&]:hidden",Xb="hidden [button:not(:disabled):hover_&]:inline mt-quarter",Jb="hidden [button:not(:disabled):hover_&]:inline",qn=({icon:t,topText:e,bottomText:r})=>h.jsxs("span",{className:"w-full h-full flex flex-col items-center justify-center",children:[h.jsx("span",{className:Kb,children:t}),h.jsx(Z,{className:Xb,children:e}),h.jsx(Z,{className:Jb,children:r})]}),Yb=()=>{const t=pt(),e=be(Bg),r=be(Fg);return h.jsxs("div",{className:"flex flex-row gap-oneScaledPix bg-metallicBlue",children:[h.jsx(nt,{disabled:!e,onClick:()=>{t(rd())},children:h.jsx(qn,{icon:h.jsx(Z,{children:"â¬…"}),topText:"un",bottomText:"do"})}),h.jsx(nt,{disabled:!r,onClick:()=>{t(nd())},children:h.jsx(qn,{icon:h.jsx(Z,{children:"âž¡"}),topText:"re",bottomText:"do"})})]})},Zb=()=>{const t=pt();return h.jsx(Qa,{className:"w-full",label:"scenery",value:be(e=>e.levelEditor.wallsFloorsLocked),onClick:(e,r)=>{t(Ug(r))},falseLabel:"edit",trueLabel:"lock"})},Qb=()=>{const t=be(r=>Go(r).planet),e=me(t==="moonbase"?"texture-door_frame_moonbase_x_whole":"texture-door_frame_generic_x_whole");return h.jsx($,{itemTool:{type:"door",config:{direction:"away",toRoom:"(placeholder)"}},children:h.jsx("span",{className:`sprite ${e} ${G}`})})},ex=()=>{const t=be(n=>Go(n).planet),e={type:"wall",config:{direction:"away",tiles:Array.from(Hg(t,1))}},r=me(t==="blacktooth"?"texture-blacktooth_wall_plain_away":t==="bookworld"?"texture-bookworld_wall_cowboy_away":t==="jail"?"texture-jail_wall_bars_away":t==="egyptus"?"texture-egyptus_wall_hieroglyphics_away":t==="market"?"texture-market_wall_passage_away":t==="moonbase"?"texture-moonbase_wall_window1_away":t==="penitentiary"?"texture-penitentiary_wall_loop_away":"texture-safari_wall_wall_away");return h.jsx($,{itemTool:e,children:h.jsx("span",{className:`sprite ${r} ${G}`})})},tx=()=>h.jsx(nt,{className:"bg-midRed",onClick:()=>M.dispatch(Wg()),children:h.jsx(Z,{className:"relative leading-none",children:"CLR"})}),pf=({currentRoomId:t,direction:e})=>{const r=be(({levelEditor:s})=>s.campaignInProgress),n=be(({levelEditor:s})=>s.currentlyEditingRoomId),o=pt();return h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap pt-1",children:[h.jsxs(Z,{className:"text-lightGrey leading-none",children:["Room ",e==="roomAbove"?"â¬†":"â¬‡"]}),h.jsx("div",{className:"flex-grow"}),h.jsxs("div",{className:"flex flex-row gap-oneScaledPix",children:[h.jsx(St,{className:"w-2 leading-none bg-moss",children:h.jsx(Z,{onClick:()=>o(Ts({direction:e,createNew:!0})),children:"+"})}),h.jsx(St,{className:"w-2 leading-none bg-midRed",children:h.jsx(Z,{onClick:()=>o(Ts({direction:e,createNew:!1,roomId:void 0})),children:"x"})})]})]}),h.jsx("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap",children:h.jsx(df,{value:t,campaign:r,excludeRoomIds:[n],triggerButtonClassName:"w-full",onSelect:s=>{o(Ts({direction:e,createNew:!1,roomId:s}))}})})]})},rx=()=>{const t=be(({levelEditor:e})=>od(e).roomAbove);return h.jsx(h.Fragment,{children:h.jsx(pf,{currentRoomId:t,direction:"roomAbove"})})},nx=()=>{const t=be(({levelEditor:e})=>od(e).roomBelow);return h.jsx(h.Fragment,{children:h.jsx(pf,{currentRoomId:t,direction:"roomBelow"})})},ox=()=>{const t=be(({levelEditor:e})=>e.tool.type==="eyeDropper");return h.jsx(nt,{isCurrentTool:t,onClick:()=>M.dispatch(Wt({type:"eyeDropper"})),children:h.jsx("span",{className:"relative sprite texture-editor_tool_eyedropper leading-none"})})},gs=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const sx="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Pn=Array.prototype.slice.call(sx),_o=(t=>{let e={};return t.forEach((r,n)=>e[r]=n),e})(Pn),ix=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Mo=String.fromCharCode.bind(String),dc=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),ax=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),gf=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),lx=t=>{let e,r,n,o,s="";const i=t.length%3;for(let a=0;a<t.length;){if((r=t.charCodeAt(a++))>255||(n=t.charCodeAt(a++))>255||(o=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=r<<16|n<<8|o,s+=Pn[e>>18&63]+Pn[e>>12&63]+Pn[e>>6&63]+Pn[e&63]}return i?s.slice(0,i-3)+"===".substring(i):s},cx=typeof btoa=="function"?t=>btoa(t):gs?t=>Buffer.from(t,"binary").toString("base64"):lx,hc=gs?t=>Buffer.from(t).toString("base64"):t=>{let r=[];for(let n=0,o=t.length;n<o;n+=4096)r.push(Mo.apply(null,t.subarray(n,n+4096)));return cx(r.join(""))},ux=(t,e=!1)=>e?ax(hc(t)):hc(t),dx=t=>{if(t=t.replace(/\s+/g,""),!ix.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,r="",n,o;for(let s=0;s<t.length;)e=_o[t.charAt(s++)]<<18|_o[t.charAt(s++)]<<12|(n=_o[t.charAt(s++)])<<6|(o=_o[t.charAt(s++)]),r+=n===64?Mo(e>>16&255):o===64?Mo(e>>16&255,e>>8&255):Mo(e>>16&255,e>>8&255,e&255);return r},hx=typeof atob=="function"?t=>atob(gf(t)):gs?t=>Buffer.from(t,"base64").toString("binary"):dx,fx=gs?t=>dc(Buffer.from(t,"base64")):t=>dc(hx(t).split("").map(e=>e.charCodeAt(0))),px=t=>fx(gx(t)),gx=t=>gf(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),mx=!0,mf=async t=>{const e=JSON.stringify(t),n=new TextEncoder().encode(e),o=new Blob([n]),s=new CompressionStream(yf),i=o.stream().pipeThrough(s),a=await new Response(i).arrayBuffer(),l=new Uint8Array(a);return ux(l,mx)},yx=async t=>{try{const e=px(t),r=new Blob([e]),n=new DecompressionStream(yf),o=r.stream().pipeThrough(n),s=await new Response(o).text();return JSON.parse(s)}catch(e){throw new Error("error decompressing object",{cause:e})}},yf="gzip",vx=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Ft(async()=>{const{default:n}=await Promise.resolve().then(()=>gn);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)};class el extends Error{constructor(e,r="FunctionsError",n){super(e),this.name=r,this.context=n}}class wx extends el{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class fc extends el{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class pc extends el{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Qi;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Qi||(Qi={}));var bx=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class xx{constructor(e,{headers:r={},customFetch:n,region:o=Qi.Any}={}){this.url=e,this.headers=r,this.region=o,this.fetch=vx(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,r={}){var n;return bx(this,void 0,void 0,function*(){try{const{headers:o,method:s,body:i}=r;let a={},{region:l}=r;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(a["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:u}).catch(m=>{throw new wx(m)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new fc(d);if(!d.ok)throw new pc(d);let g=((n=d.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),y;return g==="application/json"?y=yield d.json():g==="application/octet-stream"?y=yield d.blob():g==="text/event-stream"?y=d:g==="multipart/form-data"?y=yield d.formData():y=yield d.text(),{data:y,error:null,response:d}}catch(o){return{data:null,error:o,response:o instanceof pc||o instanceof fc?o.context:void 0}}})}}var _e={},Ar={},Tr={},Rr={},Or={},Ir={},_x=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},on=_x();const Sx=on.fetch,vf=on.fetch.bind(on),wf=on.Headers,kx=on.Request,Cx=on.Response,gn=Object.freeze(Object.defineProperty({__proto__:null,Headers:wf,Request:kx,Response:Cx,default:vf,fetch:Sx},Symbol.toStringTag,{value:"Module"})),Px=og(gn);var So={},gc;function bf(){if(gc)return So;gc=1,Object.defineProperty(So,"__esModule",{value:!0});class t extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return So.default=t,So}var mc;function xf(){if(mc)return Ir;mc=1;var t=Ir&&Ir.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Ir,"__esModule",{value:!0});const e=t(Px),r=t(bf());class n{constructor(s){this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=s.headers,this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=s.shouldThrowOnError,this.signal=s.signal,this.isMaybeSingle=s.isMaybeSingle,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=Object.assign({},this.headers),this.headers[s]=i,this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,f;let g=null,y=null,m=null,v=c.status,w=c.statusText;if(c.ok){if(this.method!=="HEAD"){const k=await c.text();k===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?y=k:y=JSON.parse(k))}const b=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),x=(d=c.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");b&&x&&x.length>1&&(m=parseInt(x[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(y)&&(y.length>1?(g={code:"PGRST116",details:`Results contain ${y.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},y=null,m=null,v=406,w="Not Acceptable"):y.length===1?y=y[0]:y=null)}else{const b=await c.text();try{g=JSON.parse(b),Array.isArray(g)&&c.status===404&&(y=[],g=null,v=200,w="OK")}catch{c.status===404&&b===""?(v=204,w="No Content"):g={message:b}}if(g&&this.isMaybeSingle&&(!((f=g?.details)===null||f===void 0)&&f.includes("0 rows"))&&(g=null,v=200,w="OK"),g&&this.shouldThrowOnError)throw new r.default(g)}return{error:g,data:y,count:m,status:v,statusText:w}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,f;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(d=c?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(f=c?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,i)}returns(){return this}overrideTypes(){return this}}return Ir.default=n,Ir}var yc;function _f(){if(yc)return Or;yc=1;var t=Or&&Or.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Or,"__esModule",{value:!0});const e=t(xf());class r extends e.default{select(o){let s=!1;const i=(o??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(o,{ascending:s=!0,nullsFirst:i,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${o}.${s?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:s,referencedTable:i=s}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${o}`),this}range(o,s,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${o}`),this.url.searchParams.set(c,`${s-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:o=!1,verbose:s=!1,settings:i=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[o?"analyze":null,s?"verbose":null,i?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${f}"; options=${d};`,c==="json"?this:this}rollback(){var o;return((o=this.headers.Prefer)!==null&&o!==void 0?o:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Or.default=r,Or}var vc;function tl(){if(vc)return Rr;vc=1;var t=Rr&&Rr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Rr,"__esModule",{value:!0});const e=t(_f());class r extends e.default{eq(o,s){return this.url.searchParams.append(o,`eq.${s}`),this}neq(o,s){return this.url.searchParams.append(o,`neq.${s}`),this}gt(o,s){return this.url.searchParams.append(o,`gt.${s}`),this}gte(o,s){return this.url.searchParams.append(o,`gte.${s}`),this}lt(o,s){return this.url.searchParams.append(o,`lt.${s}`),this}lte(o,s){return this.url.searchParams.append(o,`lte.${s}`),this}like(o,s){return this.url.searchParams.append(o,`like.${s}`),this}likeAllOf(o,s){return this.url.searchParams.append(o,`like(all).{${s.join(",")}}`),this}likeAnyOf(o,s){return this.url.searchParams.append(o,`like(any).{${s.join(",")}}`),this}ilike(o,s){return this.url.searchParams.append(o,`ilike.${s}`),this}ilikeAllOf(o,s){return this.url.searchParams.append(o,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(o,s){return this.url.searchParams.append(o,`ilike(any).{${s.join(",")}}`),this}is(o,s){return this.url.searchParams.append(o,`is.${s}`),this}in(o,s){const i=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(o,`in.(${i})`),this}contains(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cs.{${s.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(s)}`),this}containedBy(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cd.{${s.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(s)}`),this}rangeGt(o,s){return this.url.searchParams.append(o,`sr.${s}`),this}rangeGte(o,s){return this.url.searchParams.append(o,`nxl.${s}`),this}rangeLt(o,s){return this.url.searchParams.append(o,`sl.${s}`),this}rangeLte(o,s){return this.url.searchParams.append(o,`nxr.${s}`),this}rangeAdjacent(o,s){return this.url.searchParams.append(o,`adj.${s}`),this}overlaps(o,s){return typeof s=="string"?this.url.searchParams.append(o,`ov.${s}`):this.url.searchParams.append(o,`ov.{${s.join(",")}}`),this}textSearch(o,s,{config:i,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=i===void 0?"":`(${i})`;return this.url.searchParams.append(o,`${l}fts${c}.${s}`),this}match(o){return Object.entries(o).forEach(([s,i])=>{this.url.searchParams.append(s,`eq.${i}`)}),this}not(o,s,i){return this.url.searchParams.append(o,`not.${s}.${i}`),this}or(o,{foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${o})`),this}filter(o,s,i){return this.url.searchParams.append(o,`${s}.${i}`),this}}return Rr.default=r,Rr}var wc;function Sf(){if(wc)return Tr;wc=1;var t=Tr&&Tr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Tr,"__esModule",{value:!0});const e=t(tl());class r{constructor(o,{headers:s={},schema:i,fetch:a}){this.url=o,this.headers=s,this.schema=i,this.fetch=a}select(o,{head:s=!1,count:i}={}){const a=s?"HEAD":"GET";let l=!1;const c=(o??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),i&&(this.headers.Prefer=`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(o,{count:s,defaultToNull:i=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(o)){const c=o.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}upsert(o,{onConflict:s,ignoreDuplicates:i=!1,count:a,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${i?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(o)){const d=o.reduce((f,g)=>f.concat(Object.keys(g)),[]);if(d.length>0){const f=[...new Set(d)].map(g=>`"${g}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}update(o,{count:s}={}){const i="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}delete({count:o}={}){const s="DELETE",i=[];return o&&i.push(`count=${o}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Tr.default=r,Tr}var Sn={},kn={},bc;function Ex(){return bc||(bc=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.version=void 0,kn.version="0.0.0-automated"),kn}var xc;function Ax(){if(xc)return Sn;xc=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.DEFAULT_HEADERS=void 0;const t=Ex();return Sn.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${t.version}`},Sn}var _c;function Tx(){if(_c)return Ar;_c=1;var t=Ar&&Ar.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ar,"__esModule",{value:!0});const e=t(Sf()),r=t(tl()),n=Ax();class o{constructor(i,{headers:a={},schema:l,fetch:c}={}){this.url=i,this.headers=Object.assign(Object.assign({},n.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new o(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:l=!1,get:c=!1,count:u}={}){let d;const f=new URL(`${this.url}/rpc/${i}`);let g;l||c?(d=l?"HEAD":"GET",Object.entries(a).filter(([m,v])=>v!==void 0).map(([m,v])=>[m,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([m,v])=>{f.searchParams.append(m,v)})):(d="POST",g=a);const y=Object.assign({},this.headers);return u&&(y.Prefer=`count=${u}`),new r.default({method:d,url:f,headers:y,schema:this.schemaName,body:g,fetch:this.fetch,allowEmpty:!1})}}return Ar.default=o,Ar}var Sc;function Rx(){if(Sc)return _e;Sc=1;var t=_e&&_e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(_e,"__esModule",{value:!0}),_e.PostgrestError=_e.PostgrestBuilder=_e.PostgrestTransformBuilder=_e.PostgrestFilterBuilder=_e.PostgrestQueryBuilder=_e.PostgrestClient=void 0;const e=t(Tx());_e.PostgrestClient=e.default;const r=t(Sf());_e.PostgrestQueryBuilder=r.default;const n=t(tl());_e.PostgrestFilterBuilder=n.default;const o=t(_f());_e.PostgrestTransformBuilder=o.default;const s=t(xf());_e.PostgrestBuilder=s.default;const i=t(bf());return _e.PostgrestError=i.default,_e.default={PostgrestClient:e.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:s.default,PostgrestError:i.default},_e}var Ox=Rx();const Ix=Jn(Ox),{PostgrestClient:jx,PostgrestQueryBuilder:GP,PostgrestFilterBuilder:qP,PostgrestTransformBuilder:VP,PostgrestBuilder:KP,PostgrestError:XP}=Ix;function $x(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const zx=$x(),Nx="2.11.15",Lx=`realtime-js/${Nx}`,Dx="1.0.0",kf=1e4,Mx=1e3;var zn;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(zn||(zn={}));var Ee;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Ee||(Ee={}));var Ye;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Ye||(Ye={}));var ea;(function(t){t.websocket="websocket"})(ea||(ea={}));var ir;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(ir||(ir={}));class Bx{constructor(){this.HEADER_LENGTH=1}decode(e,r){return e.constructor===ArrayBuffer?r(this._binaryDecode(e)):r(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const r=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,r,n)}_decodeBroadcast(e,r,n){const o=r.getUint8(1),s=r.getUint8(2);let i=this.HEADER_LENGTH+2;const a=n.decode(e.slice(i,i+o));i=i+o;const l=n.decode(e.slice(i,i+s));i=i+s;const c=JSON.parse(n.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class Cf{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var fe;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(fe||(fe={}));const kc=(t,e,r={})=>{var n;const o=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((s,i)=>(s[i]=Fx(i,t,e,o),s),{})},Fx=(t,e,r,n)=>{const o=e.find(a=>a.name===t),s=o?.type,i=r[t];return s&&!n.includes(s)?Pf(s,i):ta(i)},Pf=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return Gx(e,r)}switch(t){case fe.bool:return Ux(e);case fe.float4:case fe.float8:case fe.int2:case fe.int4:case fe.int8:case fe.numeric:case fe.oid:return Hx(e);case fe.json:case fe.jsonb:return Wx(e);case fe.timestamp:return qx(e);case fe.abstime:case fe.date:case fe.daterange:case fe.int4range:case fe.int8range:case fe.money:case fe.reltime:case fe.text:case fe.time:case fe.timestamptz:case fe.timetz:case fe.tsrange:case fe.tstzrange:return ta(e);default:return ta(e)}},ta=t=>t,Ux=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Hx=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},Wx=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},Gx=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let s;const i=t.slice(1,r);try{s=JSON.parse("["+i+"]")}catch{s=i?i.split(","):[]}return s.map(a=>Pf(e,a))}return t},qx=t=>typeof t=="string"?t.replace(" ","T"):t,Ef=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Js{constructor(e,r,n={},o=kf){this.channel=e,this.event=r,this.payload=n,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Cc;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Cc||(Cc={}));class Nn{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Nn.syncState(this.state,o,s,i),this.pendingDiffs.forEach(l=>{this.state=Nn.syncDiff(this.state,l,s,i)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=Nn.syncDiff(this.state,o,s,i),a())}),this.onJoin((o,s,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:s,newPresences:i})}),this.onLeave((o,s,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:s,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,o){const s=this.cloneDeep(e),i=this.transformState(r),a={},l={};return this.map(s,(c,u)=>{i[c]||(l[c]=u)}),this.map(i,(c,u)=>{const d=s[c];if(d){const f=u.map(v=>v.presence_ref),g=d.map(v=>v.presence_ref),y=u.filter(v=>g.indexOf(v.presence_ref)<0),m=d.filter(v=>f.indexOf(v.presence_ref)<0);y.length>0&&(a[c]=y),m.length>0&&(l[c]=m)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},n,o)}static syncDiff(e,r,n,o){const{joins:s,leaves:i}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),o||(o=()=>{}),this.map(s,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(g=>g.presence_ref),f=u.filter(g=>d.indexOf(g.presence_ref)<0);e[a].unshift(...f)}n(a,u,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,o(a,c,l),c.length===0&&delete e[a]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const o=e[n];return"metas"in o?r[n]=o.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):r[n]=o,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Pc;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Pc||(Pc={}));var Ec;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Ec||(Ec={}));var bt;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(bt||(bt={}));class rl{constructor(e,r={config:{}},n){this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=Ee.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new Js(this,Ye.join,this.params,this.timeout),this.rejoinTimer=new Cf(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ee.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ee.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Ee.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ee.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ye.reply,{},(o,s)=>{this._trigger(this._replyEventName(s),o)}),this.presence=new Nn(this),this.broadcastEndpointURL=Ef(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,r=this.timeout){var n,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Ee.closed){const{config:{broadcast:s,presence:i,private:a}}=this.params;this._onError(u=>e?.(bt.CHANNEL_ERROR,u)),this._onClose(()=>e?.(bt.CLOSED));const l={},c={broadcast:s,presence:i,postgres_changes:(o=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){e?.(bt.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,g=(d=f?.length)!==null&&d!==void 0?d:0,y=[];for(let m=0;m<g;m++){const v=f[m],{filter:{event:w,schema:S,table:b,filter:x}}=v,k=u&&u[m];if(k&&k.event===w&&k.schema===S&&k.table===b&&k.filter===x)y.push(Object.assign(Object.assign({},v),{id:k.id}));else{this.unsubscribe(),this.state=Ee.errored,e?.(bt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(bt.SUBSCRIBED);return}}).receive("error",u=>{this.state=Ee.errored,e?.(bt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e?.(bt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this._on(e,r,n)}async send(e,r={}){var n,o;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var i,a,l;const c=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ee.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ye.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(o=>{n=new Js(this,Ye.leave,{},e),n.receive("ok",()=>{r(),o("ok")}).receive("timeout",()=>{r(),o("timed out")}).receive("error",()=>{o("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,r,n){const o=new AbortController,s=setTimeout(()=>o.abort(),n),i=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:o.signal}));return clearTimeout(s),i}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Js(this,e,r,n);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var o,s;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=Ye;if(n&&[a,l,c,u].indexOf(i)>=0&&n!==this._joinRef())return;let f=this._onMessage(i,r,n);if(r&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(g=>{var y,m,v;return((y=g.filter)===null||y===void 0?void 0:y.event)==="*"||((v=(m=g.filter)===null||m===void 0?void 0:m.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(g=>g.callback(f,n)):(s=this.bindings[i])===null||s===void 0||s.filter(g=>{var y,m,v,w,S,b;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in g){const x=g.id,k=(y=g.filter)===null||y===void 0?void 0:y.event;return x&&((m=r.ids)===null||m===void 0?void 0:m.includes(x))&&(k==="*"||k?.toLocaleLowerCase()===((v=r.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const x=(S=(w=g?.filter)===null||w===void 0?void 0:w.event)===null||S===void 0?void 0:S.toLocaleLowerCase();return x==="*"||x===((b=r?.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===i}).map(g=>{if(typeof f=="object"&&"ids"in f){const y=f.data,{schema:m,table:v,commit_timestamp:w,type:S,errors:b}=y;f=Object.assign(Object.assign({},{schema:m,table:v,commit_timestamp:w,eventType:S,new:{},old:{},errors:b}),this._getPayloadRecords(y))}g.callback(f,n)})}_isClosed(){return this.state===Ee.closed}_isJoined(){return this.state===Ee.joined}_isJoining(){return this.state===Ee.joining}_isLeaving(){return this.state===Ee.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const o=e.toLocaleLowerCase(),s={type:o,filter:r,callback:n};return this.bindings[o]?this.bindings[o].push(s):this.bindings[o]=[s],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(o=>{var s;return!(((s=o.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===n&&rl.isEqual(o.filter,r))}),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ye.close,{},e)}_onError(e){this._on(Ye.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ee.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=kc(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=kc(e.columns,e.old_record)),r}}const Ac=()=>{},Vx=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Kx{constructor(e,r){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=kf,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ac,this.ref=0,this.logger=Ac,this.conn=null,this.sendBuffer=[],this.serializer=new Bx,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>Ft(async()=>{const{default:l}=await Promise.resolve().then(()=>gn);return{default:l}},void 0).then(({default:l})=>l(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${ea.websocket}`,this.httpEndpoint=Ef(e),r?.transport?this.transport=r.transport:this.transport=null,r?.params&&(this.params=r.params),r?.timeout&&(this.timeout=r.timeout),r?.logger&&(this.logger=r.logger),(r?.logLevel||r?.log_level)&&(this.logLevel=r.logLevel||r.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),r?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=r.heartbeatIntervalMs);const o=(n=r?.params)===null||n===void 0?void 0:n.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=r?.reconnectAfterMs?r.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=r?.encode?r.encode:(s,i)=>i(JSON.stringify(s)),this.decode=r?.decode?r.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Cf(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(r?.fetch),r?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=r?.worker||!1,this.workerUrl=r?.workerUrl}this.accessToken=r?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=zx),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Dx}))}disconnect(e,r){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,r??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(n=>n.teardown()))}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case zn.connecting:return ir.Connecting;case zn.open:return ir.Open;case zn.closing:return ir.Closing;default:return ir.Closed}}isConnected(){return this.connectionState()===ir.Open}channel(e,r={config:{}}){const n=`realtime:${e}`,o=this.getChannels().find(s=>s.topic===n);if(o)return o;{const s=new rl(`realtime:${e}`,r,this);return this.channels.push(s),s}}push(e){const{topic:r,event:n,payload:o,ref:s}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${r} ${n} (${s})`,o),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let r=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const o={access_token:r,version:Lx};r&&n.updateJoinPayload(o),n.joinedOnce&&n._isJoined()&&n._push(Ye.access_token,{access_token:r})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Mx,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,r=>{let{topic:n,event:o,payload:s,ref:i}=r;n==="phoenix"&&o==="phx_reply"&&this.heartbeatCallback(r.payload.status=="ok"?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${n} ${o} ${i&&"("+i+")"||""}`,s),Array.from(this.channels).filter(a=>a._isMember(n)).forEach(a=>a._trigger(o,s,i)),this.stateChangeCallbacks.message.forEach(a=>a(r))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(r=>r(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(r=>r(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ye.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",o=new URLSearchParams(r);return`${e}${n}${o}`}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([Vx],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}}class nl extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Se(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class Xx extends nl{constructor(e,r){super(e),this.name="StorageApiError",this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ra extends nl{constructor(e,r){super(e),this.name="StorageUnknownError",this.originalError=r}}var Jx=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const Af=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Ft(async()=>{const{default:n}=await Promise.resolve().then(()=>gn);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},Yx=()=>Jx(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ft(()=>Promise.resolve().then(()=>gn),void 0)).Response:Response}),na=t=>{if(Array.isArray(t))return t.map(r=>na(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const o=r.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[o]=na(n)}),e};var _r=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const Ys=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Zx=(t,e,r)=>_r(void 0,void 0,void 0,function*(){const n=yield Yx();t instanceof n&&!r?.noResolveJson?t.json().then(o=>{e(new Xx(Ys(o),t.status||500))}).catch(o=>{e(new ra(Ys(o),o))}):e(new ra(Ys(t),t))}),Qx=(t,e,r,n)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n&&(o.body=JSON.stringify(n)),Object.assign(Object.assign({},o),r))};function no(t,e,r,n,o,s){return _r(this,void 0,void 0,function*(){return new Promise((i,a)=>{t(r,Qx(e,n,o,s)).then(l=>{if(!l.ok)throw l;return n?.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>Zx(l,a,n))})})}function Qo(t,e,r,n){return _r(this,void 0,void 0,function*(){return no(t,"GET",e,r,n)})}function Lt(t,e,r,n,o){return _r(this,void 0,void 0,function*(){return no(t,"POST",e,n,o,r)})}function e0(t,e,r,n,o){return _r(this,void 0,void 0,function*(){return no(t,"PUT",e,n,o,r)})}function t0(t,e,r,n){return _r(this,void 0,void 0,function*(){return no(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function Tf(t,e,r,n,o){return _r(this,void 0,void 0,function*(){return no(t,"DELETE",e,n,o,r)})}var je=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const r0={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Tc={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class n0{constructor(e,r={},n,o){this.url=e,this.headers=r,this.bucketId=n,this.fetch=Af(o)}uploadOrUpdate(e,r,n,o){return je(this,void 0,void 0,function*(){try{let s;const i=Object.assign(Object.assign({},Tc),o);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&n instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",n)):typeof FormData<"u"&&n instanceof FormData?(s=n,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=n,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));const c=this._removeEmptyFolders(r),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:s,headers:a},i?.duplex?{duplex:i.duplex}:{})),f=yield d.json();return d.ok?{data:{path:c,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(s){if(Se(s))return{data:null,error:s};throw s}})}upload(e,r,n){return je(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,r,n)})}uploadToSignedUrl(e,r,n,o){return je(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),i=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",r);try{let l;const c=Object.assign({upsert:Tc.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),f=yield d.json();return d.ok?{data:{path:s,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(Se(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,r){return je(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const o=Object.assign({},this.headers);r?.upsert&&(o["x-upsert"]="true");const s=yield Lt(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:o}),i=new URL(this.url+s.url),a=i.searchParams.get("token");if(!a)throw new nl("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}update(e,r,n){return je(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,r,n)})}move(e,r,n){return je(this,void 0,void 0,function*(){try{return{data:yield Lt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}copy(e,r,n){return je(this,void 0,void 0,function*(){try{return{data:{path:(yield Lt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrl(e,r,n){return je(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),s=yield Lt(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:r},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${i}`)},{data:s,error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrls(e,r,n){return je(this,void 0,void 0,function*(){try{const o=yield Lt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:e},{headers:this.headers}),s=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${s}`):null})),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}download(e,r){return je(this,void 0,void 0,function*(){const o=typeof r?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(r?.transform||{}),i=s?`?${s}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Qo(this.fetch,`${this.url}/${o}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Se(a))return{data:null,error:a};throw a}})}info(e){return je(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{const n=yield Qo(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:na(n),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}exists(e){return je(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{return yield t0(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Se(n)&&n instanceof ra){const o=n.originalError;if([400,404].includes(o?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,r){const n=this._getFinalPath(e),o=[],s=r?.download?`download=${r.download===!0?"":r.download}`:"";s!==""&&o.push(s);const a=typeof r?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(r?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${c}`)}}}remove(e){return je(this,void 0,void 0,function*(){try{return{data:yield Tf(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}list(e,r,n){return je(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},r0),r),{prefix:e||""});return{data:yield Lt(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},n),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const r=[];return e.width&&r.push(`width=${e.width}`),e.height&&r.push(`height=${e.height}`),e.resize&&r.push(`resize=${e.resize}`),e.format&&r.push(`format=${e.format}`),e.quality&&r.push(`quality=${e.quality}`),r.join("&")}}const o0="2.7.1",s0={"X-Client-Info":`storage-js/${o0}`};var jr=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class i0{constructor(e,r={},n){this.url=e,this.headers=Object.assign(Object.assign({},s0),r),this.fetch=Af(n)}listBuckets(){return jr(this,void 0,void 0,function*(){try{return{data:yield Qo(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Se(e))return{data:null,error:e};throw e}})}getBucket(e){return jr(this,void 0,void 0,function*(){try{return{data:yield Qo(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}createBucket(e,r={public:!1}){return jr(this,void 0,void 0,function*(){try{return{data:yield Lt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}updateBucket(e,r){return jr(this,void 0,void 0,function*(){try{return{data:yield e0(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}emptyBucket(e){return jr(this,void 0,void 0,function*(){try{return{data:yield Lt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}deleteBucket(e){return jr(this,void 0,void 0,function*(){try{return{data:yield Tf(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}}class a0 extends i0{constructor(e,r={},n){super(e,r,n)}from(e){return new n0(this.url,this.headers,e,this.fetch)}}const l0="2.51.0";let En="";typeof Deno<"u"?En="deno":typeof document<"u"?En="web":typeof navigator<"u"&&navigator.product==="ReactNative"?En="react-native":En="node";const c0={"X-Client-Info":`supabase-js-${En}/${l0}`},u0={headers:c0},d0={schema:"public"},h0={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},f0={};var p0=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const g0=t=>{let e;return t?e=t:typeof fetch>"u"?e=vf:e=fetch,(...r)=>e(...r)},m0=()=>typeof Headers>"u"?wf:Headers,y0=(t,e,r)=>{const n=g0(r),o=m0();return(s,i)=>p0(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:t;let c=new o(i?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(s,Object.assign(Object.assign({},i),{headers:c}))})};var v0=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};function w0(t){return t.endsWith("/")?t:t+"/"}function b0(t,e){var r,n;const{db:o,auth:s,realtime:i,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,f={db:Object.assign(Object.assign({},l),o),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(r=d?.headers)!==null&&r!==void 0?r:{}),(n=a?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>v0(this,void 0,void 0,function*(){return""})};return t.accessToken?f.accessToken=t.accessToken:delete f.accessToken,f}const Rf="2.71.0",Ur=30*1e3,oa=3,Zs=oa*Ur,x0="http://localhost:9999",_0="supabase.auth.token",S0={"X-Client-Info":`gotrue-js/${Rf}`},sa="X-Supabase-Api-Version",Of={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},k0=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,C0=10*60*1e3;class ol extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function J(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class P0 extends ol{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function E0(t){return J(t)&&t.name==="AuthApiError"}class If extends ol{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class Yt extends ol{constructor(e,r,n,o){super(e,n,o),this.name=r,this.status=n}}class Nt extends Yt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function A0(t){return J(t)&&t.name==="AuthSessionMissingError"}class ko extends Yt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Co extends Yt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Po extends Yt{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function T0(t){return J(t)&&t.name==="AuthImplicitGrantRedirectError"}class Rc extends Yt{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ia extends Yt{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function Qs(t){return J(t)&&t.name==="AuthRetryableFetchError"}class Oc extends Yt{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class aa extends Yt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const es="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ic=` 	
\r=`.split(""),R0=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Ic.length;e+=1)t[Ic[e].charCodeAt(0)]=-2;for(let e=0;e<es.length;e+=1)t[es[e].charCodeAt(0)]=e;return t})();function jc(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(es[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(es[n]),e.queuedBits-=6}}function jf(t,e,r){const n=R0[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function $c(t){const e=[],r=i=>{e.push(String.fromCodePoint(i))},n={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},s=i=>{j0(i,n,r)};for(let i=0;i<t.length;i+=1)jf(t.charCodeAt(i),o,s);return e.join("")}function O0(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function I0(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&n<=56319){const o=(n-55296)*1024&65535;n=(t.charCodeAt(r+1)-56320&65535|o)+65536,r+=1}O0(n,e)}}function j0(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let n=1;n<6;n+=1)if((t>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function $0(t){const e=[],r={queue:0,queuedBits:0},n=o=>{e.push(o)};for(let o=0;o<t.length;o+=1)jf(t.charCodeAt(o),r,n);return new Uint8Array(e)}function z0(t){const e=[];return I0(t,r=>e.push(r)),new Uint8Array(e)}function N0(t){const e=[],r={queue:0,queuedBits:0},n=o=>{e.push(o)};return t.forEach(o=>jc(o,r,n)),jc(null,r,n),e.join("")}function L0(t){return Math.round(Date.now()/1e3)+t}function D0(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const Je=()=>typeof window<"u"&&typeof document<"u",er={tested:!1,writable:!1},$f=()=>{if(!Je())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(er.tested)return er.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),er.tested=!0,er.writable=!0}catch{er.tested=!0,er.writable=!1}return er.writable};function M0(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((o,s)=>{e[s]=o})}catch{}return r.searchParams.forEach((n,o)=>{e[o]=n}),e}const zf=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Ft(async()=>{const{default:n}=await Promise.resolve().then(()=>gn);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},B0=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Hr=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},tr=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},It=async(t,e)=>{await t.removeItem(e)};class ms{constructor(){this.promise=new ms.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}ms.promiseConstructor=Promise;function ei(t){const e=t.split(".");if(e.length!==3)throw new aa("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!k0.test(e[n]))throw new aa("JWT not in base64url format");return{header:JSON.parse($c(e[0])),payload:JSON.parse($c(e[1])),signature:$0(e[2]),raw:{header:e[0],payload:e[1]}}}async function F0(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function U0(t,e){return new Promise((n,o)=>{(async()=>{for(let s=0;s<1/0;s++)try{const i=await t(s);if(!e(s,null,i)){n(i);return}}catch(i){if(!e(s,i)){o(i);return}}})()})}function H0(t){return("0"+t.toString(16)).substr(-2)}function W0(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let o="";for(let s=0;s<56;s++)o+=r.charAt(Math.floor(Math.random()*n));return o}return crypto.getRandomValues(e),Array.from(e,H0).join("")}async function G0(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),o=new Uint8Array(n);return Array.from(o).map(s=>String.fromCharCode(s)).join("")}async function q0(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await G0(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function $r(t,e,r=!1){const n=W0();let o=n;r&&(o+="/PASSWORD_RECOVERY"),await Hr(t,`${e}-code-verifier`,o);const s=await q0(n);return[s,n===s?"plain":"s256"]}const V0=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function K0(t){const e=t.headers.get(sa);if(!e||!e.match(V0))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function X0(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function J0(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Y0=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function zr(t){if(!Y0.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ti(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}var Z0=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};const nr=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Q0=[502,503,504];async function zc(t){var e;if(!B0(t))throw new ia(nr(t),0);if(Q0.includes(t.status))throw new ia(nr(t),t.status);let r;try{r=await t.json()}catch(s){throw new If(nr(s),s)}let n;const o=K0(t);if(o&&o.getTime()>=Of["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new Oc(nr(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Nt}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((s,i)=>s&&typeof i=="string",!0))throw new Oc(nr(r),t.status,r.weak_password.reasons);throw new P0(nr(r),t.status||500,n)}const e_=(t,e,r,n)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(n),Object.assign(Object.assign({},o),r))};async function oe(t,e,r,n){var o;const s=Object.assign({},n?.headers);s[sa]||(s[sa]=Of["2024-01-01"].name),n?.jwt&&(s.Authorization=`Bearer ${n.jwt}`);const i=(o=n?.query)!==null&&o!==void 0?o:{};n?.redirectTo&&(i.redirect_to=n.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await t_(t,e,r+a,{headers:s,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(l):{data:Object.assign({},l),error:null}}async function t_(t,e,r,n,o,s){const i=e_(e,n,o,s);let a;try{a=await t(r,Object.assign({},i))}catch(l){throw console.error(l),new ia(nr(l),0)}if(a.ok||await zc(a),n?.noResolveJson)return a;try{return await a.json()}catch(l){await zc(l)}}function wt(t){var e;let r=null;s_(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=L0(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function Nc(t){const e=wt(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Dt(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function r_(t){return{data:t,error:null}}function n_(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:o,verification_type:s}=t,i=Z0(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:r,hashed_token:n,redirect_to:o,verification_type:s},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function o_(t){return t}function s_(t){return t.access_token&&t.refresh_token&&t.expires_in}const ri=["global","local","others"];var i_=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};class a_{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=zf(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,r=ri[0]){if(ri.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ri.join(", ")}`);try{return await oe(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(J(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await oe(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Dt})}catch(n){if(J(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=i_(e,["options"]),o=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(o.new_email=n?.newEmail,delete o.newEmail),await oe(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:n_,redirectTo:r?.redirectTo})}catch(r){if(J(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await oe(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Dt})}catch(r){if(J(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,o,s,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await oe(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(s=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""},xform:o_});if(u.error)throw u.error;const d=await u.json(),f=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,g=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(y=>{const m=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(y.split(";")[1].split("=")[1]);c[`${v}Page`]=m}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(J(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){zr(e);try{return await oe(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Dt})}catch(r){if(J(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){zr(e);try{return await oe(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:Dt})}catch(n){if(J(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){zr(e);try{return await oe(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:Dt})}catch(n){if(J(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){zr(e.userId);try{const{data:r,error:n}=await oe(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:r,error:n}}catch(r){if(J(r))return{data:null,error:r};throw r}}async _deleteFactor(e){zr(e.userId),zr(e.id);try{return{data:await oe(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(J(r))return{data:null,error:r};throw r}}}function Lc(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}function l_(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Nr={debug:!!(globalThis&&$f()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Nf extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class c_ extends Nf{}async function u_(t,e,r){Nr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Nr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async o=>{if(o){Nr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await r()}finally{Nr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(e===0)throw Nr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new c_(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Nr.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}l_();const d_={url:x0,storageKey:_0,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:S0,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Dc(t,e,r){return await r()}const Lr={};class Vn{constructor(e){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Vn.nextInstanceID,Vn.nextInstanceID+=1,this.instanceID>0&&Je()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},d_),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new a_({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=zf(o.fetch),this.lock=o.lock||Dc,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:Je()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=u_:this.lock=Dc,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:$f()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Lc(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=Lc(this.memoryStorage)),Je()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,r;return(r=(e=Lr[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Lr[this.storageKey]=Object.assign(Object.assign({},Lr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Lr[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Lr[this.storageKey]=Object.assign(Object.assign({},Lr[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Rf}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const r=M0(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),Je()&&this.detectSessionInUrl&&n!=="none"){const{data:o,error:s}=await this._getSessionFromURL(r,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),T0(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:i,redirectType:a}=o;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return J(r)?{error:r}:{error:new If("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,o;try{const s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:wt}),{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(J(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var r,n,o;try{let s;if("email"in e){const{email:u,password:d,options:f}=e;let g=null,y=null;this.flowType==="pkce"&&([g,y]=await $r(this.storage,this.storageKey)),s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:u,password:d,data:(r=f?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:g,code_challenge_method:y},xform:wt})}else if("phone"in e){const{phone:u,password:d,options:f}=e;s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(n=f?.data)!==null&&n!==void 0?n:{},channel:(o=f?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:wt})}else throw new Co("You must provide either an email or phone number and a password");const{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(J(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let r;if("email"in e){const{email:s,password:i,options:a}=e;r=await oe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Nc})}else if("phone"in e){const{phone:s,password:i,options:a}=e;r=await oe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Nc})}else throw new Co("You must provide either an email or phone number and a password");const{data:n,error:o}=r;return o?{data:{user:null,session:null},error:o}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new ko}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:o})}catch(r){if(J(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,n,o,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;if(r==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(e){var r,n,o,s,i,a,l,c,u,d,f,g;let y,m;if("message"in e)y=e.message,m=e.signature;else{const{chain:v,wallet:w,statement:S,options:b}=e;let x;if(Je())if(typeof w=="object")x=w;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))x=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=w}const k=new URL((r=b?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in x&&x.signIn){const C=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b?.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),S?{statement:S}:null));let _;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")_=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)_=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in _&&"signature"in _&&(typeof _.signedMessage=="string"||_.signedMessage instanceof Uint8Array)&&_.signature instanceof Uint8Array)y=typeof _.signedMessage=="string"?_.signedMessage:new TextDecoder().decode(_.signedMessage),m=_.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${k.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),...S?["",S,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(o=(n=b?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=b?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((i=b?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((a=b?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((c=b?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((d=(u=b?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...b.signInWithSolana.resources.map(_=>`- ${_}`)]:[]].join(`
`);const C=await x.signMessage(new TextEncoder().encode(y),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=C}}try{const{data:v,error:w}=await oe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:N0(m)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:wt});if(w)throw w;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new ko}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:w})}catch(v){if(J(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const r=await tr(this.storage,`${this.storageKey}-code-verifier`),[n,o]=(r??"").split("/");try{const{data:s,error:i}=await oe(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:wt});if(await It(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new ko}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:i})}catch(s){if(J(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:r,provider:n,token:o,access_token:s,nonce:i}=e,a=await oe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:o,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:wt}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new ko}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(r){if(J(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,n,o,s,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await $r(this.storage,this.storageKey));const{error:d}=await oe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=l?.data)!==null&&r!==void 0?r:{},create_user:(n=l?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await oe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(o=l?.data)!==null&&o!==void 0?o:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(i=l?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new Co("You must provide either an email or phone number.")}catch(a){if(J(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var r,n;try{let o,s;"options"in e&&(o=(r=e.options)===null||r===void 0?void 0:r.redirectTo,s=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:i,error:a}=await oe(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:wt});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(J(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var r,n,o;try{let s=null,i=null;return this.flowType==="pkce"&&([s,i]=await $r(this.storage,this.storageKey)),await oe(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:i}),headers:this.headers,xform:r_})}catch(s){if(J(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new Nt;const{error:o}=await oe(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(J(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:o,options:s}=e,{error:i}=await oe(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:n,type:o,options:s}=e,{data:i,error:a}=await oe(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:a}}throw new Co("You must provide either an email or phone number and a type")}catch(r){if(J(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await tr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Zs:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const i=await tr(this.userStorage,this.storageKey+"-user");i?.user?e.user=i.user:e.user=ti()}if(this.storage.isServer&&e.user){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await oe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Dt}):await this._useSession(async r=>{var n,o,s;const{data:i,error:a}=r;if(a)throw a;return!(!((n=i.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Nt}:await oe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:Dt})})}catch(r){if(J(r))return A0(r)&&(await this._removeSession(),await It(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:o,error:s}=n;if(s)throw s;if(!o.session)throw new Nt;const i=o.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await $r(this.storage,this.storageKey));const{data:c,error:u}=await oe(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Dt});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(n){if(J(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Nt;const r=Date.now()/1e3;let n=r,o=!0,s=null;const{payload:i}=ei(e.access_token);if(i.exp&&(n=i.exp,o=n<=r),o){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(r){if(J(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:i,error:a}=r;if(a)throw a;e=(n=i.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new Nt;const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(J(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!Je())throw new Po("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Po(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new Rc("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Po("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Rc("No code detected.");const{data:S,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:S.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:o,access_token:s,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!i||!c)throw new Po("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let f=u+d;l&&(f=parseInt(l));const g=f-u;g*1e3<=Ur&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${d}s`);const y=f-d;u-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,f,u):u-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,f,u);const{data:m,error:v}=await this._getUser(s);if(v)throw v;const w={provider_token:n,provider_refresh_token:o,access_token:s,expires_in:d,expires_at:f,refresh_token:i,token_type:c,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(n){if(J(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await tr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:o,error:s}=r;if(s)return{error:s};const i=(n=o.session)===null||n===void 0?void 0:n.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(E0(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await It(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const r=D0(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,o;try{const{data:{session:s},error:i}=r;if(i)throw i;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,r={}){let n=null,o=null;this.flowType==="pkce"&&([n,o]=await $r(this.storage,this.storageKey,!0));try{return await oe(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:o,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(s){if(J(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(J(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{const{data:n,error:o}=await this._useSession(async s=>{var i,a,l,c,u;const{data:d,error:f}=s;if(f)throw f;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await oe(this.fetch,"GET",g,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(o)throw o;return Je()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(J(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,o;const{data:s,error:i}=r;if(i)throw i;return await oe(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0})})}catch(r){if(J(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await U0(async o=>(o>0&&await F0(200*Math.pow(2,o-1)),this._debug(r,"refreshing attempt",o),await oe(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:wt})),(o,s)=>{const i=200*Math.pow(2,o);return s&&Qs(s)&&Date.now()+i-n<Ur})}catch(n){if(this._debug(r,"error",n),J(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),Je()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const o=await tr(this.storage,this.storageKey);if(o&&this.userStorage){let i=await tr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:o.user},await Hr(this.userStorage,this.storageKey+"-user",i)),o.user=(e=i?.user)!==null&&e!==void 0?e:ti()}else if(o&&!o.user&&!o.user){const i=await tr(this.storage,this.storageKey+"-user");i&&i?.user?(o.user=i.user,await It(this.storage,this.storageKey+"-user"),await Hr(this.storage,this.storageKey,o)):o.user=ti()}if(this._debug(n,"session from storage",o),!this._isValidSession(o)){this._debug(n,"session is not valid"),o!==null&&await this._removeSession();return}const s=((r=o.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Zs;if(this._debug(n,`session has${s?"":" not"} expired with margin of ${Zs}s`),s){if(this.autoRefreshToken&&o.refresh_token){const{error:i}=await this._callRefreshToken(o.refresh_token);i&&(console.error(i),Qs(i)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:a}=await this._getUser(o.access_token);!a&&i?.user?(o.user=i.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(n,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(n,"error",o),console.error(o);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new Nt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new ms;const{data:s,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new Nt;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(o,"error",s),J(s)){const i={session:null,error:s};return Qs(s)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(i),i}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,r,n=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const s=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,r)}catch(l){s.push(l)}});if(await Promise.all(i),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const r=Object.assign({},e),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Hr(this.userStorage,this.storageKey+"-user",{user:r.user});const o=Object.assign({},r);delete o.user;const s=structuredClone(o);await Hr(this.storage,this.storageKey,s)}else{const o=structuredClone(r);await Hr(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await It(this.storage,this.storageKey),await It(this.storage,this.storageKey+"-code-verifier"),await It(this.storage,this.storageKey+"-user"),this.userStorage&&await It(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Je()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ur);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((n.expires_at*1e3-e)/Ur);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Ur}ms, refresh threshold is ${oa} ticks`),o<=oa&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Nf)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Je()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const o=[`provider=${encodeURIComponent(r)}`];if(n?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&o.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[s,i]=await $r(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(i)}`});o.push(a.toString())}if(n?.queryParams){const s=new URLSearchParams(n.queryParams);o.push(s.toString())}return n?.skipBrowserRedirect&&o.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;return s?{data:null,error:s}:await oe(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(J(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,o;const{data:s,error:i}=r;if(i)return{data:null,error:i};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await oe(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((o=l?.totp)===null||o===void 0)&&o.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(r){if(J(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;if(s)return{data:null,error:s};const{data:i,error:a}=await oe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(r){if(J(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;return s?{data:null,error:s}:await oe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(J(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=e?.factors||[],o=n.filter(i=>i.factor_type==="totp"&&i.status==="verified"),s=n.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:n,totp:o,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,n;const{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=ei(o.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((n=(r=o.user.factors)===null||r===void 0?void 0:r.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,r={keys:[]}){let n=r.keys.find(a=>a.kid===e);if(n)return n;const o=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+C0>o)return n;const{data:s,error:i}=await oe(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=o,n=s.keys.find(a=>a.kid===e),!n)?null:n}async getClaims(e,r={}){try{let n=e;if(!n){const{data:g,error:y}=await this.getSession();if(y||!g.session)return{data:null,error:y};n=g.session.access_token}const{header:o,payload:s,signature:i,raw:{header:a,payload:l}}=ei(n);r?.allowExpired||X0(s.exp);const c=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!c){const{error:g}=await this.getUser(n);if(g)throw g;return{data:{claims:s,header:o,signature:i},error:null}}const u=J0(o.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,i,z0(`${a}.${l}`)))throw new aa("Invalid JWT signature");return{data:{claims:s,header:o,signature:i},error:null}}catch(n){if(J(n))return{data:null,error:n};throw n}}}Vn.nextInstanceID=0;const h_=Vn;class f_ extends h_{constructor(e){super(e)}}var p_=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class g_{constructor(e,r,n){var o,s,i;if(this.supabaseUrl=e,this.supabaseKey=r,!e)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const a=w0(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:d0,realtime:f0,auth:Object.assign(Object.assign({},h0),{storageKey:c}),global:u0},d=b0(n??{},u);this.storageKey=(o=d.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(f,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=y0(r,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new jx(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new xx(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new a0(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,r={},n={}){return this.rest.rpc(e,r,n)}channel(e,r={config:{}}){return this.realtime.channel(e,r)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,r;return p_(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&r!==void 0?r:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:o,storageKey:s,flowType:i,lock:a,debug:l},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new f_({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:s,autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:o,flowType:i,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Kx(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n?.access_token)})}_handleTokenChanged(e,r,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const m_=(t,e,r)=>new g_(t,e,r),sn=m_("https://pkswdnpftrundnewgnya.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrc3dkbnBmdHJ1bmRuZXdnbnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODI2MzIsImV4cCI6MjA2ODI1ODYzMn0.r_Y1RLOGJ55C0De5SBTVXqO09SMDqgV38sQuE-oDxXE"),y_=async(t,e)=>{const r=await sn.from("campaigns").upsert([{name:t,data:await mf(e)}]).select();if(r.error)throw new Error(`error saving to db ${r.error.message} ${r.error.details}`,{cause:r.error});return console.log("saved ok",r.data),r.data},v_=async t=>{const e=await sn.from("campaigns").select("data").eq("name",t);if(e.error)throw e.error;const[r]=e.data;return await yx(r.data)},Lf=()=>{const[t,e]=p.useState(null);return p.useEffect(()=>{sn.auth.getUser().then(({data:{user:n}})=>{e(n)});const{data:{subscription:r}}=sn.auth.onAuthStateChange((n,o)=>{e(o?.user??null)});return()=>r.unsubscribe()},[]),t},w_=()=>{const t=Lf();return h.jsxs(h.Fragment,{children:[h.jsx(nt,{disabled:t===null,onClick:async()=>{const e=M.getState();await y_("sequel",sd(e))},children:h.jsx(qn,{icon:h.jsxs("div",{className:"flex flex-row items-center",children:[h.jsx("span",{className:Ce("sprite sprite-tinted text-highlightBeige texture-hud_char_âž¡ relative",{"text-lightGrey":t===null})}),h.jsx("span",{className:Ce("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})})]}),topText:"sa",bottomText:"ve"})}),h.jsx(nt,{disabled:t===null,onClick:async()=>{try{const e=await v_("sequel");console.log(e),M.dispatch(Gg({campaign:e}))}catch(e){console.error(e)}},children:h.jsx(qn,{icon:h.jsxs("div",{className:"flex flex-row items-center",children:[h.jsx("span",{className:Ce("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})}),h.jsx("span",{className:Ce("sprite sprite-tinted text-highlightBeige texture-hud_char_âž¡ relative",{"text-lightGrey":t===null})})]}),topText:"lo",bottomText:"ad"})})]})},b_=()=>h.jsx(nt,{children:h.jsx(Z,{className:"relative leading-none",children:"MAP"})}),x_=()=>h.jsx(nt,{onClick:async()=>{const t=M.getState(),e=sd(t),r=await mf(e),n=new URL("https://blockstack.ing"),o=n.searchParams;o.set("campaignData",r),o.set("noSaves","1"),o.set("cheats","1"),n.hash=t.levelEditor.currentlyEditingRoomId,window.open(n.toString(),"playtest")},children:h.jsx(qn,{topText:"pl",bottomText:"ay",icon:h.jsx("span",{className:"sprite texture-joystick mt-half"})})}),__=({className:t})=>{const e=Lf(),r=o=>async()=>{const{error:s}=await sn.auth.signInWithOAuth({provider:o});s&&console.error("Login error:",s)},n=async()=>{const{error:o}=await sn.auth.signOut();o&&console.error("Logout error:",o)};return h.jsx("div",{className:Ce(t),children:h.jsxs("div",{className:Ce("px-1",e?"bg-moss":"bg-midRed"),children:[e?h.jsxs(h.Fragment,{children:[h.jsx(Z,{children:`${e.email}`}),h.jsx(Z,{children:`via ${e.app_metadata.provider}`})]}):h.jsxs(h.Fragment,{children:[h.jsx(Z,{className:"block w-full sprites-double-height pb-1",children:"Not logged in"}),h.jsx(Z,{className:"block w-full text-highlightBeige",children:"You will not be able to save"})]}),h.jsx("div",{children:e?h.jsx(St,{className:"px-1",onClick:n,children:h.jsx(Z,{children:"Logout"})}):h.jsxs("div",{className:"pt-1",children:[h.jsx(Z,{children:"Log in with:"}),h.jsx(St,{className:"px-1",onClick:r("github"),children:h.jsx(Z,{children:"GitHub"})}),h.jsx(St,{className:"px-1",onClick:r("discord"),children:h.jsx(Z,{children:"Discord"})})]})})]})})},S_=()=>{const t=be(n=>n.levelEditor.campaignInProgress),e=be(n=>n.levelEditor.currentlyEditingRoomId),r=pt();return h.jsxs("div",{className:"scale-editor flex w-full h-full text-white bg-metallicBlueHalfbrite pb-1 gap-1 flex-wrap justify-start overflow-auto",children:[h.jsx("div",{className:Pe,children:h.jsx(__,{className:"w-full mb-1"})}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full",children:"Campaign"}),h.jsx(w_,{}),h.jsx(b_,{}),h.jsx(x_,{})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full pt-2",children:"Room"}),h.jsx(df,{value:e,campaign:t,onSelect:n=>{r(Oi(n))},triggerButtonClassName:"w-full"}),h.jsx("div",{className:"h-1 w-full"}),h.jsx(Vb,{}),h.jsx(qb,{}),h.jsx("div",{className:"h-1 w-full"}),h.jsx(rx,{}),h.jsx(nx,{})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full pt-2",children:"Edit"}),h.jsxs("div",{className:Pe,children:[h.jsx(Gb,{}),h.jsx(ox,{})]}),h.jsx(Yb,{}),h.jsx(Hb,{}),h.jsx(tx,{}),h.jsx("div",{className:"h-1 w-full"}),h.jsx(Wb,{}),h.jsx(Zb,{})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full pt-2",children:"Blocks"}),h.jsx($,{itemTool:{type:"block",config:{style:"organic"}},children:h.jsx("span",{className:`sprite texture-block_organic ${G}`})}),h.jsx($,{itemTool:{type:"block",config:{style:"organic",disappearing:{on:"stand"}}},children:h.jsx(xo,{iconClassName:me("texture-block_organic_disappearing")})}),h.jsx($,{itemTool:{type:"block",config:{style:"artificial"}},children:h.jsx("span",{className:`sprite texture-block_artificial ${G}`})}),h.jsx($,{itemTool:{type:"block",config:{style:"artificial",disappearing:{on:"stand"}}},children:h.jsx(xo,{iconClassName:me("texture-block_artificial_disappearing")})}),h.jsx($,{itemTool:{type:"block",config:{style:"tower"}},children:h.jsx("span",{className:`sprite texture-tower ${G}`})}),h.jsx($,{itemTool:{type:"block",config:{style:"book"}},children:h.jsx("span",{className:`sprite texture-book_x ${G}`})}),h.jsxs(_n,{children:[h.jsx($,{itemTool:{type:"barrier",config:{axis:"x"}},children:h.jsx("span",{className:`sprite texture-barrier_x ${G}`})}),h.jsx($,{itemTool:{type:"barrier",config:{axis:"y"}},children:h.jsx("span",{className:`sprite texture-barrier_y ${G}`})}),h.jsx($,{itemTool:{type:"barrier",config:{axis:"x",disappearing:{on:"touch"}}},children:h.jsx(xo,{iconClassName:me("texture-barrier_x")})}),h.jsx($,{itemTool:{type:"barrier",config:{axis:"y",disappearing:{on:"touch"}}},children:h.jsx(xo,{iconClassName:me("texture-barrier_y")})})]})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full",children:"Monsters"}),h.jsx($,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},children:h.jsx("span",{className:`sprite texture-dalek_1 [button:hover_&]:texture-animated-dalek" ${G}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},children:h.jsx(vt,{topClasses:"texture-cyberman_towards [button:hover_&]:texture-cyberman_right",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),h.jsx($,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-skiHead_greenAndPink_towards [button:hover_&]:texture-skiHead_greenAndPink_right ${G}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:h.jsx("span",{className:`sprite texture-helicopterBug_1 [button:hover_&]:texture-animated-helicopterBug ${G}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-turtle_towards_1 [button:hover_&]:texture-animated-turtle_right ${G}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},children:h.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase_all ${G}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},children:h.jsx(vt,{topClasses:"texture-computerBot_towards [button:hover_&]:texture-computerBot_right"})}),h.jsx($,{itemTool:{type:"monster",config:{which:"bubbleRobot",activated:"on",movement:"patrol-randomly-xy8"}},children:h.jsx(vt,{topClasses:me("texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"),bottomClasses:me("texture-headlessBase")})}),h.jsx($,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:h.jsx(vt,{topClasses:"texture-monkey_towards [button:hover_&]:texture-monkey_right"})}),h.jsx($,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},children:h.jsx(vt,{topClasses:"texture-elephant_towards [button:hover_&]:texture-elephant_right"})}),h.jsx($,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-elephant_towards [button:hover_&]:texture-elephant_right ${G}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",children:h.jsx(vt,{topClasses:"texture-ball",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),h.jsx($,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},children:h.jsx("span",{className:`sprite texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold ${G}`})})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full",children:"Pickups"}),h.jsxs(_n,{children:[h.jsx($,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:h.jsx(Ot,{iconClasses:"texture-whiteRabbit",text:"2"})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"shield"}},children:h.jsx(Ot,{iconClasses:"texture-whiteRabbit",text:"ðŸ›¡"})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"jumps"}},children:h.jsx(Ot,{iconClasses:"texture-whiteRabbit",text:"â™¨"})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"fast"}},children:h.jsx(Ot,{iconClasses:"texture-whiteRabbit",text:"âš¡"})})]}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"bag"}},children:h.jsx("span",{className:`sprite texture-bag ${G}`})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"hooter"}},children:h.jsx("span",{className:`sprite texture-hooter ${G}`})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:h.jsx("span",{className:`sprite texture-doughnuts ${G}`})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:h.jsx("span",{className:`sprite texture-crown_blacktooth ${G}`})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"scroll",page:"blacktooth"}},children:h.jsx("span",{className:`sprite texture-scroll ${G}`})})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full",children:"deadly"}),h.jsxs(_n,{children:[h.jsx($,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},children:h.jsx("span",{className:`sprite texture-volcano_1 [button:hover_&]:texture-animated-volcano ${G}`})}),h.jsx($,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},children:h.jsx("span",{className:`sprite texture-toaster_off ${G}`})})]}),h.jsx($,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},children:h.jsx("span",{className:`sprite texture-spikyBall_1 [button:hover_&]:texture-spikyBall_2 ${G}`})}),h.jsx($,{itemTool:{type:"spikes",config:pe},children:h.jsx("span",{className:`sprite texture-spikes ${G}`})})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full",children:"control"}),h.jsx($,{itemTool:{type:"charles",config:pe},children:h.jsx(vt,{topClasses:"texture-charles_towards [button:hover_&]:texture-charles_right"})}),h.jsx($,{itemTool:{type:"joystick",config:{controls:["charles"]}},children:h.jsx("span",{className:`sprite texture-joystick ${G}`})}),h.jsx($,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:Ju}},children:h.jsx("span",{className:`sprite texture-switch_left [button:hover_&]:texture-switch_right ${G}`})})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full",children:"movable"}),h.jsx($,{itemTool:{type:"spring",config:{}},children:h.jsx("span",{className:`sprite texture-spring_released [button:hover_&]:texture-spring_compressed ${G}`})}),h.jsxs(_n,{children:[h.jsx($,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:h.jsx("span",{className:`sprite texture-cube ${G}`})}),h.jsx($,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:h.jsx("span",{className:`sprite texture-drum ${G}`})}),h.jsx($,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:h.jsx("span",{className:`sprite texture-sticks ${G}`})})]}),h.jsx($,{itemTool:{type:"pushableBlock",config:{}},children:h.jsx("span",{className:`sprite texture-stepStool ${G}`})}),h.jsx($,{itemTool:{type:"ball",config:pe},children:h.jsx("span",{className:`sprite texture-ball ${G}`})}),h.jsx($,{itemTool:{type:"slidingBlock",config:{style:"puck"}},children:h.jsx("span",{className:`sprite texture-puck ${G}`})}),h.jsx($,{itemTool:{type:"slidingBlock",config:{style:"book"}},children:h.jsx("span",{className:`sprite texture-book_y ${G}`})})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full",children:"misc."}),h.jsxs($,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[h.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_static ${G} [button:active_&]:top-oneScaledPix`}),h.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_1 [button:hover_&]:texture-animated-lift ${G} [button:active_&]:top-oneScaledPix`})]}),h.jsxs(_n,{children:[h.jsx($,{itemTool:{type:"conveyor",config:{direction:"away"}},children:h.jsx(Ot,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-conveyor_y",text:"â†—"})}),h.jsx($,{itemTool:{type:"conveyor",config:{direction:"towards"}},children:h.jsx(Ot,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-reversed-conveyor_y",text:"â†™"})}),h.jsx($,{itemTool:{type:"conveyor",config:{direction:"left"}},children:h.jsx(Ot,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-conveyor_x",text:"â†–"})}),h.jsx($,{itemTool:{type:"conveyor",config:{direction:"right"}},children:h.jsx(Ot,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-reversed-conveyor_x",text:"â†˜"})})]}),h.jsx($,{itemTool:{type:"teleporter",config:{toRoom:"to?",toPosition:le}},children:h.jsx("span",{className:`sprite texture-teleporter ${G}`})}),h.jsx($,{itemTool:{type:"movingPlatform",config:{movement:"clockwise",activated:"on",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-sandwich ${G}`})}),h.jsx($,{itemTool:{type:"hushPuppy",config:{}},children:h.jsx("span",{className:`sprite texture-hushPuppy ${G}`})})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full",children:"Structure"}),h.jsx(Qb,{}),h.jsx(ex,{}),h.jsx($,{itemTool:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:{x:1,y:1}}},children:h.jsx("span",{className:`sprite texture-blacktooth_floor ${G}`})})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full",children:"Player"}),h.jsx($,{itemTool:{type:"player",config:{which:"head"}},children:h.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${G}`})}),h.jsx($,{itemTool:{type:"player",config:{which:"heels"}},children:h.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${G}`})})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full",children:"NPCâ€™s"}),h.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"head",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${G}`})}),h.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"heels",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${G}`})}),h.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"headOverHeels",startDirection:"towards"}},children:h.jsx(vt,{topClasses:"texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right",bottomClasses:"texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right"})})]}),h.jsxs("div",{className:Pe,children:[h.jsx(Z,{className:"w-full pt-2",children:"debug"}),h.jsx(Ub,{})]})]})},an=(t,e)=>({get bottomCentre(){return this.c000},get topLeft(){return this.c101},get topRight(){return this.c011},get c000(){return ee(t)},get c001(){return ee(B(t,{z:e.z}))},get c010(){return ee(B(t,{y:e.y}))},get c011(){return ee(B(t,{y:e.y,z:e.z}))},get c100(){return ee(B(t,{x:e.x}))},get c101(){return ee(B(t,{x:e.x,z:e.z}))},get c110(){return ee(B(t,{x:e.x,y:e.y}))},get c111(){return ee(B(t,{x:e.x,y:e.y,z:e.z}))},projectCorner(r){return ee(B(t,{x:r.x*e.x,y:r.y*e.y,z:r.z*e.z}))}}),ni=1e-5,Mc=-1,Cn=(t,e,r,n,o)=>n-o>t&&r<e-o,k_=0,Df=1,Mf=2,Bf=3,C_=(t,e,r,n)=>{const{topLeft:o,topRight:s,bottomCentre:i}=an(t,e),{topLeft:a,topRight:l,bottomCentre:c}=an(r,n),u=s.y-s.x/2,d=i.y-i.x/2,f=l.y-l.x/2,g=c.y-c.x/2,y=o.y+o.x/2,m=i.y+i.x/2,v=a.y+a.x/2,w=c.y+c.x/2,S=o.x,b=s.x,x=a.x,k=l.x,C=Cn(u,d,f,g,ni),_=Cn(y,m,v,w,ni),j=Cn(S,b,x,k,ni);return C&&_&&j?Df:_&&j&&Cn(u,d,f,g,Mc)?Mf:C&&j&&Cn(y,m,v,w,Mc)?Bf:k_},P_=(t,e,r,n)=>{for(const o of sg){const s=t[o],i=s+e[o],a=r[o],l=a+n[o];if(i<=a)return 1*(o==="z"?-1:1);if(s>=l)return-1*(o==="z"?-1:1)}return Bc(r)-Bc(t)},E_=(t,e)=>{if(t.fixedZIndex!==void 0||e.fixedZIndex!==void 0)return 0;const r=t.renderAabb||t.aabb,n=e.renderAabb||e.aabb,o=t.renderAabbOffset?B(t.state.position,t.renderAabbOffset):t.state.position,s=e.renderAabbOffset?B(e.state.position,e.renderAabbOffset):e.state.position;switch(C_(o,r,s,n)){case Df:return P_(o,r,s,n);case Mf:return At(o.y,s.y+n.y)&&At(o.z,s.z+n.z)?1:At(s.y,o.y+r.y)&&At(s.z,o.z+r.z)?-1:0;case Bf:return At(o.x,s.x+n.x)&&At(o.z,s.z+n.z)?1:At(s.x,o.x+r.x)&&At(s.z,o.z+r.z)?-1:0;default:return 0}},Bc=t=>t.x+t.y-t.z;class Bo extends Error{constructor(e,r,n){super(`CyclicDependencyError: .cyclicDependency property of this error has nodes as an array. ${e.join(" -> ")}`,n),this.cyclicDependency=e,this.hasClosedCycle=r}}const A_=t=>{const e=T_(t);let r=e.length,n=r;const o=new Array(r),s={},i=R_(e);for(;n--;)s[n]||a(e[n],n,new Set);return o;function a(l,c,u){if(u.has(l))throw new Bo([l],!1);if(s[c])return;s[c]=!0;const d=t.get(l)||new Set,f=Array.from(d);if(c=f.length){u.add(l);do{const g=f[--c];try{a(g,i.get(g),u)}catch(y){throw y instanceof Bo?y.hasClosedCycle?y:new Bo([l,...y.cyclicDependency],y.cyclicDependency.includes(l)):y}}while(c);u.delete(l)}o[--r]=l}};function T_(t){const e=new Set;for(const[r,n]of t.entries()){e.add(r);for(const o of n)e.add(o)}return Array.from(e)}function R_(t){const e=new Map;for(let r=0,n=t.length;r<n;r++)e.set(t[r],r);return e}const Fc=(t,e,r)=>{t.has(e)||t.set(e,new Set),t.get(e).add(r)},Eo=(t,e,r)=>{const n=t.get(e);n!==void 0&&(n?.delete(r),n.size===0&&t.delete(e))},Ff=(t,e=new Set(Wo(t)),r=new Map)=>{const n=new Map;for(const[o,s]of r)if(!t[o])r.delete(o);else for(const i of s)t[i]||Eo(r,o,i);for(const o of e)if(o.fixedZIndex===void 0)for(const s of Wo(t)){if(s.fixedZIndex!==void 0||n.get(s)?.has(o)||o===s)continue;const i=E_(o,s);if(Fc(n,o,s),i===0){Eo(r,o.id,s.id),Eo(r,s.id,o.id);continue}const a=i>0?o.id:s.id,l=i>0?s.id:o.id;Fc(r,a,l),Eo(r,l,a)}return r},sl=(t,e,r=3)=>{try{return{order:A_(t),impossible:!1}}catch(n){if(n instanceof Bo){const o=n.cyclicDependency;return t.get(o[0])?.delete(o[1]),console.warn("cyclc dependency detected: ",o.join(" --front-of--> "),`breaking link ${o[0]} --front-of--> ${o[1]}`),{order:sl(t,e,r-1).order,impossible:!0}}else throw n}};class O_{constructor(e,r){this.renderContext=e,this.appearance=r,this.output=new te({label:"AppearanceRenderer"})}#e;output;destroy(){this.output.destroy({children:!0})}tick(e){const r=this.appearance({renderContext:this.renderContext,currentRendering:this.#e,tickContext:e});r!=="no-update"&&(this.output.children.at(0)!==r.output&&(this.#e?.output&&this.output.removeChild(this.#e.output),r.output!==void 0&&this.output.addChild(r.output)),this.#e=r)}}class Uf extends O_{}const Uc=(t,e)=>{e.poly([ee({}),ee({x:t.x}),ee({x:t.x,y:t.y}),ee({y:t.y})]).poly([ee({}),ee({z:t.z}),ee({y:t.y,z:t.z}),ee({y:t.y})]).poly([ee({x:t.x}),ee({x:t.x,z:t.z}),ee(t),ee({x:t.x,y:t.y})]).poly([ee({z:t.z}),ee({x:t.x,z:t.z}),ee({x:t.x,y:t.y,z:t.z}),ee({y:t.y,z:t.z})])},Hc=(t,e)=>{const r=new ct;return Uc(t,r),r.stroke({width:.5,color:e,alpha:1}),r.eventMode="static",r.on("pointerenter",()=>{r.fill({color:e,alpha:.5})}),r.on("pointerleave",()=>{r.clear(),Uc(t,r),r.stroke({width:.5,color:e,alpha:1})}),r},I_={head:"rgba(255,184,0)",wall:"rgba(128,200,0)",portal:"rgba(255,0,255)",pickup:"rgba(0,196,255)",emitter:"rgba(0,255,255)",stopAutowalk:"rgba(255,128,128)",floatingText:"rgba(128,0,255)"};class j_{constructor(e){this.renderContext=e;const{item:r}=e,n=I_[r.type]??"rgba(255,255,255)";if(this.#e=new te({label:`ItemBoundingBoxRenderer ${r.id}`}),Zn("portal")(r)){const s=ee(r.config.relativePoint);this.#e.addChild(new ct().circle(s.x,s.y,5).stroke(n)),this.#e.addChild(new ct().circle(s.x,s.y,2).fill(n))}if(this.#e.addChild(new ct({label:"objectOrigin"}).circle(0,0,2).fill(n)),this.#e.addChild(Hc(r.aabb,n)),r.renderAabb){const s="rgba(184, 184, 255)",i=Hc(r.renderAabb,s);if(r.renderAabbOffset){const a=ee(r.renderAabbOffset);i.position.set(a.x,a.y),i.circle(0,0,2).fill(s)}this.#e.addChild(i)}this.#e.eventMode="static";let o;this.#e.on("pointerenter",()=>{if(o!==void 0)return;const s=`${r.id} ${r.type}
@(${r.state.position.x}, ${r.state.position.y}, ${r.state.position.z})}
#(${r.aabb.x}, ${r.aabb.y}, ${r.aabb.z})}`;this.#e.addChild(o=new Tm({text:s,style:{fill:n,fontSize:6,fontFamily:"Menlo"}})),o.resolution=4}),this.#e.on("pointerleave",()=>{o!==void 0&&(this.#e.removeChild(o),o=void 0)}),e.frontLayer.attach(this.#e)}#e;tick(){}destroy(){this.#e.destroy({children:!0})}get output(){return this.#e}}class $_{constructor(e,r){this.renderContext=e,this.wrappedRenderer=r,this.#e=new te({label:`ItemPositionRenderer ${e.item.id}`,children:[r.output]}),this.#t()}#e;#t(){const e=ee(this.renderContext.item.state.position);this.#e.x=e.x,this.#e.y=e.y}tick(e){this.wrappedRenderer?.tick(e),e.movedItems.has(this.renderContext.item)&&this.#t()}destroy(){this.#e.destroy({children:!0}),this.wrappedRenderer?.destroy()}get output(){return this.#e}}const ys=({aabb:t,state:{position:e}},{aabb:r,state:{position:n}})=>!(e.x+t.x<=n.x||e.x>=n.x+r.x)&&!(e.y+t.y<=n.y||e.y>=n.y+r.y)&&!(e.z+t.z<=n.z||e.z>=n.z+r.z),z_=(t,e)=>[...Xt(e).filter(r=>t.id!==r.id&&ys(t,r))];function*Hf(t,e){for(const r of e)t.id!==r.id&&ys(t,r)&&(yield r)}const Wc=ig/1e3,Wf={firedDoughnut:2*Wc,floatingText:Wc},oo=11,Gc=6e4,N_=9999,L_=8,D_=750,M_=2500,qc=200,B_=.15,Gf=50,Vc={x:.5,y:1},Kc=t=>typeof t!="string"&&Object.hasOwn(t,"animationId"),la=t=>{if(typeof t=="string")return la({textureId:t});{const{anchor:e,flipX:r,pivot:n,x:o,y:s,filter:i,times:a,label:l}=t;let c;if(Kc(t)?c=F_(t):c=new ln(Ut().textures[t.textureId]),t.hasOwnProperty("times")){const u={x:1,y:1,z:1,...a},d=new te({label:l??"timesXyz"});for(let{x:f}=u;f>=1;f--)for(let{y:g}=u;g>=1;g--)for(let y=1;y<=u.z;y++){const m={...t,textureId:t.textureId??t.textureIdCallback?.(f-1,g-1,y-1),label:`(${f},${g},${y})`};delete m.times;const v=la(m),w=hr({x:f-1,y:g-1,z:y-1});v.x+=w.x,v.y+=+w.y,d.addChild(v)}return d}if(e===void 0&&n===void 0)if(Kc(t))c.anchor=Vc;else{const u=Ut().data.frames[t.textureId];if(u===void 0)throw new Error(`no spritesheet entry for textureId "${t.textureId}"`);const d=u.frame;d.pivot!==void 0?c.pivot=d.pivot:c.anchor=Vc}else e!==void 0&&(c.anchor=e),n!==void 0&&(c.pivot=n);return o!==void 0&&(c.x=o),s!==void 0&&(c.y=s),i!==void 0&&(c.filters=i),l!==void 0&&(c.label=l),c.eventMode="static",r===!0&&(c.scale.x=-1),c}},F=la;function F_({animationId:t,reverse:e,playOnce:r,paused:n,randomiseStartFrame:o}){const s=Ut().animations[t],a=(n?[s[0]]:s).map(c=>({texture:c,time:ag}));e&&a.reverse();const l=new Un(a);return l.animationSpeed=wr.animations[t].animationSpeed,l.gotoAndPlay(o?Math.floor(Math.random()*a.length):0),r!==void 0&&(l.loop=!1,l.onComplete=()=>{l.stop(),r==="and-destroy"&&(l.visible=!1)}),l}const qf=(t,e)=>{const r=e.getLocalBounds(),n=Ta.create({width:r.maxX-r.minX,height:r.maxY-r.minY});return e.x-=r.minX,e.y-=r.minY,t.render({container:e,target:n}),new ln({texture:n,label:"shadowMaskSprite (of renderTexture)",pivot:{x:-r.minX,y:-r.minY}})},vs=(t,e,r)=>{const n=r&&{x:r.x??1,y:r.y??1},o=F({...typeof e=="string"?{textureId:e}:e,times:n});return o instanceof ln?o:qf(t,o)},jt=t=>Te(({renderContext:{item:e}})=>id(e)?F({...typeof t=="string"?{textureId:t}:t,times:Ca(e)}):F(t)),We=t=>Te(({renderContext:{item:e,general:{pixiRenderer:r}}})=>{if(id(e))return vs(r,t,Ca(e));{const n=F(t);return n instanceof ln?n:qf(r,n)}}),Te=t=>({renderContext:e,currentRendering:r,tickContext:n})=>r===void 0?{output:t({renderContext:e,currentRendering:void 0,tickContext:n}),renderProps:pe}:"no-update",$t=t=>({renderContext:{general:{pixiRenderer:e},item:r},currentRendering:n})=>{if(n===void 0){const o=Ca(r),s={output:vs(e,t(r.config),o),renderProps:pe};return o&&(s.output.y-=((o.z??1)-1)*X.h),s}else return"no-update"},Ae={x:12,y:12,z:X.h},U_={x:14,y:14,z:X.h},ar={x:16,y:16,z:X.h},oi={...Ae,z:X.h*2},Vf=t=>{switch(t.type){case"spring":case"portableBlock":case"moveableDeadly":case"slidingDeadly":case"firedDoughnut":return{aabb:Ae};case"slidingBlock":return t.config.style==="book"?{aabb:ar}:{aabb:Ae};case"lift":return{aabb:{...Ae,z:Ae.z}};case"switch":return{aabb:{...Ae,z:Ae.z}};case"pickup":return t.config.gives==="scroll"?{aabb:{x:16,y:4,z:13}}:{aabb:Ae};case"charles":return{aabb:oi};case"ball":return{aabb:{x:12,y:12,z:12}};case"pushableBlock":case"movingPlatform":return{aabb:ar};case"block":switch(t.config.style){case"artificial":case"organic":case"book":return{aabb:ar};case"tower":return{aabb:{x:11,y:11,z:X.h}};default:throw new Error("unknown block style")}case"monster":switch(t.config.which){case"skiHead":return{aabb:{...Ae,z:21}};case"bubbleRobot":case"cyberman":case"elephant":case"emperorsGuardian":case"monkey":case"computerBot":return{aabb:oi};case"helicopterBug":case"dalek":case"emperor":case"homingBot":case"elephantHead":return{aabb:Ae};case"turtle":return{aabb:Ae};default:throw t.config,new Error("unknown monster type")}case"deadlyBlock":case"spikes":return{aabb:ar};case"bubbles":return{aabb:Ae};case"conveyor":case"hushPuppy":case"teleporter":return{aabb:ar};case"barrier":return{aabb:t.config.axis==="y"?{x:3,y:15,z:X.h}:{x:15,y:3,z:X.h}};case"sceneryPlayer":return t.config.which==="headOverHeels"?{aabb:oi}:{aabb:Ae};case"emitter":return{aabb:le};default:return{aabb:U_}}},Ze={aabb:Ae},H_=({config:{direction:t},position:e})=>t==="right"&&e.x===0||t==="towards"&&e.y===0,si={x:1,y:0,z:0},ii={x:-1,y:0,z:0},ai={x:0,y:-1,z:0},li={x:0,y:1,z:0},qe={away:li,left:si,right:ii,towards:ai,down:{x:0,y:0,z:-1},up:{x:0,y:0,z:1},awayRight:lo(B(li,ii)),towardsRight:lo(B(ai,ii)),towardsLeft:lo(B(ai,si)),awayLeft:lo(B(li,si))},ca=t=>{const e=we(t.position),{aabb:r}=Vf(t);if(r===void 0)throw new Error(`item type= ${t.type} config=${JSON.stringify(t.config)} has no bounding box`);return t.type==="wall"?e:B(e,{x:X.w-r.x>>1,y:X.d-r.y>>1})},$e=()=>({expires:null,stoodOnBy:{},disappearing:null,switchedAtRoomTime:ke,stoodOnUntilRoomTime:ke}),Xc=()=>({standingOnItemId:null,vels:{gravity:le,movingFloor:le},latentMovement:[],actedOnAt:{roomTime:ke,by:pe},collidedWith:{roomTime:ke,by:pe}}),W_=t=>{const e=qg.includes(t.type);return{...$e(),position:ca(t),...e?{standingOnItemId:null,vels:{gravity:le,movingFloor:le,...Vg.includes(t.type)?{sliding:le}:{},...t.type==="monster"||t.type==="movingPlatform"?{walking:le}:{}},latentMovement:[],actedOnAt:{roomTime:ke,by:pe},collidedWith:{roomTime:ke,by:pe}}:{},...t.type==="monster"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",timeOfLastDirectionChange:Number.NEGATIVE_INFINITY,...t.config.which==="skiHead"||t.config.which==="turtle"||t.config.which==="elephantHead"||t.config.which==="cyberman"?{facing:qe[t.config.startDirection]}:{facing:qe.towards}}:{},...t.type==="pickup"?{disappearing:{on:"touch",byType:t.config.gives==="bag"||t.config.gives==="jumps"?["heels","headOverHeels"]:t.config.gives==="doughnuts"||t.config.gives==="hooter"||t.config.gives==="fast"?["head","headOverHeels"]:["head","heels","headOverHeels"]}}:{},...t.type==="movingPlatform"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",facing:qe[t.config.startDirection]}:{},...t.type==="switch"?{setting:t.config.initialSetting,touchedOnProgression:-1}:{},...t.type==="block"?{disappearing:t.config.disappearing??null}:{},...t.type==="conveyor"?{disappearing:t.config.disappearing??null}:{},...t.type==="barrier"?{disappearing:t.config.disappearing??null}:{},...t.type==="lift"?{direction:"up",vels:{lift:le}}:{},...t.type==="charles"?{facing:qe.towards}:{},...t.type==="emitter"?{lastEmittedAtRoomTime:ke,quantityEmitted:0}:{},...t.type==="firedDoughnut"?{disappearing:{on:"touch"},vels:{fired:t.config.direction?os(qe[t.config.direction],Wf.firedDoughnut):le}}:{}}},ci=X.h*2,Kf=4,An=X.h*Kf,G_=2,q_=2*X.w;function*V_(t,e){const{config:{direction:r},position:n}=t,o=Yn(r),s=un(o),i=H_(t),a={...le,[s]:i?-.5:0},l=1,c={[s]:i?-1:0},u=l*X.w,d={...le,[s]:u},f=9,g=8,y=8;{const m={[o]:g,[s]:y,z:An};yield{...t,...Ze,type:"doorFrame",id:`${e}/frameFar`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"far"},state:{...$e(),position:we(B(n,{[o]:1.5},a,c)),stoodOnBy:pe},aabb:B(m,d),renderAabb:m,renderAabbOffset:i?d:void 0}}{const m={[o]:f,[s]:y,z:An};yield{...t,...Ze,type:"doorFrame",id:`${e}/frameNear`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"near"},state:{...$e(),position:we(B(n,a,c)),stoodOnBy:pe},aabb:B(m,d),renderAabb:m,renderAabbOffset:i?d:void 0}}{const m={[o]:2*X.w-f-g,[s]:y,z:An-ci};yield{...t,...Ze,type:"doorFrame",id:`${e}/frameTop`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"top"},state:{...$e(),position:B(we(B(n,a,c)),{[o]:f,z:ci}),stoodOnBy:pe},aabb:B(m,d),renderAabb:m,renderAabbOffset:i?d:void 0}}yield{...t,...Ze,type:"blocker",id:`${e}/blockerAbove`,jsonItemId:e,config:{},renders:!1,state:{...$e(),position:B(we(B(n,a)),{z:An}),stoodOnBy:pe},aabb:we({[o]:2,[s]:.5,z:oo-Kf-n.z}),renderAabb:le,fixedZIndex:cr},yield{...t,...Ze,type:"portal",id:`${e}/portal`,jsonItemId:e,config:{...t.config,inHidden:i,relativePoint:we({...le,[s]:i?.25:-.25}),direction:qe[r]},fixedZIndex:cr,state:{...$e(),position:B(we(B(n,{[s]:i?-.5:.5})),{[o]:f}),stoodOnBy:pe},aabb:{[o]:G_*X.w-f-g,[s]:0,z:ci}},n.z!==0&&(yield{...t,...Ze,type:"doorLegs",id:`${e}/legs`,jsonItemId:e,config:{...t.config,inHiddenWall:i,style:"none",side:"away",height:n.z},renders:!0,shadowCastTexture:i?{textureId:"shadow.door.floatingThreshold.double.y",flipX:o==="x"}:void 0,state:{...$e(),position:{...we(B(n,a,c)),z:0}},aabb:B(we({[o]:2,[s]:.5,z:n.z}),d),renderAabb:i?B(we({[o]:2,[s]:.5,z:.5})):void 0,renderAabbOffset:i?B({[o]:0,[s]:0,z:(n.z-.5)*X.h},{[s]:d[s]}):void 0,shadowOffset:{z:n.z*X.h,[s]:i?d[s]:void 0}}),yield{type:"stopAutowalk",id:`${e}/stopAutowalk`,jsonItemId:e,aabb:we({[o]:2,[s]:0,z:2}),config:{},fixedZIndex:cr,state:{...$e(),position:we(Yu(n,os(qe[r],.75))),stoodOnBy:pe}}}const Jc={config:pe,shadowCastTexture:"shadow.smallRound",aabb:Ae},Yc=()=>{const t=cg(M.getState());return{action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:qe.towards,walkStartFacing:qe.towards,walkDistance:0,vels:{walking:le,gravity:le,movingFloor:le},switchedToAt:ke,lastDiedAt:ke,gameTime:0,jumpStartTime:ke,lives:t?"infinite":L_,jumpStartZ:0}},K_=(t,e)=>{const r=lg(M.getState());return t.config.which==="head"?{id:"head",jsonItemId:e,type:"head",...Ze,...Jc,state:{...$e(),...Xc(),...Yc(),hasHooter:!1,gameWalkDistance:0,fastStepsStartedAtDistance:ke,shieldCollectedAt:ke,doughnuts:r?"infinite":0,position:ca(t),stoodOnUntilRoomTime:ke}}:{id:"heels",jsonItemId:e,type:"heels",...Ze,...Jc,state:{...$e(),...Xc(),...Yc(),carrying:null,hasBag:!1,bigJumps:0,isBigJump:!1,shieldCollectedAt:ke,position:ca(t),stoodOnUntilRoomTime:ke}}},Xf=1,X_=(t=oo)=>({x:X.w,y:X.d*Xf,z:t*X.h}),J_={x:X.w,y:0,z:Gf},Y_=(t=oo)=>({x:X.w*Xf,y:X.d,z:t*X.h}),Z_={x:0,y:X.d,z:Gf},Q_=(t,e,r)=>{const{config:{direction:n},position:o}=e,s=Pa(e.config),{size:{z:i}}=r,a=Yn(n),l=un(a),c=n==="towards"||n==="right",u={...le,[l]:c?-1:0};return{type:"wall",id:t,jsonItemId:t,config:e.config,aabb:Bn(a==="y"?Y_(i):X_(i),s),renderAabb:c?le:Bn(a==="y"?Z_:J_,s),fixedZIndex:c?cr:void 0,state:{...$e(),position:we(B(o,u)),stoodOnBy:pe},shadowCastTexture:a==="y"?"shadow.wall.y":{textureId:"shadow.wall.y",flipX:!0}}},eS=3,Zc=10,Qc=.52,eu=.5,tS=(t,e,r)=>{const{config:{times:n},position:o}=e,s=B(o,{z:-3}),i={...n,z:eS};let a=s,l=i;const c=Xt(Wo(r.items)).filter(f=>f.type==="door");if(o.z===0){const f={};for(const g of c){const{position:y,config:{direction:m}}=g;switch(m){case"towards":!f.towards&&y.y===s.y&&(l=B(l,{y:eu}),a=B(a,{y:-.5}),f.towards=!0);break;case"away":!f.away&&y.y===s.y+n.y&&(l=B(l,{y:Qc}),f.away=!0);break;case"right":!f.right&&y.x===s.x&&(l=B(l,{x:eu}),a=B(a,{x:-.5}),f.right=!0);break;case"left":!f.left&&y.x===s.x+n.x&&(l=B(l,{x:Qc}),f.left=!0);break}}}const u=we(a),d=Bn(ar,l);return{type:"floor",id:t,jsonItemId:t,config:{...e.config,naturalFootprint:{aabb:Bn(ar,i),position:we(s)}},aabb:d,renderAabb:{...d,z:Zc},renderAabbOffset:{...le,z:d.z-Zc},shadowCastTexture:"shadow.fullBlock",state:{...$e(),position:u}}};function*il(t,e,r,n=pe,o={}){if(!n[t]&&!(e.type==="pickup"&&e.config.gives==="scroll"&&o[e.config.page]))switch(e.type){case"door":return yield*V_(e,t);case"player":{yield K_(e,t);return}case"wall":{yield Q_(t,e,r);return}case"floor":{yield tS(t,e,r);return}case"sceneryCrown":if(!M.getState().gameMenus.planetsLiberated[e.config.planet])return;default:{const s=Vf(e),i=e.config.times!==void 0?{aabb:Bn(s.aabb,e.config.times),renderAabb:void 0}:s;let a;try{a=W_(e)}catch(l){throw new Error(`loadItemFromJson: error creating initial state for jsonItem ${JSON.stringify(e,null,2)}`,{cause:l})}yield{...e,...Ze,...i,id:t,jsonItemId:t,fixedZIndex:e.type==="emitter"?cr:void 0,shadowCastTexture:rS(e),config:e.config,state:a}}}}const rS=t=>{switch(t.type){case"lift":return"shadow.smallBlock";case"conveyor":return{textureId:"shadow.fullBlock",flipX:Ht(t.config.direction)==="x"};case"barrier":return{textureId:"shadow.barrier.y",flipX:t.config.axis==="x"};case"spring":case"firedDoughnut":case"slidingDeadly":return"shadow.smallRound";case"block":return t.config.style==="tower"?"shadow.smallRound":"shadow.fullBlock";case"pushableBlock":case"movingPlatform":case"hushPuppy":case"deadlyBlock":case"teleporter":case"spikes":return"shadow.fullBlock";case"portableBlock":return t.config.style==="drum"?"shadow.smallRound":"shadow.smallBlock";case"pickup":return t.config.gives==="scroll"?"shadow.scroll":"shadow.smallRound";case"ball":case"charles":case"monster":return"shadow.smallRound";case"slidingBlock":return t.config.style==="book"?"shadow.fullBlock":"shadow.smallRound"}};function*nS(t){const e=t.size.z??oo,r=we({...t.size,z:1}),n=we({...ur,z:-1});if(t.roomBelow!==void 0&&(yield{...Ze,type:"portal",id:"floor/portal",fixedZIndex:cr,config:{toRoom:t.roomBelow,relativePoint:{x:r.x/2,y:r.y/2,z:r.z},direction:qe.down},aabb:r,state:{...$e(),position:n},renders:!1}),t.roomAbove!==void 0){const o=B(n,{z:X.h*e});yield{...Ze,type:"portal",id:"ceiling",fixedZIndex:cr,config:{toRoom:t.roomAbove,relativePoint:{...t.ceilingRelativePoint!==void 0?we(t.ceilingRelativePoint):{x:r.x/2,y:r.y/2},z:-12},direction:qe.up},aabb:r,state:{...$e(),position:o}}}}const oS=(t,e,r,n)=>{const o=Math.max(0,Math.min(t.x+e.x,r.x+n.x)-Math.max(t.x,r.x)),s=Math.max(0,Math.min(t.y+e.y,r.y+n.y)-Math.max(t.y,r.y));return o*s},tu=({state:{position:t},aabb:e},{state:{position:r},aabb:n})=>oS(t,e,r,n),ru={stopAutowalk:5,portal:5,wall:5,blocker:5,doorLegs:5,sceneryPlayer:5,bubbles:5,switch:10,doorFrame:15,ball:18,block:20,barrier:20,floor:20,hushPuppy:20,teleporter:20,lift:30,movingPlatform:30,pushableBlock:30,portableBlock:30,sceneryCrown:30,slidingBlock:30,spring:30,joystick:40,charles:40,conveyor:40,head:50,heels:50,headOverHeels:50,pickup:80,firedDoughnut:90,spikes:98,slidingDeadly:100,moveableDeadly:100,deadlyBlock:100,monster:100,floatingText:200,particle:200,emitter:200},sS=(t,e)=>ru[t.type]-ru[e.type],iS=(t,e,r=.001)=>{if(!Fn(e,t)||t.id===e.id)return!1;const{state:{vels:{gravity:{z:n}}}}=t;return n>0?!1:ys({state:{position:B(t.state.position,{x:0,y:0,z:-1e-4})},aabb:{...t.aabb,z:r+Zu},id:t.id},{state:{position:B(e.state.position,{x:0,y:0,z:e.aabb.z})},aabb:{...e.aabb,z:0},id:e.id})},aS=(t,e)=>{const n=[...Xt(e).filter(s=>iS(t,s))];return n.length===0?void 0:n.reduce((s,i)=>{const a=sS(i,s);return a<0||a===0&&tu(t,i)>tu(t,s)?i:s})},lS=({above:t,below:e})=>{t.state.standingOnItemId=e.id,e.state.stoodOnBy[t.id]=!0};function*cS(t,e,r,n){const o=dg(t.items);for(const[s,i]of o)i.type==="player"&&!n||(yield*il(s,i,t,e,r))}const nu=t=>Xt(t).reduce((e,r)=>({...e,[r.id]:r}),{}),ou=({roomJson:t,roomPickupsCollected:e,scrollsRead:r,isNewGame:n=!1})=>{const o={...nu(nS(t)),...nu(cS(t,e,r,n))};for(const i of Qe(o)){const l=z_(i,ug(o)).find(c=>Fn(i)&&Fn(c)&&!(i.type==="wall"&&c.type==="wall"));l!==void 0&&console.error(`in room ${t.id} item ${i.id} @${JSON.stringify(i.state.position)} #${JSON.stringify(i.aabb)} is colliding with (solid item) ${l.id} @${JSON.stringify(l.state.position)} #${JSON.stringify(l.aabb)} on loading room ${t.id}`)}for(const i of Qe(o).filter(Kg)){const a=aS(i,Qe(o).filter(l=>l.id!==i.id));a!==void 0&&lS({above:i,below:a})}return{...t,roomJson:t,items:o,roomTime:0}},so=(t,e)=>Xt(ss(t)).map(r=>{const n=e.items[r];if(n===void 0)throw new Error(`item in stoodOnBy "${r}" is not in the room`);return n});Zn("head");const uS=Zn("heels"),dS=Zn("headOverHeels"),hS=t=>{if(uS(t))return t.state;if(dS(t))return t.state.heels},fS=({room:t,item:e})=>(t.items[e.id]=e,e),pS=1e3/25,Jf=t=>{const e=wr.animations[t],r=e.length,{animationSpeed:n}=e;return r*pS/n};Jf("bubbles.white");Jf("head.fadeOut");const al=({config:{activatedOnStoreValue:t}})=>t===void 0?!0:wa(M.getState(),t),gS=({renderContext:{general:{pixiRenderer:t},item:e,room:r},currentRendering:n})=>{const{state:{stoodOnBy:o},config:{times:s}}=e,i=n?.renderProps,a=al(e),l=a&&so(o,r).find(Ea)!==void 0;return i===void 0||a!==i.activated||l!==i.flashing?{output:vs(t,{textureId:l?"shadowMask.teleporter.flashing":a?"shadowMask.teleporter":"shadowMask.fullBlock"},s),renderProps:{flashing:l,activated:a}}:"no-update"},ui=(t,e=1)=>({renderContext:{item:{state:{facing:r}}},currentRendering:n})=>{const o=n?.renderProps,s=ba(r)??"towards";if(!(o===void 0||s!==o.facingXy4))return"no-update";const a=F(s==="left"||s==="away"?`shadowMask.${t}.away`:`shadowMask.${t}.right`);return a.y=-(X.h*(e-1)),a.scale.x=s==="away"||s==="right"?1:-1,{output:a,renderProps:{facingXy4:s}}},su={lift:We("shadowMask.smallBlock"),conveyor:$t(({direction:t})=>({textureId:"shadowMask.conveyor",flipX:Ht(t)==="x"})),doorLegs:$t(({direction:t})=>({textureId:t==="right"||t==="towards"?"shadowMask.door.floatingThreshold.double.y":"shadowMask.door.legs.threshold.double.y",flipX:Ht(t)==="y"})),teleporter:gS,floor:"no-mask",barrier:$t(({axis:t})=>({textureId:"shadowMask.barrier.y",flipX:t==="x"})),spring:We("shadowMask.smallRound"),block:$t(({style:t})=>t==="tower"?"shadowMask.tower":"shadowMask.fullBlock"),pushableBlock:We("shadowMask.stepStool"),movingPlatform:We("shadowMask.fullBlock"),hushPuppy:We("shadowMask.hushPuppy"),portableBlock:$t(({style:t})=>t==="drum"?"shadowMask.smallRound":"shadowMask.smallBlock"),slidingBlock:$t(({style:t})=>t==="book"?"shadowMask.fullBlock":"shadowMask.smallRound"),deadlyBlock:$t(({style:t})=>t==="volcano"?"shadowMask.volcano":"shadowMask.toaster"),spikes:We("shadowMask.spikes"),switch:We("shadowMask.switch"),pickup:$t(({gives:t})=>{switch(t){case"scroll":return"shadowMask.scroll";case"doughnuts":return"shadowMask.doughnuts";case"fast":case"extra-life":case"jumps":case"shield":return"shadowMask.whiteRabbit";default:return"blank"}}),slidingDeadly:We("shadowMask.smallRound"),ball:We("shadowMask.ball"),"monster.dalek":We("shadowMask.dalek"),"monster.turtle":ui("turtle"),"monster.skiHead":ui("skiHead"),"monster.homingBot":We("shadowMask.smallRound"),joystick:We("shadowMask.joystick"),charles:ui("charles",2)},mS=t=>{switch(t.type){case"monster":return su[`monster.${t.config.which}`];case"floor":return t.config.floorType==="none"?void 0:"no-mask";default:return su[t.type]}},yS=new km({alpha:1-$n});class vS{constructor(e,r){if(this.renderContext=e,this.#e.filters=yS,r!=="no-mask")if(this.#r=new Uf(e,r),e.item.shadowOffset===void 0)this.#e.addChild(this.#r.output);else{const n=new te({label:"shadowMaskOffset",...ee(e.item.shadowOffset),children:[this.#r.output]});this.#e.addChild(n)}this.#e.addChild(this.#t)}#e=new te({label:"ItemShadowRenderer"});#t=new te({label:"shadows"});#r;#n={};get#o(){return M.getState().gameMenus.userSettings.displaySettings.showShadowMasks}#s(e){if(this.#r===void 0)return;const r=this.#r.output.children.at(0);this.#r.tick(e);const n=this.#r.output.children.at(0);if(n===void 0||!(n instanceof ln)){const{item:o}=this.renderContext;throw new Error(`ItemShadowRenderer: this.#shadowMaskRenderer didn't create a sprite for item "${o.id}" of type "${o.type}". Have got ${n}`)}r!==n&&(this.#o?this.renderContext.frontLayer.attach(n):this.#e.mask=n)}destroy(){this.#e.destroy(!0),this.#r?.destroy()}tick(e){if(this.#t.parent===null)throw new Error("shadow container not in scene graph");const{movedItems:r,progression:n}=e,{item:o,general:{pixiRenderer:s},room:i}=this.renderContext,a=r.has(o),l=o.state.position.z+o.aabb.z,c=Qe(i.items).filter(function(y){return y.shadowCastTexture!==void 0}),u={id:o.id,state:{position:{...o.state.position,z:l}},aabb:{...o.aabb,z:N_}},d=Object.groupBy(c,g=>{const y=this.#n[g.id]!==void 0,m=r.has(g);return!a&&!m?y?"keepUnchanged":"noShadow":ys(u,g)?y?"update":"create":"noShadow"});for(const g of Pl(d.keepUnchanged,d.update))this.#n[g.id].renderedOnProgression=n;if(d.create)for(const g of d.create){const{times:y}=g.config,m=vs(s,g.shadowCastTexture,y);m.label=g.id,this.#t.addChild(m),this.#n[g.id]={sprite:m,renderedOnProgression:n}}for(const g of Pl(d.create,d.update)){const{sprite:y}=this.#n[g.id],m=ee({...In(en(g.state.position,o.state.position),g.shadowOffset??ur),z:o.aabb.z});y.x=m.x,y.y=m.y}for(const[g,{sprite:y,renderedOnProgression:m}]of hg(this.#n))m!==n&&(y.destroy(),delete this.#n[g]);const f=(d.keepUnchanged?.length??0)+(d.update?.length??0)+(d.create?.length??0)>0;this.#e.visible=f,f&&this.#s(e)}get output(){return this.#e}}const wS=t=>{const e=mS(t.item);return e===void 0?void 0:new vS(t,e)};class bS{constructor(e,r){this.renderContext=e,this.componentRenderers=r,this.output={graphics:r.graphics?.output,sound:r.sound?.output}}output;tick(e){this.componentRenderers.graphics?.tick(e),this.componentRenderers.sound?.tick(e)}destroy(){this.componentRenderers.graphics?.destroy(),this.componentRenderers.sound?.destroy()}}const ae=new window.AudioContext,ua=()=>{throw new Error(`sounds not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`)},Re=t=>{const e=typeof t=="string"?{soundId:t}:t,{playbackRate:r=1,soundId:n,connectTo:o,loop:s=!1,varyPlaybackRate:i=!1,randomiseStartPoint:a=!1}=e,l=ae.createBufferSource(),c=ua()[n];return l.buffer=c,l.loop=s,l.playbackRate.value=i?r-.05+Math.random()*.1:r,s&&a?l.start(0,c.duration*Math.random()):l.start(),o!==void 0&&l.connect(o),l},Dr=(t,e,r)=>{const n=ae.createGain();return e!==void 0&&(n.gain.value=e),t.connect(n),n.connect(r),n},ze=({start:t,change:e,loop:r,stop:n,startAndLoopTogether:o=!1,noStartOnFirstFrame:s=!0},i)=>{let a=!0,l,c;return u=>{if(!!u!=!!c)u?t!==void 0&&!(a&&s)?(l?.stop(),l=Re({...t}),Dr(l,t.gain,i),r!==void 0&&(o?(l=Re({...r,loop:!0}),Dr(l,r.gain,i)):l.onended=()=>{c&&(l=Re({...r,loop:!0}),Dr(l,r.gain,i))})):r!==void 0&&(l=Re({...r,loop:!0}),Dr(l,r.gain,i)):(l&&l.loop&&(l.stop(),l.onended=null),n!==void 0&&(l=Re({...n}),Dr(l,n.gain,i)));else if(c!==u&&e!==void 0){const f=Re({...e});Dr(f,e.gain,i)}a=!1,c=u}};class xS{constructor(e){this.renderContext=e,this.output.gain.value=4}output=ae.createGain();#e=ze({loop:{soundId:"rollingBallLoop",playbackRate:.5}},this.output);tick(){const{renderContext:{item:{state:{vels:{sliding:e},standingOnItemId:r}}}}=this,n=(e.x!==0||e.y!==0)&&r!==null;this.#e(n)}destroy(){}}class _S{constructor(e){this.renderContext=e;const{item:{config:{was:r}}}=e;switch(r.type){case"pickup":{r.gives!=="scroll"&&Re({soundId:"bonus",connectTo:this.output});break}case"disappearing":{Re({soundId:"destroy",connectTo:this.output});break}case"hushPuppy":{this.output.gain.value=.5,Re({soundId:"hushPuppyVanish",connectTo:this.output});break}}}output=ae.createGain();tick(){}destroy(){}}class ll{constructor(e,r,n=1){this.renderContext=e,this.#e=ze({start:r},this.output),this.output.gain.value=n}output=ae.createGain();#e;tick({lastRenderRoomTime:e}){const{renderContext:{item:r}}=this,{state:{collidedWith:{roomTime:n,by:o}}}=r,s=n>(e??ke)&&!Aa(ss(o));this.#e(s)}destroy(){}}class SS{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#e.gain.value=.5,this.#r=new ll(e,{soundId:"metalHit"},.3),this.#r.output.connect(this.output)}output=ae.createGain();#e=ae.createGain();#t=ze({start:{soundId:"servoStart",playbackRate:.5},loop:{soundId:"servoLoop",playbackRate:.5},stop:{soundId:"servoStop",playbackRate:.5}},this.#e);#r;tick(e){const{renderContext:{item:r,room:{roomTime:n,items:o}}}=this,{state:{actedOnAt:{roomTime:s,by:i}}}=r,a=n===s&&Xt(ss(i)).some(l=>ad(o[l]));this.#t(a),this.#r.tick(e)}destroy(){}}const io=t=>{for(const e in t)return!0;return!1},di=2;class kS{constructor(e){this.renderContext=e}output=ae.createGain();#e=ze({start:{soundId:"conveyorStart",playbackRate:di},loop:{soundId:"conveyorLoop",playbackRate:di},stop:{soundId:"conveyorEnd",playbackRate:di}},this.output);tick(){const{renderContext:{item:{state:{stoodOnBy:e}}}}=this,r=io(e);this.#e(r)}destroy(){this.#e(!1)}}const CS=3;class PS{constructor(e){this.renderContext=e,this.output.gain.value=.7}output=ae.createGain();#e=Re({soundId:"helicopter",loop:!0,connectTo:this.output});tick(){const{renderContext:{item:{state:{vels:{lift:{z:e}}}}}}=this;this.#e.playbackRate.value=Math.max(.5,1+CS*e)}destroy(){}}const iu={skiHead:{soundId:"softBump"},turtle:{soundId:"softBump"},dalek:{soundId:"metalHit"},homingBot:{soundId:"metalHit"},computerBot:{soundId:"metalHit"}},au={cyberman:{soundId:"jetpackTurnaround",gain:1.2},dalek:{soundId:"mojoTurn",gain:.3}},lu={cyberman:{soundId:"jetpackLoop",gain:.7},emperorsGuardian:{soundId:"jetpackLoop"},dalek:{soundId:"mojoLoop"},bubbleRobot:{soundId:"bubbleRobotLoop"},helicopterBug:{soundId:"helicopter"}},cu={homingBot:{start:{soundId:"detect"},loop:{soundId:"robotWhirLoop",gain:4},startAndLoopTogether:!0},computerBot:{loop:{soundId:"robotBeepingLoop",randomiseStartPoint:!0,varyPlaybackRate:!0}}};class ES{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#t.connect(this.output),this.#t.gain.value=.66;const{item:{config:{which:r}}}=e;iu[r]!==void 0&&(this.#o=new ll(e,iu[r]),this.#o.output.connect(this.output)),au[r]!==void 0&&(this.#r=ze({change:au[r]},this.#e)),cu[r]!==void 0&&(this.#s=ze(cu[r],this.#e)),lu[r]!==void 0&&(this.#n=ze({loop:lu[r]},this.#t))}output=ae.createGain();#e=ae.createGain();#t=ae.createGain();#r;#n;#o;#s;tick(e){const{renderContext:{item:r}}=this,{state:{facing:n,activated:o,busyLickingDoughnutsOffFace:s,vels:{walking:i}}}=r;if(this.#r){const a=Qu(n);this.#r(a)}if(this.#o&&this.#o.tick(e),this.#n){const a=o&&!s;this.#n(a)}if(this.#s){const a=!jn(i,le);this.#s(a)}}destroy(){}}class hi{constructor(e){this.renderContext=e;const{general:{soundSettings:r},item:{type:n}}=e,{noFootsteps:o}={...xa.soundSettings,...r};o||(this.#e=ae.createGain(),this.#e.gain.value=2,this.#e.connect(this.output),this.#t=ze({loop:{soundId:`${n==="headOverHeels"?"heels":n}Walk`}},this.#e)),this.#r.gain.value=.8,this.#r.connect(this.output),this.#i.gain.value=1.2,this.#i.connect(this.output),this.#s.connect(this.output),this.#n=ze({start:{soundId:`${n==="headOverHeels"?"head":n}Jump`}},this.#r),this.#o=ze({loop:{soundId:`${n==="headOverHeels"?"head":n}Fall`}},this.#r)}output=ae.createGain();#e;#t;#r=ae.createGain();#n;#o;#s=ae.createGain();#l=ze({start:{soundId:"landing"},noStartOnFirstFrame:!0},this.#s);#i=ae.createGain();#c=ze({start:{soundId:"carry",playbackRate:.95},stop:{soundId:"carry",playbackRate:1.05}},this.#i);#a={teleportingPhase:null,positionZ:0};tick({lastRenderRoomTime:e}){const{renderContext:{item:r}}=this,{state:{action:n,teleporting:o,jumpStartZ:s,jumped:i,standingOnItemId:a,position:{z:l},vels:{gravity:{z:c}},collidedWith:{roomTime:u,by:d}}}=r,f=hS(r),{teleportingPhase:g,positionZ:y}=this.#a,m=o?o.phase:null,v=i&&l>s&&l>y&&c>0,w=l<y&&c<0&&a===null;this.#o(w),this.#n(v),this.#t!==void 0&&this.#t(!v&&!w&&n==="moving"),f!==void 0&&this.#c(f.carrying!==null);const S=a!==null&&u>(e??ke)&&d[a];if(this.#l(S),m!==null&&m!==g)if(m==="in"){const b=ua().teleportIn,x=ae.createBufferSource();x.buffer=b,x.connect(this.output),x.start()}else{const b=ua().teleportOut,x=ae.createBufferSource();x.buffer=b,x.connect(this.output),x.start()}this.#a={teleportingPhase:m,positionZ:l}}destroy(){}}class AS{constructor(e){this.renderContext=e}output=ae.createGain();#e=void 0;tick(){const{renderContext:{item:{state:{stoodOnBy:e},config:{style:r}}}}=this;if(r!=="drum")return;const n=this.#e?.stoodOn??!1,o=io(e);!n&&o&&Re({soundId:"drum",connectTo:this.output}),this.#e={stoodOn:o}}destroy(){}}class TS{constructor(e){this.renderContext=e,this.scrapeBracketed=ze({loop:{soundId:"stepStoolScraping"}},this.output),this.output.gain.value=.4}output=ae.createGain();scrapeBracketed;tick({movedItems:e}){const{renderContext:{item:r,room:{roomTime:n}}}=this,{state:{actedOnAt:{roomTime:o},standingOnItemId:s}}=r,i=n===o&&s!==null&&e.has(r);this.scrapeBracketed(i)}destroy(){}}class RS{constructor(e){this.renderContext=e}output=ae.createGain();tick({lastRenderRoomTime:e}){const{renderContext:{item:{state:{stoodOnBy:r,stoodOnUntilRoomTime:n}}}}=this,o=io(r);e!==void 0&&n>e&&!o&&Re({soundId:"springBoing",connectTo:this.output})}destroy(){}}class OS{constructor(e){this.renderContext=e,this.#e.connect(this.output)}output=ae.createGain();#e=ae.createGain();#t=void 0;tick(){const{renderContext:{item:{state:{setting:e},config:r}}}=this,n=r.type==="in-store"?wa(M.getState(),r.path)?"right":"left":e,o=this.#t?.setting;o!==void 0&&o!==n&&Re({soundId:"switchClick",playbackRate:n==="right"?.95:1.05,connectTo:this.#e}),this.#t={setting:n}}destroy(){}}class IS{constructor(e){this.renderContext=e}output=ae.createGain();#e=ze({loop:{soundId:"teleportWarningSiren"}},this.output);tick(){const{renderContext:{item:e,room:r}}=this;this.#e(al(e)&&so(e.state.stoodOnBy,r).some(Ea))}destroy(){}}class jS{constructor(e){this.renderContext=e,Re({soundId:"hooter",connectTo:this.output})}output=ae.createGain();tick(){}destroy(){}}class $S extends ll{constructor(e){super(e,{soundId:"glassClink",varyPlaybackRate:!0},.8),this.renderContext=e}}const zS=(t,e)=>dd(so(t.state.stoodOnBy,e).filter(ld));class NS{constructor(e){this.renderContext=e,this.output.gain.value=2}output=ae.createGain();#e=void 0;tick(e){const{renderContext:{item:r,room:n}}=this,o=zS(r,n);this.#e!==void 0&&o<this.#e&&Re({soundId:"toasterPopUpSoundUrl",connectTo:this.output}),this.#e=o}destroy(){}}const LS={lift:PS,switch:OS,bubbles:_S,head:hi,heels:hi,headOverHeels:hi,teleporter:IS,monster:ES,conveyor:kS,spring:RS,portableBlock:AS,charles:SS,ball:xS,pushableBlock:TS,firedDoughnut:jS,slidingBlock:$S},DS=t=>{if(t.item.type==="deadlyBlock"&&t.item.config.style==="toaster")return new NS(t);const e=LS[t.item.type];if(e)return new e(t)},uu=X.h*oo,du=X.h*-1,MS=X.w*16,BS=0,fi=(t,e,r)=>(t-e)/(r-e)*2-1;class FS{constructor(e,r){this.renderContext=e,this.childRenderer=r,r.output.connect(this.output),this.output.rolloffFactor=2,this.output.maxDistance=5,this.output.distanceModel="exponential";const{room:{size:{y:n,x:o}}}=e;this.positionMinX=Rs(we({x:0,y:n})),this.positionMaxX=Rs(we({x:o,y:0}))}output=ae.createPanner();positionMinX;positionMaxX;tick(e){this.childRenderer.tick(e);const{item:r}=this.renderContext,n=r.state,o=B(n.position,os(r.aabb,.5)),s=fi(Rs(o),this.positionMaxX,this.positionMinX),i=fi(o.z,du,uu);if(!Number.isFinite(i))throw new Error(`y position for sound rendering is not finite;
        positionY = numberInRangeToMinus1To1Range(
          itemCentrePosition = ${o.z},
          ${du},
          ${uu},
        );
        itemCentrePosition = addXyz(
          itemState.position = ${JSON.stringify(n.position)},
          scaleXyz(${JSON.stringify(r.aabb)}, 0.5),
        )`);const a=fi(o.x+o.y,BS,MS);this.output.positionX.value=s,this.output.positionY.value=i,this.output.positionZ.value=a}destroy(){this.childRenderer.destroy()}}const Sr=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,US=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // we know c.a is either 0 or 1, so no need to do a step()

    finalColor = mix(c, vec4(uColour, 1), c.a);
}
`;class ts extends Jt{constructor(e){const r=Et.from({vertex:Sr,fragment:US,name:"oneColour-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uColour:{value:new Float32Array(3),type:"vec3<f32>"}}}});const n=this.resources.colorReplaceUniforms.uniforms,[o,s,i]=e.toArray();n.uColour[0]=o,n.uColour[1]=s,n.uColour[2]=i}}const HS={pureBlack:new q("#000000"),shadow:new q("#1B2D3B"),midGrey:new q("#505A55"),lightGrey:new q("#929981"),white:new q("#F8FEF8"),pastelBlue:new q("#4893FF"),metallicBlue:new q("#1D4E80"),pink:new q("#B973AF"),moss:new q("#6E7B00"),redShadow:new q("#513D40"),midRed:new q("#A7574B"),lightBeige:new q("#BF8E69"),highlightBeige:new q("#DBB269"),alpha:new q("#105A69"),replaceLight:new q("#048662"),replaceDark:new q("#052229")},WS=`#version 300 es
// keep this one at mediump for the hash function's precision
precision mediump float;

in vec2 vTextureCoord;
out vec4 finalColor;

const float LUT_SIZE = 256.0;
const float magicNumber = 31.0; // Small prime number

uniform sampler2D uTexture;
uniform sampler2D uLut;

/** returns in [0, LUT_SIZE] range
this must match the TypeScript version of the hash function*/
float hashColor(vec3 color) {
    vec3 c255 = floor(color * 255.0);
    
    float hash = mod(
        c255.r + c255.g * magicNumber + c255.b * magicNumber * magicNumber, 
        LUT_SIZE
    );
    return hash;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    float h = hashColor(c.rgb);

    // use the hash to look up the replacement in the LUT:
    vec4 replacementColour = texture(
        uLut, 
        vec2(
            // normalise h to [0, 1] range
            (h + 0.5) / LUT_SIZE, 
            0.5
        )
    );
    
    // use original if either: 
    //      original alpha is 0 (because keep transparent)
    //      or lut alpha is 0 (signals nothing in this slot of the LUT)
    finalColor = mix(c, replacementColour, c.a * replacementColour.a);
}
`,Tn=256,pi=31;function GS(t){const e=Math.floor(t.red*255),r=Math.floor(t.green*255),n=Math.floor(t.blue*255);return(e+r*pi+n*pi*pi)%Tn}function qS(t){const e=new Float32Array(Tn*4);for(const[o,s]of fg(t)){const i=z[o],a=GS(i);if(e[a*4+3]>.5)throw new Error("LUT collision - mess with the hash function or lut size until this goes away");e[a*4+0]=s.red,e[a*4+1]=s.green,e[a*4+2]=s.blue,e[a*4+3]=1}const r=new Uint8Array(Tn*4);for(let o=0;o<Tn*4;o++)r[o]=Math.floor(e[o]*255);return _t.from({resource:r,width:Tn,height:1,scaleMode:"nearest"})}class Zt extends Jt{#e;constructor(e){const r=Object.keys(e).length,n=Et.from({vertex:Sr,fragment:WS,name:"palette-swop-filter"}),o=qS(e);super({glProgram:n,resources:{colorReplaceUniforms:{uOriginal:{value:new Float32Array(3*r),type:"vec3<f32>",size:r},uReplacement:{value:new Float32Array(3*r),type:"vec3<f32>",size:r}},uLut:o.source}}),this.#e=o;const s=this.resources.colorReplaceUniforms.uniforms;Object.entries(e).forEach(([i,a],l)=>{z[i].toArray().forEach((c,u)=>{s.uOriginal[l*3+u]=c}),a.toArray().forEach((c,u)=>{s.uReplacement[l*3+u]=c})})}destroy(e){this.#e?.destroy(!0),this.#e=null,super.destroy(e)}}const VS=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uTargetColor;

vec4 black = vec4(0.0, 0.0, 0.0, 1.0);

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // 1 if black, 0 if non-black
    float isBlack = step(length(c.rgb), 0.01);

    // keep original if either:
    //      * black
    //      * transparent

    finalColor = mix(    
        vec4(uTargetColor, 1),    
        c, 
        max(isBlack, 1.0 - c.a)
    );
}
`;class Ne extends Jt{uniforms;constructor(e="white"){const r=Et.from({vertex:Sr,fragment:VS,name:"revert-colourise-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[r,n,o]=new q(e).toArray();this.uniforms.uTargetColor[0]=r,this.uniforms.uTargetColor[1]=n,this.uniforms.uTargetColor[2]=o}}const KS=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    finalColor = vec4(c.rgb * 0.5, c.a);
}
`;class XS extends Jt{constructor(){const e=Et.from({vertex:Sr,fragment:KS,name:"halfbrite-filter"});super({glProgram:e,resources:{}})}}const Yf=({basic:t,dimmed:e})=>({replaceLight:t,replaceDark:e}),Zf=({color:{hue:t,shade:e},planet:r})=>{const n=t==="yellow"?e==="dimmed"||r==="jail"?ff:Xe:ps[t][e].main;return Yf(n)},JS=t=>new Zt({lightBeige:z.lightGrey,redShadow:z.shadow,pink:z.lightGrey,moss:z.lightGrey,midRed:z.midGrey,highlightBeige:z.lightGrey,...t&&Zf(t)}),YS=new Zt({midGrey:z.midRed,lightGrey:z.lightBeige,white:z.highlightBeige,metallicBlue:z.redShadow,pink:z.midRed,moss:z.midRed,replaceDark:z.midRed,replaceLight:z.lightBeige}),hu=(t,e)=>{const r=Zo(t.color).edges[e],n=r.original;return r.dimInOriginal?hf(n):n},Qf=(t,e,r)=>r?new Zt(Yf(ps[t.color.hue][t.color.shade].edges[e])):new Ne(Zo(t.color).edges[e].original),ft=t=>new Zt(Zf(t)),ZS=t=>{switch(t.color.hue){case"white":return new Zt({replaceLight:z.lightGrey,replaceDark:z.midGrey});default:return ft(t)}},ep=t=>{switch(t.color.hue){case"white":return new Zt({replaceLight:z.lightBeige,replaceDark:z.midRed,shadow:z.redShadow});case"yellow":return ft({planet:t.planet,color:{hue:"yellow",shade:"dimmed"}});default:return ft(t)}};new XS;const Qt=Ju,QS=new Zt(HS),ek=[new ts(z.midRed)],tk=[new ts(z.moss)],rk=75;class nk{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output)}output=new te({label:"ItemFlashOnSwitchedRenderer"});tick(e){const{renderContext:{item:{state:{switchedAtRoomTime:r,switchedSetting:n}},room:{roomTime:o}}}=this;this.output.filters=o-r<rk?n==="left"?tk:ek:Qt,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const ok=(t,e,r)=>{const o=Ut().textures[`door.frame.${t.planet}.${e}.near`]!==void 0?t.planet:"generic",s=t.color.shade==="dimmed"&&Ut().textures[`door.frame.${o}.dark.${e}.${r}`]!==void 0;return`door.frame.${o}${s?".dark":""}.${e}.${r}`};function ws(t,e){const r=e||new te;for(const n of t)r.addChild(n);return r}function*sk({config:{direction:t,inHiddenWall:e,height:r}},n){const o=Yn(t),s=o==="y"?1:16;function*i(a){if(e){if(r!==0){const l=F({textureId:`generic.door.floatingThreshold.${o}`,...In(a,{y:-12*r})});l.filters=Qf(n,o==="x"?"towards":"right",!0),yield l}}else{yield F({pivot:{x:s,y:9},textureId:`generic.door.legs.base.${o}`,...In(a,{})});for(let l=1;l<r;l++)yield F({pivot:{x:s,y:9},textureId:`generic.door.legs.pillar.${o}`,...In(a,{y:-l*X.h})})}}yield*i(hr({...ur,[o]:1})),yield*i(ur),e||(yield F({pivot:{x:16,y:X.h*r+13},textureId:`generic.door.legs.threshold.double.${o}`,...hr({...ur,[o]:1})}))}const tp=(t,e)=>{const r=Yn(t),n=un(r),o=8;return t==="towards"||t==="right"?ee({[n]:e[n]-o}):ur},ik=Te(({renderContext:{item:t,room:e}})=>ws(sk(t,e),new te({filters:ft(e),...tp(t.config.direction,t.aabb)}))),ak=Te(({renderContext:{item:{config:{direction:t,part:e,toRoom:r},aabb:n},room:o,general:{gameState:s}}})=>{const i=Yn(t),a=s===void 0?o:s.campaign.rooms[r];return F({textureId:ok(o,i,e),filter:ft(a),...tp(t,n)})}),gi={animationId:"bubbles.cold"},Kr=({top:t,bottom:e="headlessBase",filter:r})=>{const n=new te({filters:r}),o=F(e);n.addChild(o);const s=F(t);return s.y=-12,n.addChild(s),n[bs]=s,n[cl]=o,n},bs=Symbol(),cl=Symbol(),lk=({top:t,bottom:e})=>{const r=new te;return r.addChild(e),t.y=-12,r.addChild(t),r[bs]=t,r[cl]=e,r},ck=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform vec2 uTextureSize;
uniform sampler2D uTexture;
uniform vec3 uOutline;
uniform float uOutlineWidth;

void main(void) {
    vec2 scaledTexelSize = vec2(1.0f) / vec2(textureSize(uTexture, 0)) * uOutlineWidth;    
    
    // Calculate offset coordinates
    vec2 rightCoord = vec2(vTextureCoord.x + scaledTexelSize.x, vTextureCoord.y);
    vec2 leftCoord = vec2(vTextureCoord.x - scaledTexelSize.x, vTextureCoord.y);
    vec2 belowCoord = vec2(vTextureCoord.x, vTextureCoord.y + scaledTexelSize.y);
    vec2 aboveCoord = vec2(vTextureCoord.x, vTextureCoord.y - scaledTexelSize.y);
    
    // Create boundary masks (1.0 if within bounds, 0.0 if out of bounds)
    // seems to work fine without this, but could multiply colourToX by this to get zero'd out when OOB
    // float rightInBounds = step(rightCoord.x, 1.0);
    // float leftInBounds = step(0.0, leftCoord.x);
    // float belowInBounds = step(belowCoord.y, 1.0);
    // float aboveInBounds = step(0.0, aboveCoord.y);
    
    vec4 colourToRight = texture(uTexture, rightCoord);
    vec4 colourToLeft = texture(uTexture, leftCoord);
    vec4 colourBelow = texture(uTexture, belowCoord);
    vec4 colourAbove = texture(uTexture, aboveCoord);
    
    // Check if any neighbor is opaque (combine all alpha values)
    float hasOpaqueNeighbor = max(max(colourToRight.a, colourToLeft.a), 
                                  max(colourBelow.a, colourAbove.a));

    vec4 originalColour = texture(uTexture, vTextureCoord);
        
    finalColor = mix(
        originalColour, 
        vec4(uOutline, 1), 
        // 1 if: original colour is transparent and has an opaque neighbour - use outline colour
        // 0 if: original colour is opaque or has no opaque neighbour - use original colour (transparent or sprite)
        (1.0 - originalColour.a) * hasOpaqueNeighbor
    );
}
`;class Pt extends Jt{constructor({outlineColor:e,upscale:r,lowRes:n}){const o=Et.from({vertex:Sr,fragment:ck,name:"outline-filter"});super({glProgram:o,padding:r,resources:{colorReplaceUniforms:{uOutline:{value:new Float32Array(3),type:"vec3<f32>"},uOutlineWidth:{value:new Float32Array(1),type:"f32"}}}});const s=this.resources.colorReplaceUniforms.uniforms,[i,a,l]=e.toArray();s.uOutline[0]=i,s.uOutline[1]=a,s.uOutline[2]=l,s.uOutlineWidth[0]=r,n&&(this.resolution=1/r,this.padding=r,s.uOutlineWidth[0]=1)}}const uk=t=>{const{gameTime:e,lastDiedAt:r}=t.type==="headOverHeels"?t.state.head:t.state;return e-r<M_},mi=t=>{if(t===void 0)return 0;const{shieldCollectedAt:e,gameTime:r}=t;return e!==null&&e+Gc>r?100-Math.ceil((r-e)/(Gc/100)):0},dk=t=>t.type==="headOverHeels"?mi(t.state.head)>0||mi(t.state.heels)>0:mi(t.state)>0,xs=t=>t,da=.02,hk=({name:t,action:e,facingXy8:r,teleportingPhase:n,gravityZ:o,paused:s})=>{if(e==="death")return{animationId:`${t}.fadeOut`,paused:s};if(n==="out")return{animationId:`${t}.fadeOut`,paused:s};if(n==="in")return{animationId:`${t}.fadeOut`,paused:s};if(e==="moving")return{animationId:`${t}.walking.${r}`,paused:s};if(e==="jumping")return{textureId:o<da?`${t}.walking.${r}.2`:`${t}.walking.${r}.1`};if(e==="falling"){const a=`${t}.falling.${r}`;if(qo(a))return{textureId:a}}const i=`${t}.idle.${r}`;return jd(i)?{animationId:i,paused:s}:{textureId:`${t}.walking.${r}.2`}},ha=Symbol(),fa=Symbol(),fk=(t,e)=>{t[ha].removeChildren(),t[ha].addChild(F(hk(e)))},rp=new Zt({pastelBlue:z.pink}),yi=(t,e,r)=>{const n=new te,o=new te;n[ha]=o,n.addChild(o);const s=F({animationId:e?`shine.${t}InSymbio`:"shine",paused:r,filter:t==="heels"?rp:Qt,flipX:t==="heels"});return n[fa]=s,n},fu=({gameTime:t,switchedToAt:e},r,n)=>(r==="headOverHeels"||r===n)&&e+D_>t,pk=t=>{if(!uk(t))return!1;const{gameTime:e,lastDiedAt:r}=t.type==="headOverHeels"?t.state.head:t.state;return(e-r)%qc<qc*B_},pu=(t,e)=>{t.filters?Array.isArray(t.filters)?t.filters=[...t.filters,e]:t.filters=[t.filters,e].flat():t.filters=e},gu=(t,e)=>{t.filters=Array.isArray(t.filters)?t.filters.filter(r=>!(r instanceof e)):t.filters instanceof e?Qt:[...t.filters]},gk=(t,{highlighted:e,flashing:r},n,o)=>{const s=n?.highlighted??!1;e&&!s?pu(o,new Pt({outlineColor:Vr[t],upscale:br(M.getState()),lowRes:!1})):!e&&s&&gu(o,Pt);const i=n?.flashing??!1;r&&!i?pu(o,new ts(Vr[t])):!r&&i&&gu(o,ts)},mk=(t,e,r)=>{e&&!r?t.addChild(t[fa]):!e&&r&&t.removeChild(t[fa])},vi=(t,e,r,n,o,s)=>{r&&fk(e,{name:t,...n,paused:o}),gk(t,n,s,e),mk(e,n.shining,s?.shining??!1)},yk=({renderContext:{item:t,general:{gameState:e,paused:r}},currentRendering:n})=>{const{type:o,state:{action:s,facing:i,teleporting:a,vels:{gravity:{z:l}}}}=t,c=n?.renderProps,u=n?.output,d=Qu(i)??"towards",f=e!==void 0&&(t.type==="headOverHeels"?fu(t.state.head,"headOverHeels","headOverHeels"):fu(t.state,t.type,e.currentCharacterName)),g=pk(t),y=dk(t),m=_a(i),v=a?.phase??null,w={action:s,facingXy8:d,teleportingPhase:v,flashing:g,highlighted:f,shining:y,gravityZ:l},S=c===void 0||c.action!==s||c.facingXy8!==d||c.teleportingPhase!==v||c?.gravityZ>da!=l>da;let b;if(o==="headOverHeels"){b=u??lk({top:yi("head",!0,r),bottom:yi("heels",!0,r)});const x=b;vi("head",x[bs],S,w,r,c),vi("heels",x[cl],S,w,r,c)}else b=u??yi(o,!1,r),vi(o,b,S,w,r,c);return s==="moving"&&u instanceof Un&&(u.animationSpeed=m*pg),{output:b,renderProps:w}},wi=xs(yk),mu=t=>t-Math.floor(t),vk=({state:{position:t}},e)=>{const r=o=>o.config.direction==="away"||o.config.direction==="left";return ws(Qe(e.items).filter(o=>o.type==="wall"||o.type==="doorLegs").filter(r).map(o=>{const{id:s,config:{direction:i},state:{position:a}}=o;return F({textureId:"floorOverdraw.cornerNearWall",label:s,...ee(Yu(a,t)),times:o.type==="wall"?Pa(o.config):{[un(Ht(i))]:2},anchor:{x:0,y:1},flipX:i==="away"})}),new te({label:"floorOverdraws"}))},wk=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    finalColor = texture(uTexture, vTextureCoord);
}
`;class bk extends Jt{constructor(){const e=Et.from({vertex:Sr,fragment:wk,name:"null-filter"});super({glProgram:e,resources:{}})}}const xk=`#version 300 es
precision lowp float;

out vec4 finalColor;

in vec2 vTextureCoord;
uniform sampler2D uBackBuffer;
uniform vec3 uTargetColor;
// do not use uTexture in this frag - for some reason it causes pixi's render pipeline
// to take away the backbuffer, which we rely on sampling from

void main() {
    vec3 bg = texture(uBackBuffer, vTextureCoord).rgb;

    float isBlack = step(length(bg), 0.001f); // 1 if black, 0 otherwise
    finalColor = mix(vec4(uTargetColor, 1.0f), vec4(0, 0, 0, 0), isBlack);


}`;class yu extends Jt{uniforms;constructor(e="white"){const r=Et.from({vertex:Sr,fragment:xk,name:"colour-clash-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}},blendRequired:!0}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[r,n,o]=new q(e).toArray();this.uniforms.uTargetColor[0]=r,this.uniforms.uTargetColor[1]=n,this.uniforms.uTargetColor[2]=o}}const vu=({colourised:t,direction:e,room:r,times:n,position:o,colourSwap:s})=>F({label:`floorEdge(${e})`,textureId:`floorEdge.${e}`,times:n,filter:s?Qf(r,e,t):void 0,...ee(o)}),_k=({room:t,xSize:e,ySize:r,y:n})=>{const o=new te({label:"floorColourClash"}),s=hu(t,"right");for(let a=0;a<=r;a++){const l=hr({x:0,y:a,z:0}),c=new ct().rect(l.x-(a===0?0:8),l.y,8*3,8).fill(s);c.filters=new yu(s),o.addChild(c)}const i=hu(t,"towards");for(let a=0;a<=e;a++){const l=hr({x:a,y:0,z:0}),c=new ct().rect(l.x-16,l.y,8*(a===0?2:3),8).fill(i);c.filters=new yu(i),o.addChild(c)}return o.y=n,o},Sk=Te(({renderContext:{room:t,item:e,general:{colourised:r},colourClashLayer:n}})=>{const{color:{shade:o}}=t,{config:s,state:{position:i},aabb:a}=e,{floorType:l,naturalFootprint:c}=s,u=new te({label:"floorAppearance"}),d=ee({...a,y:0}),f=ee({...a,x:0,y:0}),g=ee({...a,x:0}),y=ee(a);if(l!=="none"){const m=new te({label:"tiles"}),v=l==="deadly"?`generic${o==="dimmed"?".dark":""}.floor.deadly`:`${s.scenery}${o==="dimmed"?".dark":""}.floor`,w=Ut().textures[v];try{Id(v)}catch(I){throw new Error(`no floor textureId for floorType: ${l}, shade: ${o}`,{cause:I})}const S=en(c.position,i),b={x:mu(S.x/X.w),y:mu(S.y/X.w)},x=8,k={x:d.x,y:y.y-x,width:g.x-d.x,height:f.y-y.y+2*x},C=en(hr(In(b,{x:.5,y:.5})),{y:a.z},k),_=new Pm({texture:w,tilePosition:C,...k});m.addChild(_),m.addChild(vk(e,t));const j=new ct().moveTo(y.x,y.y).lineTo(g.x,g.y).lineTo(g.x,g.y+3).lineTo(f.x,f.y+3).lineTo(d.x,d.y+3).lineTo(d.x,d.y).fill({color:16711680,alpha:.5});m.addChild(j),m.mask=j,m.filters=[ZS(t)];const U=new te({children:[m]});U.filters=new Pt({outlineColor:z.pureBlack,upscale:1,lowRes:!1});const N=new te({children:[U]}),H=new bk;H.enabled=!1,N.filters=H,N.cacheAsTexture(!0),u.addChild(N),u.addChild(F({textureId:"blank",x:g.x,y:f.y+8}))}{const m=new te({label:"edges"});l==="none"&&m.addChild(new ct().moveTo(g.x,g.y+8).lineTo(g.x,g.y+100).lineTo(d.x,d.y+100).lineTo(d.x,d.y+8).lineTo(f.x,f.y+8).fill(0));const v=Math.ceil(a.y/X.w);m.addChild(vu({colourised:r,direction:"right",room:t,times:{y:v},position:{z:a.z},colourSwap:r}));const w=Math.ceil(a.x/X.w);if(m.addChild(vu({colourised:r,direction:"towards",room:t,times:{x:w},position:{z:a.z},colourSwap:r})),u.addChild(m),!r){const S=_k({xSize:w,ySize:v,y:-a.z+1,room:t});u.addChild(S),n.attach(S)}}return u}),kk=["cyberman","dalek","skiHead","bubbleRobot","computerBot","turtle"],Ck=t=>{let e=2166136261;const r=t.length;for(let n=Math.max(0,r-9);n<r;n++)e^=t.charCodeAt(n),e=Math.imul(e,1540483477),e^=e>>>15;return(e>>>0)/4294967295},Pk=200,Ek=1,Ak=(t,e)=>{const r=Ck(e);return Math.sin((t+r*2e4)/Pk)*Ek},wu=({id:t,config:{which:e},state:r},n,o)=>{if((e==="cyberman"||e==="bubbleRobot")&&r.activated||e==="emperorsGuardian"){const s=o;s[bs].y=-12+Ak(n.roomTime,t)}},Tk=({renderContext:{item:t,room:e,general:{paused:r}},currentRendering:n})=>{const{config:o,state:s}=t,i=n?.renderProps,{activated:a,busyLickingDoughnutsOffFace:l}=s,c=l?YS:a?void 0:kk.includes(o.which)?JS(e):void 0;switch(o.which){case"skiHead":case"turtle":case"cyberman":case"computerBot":case"elephant":case"elephantHead":case"monkey":{const u=ba(s.facing)??"towards";if(!(i===void 0||a!==i.activated||l!==i.busyLickingDoughnutsOffFace||u!==i.facingXy4))return wu(t,e,n.output),"no-update";const f={facingXy4:u,activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"skiHead":return{output:F({textureId:`${o.which}.${o.style}.${u}`,filter:c}),renderProps:f};case"elephantHead":return{output:F({textureId:`elephant.${u}`,filter:c}),renderProps:f};case"turtle":return{output:F(a&&!l?{animationId:`${o.which}.${u}`,filter:c,paused:r}:{textureId:`${o.which}.${u}.1`,filter:c}),renderProps:f};case"cyberman":return{output:s.activated||s.busyLickingDoughnutsOffFace?Kr({top:{textureId:`${o.which}.${u}`,filter:c||ft(e)},bottom:{...gi,paused:r}}):F({textureId:`${o.which}.${u}`,filter:c}),renderProps:f};case"computerBot":case"elephant":case"monkey":return{output:Kr({top:`${o.which}.${u}`,bottom:{animationId:"headlessBase.flash",playOnce:"and-stop"},filter:c}),renderProps:f};default:throw new Error(`unexpected monster ${o}`)}break}case"homingBot":{const u=!gg(s.vels.walking,ur);return i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated||u!==i.walking?{filter:c,output:F({animationId:u?"headlessBase.flash":"headlessBase.scan",filter:c}),renderProps:{activated:a,busyLickingDoughnutsOffFace:l,walking:u}}:"no-update"}case"helicopterBug":case"emperor":case"dalek":case"bubbleRobot":case"emperorsGuardian":{if(!(i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated))return wu(t,e,n.output),"no-update";const d={activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"helicopterBug":case"dalek":return{output:F(a&&!l?{animationId:o.which,filter:c,paused:r}:{textureId:`${o.which}.1`,filter:c}),renderProps:d};case"bubbleRobot":return{output:Kr({top:{...gi,paused:r},filter:c}),renderProps:d};case"emperorsGuardian":return{output:Kr({top:"ball",bottom:{...gi,paused:r},filter:c}),renderProps:d};case"emperor":return{output:F({animationId:"bubbles.cold",filter:c,paused:r}),renderProps:d};default:throw new Error(`unexpected monster ${o}`)}break}default:throw new Error(`unexpected monster ${o}`)}},Ao=new Pt({outlineColor:z.pureBlack,upscale:br(M.getState()),lowRes:!0});new Ne;new Ne;new Ne;new Ne(z.moss);new Ne;new Ne(Vr.head),new Ne(nn(Vr.head)),new Ne(Vr.heels),new Ne(nn(Vr.heels));function*Rk(t){const e=typeof t=="string"?t==="infinite"?"":t:t.toString(),r=dd(e);let n=0;for(const o of e){const s=`hud.char.${Vu(o)}`;try{Id(s)}catch(i){throw new Error(`no texture id for char "${o}": ${i.message}`,{cause:i})}yield F({textureId:s,x:(n+.5-r/2)*mg.w}),n++}}const np=(t,e)=>{t.removeChildren();try{ws(Rk(e),t)}catch(r){throw console.error("invalid string is",e,"and on window as window.invalid"),console.error(r),window.invalid=e,new Error(`could not show text "${e}" in container because: "${r.message}"`,{cause:r})}return t},Ok=Wf.floatingText,Ik=12,bu=X.h*3,xu=[z.shadow,z.midGrey,z.redShadow,z.metallicBlue,z.midRed,z.moss,z.pink,z.lightBeige,z.pastelBlue,z.lightGrey,z.highlightBeige],_u=[...xu,...new Array(20).fill(z.white),...xu.toReversed()],jk=({renderContext:{item:{config:{textLines:t,appearanceRoomTime:e}},room:{roomTime:r},general:{displaySettings:{uncolourised:n}},frontLayer:o},currentRendering:s})=>{const i=s?.output;let a;const c=(r-e)*Ok;if(i===void 0){a=new te({filters:new Pt({outlineColor:z.pureBlack,upscale:br(M.getState()),lowRes:!1})}),o?.attach(a);for(let u=0;u<t.length;u++){const d=t[u],f=np(new te({label:d,y:u*Ik,filters:n?Qt:new Ne(z.pink)}),d.toUpperCase());a.addChild(f)}}else a=i;for(let u=0;u<t.length;u++){const d=a.children[u],[f]=d.filters,g=c+u*-12,y=g>0&&g<bu;if(d.visible=y,y&&f){const m=Math.floor(g/bu*_u.length);f.targetColor=_u[m]}}return a.y=-c,{output:a,renderProps:pe}},Su=500,$k=wr.animations["conveyor.x"].animationSpeed,ku=wr.animations["conveyor.x"].length,zk=t=>1-(1-t)**2,Nk=(t,e)=>{for(let r=0;r<t.children.length;r++){const n=t.children[r],o=r%ku;n.gotoAndStop(e?ku-o-1:o)}return t},Lk=({renderContext:{item:{config:{direction:t,times:e},state:{stoodOnBy:r}},room:{roomTime:n}},currentRendering:o})=>{const s=o?.renderProps,i=io(r),a=(!i&&s?.moving?n:s?.roomTimeStoppedMoving)??ke,l=Ht(t),c=o?.output??Nk(F({animationId:`conveyor.${l}`,reverse:t==="towards"||t==="right",times:e}),t==="towards"||t==="right"),u=i?0:Math.min(n-a,Su),d=Math.max(0,1-u/Su);for(const f of c.children)if(d===0)f.stop();else{const g=$k*zk(d);f.play(),f.animationSpeed=g}return{output:c,renderProps:{moving:i,roomTimeStoppedMoving:a}}},Dk=xs(Lk),Mk=({renderContext:{item:t,room:e,general:{paused:r}},currentRendering:n})=>{const{state:{stoodOnBy:o},config:{times:s}}=t,i=n?.renderProps,a=al(t),l=a&&so(o,e).some(Ea);return i===void 0||a!==i.activated||l!==i.flashing?{output:l?new te({children:[F({textureId:"teleporter",times:s}),F({animationId:"teleporter.flashing",times:s,paused:r})]}):F({textureId:a?"teleporter":"block.artificial",times:s}),renderProps:{flashing:l,activated:a}}:"no-update"},Bk=({renderContext:{item:{state:{facing:t,actedOnAt:{roomTime:e,by:r}}},room:{roomTime:n,items:o}},currentRendering:s})=>{const i=s?.renderProps,a=ba(t)??"towards",l=n===e&&Xt(ss(r)).some(u=>ad(o[u]));return i===void 0||a!==i.facingXy4||l!==i.controlledByJoystick?{output:Kr({top:`charles.${a}`,bottom:l?"headlessBase.all":"headlessBase"}),renderProps:{facingXy4:a,controlledByJoystick:l}}:"no-update"},Fk=({renderContext:{item:{state:{stoodOnBy:t,stoodOnUntilRoomTime:e}},general:{paused:r}},tickContext:{lastRenderRoomTime:n},currentRendering:o})=>{const s=o?.renderProps,i=io(t);let a;return o?.output?a=o?.output:(a=F({animationId:"spring.bounce"}),a.loop=!1,a.gotoAndStop(0)),n!==void 0&&e>n&&!i&&!r?a.gotoAndPlay(0):i&&!(s?.compressed??!1)&&a.gotoAndStop(1),{output:a,renderProps:{compressed:i}}},Uk=xs(Fk),Hk=({renderContext:{item:{config:{which:t,startDirection:e}}},currentRendering:r})=>r?.renderProps===void 0?{output:t==="headOverHeels"?Kr({top:{textureId:`head.walking.${e}.2`},bottom:{textureId:`heels.walking.${e}.2`}}):F({textureId:`${t}.walking.${e}.2`}),renderProps:pe}:"no-update",Wk=({renderContext:{item:{state:{vels:{sliding:t}},config:{startingPhase:e}},general:{paused:r}},tickContext:{deltaMS:n},currentRendering:o})=>{const i=(o?.renderProps?.distanceTravelled??0)+Sa(t)*(r?0:n),l=o?.output??F("spikyBall.1"),u=(Math.floor(i*2/Ro.w)+e)%2+1;return l.texture=Ut().textures[`spikyBall.${u}`],{output:l,renderProps:{distanceTravelled:i}}},Gk=xs(Wk),qk=(t,e,r,n)=>`${t}${n?".dark":""}.wall.${e}.${r}`,Vk=Te(({renderContext:{item:{id:t,config:e},room:r}})=>{if(e.direction==="right"||e.direction==="towards")throw new Error(`wall is near: ${t}`);const{direction:n,tiles:o}=e,s=un(Ht(n)),i=new te({label:"wallTiles"});for(let a=0;a<e.tiles.length;a++){let l=F({textureId:qk(r.planet,o[a],n,r.color.shade==="dimmed"),y:1,pivot:n==="away"?{x:Ro.w,y:Ro.h+1}:{x:0,y:Ro.h+1}});const c=hr({[s]:a});if(r.planet==="moonbase"){const u=`moonbase.wall.screen.${o[a]}.away`;jd(u)&&(l=new te({children:[l]}),l.addChild(F({animationId:u,randomiseStartFrame:!0,flipX:n==="left",x:n==="away"?-8:8,y:-23})))}l.x+=c.x,l.y+=c.y,i.addChild(l),i.filters=ft(r)}return i}),Kk=({renderContext:{item:{state:{setting:t},config:e}},currentRendering:r})=>{const n=r?.renderProps,o=e.type==="in-store"?wa(M.getState(),e.path)?"right":"left":t;return n===void 0||o!==n.setting?{output:F(`switch.${o}`),renderProps:{setting:o}}:"no-update"},Xk=(t,e,r)=>e==="tower"?"tower":e==="book"?"book.x":e==="organic"&&t?`block.organic.dark${r?".disappearing":""}`:`block.${e}${r?".disappearing":""}`,Jk=({renderContext:{item:{config:{style:t,times:e},state:{disappearing:r}},room:n},currentRendering:o})=>{const s=o?.renderProps,i=r!==null;return s===void 0||s.isDissapearing!==i?{output:F({textureId:Xk(n.color.shade==="dimmed",t,i),filter:t==="organic"?ft(n):t==="book"?ep(n):void 0,times:e}),renderProps:{isDissapearing:i}}:"no-update"},Yk=({state:{stoodOnBy:t,position:e},config:{times:r}},n)=>{const o=new Array(r?.x??1).fill(null).map(()=>new Array(r?.y??1));return so(t,n).filter(ld).forEach(({id:s,state:{position:i}})=>{const a=en(i,e),l={x:Math.floor(a.x/X.w),y:Math.floor(a.y/X.d)};l.x<0||l.x>=(r?.x??1)||l.y<0||l.y>=(r?.y??1)||(o[l.x][l.y]=s)}),o},Zk=(t,e)=>{let r=0,n=1;for(const o of e)for(const s of o)s!==void 0&&t.items[s]?.state.activated&&(r|=n),n<<=1;return r},Qk=({renderContext:{item:t,room:e},currentRendering:r})=>{const{config:{times:n}}=t,o=r===void 0?Yk(t,e):r.renderProps.chargePositions,s=Zk(e,o);return s!==r?.renderProps.cybermanActivationBitmask?{output:F({textureIdCallback(a,l){const c=o[a][l];return c===void 0||e.items[c]?.state.everActivated?"toaster.off":"toaster.on"},times:n??pe}),renderProps:{chargePositions:o,cybermanActivationBitmask:s}}:"no-update"},eC={head:wi,heels:wi,headOverHeels:wi,doorFrame:ak,doorLegs:ik,monster:Tk,floatingText:jk,barrier:Te(({renderContext:{item:{config:{axis:t,times:e}}}})=>F({textureId:`barrier.${t}`,times:e})),deadlyBlock:Te(({renderContext:{item:{config:t},room:e}})=>{switch(t.style){case"volcano":return F({animationId:"volcano",filter:ft(e),times:t.times,randomiseStartFrame:!0});case"toaster":throw new Error("use the special toaster appearance instead");default:throw t.style,new Error("unknown deadly block style")}}),spikes:jt("spikes"),slidingDeadly:Gk,slidingBlock:Te(({renderContext:{item:{config:{style:t}},room:e}})=>F(t==="book"?{textureId:"book.y",filter:ep(e)}:t)),block:Jk,switch:Kk,conveyor:Dk,lift:Te(({renderContext:{general:{paused:t}}})=>{const e=new te,r={x:yl.w/2,y:yl.h};return e.addChild(F({animationId:"lift",pivot:r,paused:t})),e.addChild(F({textureId:"lift.static",pivot:r})),e}),teleporter:Mk,sceneryCrown:Te(({renderContext:{item:{config:{planet:t}}}})=>F({textureId:`crown.${t}`})),pickup:Te(({renderContext:{item:{config:t},room:e,general:{paused:r}}})=>{if(t.gives==="crown")return F({textureId:`crown.${t.planet}`});const o={shield:"whiteRabbit",jumps:"whiteRabbit",fast:"whiteRabbit","extra-life":"whiteRabbit",bag:"bag",doughnuts:"doughnuts",hooter:"hooter",scroll:{textureId:"scroll",filter:ft(e)},reincarnation:{animationId:"fish",paused:r}}[t.gives];return F(o)}),moveableDeadly:jt("fish.1"),charles:Bk,joystick:jt("joystick"),movingPlatform:jt("sandwich"),pushableBlock:jt("stepStool"),portableBlock:Te(({renderContext:{item:{config:{style:t}}}})=>F(t)),spring:Uk,sceneryPlayer:Hk,hushPuppy:jt("hushPuppy"),bubbles:Te(({renderContext:{item:{config:{style:t}},general:{paused:e}}})=>F({animationId:`bubbles.${t}`,paused:e})),firedDoughnut:jt({animationId:"bubbles.doughnut"}),ball:jt("ball"),floor:Sk,particle:Te(({renderContext:{item:{config:{forCharacter:t}}}})=>F({animationId:"particle.fade",anchor:{x:.5,y:.5},filter:t==="heels"?rp:Qt}))},tC=t=>{if(t.type==="wall"){const{direction:e}=t.config;return e==="right"||e==="towards"?void 0:Vk}return t.type==="deadlyBlock"&&t.config.style==="toaster"?Qk:eC[t.type]},rC=z.moss,nC=()=>new Pt({outlineColor:rC,lowRes:!1,upscale:br(M.getState())});class oC{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output)}output=new te({label:"PortableItemPickUpNextHighlightRenderer"});#e=!1;tick(e){const{wouldPickUpNext:r}=this.renderContext.item.state;r!==!this.#e&&(this.output.filters=r?[nC()]:Qt),this.#e=r,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const sC=(t,e,r)=>Xg(t)?new oC(e,r):r,iC=z.pastelBlue,aC=z.highlightBeige,lC=z.midRed,Cu=new Pt({outlineColor:aC,upscale:br(M.getState()),lowRes:!1}),Pu=new Pt({outlineColor:lC,upscale:br(M.getState()),lowRes:!1}),Eu=new Ne(iC),Au={left:"â†–",away:"â†—",right:"â†˜",towards:"â†™"};class cC{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output),this.#e()}output=new te({label:"EditorAnnotationsRenderer"});#e(){const e=this.renderContext.item;switch(e.type){case"pickup":if(e.config.gives==="shield"||e.config.gives==="extra-life"||e.config.gives==="jumps"||e.config.gives==="fast"){const r={shield:"ðŸ›¡",jumps:"â™¨",fast:"âš¡","extra-life":"+2"};this.#t({annotationText:r[e.config.gives],yAdj:-16})}break;case"doorFrame":if(e.config.part==="near"&&!e.isCursorPreview){const{rooms:r}=M.getState().levelEditor.campaignInProgress,{config:{toRoom:n,direction:o}}=e,s=!!r[n],i=n.toUpperCase(),a=Au[o],l=o==="away"||o==="right"?`${i}${a}`:`${a}${i}`;this.#t({annotationText:l,yAdj:o==="left"||o==="away"?-48:0,error:!s,clickDispatch:s?()=>Oi(n):void 0})}break;case"teleporter":if(!e.isCursorPreview){const{rooms:r}=M.getState().levelEditor.campaignInProgress,{config:{toRoom:n}}=e,o=!!r[n];this.#t({annotationText:`âž¡${n.toUpperCase()}`,yAdj:-12,error:!o,clickDispatch:o?()=>Oi(n):void 0})}break;case"conveyor":{const{config:{direction:r}}=e,n=Au[r];this.#t({annotationText:n,yAdj:-12})}break}}#t({annotationText:e,yAdj:r=0,error:n=!1,clickDispatch:o}){const{renderContext:{frontLayer:s}}=this,i=new Ne(n?z.midRed:z.white),a=np(new te({label:"EditorAnnotationTextContainer",filters:[i,new Pt({lowRes:!0,outlineColor:z.pureBlack,upscale:br(M.getState())})]}),e);a.y=r,o!==void 0&&(a.eventMode="static",a.on("click",()=>{M.dispatch(o())}),a.on("mouseover",()=>{M.getState().levelEditor.tool.type==="pointer"&&(M.dispatch(wl(!0)),i.targetColor=z.pastelBlue)}),a.on("mouseout",()=>{M.dispatch(wl(!1)),i.targetColor=z.white}),a.cursor="pointer"),this.output.addChild(a),s.attach(a)}tick(e){this.#r(),this.childRenderer.tick(e)}#r(){const{renderContext:{item:e}}=this,{clickableAnnotationHovered:r}=M.getState().levelEditor,{jsonItemId:n}=e,o=M.getState(),s=cd(o),i=Jg(o),a=lr(o),l=n&&s?.jsonItemId===n&&!r,c=n&&i.includes(n);this.output.filters=l&&c?[Eu,a.type==="eyeDropper"?Pu:Cu]:l?a.type==="eyeDropper"?Pu:Cu:c?Eu:Qt}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const uC=(t,e,r)=>e.general.editor?new cC(e,r):r,dC=(t,e)=>{e!==void 0&&M.getState().gameMenus.cheatsOn&&(e.eventMode="static",e.on("pointertap",()=>{M.dispatch(wg({item:t}))}))},hC=t=>{const e=M.getState(),r=yg(e),n=!vg(e),{item:o}=t,s=r==="all"||r==="non-wall"&&t.item.type!=="wall",i=[],a=tC(o);if(a!==void 0){const f=new Uf(t,a),g=new nk(t,f);i.push(uC(o,t,sC(o,t,g)))}if(n){const f=wS(t);f!==void 0&&i.push(f)}s&&i.push(new j_(t));let l;if(i.length===0)l=void 0;else{const f=i.length===1?i[0]:new fC(i,t);dC(o,f.output),l=new $_(t,f)}const c=t.general.soundSettings.mute??xa.soundSettings.mute,u=t.general.paused||c?void 0:DS(t),d=u===void 0?void 0:new FS(t,u);return new bS(t,{graphics:l,sound:d})};class fC{constructor(e,r){this.renderContext=r,this.#e=e,this.#t.addChild(...e.map(n=>n.output))}#e;#t=new te({label:"CompositeRenderer"});tick(e){for(const r of this.#e)r.tick(e)}destroy(){for(const e of this.#e)e.destroy()}get output(){return this.#t}}const pC=Zn("wall","doorFrame"),Tu=256;function*gC(t){const{left:e,right:r}=Qe(t.items).filter(pC).reduce((n,{aabb:o,renderAabb:s,renderAabbOffset:i,state:{position:a}})=>{const l=s??o,c=B(a,i??le),u=ee(B(c,{x:l.x})).x,d=ee(B(c,{y:l.y})).x;return{left:Math.min(n.left,u),right:Math.max(n.right,d)}},{left:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY});e!==Number.POSITIVE_INFINITY&&(yield new ct().rect(e-100,-256,100,Tu).fill(0)),r!==Number.NEGATIVE_INFINITY&&(yield new ct().rect(r,-256,100,Tu).fill(0))}class mC{constructor(e){this.renderContext=e;const{general:{colourised:r,soundSettings:n},room:o}=e;this.initFilters(r,e.room.color);const i=n.mute??xa.soundSettings.mute?void 0:ae.createGain();ws(gC(o),this.#o),this.output={sound:i,graphics:new te({label:`RoomRenderer(${e.room.id})`})},this.output.graphics.addChild(this.#t),r||(this.#r=new Ol({sortableChildren:!1}),this.output.graphics.addChild(this.#r)),this.output.graphics.addChild(this.#o),this.output.graphics.addChild(this.#n)}#e=!1;#t=new te({label:"items"});#r;#n=new Ol({sortableChildren:!1});#o=new te({label:"occlusion"});output;#s=void 0;#l=new Map;#i=new Map;initFilters(e,r){this.#t.filters=e?r.shade==="dimmed"?QS:Qt:new Ne(r.shade==="dimmed"?hf(Zo(r).main.original):Zo(r).main.original)}#c(e){const{room:r}=this.renderContext,n={...e,lastRenderRoomTime:this.#s};for(const s of Qe(r.items)){let i=this.#i.get(s.id);if(i===void 0){i=hC({...this.renderContext,colourClashLayer:this.#r,frontLayer:this.#n,item:s}),this.#i.set(s.id,i);const{graphics:a,sound:l}=i.output;if(a&&(this.#t.addChild(a),s.fixedZIndex&&(a.zIndex=s.fixedZIndex)),l){if(!this.output.sound)throw new Error("item renderer has sound, but room renderer does not - this probably means that they disagree on if the user has sound muted");l.connect(this.output.sound)}}try{i.tick(n)}catch(a){throw new Error(`RoomRenderer caught error while ticking Renderer for item "${s.id}" - item in play object is:
           ${JSON.stringify(s,null,2)}`,{cause:a})}}let o=!1;for(const[s,i]of this.#i.entries())r.items[s]===void 0&&(i.destroy(),this.#i.delete(s),o=!0);o&&this.#a()}#a(){if(this.#r)for(const e of this.#r.renderLayerChildren)e.parent===null&&this.#r.detach(e);for(const e of this.#n.renderLayerChildren)e.parent===null&&this.#n.detach(e)}#d(e){const r=Ff(this.renderContext.room.items,e.movedItems,this.#l),{order:n}=sl(r,this.renderContext.room.items);for(let o=0;o<n.length;o++){const s=this.#i.get(n[o]);if(s===void 0)throw new Error(`Item id=${n[o]} does not have a renderer - cannot assign a z-index`);const i=s.output.graphics;if(i)i.zIndex=n.length-o;else throw new Error(`order ${n[o]} was given a z-order by sorting, but item has no graphics`)}}get#u(){return this.#s!==void 0}tick(e){const r=this.#u?e:{...e,movedItems:new Set(Qe(this.renderContext.room.items))};this.#c(r),(!this.#u||r.movedItems.size>0)&&this.#d(r),this.#s=this.renderContext.room.roomTime}destroy(){this.output.graphics.label=this.output.graphics.label+"DESTROYED",this.output.graphics.destroy({children:!0}),this.output.sound?.disconnect(),this.#i.forEach(e=>{e.destroy()}),this.#e=!0}get destroyed(){return this.#e}}const op=p.createContext(null),yC=()=>{const[t,e]=p.useState(()=>ou({roomJson:Go(M.getState()),roomPickupsCollected:pe,scrollsRead:pe,isNewGame:!0})),r=be(Go);return p.useEffect(()=>{const n=ou({roomJson:r,roomPickupsCollected:pe,scrollsRead:pe,isNewGame:!0});e(n)},[r]),t},vC=({children:t})=>{const e=yC();return h.jsx(op,{value:e,children:t})},_s=()=>{const t=p.useContext(op);if(t===null)throw new Error("no room state in context, or no context");return t},wC=t=>{t.ticker.remove(t.render,t)},sp=p.createContext(null),bC=({children:t})=>{const[e,r]=p.useState(null);return p.useEffect(()=>{const n=new bd;return n.init({background:z.pureBlack,sharedTicker:!0}).then(()=>{wC(n),r(n)}),()=>{}},[]),e===null?null:h.jsx(sp,{value:e,children:t})},kr=()=>p.useContext(sp),xC=(t,e)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:e},soundSettings:{mute:!0},pixiRenderer:t,gameState:void 0,paused:!1,colourised:!0,upscale:ka(M.getState()),editor:!0}),Ru=(t,e,r)=>new mC({room:t,general:xC(e,r)}),_C=()=>{const{renderer:t}=kr(),e=Xu();if(!t)throw new Error("this should never be falsey (typescript violation)");const r=_s(),[n,o]=p.useState(()=>Ru(r,t,e));return p.useEffect(()=>{const s=Ru(r,t,e);return o(s),()=>{s.destroy()}},[r,t,e]),n},ip=t=>Qe(t.items).filter(e=>Fn(e)&&!e.isCursorPreview),SC=(t,e)=>{for(const r of e)fS({room:t,item:r})},pa=t=>{for(const e of Qe(t.items))e.isCursorPreview&&delete t.items[e.id]};let kC=0;const ap=(t,e,r)=>{const{world:{onItem:{face:n},position:o,itemId:s}}=t;if(n.z>Zu)return Oo(o);if(r.type==="door"){const i=e.items[s];if(i.type!=="wall")return;const{config:a,aabb:l,state:{position:c}}=i,u=Yg(Pa(a)),d=un(Ht(a.direction)),f=Ht(a.direction);if(u[d]<2)return;const g=c[d],y=c[d]+l[d]-q_,m=c.z,v=c.z+l.z-An,w={[d]:Math.max(Math.min(o[d],y),g),[f]:o[f],z:Math.max(Math.min(o.z,v),m)};return Oo(w)}return B(Oo(o),n)},Ou=(t,e,r)=>{const n=(l,c,u)=>{const d=il(`cursor/${kC++}`,{type:l,config:c,position:u},e.roomJson).toArray();return d.forEach(f=>{f.isCursorPreview=!0}),d},o=ap(t,e,r);if(o===void 0)return;if(r.type==="door"){const l=e.items[t.world.itemId];if(l.type!=="wall")return;const c=l.config.direction;return n("door",{...r.config,direction:c},o)}const s=n(r.type,r.config,o),i=Array.from(ip(e));return s.some(l=>{const c=Hf(l,i);return!Aa(c)})?void 0:s},CC={z:1,x:0,y:0},PC={z:0,x:0,y:-1},Iu={z:0,x:-1,y:0},EC=(t,{x:e,y:r},n)=>{if(n.type==="item"&&n.item.type==="door"&&t.type==="wall"){const l=t.config.direction;return os(qe[l],-1)}const{bottomCentre:o,topLeft:s,topRight:i}=an(t.state.position,t.aabb);return r<s.y-(s.x-e)/2?r<i.y-(e-i.x)/2?CC:Iu:e<o.x?PC:Iu},AC=3,TC=(t,{x:e,y:r},n)=>{const o=an(t.state.position,t.aabb);return bg.find(s=>{const i=o.projectCorner(s);return Sa(en(i,{x:e,y:r}))<AC})},Mr=3,bi=1.5;function yt({x:t,y:e},r,n){const o={x:t-r.x,y:e-r.y},s=o.x*n.y-o.y*n.x;return Math.abs(s)/Math.hypot(n.x,n.y)}const lp={point:{x:-1,y:-1,z:0},normal:{x:0,y:0,z:1}},cp={point:{x:-1,y:0,z:1},normal:{x:0,y:1,z:0}},up={point:{x:0,y:-1,z:1},normal:{x:1,y:0,z:0}},dp={point:{x:0,y:1,z:1},normal:{x:1,y:0,z:0}},hp={point:{x:1,y:0,z:1},normal:{x:0,y:1,z:0}},fp={point:{x:1,y:-1,z:0},normal:{x:0,y:0,z:1}},pp={point:{x:0,y:-1,z:-1},normal:{x:1,y:0,z:0}},gp={point:{x:-1,y:1,z:0},normal:{x:0,y:0,z:1}},mp={point:{x:-1,y:0,z:-1},normal:{x:0,y:1,z:0}},RC=(t,e,r,n)=>{const o=an(t.state.position,t.aabb),s=r.x<0,i=r.y<0,a=r.z>0;if((s||i)&&yt(e,o.bottomCentre,{x:0,y:-1})<bi)return lp;if((s||a)&&yt(e,o.topRight,{x:2,y:-1})<bi)return cp;if((i||a)&&yt(e,o.topLeft,{x:2,y:1})<bi)return up;switch(!0){case a:{const l=o.c111;if(yt(e,l,{x:2,y:1})<Mr)return dp;if(yt(e,l,{x:-2,y:1})<Mr)return hp;break}case i:{const l=o.c100;if(yt(e,l,{x:0,y:-1})<Mr)return fp;if(yt(e,l,{x:2,y:1})<Mr)return pp;break}case s:{const l=o.c010;if(yt(e,l,{x:0,y:-1})<Mr)return gp;if(yt(e,l,{x:-2,y:1})<Mr)return mp;break}}},OC=({x:t,y:e},r)=>n=>{const{position:o,aabb:s}=IC(n,r),{bottomCentre:i,topLeft:a,topRight:l}=an(o,s);return!(t<a.x||t>l.x||e<l.y-(l.x-t)/2||e<a.y-(t-a.x)/2||e>i.y-(t-i.x)/2||e>i.y-(i.x-t)/2)},IC=(t,e)=>e.type==="item"&&t.type==="wall"?{position:t.state.position,aabb:t.aabb}:{position:B(t.state.position,t.renderAabbOffset??le),aabb:t.renderAabb??t.aabb},ju=t=>t.fixedZIndex!==void 0,jC=t=>{if(t.every(ju))return t.toSorted((s,i)=>i.fixedZIndex-s.fixedZIndex).at(0);const e=t.filter(s=>!ju(s));if(e.length===0)return;if(e.length===1)return e[0];const r=Object.fromEntries(e.map(s=>[s.id,s])),n=Ff(r),{order:o}=sl(n,r);return r[o[0]]},yp=(t,e,r,n)=>{const o=!n||r.type==="item"&&r.item.type==="door",s=o?X.w:X.w/2,i=X.h,a=o?0:s/2,l=i/2,c=xg(e);return{x:c==="yz"?Math.round(t.x/s)*s:Math.floor((t.x-a)/s)*s,y:c==="xz"?Math.round(t.y/s)*s:Math.floor((t.y-a)/s)*s,z:c==="xy"?Math.round(t.z/i)*i:Math.floor((t.z+l)/i)*i}},$C=({state:{position:t},aabb:e},r,n,o,s)=>{const i={x:t.x+(r.x<0?0:e.x),y:t.y+(r.y<0?0:e.y),z:t.z+(r.z<0?0:e.z)},a=Zg(i,r,n);return yp(a,r,o,s)},zC=t=>e=>{const r=Fn(e)&&!e.isCursorPreview;return t.type==="item"&&t.item.type==="door"?r&&e.type==="wall":r},xi=(t,e,r,n)=>{const o=jC(Array.from(Qe(e.items).filter(zC(r)).filter(OC(t,r)))),s=e.id;if(o){const i=EC(o,t,r);return{roomId:s,scrXy:t,world:{itemId:o.id,onItem:{face:i,corner:TC(o,t),edge:RC(o,t,i)},position:$C(o,i,t,r,n)}}}else return{roomId:s,scrXy:t,world:void 0}},NC=(t,e=console.error)=>(...r)=>{try{return t(...r)}catch(n){e(n);return}},LC=t=>{const e=t.key;(e==="Backspace"||e==="Delete")&&M.dispatch(td()),(e==="z"||e==="Z")&&M.dispatch(t.shiftKey?nd():rd()),(e==="i"||e==="I"||e===",")&&M.dispatch(Wt({type:"eyeDropper"})),e==="Escape"&&M.dispatch(Wt({type:"pointer"}))},vp=t=>_a(ul(t))>0,ul=t=>{switch(t.type){case"deadlyBlock":return As;case"conveyor":if(t.config.disappearing)return le;switch(t.config.direction){case"left":case"right":return{x:1,y:0,z:0};case"away":case"towards":return{x:0,y:1,z:0};default:throw t.config.direction,new Error}case"hushPuppy":return As;case"teleporter":return{x:1,y:1,z:0};case"floor":case"spikes":return{x:1,y:1,z:0};case"block":return t.config.disappearing?le:As;case"barrier":if(t.config.disappearing)return le;switch(t.config.axis){case"x":return{x:1,y:0,z:1};case"y":return{x:0,y:1,z:1};default:throw t.config.axis,new Error}case"wall":switch(t.config.direction){case"left":case"right":return{x:0,y:1,z:1};case"away":case"towards":return{x:1,y:0,z:1};default:throw t.config,new Error}default:return le}},DC=({roomState:t,jsonItemId:e,newPosition:r,newTimes:n})=>{const o=Xt(ip(t)).filter(i=>i.id!==e);return il("testItem",_g(t.roomJson.items[e],i=>{n&&(i.config.times=n),i.position=r}),t.roomJson).some(i=>{const a=Hf(i,o);return!Aa(a)})},wp=(t,...e)=>({x:t(...e.map(r=>r.x)),y:t(...e.map(r=>r.y)),z:t(...e.map(r=>r.z))}),MC=t=>wp(e=>e>0?e:e>-1?1:-e+1,t),BC=({jsonItem:t,blockDragAccVec:e,resizeEdgeDirection:r,startTimes:n,startPosition:o})=>{const s=ed(e,r,ul(t)),i=B(n,s),a=MC(i),l=wp((c,u,d,f,g)=>{const y=u<1;return c<0!==y?y?d-g+1:d+f-g:y?d+f-1:d},r,i,o,n,a);return{newTimes:a,newPosition:l}},FC=5,_i=(t,e)=>{const r=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const n=e.target.getBoundingClientRect(),o=e.clientX-n.left,s=e.clientY-n.top;return{x:o/r-t.gameEngineScreenSize.x/2,y:s/r-t.gameEngineScreenSize.y+16}},UC=(t,e)=>{const r=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const n=e.movementX,o=e.movementY;return{x:n/r,y:o/r}},HC=(t,e,r)=>{const n=t.world?.onItem.edge,o=ed(n?.point??le,ul(r));return _a(o)>0?n.normal:e?{x:1,y:0,z:0}:{x:0,y:0,z:1}},WC=(t,e,r,n,o,s)=>{if(t===void 0)return;const i=en(e,t.scrXy),a=Sa(i);if(!(o||a>FC))return;const c=HC(t,n,s),u=rm(c,r);return n?{x:0,y:0,z:u.z}:u},$u=(t,e=!1)=>{const r=M.getState().levelEditor;return yp(t,{x:0,y:0,z:1},r.tool,!e&&r.halfGridResolution)},GC=(t,e)=>t.items[e]?.jsonItemId,qC=(t,e)=>e.jsonItemId&&t.levelEditor.selectedJsonItemIds.includes(e.jsonItemId),Fo=(t,e)=>e.levelEditor.wallsFloorsLocked&&(t.type==="wall"||t.type==="floor"),Si=(t,e)=>{const r=M.getState();let n;if(e.world){const o=e.world.itemId,s=o&&t.items[o],i=Fo(s,r)?void 0:s.jsonItemId;n=i===void 0?void 0:{jsonItemId:i,pointingAtOnItem:e.world.onItem}}else n=void 0;Ge(cd(r),n)||M.dispatch(ud(n))},VC=t=>{const e=kr(),r=dn(ka),n=pt(),o=_s(),s=p.useRef(void 0),i=p.useRef(void 0),a=p.useRef(void 0),l=p.useRef(void 0),c=p.useRef(!0);p.useEffect(()=>{if(t===null)return;const u=v=>{const w=_i(r,v),S=UC(r,v),b=M.getState(),x=lr(b),k=xi(w,o,x,b.levelEditor.halfGridResolution),C=!Ge(k.world,s.current?.world);switch(x.type){case"item":{if(!C)break;const _=k.world&&Ou(k,o,x.item);pa(o),_!==void 0&&SC(o,_);break}case"pointer":{const _=i.current?.world?.itemId;if(_===void 0){Si(o,k);break}const j=o.items[_],{jsonItemId:U}=j,N=o.roomJson.items[U],H=WC(i.current,w,S,v.metaKey||v.shiftKey,a.current!==void 0,N);if(!H){Si(o,k);break}if(l.current===void 0&&(M.dispatch(bl(!0)),c.current=!0,l.current={position:N.position,times:xl(N.config.times)}),U===void 0||Fo(j,b))break;qC(b,j)||M.dispatch(Os({jsonItemId:U}));const I=i.current?.world?.onItem.edge,re=I&&vp(N),D=a.current??le,K=B(D,H),W=$u(K,re);if(a.current=K,jn($u(D,re),W))break;const se=l.current.position,V=l.current.times,ie=Oo(W);let ue,ce;if(re?{newTimes:ce,newPosition:ue}=BC({jsonItem:N,blockDragAccVec:ie,resizeEdgeDirection:I.point,startTimes:V,startPosition:se}):ue=B(se,ie),(!ce||jn(ce,xl(N.config.times)))&&jn(ue,N.position)||DC({roomState:o,jsonItemId:U,newPosition:ue,newTimes:ce}))break;n(tm({jsonItemId:U,newPosition:ue,newTimes:ce,startOfGesture:c.current})),c.current=!1;break}case"eyeDropper":Si(o,k);break}s.current=k},d=v=>{const w=M.getState();if(o.id!==w.levelEditor.currentlyEditingRoomId)return;const S=_i(r,v),b=lr(M.getState()),x=xi(S,o,b,w.levelEditor.halfGridResolution),k=a.current!==void 0,C=!k&&x.roomId===i.current?.roomId&&x.world?.itemId===i.current?.world?.itemId;if(a.current=void 0,i.current=void 0,l.current=void 0,M.dispatch(bl(!1)),!C&&!k){console.log("mouseUp - not a click or drag end - skipping");return}switch(b.type){case"item":{if(x.world===void 0){n(Wt({type:"pointer"}));break}if(Ou(x,o,b.item)===void 0)break;const j=o.items[x.world.itemId];n(em({blockPosition:ap(x,o,b.item),pointedAtItem:{type:j.type,config:j.config,state:j.state,jsonItemId:j.jsonItemId}}));break}case"pointer":{if(C){const _=x.world===void 0?void 0:o.items[x.world.itemId];if(_?.jsonItemId===void 0||Fo(_,w)){n(Os({jsonItemId:void 0}));break}n(Os({jsonItemId:_.jsonItemId,additive:v.ctrlKey||v.metaKey}))}break}case"eyeDropper":{if(C){const _=x.world?.itemId;if(_===void 0){console.warn("no itemId");break}const j=o.items[_];if(Fo(j,w))break;const U=GC(o,_),N=Qg(w,U);if(N===void 0){console.warn("no json item");break}const H={type:"item",item:{type:N.type,config:N.config}};n(Wt(H))}break}}},f=v=>{const w=lr(M.getState());switch(a.current=void 0,i.current=void 0,l.current=void 0,w.type){case"item":{pa(o);break}case"pointer":{n(ud(void 0));break}}},g=v=>{const w=_i(r,v),S=M.getState(),b=lr(S),x=xi(w,o,b,S.levelEditor.halfGridResolution);console.log("setting mouseDownPointingAtRef to",x),i.current=x},y=v=>{LC(v)},m=NC(u);return t.addEventListener("mousemove",m),t.addEventListener("mouseup",d),t.addEventListener("mousedown",g),t.addEventListener("mouseleave",f),t.tabIndex=0,t.addEventListener("keyup",y),()=>{t.removeEventListener("mousemove",m),t.removeEventListener("mouseup",d),t.removeEventListener("mousedown",g),t.removeEventListener("mouseleave",f),t.removeEventListener("keyup",y)}},[e.stage,r,t,n,o])},KC=()=>{const{cssUpscale:t,canvasSize:e,rotate90:r}=dn(ka);return{transform:r?`scale(${t}) rotate(90deg) translate(0, -${e.y}px)`:`scale(${t})`,width:e.x,height:e.y,transformOrigin:"top left"}},XC=t=>{const e=_s(),r=kr();p.useEffect(()=>{let n=0;const o=({deltaMS:s})=>{if(t.destroyed)return;t.renderContext.room!==e&&console.warn("room renderer does not have the current room");const i=new Set(Wo(e.items));e.roomTime+=s,t.tick({deltaMS:s,movedItems:i,progression:n++}),r.render()};return Gr.shared.add(o),()=>{Gr.shared.remove(o)}},[t,e,r])},JC=t=>{const e=kr();p.useEffect(()=>{if(t)return t.appendChild(e.canvas),()=>{t.removeChild(e.canvas)}},[t,e])},YC=()=>{const t=kr(),e=dn(r=>r.upscale.upscale.gameEngineUpscale);t.stage.scale=e},ZC=()=>{const t=kr(),e=dn(Sg);p.useEffect(()=>{t.renderer?.resize(e.x,e.y)},[t.renderer,e])},QC=t=>{const e=kr(),[r]=p.useState(()=>new te),n=dn(kg);p.useEffect(()=>{if(t.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return r.addChild(t.output.graphics),e.stage.addChild(r),()=>{e.stage.removeChild(r),r.removeChild(t.output.graphics)}},[t,e,r]),p.useEffect(()=>{r.x=n.x/2,r.y=n.y-16},[r,n])},zu=(t,e)=>{M.dispatch(Cg(Pg(Eg(M.getState()),e)))},eP=(t,e)=>{const r=pt();p.useLayoutEffect(()=>{zu()},[]),p.useLayoutEffect(()=>{const n=()=>zu(t,e);if(e){const o=new ResizeObserver(n);return o.observe(e),()=>o.disconnect()}else return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[r,e,t])},tP=()=>{const t=_s();p.useEffect(()=>Ag({actionCreator:Wt,effect(){pa(t)}}),[t])},rP=({levelEditor:t})=>{const{dragInProgress:e,clickableAnnotationHovered:r,hoveredItem:n,selectedJsonItemIds:o}=t;if(e)return me("cursor-grabbing");if(r)return me("cursor-pointer");if(n){const s=nm(t,n.jsonItemId);if(s!==void 0&&vp(s))if(n.pointingAtOnItem.corner){if(jn(n.pointingAtOnItem.corner,{x:1,y:1,z:1}))return me("cursor-n-resize")}else{const{edge:i}=n.pointingAtOnItem;if(i){if(Ge(i,gp))return me("cursor-e-resize");if(Ge(i,lp))return me("cursor-s-resize");if(Ge(i,fp))return me("cursor-w-resize");if(Ge(i,cp)||Ge(i,dp))return me("cursor-ne-resize");if(Ge(i,up)||Ge(i,hp))return me("cursor-nw-resize");if(Ge(i,mp))return me("cursor-se-resize");if(Ge(i,pp))return me("cursor-sw-resize")}}return o.includes(n.jsonItemId)?me("cursor-grab"):me("cursor-default")}return me("cursor-crosshair")},nP=()=>be(rP);Tg.defaultOptions.scaleMode="nearest";const oP=()=>{const t=_C(),[e,r]=p.useState(null),[n,o]=p.useState(null),s=nP();eP(void 0,n??void 0),ZC(),QC(t),XC(t),VC(e),JC(e),YC(),tP();const i=KC();return h.jsx("div",{className:`w-full h-full overflow-hidden ${s}`,ref:o,children:h.jsx("div",{style:i,ref:r})})},Nu=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,sP=()=>{const t=Rg(),e=dn(Og);p.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",Ig())},[]),p.useEffect(()=>{document.body.classList.remove(...Object.keys(jg).map(Nu)),document.body.classList.add(Nu(t)),document.body.classList.toggle("portrait-rot",e)},[t,e])},Ss=p.createContext(null);Ss.displayName="PanelGroupContext";const ye={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},dl=10,dr=p.useLayoutEffect,Lu=Ku.useId,iP=typeof Lu=="function"?Lu:()=>null;let aP=0;function hl(t=null){const e=iP(),r=p.useRef(t||e||null);return r.current===null&&(r.current=""+aP++),t??r.current}function bp({children:t,className:e="",collapsedSize:r,collapsible:n,defaultSize:o,forwardedRef:s,id:i,maxSize:a,minSize:l,onCollapse:c,onExpand:u,onResize:d,order:f,style:g,tagName:y="div",...m}){const v=p.useContext(Ss);if(v===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:w,expandPanel:S,getPanelSize:b,getPanelStyle:x,groupId:k,isPanelCollapsed:C,reevaluatePanelConstraints:_,registerPanel:j,resizePanel:U,unregisterPanel:N}=v,H=hl(i),I=p.useRef({callbacks:{onCollapse:c,onExpand:u,onResize:d},constraints:{collapsedSize:r,collapsible:n,defaultSize:o,maxSize:a,minSize:l},id:H,idIsFromProps:i!==void 0,order:f});p.useRef({didLogMissingDefaultSizeWarning:!1}),dr(()=>{const{callbacks:D,constraints:K}=I.current,W={...K};I.current.id=H,I.current.idIsFromProps=i!==void 0,I.current.order=f,D.onCollapse=c,D.onExpand=u,D.onResize=d,K.collapsedSize=r,K.collapsible=n,K.defaultSize=o,K.maxSize=a,K.minSize=l,(W.collapsedSize!==K.collapsedSize||W.collapsible!==K.collapsible||W.maxSize!==K.maxSize||W.minSize!==K.minSize)&&_(I.current,W)}),dr(()=>{const D=I.current;return j(D),()=>{N(D)}},[f,H,j,N]),p.useImperativeHandle(s,()=>({collapse:()=>{w(I.current)},expand:D=>{S(I.current,D)},getId(){return H},getSize(){return b(I.current)},isCollapsed(){return C(I.current)},isExpanded(){return!C(I.current)},resize:D=>{U(I.current,D)}}),[w,S,b,C,H,U]);const re=x(I.current,o);return p.createElement(y,{...m,children:t,className:e,id:H,style:{...re,...g},[ye.groupId]:k,[ye.panel]:"",[ye.panelCollapsible]:n||void 0,[ye.panelId]:H,[ye.panelSize]:parseFloat(""+re.flexGrow).toFixed(1)})}const Uo=p.forwardRef((t,e)=>p.createElement(bp,{...t,forwardedRef:e}));bp.displayName="Panel";Uo.displayName="forwardRef(Panel)";let ga=null,Ho=-1,Mt=null;function lP(t,e){if(e){const r=(e&Cp)!==0,n=(e&Pp)!==0,o=(e&Ep)!==0,s=(e&Ap)!==0;if(r)return o?"se-resize":s?"ne-resize":"e-resize";if(n)return o?"sw-resize":s?"nw-resize":"w-resize";if(o)return"s-resize";if(s)return"n-resize"}switch(t){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function cP(){Mt!==null&&(document.head.removeChild(Mt),ga=null,Mt=null,Ho=-1)}function ki(t,e){var r,n;const o=lP(t,e);if(ga!==o){if(ga=o,Mt===null&&(Mt=document.createElement("style"),document.head.appendChild(Mt)),Ho>=0){var s;(s=Mt.sheet)===null||s===void 0||s.removeRule(Ho)}Ho=(r=(n=Mt.sheet)===null||n===void 0?void 0:n.insertRule(`*{cursor: ${o} !important;}`))!==null&&r!==void 0?r:-1}}function xp(t){return t.type==="keydown"}function _p(t){return t.type.startsWith("pointer")}function Sp(t){return t.type.startsWith("mouse")}function ks(t){if(_p(t)){if(t.isPrimary)return{x:t.clientX,y:t.clientY}}else if(Sp(t))return{x:t.clientX,y:t.clientY};return{x:1/0,y:1/0}}function uP(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function dP(t,e,r){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function hP(t,e){if(t===e)throw new Error("Cannot compare node with itself");const r={a:Bu(t),b:Bu(e)};let n;for(;r.a.at(-1)===r.b.at(-1);)t=r.a.pop(),e=r.b.pop(),n=t;Q(n,"Stacking order can only be calculated for elements with a common ancestor");const o={a:Mu(Du(r.a)),b:Mu(Du(r.b))};if(o.a===o.b){const s=n.childNodes,i={a:r.a.at(-1),b:r.b.at(-1)};let a=s.length;for(;a--;){const l=s[a];if(l===i.a)return 1;if(l===i.b)return-1}}return Math.sign(o.a-o.b)}const fP=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function pP(t){var e;const r=getComputedStyle((e=kp(t))!==null&&e!==void 0?e:t).display;return r==="flex"||r==="inline-flex"}function gP(t){const e=getComputedStyle(t);return!!(e.position==="fixed"||e.zIndex!=="auto"&&(e.position!=="static"||pP(t))||+e.opacity<1||"transform"in e&&e.transform!=="none"||"webkitTransform"in e&&e.webkitTransform!=="none"||"mixBlendMode"in e&&e.mixBlendMode!=="normal"||"filter"in e&&e.filter!=="none"||"webkitFilter"in e&&e.webkitFilter!=="none"||"isolation"in e&&e.isolation==="isolate"||fP.test(e.willChange)||e.webkitOverflowScrolling==="touch")}function Du(t){let e=t.length;for(;e--;){const r=t[e];if(Q(r,"Missing node"),gP(r))return r}return null}function Mu(t){return t&&Number(getComputedStyle(t).zIndex)||0}function Bu(t){const e=[];for(;t;)e.push(t),t=kp(t);return e}function kp(t){const{parentNode:e}=t;return e&&e instanceof ShadowRoot?e.host:e}const Cp=1,Pp=2,Ep=4,Ap=8,mP=uP()==="coarse";let et=[],Qr=!1,Bt=new Map,Cs=new Map;const Kn=new Set;function yP(t,e,r,n,o){var s;const{ownerDocument:i}=e,a={direction:r,element:e,hitAreaMargins:n,setResizeHandlerState:o},l=(s=Bt.get(i))!==null&&s!==void 0?s:0;return Bt.set(i,l+1),Kn.add(a),rs(),function(){var u;Cs.delete(t),Kn.delete(a);const d=(u=Bt.get(i))!==null&&u!==void 0?u:1;if(Bt.set(i,d-1),rs(),d===1&&Bt.delete(i),et.includes(a)){const f=et.indexOf(a);f>=0&&et.splice(f,1),pl(),o("up",!0,null)}}}function vP(t){const{target:e}=t,{x:r,y:n}=ks(t);Qr=!0,fl({target:e,x:r,y:n}),rs(),et.length>0&&(ns("down",t),t.preventDefault(),Tp(e)||t.stopImmediatePropagation())}function Ci(t){const{x:e,y:r}=ks(t);if(Qr&&t.buttons===0&&(Qr=!1,ns("up",t)),!Qr){const{target:n}=t;fl({target:n,x:e,y:r})}ns("move",t),pl(),et.length>0&&t.preventDefault()}function Pi(t){const{target:e}=t,{x:r,y:n}=ks(t);Cs.clear(),Qr=!1,et.length>0&&(t.preventDefault(),Tp(e)||t.stopImmediatePropagation()),ns("up",t),fl({target:e,x:r,y:n}),pl(),rs()}function Tp(t){let e=t;for(;e;){if(e.hasAttribute(ye.resizeHandle))return!0;e=e.parentElement}return!1}function fl({target:t,x:e,y:r}){et.splice(0);let n=null;(t instanceof HTMLElement||t instanceof SVGElement)&&(n=t),Kn.forEach(o=>{const{element:s,hitAreaMargins:i}=o,a=s.getBoundingClientRect(),{bottom:l,left:c,right:u,top:d}=a,f=mP?i.coarse:i.fine;if(e>=c-f&&e<=u+f&&r>=d-f&&r<=l+f){if(n!==null&&document.contains(n)&&s!==n&&!s.contains(n)&&!n.contains(s)&&hP(n,s)>0){let y=n,m=!1;for(;y&&!y.contains(s);){if(dP(y.getBoundingClientRect(),a)){m=!0;break}y=y.parentElement}if(m)return}et.push(o)}})}function Ei(t,e){Cs.set(t,e)}function pl(){let t=!1,e=!1;et.forEach(n=>{const{direction:o}=n;o==="horizontal"?t=!0:e=!0});let r=0;Cs.forEach(n=>{r|=n}),t&&e?ki("intersection",r):t?ki("horizontal",r):e?ki("vertical",r):cP()}let Ai;function rs(){var t;(t=Ai)===null||t===void 0||t.abort(),Ai=new AbortController;const e={capture:!0,signal:Ai.signal};Kn.size&&(Qr?(et.length>0&&Bt.forEach((r,n)=>{const{body:o}=n;r>0&&(o.addEventListener("contextmenu",Pi,e),o.addEventListener("pointerleave",Ci,e),o.addEventListener("pointermove",Ci,e))}),Bt.forEach((r,n)=>{const{body:o}=n;o.addEventListener("pointerup",Pi,e),o.addEventListener("pointercancel",Pi,e)})):Bt.forEach((r,n)=>{const{body:o}=n;r>0&&(o.addEventListener("pointerdown",vP,e),o.addEventListener("pointermove",Ci,e))}))}function ns(t,e){Kn.forEach(r=>{const{setResizeHandlerState:n}=r,o=et.includes(r);n(t,o,e)})}function wP(){const[t,e]=p.useState(0);return p.useCallback(()=>e(r=>r+1),[])}function Q(t,e){if(!t)throw console.error(e),Error(e)}function vr(t,e,r=dl){return t.toFixed(r)===e.toFixed(r)?0:t>e?1:-1}function xt(t,e,r=dl){return vr(t,e,r)===0}function De(t,e,r){return vr(t,e,r)===0}function bP(t,e,r){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++){const o=t[n],s=e[n];if(!De(o,s,r))return!1}return!0}function Xr({panelConstraints:t,panelIndex:e,size:r}){const n=t[e];Q(n!=null,`Panel constraints not found for index ${e}`);let{collapsedSize:o=0,collapsible:s,maxSize:i=100,minSize:a=0}=n;if(vr(r,a)<0)if(s){const l=(o+a)/2;vr(r,l)<0?r=o:r=a}else r=a;return r=Math.min(i,r),r=parseFloat(r.toFixed(dl)),r}function Rn({delta:t,initialLayout:e,panelConstraints:r,pivotIndices:n,prevLayout:o,trigger:s}){if(De(t,0))return e;const i=[...e],[a,l]=n;Q(a!=null,"Invalid first pivot index"),Q(l!=null,"Invalid second pivot index");let c=0;if(s==="keyboard"){{const d=t<0?l:a,f=r[d];Q(f,`Panel constraints not found for index ${d}`);const{collapsedSize:g=0,collapsible:y,minSize:m=0}=f;if(y){const v=e[d];if(Q(v!=null,`Previous layout not found for panel index ${d}`),De(v,g)){const w=m-v;vr(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}{const d=t<0?a:l,f=r[d];Q(f,`No panel constraints found for index ${d}`);const{collapsedSize:g=0,collapsible:y,minSize:m=0}=f;if(y){const v=e[d];if(Q(v!=null,`Previous layout not found for panel index ${d}`),De(v,m)){const w=v-g;vr(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}}{const d=t<0?1:-1;let f=t<0?l:a,g=0;for(;;){const m=e[f];Q(m!=null,`Previous layout not found for panel index ${f}`);const w=Xr({panelConstraints:r,panelIndex:f,size:100})-m;if(g+=w,f+=d,f<0||f>=r.length)break}const y=Math.min(Math.abs(t),Math.abs(g));t=t<0?0-y:y}{let f=t<0?a:l;for(;f>=0&&f<r.length;){const g=Math.abs(t)-Math.abs(c),y=e[f];Q(y!=null,`Previous layout not found for panel index ${f}`);const m=y-g,v=Xr({panelConstraints:r,panelIndex:f,size:m});if(!De(y,v)&&(c+=y-v,i[f]=v,c.toPrecision(3).localeCompare(Math.abs(t).toPrecision(3),void 0,{numeric:!0})>=0))break;t<0?f--:f++}}if(bP(o,i))return o;{const d=t<0?l:a,f=e[d];Q(f!=null,`Previous layout not found for panel index ${d}`);const g=f+c,y=Xr({panelConstraints:r,panelIndex:d,size:g});if(i[d]=y,!De(y,g)){let m=g-y,w=t<0?l:a;for(;w>=0&&w<r.length;){const S=i[w];Q(S!=null,`Previous layout not found for panel index ${w}`);const b=S+m,x=Xr({panelConstraints:r,panelIndex:w,size:b});if(De(S,x)||(m-=x-S,i[w]=x),De(m,0))break;t>0?w--:w++}}}const u=i.reduce((d,f)=>f+d,0);return De(u,100)?i:o}function xP({layout:t,panelsArray:e,pivotIndices:r}){let n=0,o=100,s=0,i=0;const a=r[0];Q(a!=null,"No pivot index found"),e.forEach((d,f)=>{const{constraints:g}=d,{maxSize:y=100,minSize:m=0}=g;f===a?(n=m,o=y):(s+=m,i+=y)});const l=Math.min(o,100-s),c=Math.max(n,100-i),u=t[a];return{valueMax:l,valueMin:c,valueNow:u}}function Xn(t,e=document){return Array.from(e.querySelectorAll(`[${ye.resizeHandleId}][data-panel-group-id="${t}"]`))}function Rp(t,e,r=document){const o=Xn(t,r).findIndex(s=>s.getAttribute(ye.resizeHandleId)===e);return o??null}function Op(t,e,r){const n=Rp(t,e,r);return n!=null?[n,n+1]:[-1,-1]}function _P(t){return t instanceof HTMLElement?!0:typeof t=="object"&&t!==null&&"tagName"in t&&"getAttribute"in t}function Ip(t,e=document){if(_P(e)&&e.dataset.panelGroupId==t)return e;const r=e.querySelector(`[data-panel-group][data-panel-group-id="${t}"]`);return r||null}function Ps(t,e=document){const r=e.querySelector(`[${ye.resizeHandleId}="${t}"]`);return r||null}function SP(t,e,r,n=document){var o,s,i,a;const l=Ps(e,n),c=Xn(t,n),u=l?c.indexOf(l):-1,d=(o=(s=r[u])===null||s===void 0?void 0:s.id)!==null&&o!==void 0?o:null,f=(i=(a=r[u+1])===null||a===void 0?void 0:a.id)!==null&&i!==void 0?i:null;return[d,f]}function kP({committedValuesRef:t,eagerValuesRef:e,groupId:r,layout:n,panelDataArray:o,panelGroupElement:s,setLayout:i}){p.useRef({didWarnAboutMissingResizeHandle:!1}),dr(()=>{if(!s)return;const a=Xn(r,s);for(let l=0;l<o.length-1;l++){const{valueMax:c,valueMin:u,valueNow:d}=xP({layout:n,panelsArray:o,pivotIndices:[l,l+1]}),f=a[l];if(f!=null){const g=o[l];Q(g,`No panel data found for index "${l}"`),f.setAttribute("aria-controls",g.id),f.setAttribute("aria-valuemax",""+Math.round(c)),f.setAttribute("aria-valuemin",""+Math.round(u)),f.setAttribute("aria-valuenow",d!=null?""+Math.round(d):"")}}return()=>{a.forEach((l,c)=>{l.removeAttribute("aria-controls"),l.removeAttribute("aria-valuemax"),l.removeAttribute("aria-valuemin"),l.removeAttribute("aria-valuenow")})}},[r,n,o,s]),p.useEffect(()=>{if(!s)return;const a=e.current;Q(a,"Eager values not found");const{panelDataArray:l}=a,c=Ip(r,s);Q(c!=null,`No group found for id "${r}"`);const u=Xn(r,s);Q(u,`No resize handles found for group id "${r}"`);const d=u.map(f=>{const g=f.getAttribute(ye.resizeHandleId);Q(g,"Resize handle element has no handle id attribute");const[y,m]=SP(r,g,l,s);if(y==null||m==null)return()=>{};const v=w=>{if(!w.defaultPrevented)switch(w.key){case"Enter":{w.preventDefault();const S=l.findIndex(b=>b.id===y);if(S>=0){const b=l[S];Q(b,`No panel data found for index ${S}`);const x=n[S],{collapsedSize:k=0,collapsible:C,minSize:_=0}=b.constraints;if(x!=null&&C){const j=Rn({delta:De(x,k)?_-k:k-x,initialLayout:n,panelConstraints:l.map(U=>U.constraints),pivotIndices:Op(r,g,s),prevLayout:n,trigger:"keyboard"});n!==j&&i(j)}}break}}};return f.addEventListener("keydown",v),()=>{f.removeEventListener("keydown",v)}});return()=>{d.forEach(f=>f())}},[s,t,e,r,n,o,i])}function Fu(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function jp(t,e){const r=t==="horizontal",{x:n,y:o}=ks(e);return r?n:o}function CP(t,e,r,n,o){const s=r==="horizontal",i=Ps(e,o);Q(i,`No resize handle element found for id "${e}"`);const a=i.getAttribute(ye.groupId);Q(a,"Resize handle element has no group id attribute");let{initialCursorPosition:l}=n;const c=jp(r,t),u=Ip(a,o);Q(u,`No group element found for id "${a}"`);const d=u.getBoundingClientRect(),f=s?d.width:d.height;return(c-l)/f*100}function PP(t,e,r,n,o,s){if(xp(t)){const i=r==="horizontal";let a=0;t.shiftKey?a=100:o!=null?a=o:a=10;let l=0;switch(t.key){case"ArrowDown":l=i?0:a;break;case"ArrowLeft":l=i?-a:0;break;case"ArrowRight":l=i?a:0;break;case"ArrowUp":l=i?0:-a;break;case"End":l=100;break;case"Home":l=-100;break}return l}else return n==null?0:CP(t,e,r,n,s)}function EP({panelDataArray:t}){const e=Array(t.length),r=t.map(s=>s.constraints);let n=0,o=100;for(let s=0;s<t.length;s++){const i=r[s];Q(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;a!=null&&(n++,e[s]=a,o-=a)}for(let s=0;s<t.length;s++){const i=r[s];Q(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;if(a!=null)continue;const l=t.length-n,c=o/l;n++,e[s]=c,o-=c}return e}function Br(t,e,r){e.forEach((n,o)=>{const s=t[o];Q(s,`Panel data not found for index ${o}`);const{callbacks:i,constraints:a,id:l}=s,{collapsedSize:c=0,collapsible:u}=a,d=r[l];if(d==null||n!==d){r[l]=n;const{onCollapse:f,onExpand:g,onResize:y}=i;y&&y(n,d),u&&(f||g)&&(g&&(d==null||xt(d,c))&&!xt(n,c)&&g(),f&&(d==null||!xt(d,c))&&xt(n,c)&&f())}})}function To(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!=e[r])return!1;return!0}function AP({defaultSize:t,dragState:e,layout:r,panelData:n,panelIndex:o,precision:s=3}){const i=r[o];let a;return i==null?a=t!=null?t.toPrecision(s):"1":n.length===1?a="1":a=i.toPrecision(s),{flexBasis:0,flexGrow:a,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function TP(t,e=10){let r=null;return(...o)=>{r!==null&&clearTimeout(r),r=setTimeout(()=>{t(...o)},e)}}function Uu(t){try{if(typeof localStorage<"u")t.getItem=e=>localStorage.getItem(e),t.setItem=(e,r)=>{localStorage.setItem(e,r)};else throw new Error("localStorage not supported in this environment")}catch(e){console.error(e),t.getItem=()=>null,t.setItem=()=>{}}}function $p(t){return`react-resizable-panels:${t}`}function zp(t){return t.map(e=>{const{constraints:r,id:n,idIsFromProps:o,order:s}=e;return o?n:s?`${s}:${JSON.stringify(r)}`:JSON.stringify(r)}).sort((e,r)=>e.localeCompare(r)).join(",")}function Np(t,e){try{const r=$p(t),n=e.getItem(r);if(n){const o=JSON.parse(n);if(typeof o=="object"&&o!=null)return o}}catch{}return null}function RP(t,e,r){var n,o;const s=(n=Np(t,r))!==null&&n!==void 0?n:{},i=zp(e);return(o=s[i])!==null&&o!==void 0?o:null}function OP(t,e,r,n,o){var s;const i=$p(t),a=zp(e),l=(s=Np(t,o))!==null&&s!==void 0?s:{};l[a]={expandToSizes:Object.fromEntries(r.entries()),layout:n};try{o.setItem(i,JSON.stringify(l))}catch(c){console.error(c)}}function Hu({layout:t,panelConstraints:e}){const r=[...t],n=r.reduce((s,i)=>s+i,0);if(r.length!==e.length)throw Error(`Invalid ${e.length} panel layout: ${r.map(s=>`${s}%`).join(", ")}`);if(!De(n,100)&&r.length>0)for(let s=0;s<e.length;s++){const i=r[s];Q(i!=null,`No layout data found for index ${s}`);const a=100/n*i;r[s]=a}let o=0;for(let s=0;s<e.length;s++){const i=r[s];Q(i!=null,`No layout data found for index ${s}`);const a=Xr({panelConstraints:e,panelIndex:s,size:i});i!=a&&(o+=i-a,r[s]=a)}if(!De(o,0))for(let s=0;s<e.length;s++){const i=r[s];Q(i!=null,`No layout data found for index ${s}`);const a=i+o,l=Xr({panelConstraints:e,panelIndex:s,size:a});if(i!==l&&(o-=l-i,r[s]=l,De(o,0)))break}return r}const IP=100,On={getItem:t=>(Uu(On),On.getItem(t)),setItem:(t,e)=>{Uu(On),On.setItem(t,e)}},Wu={};function Lp({autoSaveId:t=null,children:e,className:r="",direction:n,forwardedRef:o,id:s=null,onLayout:i=null,keyboardResizeBy:a=null,storage:l=On,style:c,tagName:u="div",...d}){const f=hl(s),g=p.useRef(null),[y,m]=p.useState(null),[v,w]=p.useState([]),S=wP(),b=p.useRef({}),x=p.useRef(new Map),k=p.useRef(0),C=p.useRef({autoSaveId:t,direction:n,dragState:y,id:f,keyboardResizeBy:a,onLayout:i,storage:l}),_=p.useRef({layout:v,panelDataArray:[],panelDataArrayChanged:!1});p.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),p.useImperativeHandle(o,()=>({getId:()=>C.current.id,getLayout:()=>{const{layout:P}=_.current;return P},setLayout:P=>{const{onLayout:R}=C.current,{layout:A,panelDataArray:O}=_.current,T=Hu({layout:P,panelConstraints:O.map(L=>L.constraints)});Fu(A,T)||(w(T),_.current.layout=T,R&&R(T),Br(O,T,b.current))}}),[]),dr(()=>{C.current.autoSaveId=t,C.current.direction=n,C.current.dragState=y,C.current.id=f,C.current.onLayout=i,C.current.storage=l}),kP({committedValuesRef:C,eagerValuesRef:_,groupId:f,layout:v,panelDataArray:_.current.panelDataArray,setLayout:w,panelGroupElement:g.current}),p.useEffect(()=>{const{panelDataArray:P}=_.current;if(t){if(v.length===0||v.length!==P.length)return;let R=Wu[t];R==null&&(R=TP(OP,IP),Wu[t]=R);const A=[...P],O=new Map(x.current);R(t,A,O,v,l)}},[t,v,l]),p.useEffect(()=>{});const j=p.useCallback(P=>{const{onLayout:R}=C.current,{layout:A,panelDataArray:O}=_.current;if(P.constraints.collapsible){const T=O.map(Ue=>Ue.constraints),{collapsedSize:L=0,panelSize:ne,pivotIndices:de}=rr(O,P,A);if(Q(ne!=null,`Panel size not found for panel "${P.id}"`),!xt(ne,L)){x.current.set(P.id,ne);const He=Wr(O,P)===O.length-1?ne-L:L-ne,he=Rn({delta:He,initialLayout:A,panelConstraints:T,pivotIndices:de,prevLayout:A,trigger:"imperative-api"});To(A,he)||(w(he),_.current.layout=he,R&&R(he),Br(O,he,b.current))}}},[]),U=p.useCallback((P,R)=>{const{onLayout:A}=C.current,{layout:O,panelDataArray:T}=_.current;if(P.constraints.collapsible){const L=T.map(Ve=>Ve.constraints),{collapsedSize:ne=0,panelSize:de=0,minSize:Ue=0,pivotIndices:He}=rr(T,P,O),he=R??Ue;if(xt(de,ne)){const Ve=x.current.get(P.id),mn=Ve!=null&&Ve>=he?Ve:he,Es=Wr(T,P)===T.length-1?de-mn:mn-de,Oe=Rn({delta:Es,initialLayout:O,panelConstraints:L,pivotIndices:He,prevLayout:O,trigger:"imperative-api"});To(O,Oe)||(w(Oe),_.current.layout=Oe,A&&A(Oe),Br(T,Oe,b.current))}}},[]),N=p.useCallback(P=>{const{layout:R,panelDataArray:A}=_.current,{panelSize:O}=rr(A,P,R);return Q(O!=null,`Panel size not found for panel "${P.id}"`),O},[]),H=p.useCallback((P,R)=>{const{panelDataArray:A}=_.current,O=Wr(A,P);return AP({defaultSize:R,dragState:y,layout:v,panelData:A,panelIndex:O})},[y,v]),I=p.useCallback(P=>{const{layout:R,panelDataArray:A}=_.current,{collapsedSize:O=0,collapsible:T,panelSize:L}=rr(A,P,R);return Q(L!=null,`Panel size not found for panel "${P.id}"`),T===!0&&xt(L,O)},[]),re=p.useCallback(P=>{const{layout:R,panelDataArray:A}=_.current,{collapsedSize:O=0,collapsible:T,panelSize:L}=rr(A,P,R);return Q(L!=null,`Panel size not found for panel "${P.id}"`),!T||vr(L,O)>0},[]),D=p.useCallback(P=>{const{panelDataArray:R}=_.current;R.push(P),R.sort((A,O)=>{const T=A.order,L=O.order;return T==null&&L==null?0:T==null?-1:L==null?1:T-L}),_.current.panelDataArrayChanged=!0,S()},[S]);dr(()=>{if(_.current.panelDataArrayChanged){_.current.panelDataArrayChanged=!1;const{autoSaveId:P,onLayout:R,storage:A}=C.current,{layout:O,panelDataArray:T}=_.current;let L=null;if(P){const de=RP(P,T,A);de&&(x.current=new Map(Object.entries(de.expandToSizes)),L=de.layout)}L==null&&(L=EP({panelDataArray:T}));const ne=Hu({layout:L,panelConstraints:T.map(de=>de.constraints)});Fu(O,ne)||(w(ne),_.current.layout=ne,R&&R(ne),Br(T,ne,b.current))}}),dr(()=>{const P=_.current;return()=>{P.layout=[]}},[]);const K=p.useCallback(P=>{let R=!1;const A=g.current;return A&&window.getComputedStyle(A,null).getPropertyValue("direction")==="rtl"&&(R=!0),function(T){T.preventDefault();const L=g.current;if(!L)return()=>null;const{direction:ne,dragState:de,id:Ue,keyboardResizeBy:He,onLayout:he}=C.current,{layout:Ve,panelDataArray:mn}=_.current,{initialLayout:ao}=de??{},Es=Op(Ue,P,L);let Oe=PP(T,P,ne,de,He,L);const gl=ne==="horizontal";gl&&R&&(Oe=-Oe);const Mp=mn.map(Bp=>Bp.constraints),yn=Rn({delta:Oe,initialLayout:ao??Ve,panelConstraints:Mp,pivotIndices:Es,prevLayout:Ve,trigger:xp(T)?"keyboard":"mouse-or-touch"}),ml=!To(Ve,yn);(_p(T)||Sp(T))&&k.current!=Oe&&(k.current=Oe,!ml&&Oe!==0?gl?Ei(P,Oe<0?Cp:Pp):Ei(P,Oe<0?Ep:Ap):Ei(P,0)),ml&&(w(yn),_.current.layout=yn,he&&he(yn),Br(mn,yn,b.current))}},[]),W=p.useCallback((P,R)=>{const{onLayout:A}=C.current,{layout:O,panelDataArray:T}=_.current,L=T.map(Ve=>Ve.constraints),{panelSize:ne,pivotIndices:de}=rr(T,P,O);Q(ne!=null,`Panel size not found for panel "${P.id}"`);const He=Wr(T,P)===T.length-1?ne-R:R-ne,he=Rn({delta:He,initialLayout:O,panelConstraints:L,pivotIndices:de,prevLayout:O,trigger:"imperative-api"});To(O,he)||(w(he),_.current.layout=he,A&&A(he),Br(T,he,b.current))},[]),se=p.useCallback((P,R)=>{const{layout:A,panelDataArray:O}=_.current,{collapsedSize:T=0,collapsible:L}=R,{collapsedSize:ne=0,collapsible:de,maxSize:Ue=100,minSize:He=0}=P.constraints,{panelSize:he}=rr(O,P,A);he!=null&&(L&&de&&xt(he,T)?xt(T,ne)||W(P,ne):he<He?W(P,He):he>Ue&&W(P,Ue))},[W]),V=p.useCallback((P,R)=>{const{direction:A}=C.current,{layout:O}=_.current;if(!g.current)return;const T=Ps(P,g.current);Q(T,`Drag handle element not found for id "${P}"`);const L=jp(A,R);m({dragHandleId:P,dragHandleRect:T.getBoundingClientRect(),initialCursorPosition:L,initialLayout:O})},[]),ie=p.useCallback(()=>{m(null)},[]),ue=p.useCallback(P=>{const{panelDataArray:R}=_.current,A=Wr(R,P);A>=0&&(R.splice(A,1),delete b.current[P.id],_.current.panelDataArrayChanged=!0,S())},[S]),ce=p.useMemo(()=>({collapsePanel:j,direction:n,dragState:y,expandPanel:U,getPanelSize:N,getPanelStyle:H,groupId:f,isPanelCollapsed:I,isPanelExpanded:re,reevaluatePanelConstraints:se,registerPanel:D,registerResizeHandle:K,resizePanel:W,startDragging:V,stopDragging:ie,unregisterPanel:ue,panelGroupElement:g.current}),[j,y,n,U,N,H,f,I,re,se,D,K,W,V,ie,ue]),E={display:"flex",flexDirection:n==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return p.createElement(Ss.Provider,{value:ce},p.createElement(u,{...d,children:e,className:r,id:s,ref:g,style:{...E,...c},[ye.group]:"",[ye.groupDirection]:n,[ye.groupId]:f}))}const Dp=p.forwardRef((t,e)=>p.createElement(Lp,{...t,forwardedRef:e}));Lp.displayName="PanelGroup";Dp.displayName="forwardRef(PanelGroup)";function Wr(t,e){return t.findIndex(r=>r===e||r.id===e.id)}function rr(t,e,r){const n=Wr(t,e),s=n===t.length-1?[n-1,n]:[n,n+1],i=r[n];return{...e.constraints,panelSize:i,pivotIndices:s}}function jP({disabled:t,handleId:e,resizeHandler:r,panelGroupElement:n}){p.useEffect(()=>{if(t||r==null||n==null)return;const o=Ps(e,n);if(o==null)return;const s=i=>{if(!i.defaultPrevented)switch(i.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{i.preventDefault(),r(i);break}case"F6":{i.preventDefault();const a=o.getAttribute(ye.groupId);Q(a,`No group element found for id "${a}"`);const l=Xn(a,n),c=Rp(a,e,n);Q(c!==null,`No resize element found for id "${e}"`);const u=i.shiftKey?c>0?c-1:l.length-1:c+1<l.length?c+1:0;l[u].focus();break}}};return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}},[n,t,e,r])}function ma({children:t=null,className:e="",disabled:r=!1,hitAreaMargins:n,id:o,onBlur:s,onClick:i,onDragging:a,onFocus:l,onPointerDown:c,onPointerUp:u,style:d={},tabIndex:f=0,tagName:g="div",...y}){var m,v;const w=p.useRef(null),S=p.useRef({onClick:i,onDragging:a,onPointerDown:c,onPointerUp:u});p.useEffect(()=>{S.current.onClick=i,S.current.onDragging=a,S.current.onPointerDown=c,S.current.onPointerUp=u});const b=p.useContext(Ss);if(b===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:x,groupId:k,registerResizeHandle:C,startDragging:_,stopDragging:j,panelGroupElement:U}=b,N=hl(o),[H,I]=p.useState("inactive"),[re,D]=p.useState(!1),[K,W]=p.useState(null),se=p.useRef({state:H});dr(()=>{se.current.state=H}),p.useEffect(()=>{if(r)W(null);else{const ce=C(N);W(()=>ce)}},[r,N,C]);const V=(m=n?.coarse)!==null&&m!==void 0?m:15,ie=(v=n?.fine)!==null&&v!==void 0?v:5;p.useEffect(()=>{if(r||K==null)return;const ce=w.current;Q(ce,"Element ref not attached");let E=!1;return yP(N,ce,x,{coarse:V,fine:ie},(R,A,O)=>{if(!A){I("inactive");return}switch(R){case"down":{I("drag"),E=!1,Q(O,'Expected event to be defined for "down" action'),_(N,O);const{onDragging:T,onPointerDown:L}=S.current;T?.(!0),L?.();break}case"move":{const{state:T}=se.current;E=!0,T!=="drag"&&I("hover"),Q(O,'Expected event to be defined for "move" action'),K(O);break}case"up":{I("hover"),j();const{onClick:T,onDragging:L,onPointerUp:ne}=S.current;L?.(!1),ne?.(),E||T?.();break}}})},[V,x,r,ie,C,N,K,_,j]),jP({disabled:r,handleId:N,resizeHandler:K,panelGroupElement:U});const ue={touchAction:"none",userSelect:"none"};return p.createElement(g,{...y,children:t,className:e,id:o,onBlur:()=>{D(!1),s?.()},onFocus:()=>{D(!0),l?.()},ref:w,role:"separator",style:{...ue,...d},tabIndex:f,[ye.groupDirection]:x,[ye.groupId]:k,[ye.resizeHandle]:"",[ye.resizeHandleActive]:H==="drag"?"pointer":re?"keyboard":void 0,[ye.resizeHandleEnabled]:!r,[ye.resizeHandleId]:N,[ye.resizeHandleState]:H})}ma.displayName="PanelResizeHandle";const $P=$g(()=>Ft(()=>import("./JsonRoomEditor-CnM0g8OX.js").then(t=>t.J),__vite__mapDeps([8,1,2,6,9]))),zP=p.lazy($P),NP=()=>{sP();const t=h.jsx("div",{className:"flex h-full items-center justify-center bg-pureBlack",children:h.jsx("span",{className:"sprite texture-animated-head_walking_right"})});return h.jsx(h.Fragment,{children:h.jsx(qa,{children:h.jsxs(Dp,{direction:"horizontal",className:"w-full h-full",children:[h.jsx(Uo,{id:"jsonEditor",defaultSize:18,minSize:12,collapsible:!0,children:h.jsx(p.Suspense,{fallback:t,children:h.jsx(zP,{})})}),h.jsx(ma,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-r-[calc(1px*var(--scale))] border-metallicBlue"}),h.jsx(Uo,{id:"editingArea",children:h.jsx(bC,{children:h.jsx(vC,{children:h.jsx(oP,{})})})}),h.jsx(ma,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-l-[calc(1px*var(--scale))] border-metallicBlue"}),h.jsx(Uo,{id:"toolbar",defaultSize:20,maxSize:33,minSize:10,children:h.jsx(S_,{})})]})})})},JP=Object.freeze(Object.defineProperty({__proto__:null,default:NP},Symbol.toStringTag,{value:"Module"}));export{md as A,fd as C,Jt as F,JP as L,Ta as R,mm as S,yd as V,xm as a,WP as h,me as t,gm as u};
