const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebGPURenderer-D1qgw-5G.js","assets/index-vxEFV4k3.js","assets/index-Ba0mBL6p.css","assets/colorToUniform-KTpA7KSL.js","assets/SharedSystems-DqdqEHM7.js","assets/Graphics-IuJplkND.js","assets/levelEditorSlice-Blx_jxZg.js","assets/WebGLRenderer-CV4-cUay.js","assets/JsonRoomEditor-Dgn-1h_P.js","assets/JsonRoomEditor-Cpm53wG5.css"])))=>i.map(i=>d[i]);
import{x as $p,u as fa,y as Kn,s as zp,a3 as Bu,a4 as Pt,e as pa,E as Nn,a as Np,C as ee,d as Ln,v as Dn,aj as q,D as Ci,ar as Bt,k as Lp,ab as an,t as _t,T as Wr,U as Dp,M as Mp,as as Gr,V as Fu,at as Bp,w as Pi,au as Fp,av as Up,j as Hp,aw as vr,ax as f,ay as Uu,az as Ft,aA as g,aB as Wp,aC as Hu,aD as Gp,aE as qp,aF as pe,aG as pt,aH as Wu,aI as Vp,aJ as Kp,aK as M,aL as We,aM as ln,aN as Xp,aO as Jp,aP as Yp,aQ as Gu,aR as le,N as B,aS as Et,aT as Zp,_ as Bo,Z as Kt,aU as Qp,aV as eg,aW as io,aX as ke,aY as ts,aZ as lr,A as qu,a_ as Xn,J as cn,a$ as tg,b0 as rg,K as Ut,b1 as cr,b2 as Vu,b3 as Qe,b4 as ng,I as og,$ as rs,b5 as ga,b6 as ma,b7 as On,Q as Qr,b8 as sg,b9 as Ku,ba as In,bb as ya,bc as ig,bd as va,be as ag,bf as wr,bg as lg,bh as cg,bi as wa,bj as Eo,bk as fl,bl as ug,bm as dg,bn as hg,bo as ba,bp as fg,W as pg,z as ks,L as gg,bq as Xu,br as un,bs as mg,bt as yg,bu as vg,bv as wg,bw as bg,bx as xg,by as _g,bz as Sg,bA as kg,bB as Cg,bC as Pg,bD as Eg}from"./index-vxEFV4k3.js";import{r as Ag,u as be,d as Ju,c as Tg,s as ar,a as Ht,b as Rg,e as pl,f as Og,g as Ig,h as jg,i as $g,j as Yu,k as Zu,l as zg,m as Fo,n as Ng,o as Lg,p as Qu,q as Cs,t as Dg,v as Mg,w as Ei,x as Q,y as Jn,z as dr,A as ed,B as xa,C as X,D as we,E as Bg,F as Fg,G as _a,H as Mn,I as Bn,J as Ug,K as Sa,L as td,M as rd,N as Ps,O as Hg,P as gl,Q as nd,R as Wg,S as Ao,T as Gg,U as qg,V as ml,W as Vg,X as Es,Y as Kg,Z as od,_ as yl,$ as Xg,a0 as Jg,a1 as Yg}from"./levelEditorSlice-Blx_jxZg.js";import{S as Zg,G as lt}from"./Graphics-IuJplkND.js";var ao={},vl;function Qg(){if(vl)return ao;vl=1;var t=$p(),e=t.mark(s),r=fa(),n=r.wrapWithIterableIterator,o=r.ensureIterable;function s(){var a,l,c,u,d,h,p=arguments;return t.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:for(a=p.length,l=new Array(a),c=0;c<a;c++)l[c]=p[c];u=0,d=l;case 2:if(!(u<d.length)){m.next=8;break}return h=d[u],m.delegateYield(o(h),"t0",5);case 5:u++,m.next=2;break;case 8:case"end":return m.stop()}},e)}ao.__concat=s;var i=n(s);return ao.concat=i,ao}var lo={},wl;function em(){if(wl)return lo;wl=1;var t=fa(),e=t.iterableCurry,r=Ag(),n=r.__firstOr,o=Symbol("none");function s(a){return n(a,o)===o}lo.__isEmpty=s;var i=e(s,{reduces:!0});return lo.isEmpty=i,lo}var co={},bl;function tm(){if(bl)return co;bl=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,p=!1,y;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return h=v.done,v},e:function(v){p=!0,y=v},f:function(){try{!h&&c.return!=null&&c.return()}finally{if(p)throw y}}}}function e(a,l){if(a){if(typeof a=="string")return r(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return r(a,l)}}function r(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var n=fa(),o=n.ensureIterable;function s(a){var l=o(a),c=0,u=t(l),d;try{for(u.s();!(d=u.n()).done;){var h=d.value;c++}}catch(p){u.e(p)}finally{u.f()}return c}co.__size=s;var i=s;return co.size=i,co}var As,xl;function rm(){return xl||(xl=1,As=Qg().concat),As}var nm=rm();const _l=Kn(nm);var Ts,Sl;function om(){return Sl||(Sl=1,Ts=em().isEmpty),Ts}var sm=om();const ka=Kn(sm);var Rs,kl;function im(){return kl||(kl=1,Rs=tm().size),Rs}var am=im();const sd=Kn(am),id=class Ai extends zp{constructor(e){e={...Ai.defaultOptions,...e},super(e),this.enabled=!0,this._state=Zg.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(e,r,n,o){e.applyFilter(this,r,n,o)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:r,gl:n,...o}=e;let s,i;return r&&(s=Bu.from(r)),n&&(i=Pt.from(n)),new Ai({gpuProgram:s,glProgram:i,...o})}};id.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let Xt=id;const Ti=[];pa.handleByNamedList(Nn.Environment,Ti);async function lm(t){if(!t)for(let e=0;e<Ti.length;e++){const r=Ti[e];if(r.value.test()){await r.value.load();return}}}let yn;function cm(){if(typeof yn=="boolean")return yn;try{yn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{yn=!1}return yn}var ad=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(ad||{});class um{constructor(e){this.items=[],this._name=e}emit(e,r,n,o,s,i,a,l){const{name:c,items:u}=this;for(let d=0,h=u.length;d<h;d++)u[d][c](e,r,n,o,s,i,a,l);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const r=this.items.indexOf(e);return r!==-1&&this.items.splice(r,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const dm=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],ld=class cd extends Np{constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;const r=[...dm,...this.config.runners??[]];this._addRunners(...r),this._unsafeEvalCheck()}async init(e={}){const r=e.skipExtensionImports===!0?!0:e.manageImports===!1;await lm(r),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const n in this._systemsHash)e={...this._systemsHash[n].constructor.defaultOptions,...e};e={...cd.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let n=0;n<this.runners.init.items.length;n++)await this.runners.init.items[n].init(e);this._initOptions=e}render(e,r){let n=e;if(n instanceof ee&&(n={container:n},r&&(Ln(Dn,"passing a second argument is deprecated, please use render options instead"),n.target=r.renderTexture)),n.target||(n.target=this.view.renderTarget),n.target===this.view.renderTarget&&(this._lastObjectRendered=n.container,n.clearColor??(n.clearColor=this.background.colorRgba),n.clear??(n.clear=this.background.clearBeforeRender)),n.clearColor){const o=Array.isArray(n.clearColor)&&n.clearColor.length===4;n.clearColor=o?n.clearColor:q.shared.setValue(n.clearColor).toArray()}n.transform||(n.container.updateLocalTransform(),n.transform=n.container.localTransform),n.container.enableRenderGroup(),this.runners.prerender.emit(n),this.runners.renderStart.emit(n),this.runners.render.emit(n),this.runners.renderEnd.emit(n),this.runners.postrender.emit(n)}resize(e,r,n){const o=this.view.resolution;this.view.resize(e,r,n),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),n!==void 0&&n!==o&&this.runners.resolutionChange.emit(n)}clear(e={}){const r=this;e.target||(e.target=r.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=ad.ALL);const{clear:n,clearColor:o,target:s}=e;q.shared.setValue(o??this.background.colorRgba),r.renderTarget.clear(s,n,q.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(r=>{this.runners[r]=new um(r)})}_addSystems(e){let r;for(r in e){const n=e[r];this._addSystem(n.value,n.name)}}_addSystem(e,r){const n=new e(this);if(this[r])throw new Error(`Whoops! The name "${r}" is already in use`);this[r]=n,this._systemsHash[r]=n;for(const o in this.runners)this.runners[o].add(n);return this}_addPipes(e,r){const n=r.reduce((o,s)=>(o[s.name]=s.value,o),{});e.forEach(o=>{const s=o.value,i=o.name,a=n[i];this.renderPipes[i]=new s(this,a?new a:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(r=>{r.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!cm())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};ld.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let ud=ld,uo;function hm(t){return uo!==void 0||(uo=(()=>{const e={stencil:!0,failIfMajorPerformanceCaveat:t??ud.defaultOptions.failIfMajorPerformanceCaveat};try{if(!Ci.get().getWebGLRenderingContext())return!1;let n=Ci.get().createCanvas().getContext("webgl",e);const o=!!n?.getContextAttributes()?.stencil;if(n){const s=n.getExtension("WEBGL_lose_context");s&&s.loseContext()}return n=null,o}catch{return!1}})()),uo}let ho;async function fm(t={}){return ho!==void 0||(ho=await(async()=>{const e=Ci.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(t)).requestDevice(),!0}catch{return!1}})()),ho}const Cl=["webgl","webgpu","canvas"];async function pm(t){let e=[];t.preference?(e.push(t.preference),Cl.forEach(s=>{s!==t.preference&&e.push(s)})):e=Cl.slice();let r,n={};for(let s=0;s<e.length;s++){const i=e[s];if(i==="webgpu"&&await fm()){const{WebGPURenderer:a}=await Bt(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-D1qgw-5G.js");return{WebGPURenderer:l}},__vite__mapDeps([0,1,2,3,4,5,6]));r=a,n={...t,...t.webgpu};break}else if(i==="webgl"&&hm(t.failIfMajorPerformanceCaveat??ud.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await Bt(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-CV4-cUay.js");return{WebGLRenderer:l}},__vite__mapDeps([7,1,2,3,4,5,6]));r=a,n={...t,...t.webgl};break}else if(i==="canvas")throw n={...t},new Error("CanvasRenderer is not yet implemented")}if(delete n.webgpu,delete n.webgl,!r)throw new Error("No available renderer for the current environment");const o=new r;return await o.init(n),o}const dd="8.8.1";class hd{static init(){globalThis.__PIXI_APP_INIT__?.(this,dd)}static destroy(){}}hd.extension=Nn.Application;class gm{constructor(e){this._renderer=e}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,dd)}destroy(){this._renderer=null}}gm.extension={type:[Nn.WebGLSystem,Nn.WebGPUSystem],name:"initHook",priority:-10};const fd=class Ri{constructor(...e){this.stage=new ee,e[0]!==void 0&&Ln(Dn,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await pm(e),Ri._plugins.forEach(r=>{r.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return Ln(Dn,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,r=!1){const n=Ri._plugins.slice(0);n.reverse(),n.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(r),this.stage=null,this.renderer.destroy(e),this.renderer=null}};fd._plugins=[];let pd=fd;pa.handleByList(Nn.Application,pd._plugins);pa.add(hd);var mm=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,ym=`
in vec2 vTextureCoord;

out vec4 finalColor;

uniform float uAlpha;
uniform sampler2D uTexture;

void main()
{
    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;
}
`,Pl=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
 
    var sample = textureSample(uTexture, uSampler, uv);
    
    return sample * alphaUniforms.uAlpha;
}`;const gd=class md extends Xt{constructor(e){e={...md.defaultOptions,...e};const r=Bu.from({vertex:{source:Pl,entryPoint:"mainVertex"},fragment:{source:Pl,entryPoint:"mainFragment"}}),n=Pt.from({vertex:mm,fragment:ym,name:"alpha-filter"}),{alpha:o,...s}=e,i=new Lp({uAlpha:{value:o,type:"f32"}});super({...s,gpuProgram:r,glProgram:n,resources:{alphaUniforms:i}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(e){this.resources.alphaUniforms.uniforms.uAlpha=e}};gd.defaultOptions={alpha:1};let vm=gd;class Fn extends an{constructor(...e){let r=e[0];Array.isArray(e[0])&&(r={textures:e[0],autoUpdate:e[1]});const{animationSpeed:n=1,autoPlay:o=!1,autoUpdate:s=!0,loop:i=!0,onComplete:a=null,onFrameChange:l=null,onLoop:c=null,textures:u,updateAnchor:d=!1,...h}=r,[p]=u;super({...h,texture:p instanceof _t?p:p.texture}),this._textures=null,this._durations=null,this._autoUpdate=s,this._isConnectedToTicker=!1,this.animationSpeed=n,this.loop=i,this.updateAnchor=d,this.onComplete=a,this.onFrameChange=l,this.onLoop=c,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=u,o&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Wr.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Wr.shared.add(this.update,this,Dp.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const r=e.deltaTime,n=this.animationSpeed*r,o=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=n/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*r);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=n;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o||this.animationSpeed<0&&this.currentFrame>o)&&this.onLoop(),this._updateTexture())}_updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const r=[];for(let n=0;n<e.length;++n)r.push(_t.from(e[n]));return new Fn(r)}static fromImages(e){const r=[];for(let n=0;n<e.length;++n)r.push(_t.from(e[n]));return new Fn(r)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof _t)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let r=0;r<e.length;r++)this._textures.push(e[r].texture),this._durations.push(e[r].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const r=this.currentFrame;this._currentTime=e,r!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Wr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Wr.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class wm{constructor({matrix:e,observer:r}={}){this.dirty=!0,this._matrix=e??new Mp,this.observer=r,this.position=new Gr(this,0,0),this.scale=new Gr(this,1,1),this.pivot=new Gr(this,0,0),this.skew=new Gr(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}_onUpdate(e){this.dirty=!0,e===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}}const yd=class To extends Fu{constructor(...e){let r=e[0]||{};r instanceof _t&&(r={texture:r}),e.length>1&&(Ln(Dn,"use new TilingSprite({ texture, width:100, height:100 }) instead"),r.width=e[1],r.height=e[2]),r={...To.defaultOptions,...r};const{texture:n,anchor:o,tilePosition:s,tileScale:i,tileRotation:a,width:l,height:c,applyAnchorToTexture:u,roundPixels:d,...h}=r??{};super({label:"TilingSprite",...h}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new Gr({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=u,this.texture=n,this._width=l??n.width,this._height=c??n.height,this._tileTransform=new wm({observer:{_onUpdate:()=>this.onViewUpdate()}}),o&&(this.anchor=o),this.tilePosition=s,this.tileScale=i,this.tileRotation=a,this.roundPixels=d??!1}static from(e,r={}){return typeof e=="string"?new To({texture:Bp.get(e),...r}):new To({texture:e,...r})}get uvRespectAnchor(){return Pi("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){Pi("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){typeof e=="number"?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=_t.EMPTY);const r=this._texture;r!==e&&(r&&r.dynamic&&r.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,r){typeof e=="object"&&(r=e.height??e.width,e=e.width),this._width=e,this._height=r??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){const e=this._bounds,r=this._anchor,n=this._width,o=this._height;e.minX=-r._x*n,e.maxX=e.minX+n,e.minY=-r._y*o,e.maxY=e.minY+o}containsPoint(e){const r=this._width,n=this._height,o=-r*this._anchor._x;let s=0;return e.x>=o&&e.x<=o+r&&(s=-n*this._anchor._y,e.y>=s&&e.y<=s+n)}destroy(e=!1){if(super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof e=="boolean"?e:e?.texture){const n=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(n)}this._texture=null}};yd.defaultOptions={texture:_t.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let bm=yd;class xm extends Fu{constructor(e,r){const{text:n,resolution:o,style:s,anchor:i,width:a,height:l,roundPixels:c,...u}=e;super({...u}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=r,this.text=n??"",this.style=s,this.resolution=o??null,this.allowChildren=!1,this._anchor=new Gr({_onUpdate:()=>{this.onViewUpdate()}}),i&&(this.anchor=i),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){e||(e={}),this._style?.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,r){typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,this.bounds.width),r!==void 0&&this._setHeight(r,this.bounds.height)}containsPoint(e){const r=this.bounds.width,n=this.bounds.height,o=-r*this.anchor.x;let s=0;return e.x>=o&&e.x<=o+r&&(s=-n*this.anchor.y,e.y>=s&&e.y<=s+n)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e?.style)&&this._style.destroy(e),this._style=null,this._text=null}}function _m(t,e){let r=t[0]??{};return(typeof r=="string"||t[1])&&(Ln(Dn,`use new ${e}({ text: "hi!", style }) instead`),r={text:r,style:t[1]}),r}class Sm extends xm{constructor(...e){const r=_m(e,"Text");super(r,Fp),this.renderPipeId="text"}updateBounds(){const e=this._bounds,r=this._anchor,n=Up.measureText(this._text,this._style),{width:o,height:s}=n;e.minX=-r._x*o,e.maxX=e.minX+o,e.minY=-r._y*s,e.maxY=e.minY+s}}class Ca extends _t{static create(e){return new Ca({source:new Hp(e)})}resize(e,r,n){return this.source.resize(e,r,n),this}}const vd=class wd extends ee{constructor(e={}){e={...wd.defaultOptions,...e},super(),this.renderLayerChildren=[],this.sortableChildren=e.sortableChildren,this.sortFunction=e.sortFunction}attach(...e){for(let r=0;r<e.length;r++){const n=e[r];if(n.parentRenderLayer){if(n.parentRenderLayer===this)continue;n.parentRenderLayer.detach(n)}this.renderLayerChildren.push(n),n.parentRenderLayer=this;const o=this.renderGroup||this.parentRenderGroup;o&&(o.structureDidChange=!0)}return e[0]}detach(...e){for(let r=0;r<e.length;r++){const n=e[r],o=this.renderLayerChildren.indexOf(n);o!==-1&&this.renderLayerChildren.splice(o,1),n.parentRenderLayer=null;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)}return e[0]}detachAll(){const e=this.renderLayerChildren;for(let r=0;r<e.length;r++)e[r].parentRenderLayer=null;this.renderLayerChildren.length=0}collectRenderables(e,r,n){const o=this.renderLayerChildren,s=o.length;this.sortableChildren&&this.sortRenderLayerChildren();for(let i=0;i<s;i++)o[i].parent||Pi("Container must be added to both layer and scene graph. Layers only handle render order - the scene graph is required for transforms (addChild)",o[i]),o[i].collectRenderables(e,r,this)}sortRenderLayerChildren(){this.renderLayerChildren.sort(this.sortFunction)}_getGlobalBoundsRecursive(e,r,n){if(!e)return;const o=this.renderLayerChildren;for(let s=0;s<o.length;s++)o[s]._getGlobalBoundsRecursive(!0,r,this)}};vd.defaultOptions={sortableChildren:!1,sortFunction:(t,e)=>t.zIndex-e.zIndex};let km=vd;const El=km,Pa="-",Cm=t=>{const e=Em(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:i=>{const a=i.split(Pa);return a[0]===""&&a.length!==1&&a.shift(),bd(a,e)||Pm(i)},getConflictingClassGroupIds:(i,a)=>{const l=r[i]||[];return a&&n[i]?[...l,...n[i]]:l}}},bd=(t,e)=>{if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),o=n?bd(t.slice(1),n):void 0;if(o)return o;if(e.validators.length===0)return;const s=t.join(Pa);return e.validators.find(({validator:i})=>i(s))?.classGroupId},Al=/^\[(.+)\]$/,Pm=t=>{if(Al.test(t)){const e=Al.exec(t)[1],r=e?.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},Em=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return Tm(Object.entries(t.classGroups),r).forEach(([s,i])=>{Oi(i,n,s,e)}),n},Oi=(t,e,r,n)=>{t.forEach(o=>{if(typeof o=="string"){const s=o===""?e:Tl(e,o);s.classGroupId=r;return}if(typeof o=="function"){if(Am(o)){Oi(o(n),e,r,n);return}e.validators.push({validator:o,classGroupId:r});return}Object.entries(o).forEach(([s,i])=>{Oi(i,Tl(e,s),r,n)})})},Tl=(t,e)=>{let r=t;return e.split(Pa).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},Am=t=>t.isThemeGetter,Tm=(t,e)=>e?t.map(([r,n])=>{const o=n.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([i,a])=>[e+i,a])):s);return[r,o]}):t,Rm=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const o=(s,i)=>{r.set(s,i),e++,e>t&&(e=0,n=r,r=new Map)};return{get(s){let i=r.get(s);if(i!==void 0)return i;if((i=n.get(s))!==void 0)return o(s,i),i},set(s,i){r.has(s)?r.set(s,i):o(s,i)}}},xd="!",Om=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,o=e[0],s=e.length,i=a=>{const l=[];let c=0,u=0,d;for(let v=0;v<a.length;v++){let w=a[v];if(c===0){if(w===o&&(n||a.slice(v,v+s)===e)){l.push(a.slice(u,v)),u=v+s;continue}if(w==="/"){d=v;continue}}w==="["?c++:w==="]"&&c--}const h=l.length===0?a:a.substring(u),p=h.startsWith(xd),y=p?h.substring(1):h,m=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:p,baseClassName:y,maybePostfixModifierPosition:m}};return r?a=>r({className:a,parseClassName:i}):i},Im=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},jm=t=>({cache:Rm(t.cacheSize),parseClassName:Om(t),...Cm(t)}),$m=/\s+/,zm=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:o}=e,s=[],i=t.trim().split($m);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:p}=r(c);let y=!!p,m=n(y?h.substring(0,p):h);if(!m){if(!y){a=c+(a.length>0?" "+a:a);continue}if(m=n(h),!m){a=c+(a.length>0?" "+a:a);continue}y=!1}const v=Im(u).join(":"),w=d?v+xd:v,_=w+m;if(s.includes(_))continue;s.push(_);const b=o(m,y);for(let x=0;x<b.length;++x){const k=b[x];s.push(w+k)}a=c+(a.length>0?" "+a:a)}return a};function Nm(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=_d(e))&&(n&&(n+=" "),n+=r);return n}const _d=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=_d(t[n]))&&(r&&(r+=" "),r+=e);return r};function Lm(t,...e){let r,n,o,s=i;function i(l){const c=e.reduce((u,d)=>d(u),t());return r=jm(c),n=r.cache.get,o=r.cache.set,s=a,a(l)}function a(l){const c=n(l);if(c)return c;const u=zm(l,r);return o(l,u),u}return function(){return s(Nm.apply(null,arguments))}}const ge=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},Sd=/^\[(?:([a-z-]+):)?(.+)\]$/i,Dm=/^\d+\/\d+$/,Mm=new Set(["px","full","screen"]),Bm=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Fm=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Um=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Hm=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Wm=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,mt=t=>Xr(t)||Mm.has(t)||Dm.test(t),At=t=>dn(t,"length",Zm),Xr=t=>!!t&&!Number.isNaN(Number(t)),Os=t=>dn(t,"number",Xr),vn=t=>!!t&&Number.isInteger(Number(t)),Gm=t=>t.endsWith("%")&&Xr(t.slice(0,-1)),Y=t=>Sd.test(t),Tt=t=>Bm.test(t),qm=new Set(["length","size","percentage"]),Vm=t=>dn(t,qm,kd),Km=t=>dn(t,"position",kd),Xm=new Set(["image","url"]),Jm=t=>dn(t,Xm,ey),Ym=t=>dn(t,"",Qm),wn=()=>!0,dn=(t,e,r)=>{const n=Sd.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},Zm=t=>Fm.test(t)&&!Um.test(t),kd=()=>!1,Qm=t=>Hm.test(t),ey=t=>Wm.test(t),ty=()=>{const t=ge("colors"),e=ge("spacing"),r=ge("blur"),n=ge("brightness"),o=ge("borderColor"),s=ge("borderRadius"),i=ge("borderSpacing"),a=ge("borderWidth"),l=ge("contrast"),c=ge("grayscale"),u=ge("hueRotate"),d=ge("invert"),h=ge("gap"),p=ge("gradientColorStops"),y=ge("gradientColorStopPositions"),m=ge("inset"),v=ge("margin"),w=ge("opacity"),_=ge("padding"),b=ge("saturate"),x=ge("scale"),k=ge("sepia"),C=ge("skew"),S=ge("space"),j=ge("translate"),U=()=>["auto","contain","none"],N=()=>["auto","hidden","clip","visible","scroll"],H=()=>["auto",Y,e],I=()=>[Y,e],te=()=>["",mt,At],D=()=>["auto",Xr,Y],K=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],W=()=>["solid","dashed","dotted","double","none"],oe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],V=()=>["start","end","center","between","around","evenly","stretch"],se=()=>["","0",Y],ue=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ce=()=>[Xr,Y];return{cacheSize:500,separator:":",theme:{colors:[wn],spacing:[mt,At],blur:["none","",Tt,Y],brightness:ce(),borderColor:[t],borderRadius:["none","","full",Tt,Y],borderSpacing:I(),borderWidth:te(),contrast:ce(),grayscale:se(),hueRotate:ce(),invert:se(),gap:I(),gradientColorStops:[t],gradientColorStopPositions:[Gm,At],inset:H(),margin:H(),opacity:ce(),padding:I(),saturate:ce(),scale:ce(),sepia:se(),skew:ce(),space:I(),translate:I()},classGroups:{aspect:[{aspect:["auto","square","video",Y]}],container:["container"],columns:[{columns:[Tt]}],"break-after":[{"break-after":ue()}],"break-before":[{"break-before":ue()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...K(),Y]}],overflow:[{overflow:N()}],"overflow-x":[{"overflow-x":N()}],"overflow-y":[{"overflow-y":N()}],overscroll:[{overscroll:U()}],"overscroll-x":[{"overscroll-x":U()}],"overscroll-y":[{"overscroll-y":U()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[m]}],"inset-x":[{"inset-x":[m]}],"inset-y":[{"inset-y":[m]}],start:[{start:[m]}],end:[{end:[m]}],top:[{top:[m]}],right:[{right:[m]}],bottom:[{bottom:[m]}],left:[{left:[m]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",vn,Y]}],basis:[{basis:H()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Y]}],grow:[{grow:se()}],shrink:[{shrink:se()}],order:[{order:["first","last","none",vn,Y]}],"grid-cols":[{"grid-cols":[wn]}],"col-start-end":[{col:["auto",{span:["full",vn,Y]},Y]}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":[wn]}],"row-start-end":[{row:["auto",{span:[vn,Y]},Y]}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Y]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Y]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...V()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...V(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...V(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Y,e]}],"min-w":[{"min-w":[Y,e,"min","max","fit"]}],"max-w":[{"max-w":[Y,e,"none","full","min","max","fit","prose",{screen:[Tt]},Tt]}],h:[{h:[Y,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Y,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Y,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Y,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Tt,At]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Os]}],"font-family":[{font:[wn]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Y]}],"line-clamp":[{"line-clamp":["none",Xr,Os]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",mt,Y]}],"list-image":[{"list-image":["none",Y]}],"list-style-type":[{list:["none","disc","decimal",Y]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...W(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",mt,At]}],"underline-offset":[{"underline-offset":["auto",mt,Y]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Y]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Y]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...K(),Km]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Vm]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Jm]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[...W(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:W()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...W()]}],"outline-offset":[{"outline-offset":[mt,Y]}],"outline-w":[{outline:[mt,At]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:te()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[mt,At]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Tt,Ym]}],"shadow-color":[{shadow:[wn]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":[...oe(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":oe()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Tt,Y]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[b]}],sepia:[{sepia:[k]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[k]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Y]}],duration:[{duration:ce()}],ease:[{ease:["linear","in","out","in-out",Y]}],delay:[{delay:ce()}],animate:[{animate:["none","spin","ping","pulse","bounce",Y]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[x]}],"scale-x":[{"scale-x":[x]}],"scale-y":[{"scale-y":[x]}],rotate:[{rotate:[vn,Y]}],"translate-x":[{"translate-x":[j]}],"translate-y":[{"translate-y":[j]}],"skew-x":[{"skew-x":[C]}],"skew-y":[{"skew-y":[C]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Y]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Y]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Y]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[mt,At,Os]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Cd=Lm(ty);function Pd(t){if(!Uo(t))throw new Error(`Invalid textureId: "${t}"; textureId ∋ {${Object.keys(vr.frames).sort().map(e=>`"${e}"`).join(`,
`)}}`)}function Uo(t){return vr.frames[t]!==void 0}function Ed(t){return vr.animations[t]!==void 0}const ry=t=>t.replaceAll(".","_"),ie=({children:t,className:e,noSlitWords:r,classnameCycle:n,onClick:o,noTint:s=!1,TagName:i="span"})=>{const a=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(a.length===0)return null;const l=r?[a.toUpperCase()]:a.toUpperCase().split(/\s+/);return f.jsxs(i,{className:e,onClick:o,children:[f.jsx("span",{className:"sr-only",children:a}),l.map((c,u)=>f.jsx("span",{className:Cd("text-nowrap inline-block",u===l.length-1?"":"me-1"),children:Array.from(c).map((d,h)=>{const p=`hud.char.${Uu(d)}`;return Uo(p)||console.error("no texture for char",d,d.charCodeAt(0),p,"we have:",Object.keys(Ft().textures)),f.jsx("span",{className:`sprite ${Uo(p)?`texture-${ry(p)}`:"texture-hud_char_?"}
                  ${s?"":"sprite-tinted"}
                  ${n===void 0?"":n[h%n.length]}`},h)})},u))]})};function Me(t,e,{checkForDefaultPrevented:r=!0}={}){return function(o){if(t?.(o),r===!1||!o.defaultPrevented)return e?.(o)}}function Rl(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Ad(...t){return e=>{let r=!1;const n=t.map(o=>{const s=Rl(o,e);return!r&&typeof s=="function"&&(r=!0),s});if(r)return()=>{for(let o=0;o<n.length;o++){const s=n[o];typeof s=="function"?s():Rl(t[o],null)}}}}function nt(...t){return g.useCallback(Ad(...t),t)}function ny(t,e){const r=g.createContext(e),n=s=>{const{children:i,...a}=s,l=g.useMemo(()=>a,Object.values(a));return f.jsx(r.Provider,{value:l,children:i})};n.displayName=t+"Provider";function o(s){const i=g.useContext(r);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[n,o]}function Ea(t,e=[]){let r=[];function n(s,i){const a=g.createContext(i),l=r.length;r=[...r,i];const c=d=>{const{scope:h,children:p,...y}=d,m=h?.[t]?.[l]||a,v=g.useMemo(()=>y,Object.values(y));return f.jsx(m.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(d,h){const p=h?.[t]?.[l]||a,y=g.useContext(p);if(y)return y;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=r.map(i=>g.createContext(i));return function(a){const l=a?.[t]||s;return g.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[n,oy(o,...e)]}function oy(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=n.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return g.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return r.scopeName=e.scopeName,r}var Aa=Wp();const sy=Kn(Aa);var ns=g.forwardRef((t,e)=>{const{children:r,...n}=t,o=g.Children.toArray(r),s=o.find(ay);if(s){const i=s.props.children,a=o.map(l=>l===s?g.Children.count(i)>1?g.Children.only(null):g.isValidElement(i)?i.props.children:null:l);return f.jsx(Ii,{...n,ref:e,children:g.isValidElement(i)?g.cloneElement(i,void 0,a):null})}return f.jsx(Ii,{...n,ref:e,children:r})});ns.displayName="Slot";var Ii=g.forwardRef((t,e)=>{const{children:r,...n}=t;if(g.isValidElement(r)){const o=cy(r),s=ly(n,r.props);return r.type!==g.Fragment&&(s.ref=e?Ad(e,o):o),g.cloneElement(r,s)}return g.Children.count(r)>1?g.Children.only(null):null});Ii.displayName="SlotClone";var iy=({children:t})=>f.jsx(f.Fragment,{children:t});function ay(t){return g.isValidElement(t)&&t.type===iy}function ly(t,e){const r={...e};for(const n in e){const o=t[n],s=e[n];/^on[A-Z]/.test(n)?o&&s?r[n]=(...a)=>{s(...a),o(...a)}:o&&(r[n]=o):n==="style"?r[n]={...o,...s}:n==="className"&&(r[n]=[o,s].filter(Boolean).join(" "))}return{...t,...r}}function cy(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var uy=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ve=uy.reduce((t,e)=>{const r=g.forwardRef((n,o)=>{const{asChild:s,...i}=n,a=s?ns:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),f.jsx(a,{...i,ref:o})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function dy(t,e){t&&Aa.flushSync(()=>t.dispatchEvent(e))}function Wt(t){const e=g.useRef(t);return g.useEffect(()=>{e.current=t}),g.useMemo(()=>(...r)=>e.current?.(...r),[])}function hy(t,e=globalThis?.document){const r=Wt(t);g.useEffect(()=>{const n=o=>{o.key==="Escape"&&r(o)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[r,e])}var fy="DismissableLayer",ji="dismissableLayer.update",py="dismissableLayer.pointerDownOutside",gy="dismissableLayer.focusOutside",Ol,Td=g.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ta=g.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=g.useContext(Td),[u,d]=g.useState(null),h=u?.ownerDocument??globalThis?.document,[,p]=g.useState({}),y=nt(e,S=>d(S)),m=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),w=m.indexOf(v),_=u?m.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,x=_>=w,k=vy(S=>{const j=S.target,U=[...c.branches].some(N=>N.contains(j));!x||U||(o?.(S),i?.(S),S.defaultPrevented||a?.())},h),C=wy(S=>{const j=S.target;[...c.branches].some(N=>N.contains(j))||(s?.(S),i?.(S),S.defaultPrevented||a?.())},h);return hy(S=>{_===c.layers.size-1&&(n?.(S),!S.defaultPrevented&&a&&(S.preventDefault(),a()))},h),g.useEffect(()=>{if(u)return r&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Ol=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),Il(),()=>{r&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=Ol)}},[u,h,r,c]),g.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),Il())},[u,c]),g.useEffect(()=>{const S=()=>p({});return document.addEventListener(ji,S),()=>document.removeEventListener(ji,S)},[]),f.jsx(ve.div,{...l,ref:y,style:{pointerEvents:b?x?"auto":"none":void 0,...t.style},onFocusCapture:Me(t.onFocusCapture,C.onFocusCapture),onBlurCapture:Me(t.onBlurCapture,C.onBlurCapture),onPointerDownCapture:Me(t.onPointerDownCapture,k.onPointerDownCapture)})});Ta.displayName=fy;var my="DismissableLayerBranch",yy=g.forwardRef((t,e)=>{const r=g.useContext(Td),n=g.useRef(null),o=nt(e,n);return g.useEffect(()=>{const s=n.current;if(s)return r.branches.add(s),()=>{r.branches.delete(s)}},[r.branches]),f.jsx(ve.div,{...t,ref:o})});yy.displayName=my;function vy(t,e=globalThis?.document){const r=Wt(t),n=g.useRef(!1),o=g.useRef(()=>{});return g.useEffect(()=>{const s=a=>{if(a.target&&!n.current){let l=function(){Rd(py,r,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);n.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,r]),{onPointerDownCapture:()=>n.current=!0}}function wy(t,e=globalThis?.document){const r=Wt(t),n=g.useRef(!1);return g.useEffect(()=>{const o=s=>{s.target&&!n.current&&Rd(gy,r,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function Il(){const t=new CustomEvent(ji);document.dispatchEvent(t)}function Rd(t,e,r,{discrete:n}){const o=r.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&o.addEventListener(t,e,{once:!0}),n?dy(o,s):o.dispatchEvent(s)}var Is=0;function Od(){g.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??jl()),document.body.insertAdjacentElement("beforeend",t[1]??jl()),Is++,()=>{Is===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Is--}},[])}function jl(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var js="focusScope.autoFocusOnMount",$s="focusScope.autoFocusOnUnmount",$l={bubbles:!1,cancelable:!0},by="FocusScope",Ra=g.forwardRef((t,e)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=t,[a,l]=g.useState(null),c=Wt(o),u=Wt(s),d=g.useRef(null),h=nt(e,m=>l(m)),p=g.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;g.useEffect(()=>{if(n){let m=function(b){if(p.paused||!a)return;const x=b.target;a.contains(x)?d.current=x:$t(d.current,{select:!0})},v=function(b){if(p.paused||!a)return;const x=b.relatedTarget;x!==null&&(a.contains(x)||$t(d.current,{select:!0}))},w=function(b){if(document.activeElement===document.body)for(const k of b)k.removedNodes.length>0&&$t(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",v);const _=new MutationObserver(w);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",v),_.disconnect()}}},[n,a,p.paused]),g.useEffect(()=>{if(a){Nl.add(p);const m=document.activeElement;if(!a.contains(m)){const w=new CustomEvent(js,$l);a.addEventListener(js,c),a.dispatchEvent(w),w.defaultPrevented||(xy(Py(Id(a)),{select:!0}),document.activeElement===m&&$t(a))}return()=>{a.removeEventListener(js,c),setTimeout(()=>{const w=new CustomEvent($s,$l);a.addEventListener($s,u),a.dispatchEvent(w),w.defaultPrevented||$t(m??document.body,{select:!0}),a.removeEventListener($s,u),Nl.remove(p)},0)}}},[a,c,u,p]);const y=g.useCallback(m=>{if(!r&&!n||p.paused)return;const v=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,w=document.activeElement;if(v&&w){const _=m.currentTarget,[b,x]=_y(_);b&&x?!m.shiftKey&&w===x?(m.preventDefault(),r&&$t(b,{select:!0})):m.shiftKey&&w===b&&(m.preventDefault(),r&&$t(x,{select:!0})):w===_&&m.preventDefault()}},[r,n,p.paused]);return f.jsx(ve.div,{tabIndex:-1,...i,ref:h,onKeyDown:y})});Ra.displayName=by;function xy(t,{select:e=!1}={}){const r=document.activeElement;for(const n of t)if($t(n,{select:e}),document.activeElement!==r)return}function _y(t){const e=Id(t),r=zl(e,t),n=zl(e.reverse(),t);return[r,n]}function Id(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const o=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||o?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function zl(t,e){for(const r of t)if(!Sy(r,{upTo:e}))return r}function Sy(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function ky(t){return t instanceof HTMLInputElement&&"select"in t}function $t(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&ky(t)&&e&&t.select()}}var Nl=Cy();function Cy(){let t=[];return{add(e){const r=t[0];e!==r&&r?.pause(),t=Ll(t,e),t.unshift(e)},remove(e){t=Ll(t,e),t[0]?.resume()}}}function Ll(t,e){const r=[...t],n=r.indexOf(e);return n!==-1&&r.splice(n,1),r}function Py(t){return t.filter(e=>e.tagName!=="A")}var hr=globalThis?.document?g.useLayoutEffect:()=>{},Ey=Hu.useId||(()=>{}),Ay=0;function ct(t){const[e,r]=g.useState(Ey());return hr(()=>{r(n=>n??String(Ay++))},[t]),t||(e?`radix-${e}`:"")}const Ty=["top","right","bottom","left"],Gt=Math.min,De=Math.max,Ho=Math.round,fo=Math.floor,ut=t=>({x:t,y:t}),Ry={left:"right",right:"left",bottom:"top",top:"bottom"},Oy={start:"end",end:"start"};function $i(t,e,r){return De(t,Gt(e,r))}function St(t,e){return typeof t=="function"?t(e):t}function kt(t){return t.split("-")[0]}function hn(t){return t.split("-")[1]}function Oa(t){return t==="x"?"y":"x"}function Ia(t){return t==="y"?"height":"width"}function qt(t){return["top","bottom"].includes(kt(t))?"y":"x"}function ja(t){return Oa(qt(t))}function Iy(t,e,r){r===void 0&&(r=!1);const n=hn(t),o=ja(t),s=Ia(o);let i=o==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(i=Wo(i)),[i,Wo(i)]}function jy(t){const e=Wo(t);return[zi(t),e,zi(e)]}function zi(t){return t.replace(/start|end/g,e=>Oy[e])}function $y(t,e,r){const n=["left","right"],o=["right","left"],s=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return r?e?o:n:e?n:o;case"left":case"right":return e?s:i;default:return[]}}function zy(t,e,r,n){const o=hn(t);let s=$y(kt(t),r==="start",n);return o&&(s=s.map(i=>i+"-"+o),e&&(s=s.concat(s.map(zi)))),s}function Wo(t){return t.replace(/left|right|bottom|top/g,e=>Ry[e])}function Ny(t){return{top:0,right:0,bottom:0,left:0,...t}}function jd(t){return typeof t!="number"?Ny(t):{top:t,right:t,bottom:t,left:t}}function Go(t){const{x:e,y:r,width:n,height:o}=t;return{width:n,height:o,top:r,left:e,right:e+n,bottom:r+o,x:e,y:r}}function Dl(t,e,r){let{reference:n,floating:o}=t;const s=qt(e),i=ja(e),a=Ia(i),l=kt(e),c=s==="y",u=n.x+n.width/2-o.width/2,d=n.y+n.height/2-o.height/2,h=n[a]/2-o[a]/2;let p;switch(l){case"top":p={x:u,y:n.y-o.height};break;case"bottom":p={x:u,y:n.y+n.height};break;case"right":p={x:n.x+n.width,y:d};break;case"left":p={x:n.x-o.width,y:d};break;default:p={x:n.x,y:n.y}}switch(hn(e)){case"start":p[i]-=h*(r&&c?-1:1);break;case"end":p[i]+=h*(r&&c?-1:1);break}return p}const Ly=async(t,e,r)=>{const{placement:n="bottom",strategy:o="absolute",middleware:s=[],platform:i}=r,a=s.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:o}),{x:u,y:d}=Dl(c,n,l),h=n,p={},y=0;for(let m=0;m<a.length;m++){const{name:v,fn:w}=a[m],{x:_,y:b,data:x,reset:k}=await w({x:u,y:d,initialPlacement:n,placement:h,strategy:o,middlewareData:p,rects:c,platform:i,elements:{reference:t,floating:e}});u=_??u,d=b??d,p={...p,[v]:{...p[v],...x}},k&&y<=50&&(y++,typeof k=="object"&&(k.placement&&(h=k.placement),k.rects&&(c=k.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:o}):k.rects),{x:u,y:d}=Dl(c,h,l)),m=-1)}return{x:u,y:d,placement:h,strategy:o,middlewareData:p}};async function Un(t,e){var r;e===void 0&&(e={});const{x:n,y:o,platform:s,rects:i,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=St(e,t),y=jd(p),v=a[h?d==="floating"?"reference":"floating":d],w=Go(await s.getClippingRect({element:(r=await(s.isElement==null?void 0:s.isElement(v)))==null||r?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),_=d==="floating"?{x:n,y:o,width:i.floating.width,height:i.floating.height}:i.reference,b=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),x=await(s.isElement==null?void 0:s.isElement(b))?await(s.getScale==null?void 0:s.getScale(b))||{x:1,y:1}:{x:1,y:1},k=Go(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:b,strategy:l}):_);return{top:(w.top-k.top+y.top)/x.y,bottom:(k.bottom-w.bottom+y.bottom)/x.y,left:(w.left-k.left+y.left)/x.x,right:(k.right-w.right+y.right)/x.x}}const Dy=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:n,placement:o,rects:s,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=St(t,e)||{};if(c==null)return{};const d=jd(u),h={x:r,y:n},p=ja(o),y=Ia(p),m=await i.getDimensions(c),v=p==="y",w=v?"top":"left",_=v?"bottom":"right",b=v?"clientHeight":"clientWidth",x=s.reference[y]+s.reference[p]-h[p]-s.floating[y],k=h[p]-s.reference[p],C=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let S=C?C[b]:0;(!S||!await(i.isElement==null?void 0:i.isElement(C)))&&(S=a.floating[b]||s.floating[y]);const j=x/2-k/2,U=S/2-m[y]/2-1,N=Gt(d[w],U),H=Gt(d[_],U),I=N,te=S-m[y]-H,D=S/2-m[y]/2+j,K=$i(I,D,te),W=!l.arrow&&hn(o)!=null&&D!==K&&s.reference[y]/2-(D<I?N:H)-m[y]/2<0,oe=W?D<I?D-I:D-te:0;return{[p]:h[p]+oe,data:{[p]:K,centerOffset:D-K-oe,...W&&{alignmentOffset:oe}},reset:W}}}),My=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,n;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:m=!0,...v}=St(t,e);if((r=s.arrow)!=null&&r.alignmentOffset)return{};const w=kt(o),_=qt(a),b=kt(a)===a,x=await(l.isRTL==null?void 0:l.isRTL(c.floating)),k=h||(b||!m?[Wo(a)]:jy(a)),C=y!=="none";!h&&C&&k.push(...zy(a,m,y,x));const S=[a,...k],j=await Un(e,v),U=[];let N=((n=s.flip)==null?void 0:n.overflows)||[];if(u&&U.push(j[w]),d){const D=Iy(o,i,x);U.push(j[D[0]],j[D[1]])}if(N=[...N,{placement:o,overflows:U}],!U.every(D=>D<=0)){var H,I;const D=(((H=s.flip)==null?void 0:H.index)||0)+1,K=S[D];if(K)return{data:{index:D,overflows:N},reset:{placement:K}};let W=(I=N.filter(oe=>oe.overflows[0]<=0).sort((oe,V)=>oe.overflows[1]-V.overflows[1])[0])==null?void 0:I.placement;if(!W)switch(p){case"bestFit":{var te;const oe=(te=N.filter(V=>{if(C){const se=qt(V.placement);return se===_||se==="y"}return!0}).map(V=>[V.placement,V.overflows.filter(se=>se>0).reduce((se,ue)=>se+ue,0)]).sort((V,se)=>V[1]-se[1])[0])==null?void 0:te[0];oe&&(W=oe);break}case"initialPlacement":W=a;break}if(o!==W)return{reset:{placement:W}}}return{}}}};function Ml(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Bl(t){return Ty.some(e=>t[e]>=0)}const By=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:n="referenceHidden",...o}=St(t,e);switch(n){case"referenceHidden":{const s=await Un(e,{...o,elementContext:"reference"}),i=Ml(s,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:Bl(i)}}}case"escaped":{const s=await Un(e,{...o,altBoundary:!0}),i=Ml(s,r.floating);return{data:{escapedOffsets:i,escaped:Bl(i)}}}default:return{}}}}};async function Fy(t,e){const{placement:r,platform:n,elements:o}=t,s=await(n.isRTL==null?void 0:n.isRTL(o.floating)),i=kt(r),a=hn(r),l=qt(r)==="y",c=["left","top"].includes(i)?-1:1,u=s&&l?-1:1,d=St(e,t);let{mainAxis:h,crossAxis:p,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof y=="number"&&(p=a==="end"?y*-1:y),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}const Uy=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,n;const{x:o,y:s,placement:i,middlewareData:a}=e,l=await Fy(e,t);return i===((r=a.offset)==null?void 0:r.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:o+l.x,y:s+l.y,data:{...l,placement:i}}}}},Hy=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:n,placement:o}=e,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:v=>{let{x:w,y:_}=v;return{x:w,y:_}}},...l}=St(t,e),c={x:r,y:n},u=await Un(e,l),d=qt(kt(o)),h=Oa(d);let p=c[h],y=c[d];if(s){const v=h==="y"?"top":"left",w=h==="y"?"bottom":"right",_=p+u[v],b=p-u[w];p=$i(_,p,b)}if(i){const v=d==="y"?"top":"left",w=d==="y"?"bottom":"right",_=y+u[v],b=y-u[w];y=$i(_,y,b)}const m=a.fn({...e,[h]:p,[d]:y});return{...m,data:{x:m.x-r,y:m.y-n,enabled:{[h]:s,[d]:i}}}}}},Wy=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:n,placement:o,rects:s,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=St(t,e),u={x:r,y:n},d=qt(o),h=Oa(d);let p=u[h],y=u[d];const m=St(a,e),v=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const b=h==="y"?"height":"width",x=s.reference[h]-s.floating[b]+v.mainAxis,k=s.reference[h]+s.reference[b]-v.mainAxis;p<x?p=x:p>k&&(p=k)}if(c){var w,_;const b=h==="y"?"width":"height",x=["top","left"].includes(kt(o)),k=s.reference[d]-s.floating[b]+(x&&((w=i.offset)==null?void 0:w[d])||0)+(x?0:v.crossAxis),C=s.reference[d]+s.reference[b]+(x?0:((_=i.offset)==null?void 0:_[d])||0)-(x?v.crossAxis:0);y<k?y=k:y>C&&(y=C)}return{[h]:p,[d]:y}}}},Gy=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var r,n;const{placement:o,rects:s,platform:i,elements:a}=e,{apply:l=()=>{},...c}=St(t,e),u=await Un(e,c),d=kt(o),h=hn(o),p=qt(o)==="y",{width:y,height:m}=s.floating;let v,w;d==="top"||d==="bottom"?(v=d,w=h===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(w=d,v=h==="end"?"top":"bottom");const _=m-u.top-u.bottom,b=y-u.left-u.right,x=Gt(m-u[v],_),k=Gt(y-u[w],b),C=!e.middlewareData.shift;let S=x,j=k;if((r=e.middlewareData.shift)!=null&&r.enabled.x&&(j=b),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(S=_),C&&!h){const N=De(u.left,0),H=De(u.right,0),I=De(u.top,0),te=De(u.bottom,0);p?j=y-2*(N!==0||H!==0?N+H:De(u.left,u.right)):S=m-2*(I!==0||te!==0?I+te:De(u.top,u.bottom))}await l({...e,availableWidth:j,availableHeight:S});const U=await i.getDimensions(a.floating);return y!==U.width||m!==U.height?{reset:{rects:!0}}:{}}}};function os(){return typeof window<"u"}function fn(t){return $d(t)?(t.nodeName||"").toLowerCase():"#document"}function Be(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function gt(t){var e;return(e=($d(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function $d(t){return os()?t instanceof Node||t instanceof Be(t).Node:!1}function tt(t){return os()?t instanceof Element||t instanceof Be(t).Element:!1}function dt(t){return os()?t instanceof HTMLElement||t instanceof Be(t).HTMLElement:!1}function Fl(t){return!os()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Be(t).ShadowRoot}function Yn(t){const{overflow:e,overflowX:r,overflowY:n,display:o}=rt(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+r)&&!["inline","contents"].includes(o)}function qy(t){return["table","td","th"].includes(fn(t))}function ss(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function $a(t){const e=za(),r=tt(t)?rt(t):t;return["transform","translate","scale","rotate","perspective"].some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(n=>(r.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(r.contain||"").includes(n))}function Vy(t){let e=Vt(t);for(;dt(e)&&!en(e);){if($a(e))return e;if(ss(e))return null;e=Vt(e)}return null}function za(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function en(t){return["html","body","#document"].includes(fn(t))}function rt(t){return Be(t).getComputedStyle(t)}function is(t){return tt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Vt(t){if(fn(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Fl(t)&&t.host||gt(t);return Fl(e)?e.host:e}function zd(t){const e=Vt(t);return en(e)?t.ownerDocument?t.ownerDocument.body:t.body:dt(e)&&Yn(e)?e:zd(e)}function Hn(t,e,r){var n;e===void 0&&(e=[]),r===void 0&&(r=!0);const o=zd(t),s=o===((n=t.ownerDocument)==null?void 0:n.body),i=Be(o);if(s){const a=Ni(i);return e.concat(i,i.visualViewport||[],Yn(o)?o:[],a&&r?Hn(a):[])}return e.concat(o,Hn(o,[],r))}function Ni(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Nd(t){const e=rt(t);let r=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const o=dt(t),s=o?t.offsetWidth:r,i=o?t.offsetHeight:n,a=Ho(r)!==s||Ho(n)!==i;return a&&(r=s,n=i),{width:r,height:n,$:a}}function Na(t){return tt(t)?t:t.contextElement}function Jr(t){const e=Na(t);if(!dt(e))return ut(1);const r=e.getBoundingClientRect(),{width:n,height:o,$:s}=Nd(e);let i=(s?Ho(r.width):r.width)/n,a=(s?Ho(r.height):r.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const Ky=ut(0);function Ld(t){const e=Be(t);return!za()||!e.visualViewport?Ky:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Xy(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==Be(t)?!1:e}function fr(t,e,r,n){e===void 0&&(e=!1),r===void 0&&(r=!1);const o=t.getBoundingClientRect(),s=Na(t);let i=ut(1);e&&(n?tt(n)&&(i=Jr(n)):i=Jr(t));const a=Xy(s,r,n)?Ld(s):ut(0);let l=(o.left+a.x)/i.x,c=(o.top+a.y)/i.y,u=o.width/i.x,d=o.height/i.y;if(s){const h=Be(s),p=n&&tt(n)?Be(n):n;let y=h,m=Ni(y);for(;m&&n&&p!==y;){const v=Jr(m),w=m.getBoundingClientRect(),_=rt(m),b=w.left+(m.clientLeft+parseFloat(_.paddingLeft))*v.x,x=w.top+(m.clientTop+parseFloat(_.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,d*=v.y,l+=b,c+=x,y=Be(m),m=Ni(y)}}return Go({width:u,height:d,x:l,y:c})}function La(t,e){const r=is(t).scrollLeft;return e?e.left+r:fr(gt(t)).left+r}function Dd(t,e,r){r===void 0&&(r=!1);const n=t.getBoundingClientRect(),o=n.left+e.scrollLeft-(r?0:La(t,n)),s=n.top+e.scrollTop;return{x:o,y:s}}function Jy(t){let{elements:e,rect:r,offsetParent:n,strategy:o}=t;const s=o==="fixed",i=gt(n),a=e?ss(e.floating):!1;if(n===i||a&&s)return r;let l={scrollLeft:0,scrollTop:0},c=ut(1);const u=ut(0),d=dt(n);if((d||!d&&!s)&&((fn(n)!=="body"||Yn(i))&&(l=is(n)),dt(n))){const p=fr(n);c=Jr(n),u.x=p.x+n.clientLeft,u.y=p.y+n.clientTop}const h=i&&!d&&!s?Dd(i,l,!0):ut(0);return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:r.y*c.y-l.scrollTop*c.y+u.y+h.y}}function Yy(t){return Array.from(t.getClientRects())}function Zy(t){const e=gt(t),r=is(t),n=t.ownerDocument.body,o=De(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),s=De(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+La(t);const a=-r.scrollTop;return rt(n).direction==="rtl"&&(i+=De(e.clientWidth,n.clientWidth)-o),{width:o,height:s,x:i,y:a}}function Qy(t,e){const r=Be(t),n=gt(t),o=r.visualViewport;let s=n.clientWidth,i=n.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;const c=za();(!c||c&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:s,height:i,x:a,y:l}}function ev(t,e){const r=fr(t,!0,e==="fixed"),n=r.top+t.clientTop,o=r.left+t.clientLeft,s=dt(t)?Jr(t):ut(1),i=t.clientWidth*s.x,a=t.clientHeight*s.y,l=o*s.x,c=n*s.y;return{width:i,height:a,x:l,y:c}}function Ul(t,e,r){let n;if(e==="viewport")n=Qy(t,r);else if(e==="document")n=Zy(gt(t));else if(tt(e))n=ev(e,r);else{const o=Ld(t);n={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return Go(n)}function Md(t,e){const r=Vt(t);return r===e||!tt(r)||en(r)?!1:rt(r).position==="fixed"||Md(r,e)}function tv(t,e){const r=e.get(t);if(r)return r;let n=Hn(t,[],!1).filter(a=>tt(a)&&fn(a)!=="body"),o=null;const s=rt(t).position==="fixed";let i=s?Vt(t):t;for(;tt(i)&&!en(i);){const a=rt(i),l=$a(i);!l&&a.position==="fixed"&&(o=null),(s?!l&&!o:!l&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||Yn(i)&&!l&&Md(t,i))?n=n.filter(u=>u!==i):o=a,i=Vt(i)}return e.set(t,n),n}function rv(t){let{element:e,boundary:r,rootBoundary:n,strategy:o}=t;const i=[...r==="clippingAncestors"?ss(e)?[]:tv(e,this._c):[].concat(r),n],a=i[0],l=i.reduce((c,u)=>{const d=Ul(e,u,o);return c.top=De(d.top,c.top),c.right=Gt(d.right,c.right),c.bottom=Gt(d.bottom,c.bottom),c.left=De(d.left,c.left),c},Ul(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function nv(t){const{width:e,height:r}=Nd(t);return{width:e,height:r}}function ov(t,e,r){const n=dt(e),o=gt(e),s=r==="fixed",i=fr(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=ut(0);if(n||!n&&!s)if((fn(e)!=="body"||Yn(o))&&(a=is(e)),n){const h=fr(e,!0,s,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else o&&(l.x=La(o));const c=o&&!n&&!s?Dd(o,a):ut(0),u=i.left+a.scrollLeft-l.x-c.x,d=i.top+a.scrollTop-l.y-c.y;return{x:u,y:d,width:i.width,height:i.height}}function zs(t){return rt(t).position==="static"}function Hl(t,e){if(!dt(t)||rt(t).position==="fixed")return null;if(e)return e(t);let r=t.offsetParent;return gt(t)===r&&(r=r.ownerDocument.body),r}function Bd(t,e){const r=Be(t);if(ss(t))return r;if(!dt(t)){let o=Vt(t);for(;o&&!en(o);){if(tt(o)&&!zs(o))return o;o=Vt(o)}return r}let n=Hl(t,e);for(;n&&qy(n)&&zs(n);)n=Hl(n,e);return n&&en(n)&&zs(n)&&!$a(n)?r:n||Vy(t)||r}const sv=async function(t){const e=this.getOffsetParent||Bd,r=this.getDimensions,n=await r(t.floating);return{reference:ov(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function iv(t){return rt(t).direction==="rtl"}const av={convertOffsetParentRelativeRectToViewportRelativeRect:Jy,getDocumentElement:gt,getClippingRect:rv,getOffsetParent:Bd,getElementRects:sv,getClientRects:Yy,getDimensions:nv,getScale:Jr,isElement:tt,isRTL:iv};function Fd(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function lv(t,e){let r=null,n;const o=gt(t);function s(){var a;clearTimeout(n),(a=r)==null||a.disconnect(),r=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:h,height:p}=c;if(a||e(),!h||!p)return;const y=fo(d),m=fo(o.clientWidth-(u+h)),v=fo(o.clientHeight-(d+p)),w=fo(u),b={rootMargin:-y+"px "+-m+"px "+-v+"px "+-w+"px",threshold:De(0,Gt(1,l))||1};let x=!0;function k(C){const S=C[0].intersectionRatio;if(S!==l){if(!x)return i();S?i(!1,S):n=setTimeout(()=>{i(!1,1e-7)},1e3)}S===1&&!Fd(c,t.getBoundingClientRect())&&i(),x=!1}try{r=new IntersectionObserver(k,{...b,root:o.ownerDocument})}catch{r=new IntersectionObserver(k,b)}r.observe(t)}return i(!0),s}function cv(t,e,r,n){n===void 0&&(n={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=Na(t),u=o||s?[...c?Hn(c):[],...Hn(e)]:[];u.forEach(w=>{o&&w.addEventListener("scroll",r,{passive:!0}),s&&w.addEventListener("resize",r)});const d=c&&a?lv(c,r):null;let h=-1,p=null;i&&(p=new ResizeObserver(w=>{let[_]=w;_&&_.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var b;(b=p)==null||b.observe(e)})),r()}),c&&!l&&p.observe(c),p.observe(e));let y,m=l?fr(t):null;l&&v();function v(){const w=fr(t);m&&!Fd(m,w)&&r(),m=w,y=requestAnimationFrame(v)}return r(),()=>{var w;u.forEach(_=>{o&&_.removeEventListener("scroll",r),s&&_.removeEventListener("resize",r)}),d?.(),(w=p)==null||w.disconnect(),p=null,l&&cancelAnimationFrame(y)}}const uv=Uy,dv=Hy,hv=My,fv=Gy,pv=By,Wl=Dy,gv=Wy,mv=(t,e,r)=>{const n=new Map,o={platform:av,...r},s={...o.platform,_c:n};return Ly(t,e,{...o,platform:s})};var Ro=typeof document<"u"?g.useLayoutEffect:g.useEffect;function qo(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,n,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(n=r;n--!==0;)if(!qo(t[n],e[n]))return!1;return!0}if(o=Object.keys(t),r=o.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(e,o[n]))return!1;for(n=r;n--!==0;){const s=o[n];if(!(s==="_owner"&&t.$$typeof)&&!qo(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Ud(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Gl(t,e){const r=Ud(t);return Math.round(e*r)/r}function Ns(t){const e=g.useRef(t);return Ro(()=>{e.current=t}),e}function yv(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:n=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=g.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=g.useState(n);qo(h,n)||p(n);const[y,m]=g.useState(null),[v,w]=g.useState(null),_=g.useCallback(V=>{V!==C.current&&(C.current=V,m(V))},[]),b=g.useCallback(V=>{V!==S.current&&(S.current=V,w(V))},[]),x=s||y,k=i||v,C=g.useRef(null),S=g.useRef(null),j=g.useRef(u),U=l!=null,N=Ns(l),H=Ns(o),I=Ns(c),te=g.useCallback(()=>{if(!C.current||!S.current)return;const V={placement:e,strategy:r,middleware:h};H.current&&(V.platform=H.current),mv(C.current,S.current,V).then(se=>{const ue={...se,isPositioned:I.current!==!1};D.current&&!qo(j.current,ue)&&(j.current=ue,Aa.flushSync(()=>{d(ue)}))})},[h,e,r,H,I]);Ro(()=>{c===!1&&j.current.isPositioned&&(j.current.isPositioned=!1,d(V=>({...V,isPositioned:!1})))},[c]);const D=g.useRef(!1);Ro(()=>(D.current=!0,()=>{D.current=!1}),[]),Ro(()=>{if(x&&(C.current=x),k&&(S.current=k),x&&k){if(N.current)return N.current(x,k,te);te()}},[x,k,te,N,U]);const K=g.useMemo(()=>({reference:C,floating:S,setReference:_,setFloating:b}),[_,b]),W=g.useMemo(()=>({reference:x,floating:k}),[x,k]),oe=g.useMemo(()=>{const V={position:r,left:0,top:0};if(!W.floating)return V;const se=Gl(W.floating,u.x),ue=Gl(W.floating,u.y);return a?{...V,transform:"translate("+se+"px, "+ue+"px)",...Ud(W.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:se,top:ue}},[r,a,W.floating,u.x,u.y]);return g.useMemo(()=>({...u,update:te,refs:K,elements:W,floatingStyles:oe}),[u,te,K,W,oe])}const vv=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:n,padding:o}=typeof t=="function"?t(r):t;return n&&e(n)?n.current!=null?Wl({element:n.current,padding:o}).fn(r):{}:n?Wl({element:n,padding:o}).fn(r):{}}}},wv=(t,e)=>({...uv(t),options:[t,e]}),bv=(t,e)=>({...dv(t),options:[t,e]}),xv=(t,e)=>({...gv(t),options:[t,e]}),_v=(t,e)=>({...hv(t),options:[t,e]}),Sv=(t,e)=>({...fv(t),options:[t,e]}),kv=(t,e)=>({...pv(t),options:[t,e]}),Cv=(t,e)=>({...vv(t),options:[t,e]});var Pv="Arrow",Hd=g.forwardRef((t,e)=>{const{children:r,width:n=10,height:o=5,...s}=t;return f.jsx(ve.svg,{...s,ref:e,width:n,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:f.jsx("polygon",{points:"0,0 30,0 15,10"})})});Hd.displayName=Pv;var Ev=Hd;function Av(t){const[e,r]=g.useState(void 0);return hr(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;r({width:i,height:a})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else r(void 0)},[t]),e}var Da="Popper",[Wd,Gd]=Ea(Da),[Tv,qd]=Wd(Da),Vd=t=>{const{__scopePopper:e,children:r}=t,[n,o]=g.useState(null);return f.jsx(Tv,{scope:e,anchor:n,onAnchorChange:o,children:r})};Vd.displayName=Da;var Kd="PopperAnchor",Xd=g.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:n,...o}=t,s=qd(Kd,r),i=g.useRef(null),a=nt(e,i);return g.useEffect(()=>{s.onAnchorChange(n?.current||i.current)}),n?null:f.jsx(ve.div,{...o,ref:a})});Xd.displayName=Kd;var Ma="PopperContent",[Rv,Ov]=Wd(Ma),Jd=g.forwardRef((t,e)=>{const{__scopePopper:r,side:n="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:y,...m}=t,v=qd(Ma,r),[w,_]=g.useState(null),b=nt(e,T=>_(T)),[x,k]=g.useState(null),C=Av(x),S=C?.width??0,j=C?.height??0,U=n+(s!=="center"?"-"+s:""),N=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},H=Array.isArray(c)?c:[c],I=H.length>0,te={padding:N,boundary:H.filter(jv),altBoundary:I},{refs:D,floatingStyles:K,placement:W,isPositioned:oe,middlewareData:V}=yv({strategy:"fixed",placement:U,whileElementsMounted:(...T)=>cv(...T,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[wv({mainAxis:o+j,alignmentAxis:i}),l&&bv({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?xv():void 0,...te}),l&&_v({...te}),Sv({...te,apply:({elements:T,rects:L,availableWidth:re,availableHeight:de})=>{const{width:Fe,height:Ue}=L.reference,he=T.floating.style;he.setProperty("--radix-popper-available-width",`${re}px`),he.setProperty("--radix-popper-available-height",`${de}px`),he.setProperty("--radix-popper-anchor-width",`${Fe}px`),he.setProperty("--radix-popper-anchor-height",`${Ue}px`)}}),x&&Cv({element:x,padding:a}),$v({arrowWidth:S,arrowHeight:j}),h&&kv({strategy:"referenceHidden",...te})]}),[se,ue]=Qd(W),ce=Wt(y);hr(()=>{oe&&ce?.()},[oe,ce]);const E=V.arrow?.x,P=V.arrow?.y,R=V.arrow?.centerOffset!==0,[A,O]=g.useState();return hr(()=>{w&&O(window.getComputedStyle(w).zIndex)},[w]),f.jsx("div",{ref:D.setFloating,"data-radix-popper-content-wrapper":"",style:{...K,transform:oe?K.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:A,"--radix-popper-transform-origin":[V.transformOrigin?.x,V.transformOrigin?.y].join(" "),...V.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:f.jsx(Rv,{scope:r,placedSide:se,onArrowChange:k,arrowX:E,arrowY:P,shouldHideArrow:R,children:f.jsx(ve.div,{"data-side":se,"data-align":ue,...m,ref:b,style:{...m.style,animation:oe?void 0:"none"}})})})});Jd.displayName=Ma;var Yd="PopperArrow",Iv={top:"bottom",right:"left",bottom:"top",left:"right"},Zd=g.forwardRef(function(e,r){const{__scopePopper:n,...o}=e,s=Ov(Yd,n),i=Iv[s.placedSide];return f.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:f.jsx(Ev,{...o,ref:r,style:{...o.style,display:"block"}})})});Zd.displayName=Yd;function jv(t){return t!==null}var $v=t=>({name:"transformOrigin",options:t,fn(e){const{placement:r,rects:n,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=Qd(r),d={start:"0%",center:"50%",end:"100%"}[u],h=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let y="",m="";return c==="bottom"?(y=i?d:`${h}px`,m=`${-l}px`):c==="top"?(y=i?d:`${h}px`,m=`${n.floating.height+l}px`):c==="right"?(y=`${-l}px`,m=i?d:`${p}px`):c==="left"&&(y=`${n.floating.width+l}px`,m=i?d:`${p}px`),{data:{x:y,y:m}}}});function Qd(t){const[e,r="center"]=t.split("-");return[e,r]}var zv=Vd,eh=Xd,Nv=Jd,Lv=Zd,Dv="Portal",th=g.forwardRef((t,e)=>{const{container:r,...n}=t,[o,s]=g.useState(!1);hr(()=>s(!0),[]);const i=r||o&&globalThis?.document?.body;return i?sy.createPortal(f.jsx(ve.div,{...n,ref:e}),i):null});th.displayName=Dv;function Mv(t,e){return g.useReducer((r,n)=>e[r][n]??r,t)}var Zn=t=>{const{present:e,children:r}=t,n=Bv(e),o=typeof r=="function"?r({present:n.isPresent}):g.Children.only(r),s=nt(n.ref,Fv(o));return typeof r=="function"||n.isPresent?g.cloneElement(o,{ref:s}):null};Zn.displayName="Presence";function Bv(t){const[e,r]=g.useState(),n=g.useRef({}),o=g.useRef(t),s=g.useRef("none"),i=t?"mounted":"unmounted",[a,l]=Mv(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return g.useEffect(()=>{const c=po(n.current);s.current=a==="mounted"?c:"none"},[a]),hr(()=>{const c=n.current,u=o.current;if(u!==t){const h=s.current,p=po(c);t?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&h!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),hr(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const m=po(n.current).includes(p.animationName);if(p.target===e&&m&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},h=p=>{p.target===e&&(s.current=po(n.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:g.useCallback(c=>{c&&(n.current=getComputedStyle(c)),r(c)},[])}}function po(t){return t?.animationName||"none"}function Fv(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function rh({prop:t,defaultProp:e,onChange:r=()=>{}}){const[n,o]=Uv({defaultProp:e,onChange:r}),s=t!==void 0,i=s?t:n,a=Wt(r),l=g.useCallback(c=>{if(s){const d=typeof c=="function"?c(t):c;d!==t&&a(d)}else o(c)},[s,t,o,a]);return[i,l]}function Uv({defaultProp:t,onChange:e}){const r=g.useState(t),[n]=r,o=g.useRef(n),s=Wt(e);return g.useEffect(()=>{o.current!==n&&(s(n),o.current=n)},[n,o,s]),r}var Hv=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},kr=new WeakMap,go=new WeakMap,mo={},Ls=0,nh=function(t){return t&&(t.host||nh(t.parentNode))},Wv=function(t,e){return e.map(function(r){if(t.contains(r))return r;var n=nh(r);return n&&t.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},Gv=function(t,e,r,n){var o=Wv(e,Array.isArray(t)?t:[t]);mo[r]||(mo[r]=new WeakMap);var s=mo[r],i=[],a=new Set,l=new Set(o),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};o.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var p=h.getAttribute(n),y=p!==null&&p!=="false",m=(kr.get(h)||0)+1,v=(s.get(h)||0)+1;kr.set(h,m),s.set(h,v),i.push(h),m===1&&y&&go.set(h,!0),v===1&&h.setAttribute(r,"true"),y||h.setAttribute(n,"true")}catch(w){console.error("aria-hidden: cannot operate on ",h,w)}})};return u(e),a.clear(),Ls++,function(){i.forEach(function(d){var h=kr.get(d)-1,p=s.get(d)-1;kr.set(d,h),s.set(d,p),h||(go.has(d)||d.removeAttribute(n),go.delete(d)),p||d.removeAttribute(r)}),Ls--,Ls||(kr=new WeakMap,kr=new WeakMap,go=new WeakMap,mo={})}},oh=function(t,e,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(t)?t:[t]),o=Hv(t);return o?(n.push.apply(n,Array.from(o.querySelectorAll("[aria-live]"))),Gv(n,o,r,"aria-hidden")):function(){return null}},at=function(){return at=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},at.apply(this,arguments)};function sh(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r}function qv(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))}var Oo="right-scroll-bar-position",Io="width-before-scroll-bar",Vv="with-scroll-bars-hidden",Kv="--removed-body-scroll-bar-size";function Ds(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function Xv(t,e){var r=g.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(n){var o=r.value;o!==n&&(r.value=n,r.callback(n,o))}}}})[0];return r.callback=e,r.facade}var Jv=typeof window<"u"?g.useLayoutEffect:g.useEffect,ql=new WeakMap;function Yv(t,e){var r=Xv(null,function(n){return t.forEach(function(o){return Ds(o,n)})});return Jv(function(){var n=ql.get(r);if(n){var o=new Set(n),s=new Set(t),i=r.current;o.forEach(function(a){s.has(a)||Ds(a,null)}),s.forEach(function(a){o.has(a)||Ds(a,i)})}ql.set(r,t)},[t]),r}function Zv(t){return t}function Qv(t,e){e===void 0&&(e=Zv);var r=[],n=!1,o={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(s){var i=e(s,n);return r.push(i),function(){r=r.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(n=!0;r.length;){var i=r;r=[],i.forEach(s)}r={push:function(a){return s(a)},filter:function(){return r}}},assignMedium:function(s){n=!0;var i=[];if(r.length){var a=r;r=[],a.forEach(s),i=r}var l=function(){var u=i;i=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),r={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),r}}}};return o}function ew(t){t===void 0&&(t={});var e=Qv(null);return e.options=at({async:!0,ssr:!1},t),e}var ih=function(t){var e=t.sideCar,r=sh(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return g.createElement(n,at({},r))};ih.isSideCarExport=!0;function tw(t,e){return t.useMedium(e),ih}var ah=ew(),Ms=function(){},as=g.forwardRef(function(t,e){var r=g.useRef(null),n=g.useState({onScrollCapture:Ms,onWheelCapture:Ms,onTouchMoveCapture:Ms}),o=n[0],s=n[1],i=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,h=t.sideCar,p=t.noIsolation,y=t.inert,m=t.allowPinchZoom,v=t.as,w=v===void 0?"div":v,_=t.gapMode,b=sh(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=h,k=Yv([r,e]),C=at(at({},b),o);return g.createElement(g.Fragment,null,u&&g.createElement(x,{sideCar:ah,removeScrollBar:c,shards:d,noIsolation:p,inert:y,setCallbacks:s,allowPinchZoom:!!m,lockRef:r,gapMode:_}),i?g.cloneElement(g.Children.only(a),at(at({},C),{ref:k})):g.createElement(w,at({},C,{className:l,ref:k}),a))});as.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};as.classNames={fullWidth:Io,zeroRight:Oo};var rw=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function nw(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=rw();return e&&t.setAttribute("nonce",e),t}function ow(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function sw(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var iw=function(){var t=0,e=null;return{add:function(r){t==0&&(e=nw())&&(ow(e,r),sw(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},aw=function(){var t=iw();return function(e,r){g.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},lh=function(){var t=aw(),e=function(r){var n=r.styles,o=r.dynamic;return t(n,o),null};return e},lw={left:0,top:0,right:0,gap:0},Bs=function(t){return parseInt(t||"",10)||0},cw=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],n=e[t==="padding"?"paddingTop":"marginTop"],o=e[t==="padding"?"paddingRight":"marginRight"];return[Bs(r),Bs(n),Bs(o)]},uw=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return lw;var e=cw(t),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-r+e[2]-e[0])}},dw=lh(),Yr="data-scroll-locked",hw=function(t,e,r,n){var o=t.left,s=t.top,i=t.right,a=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(Vv,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(a,"px ").concat(n,`;
  }
  body[`).concat(Yr,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(a,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Oo,` {
    right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Io,` {
    margin-right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Oo," .").concat(Oo,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Io," .").concat(Io,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Yr,`] {
    `).concat(Kv,": ").concat(a,`px;
  }
`)},Vl=function(){var t=parseInt(document.body.getAttribute(Yr)||"0",10);return isFinite(t)?t:0},fw=function(){g.useEffect(function(){return document.body.setAttribute(Yr,(Vl()+1).toString()),function(){var t=Vl()-1;t<=0?document.body.removeAttribute(Yr):document.body.setAttribute(Yr,t.toString())}},[])},pw=function(t){var e=t.noRelative,r=t.noImportant,n=t.gapMode,o=n===void 0?"margin":n;fw();var s=g.useMemo(function(){return uw(o)},[o]);return g.createElement(dw,{styles:hw(s,!e,o,r?"":"!important")})},Li=!1;if(typeof window<"u")try{var yo=Object.defineProperty({},"passive",{get:function(){return Li=!0,!0}});window.addEventListener("test",yo,yo),window.removeEventListener("test",yo,yo)}catch{Li=!1}var Cr=Li?{passive:!1}:!1,gw=function(t){return t.tagName==="TEXTAREA"},ch=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!gw(t)&&r[e]==="visible")},mw=function(t){return ch(t,"overflowY")},yw=function(t){return ch(t,"overflowX")},Kl=function(t,e){var r=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var o=uh(t,n);if(o){var s=dh(t,n),i=s[1],a=s[2];if(i>a)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},vw=function(t){var e=t.scrollTop,r=t.scrollHeight,n=t.clientHeight;return[e,r,n]},ww=function(t){var e=t.scrollLeft,r=t.scrollWidth,n=t.clientWidth;return[e,r,n]},uh=function(t,e){return t==="v"?mw(e):yw(e)},dh=function(t,e){return t==="v"?vw(e):ww(e)},bw=function(t,e){return t==="h"&&e==="rtl"?-1:1},xw=function(t,e,r,n,o){var s=bw(t,window.getComputedStyle(e).direction),i=s*n,a=r.target,l=e.contains(a),c=!1,u=i>0,d=0,h=0;do{var p=dh(t,a),y=p[0],m=p[1],v=p[2],w=m-v-s*y;(y||w)&&uh(t,a)&&(d+=w,h+=y),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},vo=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Xl=function(t){return[t.deltaX,t.deltaY]},Jl=function(t){return t&&"current"in t?t.current:t},_w=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Sw=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},kw=0,Pr=[];function Cw(t){var e=g.useRef([]),r=g.useRef([0,0]),n=g.useRef(),o=g.useState(kw++)[0],s=g.useState(lh)[0],i=g.useRef(t);g.useEffect(function(){i.current=t},[t]),g.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(o));var m=qv([t.lockRef.current],(t.shards||[]).map(Jl),!0).filter(Boolean);return m.forEach(function(v){return v.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),m.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(o))})}}},[t.inert,t.lockRef.current,t.shards]);var a=g.useCallback(function(m,v){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!i.current.allowPinchZoom;var w=vo(m),_=r.current,b="deltaX"in m?m.deltaX:_[0]-w[0],x="deltaY"in m?m.deltaY:_[1]-w[1],k,C=m.target,S=Math.abs(b)>Math.abs(x)?"h":"v";if("touches"in m&&S==="h"&&C.type==="range")return!1;var j=Kl(S,C);if(!j)return!0;if(j?k=S:(k=S==="v"?"h":"v",j=Kl(S,C)),!j)return!1;if(!n.current&&"changedTouches"in m&&(b||x)&&(n.current=k),!k)return!0;var U=n.current||k;return xw(U,v,m,U==="h"?b:x)},[]),l=g.useCallback(function(m){var v=m;if(!(!Pr.length||Pr[Pr.length-1]!==s)){var w="deltaY"in v?Xl(v):vo(v),_=e.current.filter(function(k){return k.name===v.type&&(k.target===v.target||v.target===k.shadowParent)&&_w(k.delta,w)})[0];if(_&&_.should){v.cancelable&&v.preventDefault();return}if(!_){var b=(i.current.shards||[]).map(Jl).filter(Boolean).filter(function(k){return k.contains(v.target)}),x=b.length>0?a(v,b[0]):!i.current.noIsolation;x&&v.cancelable&&v.preventDefault()}}},[]),c=g.useCallback(function(m,v,w,_){var b={name:m,delta:v,target:w,should:_,shadowParent:Pw(w)};e.current.push(b),setTimeout(function(){e.current=e.current.filter(function(x){return x!==b})},1)},[]),u=g.useCallback(function(m){r.current=vo(m),n.current=void 0},[]),d=g.useCallback(function(m){c(m.type,Xl(m),m.target,a(m,t.lockRef.current))},[]),h=g.useCallback(function(m){c(m.type,vo(m),m.target,a(m,t.lockRef.current))},[]);g.useEffect(function(){return Pr.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Cr),document.addEventListener("touchmove",l,Cr),document.addEventListener("touchstart",u,Cr),function(){Pr=Pr.filter(function(m){return m!==s}),document.removeEventListener("wheel",l,Cr),document.removeEventListener("touchmove",l,Cr),document.removeEventListener("touchstart",u,Cr)}},[]);var p=t.removeScrollBar,y=t.inert;return g.createElement(g.Fragment,null,y?g.createElement(s,{styles:Sw(o)}):null,p?g.createElement(pw,{gapMode:t.gapMode}):null)}function Pw(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Ew=tw(ah,Cw);var Ba=g.forwardRef(function(t,e){return g.createElement(as,at({},t,{ref:e,sideCar:Ew}))});Ba.classNames=as.classNames;var Fa="Popover",[hh,SP]=Ea(Fa,[Gd]),Qn=Gd(),[Aw,br]=hh(Fa),fh=t=>{const{__scopePopover:e,children:r,open:n,defaultOpen:o,onOpenChange:s,modal:i=!1}=t,a=Qn(e),l=g.useRef(null),[c,u]=g.useState(!1),[d=!1,h]=rh({prop:n,defaultProp:o,onChange:s});return f.jsx(zv,{...a,children:f.jsx(Aw,{scope:e,contentId:ct(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:g.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:c,onCustomAnchorAdd:g.useCallback(()=>u(!0),[]),onCustomAnchorRemove:g.useCallback(()=>u(!1),[]),modal:i,children:r})})};fh.displayName=Fa;var ph="PopoverAnchor",Tw=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=br(ph,r),s=Qn(r),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=o;return g.useEffect(()=>(i(),()=>a()),[i,a]),f.jsx(eh,{...s,...n,ref:e})});Tw.displayName=ph;var gh="PopoverTrigger",mh=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=br(gh,r),s=Qn(r),i=nt(e,o.triggerRef),a=f.jsx(ve.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":bh(o.open),...n,ref:i,onClick:Me(t.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:f.jsx(eh,{asChild:!0,...s,children:a})});mh.displayName=gh;var Rw="PopoverPortal",[kP,Ow]=hh(Rw,{forceMount:void 0}),tn="PopoverContent",yh=g.forwardRef((t,e)=>{const r=Ow(tn,t.__scopePopover),{forceMount:n=r.forceMount,...o}=t,s=br(tn,t.__scopePopover);return f.jsx(Zn,{present:n||s.open,children:s.modal?f.jsx(Iw,{...o,ref:e}):f.jsx(jw,{...o,ref:e})})});yh.displayName=tn;var Iw=g.forwardRef((t,e)=>{const r=br(tn,t.__scopePopover),n=g.useRef(null),o=nt(e,n),s=g.useRef(!1);return g.useEffect(()=>{const i=n.current;if(i)return oh(i)},[]),f.jsx(Ba,{as:ns,allowPinchZoom:!0,children:f.jsx(vh,{...t,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Me(t.onCloseAutoFocus,i=>{i.preventDefault(),s.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Me(t.onPointerDownOutside,i=>{const a=i.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Me(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),jw=g.forwardRef((t,e)=>{const r=br(tn,t.__scopePopover),n=g.useRef(!1),o=g.useRef(!1);return f.jsx(vh,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(n.current||r.triggerRef.current?.focus(),s.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(n.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;r.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),vh=g.forwardRef((t,e)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=t,h=br(tn,r),p=Qn(r);return Od(),f.jsx(Ra,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:s,children:f.jsx(Ta,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1),children:f.jsx(Nv,{"data-state":bh(h.open),role:"dialog",id:h.contentId,...p,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),wh="PopoverClose",$w=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=br(wh,r);return f.jsx(ve.button,{type:"button",...n,ref:e,onClick:Me(t.onClick,()=>o.onOpenChange(!1))})});$w.displayName=wh;var zw="PopoverArrow",Nw=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=Qn(r);return f.jsx(Lv,{...o,...n,ref:e})});Nw.displayName=zw;function bh(t){return t?"open":"closed"}var Lw=mh;function xh(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(e=0;e<o;e++)t[e]&&(r=xh(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function _h(){for(var t,e,r=0,n="",o=arguments.length;r<o;r++)(t=arguments[r])&&(e=xh(t))&&(n&&(n+=" "),n+=e);return n}function qe(...t){return Cd(_h(t))}const Sh=fh,kh=Lw,Ch=g.forwardRef(({className:t,align:e="end",...r},n)=>f.jsx(yh,{ref:n,align:e,className:qe("z-popups drop-shadow-oneBlock p-0 border-shadow outline-none",t),...r,onKeyDown:o=>{o.stopPropagation()}})),Ua=({children:t,scaleFactor:e})=>{const r=Gp();return f.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??r,"--block":`${(e??r)*8}px`},children:t})};var Yl=1,Dw=.9,Mw=.8,Bw=.17,Fs=.1,Us=.999,Fw=.9999,Uw=.99,Hw=/[\\\/_+.#"@\[\(\{&]/,Ww=/[\\\/_+.#"@\[\(\{&]/g,Gw=/[\s-]/,Ph=/[\s-]/g;function Di(t,e,r,n,o,s,i){if(s===e.length)return o===t.length?Yl:Uw;var a=`${o},${s}`;if(i[a]!==void 0)return i[a];for(var l=n.charAt(s),c=r.indexOf(l,o),u=0,d,h,p,y;c>=0;)d=Di(t,e,r,n,c+1,s+1,i),d>u&&(c===o?d*=Yl:Hw.test(t.charAt(c-1))?(d*=Mw,p=t.slice(o,c-1).match(Ww),p&&o>0&&(d*=Math.pow(Us,p.length))):Gw.test(t.charAt(c-1))?(d*=Dw,y=t.slice(o,c-1).match(Ph),y&&o>0&&(d*=Math.pow(Us,y.length))):(d*=Bw,o>0&&(d*=Math.pow(Us,c-o))),t.charAt(c)!==e.charAt(s)&&(d*=Fw)),(d<Fs&&r.charAt(c-1)===n.charAt(s+1)||n.charAt(s+1)===n.charAt(s)&&r.charAt(c-1)!==n.charAt(s))&&(h=Di(t,e,r,n,c+1,s+2,i),h*Fs>d&&(d=h*Fs)),d>u&&(u=d),c=r.indexOf(l,c+1);return i[a]=u,u}function Zl(t){return t.toLowerCase().replace(Ph," ")}function qw(t,e,r){return t=r&&r.length>0?`${t+" "+r.join(" ")}`:t,Di(t,e,Zl(t),Zl(e),0,0,{})}var Ha="Dialog",[Eh,CP]=Ea(Ha),[Vw,ot]=Eh(Ha),Ah=t=>{const{__scopeDialog:e,children:r,open:n,defaultOpen:o,onOpenChange:s,modal:i=!0}=t,a=g.useRef(null),l=g.useRef(null),[c=!1,u]=rh({prop:n,defaultProp:o,onChange:s});return f.jsx(Vw,{scope:e,triggerRef:a,contentRef:l,contentId:ct(),titleId:ct(),descriptionId:ct(),open:c,onOpenChange:u,onOpenToggle:g.useCallback(()=>u(d=>!d),[u]),modal:i,children:r})};Ah.displayName=Ha;var Th="DialogTrigger",Kw=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=ot(Th,r),s=nt(e,o.triggerRef);return f.jsx(ve.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":qa(o.open),...n,ref:s,onClick:Me(t.onClick,o.onOpenToggle)})});Kw.displayName=Th;var Wa="DialogPortal",[Xw,Rh]=Eh(Wa,{forceMount:void 0}),Oh=t=>{const{__scopeDialog:e,forceMount:r,children:n,container:o}=t,s=ot(Wa,e);return f.jsx(Xw,{scope:e,forceMount:r,children:g.Children.map(n,i=>f.jsx(Zn,{present:r||s.open,children:f.jsx(th,{asChild:!0,container:o,children:i})}))})};Oh.displayName=Wa;var Vo="DialogOverlay",Ih=g.forwardRef((t,e)=>{const r=Rh(Vo,t.__scopeDialog),{forceMount:n=r.forceMount,...o}=t,s=ot(Vo,t.__scopeDialog);return s.modal?f.jsx(Zn,{present:n||s.open,children:f.jsx(Jw,{...o,ref:e})}):null});Ih.displayName=Vo;var Jw=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=ot(Vo,r);return f.jsx(Ba,{as:ns,allowPinchZoom:!0,shards:[o.contentRef],children:f.jsx(ve.div,{"data-state":qa(o.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),pr="DialogContent",jh=g.forwardRef((t,e)=>{const r=Rh(pr,t.__scopeDialog),{forceMount:n=r.forceMount,...o}=t,s=ot(pr,t.__scopeDialog);return f.jsx(Zn,{present:n||s.open,children:s.modal?f.jsx(Yw,{...o,ref:e}):f.jsx(Zw,{...o,ref:e})})});jh.displayName=pr;var Yw=g.forwardRef((t,e)=>{const r=ot(pr,t.__scopeDialog),n=g.useRef(null),o=nt(e,r.contentRef,n);return g.useEffect(()=>{const s=n.current;if(s)return oh(s)},[]),f.jsx($h,{...t,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Me(t.onCloseAutoFocus,s=>{s.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:Me(t.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:Me(t.onFocusOutside,s=>s.preventDefault())})}),Zw=g.forwardRef((t,e)=>{const r=ot(pr,t.__scopeDialog),n=g.useRef(!1),o=g.useRef(!1);return f.jsx($h,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(n.current||r.triggerRef.current?.focus(),s.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(n.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;r.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),$h=g.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=t,a=ot(pr,r),l=g.useRef(null),c=nt(e,l);return Od(),f.jsxs(f.Fragment,{children:[f.jsx(Ra,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:s,children:f.jsx(Ta,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":qa(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),f.jsxs(f.Fragment,{children:[f.jsx(rb,{titleId:a.titleId}),f.jsx(ob,{contentRef:l,descriptionId:a.descriptionId})]})]})}),Ga="DialogTitle",Qw=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=ot(Ga,r);return f.jsx(ve.h2,{id:o.titleId,...n,ref:e})});Qw.displayName=Ga;var zh="DialogDescription",eb=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=ot(zh,r);return f.jsx(ve.p,{id:o.descriptionId,...n,ref:e})});eb.displayName=zh;var Nh="DialogClose",tb=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=ot(Nh,r);return f.jsx(ve.button,{type:"button",...n,ref:e,onClick:Me(t.onClick,()=>o.onOpenChange(!1))})});tb.displayName=Nh;function qa(t){return t?"open":"closed"}var Lh="DialogTitleWarning",[PP,Dh]=ny(Lh,{contentName:pr,titleName:Ga,docsSlug:"dialog"}),rb=({titleId:t})=>{const e=Dh(Lh),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return g.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},nb="DialogDescriptionWarning",ob=({contentRef:t,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Dh(nb).contentName}}.`;return g.useEffect(()=>{const o=t.current?.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(n))},[n,t,e]),null},sb=Ah,ib=Oh,ab=Ih,lb=jh,Hs={exports:{}},Ws={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ql;function cb(){if(Ql)return Ws;Ql=1;var t=qp();function e(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var r=typeof Object.is=="function"?Object.is:e,n=t.useState,o=t.useEffect,s=t.useLayoutEffect,i=t.useDebugValue;function a(d,h){var p=h(),y=n({inst:{value:p,getSnapshot:h}}),m=y[0].inst,v=y[1];return s(function(){m.value=p,m.getSnapshot=h,l(m)&&v({inst:m})},[d,p,h]),o(function(){return l(m)&&v({inst:m}),d(function(){l(m)&&v({inst:m})})},[d]),i(p),p}function l(d){var h=d.getSnapshot;d=d.value;try{var p=h();return!r(d,p)}catch{return!0}}function c(d,h){return h()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return Ws.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,Ws}var ec;function ub(){return ec||(ec=1,Hs.exports=cb()),Hs.exports}var db=ub(),bn='[cmdk-group=""]',Gs='[cmdk-group-items=""]',hb='[cmdk-group-heading=""]',Va='[cmdk-item=""]',tc=`${Va}:not([aria-disabled="true"])`,Mi="cmdk-item-select",nr="data-value",fb=(t,e,r)=>qw(t,e,r),Mh=g.createContext(void 0),eo=()=>g.useContext(Mh),Bh=g.createContext(void 0),Ka=()=>g.useContext(Bh),Fh=g.createContext(void 0),Uh=g.forwardRef((t,e)=>{let r=Br(()=>{var E,P;return{search:"",value:(P=(E=t.value)!=null?E:t.defaultValue)!=null?P:"",filtered:{count:0,items:new Map,groups:new Set}}}),n=Br(()=>new Set),o=Br(()=>new Map),s=Br(()=>new Map),i=Br(()=>new Set),a=Hh(t),{label:l,children:c,value:u,onValueChange:d,filter:h,shouldFilter:p,loop:y,disablePointerSelection:m=!1,vimBindings:v=!0,...w}=t,_=ct(),b=ct(),x=ct(),k=g.useRef(null),C=kb();gr(()=>{if(u!==void 0){let E=u.trim();r.current.value=E,S.emit()}},[u]),gr(()=>{C(6,te)},[]);let S=g.useMemo(()=>({subscribe:E=>(i.current.add(E),()=>i.current.delete(E)),snapshot:()=>r.current,setState:(E,P,R)=>{var A,O,T;if(!Object.is(r.current[E],P)){if(r.current[E]=P,E==="search")I(),N(),C(1,H);else if(E==="value"&&(R||C(5,te),((A=a.current)==null?void 0:A.value)!==void 0)){let L=P??"";(T=(O=a.current).onValueChange)==null||T.call(O,L);return}S.emit()}},emit:()=>{i.current.forEach(E=>E())}}),[]),j=g.useMemo(()=>({value:(E,P,R)=>{var A;P!==((A=s.current.get(E))==null?void 0:A.value)&&(s.current.set(E,{value:P,keywords:R}),r.current.filtered.items.set(E,U(P,R)),C(2,()=>{N(),S.emit()}))},item:(E,P)=>(n.current.add(E),P&&(o.current.has(P)?o.current.get(P).add(E):o.current.set(P,new Set([E]))),C(3,()=>{I(),N(),r.current.value||H(),S.emit()}),()=>{s.current.delete(E),n.current.delete(E),r.current.filtered.items.delete(E);let R=D();C(4,()=>{I(),R?.getAttribute("id")===E&&H(),S.emit()})}),group:E=>(o.current.has(E)||o.current.set(E,new Set),()=>{s.current.delete(E),o.current.delete(E)}),filter:()=>a.current.shouldFilter,label:l||t["aria-label"],getDisablePointerSelection:()=>a.current.disablePointerSelection,listId:_,inputId:x,labelId:b,listInnerRef:k}),[]);function U(E,P){var R,A;let O=(A=(R=a.current)==null?void 0:R.filter)!=null?A:fb;return E?O(E,r.current.search,P):0}function N(){if(!r.current.search||a.current.shouldFilter===!1)return;let E=r.current.filtered.items,P=[];r.current.filtered.groups.forEach(A=>{let O=o.current.get(A),T=0;O.forEach(L=>{let re=E.get(L);T=Math.max(re,T)}),P.push([A,T])});let R=k.current;K().sort((A,O)=>{var T,L;let re=A.getAttribute("id"),de=O.getAttribute("id");return((T=E.get(de))!=null?T:0)-((L=E.get(re))!=null?L:0)}).forEach(A=>{let O=A.closest(Gs);O?O.appendChild(A.parentElement===O?A:A.closest(`${Gs} > *`)):R.appendChild(A.parentElement===R?A:A.closest(`${Gs} > *`))}),P.sort((A,O)=>O[1]-A[1]).forEach(A=>{var O;let T=(O=k.current)==null?void 0:O.querySelector(`${bn}[${nr}="${encodeURIComponent(A[0])}"]`);T?.parentElement.appendChild(T)})}function H(){let E=K().find(R=>R.getAttribute("aria-disabled")!=="true"),P=E?.getAttribute(nr);S.setState("value",P||void 0)}function I(){var E,P,R,A;if(!r.current.search||a.current.shouldFilter===!1){r.current.filtered.count=n.current.size;return}r.current.filtered.groups=new Set;let O=0;for(let T of n.current){let L=(P=(E=s.current.get(T))==null?void 0:E.value)!=null?P:"",re=(A=(R=s.current.get(T))==null?void 0:R.keywords)!=null?A:[],de=U(L,re);r.current.filtered.items.set(T,de),de>0&&O++}for(let[T,L]of o.current)for(let re of L)if(r.current.filtered.items.get(re)>0){r.current.filtered.groups.add(T);break}r.current.filtered.count=O}function te(){var E,P,R;let A=D();A&&(((E=A.parentElement)==null?void 0:E.firstChild)===A&&((R=(P=A.closest(bn))==null?void 0:P.querySelector(hb))==null||R.scrollIntoView({block:"nearest"})),A.scrollIntoView({block:"nearest"}))}function D(){var E;return(E=k.current)==null?void 0:E.querySelector(`${Va}[aria-selected="true"]`)}function K(){var E;return Array.from(((E=k.current)==null?void 0:E.querySelectorAll(tc))||[])}function W(E){let P=K()[E];P&&S.setState("value",P.getAttribute(nr))}function oe(E){var P;let R=D(),A=K(),O=A.findIndex(L=>L===R),T=A[O+E];(P=a.current)!=null&&P.loop&&(T=O+E<0?A[A.length-1]:O+E===A.length?A[0]:A[O+E]),T&&S.setState("value",T.getAttribute(nr))}function V(E){let P=D(),R=P?.closest(bn),A;for(;R&&!A;)R=E>0?_b(R,bn):Sb(R,bn),A=R?.querySelector(tc);A?S.setState("value",A.getAttribute(nr)):oe(E)}let se=()=>W(K().length-1),ue=E=>{E.preventDefault(),E.metaKey?se():E.altKey?V(1):oe(1)},ce=E=>{E.preventDefault(),E.metaKey?W(0):E.altKey?V(-1):oe(-1)};return g.createElement(ve.div,{ref:e,tabIndex:-1,...w,"cmdk-root":"",onKeyDown:E=>{var P;if((P=w.onKeyDown)==null||P.call(w,E),!E.defaultPrevented)switch(E.key){case"n":case"j":{v&&E.ctrlKey&&ue(E);break}case"ArrowDown":{ue(E);break}case"p":case"k":{v&&E.ctrlKey&&ce(E);break}case"ArrowUp":{ce(E);break}case"Home":{E.preventDefault(),W(0);break}case"End":{E.preventDefault(),se();break}case"Enter":if(!E.nativeEvent.isComposing&&E.keyCode!==229){E.preventDefault();let R=D();if(R){let A=new Event(Mi);R.dispatchEvent(A)}}}}},g.createElement("label",{"cmdk-label":"",htmlFor:j.inputId,id:j.labelId,style:Pb},l),ls(t,E=>g.createElement(Bh.Provider,{value:S},g.createElement(Mh.Provider,{value:j},E))))}),pb=g.forwardRef((t,e)=>{var r,n;let o=ct(),s=g.useRef(null),i=g.useContext(Fh),a=eo(),l=Hh(t),c=(n=(r=l.current)==null?void 0:r.forceMount)!=null?n:i?.forceMount;gr(()=>{if(!c)return a.item(o,i?.id)},[c]);let u=Wh(o,s,[t.value,t.children,s],t.keywords),d=Ka(),h=mr(C=>C.value&&C.value===u.current),p=mr(C=>c||a.filter()===!1?!0:C.search?C.filtered.items.get(o)>0:!0);g.useEffect(()=>{let C=s.current;if(!(!C||t.disabled))return C.addEventListener(Mi,y),()=>C.removeEventListener(Mi,y)},[p,t.onSelect,t.disabled]);function y(){var C,S;m(),(S=(C=l.current).onSelect)==null||S.call(C,u.current)}function m(){d.setState("value",u.current,!0)}if(!p)return null;let{disabled:v,value:w,onSelect:_,forceMount:b,keywords:x,...k}=t;return g.createElement(ve.div,{ref:Wn([s,e]),...k,id:o,"cmdk-item":"",role:"option","aria-disabled":!!v,"aria-selected":!!h,"data-disabled":!!v,"data-selected":!!h,onPointerMove:v||a.getDisablePointerSelection()?void 0:m,onClick:v?void 0:y},t.children)}),gb=g.forwardRef((t,e)=>{let{heading:r,children:n,forceMount:o,...s}=t,i=ct(),a=g.useRef(null),l=g.useRef(null),c=ct(),u=eo(),d=mr(p=>o||u.filter()===!1?!0:p.search?p.filtered.groups.has(i):!0);gr(()=>u.group(i),[]),Wh(i,a,[t.value,t.heading,l]);let h=g.useMemo(()=>({id:i,forceMount:o}),[o]);return g.createElement(ve.div,{ref:Wn([a,e]),...s,"cmdk-group":"",role:"presentation",hidden:d?void 0:!0},r&&g.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:c},r),ls(t,p=>g.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?c:void 0},g.createElement(Fh.Provider,{value:h},p))))}),mb=g.forwardRef((t,e)=>{let{alwaysRender:r,...n}=t,o=g.useRef(null),s=mr(i=>!i.search);return!r&&!s?null:g.createElement(ve.div,{ref:Wn([o,e]),...n,"cmdk-separator":"",role:"separator"})}),yb=g.forwardRef((t,e)=>{let{onValueChange:r,...n}=t,o=t.value!=null,s=Ka(),i=mr(u=>u.search),a=mr(u=>u.value),l=eo(),c=g.useMemo(()=>{var u;let d=(u=l.listInnerRef.current)==null?void 0:u.querySelector(`${Va}[${nr}="${encodeURIComponent(a)}"]`);return d?.getAttribute("id")},[]);return g.useEffect(()=>{t.value!=null&&s.setState("search",t.value)},[t.value]),g.createElement(ve.input,{ref:e,...n,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":c,id:l.inputId,type:"text",value:o?t.value:i,onChange:u=>{o||s.setState("search",u.target.value),r?.(u.target.value)}})}),vb=g.forwardRef((t,e)=>{let{children:r,label:n="Suggestions",...o}=t,s=g.useRef(null),i=g.useRef(null),a=eo();return g.useEffect(()=>{if(i.current&&s.current){let l=i.current,c=s.current,u,d=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let h=l.offsetHeight;c.style.setProperty("--cmdk-list-height",h.toFixed(1)+"px")})});return d.observe(l),()=>{cancelAnimationFrame(u),d.unobserve(l)}}},[]),g.createElement(ve.div,{ref:Wn([s,e]),...o,"cmdk-list":"",role:"listbox","aria-label":n,id:a.listId},ls(t,l=>g.createElement("div",{ref:Wn([i,a.listInnerRef]),"cmdk-list-sizer":""},l)))}),wb=g.forwardRef((t,e)=>{let{open:r,onOpenChange:n,overlayClassName:o,contentClassName:s,container:i,...a}=t;return g.createElement(sb,{open:r,onOpenChange:n},g.createElement(ib,{container:i},g.createElement(ab,{"cmdk-overlay":"",className:o}),g.createElement(lb,{"aria-label":t.label,"cmdk-dialog":"",className:s},g.createElement(Uh,{ref:e,...a}))))}),bb=g.forwardRef((t,e)=>mr(r=>r.filtered.count===0)?g.createElement(ve.div,{ref:e,...t,"cmdk-empty":"",role:"presentation"}):null),xb=g.forwardRef((t,e)=>{let{progress:r,children:n,label:o="Loading...",...s}=t;return g.createElement(ve.div,{ref:e,...s,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},ls(t,i=>g.createElement("div",{"aria-hidden":!0},i)))}),Ne=Object.assign(Uh,{List:vb,Item:pb,Input:yb,Group:gb,Separator:mb,Dialog:wb,Empty:bb,Loading:xb});function _b(t,e){let r=t.nextElementSibling;for(;r;){if(r.matches(e))return r;r=r.nextElementSibling}}function Sb(t,e){let r=t.previousElementSibling;for(;r;){if(r.matches(e))return r;r=r.previousElementSibling}}function Hh(t){let e=g.useRef(t);return gr(()=>{e.current=t}),e}var gr=typeof window>"u"?g.useEffect:g.useLayoutEffect;function Br(t){let e=g.useRef();return e.current===void 0&&(e.current=t()),e}function Wn(t){return e=>{t.forEach(r=>{typeof r=="function"?r(e):r!=null&&(r.current=e)})}}function mr(t){let e=Ka(),r=()=>t(e.snapshot());return db.useSyncExternalStore(e.subscribe,r,r)}function Wh(t,e,r,n=[]){let o=g.useRef(),s=eo();return gr(()=>{var i;let a=(()=>{var c;for(let u of r){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(c=u.current.textContent)==null?void 0:c.trim():o.current}})(),l=n.map(c=>c.trim());s.value(t,a,l),(i=e.current)==null||i.setAttribute(nr,a),o.current=a}),o}var kb=()=>{let[t,e]=g.useState(),r=Br(()=>new Map);return gr(()=>{r.current.forEach(n=>n()),r.current=new Map},[t]),(n,o)=>{r.current.set(n,o),e({})}};function Cb(t){let e=t.type;return typeof e=="function"?e(t.props):"render"in e?e.render(t.props):t}function ls({asChild:t,children:e},r){return t&&g.isValidElement(e)?g.cloneElement(Cb(e),{ref:e.ref},r(e.props.children)):r(e)}var Pb={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Gh=g.forwardRef(({className:t,...e},r)=>f.jsx(Ne,{ref:r,className:qe("flex h-full w-full flex-col overflow-hidden bg-metallicBlue text-popover-foreground",t),...e}));Gh.displayName=Ne.displayName;const qh=g.forwardRef(({className:t,...e},r)=>f.jsxs("div",{className:"flex items-center border-b px-1 pb-1","cmdk-input-wrapper":"",children:[f.jsx("span",{className:"sprite mr-1 texture-hud_char_gt"}),f.jsx(Ne.Input,{ref:r,className:qe("flex h-1 w-full bg-pastelBlue py-1 outline-none placeholder:text-shadow disabled:cursor-not-allowed",t),...e})]}));qh.displayName=Ne.Input.displayName;const Vh=g.forwardRef(({className:t,...e},r)=>f.jsx(Ne.List,{ref:r,className:qe("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...e}));Vh.displayName=Ne.List.displayName;const Kh=g.forwardRef((t,e)=>f.jsx(Ne.Empty,{ref:e,className:"pl-1",...t}));Kh.displayName=Ne.Empty.displayName;const Xh=g.forwardRef(({className:t,...e},r)=>f.jsx(Ne.Group,{ref:r,className:qe("overflow-hidden",t),...e}));Xh.displayName=Ne.Group.displayName;const Eb=g.forwardRef(({className:t,...e},r)=>f.jsx(Ne.Separator,{ref:r,className:qe("-mx-1 h-px bg-shadow",t),...e}));Eb.displayName=Ne.Separator.displayName;const cs=g.forwardRef(({className:t,...e},r)=>f.jsx(Ne.Item,{ref:r,className:qe("relative flex cursor-default select-none items-center text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-midRed hover:bg-pastelBlue data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...e}));cs.displayName=Ne.Item.displayName;const rn=g.forwardRef(({className:t,selected:e,...r},n)=>f.jsx("button",{"data-selected":e,className:qe(`inline-flex items-center justify-center whitespace-nowrap 
          bg-metallicBlue zx:bg-zxBlue border-none border-shadow
          gap-2
           disabled:bg-midGrey disabled:text-lightGrey 
           data-[selected=true]:bg-lightBeige
           [&:not(:disabled):hover:not([data-selected=true])]:bg-pastelBlue 
           `,t),ref:n,...r}));rn.displayName="Button";var rc=!1,or,Bi,Fi,jo,$o,Jh,zo,Ui,Hi,Wi,Yh,Gi,qi,Zh,Qh;function Oe(){if(!rc){rc=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),r=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(Gi=/\b(iPhone|iP[ao]d)/.exec(t),qi=/\b(iP[ao]d)/.exec(t),Wi=/Android/i.exec(t),Zh=/FBAN\/\w+;/i.exec(t),Qh=/Mobile/i.exec(t),Yh=!!/Win64/.exec(t),e){or=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN,or&&document&&document.documentMode&&(or=document.documentMode);var n=/(?:Trident\/(\d+.\d+))/.exec(t);Jh=n?parseFloat(n[1])+4:or,Bi=e[2]?parseFloat(e[2]):NaN,Fi=e[3]?parseFloat(e[3]):NaN,jo=e[4]?parseFloat(e[4]):NaN,jo?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),$o=e&&e[1]?parseFloat(e[1]):NaN):$o=NaN}else or=Bi=Fi=$o=jo=NaN;if(r){if(r[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);zo=o?parseFloat(o[1].replace("_",".")):!0}else zo=!1;Ui=!!r[2],Hi=!!r[3]}else zo=Ui=Hi=!1}}var Vi={ie:function(){return Oe()||or},ieCompatibilityMode:function(){return Oe()||Jh>or},ie64:function(){return Vi.ie()&&Yh},firefox:function(){return Oe()||Bi},opera:function(){return Oe()||Fi},webkit:function(){return Oe()||jo},safari:function(){return Vi.webkit()},chrome:function(){return Oe()||$o},windows:function(){return Oe()||Ui},osx:function(){return Oe()||zo},linux:function(){return Oe()||Hi},iphone:function(){return Oe()||Gi},mobile:function(){return Oe()||Gi||qi||Wi||Qh},nativeApp:function(){return Oe()||Zh},android:function(){return Oe()||Wi},ipad:function(){return Oe()||qi}},Ab=Vi,Tb=!!(typeof window<"u"&&window.document&&window.document.createElement),Rb={canUseDOM:Tb},ef=Rb,tf;ef.canUseDOM&&(tf=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);function Ob(t,e){if(!ef.canUseDOM||e&&!("addEventListener"in document))return!1;var r="on"+t,n=r in document;if(!n){var o=document.createElement("div");o.setAttribute(r,"return;"),n=typeof o[r]=="function"}return!n&&tf&&t==="wheel"&&(n=document.implementation.hasFeature("Events.wheel","3.0")),n}var Ib=Ob,nc=10,oc=40,sc=800;function rf(t){var e=0,r=0,n=0,o=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),n=e*nc,o=r*nc,"deltaY"in t&&(o=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||o)&&t.deltaMode&&(t.deltaMode==1?(n*=oc,o*=oc):(n*=sc,o*=sc)),n&&!e&&(e=n<1?-1:1),o&&!r&&(r=o<1?-1:1),{spinX:e,spinY:r,pixelX:n,pixelY:o}}rf.getEventType=function(){return Ab.firefox()?"DOMMouseScroll":Ib("wheel")?"wheel":"mousewheel"};var jb=rf;/**
* Checks if an event is supported in the current execution environment.
*
* NOTE: This will not work correctly for non-generic events such as `change`,
* `reset`, `load`, `error`, and `select`.
*
* Borrows from Modernizr.
*
* @param {string} eventNameSuffix Event name, e.g. "click".
* @param {?boolean} capture Check if the capture phase is supported.
* @return {boolean} True if the event is supported.
* @internal
* @license Modernizr 3.0.0pre (Custom Build) | MIT
*/const $b=(t,e)=>{const r=g.useRef(0),n=g.useCallback(o=>{const s=o;s.preventDefault(),s.stopPropagation();const i=jb(s);r.current-=i.spinY,r.current>=1&&(e(1),r.current=0),r.current<=-1&&(e(-1),r.current=0)},[e]);g.useEffect(()=>{const o=t.current;if(o!==null)return o.addEventListener("wheel",n,{passive:!1}),()=>{o.removeEventListener("wheel",n)}},[t,n])},nf=(t,e,r)=>{const n=g.useRef(0);return $b(t,o=>{const s=(n.current+o+256*e.length)%e.length;n.current=s,r(e[s],s)})},zb=({value:t,onSelect:e})=>f.jsx(cs,{value:t,onSelect:e,className:"px-1",children:f.jsx(ie,{children:t})}),us=t=>{const{values:e,onSelect:r,triggerButtonClassName:n="",triggerButtonStyle:o=pe,triggerButtonLabel:s="",OptionCommandItem:i=zb}=t,[a,l]=g.useState(!1),c=g.useRef(null);return nf(c,e,u=>{r(u)}),f.jsxs(Sh,{open:a,onOpenChange:l,children:[f.jsx(kh,{asChild:!0,children:f.jsxs(rn,{className:qe("h-2 px-1 flex flex-row gap-1 justify-start leading-none",n),style:o,ref:c,children:[typeof s=="string"?f.jsx(ie,{className:"grow overflow-hidden text-left",children:s}):s,f.jsx(ie,{className:"grow-0",children:a?"X":"⬇"})]})}),f.jsx(Ch,{className:"p-0",children:f.jsx(Ua,{scaleFactor:2,children:f.jsxs(Gh,{className:"w-[--radix-popper-anchor-width]",children:[t.disableCommandInput===!0?null:f.jsx(qh,{placeholder:t.placeholder}),f.jsxs(Vh,{children:[f.jsx(Kh,{children:f.jsx(ie,{children:"Nothing found"})}),f.jsx(Xh,{children:e.map(u=>f.jsx(i,{value:u,onSelect:d=>{l(!1),r(d)}},u))})]})]})})})]})},Nb=()=>{const t=pt(),e=Wu();return f.jsx(f.Fragment,{children:f.jsx(us,{value:e,values:Vp,onSelect:r=>{t(Kp(r))},disableCommandInput:!0,triggerButtonLabel:e,triggerButtonClassName:"w-13"})})};function of({campaign:t,onSelect:e,headRoomId:r,heelsRoomId:n,value:o,triggerButtonClassName:s,excludeRoomIds:i=[]}){const a=Object.keys(t.rooms).filter(l=>!i.includes(l));return f.jsx(us,{onSelect:l=>e?.(l),value:o,values:a,triggerButtonClassName:s,placeholder:"search",disableCommandInput:!1,triggerButtonLabel:o??"none",OptionCommandItem:({value:l,onSelect:c})=>f.jsxs(cs,{value:l,onSelect:c,className:"px-1",children:[r===l&&f.jsx("span",{className:"sprite mr-1 my-1 texture-head_walking_towards_2"}),n===l&&f.jsx("span",{className:"sprite mr-1 my-1 texture-heels_walking_towards_2"}),f.jsx(ie,{children:l})]})})}const me=t=>t,Ki="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",G=me("[button:not([data-selected=true]):not(:hover)_&]:sprite-revert-to-two-tone-dim"),Pe=me("flex flex-wrap gap-oneScaledPix w-full"),ht=({className:t,onClick:e,children:r,disabled:n=!1,isCurrentTool:o=!1})=>f.jsx(rn,{disabled:n,selected:o,className:`
        ${Ki} 
        active:pt-oneScaledPix  gap-0 inline-flex overflow-hidden 
        
        ${t??""}`,onClick:e,children:r}),Lb=()=>{const t=be(e=>e.levelEditor.selectedJsonItemIds.length>0);return f.jsx(ht,{className:"bg-midRed",disabled:!t,onClick:()=>M.dispatch(Ju()),children:f.jsx("span",{className:"sprite sprite-tinted texture-hud_char_X relative"})})},Xa=({className:t,value:e,onClick:r,trueLabel:n="ON",falseLabel:o="OFF",label:s})=>{const i=Math.max(n.length,o.length)+1,a=n.padStart(i," "),l=o.padEnd(i," ");return f.jsxs("span",{onClick:c=>r?.(c,!e),className:qe("inline-flex justify-between",t),children:[s&&f.jsx(ie,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),f.jsx(ie,{className:_h("inline-block w-min h-min",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:e?a:l})]})},Db=()=>{const t=pt();return f.jsx(Xa,{className:"w-full",label:"snap",value:be(e=>e.levelEditor.halfGridResolution),onClick:(e,r)=>{t(Tg(r))},falseLabel:"Block",trueLabel:"Half"})},$=({itemTool:t,children:e,className:r})=>{const n=be(ar),o=We(n?.type==="item"&&n.item,t);return f.jsx(ht,{isCurrentTool:o,className:r,onClick:()=>M.dispatch(Ht({type:"item",item:t})),children:e})},xn=({children:t})=>{const[e,r]=g.useState(!1),[n,o]=g.useState(0),s=g.useRef(null);nf(s,t,(a,l)=>{o(l)});const i=t[n];return f.jsxs(Sh,{open:e,onOpenChange:r,children:[f.jsx("div",{className:qe(Ki,"relative",{"drop-shadow-oneBlock z-popups":e}),children:f.jsxs("span",{className:"content",ref:s,children:[i,f.jsx(kh,{asChild:!0,children:f.jsx(rn,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:f.jsx(ie,{className:"pl-oneScaledPix",children:e?"X":"⬇"})})})]})}),f.jsx(Ch,{children:f.jsx(Ua,{scaleFactor:2,children:f.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:t.map((a,l)=>l===n?null:f.jsx("div",{className:Ki,onClick:()=>{o(l),r(!1)},children:a},l))})})})]})},Mb=()=>{const e=be(ar)?.type==="pointer";return f.jsx(ht,{onClick:()=>M.dispatch(Ht({type:"pointer"})),isCurrentTool:e,children:f.jsx("span",{className:"sprite texture-editor_tool_pointer relative"})})},z={pureBlack:new q("#000000"),shadow:new q("#325149"),midGrey:new q("#7F7773"),lightGrey:new q("#BBB1AB"),white:new q("#FBFEFB"),pastelBlue:new q("#75ACFF"),metallicBlue:new q("#366CAA"),pink:new q("#D68ED1"),moss:new q("#9E9600"),redShadow:new q("#805E50"),midRed:new q("#CA7463"),lightBeige:new q("#DAA78F"),highlightBeige:new q("#EBC690"),alpha:new q("#1E7790"),replaceLight:new q("#08A086"),replaceDark:new q("#0A4730")},jn=.33,sf=t=>{const[e,r,n]=t.toUint8RgbArray();return new q({r:e*.75,g:r*.75,b:n*.75})},nn=(t,e=jn)=>{const[r,n,o]=t.toUint8RgbArray();return new q({r:r*e,g:n*e,b:o*e})};function EP(t){t=t.replace(/^#/,"");let e=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),n=parseInt(t.substring(4,6),16);e=Math.floor(e*jn),r=Math.floor(r*jn),n=Math.floor(n*jn);const o=s=>s.toString(16).padStart(2,"0");return`#${o(e)}${o(r)}${o(n)}`}const Ke={original:new q(ln.zxWhite),basic:z.white,dimmed:z.lightGrey},Xe={original:new q(ln.zxYellow),basic:new q(15654246),dimmed:nn(new q(15654246),.5)},af={original:new q(ln.zxYellow),basic:z.midRed,dimmed:z.redShadow},st={original:new q(ln.zxMagenta),basic:z.pink,dimmed:nn(z.pink,.5)},xe={original:new q(ln.zxCyan),basic:z.pastelBlue,dimmed:nn(z.pastelBlue,.5)},it={original:new q(ln.zxGreen),basic:z.moss,dimmed:nn(z.moss,.5)},ds={white:{basic:{main:Ke,edges:{towards:{...xe,dimInOriginal:!1},right:{...Xe,dimInOriginal:!0}},hud:{lives:Xe,dimmed:st,icons:xe}},dimmed:{main:Ke,edges:{towards:{...it,dimInOriginal:!1},right:{...xe,dimInOriginal:!0}},hud:{lives:af,dimmed:st,icons:xe}}},yellow:{basic:{main:Xe,edges:{towards:{...it,dimInOriginal:!1},right:{...Ke,dimInOriginal:!0}},hud:{lives:xe,dimmed:st,icons:it}},dimmed:{main:Xe,edges:{towards:{...xe,dimInOriginal:!0},right:{...xe,dimInOriginal:!1}},hud:{lives:xe,dimmed:st,icons:it}}},magenta:{basic:{main:st,edges:{towards:{...it,dimInOriginal:!0},right:{...xe,dimInOriginal:!0}},hud:{lives:Ke,dimmed:xe,icons:Xe}},dimmed:{main:st,edges:{towards:{...it,dimInOriginal:!0},right:{...xe,dimInOriginal:!0}},hud:{lives:Ke,dimmed:xe,icons:Xe}}},cyan:{basic:{main:xe,edges:{towards:{...st,dimInOriginal:!1},right:{...Ke,dimInOriginal:!1}},hud:{lives:Ke,dimmed:it,icons:Xe}},dimmed:{main:xe,edges:{towards:{...st,dimInOriginal:!0},right:{...Ke,dimInOriginal:!0}},hud:{lives:Ke,dimmed:it,icons:Xe}}},green:{basic:{main:it,edges:{towards:{...xe,dimInOriginal:!1},right:{...Xe,dimInOriginal:!1}},hud:{lives:Ke,dimmed:st,icons:xe}},dimmed:{main:it,edges:{towards:{...xe,dimInOriginal:!0},right:{...Xe,dimInOriginal:!0}},hud:{lives:Ke,dimmed:st,icons:xe}}}},Ko=t=>ds[t.hue][t.shade],qr={head:z.pastelBlue,heels:z.pink},ic=t=>{const{main:e}=ds[t].basic;return{backgroundColor:e.basic.toHex(),borderColor:e.dimmed.toHex()}};function Bb(){const t=pt(),e=be(Rg);return f.jsxs(f.Fragment,{children:[f.jsx(us,{value:e.hue,onSelect:r=>{t(pl({hue:r}))},values:Xp,disableCommandInput:!0,OptionCommandItem:({value:r,onSelect:n})=>f.jsx(cs,{value:r,className:"border-l-3 h-2 w-full p-0",style:ic(r),onSelect:n}),triggerButtonLabel:"colour",triggerButtonClassName:qe("w-full",`${e.hue==="white"?"text-pureBlack":"text-white"}`),triggerButtonStyle:ic(e.hue)}),f.jsx(Xa,{className:"w-full",label:"shade",value:e.shade==="basic",onClick:(r,n)=>{t(pl({shade:n?"basic":"dimmed"}))},falseLabel:"dim",trueLabel:"basic"})]})}function Fb(){const t=pt(),e=be(Og);return f.jsx(us,{value:e,onSelect:r=>{t(Ig(r))},values:Jp,disableCommandInput:!0,triggerButtonClassName:"w-full",triggerButtonLabel:e})}const Rt=({iconClasses:t,text:e})=>f.jsxs("div",{className:"relative w-full h-full",children:[f.jsx("span",{className:`sprite absolute top-0 left-0 ${t} ${G}`}),f.jsx(ie,{className:"bg-metallicBlueHalfbrite absolute top-0 right-0 pl-oneScaledPix block",children:e})]}),wo=({iconClassName:t})=>f.jsx(vt,{topClasses:me("texture-bubbles_white_2 [button:hover_&]:texture-animated-bubbles_white"),bottomClasses:t}),vt=({topClasses:t,bottomClasses:e="texture-headlessBase"})=>f.jsxs("div",{className:"relative w-full h-full",children:[f.jsx("span",{className:`sprite absolute top-[calc(9px*var(--scale))] left-0 ${e} ${G}`}),f.jsx("span",{className:`sprite absolute top-[calc(-3px*var(--scale))] left-0 ${t} ${G}`})]}),Ub="[button:not(:disabled):hover_&]:hidden",Hb="hidden [button:not(:disabled):hover_&]:inline mt-quarter",Wb="hidden [button:not(:disabled):hover_&]:inline",Xo=({icon:t,topText:e,bottomText:r})=>f.jsxs("span",{className:"w-full h-full flex flex-col items-center justify-center",children:[f.jsx("span",{className:Ub,children:t}),f.jsx(ie,{className:Hb,children:e}),f.jsx(ie,{className:Wb,children:r})]}),Gb=()=>{const t=pt(),e=be(jg),r=be($g);return f.jsxs("div",{className:"flex flex-row gap-oneScaledPix bg-metallicBlue",children:[f.jsx(ht,{disabled:!e,onClick:()=>{t(Yu())},children:f.jsx(Xo,{icon:f.jsx(ie,{children:"⬅"}),topText:"un",bottomText:"do"})}),f.jsx(ht,{disabled:!r,onClick:()=>{t(Zu())},children:f.jsx(Xo,{icon:f.jsx(ie,{children:"➡"}),topText:"re",bottomText:"do"})})]})},qb=()=>{const t=pt();return f.jsx(Xa,{className:"w-full",label:"scenery",value:be(e=>e.levelEditor.wallsFloorsLocked),onClick:(e,r)=>{t(zg(r))},falseLabel:"edit",trueLabel:"lock"})},Vb=()=>{const t=be(r=>Fo(r).planet),e=me(t==="moonbase"?"texture-door_frame_moonbase_x_whole":"texture-door_frame_generic_x_whole");return f.jsx($,{itemTool:{type:"door",config:{direction:"away",toRoom:"(placeholder)"}},children:f.jsx("span",{className:`sprite ${e} ${G}`})})},Kb=()=>{const t=be(n=>Fo(n).planet),e={type:"wall",config:{direction:"away",tiles:Ng(t,1)}},r=me(t==="blacktooth"?"texture-blacktooth_wall_plain_away":t==="bookworld"?"texture-bookworld_wall_cowboy_away":t==="jail"?"texture-jail_wall_bars_away":t==="egyptus"?"texture-egyptus_wall_hieroglyphics_away":t==="market"?"texture-market_wall_passage_away":t==="moonbase"?"texture-moonbase_wall_window1_away":t==="penitentiary"?"texture-penitentiary_wall_loop_away":"texture-safari_wall_wall_away");return f.jsx($,{itemTool:e,children:f.jsx("span",{className:`sprite ${r} ${G}`})})},Xb=()=>f.jsx(ht,{className:"bg-midRed",onClick:()=>M.dispatch(Lg()),children:f.jsx(ie,{className:"relative leading-none",children:"CLR"})}),lf=({currentRoomId:t,direction:e})=>{const r=be(({levelEditor:s})=>s.campaignInProgress),n=be(({levelEditor:s})=>s.currentlyEditingRoomId),o=pt();return f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap pt-1",children:[f.jsxs(ie,{className:"text-lightGrey leading-none",children:["Room ",e==="roomAbove"?"⬆":"⬇"]}),f.jsx("div",{className:"flex-grow"}),f.jsxs("div",{className:"flex flex-row gap-oneScaledPix",children:[f.jsx(rn,{className:"w-2 leading-none bg-moss",children:f.jsx(ie,{onClick:()=>o(Cs({direction:e,createNew:!0})),children:"+"})}),f.jsx(rn,{className:"w-2 leading-none bg-midRed",children:f.jsx(ie,{onClick:()=>o(Cs({direction:e,createNew:!1,roomId:void 0})),children:"x"})})]})]}),f.jsx("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap",children:f.jsx(of,{value:t,campaign:r,excludeRoomIds:[n],triggerButtonClassName:"w-full",onSelect:s=>{o(Cs({direction:e,createNew:!1,roomId:s}))}})})]})},Jb=()=>{const t=be(({levelEditor:e})=>Qu(e).roomAbove);return f.jsx(f.Fragment,{children:f.jsx(lf,{currentRoomId:t,direction:"roomAbove"})})},Yb=()=>{const t=be(({levelEditor:e})=>Qu(e).roomBelow);return f.jsx(f.Fragment,{children:f.jsx(lf,{currentRoomId:t,direction:"roomBelow"})})},Zb=()=>{const t=be(({levelEditor:e})=>e.tool.type==="eyeDropper");return f.jsx(ht,{isCurrentTool:t,onClick:()=>M.dispatch(Ht({type:"eyeDropper"})),children:f.jsx("span",{className:"relative sprite texture-editor_tool_eyedropper leading-none"})})},Qb=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Bt(async()=>{const{default:n}=await Promise.resolve().then(()=>pn);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)};class Ja extends Error{constructor(e,r="FunctionsError",n){super(e),this.name=r,this.context=n}}class ex extends Ja{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ac extends Ja{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class lc extends Ja{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Xi;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Xi||(Xi={}));var tx=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class rx{constructor(e,{headers:r={},customFetch:n,region:o=Xi.Any}={}){this.url=e,this.headers=r,this.region=o,this.fetch=Qb(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,r={}){var n;return tx(this,void 0,void 0,function*(){try{const{headers:o,method:s,body:i}=r;let a={},{region:l}=r;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(a["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:u}).catch(m=>{throw new ex(m)}),h=d.headers.get("x-relay-error");if(h&&h==="true")throw new ac(d);if(!d.ok)throw new lc(d);let p=((n=d.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),y;return p==="application/json"?y=yield d.json():p==="application/octet-stream"?y=yield d.blob():p==="text/event-stream"?y=d:p==="multipart/form-data"?y=yield d.formData():y=yield d.text(),{data:y,error:null,response:d}}catch(o){return{data:null,error:o,response:o instanceof lc||o instanceof ac?o.context:void 0}}})}}var _e={},Er={},Ar={},Tr={},Rr={},Or={},nx=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},on=nx();const ox=on.fetch,cf=on.fetch.bind(on),uf=on.Headers,sx=on.Request,ix=on.Response,pn=Object.freeze(Object.defineProperty({__proto__:null,Headers:uf,Request:sx,Response:ix,default:cf,fetch:ox},Symbol.toStringTag,{value:"Module"})),ax=Yp(pn);var bo={},cc;function df(){if(cc)return bo;cc=1,Object.defineProperty(bo,"__esModule",{value:!0});class t extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return bo.default=t,bo}var uc;function hf(){if(uc)return Or;uc=1;var t=Or&&Or.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Or,"__esModule",{value:!0});const e=t(ax),r=t(df());class n{constructor(s){this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=s.headers,this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=s.shouldThrowOnError,this.signal=s.signal,this.isMaybeSingle=s.isMaybeSingle,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=Object.assign({},this.headers),this.headers[s]=i,this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,h;let p=null,y=null,m=null,v=c.status,w=c.statusText;if(c.ok){if(this.method!=="HEAD"){const k=await c.text();k===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?y=k:y=JSON.parse(k))}const b=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),x=(d=c.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");b&&x&&x.length>1&&(m=parseInt(x[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(y)&&(y.length>1?(p={code:"PGRST116",details:`Results contain ${y.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},y=null,m=null,v=406,w="Not Acceptable"):y.length===1?y=y[0]:y=null)}else{const b=await c.text();try{p=JSON.parse(b),Array.isArray(p)&&c.status===404&&(y=[],p=null,v=200,w="OK")}catch{c.status===404&&b===""?(v=204,w="No Content"):p={message:b}}if(p&&this.isMaybeSingle&&(!((h=p?.details)===null||h===void 0)&&h.includes("0 rows"))&&(p=null,v=200,w="OK"),p&&this.shouldThrowOnError)throw new r.default(p)}return{error:p,data:y,count:m,status:v,statusText:w}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,h;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(d=c?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(h=c?.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,i)}returns(){return this}overrideTypes(){return this}}return Or.default=n,Or}var dc;function ff(){if(dc)return Rr;dc=1;var t=Rr&&Rr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Rr,"__esModule",{value:!0});const e=t(hf());class r extends e.default{select(o){let s=!1;const i=(o??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(o,{ascending:s=!0,nullsFirst:i,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${o}.${s?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:s,referencedTable:i=s}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${o}`),this}range(o,s,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${o}`),this.url.searchParams.set(c,`${s-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:o=!1,verbose:s=!1,settings:i=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[o?"analyze":null,s?"verbose":null,i?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),h=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${h}"; options=${d};`,c==="json"?this:this}rollback(){var o;return((o=this.headers.Prefer)!==null&&o!==void 0?o:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Rr.default=r,Rr}var hc;function Ya(){if(hc)return Tr;hc=1;var t=Tr&&Tr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Tr,"__esModule",{value:!0});const e=t(ff());class r extends e.default{eq(o,s){return this.url.searchParams.append(o,`eq.${s}`),this}neq(o,s){return this.url.searchParams.append(o,`neq.${s}`),this}gt(o,s){return this.url.searchParams.append(o,`gt.${s}`),this}gte(o,s){return this.url.searchParams.append(o,`gte.${s}`),this}lt(o,s){return this.url.searchParams.append(o,`lt.${s}`),this}lte(o,s){return this.url.searchParams.append(o,`lte.${s}`),this}like(o,s){return this.url.searchParams.append(o,`like.${s}`),this}likeAllOf(o,s){return this.url.searchParams.append(o,`like(all).{${s.join(",")}}`),this}likeAnyOf(o,s){return this.url.searchParams.append(o,`like(any).{${s.join(",")}}`),this}ilike(o,s){return this.url.searchParams.append(o,`ilike.${s}`),this}ilikeAllOf(o,s){return this.url.searchParams.append(o,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(o,s){return this.url.searchParams.append(o,`ilike(any).{${s.join(",")}}`),this}is(o,s){return this.url.searchParams.append(o,`is.${s}`),this}in(o,s){const i=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(o,`in.(${i})`),this}contains(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cs.{${s.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(s)}`),this}containedBy(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cd.{${s.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(s)}`),this}rangeGt(o,s){return this.url.searchParams.append(o,`sr.${s}`),this}rangeGte(o,s){return this.url.searchParams.append(o,`nxl.${s}`),this}rangeLt(o,s){return this.url.searchParams.append(o,`sl.${s}`),this}rangeLte(o,s){return this.url.searchParams.append(o,`nxr.${s}`),this}rangeAdjacent(o,s){return this.url.searchParams.append(o,`adj.${s}`),this}overlaps(o,s){return typeof s=="string"?this.url.searchParams.append(o,`ov.${s}`):this.url.searchParams.append(o,`ov.{${s.join(",")}}`),this}textSearch(o,s,{config:i,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=i===void 0?"":`(${i})`;return this.url.searchParams.append(o,`${l}fts${c}.${s}`),this}match(o){return Object.entries(o).forEach(([s,i])=>{this.url.searchParams.append(s,`eq.${i}`)}),this}not(o,s,i){return this.url.searchParams.append(o,`not.${s}.${i}`),this}or(o,{foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${o})`),this}filter(o,s,i){return this.url.searchParams.append(o,`${s}.${i}`),this}}return Tr.default=r,Tr}var fc;function pf(){if(fc)return Ar;fc=1;var t=Ar&&Ar.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ar,"__esModule",{value:!0});const e=t(Ya());class r{constructor(o,{headers:s={},schema:i,fetch:a}){this.url=o,this.headers=s,this.schema=i,this.fetch=a}select(o,{head:s=!1,count:i}={}){const a=s?"HEAD":"GET";let l=!1;const c=(o??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),i&&(this.headers.Prefer=`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(o,{count:s,defaultToNull:i=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(o)){const c=o.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}upsert(o,{onConflict:s,ignoreDuplicates:i=!1,count:a,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${i?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(o)){const d=o.reduce((h,p)=>h.concat(Object.keys(p)),[]);if(d.length>0){const h=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}update(o,{count:s}={}){const i="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}delete({count:o}={}){const s="DELETE",i=[];return o&&i.push(`count=${o}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Ar.default=r,Ar}var _n={},Sn={},pc;function lx(){return pc||(pc=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.version=void 0,Sn.version="0.0.0-automated"),Sn}var gc;function cx(){if(gc)return _n;gc=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.DEFAULT_HEADERS=void 0;const t=lx();return _n.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${t.version}`},_n}var mc;function ux(){if(mc)return Er;mc=1;var t=Er&&Er.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Er,"__esModule",{value:!0});const e=t(pf()),r=t(Ya()),n=cx();class o{constructor(i,{headers:a={},schema:l,fetch:c}={}){this.url=i,this.headers=Object.assign(Object.assign({},n.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new o(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:l=!1,get:c=!1,count:u}={}){let d;const h=new URL(`${this.url}/rpc/${i}`);let p;l||c?(d=l?"HEAD":"GET",Object.entries(a).filter(([m,v])=>v!==void 0).map(([m,v])=>[m,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([m,v])=>{h.searchParams.append(m,v)})):(d="POST",p=a);const y=Object.assign({},this.headers);return u&&(y.Prefer=`count=${u}`),new r.default({method:d,url:h,headers:y,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return Er.default=o,Er}var yc;function dx(){if(yc)return _e;yc=1;var t=_e&&_e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(_e,"__esModule",{value:!0}),_e.PostgrestError=_e.PostgrestBuilder=_e.PostgrestTransformBuilder=_e.PostgrestFilterBuilder=_e.PostgrestQueryBuilder=_e.PostgrestClient=void 0;const e=t(ux());_e.PostgrestClient=e.default;const r=t(pf());_e.PostgrestQueryBuilder=r.default;const n=t(Ya());_e.PostgrestFilterBuilder=n.default;const o=t(ff());_e.PostgrestTransformBuilder=o.default;const s=t(hf());_e.PostgrestBuilder=s.default;const i=t(df());return _e.PostgrestError=i.default,_e.default={PostgrestClient:e.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:s.default,PostgrestError:i.default},_e}var hx=dx();const fx=Kn(hx),{PostgrestClient:px,PostgrestQueryBuilder:AP,PostgrestFilterBuilder:TP,PostgrestTransformBuilder:RP,PostgrestBuilder:OP,PostgrestError:IP}=fx;function gx(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const mx=gx(),yx="2.11.15",vx=`realtime-js/${yx}`,wx="1.0.0",gf=1e4,bx=1e3;var $n;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})($n||($n={}));var Ce;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Ce||(Ce={}));var Ye;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Ye||(Ye={}));var Ji;(function(t){t.websocket="websocket"})(Ji||(Ji={}));var sr;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(sr||(sr={}));class xx{constructor(){this.HEADER_LENGTH=1}decode(e,r){return e.constructor===ArrayBuffer?r(this._binaryDecode(e)):r(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const r=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,r,n)}_decodeBroadcast(e,r,n){const o=r.getUint8(1),s=r.getUint8(2);let i=this.HEADER_LENGTH+2;const a=n.decode(e.slice(i,i+o));i=i+o;const l=n.decode(e.slice(i,i+s));i=i+s;const c=JSON.parse(n.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class mf{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var fe;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(fe||(fe={}));const vc=(t,e,r={})=>{var n;const o=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((s,i)=>(s[i]=_x(i,t,e,o),s),{})},_x=(t,e,r,n)=>{const o=e.find(a=>a.name===t),s=o?.type,i=r[t];return s&&!n.includes(s)?yf(s,i):Yi(i)},yf=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return Px(e,r)}switch(t){case fe.bool:return Sx(e);case fe.float4:case fe.float8:case fe.int2:case fe.int4:case fe.int8:case fe.numeric:case fe.oid:return kx(e);case fe.json:case fe.jsonb:return Cx(e);case fe.timestamp:return Ex(e);case fe.abstime:case fe.date:case fe.daterange:case fe.int4range:case fe.int8range:case fe.money:case fe.reltime:case fe.text:case fe.time:case fe.timestamptz:case fe.timetz:case fe.tsrange:case fe.tstzrange:return Yi(e);default:return Yi(e)}},Yi=t=>t,Sx=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},kx=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},Cx=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},Px=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let s;const i=t.slice(1,r);try{s=JSON.parse("["+i+"]")}catch{s=i?i.split(","):[]}return s.map(a=>yf(e,a))}return t},Ex=t=>typeof t=="string"?t.replace(" ","T"):t,vf=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class qs{constructor(e,r,n={},o=gf){this.channel=e,this.event=r,this.payload=n,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var wc;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(wc||(wc={}));class zn{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=zn.syncState(this.state,o,s,i),this.pendingDiffs.forEach(l=>{this.state=zn.syncDiff(this.state,l,s,i)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=zn.syncDiff(this.state,o,s,i),a())}),this.onJoin((o,s,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:s,newPresences:i})}),this.onLeave((o,s,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:s,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,o){const s=this.cloneDeep(e),i=this.transformState(r),a={},l={};return this.map(s,(c,u)=>{i[c]||(l[c]=u)}),this.map(i,(c,u)=>{const d=s[c];if(d){const h=u.map(v=>v.presence_ref),p=d.map(v=>v.presence_ref),y=u.filter(v=>p.indexOf(v.presence_ref)<0),m=d.filter(v=>h.indexOf(v.presence_ref)<0);y.length>0&&(a[c]=y),m.length>0&&(l[c]=m)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},n,o)}static syncDiff(e,r,n,o){const{joins:s,leaves:i}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),o||(o=()=>{}),this.map(s,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(p=>p.presence_ref),h=u.filter(p=>d.indexOf(p.presence_ref)<0);e[a].unshift(...h)}n(a,u,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,o(a,c,l),c.length===0&&delete e[a]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const o=e[n];return"metas"in o?r[n]=o.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):r[n]=o,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var bc;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(bc||(bc={}));var xc;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(xc||(xc={}));var bt;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(bt||(bt={}));class Za{constructor(e,r={config:{}},n){this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=Ce.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new qs(this,Ye.join,this.params,this.timeout),this.rejoinTimer=new mf(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ce.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ce.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Ce.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ce.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ye.reply,{},(o,s)=>{this._trigger(this._replyEventName(s),o)}),this.presence=new zn(this),this.broadcastEndpointURL=vf(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,r=this.timeout){var n,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Ce.closed){const{config:{broadcast:s,presence:i,private:a}}=this.params;this._onError(u=>e?.(bt.CHANNEL_ERROR,u)),this._onClose(()=>e?.(bt.CLOSED));const l={},c={broadcast:s,presence:i,postgres_changes:(o=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){e?.(bt.SUBSCRIBED);return}else{const h=this.bindings.postgres_changes,p=(d=h?.length)!==null&&d!==void 0?d:0,y=[];for(let m=0;m<p;m++){const v=h[m],{filter:{event:w,schema:_,table:b,filter:x}}=v,k=u&&u[m];if(k&&k.event===w&&k.schema===_&&k.table===b&&k.filter===x)y.push(Object.assign(Object.assign({},v),{id:k.id}));else{this.unsubscribe(),this.state=Ce.errored,e?.(bt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(bt.SUBSCRIBED);return}}).receive("error",u=>{this.state=Ce.errored,e?.(bt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e?.(bt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this._on(e,r,n)}async send(e,r={}){var n,o;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var i,a,l;const c=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ce.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ye.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(o=>{n=new qs(this,Ye.leave,{},e),n.receive("ok",()=>{r(),o("ok")}).receive("timeout",()=>{r(),o("timed out")}).receive("error",()=>{o("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,r,n){const o=new AbortController,s=setTimeout(()=>o.abort(),n),i=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:o.signal}));return clearTimeout(s),i}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new qs(this,e,r,n);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var o,s;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=Ye;if(n&&[a,l,c,u].indexOf(i)>=0&&n!==this._joinRef())return;let h=this._onMessage(i,r,n);if(r&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(p=>{var y,m,v;return((y=p.filter)===null||y===void 0?void 0:y.event)==="*"||((v=(m=p.filter)===null||m===void 0?void 0:m.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(p=>p.callback(h,n)):(s=this.bindings[i])===null||s===void 0||s.filter(p=>{var y,m,v,w,_,b;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in p){const x=p.id,k=(y=p.filter)===null||y===void 0?void 0:y.event;return x&&((m=r.ids)===null||m===void 0?void 0:m.includes(x))&&(k==="*"||k?.toLocaleLowerCase()===((v=r.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const x=(_=(w=p?.filter)===null||w===void 0?void 0:w.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return x==="*"||x===((b=r?.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===i}).map(p=>{if(typeof h=="object"&&"ids"in h){const y=h.data,{schema:m,table:v,commit_timestamp:w,type:_,errors:b}=y;h=Object.assign(Object.assign({},{schema:m,table:v,commit_timestamp:w,eventType:_,new:{},old:{},errors:b}),this._getPayloadRecords(y))}p.callback(h,n)})}_isClosed(){return this.state===Ce.closed}_isJoined(){return this.state===Ce.joined}_isJoining(){return this.state===Ce.joining}_isLeaving(){return this.state===Ce.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const o=e.toLocaleLowerCase(),s={type:o,filter:r,callback:n};return this.bindings[o]?this.bindings[o].push(s):this.bindings[o]=[s],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(o=>{var s;return!(((s=o.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===n&&Za.isEqual(o.filter,r))}),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ye.close,{},e)}_onError(e){this._on(Ye.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ce.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=vc(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=vc(e.columns,e.old_record)),r}}const _c=()=>{},Ax=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Tx{constructor(e,r){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=gf,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=_c,this.ref=0,this.logger=_c,this.conn=null,this.sendBuffer=[],this.serializer=new xx,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>Bt(async()=>{const{default:l}=await Promise.resolve().then(()=>pn);return{default:l}},void 0).then(({default:l})=>l(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${Ji.websocket}`,this.httpEndpoint=vf(e),r?.transport?this.transport=r.transport:this.transport=null,r?.params&&(this.params=r.params),r?.timeout&&(this.timeout=r.timeout),r?.logger&&(this.logger=r.logger),(r?.logLevel||r?.log_level)&&(this.logLevel=r.logLevel||r.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),r?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=r.heartbeatIntervalMs);const o=(n=r?.params)===null||n===void 0?void 0:n.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=r?.reconnectAfterMs?r.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=r?.encode?r.encode:(s,i)=>i(JSON.stringify(s)),this.decode=r?.decode?r.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new mf(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(r?.fetch),r?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=r?.worker||!1,this.workerUrl=r?.workerUrl}this.accessToken=r?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=mx),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:wx}))}disconnect(e,r){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,r??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(n=>n.teardown()))}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case $n.connecting:return sr.Connecting;case $n.open:return sr.Open;case $n.closing:return sr.Closing;default:return sr.Closed}}isConnected(){return this.connectionState()===sr.Open}channel(e,r={config:{}}){const n=`realtime:${e}`,o=this.getChannels().find(s=>s.topic===n);if(o)return o;{const s=new Za(`realtime:${e}`,r,this);return this.channels.push(s),s}}push(e){const{topic:r,event:n,payload:o,ref:s}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${r} ${n} (${s})`,o),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let r=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const o={access_token:r,version:vx};r&&n.updateJoinPayload(o),n.joinedOnce&&n._isJoined()&&n._push(Ye.access_token,{access_token:r})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(bx,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,r=>{let{topic:n,event:o,payload:s,ref:i}=r;n==="phoenix"&&o==="phx_reply"&&this.heartbeatCallback(r.payload.status=="ok"?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${n} ${o} ${i&&"("+i+")"||""}`,s),Array.from(this.channels).filter(a=>a._isMember(n)).forEach(a=>a._trigger(o,s,i)),this.stateChangeCallbacks.message.forEach(a=>a(r))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(r=>r(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(r=>r(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ye.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",o=new URLSearchParams(r);return`${e}${n}${o}`}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([Ax],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}}class Qa extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Se(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class Rx extends Qa{constructor(e,r){super(e),this.name="StorageApiError",this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Zi extends Qa{constructor(e,r){super(e),this.name="StorageUnknownError",this.originalError=r}}var Ox=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const wf=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Bt(async()=>{const{default:n}=await Promise.resolve().then(()=>pn);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},Ix=()=>Ox(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Bt(()=>Promise.resolve().then(()=>pn),void 0)).Response:Response}),Qi=t=>{if(Array.isArray(t))return t.map(r=>Qi(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const o=r.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[o]=Qi(n)}),e};var xr=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const Vs=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),jx=(t,e,r)=>xr(void 0,void 0,void 0,function*(){const n=yield Ix();t instanceof n&&!r?.noResolveJson?t.json().then(o=>{e(new Rx(Vs(o),t.status||500))}).catch(o=>{e(new Zi(Vs(o),o))}):e(new Zi(Vs(t),t))}),$x=(t,e,r,n)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n&&(o.body=JSON.stringify(n)),Object.assign(Object.assign({},o),r))};function to(t,e,r,n,o,s){return xr(this,void 0,void 0,function*(){return new Promise((i,a)=>{t(r,$x(e,n,o,s)).then(l=>{if(!l.ok)throw l;return n?.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>jx(l,a,n))})})}function Jo(t,e,r,n){return xr(this,void 0,void 0,function*(){return to(t,"GET",e,r,n)})}function Nt(t,e,r,n,o){return xr(this,void 0,void 0,function*(){return to(t,"POST",e,n,o,r)})}function zx(t,e,r,n,o){return xr(this,void 0,void 0,function*(){return to(t,"PUT",e,n,o,r)})}function Nx(t,e,r,n){return xr(this,void 0,void 0,function*(){return to(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function bf(t,e,r,n,o){return xr(this,void 0,void 0,function*(){return to(t,"DELETE",e,n,o,r)})}var Ie=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const Lx={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Sc={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Dx{constructor(e,r={},n,o){this.url=e,this.headers=r,this.bucketId=n,this.fetch=wf(o)}uploadOrUpdate(e,r,n,o){return Ie(this,void 0,void 0,function*(){try{let s;const i=Object.assign(Object.assign({},Sc),o);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&n instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",n)):typeof FormData<"u"&&n instanceof FormData?(s=n,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=n,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));const c=this._removeEmptyFolders(r),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:s,headers:a},i?.duplex?{duplex:i.duplex}:{})),h=yield d.json();return d.ok?{data:{path:c,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(s){if(Se(s))return{data:null,error:s};throw s}})}upload(e,r,n){return Ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,r,n)})}uploadToSignedUrl(e,r,n,o){return Ie(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),i=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",r);try{let l;const c=Object.assign({upsert:Sc.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),h=yield d.json();return d.ok?{data:{path:s,fullPath:h.Key},error:null}:{data:null,error:h}}catch(l){if(Se(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,r){return Ie(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const o=Object.assign({},this.headers);r?.upsert&&(o["x-upsert"]="true");const s=yield Nt(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:o}),i=new URL(this.url+s.url),a=i.searchParams.get("token");if(!a)throw new Qa("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}update(e,r,n){return Ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,r,n)})}move(e,r,n){return Ie(this,void 0,void 0,function*(){try{return{data:yield Nt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}copy(e,r,n){return Ie(this,void 0,void 0,function*(){try{return{data:{path:(yield Nt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrl(e,r,n){return Ie(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),s=yield Nt(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:r},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${i}`)},{data:s,error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrls(e,r,n){return Ie(this,void 0,void 0,function*(){try{const o=yield Nt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:e},{headers:this.headers}),s=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${s}`):null})),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}download(e,r){return Ie(this,void 0,void 0,function*(){const o=typeof r?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(r?.transform||{}),i=s?`?${s}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Jo(this.fetch,`${this.url}/${o}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Se(a))return{data:null,error:a};throw a}})}info(e){return Ie(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{const n=yield Jo(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:Qi(n),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}exists(e){return Ie(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{return yield Nx(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Se(n)&&n instanceof Zi){const o=n.originalError;if([400,404].includes(o?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,r){const n=this._getFinalPath(e),o=[],s=r?.download?`download=${r.download===!0?"":r.download}`:"";s!==""&&o.push(s);const a=typeof r?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(r?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${c}`)}}}remove(e){return Ie(this,void 0,void 0,function*(){try{return{data:yield bf(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}list(e,r,n){return Ie(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},Lx),r),{prefix:e||""});return{data:yield Nt(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},n),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const r=[];return e.width&&r.push(`width=${e.width}`),e.height&&r.push(`height=${e.height}`),e.resize&&r.push(`resize=${e.resize}`),e.format&&r.push(`format=${e.format}`),e.quality&&r.push(`quality=${e.quality}`),r.join("&")}}const Mx="2.7.1",Bx={"X-Client-Info":`storage-js/${Mx}`};var Ir=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class Fx{constructor(e,r={},n){this.url=e,this.headers=Object.assign(Object.assign({},Bx),r),this.fetch=wf(n)}listBuckets(){return Ir(this,void 0,void 0,function*(){try{return{data:yield Jo(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Se(e))return{data:null,error:e};throw e}})}getBucket(e){return Ir(this,void 0,void 0,function*(){try{return{data:yield Jo(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}createBucket(e,r={public:!1}){return Ir(this,void 0,void 0,function*(){try{return{data:yield Nt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}updateBucket(e,r){return Ir(this,void 0,void 0,function*(){try{return{data:yield zx(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}emptyBucket(e){return Ir(this,void 0,void 0,function*(){try{return{data:yield Nt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}deleteBucket(e){return Ir(this,void 0,void 0,function*(){try{return{data:yield bf(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}}class Ux extends Fx{constructor(e,r={},n){super(e,r,n)}from(e){return new Dx(this.url,this.headers,e,this.fetch)}}const Hx="2.51.0";let Pn="";typeof Deno<"u"?Pn="deno":typeof document<"u"?Pn="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Pn="react-native":Pn="node";const Wx={"X-Client-Info":`supabase-js-${Pn}/${Hx}`},Gx={headers:Wx},qx={schema:"public"},Vx={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Kx={};var Xx=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const Jx=t=>{let e;return t?e=t:typeof fetch>"u"?e=cf:e=fetch,(...r)=>e(...r)},Yx=()=>typeof Headers>"u"?uf:Headers,Zx=(t,e,r)=>{const n=Jx(r),o=Yx();return(s,i)=>Xx(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:t;let c=new o(i?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(s,Object.assign(Object.assign({},i),{headers:c}))})};var Qx=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};function e0(t){return t.endsWith("/")?t:t+"/"}function t0(t,e){var r,n;const{db:o,auth:s,realtime:i,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,h={db:Object.assign(Object.assign({},l),o),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(r=d?.headers)!==null&&r!==void 0?r:{}),(n=a?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>Qx(this,void 0,void 0,function*(){return""})};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}const xf="2.71.0",Fr=30*1e3,ea=3,Ks=ea*Fr,r0="http://localhost:9999",n0="supabase.auth.token",o0={"X-Client-Info":`gotrue-js/${xf}`},ta="X-Supabase-Api-Version",_f={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},s0=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,i0=10*60*1e3;class el extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function J(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class a0 extends el{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function l0(t){return J(t)&&t.name==="AuthApiError"}class Sf extends el{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class Jt extends el{constructor(e,r,n,o){super(e,n,o),this.name=r,this.status=n}}class zt extends Jt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function c0(t){return J(t)&&t.name==="AuthSessionMissingError"}class xo extends Jt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class _o extends Jt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class So extends Jt{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function u0(t){return J(t)&&t.name==="AuthImplicitGrantRedirectError"}class kc extends Jt{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ra extends Jt{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function Xs(t){return J(t)&&t.name==="AuthRetryableFetchError"}class Cc extends Jt{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class na extends Jt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Yo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Pc=` 	
\r=`.split(""),d0=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Pc.length;e+=1)t[Pc[e].charCodeAt(0)]=-2;for(let e=0;e<Yo.length;e+=1)t[Yo[e].charCodeAt(0)]=e;return t})();function Ec(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(Yo[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(Yo[n]),e.queuedBits-=6}}function kf(t,e,r){const n=d0[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Ac(t){const e=[],r=i=>{e.push(String.fromCodePoint(i))},n={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},s=i=>{p0(i,n,r)};for(let i=0;i<t.length;i+=1)kf(t.charCodeAt(i),o,s);return e.join("")}function h0(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function f0(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&n<=56319){const o=(n-55296)*1024&65535;n=(t.charCodeAt(r+1)-56320&65535|o)+65536,r+=1}h0(n,e)}}function p0(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let n=1;n<6;n+=1)if((t>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function g0(t){const e=[],r={queue:0,queuedBits:0},n=o=>{e.push(o)};for(let o=0;o<t.length;o+=1)kf(t.charCodeAt(o),r,n);return new Uint8Array(e)}function m0(t){const e=[];return f0(t,r=>e.push(r)),new Uint8Array(e)}function y0(t){const e=[],r={queue:0,queuedBits:0},n=o=>{e.push(o)};return t.forEach(o=>Ec(o,r,n)),Ec(null,r,n),e.join("")}function v0(t){return Math.round(Date.now()/1e3)+t}function w0(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const Je=()=>typeof window<"u"&&typeof document<"u",Qt={tested:!1,writable:!1},Cf=()=>{if(!Je())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Qt.tested)return Qt.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Qt.tested=!0,Qt.writable=!0}catch{Qt.tested=!0,Qt.writable=!1}return Qt.writable};function b0(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((o,s)=>{e[s]=o})}catch{}return r.searchParams.forEach((n,o)=>{e[o]=n}),e}const Pf=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Bt(async()=>{const{default:n}=await Promise.resolve().then(()=>pn);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},x0=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Ur=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},er=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Ot=async(t,e)=>{await t.removeItem(e)};class hs{constructor(){this.promise=new hs.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}hs.promiseConstructor=Promise;function Js(t){const e=t.split(".");if(e.length!==3)throw new na("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!s0.test(e[n]))throw new na("JWT not in base64url format");return{header:JSON.parse(Ac(e[0])),payload:JSON.parse(Ac(e[1])),signature:g0(e[2]),raw:{header:e[0],payload:e[1]}}}async function _0(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function S0(t,e){return new Promise((n,o)=>{(async()=>{for(let s=0;s<1/0;s++)try{const i=await t(s);if(!e(s,null,i)){n(i);return}}catch(i){if(!e(s,i)){o(i);return}}})()})}function k0(t){return("0"+t.toString(16)).substr(-2)}function C0(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let o="";for(let s=0;s<56;s++)o+=r.charAt(Math.floor(Math.random()*n));return o}return crypto.getRandomValues(e),Array.from(e,k0).join("")}async function P0(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),o=new Uint8Array(n);return Array.from(o).map(s=>String.fromCharCode(s)).join("")}async function E0(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await P0(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function jr(t,e,r=!1){const n=C0();let o=n;r&&(o+="/PASSWORD_RECOVERY"),await Ur(t,`${e}-code-verifier`,o);const s=await E0(n);return[s,n===s?"plain":"s256"]}const A0=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function T0(t){const e=t.headers.get(ta);if(!e||!e.match(A0))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function R0(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function O0(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const I0=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function $r(t){if(!I0.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ys(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}var j0=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};const rr=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),$0=[502,503,504];async function Tc(t){var e;if(!x0(t))throw new ra(rr(t),0);if($0.includes(t.status))throw new ra(rr(t),t.status);let r;try{r=await t.json()}catch(s){throw new Sf(rr(s),s)}let n;const o=T0(t);if(o&&o.getTime()>=_f["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new Cc(rr(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new zt}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((s,i)=>s&&typeof i=="string",!0))throw new Cc(rr(r),t.status,r.weak_password.reasons);throw new a0(rr(r),t.status||500,n)}const z0=(t,e,r,n)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(n),Object.assign(Object.assign({},o),r))};async function ne(t,e,r,n){var o;const s=Object.assign({},n?.headers);s[ta]||(s[ta]=_f["2024-01-01"].name),n?.jwt&&(s.Authorization=`Bearer ${n.jwt}`);const i=(o=n?.query)!==null&&o!==void 0?o:{};n?.redirectTo&&(i.redirect_to=n.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await N0(t,e,r+a,{headers:s,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(l):{data:Object.assign({},l),error:null}}async function N0(t,e,r,n,o,s){const i=z0(e,n,o,s);let a;try{a=await t(r,Object.assign({},i))}catch(l){throw console.error(l),new ra(rr(l),0)}if(a.ok||await Tc(a),n?.noResolveJson)return a;try{return await a.json()}catch(l){await Tc(l)}}function wt(t){var e;let r=null;B0(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=v0(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function Rc(t){const e=wt(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Lt(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function L0(t){return{data:t,error:null}}function D0(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:o,verification_type:s}=t,i=j0(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:r,hashed_token:n,redirect_to:o,verification_type:s},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function M0(t){return t}function B0(t){return t.access_token&&t.refresh_token&&t.expires_in}const Zs=["global","local","others"];var F0=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};class U0{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=Pf(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,r=Zs[0]){if(Zs.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Zs.join(", ")}`);try{return await ne(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(J(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await ne(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Lt})}catch(n){if(J(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=F0(e,["options"]),o=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(o.new_email=n?.newEmail,delete o.newEmail),await ne(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:D0,redirectTo:r?.redirectTo})}catch(r){if(J(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await ne(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Lt})}catch(r){if(J(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,o,s,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await ne(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(s=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""},xform:M0});if(u.error)throw u.error;const d=await u.json(),h=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,p=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(y=>{const m=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(y.split(";")[1].split("=")[1]);c[`${v}Page`]=m}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(J(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){$r(e);try{return await ne(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Lt})}catch(r){if(J(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){$r(e);try{return await ne(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:Lt})}catch(n){if(J(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){$r(e);try{return await ne(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:Lt})}catch(n){if(J(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){$r(e.userId);try{const{data:r,error:n}=await ne(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:r,error:n}}catch(r){if(J(r))return{data:null,error:r};throw r}}async _deleteFactor(e){$r(e.userId),$r(e.id);try{return{data:await ne(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(J(r))return{data:null,error:r};throw r}}}function Oc(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}function H0(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const zr={debug:!!(globalThis&&Cf()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Ef extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class W0 extends Ef{}async function G0(t,e,r){zr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),zr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async o=>{if(o){zr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await r()}finally{zr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(e===0)throw zr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new W0(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(zr.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}H0();const q0={url:r0,storageKey:n0,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:o0,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ic(t,e,r){return await r()}const Nr={};class Gn{constructor(e){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Gn.nextInstanceID,Gn.nextInstanceID+=1,this.instanceID>0&&Je()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},q0),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new U0({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Pf(o.fetch),this.lock=o.lock||Ic,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:Je()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=G0:this.lock=Ic,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:Cf()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Oc(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=Oc(this.memoryStorage)),Je()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,r;return(r=(e=Nr[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Nr[this.storageKey]=Object.assign(Object.assign({},Nr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Nr[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Nr[this.storageKey]=Object.assign(Object.assign({},Nr[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${xf}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const r=b0(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),Je()&&this.detectSessionInUrl&&n!=="none"){const{data:o,error:s}=await this._getSessionFromURL(r,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),u0(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:i,redirectType:a}=o;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return J(r)?{error:r}:{error:new Sf("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,o;try{const s=await ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:wt}),{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(J(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var r,n,o;try{let s;if("email"in e){const{email:u,password:d,options:h}=e;let p=null,y=null;this.flowType==="pkce"&&([p,y]=await jr(this.storage,this.storageKey)),s=await ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h?.emailRedirectTo,body:{email:u,password:d,data:(r=h?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:p,code_challenge_method:y},xform:wt})}else if("phone"in e){const{phone:u,password:d,options:h}=e;s=await ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(n=h?.data)!==null&&n!==void 0?n:{},channel:(o=h?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:wt})}else throw new _o("You must provide either an email or phone number and a password");const{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(J(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let r;if("email"in e){const{email:s,password:i,options:a}=e;r=await ne(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Rc})}else if("phone"in e){const{phone:s,password:i,options:a}=e;r=await ne(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Rc})}else throw new _o("You must provide either an email or phone number and a password");const{data:n,error:o}=r;return o?{data:{user:null,session:null},error:o}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new xo}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:o})}catch(r){if(J(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,n,o,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;if(r==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(e){var r,n,o,s,i,a,l,c,u,d,h,p;let y,m;if("message"in e)y=e.message,m=e.signature;else{const{chain:v,wallet:w,statement:_,options:b}=e;let x;if(Je())if(typeof w=="object")x=w;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))x=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=w}const k=new URL((r=b?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in x&&x.signIn){const C=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b?.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),_?{statement:_}:null));let S;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")S=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)S=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)y=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),m=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${k.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(o=(n=b?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=b?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((i=b?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((a=b?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((c=b?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((d=(u=b?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...b.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const C=await x.signMessage(new TextEncoder().encode(y),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=C}}try{const{data:v,error:w}=await ne(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:y0(m)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:wt});if(w)throw w;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new xo}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:w})}catch(v){if(J(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const r=await er(this.storage,`${this.storageKey}-code-verifier`),[n,o]=(r??"").split("/");try{const{data:s,error:i}=await ne(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:wt});if(await Ot(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new xo}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:i})}catch(s){if(J(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:r,provider:n,token:o,access_token:s,nonce:i}=e,a=await ne(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:o,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:wt}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new xo}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(r){if(J(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,n,o,s,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await jr(this.storage,this.storageKey));const{error:d}=await ne(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=l?.data)!==null&&r!==void 0?r:{},create_user:(n=l?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await ne(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(o=l?.data)!==null&&o!==void 0?o:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(i=l?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new _o("You must provide either an email or phone number.")}catch(a){if(J(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var r,n;try{let o,s;"options"in e&&(o=(r=e.options)===null||r===void 0?void 0:r.redirectTo,s=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:i,error:a}=await ne(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:wt});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(J(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var r,n,o;try{let s=null,i=null;return this.flowType==="pkce"&&([s,i]=await jr(this.storage,this.storageKey)),await ne(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:i}),headers:this.headers,xform:L0})}catch(s){if(J(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new zt;const{error:o}=await ne(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(J(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:o,options:s}=e,{error:i}=await ne(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:n,type:o,options:s}=e,{data:i,error:a}=await ne(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:a}}throw new _o("You must provide either an email or phone number and a type")}catch(r){if(J(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await er(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Ks:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const i=await er(this.userStorage,this.storageKey+"-user");i?.user?e.user=i.user:e.user=Ys()}if(this.storage.isServer&&e.user){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ne(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Lt}):await this._useSession(async r=>{var n,o,s;const{data:i,error:a}=r;if(a)throw a;return!(!((n=i.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new zt}:await ne(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:Lt})})}catch(r){if(J(r))return c0(r)&&(await this._removeSession(),await Ot(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:o,error:s}=n;if(s)throw s;if(!o.session)throw new zt;const i=o.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await jr(this.storage,this.storageKey));const{data:c,error:u}=await ne(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Lt});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(n){if(J(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new zt;const r=Date.now()/1e3;let n=r,o=!0,s=null;const{payload:i}=Js(e.access_token);if(i.exp&&(n=i.exp,o=n<=r),o){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(r){if(J(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:i,error:a}=r;if(a)throw a;e=(n=i.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new zt;const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(J(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!Je())throw new So("No browser detected.");if(e.error||e.error_description||e.error_code)throw new So(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new kc("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new So("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new kc("No code detected.");const{data:_,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:o,access_token:s,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!i||!c)throw new So("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let h=u+d;l&&(h=parseInt(l));const p=h-u;p*1e3<=Fr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const y=h-d;u-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,h,u):u-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,h,u);const{data:m,error:v}=await this._getUser(s);if(v)throw v;const w={provider_token:n,provider_refresh_token:o,access_token:s,expires_in:d,expires_at:h,refresh_token:i,token_type:c,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(n){if(J(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await er(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:o,error:s}=r;if(s)return{error:s};const i=(n=o.session)===null||n===void 0?void 0:n.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(l0(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Ot(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const r=w0(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,o;try{const{data:{session:s},error:i}=r;if(i)throw i;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,r={}){let n=null,o=null;this.flowType==="pkce"&&([n,o]=await jr(this.storage,this.storageKey,!0));try{return await ne(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:o,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(s){if(J(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(J(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{const{data:n,error:o}=await this._useSession(async s=>{var i,a,l,c,u;const{data:d,error:h}=s;if(h)throw h;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await ne(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(o)throw o;return Je()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(J(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,o;const{data:s,error:i}=r;if(i)throw i;return await ne(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0})})}catch(r){if(J(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await S0(async o=>(o>0&&await _0(200*Math.pow(2,o-1)),this._debug(r,"refreshing attempt",o),await ne(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:wt})),(o,s)=>{const i=200*Math.pow(2,o);return s&&Xs(s)&&Date.now()+i-n<Fr})}catch(n){if(this._debug(r,"error",n),J(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),Je()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const o=await er(this.storage,this.storageKey);if(o&&this.userStorage){let i=await er(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:o.user},await Ur(this.userStorage,this.storageKey+"-user",i)),o.user=(e=i?.user)!==null&&e!==void 0?e:Ys()}else if(o&&!o.user&&!o.user){const i=await er(this.storage,this.storageKey+"-user");i&&i?.user?(o.user=i.user,await Ot(this.storage,this.storageKey+"-user"),await Ur(this.storage,this.storageKey,o)):o.user=Ys()}if(this._debug(n,"session from storage",o),!this._isValidSession(o)){this._debug(n,"session is not valid"),o!==null&&await this._removeSession();return}const s=((r=o.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Ks;if(this._debug(n,`session has${s?"":" not"} expired with margin of ${Ks}s`),s){if(this.autoRefreshToken&&o.refresh_token){const{error:i}=await this._callRefreshToken(o.refresh_token);i&&(console.error(i),Xs(i)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:a}=await this._getUser(o.access_token);!a&&i?.user?(o.user=i.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(n,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(n,"error",o),console.error(o);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new zt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new hs;const{data:s,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new zt;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(o,"error",s),J(s)){const i={session:null,error:s};return Xs(s)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(i),i}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,r,n=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const s=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,r)}catch(l){s.push(l)}});if(await Promise.all(i),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const r=Object.assign({},e),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Ur(this.userStorage,this.storageKey+"-user",{user:r.user});const o=Object.assign({},r);delete o.user;const s=structuredClone(o);await Ur(this.storage,this.storageKey,s)}else{const o=structuredClone(r);await Ur(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await Ot(this.storage,this.storageKey),await Ot(this.storage,this.storageKey+"-code-verifier"),await Ot(this.storage,this.storageKey+"-user"),this.userStorage&&await Ot(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Je()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Fr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((n.expires_at*1e3-e)/Fr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Fr}ms, refresh threshold is ${ea} ticks`),o<=ea&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ef)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Je()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const o=[`provider=${encodeURIComponent(r)}`];if(n?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&o.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[s,i]=await jr(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(i)}`});o.push(a.toString())}if(n?.queryParams){const s=new URLSearchParams(n.queryParams);o.push(s.toString())}return n?.skipBrowserRedirect&&o.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;return s?{data:null,error:s}:await ne(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(J(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,o;const{data:s,error:i}=r;if(i)return{data:null,error:i};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await ne(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((o=l?.totp)===null||o===void 0)&&o.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(r){if(J(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;if(s)return{data:null,error:s};const{data:i,error:a}=await ne(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(r){if(J(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;return s?{data:null,error:s}:await ne(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(J(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=e?.factors||[],o=n.filter(i=>i.factor_type==="totp"&&i.status==="verified"),s=n.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:n,totp:o,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,n;const{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Js(o.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((n=(r=o.user.factors)===null||r===void 0?void 0:r.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,r={keys:[]}){let n=r.keys.find(a=>a.kid===e);if(n)return n;const o=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+i0>o)return n;const{data:s,error:i}=await ne(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=o,n=s.keys.find(a=>a.kid===e),!n)?null:n}async getClaims(e,r={}){try{let n=e;if(!n){const{data:p,error:y}=await this.getSession();if(y||!p.session)return{data:null,error:y};n=p.session.access_token}const{header:o,payload:s,signature:i,raw:{header:a,payload:l}}=Js(n);r?.allowExpired||R0(s.exp);const c=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!c){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:s,header:o,signature:i},error:null}}const u=O0(o.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,i,m0(`${a}.${l}`)))throw new na("Invalid JWT signature");return{data:{claims:s,header:o,signature:i},error:null}}catch(n){if(J(n))return{data:null,error:n};throw n}}}Gn.nextInstanceID=0;const V0=Gn;class K0 extends V0{constructor(e){super(e)}}var X0=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class J0{constructor(e,r,n){var o,s,i;if(this.supabaseUrl=e,this.supabaseKey=r,!e)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const a=e0(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:qx,realtime:Kx,auth:Object.assign(Object.assign({},Vx),{storageKey:c}),global:Gx},d=t0(n??{},u);this.storageKey=(o=d.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=Zx(r,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new px(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new rx(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ux(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,r={},n={}){return this.rest.rpc(e,r,n)}channel(e,r={config:{}}){return this.realtime.channel(e,r)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,r;return X0(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&r!==void 0?r:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:o,storageKey:s,flowType:i,lock:a,debug:l},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new K0({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:s,autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:o,flowType:i,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Tx(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n?.access_token)})}_handleTokenChanged(e,r,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Y0=(t,e,r)=>new J0(t,e,r),Af=Y0("https://pkswdnpftrundnewgnya.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrc3dkbnBmdHJ1bmRuZXdnbnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODI2MzIsImV4cCI6MjA2ODI1ODYzMn0.r_Y1RLOGJ55C0De5SBTVXqO09SMDqgV38sQuE-oDxXE");var kn={},jc;function Z0(){if(jc)return kn;jc=1,kn.byteLength=a,kn.toByteArray=c,kn.fromByteArray=h;for(var t=[],e=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=n.length;o<s;++o)t[o]=n[o],e[n.charCodeAt(o)]=o;e[45]=62,e[95]=63;function i(p){var y=p.length;if(y%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=p.indexOf("=");m===-1&&(m=y);var v=m===y?0:4-m%4;return[m,v]}function a(p){var y=i(p),m=y[0],v=y[1];return(m+v)*3/4-v}function l(p,y,m){return(y+m)*3/4-m}function c(p){var y,m=i(p),v=m[0],w=m[1],_=new r(l(p,v,w)),b=0,x=w>0?v-4:v,k;for(k=0;k<x;k+=4)y=e[p.charCodeAt(k)]<<18|e[p.charCodeAt(k+1)]<<12|e[p.charCodeAt(k+2)]<<6|e[p.charCodeAt(k+3)],_[b++]=y>>16&255,_[b++]=y>>8&255,_[b++]=y&255;return w===2&&(y=e[p.charCodeAt(k)]<<2|e[p.charCodeAt(k+1)]>>4,_[b++]=y&255),w===1&&(y=e[p.charCodeAt(k)]<<10|e[p.charCodeAt(k+1)]<<4|e[p.charCodeAt(k+2)]>>2,_[b++]=y>>8&255,_[b++]=y&255),_}function u(p){return t[p>>18&63]+t[p>>12&63]+t[p>>6&63]+t[p&63]}function d(p,y,m){for(var v,w=[],_=y;_<m;_+=3)v=(p[_]<<16&16711680)+(p[_+1]<<8&65280)+(p[_+2]&255),w.push(u(v));return w.join("")}function h(p){for(var y,m=p.length,v=m%3,w=[],_=16383,b=0,x=m-v;b<x;b+=_)w.push(d(p,b,b+_>x?x:b+_));return v===1?(y=p[m-1],w.push(t[y>>2]+t[y<<4&63]+"==")):v===2&&(y=(p[m-2]<<8)+p[m-1],w.push(t[y>>10]+t[y>>4&63]+t[y<<2&63]+"=")),w.join("")}return kn}var Tf=Z0();const Rf="gzip",Q0=async t=>{const e=JSON.stringify(t),n=new TextEncoder().encode(e),o=new Blob([n]),s=new CompressionStream(Rf),i=o.stream().pipeThrough(s),a=await new Response(i).arrayBuffer(),l=new Uint8Array(a);return Tf.fromByteArray(l)},e_=async t=>{try{const e=Tf.toByteArray(t),r=new Blob([e]),n=new DecompressionStream(Rf),o=r.stream().pipeThrough(n),s=await new Response(o).text();return JSON.parse(s)}catch(e){throw new Error("error decompressing object",{cause:e})}},t_=async(t,e)=>{const r=await Af.from("campaigns").upsert([{name:t,data:await Q0(e)}]).select();if(r.error)throw new Error(`error saving to db ${r.error.details}`,{cause:r.error});return r.data},r_=async t=>{const e=await Af.from("campaigns").select("data").eq("name",t);if(e.error)throw e.error;const[r]=e.data;return await e_(r.data)},n_=()=>f.jsx(ht,{onClick:async()=>{const t=M.getState();await t_("sequel",Dg(t))},children:f.jsx(Xo,{icon:f.jsxs("div",{className:"flex flex-row items-center",children:[f.jsx("span",{className:"sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative"}),f.jsx("span",{className:"sprite texture-editor_tool_save relative"})]}),topText:"sa",bottomText:"ve"})}),o_=()=>f.jsx(ht,{onClick:async()=>{try{const t=await r_("sequel");console.log(t),M.dispatch(Mg({campaign:t}))}catch(t){console.error(t)}},children:f.jsx(Xo,{icon:f.jsxs("div",{className:"flex flex-row items-center",children:[f.jsx("span",{className:"sprite texture-editor_tool_save relative"}),f.jsx("span",{className:"sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative"})]}),topText:"lo",bottomText:"ad"})}),s_=()=>f.jsx(ht,{children:f.jsx(ie,{className:"relative leading-none",children:"MAP"})}),i_=()=>{const t=be(n=>n.levelEditor.campaignInProgress),e=be(n=>n.levelEditor.currentlyEditingRoomId),r=pt();return f.jsxs("div",{className:"scale-editor flex w-full h-full text-white bg-metallicBlueHalfbrite py-1 gap-1 flex-wrap justify-start overflow-auto",children:[f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full",children:"Campaign"}),f.jsx(n_,{}),f.jsx(o_,{}),f.jsx(s_,{}),f.jsx(of,{value:e,campaign:t,onSelect:n=>{r(Ei(n))},triggerButtonClassName:"w-full"})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full pt-2",children:"Room"}),f.jsx(Fb,{}),f.jsx(Bb,{}),f.jsx("div",{className:"h-1 w-full"}),f.jsx(Jb,{}),f.jsx(Yb,{})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full pt-2",children:"Edit"}),f.jsxs("div",{className:Pe,children:[f.jsx(Mb,{}),f.jsx(Zb,{})]}),f.jsx(Gb,{}),f.jsx(Lb,{}),f.jsx(Xb,{}),f.jsx("div",{className:"h-1 w-full"}),f.jsx(Db,{}),f.jsx(qb,{})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full pt-2",children:"Blocks"}),f.jsx($,{itemTool:{type:"block",config:{style:"organic"}},children:f.jsx("span",{className:`sprite texture-block_organic ${G}`})}),f.jsx($,{itemTool:{type:"block",config:{style:"organic",disappearing:{on:"stand"}}},children:f.jsx(wo,{iconClassName:me("texture-block_organic_disappearing")})}),f.jsx($,{itemTool:{type:"block",config:{style:"artificial"}},children:f.jsx("span",{className:`sprite texture-block_artificial ${G}`})}),f.jsx($,{itemTool:{type:"block",config:{style:"artificial",disappearing:{on:"stand"}}},children:f.jsx(wo,{iconClassName:me("texture-block_artificial_disappearing")})}),f.jsx($,{itemTool:{type:"block",config:{style:"tower"}},children:f.jsx("span",{className:`sprite texture-tower ${G}`})}),f.jsx($,{itemTool:{type:"block",config:{style:"book"}},children:f.jsx("span",{className:`sprite texture-book_x ${G}`})}),f.jsxs(xn,{children:[f.jsx($,{itemTool:{type:"barrier",config:{axis:"x"}},children:f.jsx("span",{className:`sprite texture-barrier_x ${G}`})}),f.jsx($,{itemTool:{type:"barrier",config:{axis:"y"}},children:f.jsx("span",{className:`sprite texture-barrier_y ${G}`})}),f.jsx($,{itemTool:{type:"barrier",config:{axis:"x",disappearing:{on:"touch"}}},children:f.jsx(wo,{iconClassName:me("texture-barrier_x")})}),f.jsx($,{itemTool:{type:"barrier",config:{axis:"y",disappearing:{on:"touch"}}},children:f.jsx(wo,{iconClassName:me("texture-barrier_y")})})]})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full",children:"Monsters"}),f.jsx($,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},children:f.jsx("span",{className:`sprite texture-dalek_1 [button:hover_&]:texture-animated-dalek" ${G}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},children:f.jsx(vt,{topClasses:"texture-cyberman_towards [button:hover_&]:texture-cyberman_right",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),f.jsx($,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-skiHead_greenAndPink_towards [button:hover_&]:texture-skiHead_greenAndPink_right ${G}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:f.jsx("span",{className:`sprite texture-helicopterBug_1 [button:hover_&]:texture-animated-helicopterBug ${G}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-turtle_towards_1 [button:hover_&]:texture-animated-turtle_right ${G}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},children:f.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase_all ${G}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},children:f.jsx(vt,{topClasses:"texture-computerBot_towards [button:hover_&]:texture-computerBot_right"})}),f.jsx($,{itemTool:{type:"monster",config:{which:"bubbleRobot",activated:"on",movement:"patrol-randomly-xy8"}},children:f.jsx(vt,{topClasses:me("texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"),bottomClasses:me("texture-headlessBase")})}),f.jsx($,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:f.jsx(vt,{topClasses:"texture-monkey_towards [button:hover_&]:texture-monkey_right"})}),f.jsx($,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},children:f.jsx(vt,{topClasses:"texture-elephant_towards [button:hover_&]:texture-elephant_right"})}),f.jsx($,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-elephant_towards [button:hover_&]:texture-elephant_right ${G}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",children:f.jsx(vt,{topClasses:"texture-ball",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),f.jsx($,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},children:f.jsx("span",{className:`sprite texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold ${G}`})})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full",children:"Pickups"}),f.jsxs(xn,{children:[f.jsx($,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:f.jsx(Rt,{iconClasses:"texture-whiteRabbit",text:"2"})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"shield"}},children:f.jsx(Rt,{iconClasses:"texture-whiteRabbit",text:"🛡"})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"jumps"}},children:f.jsx(Rt,{iconClasses:"texture-whiteRabbit",text:"♨"})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"fast"}},children:f.jsx(Rt,{iconClasses:"texture-whiteRabbit",text:"⚡"})})]}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"bag"}},children:f.jsx("span",{className:`sprite texture-bag ${G}`})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"hooter"}},children:f.jsx("span",{className:`sprite texture-hooter ${G}`})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:f.jsx("span",{className:`sprite texture-doughnuts ${G}`})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:f.jsx("span",{className:`sprite texture-crown_blacktooth ${G}`})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"scroll",page:"blacktooth"}},children:f.jsx("span",{className:`sprite texture-scroll ${G}`})})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full",children:"deadly"}),f.jsxs(xn,{children:[f.jsx($,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},children:f.jsx("span",{className:`sprite texture-volcano_1 [button:hover_&]:texture-animated-volcano ${G}`})}),f.jsx($,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},children:f.jsx("span",{className:`sprite texture-toaster_off ${G}`})})]}),f.jsx($,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},children:f.jsx("span",{className:`sprite texture-spikyBall_1 [button:hover_&]:texture-spikyBall_2 ${G}`})}),f.jsx($,{itemTool:{type:"spikes",config:pe},children:f.jsx("span",{className:`sprite texture-spikes ${G}`})})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full",children:"control"}),f.jsx($,{itemTool:{type:"charles",config:pe},children:f.jsx(vt,{topClasses:"texture-charles_towards [button:hover_&]:texture-charles_right"})}),f.jsx($,{itemTool:{type:"joystick",config:{controls:["(placeholder)"]}},children:f.jsx("span",{className:`sprite texture-joystick ${G}`})}),f.jsx($,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:Gu}},children:f.jsx("span",{className:`sprite texture-switch_left [button:hover_&]:texture-switch_right ${G}`})})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full",children:"movable"}),f.jsx($,{itemTool:{type:"spring",config:{}},children:f.jsx("span",{className:`sprite texture-spring_released [button:hover_&]:texture-spring_compressed ${G}`})}),f.jsxs(xn,{children:[f.jsx($,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:f.jsx("span",{className:`sprite texture-cube ${G}`})}),f.jsx($,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:f.jsx("span",{className:`sprite texture-drum ${G}`})}),f.jsx($,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:f.jsx("span",{className:`sprite texture-sticks ${G}`})})]}),f.jsx($,{itemTool:{type:"pushableBlock",config:{}},children:f.jsx("span",{className:`sprite texture-stepStool ${G}`})}),f.jsx($,{itemTool:{type:"ball",config:pe},children:f.jsx("span",{className:`sprite texture-ball ${G}`})}),f.jsx($,{itemTool:{type:"slidingBlock",config:{style:"puck"}},children:f.jsx("span",{className:`sprite texture-puck ${G}`})}),f.jsx($,{itemTool:{type:"slidingBlock",config:{style:"book"}},children:f.jsx("span",{className:`sprite texture-book_y ${G}`})})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full",children:"misc."}),f.jsxs($,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[f.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_static ${G} [button:active_&]:top-oneScaledPix`}),f.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_1 [button:hover_&]:texture-animated-lift ${G} [button:active_&]:top-oneScaledPix`})]}),f.jsxs(xn,{children:[f.jsx($,{itemTool:{type:"conveyor",config:{direction:"away"}},children:f.jsx(Rt,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-conveyor_y",text:"↗"})}),f.jsx($,{itemTool:{type:"conveyor",config:{direction:"towards"}},children:f.jsx(Rt,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-reversed-conveyor_y",text:"↙"})}),f.jsx($,{itemTool:{type:"conveyor",config:{direction:"left"}},children:f.jsx(Rt,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-conveyor_x",text:"↖"})}),f.jsx($,{itemTool:{type:"conveyor",config:{direction:"right"}},children:f.jsx(Rt,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-reversed-conveyor_x",text:"↘"})})]}),f.jsx($,{itemTool:{type:"teleporter",config:{toRoom:"to?",toPosition:le}},children:f.jsx("span",{className:`sprite texture-teleporter ${G}`})}),f.jsx($,{itemTool:{type:"movingPlatform",config:{movement:"clockwise",activated:"on",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-sandwich ${G}`})}),f.jsx($,{itemTool:{type:"hushPuppy",config:{}},children:f.jsx("span",{className:`sprite texture-hushPuppy ${G}`})})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full",children:"Structure"}),f.jsx(Vb,{}),f.jsx(Kb,{}),f.jsx($,{itemTool:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:{x:1,y:1}}},children:f.jsx("span",{className:`sprite texture-blacktooth_floor ${G}`})})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full",children:"Player"}),f.jsx($,{itemTool:{type:"player",config:{which:"head"}},children:f.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${G}`})}),f.jsx($,{itemTool:{type:"player",config:{which:"heels"}},children:f.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${G}`})})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full",children:"NPC’s"}),f.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"head",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${G}`})}),f.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"heels",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${G}`})}),f.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"headOverHeels",startDirection:"towards"}},children:f.jsx(vt,{topClasses:"texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right",bottomClasses:"texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right"})})]}),f.jsxs("div",{className:Pe,children:[f.jsx(ie,{className:"w-full pt-2",children:"debug"}),f.jsx(Nb,{})]})]})},sn=(t,e)=>({get bottomCentre(){return this.c000},get topLeft(){return this.c101},get topRight(){return this.c011},get c000(){return Q(t)},get c001(){return Q(B(t,{z:e.z}))},get c010(){return Q(B(t,{y:e.y}))},get c011(){return Q(B(t,{y:e.y,z:e.z}))},get c100(){return Q(B(t,{x:e.x}))},get c101(){return Q(B(t,{x:e.x,z:e.z}))},get c110(){return Q(B(t,{x:e.x,y:e.y}))},get c111(){return Q(B(t,{x:e.x,y:e.y,z:e.z}))},projectCorner(r){return Q(B(t,{x:r.x*e.x,y:r.y*e.y,z:r.z*e.z}))}}),Qs=1e-5,$c=-1,Cn=(t,e,r,n,o)=>n-o>t&&r<e-o,a_=0,Of=1,If=2,jf=3,l_=(t,e,r,n)=>{const{topLeft:o,topRight:s,bottomCentre:i}=sn(t,e),{topLeft:a,topRight:l,bottomCentre:c}=sn(r,n),u=s.y-s.x/2,d=i.y-i.x/2,h=l.y-l.x/2,p=c.y-c.x/2,y=o.y+o.x/2,m=i.y+i.x/2,v=a.y+a.x/2,w=c.y+c.x/2,_=o.x,b=s.x,x=a.x,k=l.x,C=Cn(u,d,h,p,Qs),S=Cn(y,m,v,w,Qs),j=Cn(_,b,x,k,Qs);return C&&S&&j?Of:S&&j&&Cn(u,d,h,p,$c)?If:C&&j&&Cn(y,m,v,w,$c)?jf:a_},c_=(t,e,r,n)=>{for(const o of Zp){const s=t[o],i=s+e[o],a=r[o],l=a+n[o];if(i<=a)return 1*(o==="z"?-1:1);if(s>=l)return-1*(o==="z"?-1:1)}return zc(r)-zc(t)},u_=(t,e)=>{if(t.fixedZIndex!==void 0||e.fixedZIndex!==void 0)return 0;const r=t.renderAabb||t.aabb,n=e.renderAabb||e.aabb,o=t.renderAabbOffset?B(t.state.position,t.renderAabbOffset):t.state.position,s=e.renderAabbOffset?B(e.state.position,e.renderAabbOffset):e.state.position;switch(l_(o,r,s,n)){case Of:return c_(o,r,s,n);case If:return Et(o.y,s.y+n.y)&&Et(o.z,s.z+n.z)?1:Et(s.y,o.y+r.y)&&Et(s.z,o.z+r.z)?-1:0;case jf:return Et(o.x,s.x+n.x)&&Et(o.z,s.z+n.z)?1:Et(s.x,o.x+r.x)&&Et(s.z,o.z+r.z)?-1:0;default:return 0}},zc=t=>t.x+t.y-t.z;class No extends Error{constructor(e,r,n){super(`CyclicDependencyError: .cyclicDependency property of this error has nodes as an array. ${e.join(" -> ")}`,n),this.cyclicDependency=e,this.hasClosedCycle=r}}const d_=t=>{const e=h_(t);let r=e.length,n=r;const o=new Array(r),s={},i=f_(e);for(;n--;)s[n]||a(e[n],n,new Set);return o;function a(l,c,u){if(u.has(l))throw new No([l],!1);if(s[c])return;s[c]=!0;const d=t.get(l)||new Set,h=Array.from(d);if(c=h.length){u.add(l);do{const p=h[--c];try{a(p,i.get(p),u)}catch(y){throw y instanceof No?y.hasClosedCycle?y:new No([l,...y.cyclicDependency],y.cyclicDependency.includes(l)):y}}while(c);u.delete(l)}o[--r]=l}};function h_(t){const e=new Set;for(const[r,n]of t.entries()){e.add(r);for(const o of n)e.add(o)}return Array.from(e)}function f_(t){const e=new Map;for(let r=0,n=t.length;r<n;r++)e.set(t[r],r);return e}const Nc=(t,e,r)=>{t.has(e)||t.set(e,new Set),t.get(e).add(r)},ko=(t,e,r)=>{const n=t.get(e);n!==void 0&&(n?.delete(r),n.size===0&&t.delete(e))},$f=(t,e=new Set(Bo(t)),r=new Map)=>{const n=new Map;for(const[o,s]of r)if(!t[o])r.delete(o);else for(const i of s)t[i]||ko(r,o,i);for(const o of e)if(o.fixedZIndex===void 0)for(const s of Bo(t)){if(s.fixedZIndex!==void 0||n.get(s)?.has(o)||o===s)continue;const i=u_(o,s);if(Nc(n,o,s),i===0){ko(r,o.id,s.id),ko(r,s.id,o.id);continue}const a=i>0?o.id:s.id,l=i>0?s.id:o.id;Nc(r,a,l),ko(r,l,a)}return r},tl=(t,e,r=3)=>{try{return{order:d_(t),impossible:!1}}catch(n){if(n instanceof No){const o=n.cyclicDependency;return t.get(o[0])?.delete(o[1]),console.warn("cyclc dependency detected: ",o.join(" --front-of--> "),`breaking link ${o[0]} --front-of--> ${o[1]}`),{order:tl(t,e,r-1).order,impossible:!0}}else throw n}};class p_{constructor(e,r){this.renderContext=e,this.appearance=r,this.output=new ee({label:"AppearanceRenderer"})}#e;output;destroy(){this.output.destroy({children:!0})}tick(e){const r=this.appearance({renderContext:this.renderContext,currentRendering:this.#e,tickContext:e});r!=="no-update"&&(this.output.children.at(0)!==r.output&&(this.#e?.output&&this.output.removeChild(this.#e.output),r.output!==void 0&&this.output.addChild(r.output)),this.#e=r)}}class zf extends p_{}const Lc=(t,e)=>{e.poly([Q({}),Q({x:t.x}),Q({x:t.x,y:t.y}),Q({y:t.y})]).poly([Q({}),Q({z:t.z}),Q({y:t.y,z:t.z}),Q({y:t.y})]).poly([Q({x:t.x}),Q({x:t.x,z:t.z}),Q(t),Q({x:t.x,y:t.y})]).poly([Q({z:t.z}),Q({x:t.x,z:t.z}),Q({x:t.x,y:t.y,z:t.z}),Q({y:t.y,z:t.z})])},Dc=(t,e)=>{const r=new lt;return Lc(t,r),r.stroke({width:.5,color:e,alpha:1}),r.eventMode="static",r.on("pointerenter",()=>{r.fill({color:e,alpha:.5})}),r.on("pointerleave",()=>{r.clear(),Lc(t,r),r.stroke({width:.5,color:e,alpha:1})}),r},g_={head:"rgba(255,184,0)",wall:"rgba(128,200,0)",portal:"rgba(255,0,255)",pickup:"rgba(0,196,255)",emitter:"rgba(0,255,255)",stopAutowalk:"rgba(255,128,128)",floatingText:"rgba(128,0,255)"};class m_{constructor(e){this.renderContext=e;const{item:r}=e,n=g_[r.type]??"rgba(255,255,255)";if(this.#e=new ee({label:`ItemBoundingBoxRenderer ${r.id}`}),Jn("portal")(r)){const s=Q(r.config.relativePoint);this.#e.addChild(new lt().circle(s.x,s.y,5).stroke(n)),this.#e.addChild(new lt().circle(s.x,s.y,2).fill(n))}if(this.#e.addChild(new lt({label:"objectOrigin"}).circle(0,0,2).fill(n)),this.#e.addChild(Dc(r.aabb,n)),r.renderAabb){const s="rgba(184, 184, 255)",i=Dc(r.renderAabb,s);if(r.renderAabbOffset){const a=Q(r.renderAabbOffset);i.position.set(a.x,a.y),i.circle(0,0,2).fill(s)}this.#e.addChild(i)}this.#e.eventMode="static";let o;this.#e.on("pointerenter",()=>{if(o!==void 0)return;const s=`${r.id} ${r.type}
@(${r.state.position.x}, ${r.state.position.y}, ${r.state.position.z})}
#(${r.aabb.x}, ${r.aabb.y}, ${r.aabb.z})}`;this.#e.addChild(o=new Sm({text:s,style:{fill:n,fontSize:6,fontFamily:"Menlo"}})),o.resolution=4}),this.#e.on("pointerleave",()=>{o!==void 0&&(this.#e.removeChild(o),o=void 0)}),e.frontLayer.attach(this.#e)}#e;tick(){}destroy(){this.#e.destroy({children:!0})}get output(){return this.#e}}class y_{constructor(e,r){this.renderContext=e,this.wrappedRenderer=r,this.#e=new ee({label:`ItemPositionRenderer ${e.item.id}`,children:[r.output]}),this.#t()}#e;#t(){const e=Q(this.renderContext.item.state.position);this.#e.x=e.x,this.#e.y=e.y}tick(e){this.wrappedRenderer?.tick(e),e.movedItems.has(this.renderContext.item)&&this.#t()}destroy(){this.#e.destroy({children:!0}),this.wrappedRenderer?.destroy()}get output(){return this.#e}}const fs=({aabb:t,state:{position:e}},{aabb:r,state:{position:n}})=>!(e.x+t.x<=n.x||e.x>=n.x+r.x)&&!(e.y+t.y<=n.y||e.y>=n.y+r.y)&&!(e.z+t.z<=n.z||e.z>=n.z+r.z),v_=(t,e)=>[...Kt(e).filter(r=>t.id!==r.id&&fs(t,r))];function*Nf(t,e){for(const r of e)t.id!==r.id&&fs(t,r)&&(yield r)}const Mc=Qp/1e3,Lf={firedDoughnut:2*Mc,floatingText:Mc},ro=11,Bc=6e4,w_=9999,b_=8,x_=750,__=2500,Fc=200,S_=.15,Df=50,Uc={x:.5,y:1},Hc=t=>typeof t!="string"&&Object.hasOwn(t,"animationId"),oa=t=>{if(typeof t=="string")return oa({textureId:t});{const{anchor:e,flipX:r,pivot:n,x:o,y:s,filter:i,times:a,label:l}=t;let c;if(Hc(t)?c=k_(t):c=new an(Ft().textures[t.textureId]),t.hasOwnProperty("times")){const u={x:1,y:1,z:1,...a},d=new ee({label:l??"timesXyz"});for(let{x:h}=u;h>=1;h--)for(let{y:p}=u;p>=1;p--)for(let y=1;y<=u.z;y++){const m={...t,textureId:t.textureId??t.textureIdCallback?.(h-1,p-1,y-1),label:`(${h},${p},${y})`};delete m.times;const v=oa(m),w=dr({x:h-1,y:p-1,z:y-1});v.x+=w.x,v.y+=+w.y,d.addChild(v)}return d}if(e===void 0&&n===void 0)if(Hc(t))c.anchor=Uc;else{const u=Ft().data.frames[t.textureId];if(u===void 0)throw new Error(`no spritesheet entry for textureId "${t.textureId}"`);const d=u.frame;d.pivot!==void 0?c.pivot=d.pivot:c.anchor=Uc}else e!==void 0&&(c.anchor=e),n!==void 0&&(c.pivot=n);return o!==void 0&&(c.x=o),s!==void 0&&(c.y=s),i!==void 0&&(c.filters=i),l!==void 0&&(c.label=l),c.eventMode="static",r===!0&&(c.scale.x=-1),c}},F=oa;function k_({animationId:t,reverse:e,playOnce:r,paused:n,randomiseStartFrame:o}){const s=Ft().animations[t],a=(n?[s[0]]:s).map(c=>({texture:c,time:eg}));e&&a.reverse();const l=new Fn(a);return l.animationSpeed=vr.animations[t].animationSpeed,l.gotoAndPlay(o?Math.floor(Math.random()*a.length):0),r!==void 0&&(l.loop=!1,l.onComplete=()=>{l.stop(),r==="and-destroy"&&(l.visible=!1)}),l}const Mf=(t,e)=>{const r=e.getLocalBounds(),n=Ca.create({width:r.maxX-r.minX,height:r.maxY-r.minY});return e.x-=r.minX,e.y-=r.minY,t.render({container:e,target:n}),new an({texture:n,label:"shadowMaskSprite (of renderTexture)",pivot:{x:-r.minX,y:-r.minY}})},ps=(t,e,r)=>{const n=r&&{x:r.x??1,y:r.y??1},o=F({...typeof e=="string"?{textureId:e}:e,times:n});return o instanceof an?o:Mf(t,o)},It=t=>Ae(({renderContext:{item:e}})=>ed(e)?F({...typeof t=="string"?{textureId:t}:t,times:xa(e)}):F(t)),He=t=>Ae(({renderContext:{item:e,general:{pixiRenderer:r}}})=>{if(ed(e))return ps(r,t,xa(e));{const n=F(t);return n instanceof an?n:Mf(r,n)}}),Ae=t=>({renderContext:e,currentRendering:r,tickContext:n})=>r===void 0?{output:t({renderContext:e,currentRendering:void 0,tickContext:n}),renderProps:pe}:"no-update",jt=t=>({renderContext:{general:{pixiRenderer:e},item:r},currentRendering:n})=>{if(n===void 0){const o=xa(r),s={output:ps(e,t(r.config),o),renderProps:pe};return o&&(s.output.y-=((o.z??1)-1)*X.h),s}else return"no-update"},Ee={x:12,y:12,z:X.h},C_={x:14,y:14,z:X.h},ir={x:16,y:16,z:X.h},ei={...Ee,z:X.h*2},Bf=t=>{switch(t.type){case"spring":case"portableBlock":case"moveableDeadly":case"slidingDeadly":case"firedDoughnut":return{aabb:Ee};case"slidingBlock":return t.config.style==="book"?{aabb:ir}:{aabb:Ee};case"lift":return{aabb:{...Ee,z:Ee.z}};case"switch":return{aabb:{...Ee,z:Ee.z}};case"pickup":return t.config.gives==="scroll"?{aabb:{x:16,y:4,z:13}}:{aabb:Ee};case"charles":return{aabb:ei};case"ball":return{aabb:{x:12,y:12,z:12}};case"pushableBlock":case"movingPlatform":return{aabb:ir};case"block":switch(t.config.style){case"artificial":case"organic":case"book":return{aabb:ir};case"tower":return{aabb:{x:11,y:11,z:X.h}};default:throw new Error("unknown block style")}case"monster":switch(t.config.which){case"skiHead":return{aabb:{...Ee,z:21}};case"bubbleRobot":case"cyberman":case"elephant":case"emperorsGuardian":case"monkey":case"computerBot":return{aabb:ei};case"helicopterBug":case"dalek":case"emperor":case"homingBot":case"elephantHead":return{aabb:Ee};case"turtle":return{aabb:Ee};default:throw t.config,new Error("unknown monster type")}case"deadlyBlock":case"spikes":return{aabb:ir};case"bubbles":return{aabb:Ee};case"conveyor":case"hushPuppy":case"teleporter":return{aabb:ir};case"barrier":return{aabb:t.config.axis==="y"?{x:3,y:15,z:X.h}:{x:15,y:3,z:X.h}};case"sceneryPlayer":return t.config.which==="headOverHeels"?{aabb:ei}:{aabb:Ee};case"emitter":return{aabb:le};default:return{aabb:C_}}},Ze={aabb:Ee},P_=({config:{direction:t},position:e})=>t==="right"&&e.x===0||t==="towards"&&e.y===0,ti={x:1,y:0,z:0},ri={x:-1,y:0,z:0},ni={x:0,y:-1,z:0},oi={x:0,y:1,z:0},Ge={away:oi,left:ti,right:ri,towards:ni,down:{x:0,y:0,z:-1},up:{x:0,y:0,z:1},awayRight:io(B(oi,ri)),towardsRight:io(B(ni,ri)),towardsLeft:io(B(ni,ti)),awayLeft:io(B(oi,ti))},sa=t=>{const e=we(t.position),{aabb:r}=Bf(t);if(r===void 0)throw new Error(`item type= ${t.type} config=${JSON.stringify(t.config)} has no bounding box`);return t.type==="wall"?e:B(e,{x:X.w-r.x>>1,y:X.d-r.y>>1})},je=()=>({expires:null,stoodOnBy:{},disappearing:null,switchedAtRoomTime:ke,stoodOnUntilRoomTime:ke}),Wc=()=>({standingOnItemId:null,vels:{gravity:le,movingFloor:le},latentMovement:[],actedOnAt:{roomTime:ke,by:pe},collidedWith:{roomTime:ke,by:pe}}),E_=t=>{const e=Bg.includes(t.type);return{...je(),position:sa(t),...e?{standingOnItemId:null,vels:{gravity:le,movingFloor:le,...Fg.includes(t.type)?{sliding:le}:{},...t.type==="monster"||t.type==="movingPlatform"?{walking:le}:{}},latentMovement:[],actedOnAt:{roomTime:ke,by:pe},collidedWith:{roomTime:ke,by:pe}}:{},...t.type==="monster"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",timeOfLastDirectionChange:Number.NEGATIVE_INFINITY,...t.config.which==="skiHead"||t.config.which==="turtle"||t.config.which==="elephantHead"||t.config.which==="cyberman"?{facing:Ge[t.config.startDirection]}:{facing:Ge.towards}}:{},...t.type==="pickup"?{disappearing:{on:"touch",byType:t.config.gives==="bag"||t.config.gives==="jumps"?["heels","headOverHeels"]:t.config.gives==="doughnuts"||t.config.gives==="hooter"||t.config.gives==="fast"?["head","headOverHeels"]:["head","heels","headOverHeels"]}}:{},...t.type==="movingPlatform"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",facing:Ge[t.config.startDirection]}:{},...t.type==="switch"?{setting:t.config.initialSetting,touchedOnProgression:-1}:{},...t.type==="block"?{disappearing:t.config.disappearing??null}:{},...t.type==="conveyor"?{disappearing:t.config.disappearing??null}:{},...t.type==="barrier"?{disappearing:t.config.disappearing??null}:{},...t.type==="lift"?{direction:"up",vels:{lift:le}}:{},...t.type==="charles"?{facing:Ge.towards}:{},...t.type==="emitter"?{lastEmittedAtRoomTime:ke,quantityEmitted:0}:{},...t.type==="firedDoughnut"?{disappearing:{on:"touch"},vels:{fired:t.config.direction?ts(Ge[t.config.direction],Lf.firedDoughnut):le}}:{}}},si=X.h*2,Ff=4,En=X.h*Ff,A_=2,T_=2*X.w;function*R_(t,e){const{config:{direction:r},position:n}=t,o=Xn(r),s=cn(o),i=P_(t),a={...le,[s]:i?-.5:0},l=1,c={[s]:i?-1:0},u=l*X.w,d={...le,[s]:u},h=9,p=8,y=8;{const m={[o]:p,[s]:y,z:En};yield{...t,...Ze,type:"doorFrame",id:`${e}/frameFar`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"far"},state:{...je(),position:we(B(n,{[o]:1.5},a,c)),stoodOnBy:pe},aabb:B(m,d),renderAabb:m,renderAabbOffset:i?d:void 0}}{const m={[o]:h,[s]:y,z:En};yield{...t,...Ze,type:"doorFrame",id:`${e}/frameNear`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"near"},state:{...je(),position:we(B(n,a,c)),stoodOnBy:pe},aabb:B(m,d),renderAabb:m,renderAabbOffset:i?d:void 0}}{const m={[o]:2*X.w-h-p,[s]:y,z:En-si};yield{...t,...Ze,type:"doorFrame",id:`${e}/frameTop`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"top"},state:{...je(),position:B(we(B(n,a,c)),{[o]:h,z:si}),stoodOnBy:pe},aabb:B(m,d),renderAabb:m,renderAabbOffset:i?d:void 0}}yield{...t,...Ze,type:"blocker",id:`${e}/blockerAbove`,jsonItemId:e,config:{},renders:!1,state:{...je(),position:B(we(B(n,a)),{z:En}),stoodOnBy:pe},aabb:we({[o]:2,[s]:.5,z:ro-Ff-n.z}),renderAabb:le,fixedZIndex:lr},yield{...t,...Ze,type:"portal",id:`${e}/portal`,jsonItemId:e,config:{...t.config,inHidden:i,relativePoint:we({...le,[s]:i?.25:-.25}),direction:Ge[r]},fixedZIndex:lr,state:{...je(),position:B(we(B(n,{[s]:i?-.5:.5})),{[o]:h}),stoodOnBy:pe},aabb:{[o]:A_*X.w-h-p,[s]:0,z:si}},n.z!==0&&(yield{...t,...Ze,type:"doorLegs",id:`${e}/legs`,jsonItemId:e,config:{...t.config,inHiddenWall:i,style:"none",side:"away",height:n.z},renders:!0,shadowCastTexture:i?{textureId:"shadow.door.floatingThreshold.double.y",flipX:o==="x"}:void 0,state:{...je(),position:{...we(B(n,a,c)),z:0}},aabb:B(we({[o]:2,[s]:.5,z:n.z}),d),renderAabb:i?B(we({[o]:2,[s]:.5,z:.5})):void 0,renderAabbOffset:i?B({[o]:0,[s]:0,z:(n.z-.5)*X.h},{[s]:d[s]}):void 0,shadowOffset:{z:n.z*X.h,[s]:i?d[s]:void 0}}),yield{type:"stopAutowalk",id:`${e}/stopAutowalk`,jsonItemId:e,aabb:we({[o]:2,[s]:0,z:2}),config:{},fixedZIndex:lr,state:{...je(),position:we(qu(n,ts(Ge[r],.75))),stoodOnBy:pe}}}const Gc={config:pe,shadowCastTexture:"shadow.smallRound",aabb:Ee},qc=()=>{const t=rg(M.getState());return{action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:Ge.towards,walkStartFacing:Ge.towards,walkDistance:0,vels:{walking:le,gravity:le,movingFloor:le},switchedToAt:ke,lastDiedAt:ke,gameTime:0,jumpStartTime:ke,lives:t?"infinite":b_,jumpStartZ:0}},O_=(t,e)=>{const r=tg(M.getState());return t.config.which==="head"?{id:"head",jsonItemId:e,type:"head",...Ze,...Gc,state:{...je(),...Wc(),...qc(),hasHooter:!1,gameWalkDistance:0,fastStepsStartedAtDistance:ke,shieldCollectedAt:ke,doughnuts:r?"infinite":0,position:sa(t),stoodOnUntilRoomTime:ke}}:{id:"heels",jsonItemId:e,type:"heels",...Ze,...Gc,state:{...je(),...Wc(),...qc(),carrying:null,hasBag:!1,bigJumps:0,isBigJump:!1,shieldCollectedAt:ke,position:sa(t),stoodOnUntilRoomTime:ke}}},Uf=1,I_=(t=ro)=>({x:X.w,y:X.d*Uf,z:t*X.h}),j_={x:X.w,y:0,z:Df},$_=(t=ro)=>({x:X.w*Uf,y:X.d,z:t*X.h}),z_={x:0,y:X.d,z:Df},N_=(t,e,r)=>{const{config:{direction:n},position:o}=e,s=_a(e.config),{size:{z:i}}=r,a=Xn(n),l=cn(a),c=n==="towards"||n==="right",u={...le,[l]:c?-1:0};return{type:"wall",id:t,jsonItemId:t,config:e.config,aabb:Mn(a==="y"?$_(i):I_(i),s),renderAabb:c?le:Mn(a==="y"?z_:j_,s),fixedZIndex:c?lr:void 0,state:{...je(),position:we(B(o,u)),stoodOnBy:pe},shadowCastTexture:a==="y"?"shadow.wall.y":{textureId:"shadow.wall.y",flipX:!0}}},L_=3,Vc=10,Kc=.52,Xc=.5,D_=(t,e,r)=>{const{config:{times:n},position:o}=e,s=B(o,{z:-3}),i={...n,z:L_};let a=s,l=i;const c=Kt(Bo(r.items)).filter(h=>h.type==="door");if(o.z===0){const h={};for(const p of c){const{position:y,config:{direction:m}}=p;switch(m){case"towards":!h.towards&&y.y===s.y&&(l=B(l,{y:Xc}),a=B(a,{y:-.5}),h.towards=!0);break;case"away":!h.away&&y.y===s.y+n.y&&(l=B(l,{y:Kc}),h.away=!0);break;case"right":!h.right&&y.x===s.x&&(l=B(l,{x:Xc}),a=B(a,{x:-.5}),h.right=!0);break;case"left":!h.left&&y.x===s.x+n.x&&(l=B(l,{x:Kc}),h.left=!0);break}}}const u=we(a),d=Mn(ir,l);return{type:"floor",id:t,jsonItemId:t,config:{...e.config,naturalFootprint:{aabb:Mn(ir,i),position:we(s)}},aabb:d,renderAabb:{...d,z:Vc},renderAabbOffset:{...le,z:d.z-Vc},shadowCastTexture:"shadow.fullBlock",state:{...je(),position:u}}};function*rl(t,e,r,n=pe,o={}){if(!n[t]&&!(e.type==="pickup"&&e.config.gives==="scroll"&&o[e.config.page]))switch(e.type){case"door":return yield*R_(e,t);case"player":{yield O_(e,t);return}case"wall":{yield N_(t,e,r);return}case"floor":{yield D_(t,e,r);return}case"sceneryCrown":if(!M.getState().gameMenus.planetsLiberated[e.config.planet])return;default:{const s=Bf(e),i=e.config.times!==void 0?{aabb:Mn(s.aabb,e.config.times),renderAabb:void 0}:s;let a;try{a=E_(e)}catch(l){throw new Error(`loadItemFromJson: error creating initial state for jsonItem ${JSON.stringify(e,null,2)}`,{cause:l})}yield{...e,...Ze,...i,id:t,jsonItemId:t,fixedZIndex:e.type==="emitter"?lr:void 0,shadowCastTexture:M_(e),config:e.config,state:a}}}}const M_=t=>{switch(t.type){case"lift":return"shadow.smallBlock";case"conveyor":return{textureId:"shadow.fullBlock",flipX:Ut(t.config.direction)==="x"};case"barrier":return{textureId:"shadow.barrier.y",flipX:t.config.axis==="x"};case"spring":case"firedDoughnut":case"slidingDeadly":return"shadow.smallRound";case"block":return t.config.style==="tower"?"shadow.smallRound":"shadow.fullBlock";case"pushableBlock":case"movingPlatform":case"hushPuppy":case"deadlyBlock":case"teleporter":case"spikes":return"shadow.fullBlock";case"portableBlock":return t.config.style==="drum"?"shadow.smallRound":"shadow.smallBlock";case"pickup":return t.config.gives==="scroll"?"shadow.scroll":"shadow.smallRound";case"ball":case"charles":case"monster":return"shadow.smallRound";case"slidingBlock":return t.config.style==="book"?"shadow.fullBlock":"shadow.smallRound"}};function*B_(t){const e=t.size.z??ro,r=we({...t.size,z:1}),n=we({...cr,z:-1});if(t.roomBelow!==void 0&&(yield{...Ze,type:"portal",id:"floor/portal",fixedZIndex:lr,config:{toRoom:t.roomBelow,relativePoint:{x:r.x/2,y:r.y/2,z:r.z},direction:Ge.down},aabb:r,state:{...je(),position:n},renders:!1}),t.roomAbove!==void 0){const o=B(n,{z:X.h*e});yield{...Ze,type:"portal",id:"ceiling",fixedZIndex:lr,config:{toRoom:t.roomAbove,relativePoint:{...t.ceilingRelativePoint!==void 0?we(t.ceilingRelativePoint):{x:r.x/2,y:r.y/2},z:-12},direction:Ge.up},aabb:r,state:{...je(),position:o}}}}const F_=(t,e,r,n)=>{const o=Math.max(0,Math.min(t.x+e.x,r.x+n.x)-Math.max(t.x,r.x)),s=Math.max(0,Math.min(t.y+e.y,r.y+n.y)-Math.max(t.y,r.y));return o*s},Jc=({state:{position:t},aabb:e},{state:{position:r},aabb:n})=>F_(t,e,r,n),Yc={stopAutowalk:5,portal:5,wall:5,blocker:5,doorLegs:5,sceneryPlayer:5,bubbles:5,switch:10,doorFrame:15,ball:18,block:20,barrier:20,floor:20,hushPuppy:20,teleporter:20,lift:30,movingPlatform:30,pushableBlock:30,portableBlock:30,sceneryCrown:30,slidingBlock:30,spring:30,joystick:40,charles:40,conveyor:40,head:50,heels:50,headOverHeels:50,pickup:80,firedDoughnut:90,spikes:98,slidingDeadly:100,moveableDeadly:100,deadlyBlock:100,monster:100,floatingText:200,particle:200,emitter:200},U_=(t,e)=>Yc[t.type]-Yc[e.type],H_=(t,e,r=.001)=>{if(!Bn(e,t)||t.id===e.id)return!1;const{state:{vels:{gravity:{z:n}}}}=t;return n>0?!1:fs({state:{position:B(t.state.position,{x:0,y:0,z:-1e-4})},aabb:{...t.aabb,z:r+Vu},id:t.id},{state:{position:B(e.state.position,{x:0,y:0,z:e.aabb.z})},aabb:{...e.aabb,z:0},id:e.id})},W_=(t,e)=>{const n=[...Kt(e).filter(s=>H_(t,s))];return n.length===0?void 0:n.reduce((s,i)=>{const a=U_(i,s);return a<0||a===0&&Jc(t,i)>Jc(t,s)?i:s})},G_=({above:t,below:e})=>{t.state.standingOnItemId=e.id,e.state.stoodOnBy[t.id]=!0};function*q_(t,e,r,n){const o=og(t.items);for(const[s,i]of o)i.type==="player"&&!n||(yield*rl(s,i,t,e,r))}const Zc=t=>Kt(t).reduce((e,r)=>({...e,[r.id]:r}),{}),Qc=({roomJson:t,roomPickupsCollected:e,scrollsRead:r,isNewGame:n=!1})=>{const o={...Zc(B_(t)),...Zc(q_(t,e,r,n))};for(const i of Qe(o)){const l=v_(i,ng(o)).find(c=>Bn(i)&&Bn(c)&&!(i.type==="wall"&&c.type==="wall"));l!==void 0&&console.error(`in room ${t.id} item ${i.id} @${JSON.stringify(i.state.position)} #${JSON.stringify(i.aabb)} is colliding with (solid item) ${l.id} @${JSON.stringify(l.state.position)} #${JSON.stringify(l.aabb)} on loading room ${t.id}`)}for(const i of Qe(o).filter(Ug)){const a=W_(i,Qe(o).filter(l=>l.id!==i.id));a!==void 0&&G_({above:i,below:a})}return{...t,roomJson:t,items:o,roomTime:0}},no=(t,e)=>Kt(rs(t)).map(r=>{const n=e.items[r];if(n===void 0)throw new Error(`item in stoodOnBy "${r}" is not in the room`);return n});Jn("head");const V_=Jn("heels"),K_=Jn("headOverHeels"),X_=t=>{if(V_(t))return t.state;if(K_(t))return t.state.heels},J_=({room:t,item:e})=>(t.items[e.id]=e,e),Y_=1e3/25,Hf=t=>{const e=vr.animations[t],r=e.length,{animationSpeed:n}=e;return r*Y_/n};Hf("bubbles.white");Hf("head.fadeOut");const nl=({config:{activatedOnStoreValue:t}})=>t===void 0?!0:ga(M.getState(),t),Z_=({renderContext:{general:{pixiRenderer:t},item:e,room:r},currentRendering:n})=>{const{state:{stoodOnBy:o},config:{times:s}}=e,i=n?.renderProps,a=nl(e),l=a&&no(o,r).find(Sa)!==void 0;return i===void 0||a!==i.activated||l!==i.flashing?{output:ps(t,{textureId:l?"shadowMask.teleporter.flashing":a?"shadowMask.teleporter":"shadowMask.fullBlock"},s),renderProps:{flashing:l,activated:a}}:"no-update"},ii=(t,e=1)=>({renderContext:{item:{state:{facing:r}}},currentRendering:n})=>{const o=n?.renderProps,s=ma(r)??"towards";if(!(o===void 0||s!==o.facingXy4))return"no-update";const a=F(s==="left"||s==="away"?`shadowMask.${t}.away`:`shadowMask.${t}.right`);return a.y=-(X.h*(e-1)),a.scale.x=s==="away"||s==="right"?1:-1,{output:a,renderProps:{facingXy4:s}}},eu={lift:He("shadowMask.smallBlock"),conveyor:jt(({direction:t})=>({textureId:"shadowMask.conveyor",flipX:Ut(t)==="x"})),doorLegs:jt(({direction:t})=>({textureId:t==="right"||t==="towards"?"shadowMask.door.floatingThreshold.double.y":"shadowMask.door.legs.threshold.double.y",flipX:Ut(t)==="y"})),teleporter:Z_,floor:"no-mask",barrier:jt(({axis:t})=>({textureId:"shadowMask.barrier.y",flipX:t==="x"})),spring:He("shadowMask.smallRound"),block:jt(({style:t})=>t==="tower"?"shadowMask.tower":"shadowMask.fullBlock"),pushableBlock:He("shadowMask.stepStool"),movingPlatform:He("shadowMask.fullBlock"),hushPuppy:He("shadowMask.hushPuppy"),portableBlock:jt(({style:t})=>t==="drum"?"shadowMask.smallRound":"shadowMask.smallBlock"),slidingBlock:jt(({style:t})=>t==="book"?"shadowMask.fullBlock":"shadowMask.smallRound"),deadlyBlock:jt(({style:t})=>t==="volcano"?"shadowMask.volcano":"shadowMask.toaster"),spikes:He("shadowMask.spikes"),switch:He("shadowMask.switch"),pickup:jt(({gives:t})=>{switch(t){case"scroll":return"shadowMask.scroll";case"doughnuts":return"shadowMask.doughnuts";case"fast":case"extra-life":case"jumps":case"shield":return"shadowMask.whiteRabbit";default:return"blank"}}),slidingDeadly:He("shadowMask.smallRound"),ball:He("shadowMask.ball"),"monster.dalek":He("shadowMask.dalek"),"monster.turtle":ii("turtle"),"monster.skiHead":ii("skiHead"),"monster.homingBot":He("shadowMask.smallRound"),joystick:He("shadowMask.joystick"),charles:ii("charles",2)},Q_=t=>{switch(t.type){case"monster":return eu[`monster.${t.config.which}`];case"floor":return t.config.floorType==="none"?void 0:"no-mask";default:return eu[t.type]}},eS=new vm({alpha:1-jn});class tS{constructor(e,r){if(this.renderContext=e,this.#e.filters=eS,r!=="no-mask")if(this.#r=new zf(e,r),e.item.shadowOffset===void 0)this.#e.addChild(this.#r.output);else{const n=new ee({label:"shadowMaskOffset",...Q(e.item.shadowOffset),children:[this.#r.output]});this.#e.addChild(n)}this.#e.addChild(this.#t)}#e=new ee({label:"ItemShadowRenderer"});#t=new ee({label:"shadows"});#r;#n={};get#o(){return M.getState().gameMenus.userSettings.displaySettings.showShadowMasks}#s(e){if(this.#r===void 0)return;const r=this.#r.output.children.at(0);this.#r.tick(e);const n=this.#r.output.children.at(0);if(n===void 0||!(n instanceof an)){const{item:o}=this.renderContext;throw new Error(`ItemShadowRenderer: this.#shadowMaskRenderer didn't create a sprite for item "${o.id}" of type "${o.type}". Have got ${n}`)}r!==n&&(this.#o?this.renderContext.frontLayer.attach(n):this.#e.mask=n)}destroy(){this.#e.destroy(!0),this.#r?.destroy()}tick(e){if(this.#t.parent===null)throw new Error("shadow container not in scene graph");const{movedItems:r,progression:n}=e,{item:o,general:{pixiRenderer:s},room:i}=this.renderContext,a=r.has(o),l=o.state.position.z+o.aabb.z,c=Qe(i.items).filter(function(y){return y.shadowCastTexture!==void 0}),u={id:o.id,state:{position:{...o.state.position,z:l}},aabb:{...o.aabb,z:w_}},d=Object.groupBy(c,p=>{const y=this.#n[p.id]!==void 0,m=r.has(p);return!a&&!m?y?"keepUnchanged":"noShadow":fs(u,p)?y?"update":"create":"noShadow"});for(const p of _l(d.keepUnchanged,d.update))this.#n[p.id].renderedOnProgression=n;if(d.create)for(const p of d.create){const{times:y}=p.config,m=ps(s,p.shadowCastTexture,y);m.label=p.id,this.#t.addChild(m),this.#n[p.id]={sprite:m,renderedOnProgression:n}}for(const p of _l(d.create,d.update)){const{sprite:y}=this.#n[p.id],m=Q({...On(Qr(p.state.position,o.state.position),p.shadowOffset??cr),z:o.aabb.z});y.x=m.x,y.y=m.y}for(const[p,{sprite:y,renderedOnProgression:m}]of sg(this.#n))m!==n&&(y.destroy(),delete this.#n[p]);const h=(d.keepUnchanged?.length??0)+(d.update?.length??0)+(d.create?.length??0)>0;this.#e.visible=h,h&&this.#s(e)}get output(){return this.#e}}const rS=t=>{const e=Q_(t.item);return e===void 0?void 0:new tS(t,e)};class nS{constructor(e,r){this.renderContext=e,this.componentRenderers=r,this.output={graphics:r.graphics?.output,sound:r.sound?.output}}output;tick(e){this.componentRenderers.graphics?.tick(e),this.componentRenderers.sound?.tick(e)}destroy(){this.componentRenderers.graphics?.destroy(),this.componentRenderers.sound?.destroy()}}const ae=new window.AudioContext,ia=()=>{throw new Error(`sounds not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`)},Te=t=>{const e=typeof t=="string"?{soundId:t}:t,{playbackRate:r=1,soundId:n,connectTo:o,loop:s=!1,varyPlaybackRate:i=!1,randomiseStartPoint:a=!1}=e,l=ae.createBufferSource(),c=ia()[n];return l.buffer=c,l.loop=s,l.playbackRate.value=i?r-.05+Math.random()*.1:r,s&&a?l.start(0,c.duration*Math.random()):l.start(),o!==void 0&&l.connect(o),l},Lr=(t,e,r)=>{const n=ae.createGain();return e!==void 0&&(n.gain.value=e),t.connect(n),n.connect(r),n},$e=({start:t,change:e,loop:r,stop:n,startAndLoopTogether:o=!1,noStartOnFirstFrame:s=!0},i)=>{let a=!0,l,c;return u=>{if(!!u!=!!c)u?t!==void 0&&!(a&&s)?(l?.stop(),l=Te({...t}),Lr(l,t.gain,i),r!==void 0&&(o?(l=Te({...r,loop:!0}),Lr(l,r.gain,i)):l.onended=()=>{c&&(l=Te({...r,loop:!0}),Lr(l,r.gain,i))})):r!==void 0&&(l=Te({...r,loop:!0}),Lr(l,r.gain,i)):(l&&l.loop&&(l.stop(),l.onended=null),n!==void 0&&(l=Te({...n}),Lr(l,n.gain,i)));else if(c!==u&&e!==void 0){const h=Te({...e});Lr(h,e.gain,i)}a=!1,c=u}};class oS{constructor(e){this.renderContext=e,this.output.gain.value=4}output=ae.createGain();#e=$e({loop:{soundId:"rollingBallLoop",playbackRate:.5}},this.output);tick(){const{renderContext:{item:{state:{vels:{sliding:e},standingOnItemId:r}}}}=this,n=(e.x!==0||e.y!==0)&&r!==null;this.#e(n)}destroy(){}}class sS{constructor(e){this.renderContext=e;const{item:{config:{was:r}}}=e;switch(r.type){case"pickup":{r.gives!=="scroll"&&Te({soundId:"bonus",connectTo:this.output});break}case"disappearing":{Te({soundId:"destroy",connectTo:this.output});break}case"hushPuppy":{this.output.gain.value=.5,Te({soundId:"hushPuppyVanish",connectTo:this.output});break}}}output=ae.createGain();tick(){}destroy(){}}class ol{constructor(e,r,n=1){this.renderContext=e,this.#e=$e({start:r},this.output),this.output.gain.value=n}output=ae.createGain();#e;tick({lastRenderRoomTime:e}){const{renderContext:{item:r}}=this,{state:{collidedWith:{roomTime:n,by:o}}}=r,s=n>(e??ke)&&!ka(rs(o));this.#e(s)}destroy(){}}class iS{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#e.gain.value=.5,this.#r=new ol(e,{soundId:"metalHit"},.3),this.#r.output.connect(this.output)}output=ae.createGain();#e=ae.createGain();#t=$e({start:{soundId:"servoStart",playbackRate:.5},loop:{soundId:"servoLoop",playbackRate:.5},stop:{soundId:"servoStop",playbackRate:.5}},this.#e);#r;tick(e){const{renderContext:{item:r,room:{roomTime:n,items:o}}}=this,{state:{actedOnAt:{roomTime:s,by:i}}}=r,a=n===s&&Kt(rs(i)).some(l=>td(o[l]));this.#t(a),this.#r.tick(e)}destroy(){}}const oo=t=>{for(const e in t)return!0;return!1},ai=2;class aS{constructor(e){this.renderContext=e}output=ae.createGain();#e=$e({start:{soundId:"conveyorStart",playbackRate:ai},loop:{soundId:"conveyorLoop",playbackRate:ai},stop:{soundId:"conveyorEnd",playbackRate:ai}},this.output);tick(){const{renderContext:{item:{state:{stoodOnBy:e}}}}=this,r=oo(e);this.#e(r)}destroy(){this.#e(!1)}}const lS=3;class cS{constructor(e){this.renderContext=e,this.output.gain.value=.7}output=ae.createGain();#e=Te({soundId:"helicopter",loop:!0,connectTo:this.output});tick(){const{renderContext:{item:{state:{vels:{lift:{z:e}}}}}}=this;this.#e.playbackRate.value=Math.max(.5,1+lS*e)}destroy(){}}const tu={skiHead:{soundId:"softBump"},turtle:{soundId:"softBump"},dalek:{soundId:"metalHit"},homingBot:{soundId:"metalHit"},computerBot:{soundId:"metalHit"}},ru={cyberman:{soundId:"jetpackTurnaround",gain:1.2},dalek:{soundId:"mojoTurn",gain:.3}},nu={cyberman:{soundId:"jetpackLoop",gain:.7},emperorsGuardian:{soundId:"jetpackLoop"},dalek:{soundId:"mojoLoop"},bubbleRobot:{soundId:"bubbleRobotLoop"},helicopterBug:{soundId:"helicopter"}},ou={homingBot:{start:{soundId:"detect"},loop:{soundId:"robotWhirLoop",gain:4},startAndLoopTogether:!0},computerBot:{loop:{soundId:"robotBeepingLoop",randomiseStartPoint:!0,varyPlaybackRate:!0}}};class uS{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#t.connect(this.output),this.#t.gain.value=.66;const{item:{config:{which:r}}}=e;tu[r]!==void 0&&(this.#o=new ol(e,tu[r]),this.#o.output.connect(this.output)),ru[r]!==void 0&&(this.#r=$e({change:ru[r]},this.#e)),ou[r]!==void 0&&(this.#s=$e(ou[r],this.#e)),nu[r]!==void 0&&(this.#n=$e({loop:nu[r]},this.#t))}output=ae.createGain();#e=ae.createGain();#t=ae.createGain();#r;#n;#o;#s;tick(e){const{renderContext:{item:r}}=this,{state:{facing:n,activated:o,busyLickingDoughnutsOffFace:s,vels:{walking:i}}}=r;if(this.#r){const a=Ku(n);this.#r(a)}if(this.#o&&this.#o.tick(e),this.#n){const a=o&&!s;this.#n(a)}if(this.#s){const a=!In(i,le);this.#s(a)}}destroy(){}}class li{constructor(e){this.renderContext=e;const{general:{soundSettings:r},item:{type:n}}=e,{noFootsteps:o}={...ya.soundSettings,...r};o||(this.#e=ae.createGain(),this.#e.gain.value=2,this.#e.connect(this.output),this.#t=$e({loop:{soundId:`${n==="headOverHeels"?"heels":n}Walk`}},this.#e)),this.#r.gain.value=.8,this.#r.connect(this.output),this.#i.gain.value=1.2,this.#i.connect(this.output),this.#s.connect(this.output),this.#n=$e({start:{soundId:`${n==="headOverHeels"?"head":n}Jump`}},this.#r),this.#o=$e({loop:{soundId:`${n==="headOverHeels"?"head":n}Fall`}},this.#r)}output=ae.createGain();#e;#t;#r=ae.createGain();#n;#o;#s=ae.createGain();#l=$e({start:{soundId:"landing"},noStartOnFirstFrame:!0},this.#s);#i=ae.createGain();#c=$e({start:{soundId:"carry",playbackRate:.95},stop:{soundId:"carry",playbackRate:1.05}},this.#i);#a={teleportingPhase:null,positionZ:0};tick({lastRenderRoomTime:e}){const{renderContext:{item:r}}=this,{state:{action:n,teleporting:o,jumpStartZ:s,jumped:i,standingOnItemId:a,position:{z:l},vels:{gravity:{z:c}},collidedWith:{roomTime:u,by:d}}}=r,h=X_(r),{teleportingPhase:p,positionZ:y}=this.#a,m=o?o.phase:null,v=i&&l>s&&l>y&&c>0,w=l<y&&c<0&&a===null;this.#o(w),this.#n(v),this.#t!==void 0&&this.#t(!v&&!w&&n==="moving"),h!==void 0&&this.#c(h.carrying!==null);const _=a!==null&&u>(e??ke)&&d[a];if(this.#l(_),m!==null&&m!==p)if(m==="in"){const b=ia().teleportIn,x=ae.createBufferSource();x.buffer=b,x.connect(this.output),x.start()}else{const b=ia().teleportOut,x=ae.createBufferSource();x.buffer=b,x.connect(this.output),x.start()}this.#a={teleportingPhase:m,positionZ:l}}destroy(){}}class dS{constructor(e){this.renderContext=e}output=ae.createGain();#e=void 0;tick(){const{renderContext:{item:{state:{stoodOnBy:e},config:{style:r}}}}=this;if(r!=="drum")return;const n=this.#e?.stoodOn??!1,o=oo(e);!n&&o&&Te({soundId:"drum",connectTo:this.output}),this.#e={stoodOn:o}}destroy(){}}class hS{constructor(e){this.renderContext=e,this.scrapeBracketed=$e({loop:{soundId:"stepStoolScraping"}},this.output),this.output.gain.value=.4}output=ae.createGain();scrapeBracketed;tick({movedItems:e}){const{renderContext:{item:r,room:{roomTime:n}}}=this,{state:{actedOnAt:{roomTime:o},standingOnItemId:s}}=r,i=n===o&&s!==null&&e.has(r);this.scrapeBracketed(i)}destroy(){}}class fS{constructor(e){this.renderContext=e}output=ae.createGain();tick({lastRenderRoomTime:e}){const{renderContext:{item:{state:{stoodOnBy:r,stoodOnUntilRoomTime:n}}}}=this,o=oo(r);e!==void 0&&n>e&&!o&&Te({soundId:"springBoing",connectTo:this.output})}destroy(){}}class pS{constructor(e){this.renderContext=e,this.#e.connect(this.output)}output=ae.createGain();#e=ae.createGain();#t=void 0;tick(){const{renderContext:{item:{state:{setting:e},config:r}}}=this,n=r.type==="in-store"?ga(M.getState(),r.path)?"right":"left":e,o=this.#t?.setting;o!==void 0&&o!==n&&Te({soundId:"switchClick",playbackRate:n==="right"?.95:1.05,connectTo:this.#e}),this.#t={setting:n}}destroy(){}}class gS{constructor(e){this.renderContext=e}output=ae.createGain();#e=$e({loop:{soundId:"teleportWarningSiren"}},this.output);tick(){const{renderContext:{item:e,room:r}}=this;this.#e(nl(e)&&no(e.state.stoodOnBy,r).some(Sa))}destroy(){}}class mS{constructor(e){this.renderContext=e,Te({soundId:"hooter",connectTo:this.output})}output=ae.createGain();tick(){}destroy(){}}class yS extends ol{constructor(e){super(e,{soundId:"glassClink",varyPlaybackRate:!0},.8),this.renderContext=e}}const vS=(t,e)=>sd(no(t.state.stoodOnBy,e).filter(rd));class wS{constructor(e){this.renderContext=e,this.output.gain.value=2}output=ae.createGain();#e=void 0;tick(e){const{renderContext:{item:r,room:n}}=this,o=vS(r,n);this.#e!==void 0&&o<this.#e&&Te({soundId:"toasterPopUpSoundUrl",connectTo:this.output}),this.#e=o}destroy(){}}const bS={lift:cS,switch:pS,bubbles:sS,head:li,heels:li,headOverHeels:li,teleporter:gS,monster:uS,conveyor:aS,spring:fS,portableBlock:dS,charles:iS,ball:oS,pushableBlock:hS,firedDoughnut:mS,slidingBlock:yS},xS=t=>{if(t.item.type==="deadlyBlock"&&t.item.config.style==="toaster")return new wS(t);const e=bS[t.item.type];if(e)return new e(t)},su=X.h*ro,iu=X.h*-1,_S=X.w*16,SS=0,ci=(t,e,r)=>(t-e)/(r-e)*2-1;class kS{constructor(e,r){this.renderContext=e,this.childRenderer=r,r.output.connect(this.output),this.output.rolloffFactor=2,this.output.maxDistance=5,this.output.distanceModel="exponential";const{room:{size:{y:n,x:o}}}=e;this.positionMinX=Ps(we({x:0,y:n})),this.positionMaxX=Ps(we({x:o,y:0}))}output=ae.createPanner();positionMinX;positionMaxX;tick(e){this.childRenderer.tick(e);const{item:r}=this.renderContext,n=r.state,o=B(n.position,ts(r.aabb,.5)),s=ci(Ps(o),this.positionMaxX,this.positionMinX),i=ci(o.z,iu,su);if(!Number.isFinite(i))throw new Error(`y position for sound rendering is not finite;
        positionY = numberInRangeToMinus1To1Range(
          itemCentrePosition = ${o.z},
          ${iu},
          ${su},
        );
        itemCentrePosition = addXyz(
          itemState.position = ${JSON.stringify(n.position)},
          scaleXyz(${JSON.stringify(r.aabb)}, 0.5),
        )`);const a=ci(o.x+o.y,SS,_S);this.output.positionX.value=s,this.output.positionY.value=i,this.output.positionZ.value=a}destroy(){this.childRenderer.destroy()}}const _r=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,CS=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // we know c.a is either 0 or 1, so no need to do a step()

    finalColor = mix(c, vec4(uColour, 1), c.a);
}
`;class Zo extends Xt{constructor(e){const r=Pt.from({vertex:_r,fragment:CS,name:"oneColour-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uColour:{value:new Float32Array(3),type:"vec3<f32>"}}}});const n=this.resources.colorReplaceUniforms.uniforms,[o,s,i]=e.toArray();n.uColour[0]=o,n.uColour[1]=s,n.uColour[2]=i}}const PS={pureBlack:new q("#000000"),shadow:new q("#1B2D3B"),midGrey:new q("#505A55"),lightGrey:new q("#929981"),white:new q("#F8FEF8"),pastelBlue:new q("#4893FF"),metallicBlue:new q("#1D4E80"),pink:new q("#B973AF"),moss:new q("#6E7B00"),redShadow:new q("#513D40"),midRed:new q("#A7574B"),lightBeige:new q("#BF8E69"),highlightBeige:new q("#DBB269"),alpha:new q("#105A69"),replaceLight:new q("#048662"),replaceDark:new q("#052229")},ES=`#version 300 es
// keep this one at mediump for the hash function's precision
precision mediump float;

in vec2 vTextureCoord;
out vec4 finalColor;

const float LUT_SIZE = 256.0;
const float magicNumber = 31.0; // Small prime number

uniform sampler2D uTexture;
uniform sampler2D uLut;

/** returns in [0, LUT_SIZE] range
this must match the TypeScript version of the hash function*/
float hashColor(vec3 color) {
    vec3 c255 = floor(color * 255.0);
    
    float hash = mod(
        c255.r + c255.g * magicNumber + c255.b * magicNumber * magicNumber, 
        LUT_SIZE
    );
    return hash;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    float h = hashColor(c.rgb);

    // use the hash to look up the replacement in the LUT:
    vec4 replacementColour = texture(
        uLut, 
        vec2(
            // normalise h to [0, 1] range
            (h + 0.5) / LUT_SIZE, 
            0.5
        )
    );
    
    // use original if either: 
    //      original alpha is 0 (because keep transparent)
    //      or lut alpha is 0 (signals nothing in this slot of the LUT)
    finalColor = mix(c, replacementColour, c.a * replacementColour.a);
}
`,An=256,ui=31;function AS(t){const e=Math.floor(t.red*255),r=Math.floor(t.green*255),n=Math.floor(t.blue*255);return(e+r*ui+n*ui*ui)%An}function TS(t){const e=new Float32Array(An*4);for(const[o,s]of ig(t)){const i=z[o],a=AS(i);if(e[a*4+3]>.5)throw new Error("LUT collision - mess with the hash function or lut size until this goes away");e[a*4+0]=s.red,e[a*4+1]=s.green,e[a*4+2]=s.blue,e[a*4+3]=1}const r=new Uint8Array(An*4);for(let o=0;o<An*4;o++)r[o]=Math.floor(e[o]*255);return _t.from({resource:r,width:An,height:1,scaleMode:"nearest"})}class Yt extends Xt{#e;constructor(e){const r=Object.keys(e).length,n=Pt.from({vertex:_r,fragment:ES,name:"palette-swop-filter"}),o=TS(e);super({glProgram:n,resources:{colorReplaceUniforms:{uOriginal:{value:new Float32Array(3*r),type:"vec3<f32>",size:r},uReplacement:{value:new Float32Array(3*r),type:"vec3<f32>",size:r}},uLut:o.source}}),this.#e=o;const s=this.resources.colorReplaceUniforms.uniforms;Object.entries(e).forEach(([i,a],l)=>{z[i].toArray().forEach((c,u)=>{s.uOriginal[l*3+u]=c}),a.toArray().forEach((c,u)=>{s.uReplacement[l*3+u]=c})})}destroy(e){this.#e?.destroy(!0),this.#e=null,super.destroy(e)}}const RS=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uTargetColor;

vec4 black = vec4(0.0, 0.0, 0.0, 1.0);

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // 1 if black, 0 if non-black
    float isBlack = step(length(c.rgb), 0.01);

    // keep original if either:
    //      * black
    //      * transparent

    finalColor = mix(    
        vec4(uTargetColor, 1),    
        c, 
        max(isBlack, 1.0 - c.a)
    );
}
`;class ze extends Xt{uniforms;constructor(e="white"){const r=Pt.from({vertex:_r,fragment:RS,name:"revert-colourise-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[r,n,o]=new q(e).toArray();this.uniforms.uTargetColor[0]=r,this.uniforms.uTargetColor[1]=n,this.uniforms.uTargetColor[2]=o}}const OS=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    finalColor = vec4(c.rgb * 0.5, c.a);
}
`;class IS extends Xt{constructor(){const e=Pt.from({vertex:_r,fragment:OS,name:"halfbrite-filter"});super({glProgram:e,resources:{}})}}const Wf=({basic:t,dimmed:e})=>({replaceLight:t,replaceDark:e}),Gf=({color:{hue:t,shade:e},planet:r})=>{const n=t==="yellow"?e==="dimmed"||r==="jail"?af:Xe:ds[t][e].main;return Wf(n)},jS=t=>new Yt({lightBeige:z.lightGrey,redShadow:z.shadow,pink:z.lightGrey,moss:z.lightGrey,midRed:z.midGrey,highlightBeige:z.lightGrey,...t&&Gf(t)}),$S=new Yt({midGrey:z.midRed,lightGrey:z.lightBeige,white:z.highlightBeige,metallicBlue:z.redShadow,pink:z.midRed,moss:z.midRed,replaceDark:z.midRed,replaceLight:z.lightBeige}),au=(t,e)=>{const r=Ko(t.color).edges[e],n=r.original;return r.dimInOriginal?sf(n):n},qf=(t,e,r)=>r?new Yt(Wf(ds[t.color.hue][t.color.shade].edges[e])):new ze(Ko(t.color).edges[e].original),ft=t=>new Yt(Gf(t)),zS=t=>{switch(t.color.hue){case"white":return new Yt({replaceLight:z.lightGrey,replaceDark:z.midGrey});default:return ft(t)}},Vf=t=>{switch(t.color.hue){case"white":return new Yt({replaceLight:z.lightBeige,replaceDark:z.midRed,shadow:z.redShadow});case"yellow":return ft({planet:t.planet,color:{hue:"yellow",shade:"dimmed"}});default:return ft(t)}};new IS;const Zt=Gu,NS=new Yt(PS),LS=[new Zo(z.midRed)],DS=[new Zo(z.moss)],MS=75;class BS{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output)}output=new ee({label:"ItemFlashOnSwitchedRenderer"});tick(e){const{renderContext:{item:{state:{switchedAtRoomTime:r,switchedSetting:n}},room:{roomTime:o}}}=this;this.output.filters=o-r<MS?n==="left"?DS:LS:Zt,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const FS=(t,e,r)=>{const o=Ft().textures[`door.frame.${t.planet}.${e}.near`]!==void 0?t.planet:"generic",s=t.color.shade==="dimmed"&&Ft().textures[`door.frame.${o}.dark.${e}.${r}`]!==void 0;return`door.frame.${o}${s?".dark":""}.${e}.${r}`};function gs(t,e){const r=e||new ee;for(const n of t)r.addChild(n);return r}function*US({config:{direction:t,inHiddenWall:e,height:r}},n){const o=Xn(t),s=o==="y"?1:16;function*i(a){if(e){if(r!==0){const l=F({textureId:`generic.door.floatingThreshold.${o}`,...On(a,{y:-12*r})});l.filters=qf(n,o==="x"?"towards":"right",!0),yield l}}else{yield F({pivot:{x:s,y:9},textureId:`generic.door.legs.base.${o}`,...On(a,{})});for(let l=1;l<r;l++)yield F({pivot:{x:s,y:9},textureId:`generic.door.legs.pillar.${o}`,...On(a,{y:-l*X.h})})}}yield*i(dr({...cr,[o]:1})),yield*i(cr),e||(yield F({pivot:{x:16,y:X.h*r+13},textureId:`generic.door.legs.threshold.double.${o}`,...dr({...cr,[o]:1})}))}const Kf=(t,e)=>{const r=Xn(t),n=cn(r),o=8;return t==="towards"||t==="right"?Q({[n]:e[n]-o}):cr},HS=Ae(({renderContext:{item:t,room:e}})=>gs(US(t,e),new ee({filters:ft(e),...Kf(t.config.direction,t.aabb)}))),WS=Ae(({renderContext:{item:{config:{direction:t,part:e,toRoom:r},aabb:n},room:o,general:{gameState:s}}})=>{const i=Xn(t),a=s===void 0?o:s.campaign.rooms[r];return F({textureId:FS(o,i,e),filter:ft(a),...Kf(t,n)})}),di={animationId:"bubbles.cold"},Vr=({top:t,bottom:e="headlessBase",filter:r})=>{const n=new ee({filters:r}),o=F(e);n.addChild(o);const s=F(t);return s.y=-12,n.addChild(s),n[ms]=s,n[sl]=o,n},ms=Symbol(),sl=Symbol(),GS=({top:t,bottom:e})=>{const r=new ee;return r.addChild(e),t.y=-12,r.addChild(t),r[ms]=t,r[sl]=e,r},qS=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform vec2 uTextureSize;
uniform sampler2D uTexture;
uniform vec3 uOutline;
uniform float uOutlineWidth;

void main(void) {
    vec2 scaledTexelSize = vec2(1.0f) / vec2(textureSize(uTexture, 0)) * uOutlineWidth;    
    
    // Calculate offset coordinates
    vec2 rightCoord = vec2(vTextureCoord.x + scaledTexelSize.x, vTextureCoord.y);
    vec2 leftCoord = vec2(vTextureCoord.x - scaledTexelSize.x, vTextureCoord.y);
    vec2 belowCoord = vec2(vTextureCoord.x, vTextureCoord.y + scaledTexelSize.y);
    vec2 aboveCoord = vec2(vTextureCoord.x, vTextureCoord.y - scaledTexelSize.y);
    
    // Create boundary masks (1.0 if within bounds, 0.0 if out of bounds)
    // seems to work fine without this, but could multiply colourToX by this to get zero'd out when OOB
    // float rightInBounds = step(rightCoord.x, 1.0);
    // float leftInBounds = step(0.0, leftCoord.x);
    // float belowInBounds = step(belowCoord.y, 1.0);
    // float aboveInBounds = step(0.0, aboveCoord.y);
    
    vec4 colourToRight = texture(uTexture, rightCoord);
    vec4 colourToLeft = texture(uTexture, leftCoord);
    vec4 colourBelow = texture(uTexture, belowCoord);
    vec4 colourAbove = texture(uTexture, aboveCoord);
    
    // Check if any neighbor is opaque (combine all alpha values)
    float hasOpaqueNeighbor = max(max(colourToRight.a, colourToLeft.a), 
                                  max(colourBelow.a, colourAbove.a));

    vec4 originalColour = texture(uTexture, vTextureCoord);
        
    finalColor = mix(
        originalColour, 
        vec4(uOutline, 1), 
        // 1 if: original colour is transparent and has an opaque neighbour - use outline colour
        // 0 if: original colour is opaque or has no opaque neighbour - use original colour (transparent or sprite)
        (1.0 - originalColour.a) * hasOpaqueNeighbor
    );
}
`;class Ct extends Xt{constructor({outlineColor:e,upscale:r,lowRes:n}){const o=Pt.from({vertex:_r,fragment:qS,name:"outline-filter"});super({glProgram:o,padding:r,resources:{colorReplaceUniforms:{uOutline:{value:new Float32Array(3),type:"vec3<f32>"},uOutlineWidth:{value:new Float32Array(1),type:"f32"}}}});const s=this.resources.colorReplaceUniforms.uniforms,[i,a,l]=e.toArray();s.uOutline[0]=i,s.uOutline[1]=a,s.uOutline[2]=l,s.uOutlineWidth[0]=r,n&&(this.resolution=1/r,this.padding=r,s.uOutlineWidth[0]=1)}}const VS=t=>{const{gameTime:e,lastDiedAt:r}=t.type==="headOverHeels"?t.state.head:t.state;return e-r<__},hi=t=>{if(t===void 0)return 0;const{shieldCollectedAt:e,gameTime:r}=t;return e!==null&&e+Bc>r?100-Math.ceil((r-e)/(Bc/100)):0},KS=t=>t.type==="headOverHeels"?hi(t.state.head)>0||hi(t.state.heels)>0:hi(t.state)>0,ys=t=>t,aa=.02,XS=({name:t,action:e,facingXy8:r,teleportingPhase:n,gravityZ:o,paused:s})=>{if(e==="death")return{animationId:`${t}.fadeOut`,paused:s};if(n==="out")return{animationId:`${t}.fadeOut`,paused:s};if(n==="in")return{animationId:`${t}.fadeOut`,paused:s};if(e==="moving")return{animationId:`${t}.walking.${r}`,paused:s};if(e==="jumping")return{textureId:o<aa?`${t}.walking.${r}.2`:`${t}.walking.${r}.1`};if(e==="falling"){const a=`${t}.falling.${r}`;if(Uo(a))return{textureId:a}}const i=`${t}.idle.${r}`;return Ed(i)?{animationId:i,paused:s}:{textureId:`${t}.walking.${r}.2`}},la=Symbol(),ca=Symbol(),JS=(t,e)=>{t[la].removeChildren(),t[la].addChild(F(XS(e)))},Xf=new Yt({pastelBlue:z.pink}),fi=(t,e,r)=>{const n=new ee,o=new ee;n[la]=o,n.addChild(o);const s=F({animationId:e?`shine.${t}InSymbio`:"shine",paused:r,filter:t==="heels"?Xf:Zt,flipX:t==="heels"});return n[ca]=s,n},lu=({gameTime:t,switchedToAt:e},r,n)=>(r==="headOverHeels"||r===n)&&e+x_>t,YS=t=>{if(!VS(t))return!1;const{gameTime:e,lastDiedAt:r}=t.type==="headOverHeels"?t.state.head:t.state;return(e-r)%Fc<Fc*S_},cu=(t,e)=>{t.filters?Array.isArray(t.filters)?t.filters=[...t.filters,e]:t.filters=[t.filters,e].flat():t.filters=e},uu=(t,e)=>{t.filters=Array.isArray(t.filters)?t.filters.filter(r=>!(r instanceof e)):t.filters instanceof e?Zt:[...t.filters]},ZS=(t,{highlighted:e,flashing:r},n,o)=>{const s=n?.highlighted??!1;e&&!s?cu(o,new Ct({outlineColor:qr[t],upscale:wr(M.getState()),lowRes:!1})):!e&&s&&uu(o,Ct);const i=n?.flashing??!1;r&&!i?cu(o,new Zo(qr[t])):!r&&i&&uu(o,Zo)},QS=(t,e,r)=>{e&&!r?t.addChild(t[ca]):!e&&r&&t.removeChild(t[ca])},pi=(t,e,r,n,o,s)=>{r&&JS(e,{name:t,...n,paused:o}),ZS(t,n,s,e),QS(e,n.shining,s?.shining??!1)},ek=({renderContext:{item:t,general:{gameState:e,paused:r}},currentRendering:n})=>{const{type:o,state:{action:s,facing:i,teleporting:a,vels:{gravity:{z:l}}}}=t,c=n?.renderProps,u=n?.output,d=Ku(i)??"towards",h=e!==void 0&&(t.type==="headOverHeels"?lu(t.state.head,"headOverHeels","headOverHeels"):lu(t.state,t.type,e.currentCharacterName)),p=YS(t),y=KS(t),m=va(i),v=a?.phase??null,w={action:s,facingXy8:d,teleportingPhase:v,flashing:p,highlighted:h,shining:y,gravityZ:l},_=c===void 0||c.action!==s||c.facingXy8!==d||c.teleportingPhase!==v||c?.gravityZ>aa!=l>aa;let b;if(o==="headOverHeels"){b=u??GS({top:fi("head",!0,r),bottom:fi("heels",!0,r)});const x=b;pi("head",x[ms],_,w,r,c),pi("heels",x[sl],_,w,r,c)}else b=u??fi(o,!1,r),pi(o,b,_,w,r,c);return s==="moving"&&u instanceof Fn&&(u.animationSpeed=m*ag),{output:b,renderProps:w}},gi=ys(ek),du=t=>t-Math.floor(t),tk=({state:{position:t}},e)=>{const r=o=>o.config.direction==="away"||o.config.direction==="left";return gs(Qe(e.items).filter(o=>o.type==="wall"||o.type==="doorLegs").filter(r).map(o=>{const{id:s,config:{direction:i},state:{position:a}}=o;return F({textureId:"floorOverdraw.cornerNearWall",label:s,...Q(qu(a,t)),times:o.type==="wall"?_a(o.config):{[cn(Ut(i))]:2},anchor:{x:0,y:1},flipX:i==="away"})}),new ee({label:"floorOverdraws"}))},rk=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    finalColor = texture(uTexture, vTextureCoord);
}
`;class nk extends Xt{constructor(){const e=Pt.from({vertex:_r,fragment:rk,name:"null-filter"});super({glProgram:e,resources:{}})}}const ok=`#version 300 es
precision lowp float;

out vec4 finalColor;

in vec2 vTextureCoord;
uniform sampler2D uBackBuffer;
uniform vec3 uTargetColor;
// do not use uTexture in this frag - for some reason it causes pixi's render pipeline
// to take away the backbuffer, which we rely on sampling from

void main() {
    vec3 bg = texture(uBackBuffer, vTextureCoord).rgb;

    float isBlack = step(length(bg), 0.001f); // 1 if black, 0 otherwise
    finalColor = mix(vec4(uTargetColor, 1.0f), vec4(0, 0, 0, 0), isBlack);


}`;class hu extends Xt{uniforms;constructor(e="white"){const r=Pt.from({vertex:_r,fragment:ok,name:"colour-clash-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}},blendRequired:!0}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[r,n,o]=new q(e).toArray();this.uniforms.uTargetColor[0]=r,this.uniforms.uTargetColor[1]=n,this.uniforms.uTargetColor[2]=o}}const fu=({colourised:t,direction:e,room:r,times:n,position:o,colourSwap:s})=>F({label:`floorEdge(${e})`,textureId:`floorEdge.${e}`,times:n,filter:s?qf(r,e,t):void 0,...Q(o)}),sk=({room:t,xSize:e,ySize:r,y:n})=>{const o=new ee({label:"floorColourClash"}),s=au(t,"right");for(let a=0;a<=r;a++){const l=dr({x:0,y:a,z:0}),c=new lt().rect(l.x-(a===0?0:8),l.y,8*3,8).fill(s);c.filters=new hu(s),o.addChild(c)}const i=au(t,"towards");for(let a=0;a<=e;a++){const l=dr({x:a,y:0,z:0}),c=new lt().rect(l.x-16,l.y,8*(a===0?2:3),8).fill(i);c.filters=new hu(i),o.addChild(c)}return o.y=n,o},ik=Ae(({renderContext:{room:t,item:e,general:{colourised:r},colourClashLayer:n}})=>{const{color:{shade:o}}=t,{config:s,state:{position:i},aabb:a}=e,{floorType:l,naturalFootprint:c}=s,u=new ee({label:"floorAppearance"}),d=Q({...a,y:0}),h=Q({...a,x:0,y:0}),p=Q({...a,x:0}),y=Q(a);if(l!=="none"){const m=new ee({label:"tiles"}),v=l==="deadly"?`generic${o==="dimmed"?".dark":""}.floor.deadly`:`${s.scenery}${o==="dimmed"?".dark":""}.floor`,w=Ft().textures[v];try{Pd(v)}catch(I){throw new Error(`no floor textureId for floorType: ${l}, shade: ${o}`,{cause:I})}const _=Qr(c.position,i),b={x:du(_.x/X.w),y:du(_.y/X.w)},x=8,k={x:d.x,y:y.y-x,width:p.x-d.x,height:h.y-y.y+2*x},C=Qr(dr(On(b,{x:.5,y:.5})),{y:a.z},k),S=new bm({texture:w,tilePosition:C,...k});m.addChild(S),m.addChild(tk(e,t));const j=new lt().moveTo(y.x,y.y).lineTo(p.x,p.y).lineTo(p.x,p.y+3).lineTo(h.x,h.y+3).lineTo(d.x,d.y+3).lineTo(d.x,d.y).fill({color:16711680,alpha:.5});m.addChild(j),m.mask=j,m.filters=[zS(t)];const U=new ee({children:[m]});U.filters=new Ct({outlineColor:z.pureBlack,upscale:1,lowRes:!1});const N=new ee({children:[U]}),H=new nk;H.enabled=!1,N.filters=H,N.cacheAsTexture(!0),u.addChild(N),u.addChild(F({textureId:"blank",x:p.x,y:h.y+8}))}{const m=new ee({label:"edges"});l==="none"&&m.addChild(new lt().moveTo(p.x,p.y+8).lineTo(p.x,p.y+100).lineTo(d.x,d.y+100).lineTo(d.x,d.y+8).lineTo(h.x,h.y+8).fill(0));const v=Math.ceil(a.y/X.w);m.addChild(fu({colourised:r,direction:"right",room:t,times:{y:v},position:{z:a.z},colourSwap:r}));const w=Math.ceil(a.x/X.w);if(m.addChild(fu({colourised:r,direction:"towards",room:t,times:{x:w},position:{z:a.z},colourSwap:r})),u.addChild(m),!r){const _=sk({xSize:w,ySize:v,y:-a.z+1,room:t});u.addChild(_),n.attach(_)}}return u}),ak=["cyberman","dalek","skiHead","bubbleRobot","computerBot","turtle"],lk=t=>{let e=2166136261;const r=t.length;for(let n=Math.max(0,r-9);n<r;n++)e^=t.charCodeAt(n),e=Math.imul(e,1540483477),e^=e>>>15;return(e>>>0)/4294967295},ck=200,uk=1,dk=(t,e)=>{const r=lk(e);return Math.sin((t+r*2e4)/ck)*uk},pu=({id:t,config:{which:e},state:r},n,o)=>{if((e==="cyberman"||e==="bubbleRobot")&&r.activated||e==="emperorsGuardian"){const s=o;s[ms].y=-12+dk(n.roomTime,t)}},hk=({renderContext:{item:t,room:e,general:{paused:r}},currentRendering:n})=>{const{config:o,state:s}=t,i=n?.renderProps,{activated:a,busyLickingDoughnutsOffFace:l}=s,c=l?$S:a?void 0:ak.includes(o.which)?jS(e):void 0;switch(o.which){case"skiHead":case"turtle":case"cyberman":case"computerBot":case"elephant":case"elephantHead":case"monkey":{const u=ma(s.facing)??"towards";if(!(i===void 0||a!==i.activated||l!==i.busyLickingDoughnutsOffFace||u!==i.facingXy4))return pu(t,e,n.output),"no-update";const h={facingXy4:u,activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"skiHead":return{output:F({textureId:`${o.which}.${o.style}.${u}`,filter:c}),renderProps:h};case"elephantHead":return{output:F({textureId:`elephant.${u}`,filter:c}),renderProps:h};case"turtle":return{output:F(a&&!l?{animationId:`${o.which}.${u}`,filter:c,paused:r}:{textureId:`${o.which}.${u}.1`,filter:c}),renderProps:h};case"cyberman":return{output:s.activated||s.busyLickingDoughnutsOffFace?Vr({top:{textureId:`${o.which}.${u}`,filter:c||ft(e)},bottom:{...di,paused:r}}):F({textureId:`${o.which}.${u}`,filter:c}),renderProps:h};case"computerBot":case"elephant":case"monkey":return{output:Vr({top:`${o.which}.${u}`,bottom:{animationId:"headlessBase.flash",playOnce:"and-stop"},filter:c}),renderProps:h};default:throw new Error(`unexpected monster ${o}`)}break}case"homingBot":{const u=!lg(s.vels.walking,cr);return i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated||u!==i.walking?{filter:c,output:F({animationId:u?"headlessBase.flash":"headlessBase.scan",filter:c}),renderProps:{activated:a,busyLickingDoughnutsOffFace:l,walking:u}}:"no-update"}case"helicopterBug":case"emperor":case"dalek":case"bubbleRobot":case"emperorsGuardian":{if(!(i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated))return pu(t,e,n.output),"no-update";const d={activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"helicopterBug":case"dalek":return{output:F(a&&!l?{animationId:o.which,filter:c,paused:r}:{textureId:`${o.which}.1`,filter:c}),renderProps:d};case"bubbleRobot":return{output:Vr({top:{...di,paused:r},filter:c}),renderProps:d};case"emperorsGuardian":return{output:Vr({top:"ball",bottom:{...di,paused:r},filter:c}),renderProps:d};case"emperor":return{output:F({animationId:"bubbles.cold",filter:c,paused:r}),renderProps:d};default:throw new Error(`unexpected monster ${o}`)}break}default:throw new Error(`unexpected monster ${o}`)}},Co=new Ct({outlineColor:z.pureBlack,upscale:wr(M.getState()),lowRes:!0});new ze;new ze;new ze;new ze(z.moss);new ze;new ze(qr.head),new ze(nn(qr.head)),new ze(qr.heels),new ze(nn(qr.heels));function*fk(t){const e=typeof t=="string"?t==="infinite"?"":t:t.toString(),r=sd(e);let n=0;for(const o of e){const s=`hud.char.${Uu(o)}`;try{Pd(s)}catch(i){throw new Error(`no texture id for char "${o}": ${i.message}`,{cause:i})}yield F({textureId:s,x:(n+.5-r/2)*cg.w}),n++}}const Jf=(t,e)=>{t.removeChildren();try{gs(fk(e),t)}catch(r){throw console.error("invalid string is",e,"and on window as window.invalid"),console.error(r),window.invalid=e,new Error(`could not show text "${e}" in container because: "${r.message}"`,{cause:r})}return t},pk=Lf.floatingText,gk=12,gu=X.h*3,mu=[z.shadow,z.midGrey,z.redShadow,z.metallicBlue,z.midRed,z.moss,z.pink,z.lightBeige,z.pastelBlue,z.lightGrey,z.highlightBeige],yu=[...mu,...new Array(20).fill(z.white),...mu.toReversed()],mk=({renderContext:{item:{config:{textLines:t,appearanceRoomTime:e}},room:{roomTime:r},general:{displaySettings:{uncolourised:n}},frontLayer:o},currentRendering:s})=>{const i=s?.output;let a;const c=(r-e)*pk;if(i===void 0){a=new ee({filters:new Ct({outlineColor:z.pureBlack,upscale:wr(M.getState()),lowRes:!1})}),o?.attach(a);for(let u=0;u<t.length;u++){const d=t[u],h=Jf(new ee({label:d,y:u*gk,filters:n?Zt:new ze(z.pink)}),d.toUpperCase());a.addChild(h)}}else a=i;for(let u=0;u<t.length;u++){const d=a.children[u],[h]=d.filters,p=c+u*-12,y=p>0&&p<gu;if(d.visible=y,y&&h){const m=Math.floor(p/gu*yu.length);h.targetColor=yu[m]}}return a.y=-c,{output:a,renderProps:pe}},vu=500,yk=vr.animations["conveyor.x"].animationSpeed,wu=vr.animations["conveyor.x"].length,vk=t=>1-(1-t)**2,wk=(t,e)=>{for(let r=0;r<t.children.length;r++){const n=t.children[r],o=r%wu;n.gotoAndStop(e?wu-o-1:o)}return t},bk=({renderContext:{item:{config:{direction:t,times:e},state:{stoodOnBy:r}},room:{roomTime:n}},currentRendering:o})=>{const s=o?.renderProps,i=oo(r),a=(!i&&s?.moving?n:s?.roomTimeStoppedMoving)??ke,l=Ut(t),c=o?.output??wk(F({animationId:`conveyor.${l}`,reverse:t==="towards"||t==="right",times:e}),t==="towards"||t==="right"),u=i?0:Math.min(n-a,vu),d=Math.max(0,1-u/vu);for(const h of c.children)if(d===0)h.stop();else{const p=yk*vk(d);h.play(),h.animationSpeed=p}return{output:c,renderProps:{moving:i,roomTimeStoppedMoving:a}}},xk=ys(bk),_k=({renderContext:{item:t,room:e,general:{paused:r}},currentRendering:n})=>{const{state:{stoodOnBy:o},config:{times:s}}=t,i=n?.renderProps,a=nl(t),l=a&&no(o,e).some(Sa);return i===void 0||a!==i.activated||l!==i.flashing?{output:l?new ee({children:[F({textureId:"teleporter",times:s}),F({animationId:"teleporter.flashing",times:s,paused:r})]}):F({textureId:a?"teleporter":"block.artificial",times:s}),renderProps:{flashing:l,activated:a}}:"no-update"},Sk=({renderContext:{item:{state:{facing:t,actedOnAt:{roomTime:e,by:r}}},room:{roomTime:n,items:o}},currentRendering:s})=>{const i=s?.renderProps,a=ma(t)??"towards",l=n===e&&Kt(rs(r)).some(u=>td(o[u]));return i===void 0||a!==i.facingXy4||l!==i.controlledByJoystick?{output:Vr({top:`charles.${a}`,bottom:l?"headlessBase.all":"headlessBase"}),renderProps:{facingXy4:a,controlledByJoystick:l}}:"no-update"},kk=({renderContext:{item:{state:{stoodOnBy:t,stoodOnUntilRoomTime:e}},general:{paused:r}},tickContext:{lastRenderRoomTime:n},currentRendering:o})=>{const s=o?.renderProps,i=oo(t);let a;return o?.output?a=o?.output:(a=F({animationId:"spring.bounce"}),a.loop=!1,a.gotoAndStop(0)),n!==void 0&&e>n&&!i&&!r?a.gotoAndPlay(0):i&&!(s?.compressed??!1)&&a.gotoAndStop(1),{output:a,renderProps:{compressed:i}}},Ck=ys(kk),Pk=({renderContext:{item:{config:{which:t,startDirection:e}}},currentRendering:r})=>r?.renderProps===void 0?{output:t==="headOverHeels"?Vr({top:{textureId:`head.walking.${e}.2`},bottom:{textureId:`heels.walking.${e}.2`}}):F({textureId:`${t}.walking.${e}.2`}),renderProps:pe}:"no-update",Ek=({renderContext:{item:{state:{vels:{sliding:t}},config:{startingPhase:e}},general:{paused:r}},tickContext:{deltaMS:n},currentRendering:o})=>{const i=(o?.renderProps?.distanceTravelled??0)+wa(t)*(r?0:n),l=o?.output??F("spikyBall.1"),u=(Math.floor(i*2/Eo.w)+e)%2+1;return l.texture=Ft().textures[`spikyBall.${u}`],{output:l,renderProps:{distanceTravelled:i}}},Ak=ys(Ek),Tk=(t,e,r,n)=>`${t}${n?".dark":""}.wall.${e}.${r}`,Rk=Ae(({renderContext:{item:{id:t,config:e},room:r}})=>{if(e.direction==="right"||e.direction==="towards")throw new Error(`wall is near: ${t}`);const{direction:n,tiles:o}=e,s=cn(Ut(n)),i=new ee({label:"wallTiles"});for(let a=0;a<e.tiles.length;a++){let l=F({textureId:Tk(r.planet,o[a],n,r.color.shade==="dimmed"),y:1,pivot:n==="away"?{x:Eo.w,y:Eo.h+1}:{x:0,y:Eo.h+1}});const c=dr({[s]:a});if(r.planet==="moonbase"){const u=`moonbase.wall.screen.${o[a]}.away`;Ed(u)&&(l=new ee({children:[l]}),l.addChild(F({animationId:u,randomiseStartFrame:!0,flipX:n==="left",x:n==="away"?-8:8,y:-23})))}l.x+=c.x,l.y+=c.y,i.addChild(l),i.filters=ft(r)}return i}),Ok=({renderContext:{item:{state:{setting:t},config:e}},currentRendering:r})=>{const n=r?.renderProps,o=e.type==="in-store"?ga(M.getState(),e.path)?"right":"left":t;return n===void 0||o!==n.setting?{output:F(`switch.${o}`),renderProps:{setting:o}}:"no-update"},Ik=(t,e,r)=>e==="tower"?"tower":e==="book"?"book.x":e==="organic"&&t?`block.organic.dark${r?".disappearing":""}`:`block.${e}${r?".disappearing":""}`,jk=({renderContext:{item:{config:{style:t,times:e},state:{disappearing:r}},room:n},currentRendering:o})=>{const s=o?.renderProps,i=r!==null;return s===void 0||s.isDissapearing!==i?{output:F({textureId:Ik(n.color.shade==="dimmed",t,i),filter:t==="organic"?ft(n):t==="book"?Vf(n):void 0,times:e}),renderProps:{isDissapearing:i}}:"no-update"},$k=({state:{stoodOnBy:t,position:e},config:{times:r}},n)=>{const o=new Array(r?.x??1).fill(null).map(()=>new Array(r?.y??1));return no(t,n).filter(rd).forEach(({id:s,state:{position:i}})=>{const a=Qr(i,e),l={x:Math.floor(a.x/X.w),y:Math.floor(a.y/X.d)};l.x<0||l.x>=(r?.x??1)||l.y<0||l.y>=(r?.y??1)||(o[l.x][l.y]=s)}),o},zk=(t,e)=>{let r=0,n=1;for(const o of e)for(const s of o)s!==void 0&&t.items[s]?.state.activated&&(r|=n),n<<=1;return r},Nk=({renderContext:{item:t,room:e},currentRendering:r})=>{const{config:{times:n}}=t,o=r===void 0?$k(t,e):r.renderProps.chargePositions,s=zk(e,o);return s!==r?.renderProps.cybermanActivationBitmask?{output:F({textureIdCallback(a,l){const c=o[a][l];return c===void 0||e.items[c]?.state.everActivated?"toaster.off":"toaster.on"},times:n??pe}),renderProps:{chargePositions:o,cybermanActivationBitmask:s}}:"no-update"},Lk={head:gi,heels:gi,headOverHeels:gi,doorFrame:WS,doorLegs:HS,monster:hk,floatingText:mk,barrier:Ae(({renderContext:{item:{config:{axis:t,times:e}}}})=>F({textureId:`barrier.${t}`,times:e})),deadlyBlock:Ae(({renderContext:{item:{config:t},room:e}})=>{switch(t.style){case"volcano":return F({animationId:"volcano",filter:ft(e),times:t.times,randomiseStartFrame:!0});case"toaster":throw new Error("use the special toaster appearance instead");default:throw t.style,new Error("unknown deadly block style")}}),spikes:It("spikes"),slidingDeadly:Ak,slidingBlock:Ae(({renderContext:{item:{config:{style:t}},room:e}})=>F(t==="book"?{textureId:"book.y",filter:Vf(e)}:t)),block:jk,switch:Ok,conveyor:xk,lift:Ae(({renderContext:{general:{paused:t}}})=>{const e=new ee,r={x:fl.w/2,y:fl.h};return e.addChild(F({animationId:"lift",pivot:r,paused:t})),e.addChild(F({textureId:"lift.static",pivot:r})),e}),teleporter:_k,sceneryCrown:Ae(({renderContext:{item:{config:{planet:t}}}})=>F({textureId:`crown.${t}`})),pickup:Ae(({renderContext:{item:{config:t},room:e,general:{paused:r}}})=>{if(t.gives==="crown")return F({textureId:`crown.${t.planet}`});const o={shield:"whiteRabbit",jumps:"whiteRabbit",fast:"whiteRabbit","extra-life":"whiteRabbit",bag:"bag",doughnuts:"doughnuts",hooter:"hooter",scroll:{textureId:"scroll",filter:ft(e)},reincarnation:{animationId:"fish",paused:r}}[t.gives];return F(o)}),moveableDeadly:It("fish.1"),charles:Sk,joystick:It("joystick"),movingPlatform:It("sandwich"),pushableBlock:It("stepStool"),portableBlock:Ae(({renderContext:{item:{config:{style:t}}}})=>F(t)),spring:Ck,sceneryPlayer:Pk,hushPuppy:It("hushPuppy"),bubbles:Ae(({renderContext:{item:{config:{style:t}},general:{paused:e}}})=>F({animationId:`bubbles.${t}`,paused:e})),firedDoughnut:It({animationId:"bubbles.doughnut"}),ball:It("ball"),floor:ik,particle:Ae(({renderContext:{item:{config:{forCharacter:t}}}})=>F({animationId:"particle.fade",anchor:{x:.5,y:.5},filter:t==="heels"?Xf:Zt}))},Dk=t=>{if(t.type==="wall"){const{direction:e}=t.config;return e==="right"||e==="towards"?void 0:Rk}return t.type==="deadlyBlock"&&t.config.style==="toaster"?Nk:Lk[t.type]},Mk=z.moss,Bk=()=>new Ct({outlineColor:Mk,lowRes:!1,upscale:wr(M.getState())});class Fk{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output)}output=new ee({label:"PortableItemPickUpNextHighlightRenderer"});#e=!1;tick(e){const{wouldPickUpNext:r}=this.renderContext.item.state;r!==!this.#e&&(this.output.filters=r?[Bk()]:Zt),this.#e=r,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const Uk=(t,e,r)=>Hg(t)?new Fk(e,r):r,Hk=z.pastelBlue,Wk=z.highlightBeige,Gk=z.midRed,bu=new Ct({outlineColor:Wk,upscale:wr(M.getState()),lowRes:!1}),xu=new Ct({outlineColor:Gk,upscale:wr(M.getState()),lowRes:!1}),_u=new ze(Hk),Su={left:"↖",away:"↗",right:"↘",towards:"↙"};class qk{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output),this.#e()}output=new ee({label:"EditorAnnotationsRenderer"});#e(){const e=this.renderContext.item;switch(e.type){case"pickup":if(e.config.gives==="shield"||e.config.gives==="extra-life"||e.config.gives==="jumps"||e.config.gives==="fast"){const r={shield:"🛡",jumps:"♨",fast:"⚡","extra-life":"+2"};this.#t({annotationText:r[e.config.gives],yAdj:-16})}break;case"doorFrame":if(e.config.part==="near"&&!e.isCursorPreview){const{rooms:r}=M.getState().levelEditor.campaignInProgress,{config:{toRoom:n,direction:o}}=e,s=!!r[n],i=n.toUpperCase(),a=Su[o],l=o==="away"||o==="right"?`${i}${a}`:`${a}${i}`;this.#t({annotationText:l,yAdj:o==="left"||o==="away"?-48:0,error:!s,clickDispatch:s?()=>Ei(n):void 0})}break;case"teleporter":if(!e.isCursorPreview){const{rooms:r}=M.getState().levelEditor.campaignInProgress,{config:{toRoom:n}}=e,o=!!r[n];this.#t({annotationText:`➡${n.toUpperCase()}`,yAdj:-12,error:!o,clickDispatch:o?()=>Ei(n):void 0})}break;case"conveyor":{const{config:{direction:r}}=e,n=Su[r];this.#t({annotationText:n,yAdj:-12})}break}}#t({annotationText:e,yAdj:r=0,error:n=!1,clickDispatch:o}){const{renderContext:{frontLayer:s}}=this,i=new ze(n?z.midRed:z.white),a=Jf(new ee({label:"EditorAnnotationTextContainer",filters:[i,new Ct({lowRes:!0,outlineColor:z.pureBlack,upscale:wr(M.getState())})]}),e);a.y=r,o!==void 0&&(a.eventMode="static",a.on("click",()=>{M.dispatch(o())}),a.on("mouseover",()=>{M.getState().levelEditor.tool.type==="pointer"&&(M.dispatch(gl(!0)),i.targetColor=z.pastelBlue)}),a.on("mouseout",()=>{M.dispatch(gl(!1)),i.targetColor=z.white}),a.cursor="pointer"),this.output.addChild(a),s.attach(a)}tick(e){this.#r(),this.childRenderer.tick(e)}#r(){const{renderContext:{item:e}}=this,{clickableAnnotationHovered:r}=M.getState().levelEditor,{jsonItemId:n}=e,o=M.getState(),s=nd(o),i=Wg(o),a=ar(o),l=n&&s?.jsonItemId===n&&!r,c=n&&i.includes(n);this.output.filters=l&&c?[_u,a.type==="eyeDropper"?xu:bu]:l?a.type==="eyeDropper"?xu:bu:c?_u:Zt}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const Vk=(t,e,r)=>e.general.editor?new qk(e,r):r,Kk=(t,e)=>{e!==void 0&&M.getState().gameMenus.cheatsOn&&(e.eventMode="static",e.on("pointertap",()=>{M.dispatch(hg({item:t}))}))},Xk=t=>{const e=M.getState(),r=ug(e),n=!dg(e),{item:o}=t,s=r==="all"||r==="non-wall"&&t.item.type!=="wall",i=[],a=Dk(o);if(a!==void 0){const h=new zf(t,a),p=new BS(t,h);i.push(Vk(o,t,Uk(o,t,p)))}if(n){const h=rS(t);h!==void 0&&i.push(h)}s&&i.push(new m_(t));let l;if(i.length===0)l=void 0;else{const h=i.length===1?i[0]:new Jk(i,t);Kk(o,h.output),l=new y_(t,h)}const c=t.general.soundSettings.mute??ya.soundSettings.mute,u=t.general.paused||c?void 0:xS(t),d=u===void 0?void 0:new kS(t,u);return new nS(t,{graphics:l,sound:d})};class Jk{constructor(e,r){this.renderContext=r,this.#e=e,this.#t.addChild(...e.map(n=>n.output))}#e;#t=new ee({label:"CompositeRenderer"});tick(e){for(const r of this.#e)r.tick(e)}destroy(){for(const e of this.#e)e.destroy()}get output(){return this.#t}}const Yk=Jn("wall","doorFrame"),ku=256;function*Zk(t){const{left:e,right:r}=Qe(t.items).filter(Yk).reduce((n,{aabb:o,renderAabb:s,renderAabbOffset:i,state:{position:a}})=>{const l=s??o,c=B(a,i??le),u=Q(B(c,{x:l.x})).x,d=Q(B(c,{y:l.y})).x;return{left:Math.min(n.left,u),right:Math.max(n.right,d)}},{left:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY});e!==Number.POSITIVE_INFINITY&&(yield new lt().rect(e-100,-256,100,ku).fill(0)),r!==Number.NEGATIVE_INFINITY&&(yield new lt().rect(r,-256,100,ku).fill(0))}class Qk{constructor(e){this.renderContext=e;const{general:{colourised:r,soundSettings:n},room:o}=e;this.initFilters(r,e.room.color);const i=n.mute??ya.soundSettings.mute?void 0:ae.createGain();gs(Zk(o),this.#o),this.output={sound:i,graphics:new ee({label:`RoomRenderer(${e.room.id})`})},this.output.graphics.addChild(this.#t),r||(this.#r=new El({sortableChildren:!1}),this.output.graphics.addChild(this.#r)),this.output.graphics.addChild(this.#o),this.output.graphics.addChild(this.#n)}#e=!1;#t=new ee({label:"items"});#r;#n=new El({sortableChildren:!1});#o=new ee({label:"occlusion"});output;#s=void 0;#l=new Map;#i=new Map;initFilters(e,r){this.#t.filters=e?r.shade==="dimmed"?NS:Zt:new ze(r.shade==="dimmed"?sf(Ko(r).main.original):Ko(r).main.original)}#c(e){const{room:r}=this.renderContext,n={...e,lastRenderRoomTime:this.#s};for(const s of Qe(r.items)){let i=this.#i.get(s.id);if(i===void 0){i=Xk({...this.renderContext,colourClashLayer:this.#r,frontLayer:this.#n,item:s}),this.#i.set(s.id,i);const{graphics:a,sound:l}=i.output;if(a&&(this.#t.addChild(a),s.fixedZIndex&&(a.zIndex=s.fixedZIndex)),l){if(!this.output.sound)throw new Error("item renderer has sound, but room renderer does not - this probably means that they disagree on if the user has sound muted");l.connect(this.output.sound)}}try{i.tick(n)}catch(a){throw new Error(`RoomRenderer caught error while ticking Renderer for item "${s.id}" - item in play object is:
           ${JSON.stringify(s,null,2)}`,{cause:a})}}let o=!1;for(const[s,i]of this.#i.entries())r.items[s]===void 0&&(i.destroy(),this.#i.delete(s),o=!0);o&&this.#a()}#a(){if(this.#r)for(const e of this.#r.renderLayerChildren)e.parent===null&&this.#r.detach(e);for(const e of this.#n.renderLayerChildren)e.parent===null&&this.#n.detach(e)}#d(e){const r=$f(this.renderContext.room.items,e.movedItems,this.#l),{order:n}=tl(r,this.renderContext.room.items);for(let o=0;o<n.length;o++){const s=this.#i.get(n[o]);if(s===void 0)throw new Error(`Item id=${n[o]} does not have a renderer - cannot assign a z-index`);const i=s.output.graphics;if(i)i.zIndex=n.length-o;else throw new Error(`order ${n[o]} was given a z-order by sorting, but item has no graphics`)}}get#u(){return this.#s!==void 0}tick(e){const r=this.#u?e:{...e,movedItems:new Set(Qe(this.renderContext.room.items))};this.#c(r),(!this.#u||r.movedItems.size>0)&&this.#d(r),this.#s=this.renderContext.room.roomTime}destroy(){this.output.graphics.label=this.output.graphics.label+"DESTROYED",this.output.graphics.destroy({children:!0}),this.output.sound?.disconnect(),this.#i.forEach(e=>{e.destroy()}),this.#e=!0}get destroyed(){return this.#e}}const Yf=g.createContext(null),eC=()=>{const[t,e]=g.useState(()=>Qc({roomJson:Fo(M.getState()),roomPickupsCollected:pe,scrollsRead:pe,isNewGame:!0})),r=be(Fo);return g.useEffect(()=>{const n=Qc({roomJson:r,roomPickupsCollected:pe,scrollsRead:pe,isNewGame:!0});e(n)},[r]),t},tC=({children:t})=>{const e=eC();return f.jsx(Yf,{value:e,children:t})},vs=()=>{const t=g.useContext(Yf);if(t===null)throw new Error("no room state in context, or no context");return t},rC=t=>{t.ticker.remove(t.render,t)},Zf=g.createContext(null),nC=({children:t})=>{const[e,r]=g.useState(null);return g.useEffect(()=>{const n=new pd;return n.init({background:z.pureBlack,sharedTicker:!0}).then(()=>{rC(n),r(n)}),()=>{}},[]),e===null?null:f.jsx(Zf,{value:e,children:t})},Sr=()=>g.useContext(Zf),oC=(t,e)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:e},soundSettings:{mute:!0},pixiRenderer:t,gameState:void 0,paused:!1,colourised:!0,upscale:ba(M.getState()),editor:!0}),Cu=(t,e,r)=>new Qk({room:t,general:oC(e,r)}),sC=()=>{const{renderer:t}=Sr(),e=Wu();if(!t)throw new Error("this should never be falsey (typescript violation)");const r=vs(),[n,o]=g.useState(()=>Cu(r,t,e));return g.useEffect(()=>{const s=Cu(r,t,e);return o(s),()=>{s.destroy()}},[r,t,e]),n},Qf=t=>Qe(t.items).filter(e=>Bn(e)&&!e.isCursorPreview),iC=(t,e)=>{for(const r of e)J_({room:t,item:r})},ua=t=>{for(const e of Qe(t.items))e.isCursorPreview&&delete t.items[e.id]};let aC=0;const ep=(t,e,r)=>{const{world:{onItem:{face:n},position:o,itemId:s}}=t;if(n.z>Vu)return Ao(o);if(r.type==="door"){const i=e.items[s];if(i.type!=="wall")return;const{config:a,aabb:l,state:{position:c}}=i,u=Gg(_a(a)),d=cn(Ut(a.direction)),h=Ut(a.direction);if(u[d]<2)return;const p=c[d],y=c[d]+l[d]-T_,m=c.z,v=c.z+l.z-En,w={[d]:Math.max(Math.min(o[d],y),p),[h]:o[h],z:Math.max(Math.min(o.z,v),m)};return Ao(w)}return B(Ao(o),n)},Pu=(t,e,r)=>{const n=(l,c,u)=>{const d=rl(`cursor/${aC++}`,{type:l,config:c,position:u},e.roomJson).toArray();return d.forEach(h=>{h.isCursorPreview=!0}),d},o=ep(t,e,r);if(o===void 0)return;if(r.type==="door"){const l=e.items[t.world.itemId];if(l.type!=="wall")return;const c=l.config.direction;return n("door",{...r.config,direction:c},o)}const s=n(r.type,r.config,o),i=Array.from(Qf(e));return s.some(l=>{const c=Nf(l,i);return!ka(c)})?void 0:s},lC={z:1,x:0,y:0},cC={z:0,x:0,y:-1},Eu={z:0,x:-1,y:0},uC=(t,{x:e,y:r},n)=>{if(n.type==="item"&&n.item.type==="door"&&t.type==="wall"){const l=t.config.direction;return ts(Ge[l],-1)}const{bottomCentre:o,topLeft:s,topRight:i}=sn(t.state.position,t.aabb);return r<s.y-(s.x-e)/2?r<i.y-(e-i.x)/2?lC:Eu:e<o.x?cC:Eu},dC=3,hC=(t,{x:e,y:r},n)=>{const o=sn(t.state.position,t.aabb);return fg.find(s=>{const i=o.projectCorner(s);return wa(Qr(i,{x:e,y:r}))<dC})},Dr=3,mi=1.5;function yt({x:t,y:e},r,n){const o={x:t-r.x,y:e-r.y},s=o.x*n.y-o.y*n.x;return Math.abs(s)/Math.hypot(n.x,n.y)}const tp={point:{x:-1,y:-1,z:0},normal:{x:0,y:0,z:1}},rp={point:{x:-1,y:0,z:1},normal:{x:0,y:1,z:0}},np={point:{x:0,y:-1,z:1},normal:{x:1,y:0,z:0}},op={point:{x:0,y:1,z:1},normal:{x:1,y:0,z:0}},sp={point:{x:1,y:0,z:1},normal:{x:0,y:1,z:0}},ip={point:{x:1,y:-1,z:0},normal:{x:0,y:0,z:1}},ap={point:{x:0,y:-1,z:-1},normal:{x:1,y:0,z:0}},lp={point:{x:-1,y:1,z:0},normal:{x:0,y:0,z:1}},cp={point:{x:-1,y:0,z:-1},normal:{x:0,y:1,z:0}},fC=(t,e,r,n)=>{const o=sn(t.state.position,t.aabb),s=r.x<0,i=r.y<0,a=r.z>0;if((s||i)&&yt(e,o.bottomCentre,{x:0,y:-1})<mi)return tp;if((s||a)&&yt(e,o.topRight,{x:2,y:-1})<mi)return rp;if((i||a)&&yt(e,o.topLeft,{x:2,y:1})<mi)return np;switch(!0){case a:{const l=o.c111;if(yt(e,l,{x:2,y:1})<Dr)return op;if(yt(e,l,{x:-2,y:1})<Dr)return sp;break}case i:{const l=o.c100;if(yt(e,l,{x:0,y:-1})<Dr)return ip;if(yt(e,l,{x:2,y:1})<Dr)return ap;break}case s:{const l=o.c010;if(yt(e,l,{x:0,y:-1})<Dr)return lp;if(yt(e,l,{x:-2,y:1})<Dr)return cp;break}}},pC=({x:t,y:e},r)=>n=>{const{position:o,aabb:s}=gC(n,r),{bottomCentre:i,topLeft:a,topRight:l}=sn(o,s);return!(t<a.x||t>l.x||e<l.y-(l.x-t)/2||e<a.y-(t-a.x)/2||e>i.y-(t-i.x)/2||e>i.y-(i.x-t)/2)},gC=(t,e)=>e.type==="item"&&t.type==="wall"?{position:t.state.position,aabb:t.aabb}:{position:B(t.state.position,t.renderAabbOffset??le),aabb:t.renderAabb??t.aabb},Au=t=>t.fixedZIndex!==void 0,mC=t=>{if(t.every(Au))return t.toSorted((s,i)=>i.fixedZIndex-s.fixedZIndex).at(0);const e=t.filter(s=>!Au(s));if(e.length===0)return;if(e.length===1)return e[0];const r=Object.fromEntries(e.map(s=>[s.id,s])),n=$f(r),{order:o}=tl(n,r);return r[o[0]]},up=(t,e,r,n)=>{const o=!n||r.type==="item"&&r.item.type==="door",s=o?X.w:X.w/2,i=X.h,a=o?0:s/2,l=i/2,c=pg(e);return{x:c==="yz"?Math.round(t.x/s)*s:Math.floor((t.x-a)/s)*s,y:c==="xz"?Math.round(t.y/s)*s:Math.floor((t.y-a)/s)*s,z:c==="xy"?Math.round(t.z/i)*i:Math.floor((t.z+l)/i)*i}},yC=({state:{position:t},aabb:e},r,n,o,s)=>{const i={x:t.x+(r.x<0?0:e.x),y:t.y+(r.y<0?0:e.y),z:t.z+(r.z<0?0:e.z)},a=qg(i,r,n);return up(a,r,o,s)},vC=t=>e=>{const r=Bn(e)&&!e.isCursorPreview;return t.type==="item"&&t.item.type==="door"?r&&e.type==="wall":r},yi=(t,e,r,n)=>{const o=mC(Array.from(Qe(e.items).filter(vC(r)).filter(pC(t,r)))),s=e.id;if(o){const i=uC(o,t,r);return{roomId:s,scrXy:t,world:{itemId:o.id,onItem:{face:i,corner:hC(o,t),edge:fC(o,t,i)},position:yC(o,i,t,r,n)}}}else return{roomId:s,scrXy:t,world:void 0}},wC=(t,e=console.error)=>(...r)=>{try{return t(...r)}catch(n){e(n);return}},bC=t=>{const e=t.key;(e==="Backspace"||e==="Delete")&&M.dispatch(Ju()),(e==="z"||e==="Z")&&M.dispatch(t.shiftKey?Zu():Yu()),(e==="i"||e==="I"||e===",")&&M.dispatch(Ht({type:"eyeDropper"})),e==="Escape"&&M.dispatch(Ht({type:"pointer"}))},dp=t=>va(il(t))>0,il=t=>{switch(t.type){case"deadlyBlock":return ks;case"conveyor":if(t.config.disappearing)return le;switch(t.config.direction){case"left":case"right":return{x:1,y:0,z:0};case"away":case"towards":return{x:0,y:1,z:0};default:throw t.config.direction,new Error}case"hushPuppy":return ks;case"teleporter":return{x:1,y:1,z:0};case"floor":case"spikes":return{x:1,y:1,z:0};case"block":return t.config.disappearing?le:ks;case"barrier":if(t.config.disappearing)return le;switch(t.config.axis){case"x":return{x:1,y:0,z:1};case"y":return{x:0,y:1,z:1};default:throw t.config.axis,new Error}case"wall":switch(t.config.direction){case"left":case"right":return{x:0,y:1,z:1};case"away":case"towards":return{x:1,y:0,z:1};default:throw t.config,new Error}default:return le}},xC=({roomState:t,jsonItemId:e,newPosition:r,newTimes:n})=>{const o=Kt(Qf(t)).filter(i=>i.id!==e);return rl("testItem",gg(t.roomJson.items[e],i=>{n&&(i.config.times=n),i.position=r}),t.roomJson).some(i=>{const a=Nf(i,o);return!ka(a)})},hp=(t,...e)=>({x:t(...e.map(r=>r.x)),y:t(...e.map(r=>r.y)),z:t(...e.map(r=>r.z))}),_C=t=>hp(e=>e>0?e:e>-1?1:-e+1,t),SC=({jsonItem:t,blockDragAccVec:e,resizeEdgeDirection:r,startTimes:n,startPosition:o})=>{const s=Xu(e,r,il(t)),i=B(n,s),a=_C(i),l=hp((c,u,d,h,p)=>{const y=u<1;return c<0!==y?y?d-p+1:d+h-p:y?d+h-1:d},r,i,o,n,a);return{newTimes:a,newPosition:l}},kC=5,vi=(t,e)=>{const r=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const n=e.target.getBoundingClientRect(),o=e.clientX-n.left,s=e.clientY-n.top;return{x:o/r-t.gameEngineScreenSize.x/2,y:s/r-t.gameEngineScreenSize.y+16}},CC=(t,e)=>{const r=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const n=e.movementX,o=e.movementY;return{x:n/r,y:o/r}},PC=(t,e,r)=>{const n=t.world?.onItem.edge,o=Xu(n?.point??le,il(r));return va(o)>0?n.normal:e?{x:1,y:0,z:0}:{x:0,y:0,z:1}},EC=(t,e,r,n,o,s)=>{if(t===void 0)return;const i=Qr(e,t.scrXy),a=wa(i);if(!(o||a>kC))return;const c=PC(t,n,s),u=Jg(c,r);return n?{x:0,y:0,z:u.z}:u},Tu=(t,e=!1)=>{const r=M.getState().levelEditor;return up(t,{x:0,y:0,z:1},r.tool,!e&&r.halfGridResolution)},AC=(t,e)=>t.items[e]?.jsonItemId,TC=(t,e)=>e.jsonItemId&&t.levelEditor.selectedJsonItemIds.includes(e.jsonItemId),Lo=(t,e)=>e.levelEditor.wallsFloorsLocked&&(t.type==="wall"||t.type==="floor"),wi=(t,e)=>{const r=M.getState();let n;if(e.world){const o=e.world.itemId,s=o&&t.items[o],i=Lo(s,r)?void 0:s.jsonItemId;n=i===void 0?void 0:{jsonItemId:i,pointingAtOnItem:e.world.onItem}}else n=void 0;We(nd(r),n)||M.dispatch(od(n))},RC=t=>{const e=Sr(),r=un(ba),n=pt(),o=vs(),s=g.useRef(void 0),i=g.useRef(void 0),a=g.useRef(void 0),l=g.useRef(void 0),c=g.useRef(!0);g.useEffect(()=>{if(t===null)return;const u=v=>{const w=vi(r,v),_=CC(r,v),b=M.getState(),x=ar(b),k=yi(w,o,x,b.levelEditor.halfGridResolution),C=!We(k.world,s.current?.world);switch(x.type){case"item":{if(!C)break;const S=k.world&&Pu(k,o,x.item);ua(o),S!==void 0&&iC(o,S);break}case"pointer":{const S=i.current?.world?.itemId;if(S===void 0){wi(o,k);break}const j=o.items[S],{jsonItemId:U}=j,N=o.roomJson.items[U],H=EC(i.current,w,_,v.metaKey||v.shiftKey,a.current!==void 0,N);if(!H){wi(o,k);break}if(l.current===void 0&&(M.dispatch(ml(!0)),c.current=!0,l.current={position:N.position,times:yl(N.config.times)}),U===void 0||Lo(j,b))break;TC(b,j)||M.dispatch(Es({jsonItemId:U}));const I=i.current?.world?.onItem.edge,te=I&&dp(N),D=a.current??le,K=B(D,H),W=Tu(K,te);if(a.current=K,In(Tu(D,te),W))break;const oe=l.current.position,V=l.current.times,se=Ao(W);let ue,ce;if(te?{newTimes:ce,newPosition:ue}=SC({jsonItem:N,blockDragAccVec:se,resizeEdgeDirection:I.point,startTimes:V,startPosition:oe}):ue=B(oe,se),(!ce||In(ce,yl(N.config.times)))&&In(ue,N.position)||xC({roomState:o,jsonItemId:U,newPosition:ue,newTimes:ce}))break;n(Xg({jsonItemId:U,newPosition:ue,newTimes:ce,startOfGesture:c.current})),c.current=!1;break}case"eyeDropper":wi(o,k);break}s.current=k},d=v=>{const w=M.getState();if(o.id!==w.levelEditor.currentlyEditingRoomId)return;const _=vi(r,v),b=ar(M.getState()),x=yi(_,o,b,w.levelEditor.halfGridResolution),k=a.current!==void 0,C=!k&&x.roomId===i.current?.roomId&&x.world?.itemId===i.current?.world?.itemId;if(a.current=void 0,i.current=void 0,l.current=void 0,M.dispatch(ml(!1)),!C&&!k){console.log("mouseUp - not a click or drag end - skipping");return}switch(b.type){case"item":{if(x.world===void 0){n(Ht({type:"pointer"}));break}if(Pu(x,o,b.item)===void 0)break;const j=o.items[x.world.itemId];n(Kg({blockPosition:ep(x,o,b.item),pointedAtItem:{type:j.type,config:j.config,state:j.state,jsonItemId:j.jsonItemId}}));break}case"pointer":{if(C){const S=x.world===void 0?void 0:o.items[x.world.itemId];if(S?.jsonItemId===void 0||Lo(S,w)){n(Es({jsonItemId:void 0}));break}n(Es({jsonItemId:S.jsonItemId,additive:v.ctrlKey||v.metaKey}))}break}case"eyeDropper":{if(C){const S=x.world?.itemId;if(S===void 0){console.warn("no itemId");break}const j=o.items[S];if(Lo(j,w))break;const U=AC(o,S),N=Vg(w,U);if(N===void 0){console.warn("no json item");break}const H={type:"item",item:{type:N.type,config:N.config}};n(Ht(H))}break}}},h=v=>{const w=ar(M.getState());switch(a.current=void 0,i.current=void 0,l.current=void 0,w.type){case"item":{ua(o);break}case"pointer":{n(od(void 0));break}}},p=v=>{const w=vi(r,v),_=M.getState(),b=ar(_),x=yi(w,o,b,_.levelEditor.halfGridResolution);console.log("setting mouseDownPointingAtRef to",x),i.current=x},y=v=>{bC(v)},m=wC(u);return t.addEventListener("mousemove",m),t.addEventListener("mouseup",d),t.addEventListener("mousedown",p),t.addEventListener("mouseleave",h),t.tabIndex=0,t.addEventListener("keyup",y),()=>{t.removeEventListener("mousemove",m),t.removeEventListener("mouseup",d),t.removeEventListener("mousedown",p),t.removeEventListener("mouseleave",h),t.removeEventListener("keyup",y)}},[e.stage,r,t,n,o])},OC=()=>{const{cssUpscale:t,canvasSize:e,rotate90:r}=un(ba);return{transform:r?`scale(${t}) rotate(90deg) translate(0, -${e.y}px)`:`scale(${t})`,width:e.x,height:e.y,transformOrigin:"top left"}},IC=t=>{const e=vs(),r=Sr();g.useEffect(()=>{let n=0;const o=({deltaMS:s})=>{if(t.destroyed)return;t.renderContext.room!==e&&console.warn("room renderer does not have the current room");const i=new Set(Bo(e.items));e.roomTime+=s,t.tick({deltaMS:s,movedItems:i,progression:n++}),r.render()};return Wr.shared.add(o),()=>{Wr.shared.remove(o)}},[t,e,r])},jC=t=>{const e=Sr();g.useEffect(()=>{if(t)return t.appendChild(e.canvas),()=>{t.removeChild(e.canvas)}},[t,e])},$C=()=>{const t=Sr(),e=un(r=>r.upscale.upscale.gameEngineUpscale);t.stage.scale=e},zC=()=>{const t=Sr(),e=un(mg);g.useEffect(()=>{t.renderer?.resize(e.x,e.y)},[t.renderer,e])},NC=t=>{const e=Sr(),[r]=g.useState(()=>new ee),n=un(yg);g.useEffect(()=>{if(t.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return r.addChild(t.output.graphics),e.stage.addChild(r),()=>{e.stage.removeChild(r),r.removeChild(t.output.graphics)}},[t,e,r]),g.useEffect(()=>{r.x=n.x/2,r.y=n.y-16},[r,n])},Ru=(t,e)=>{M.dispatch(vg(wg(bg(M.getState()),e)))},LC=(t,e)=>{const r=pt();g.useLayoutEffect(()=>{Ru()},[]),g.useLayoutEffect(()=>{const n=()=>Ru(t,e);if(e){const o=new ResizeObserver(n);return o.observe(e),()=>o.disconnect()}else return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[r,e,t])},DC=()=>{const t=vs();g.useEffect(()=>xg({actionCreator:Ht,effect(){ua(t)}}),[t])},MC=({levelEditor:t})=>{const{dragInProgress:e,clickableAnnotationHovered:r,hoveredItem:n,selectedJsonItemIds:o}=t;if(e)return me("cursor-grabbing");if(r)return me("cursor-pointer");if(n){const s=Yg(t,n.jsonItemId);if(s!==void 0&&dp(s))if(n.pointingAtOnItem.corner){if(In(n.pointingAtOnItem.corner,{x:1,y:1,z:1}))return me("cursor-n-resize")}else{const{edge:i}=n.pointingAtOnItem;if(i){if(We(i,lp))return me("cursor-e-resize");if(We(i,tp))return me("cursor-s-resize");if(We(i,ip))return me("cursor-w-resize");if(We(i,rp)||We(i,op))return me("cursor-ne-resize");if(We(i,np)||We(i,sp))return me("cursor-nw-resize");if(We(i,cp))return me("cursor-se-resize");if(We(i,ap))return me("cursor-sw-resize")}}return o.includes(n.jsonItemId)?me("cursor-grab"):me("cursor-default")}return me("cursor-crosshair")},BC=()=>be(MC);_g.defaultOptions.scaleMode="nearest";const FC=()=>{const t=sC(),[e,r]=g.useState(null),[n,o]=g.useState(null),s=BC();LC(void 0,n??void 0),zC(),NC(t),IC(t),RC(e),jC(e),$C(),DC();const i=OC();return f.jsx("div",{className:`w-full h-full overflow-hidden ${s}`,ref:o,children:f.jsx("div",{style:i,ref:r})})},Ou=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,UC=()=>{const t=Sg(),e=un(kg);g.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",Cg())},[]),g.useEffect(()=>{document.body.classList.remove(...Object.keys(Pg).map(Ou)),document.body.classList.add(Ou(t)),document.body.classList.toggle("portrait-rot",e)},[t,e])},ws=g.createContext(null);ws.displayName="PanelGroupContext";const ye={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},al=10,ur=g.useLayoutEffect,Iu=Hu.useId,HC=typeof Iu=="function"?Iu:()=>null;let WC=0;function ll(t=null){const e=HC(),r=g.useRef(t||e||null);return r.current===null&&(r.current=""+WC++),t??r.current}function fp({children:t,className:e="",collapsedSize:r,collapsible:n,defaultSize:o,forwardedRef:s,id:i,maxSize:a,minSize:l,onCollapse:c,onExpand:u,onResize:d,order:h,style:p,tagName:y="div",...m}){const v=g.useContext(ws);if(v===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:w,expandPanel:_,getPanelSize:b,getPanelStyle:x,groupId:k,isPanelCollapsed:C,reevaluatePanelConstraints:S,registerPanel:j,resizePanel:U,unregisterPanel:N}=v,H=ll(i),I=g.useRef({callbacks:{onCollapse:c,onExpand:u,onResize:d},constraints:{collapsedSize:r,collapsible:n,defaultSize:o,maxSize:a,minSize:l},id:H,idIsFromProps:i!==void 0,order:h});g.useRef({didLogMissingDefaultSizeWarning:!1}),ur(()=>{const{callbacks:D,constraints:K}=I.current,W={...K};I.current.id=H,I.current.idIsFromProps=i!==void 0,I.current.order=h,D.onCollapse=c,D.onExpand=u,D.onResize=d,K.collapsedSize=r,K.collapsible=n,K.defaultSize=o,K.maxSize=a,K.minSize=l,(W.collapsedSize!==K.collapsedSize||W.collapsible!==K.collapsible||W.maxSize!==K.maxSize||W.minSize!==K.minSize)&&S(I.current,W)}),ur(()=>{const D=I.current;return j(D),()=>{N(D)}},[h,H,j,N]),g.useImperativeHandle(s,()=>({collapse:()=>{w(I.current)},expand:D=>{_(I.current,D)},getId(){return H},getSize(){return b(I.current)},isCollapsed(){return C(I.current)},isExpanded(){return!C(I.current)},resize:D=>{U(I.current,D)}}),[w,_,b,C,H,U]);const te=x(I.current,o);return g.createElement(y,{...m,children:t,className:e,id:H,style:{...te,...p},[ye.groupId]:k,[ye.panel]:"",[ye.panelCollapsible]:n||void 0,[ye.panelId]:H,[ye.panelSize]:parseFloat(""+te.flexGrow).toFixed(1)})}const Do=g.forwardRef((t,e)=>g.createElement(fp,{...t,forwardedRef:e}));fp.displayName="Panel";Do.displayName="forwardRef(Panel)";let da=null,Mo=-1,Dt=null;function GC(t,e){if(e){const r=(e&vp)!==0,n=(e&wp)!==0,o=(e&bp)!==0,s=(e&xp)!==0;if(r)return o?"se-resize":s?"ne-resize":"e-resize";if(n)return o?"sw-resize":s?"nw-resize":"w-resize";if(o)return"s-resize";if(s)return"n-resize"}switch(t){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function qC(){Dt!==null&&(document.head.removeChild(Dt),da=null,Dt=null,Mo=-1)}function bi(t,e){var r,n;const o=GC(t,e);if(da!==o){if(da=o,Dt===null&&(Dt=document.createElement("style"),document.head.appendChild(Dt)),Mo>=0){var s;(s=Dt.sheet)===null||s===void 0||s.removeRule(Mo)}Mo=(r=(n=Dt.sheet)===null||n===void 0?void 0:n.insertRule(`*{cursor: ${o} !important;}`))!==null&&r!==void 0?r:-1}}function pp(t){return t.type==="keydown"}function gp(t){return t.type.startsWith("pointer")}function mp(t){return t.type.startsWith("mouse")}function bs(t){if(gp(t)){if(t.isPrimary)return{x:t.clientX,y:t.clientY}}else if(mp(t))return{x:t.clientX,y:t.clientY};return{x:1/0,y:1/0}}function VC(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function KC(t,e,r){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function XC(t,e){if(t===e)throw new Error("Cannot compare node with itself");const r={a:zu(t),b:zu(e)};let n;for(;r.a.at(-1)===r.b.at(-1);)t=r.a.pop(),e=r.b.pop(),n=t;Z(n,"Stacking order can only be calculated for elements with a common ancestor");const o={a:$u(ju(r.a)),b:$u(ju(r.b))};if(o.a===o.b){const s=n.childNodes,i={a:r.a.at(-1),b:r.b.at(-1)};let a=s.length;for(;a--;){const l=s[a];if(l===i.a)return 1;if(l===i.b)return-1}}return Math.sign(o.a-o.b)}const JC=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function YC(t){var e;const r=getComputedStyle((e=yp(t))!==null&&e!==void 0?e:t).display;return r==="flex"||r==="inline-flex"}function ZC(t){const e=getComputedStyle(t);return!!(e.position==="fixed"||e.zIndex!=="auto"&&(e.position!=="static"||YC(t))||+e.opacity<1||"transform"in e&&e.transform!=="none"||"webkitTransform"in e&&e.webkitTransform!=="none"||"mixBlendMode"in e&&e.mixBlendMode!=="normal"||"filter"in e&&e.filter!=="none"||"webkitFilter"in e&&e.webkitFilter!=="none"||"isolation"in e&&e.isolation==="isolate"||JC.test(e.willChange)||e.webkitOverflowScrolling==="touch")}function ju(t){let e=t.length;for(;e--;){const r=t[e];if(Z(r,"Missing node"),ZC(r))return r}return null}function $u(t){return t&&Number(getComputedStyle(t).zIndex)||0}function zu(t){const e=[];for(;t;)e.push(t),t=yp(t);return e}function yp(t){const{parentNode:e}=t;return e&&e instanceof ShadowRoot?e.host:e}const vp=1,wp=2,bp=4,xp=8,QC=VC()==="coarse";let et=[],Zr=!1,Mt=new Map,xs=new Map;const qn=new Set;function eP(t,e,r,n,o){var s;const{ownerDocument:i}=e,a={direction:r,element:e,hitAreaMargins:n,setResizeHandlerState:o},l=(s=Mt.get(i))!==null&&s!==void 0?s:0;return Mt.set(i,l+1),qn.add(a),Qo(),function(){var u;xs.delete(t),qn.delete(a);const d=(u=Mt.get(i))!==null&&u!==void 0?u:1;if(Mt.set(i,d-1),Qo(),d===1&&Mt.delete(i),et.includes(a)){const h=et.indexOf(a);h>=0&&et.splice(h,1),ul(),o("up",!0,null)}}}function tP(t){const{target:e}=t,{x:r,y:n}=bs(t);Zr=!0,cl({target:e,x:r,y:n}),Qo(),et.length>0&&(es("down",t),t.preventDefault(),_p(e)||t.stopImmediatePropagation())}function xi(t){const{x:e,y:r}=bs(t);if(Zr&&t.buttons===0&&(Zr=!1,es("up",t)),!Zr){const{target:n}=t;cl({target:n,x:e,y:r})}es("move",t),ul(),et.length>0&&t.preventDefault()}function _i(t){const{target:e}=t,{x:r,y:n}=bs(t);xs.clear(),Zr=!1,et.length>0&&(t.preventDefault(),_p(e)||t.stopImmediatePropagation()),es("up",t),cl({target:e,x:r,y:n}),ul(),Qo()}function _p(t){let e=t;for(;e;){if(e.hasAttribute(ye.resizeHandle))return!0;e=e.parentElement}return!1}function cl({target:t,x:e,y:r}){et.splice(0);let n=null;(t instanceof HTMLElement||t instanceof SVGElement)&&(n=t),qn.forEach(o=>{const{element:s,hitAreaMargins:i}=o,a=s.getBoundingClientRect(),{bottom:l,left:c,right:u,top:d}=a,h=QC?i.coarse:i.fine;if(e>=c-h&&e<=u+h&&r>=d-h&&r<=l+h){if(n!==null&&document.contains(n)&&s!==n&&!s.contains(n)&&!n.contains(s)&&XC(n,s)>0){let y=n,m=!1;for(;y&&!y.contains(s);){if(KC(y.getBoundingClientRect(),a)){m=!0;break}y=y.parentElement}if(m)return}et.push(o)}})}function Si(t,e){xs.set(t,e)}function ul(){let t=!1,e=!1;et.forEach(n=>{const{direction:o}=n;o==="horizontal"?t=!0:e=!0});let r=0;xs.forEach(n=>{r|=n}),t&&e?bi("intersection",r):t?bi("horizontal",r):e?bi("vertical",r):qC()}let ki;function Qo(){var t;(t=ki)===null||t===void 0||t.abort(),ki=new AbortController;const e={capture:!0,signal:ki.signal};qn.size&&(Zr?(et.length>0&&Mt.forEach((r,n)=>{const{body:o}=n;r>0&&(o.addEventListener("contextmenu",_i,e),o.addEventListener("pointerleave",xi,e),o.addEventListener("pointermove",xi,e))}),Mt.forEach((r,n)=>{const{body:o}=n;o.addEventListener("pointerup",_i,e),o.addEventListener("pointercancel",_i,e)})):Mt.forEach((r,n)=>{const{body:o}=n;r>0&&(o.addEventListener("pointerdown",tP,e),o.addEventListener("pointermove",xi,e))}))}function es(t,e){qn.forEach(r=>{const{setResizeHandlerState:n}=r,o=et.includes(r);n(t,o,e)})}function rP(){const[t,e]=g.useState(0);return g.useCallback(()=>e(r=>r+1),[])}function Z(t,e){if(!t)throw console.error(e),Error(e)}function yr(t,e,r=al){return t.toFixed(r)===e.toFixed(r)?0:t>e?1:-1}function xt(t,e,r=al){return yr(t,e,r)===0}function Le(t,e,r){return yr(t,e,r)===0}function nP(t,e,r){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++){const o=t[n],s=e[n];if(!Le(o,s,r))return!1}return!0}function Kr({panelConstraints:t,panelIndex:e,size:r}){const n=t[e];Z(n!=null,`Panel constraints not found for index ${e}`);let{collapsedSize:o=0,collapsible:s,maxSize:i=100,minSize:a=0}=n;if(yr(r,a)<0)if(s){const l=(o+a)/2;yr(r,l)<0?r=o:r=a}else r=a;return r=Math.min(i,r),r=parseFloat(r.toFixed(al)),r}function Tn({delta:t,initialLayout:e,panelConstraints:r,pivotIndices:n,prevLayout:o,trigger:s}){if(Le(t,0))return e;const i=[...e],[a,l]=n;Z(a!=null,"Invalid first pivot index"),Z(l!=null,"Invalid second pivot index");let c=0;if(s==="keyboard"){{const d=t<0?l:a,h=r[d];Z(h,`Panel constraints not found for index ${d}`);const{collapsedSize:p=0,collapsible:y,minSize:m=0}=h;if(y){const v=e[d];if(Z(v!=null,`Previous layout not found for panel index ${d}`),Le(v,p)){const w=m-v;yr(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}{const d=t<0?a:l,h=r[d];Z(h,`No panel constraints found for index ${d}`);const{collapsedSize:p=0,collapsible:y,minSize:m=0}=h;if(y){const v=e[d];if(Z(v!=null,`Previous layout not found for panel index ${d}`),Le(v,m)){const w=v-p;yr(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}}{const d=t<0?1:-1;let h=t<0?l:a,p=0;for(;;){const m=e[h];Z(m!=null,`Previous layout not found for panel index ${h}`);const w=Kr({panelConstraints:r,panelIndex:h,size:100})-m;if(p+=w,h+=d,h<0||h>=r.length)break}const y=Math.min(Math.abs(t),Math.abs(p));t=t<0?0-y:y}{let h=t<0?a:l;for(;h>=0&&h<r.length;){const p=Math.abs(t)-Math.abs(c),y=e[h];Z(y!=null,`Previous layout not found for panel index ${h}`);const m=y-p,v=Kr({panelConstraints:r,panelIndex:h,size:m});if(!Le(y,v)&&(c+=y-v,i[h]=v,c.toPrecision(3).localeCompare(Math.abs(t).toPrecision(3),void 0,{numeric:!0})>=0))break;t<0?h--:h++}}if(nP(o,i))return o;{const d=t<0?l:a,h=e[d];Z(h!=null,`Previous layout not found for panel index ${d}`);const p=h+c,y=Kr({panelConstraints:r,panelIndex:d,size:p});if(i[d]=y,!Le(y,p)){let m=p-y,w=t<0?l:a;for(;w>=0&&w<r.length;){const _=i[w];Z(_!=null,`Previous layout not found for panel index ${w}`);const b=_+m,x=Kr({panelConstraints:r,panelIndex:w,size:b});if(Le(_,x)||(m-=x-_,i[w]=x),Le(m,0))break;t>0?w--:w++}}}const u=i.reduce((d,h)=>h+d,0);return Le(u,100)?i:o}function oP({layout:t,panelsArray:e,pivotIndices:r}){let n=0,o=100,s=0,i=0;const a=r[0];Z(a!=null,"No pivot index found"),e.forEach((d,h)=>{const{constraints:p}=d,{maxSize:y=100,minSize:m=0}=p;h===a?(n=m,o=y):(s+=m,i+=y)});const l=Math.min(o,100-s),c=Math.max(n,100-i),u=t[a];return{valueMax:l,valueMin:c,valueNow:u}}function Vn(t,e=document){return Array.from(e.querySelectorAll(`[${ye.resizeHandleId}][data-panel-group-id="${t}"]`))}function Sp(t,e,r=document){const o=Vn(t,r).findIndex(s=>s.getAttribute(ye.resizeHandleId)===e);return o??null}function kp(t,e,r){const n=Sp(t,e,r);return n!=null?[n,n+1]:[-1,-1]}function sP(t){return t instanceof HTMLElement?!0:typeof t=="object"&&t!==null&&"tagName"in t&&"getAttribute"in t}function Cp(t,e=document){if(sP(e)&&e.dataset.panelGroupId==t)return e;const r=e.querySelector(`[data-panel-group][data-panel-group-id="${t}"]`);return r||null}function _s(t,e=document){const r=e.querySelector(`[${ye.resizeHandleId}="${t}"]`);return r||null}function iP(t,e,r,n=document){var o,s,i,a;const l=_s(e,n),c=Vn(t,n),u=l?c.indexOf(l):-1,d=(o=(s=r[u])===null||s===void 0?void 0:s.id)!==null&&o!==void 0?o:null,h=(i=(a=r[u+1])===null||a===void 0?void 0:a.id)!==null&&i!==void 0?i:null;return[d,h]}function aP({committedValuesRef:t,eagerValuesRef:e,groupId:r,layout:n,panelDataArray:o,panelGroupElement:s,setLayout:i}){g.useRef({didWarnAboutMissingResizeHandle:!1}),ur(()=>{if(!s)return;const a=Vn(r,s);for(let l=0;l<o.length-1;l++){const{valueMax:c,valueMin:u,valueNow:d}=oP({layout:n,panelsArray:o,pivotIndices:[l,l+1]}),h=a[l];if(h!=null){const p=o[l];Z(p,`No panel data found for index "${l}"`),h.setAttribute("aria-controls",p.id),h.setAttribute("aria-valuemax",""+Math.round(c)),h.setAttribute("aria-valuemin",""+Math.round(u)),h.setAttribute("aria-valuenow",d!=null?""+Math.round(d):"")}}return()=>{a.forEach((l,c)=>{l.removeAttribute("aria-controls"),l.removeAttribute("aria-valuemax"),l.removeAttribute("aria-valuemin"),l.removeAttribute("aria-valuenow")})}},[r,n,o,s]),g.useEffect(()=>{if(!s)return;const a=e.current;Z(a,"Eager values not found");const{panelDataArray:l}=a,c=Cp(r,s);Z(c!=null,`No group found for id "${r}"`);const u=Vn(r,s);Z(u,`No resize handles found for group id "${r}"`);const d=u.map(h=>{const p=h.getAttribute(ye.resizeHandleId);Z(p,"Resize handle element has no handle id attribute");const[y,m]=iP(r,p,l,s);if(y==null||m==null)return()=>{};const v=w=>{if(!w.defaultPrevented)switch(w.key){case"Enter":{w.preventDefault();const _=l.findIndex(b=>b.id===y);if(_>=0){const b=l[_];Z(b,`No panel data found for index ${_}`);const x=n[_],{collapsedSize:k=0,collapsible:C,minSize:S=0}=b.constraints;if(x!=null&&C){const j=Tn({delta:Le(x,k)?S-k:k-x,initialLayout:n,panelConstraints:l.map(U=>U.constraints),pivotIndices:kp(r,p,s),prevLayout:n,trigger:"keyboard"});n!==j&&i(j)}}break}}};return h.addEventListener("keydown",v),()=>{h.removeEventListener("keydown",v)}});return()=>{d.forEach(h=>h())}},[s,t,e,r,n,o,i])}function Nu(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Pp(t,e){const r=t==="horizontal",{x:n,y:o}=bs(e);return r?n:o}function lP(t,e,r,n,o){const s=r==="horizontal",i=_s(e,o);Z(i,`No resize handle element found for id "${e}"`);const a=i.getAttribute(ye.groupId);Z(a,"Resize handle element has no group id attribute");let{initialCursorPosition:l}=n;const c=Pp(r,t),u=Cp(a,o);Z(u,`No group element found for id "${a}"`);const d=u.getBoundingClientRect(),h=s?d.width:d.height;return(c-l)/h*100}function cP(t,e,r,n,o,s){if(pp(t)){const i=r==="horizontal";let a=0;t.shiftKey?a=100:o!=null?a=o:a=10;let l=0;switch(t.key){case"ArrowDown":l=i?0:a;break;case"ArrowLeft":l=i?-a:0;break;case"ArrowRight":l=i?a:0;break;case"ArrowUp":l=i?0:-a;break;case"End":l=100;break;case"Home":l=-100;break}return l}else return n==null?0:lP(t,e,r,n,s)}function uP({panelDataArray:t}){const e=Array(t.length),r=t.map(s=>s.constraints);let n=0,o=100;for(let s=0;s<t.length;s++){const i=r[s];Z(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;a!=null&&(n++,e[s]=a,o-=a)}for(let s=0;s<t.length;s++){const i=r[s];Z(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;if(a!=null)continue;const l=t.length-n,c=o/l;n++,e[s]=c,o-=c}return e}function Mr(t,e,r){e.forEach((n,o)=>{const s=t[o];Z(s,`Panel data not found for index ${o}`);const{callbacks:i,constraints:a,id:l}=s,{collapsedSize:c=0,collapsible:u}=a,d=r[l];if(d==null||n!==d){r[l]=n;const{onCollapse:h,onExpand:p,onResize:y}=i;y&&y(n,d),u&&(h||p)&&(p&&(d==null||xt(d,c))&&!xt(n,c)&&p(),h&&(d==null||!xt(d,c))&&xt(n,c)&&h())}})}function Po(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!=e[r])return!1;return!0}function dP({defaultSize:t,dragState:e,layout:r,panelData:n,panelIndex:o,precision:s=3}){const i=r[o];let a;return i==null?a=t!=null?t.toPrecision(s):"1":n.length===1?a="1":a=i.toPrecision(s),{flexBasis:0,flexGrow:a,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function hP(t,e=10){let r=null;return(...o)=>{r!==null&&clearTimeout(r),r=setTimeout(()=>{t(...o)},e)}}function Lu(t){try{if(typeof localStorage<"u")t.getItem=e=>localStorage.getItem(e),t.setItem=(e,r)=>{localStorage.setItem(e,r)};else throw new Error("localStorage not supported in this environment")}catch(e){console.error(e),t.getItem=()=>null,t.setItem=()=>{}}}function Ep(t){return`react-resizable-panels:${t}`}function Ap(t){return t.map(e=>{const{constraints:r,id:n,idIsFromProps:o,order:s}=e;return o?n:s?`${s}:${JSON.stringify(r)}`:JSON.stringify(r)}).sort((e,r)=>e.localeCompare(r)).join(",")}function Tp(t,e){try{const r=Ep(t),n=e.getItem(r);if(n){const o=JSON.parse(n);if(typeof o=="object"&&o!=null)return o}}catch{}return null}function fP(t,e,r){var n,o;const s=(n=Tp(t,r))!==null&&n!==void 0?n:{},i=Ap(e);return(o=s[i])!==null&&o!==void 0?o:null}function pP(t,e,r,n,o){var s;const i=Ep(t),a=Ap(e),l=(s=Tp(t,o))!==null&&s!==void 0?s:{};l[a]={expandToSizes:Object.fromEntries(r.entries()),layout:n};try{o.setItem(i,JSON.stringify(l))}catch(c){console.error(c)}}function Du({layout:t,panelConstraints:e}){const r=[...t],n=r.reduce((s,i)=>s+i,0);if(r.length!==e.length)throw Error(`Invalid ${e.length} panel layout: ${r.map(s=>`${s}%`).join(", ")}`);if(!Le(n,100)&&r.length>0)for(let s=0;s<e.length;s++){const i=r[s];Z(i!=null,`No layout data found for index ${s}`);const a=100/n*i;r[s]=a}let o=0;for(let s=0;s<e.length;s++){const i=r[s];Z(i!=null,`No layout data found for index ${s}`);const a=Kr({panelConstraints:e,panelIndex:s,size:i});i!=a&&(o+=i-a,r[s]=a)}if(!Le(o,0))for(let s=0;s<e.length;s++){const i=r[s];Z(i!=null,`No layout data found for index ${s}`);const a=i+o,l=Kr({panelConstraints:e,panelIndex:s,size:a});if(i!==l&&(o-=l-i,r[s]=l,Le(o,0)))break}return r}const gP=100,Rn={getItem:t=>(Lu(Rn),Rn.getItem(t)),setItem:(t,e)=>{Lu(Rn),Rn.setItem(t,e)}},Mu={};function Rp({autoSaveId:t=null,children:e,className:r="",direction:n,forwardedRef:o,id:s=null,onLayout:i=null,keyboardResizeBy:a=null,storage:l=Rn,style:c,tagName:u="div",...d}){const h=ll(s),p=g.useRef(null),[y,m]=g.useState(null),[v,w]=g.useState([]),_=rP(),b=g.useRef({}),x=g.useRef(new Map),k=g.useRef(0),C=g.useRef({autoSaveId:t,direction:n,dragState:y,id:h,keyboardResizeBy:a,onLayout:i,storage:l}),S=g.useRef({layout:v,panelDataArray:[],panelDataArrayChanged:!1});g.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),g.useImperativeHandle(o,()=>({getId:()=>C.current.id,getLayout:()=>{const{layout:P}=S.current;return P},setLayout:P=>{const{onLayout:R}=C.current,{layout:A,panelDataArray:O}=S.current,T=Du({layout:P,panelConstraints:O.map(L=>L.constraints)});Nu(A,T)||(w(T),S.current.layout=T,R&&R(T),Mr(O,T,b.current))}}),[]),ur(()=>{C.current.autoSaveId=t,C.current.direction=n,C.current.dragState=y,C.current.id=h,C.current.onLayout=i,C.current.storage=l}),aP({committedValuesRef:C,eagerValuesRef:S,groupId:h,layout:v,panelDataArray:S.current.panelDataArray,setLayout:w,panelGroupElement:p.current}),g.useEffect(()=>{const{panelDataArray:P}=S.current;if(t){if(v.length===0||v.length!==P.length)return;let R=Mu[t];R==null&&(R=hP(pP,gP),Mu[t]=R);const A=[...P],O=new Map(x.current);R(t,A,O,v,l)}},[t,v,l]),g.useEffect(()=>{});const j=g.useCallback(P=>{const{onLayout:R}=C.current,{layout:A,panelDataArray:O}=S.current;if(P.constraints.collapsible){const T=O.map(Fe=>Fe.constraints),{collapsedSize:L=0,panelSize:re,pivotIndices:de}=tr(O,P,A);if(Z(re!=null,`Panel size not found for panel "${P.id}"`),!xt(re,L)){x.current.set(P.id,re);const Ue=Hr(O,P)===O.length-1?re-L:L-re,he=Tn({delta:Ue,initialLayout:A,panelConstraints:T,pivotIndices:de,prevLayout:A,trigger:"imperative-api"});Po(A,he)||(w(he),S.current.layout=he,R&&R(he),Mr(O,he,b.current))}}},[]),U=g.useCallback((P,R)=>{const{onLayout:A}=C.current,{layout:O,panelDataArray:T}=S.current;if(P.constraints.collapsible){const L=T.map(Ve=>Ve.constraints),{collapsedSize:re=0,panelSize:de=0,minSize:Fe=0,pivotIndices:Ue}=tr(T,P,O),he=R??Fe;if(xt(de,re)){const Ve=x.current.get(P.id),gn=Ve!=null&&Ve>=he?Ve:he,Ss=Hr(T,P)===T.length-1?de-gn:gn-de,Re=Tn({delta:Ss,initialLayout:O,panelConstraints:L,pivotIndices:Ue,prevLayout:O,trigger:"imperative-api"});Po(O,Re)||(w(Re),S.current.layout=Re,A&&A(Re),Mr(T,Re,b.current))}}},[]),N=g.useCallback(P=>{const{layout:R,panelDataArray:A}=S.current,{panelSize:O}=tr(A,P,R);return Z(O!=null,`Panel size not found for panel "${P.id}"`),O},[]),H=g.useCallback((P,R)=>{const{panelDataArray:A}=S.current,O=Hr(A,P);return dP({defaultSize:R,dragState:y,layout:v,panelData:A,panelIndex:O})},[y,v]),I=g.useCallback(P=>{const{layout:R,panelDataArray:A}=S.current,{collapsedSize:O=0,collapsible:T,panelSize:L}=tr(A,P,R);return Z(L!=null,`Panel size not found for panel "${P.id}"`),T===!0&&xt(L,O)},[]),te=g.useCallback(P=>{const{layout:R,panelDataArray:A}=S.current,{collapsedSize:O=0,collapsible:T,panelSize:L}=tr(A,P,R);return Z(L!=null,`Panel size not found for panel "${P.id}"`),!T||yr(L,O)>0},[]),D=g.useCallback(P=>{const{panelDataArray:R}=S.current;R.push(P),R.sort((A,O)=>{const T=A.order,L=O.order;return T==null&&L==null?0:T==null?-1:L==null?1:T-L}),S.current.panelDataArrayChanged=!0,_()},[_]);ur(()=>{if(S.current.panelDataArrayChanged){S.current.panelDataArrayChanged=!1;const{autoSaveId:P,onLayout:R,storage:A}=C.current,{layout:O,panelDataArray:T}=S.current;let L=null;if(P){const de=fP(P,T,A);de&&(x.current=new Map(Object.entries(de.expandToSizes)),L=de.layout)}L==null&&(L=uP({panelDataArray:T}));const re=Du({layout:L,panelConstraints:T.map(de=>de.constraints)});Nu(O,re)||(w(re),S.current.layout=re,R&&R(re),Mr(T,re,b.current))}}),ur(()=>{const P=S.current;return()=>{P.layout=[]}},[]);const K=g.useCallback(P=>{let R=!1;const A=p.current;return A&&window.getComputedStyle(A,null).getPropertyValue("direction")==="rtl"&&(R=!0),function(T){T.preventDefault();const L=p.current;if(!L)return()=>null;const{direction:re,dragState:de,id:Fe,keyboardResizeBy:Ue,onLayout:he}=C.current,{layout:Ve,panelDataArray:gn}=S.current,{initialLayout:so}=de??{},Ss=kp(Fe,P,L);let Re=cP(T,P,re,de,Ue,L);const dl=re==="horizontal";dl&&R&&(Re=-Re);const Ip=gn.map(jp=>jp.constraints),mn=Tn({delta:Re,initialLayout:so??Ve,panelConstraints:Ip,pivotIndices:Ss,prevLayout:Ve,trigger:pp(T)?"keyboard":"mouse-or-touch"}),hl=!Po(Ve,mn);(gp(T)||mp(T))&&k.current!=Re&&(k.current=Re,!hl&&Re!==0?dl?Si(P,Re<0?vp:wp):Si(P,Re<0?bp:xp):Si(P,0)),hl&&(w(mn),S.current.layout=mn,he&&he(mn),Mr(gn,mn,b.current))}},[]),W=g.useCallback((P,R)=>{const{onLayout:A}=C.current,{layout:O,panelDataArray:T}=S.current,L=T.map(Ve=>Ve.constraints),{panelSize:re,pivotIndices:de}=tr(T,P,O);Z(re!=null,`Panel size not found for panel "${P.id}"`);const Ue=Hr(T,P)===T.length-1?re-R:R-re,he=Tn({delta:Ue,initialLayout:O,panelConstraints:L,pivotIndices:de,prevLayout:O,trigger:"imperative-api"});Po(O,he)||(w(he),S.current.layout=he,A&&A(he),Mr(T,he,b.current))},[]),oe=g.useCallback((P,R)=>{const{layout:A,panelDataArray:O}=S.current,{collapsedSize:T=0,collapsible:L}=R,{collapsedSize:re=0,collapsible:de,maxSize:Fe=100,minSize:Ue=0}=P.constraints,{panelSize:he}=tr(O,P,A);he!=null&&(L&&de&&xt(he,T)?xt(T,re)||W(P,re):he<Ue?W(P,Ue):he>Fe&&W(P,Fe))},[W]),V=g.useCallback((P,R)=>{const{direction:A}=C.current,{layout:O}=S.current;if(!p.current)return;const T=_s(P,p.current);Z(T,`Drag handle element not found for id "${P}"`);const L=Pp(A,R);m({dragHandleId:P,dragHandleRect:T.getBoundingClientRect(),initialCursorPosition:L,initialLayout:O})},[]),se=g.useCallback(()=>{m(null)},[]),ue=g.useCallback(P=>{const{panelDataArray:R}=S.current,A=Hr(R,P);A>=0&&(R.splice(A,1),delete b.current[P.id],S.current.panelDataArrayChanged=!0,_())},[_]),ce=g.useMemo(()=>({collapsePanel:j,direction:n,dragState:y,expandPanel:U,getPanelSize:N,getPanelStyle:H,groupId:h,isPanelCollapsed:I,isPanelExpanded:te,reevaluatePanelConstraints:oe,registerPanel:D,registerResizeHandle:K,resizePanel:W,startDragging:V,stopDragging:se,unregisterPanel:ue,panelGroupElement:p.current}),[j,y,n,U,N,H,h,I,te,oe,D,K,W,V,se,ue]),E={display:"flex",flexDirection:n==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return g.createElement(ws.Provider,{value:ce},g.createElement(u,{...d,children:e,className:r,id:s,ref:p,style:{...E,...c},[ye.group]:"",[ye.groupDirection]:n,[ye.groupId]:h}))}const Op=g.forwardRef((t,e)=>g.createElement(Rp,{...t,forwardedRef:e}));Rp.displayName="PanelGroup";Op.displayName="forwardRef(PanelGroup)";function Hr(t,e){return t.findIndex(r=>r===e||r.id===e.id)}function tr(t,e,r){const n=Hr(t,e),s=n===t.length-1?[n-1,n]:[n,n+1],i=r[n];return{...e.constraints,panelSize:i,pivotIndices:s}}function mP({disabled:t,handleId:e,resizeHandler:r,panelGroupElement:n}){g.useEffect(()=>{if(t||r==null||n==null)return;const o=_s(e,n);if(o==null)return;const s=i=>{if(!i.defaultPrevented)switch(i.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{i.preventDefault(),r(i);break}case"F6":{i.preventDefault();const a=o.getAttribute(ye.groupId);Z(a,`No group element found for id "${a}"`);const l=Vn(a,n),c=Sp(a,e,n);Z(c!==null,`No resize element found for id "${e}"`);const u=i.shiftKey?c>0?c-1:l.length-1:c+1<l.length?c+1:0;l[u].focus();break}}};return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}},[n,t,e,r])}function ha({children:t=null,className:e="",disabled:r=!1,hitAreaMargins:n,id:o,onBlur:s,onClick:i,onDragging:a,onFocus:l,onPointerDown:c,onPointerUp:u,style:d={},tabIndex:h=0,tagName:p="div",...y}){var m,v;const w=g.useRef(null),_=g.useRef({onClick:i,onDragging:a,onPointerDown:c,onPointerUp:u});g.useEffect(()=>{_.current.onClick=i,_.current.onDragging=a,_.current.onPointerDown=c,_.current.onPointerUp=u});const b=g.useContext(ws);if(b===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:x,groupId:k,registerResizeHandle:C,startDragging:S,stopDragging:j,panelGroupElement:U}=b,N=ll(o),[H,I]=g.useState("inactive"),[te,D]=g.useState(!1),[K,W]=g.useState(null),oe=g.useRef({state:H});ur(()=>{oe.current.state=H}),g.useEffect(()=>{if(r)W(null);else{const ce=C(N);W(()=>ce)}},[r,N,C]);const V=(m=n?.coarse)!==null&&m!==void 0?m:15,se=(v=n?.fine)!==null&&v!==void 0?v:5;g.useEffect(()=>{if(r||K==null)return;const ce=w.current;Z(ce,"Element ref not attached");let E=!1;return eP(N,ce,x,{coarse:V,fine:se},(R,A,O)=>{if(!A){I("inactive");return}switch(R){case"down":{I("drag"),E=!1,Z(O,'Expected event to be defined for "down" action'),S(N,O);const{onDragging:T,onPointerDown:L}=_.current;T?.(!0),L?.();break}case"move":{const{state:T}=oe.current;E=!0,T!=="drag"&&I("hover"),Z(O,'Expected event to be defined for "move" action'),K(O);break}case"up":{I("hover"),j();const{onClick:T,onDragging:L,onPointerUp:re}=_.current;L?.(!1),re?.(),E||T?.();break}}})},[V,x,r,se,C,N,K,S,j]),mP({disabled:r,handleId:N,resizeHandler:K,panelGroupElement:U});const ue={touchAction:"none",userSelect:"none"};return g.createElement(p,{...y,children:t,className:e,id:o,onBlur:()=>{D(!1),s?.()},onFocus:()=>{D(!0),l?.()},ref:w,role:"separator",style:{...ue,...d},tabIndex:h,[ye.groupDirection]:x,[ye.groupId]:k,[ye.resizeHandle]:"",[ye.resizeHandleActive]:H==="drag"?"pointer":te?"keyboard":void 0,[ye.resizeHandleEnabled]:!r,[ye.resizeHandleId]:N,[ye.resizeHandleState]:H})}ha.displayName="PanelResizeHandle";const yP=Eg(()=>Bt(()=>import("./JsonRoomEditor-Dgn-1h_P.js").then(t=>t.J),__vite__mapDeps([8,1,2,6,9]))),vP=g.lazy(yP),wP=()=>{UC();const t=f.jsx("div",{className:"flex h-full items-center justify-center bg-pureBlack",children:f.jsx("span",{className:"sprite texture-animated-head_walking_right"})});return f.jsx(f.Fragment,{children:f.jsx(Ua,{children:f.jsxs(Op,{direction:"horizontal",className:"w-full h-full",children:[f.jsx(Do,{id:"jsonEditor",defaultSize:18,minSize:12,collapsible:!0,children:f.jsx(g.Suspense,{fallback:t,children:f.jsx(vP,{})})}),f.jsx(ha,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-r-[calc(1px*var(--scale))] border-metallicBlue"}),f.jsx(Do,{id:"editingArea",children:f.jsx(nC,{children:f.jsx(tC,{children:f.jsx(FC,{})})})}),f.jsx(ha,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-l-[calc(1px*var(--scale))] border-metallicBlue"}),f.jsx(Do,{id:"toolbar",defaultSize:20,maxSize:33,minSize:10,children:f.jsx(i_,{})})]})})})},jP=Object.freeze(Object.defineProperty({__proto__:null,default:wP},Symbol.toStringTag,{value:"Module"}));export{ud as A,ad as C,Xt as F,jP as L,Ca as R,um as S,dd as V,gm as a,EP as h,me as t,cm as u};
