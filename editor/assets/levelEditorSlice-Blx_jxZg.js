import{u as k,x as re,y as D,z as ue,A as $,F as ye,H as fe,I as me,J as pe,K as j,L as C,N as te,O as ge,Q as he,W as ve,X as Ie,Y as be,Z as we,_ as Re,$ as oe,a0 as ke,a1 as Ce}from"./index-vxEFV4k3.js";var T={},_={},H;function Te(){if(H)return _;H=1;function e(i,l){var n;if(typeof Symbol>"u"||i[Symbol.iterator]==null){if(Array.isArray(i)||(n=t(i))||l){n&&(i=n);var y=0,c=function(){};return{s:c,n:function(){return y>=i.length?{done:!0}:{done:!1,value:i[y++]}},e:function(m){throw m},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,h=!1,p;return{s:function(){n=i[Symbol.iterator]()},n:function(){var m=n.next();return f=m.done,m},e:function(m){h=!0,p=m},f:function(){try{!f&&n.return!=null&&n.return()}finally{if(h)throw p}}}}function t(i,l){if(i){if(typeof i=="string")return r(i,l);var n=Object.prototype.toString.call(i).slice(8,-1);if(n==="Object"&&i.constructor&&(n=i.constructor.name),n==="Map"||n==="Set")return Array.from(i);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(i,l)}}function r(i,l){(l==null||l>i.length)&&(l=i.length);for(var n=0,y=new Array(l);n<l;n++)y[n]=i[n];return y}var o=k(),s=o.ensureIterable;function a(i){var l=[],n=e(i),y;try{for(n.s();!(y=n.n()).done;){var c=y.value;l.push(c)}}catch(f){n.e(f)}finally{n.f()}return l}_.__toArray=a;function u(i){return a(s(i))}return _.toArray=u,_}var W;function _e(){if(W)return T;W=1;var e=re(),t=e.mark(u),r=k(),o=r.iterableCurry,s=Te(),a=s.__toArray;function u(l,n){var y;return e.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(y=Array.isArray(l)?l:a(l),y.length){f.next=3;break}return f.abrupt("return");case 3:if(!n--){f.next=7;break}return f.delegateYield(y,"t0",5);case 5:f.next=3;break;case 7:case"end":return f.stop()}},t)}T.__cycleTimes=u;var i=o(u);return T.cycleTimes=i,T}var S={},L;function Se(){if(L)return S;L=1;var e=k(),t=e.iterableCurry,r=_e(),o=r.__cycleTimes;function s(u){return o(u,1/0)}S.__cycle=s;var a=t(s);return S.cycle=a,S}var x={},z={},M;function xe(){if(M)return z;M=1;var e=k(),t=e.iterableCurry,r=e.callReturn;function o(a,u){var i=a[Symbol.iterator](),l=i.next(),n=l.value,y=l.done;return y?u:(r(i),n)}z.__firstOr=o;var s=t(o,{reduces:!0});return z.firstOr=s,z}var U;function ze(){if(U)return x;U=1;var e=k(),t=e.iterableCurry,r=xe(),o=r.__firstOr;function s(u){return o(u,void 0)}x.__first=s;var a=t(s,{reduces:!0});return x.first=a,x}var A={},G;function Ae(){if(G)return A;G=1;var e=re(),t=e.mark(i);function r(n,y){var c;if(typeof Symbol>"u"||n[Symbol.iterator]==null){if(Array.isArray(n)||(c=o(n))||y){c&&(n=c);var f=0,h=function(){};return{s:h,n:function(){return f>=n.length?{done:!0}:{done:!1,value:n[f++]}},e:function(w){throw w},f:h}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,d=!1,m;return{s:function(){c=n[Symbol.iterator]()},n:function(){var w=c.next();return p=w.done,w},e:function(w){d=!0,m=w},f:function(){try{!p&&c.return!=null&&c.return()}finally{if(d)throw m}}}}function o(n,y){if(n){if(typeof n=="string")return s(n,y);var c=Object.prototype.toString.call(n).slice(8,-1);if(c==="Object"&&n.constructor&&(c=n.constructor.name),c==="Map"||c==="Set")return Array.from(n);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return s(n,y)}}function s(n,y){(y==null||y>n.length)&&(y=n.length);for(var c=0,f=new Array(y);c<y;c++)f[c]=n[c];return f}var a=k(),u=a.iterableCurry;function i(n,y){var c,f,h,p;return e.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(y!==0){m.next=2;break}return m.abrupt("return");case 2:c=0,f=r(n),m.prev=4,f.s();case 6:if((h=f.n()).done){m.next=14;break}return p=h.value,m.next=10,p;case 10:if(++c!==y){m.next=12;break}return m.abrupt("break",14);case 12:m.next=6;break;case 14:m.next=19;break;case 16:m.prev=16,m.t0=m.catch(4),f.e(m.t0);case 19:return m.prev=19,f.f(),m.finish(19);case 22:case"end":return m.stop()}},t,null,[[4,16,19,22]])}A.__take=i;var l=u(i);return A.take=l,A}var P,N;function Ee(){return N||(N=1,P=Se().cycle),P}var Pe=Ee();const Oe=D(Pe);var O,Y;function Je(){return Y||(Y=1,O=ze().first),O}var qe=Je();const $e=D(qe);var J,K;function Xe(){return K||(K=1,J=Ae().take),J}var Fe=Xe();const De=D(Fe),Be={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},X=(e,t)=>[...De(t,Oe(Be[e]))],je=e=>({awayWall:{type:"wall",config:{direction:"away",tiles:X("blacktooth",e.x)},position:{x:0,y:e.y,z:0}},leftWall:{type:"wall",config:{direction:"left",tiles:X("blacktooth",e.y)},position:{x:e.x,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:e.x}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:e.y}},position:{x:0,y:0,z:0}}}),ne=e=>({planet:"blacktooth",color:{hue:"cyan",shade:"basic"},size:e,items:{floor:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:e},position:{x:0,y:0,z:0}},...je(e)}}),v=e=>e.campaignInProgress.rooms[e.currentlyEditingRoomId],Q=(e,t)=>e.campaignInProgress.rooms[t],se=(e,t,r)=>e.campaignInProgress.rooms[r??e.currentlyEditingRoomId]?.items[t],R={w:16,d:16,h:12},V={x:16,y:16,z:12},He=["head","heels"],We=[...He,"headOverHeels"],g=(...e)=>t=>e.includes(t.type),Le=g("bubbles","stopAutowalk","firedDoughnut","floatingText","emitter","particle"),Me=(e,t)=>Le(e)||Ze(e)&&(t!==void 0&&Ye(t)||e.config.direction.z!==0)||rr(e)&&e.config.floorType==="none",Zr=(e,t)=>!Me(e,t),Ue=["ball","slidingBlock","slidingDeadly"];g(...Ue);const Ge=["portableBlock","spring","sceneryPlayer","sceneryCrown","monster","slidingBlock"],Ne=["dalek","turtle","elephantHead","homingBot","helicopterBug"],et=e=>e.type==="slidingBlock"?e.config.style==="puck":e.type==="monster"?Ne.includes(e.config.which):Ge.includes(e.type),Ye=e=>e.type==="head"||e.type==="heels"||e.type==="headOverHeels";function rt(e){return Ke.includes(e.type)}const Ke=[...We,"monster","ball","charles","pushableBlock","movingPlatform","moveableDeadly","pickup","portableBlock","slidingBlock","slidingDeadly","spring","sceneryPlayer","sceneryCrown"],Qe=["monster","deadlyBlock","moveableDeadly","slidingDeadly"];g(...Qe);const Ve=e=>e.config.times!==void 0,Ze=g("portal");g("teleporter");g("heels");g("head");g("heels","headOverHeels");g("head","headOverHeels");g("lift");g("emitter");const er=g("monster"),rr=g("floor");g("pickup");g("spring");const tt=g("joystick");g("monster","movingPlatform");const ot=e=>er(e)&&e.config.which==="cyberman"&&e.state.everActivated===!1,nt=(e,t={})=>{const r=tr(t),o=$(V,e);return $(ye(r,V),o)},ie=e=>({x:e.direction==="away"?e.tiles.length:e.direction==="towards"?e.times?.x:1,y:e.direction==="left"?e.tiles.length:e.direction==="right"?e.times?.y:1}),st=e=>e.type==="wall"?ie(e.config):Ve(e)?e.config.times:void 0,tr=(e=ue)=>({x:e.x??1,y:e.y??1,z:e.z??1}),or=e=>({x:e.x??1,y:e.y??1});function*nr(e,t,r){for(const o of me(e)){const[s,a]=o;if(a.type!=="wall"){yield o;continue}if(a.config.direction!==t){yield o;continue}const{position:u,config:i}=a,l=or(ie(i)),n=pe(j(i.direction)),y=j(i.direction),c=$(r,u);if(c[y]!==0){yield o;continue}if(c[n]<-1){yield o;continue}if(c[n]>l[n]){yield o;continue}if(l[n]===2)continue;const f=c[n]===0;f&&(yield[s,C(a,p=>{p.position=te(u,{[n]:2});const d=p.config;switch(d.direction){case"towards":d.times={x:l[n]-2};break;case"right":d.times={y:l[n]-2};break;default:d.tiles=d.tiles.slice(2)}})]);const h=c[n]===l[n]-2;h&&(yield[s,C(a,p=>{const d=p.config;switch(d.direction){case"towards":d.times={x:l[n]-2};break;case"right":d.times={y:l[n]-2};break;default:d.tiles=d.tiles.slice(0,-2)}})]),!f&&!h&&(yield[`${s}/beforeDoor`,C(a,p=>{const d=p.config;switch(d.direction){case"towards":d.times={x:c[n]};break;case"right":d.times={y:c[n]};break;default:d.tiles=d.tiles.slice(0,c[n])}})],yield[`${s}/afterDoor`,C(a,p=>{p.position={...u,[n]:r[n]+2};const d=p.config;switch(d.direction){case"towards":d.times={x:l[n]-c[n]-2};break;case"right":d.times={y:l[n]-c[n]-2};break;default:d.tiles=d.tiles.slice(c[n]+2)}})])}}const Z=(e,t,r)=>{e.items=fe(nr(e.items,t,r))},I=e=>{const t=structuredClone(ge(v(e))),{history:r}=e;r.redo=[],r.undo.push(t)},sr={undo(e){const t=e,{campaignInProgress:r,history:{undo:o,redo:s},currentlyEditingRoomId:a}=t;o.length!==0&&(s.push(r.rooms[a]),r.rooms[a]=o.pop())},redo(e){const t=e,{campaignInProgress:r,history:{redo:o,undo:s},currentlyEditingRoomId:a}=t;o.length!==0&&(s.push(r.rooms[a]),r.rooms[a]=o.pop())}},ir={selectCanUndo:e=>e.history.undo.length>0,selectCanRedo:e=>e.history.redo.length>0},it=({x:e=0,y:t=0})=>t-e,ae=({x:e=0,y:t=0,z:r=0})=>({x:t-e,y:-(e+t)/2-r}),at=(e,t,r)=>{const o=ae(e),s=he(r,o);return te(ar(t,s),e)},ar=(e,{x:t,y:r})=>{switch(ve(e)){case"xy":return{x:-t/2-r,y:t/2-r,z:0};case"xz":return{x:-t,y:0,z:t/2-r};case"yz":return{x:0,y:t,z:-t/2-r};default:throw new Error("only axis-aligned planes are supported for unprojection")}},cr=({x:e=0,y:t=0,z:r=0})=>({x:e*R.w,y:t*R.d,z:r*R.h}),lr=({x:e=0,y:t=0,z:r=0})=>({x:e/R.w,y:t/R.d,z:r/R.h}),ct=e=>ae(cr(e)),ce=(e,t)=>{e.planet=t;for(const r of Object.values(e.items))r.type==="floor"&&r.config.floorType==="standable"&&(r.config.scenery=t),r.type==="wall"&&(r.config.direction==="away"||r.config.direction==="left")&&(r.config.tiles=X(t,r.config.tiles.length)),r.type==="pickup"&&r.config.gives==="crown"&&Ie.includes(t)&&(r.config.planet=t)},le=(e,t,r)=>{const o=`room_${e.nextRoomId++}`,s={id:o,...structuredClone(ne({x:8,y:8})),color:r};return ce(s,t),e.campaignInProgress.rooms[o]=s,s},de=(e,t)=>{const r=t.type==="monster"?t.config.which:t.type;for(let o=1;;o++){const s=o===1?r:`${r}_${o}`;if(!e.items[s])return s}},q=(e,t,r)=>{const o=v(e),s=de(o,t);o.items[s]={type:t.type,config:t.config,position:r}},dr=e=>e.type==="door",ur=e=>e.type==="monster"&&e.config.which==="cyberman",yr={applyItemTool(e,{payload:{blockPosition:t,pointedAtItem:r}}){const o=e,{tool:s}=o;switch(s?.type){case"item":{if(dr(s.item)&&r.type==="wall"){I(o);const a=v(o),u=r.config.direction;Z(a,u,t);const i=le(o,a.planet,a.color);q(o,{...s.item,config:{...s.item.config,toRoom:i.id,direction:u}},t);const l=de(i,s.item),n={x:u==="left"?0:u==="right"?i.size.x:Math.floor(i.size.x/2),y:u==="away"?0:u==="towards"?i.size.x:Math.floor(i.size.x/2),z:t.z},y=be(u),c={type:"door",config:{toRoom:a.id,direction:y},position:n};i.items[l]=c,Z(i,y,n)}else ur(s.item)&&r.type==="deadlyBlock"&&r.config.style==="toaster"&&lr(r.state.position).z+1===t.z?(I(o),q(o,{...s.item,config:{...s.item.config,activated:"off"}},t)):(I(o),q(o,s.item,t));o.selectedJsonItemIds=[];break}}}},fr={changeDragInProgress(e,{payload:t}){const r=e;r.dragInProgress=t}},mr={changeGridResolution(e,{payload:t}){const r=e;r.halfGridResolution=t},changeWallsFloorsLocked(e,{payload:t}){const r=e;r.wallsFloorsLocked=t}},pr={setSelectedItemInRoom(e,{payload:{jsonItemId:t,additive:r=!1}}){if(r)if(t===void 0)e.selectedJsonItemIds=[];else{const o=e.selectedJsonItemIds.indexOf(t);o===-1?e.selectedJsonItemIds.push(t):e.selectedJsonItemIds.splice(o,1)}else e.selectedJsonItemIds=t===void 0?[]:[t]},setHoveredItemInRoom(e,t){e.hoveredItem=t.payload},setClickableAnnotationHovered(e,t){e.clickableAnnotationHovered=t.payload}},gr={moveOrResizeItem(e,{payload:{jsonItemId:t,newTimes:r,newPosition:o,startOfGesture:s}}){const a=e;s&&I(a);const u=se(a,t);if(u===void 0){console.warn("no json item found for resize",t);return}if(r!==void 0){const{config:i}=u;i.times={...r.x===1?{}:{x:r.x},...r.y===1?{}:{y:r.y},...r.z===1?{}:{z:r.z}}}o!==void 0&&(u.position=o)}},hr=e=>Re(e.items),vr=e=>we(hr(e)),ee=(e,t)=>{vr(e).filter(r=>r.type==="floor").filter(r=>r.position.z===0).forEach(r=>{r.config={...r.config,floorType:t,scenery:t==="standable"?e.planet:void 0}})},Ir={changeRoomColour(e,{payload:t}){const r=e,o=r.campaignInProgress.rooms[r.currentlyEditingRoomId].color;I(r),Object.assign(o,t)},changeRoomScenery(e,{payload:t}){const r=e,o=v(r);I(r),ce(o,t)},roomJsonEdited(e,{payload:t}){const r=e;r.campaignInProgress.rooms[r.currentlyEditingRoomId]=t},deleteSelected(e){const t=e,r=v(t);I(t),t.selectedJsonItemIds.forEach(o=>{delete r.items[o]}),t.selectedJsonItemIds=[]},clearRoom(e){const t=e,r=v(t);I(t);for(const o of oe(r.items)){const s=r.items[o];s.type!=="floor"&&s.type!=="wall"&&s.type!=="door"&&(delete r.items[o],t.selectedJsonItemIds=t.selectedJsonItemIds.filter(a=>a!==o))}},setRoomAboveOrBelow(e,{payload:t}){const r=e,o=t.direction,s=o==="roomAbove"?"roomBelow":"roomAbove",a=v(r),u=t.createNew?le(r,a.planet,a.color).id:t.roomId,i=a[o]&&Q(r,a[o]);i?.[s]===r.currentlyEditingRoomId&&(i[s]=void 0),a[o]=u;const l=u&&Q(r,u);l!==void 0&&(l[s]=a.id),l?ee(o==="roomBelow"?a:l,"none"):ee(o==="roomBelow"?a:i,"standable")}},F="room_0",br={id:F,...ne({x:8,y:8})},E={campaignInProgress:{name:"new campaign",rooms:{[F]:br}},nextRoomId:1,currentlyEditingRoomId:F,tool:{type:"pointer"},hoveredItem:void 0,clickableAnnotationHovered:!1,selectedJsonItemIds:[],halfGridResolution:!1,wallsFloorsLocked:!0,dragInProgress:!1,history:{undo:[],redo:[]}},B=ke({name:"levelEditor",initialState:E,reducers:{setTool(e,{payload:t}){const r=e;t.type==="item"&&(r.selectedJsonItemIds=[]),r.tool=t},changeToRoom(e,{payload:t}){const r=e;if(!r.campaignInProgress.rooms[t]){console.warn(`can't change to room ${t} - it doesn't exist`);return}r.currentlyEditingRoomId=t,r.clickableAnnotationHovered=!1,r.hoveredItem=void 0,r.selectedJsonItemIds=[],r.history=E.history},loadCampaign(e,{payload:{campaign:t}}){const r=e;r.campaignInProgress=t,r.hoveredItem=void 0,r.selectedJsonItemIds=[],r.clickableAnnotationHovered=!1,r.dragInProgress=!1,r.history=E.history;const o=$e(oe(t.rooms));if(o===void 0)throw new Error("could not find any rooms in this campaign");r.currentlyEditingRoomId=o},injected(){},...mr,...sr,...yr,...fr,...pr,...Ir,...gr},selectors:{selectCurrentCampaignInProgress:e=>e.campaignInProgress,selectCurrentEditingRoomJson:v,selectItem:se,selectCurrentEditingRoomColour:e=>v(e).color,selectCurrentEditingRoomScenery:e=>v(e).planet,selectTool:e=>e.tool,selectSelectedJsonItemIds:e=>e.selectedJsonItemIds,selectHoveredItem:e=>e.hoveredItem,...ir}}),{applyItemTool:wr,changeDragInProgress:Rr,changeGridResolution:kr,changeRoomColour:Cr,changeRoomScenery:Tr,changeToRoom:_r,changeWallsFloorsLocked:Sr,clearRoom:xr,deleteSelected:zr,injected:Ar,loadCampaign:Er,moveOrResizeItem:Pr,redo:Or,roomJsonEdited:Jr,setClickableAnnotationHovered:qr,setHoveredItemInRoom:$r,setRoomAboveOrBelow:Xr,setSelectedItemInRoom:Fr,setTool:Dr,undo:Br}=B.actions,{selectCanRedo:jr,selectCanUndo:Hr,selectCurrentCampaignInProgress:Wr,selectCurrentEditingRoomColour:Lr,selectCurrentEditingRoomJson:Mr,selectCurrentEditingRoomScenery:Ur,selectHoveredItem:Gr,selectItem:Nr,selectSelectedJsonItemIds:Yr,selectTool:Kr}=B.selectors,Qr=Ce.withTypes(),lt=Object.freeze(Object.defineProperty({__proto__:null,applyItemTool:wr,changeDragInProgress:Rr,changeGridResolution:kr,changeRoomColour:Cr,changeRoomScenery:Tr,changeToRoom:_r,changeWallsFloorsLocked:Sr,clearRoom:xr,deleteSelected:zr,initialLevelEditorSliceState:E,injected:Ar,levelEditorSlice:B,loadCampaign:Er,moveOrResizeItem:Pr,redo:Or,roomJsonEdited:Jr,selectCanRedo:jr,selectCanUndo:Hr,selectCurrentCampaignInProgress:Wr,selectCurrentEditingRoomColour:Lr,selectCurrentEditingRoomJson:Mr,selectCurrentEditingRoomScenery:Ur,selectHoveredItem:Gr,selectItem:Nr,selectSelectedJsonItemIds:Yr,selectTool:Kr,setClickableAnnotationHovered:qr,setHoveredItemInRoom:$r,setRoomAboveOrBelow:Xr,setSelectedItemInRoom:Fr,setTool:Dr,undo:Br,useAppSelectorWithLevelEditorSlice:Qr},Symbol.toStringTag,{value:"Module"}));export{Pr as $,Ve as A,st as B,R as C,cr as D,Ke as E,Ue as F,ie as G,nt as H,Zr as I,rt as J,Ye as K,tt as L,ot as M,it as N,et as O,qr as P,Gr as Q,Yr as R,lr as S,or as T,at as U,Rr as V,Nr as W,Fr as X,wr as Y,$r as Z,tr as _,Dr as a,ar as a0,se as a1,Jr as a2,lt as a3,Lr as b,kr as c,zr as d,Cr as e,Ur as f,Tr as g,Hr as h,jr as i,Br as j,Or as k,Sr as l,Mr as m,X as n,xr as o,v as p,Xr as q,xe as r,Kr as s,Wr as t,Qr as u,Er as v,_r as w,ae as x,g as y,ct as z};
