import{b as A,c as G,g as L,s as _,p as V,f as Z,h as ee,i as te,j as $,k,l as re,m as oe,n as ne,o as se,q as ie,u as ae}from"./index-C1Dx5mLS.js";var R={},C={},D;function le(){if(D)return C;D=1;function e(a,i){var r;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(r=t(a))||i){r&&(a=r);var c=0,s=function(){};return{s,n:function(){return c>=a.length?{done:!0}:{done:!1,value:a[c++]}},e:function(y){throw y},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,h=!1,p;return{s:function(){r=a[Symbol.iterator]()},n:function(){var y=r.next();return u=y.done,y},e:function(y){h=!0,p=y},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(h)throw p}}}}function t(a,i){if(a){if(typeof a=="string")return o(a,i);var r=Object.prototype.toString.call(a).slice(8,-1);if(r==="Object"&&a.constructor&&(r=a.constructor.name),r==="Map"||r==="Set")return Array.from(a);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(a,i)}}function o(a,i){(i==null||i>a.length)&&(i=a.length);for(var r=0,c=new Array(i);r<i;r++)c[r]=a[r];return c}var n=A(),d=n.ensureIterable;function f(a){var i=[],r=e(a),c;try{for(r.s();!(c=r.n()).done;){var s=c.value;i.push(s)}}catch(u){r.e(u)}finally{r.f()}return i}C.__toArray=f;function m(a){return f(d(a))}return C.toArray=m,C}var H;function ce(){if(H)return R;H=1;var e=G(),t=e.mark(m),o=A(),n=o.iterableCurry,d=le(),f=d.__toArray;function m(i,r){var c;return e.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(c=Array.isArray(i)?i:f(i),c.length){u.next=3;break}return u.abrupt("return");case 3:if(!r--){u.next=7;break}return u.delegateYield(c,"t0",5);case 5:u.next=3;break;case 7:case"end":return u.stop()}},t)}R.__cycleTimes=m;var a=n(m);return R.cycleTimes=a,R}var T={},O;function de(){if(O)return T;O=1;var e=A(),t=e.iterableCurry,o=ce(),n=o.__cycleTimes;function d(m){return n(m,1/0)}T.__cycle=d;var f=t(d);return T.cycle=f,T}var S={},j;function ue(){if(j)return S;j=1;var e=G(),t=e.mark(a);function o(r,c){var s;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(s=n(r))||c){s&&(r=s);var u=0,h=function(){};return{s:h,n:function(){return u>=r.length?{done:!0}:{done:!1,value:r[u++]}},e:function(I){throw I},f:h}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,l=!1,y;return{s:function(){s=r[Symbol.iterator]()},n:function(){var I=s.next();return p=I.done,I},e:function(I){l=!0,y=I},f:function(){try{!p&&s.return!=null&&s.return()}finally{if(l)throw y}}}}function n(r,c){if(r){if(typeof r=="string")return d(r,c);var s=Object.prototype.toString.call(r).slice(8,-1);if(s==="Object"&&r.constructor&&(s=r.constructor.name),s==="Map"||s==="Set")return Array.from(r);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return d(r,c)}}function d(r,c){(c==null||c>r.length)&&(c=r.length);for(var s=0,u=new Array(c);s<c;s++)u[s]=r[s];return u}var f=A(),m=f.iterableCurry;function a(r,c){var s,u,h,p;return e.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(c!==0){y.next=2;break}return y.abrupt("return");case 2:s=0,u=o(r),y.prev=4,u.s();case 6:if((h=u.n()).done){y.next=14;break}return p=h.value,y.next=10,p;case 10:if(++s!==c){y.next=12;break}return y.abrupt("break",14);case 12:y.next=6;break;case 14:y.next=19;break;case 16:y.prev=16,y.t0=y.catch(4),u.e(y.t0);case 19:return y.prev=19,u.f(),y.finish(19);case 22:case"end":return y.stop()}},t,null,[[4,16,19,22]])}S.__take=a;var i=m(a);return S.take=i,S}var E,B;function ye(){return B||(B=1,E=de().cycle),E}var fe=ye();const me=L(fe);var J,W;function pe(){return W||(W=1,J=ue().take),J}var ge=pe();const he=L(ge),ve={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},x=(e,t)=>[...he(t,me(ve[e]))],be={awayWall:{type:"wall",config:{direction:"away",tiles:x("blacktooth",8)},position:{x:0,y:8,z:0}},leftWall:{type:"wall",config:{direction:"left",tiles:x("blacktooth",8)},position:{x:8,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:8}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:8}},position:{x:0,y:0,z:0}}},F={x:8,y:8},K={planet:"blacktooth",color:{hue:"cyan",shade:"basic"},size:F,items:{floor:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:F},position:{x:0,y:0,z:0}},...be}},v=e=>e.campaignInProgress.rooms[e.currentlyEditingRoomId],yt={w:16,d:16,h:12},M={x:16,y:16,z:12},Ie=["head","heels"],we=[...Ie,"headOverHeels"],g=(...e)=>t=>e.includes(t.type),ke=g("bubbles","stopAutowalk","firedDoughnut","floatingText","emitter","particle"),Re=(e,t)=>ke(e)||xe(e)&&(t!==void 0&&Ae(t)||e.config.direction.z!==0)||qe(e)&&e.config.floorType==="none",ft=(e,t)=>!Re(e,t),Ce=["ball","slidingBlock","slidingDeadly"];g(...Ce);const Te=["portableBlock","spring","sceneryPlayer","sceneryCrown","monster","slidingBlock"],Se=["dalek","turtle","elephantHead","homingBot","helicopterBug"],mt=e=>e.type==="slidingBlock"?e.config.style==="puck":e.type==="monster"?Se.includes(e.config.which):Te.includes(e.type),Ae=e=>e.type==="head"||e.type==="heels"||e.type==="headOverHeels";function pt(e){return Ee.includes(e.type)}const Ee=[...we,"monster","ball","charles","pushableBlock","movingPlatform","moveableDeadly","pickup","portableBlock","slidingBlock","slidingDeadly","spring","sceneryPlayer","sceneryCrown"],Je=["monster","deadlyBlock","moveableDeadly","slidingDeadly"];g(...Je);const _e=e=>e.config.times!==void 0,xe=g("portal");g("teleporter");g("heels");g("head");g("heels","headOverHeels");g("head","headOverHeels");g("lift");g("emitter");const ze=g("monster"),qe=g("floor");g("pickup");g("spring");const gt=g("joystick");g("monster","movingPlatform");const ht=e=>ze(e)&&e.config.which==="cyberman"&&e.state.everActivated===!1,vt=(e,t={})=>{const o=Pe(t),n=_(M,e);return _(V(o,M),n)},Y=e=>({x:e.direction==="away"?e.tiles.length:e.direction==="towards"?e.times?.x:1,y:e.direction==="left"?e.tiles.length:e.direction==="right"?e.times?.y:1}),bt=e=>_e(e)?e.type==="wall"?Y(e.config):e.config.times:void 0,Pe=e=>({x:e.x??1,y:e.y??1,z:e.z??1}),$e=e=>({x:e.x??1,y:e.y??1});function*De(e,t,o){for(const n of ee(e)){const[d,f]=n;if(f.type!=="wall"){yield n;continue}if(f.config.direction!==t){yield n;continue}const{position:m,config:a}=f,i=$e(Y(a)),r=te($(a.direction)),c=$(a.direction),s=_(o,m);if(s[c]!==0){yield n;continue}if(s[r]<-1){yield n;continue}if(s[r]>i[r]){yield n;continue}if(i[r]===2)continue;const u=s[r]===0;u&&(yield[d,k(f,p=>{p.position=re(m,{[r]:2});const l=p.config;switch(l.direction){case"towards":l.times={x:i[r]-2};break;case"right":l.times={y:i[r]-2};break;default:l.tiles=l.tiles.slice(2)}})]);const h=s[r]===i[r]-2;h&&(yield[d,k(f,p=>{const l=p.config;switch(l.direction){case"towards":l.times={x:i[r]-2};break;case"right":l.times={y:i[r]-2};break;default:l.tiles=l.tiles.slice(0,-2)}})]),!u&&!h&&(yield[`${d}/beforeDoor`,k(f,p=>{const l=p.config;switch(l.direction){case"towards":l.times={x:s[r]};break;case"right":l.times={y:s[r]};break;default:l.tiles=l.tiles.slice(0,s[r])}})],yield[`${d}/afterDoor`,k(f,p=>{p.position={...m,[r]:o[r]+2};const l=p.config;switch(l.direction){case"towards":l.times={x:i[r]-s[r]-2};break;case"right":l.times={y:i[r]-s[r]-2};break;default:l.tiles=l.tiles.slice(s[r]+2)}})])}}const X=(e,t,o)=>{e.items=Z(De(e.items,t,o))},w=e=>{const t=structuredClone(oe(v(e))),{history:o}=e;o.redo=[],o.undo.push(t)},He={undo(e){const t=e,{campaignInProgress:o,history:{undo:n,redo:d},currentlyEditingRoomId:f}=t;n.length!==0&&(d.push(o.rooms[f]),o.rooms[f]=n.pop())},redo(e){const t=e,{campaignInProgress:o,history:{redo:n,undo:d},currentlyEditingRoomId:f}=t;n.length!==0&&(d.push(o.rooms[f]),o.rooms[f]=n.pop())}},Oe={selectCanUndo:e=>e.history.undo.length>0,selectCanRedo:e=>e.history.redo.length>0},N=(e,t)=>{e.planet=t;for(const o of Object.values(e.items))o.type==="floor"&&o.config.floorType==="standable"&&(o.config.scenery=t),o.type==="wall"&&(o.config.direction==="away"||o.config.direction==="left")&&(o.config.tiles=x(t,o.config.tiles.length)),o.type==="pickup"&&o.config.gives==="crown"&&ne.includes(t)&&(o.config.planet=t)},Q=(e,t)=>{const o=t.type==="monster"?t.config.which:t.type;for(let n=1;;n++){const d=n===1?o:`${o}_${n}`;if(!e.items[d])return d}},U=(e,t,o)=>{const n=v(e),d=Q(n,t);n.items[d]={type:t.type,config:t.config,position:o}},je=e=>e.type==="door",Be={applyToolToRoomJson(e,{payload:{blockPosition:t,pointedAtItem:o}}){const n=e,{tool:d}=n;switch(d?.type){case"item":{if(je(d.item)&&o.type==="wall"){w(n);const f=v(n),m=o.config.direction;X(f,m,t);const a=`room_${n.nextRoomId++}`;U(n,{...d.item,config:{...d.item.config,toRoom:a,direction:m}},t);const i={id:a,...structuredClone(K),color:f.color};N(i,f.planet),n.campaignInProgress.rooms[a]=i;const r=Q(i,d.item),c={x:m==="left"?0:m==="right"?i.size.x:Math.floor(i.size.x/2),y:m==="away"?0:m==="towards"?i.size.x:Math.floor(i.size.x/2),z:t.z},s=se(m),u={type:"door",config:{toRoom:f.id,direction:s},position:c};i.items[r]=u,X(i,s,c)}else w(n),U(n,d.item,t);n.selectedJsonItemIds=[];break}}}},z="room_0",We={id:z,...structuredClone(K)},q={campaignInProgress:{name:"new campaign",rooms:{[z]:We}},nextRoomId:1,currentlyEditingRoomId:z,tool:{type:"pointer"},hoveredJsonItemId:void 0,clickableAnnotationHovered:!1,selectedJsonItemIds:[],halfGridResolution:!1,history:{undo:[],redo:[]}},P=ie({name:"levelEditor",initialState:q,reducers:{setTool(e,{payload:t}){const o=e;t.type==="item"&&(o.selectedJsonItemIds=[]),o.tool=t},changeRoomColour(e,{payload:t}){const o=e,n=o.campaignInProgress.rooms[o.currentlyEditingRoomId].color;w(o),Object.assign(n,t)},changeRoomScenery(e,{payload:t}){const o=e,n=v(o);w(o),N(n,t)},changeToRoom(e,{payload:t}){const o=e;if(!o.campaignInProgress.rooms[t]){console.warn(`can't change to room ${t} - it doesn't exist`);return}o.currentlyEditingRoomId=t,o.clickableAnnotationHovered=!1,o.hoveredJsonItemId=void 0,o.selectedJsonItemIds=[],o.history=q.history},roomJsonEdited(e,{payload:t}){const o=e;o.campaignInProgress.rooms[o.currentlyEditingRoomId]=t},setHoveredItemInRoom(e,t){e.hoveredJsonItemId=t.payload},setClickableAnnotationHovered(e,t){e.clickableAnnotationHovered=t.payload},setSelectedItemInRoom(e,{payload:{jsonItemId:t,additive:o=!1}}){if(o)if(t===void 0)e.selectedJsonItemIds=[];else{const n=e.selectedJsonItemIds.indexOf(t);n===-1?e.selectedJsonItemIds.push(t):e.selectedJsonItemIds.splice(n,1)}else e.selectedJsonItemIds=t===void 0?[]:[t]},deleteSelected(e){const t=e,o=v(t);w(t),t.selectedJsonItemIds.forEach(n=>{delete o.items[n]}),t.selectedJsonItemIds=[]},injected(){},changeGridResolution(e,{payload:t}){const o=e;o.halfGridResolution=t},...He,...Be},selectors:{selectCurrentEditingRoomJson:v,selectCurrentEditingRoomColour:e=>v(e).color,selectCurrentEditingRoomScenery:e=>v(e).planet,selectTool:e=>e.tool,selectSelectedJsonItemIds:e=>e.selectedJsonItemIds,selectHoveredJsonItemId:e=>e.hoveredJsonItemId,...Oe}}),{applyToolToRoomJson:Fe,changeGridResolution:Me,changeRoomColour:Xe,changeRoomScenery:Ue,changeToRoom:Ge,deleteSelected:Le,injected:Ke,redo:Ye,roomJsonEdited:Ne,setClickableAnnotationHovered:Qe,setHoveredItemInRoom:Ve,setSelectedItemInRoom:Ze,setTool:et,undo:tt}=P.actions,{selectCanRedo:rt,selectCanUndo:ot,selectCurrentEditingRoomColour:nt,selectCurrentEditingRoomJson:st,selectCurrentEditingRoomScenery:it,selectHoveredJsonItemId:at,selectSelectedJsonItemIds:lt,selectTool:ct}=P.selectors,dt=ae.withTypes(),It=Object.freeze(Object.defineProperty({__proto__:null,applyToolToRoomJson:Fe,changeGridResolution:Me,changeRoomColour:Xe,changeRoomScenery:Ue,changeToRoom:Ge,deleteSelected:Le,initialLevelEditorSliceState:q,injected:Ke,levelEditorSlice:P,redo:Ye,roomJsonEdited:Ne,selectCanRedo:rt,selectCanUndo:ot,selectCurrentEditingRoomColour:nt,selectCurrentEditingRoomJson:st,selectCurrentEditingRoomScenery:it,selectHoveredJsonItemId:at,selectSelectedJsonItemIds:lt,selectTool:ct,setClickableAnnotationHovered:Qe,setHoveredItemInRoom:Ve,setSelectedItemInRoom:Ze,setTool:et,undo:tt,useAppSelectorWithLevelEditorSlice:dt},Symbol.toStringTag,{value:"Module"}));export{gt as A,ht as B,mt as C,Qe as D,at as E,lt as F,$e as G,Ve as H,Ze as I,Fe as J,Le as K,Ne as L,It as M,et as a,nt as b,Me as c,Xe as d,it as e,Ue as f,ot as g,rt as h,tt as i,st as j,x as k,Ge as l,yt as m,g as n,_e as o,bt as p,Ee as q,Ye as r,ct as s,Ce as t,dt as u,vt as v,Y as w,ft as x,pt as y,Ae as z};
