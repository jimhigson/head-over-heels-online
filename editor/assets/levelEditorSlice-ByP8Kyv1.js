import{u as A,x as N,y as Y,z as ne,A as P,F as se,H as ie,I as ae,J as ce,K as $,L as R,N as K,O as le,Q as de,W as ue,X as ye,Y as fe,Z as me,_ as pe,$ as ge,a0 as he,a1 as ve}from"./index-ConB_4-b.js";var T={},C={},q;function Ie(){if(q)return C;q=1;function e(i,l){var r;if(typeof Symbol>"u"||i[Symbol.iterator]==null){if(Array.isArray(i)||(r=t(i))||l){r&&(i=r);var u=0,a=function(){};return{s:a,n:function(){return u>=i.length?{done:!0}:{done:!1,value:i[u++]}},e:function(m){throw m},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,h=!1,p;return{s:function(){r=i[Symbol.iterator]()},n:function(){var m=r.next();return f=m.done,m},e:function(m){h=!0,p=m},f:function(){try{!f&&r.return!=null&&r.return()}finally{if(h)throw p}}}}function t(i,l){if(i){if(typeof i=="string")return o(i,l);var r=Object.prototype.toString.call(i).slice(8,-1);if(r==="Object"&&i.constructor&&(r=i.constructor.name),r==="Map"||r==="Set")return Array.from(i);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(i,l)}}function o(i,l){(l==null||l>i.length)&&(l=i.length);for(var r=0,u=new Array(l);r<l;r++)u[r]=i[r];return u}var n=A(),s=n.ensureIterable;function c(i){var l=[],r=e(i),u;try{for(r.s();!(u=r.n()).done;){var a=u.value;l.push(a)}}catch(f){r.e(f)}finally{r.f()}return l}C.__toArray=c;function y(i){return c(s(i))}return C.toArray=y,C}var B;function be(){if(B)return T;B=1;var e=N(),t=e.mark(y),o=A(),n=o.iterableCurry,s=Ie(),c=s.__toArray;function y(l,r){var u;return e.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(u=Array.isArray(l)?l:c(l),u.length){f.next=3;break}return f.abrupt("return");case 3:if(!r--){f.next=7;break}return f.delegateYield(u,"t0",5);case 5:f.next=3;break;case 7:case"end":return f.stop()}},t)}T.__cycleTimes=y;var i=n(y);return T.cycleTimes=i,T}var S={},j;function we(){if(j)return S;j=1;var e=A(),t=e.iterableCurry,o=be(),n=o.__cycleTimes;function s(y){return n(y,1/0)}S.__cycle=s;var c=t(s);return S.cycle=c,S}var z={},W;function ke(){if(W)return z;W=1;var e=N(),t=e.mark(i);function o(r,u){var a;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(a=n(r))||u){a&&(r=a);var f=0,h=function(){};return{s:h,n:function(){return f>=r.length?{done:!0}:{done:!1,value:r[f++]}},e:function(w){throw w},f:h}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,d=!1,m;return{s:function(){a=r[Symbol.iterator]()},n:function(){var w=a.next();return p=w.done,w},e:function(w){d=!0,m=w},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(d)throw m}}}}function n(r,u){if(r){if(typeof r=="string")return s(r,u);var a=Object.prototype.toString.call(r).slice(8,-1);if(a==="Object"&&r.constructor&&(a=r.constructor.name),a==="Map"||a==="Set")return Array.from(r);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return s(r,u)}}function s(r,u){(u==null||u>r.length)&&(u=r.length);for(var a=0,f=new Array(u);a<u;a++)f[a]=r[a];return f}var c=A(),y=c.iterableCurry;function i(r,u){var a,f,h,p;return e.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(u!==0){m.next=2;break}return m.abrupt("return");case 2:a=0,f=o(r),m.prev=4,f.s();case 6:if((h=f.n()).done){m.next=14;break}return p=h.value,m.next=10,p;case 10:if(++a!==u){m.next=12;break}return m.abrupt("break",14);case 12:m.next=6;break;case 14:m.next=19;break;case 16:m.prev=16,m.t0=m.catch(4),f.e(m.t0);case 19:return m.prev=19,f.f(),m.finish(19);case 22:case"end":return m.stop()}},t,null,[[4,16,19,22]])}z.__take=i;var l=y(i);return z.take=l,z}var x,F;function Re(){return F||(F=1,x=we().cycle),x}var Te=Re();const Ce=Y(Te);var E,H;function Se(){return H||(H=1,E=ke().take),E}var ze=Se();const Ae=Y(ze),xe={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},J=(e,t)=>[...Ae(t,Ce(xe[e]))],Ee=e=>({awayWall:{type:"wall",config:{direction:"away",tiles:J("blacktooth",e.x)},position:{x:0,y:e.y,z:0}},leftWall:{type:"wall",config:{direction:"left",tiles:J("blacktooth",e.y)},position:{x:e.x,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:e.x}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:e.y}},position:{x:0,y:0,z:0}}}),Q=e=>({planet:"blacktooth",color:{hue:"cyan",shade:"basic"},size:e,items:{floor:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:e},position:{x:0,y:0,z:0}},...Ee(e)}}),v=e=>e.campaignInProgress.rooms[e.currentlyEditingRoomId],L=(e,t)=>e.campaignInProgress.rooms[t],V=(e,t,o)=>e.campaignInProgress.rooms[o??e.currentlyEditingRoomId]?.items[t],k={w:16,d:16,h:12},M={x:16,y:16,z:12},_e=["head","heels"],Pe=[..._e,"headOverHeels"],g=(...e)=>t=>e.includes(t.type),Je=g("bubbles","stopAutowalk","firedDoughnut","floatingText","emitter","particle"),Xe=(e,t)=>Je(e)||Fe(e)&&(t!==void 0&&qe(t)||e.config.direction.z!==0)||Le(e)&&e.config.floorType==="none",jt=(e,t)=>!Xe(e,t),Oe=["ball","slidingBlock","slidingDeadly"];g(...Oe);const De=["portableBlock","spring","sceneryPlayer","sceneryCrown","monster","slidingBlock"],$e=["dalek","turtle","elephantHead","homingBot","helicopterBug"],Wt=e=>e.type==="slidingBlock"?e.config.style==="puck":e.type==="monster"?$e.includes(e.config.which):De.includes(e.type),qe=e=>e.type==="head"||e.type==="heels"||e.type==="headOverHeels";function Ft(e){return Be.includes(e.type)}const Be=[...Pe,"monster","ball","charles","pushableBlock","movingPlatform","moveableDeadly","pickup","portableBlock","slidingBlock","slidingDeadly","spring","sceneryPlayer","sceneryCrown"],je=["monster","deadlyBlock","moveableDeadly","slidingDeadly"];g(...je);const We=e=>e.config.times!==void 0,Fe=g("portal");g("teleporter");g("heels");g("head");g("heels","headOverHeels");g("head","headOverHeels");g("lift");g("emitter");const He=g("monster"),Le=g("floor");g("pickup");g("spring");const Ht=g("joystick");g("monster","movingPlatform");const Lt=e=>He(e)&&e.config.which==="cyberman"&&e.state.everActivated===!1,Mt=(e,t={})=>{const o=Me(t),n=P(M,e);return P(se(o,M),n)},Z=e=>({x:e.direction==="away"?e.tiles.length:e.direction==="towards"?e.times?.x:1,y:e.direction==="left"?e.tiles.length:e.direction==="right"?e.times?.y:1}),Ut=e=>e.type==="wall"?Z(e.config):We(e)?e.config.times:void 0,Me=(e=ne)=>({x:e.x??1,y:e.y??1,z:e.z??1}),Ue=e=>({x:e.x??1,y:e.y??1});function*Ge(e,t,o){for(const n of ae(e)){const[s,c]=n;if(c.type!=="wall"){yield n;continue}if(c.config.direction!==t){yield n;continue}const{position:y,config:i}=c,l=Ue(Z(i)),r=ce($(i.direction)),u=$(i.direction),a=P(o,y);if(a[u]!==0){yield n;continue}if(a[r]<-1){yield n;continue}if(a[r]>l[r]){yield n;continue}if(l[r]===2)continue;const f=a[r]===0;f&&(yield[s,R(c,p=>{p.position=K(y,{[r]:2});const d=p.config;switch(d.direction){case"towards":d.times={x:l[r]-2};break;case"right":d.times={y:l[r]-2};break;default:d.tiles=d.tiles.slice(2)}})]);const h=a[r]===l[r]-2;h&&(yield[s,R(c,p=>{const d=p.config;switch(d.direction){case"towards":d.times={x:l[r]-2};break;case"right":d.times={y:l[r]-2};break;default:d.tiles=d.tiles.slice(0,-2)}})]),!f&&!h&&(yield[`${s}/beforeDoor`,R(c,p=>{const d=p.config;switch(d.direction){case"towards":d.times={x:a[r]};break;case"right":d.times={y:a[r]};break;default:d.tiles=d.tiles.slice(0,a[r])}})],yield[`${s}/afterDoor`,R(c,p=>{p.position={...y,[r]:o[r]+2};const d=p.config;switch(d.direction){case"towards":d.times={x:l[r]-a[r]-2};break;case"right":d.times={y:l[r]-a[r]-2};break;default:d.tiles=d.tiles.slice(a[r]+2)}})])}}const U=(e,t,o)=>{e.items=ie(Ge(e.items,t,o))},I=e=>{const t=structuredClone(le(v(e))),{history:o}=e;o.redo=[],o.undo.push(t)},Ne={undo(e){const t=e,{campaignInProgress:o,history:{undo:n,redo:s},currentlyEditingRoomId:c}=t;n.length!==0&&(s.push(o.rooms[c]),o.rooms[c]=n.pop())},redo(e){const t=e,{campaignInProgress:o,history:{redo:n,undo:s},currentlyEditingRoomId:c}=t;n.length!==0&&(s.push(o.rooms[c]),o.rooms[c]=n.pop())}},Ye={selectCanUndo:e=>e.history.undo.length>0,selectCanRedo:e=>e.history.redo.length>0},Gt=({x:e=0,y:t=0})=>t-e,ee=({x:e=0,y:t=0,z:o=0})=>({x:t-e,y:-(e+t)/2-o}),Nt=(e,t,o)=>{const n=ee(e),s=de(o,n);return K(Ke(t,s),e)},Ke=(e,{x:t,y:o})=>{switch(ue(e)){case"xy":return{x:-t/2-o,y:t/2-o,z:0};case"xz":return{x:-t,y:0,z:t/2-o};case"yz":return{x:0,y:t,z:-t/2-o};default:throw new Error("only axis-aligned planes are supported for unprojection")}},Qe=({x:e=0,y:t=0,z:o=0})=>({x:e*k.w,y:t*k.d,z:o*k.h}),Ve=({x:e=0,y:t=0,z:o=0})=>({x:e/k.w,y:t/k.d,z:o/k.h}),Yt=e=>ee(Qe(e)),te=(e,t)=>{e.planet=t;for(const o of Object.values(e.items))o.type==="floor"&&o.config.floorType==="standable"&&(o.config.scenery=t),o.type==="wall"&&(o.config.direction==="away"||o.config.direction==="left")&&(o.config.tiles=J(t,o.config.tiles.length)),o.type==="pickup"&&o.config.gives==="crown"&&ye.includes(t)&&(o.config.planet=t)},oe=(e,t,o)=>{const n=`room_${e.nextRoomId++}`,s={id:n,...structuredClone(Q({x:8,y:8})),color:o};return te(s,t),e.campaignInProgress.rooms[n]=s,s},re=(e,t)=>{const o=t.type==="monster"?t.config.which:t.type;for(let n=1;;n++){const s=n===1?o:`${o}_${n}`;if(!e.items[s])return s}},_=(e,t,o)=>{const n=v(e),s=re(n,t);n.items[s]={type:t.type,config:t.config,position:o}},Ze=e=>e.type==="door",et=e=>e.type==="monster"&&e.config.which==="cyberman",tt={applyItemTool(e,{payload:{blockPosition:t,pointedAtItem:o}}){const n=e,{tool:s}=n;switch(s?.type){case"item":{if(Ze(s.item)&&o.type==="wall"){I(n);const c=v(n),y=o.config.direction;U(c,y,t);const i=oe(n,c.planet,c.color);_(n,{...s.item,config:{...s.item.config,toRoom:i.id,direction:y}},t);const l=re(i,s.item),r={x:y==="left"?0:y==="right"?i.size.x:Math.floor(i.size.x/2),y:y==="away"?0:y==="towards"?i.size.x:Math.floor(i.size.x/2),z:t.z},u=fe(y),a={type:"door",config:{toRoom:c.id,direction:u},position:r};i.items[l]=a,U(i,u,r)}else et(s.item)&&o.type==="deadlyBlock"&&o.config.style==="toaster"&&Ve(o.state.position).z+1===t.z?(I(n),_(n,{...s.item,config:{...s.item.config,activated:"off"}},t)):(I(n),_(n,s.item,t));n.selectedJsonItemIds=[];break}}}},ot={changeDragInProgress(e,{payload:t}){const o=e;o.dragInProgress=t}},rt={changeGridResolution(e,{payload:t}){const o=e;o.halfGridResolution=t},changeWallsFloorsLocked(e,{payload:t}){const o=e;o.wallsFloorsLocked=t}},nt={setSelectedItemInRoom(e,{payload:{jsonItemId:t,additive:o=!1}}){if(o)if(t===void 0)e.selectedJsonItemIds=[];else{const n=e.selectedJsonItemIds.indexOf(t);n===-1?e.selectedJsonItemIds.push(t):e.selectedJsonItemIds.splice(n,1)}else e.selectedJsonItemIds=t===void 0?[]:[t]},setHoveredItemInRoom(e,t){e.hoveredItem=t.payload},setClickableAnnotationHovered(e,t){e.clickableAnnotationHovered=t.payload}},st={moveOrResizeItem(e,{payload:{jsonItemId:t,newTimes:o,newPosition:n,startOfGesture:s}}){const c=e;s&&I(c);const y=V(c,t);if(y===void 0){console.warn("no json item found for resize",t);return}if(o!==void 0){const{config:i}=y;i.times={...o.x===1?{}:{x:o.x},...o.y===1?{}:{y:o.y},...o.z===1?{}:{z:o.z}}}n!==void 0&&(y.position=n)}},it=e=>pe(e.items),at=e=>me(it(e)),G=(e,t)=>{at(e).filter(o=>o.type==="floor").filter(o=>o.position.z===0).forEach(o=>{o.config={...o.config,floorType:t,scenery:t==="standable"?e.planet:void 0}})},ct={changeRoomColour(e,{payload:t}){const o=e,n=o.campaignInProgress.rooms[o.currentlyEditingRoomId].color;I(o),Object.assign(n,t)},changeRoomScenery(e,{payload:t}){const o=e,n=v(o);I(o),te(n,t)},roomJsonEdited(e,{payload:t}){const o=e;o.campaignInProgress.rooms[o.currentlyEditingRoomId]=t},deleteSelected(e){const t=e,o=v(t);I(t),t.selectedJsonItemIds.forEach(n=>{delete o.items[n]}),t.selectedJsonItemIds=[]},clearRoom(e){const t=e,o=v(t);I(t);for(const n of ge(o.items)){const s=o.items[n];s.type!=="floor"&&s.type!=="wall"&&s.type!=="door"&&(delete o.items[n],t.selectedJsonItemIds=t.selectedJsonItemIds.filter(c=>c!==n))}},setRoomAboveOrBelow(e,{payload:t}){const o=e,n=t.direction,s=n==="roomAbove"?"roomBelow":"roomAbove",c=v(o),y=t.createNew?oe(o,c.planet,c.color).id:t.roomId,i=c[n]&&L(o,c[n]);i?.[s]===o.currentlyEditingRoomId&&(i[s]=void 0),c[n]=y;const l=y&&L(o,y);l!==void 0&&(l[s]=c.id),l?G(n==="roomBelow"?c:l,"none"):G(n==="roomBelow"?c:i,"standable")}},X="room_0",lt={id:X,...Q({x:8,y:8})},O={campaignInProgress:{name:"new campaign",rooms:{[X]:lt}},nextRoomId:1,currentlyEditingRoomId:X,tool:{type:"pointer"},hoveredItem:void 0,clickableAnnotationHovered:!1,selectedJsonItemIds:[],halfGridResolution:!1,wallsFloorsLocked:!0,dragInProgress:!1,history:{undo:[],redo:[]}},D=he({name:"levelEditor",initialState:O,reducers:{setTool(e,{payload:t}){const o=e;t.type==="item"&&(o.selectedJsonItemIds=[]),o.tool=t},changeToRoom(e,{payload:t}){const o=e;if(!o.campaignInProgress.rooms[t]){console.warn(`can't change to room ${t} - it doesn't exist`);return}o.currentlyEditingRoomId=t,o.clickableAnnotationHovered=!1,o.hoveredItem=void 0,o.selectedJsonItemIds=[],o.history=O.history},injected(){},...rt,...Ne,...tt,...ot,...nt,...ct,...st},selectors:{selectCurrentEditingRoomJson:v,selectItem:V,selectCurrentEditingRoomColour:e=>v(e).color,selectCurrentEditingRoomScenery:e=>v(e).planet,selectTool:e=>e.tool,selectSelectedJsonItemIds:e=>e.selectedJsonItemIds,selectHoveredItem:e=>e.hoveredItem,...Ye}}),{applyItemTool:dt,changeDragInProgress:ut,changeGridResolution:yt,changeRoomColour:ft,changeRoomScenery:mt,changeToRoom:pt,changeWallsFloorsLocked:gt,clearRoom:ht,deleteSelected:vt,injected:It,redo:bt,moveOrResizeItem:wt,roomJsonEdited:kt,setClickableAnnotationHovered:Rt,setHoveredItemInRoom:Tt,setRoomAboveOrBelow:Ct,setSelectedItemInRoom:St,setTool:zt,undo:At}=D.actions,{selectCanRedo:xt,selectCanUndo:Et,selectCurrentEditingRoomColour:_t,selectCurrentEditingRoomJson:Pt,selectItem:Jt,selectCurrentEditingRoomScenery:Xt,selectHoveredItem:Ot,selectSelectedJsonItemIds:Dt,selectTool:$t}=D.selectors,qt=ve.withTypes(),Kt=Object.freeze(Object.defineProperty({__proto__:null,applyItemTool:dt,changeDragInProgress:ut,changeGridResolution:yt,changeRoomColour:ft,changeRoomScenery:mt,changeToRoom:pt,changeWallsFloorsLocked:gt,clearRoom:ht,deleteSelected:vt,initialLevelEditorSliceState:O,injected:It,levelEditorSlice:D,moveOrResizeItem:wt,redo:bt,roomJsonEdited:kt,selectCanRedo:xt,selectCanUndo:Et,selectCurrentEditingRoomColour:_t,selectCurrentEditingRoomJson:Pt,selectCurrentEditingRoomScenery:Xt,selectHoveredItem:Ot,selectItem:Jt,selectSelectedJsonItemIds:Dt,selectTool:$t,setClickableAnnotationHovered:Rt,setHoveredItemInRoom:Tt,setRoomAboveOrBelow:Ct,setSelectedItemInRoom:St,setTool:zt,undo:At,useAppSelectorWithLevelEditorSlice:qt},Symbol.toStringTag,{value:"Module"}));export{kt as $,Qe as A,Be as B,Oe as C,Z as D,Mt as E,jt as F,Ft as G,qe as H,Ht as I,Lt as J,Gt as K,Wt as L,Rt as M,Ot as N,Dt as O,Ve as P,Ue as Q,Nt as R,ut as S,Jt as T,St as U,dt as V,Tt as W,Me as X,wt as Y,Ke as Z,V as _,zt as a,Kt as a0,_t as b,yt as c,vt as d,ft as e,Xt as f,mt as g,Et as h,xt as i,At as j,gt as k,Pt as l,J as m,ht as n,v as o,Ct as p,pt as q,bt as r,$t as s,ee as t,qt as u,g as v,Yt as w,We as x,Ut as y,k as z};
