const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebGPURenderer-DkwvVTWl.js","assets/index-B-Wm-xHn.js","assets/index-ITC6aZni.css","assets/colorToUniform-KTpA7KSL.js","assets/SharedSystems-xOR-kup6.js","assets/Graphics-DO4_2mLw.js","assets/levelEditorSlice-CmusRLIg.js","assets/WebGLRenderer-Dpji5UMH.js","assets/JsonRoomEditor-Buor0pqx.js","assets/JsonRoomEditor-Cpm53wG5.css"])))=>i.map(i=>d[i]);
import{a6 as Za,a5 as _r,a7 as It,s as Ug,x as eh,y as Qt,e as Qa,E as Zr,a as Hg,C as oe,d as Qr,v as eo,Z as J,D as sa,az as Gt,k as Wg,K as Sr,t as ht,T as er,U as Gg,M as qg,aA as tr,V as th,aB as Vg,w as ia,aC as Kg,aD as Xg,j as Jg,aE as Pn,aF as f,aG as nh,aH as qt,aI as p,aJ as Yg,aK as ks,aL as rh,aM as Zg,aN as de,aO as He,aP as oh,aQ as Qg,aR as ey,aS as U,aT as Ge,aU as Cr,al as ty,aV as ny,aW as ry,aX as sh,aY as ih,ae as ue,ai as yn,aa as B,aZ as ah,a_ as sr,a$ as oy,b0 as Es,b1 as mn,ag as dr,b2 as ho,an as kr,b3 as sy,b4 as iy,b5 as ay,ab as bt,ac as ds,at as Ps,ap as el,am as ly,ao as Vt,b6 as Ie,b7 as lh,b8 as cy,af as uy,b9 as Tn,aq as ch,au as hs,ba as to,bb as Ot,bc as dy,bd as hy,av as Ts,be as tl,bf as nl,bg as Kr,ad as ir,bh as uh,as as rl,bi as ol,bj as fy,bk as py,bl as en,ah as my,bm as gy,bn as sl,bo as oc,bp as yy,bq as vy,br as by,bs as il,bt as wy,bu as xy,bv as _y,bw as Sy,bx as Cy,by as ky,bz as Ey,bA as Py,bB as Ty,bC as Ay,bD as Ry,bE as Iy,bF as Oy,bG as jy}from"./index-B-Wm-xHn.js";import{r as $y,u as he,d as Ny,g as zy,c as Dy,s as pn,a as vn,b as My,e as sc,f as Ly,h as By,i as Fy,j as Uy,k as Hy,l as Wy,m as Gy,n as hr,o as qy,p as Vy,q as dh,t as ri,v as hh,w as Ky,x as Xy,y as Jy,z as Yy,A as q,B as Zy,C as Ee,D as Qy,E as ev,F as fh,G as ic,H as al,I as tv,J as aa,K as ac,L as fr,M as nv,N as rv,O as ov,P as ph,Q as mh,R as sv,S as iv,T as av,U as la,V as fo,W as gh,X as ll,Y as cl,Z as yh,_ as vh,$ as lv,a0 as lc,a1 as bh,a2 as cv,a3 as uv,a4 as wh,a5 as xh,a6 as dv,a7 as oi,a8 as hv,a9 as cc,aa as _h,ab as ca,ac as Sh,ad as fv,ae as pv,af as Ch}from"./levelEditorSlice-CmusRLIg.js";import{S as mv,G as ft}from"./Graphics-DO4_2mLw.js";function gv(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function yv(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function vv(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(n=>typeof n=="function")){const n=t.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${e}[${n}]`)}}var uc=t=>Array.isArray(t)?t:[t];function bv(t){const e=Array.isArray(t[0])?t[0]:t;return vv(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function wv(t,e){const n=[],{length:r}=t;for(let o=0;o<r;o++)n.push(t[o].apply(null,e));return n}var xv=class{constructor(t){this.value=t}deref(){return this.value}},_v=typeof WeakRef<"u"?WeakRef:xv,Sv=0,dc=1;function Co(){return{s:Sv,v:void 0,o:null,p:null}}function kh(t,e={}){let n=Co();const{resultEqualityCheck:r}=e;let o,s=0;function i(){let a=n;const{length:l}=arguments;for(let d=0,h=l;d<h;d++){const m=arguments[d];if(typeof m=="function"||typeof m=="object"&&m!==null){let g=a.o;g===null&&(a.o=g=new WeakMap);const y=g.get(m);y===void 0?(a=Co(),g.set(m,a)):a=y}else{let g=a.p;g===null&&(a.p=g=new Map);const y=g.get(m);y===void 0?(a=Co(),g.set(m,a)):a=y}}const c=a;let u;if(a.s===dc)u=a.v;else if(u=t.apply(null,arguments),s++,r){const d=o?.deref?.()??o;d!=null&&r(d,u)&&(u=d,s!==0&&s--),o=typeof u=="object"&&u!==null||typeof u=="function"?new _v(u):u}return c.s=dc,c.v=u,u}return i.clearCache=()=>{n=Co(),i.resetResultsCount()},i.resultsCount=()=>s,i.resetResultsCount=()=>{s=0},i}function Cv(t,...e){const n=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,r=(...o)=>{let s=0,i=0,a,l={},c=o.pop();typeof c=="object"&&(l=c,c=o.pop()),gv(c,`createSelector expects an output function after the inputs, but received: [${typeof c}]`);const u={...n,...l},{memoize:d,memoizeOptions:h=[],argsMemoize:m=kh,argsMemoizeOptions:g=[]}=u,y=uc(h),v=uc(g),b=bv(o),_=d(function(){return s++,c.apply(null,arguments)},...y),w=m(function(){i++;const C=wv(b,arguments);return a=_.apply(null,C),a},...v);return Object.assign(w,{resultFunc:c,memoizedResultFunc:_,dependencies:b,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>a,recomputations:()=>s,resetRecomputations:()=>{s=0},memoize:d,argsMemoize:m})};return Object.assign(r,{withTypes:()=>r}),r}var Eh=Cv(kh),kv=Object.assign((t,e=Eh)=>{yv(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const n=Object.keys(t),r=n.map(s=>t[s]);return e(r,(...s)=>s.reduce((i,a,l)=>(i[n[l]]=a,i),{}))},{withTypes:()=>kv}),ko={},hc;function Ph(){if(hc)return ko;hc=1;var t=Za(),e=t.mark(a);function n(c,u){var d;if(typeof Symbol>"u"||c[Symbol.iterator]==null){if(Array.isArray(c)||(d=r(c))||u){d&&(c=d);var h=0,m=function(){};return{s:m,n:function(){return h>=c.length?{done:!0}:{done:!1,value:c[h++]}},e:function(_){throw _},f:m}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var g=!0,y=!1,v;return{s:function(){d=c[Symbol.iterator]()},n:function(){var _=d.next();return g=_.done,_},e:function(_){y=!0,v=_},f:function(){try{!g&&d.return!=null&&d.return()}finally{if(y)throw v}}}}function r(c,u){if(c){if(typeof c=="string")return o(c,u);var d=Object.prototype.toString.call(c).slice(8,-1);if(d==="Object"&&c.constructor&&(d=c.constructor.name),d==="Map"||d==="Set")return Array.from(c);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return o(c,u)}}function o(c,u){(u==null||u>c.length)&&(u=c.length);for(var d=0,h=new Array(u);d<u;d++)h[d]=c[d];return h}var s=_r(),i=s.iterableCurry;function a(c,u){var d,h,m,g;return t.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d=0,h=n(c),v.prev=2,h.s();case 4:if((m=h.n()).done){v.next=10;break}return g=m.value,v.next=8,u(g,d++);case 8:v.next=4;break;case 10:v.next=15;break;case 12:v.prev=12,v.t0=v.catch(2),h.e(v.t0);case 15:return v.prev=15,h.f(),v.finish(15);case 18:case"end":return v.stop()}},e,null,[[2,12,15,18]])}ko.__map=a;var l=i(a);return ko.map=l,ko}var Eo={},fc;function Ev(){if(fc)return Eo;fc=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,m=!1,g;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return h=v.done,v},e:function(v){m=!0,g=v},f:function(){try{!h&&c.return!=null&&c.return()}finally{if(m)throw g}}}}function e(a,l){if(a){if(typeof a=="string")return n(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return n(a,l)}}function n(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var r=_r(),o=r.iterableCurry;function s(a,l){var c=0,u=t(a),d;try{for(u.s();!(d=u.n()).done;){var h=d.value;if(l(h,c++))return!0}}catch(m){u.e(m)}finally{u.f()}return!1}Eo.__some=s;var i=o(s,{reduces:!0});return Eo.some=i,Eo}var Po={},pc;function Pv(){if(pc)return Po;pc=1;var t=Za(),e=t.mark(s),n=_r(),r=n.wrapWithIterableIterator,o=n.ensureIterable;function s(){var a,l,c,u,d,h,m=arguments;return t.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:for(a=m.length,l=new Array(a),c=0;c<a;c++)l[c]=m[c];u=0,d=l;case 2:if(!(u<d.length)){y.next=8;break}return h=d[u],y.delegateYield(o(h),"t0",5);case 5:u++,y.next=2;break;case 8:case"end":return y.stop()}},e)}Po.__concat=s;var i=r(s);return Po.concat=i,Po}var To={},mc;function Tv(){if(mc)return To;mc=1;var t=Za(),e=t.mark(c);function n(d,h){var m;if(typeof Symbol>"u"||d[Symbol.iterator]==null){if(Array.isArray(d)||(m=r(d))||h){m&&(d=m);var g=0,y=function(){};return{s:y,n:function(){return g>=d.length?{done:!0}:{done:!1,value:d[g++]}},e:function(x){throw x},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,b=!1,_;return{s:function(){m=d[Symbol.iterator]()},n:function(){var x=m.next();return v=x.done,x},e:function(x){b=!0,_=x},f:function(){try{!v&&m.return!=null&&m.return()}finally{if(b)throw _}}}}function r(d,h){if(d){if(typeof d=="string")return o(d,h);var m=Object.prototype.toString.call(d).slice(8,-1);if(m==="Object"&&d.constructor&&(m=d.constructor.name),m==="Map"||m==="Set")return Array.from(d);if(m==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return o(d,h)}}function o(d,h){(h==null||h>d.length)&&(h=d.length);for(var m=0,g=new Array(h);m<h;m++)g[m]=d[m];return g}var s=_r(),i=s.iterableCurry,a=Ph(),l=a.__map;function c(d,h){var m,g,y;return t.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:m=n(l(d,h)),b.prev=1,m.s();case 3:if((g=m.n()).done){b.next=8;break}return y=g.value,b.delegateYield(y,"t0",6);case 6:b.next=3;break;case 8:b.next=13;break;case 10:b.prev=10,b.t1=b.catch(1),m.e(b.t1);case 13:return b.prev=13,m.f(),b.finish(13);case 16:case"end":return b.stop()}},e,null,[[1,10,13,16]])}To.__flatMap=c;var u=i(c);return To.flatMap=u,To}var Ao={},gc;function Av(){if(gc)return Ao;gc=1;var t=_r(),e=t.iterableCurry,n=$y(),r=n.__firstOr,o=Symbol("none");function s(a){return r(a,o)===o}Ao.__isEmpty=s;var i=e(s,{reduces:!0});return Ao.isEmpty=i,Ao}var Ro={},yc;function Rv(){if(yc)return Ro;yc=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,m=!1,g;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return h=v.done,v},e:function(v){m=!0,g=v},f:function(){try{!h&&c.return!=null&&c.return()}finally{if(m)throw g}}}}function e(a,l){if(a){if(typeof a=="string")return n(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return n(a,l)}}function n(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var r=_r(),o=r.ensureIterable;function s(a){var l=o(a),c=0,u=t(l),d;try{for(u.s();!(d=u.n()).done;){var h=d.value;c++}}catch(m){u.e(m)}finally{u.f()}return c}Ro.__size=s;var i=s;return Ro.size=i,Ro}var si,vc;function Iv(){return vc||(vc=1,si=Pv().concat),si}var Ov=Iv();const bc=It(Ov);var ii,wc;function jv(){return wc||(wc=1,ii=Tv().flatMap),ii}var $v=jv();const Nv=It($v);var ai,xc;function zv(){return xc||(xc=1,ai=Av().isEmpty),ai}var Dv=zv();const Th=It(Dv);var li,_c;function Mv(){return _c||(_c=1,li=Ph().map),li}var Lv=Mv();const Sc=It(Lv);var ci={},Cc;function Bv(){if(Cc)return ci;Cc=1;var t=function(r){return r};function e(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return r.length||(r=[t]),r.reduce(function(s,i){return function(){return i(s.apply(void 0,arguments))}})}return ci.pipe=e,ci}var ui,kc;function Fv(){return kc||(kc=1,ui=Bv().pipe),ui}var Uv=Fv();const Ec=It(Uv);var di,Pc;function Hv(){return Pc||(Pc=1,di=Rv().size),di}var Wv=Hv();const Ah=It(Wv);var hi,Tc;function Gv(){return Tc||(Tc=1,hi=Ev().some),hi}var qv=Gv();const Vv=It(qv),Rh=class ua extends Ug{constructor(e){e={...ua.defaultOptions,...e},super(e),this.enabled=!0,this._state=mv.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(e,n,r,o){e.applyFilter(this,n,r,o)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:n,gl:r,...o}=e;let s,i;return n&&(s=eh.from(n)),r&&(i=Qt.from(r)),new ua({gpuProgram:s,glProgram:i,...o})}};Rh.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let An=Rh;const da=[];Qa.handleByNamedList(Zr.Environment,da);async function Kv(t){if(!t)for(let e=0;e<da.length;e++){const n=da[e];if(n.value.test()){await n.value.load();return}}}let jr;function Xv(){if(typeof jr=="boolean")return jr;try{jr=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{jr=!1}return jr}var Ih=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(Ih||{});class Jv{constructor(e){this.items=[],this._name=e}emit(e,n,r,o,s,i,a,l){const{name:c,items:u}=this;for(let d=0,h=u.length;d<h;d++)u[d][c](e,n,r,o,s,i,a,l);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const n=this.items.indexOf(e);return n!==-1&&this.items.splice(n,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const Yv=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Oh=class jh extends Hg{constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;const n=[...Yv,...this.config.runners??[]];this._addRunners(...n),this._unsafeEvalCheck()}async init(e={}){const n=e.skipExtensionImports===!0?!0:e.manageImports===!1;await Kv(n),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const r in this._systemsHash)e={...this._systemsHash[r].constructor.defaultOptions,...e};e={...jh.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let r=0;r<this.runners.init.items.length;r++)await this.runners.init.items[r].init(e);this._initOptions=e}render(e,n){let r=e;if(r instanceof oe&&(r={container:r},n&&(Qr(eo,"passing a second argument is deprecated, please use render options instead"),r.target=n.renderTexture)),r.target||(r.target=this.view.renderTarget),r.target===this.view.renderTarget&&(this._lastObjectRendered=r.container,r.clearColor??(r.clearColor=this.background.colorRgba),r.clear??(r.clear=this.background.clearBeforeRender)),r.clearColor){const o=Array.isArray(r.clearColor)&&r.clearColor.length===4;r.clearColor=o?r.clearColor:J.shared.setValue(r.clearColor).toArray()}r.transform||(r.container.updateLocalTransform(),r.transform=r.container.localTransform),r.container.enableRenderGroup(),this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r)}resize(e,n,r){const o=this.view.resolution;this.view.resize(e,n,r),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),r!==void 0&&r!==o&&this.runners.resolutionChange.emit(r)}clear(e={}){const n=this;e.target||(e.target=n.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=Ih.ALL);const{clear:r,clearColor:o,target:s}=e;J.shared.setValue(o??this.background.colorRgba),n.renderTarget.clear(s,r,J.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(n=>{this.runners[n]=new Jv(n)})}_addSystems(e){let n;for(n in e){const r=e[n];this._addSystem(r.value,r.name)}}_addSystem(e,n){const r=new e(this);if(this[n])throw new Error(`Whoops! The name "${n}" is already in use`);this[n]=r,this._systemsHash[n]=r;for(const o in this.runners)this.runners[o].add(r);return this}_addPipes(e,n){const r=n.reduce((o,s)=>(o[s.name]=s.value,o),{});e.forEach(o=>{const s=o.value,i=o.name,a=r[i];this.renderPipes[i]=new s(this,a?new a:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(n=>{n.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!Xv())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Oh.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let $h=Oh,Io;function Zv(t){return Io!==void 0||(Io=(()=>{const e={stencil:!0,failIfMajorPerformanceCaveat:t??$h.defaultOptions.failIfMajorPerformanceCaveat};try{if(!sa.get().getWebGLRenderingContext())return!1;let r=sa.get().createCanvas().getContext("webgl",e);const o=!!r?.getContextAttributes()?.stencil;if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,o}catch{return!1}})()),Io}let Oo;async function Qv(t={}){return Oo!==void 0||(Oo=await(async()=>{const e=sa.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(t)).requestDevice(),!0}catch{return!1}})()),Oo}const Ac=["webgl","webgpu","canvas"];async function eb(t){let e=[];t.preference?(e.push(t.preference),Ac.forEach(s=>{s!==t.preference&&e.push(s)})):e=Ac.slice();let n,r={};for(let s=0;s<e.length;s++){const i=e[s];if(i==="webgpu"&&await Qv()){const{WebGPURenderer:a}=await Gt(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-DkwvVTWl.js");return{WebGPURenderer:l}},__vite__mapDeps([0,1,2,3,4,5,6]));n=a,r={...t,...t.webgpu};break}else if(i==="webgl"&&Zv(t.failIfMajorPerformanceCaveat??$h.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await Gt(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-Dpji5UMH.js");return{WebGLRenderer:l}},__vite__mapDeps([7,1,2,3,4,5,6]));n=a,r={...t,...t.webgl};break}else if(i==="canvas")throw r={...t},new Error("CanvasRenderer is not yet implemented")}if(delete r.webgpu,delete r.webgl,!n)throw new Error("No available renderer for the current environment");const o=new n;return await o.init(r),o}const Nh="8.8.1";class zh{static init(){globalThis.__PIXI_APP_INIT__?.(this,Nh)}static destroy(){}}zh.extension=Zr.Application;class tb{constructor(e){this._renderer=e}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,Nh)}destroy(){this._renderer=null}}tb.extension={type:[Zr.WebGLSystem,Zr.WebGPUSystem],name:"initHook",priority:-10};const Dh=class ha{constructor(...e){this.stage=new oe,e[0]!==void 0&&Qr(eo,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await eb(e),ha._plugins.forEach(n=>{n.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return Qr(eo,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,n=!1){const r=ha._plugins.slice(0);r.reverse(),r.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(n),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Dh._plugins=[];let Mh=Dh;Qa.handleByList(Zr.Application,Mh._plugins);Qa.add(zh);var nb=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,rb=`
in vec2 vTextureCoord;

out vec4 finalColor;

uniform float uAlpha;
uniform sampler2D uTexture;

void main()
{
    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;
}
`,Rc=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
 
    var sample = textureSample(uTexture, uSampler, uv);
    
    return sample * alphaUniforms.uAlpha;
}`;const Lh=class Bh extends An{constructor(e){e={...Bh.defaultOptions,...e};const n=eh.from({vertex:{source:Rc,entryPoint:"mainVertex"},fragment:{source:Rc,entryPoint:"mainFragment"}}),r=Qt.from({vertex:nb,fragment:rb,name:"alpha-filter"}),{alpha:o,...s}=e,i=new Wg({uAlpha:{value:o,type:"f32"}});super({...s,gpuProgram:n,glProgram:r,resources:{alphaUniforms:i}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(e){this.resources.alphaUniforms.uniforms.uAlpha=e}};Lh.defaultOptions={alpha:1};let ob=Lh;class pr extends Sr{constructor(...e){let n=e[0];Array.isArray(e[0])&&(n={textures:e[0],autoUpdate:e[1]});const{animationSpeed:r=1,autoPlay:o=!1,autoUpdate:s=!0,loop:i=!0,onComplete:a=null,onFrameChange:l=null,onLoop:c=null,textures:u,updateAnchor:d=!1,...h}=n,[m]=u;super({...h,texture:m instanceof ht?m:m.texture}),this._textures=null,this._durations=null,this._autoUpdate=s,this._isConnectedToTicker=!1,this.animationSpeed=r,this.loop=i,this.updateAnchor=d,this.onComplete=a,this.onFrameChange=l,this.onLoop=c,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=u,o&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(er.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(er.shared.add(this.update,this,Gg.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const n=e.deltaTime,r=this.animationSpeed*n,o=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=r/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*n);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o||this.animationSpeed<0&&this.currentFrame>o)&&this.onLoop(),this._updateTexture())}_updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const n=[];for(let r=0;r<e.length;++r)n.push(ht.from(e[r]));return new pr(n)}static fromImages(e){const n=[];for(let r=0;r<e.length;++r)n.push(ht.from(e[r]));return new pr(n)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof ht)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let n=0;n<e.length;n++)this._textures.push(e[n].texture),this._durations.push(e[n].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const n=this.currentFrame;this._currentTime=e,n!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(er.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(er.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class sb{constructor({matrix:e,observer:n}={}){this.dirty=!0,this._matrix=e??new qg,this.observer=n,this.position=new tr(this,0,0),this.scale=new tr(this,1,1),this.pivot=new tr(this,0,0),this.skew=new tr(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}_onUpdate(e){this.dirty=!0,e===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}}const Fh=class Zo extends th{constructor(...e){let n=e[0]||{};n instanceof ht&&(n={texture:n}),e.length>1&&(Qr(eo,"use new TilingSprite({ texture, width:100, height:100 }) instead"),n.width=e[1],n.height=e[2]),n={...Zo.defaultOptions,...n};const{texture:r,anchor:o,tilePosition:s,tileScale:i,tileRotation:a,width:l,height:c,applyAnchorToTexture:u,roundPixels:d,...h}=n??{};super({label:"TilingSprite",...h}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new tr({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=u,this.texture=r,this._width=l??r.width,this._height=c??r.height,this._tileTransform=new sb({observer:{_onUpdate:()=>this.onViewUpdate()}}),o&&(this.anchor=o),this.tilePosition=s,this.tileScale=i,this.tileRotation=a,this.roundPixels=d??!1}static from(e,n={}){return typeof e=="string"?new Zo({texture:Vg.get(e),...n}):new Zo({texture:e,...n})}get uvRespectAnchor(){return ia("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){ia("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){typeof e=="number"?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=ht.EMPTY);const n=this._texture;n!==e&&(n&&n.dynamic&&n.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,n){typeof e=="object"&&(n=e.height??e.width,e=e.width),this._width=e,this._height=n??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){const e=this._bounds,n=this._anchor,r=this._width,o=this._height;e.minX=-n._x*r,e.maxX=e.minX+r,e.minY=-n._y*o,e.maxY=e.minY+o}containsPoint(e){const n=this._width,r=this._height,o=-n*this._anchor._x;let s=0;return e.x>=o&&e.x<=o+n&&(s=-r*this._anchor._y,e.y>=s&&e.y<=s+r)}destroy(e=!1){if(super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof e=="boolean"?e:e?.texture){const r=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(r)}this._texture=null}};Fh.defaultOptions={texture:ht.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let ib=Fh;class ab extends th{constructor(e,n){const{text:r,resolution:o,style:s,anchor:i,width:a,height:l,roundPixels:c,...u}=e;super({...u}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=n,this.text=r??"",this.style=s,this.resolution=o??null,this.allowChildren=!1,this._anchor=new tr({_onUpdate:()=>{this.onViewUpdate()}}),i&&(this.anchor=i),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){e||(e={}),this._style?.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,n){typeof e=="object"?(n=e.height??e.width,e=e.width):n??(n=e),e!==void 0&&this._setWidth(e,this.bounds.width),n!==void 0&&this._setHeight(n,this.bounds.height)}containsPoint(e){const n=this.bounds.width,r=this.bounds.height,o=-n*this.anchor.x;let s=0;return e.x>=o&&e.x<=o+n&&(s=-r*this.anchor.y,e.y>=s&&e.y<=s+r)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e?.style)&&this._style.destroy(e),this._style=null,this._text=null}}function lb(t,e){let n=t[0]??{};return(typeof n=="string"||t[1])&&(Qr(eo,`use new ${e}({ text: "hi!", style }) instead`),n={text:n,style:t[1]}),n}class cb extends ab{constructor(...e){const n=lb(e,"Text");super(n,Kg),this.renderPipeId="text"}updateBounds(){const e=this._bounds,n=this._anchor,r=Xg.measureText(this._text,this._style),{width:o,height:s}=r;e.minX=-n._x*o,e.maxX=e.minX+o,e.minY=-n._y*s,e.maxY=e.minY+s}}class ul extends ht{static create(e){return new ul({source:new Jg(e)})}resize(e,n,r){return this.source.resize(e,n,r),this}}const Uh=class Hh extends oe{constructor(e={}){e={...Hh.defaultOptions,...e},super(),this.renderLayerChildren=[],this.sortableChildren=e.sortableChildren,this.sortFunction=e.sortFunction}attach(...e){for(let n=0;n<e.length;n++){const r=e[n];if(r.parentRenderLayer){if(r.parentRenderLayer===this)continue;r.parentRenderLayer.detach(r)}this.renderLayerChildren.push(r),r.parentRenderLayer=this;const o=this.renderGroup||this.parentRenderGroup;o&&(o.structureDidChange=!0)}return e[0]}detach(...e){for(let n=0;n<e.length;n++){const r=e[n],o=this.renderLayerChildren.indexOf(r);o!==-1&&this.renderLayerChildren.splice(o,1),r.parentRenderLayer=null;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)}return e[0]}detachAll(){const e=this.renderLayerChildren;for(let n=0;n<e.length;n++)e[n].parentRenderLayer=null;this.renderLayerChildren.length=0}collectRenderables(e,n,r){const o=this.renderLayerChildren,s=o.length;this.sortableChildren&&this.sortRenderLayerChildren();for(let i=0;i<s;i++)o[i].parent||ia("Container must be added to both layer and scene graph. Layers only handle render order - the scene graph is required for transforms (addChild)",o[i]),o[i].collectRenderables(e,n,this)}sortRenderLayerChildren(){this.renderLayerChildren.sort(this.sortFunction)}_getGlobalBoundsRecursive(e,n,r){if(!e)return;const o=this.renderLayerChildren;for(let s=0;s<o.length;s++)o[s]._getGlobalBoundsRecursive(!0,n,this)}};Uh.defaultOptions={sortableChildren:!1,sortFunction:(t,e)=>t.zIndex-e.zIndex};let ub=Uh;const Ic=ub,dl="-",db=t=>{const e=fb(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:i=>{const a=i.split(dl);return a[0]===""&&a.length!==1&&a.shift(),Wh(a,e)||hb(i)},getConflictingClassGroupIds:(i,a)=>{const l=n[i]||[];return a&&r[i]?[...l,...r[i]]:l}}},Wh=(t,e)=>{if(t.length===0)return e.classGroupId;const n=t[0],r=e.nextPart.get(n),o=r?Wh(t.slice(1),r):void 0;if(o)return o;if(e.validators.length===0)return;const s=t.join(dl);return e.validators.find(({validator:i})=>i(s))?.classGroupId},Oc=/^\[(.+)\]$/,hb=t=>{if(Oc.test(t)){const e=Oc.exec(t)[1],n=e?.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},fb=t=>{const{theme:e,prefix:n}=t,r={nextPart:new Map,validators:[]};return mb(Object.entries(t.classGroups),n).forEach(([s,i])=>{fa(i,r,s,e)}),r},fa=(t,e,n,r)=>{t.forEach(o=>{if(typeof o=="string"){const s=o===""?e:jc(e,o);s.classGroupId=n;return}if(typeof o=="function"){if(pb(o)){fa(o(r),e,n,r);return}e.validators.push({validator:o,classGroupId:n});return}Object.entries(o).forEach(([s,i])=>{fa(i,jc(e,s),n,r)})})},jc=(t,e)=>{let n=t;return e.split(dl).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},pb=t=>t.isThemeGetter,mb=(t,e)=>e?t.map(([n,r])=>{const o=r.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([i,a])=>[e+i,a])):s);return[n,o]}):t,gb=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,r=new Map;const o=(s,i)=>{n.set(s,i),e++,e>t&&(e=0,r=n,n=new Map)};return{get(s){let i=n.get(s);if(i!==void 0)return i;if((i=r.get(s))!==void 0)return o(s,i),i},set(s,i){n.has(s)?n.set(s,i):o(s,i)}}},Gh="!",yb=t=>{const{separator:e,experimentalParseClassName:n}=t,r=e.length===1,o=e[0],s=e.length,i=a=>{const l=[];let c=0,u=0,d;for(let v=0;v<a.length;v++){let b=a[v];if(c===0){if(b===o&&(r||a.slice(v,v+s)===e)){l.push(a.slice(u,v)),u=v+s;continue}if(b==="/"){d=v;continue}}b==="["?c++:b==="]"&&c--}const h=l.length===0?a:a.substring(u),m=h.startsWith(Gh),g=m?h.substring(1):h,y=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:m,baseClassName:g,maybePostfixModifierPosition:y}};return n?a=>n({className:a,parseClassName:i}):i},vb=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(r=>{r[0]==="["?(e.push(...n.sort(),r),n=[]):n.push(r)}),e.push(...n.sort()),e},bb=t=>({cache:gb(t.cacheSize),parseClassName:yb(t),...db(t)}),wb=/\s+/,xb=(t,e)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:o}=e,s=[],i=t.trim().split(wb);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:m}=n(c);let g=!!m,y=r(g?h.substring(0,m):h);if(!y){if(!g){a=c+(a.length>0?" "+a:a);continue}if(y=r(h),!y){a=c+(a.length>0?" "+a:a);continue}g=!1}const v=vb(u).join(":"),b=d?v+Gh:v,_=b+y;if(s.includes(_))continue;s.push(_);const w=o(y,g);for(let x=0;x<w.length;++x){const C=w[x];s.push(b+C)}a=c+(a.length>0?" "+a:a)}return a};function _b(){let t=0,e,n,r="";for(;t<arguments.length;)(e=arguments[t++])&&(n=qh(e))&&(r&&(r+=" "),r+=n);return r}const qh=t=>{if(typeof t=="string")return t;let e,n="";for(let r=0;r<t.length;r++)t[r]&&(e=qh(t[r]))&&(n&&(n+=" "),n+=e);return n};function Sb(t,...e){let n,r,o,s=i;function i(l){const c=e.reduce((u,d)=>d(u),t());return n=bb(c),r=n.cache.get,o=n.cache.set,s=a,a(l)}function a(l){const c=r(l);if(c)return c;const u=xb(l,n);return o(l,u),u}return function(){return s(_b.apply(null,arguments))}}const me=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},Vh=/^\[(?:([a-z-]+):)?(.+)\]$/i,Cb=/^\d+\/\d+$/,kb=new Set(["px","full","screen"]),Eb=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Pb=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Tb=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Ab=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Rb=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,xt=t=>ar(t)||kb.has(t)||Cb.test(t),jt=t=>Er(t,"length",Mb),ar=t=>!!t&&!Number.isNaN(Number(t)),fi=t=>Er(t,"number",ar),$r=t=>!!t&&Number.isInteger(Number(t)),Ib=t=>t.endsWith("%")&&ar(t.slice(0,-1)),te=t=>Vh.test(t),$t=t=>Eb.test(t),Ob=new Set(["length","size","percentage"]),jb=t=>Er(t,Ob,Kh),$b=t=>Er(t,"position",Kh),Nb=new Set(["image","url"]),zb=t=>Er(t,Nb,Bb),Db=t=>Er(t,"",Lb),Nr=()=>!0,Er=(t,e,n)=>{const r=Vh.exec(t);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):n(r[2]):!1},Mb=t=>Pb.test(t)&&!Tb.test(t),Kh=()=>!1,Lb=t=>Ab.test(t),Bb=t=>Rb.test(t),Fb=()=>{const t=me("colors"),e=me("spacing"),n=me("blur"),r=me("brightness"),o=me("borderColor"),s=me("borderRadius"),i=me("borderSpacing"),a=me("borderWidth"),l=me("contrast"),c=me("grayscale"),u=me("hueRotate"),d=me("invert"),h=me("gap"),m=me("gradientColorStops"),g=me("gradientColorStopPositions"),y=me("inset"),v=me("margin"),b=me("opacity"),_=me("padding"),w=me("saturate"),x=me("scale"),C=me("sepia"),k=me("skew"),S=me("space"),N=me("translate"),H=()=>["auto","contain","none"],L=()=>["auto","hidden","clip","visible","scroll"],V=()=>["auto",te,e],O=()=>[te,e],ee=()=>["",xt,jt],M=()=>["auto",ar,te],K=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],X=()=>["solid","dashed","dotted","double","none"],Z=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],F=()=>["start","end","center","between","around","evenly","stretch"],ie=()=>["","0",te],ve=()=>["auto","avoid","all","avoid-page","page","left","right","column"],pe=()=>[ar,te];return{cacheSize:500,separator:":",theme:{colors:[Nr],spacing:[xt,jt],blur:["none","",$t,te],brightness:pe(),borderColor:[t],borderRadius:["none","","full",$t,te],borderSpacing:O(),borderWidth:ee(),contrast:pe(),grayscale:ie(),hueRotate:pe(),invert:ie(),gap:O(),gradientColorStops:[t],gradientColorStopPositions:[Ib,jt],inset:V(),margin:V(),opacity:pe(),padding:O(),saturate:pe(),scale:pe(),sepia:ie(),skew:pe(),space:O(),translate:O()},classGroups:{aspect:[{aspect:["auto","square","video",te]}],container:["container"],columns:[{columns:[$t]}],"break-after":[{"break-after":ve()}],"break-before":[{"break-before":ve()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...K(),te]}],overflow:[{overflow:L()}],"overflow-x":[{"overflow-x":L()}],"overflow-y":[{"overflow-y":L()}],overscroll:[{overscroll:H()}],"overscroll-x":[{"overscroll-x":H()}],"overscroll-y":[{"overscroll-y":H()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[y]}],"inset-x":[{"inset-x":[y]}],"inset-y":[{"inset-y":[y]}],start:[{start:[y]}],end:[{end:[y]}],top:[{top:[y]}],right:[{right:[y]}],bottom:[{bottom:[y]}],left:[{left:[y]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",$r,te]}],basis:[{basis:V()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",te]}],grow:[{grow:ie()}],shrink:[{shrink:ie()}],order:[{order:["first","last","none",$r,te]}],"grid-cols":[{"grid-cols":[Nr]}],"col-start-end":[{col:["auto",{span:["full",$r,te]},te]}],"col-start":[{"col-start":M()}],"col-end":[{"col-end":M()}],"grid-rows":[{"grid-rows":[Nr]}],"row-start-end":[{row:["auto",{span:[$r,te]},te]}],"row-start":[{"row-start":M()}],"row-end":[{"row-end":M()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",te]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",te]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...F()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...F(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...F(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",te,e]}],"min-w":[{"min-w":[te,e,"min","max","fit"]}],"max-w":[{"max-w":[te,e,"none","full","min","max","fit","prose",{screen:[$t]},$t]}],h:[{h:[te,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[te,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[te,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[te,e,"auto","min","max","fit"]}],"font-size":[{text:["base",$t,jt]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",fi]}],"font-family":[{font:[Nr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",te]}],"line-clamp":[{"line-clamp":["none",ar,fi]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",xt,te]}],"list-image":[{"list-image":["none",te]}],"list-style-type":[{list:["none","disc","decimal",te]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[b]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[b]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...X(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",xt,jt]}],"underline-offset":[{"underline-offset":["auto",xt,te]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:O()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",te]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",te]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[b]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...K(),$b]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",jb]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},zb]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[g]}],"gradient-via-pos":[{via:[g]}],"gradient-to-pos":[{to:[g]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[b]}],"border-style":[{border:[...X(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[b]}],"divide-style":[{divide:X()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...X()]}],"outline-offset":[{"outline-offset":[xt,te]}],"outline-w":[{outline:[xt,jt]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:ee()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[b]}],"ring-offset-w":[{"ring-offset":[xt,jt]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",$t,Db]}],"shadow-color":[{shadow:[Nr]}],opacity:[{opacity:[b]}],"mix-blend":[{"mix-blend":[...Z(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Z()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",$t,te]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[w]}],sepia:[{sepia:[C]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[b]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[C]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",te]}],duration:[{duration:pe()}],ease:[{ease:["linear","in","out","in-out",te]}],delay:[{delay:pe()}],animate:[{animate:["none","spin","ping","pulse","bounce",te]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[x]}],"scale-x":[{"scale-x":[x]}],"scale-y":[{"scale-y":[x]}],rotate:[{rotate:[$r,te]}],"translate-x":[{"translate-x":[N]}],"translate-y":[{"translate-y":[N]}],"skew-x":[{"skew-x":[k]}],"skew-y":[{"skew-y":[k]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",te]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",te]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":O()}],"scroll-mx":[{"scroll-mx":O()}],"scroll-my":[{"scroll-my":O()}],"scroll-ms":[{"scroll-ms":O()}],"scroll-me":[{"scroll-me":O()}],"scroll-mt":[{"scroll-mt":O()}],"scroll-mr":[{"scroll-mr":O()}],"scroll-mb":[{"scroll-mb":O()}],"scroll-ml":[{"scroll-ml":O()}],"scroll-p":[{"scroll-p":O()}],"scroll-px":[{"scroll-px":O()}],"scroll-py":[{"scroll-py":O()}],"scroll-ps":[{"scroll-ps":O()}],"scroll-pe":[{"scroll-pe":O()}],"scroll-pt":[{"scroll-pt":O()}],"scroll-pr":[{"scroll-pr":O()}],"scroll-pb":[{"scroll-pb":O()}],"scroll-pl":[{"scroll-pl":O()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",te]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[xt,jt,fi]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},hl=Sb(Fb);function Xh(t){if(!fs(t))throw new Error(`Invalid textureId: "${t}"; textureId ∋ {${Object.keys(Pn.frames).sort().map(e=>`"${e}"`).join(`,
`)}}`)}function fs(t){return Pn.frames[t]!==void 0}function Jh(t){return Pn.animations[t]!==void 0}const Ub=({className:t,children:e})=>t?f.jsx("div",{className:`contents ${t}`,children:e}):e,Hb=t=>t.replaceAll(/(?<!\.)\./g,"_"),D=({children:t,className:e,noSlitWords:n,classnameCycle:r,onClick:o,noTint:s=!1,TagName:i="span"})=>{const a=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(a.length===0)return null;const l=n?[a.toUpperCase()]:a.toUpperCase().split(/\s+/);return f.jsxs(i,{className:e,onClick:o,children:[f.jsx("span",{className:"sr-only",children:a}),l.map((c,u)=>f.jsx("span",{className:hl("text-nowrap inline-block",u===l.length-1?"":"me-1"),children:Array.from(c).map((d,h)=>{const m=`hud.char.${nh(d)}`;return fs(m)||console.error("no texture for char",d,d.charCodeAt(0),m,"we have:",Object.keys(qt().textures)),f.jsx("span",{className:`sprite ${fs(m)?`texture-${Hb(m)}`:"texture-hud_char_?"}
                  ${s?"":"sprite-tinted"}
                  ${r===void 0?"":r[h%r.length]}`},h)})},u))]})},Wb=t=>t.props.children!==void 0,tt=({children:t,className:e})=>f.jsx(Ub,{className:e,children:Array.isArray(t)?t.map((n,r)=>f.jsx(tt,{children:n},r)):typeof t=="number"?f.jsx(D,{children:String(t)}):typeof t=="string"?f.jsx(D,{children:t}):p.isValidElement(t)?t.type===D||t.type===tt?t:Wb(t)?p.cloneElement(t,void 0,typeof t.props.children=="string"?f.jsx(D,{children:`${t.props.children}`}):f.jsx(tt,{children:t.props.children})):t:t});function Ke(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t?.(o),n===!1||!o.defaultPrevented)return e?.(o)}}function $c(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Yh(...t){return e=>{let n=!1;const r=t.map(o=>{const s=$c(o,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():$c(t[o],null)}}}}function at(...t){return p.useCallback(Yh(...t),t)}function Gb(t,e){const n=p.createContext(e),r=s=>{const{children:i,...a}=s,l=p.useMemo(()=>a,Object.values(a));return f.jsx(n.Provider,{value:l,children:i})};r.displayName=t+"Provider";function o(s){const i=p.useContext(n);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[r,o]}function fl(t,e=[]){let n=[];function r(s,i){const a=p.createContext(i),l=n.length;n=[...n,i];const c=d=>{const{scope:h,children:m,...g}=d,y=h?.[t]?.[l]||a,v=p.useMemo(()=>g,Object.values(g));return f.jsx(y.Provider,{value:v,children:m})};c.displayName=s+"Provider";function u(d,h){const m=h?.[t]?.[l]||a,g=p.useContext(m);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=n.map(i=>p.createContext(i));return function(a){const l=a?.[t]||s;return p.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[r,qb(o,...e)]}function qb(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return p.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}var As=Yg();const Zh=It(As);var Rs=p.forwardRef((t,e)=>{const{children:n,...r}=t,o=p.Children.toArray(n),s=o.find(Kb);if(s){const i=s.props.children,a=o.map(l=>l===s?p.Children.count(i)>1?p.Children.only(null):p.isValidElement(i)?i.props.children:null:l);return f.jsx(pa,{...r,ref:e,children:p.isValidElement(i)?p.cloneElement(i,void 0,a):null})}return f.jsx(pa,{...r,ref:e,children:n})});Rs.displayName="Slot";var pa=p.forwardRef((t,e)=>{const{children:n,...r}=t;if(p.isValidElement(n)){const o=Jb(n),s=Xb(r,n.props);return n.type!==p.Fragment&&(s.ref=e?Yh(e,o):o),p.cloneElement(n,s)}return p.Children.count(n)>1?p.Children.only(null):null});pa.displayName="SlotClone";var Vb=({children:t})=>f.jsx(f.Fragment,{children:t});function Kb(t){return p.isValidElement(t)&&t.type===Vb}function Xb(t,e){const n={...e};for(const r in e){const o=t[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{s(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...t,...n}}function Jb(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Yb=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],we=Yb.reduce((t,e)=>{const n=p.forwardRef((r,o)=>{const{asChild:s,...i}=r,a=s?Rs:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),f.jsx(a,{...i,ref:o})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function Zb(t,e){t&&As.flushSync(()=>t.dispatchEvent(e))}function Kt(t){const e=p.useRef(t);return p.useEffect(()=>{e.current=t}),p.useMemo(()=>(...n)=>e.current?.(...n),[])}function Qb(t,e=globalThis?.document){const n=Kt(t);p.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var ew="DismissableLayer",ma="dismissableLayer.update",tw="dismissableLayer.pointerDownOutside",nw="dismissableLayer.focusOutside",Nc,Qh=p.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),pl=p.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=p.useContext(Qh),[u,d]=p.useState(null),h=u?.ownerDocument??globalThis?.document,[,m]=p.useState({}),g=at(e,S=>d(S)),y=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),b=y.indexOf(v),_=u?y.indexOf(u):-1,w=c.layersWithOutsidePointerEventsDisabled.size>0,x=_>=b,C=sw(S=>{const N=S.target,H=[...c.branches].some(L=>L.contains(N));!x||H||(o?.(S),i?.(S),S.defaultPrevented||a?.())},h),k=iw(S=>{const N=S.target;[...c.branches].some(L=>L.contains(N))||(s?.(S),i?.(S),S.defaultPrevented||a?.())},h);return Qb(S=>{_===c.layers.size-1&&(r?.(S),!S.defaultPrevented&&a&&(S.preventDefault(),a()))},h),p.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Nc=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),zc(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=Nc)}},[u,h,n,c]),p.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),zc())},[u,c]),p.useEffect(()=>{const S=()=>m({});return document.addEventListener(ma,S),()=>document.removeEventListener(ma,S)},[]),f.jsx(we.div,{...l,ref:g,style:{pointerEvents:w?x?"auto":"none":void 0,...t.style},onFocusCapture:Ke(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Ke(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Ke(t.onPointerDownCapture,C.onPointerDownCapture)})});pl.displayName=ew;var rw="DismissableLayerBranch",ow=p.forwardRef((t,e)=>{const n=p.useContext(Qh),r=p.useRef(null),o=at(e,r);return p.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),f.jsx(we.div,{...t,ref:o})});ow.displayName=rw;function sw(t,e=globalThis?.document){const n=Kt(t),r=p.useRef(!1),o=p.useRef(()=>{});return p.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){ef(tw,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function iw(t,e=globalThis?.document){const n=Kt(t),r=p.useRef(!1);return p.useEffect(()=>{const o=s=>{s.target&&!r.current&&ef(nw,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function zc(){const t=new CustomEvent(ma);document.dispatchEvent(t)}function ef(t,e,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?Zb(o,s):o.dispatchEvent(s)}var pi=0;function tf(){p.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Dc()),document.body.insertAdjacentElement("beforeend",t[1]??Dc()),pi++,()=>{pi===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),pi--}},[])}function Dc(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var mi="focusScope.autoFocusOnMount",gi="focusScope.autoFocusOnUnmount",Mc={bubbles:!1,cancelable:!0},aw="FocusScope",ml=p.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=t,[a,l]=p.useState(null),c=Kt(o),u=Kt(s),d=p.useRef(null),h=at(e,y=>l(y)),m=p.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;p.useEffect(()=>{if(r){let y=function(w){if(m.paused||!a)return;const x=w.target;a.contains(x)?d.current=x:Mt(d.current,{select:!0})},v=function(w){if(m.paused||!a)return;const x=w.relatedTarget;x!==null&&(a.contains(x)||Mt(d.current,{select:!0}))},b=function(w){if(document.activeElement===document.body)for(const C of w)C.removedNodes.length>0&&Mt(a)};document.addEventListener("focusin",y),document.addEventListener("focusout",v);const _=new MutationObserver(b);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",v),_.disconnect()}}},[r,a,m.paused]),p.useEffect(()=>{if(a){Bc.add(m);const y=document.activeElement;if(!a.contains(y)){const b=new CustomEvent(mi,Mc);a.addEventListener(mi,c),a.dispatchEvent(b),b.defaultPrevented||(lw(fw(nf(a)),{select:!0}),document.activeElement===y&&Mt(a))}return()=>{a.removeEventListener(mi,c),setTimeout(()=>{const b=new CustomEvent(gi,Mc);a.addEventListener(gi,u),a.dispatchEvent(b),b.defaultPrevented||Mt(y??document.body,{select:!0}),a.removeEventListener(gi,u),Bc.remove(m)},0)}}},[a,c,u,m]);const g=p.useCallback(y=>{if(!n&&!r||m.paused)return;const v=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,b=document.activeElement;if(v&&b){const _=y.currentTarget,[w,x]=cw(_);w&&x?!y.shiftKey&&b===x?(y.preventDefault(),n&&Mt(w,{select:!0})):y.shiftKey&&b===w&&(y.preventDefault(),n&&Mt(x,{select:!0})):b===_&&y.preventDefault()}},[n,r,m.paused]);return f.jsx(we.div,{tabIndex:-1,...i,ref:h,onKeyDown:g})});ml.displayName=aw;function lw(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(Mt(r,{select:e}),document.activeElement!==n)return}function cw(t){const e=nf(t),n=Lc(e,t),r=Lc(e.reverse(),t);return[n,r]}function nf(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Lc(t,e){for(const n of t)if(!uw(n,{upTo:e}))return n}function uw(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function dw(t){return t instanceof HTMLInputElement&&"select"in t}function Mt(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&dw(t)&&e&&t.select()}}var Bc=hw();function hw(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=Fc(t,e),t.unshift(e)},remove(e){t=Fc(t,e),t[0]?.resume()}}}function Fc(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function fw(t){return t.filter(e=>e.tagName!=="A")}var bn=globalThis?.document?p.useLayoutEffect:()=>{},pw=ks.useId||(()=>{}),mw=0;function pt(t){const[e,n]=p.useState(pw());return bn(()=>{n(r=>r??String(mw++))},[t]),t||(e?`radix-${e}`:"")}const gw=["top","right","bottom","left"],Xt=Math.min,Ve=Math.max,ps=Math.round,jo=Math.floor,mt=t=>({x:t,y:t}),yw={left:"right",right:"left",bottom:"top",top:"bottom"},vw={start:"end",end:"start"};function ga(t,e,n){return Ve(t,Xt(e,n))}function At(t,e){return typeof t=="function"?t(e):t}function Rt(t){return t.split("-")[0]}function Pr(t){return t.split("-")[1]}function gl(t){return t==="x"?"y":"x"}function yl(t){return t==="y"?"height":"width"}function Jt(t){return["top","bottom"].includes(Rt(t))?"y":"x"}function vl(t){return gl(Jt(t))}function bw(t,e,n){n===void 0&&(n=!1);const r=Pr(t),o=vl(t),s=yl(o);let i=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(i=ms(i)),[i,ms(i)]}function ww(t){const e=ms(t);return[ya(t),e,ya(e)]}function ya(t){return t.replace(/start|end/g,e=>vw[e])}function xw(t,e,n){const r=["left","right"],o=["right","left"],s=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return n?e?o:r:e?r:o;case"left":case"right":return e?s:i;default:return[]}}function _w(t,e,n,r){const o=Pr(t);let s=xw(Rt(t),n==="start",r);return o&&(s=s.map(i=>i+"-"+o),e&&(s=s.concat(s.map(ya)))),s}function ms(t){return t.replace(/left|right|bottom|top/g,e=>yw[e])}function Sw(t){return{top:0,right:0,bottom:0,left:0,...t}}function rf(t){return typeof t!="number"?Sw(t):{top:t,right:t,bottom:t,left:t}}function gs(t){const{x:e,y:n,width:r,height:o}=t;return{width:r,height:o,top:n,left:e,right:e+r,bottom:n+o,x:e,y:n}}function Uc(t,e,n){let{reference:r,floating:o}=t;const s=Jt(e),i=vl(e),a=yl(i),l=Rt(e),c=s==="y",u=r.x+r.width/2-o.width/2,d=r.y+r.height/2-o.height/2,h=r[a]/2-o[a]/2;let m;switch(l){case"top":m={x:u,y:r.y-o.height};break;case"bottom":m={x:u,y:r.y+r.height};break;case"right":m={x:r.x+r.width,y:d};break;case"left":m={x:r.x-o.width,y:d};break;default:m={x:r.x,y:r.y}}switch(Pr(e)){case"start":m[i]-=h*(n&&c?-1:1);break;case"end":m[i]+=h*(n&&c?-1:1);break}return m}const Cw=async(t,e,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:s=[],platform:i}=n,a=s.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:o}),{x:u,y:d}=Uc(c,r,l),h=r,m={},g=0;for(let y=0;y<a.length;y++){const{name:v,fn:b}=a[y],{x:_,y:w,data:x,reset:C}=await b({x:u,y:d,initialPlacement:r,placement:h,strategy:o,middlewareData:m,rects:c,platform:i,elements:{reference:t,floating:e}});u=_??u,d=w??d,m={...m,[v]:{...m[v],...x}},C&&g<=50&&(g++,typeof C=="object"&&(C.placement&&(h=C.placement),C.rects&&(c=C.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:o}):C.rects),{x:u,y:d}=Uc(c,h,l)),y=-1)}return{x:u,y:d,placement:h,strategy:o,middlewareData:m}};async function no(t,e){var n;e===void 0&&(e={});const{x:r,y:o,platform:s,rects:i,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:m=0}=At(e,t),g=rf(m),v=a[h?d==="floating"?"reference":"floating":d],b=gs(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(v)))==null||n?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),_=d==="floating"?{x:r,y:o,width:i.floating.width,height:i.floating.height}:i.reference,w=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),x=await(s.isElement==null?void 0:s.isElement(w))?await(s.getScale==null?void 0:s.getScale(w))||{x:1,y:1}:{x:1,y:1},C=gs(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:w,strategy:l}):_);return{top:(b.top-C.top+g.top)/x.y,bottom:(C.bottom-b.bottom+g.bottom)/x.y,left:(b.left-C.left+g.left)/x.x,right:(C.right-b.right+g.right)/x.x}}const kw=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:o,rects:s,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=At(t,e)||{};if(c==null)return{};const d=rf(u),h={x:n,y:r},m=vl(o),g=yl(m),y=await i.getDimensions(c),v=m==="y",b=v?"top":"left",_=v?"bottom":"right",w=v?"clientHeight":"clientWidth",x=s.reference[g]+s.reference[m]-h[m]-s.floating[g],C=h[m]-s.reference[m],k=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let S=k?k[w]:0;(!S||!await(i.isElement==null?void 0:i.isElement(k)))&&(S=a.floating[w]||s.floating[g]);const N=x/2-C/2,H=S/2-y[g]/2-1,L=Xt(d[b],H),V=Xt(d[_],H),O=L,ee=S-y[g]-V,M=S/2-y[g]/2+N,K=ga(O,M,ee),X=!l.arrow&&Pr(o)!=null&&M!==K&&s.reference[g]/2-(M<O?L:V)-y[g]/2<0,Z=X?M<O?M-O:M-ee:0;return{[m]:h[m]+Z,data:{[m]:K,centerOffset:M-K-Z,...X&&{alignmentOffset:Z}},reset:X}}}),Ew=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:y=!0,...v}=At(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const b=Rt(o),_=Jt(a),w=Rt(a)===a,x=await(l.isRTL==null?void 0:l.isRTL(c.floating)),C=h||(w||!y?[ms(a)]:ww(a)),k=g!=="none";!h&&k&&C.push(..._w(a,y,g,x));const S=[a,...C],N=await no(e,v),H=[];let L=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&H.push(N[b]),d){const M=bw(o,i,x);H.push(N[M[0]],N[M[1]])}if(L=[...L,{placement:o,overflows:H}],!H.every(M=>M<=0)){var V,O;const M=(((V=s.flip)==null?void 0:V.index)||0)+1,K=S[M];if(K)return{data:{index:M,overflows:L},reset:{placement:K}};let X=(O=L.filter(Z=>Z.overflows[0]<=0).sort((Z,F)=>Z.overflows[1]-F.overflows[1])[0])==null?void 0:O.placement;if(!X)switch(m){case"bestFit":{var ee;const Z=(ee=L.filter(F=>{if(k){const ie=Jt(F.placement);return ie===_||ie==="y"}return!0}).map(F=>[F.placement,F.overflows.filter(ie=>ie>0).reduce((ie,ve)=>ie+ve,0)]).sort((F,ie)=>F[1]-ie[1])[0])==null?void 0:ee[0];Z&&(X=Z);break}case"initialPlacement":X=a;break}if(o!==X)return{reset:{placement:X}}}return{}}}};function Hc(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Wc(t){return gw.some(e=>t[e]>=0)}const Pw=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...o}=At(t,e);switch(r){case"referenceHidden":{const s=await no(e,{...o,elementContext:"reference"}),i=Hc(s,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:Wc(i)}}}case"escaped":{const s=await no(e,{...o,altBoundary:!0}),i=Hc(s,n.floating);return{data:{escapedOffsets:i,escaped:Wc(i)}}}default:return{}}}}};async function Tw(t,e){const{placement:n,platform:r,elements:o}=t,s=await(r.isRTL==null?void 0:r.isRTL(o.floating)),i=Rt(n),a=Pr(n),l=Jt(n)==="y",c=["left","top"].includes(i)?-1:1,u=s&&l?-1:1,d=At(e,t);let{mainAxis:h,crossAxis:m,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(m=a==="end"?g*-1:g),l?{x:m*u,y:h*c}:{x:h*c,y:m*u}}const Aw=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:o,y:s,placement:i,middlewareData:a}=e,l=await Tw(e,t);return i===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:o+l.x,y:s+l.y,data:{...l,placement:i}}}}},Rw=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:o}=e,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:v=>{let{x:b,y:_}=v;return{x:b,y:_}}},...l}=At(t,e),c={x:n,y:r},u=await no(e,l),d=Jt(Rt(o)),h=gl(d);let m=c[h],g=c[d];if(s){const v=h==="y"?"top":"left",b=h==="y"?"bottom":"right",_=m+u[v],w=m-u[b];m=ga(_,m,w)}if(i){const v=d==="y"?"top":"left",b=d==="y"?"bottom":"right",_=g+u[v],w=g-u[b];g=ga(_,g,w)}const y=a.fn({...e,[h]:m,[d]:g});return{...y,data:{x:y.x-n,y:y.y-r,enabled:{[h]:s,[d]:i}}}}}},Iw=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:o,rects:s,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=At(t,e),u={x:n,y:r},d=Jt(o),h=gl(d);let m=u[h],g=u[d];const y=At(a,e),v=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(l){const w=h==="y"?"height":"width",x=s.reference[h]-s.floating[w]+v.mainAxis,C=s.reference[h]+s.reference[w]-v.mainAxis;m<x?m=x:m>C&&(m=C)}if(c){var b,_;const w=h==="y"?"width":"height",x=["top","left"].includes(Rt(o)),C=s.reference[d]-s.floating[w]+(x&&((b=i.offset)==null?void 0:b[d])||0)+(x?0:v.crossAxis),k=s.reference[d]+s.reference[w]+(x?0:((_=i.offset)==null?void 0:_[d])||0)-(x?v.crossAxis:0);g<C?g=C:g>k&&(g=k)}return{[h]:m,[d]:g}}}},Ow=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:o,rects:s,platform:i,elements:a}=e,{apply:l=()=>{},...c}=At(t,e),u=await no(e,c),d=Rt(o),h=Pr(o),m=Jt(o)==="y",{width:g,height:y}=s.floating;let v,b;d==="top"||d==="bottom"?(v=d,b=h===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(b=d,v=h==="end"?"top":"bottom");const _=y-u.top-u.bottom,w=g-u.left-u.right,x=Xt(y-u[v],_),C=Xt(g-u[b],w),k=!e.middlewareData.shift;let S=x,N=C;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(N=w),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(S=_),k&&!h){const L=Ve(u.left,0),V=Ve(u.right,0),O=Ve(u.top,0),ee=Ve(u.bottom,0);m?N=g-2*(L!==0||V!==0?L+V:Ve(u.left,u.right)):S=y-2*(O!==0||ee!==0?O+ee:Ve(u.top,u.bottom))}await l({...e,availableWidth:N,availableHeight:S});const H=await i.getDimensions(a.floating);return g!==H.width||y!==H.height?{reset:{rects:!0}}:{}}}};function Is(){return typeof window<"u"}function Tr(t){return of(t)?(t.nodeName||"").toLowerCase():"#document"}function Xe(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function wt(t){var e;return(e=(of(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function of(t){return Is()?t instanceof Node||t instanceof Xe(t).Node:!1}function st(t){return Is()?t instanceof Element||t instanceof Xe(t).Element:!1}function gt(t){return Is()?t instanceof HTMLElement||t instanceof Xe(t).HTMLElement:!1}function Gc(t){return!Is()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Xe(t).ShadowRoot}function po(t){const{overflow:e,overflowX:n,overflowY:r,display:o}=it(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(o)}function jw(t){return["table","td","th"].includes(Tr(t))}function Os(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function bl(t){const e=wl(),n=st(t)?it(t):t;return["transform","translate","scale","rotate","perspective"].some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function $w(t){let e=Yt(t);for(;gt(e)&&!mr(e);){if(bl(e))return e;if(Os(e))return null;e=Yt(e)}return null}function wl(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function mr(t){return["html","body","#document"].includes(Tr(t))}function it(t){return Xe(t).getComputedStyle(t)}function js(t){return st(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Yt(t){if(Tr(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Gc(t)&&t.host||wt(t);return Gc(e)?e.host:e}function sf(t){const e=Yt(t);return mr(e)?t.ownerDocument?t.ownerDocument.body:t.body:gt(e)&&po(e)?e:sf(e)}function ro(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const o=sf(t),s=o===((r=t.ownerDocument)==null?void 0:r.body),i=Xe(o);if(s){const a=va(i);return e.concat(i,i.visualViewport||[],po(o)?o:[],a&&n?ro(a):[])}return e.concat(o,ro(o,[],n))}function va(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function af(t){const e=it(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=gt(t),s=o?t.offsetWidth:n,i=o?t.offsetHeight:r,a=ps(n)!==s||ps(r)!==i;return a&&(n=s,r=i),{width:n,height:r,$:a}}function xl(t){return st(t)?t:t.contextElement}function lr(t){const e=xl(t);if(!gt(e))return mt(1);const n=e.getBoundingClientRect(),{width:r,height:o,$:s}=af(e);let i=(s?ps(n.width):n.width)/r,a=(s?ps(n.height):n.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const Nw=mt(0);function lf(t){const e=Xe(t);return!wl()||!e.visualViewport?Nw:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function zw(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Xe(t)?!1:e}function wn(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const o=t.getBoundingClientRect(),s=xl(t);let i=mt(1);e&&(r?st(r)&&(i=lr(r)):i=lr(t));const a=zw(s,n,r)?lf(s):mt(0);let l=(o.left+a.x)/i.x,c=(o.top+a.y)/i.y,u=o.width/i.x,d=o.height/i.y;if(s){const h=Xe(s),m=r&&st(r)?Xe(r):r;let g=h,y=va(g);for(;y&&r&&m!==g;){const v=lr(y),b=y.getBoundingClientRect(),_=it(y),w=b.left+(y.clientLeft+parseFloat(_.paddingLeft))*v.x,x=b.top+(y.clientTop+parseFloat(_.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,d*=v.y,l+=w,c+=x,g=Xe(y),y=va(g)}}return gs({width:u,height:d,x:l,y:c})}function _l(t,e){const n=js(t).scrollLeft;return e?e.left+n:wn(wt(t)).left+n}function cf(t,e,n){n===void 0&&(n=!1);const r=t.getBoundingClientRect(),o=r.left+e.scrollLeft-(n?0:_l(t,r)),s=r.top+e.scrollTop;return{x:o,y:s}}function Dw(t){let{elements:e,rect:n,offsetParent:r,strategy:o}=t;const s=o==="fixed",i=wt(r),a=e?Os(e.floating):!1;if(r===i||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=mt(1);const u=mt(0),d=gt(r);if((d||!d&&!s)&&((Tr(r)!=="body"||po(i))&&(l=js(r)),gt(r))){const m=wn(r);c=lr(r),u.x=m.x+r.clientLeft,u.y=m.y+r.clientTop}const h=i&&!d&&!s?cf(i,l,!0):mt(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:n.y*c.y-l.scrollTop*c.y+u.y+h.y}}function Mw(t){return Array.from(t.getClientRects())}function Lw(t){const e=wt(t),n=js(t),r=t.ownerDocument.body,o=Ve(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Ve(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let i=-n.scrollLeft+_l(t);const a=-n.scrollTop;return it(r).direction==="rtl"&&(i+=Ve(e.clientWidth,r.clientWidth)-o),{width:o,height:s,x:i,y:a}}function Bw(t,e){const n=Xe(t),r=wt(t),o=n.visualViewport;let s=r.clientWidth,i=r.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;const c=wl();(!c||c&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:s,height:i,x:a,y:l}}function Fw(t,e){const n=wn(t,!0,e==="fixed"),r=n.top+t.clientTop,o=n.left+t.clientLeft,s=gt(t)?lr(t):mt(1),i=t.clientWidth*s.x,a=t.clientHeight*s.y,l=o*s.x,c=r*s.y;return{width:i,height:a,x:l,y:c}}function qc(t,e,n){let r;if(e==="viewport")r=Bw(t,n);else if(e==="document")r=Lw(wt(t));else if(st(e))r=Fw(e,n);else{const o=lf(t);r={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return gs(r)}function uf(t,e){const n=Yt(t);return n===e||!st(n)||mr(n)?!1:it(n).position==="fixed"||uf(n,e)}function Uw(t,e){const n=e.get(t);if(n)return n;let r=ro(t,[],!1).filter(a=>st(a)&&Tr(a)!=="body"),o=null;const s=it(t).position==="fixed";let i=s?Yt(t):t;for(;st(i)&&!mr(i);){const a=it(i),l=bl(i);!l&&a.position==="fixed"&&(o=null),(s?!l&&!o:!l&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||po(i)&&!l&&uf(t,i))?r=r.filter(u=>u!==i):o=a,i=Yt(i)}return e.set(t,r),r}function Hw(t){let{element:e,boundary:n,rootBoundary:r,strategy:o}=t;const i=[...n==="clippingAncestors"?Os(e)?[]:Uw(e,this._c):[].concat(n),r],a=i[0],l=i.reduce((c,u)=>{const d=qc(e,u,o);return c.top=Ve(d.top,c.top),c.right=Xt(d.right,c.right),c.bottom=Xt(d.bottom,c.bottom),c.left=Ve(d.left,c.left),c},qc(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Ww(t){const{width:e,height:n}=af(t);return{width:e,height:n}}function Gw(t,e,n){const r=gt(e),o=wt(e),s=n==="fixed",i=wn(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=mt(0);if(r||!r&&!s)if((Tr(e)!=="body"||po(o))&&(a=js(e)),r){const h=wn(e,!0,s,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else o&&(l.x=_l(o));const c=o&&!r&&!s?cf(o,a):mt(0),u=i.left+a.scrollLeft-l.x-c.x,d=i.top+a.scrollTop-l.y-c.y;return{x:u,y:d,width:i.width,height:i.height}}function yi(t){return it(t).position==="static"}function Vc(t,e){if(!gt(t)||it(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return wt(t)===n&&(n=n.ownerDocument.body),n}function df(t,e){const n=Xe(t);if(Os(t))return n;if(!gt(t)){let o=Yt(t);for(;o&&!mr(o);){if(st(o)&&!yi(o))return o;o=Yt(o)}return n}let r=Vc(t,e);for(;r&&jw(r)&&yi(r);)r=Vc(r,e);return r&&mr(r)&&yi(r)&&!bl(r)?n:r||$w(t)||n}const qw=async function(t){const e=this.getOffsetParent||df,n=this.getDimensions,r=await n(t.floating);return{reference:Gw(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Vw(t){return it(t).direction==="rtl"}const Kw={convertOffsetParentRelativeRectToViewportRelativeRect:Dw,getDocumentElement:wt,getClippingRect:Hw,getOffsetParent:df,getElementRects:qw,getClientRects:Mw,getDimensions:Ww,getScale:lr,isElement:st,isRTL:Vw};function hf(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Xw(t,e){let n=null,r;const o=wt(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:h,height:m}=c;if(a||e(),!h||!m)return;const g=jo(d),y=jo(o.clientWidth-(u+h)),v=jo(o.clientHeight-(d+m)),b=jo(u),w={rootMargin:-g+"px "+-y+"px "+-v+"px "+-b+"px",threshold:Ve(0,Xt(1,l))||1};let x=!0;function C(k){const S=k[0].intersectionRatio;if(S!==l){if(!x)return i();S?i(!1,S):r=setTimeout(()=>{i(!1,1e-7)},1e3)}S===1&&!hf(c,t.getBoundingClientRect())&&i(),x=!1}try{n=new IntersectionObserver(C,{...w,root:o.ownerDocument})}catch{n=new IntersectionObserver(C,w)}n.observe(t)}return i(!0),s}function ff(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=xl(t),u=o||s?[...c?ro(c):[],...ro(e)]:[];u.forEach(b=>{o&&b.addEventListener("scroll",n,{passive:!0}),s&&b.addEventListener("resize",n)});const d=c&&a?Xw(c,n):null;let h=-1,m=null;i&&(m=new ResizeObserver(b=>{let[_]=b;_&&_.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var w;(w=m)==null||w.observe(e)})),n()}),c&&!l&&m.observe(c),m.observe(e));let g,y=l?wn(t):null;l&&v();function v(){const b=wn(t);y&&!hf(y,b)&&n(),y=b,g=requestAnimationFrame(v)}return n(),()=>{var b;u.forEach(_=>{o&&_.removeEventListener("scroll",n),s&&_.removeEventListener("resize",n)}),d?.(),(b=m)==null||b.disconnect(),m=null,l&&cancelAnimationFrame(g)}}const Jw=Aw,Yw=Rw,Zw=Ew,Qw=Ow,ex=Pw,Kc=kw,tx=Iw,nx=(t,e,n)=>{const r=new Map,o={platform:Kw,...n},s={...o.platform,_c:r};return Cw(t,e,{...o,platform:s})};var Qo=typeof document<"u"?p.useLayoutEffect:p.useEffect;function ys(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!ys(t[r],e[r]))return!1;return!0}if(o=Object.keys(t),n=o.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,o[r]))return!1;for(r=n;r--!==0;){const s=o[r];if(!(s==="_owner"&&t.$$typeof)&&!ys(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function pf(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Xc(t,e){const n=pf(t);return Math.round(e*n)/n}function vi(t){const e=p.useRef(t);return Qo(()=>{e.current=t}),e}function mf(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=p.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[h,m]=p.useState(r);ys(h,r)||m(r);const[g,y]=p.useState(null),[v,b]=p.useState(null),_=p.useCallback(F=>{F!==k.current&&(k.current=F,y(F))},[]),w=p.useCallback(F=>{F!==S.current&&(S.current=F,b(F))},[]),x=s||g,C=i||v,k=p.useRef(null),S=p.useRef(null),N=p.useRef(u),H=l!=null,L=vi(l),V=vi(o),O=vi(c),ee=p.useCallback(()=>{if(!k.current||!S.current)return;const F={placement:e,strategy:n,middleware:h};V.current&&(F.platform=V.current),nx(k.current,S.current,F).then(ie=>{const ve={...ie,isPositioned:O.current!==!1};M.current&&!ys(N.current,ve)&&(N.current=ve,As.flushSync(()=>{d(ve)}))})},[h,e,n,V,O]);Qo(()=>{c===!1&&N.current.isPositioned&&(N.current.isPositioned=!1,d(F=>({...F,isPositioned:!1})))},[c]);const M=p.useRef(!1);Qo(()=>(M.current=!0,()=>{M.current=!1}),[]),Qo(()=>{if(x&&(k.current=x),C&&(S.current=C),x&&C){if(L.current)return L.current(x,C,ee);ee()}},[x,C,ee,L,H]);const K=p.useMemo(()=>({reference:k,floating:S,setReference:_,setFloating:w}),[_,w]),X=p.useMemo(()=>({reference:x,floating:C}),[x,C]),Z=p.useMemo(()=>{const F={position:n,left:0,top:0};if(!X.floating)return F;const ie=Xc(X.floating,u.x),ve=Xc(X.floating,u.y);return a?{...F,transform:"translate("+ie+"px, "+ve+"px)",...pf(X.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:ie,top:ve}},[n,a,X.floating,u.x,u.y]);return p.useMemo(()=>({...u,update:ee,refs:K,elements:X,floatingStyles:Z}),[u,ee,K,X,Z])}const rx=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:o}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?Kc({element:r.current,padding:o}).fn(n):{}:r?Kc({element:r,padding:o}).fn(n):{}}}},gf=(t,e)=>({...Jw(t),options:[t,e]}),yf=(t,e)=>({...Yw(t),options:[t,e]}),vf=(t,e)=>({...tx(t),options:[t,e]}),bf=(t,e)=>({...Zw(t),options:[t,e]}),wf=(t,e)=>({...Qw(t),options:[t,e]}),xf=(t,e)=>({...ex(t),options:[t,e]}),_f=(t,e)=>({...rx(t),options:[t,e]});var ox="Arrow",Sf=p.forwardRef((t,e)=>{const{children:n,width:r=10,height:o=5,...s}=t;return f.jsx(we.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:f.jsx("polygon",{points:"0,0 30,0 15,10"})})});Sf.displayName=ox;var sx=Sf;function ix(t){const[e,n]=p.useState(void 0);return bn(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var Sl="Popper",[Cf,kf]=fl(Sl),[ax,Ef]=Cf(Sl),Pf=t=>{const{__scopePopper:e,children:n}=t,[r,o]=p.useState(null);return f.jsx(ax,{scope:e,anchor:r,onAnchorChange:o,children:n})};Pf.displayName=Sl;var Tf="PopperAnchor",Af=p.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,s=Ef(Tf,n),i=p.useRef(null),a=at(e,i);return p.useEffect(()=>{s.onAnchorChange(r?.current||i.current)}),r?null:f.jsx(we.div,{...o,ref:a})});Af.displayName=Tf;var Cl="PopperContent",[lx,cx]=Cf(Cl),Rf=p.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:m="optimized",onPlaced:g,...y}=t,v=Ef(Cl,n),[b,_]=p.useState(null),w=at(e,A=>_(A)),[x,C]=p.useState(null),k=ix(x),S=k?.width??0,N=k?.height??0,H=r+(s!=="center"?"-"+s:""),L=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},V=Array.isArray(c)?c:[c],O=V.length>0,ee={padding:L,boundary:V.filter(dx),altBoundary:O},{refs:M,floatingStyles:K,placement:X,isPositioned:Z,middlewareData:F}=mf({strategy:"fixed",placement:H,whileElementsMounted:(...A)=>ff(...A,{animationFrame:m==="always"}),elements:{reference:v.anchor},middleware:[gf({mainAxis:o+N,alignmentAxis:i}),l&&yf({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?vf():void 0,...ee}),l&&bf({...ee}),wf({...ee,apply:({elements:A,rects:z,availableWidth:re,availableHeight:le})=>{const{width:Ne,height:ze}=z.reference,ae=A.floating.style;ae.setProperty("--radix-popper-available-width",`${re}px`),ae.setProperty("--radix-popper-available-height",`${le}px`),ae.setProperty("--radix-popper-anchor-width",`${Ne}px`),ae.setProperty("--radix-popper-anchor-height",`${ze}px`)}}),x&&_f({element:x,padding:a}),hx({arrowWidth:S,arrowHeight:N}),h&&xf({strategy:"referenceHidden",...ee})]}),[ie,ve]=jf(X),pe=Kt(g);bn(()=>{Z&&pe?.()},[Z,pe]);const P=F.arrow?.x,E=F.arrow?.y,R=F.arrow?.centerOffset!==0,[T,I]=p.useState();return bn(()=>{b&&I(window.getComputedStyle(b).zIndex)},[b]),f.jsx("div",{ref:M.setFloating,"data-radix-popper-content-wrapper":"",style:{...K,transform:Z?K.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:T,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:f.jsx(lx,{scope:n,placedSide:ie,onArrowChange:C,arrowX:P,arrowY:E,shouldHideArrow:R,children:f.jsx(we.div,{"data-side":ie,"data-align":ve,...y,ref:w,style:{...y.style,animation:Z?void 0:"none"}})})})});Rf.displayName=Cl;var If="PopperArrow",ux={top:"bottom",right:"left",bottom:"top",left:"right"},Of=p.forwardRef(function(e,n){const{__scopePopper:r,...o}=e,s=cx(If,r),i=ux[s.placedSide];return f.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:f.jsx(sx,{...o,ref:n,style:{...o.style,display:"block"}})})});Of.displayName=If;function dx(t){return t!==null}var hx=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=jf(n),d={start:"0%",center:"50%",end:"100%"}[u],h=(o.arrow?.x??0)+a/2,m=(o.arrow?.y??0)+l/2;let g="",y="";return c==="bottom"?(g=i?d:`${h}px`,y=`${-l}px`):c==="top"?(g=i?d:`${h}px`,y=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,y=i?d:`${m}px`):c==="left"&&(g=`${r.floating.width+l}px`,y=i?d:`${m}px`),{data:{x:g,y}}}});function jf(t){const[e,n="center"]=t.split("-");return[e,n]}var fx=Pf,$f=Af,px=Rf,mx=Of,gx="Portal",Nf=p.forwardRef((t,e)=>{const{container:n,...r}=t,[o,s]=p.useState(!1);bn(()=>s(!0),[]);const i=n||o&&globalThis?.document?.body;return i?Zh.createPortal(f.jsx(we.div,{...r,ref:e}),i):null});Nf.displayName=gx;function yx(t,e){return p.useReducer((n,r)=>e[n][r]??n,t)}var mo=t=>{const{present:e,children:n}=t,r=vx(e),o=typeof n=="function"?n({present:r.isPresent}):p.Children.only(n),s=at(r.ref,bx(o));return typeof n=="function"||r.isPresent?p.cloneElement(o,{ref:s}):null};mo.displayName="Presence";function vx(t){const[e,n]=p.useState(),r=p.useRef({}),o=p.useRef(t),s=p.useRef("none"),i=t?"mounted":"unmounted",[a,l]=yx(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return p.useEffect(()=>{const c=$o(r.current);s.current=a==="mounted"?c:"none"},[a]),bn(()=>{const c=r.current,u=o.current;if(u!==t){const h=s.current,m=$o(c);t?l("MOUNT"):m==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&h!==m?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),bn(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=m=>{const y=$o(r.current).includes(m.animationName);if(m.target===e&&y&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},h=m=>{m.target===e&&(s.current=$o(r.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:p.useCallback(c=>{c&&(r.current=getComputedStyle(c)),n(c)},[])}}function $o(t){return t?.animationName||"none"}function bx(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function zf({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,o]=wx({defaultProp:e,onChange:n}),s=t!==void 0,i=s?t:r,a=Kt(n),l=p.useCallback(c=>{if(s){const d=typeof c=="function"?c(t):c;d!==t&&a(d)}else o(c)},[s,t,o,a]);return[i,l]}function wx({defaultProp:t,onChange:e}){const n=p.useState(t),[r]=n,o=p.useRef(r),s=Kt(e);return p.useEffect(()=>{o.current!==r&&(s(r),o.current=r)},[r,o,s]),n}var xx=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},$n=new WeakMap,No=new WeakMap,zo={},bi=0,Df=function(t){return t&&(t.host||Df(t.parentNode))},_x=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=Df(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},Sx=function(t,e,n,r){var o=_x(e,Array.isArray(t)?t:[t]);zo[n]||(zo[n]=new WeakMap);var s=zo[n],i=[],a=new Set,l=new Set(o),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};o.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var m=h.getAttribute(r),g=m!==null&&m!=="false",y=($n.get(h)||0)+1,v=(s.get(h)||0)+1;$n.set(h,y),s.set(h,v),i.push(h),y===1&&g&&No.set(h,!0),v===1&&h.setAttribute(n,"true"),g||h.setAttribute(r,"true")}catch(b){console.error("aria-hidden: cannot operate on ",h,b)}})};return u(e),a.clear(),bi++,function(){i.forEach(function(d){var h=$n.get(d)-1,m=s.get(d)-1;$n.set(d,h),s.set(d,m),h||(No.has(d)||d.removeAttribute(r),No.delete(d)),m||d.removeAttribute(n)}),bi--,bi||($n=new WeakMap,$n=new WeakMap,No=new WeakMap,zo={})}},Mf=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),o=xx(t);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live]"))),Sx(r,o,n,"aria-hidden")):function(){return null}},dt=function(){return dt=Object.assign||function(e){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},dt.apply(this,arguments)};function Lf(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function Cx(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,s;r<o;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}var es="right-scroll-bar-position",ts="width-before-scroll-bar",kx="with-scroll-bars-hidden",Ex="--removed-body-scroll-bar-size";function wi(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function Px(t,e){var n=p.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var o=n.value;o!==r&&(n.value=r,n.callback(r,o))}}}})[0];return n.callback=e,n.facade}var Tx=typeof window<"u"?p.useLayoutEffect:p.useEffect,Jc=new WeakMap;function Ax(t,e){var n=Px(null,function(r){return t.forEach(function(o){return wi(o,r)})});return Tx(function(){var r=Jc.get(n);if(r){var o=new Set(r),s=new Set(t),i=n.current;o.forEach(function(a){s.has(a)||wi(a,null)}),s.forEach(function(a){o.has(a)||wi(a,i)})}Jc.set(n,t)},[t]),n}function Rx(t){return t}function Ix(t,e){e===void 0&&(e=Rx);var n=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var i=e(s,r);return n.push(i),function(){n=n.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(r=!0;n.length;){var i=n;n=[],i.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){r=!0;var i=[];if(n.length){var a=n;n=[],a.forEach(s),i=n}var l=function(){var u=i;i=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),n={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),n}}}};return o}function Ox(t){t===void 0&&(t={});var e=Ix(null);return e.options=dt({async:!0,ssr:!1},t),e}var Bf=function(t){var e=t.sideCar,n=Lf(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return p.createElement(r,dt({},n))};Bf.isSideCarExport=!0;function jx(t,e){return t.useMedium(e),Bf}var Ff=Ox(),xi=function(){},$s=p.forwardRef(function(t,e){var n=p.useRef(null),r=p.useState({onScrollCapture:xi,onWheelCapture:xi,onTouchMoveCapture:xi}),o=r[0],s=r[1],i=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,h=t.sideCar,m=t.noIsolation,g=t.inert,y=t.allowPinchZoom,v=t.as,b=v===void 0?"div":v,_=t.gapMode,w=Lf(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=h,C=Ax([n,e]),k=dt(dt({},w),o);return p.createElement(p.Fragment,null,u&&p.createElement(x,{sideCar:Ff,removeScrollBar:c,shards:d,noIsolation:m,inert:g,setCallbacks:s,allowPinchZoom:!!y,lockRef:n,gapMode:_}),i?p.cloneElement(p.Children.only(a),dt(dt({},k),{ref:C})):p.createElement(b,dt({},k,{className:l,ref:C}),a))});$s.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};$s.classNames={fullWidth:ts,zeroRight:es};var $x=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Nx(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=$x();return e&&t.setAttribute("nonce",e),t}function zx(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function Dx(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Mx=function(){var t=0,e=null;return{add:function(n){t==0&&(e=Nx())&&(zx(e,n),Dx(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Lx=function(){var t=Mx();return function(e,n){p.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},Uf=function(){var t=Lx(),e=function(n){var r=n.styles,o=n.dynamic;return t(r,o),null};return e},Bx={left:0,top:0,right:0,gap:0},_i=function(t){return parseInt(t||"",10)||0},Fx=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],o=e[t==="padding"?"paddingRight":"marginRight"];return[_i(n),_i(r),_i(o)]},Ux=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Bx;var e=Fx(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},Hx=Uf(),cr="data-scroll-locked",Wx=function(t,e,n,r){var o=t.left,s=t.top,i=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(kx,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(cr,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(es,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(ts,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(es," .").concat(es,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(ts," .").concat(ts,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(cr,`] {
    `).concat(Ex,": ").concat(a,`px;
  }
`)},Yc=function(){var t=parseInt(document.body.getAttribute(cr)||"0",10);return isFinite(t)?t:0},Gx=function(){p.useEffect(function(){return document.body.setAttribute(cr,(Yc()+1).toString()),function(){var t=Yc()-1;t<=0?document.body.removeAttribute(cr):document.body.setAttribute(cr,t.toString())}},[])},qx=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,o=r===void 0?"margin":r;Gx();var s=p.useMemo(function(){return Ux(o)},[o]);return p.createElement(Hx,{styles:Wx(s,!e,o,n?"":"!important")})},ba=!1;if(typeof window<"u")try{var Do=Object.defineProperty({},"passive",{get:function(){return ba=!0,!0}});window.addEventListener("test",Do,Do),window.removeEventListener("test",Do,Do)}catch{ba=!1}var Nn=ba?{passive:!1}:!1,Vx=function(t){return t.tagName==="TEXTAREA"},Hf=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!Vx(t)&&n[e]==="visible")},Kx=function(t){return Hf(t,"overflowY")},Xx=function(t){return Hf(t,"overflowX")},Zc=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=Wf(t,r);if(o){var s=Gf(t,r),i=s[1],a=s[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},Jx=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},Yx=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},Wf=function(t,e){return t==="v"?Kx(e):Xx(e)},Gf=function(t,e){return t==="v"?Jx(e):Yx(e)},Zx=function(t,e){return t==="h"&&e==="rtl"?-1:1},Qx=function(t,e,n,r,o){var s=Zx(t,window.getComputedStyle(e).direction),i=s*r,a=n.target,l=e.contains(a),c=!1,u=i>0,d=0,h=0;do{var m=Gf(t,a),g=m[0],y=m[1],v=m[2],b=y-v-s*g;(g||b)&&Wf(t,a)&&(d+=b,h+=g),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},Mo=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Qc=function(t){return[t.deltaX,t.deltaY]},eu=function(t){return t&&"current"in t?t.current:t},e0=function(t,e){return t[0]===e[0]&&t[1]===e[1]},t0=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},n0=0,zn=[];function r0(t){var e=p.useRef([]),n=p.useRef([0,0]),r=p.useRef(),o=p.useState(n0++)[0],s=p.useState(Uf)[0],i=p.useRef(t);p.useEffect(function(){i.current=t},[t]),p.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(o));var y=Cx([t.lockRef.current],(t.shards||[]).map(eu),!0).filter(Boolean);return y.forEach(function(v){return v.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),y.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(o))})}}},[t.inert,t.lockRef.current,t.shards]);var a=p.useCallback(function(y,v){if("touches"in y&&y.touches.length===2||y.type==="wheel"&&y.ctrlKey)return!i.current.allowPinchZoom;var b=Mo(y),_=n.current,w="deltaX"in y?y.deltaX:_[0]-b[0],x="deltaY"in y?y.deltaY:_[1]-b[1],C,k=y.target,S=Math.abs(w)>Math.abs(x)?"h":"v";if("touches"in y&&S==="h"&&k.type==="range")return!1;var N=Zc(S,k);if(!N)return!0;if(N?C=S:(C=S==="v"?"h":"v",N=Zc(S,k)),!N)return!1;if(!r.current&&"changedTouches"in y&&(w||x)&&(r.current=C),!C)return!0;var H=r.current||C;return Qx(H,v,y,H==="h"?w:x)},[]),l=p.useCallback(function(y){var v=y;if(!(!zn.length||zn[zn.length-1]!==s)){var b="deltaY"in v?Qc(v):Mo(v),_=e.current.filter(function(C){return C.name===v.type&&(C.target===v.target||v.target===C.shadowParent)&&e0(C.delta,b)})[0];if(_&&_.should){v.cancelable&&v.preventDefault();return}if(!_){var w=(i.current.shards||[]).map(eu).filter(Boolean).filter(function(C){return C.contains(v.target)}),x=w.length>0?a(v,w[0]):!i.current.noIsolation;x&&v.cancelable&&v.preventDefault()}}},[]),c=p.useCallback(function(y,v,b,_){var w={name:y,delta:v,target:b,should:_,shadowParent:o0(b)};e.current.push(w),setTimeout(function(){e.current=e.current.filter(function(x){return x!==w})},1)},[]),u=p.useCallback(function(y){n.current=Mo(y),r.current=void 0},[]),d=p.useCallback(function(y){c(y.type,Qc(y),y.target,a(y,t.lockRef.current))},[]),h=p.useCallback(function(y){c(y.type,Mo(y),y.target,a(y,t.lockRef.current))},[]);p.useEffect(function(){return zn.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Nn),document.addEventListener("touchmove",l,Nn),document.addEventListener("touchstart",u,Nn),function(){zn=zn.filter(function(y){return y!==s}),document.removeEventListener("wheel",l,Nn),document.removeEventListener("touchmove",l,Nn),document.removeEventListener("touchstart",u,Nn)}},[]);var m=t.removeScrollBar,g=t.inert;return p.createElement(p.Fragment,null,g?p.createElement(s,{styles:t0(o)}):null,m?p.createElement(qx,{gapMode:t.gapMode}):null)}function o0(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const s0=jx(Ff,r0);var kl=p.forwardRef(function(t,e){return p.createElement($s,dt({},t,{ref:e,sideCar:s0}))});kl.classNames=$s.classNames;var El="Popover",[qf,YR]=fl(El,[kf]),go=kf(),[i0,Rn]=qf(El),Vf=t=>{const{__scopePopover:e,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!1}=t,a=go(e),l=p.useRef(null),[c,u]=p.useState(!1),[d=!1,h]=zf({prop:r,defaultProp:o,onChange:s});return f.jsx(fx,{...a,children:f.jsx(i0,{scope:e,contentId:pt(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:p.useCallback(()=>h(m=>!m),[h]),hasCustomAnchor:c,onCustomAnchorAdd:p.useCallback(()=>u(!0),[]),onCustomAnchorRemove:p.useCallback(()=>u(!1),[]),modal:i,children:n})})};Vf.displayName=El;var Kf="PopoverAnchor",a0=p.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=Rn(Kf,n),s=go(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=o;return p.useEffect(()=>(i(),()=>a()),[i,a]),f.jsx($f,{...s,...r,ref:e})});a0.displayName=Kf;var Xf="PopoverTrigger",Jf=p.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=Rn(Xf,n),s=go(n),i=at(e,o.triggerRef),a=f.jsx(we.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":ep(o.open),...r,ref:i,onClick:Ke(t.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:f.jsx($f,{asChild:!0,...s,children:a})});Jf.displayName=Xf;var l0="PopoverPortal",[ZR,c0]=qf(l0,{forceMount:void 0}),gr="PopoverContent",Yf=p.forwardRef((t,e)=>{const n=c0(gr,t.__scopePopover),{forceMount:r=n.forceMount,...o}=t,s=Rn(gr,t.__scopePopover);return f.jsx(mo,{present:r||s.open,children:s.modal?f.jsx(u0,{...o,ref:e}):f.jsx(d0,{...o,ref:e})})});Yf.displayName=gr;var u0=p.forwardRef((t,e)=>{const n=Rn(gr,t.__scopePopover),r=p.useRef(null),o=at(e,r),s=p.useRef(!1);return p.useEffect(()=>{const i=r.current;if(i)return Mf(i)},[]),f.jsx(kl,{as:Rs,allowPinchZoom:!0,children:f.jsx(Zf,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ke(t.onCloseAutoFocus,i=>{i.preventDefault(),s.current||n.triggerRef.current?.focus()}),onPointerDownOutside:Ke(t.onPointerDownOutside,i=>{const a=i.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Ke(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),d0=p.forwardRef((t,e)=>{const n=Rn(gr,t.__scopePopover),r=p.useRef(!1),o=p.useRef(!1);return f.jsx(Zf,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;n.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),Zf=p.forwardRef((t,e)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=t,h=Rn(gr,n),m=go(n);return tf(),f.jsx(ml,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:f.jsx(pl,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1),children:f.jsx(px,{"data-state":ep(h.open),role:"dialog",id:h.contentId,...m,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Qf="PopoverClose",h0=p.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=Rn(Qf,n);return f.jsx(we.button,{type:"button",...r,ref:e,onClick:Ke(t.onClick,()=>o.onOpenChange(!1))})});h0.displayName=Qf;var f0="PopoverArrow",p0=p.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=go(n);return f.jsx(mx,{...o,...r,ref:e})});p0.displayName=f0;function ep(t){return t?"open":"closed"}var m0=Jf;function tp(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(e=0;e<o;e++)t[e]&&(n=tp(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function Pl(){for(var t,e,n=0,r="",o=arguments.length;n<o;n++)(t=arguments[n])&&(e=tp(t))&&(r&&(r+=" "),r+=e);return r}function Te(...t){return hl(Pl(t))}const np=Vf,rp=m0,op=p.forwardRef(({className:t,align:e="end",...n},r)=>f.jsx(Yf,{ref:r,align:e,className:Te("z-popups drop-shadow-oneBlock p-0 border-shadow outline-none",t),...n,onKeyDown:o=>{o.stopPropagation()}})),Ns=({children:t,scaleFactor:e})=>{const n=rh();return f.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??n,"--block":`${(e??n)*8}px`},children:t})};var tu=1,g0=.9,y0=.8,v0=.17,Si=.1,Ci=.999,b0=.9999,w0=.99,x0=/[\\\/_+.#"@\[\(\{&]/,_0=/[\\\/_+.#"@\[\(\{&]/g,S0=/[\s-]/,sp=/[\s-]/g;function wa(t,e,n,r,o,s,i){if(s===e.length)return o===t.length?tu:w0;var a=`${o},${s}`;if(i[a]!==void 0)return i[a];for(var l=r.charAt(s),c=n.indexOf(l,o),u=0,d,h,m,g;c>=0;)d=wa(t,e,n,r,c+1,s+1,i),d>u&&(c===o?d*=tu:x0.test(t.charAt(c-1))?(d*=y0,m=t.slice(o,c-1).match(_0),m&&o>0&&(d*=Math.pow(Ci,m.length))):S0.test(t.charAt(c-1))?(d*=g0,g=t.slice(o,c-1).match(sp),g&&o>0&&(d*=Math.pow(Ci,g.length))):(d*=v0,o>0&&(d*=Math.pow(Ci,c-o))),t.charAt(c)!==e.charAt(s)&&(d*=b0)),(d<Si&&n.charAt(c-1)===r.charAt(s+1)||r.charAt(s+1)===r.charAt(s)&&n.charAt(c-1)!==r.charAt(s))&&(h=wa(t,e,n,r,c+1,s+2,i),h*Si>d&&(d=h*Si)),d>u&&(u=d),c=n.indexOf(l,c+1);return i[a]=u,u}function nu(t){return t.toLowerCase().replace(sp," ")}function C0(t,e,n){return t=n&&n.length>0?`${t+" "+n.join(" ")}`:t,wa(t,e,nu(t),nu(e),0,0,{})}var Tl="Dialog",[ip,QR]=fl(Tl),[k0,lt]=ip(Tl),ap=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!0}=t,a=p.useRef(null),l=p.useRef(null),[c=!1,u]=zf({prop:r,defaultProp:o,onChange:s});return f.jsx(k0,{scope:e,triggerRef:a,contentRef:l,contentId:pt(),titleId:pt(),descriptionId:pt(),open:c,onOpenChange:u,onOpenToggle:p.useCallback(()=>u(d=>!d),[u]),modal:i,children:n})};ap.displayName=Tl;var lp="DialogTrigger",E0=p.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(lp,n),s=at(e,o.triggerRef);return f.jsx(we.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Il(o.open),...r,ref:s,onClick:Ke(t.onClick,o.onOpenToggle)})});E0.displayName=lp;var Al="DialogPortal",[P0,cp]=ip(Al,{forceMount:void 0}),up=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:o}=t,s=lt(Al,e);return f.jsx(P0,{scope:e,forceMount:n,children:p.Children.map(r,i=>f.jsx(mo,{present:n||s.open,children:f.jsx(Nf,{asChild:!0,container:o,children:i})}))})};up.displayName=Al;var vs="DialogOverlay",dp=p.forwardRef((t,e)=>{const n=cp(vs,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,s=lt(vs,t.__scopeDialog);return s.modal?f.jsx(mo,{present:r||s.open,children:f.jsx(T0,{...o,ref:e})}):null});dp.displayName=vs;var T0=p.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(vs,n);return f.jsx(kl,{as:Rs,allowPinchZoom:!0,shards:[o.contentRef],children:f.jsx(we.div,{"data-state":Il(o.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),xn="DialogContent",hp=p.forwardRef((t,e)=>{const n=cp(xn,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,s=lt(xn,t.__scopeDialog);return f.jsx(mo,{present:r||s.open,children:s.modal?f.jsx(A0,{...o,ref:e}):f.jsx(R0,{...o,ref:e})})});hp.displayName=xn;var A0=p.forwardRef((t,e)=>{const n=lt(xn,t.__scopeDialog),r=p.useRef(null),o=at(e,n.contentRef,r);return p.useEffect(()=>{const s=r.current;if(s)return Mf(s)},[]),f.jsx(fp,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ke(t.onCloseAutoFocus,s=>{s.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Ke(t.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:Ke(t.onFocusOutside,s=>s.preventDefault())})}),R0=p.forwardRef((t,e)=>{const n=lt(xn,t.__scopeDialog),r=p.useRef(!1),o=p.useRef(!1);return f.jsx(fp,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;n.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),fp=p.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=t,a=lt(xn,n),l=p.useRef(null),c=at(e,l);return tf(),f.jsxs(f.Fragment,{children:[f.jsx(ml,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:f.jsx(pl,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":Il(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),f.jsxs(f.Fragment,{children:[f.jsx($0,{titleId:a.titleId}),f.jsx(z0,{contentRef:l,descriptionId:a.descriptionId})]})]})}),Rl="DialogTitle",I0=p.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(Rl,n);return f.jsx(we.h2,{id:o.titleId,...r,ref:e})});I0.displayName=Rl;var pp="DialogDescription",O0=p.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(pp,n);return f.jsx(we.p,{id:o.descriptionId,...r,ref:e})});O0.displayName=pp;var mp="DialogClose",j0=p.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(mp,n);return f.jsx(we.button,{type:"button",...r,ref:e,onClick:Ke(t.onClick,()=>o.onOpenChange(!1))})});j0.displayName=mp;function Il(t){return t?"open":"closed"}var gp="DialogTitleWarning",[eI,yp]=Gb(gp,{contentName:xn,titleName:Rl,docsSlug:"dialog"}),$0=({titleId:t})=>{const e=yp(gp),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return p.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},N0="DialogDescriptionWarning",z0=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${yp(N0).contentName}}.`;return p.useEffect(()=>{const o=t.current?.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},D0=ap,M0=up,L0=dp,B0=hp,ki={exports:{}},Ei={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ru;function F0(){if(ru)return Ei;ru=1;var t=Zg();function e(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,o=t.useEffect,s=t.useLayoutEffect,i=t.useDebugValue;function a(d,h){var m=h(),g=r({inst:{value:m,getSnapshot:h}}),y=g[0].inst,v=g[1];return s(function(){y.value=m,y.getSnapshot=h,l(y)&&v({inst:y})},[d,m,h]),o(function(){return l(y)&&v({inst:y}),d(function(){l(y)&&v({inst:y})})},[d]),i(m),m}function l(d){var h=d.getSnapshot;d=d.value;try{var m=h();return!n(d,m)}catch{return!0}}function c(d,h){return h()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return Ei.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,Ei}var ou;function U0(){return ou||(ou=1,ki.exports=F0()),ki.exports}var H0=U0(),zr='[cmdk-group=""]',Pi='[cmdk-group-items=""]',W0='[cmdk-group-heading=""]',Ol='[cmdk-item=""]',su=`${Ol}:not([aria-disabled="true"])`,xa="cmdk-item-select",un="data-value",G0=(t,e,n)=>C0(t,e,n),vp=p.createContext(void 0),yo=()=>p.useContext(vp),bp=p.createContext(void 0),jl=()=>p.useContext(bp),wp=p.createContext(void 0),xp=p.forwardRef((t,e)=>{let n=Jn(()=>{var P,E;return{search:"",value:(E=(P=t.value)!=null?P:t.defaultValue)!=null?E:"",filtered:{count:0,items:new Map,groups:new Set}}}),r=Jn(()=>new Set),o=Jn(()=>new Map),s=Jn(()=>new Map),i=Jn(()=>new Set),a=_p(t),{label:l,children:c,value:u,onValueChange:d,filter:h,shouldFilter:m,loop:g,disablePointerSelection:y=!1,vimBindings:v=!0,...b}=t,_=pt(),w=pt(),x=pt(),C=p.useRef(null),k=n_();_n(()=>{if(u!==void 0){let P=u.trim();n.current.value=P,S.emit()}},[u]),_n(()=>{k(6,ee)},[]);let S=p.useMemo(()=>({subscribe:P=>(i.current.add(P),()=>i.current.delete(P)),snapshot:()=>n.current,setState:(P,E,R)=>{var T,I,A;if(!Object.is(n.current[P],E)){if(n.current[P]=E,P==="search")O(),L(),k(1,V);else if(P==="value"&&(R||k(5,ee),((T=a.current)==null?void 0:T.value)!==void 0)){let z=E??"";(A=(I=a.current).onValueChange)==null||A.call(I,z);return}S.emit()}},emit:()=>{i.current.forEach(P=>P())}}),[]),N=p.useMemo(()=>({value:(P,E,R)=>{var T;E!==((T=s.current.get(P))==null?void 0:T.value)&&(s.current.set(P,{value:E,keywords:R}),n.current.filtered.items.set(P,H(E,R)),k(2,()=>{L(),S.emit()}))},item:(P,E)=>(r.current.add(P),E&&(o.current.has(E)?o.current.get(E).add(P):o.current.set(E,new Set([P]))),k(3,()=>{O(),L(),n.current.value||V(),S.emit()}),()=>{s.current.delete(P),r.current.delete(P),n.current.filtered.items.delete(P);let R=M();k(4,()=>{O(),R?.getAttribute("id")===P&&V(),S.emit()})}),group:P=>(o.current.has(P)||o.current.set(P,new Set),()=>{s.current.delete(P),o.current.delete(P)}),filter:()=>a.current.shouldFilter,label:l||t["aria-label"],getDisablePointerSelection:()=>a.current.disablePointerSelection,listId:_,inputId:x,labelId:w,listInnerRef:C}),[]);function H(P,E){var R,T;let I=(T=(R=a.current)==null?void 0:R.filter)!=null?T:G0;return P?I(P,n.current.search,E):0}function L(){if(!n.current.search||a.current.shouldFilter===!1)return;let P=n.current.filtered.items,E=[];n.current.filtered.groups.forEach(T=>{let I=o.current.get(T),A=0;I.forEach(z=>{let re=P.get(z);A=Math.max(re,A)}),E.push([T,A])});let R=C.current;K().sort((T,I)=>{var A,z;let re=T.getAttribute("id"),le=I.getAttribute("id");return((A=P.get(le))!=null?A:0)-((z=P.get(re))!=null?z:0)}).forEach(T=>{let I=T.closest(Pi);I?I.appendChild(T.parentElement===I?T:T.closest(`${Pi} > *`)):R.appendChild(T.parentElement===R?T:T.closest(`${Pi} > *`))}),E.sort((T,I)=>I[1]-T[1]).forEach(T=>{var I;let A=(I=C.current)==null?void 0:I.querySelector(`${zr}[${un}="${encodeURIComponent(T[0])}"]`);A?.parentElement.appendChild(A)})}function V(){let P=K().find(R=>R.getAttribute("aria-disabled")!=="true"),E=P?.getAttribute(un);S.setState("value",E||void 0)}function O(){var P,E,R,T;if(!n.current.search||a.current.shouldFilter===!1){n.current.filtered.count=r.current.size;return}n.current.filtered.groups=new Set;let I=0;for(let A of r.current){let z=(E=(P=s.current.get(A))==null?void 0:P.value)!=null?E:"",re=(T=(R=s.current.get(A))==null?void 0:R.keywords)!=null?T:[],le=H(z,re);n.current.filtered.items.set(A,le),le>0&&I++}for(let[A,z]of o.current)for(let re of z)if(n.current.filtered.items.get(re)>0){n.current.filtered.groups.add(A);break}n.current.filtered.count=I}function ee(){var P,E,R;let T=M();T&&(((P=T.parentElement)==null?void 0:P.firstChild)===T&&((R=(E=T.closest(zr))==null?void 0:E.querySelector(W0))==null||R.scrollIntoView({block:"nearest"})),T.scrollIntoView({block:"nearest"}))}function M(){var P;return(P=C.current)==null?void 0:P.querySelector(`${Ol}[aria-selected="true"]`)}function K(){var P;return Array.from(((P=C.current)==null?void 0:P.querySelectorAll(su))||[])}function X(P){let E=K()[P];E&&S.setState("value",E.getAttribute(un))}function Z(P){var E;let R=M(),T=K(),I=T.findIndex(z=>z===R),A=T[I+P];(E=a.current)!=null&&E.loop&&(A=I+P<0?T[T.length-1]:I+P===T.length?T[0]:T[I+P]),A&&S.setState("value",A.getAttribute(un))}function F(P){let E=M(),R=E?.closest(zr),T;for(;R&&!T;)R=P>0?e_(R,zr):t_(R,zr),T=R?.querySelector(su);T?S.setState("value",T.getAttribute(un)):Z(P)}let ie=()=>X(K().length-1),ve=P=>{P.preventDefault(),P.metaKey?ie():P.altKey?F(1):Z(1)},pe=P=>{P.preventDefault(),P.metaKey?X(0):P.altKey?F(-1):Z(-1)};return p.createElement(we.div,{ref:e,tabIndex:-1,...b,"cmdk-root":"",onKeyDown:P=>{var E;if((E=b.onKeyDown)==null||E.call(b,P),!P.defaultPrevented)switch(P.key){case"n":case"j":{v&&P.ctrlKey&&ve(P);break}case"ArrowDown":{ve(P);break}case"p":case"k":{v&&P.ctrlKey&&pe(P);break}case"ArrowUp":{pe(P);break}case"Home":{P.preventDefault(),X(0);break}case"End":{P.preventDefault(),ie();break}case"Enter":if(!P.nativeEvent.isComposing&&P.keyCode!==229){P.preventDefault();let R=M();if(R){let T=new Event(xa);R.dispatchEvent(T)}}}}},p.createElement("label",{"cmdk-label":"",htmlFor:N.inputId,id:N.labelId,style:o_},l),zs(t,P=>p.createElement(bp.Provider,{value:S},p.createElement(vp.Provider,{value:N},P))))}),q0=p.forwardRef((t,e)=>{var n,r;let o=pt(),s=p.useRef(null),i=p.useContext(wp),a=yo(),l=_p(t),c=(r=(n=l.current)==null?void 0:n.forceMount)!=null?r:i?.forceMount;_n(()=>{if(!c)return a.item(o,i?.id)},[c]);let u=Sp(o,s,[t.value,t.children,s],t.keywords),d=jl(),h=Sn(k=>k.value&&k.value===u.current),m=Sn(k=>c||a.filter()===!1?!0:k.search?k.filtered.items.get(o)>0:!0);p.useEffect(()=>{let k=s.current;if(!(!k||t.disabled))return k.addEventListener(xa,g),()=>k.removeEventListener(xa,g)},[m,t.onSelect,t.disabled]);function g(){var k,S;y(),(S=(k=l.current).onSelect)==null||S.call(k,u.current)}function y(){d.setState("value",u.current,!0)}if(!m)return null;let{disabled:v,value:b,onSelect:_,forceMount:w,keywords:x,...C}=t;return p.createElement(we.div,{ref:oo([s,e]),...C,id:o,"cmdk-item":"",role:"option","aria-disabled":!!v,"aria-selected":!!h,"data-disabled":!!v,"data-selected":!!h,onPointerMove:v||a.getDisablePointerSelection()?void 0:y,onClick:v?void 0:g},t.children)}),V0=p.forwardRef((t,e)=>{let{heading:n,children:r,forceMount:o,...s}=t,i=pt(),a=p.useRef(null),l=p.useRef(null),c=pt(),u=yo(),d=Sn(m=>o||u.filter()===!1?!0:m.search?m.filtered.groups.has(i):!0);_n(()=>u.group(i),[]),Sp(i,a,[t.value,t.heading,l]);let h=p.useMemo(()=>({id:i,forceMount:o}),[o]);return p.createElement(we.div,{ref:oo([a,e]),...s,"cmdk-group":"",role:"presentation",hidden:d?void 0:!0},n&&p.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:c},n),zs(t,m=>p.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?c:void 0},p.createElement(wp.Provider,{value:h},m))))}),K0=p.forwardRef((t,e)=>{let{alwaysRender:n,...r}=t,o=p.useRef(null),s=Sn(i=>!i.search);return!n&&!s?null:p.createElement(we.div,{ref:oo([o,e]),...r,"cmdk-separator":"",role:"separator"})}),X0=p.forwardRef((t,e)=>{let{onValueChange:n,...r}=t,o=t.value!=null,s=jl(),i=Sn(u=>u.search),a=Sn(u=>u.value),l=yo(),c=p.useMemo(()=>{var u;let d=(u=l.listInnerRef.current)==null?void 0:u.querySelector(`${Ol}[${un}="${encodeURIComponent(a)}"]`);return d?.getAttribute("id")},[]);return p.useEffect(()=>{t.value!=null&&s.setState("search",t.value)},[t.value]),p.createElement(we.input,{ref:e,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":c,id:l.inputId,type:"text",value:o?t.value:i,onChange:u=>{o||s.setState("search",u.target.value),n?.(u.target.value)}})}),J0=p.forwardRef((t,e)=>{let{children:n,label:r="Suggestions",...o}=t,s=p.useRef(null),i=p.useRef(null),a=yo();return p.useEffect(()=>{if(i.current&&s.current){let l=i.current,c=s.current,u,d=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let h=l.offsetHeight;c.style.setProperty("--cmdk-list-height",h.toFixed(1)+"px")})});return d.observe(l),()=>{cancelAnimationFrame(u),d.unobserve(l)}}},[]),p.createElement(we.div,{ref:oo([s,e]),...o,"cmdk-list":"",role:"listbox","aria-label":r,id:a.listId},zs(t,l=>p.createElement("div",{ref:oo([i,a.listInnerRef]),"cmdk-list-sizer":""},l)))}),Y0=p.forwardRef((t,e)=>{let{open:n,onOpenChange:r,overlayClassName:o,contentClassName:s,container:i,...a}=t;return p.createElement(D0,{open:n,onOpenChange:r},p.createElement(M0,{container:i},p.createElement(L0,{"cmdk-overlay":"",className:o}),p.createElement(B0,{"aria-label":t.label,"cmdk-dialog":"",className:s},p.createElement(xp,{ref:e,...a}))))}),Z0=p.forwardRef((t,e)=>Sn(n=>n.filtered.count===0)?p.createElement(we.div,{ref:e,...t,"cmdk-empty":"",role:"presentation"}):null),Q0=p.forwardRef((t,e)=>{let{progress:n,children:r,label:o="Loading...",...s}=t;return p.createElement(we.div,{ref:e,...s,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},zs(t,i=>p.createElement("div",{"aria-hidden":!0},i)))}),We=Object.assign(xp,{List:J0,Item:q0,Input:X0,Group:V0,Separator:K0,Dialog:Y0,Empty:Z0,Loading:Q0});function e_(t,e){let n=t.nextElementSibling;for(;n;){if(n.matches(e))return n;n=n.nextElementSibling}}function t_(t,e){let n=t.previousElementSibling;for(;n;){if(n.matches(e))return n;n=n.previousElementSibling}}function _p(t){let e=p.useRef(t);return _n(()=>{e.current=t}),e}var _n=typeof window>"u"?p.useEffect:p.useLayoutEffect;function Jn(t){let e=p.useRef();return e.current===void 0&&(e.current=t()),e}function oo(t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}function Sn(t){let e=jl(),n=()=>t(e.snapshot());return H0.useSyncExternalStore(e.subscribe,n,n)}function Sp(t,e,n,r=[]){let o=p.useRef(),s=yo();return _n(()=>{var i;let a=(()=>{var c;for(let u of n){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(c=u.current.textContent)==null?void 0:c.trim():o.current}})(),l=r.map(c=>c.trim());s.value(t,a,l),(i=e.current)==null||i.setAttribute(un,a),o.current=a}),o}var n_=()=>{let[t,e]=p.useState(),n=Jn(()=>new Map);return _n(()=>{n.current.forEach(r=>r()),n.current=new Map},[t]),(r,o)=>{n.current.set(r,o),e({})}};function r_(t){let e=t.type;return typeof e=="function"?e(t.props):"render"in e?e.render(t.props):t}function zs({asChild:t,children:e},n){return t&&p.isValidElement(e)?p.cloneElement(r_(e),{ref:e.ref},n(e.props.children)):n(e)}var o_={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Cp=p.forwardRef(({className:t,...e},n)=>f.jsx(We,{ref:n,className:Te("flex h-full w-full flex-col overflow-hidden bg-metallicBlue text-popover-foreground",t),...e}));Cp.displayName=We.displayName;const kp=p.forwardRef(({className:t,...e},n)=>f.jsxs("div",{className:"flex items-center border-b px-1 pb-1","cmdk-input-wrapper":"",children:[f.jsx("span",{className:"sprite mr-1 texture-hud_char_gt"}),f.jsx(We.Input,{ref:n,className:Te("flex h-1 w-full bg-pastelBlue py-1 outline-none placeholder:text-shadow disabled:cursor-not-allowed",t),...e})]}));kp.displayName=We.Input.displayName;const Ep=p.forwardRef(({className:t,...e},n)=>f.jsx(We.List,{ref:n,className:Te("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...e}));Ep.displayName=We.List.displayName;const Pp=p.forwardRef((t,e)=>f.jsx(We.Empty,{ref:e,className:"pl-1",...t}));Pp.displayName=We.Empty.displayName;const Tp=p.forwardRef(({className:t,...e},n)=>f.jsx(We.Group,{ref:n,className:Te("overflow-hidden",t),...e}));Tp.displayName=We.Group.displayName;const s_=p.forwardRef(({className:t,...e},n)=>f.jsx(We.Separator,{ref:n,className:Te("-mx-1 h-px bg-shadow",t),...e}));s_.displayName=We.Separator.displayName;const Ds=p.forwardRef(({className:t,...e},n)=>f.jsx(We.Item,{ref:n,className:Te("relative flex cursor-default select-none items-center text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-midRed hover:bg-pastelBlue data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...e}));Ds.displayName=We.Item.displayName;function Pt(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t?.(o),n===!1||!o.defaultPrevented)return e?.(o)}}function iu(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Ap(...t){return e=>{let n=!1;const r=t.map(o=>{const s=iu(o,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():iu(t[o],null)}}}}function In(...t){return p.useCallback(Ap(...t),t)}function Rp(t,e=[]){let n=[];function r(s,i){const a=p.createContext(i),l=n.length;n=[...n,i];const c=d=>{const{scope:h,children:m,...g}=d,y=h?.[t]?.[l]||a,v=p.useMemo(()=>g,Object.values(g));return f.jsx(y.Provider,{value:v,children:m})};c.displayName=s+"Provider";function u(d,h){const m=h?.[t]?.[l]||a,g=p.useContext(m);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=n.map(i=>p.createContext(i));return function(a){const l=a?.[t]||s;return p.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[r,i_(o,...e)]}function i_(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return p.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}function a_(t){const e=l_(t),n=p.forwardRef((r,o)=>{const{children:s,...i}=r,a=p.Children.toArray(s),l=a.find(u_);if(l){const c=l.props.children,u=a.map(d=>d===l?p.Children.count(c)>1?p.Children.only(null):p.isValidElement(c)?c.props.children:null:d);return f.jsx(e,{...i,ref:o,children:p.isValidElement(c)?p.cloneElement(c,void 0,u):null})}return f.jsx(e,{...i,ref:o,children:s})});return n.displayName=`${t}.Slot`,n}function l_(t){const e=p.forwardRef((n,r)=>{const{children:o,...s}=n;if(p.isValidElement(o)){const i=h_(o),a=d_(s,o.props);return o.type!==p.Fragment&&(a.ref=r?Ap(r,i):i),p.cloneElement(o,a)}return p.Children.count(o)>1?p.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Ip=Symbol("radix.slottable");function c_(t){const e=({children:n})=>f.jsx(f.Fragment,{children:n});return e.displayName=`${t}.Slottable`,e.__radixId=Ip,e}function u_(t){return p.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Ip}function d_(t,e){const n={...e};for(const r in e){const o=t[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{const l=s(...a);return o(...a),l}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...t,...n}}function h_(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var f_=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],tn=f_.reduce((t,e)=>{const n=a_(`Primitive.${e}`),r=p.forwardRef((o,s)=>{const{asChild:i,...a}=o,l=i?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),f.jsx(l,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function p_(t,e){t&&As.flushSync(()=>t.dispatchEvent(e))}function Ms(t){const e=p.useRef(t);return p.useEffect(()=>{e.current=t}),p.useMemo(()=>(...n)=>e.current?.(...n),[])}function m_(t,e=globalThis?.document){const n=Ms(t);p.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var g_="DismissableLayer",_a="dismissableLayer.update",y_="dismissableLayer.pointerDownOutside",v_="dismissableLayer.focusOutside",au,Op=p.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),jp=p.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=p.useContext(Op),[u,d]=p.useState(null),h=u?.ownerDocument??globalThis?.document,[,m]=p.useState({}),g=In(e,S=>d(S)),y=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),b=y.indexOf(v),_=u?y.indexOf(u):-1,w=c.layersWithOutsidePointerEventsDisabled.size>0,x=_>=b,C=x_(S=>{const N=S.target,H=[...c.branches].some(L=>L.contains(N));!x||H||(o?.(S),i?.(S),S.defaultPrevented||a?.())},h),k=__(S=>{const N=S.target;[...c.branches].some(L=>L.contains(N))||(s?.(S),i?.(S),S.defaultPrevented||a?.())},h);return m_(S=>{_===c.layers.size-1&&(r?.(S),!S.defaultPrevented&&a&&(S.preventDefault(),a()))},h),p.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(au=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),lu(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=au)}},[u,h,n,c]),p.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),lu())},[u,c]),p.useEffect(()=>{const S=()=>m({});return document.addEventListener(_a,S),()=>document.removeEventListener(_a,S)},[]),f.jsx(tn.div,{...l,ref:g,style:{pointerEvents:w?x?"auto":"none":void 0,...t.style},onFocusCapture:Pt(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Pt(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Pt(t.onPointerDownCapture,C.onPointerDownCapture)})});jp.displayName=g_;var b_="DismissableLayerBranch",w_=p.forwardRef((t,e)=>{const n=p.useContext(Op),r=p.useRef(null),o=In(e,r);return p.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),f.jsx(tn.div,{...t,ref:o})});w_.displayName=b_;function x_(t,e=globalThis?.document){const n=Ms(t),r=p.useRef(!1),o=p.useRef(()=>{});return p.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){$p(y_,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function __(t,e=globalThis?.document){const n=Ms(t),r=p.useRef(!1);return p.useEffect(()=>{const o=s=>{s.target&&!r.current&&$p(v_,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function lu(){const t=new CustomEvent(_a);document.dispatchEvent(t)}function $p(t,e,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?p_(o,s):o.dispatchEvent(s)}var Zt=globalThis?.document?p.useLayoutEffect:()=>{},S_=ks[" useId ".trim().toString()]||(()=>{}),C_=0;function k_(t){const[e,n]=p.useState(S_());return Zt(()=>{n(r=>r??String(C_++))},[t]),e?`radix-${e}`:""}var E_="Arrow",Np=p.forwardRef((t,e)=>{const{children:n,width:r=10,height:o=5,...s}=t;return f.jsx(tn.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:f.jsx("polygon",{points:"0,0 30,0 15,10"})})});Np.displayName=E_;var P_=Np;function T_(t){const[e,n]=p.useState(void 0);return Zt(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var $l="Popper",[zp,Dp]=Rp($l),[A_,Mp]=zp($l),Lp=t=>{const{__scopePopper:e,children:n}=t,[r,o]=p.useState(null);return f.jsx(A_,{scope:e,anchor:r,onAnchorChange:o,children:n})};Lp.displayName=$l;var Bp="PopperAnchor",Fp=p.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,s=Mp(Bp,n),i=p.useRef(null),a=In(e,i);return p.useEffect(()=>{s.onAnchorChange(r?.current||i.current)}),r?null:f.jsx(tn.div,{...o,ref:a})});Fp.displayName=Bp;var Nl="PopperContent",[R_,I_]=zp(Nl),Up=p.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:m="optimized",onPlaced:g,...y}=t,v=Mp(Nl,n),[b,_]=p.useState(null),w=In(e,A=>_(A)),[x,C]=p.useState(null),k=T_(x),S=k?.width??0,N=k?.height??0,H=r+(s!=="center"?"-"+s:""),L=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},V=Array.isArray(c)?c:[c],O=V.length>0,ee={padding:L,boundary:V.filter(j_),altBoundary:O},{refs:M,floatingStyles:K,placement:X,isPositioned:Z,middlewareData:F}=mf({strategy:"fixed",placement:H,whileElementsMounted:(...A)=>ff(...A,{animationFrame:m==="always"}),elements:{reference:v.anchor},middleware:[gf({mainAxis:o+N,alignmentAxis:i}),l&&yf({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?vf():void 0,...ee}),l&&bf({...ee}),wf({...ee,apply:({elements:A,rects:z,availableWidth:re,availableHeight:le})=>{const{width:Ne,height:ze}=z.reference,ae=A.floating.style;ae.setProperty("--radix-popper-available-width",`${re}px`),ae.setProperty("--radix-popper-available-height",`${le}px`),ae.setProperty("--radix-popper-anchor-width",`${Ne}px`),ae.setProperty("--radix-popper-anchor-height",`${ze}px`)}}),x&&_f({element:x,padding:a}),$_({arrowWidth:S,arrowHeight:N}),h&&xf({strategy:"referenceHidden",...ee})]}),[ie,ve]=Gp(X),pe=Ms(g);Zt(()=>{Z&&pe?.()},[Z,pe]);const P=F.arrow?.x,E=F.arrow?.y,R=F.arrow?.centerOffset!==0,[T,I]=p.useState();return Zt(()=>{b&&I(window.getComputedStyle(b).zIndex)},[b]),f.jsx("div",{ref:M.setFloating,"data-radix-popper-content-wrapper":"",style:{...K,transform:Z?K.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:T,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:f.jsx(R_,{scope:n,placedSide:ie,onArrowChange:C,arrowX:P,arrowY:E,shouldHideArrow:R,children:f.jsx(tn.div,{"data-side":ie,"data-align":ve,...y,ref:w,style:{...y.style,animation:Z?void 0:"none"}})})})});Up.displayName=Nl;var Hp="PopperArrow",O_={top:"bottom",right:"left",bottom:"top",left:"right"},Wp=p.forwardRef(function(e,n){const{__scopePopper:r,...o}=e,s=I_(Hp,r),i=O_[s.placedSide];return f.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:f.jsx(P_,{...o,ref:n,style:{...o.style,display:"block"}})})});Wp.displayName=Hp;function j_(t){return t!==null}var $_=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=Gp(n),d={start:"0%",center:"50%",end:"100%"}[u],h=(o.arrow?.x??0)+a/2,m=(o.arrow?.y??0)+l/2;let g="",y="";return c==="bottom"?(g=i?d:`${h}px`,y=`${-l}px`):c==="top"?(g=i?d:`${h}px`,y=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,y=i?d:`${m}px`):c==="left"&&(g=`${r.floating.width+l}px`,y=i?d:`${m}px`),{data:{x:g,y}}}});function Gp(t){const[e,n="center"]=t.split("-");return[e,n]}var N_=Lp,z_=Fp,D_=Up,M_=Wp,L_="Portal",qp=p.forwardRef((t,e)=>{const{container:n,...r}=t,[o,s]=p.useState(!1);Zt(()=>s(!0),[]);const i=n||o&&globalThis?.document?.body;return i?Zh.createPortal(f.jsx(tn.div,{...r,ref:e}),i):null});qp.displayName=L_;function B_(t,e){return p.useReducer((n,r)=>e[n][r]??n,t)}var zl=t=>{const{present:e,children:n}=t,r=F_(e),o=typeof n=="function"?n({present:r.isPresent}):p.Children.only(n),s=In(r.ref,U_(o));return typeof n=="function"||r.isPresent?p.cloneElement(o,{ref:s}):null};zl.displayName="Presence";function F_(t){const[e,n]=p.useState(),r=p.useRef(null),o=p.useRef(t),s=p.useRef("none"),i=t?"mounted":"unmounted",[a,l]=B_(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return p.useEffect(()=>{const c=Lo(r.current);s.current=a==="mounted"?c:"none"},[a]),Zt(()=>{const c=r.current,u=o.current;if(u!==t){const h=s.current,m=Lo(c);t?l("MOUNT"):m==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&h!==m?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),Zt(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=m=>{const y=Lo(r.current).includes(m.animationName);if(m.target===e&&y&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},h=m=>{m.target===e&&(s.current=Lo(r.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:p.useCallback(c=>{r.current=c?getComputedStyle(c):null,n(c)},[])}}function Lo(t){return t?.animationName||"none"}function U_(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var H_=ks[" useInsertionEffect ".trim().toString()]||Zt;function W_({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[o,s,i]=G_({defaultProp:e,onChange:n}),a=t!==void 0,l=a?t:o;{const u=p.useRef(t!==void 0);p.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,r])}const c=p.useCallback(u=>{if(a){const d=q_(u)?u(t):u;d!==t&&i.current?.(d)}else s(u)},[a,t,s,i]);return[l,c]}function G_({defaultProp:t,onChange:e}){const[n,r]=p.useState(t),o=p.useRef(n),s=p.useRef(e);return H_(()=>{s.current=e},[e]),p.useEffect(()=>{o.current!==n&&(s.current?.(n),o.current=n)},[n,o]),[n,r,s]}function q_(t){return typeof t=="function"}var V_=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),K_="VisuallyHidden",Vp=p.forwardRef((t,e)=>f.jsx(tn.span,{...t,ref:e,style:{...V_,...t.style}}));Vp.displayName=K_;var X_=Vp,[Ls,tI]=Rp("Tooltip",[Dp]),Bs=Dp(),Kp="TooltipProvider",J_=700,Sa="tooltip.open",[Y_,Dl]=Ls(Kp),Xp=t=>{const{__scopeTooltip:e,delayDuration:n=J_,skipDelayDuration:r=300,disableHoverableContent:o=!1,children:s}=t,i=p.useRef(!0),a=p.useRef(!1),l=p.useRef(0);return p.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),f.jsx(Y_,{scope:e,isOpenDelayedRef:i,delayDuration:n,onOpen:p.useCallback(()=>{window.clearTimeout(l.current),i.current=!1},[]),onClose:p.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.current=!0,r)},[r]),isPointerInTransitRef:a,onPointerInTransitChange:p.useCallback(c=>{a.current=c},[]),disableHoverableContent:o,children:s})};Xp.displayName=Kp;var so="Tooltip",[Z_,vo]=Ls(so),Jp=t=>{const{__scopeTooltip:e,children:n,open:r,defaultOpen:o,onOpenChange:s,disableHoverableContent:i,delayDuration:a}=t,l=Dl(so,t.__scopeTooltip),c=Bs(e),[u,d]=p.useState(null),h=k_(),m=p.useRef(0),g=i??l.disableHoverableContent,y=a??l.delayDuration,v=p.useRef(!1),[b,_]=W_({prop:r,defaultProp:o??!1,onChange:S=>{S?(l.onOpen(),document.dispatchEvent(new CustomEvent(Sa))):l.onClose(),s?.(S)},caller:so}),w=p.useMemo(()=>b?v.current?"delayed-open":"instant-open":"closed",[b]),x=p.useCallback(()=>{window.clearTimeout(m.current),m.current=0,v.current=!1,_(!0)},[_]),C=p.useCallback(()=>{window.clearTimeout(m.current),m.current=0,_(!1)},[_]),k=p.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>{v.current=!0,_(!0),m.current=0},y)},[y,_]);return p.useEffect(()=>()=>{m.current&&(window.clearTimeout(m.current),m.current=0)},[]),f.jsx(N_,{...c,children:f.jsx(Z_,{scope:e,contentId:h,open:b,stateAttribute:w,trigger:u,onTriggerChange:d,onTriggerEnter:p.useCallback(()=>{l.isOpenDelayedRef.current?k():x()},[l.isOpenDelayedRef,k,x]),onTriggerLeave:p.useCallback(()=>{g?C():(window.clearTimeout(m.current),m.current=0)},[C,g]),onOpen:x,onClose:C,disableHoverableContent:g,children:n})})};Jp.displayName=so;var Ca="TooltipTrigger",Yp=p.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=vo(Ca,n),s=Dl(Ca,n),i=Bs(n),a=p.useRef(null),l=In(e,a,o.onTriggerChange),c=p.useRef(!1),u=p.useRef(!1),d=p.useCallback(()=>c.current=!1,[]);return p.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),f.jsx(z_,{asChild:!0,...i,children:f.jsx(tn.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...r,ref:l,onPointerMove:Pt(t.onPointerMove,h=>{h.pointerType!=="touch"&&!u.current&&!s.isPointerInTransitRef.current&&(o.onTriggerEnter(),u.current=!0)}),onPointerLeave:Pt(t.onPointerLeave,()=>{o.onTriggerLeave(),u.current=!1}),onPointerDown:Pt(t.onPointerDown,()=>{o.open&&o.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:Pt(t.onFocus,()=>{c.current||o.onOpen()}),onBlur:Pt(t.onBlur,o.onClose),onClick:Pt(t.onClick,o.onClose)})})});Yp.displayName=Ca;var Ml="TooltipPortal",[Q_,eS]=Ls(Ml,{forceMount:void 0}),Zp=t=>{const{__scopeTooltip:e,forceMount:n,children:r,container:o}=t,s=vo(Ml,e);return f.jsx(Q_,{scope:e,forceMount:n,children:f.jsx(zl,{present:n||s.open,children:f.jsx(qp,{asChild:!0,container:o,children:r})})})};Zp.displayName=Ml;var yr="TooltipContent",Qp=p.forwardRef((t,e)=>{const n=eS(yr,t.__scopeTooltip),{forceMount:r=n.forceMount,side:o="top",...s}=t,i=vo(yr,t.__scopeTooltip);return f.jsx(zl,{present:r||i.open,children:i.disableHoverableContent?f.jsx(em,{side:o,...s,ref:e}):f.jsx(tS,{side:o,...s,ref:e})})}),tS=p.forwardRef((t,e)=>{const n=vo(yr,t.__scopeTooltip),r=Dl(yr,t.__scopeTooltip),o=p.useRef(null),s=In(e,o),[i,a]=p.useState(null),{trigger:l,onClose:c}=n,u=o.current,{onPointerInTransitChange:d}=r,h=p.useCallback(()=>{a(null),d(!1)},[d]),m=p.useCallback((g,y)=>{const v=g.currentTarget,b={x:g.clientX,y:g.clientY},_=iS(b,v.getBoundingClientRect()),w=aS(b,_),x=lS(y.getBoundingClientRect()),C=uS([...w,...x]);a(C),d(!0)},[d]);return p.useEffect(()=>()=>h(),[h]),p.useEffect(()=>{if(l&&u){const g=v=>m(v,u),y=v=>m(v,l);return l.addEventListener("pointerleave",g),u.addEventListener("pointerleave",y),()=>{l.removeEventListener("pointerleave",g),u.removeEventListener("pointerleave",y)}}},[l,u,m,h]),p.useEffect(()=>{if(i){const g=y=>{const v=y.target,b={x:y.clientX,y:y.clientY},_=l?.contains(v)||u?.contains(v),w=!cS(b,i);_?h():w&&(h(),c())};return document.addEventListener("pointermove",g),()=>document.removeEventListener("pointermove",g)}},[l,u,i,c,h]),f.jsx(em,{...t,ref:s})}),[nS,rS]=Ls(so,{isInside:!1}),oS=c_("TooltipContent"),em=p.forwardRef((t,e)=>{const{__scopeTooltip:n,children:r,"aria-label":o,onEscapeKeyDown:s,onPointerDownOutside:i,...a}=t,l=vo(yr,n),c=Bs(n),{onClose:u}=l;return p.useEffect(()=>(document.addEventListener(Sa,u),()=>document.removeEventListener(Sa,u)),[u]),p.useEffect(()=>{if(l.trigger){const d=h=>{h.target?.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),f.jsx(jp,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:f.jsxs(D_,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[f.jsx(oS,{children:r}),f.jsx(nS,{scope:n,isInside:!0,children:f.jsx(X_,{id:l.contentId,role:"tooltip",children:o||r})})]})})});Qp.displayName=yr;var tm="TooltipArrow",sS=p.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=Bs(n);return rS(tm,n).isInside?null:f.jsx(M_,{...o,...r,ref:e})});sS.displayName=tm;function iS(t,e){const n=Math.abs(e.top-t.y),r=Math.abs(e.bottom-t.y),o=Math.abs(e.right-t.x),s=Math.abs(e.left-t.x);switch(Math.min(n,r,o,s)){case s:return"left";case o:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function aS(t,e,n=5){const r=[];switch(e){case"top":r.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":r.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":r.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":r.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return r}function lS(t){const{top:e,right:n,bottom:r,left:o}=t;return[{x:o,y:e},{x:n,y:e},{x:n,y:r},{x:o,y:r}]}function cS(t,e){const{x:n,y:r}=t;let o=!1;for(let s=0,i=e.length-1;s<e.length;i=s++){const a=e[s],l=e[i],c=a.x,u=a.y,d=l.x,h=l.y;u>r!=h>r&&n<(d-c)*(r-u)/(h-u)+c&&(o=!o)}return o}function uS(t){const e=t.slice();return e.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),dS(e)}function dS(t){if(t.length<=1)return t.slice();const e=[];for(let r=0;r<t.length;r++){const o=t[r];for(;e.length>=2;){const s=e[e.length-1],i=e[e.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))e.pop();else break}e.push(o)}e.pop();const n=[];for(let r=t.length-1;r>=0;r--){const o=t[r];for(;n.length>=2;){const s=n[n.length-1],i=n[n.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))n.pop();else break}n.push(o)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}var hS=Xp,fS=Jp;const pS={"":p.Fragment,pre:"pre",code:"code",ol:"ol",ul:"ul",hr:"hr",blockquote:"blockquote",li:"li",a:"a",img:"img",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",p:"p",em:"em",strong:"strong"},cu=t=>t.replace(RegExp("^"+(t.match(/^(\t| )+/)||"")[0],"gm"),""),mS=t=>t&&typeof t!="string"&&["div","ul","ol","pre","h1","h2","h3","h4","h5","h6"].includes(t.t),Ti=t=>t.replace(/^\s+|\s+$/g," "),xe=(t,e=[],n={})=>({t,c:Array.isArray(e)?e:[e],p:n}),Fr=(t,e=!1)=>{let n=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,r=0;const o=xe("");let s,i;e?(s=xe("p"),i=[o,s],o.c.push(s)):(s=o,i=[o]);let a;const l=(d,h=!0)=>(h&&i.push(d),s.c.push(d),h&&(s=d),d),c=d=>{const h=i.findIndex(m=>m.t===d);i=i.slice(0,h),s=i.at(-1)};for(;a=n.exec(t);){const d=t.substring(r,a.index);if(r=n.lastIndex,d!=="")if(s===o&&e){const h=xe("p",Ti(d));o.c.push(h),i=[o,h],s=h}else s.c.push(Ti(d));if(!d.match(/[^\\](\\\\)*\\$/)){if(a[3]||a[4]){const h=xe("pre",a[4]?cu(a[4]):xe("code",cu(a[3]),a[2]?{language:`language-${a[2].toLowerCase()}`}:{}));o.c.push(h),i=[o],s=o}else if(a[6]){const h=a[6],m=h!==">",g=!!h.match(/\./),y=m?g?"ol":"ul":"blockquote",v=a[5].split(`
`).map(_=>_.replace(/^(\*|-|\+|>|\d+\.)\s+/,"")).filter(_=>_.trim()!==""),b=xe(y,m?v.map(_=>xe("li",Fr(_).c)):Fr(v.join(`
`)).c);o.c.push(b),i=[o,b],s=o}else if(a[8]){const h=xe("img",[],{src:a[8],...a[7]?{alt:a[7]}:{}});if(e&&s===o){const m=xe("p",h);o.c.push(m),s=m,i=[o,m]}else l(h,!1)}else if(a[10]){const h=i.find(m=>m.t==="a");h&&(h.p.href=a[11])}else if(a[9])l(xe("a"));else if(a[14]){const h="h"+a[14].length;o.c.push(xe(h,Fr(a[15]).c)),i=[o],s=o}else if(a[13])o.c.push(xe("h1",Fr(a[12]).c)),i=[o],s=o;else if(a[16])l(xe("code",a[16]),!1);else if(a[17]?.[0]===`
`||a[17]===`  
`){if(!(i[1]?.t==="p")){const g=o.c;let y;for(y=g.length-1;y>=0&&!mS(g[y]);y--);if(y!==o.c.length-1){const v=o.c.splice(y+1);o.c.push(xe("p",v))}}const m=xe("p");o.c.push(m),i=[o,m],s=m}else if(a[1])o.c.push(xe("hr")),i=[o],s=o;else if(a[17]){const h=a[17].length===2?"strong":"em";i.findIndex(g=>g.t===h)===-1?l(xe(h)):c(h)}}}const u=Ti(t.substring(r));if(u.length){const d=o.c.at(-1);let h;d?.t==="p"?h=d:e?(h=xe("p"),o.c.push(h)):h=o,h.c.push(u)}return o.c=o.c.filter(d=>typeof d=="string"||d.t!=="p"||d.c?.length>0),o},gS=(t,e={})=>{const n={...pS,...e},r=(o,s=0)=>{const i=o.t===""?p.Fragment:n[o.t];return p.createElement(i,{...o.p,key:s},o.c.length===0?void 0:o.c.map((a,l)=>typeof a=="string"?a:r(a,l)))};return r(Fr(t,!0))},yS=({markdown:t,customComponents:e})=>gS(t,e),Bo="leading-none [&_[class*='texture-hud']]:mb-oneScaledPix",vS={h2:function({children:e}){return f.jsx("h2",{className:`mb-1 sprites-double-height text-metallicBlue zx:text-zxBlue clear-both ${Bo}`,children:f.jsx(tt,{children:e})})},h3:function({children:e}){return f.jsx("h3",{className:"mt-1 mb-1 text-metallicBlue zx:text-zxBlue clear-both",children:f.jsx(tt,{children:e})})},blockquote:function({children:e}){return f.jsx("blockquote",{className:`${Bo} mt-1 mb-1 text-moss zx:text-zxBlue clear-both`,children:f.jsxs(tt,{children:["> ",e]})})},p:function({children:e}){return f.jsx("div",{className:`mb-1 last:mb-0 ${Bo}`,children:f.jsx(tt,{children:e})})},a:function({children:e,href:n}){return f.jsx("a",{className:"bitmap-text-link",href:n,target:"_blank",rel:"noopener noreferrer",children:f.jsx(tt,{children:e})})},li:function({children:e}){return f.jsx("div",{className:`mb-1 clear-both ${Bo}`,children:f.jsxs(tt,{children:[f.jsx(D,{className:"text-metallicBlue zx:text-zxYellow",children:"•"}),e]})})},strong:function({children:e}){return f.jsx(tt,{className:"strong text-midRed zx:text-zxRed",children:e})},em:function({children:e}){return f.jsx(tt,{className:"em text-moss zx:text-zxBlue",children:e})},img:function({src:e}){const n=rh();if(e===void 0)throw new Error("image without src");const r=e.split(/\?|&/);return f.jsx("span",{style:{"--scale":n*2},children:f.jsx("span",{className:hl("sprite float-left mr-1 mb-1 zx:sprite-revert-to-two-tone",r.join(" "))})})},hr:function(){return f.jsx("hr",{className:"bg-metallicBlue zx:bg-zxWhite h-half mb-half border-none"})}},bS=({markdown:t,className:e})=>f.jsx("div",{className:`contents ${e}`,children:f.jsx(yS,{customComponents:vS,markdown:t})}),Ll=({triggerContent:t,tooltipContent:e})=>e?f.jsxs(fS,{children:[f.jsx(Yp,{asChild:!0,children:t}),f.jsx(Zp,{children:f.jsx(Ns,{scaleFactor:2,children:f.jsx(Qp,{side:"bottom",align:"end",className:"bg-highlightBeige text-white p-1 mt-oneScaledPix drop-shadow-oneBlock z-popups",children:typeof e=="string"?f.jsx("div",{className:"max-w-16",children:f.jsx(bS,{markdown:e})}):e})})})]}):t,Wt=({className:t,selected:e,disabled:n=!1,onClick:r,ref:o,tooltipContent:s,...i})=>{const a=f.jsx("button",{disabled:n,onClick:r,"data-selected":e,className:Te(`inline-flex items-center justify-center whitespace-nowrap 
          bg-metallicBlue zx:bg-zxBlue border-none border-shadow
          gap-2
           disabled:bg-midGrey disabled:text-lightGrey 
           data-[selected=true]:bg-lightBeige
           [&:not(:disabled):hover:not([data-selected=true])]:bg-pastelBlue 
           `,t),ref:o,...i});return f.jsx(Ll,{triggerContent:a,tooltipContent:s})};var uu=!1,dn,ka,Ea,ns,rs,nm,os,Pa,Ta,Aa,rm,Ra,Ia,om,sm;function Me(){if(!uu){uu=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),n=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(Ra=/\b(iPhone|iP[ao]d)/.exec(t),Ia=/\b(iP[ao]d)/.exec(t),Aa=/Android/i.exec(t),om=/FBAN\/\w+;/i.exec(t),sm=/Mobile/i.exec(t),rm=!!/Win64/.exec(t),e){dn=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN,dn&&document&&document.documentMode&&(dn=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(t);nm=r?parseFloat(r[1])+4:dn,ka=e[2]?parseFloat(e[2]):NaN,Ea=e[3]?parseFloat(e[3]):NaN,ns=e[4]?parseFloat(e[4]):NaN,ns?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),rs=e&&e[1]?parseFloat(e[1]):NaN):rs=NaN}else dn=ka=Ea=rs=ns=NaN;if(n){if(n[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);os=o?parseFloat(o[1].replace("_",".")):!0}else os=!1;Pa=!!n[2],Ta=!!n[3]}else os=Pa=Ta=!1}}var Oa={ie:function(){return Me()||dn},ieCompatibilityMode:function(){return Me()||nm>dn},ie64:function(){return Oa.ie()&&rm},firefox:function(){return Me()||ka},opera:function(){return Me()||Ea},webkit:function(){return Me()||ns},safari:function(){return Oa.webkit()},chrome:function(){return Me()||rs},windows:function(){return Me()||Pa},osx:function(){return Me()||os},linux:function(){return Me()||Ta},iphone:function(){return Me()||Ra},mobile:function(){return Me()||Ra||Ia||Aa||sm},nativeApp:function(){return Me()||om},android:function(){return Me()||Aa},ipad:function(){return Me()||Ia}},wS=Oa,xS=!!(typeof window<"u"&&window.document&&window.document.createElement),_S={canUseDOM:xS},im=_S,am;im.canUseDOM&&(am=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);function SS(t,e){if(!im.canUseDOM||e&&!("addEventListener"in document))return!1;var n="on"+t,r=n in document;if(!r){var o=document.createElement("div");o.setAttribute(n,"return;"),r=typeof o[n]=="function"}return!r&&am&&t==="wheel"&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var CS=SS,du=10,hu=40,fu=800;function lm(t){var e=0,n=0,r=0,o=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*du,o=n*du,"deltaY"in t&&(o=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||o)&&t.deltaMode&&(t.deltaMode==1?(r*=hu,o*=hu):(r*=fu,o*=fu)),r&&!e&&(e=r<1?-1:1),o&&!n&&(n=o<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:o}}lm.getEventType=function(){return wS.firefox()?"DOMMouseScroll":CS("wheel")?"wheel":"mousewheel"};var kS=lm;/**
* Checks if an event is supported in the current execution environment.
*
* NOTE: This will not work correctly for non-generic events such as `change`,
* `reset`, `load`, `error`, and `select`.
*
* Borrows from Modernizr.
*
* @param {string} eventNameSuffix Event name, e.g. "click".
* @param {?boolean} capture Check if the capture phase is supported.
* @return {boolean} True if the event is supported.
* @internal
* @license Modernizr 3.0.0pre (Custom Build) | MIT
*/const ES=(t,e,n=!1)=>{const r=p.useRef(0),o=p.useCallback(s=>{if(n)return;const i=s;i.preventDefault(),i.stopPropagation();const a=kS(i);r.current-=a.spinY,r.current>=1&&(e(1),r.current=0),r.current<=-1&&(e(-1),r.current=0)},[e,n]);p.useEffect(()=>{const s=t.current;if(s!==null)return s.addEventListener("wheel",o,{passive:!1}),()=>{s.removeEventListener("wheel",o)}},[t,o])},cm=(t,e,n,r=!1)=>{const o=p.useRef(0);return ES(t,s=>{if(e.length===0)return;const i=(o.current+s+256*e.length)%e.length;o.current=i,n(e[i],i)},r)},PS=({value:t,onSelect:e})=>f.jsx(Ds,{value:t,onSelect:e,className:"px-1",children:f.jsx(D,{children:t})}),Fs=t=>{const{value:e,values:n,onSelect:r,triggerButtonClassName:o="",triggerButtonStyle:s=de,triggerButtonLabel:i="",OptionCommandItem:a=PS,tooltipContent:l}=t,[c,u]=p.useState(!1),d=p.useRef(null);return cm(d,n,h=>{r(h)},!c),f.jsxs(np,{open:c,onOpenChange:u,children:[f.jsx(rp,{asChild:!0,children:f.jsxs(Wt,{className:Te("h-2 px-1 flex flex-row gap-1 justify-start leading-none",o),style:s,ref:d,tooltipContent:!c&&l,children:[typeof i=="string"?f.jsx(D,{className:"grow overflow-hidden text-left",children:i}):i,f.jsx(D,{className:"grow-0",children:c?"X":"⬇"})]})}),f.jsx(op,{className:"p-0",children:f.jsx(Ns,{scaleFactor:2,children:f.jsxs(Cp,{value:e,className:"w-[--radix-popper-anchor-width]",children:[t.disableCommandInput===!0?null:f.jsx(kp,{placeholder:t.placeholder}),f.jsxs(Ep,{children:[f.jsx(Pp,{children:f.jsx(D,{children:"Nothing found"})}),f.jsx(Tp,{children:n.map(h=>f.jsx(a,{value:h,onSelect:m=>{u(!1),r(m)}},h))})]})]})})})]})},TS=()=>{const t=He(),e=oh();return f.jsx(f.Fragment,{children:f.jsx(Fs,{value:e,values:Qg,onSelect:n=>{t(ey(n))},disableCommandInput:!0,triggerButtonLabel:e,triggerButtonClassName:"w-13"})})};function um({campaign:t,onSelect:e,headRoomId:n,heelsRoomId:r,value:o,triggerButtonClassName:s,excludeRoomIds:i=[],tooltipContent:a}){const l=Object.keys(t.rooms).filter(c=>!i.includes(c));return f.jsx(Fs,{onSelect:c=>e?.(c),value:o,values:l,triggerButtonClassName:s,placeholder:"search",tooltipContent:a,disableCommandInput:!1,triggerButtonLabel:o??"none",OptionCommandItem:({value:c,onSelect:u})=>f.jsxs(Ds,{value:c,onSelect:u,className:"px-1",children:[n===c&&f.jsx("span",{className:"sprite mr-1 my-1 texture-head_walking_towards_2"}),r===c&&f.jsx("span",{className:"sprite mr-1 my-1 texture-heels_walking_towards_2"}),f.jsx(D,{children:c})]})})}const ge=t=>t,dm="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",AS="h-[calc(2*var(--block)-1px*var(--scale))] w-[calc(2*var(--block)-1px*var(--scale))]",W=ge("[button:not([data-selected=true]):not(:hover)_&]:sprite-revert-to-two-tone-dim"),Ae=ge("flex flex-wrap gap-oneScaledPix w-full"),RS=/^(?<modifiers>[⇧⌘^]*)(?<key>.+)$/,IS=t=>{const e=new Set;for(const n of t){if(e.has(n))return!0;e.add(n)}return!1},Bl=(t,e,n)=>{const r=t?.join(" ");p.useEffect(()=>{if(!t||t.length===0)return;const o=s=>{if(s.target.closest(".monaco-editor")===null)for(const l of t){const c=l.match(RS);if(!c||!c.groups)continue;const{modifiers:u,key:d}=c.groups;if(IS(u)){console.warn(`Invalid shortcut "${l}": duplicate modifiers`);continue}const h=u.includes("^"),m=u.includes("⌘"),g=u.includes("⇧"),y=h||m||g,v=h===s.ctrlKey&&m===s.metaKey&&g===s.shiftKey&&(y||!s.ctrlKey&&!s.metaKey&&!s.shiftKey);if(s.key.toLowerCase()===d.toLowerCase()&&v){e||n?.(),s.preventDefault();break}}};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e,n,r])},ye=({className:t,onClick:e,children:n,disabled:r=!1,isCurrentTool:o=!1,shortcutKeys:s,small:i=!1,tooltipContent:a})=>(Bl(s,r,e),f.jsx(Wt,{disabled:r,selected:o,className:`
        ${i?AS:dm} 
        active:pt-oneScaledPix gap-0 inline-flex overflow-hidden 
        
        ${t??""}`,onClick:e,tooltipContent:a,children:n})),OS=()=>{const t=he(e=>e.levelEditor.selectedJsonItemIds.length>0);return f.jsx(ye,{className:"bg-midRed",disabled:!t,onClick:()=>U.dispatch(Ny()),shortcutKeys:["Delete","Backspace"],tooltipContent:`## Delete items
delete selected item(s)

Hotkey: **Delete** or **Backspace**`,children:f.jsx("span",{className:"sprite sprite-tinted texture-hud_char_X relative"})})},vr=({className:t,value:e,onChange:n,trueLabel:r="ON",falseLabel:o="OFF",label:s,shortcutKeys:i,tooltipContent:a})=>{const l=Math.max(r.length,o.length)+1,c=r.padStart(l," "),u=o.padEnd(l," ");Bl(i,!1,()=>{n?.(!e,void 0)});const d=f.jsxs("span",{onClick:h=>n?.(!e,h),className:Te("inline-flex justify-between",t),children:[s&&f.jsx(D,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),f.jsx(D,{className:Pl("inline-block w-min h-min",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:e?c:u})]});return f.jsx(Ll,{triggerContent:d,tooltipContent:a})},jS=({className:t,value:e,onChange:n,values:r,valueLabels:o=[`${r[0]}`,`${r[1]}`,`${r[2]}`],label:s,shortcutKeys:i,tooltipContent:a})=>{const l=r.indexOf(e),c=Math.max(o[0].length,o[1].length+2,o[2].length)+1,u=p.useCallback(()=>{const h=(l+1)%3;n?.(r[h],void 0)},[n,l,r]);Bl(i,!1,()=>{u()});const d=f.jsxs("span",{onClick:u,className:Te("inline-flex justify-between",t),children:[s&&f.jsx(D,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),f.jsx(D,{className:Pl("inline-block w-min h-min",l===0?"bg-redShadowHalfbrite text-highlightBeige zx:bg-zxBlack zx:text-zxGreen":l===1?"bg-metallicBlueHalfbrite text-pastelBlue zx:bg-zxBlack zx:text-zxBlue":"bg-pinkHalfbrite text-pink zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:l===0?o[0].padEnd(c," "):l===1?` ${o[1].padStart(Math.floor((c-o[1].length-2)/2)+o[1].length," ").padEnd(c-1," ")} `:o[2].padStart(c," ")})]});return f.jsx(Ll,{triggerContent:d,tooltipContent:a})},$S=({className:t})=>{const e=He();return f.jsx(jS,{className:t,label:"snap",values:zy,value:he(n=>n.levelEditor.gridResolution),onChange:n=>{e(Dy(n))},valueLabels:["block","half","2px"],shortcutKeys:["S"],tooltipContent:`snaps to either the grid (like the original game)

or, allows placing on a half-block grid, or to 2px resolution

hotkey: **S**
`})},hm=t=>{const e=he(pn);return Ge(e?.type==="item"&&e.item,t)},j=({itemTool:t,children:e,className:n,shortcutKeys:r,tooltipContent:o})=>{const s=hm(t);return f.jsx(ye,{isCurrentTool:s,className:n,onClick:()=>U.dispatch(vn({type:"item",item:t})),shortcutKeys:r,tooltipContent:o,children:e})},Fl=({main:t,children:e,closeOnSelect:n,ref:r})=>{const[o,s]=p.useState(!1);return f.jsxs(np,{open:o,onOpenChange:s,children:[f.jsx("div",{ref:r,className:Te(dm,"relative",{"drop-shadow-oneBlock z-popups":o}),children:f.jsxs("span",{className:"content",children:[t,f.jsx(rp,{asChild:!0,children:f.jsx(Wt,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:f.jsx(D,{className:"pl-oneScaledPix leading-none py-oneScaledPix",children:o?"X":"⬇"})})})]})}),f.jsx(op,{children:f.jsx(Ns,{scaleFactor:2,children:f.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:e.map((i,a)=>i===null?null:f.jsx("div",{className:"leading-none",onClick:()=>{n&&s(!1)},children:i},a))})})})]})},Dr=({children:t})=>{const[e,n]=p.useState(0),r=p.useRef(null);cm(r,t,(s,i)=>{n(i)});const o=t[e];return f.jsx(Fl,{main:o,closeOnSelect:!0,ref:r,children:t.map((s,i)=>i===e?null:f.jsx("div",{className:"leading-none",onClick:()=>{n(i)},children:s},i))})},NS=()=>{const e=he(pn)?.type==="pointer";return f.jsx(ye,{onClick:()=>U.dispatch(vn({type:"pointer"})),isCurrentTool:e,shortcutKeys:["Escape","."],tooltipContent:`## Pointer
hotkey: **Esc** or **.**`,children:f.jsx("span",{className:"sprite texture-editor_tool_pointer relative"})})},$={pureBlack:new J("#000000"),shadow:new J("#325149"),midGrey:new J("#7F7773"),lightGrey:new J("#BBB1AB"),white:new J("#FBFEFB"),pastelBlue:new J("#75ACFF"),metallicBlue:new J("#366CAA"),pink:new J("#D68ED1"),moss:new J("#9E9600"),redShadow:new J("#805E50"),midRed:new J("#CA7463"),lightBeige:new J("#DAA78F"),highlightBeige:new J("#EBC690"),alpha:new J("#1E7790"),replaceLight:new J("#08A086"),replaceDark:new J("#0A4730")},Xr=.33,fm=t=>{const[e,n,r]=t.toUint8RgbArray();return new J({r:e*.75,g:n*.75,b:r*.75})},br=(t,e=Xr)=>{const[n,r,o]=t.toUint8RgbArray();return new J({r:n*e,g:r*e,b:o*e})};function nI(t){t=t.replace(/^#/,"");let e=parseInt(t.substring(0,2),16),n=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16);e=Math.floor(e*Xr),n=Math.floor(n*Xr),r=Math.floor(r*Xr);const o=s=>s.toString(16).padStart(2,"0");return`#${o(e)}${o(n)}${o(r)}`}const Ze={original:new J(Cr.zxWhite),basic:$.white,dimmed:$.lightGrey},Qe={original:new J(Cr.zxYellow),basic:new J(15654246),dimmed:br(new J(15654246),.5)},pm={original:new J(Cr.zxYellow),basic:$.midRed,dimmed:$.redShadow},ct={original:new J(Cr.zxMagenta),basic:$.pink,dimmed:br($.pink,.5)},_e={original:new J(Cr.zxCyan),basic:$.pastelBlue,dimmed:br($.pastelBlue,.5)},ut={original:new J(Cr.zxGreen),basic:$.moss,dimmed:br($.moss,.5)},Us={white:{basic:{main:Ze,edges:{towards:{..._e,dimInOriginal:!1},right:{...Qe,dimInOriginal:!0}},hud:{lives:Qe,dimmed:ct,icons:_e}},dimmed:{main:Ze,edges:{towards:{...ut,dimInOriginal:!1},right:{..._e,dimInOriginal:!0}},hud:{lives:pm,dimmed:ct,icons:_e}}},yellow:{basic:{main:Qe,edges:{towards:{...ut,dimInOriginal:!1},right:{...Ze,dimInOriginal:!0}},hud:{lives:_e,dimmed:ct,icons:ut}},dimmed:{main:Qe,edges:{towards:{..._e,dimInOriginal:!0},right:{..._e,dimInOriginal:!1}},hud:{lives:_e,dimmed:ct,icons:ut}}},magenta:{basic:{main:ct,edges:{towards:{...ut,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Ze,dimmed:_e,icons:Qe}},dimmed:{main:ct,edges:{towards:{...ut,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Ze,dimmed:_e,icons:Qe}}},cyan:{basic:{main:_e,edges:{towards:{...ct,dimInOriginal:!1},right:{...Ze,dimInOriginal:!1}},hud:{lives:Ze,dimmed:ut,icons:Qe}},dimmed:{main:_e,edges:{towards:{...ct,dimInOriginal:!0},right:{...Ze,dimInOriginal:!0}},hud:{lives:Ze,dimmed:ut,icons:Qe}}},green:{basic:{main:ut,edges:{towards:{..._e,dimInOriginal:!1},right:{...Qe,dimInOriginal:!1}},hud:{lives:Ze,dimmed:ct,icons:_e}},dimmed:{main:ut,edges:{towards:{..._e,dimInOriginal:!0},right:{...Qe,dimInOriginal:!0}},hud:{lives:Ze,dimmed:ct,icons:_e}}}},bs=t=>Us[t.hue][t.shade],nr={head:$.pastelBlue,heels:$.pink},pu=t=>{const{main:e}=Us[t].basic;return{backgroundColor:e.basic.toHex(),borderColor:e.dimmed.toHex()}};function zS(){const t=He(),e=he(My);return f.jsxs(f.Fragment,{children:[f.jsx(Fs,{value:e.hue,onSelect:n=>{t(sc({hue:n}))},values:ty,disableCommandInput:!0,OptionCommandItem:({value:n,onSelect:r})=>f.jsx(Ds,{value:n,className:"border-l-3 h-2 w-full p-0",style:pu(n),onSelect:r}),triggerButtonLabel:"colour",triggerButtonClassName:Te("w-full",`${e.hue==="white"||e.hue==="yellow"?"text-pureBlack":"text-white"}`),triggerButtonStyle:pu(e.hue),tooltipContent:"Change the colour of this room"}),f.jsx(vr,{className:"",label:"shade",value:e.shade==="basic",onChange:n=>{t(sc({shade:n?"basic":"dimmed"}))},falseLabel:"dim",trueLabel:"basic"})]})}function DS(){const t=He(),e=he(Ly);return f.jsx(Fs,{value:e,onSelect:n=>{t(By(n))},values:ny,placeholder:"scenery",triggerButtonClassName:"w-full",triggerButtonLabel:e,tooltipContent:"Change this room’s scenery"})}const St=({iconClasses:t,text:e,className:n=""})=>f.jsxs("div",{className:`relative w-full h-full ${n}`,children:[f.jsx("span",{className:`sprite absolute top-0 left-0 ${t} ${W}`}),f.jsx(D,{className:"bg-moss text-pureBlack absolute top-0 left-0 pl-oneScaledPix py-oneScaledPix block leading-none",children:e})]}),Fo=({iconClassName:t})=>f.jsx(Ct,{topClasses:ge("texture-bubbles_white_2 [button:hover_&]:texture-animated-bubbles_white"),bottomClasses:t}),Ct=({topClasses:t,bottomClasses:e="texture-headlessBase"})=>f.jsxs("div",{className:"relative w-full h-full",children:[f.jsx("span",{className:`sprite absolute top-[calc(9px*var(--scale))] left-0 ${e} ${W}`}),f.jsx("span",{className:`sprite absolute top-[calc(-3px*var(--scale))] left-0 ${t} ${W}`})]}),MS="[button:not(:disabled):hover_&]:hidden",LS="hidden [button:not(:disabled):hover_&]:inline mt-quarter",BS="hidden [button:not(:disabled):hover_&]:inline",ja=({icon:t,topText:e,bottomText:n})=>f.jsxs("span",{className:"w-full h-full flex flex-col items-center justify-center",children:[f.jsx("span",{className:MS,children:t}),f.jsx(D,{className:LS,children:e}),f.jsx(D,{className:BS,children:n})]}),FS=()=>{const t=He(),e=he(Fy),n=he(Uy);return f.jsxs("div",{className:"flex flex-row gap-oneScaledPix bg-metallicBlue",children:[f.jsx(ye,{disabled:!e,onClick:()=>{t(Hy())},shortcutKeys:["⌘Z","^Z"],children:f.jsx(ja,{icon:f.jsx(D,{children:"⬅"}),topText:"un",bottomText:"do"})}),f.jsx(ye,{disabled:!n,onClick:()=>{t(Wy())},shortcutKeys:["⌘⇧Z","^⇧Z"],children:f.jsx(ja,{icon:f.jsx(D,{children:"➡"}),topText:"re",bottomText:"do"})})]})},US=({className:t})=>{const e=He();return f.jsx(vr,{className:t,label:"scenery",value:he(n=>n.levelEditor.wallsFloorsLocked),onChange:n=>{e(Gy(n))},falseLabel:"edit",trueLabel:"lock",shortcutKeys:["C"],tooltipContent:`locks walls and floors, to edit their contents

hotkey: **C**
`})};function mu(t){return{type:"door",config:{direction:"away",toRoom:t?"+":"nowhere"}}}const HS=()=>{const[t,e]=p.useState(!0),n=he(i=>hr(i).planet),r=ge(n==="moonbase"?"texture-door_frame_moonbase_x_whole":"texture-door_frame_generic_x_whole"),o=mu(t),s=hm(o);return f.jsx(Fl,{main:f.jsx(j,{itemTool:o,shortcutKeys:["D"],children:f.jsx(St,{iconClasses:`sprite top-[calc(-17px*var(--scale))] left-[calc(-2px*var(--scale))] ${r} ${W}`,text:t?"+":""})}),children:[f.jsx(vr,{className:"w-full",value:t,label:"auto + room",onChange:i=>{e(i),s&&U.dispatch(vn({type:"item",item:mu(i)}))}},"autoAddDoor")]})},WS=()=>{const t=he(r=>hr(r).planet),e={type:"wall",config:{direction:"away",tiles:Array.from(qy(t,1))}},n=ge(t==="blacktooth"?"texture-blacktooth_wall_plain_away":t==="bookworld"?"texture-bookworld_wall_cowboy_away":t==="jail"?"texture-jail_wall_bars_away":t==="egyptus"?"texture-egyptus_wall_hieroglyphics_away":t==="market"?"texture-market_wall_passage_away":t==="moonbase"?"texture-moonbase_wall_window1_away":t==="penitentiary"?"texture-penitentiary_wall_loop_away":"texture-safari_wall_wall_away");return f.jsx(j,{itemTool:e,children:f.jsx("span",{className:`sprite ${n} ${W}`})})},GS=()=>f.jsx(ye,{className:"bg-midRed",onClick:()=>U.dispatch(Vy()),tooltipContent:`## Clear room

Clears the room out, leaving just walls, floors, and doors`,children:f.jsx(D,{className:"relative leading-none",children:"CLR"})}),mm=({currentRoomId:t,direction:e})=>{const n=he(({levelEditor:s})=>s.campaignInProgress),r=he(({levelEditor:s})=>s.currentlyEditingRoomId),o=He();return f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap pt-1",children:[f.jsxs(D,{className:"text-lightGrey leading-none",children:["Room ",e==="above"?"⬆":"⬇"]}),f.jsx("div",{className:"flex-grow"}),f.jsxs("div",{className:"flex flex-row gap-oneScaledPix",children:[f.jsx(Wt,{className:"w-2 leading-none bg-moss",tooltipContent:`Add a new room *${e}* this one`,children:f.jsx(D,{onClick:()=>o(ri({direction:e,createNew:!0})),children:"+"})}),f.jsx(Wt,{className:"w-2 leading-none bg-midRed",tooltipContent:`Break the link with the room *${e}*`,children:f.jsx(D,{onClick:()=>o(ri({direction:e,createNew:!1,roomId:void 0})),children:"x"})})]})]}),f.jsx("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap",children:f.jsx(um,{value:t,campaign:n,excludeRoomIds:[r],triggerButtonClassName:"w-full",onSelect:s=>{o(ri({direction:e,createNew:!1,roomId:s}))},tooltipContent:`Select a room to place *${e}* this one`})})]})},qS=()=>{const t=he(({levelEditor:e})=>dh(e).roomAbove);return f.jsx(f.Fragment,{children:f.jsx(mm,{currentRoomId:t,direction:"above"})})},VS=()=>{const t=he(({levelEditor:e})=>dh(e).roomBelow);return f.jsx(f.Fragment,{children:f.jsx(mm,{currentRoomId:t,direction:"below"})})},KS=()=>{const t=he(({levelEditor:e})=>e.tool.type==="eyeDropper");return f.jsx(ye,{shortcutKeys:["I",","],isCurrentTool:t,onClick:()=>U.dispatch(vn({type:"eyeDropper"})),tooltipContent:`## eye-dropper

click on an item in the room to copy it and put a copy down somewhere else
  
hotkey: **I** or **,**`,children:f.jsx("span",{className:"relative sprite texture-editor_tool_eyedropper leading-none"})})},Hs=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const XS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ur=Array.prototype.slice.call(XS),Uo=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(Ur),JS=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ss=String.fromCharCode.bind(String),gu=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),YS=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),gm=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),ZS=t=>{let e,n,r,o,s="";const i=t.length%3;for(let a=0;a<t.length;){if((n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(o=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|o,s+=Ur[e>>18&63]+Ur[e>>12&63]+Ur[e>>6&63]+Ur[e&63]}return i?s.slice(0,i-3)+"===".substring(i):s},QS=typeof btoa=="function"?t=>btoa(t):Hs?t=>Buffer.from(t,"binary").toString("base64"):ZS,yu=Hs?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let r=0,o=t.length;r<o;r+=4096)n.push(ss.apply(null,t.subarray(r,r+4096)));return QS(n.join(""))},eC=(t,e=!1)=>e?YS(yu(t)):yu(t),tC=t=>{if(t=t.replace(/\s+/g,""),!JS.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,o;for(let s=0;s<t.length;)e=Uo[t.charAt(s++)]<<18|Uo[t.charAt(s++)]<<12|(r=Uo[t.charAt(s++)])<<6|(o=Uo[t.charAt(s++)]),n+=r===64?ss(e>>16&255):o===64?ss(e>>16&255,e>>8&255):ss(e>>16&255,e>>8&255,e&255);return n},nC=typeof atob=="function"?t=>atob(gm(t)):Hs?t=>Buffer.from(t,"base64").toString("binary"):tC,rC=Hs?t=>gu(Buffer.from(t,"base64")):t=>gu(nC(t).split("").map(e=>e.charCodeAt(0))),oC=t=>rC(sC(t)),sC=t=>gm(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),iC=!0,ym="gzip",vm=async t=>{const e=JSON.stringify(t),r=new TextEncoder().encode(e),o=new Blob([r]),s=new CompressionStream(ym),i=o.stream().pipeThrough(s),a=await new Response(i).arrayBuffer(),l=new Uint8Array(a);return eC(l,iC)},aC=async t=>{try{const e=oC(t),n=new Blob([e]),r=new DecompressionStream(ym),o=n.stream().pipeThrough(r),s=await new Response(o).text();return JSON.parse(s)}catch(e){throw new Error("error decompressing object",{cause:e})}},lC=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Gt(async()=>{const{default:r}=await Promise.resolve().then(()=>Ar);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)};class Ul extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class cC extends Ul{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class vu extends Ul{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class bu extends Ul{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var $a;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})($a||($a={}));var uC=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class dC{constructor(e,{headers:n={},customFetch:r,region:o=$a.Any}={}){this.url=e,this.headers=n,this.region=o,this.fetch=lC(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,n={}){var r;return uC(this,void 0,void 0,function*(){try{const{headers:o,method:s,body:i}=n;let a={},{region:l}=n;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(a["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:u}).catch(y=>{throw new cC(y)}),h=d.headers.get("x-relay-error");if(h&&h==="true")throw new vu(d);if(!d.ok)throw new bu(d);let m=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return m==="application/json"?g=yield d.json():m==="application/octet-stream"?g=yield d.blob():m==="text/event-stream"?g=d:m==="multipart/form-data"?g=yield d.formData():g=yield d.text(),{data:g,error:null,response:d}}catch(o){return{data:null,error:o,response:o instanceof bu||o instanceof vu?o.context:void 0}}})}}var Se={},Dn={},Mn={},Ln={},Bn={},Fn={},hC=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},wr=hC();const fC=wr.fetch,bm=wr.fetch.bind(wr),wm=wr.Headers,pC=wr.Request,mC=wr.Response,Ar=Object.freeze(Object.defineProperty({__proto__:null,Headers:wm,Request:pC,Response:mC,default:bm,fetch:fC},Symbol.toStringTag,{value:"Module"})),gC=ry(Ar);var Ho={},wu;function xm(){if(wu)return Ho;wu=1,Object.defineProperty(Ho,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return Ho.default=t,Ho}var xu;function _m(){if(xu)return Fn;xu=1;var t=Fn&&Fn.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Fn,"__esModule",{value:!0});const e=t(gC),n=t(xm());class r{constructor(s){this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=s.headers,this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=s.shouldThrowOnError,this.signal=s.signal,this.isMaybeSingle=s.isMaybeSingle,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=Object.assign({},this.headers),this.headers[s]=i,this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,h;let m=null,g=null,y=null,v=c.status,b=c.statusText;if(c.ok){if(this.method!=="HEAD"){const C=await c.text();C===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=C:g=JSON.parse(C))}const w=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),x=(d=c.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");w&&x&&x.length>1&&(y=parseInt(x[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(m={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,y=null,v=406,b="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const w=await c.text();try{m=JSON.parse(w),Array.isArray(m)&&c.status===404&&(g=[],m=null,v=200,b="OK")}catch{c.status===404&&w===""?(v=204,b="No Content"):m={message:w}}if(m&&this.isMaybeSingle&&(!((h=m?.details)===null||h===void 0)&&h.includes("0 rows"))&&(m=null,v=200,b="OK"),m&&this.shouldThrowOnError)throw new n.default(m)}return{error:m,data:g,count:y,status:v,statusText:b}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,h;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(d=c?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(h=c?.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,i)}returns(){return this}overrideTypes(){return this}}return Fn.default=r,Fn}var _u;function Sm(){if(_u)return Bn;_u=1;var t=Bn&&Bn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Bn,"__esModule",{value:!0});const e=t(_m());class n extends e.default{select(o){let s=!1;const i=(o??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(o,{ascending:s=!0,nullsFirst:i,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${o}.${s?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:s,referencedTable:i=s}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${o}`),this}range(o,s,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${o}`),this.url.searchParams.set(c,`${s-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:o=!1,verbose:s=!1,settings:i=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[o?"analyze":null,s?"verbose":null,i?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),h=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${h}"; options=${d};`,c==="json"?this:this}rollback(){var o;return((o=this.headers.Prefer)!==null&&o!==void 0?o:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Bn.default=n,Bn}var Su;function Hl(){if(Su)return Ln;Su=1;var t=Ln&&Ln.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ln,"__esModule",{value:!0});const e=t(Sm());class n extends e.default{eq(o,s){return this.url.searchParams.append(o,`eq.${s}`),this}neq(o,s){return this.url.searchParams.append(o,`neq.${s}`),this}gt(o,s){return this.url.searchParams.append(o,`gt.${s}`),this}gte(o,s){return this.url.searchParams.append(o,`gte.${s}`),this}lt(o,s){return this.url.searchParams.append(o,`lt.${s}`),this}lte(o,s){return this.url.searchParams.append(o,`lte.${s}`),this}like(o,s){return this.url.searchParams.append(o,`like.${s}`),this}likeAllOf(o,s){return this.url.searchParams.append(o,`like(all).{${s.join(",")}}`),this}likeAnyOf(o,s){return this.url.searchParams.append(o,`like(any).{${s.join(",")}}`),this}ilike(o,s){return this.url.searchParams.append(o,`ilike.${s}`),this}ilikeAllOf(o,s){return this.url.searchParams.append(o,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(o,s){return this.url.searchParams.append(o,`ilike(any).{${s.join(",")}}`),this}is(o,s){return this.url.searchParams.append(o,`is.${s}`),this}in(o,s){const i=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(o,`in.(${i})`),this}contains(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cs.{${s.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(s)}`),this}containedBy(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cd.{${s.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(s)}`),this}rangeGt(o,s){return this.url.searchParams.append(o,`sr.${s}`),this}rangeGte(o,s){return this.url.searchParams.append(o,`nxl.${s}`),this}rangeLt(o,s){return this.url.searchParams.append(o,`sl.${s}`),this}rangeLte(o,s){return this.url.searchParams.append(o,`nxr.${s}`),this}rangeAdjacent(o,s){return this.url.searchParams.append(o,`adj.${s}`),this}overlaps(o,s){return typeof s=="string"?this.url.searchParams.append(o,`ov.${s}`):this.url.searchParams.append(o,`ov.{${s.join(",")}}`),this}textSearch(o,s,{config:i,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=i===void 0?"":`(${i})`;return this.url.searchParams.append(o,`${l}fts${c}.${s}`),this}match(o){return Object.entries(o).forEach(([s,i])=>{this.url.searchParams.append(s,`eq.${i}`)}),this}not(o,s,i){return this.url.searchParams.append(o,`not.${s}.${i}`),this}or(o,{foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${o})`),this}filter(o,s,i){return this.url.searchParams.append(o,`${s}.${i}`),this}}return Ln.default=n,Ln}var Cu;function Cm(){if(Cu)return Mn;Cu=1;var t=Mn&&Mn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Mn,"__esModule",{value:!0});const e=t(Hl());class n{constructor(o,{headers:s={},schema:i,fetch:a}){this.url=o,this.headers=s,this.schema=i,this.fetch=a}select(o,{head:s=!1,count:i}={}){const a=s?"HEAD":"GET";let l=!1;const c=(o??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),i&&(this.headers.Prefer=`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(o,{count:s,defaultToNull:i=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(o)){const c=o.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}upsert(o,{onConflict:s,ignoreDuplicates:i=!1,count:a,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${i?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(o)){const d=o.reduce((h,m)=>h.concat(Object.keys(m)),[]);if(d.length>0){const h=[...new Set(d)].map(m=>`"${m}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}update(o,{count:s}={}){const i="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}delete({count:o}={}){const s="DELETE",i=[];return o&&i.push(`count=${o}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Mn.default=n,Mn}var Mr={},Lr={},ku;function yC(){return ku||(ku=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.version=void 0,Lr.version="0.0.0-automated"),Lr}var Eu;function vC(){if(Eu)return Mr;Eu=1,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.DEFAULT_HEADERS=void 0;const t=yC();return Mr.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${t.version}`},Mr}var Pu;function bC(){if(Pu)return Dn;Pu=1;var t=Dn&&Dn.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Dn,"__esModule",{value:!0});const e=t(Cm()),n=t(Hl()),r=vC();class o{constructor(i,{headers:a={},schema:l,fetch:c}={}){this.url=i,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new o(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:l=!1,get:c=!1,count:u}={}){let d;const h=new URL(`${this.url}/rpc/${i}`);let m;l||c?(d=l?"HEAD":"GET",Object.entries(a).filter(([y,v])=>v!==void 0).map(([y,v])=>[y,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([y,v])=>{h.searchParams.append(y,v)})):(d="POST",m=a);const g=Object.assign({},this.headers);return u&&(g.Prefer=`count=${u}`),new n.default({method:d,url:h,headers:g,schema:this.schemaName,body:m,fetch:this.fetch,allowEmpty:!1})}}return Dn.default=o,Dn}var Tu;function wC(){if(Tu)return Se;Tu=1;var t=Se&&Se.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Se,"__esModule",{value:!0}),Se.PostgrestError=Se.PostgrestBuilder=Se.PostgrestTransformBuilder=Se.PostgrestFilterBuilder=Se.PostgrestQueryBuilder=Se.PostgrestClient=void 0;const e=t(bC());Se.PostgrestClient=e.default;const n=t(Cm());Se.PostgrestQueryBuilder=n.default;const r=t(Hl());Se.PostgrestFilterBuilder=r.default;const o=t(Sm());Se.PostgrestTransformBuilder=o.default;const s=t(_m());Se.PostgrestBuilder=s.default;const i=t(xm());return Se.PostgrestError=i.default,Se.default={PostgrestClient:e.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:s.default,PostgrestError:i.default},Se}var xC=wC();const _C=It(xC),{PostgrestClient:SC,PostgrestQueryBuilder:rI,PostgrestFilterBuilder:oI,PostgrestTransformBuilder:sI,PostgrestBuilder:iI,PostgrestError:aI}=_C;function CC(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const kC=CC(),EC="2.11.15",PC=`realtime-js/${EC}`,TC="1.0.0",km=1e4,AC=1e3;var Jr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Jr||(Jr={}));var Re;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Re||(Re={}));var nt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(nt||(nt={}));var Na;(function(t){t.websocket="websocket"})(Na||(Na={}));var hn;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(hn||(hn={}));class RC{constructor(){this.HEADER_LENGTH=1}decode(e,n){return e.constructor===ArrayBuffer?n(this._binaryDecode(e)):n(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const n=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,n,r)}_decodeBroadcast(e,n,r){const o=n.getUint8(1),s=n.getUint8(2);let i=this.HEADER_LENGTH+2;const a=r.decode(e.slice(i,i+o));i=i+o;const l=r.decode(e.slice(i,i+s));i=i+s;const c=JSON.parse(r.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class Em{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var fe;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(fe||(fe={}));const Au=(t,e,n={})=>{var r;const o=(r=n.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,i)=>(s[i]=IC(i,t,e,o),s),{})},IC=(t,e,n,r)=>{const o=e.find(a=>a.name===t),s=o?.type,i=n[t];return s&&!r.includes(s)?Pm(s,i):za(i)},Pm=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return NC(e,n)}switch(t){case fe.bool:return OC(e);case fe.float4:case fe.float8:case fe.int2:case fe.int4:case fe.int8:case fe.numeric:case fe.oid:return jC(e);case fe.json:case fe.jsonb:return $C(e);case fe.timestamp:return zC(e);case fe.abstime:case fe.date:case fe.daterange:case fe.int4range:case fe.int8range:case fe.money:case fe.reltime:case fe.text:case fe.time:case fe.timestamptz:case fe.timetz:case fe.tsrange:case fe.tstzrange:return za(e);default:return za(e)}},za=t=>t,OC=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},jC=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},$C=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},NC=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let s;const i=t.slice(1,n);try{s=JSON.parse("["+i+"]")}catch{s=i?i.split(","):[]}return s.map(a=>Pm(e,a))}return t},zC=t=>typeof t=="string"?t.replace(" ","T"):t,Tm=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ai{constructor(e,n,r={},o=km){this.channel=e,this.event=n,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ru;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Ru||(Ru={}));class Yr{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Yr.syncState(this.state,o,s,i),this.pendingDiffs.forEach(l=>{this.state=Yr.syncDiff(this.state,l,s,i)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=Yr.syncDiff(this.state,o,s,i),a())}),this.onJoin((o,s,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:s,newPresences:i})}),this.onLeave((o,s,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:s,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,o){const s=this.cloneDeep(e),i=this.transformState(n),a={},l={};return this.map(s,(c,u)=>{i[c]||(l[c]=u)}),this.map(i,(c,u)=>{const d=s[c];if(d){const h=u.map(v=>v.presence_ref),m=d.map(v=>v.presence_ref),g=u.filter(v=>m.indexOf(v.presence_ref)<0),y=d.filter(v=>h.indexOf(v.presence_ref)<0);g.length>0&&(a[c]=g),y.length>0&&(l[c]=y)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},r,o)}static syncDiff(e,n,r,o){const{joins:s,leaves:i}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(s,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(m=>m.presence_ref),h=u.filter(m=>d.indexOf(m.presence_ref)<0);e[a].unshift(...h)}r(a,u,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,o(a,c,l),c.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const o=e[r];return"metas"in o?n[r]=o.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):n[r]=o,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Iu;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Iu||(Iu={}));var Ou;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Ou||(Ou={}));var Et;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Et||(Et={}));class Wl{constructor(e,n={config:{}},r){this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Re.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Ai(this,nt.join,this.params,this.timeout),this.rejoinTimer=new Em(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Re.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Re.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Re.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Re.errored,this.rejoinTimer.scheduleTimeout())}),this._on(nt.reply,{},(o,s)=>{this._trigger(this._replyEventName(s),o)}),this.presence=new Yr(this),this.broadcastEndpointURL=Tm(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,n=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Re.closed){const{config:{broadcast:s,presence:i,private:a}}=this.params;this._onError(u=>e?.(Et.CHANNEL_ERROR,u)),this._onClose(()=>e?.(Et.CLOSED));const l={},c={broadcast:s,presence:i,postgres_changes:(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){e?.(Et.SUBSCRIBED);return}else{const h=this.bindings.postgres_changes,m=(d=h?.length)!==null&&d!==void 0?d:0,g=[];for(let y=0;y<m;y++){const v=h[y],{filter:{event:b,schema:_,table:w,filter:x}}=v,C=u&&u[y];if(C&&C.event===b&&C.schema===_&&C.table===w&&C.filter===x)g.push(Object.assign(Object.assign({},v),{id:C.id}));else{this.unsubscribe(),this.state=Re.errored,e?.(Et.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(Et.SUBSCRIBED);return}}).receive("error",u=>{this.state=Re.errored,e?.(Et.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e?.(Et.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this._on(e,n,r)}async send(e,n={}){var r,o;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var i,a,l;const c=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Re.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(nt.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(o=>{r=new Ai(this,nt.leave,{},e),r.receive("ok",()=>{n(),o("ok")}).receive("timeout",()=>{n(),o("timed out")}).receive("error",()=>{o("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,n,r){const o=new AbortController,s=setTimeout(()=>o.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:o.signal}));return clearTimeout(s),i}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Ai(this,e,n,r);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var o,s;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=nt;if(r&&[a,l,c,u].indexOf(i)>=0&&r!==this._joinRef())return;let h=this._onMessage(i,n,r);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(m=>{var g,y,v;return((g=m.filter)===null||g===void 0?void 0:g.event)==="*"||((v=(y=m.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(m=>m.callback(h,r)):(s=this.bindings[i])===null||s===void 0||s.filter(m=>{var g,y,v,b,_,w;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in m){const x=m.id,C=(g=m.filter)===null||g===void 0?void 0:g.event;return x&&((y=n.ids)===null||y===void 0?void 0:y.includes(x))&&(C==="*"||C?.toLocaleLowerCase()===((v=n.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const x=(_=(b=m?.filter)===null||b===void 0?void 0:b.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return x==="*"||x===((w=n?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===i}).map(m=>{if(typeof h=="object"&&"ids"in h){const g=h.data,{schema:y,table:v,commit_timestamp:b,type:_,errors:w}=g;h=Object.assign(Object.assign({},{schema:y,table:v,commit_timestamp:b,eventType:_,new:{},old:{},errors:w}),this._getPayloadRecords(g))}m.callback(h,r)})}_isClosed(){return this.state===Re.closed}_isJoined(){return this.state===Re.joined}_isJoining(){return this.state===Re.joining}_isLeaving(){return this.state===Re.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const o=e.toLocaleLowerCase(),s={type:o,filter:n,callback:r};return this.bindings[o]?this.bindings[o].push(s):this.bindings[o]=[s],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(o=>{var s;return!(((s=o.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&Wl.isEqual(o.filter,n))}),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(nt.close,{},e)}_onError(e){this._on(nt.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Re.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Au(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Au(e.columns,e.old_record)),n}}const ju=()=>{},DC=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class MC{constructor(e,n){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=km,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ju,this.ref=0,this.logger=ju,this.conn=null,this.sendBuffer=[],this.serializer=new RC,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>Gt(async()=>{const{default:l}=await Promise.resolve().then(()=>Ar);return{default:l}},void 0).then(({default:l})=>l(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${Na.websocket}`,this.httpEndpoint=Tm(e),n?.transport?this.transport=n.transport:this.transport=null,n?.params&&(this.params=n.params),n?.timeout&&(this.timeout=n.timeout),n?.logger&&(this.logger=n.logger),(n?.logLevel||n?.log_level)&&(this.logLevel=n.logLevel||n.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),n?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=n.heartbeatIntervalMs);const o=(r=n?.params)===null||r===void 0?void 0:r.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=n?.reconnectAfterMs?n.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=n?.encode?n.encode:(s,i)=>i(JSON.stringify(s)),this.decode=n?.decode?n.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Em(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(n?.fetch),n?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=n?.worker||!1,this.workerUrl=n?.workerUrl}this.accessToken=n?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=kC),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:TC}))}disconnect(e,n){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,n??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Jr.connecting:return hn.Connecting;case Jr.open:return hn.Open;case Jr.closing:return hn.Closing;default:return hn.Closed}}isConnected(){return this.connectionState()===hn.Open}channel(e,n={config:{}}){const r=`realtime:${e}`,o=this.getChannels().find(s=>s.topic===r);if(o)return o;{const s=new Wl(`realtime:${e}`,n,this);return this.channels.push(s),s}}push(e){const{topic:n,event:r,payload:o,ref:s}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${s})`,o),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let n=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const o={access_token:n,version:PC};n&&r.updateJoinPayload(o),r.joinedOnce&&r._isJoined()&&r._push(nt.access_token,{access_token:n})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(AC,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,n=>{let{topic:r,event:o,payload:s,ref:i}=n;r==="phoenix"&&o==="phx_reply"&&this.heartbeatCallback(n.payload.status=="ok"?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${r} ${o} ${i&&"("+i+")"||""}`,s),Array.from(this.channels).filter(a=>a._isMember(r)).forEach(a=>a._trigger(o,s,i)),this.stateChangeCallbacks.message.forEach(a=>a(n))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(n=>n(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(n=>n(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(nt.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",o=new URLSearchParams(n);return`${e}${r}${o}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([DC],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}}class Gl extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ce(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class LC extends Gl{constructor(e,n){super(e),this.name="StorageApiError",this.status=n}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Da extends Gl{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}var BC=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const Am=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Gt(async()=>{const{default:r}=await Promise.resolve().then(()=>Ar);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},FC=()=>BC(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Gt(()=>Promise.resolve().then(()=>Ar),void 0)).Response:Response}),Ma=t=>{if(Array.isArray(t))return t.map(n=>Ma(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const o=n.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[o]=Ma(r)}),e};var On=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const Ri=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),UC=(t,e,n)=>On(void 0,void 0,void 0,function*(){const r=yield FC();t instanceof r&&!n?.noResolveJson?t.json().then(o=>{e(new LC(Ri(o),t.status||500))}).catch(o=>{e(new Da(Ri(o),o))}):e(new Da(Ri(t),t))}),HC=(t,e,n,r)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),r&&(o.body=JSON.stringify(r)),Object.assign(Object.assign({},o),n))};function bo(t,e,n,r,o,s){return On(this,void 0,void 0,function*(){return new Promise((i,a)=>{t(n,HC(e,r,o,s)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>UC(l,a,r))})})}function ws(t,e,n,r){return On(this,void 0,void 0,function*(){return bo(t,"GET",e,n,r)})}function Bt(t,e,n,r,o){return On(this,void 0,void 0,function*(){return bo(t,"POST",e,r,o,n)})}function WC(t,e,n,r,o){return On(this,void 0,void 0,function*(){return bo(t,"PUT",e,r,o,n)})}function GC(t,e,n,r){return On(this,void 0,void 0,function*(){return bo(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function Rm(t,e,n,r,o){return On(this,void 0,void 0,function*(){return bo(t,"DELETE",e,r,o,n)})}var Le=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const qC={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},$u={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class VC{constructor(e,n={},r,o){this.url=e,this.headers=n,this.bucketId=r,this.fetch=Am(o)}uploadOrUpdate(e,n,r,o){return Le(this,void 0,void 0,function*(){try{let s;const i=Object.assign(Object.assign({},$u),o);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=r,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));const c=this._removeEmptyFolders(n),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:s,headers:a},i?.duplex?{duplex:i.duplex}:{})),h=yield d.json();return d.ok?{data:{path:c,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(s){if(Ce(s))return{data:null,error:s};throw s}})}upload(e,n,r){return Le(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,o){return Le(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),i=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",n);try{let l;const c=Object.assign({upsert:$u.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),h=yield d.json();return d.ok?{data:{path:s,fullPath:h.Key},error:null}:{data:null,error:h}}catch(l){if(Ce(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,n){return Le(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const o=Object.assign({},this.headers);n?.upsert&&(o["x-upsert"]="true");const s=yield Bt(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),i=new URL(this.url+s.url),a=i.searchParams.get("token");if(!a)throw new Gl("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(r){if(Ce(r))return{data:null,error:r};throw r}})}update(e,n,r){return Le(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return Le(this,void 0,void 0,function*(){try{return{data:yield Bt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Ce(o))return{data:null,error:o};throw o}})}copy(e,n,r){return Le(this,void 0,void 0,function*(){try{return{data:{path:(yield Bt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Ce(o))return{data:null,error:o};throw o}})}createSignedUrl(e,n,r){return Le(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),s=yield Bt(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:n},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${i}`)},{data:s,error:null}}catch(o){if(Ce(o))return{data:null,error:o};throw o}})}createSignedUrls(e,n,r){return Le(this,void 0,void 0,function*(){try{const o=yield Bt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${s}`):null})),error:null}}catch(o){if(Ce(o))return{data:null,error:o};throw o}})}download(e,n){return Le(this,void 0,void 0,function*(){const o=typeof n?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(n?.transform||{}),i=s?`?${s}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield ws(this.fetch,`${this.url}/${o}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Ce(a))return{data:null,error:a};throw a}})}info(e){return Le(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield ws(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:Ma(r),error:null}}catch(r){if(Ce(r))return{data:null,error:r};throw r}})}exists(e){return Le(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield GC(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Ce(r)&&r instanceof Da){const o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),o=[],s=n?.download?`download=${n.download===!0?"":n.download}`:"";s!==""&&o.push(s);const a=typeof n?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(n?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return Le(this,void 0,void 0,function*(){try{return{data:yield Rm(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(Ce(n))return{data:null,error:n};throw n}})}list(e,n,r){return Le(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},qC),n),{prefix:e||""});return{data:yield Bt(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(Ce(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const KC="2.7.1",XC={"X-Client-Info":`storage-js/${KC}`};var Un=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class JC{constructor(e,n={},r){this.url=e,this.headers=Object.assign(Object.assign({},XC),n),this.fetch=Am(r)}listBuckets(){return Un(this,void 0,void 0,function*(){try{return{data:yield ws(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Ce(e))return{data:null,error:e};throw e}})}getBucket(e){return Un(this,void 0,void 0,function*(){try{return{data:yield ws(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(Ce(n))return{data:null,error:n};throw n}})}createBucket(e,n={public:!1}){return Un(this,void 0,void 0,function*(){try{return{data:yield Bt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Ce(r))return{data:null,error:r};throw r}})}updateBucket(e,n){return Un(this,void 0,void 0,function*(){try{return{data:yield WC(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Ce(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Un(this,void 0,void 0,function*(){try{return{data:yield Bt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(Ce(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Un(this,void 0,void 0,function*(){try{return{data:yield Rm(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(Ce(n))return{data:null,error:n};throw n}})}}class YC extends JC{constructor(e,n={},r){super(e,n,r)}from(e){return new VC(this.url,this.headers,e,this.fetch)}}const ZC="2.51.0";let Hr="";typeof Deno<"u"?Hr="deno":typeof document<"u"?Hr="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Hr="react-native":Hr="node";const QC={"X-Client-Info":`supabase-js-${Hr}/${ZC}`},ek={headers:QC},tk={schema:"public"},nk={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},rk={};var ok=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const sk=t=>{let e;return t?e=t:typeof fetch>"u"?e=bm:e=fetch,(...n)=>e(...n)},ik=()=>typeof Headers>"u"?wm:Headers,ak=(t,e,n)=>{const r=sk(n),o=ik();return(s,i)=>ok(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:t;let c=new o(i?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(s,Object.assign(Object.assign({},i),{headers:c}))})};var lk=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};function ck(t){return t.endsWith("/")?t:t+"/"}function uk(t,e){var n,r;const{db:o,auth:s,realtime:i,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,h={db:Object.assign(Object.assign({},l),o),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(n=d?.headers)!==null&&n!==void 0?n:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>lk(this,void 0,void 0,function*(){return""})};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}const Im="2.71.0",Yn=30*1e3,La=3,Ii=La*Yn,dk="http://localhost:9999",hk="supabase.auth.token",fk={"X-Client-Info":`gotrue-js/${Im}`},Ba="X-Supabase-Api-Version",Om={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},pk=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,mk=10*60*1e3;class ql extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Q(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class gk extends ql{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function yk(t){return Q(t)&&t.name==="AuthApiError"}class jm extends ql{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class nn extends ql{constructor(e,n,r,o){super(e,r,o),this.name=n,this.status=r}}class Lt extends nn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function vk(t){return Q(t)&&t.name==="AuthSessionMissingError"}class Wo extends nn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Go extends nn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class qo extends nn{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function bk(t){return Q(t)&&t.name==="AuthImplicitGrantRedirectError"}class Nu extends nn{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Fa extends nn{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Oi(t){return Q(t)&&t.name==="AuthRetryableFetchError"}class zu extends nn{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Ua extends nn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const xs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Du=` 	
\r=`.split(""),wk=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Du.length;e+=1)t[Du[e].charCodeAt(0)]=-2;for(let e=0;e<xs.length;e+=1)t[xs[e].charCodeAt(0)]=e;return t})();function Mu(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(xs[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(xs[r]),e.queuedBits-=6}}function $m(t,e,n){const r=wk[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Lu(t){const e=[],n=i=>{e.push(String.fromCodePoint(i))},r={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},s=i=>{Sk(i,r,n)};for(let i=0;i<t.length;i+=1)$m(t.charCodeAt(i),o,s);return e.join("")}function xk(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function _k(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const o=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|o)+65536,n+=1}xk(r,e)}}function Sk(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function Ck(t){const e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};for(let o=0;o<t.length;o+=1)$m(t.charCodeAt(o),n,r);return new Uint8Array(e)}function kk(t){const e=[];return _k(t,n=>e.push(n)),new Uint8Array(e)}function Ek(t){const e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};return t.forEach(o=>Mu(o,n,r)),Mu(null,n,r),e.join("")}function Pk(t){return Math.round(Date.now()/1e3)+t}function Tk(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const et=()=>typeof window<"u"&&typeof document<"u",sn={tested:!1,writable:!1},Nm=()=>{if(!et())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(sn.tested)return sn.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),sn.tested=!0,sn.writable=!0}catch{sn.tested=!0,sn.writable=!1}return sn.writable};function Ak(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((o,s)=>{e[s]=o})}catch{}return n.searchParams.forEach((r,o)=>{e[o]=r}),e}const zm=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Gt(async()=>{const{default:r}=await Promise.resolve().then(()=>Ar);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},Rk=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Zn=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},an=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Nt=async(t,e)=>{await t.removeItem(e)};class Ws{constructor(){this.promise=new Ws.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Ws.promiseConstructor=Promise;function ji(t){const e=t.split(".");if(e.length!==3)throw new Ua("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!pk.test(e[r]))throw new Ua("JWT not in base64url format");return{header:JSON.parse(Lu(e[0])),payload:JSON.parse(Lu(e[1])),signature:Ck(e[2]),raw:{header:e[0],payload:e[1]}}}async function Ik(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Ok(t,e){return new Promise((r,o)=>{(async()=>{for(let s=0;s<1/0;s++)try{const i=await t(s);if(!e(s,null,i)){r(i);return}}catch(i){if(!e(s,i)){o(i);return}}})()})}function jk(t){return("0"+t.toString(16)).substr(-2)}function $k(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let o="";for(let s=0;s<56;s++)o+=n.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(e),Array.from(e,jk).join("")}async function Nk(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),o=new Uint8Array(r);return Array.from(o).map(s=>String.fromCharCode(s)).join("")}async function zk(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await Nk(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Hn(t,e,n=!1){const r=$k();let o=r;n&&(o+="/PASSWORD_RECOVERY"),await Zn(t,`${e}-code-verifier`,o);const s=await zk(r);return[s,r===s?"plain":"s256"]}const Dk=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Mk(t){const e=t.headers.get(Ba);if(!e||!e.match(Dk))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Lk(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function Bk(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Fk=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Wn(t){if(!Fk.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function $i(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}var Uk=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n};const cn=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Hk=[502,503,504];async function Bu(t){var e;if(!Rk(t))throw new Fa(cn(t),0);if(Hk.includes(t.status))throw new Fa(cn(t),t.status);let n;try{n=await t.json()}catch(s){throw new jm(cn(s),s)}let r;const o=Mk(t);if(o&&o.getTime()>=Om["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new zu(cn(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Lt}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((s,i)=>s&&typeof i=="string",!0))throw new zu(cn(n),t.status,n.weak_password.reasons);throw new gk(cn(n),t.status||500,r)}const Wk=(t,e,n,r)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),n))};async function se(t,e,n,r){var o;const s=Object.assign({},r?.headers);s[Ba]||(s[Ba]=Om["2024-01-01"].name),r?.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const i=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(i.redirect_to=r.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await Gk(t,e,n+a,{headers:s,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function Gk(t,e,n,r,o,s){const i=Wk(e,r,o,s);let a;try{a=await t(n,Object.assign({},i))}catch(l){throw console.error(l),new Fa(cn(l),0)}if(a.ok||await Bu(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await Bu(l)}}function kt(t){var e;let n=null;Xk(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=Pk(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function Fu(t){const e=kt(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Ft(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function qk(t){return{data:t,error:null}}function Vk(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s}=t,i=Uk(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function Kk(t){return t}function Xk(t){return t.access_token&&t.refresh_token&&t.expires_in}const Ni=["global","local","others"];var Jk=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n};class Yk{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=zm(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,n=Ni[0]){if(Ni.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ni.join(", ")}`);try{return await se(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await se(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Ft})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=Jk(e,["options"]),o=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await se(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:Vk,redirectTo:n?.redirectTo})}catch(n){if(Q(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await se(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ft})}catch(n){if(Q(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,o,s,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await se(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(s=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""},xform:Kk});if(u.error)throw u.error;const d=await u.json(),h=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,m=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return m.length>0&&(m.forEach(g=>{const y=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);c[`${v}Page`]=y}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(Q(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Wn(e);try{return await se(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ft})}catch(n){if(Q(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){Wn(e);try{return await se(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Ft})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){Wn(e);try{return await se(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Ft})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Wn(e.userId);try{const{data:n,error:r}=await se(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:n,error:r}}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _deleteFactor(e){Wn(e.userId),Wn(e.id);try{return{data:await se(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}}function Uu(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}function Zk(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Gn={debug:!!(globalThis&&Nm()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Dm extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Qk extends Dm{}async function eE(t,e,n){Gn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Gn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){Gn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await n()}finally{Gn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(e===0)throw Gn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Qk(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Gn.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}Zk();const tE={url:dk,storageKey:hk,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:fk,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Hu(t,e,n){return await n()}const qn={};class io{constructor(e){var n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=io.nextInstanceID,io.nextInstanceID+=1,this.instanceID>0&&et()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},tE),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new Yk({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=zm(o.fetch),this.lock=o.lock||Hu,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:et()&&(!((n=globalThis?.navigator)===null||n===void 0)&&n.locks)?this.lock=eE:this.lock=Hu,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:Nm()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Uu(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=Uu(this.memoryStorage)),et()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,n;return(n=(e=qn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){qn[this.storageKey]=Object.assign(Object.assign({},qn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=qn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){qn[this.storageKey]=Object.assign(Object.assign({},qn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Im}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const n=Ak(window.location.href);let r="none";if(this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce"),et()&&this.detectSessionInUrl&&r!=="none"){const{data:o,error:s}=await this._getSessionFromURL(n,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),bk(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:i,redirectType:a}=o;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Q(n)?{error:n}:{error:new jm("Unexpected error during initialization",n)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,o;try{const s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e?.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:kt}),{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Q(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var n,r,o;try{let s;if("email"in e){const{email:u,password:d,options:h}=e;let m=null,g=null;this.flowType==="pkce"&&([m,g]=await Hn(this.storage,this.storageKey)),s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h?.emailRedirectTo,body:{email:u,password:d,data:(n=h?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:m,code_challenge_method:g},xform:kt})}else if("phone"in e){const{phone:u,password:d,options:h}=e;s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(r=h?.data)!==null&&r!==void 0?r:{},channel:(o=h?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:kt})}else throw new Go("You must provide either an email or phone number and a password");const{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Q(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let n;if("email"in e){const{email:s,password:i,options:a}=e;n=await se(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Fu})}else if("phone"in e){const{phone:s,password:i,options:a}=e;n=await se(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Fu})}else throw new Go("You must provide either an email or phone number and a password");const{data:r,error:o}=n;return o?{data:{user:null,session:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Wo}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOAuth(e){var n,r,o,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;if(n==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}async signInWithSolana(e){var n,r,o,s,i,a,l,c,u,d,h,m;let g,y;if("message"in e)g=e.message,y=e.signature;else{const{chain:v,wallet:b,statement:_,options:w}=e;let x;if(et())if(typeof b=="object")x=b;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))x=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=b}const C=new URL((n=w?.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in x&&x.signIn){const k=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w?.signInWithSolana),{version:"1",domain:C.host,uri:C.href}),_?{statement:_}:null));let S;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")S=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)S=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)g=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),y=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${C.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${C.href}`,`Issued At: ${(o=(r=w?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=w?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((i=w?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((d=(u=w?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...w.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const k=await x.signMessage(new TextEncoder().encode(g),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=k}}try{const{data:v,error:b}=await se(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Ek(y)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:kt});if(b)throw b;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new Wo}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:b})}catch(v){if(Q(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const n=await an(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(n??"").split("/");try{const{data:s,error:i}=await se(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:kt});if(await Nt(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Wo}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:i})}catch(s){if(Q(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:n,provider:r,token:o,access_token:s,nonce:i}=e,a=await se(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:kt}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Wo}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOtp(e){var n,r,o,s,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Hn(this.storage,this.storageKey));const{error:d}=await se(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await se(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(o=l?.data)!==null&&o!==void 0?o:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(i=l?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new Go("You must provide either an email or phone number.")}catch(a){if(Q(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var n,r;try{let o,s;"options"in e&&(o=(n=e.options)===null||n===void 0?void 0:n.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:i,error:a}=await se(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:kt});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(Q(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var n,r,o;try{let s=null,i=null;return this.flowType==="pkce"&&([s,i]=await Hn(this.storage,this.storageKey)),await se(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:i}),headers:this.headers,xform:qk})}catch(s){if(Q(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Lt;const{error:o}=await se(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(Q(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:o,options:s}=e,{error:i}=await se(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:r,type:o,options:s}=e,{data:i,error:a}=await se(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:a}}throw new Go("You must provide either an email or phone number and a type")}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await an(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Ii:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const i=await an(this.userStorage,this.storageKey+"-user");i?.user?e.user=i.user:e.user=$i()}if(this.storage.isServer&&e.user){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await se(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ft}):await this._useSession(async n=>{var r,o,s;const{data:i,error:a}=n;if(a)throw a;return!(!((r=i.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Lt}:await se(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:Ft})})}catch(n){if(Q(n))return vk(n)&&(await this._removeSession(),await Nt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:n};throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:o,error:s}=r;if(s)throw s;if(!o.session)throw new Lt;const i=o.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Hn(this.storage,this.storageKey));const{data:c,error:u}=await se(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Ft});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Lt;const n=Date.now()/1e3;let r=n,o=!0,s=null;const{payload:i}=ji(e.access_token);if(i.exp&&(r=i.exp,o=r<=n),o){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(n){if(Q(n))return{data:{session:null,user:null},error:n};throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:i,error:a}=n;if(a)throw a;e=(r=i.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Lt;const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async _getSessionFromURL(e,n){try{if(!et())throw new qo("No browser detected.");if(e.error||e.error_description||e.error_code)throw new qo(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Nu("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new qo("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Nu("No code detected.");const{data:_,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:o,access_token:s,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!i||!c)throw new qo("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let h=u+d;l&&(h=parseInt(l));const m=h-u;m*1e3<=Yn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${d}s`);const g=h-d;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,h,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,h,u);const{data:y,error:v}=await this._getUser(s);if(v)throw v;const b={provider_token:r,provider_refresh_token:o,access_token:s,expires_in:d,expires_at:h,refresh_token:i,token_type:c,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:e.type},error:null}}catch(r){if(Q(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await an(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:o,error:s}=n;if(s)return{error:s};const i=(r=o.session)===null||r===void 0?void 0:r.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(yk(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Nt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const n=Tk(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,o;try{const{data:{session:s},error:i}=n;if(i)throw i;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,n={}){let r=null,o=null;this.flowType==="pkce"&&([r,o]=await Hn(this.storage,this.storageKey,!0));try{return await se(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:o,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(s){if(Q(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}async linkIdentity(e){var n;try{const{data:r,error:o}=await this._useSession(async s=>{var i,a,l,c,u;const{data:d,error:h}=s;if(h)throw h;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await se(this.fetch,"GET",m,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(o)throw o;return et()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(Q(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,o;const{data:s,error:i}=n;if(i)throw i;return await se(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await Ok(async o=>(o>0&&await Ik(200*Math.pow(2,o-1)),this._debug(n,"refreshing attempt",o),await se(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:kt})),(o,s)=>{const i=200*Math.pow(2,o);return s&&Oi(s)&&Date.now()+i-r<Yn})}catch(r){if(this._debug(n,"error",r),Q(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),et()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const o=await an(this.storage,this.storageKey);if(o&&this.userStorage){let i=await an(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:o.user},await Zn(this.userStorage,this.storageKey+"-user",i)),o.user=(e=i?.user)!==null&&e!==void 0?e:$i()}else if(o&&!o.user&&!o.user){const i=await an(this.storage,this.storageKey+"-user");i&&i?.user?(o.user=i.user,await Nt(this.storage,this.storageKey+"-user"),await Zn(this.storage,this.storageKey,o)):o.user=$i()}if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}const s=((n=o.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Ii;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${Ii}s`),s){if(this.autoRefreshToken&&o.refresh_token){const{error:i}=await this._callRefreshToken(o.refresh_token);i&&(console.error(i),Oi(i)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:a}=await this._getUser(o.access_token);!a&&i?.user?(o.user=i.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(r,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Lt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Ws;const{data:s,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new Lt;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(o,"error",s),Q(s)){const i={session:null,error:s};return Oi(s)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(i),i}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,n,r=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const s=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){s.push(l)}});if(await Promise.all(i),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await Zn(this.userStorage,this.storageKey+"-user",{user:n.user});const o=Object.assign({},n);delete o.user;const s=structuredClone(o);await Zn(this.storage,this.storageKey,s)}else{const o=structuredClone(n);await Zn(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await Nt(this.storage,this.storageKey),await Nt(this.storage,this.storageKey+"-code-verifier"),await Nt(this.storage,this.storageKey+"-user"),this.userStorage&&await Nt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&et()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Yn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((r.expires_at*1e3-e)/Yn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Yn}ms, refresh threshold is ${La} ticks`),o<=La&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Dm)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!et()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const o=[`provider=${encodeURIComponent(n)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[s,i]=await Hn(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(i)}`});o.push(a.toString())}if(r?.queryParams){const s=new URLSearchParams(r.queryParams);o.push(s.toString())}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;return s?{data:null,error:s}:await se(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,o;const{data:s,error:i}=n;if(i)return{data:null,error:i};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await se(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((o=l?.totp)===null||o===void 0)&&o.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;if(s)return{data:null,error:s};const{data:i,error:a}=await se(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(n){if(Q(n))return{data:null,error:n};throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;return s?{data:null,error:s}:await se(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Q(n))return{data:null,error:n};throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){const{data:{user:e},error:n}=await this.getUser();if(n)return{data:null,error:n};const r=e?.factors||[],o=r.filter(i=>i.factor_type==="totp"&&i.status==="verified"),s=r.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:r,totp:o,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var n,r;const{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=ji(o.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((r=(n=o.user.factors)===null||n===void 0?void 0:n.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;const o=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+mk>o)return r;const{data:s,error:i}=await se(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=o,r=s.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:m,error:g}=await this.getSession();if(g||!m.session)return{data:null,error:g};r=m.session.access_token}const{header:o,payload:s,signature:i,raw:{header:a,payload:l}}=ji(r);n?.allowExpired||Lk(s.exp);const c=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,n?.keys?{keys:n.keys}:n?.jwks);if(!c){const{error:m}=await this.getUser(r);if(m)throw m;return{data:{claims:s,header:o,signature:i},error:null}}const u=Bk(o.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,i,kk(`${a}.${l}`)))throw new Ua("Invalid JWT signature");return{data:{claims:s,header:o,signature:i},error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}}io.nextInstanceID=0;const nE=io;class rE extends nE{constructor(e){super(e)}}var oE=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class sE{constructor(e,n,r){var o,s,i;if(this.supabaseUrl=e,this.supabaseKey=n,!e)throw new Error("supabaseUrl is required.");if(!n)throw new Error("supabaseKey is required.");const a=ck(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:tk,realtime:rk,auth:Object.assign(Object.assign({},nk),{storageKey:c}),global:ek},d=uk(r??{},u);this.storageKey=(o=d.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=ak(n,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new SC(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new dC(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new YC(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,n;return oE(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,storageKey:s,flowType:i,lock:a,debug:l},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new rE({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:s,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,flowType:i,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new MC(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r?.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const iE=(t,e,n)=>new sE(t,e,n),Cn=iE("https://pkswdnpftrundnewgnya.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrc3dkbnBmdHJ1bmRuZXdnbnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODI2MzIsImV4cCI6MjA2ODI1ODYzMn0.r_Y1RLOGJ55C0De5SBTVXqO09SMDqgV38sQuE-oDxXE"),aE=async(t,e)=>{const n=await Cn.rpc("save_campaign_version",{p_name:t,p_data:await vm(e)});if(n.error)throw new Error(`error saving to db ${n.error.message} ${n.error.details}`,{cause:n.error});return n.data},lE=async t=>{const e=await Cn.rpc("get_latest_campaign",{p_name:t.name,p_created_by:t.createdBy,p_version:t.version});if(e.error)throw new Error("could not get campaign",{cause:e.error});const n=await aC(e.data.data);return Object.values(n.rooms).forEach(r=>{delete r.size}),n},Mm=()=>{const[t,e]=p.useState(null);return p.useEffect(()=>{Cn.auth.getUser().then(({data:{user:r}})=>{e(r)});const{data:{subscription:n}}=Cn.auth.onAuthStateChange((r,o)=>{e(o?.user??null)});return()=>n.unsubscribe()},[]),t},Lm=()=>{const[t,e]=p.useState(0);return{justDone:t,doneNow(){e(n=>n+1),setTimeout(()=>e(n=>n-1),cE)}}},cE=2e3,uE=`
## Save

put your campaign on cassette tape, or even floppy disk!

to be shared or worked on later

(really, saves to a cloud database)

hotkey: **Cmd-S**
`,dE=`
## Load

continue working from your last save
`,Bm=()=>he(({levelEditor:{savedCampaign:t,campaignInProgress:e}})=>Ge(t,e)),hE=()=>{const t=Mm(),e=Bm(),{doneNow:n,justDone:r}=Lm(),o=async()=>{const i=U.getState(),a=hh(i);console.info("saving...",a);const l=await aE("sequel",a);console.info(`...saved as v${l}`),U.dispatch(Ky({campaign:a})),n()},s=async()=>{try{const i=await lE({name:"sequel"});console.info("loaded",i),U.dispatch(Xy({campaign:i}))}catch(i){console.error(i)}};return f.jsxs(f.Fragment,{children:[r>0?f.jsx(ye,{disabled:!0,className:"!bg-moss !text-white",children:f.jsx(D,{className:"relative leading-none",children:"OK!"})}):f.jsx(ye,{disabled:t===null||e,onClick:o,shortcutKeys:["^S","⌘S"],tooltipContent:uE,children:f.jsxs("div",{className:"flex flex-row items-center",children:[f.jsx("span",{className:Te("sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative",{"text-lightGrey":t===null})}),f.jsx("span",{className:Te("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})})]})}),f.jsx(ye,{disabled:t===null,onClick:s,tooltipContent:dE,children:f.jsxs("div",{className:"flex flex-row items-center",children:[f.jsx("span",{className:Te("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})}),f.jsx("span",{className:Te("sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative",{"text-lightGrey":t===null})})]})})]})},fE=()=>f.jsx(ye,{children:f.jsx(D,{className:"relative leading-none",children:"MAP"})}),pE=()=>{const[t,e]=p.useState(!1),[n,r]=p.useState(!1);return f.jsx(Fl,{main:f.jsx(ye,{onClick:async()=>{const o=U.getState(),s=hh(o),i=await vm(s),a=new URL("https://blockstack.ing"),l=a.searchParams;l.set("campaignData",i),l.set("noSaves","1"),l.set("cheats","1"),n&&l.set("playAsHeels","1"),t||(a.hash=o.levelEditor.currentlyEditingRoomId),window.open(a.toString(),"playtest")},shortcutKeys:["⌘P","^P"],children:f.jsx(ja,{topText:"pl",bottomText:"ay",icon:f.jsx("span",{className:"sprite texture-joystick mt-half"})})}),children:[f.jsx(vr,{className:"w-full",value:t,label:"from",falseLabel:"room",trueLabel:"start",onChange:o=>e(o)},"fromStart"),f.jsx(vr,{className:"w-full",value:n,label:"as",falseLabel:"head",trueLabel:"heels",onChange:o=>r(o)},"playAsHeels")]})},mE=t=>{switch(t){case"github":return sh;case"discord":return ih;default:throw new Error}},gE=({className:t})=>{const e=Mm(),n=o=>async()=>{const s=new URL(window.location.href);s.hash="";const i=s.toString(),{error:a}=await Cn.auth.signInWithOAuth({provider:o,options:{redirectTo:i}});a&&console.error("Login error:",a)},r=async()=>{const{error:o}=await Cn.auth.signOut();o&&console.error("Logout error:",o)};return f.jsx("div",{className:Te(t),children:e?f.jsxs("div",{className:"bg-moss overflow-hidden text-center",children:[f.jsx(D,{noSlitWords:!0,className:"overflow-hidden",children:`${mE(e.app_metadata.provider)}${e.email}`}),f.jsx(Wt,{className:"px-1 w-full",onClick:r,children:f.jsx(D,{children:"Logout"})})]}):f.jsxs("div",{className:"px-1 bg-midRed",children:[f.jsx(D,{className:"block w-full sprites-double-height pb-1",children:"Not logged in"}),f.jsx(D,{className:"block w-full text-highlightBeige",children:"You will not be able to save"}),f.jsxs("div",{className:"pt-1 flex flex-col gap-half",children:[f.jsx(D,{children:"Log in with:"}),f.jsxs(Wt,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:n("github"),children:[f.jsx(D,{children:sh}),f.jsx(D,{children:"GitHub"})]}),f.jsxs(Wt,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:n("discord"),children:[f.jsx(D,{children:ih}),f.jsx(D,{children:"Discord"})]})]})]})})},yE=`
## Add room

Add a **new room** to this campaign

Nothing will link to the room so add *doors* and *teleporters* to get into it
`,vE=`
## Delete room

Delete this room
`,bE=()=>{const t=He(),e=he(n=>Object.keys(n.levelEditor.campaignInProgress.rooms).length>1);return f.jsxs(f.Fragment,{children:[f.jsx(ye,{className:"bg-moss",onClick:()=>t(Jy()),tooltipContent:yE,children:f.jsx("span",{className:"sprite texture-hud_char_+ relative"})}),f.jsx(ye,{className:"bg-midRed",onClick:()=>t(Yy()),disabled:!e,tooltipContent:vE,children:f.jsx("span",{className:"sprite texture-hud_char_X relative"})})]})},Oe={x:12,y:12,z:q.h},wE={x:14,y:14,z:q.h},fn={x:16,y:16,z:q.h},zi={...Oe,z:q.h*2},Fm=t=>{switch(t.type){case"spring":case"portableBlock":case"moveableDeadly":case"slidingDeadly":case"firedDoughnut":return{aabb:Oe};case"slidingBlock":return t.config.style==="book"?{aabb:fn}:{aabb:Oe};case"lift":return{aabb:{...Oe,z:Oe.z}};case"switch":return{aabb:{...Oe,z:Oe.z}};case"pickup":return t.config.gives==="scroll"?{aabb:{x:16,y:4,z:13}}:{aabb:Oe};case"charles":return{aabb:zi};case"ball":return{aabb:{x:12,y:12,z:12}};case"pushableBlock":case"movingPlatform":return{aabb:fn};case"block":switch(t.config.style){case"artificial":case"organic":case"book":return{aabb:fn};case"tower":return{aabb:{x:11,y:11,z:q.h}};default:throw new Error("unknown block style")}case"monster":switch(t.config.which){case"skiHead":return{aabb:{...Oe,z:21}};case"bubbleRobot":case"cyberman":case"elephant":case"emperorsGuardian":case"monkey":case"computerBot":return{aabb:zi};case"helicopterBug":case"dalek":case"emperor":case"homingBot":case"elephantHead":return{aabb:Oe};case"turtle":return{aabb:Oe};default:throw t.config,new Error("unknown monster type")}case"deadlyBlock":case"spikes":return{aabb:fn};case"bubbles":return{aabb:Oe};case"conveyor":case"hushPuppy":case"teleporter":return{aabb:fn};case"barrier":return{aabb:t.config.axis==="y"?{x:3,y:15,z:q.h}:{x:15,y:3,z:q.h}};case"sceneryPlayer":return t.config.which==="headOverHeels"?{aabb:zi}:{aabb:Oe};case"emitter":return{aabb:ue};default:return{aabb:wE}}},rt={aabb:Oe},xE=({config:{direction:t},position:e})=>t==="right"&&e.x===0||t==="towards"&&e.y===0,_E=({x:t=0,y:e=0})=>e-t,Y=({x:t=0,y:e=0,z:n=0})=>({x:e-t,y:-(t+e)/2-n}),SE=(t,e,n)=>{const r=Y(t),o=yn(n,r);return B(Um(e,o),t)},Um=(t,{x:e,y:n})=>{switch(ah(t)){case"xy":return{x:-e/2-n,y:e/2-n,z:0};case"xz":return{x:-e,y:0,z:e/2-n};case"yz":return{x:0,y:e,z:-e/2-n};default:throw new Error("only axis-aligned planes are supported for unprojection")}},ke=({x:t=0,y:e=0,z:n=0})=>({x:t*q.w,y:e*q.d,z:n*q.h}),is=({x:t=0,y:e=0,z:n=0})=>({x:t/q.w,y:e/q.d,z:n/q.h}),kn=t=>Y(ke(t)),Ha=t=>{const e=ke(t.position),{aabb:n}=Fm(t);if(n===void 0)throw new Error(`item type= ${t.type} config=${JSON.stringify(t.config)} has no bounding box`);return t.type==="wall"?e:B(e,{x:q.w-n.x>>1,y:q.d-n.y>>1})},Pe=Number.MIN_SAFE_INTEGER,Wu=oy/1e3,Hm={firedDoughnut:2*Wu,floatingText:Wu},Wm=10,Gu=6e4,CE=8,kE=750,EE=2500,qu=200,PE=.15,TE=sr.h-sr.w/2,Gm=TE+2,Gs=9999,Be=()=>({expires:null,stoodOnBy:{},disappearing:null,switchedAtRoomTime:Pe,stoodOnUntilRoomTime:Pe}),Vu=()=>({standingOnItemId:null,vels:{gravity:ue,movingFloor:ue},latentMovement:[],actedOnAt:{roomTime:Pe,by:de},collidedWith:{roomTime:Pe,by:de}}),AE=t=>{const e=Zy.includes(t.type);return{...Be(),position:Ha(t),...e?{standingOnItemId:null,vels:{gravity:ue,movingFloor:ue,...Qy.includes(t.type)?{sliding:ue}:{},...t.type==="monster"||t.type==="movingPlatform"?{walking:ue}:{}},latentMovement:[],actedOnAt:{roomTime:Pe,by:de},collidedWith:{roomTime:Pe,by:de}}:{},...t.type==="monster"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",timeOfLastDirectionChange:Number.NEGATIVE_INFINITY,...t.config.which==="skiHead"||t.config.which==="turtle"||t.config.which==="elephantHead"||t.config.which==="cyberman"?{facing:Ee[t.config.startDirection]}:{facing:Ee.towards}}:{},...t.type==="pickup"?{disappearing:{on:"touch",byType:t.config.gives==="bag"||t.config.gives==="jumps"?["heels","headOverHeels"]:t.config.gives==="doughnuts"||t.config.gives==="hooter"||t.config.gives==="fast"?["head","headOverHeels"]:["head","heels","headOverHeels"]}}:{},...t.type==="movingPlatform"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",facing:Ee[t.config.startDirection]}:{},...t.type==="switch"?{setting:t.config.initialSetting,touchedOnProgression:-1}:{},...t.type==="block"?{disappearing:t.config.disappearing??null}:{},...t.type==="conveyor"?{disappearing:t.config.disappearing??null}:{},...t.type==="barrier"?{disappearing:t.config.disappearing??null}:{},...t.type==="lift"?{direction:"up",vels:{lift:ue}}:{},...t.type==="charles"?{facing:Ee.towards}:{},...t.type==="emitter"?{lastEmittedAtRoomTime:Pe,quantityEmitted:0}:{},...t.type==="firedDoughnut"?{disappearing:{on:"touch"},vels:{fired:t.config.direction?Es(Ee[t.config.direction],Hm.firedDoughnut):ue}}:{}}},Di=q.h*2,RE=4,Wr=q.h*RE,IE=2,OE=2*q.w,jE=.5,Ku=2;function*$E(t,e){const{config:{direction:n},position:r}=t,o=ho(n),s=kr(o),i=xE(t),a={...ue,[s]:i?-.5:0},l=1,c={[s]:i?-1:0},u=l*q.w,d={...ue,[s]:u},h=9,m=8,g=8;{const y={[o]:m,[s]:g,z:Wr};yield{...t,...rt,type:"doorFrame",id:`${e}/frameFar`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"far"},state:{...Be(),position:ke(B(r,{[o]:1.5},a,c)),stoodOnBy:de},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}{const y={[o]:h,[s]:g,z:Wr};yield{...t,...rt,type:"doorFrame",id:`${e}/frameNear`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"near"},state:{...Be(),position:ke(B(r,a,c)),stoodOnBy:de},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}{const y={[o]:2*q.w-h-m,[s]:g,z:Wr-Di};yield{...t,...rt,type:"doorFrame",id:`${e}/frameTop`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"top"},state:{...Be(),position:B(ke(B(r,a,c)),{[o]:h,z:Di}),stoodOnBy:de},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}yield{...t,...rt,type:"blocker",id:`${e}/blockerAbove`,jsonItemId:e,config:{},renders:!1,state:{...Be(),position:B(ke(B(r,a,c)),{z:Wr}),stoodOnBy:de},aabb:B(ke({[o]:2,[s]:l,z:Gs}),{[s]:g}),renderAabb:ue,fixedZIndex:mn},yield{...t,...rt,type:"portal",id:`${e}/portal`,jsonItemId:e,config:{...ev(t.config,"toRoom","toDoor"),inHidden:i,relativePoint:ke({...ue,[s]:i?l+.25:-.25}),direction:Ee[n]},fixedZIndex:mn,state:{...Be(),position:B(ke(B(r,{[s]:i?-.5-l:.5})),{[o]:h}),stoodOnBy:de},aabb:{[o]:IE*q.w-h-m,[s]:u,z:Di}},r.z!==0&&(yield{...t,...rt,type:"doorLegs",id:`${e}/legs`,jsonItemId:e,config:{...t.config,inHiddenWall:i,style:"none",side:"away",height:r.z},renders:!0,shadowCastTexture:i?{textureId:"shadow.door.floatingThreshold.double.y",flipX:o==="x"}:void 0,state:{...Be(),position:{...ke(B(r,a,c)),z:0}},aabb:B(ke({[o]:2,[s]:.5,z:r.z}),d),renderAabb:i?B(ke({[o]:2,[s]:.5,z:.5})):void 0,renderAabbOffset:i?B({[o]:0,[s]:0,z:(r.z-.5)*q.h},{[s]:d[s]}):void 0,shadowOffset:{z:r.z*q.h,[s]:i?d[s]:void 0}}),yield{type:"stopAutowalk",id:`${e}/stopAutowalk`,jsonItemId:e,aabb:ke({[o]:2,[s]:Ku,z:2}),config:{},fixedZIndex:mn,state:{...Be(),position:ke(dr(r,Es(Ee[n],jE),i?ue:{[s]:Ku})),stoodOnBy:de}}}const Xu={config:de,shadowCastTexture:"shadow.smallRound",aabb:Oe},Ju=()=>{const t=iy(U.getState());return{action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:Ee.towards,walkStartFacing:Ee.towards,walkDistance:0,vels:{walking:ue,gravity:ue,movingFloor:ue},switchedToAt:Pe,lastDiedAt:Pe,gameTime:0,jumpStartTime:Pe,lives:t?"infinite":CE,jumpStartZ:0}},NE=(t,e)=>{const n=sy(U.getState());return t.config.which==="head"?{id:e,jsonItemId:e,type:"head",...rt,...Xu,state:{...Be(),...Vu(),...Ju(),hasHooter:!1,gameWalkDistance:0,fastStepsStartedAtDistance:Pe,shieldCollectedAt:Pe,doughnuts:n?"infinite":0,position:Ha(t),stoodOnUntilRoomTime:Pe}}:{id:e,jsonItemId:e,type:"heels",...rt,...Xu,state:{...Be(),...Vu(),...Ju(),carrying:null,hasBag:!1,bigJumps:0,isBigJump:!1,shieldCollectedAt:Pe,position:Ha(t),stoodOnUntilRoomTime:Pe}}},ao=(t,e={})=>{const n=fh(e),r=dr(ic,t);return dr(ay(n,ic),r)},qm=1,zE={x:q.w,y:q.d*qm,z:Gs},DE={x:q.w,y:0,z:Gm},ME={x:q.w*qm,y:q.d,z:Gs},LE={x:0,y:q.d,z:Gm},BE=(t,e)=>{const{config:{direction:n},position:r}=e,o=al(e.config),s=ho(n),i=kr(s),a=tv(n),l={...ue,[i]:a?-1:0};return{type:"wall",id:t,jsonItemId:t,config:e.config,aabb:ao(s==="y"?ME:zE,o),renderAabb:a?ue:ao(s==="y"?LE:DE,o),fixedZIndex:a?mn:void 0,state:{...Be(),position:ke(B(r,l)),stoodOnBy:de},shadowCastTexture:s==="y"?"shadow.wall.y":{textureId:"shadow.wall.y",flipX:!0}}},FE=3,Yu=10,Zu=.52,Qu=.5,UE=(t,e,n)=>{const{config:{times:r},position:o}=e,s=B(o,{z:-3}),i={...r,z:FE};let a=s,l=i;const c=bt(ds(n.items)).filter(h=>h.type==="door");if(o.z===0){const h={};for(const m of c){const{position:g,config:{direction:y}}=m;switch(y){case"towards":!h.towards&&g.y===s.y&&(l=B(l,{y:Qu}),a=B(a,{y:-.5}),h.towards=!0);break;case"away":!h.away&&g.y===s.y+r.y&&(l=B(l,{y:Zu}),h.away=!0);break;case"right":!h.right&&g.x===s.x&&(l=B(l,{x:Qu}),a=B(a,{x:-.5}),h.right=!0);break;case"left":!h.left&&g.x===s.x+r.x&&(l=B(l,{x:Zu}),h.left=!0);break}}}const u=ke(a),d=ao(fn,l);return{type:"floor",id:t,jsonItemId:t,config:{...e.config,naturalFootprint:{aabb:ao(fn,i),position:ke(s)}},aabb:d,renderAabb:{...d,z:Yu},renderAabbOffset:{...ue,z:d.z-Yu},shadowCastTexture:"shadow.fullBlock",state:{...Be(),position:u}}};function*qs(t,e,n,r=de,o={},s=""){if(!r[t]&&!(e.type==="pickup"&&e.config.gives==="scroll"&&o[e.config.page]))switch(!0){case e.type==="door":return yield*$E(e,t);case e.type==="player":{yield NE(e,t);return}case e.type==="wall":{yield BE(t,e);return}case e.type==="floor":{yield UE(t,e,n);return}case(e.type==="block"&&e.config.disappearing!==void 0&&Ps(aa(e))>=2):{const i=aa(e);for(let a=0;a<i.x;a++)for(let l=0;l<i.y;l++)for(let c=0;c<i.z;c++){const u=el(e,d=>{d.position={x:e.position.x+a,y:e.position.y+l,z:e.position.z+c},d.config.times=ly});yield*qs(t,u,n,r,o,`${s}_${a}_${l}_${c}`)}break}case(e.type==="sceneryCrown"&&!U.getState().gameMenus.planetsLiberated[e.config.planet]):return;default:{const i=Fm(e),a=e.config.times!==void 0?{aabb:ao(i.aabb,e.config.times),renderAabb:void 0}:i;let l;try{l=AE(e)}catch(c){throw new Error(`loadItemFromJson: error creating initial state for jsonItem ${JSON.stringify(e,null,2)}`,{cause:c})}yield{...e,...rt,...a,id:`${t}${s}`,jsonItemId:t,fixedZIndex:e.type==="emitter"?mn:void 0,shadowCastTexture:HE(e),config:e.config,state:l}}}}const HE=t=>{switch(t.type){case"lift":return"shadow.smallBlock";case"conveyor":return{textureId:"shadow.fullBlock",flipX:Vt(t.config.direction)==="x"};case"barrier":return{textureId:"shadow.barrier.y",flipX:t.config.axis==="x"};case"spring":case"firedDoughnut":case"slidingDeadly":return"shadow.smallRound";case"block":return t.config.style==="tower"?"shadow.smallRound":"shadow.fullBlock";case"pushableBlock":case"movingPlatform":case"hushPuppy":case"deadlyBlock":case"teleporter":case"spikes":return"shadow.fullBlock";case"portableBlock":return t.config.style==="drum"?"shadow.smallRound":"shadow.smallBlock";case"pickup":return t.config.gives==="scroll"?"shadow.scroll":"shadow.smallRound";case"ball":case"charles":case"monster":return"shadow.smallRound";case"slidingBlock":return t.config.style==="book"?"shadow.fullBlock":"shadow.smallRound"}},Vs=({aabb:t,state:{position:e}},{aabb:n,state:{position:r}})=>!(e.x+t.x<=r.x||e.x>=r.x+n.x)&&!(e.y+t.y<=r.y||e.y>=r.y+n.y)&&!(e.z+t.z<=r.z||e.z>=r.z+n.z),WE=(t,e)=>[...bt(e).filter(n=>t.id!==n.id&&Vs(t,n))];function*Wa(t,e){for(const n of e)t.id!==n.id&&Vs(t,n)&&(yield n)}function*GE(t,e){if(t.roomBelow!==void 0)for(const n of Ie(e).filter(ac)){const{config:{naturalFootprint:r}}=n;yield{...rt,type:"portal",id:"floor/portal",fixedZIndex:mn,config:{toRoom:t.roomBelow,relativePoint:{x:r.aabb.x/2,y:r.aabb.y/2,z:r.aabb.z},direction:Ee.down},aabb:r.aabb,state:{...Be(),position:r.position},renders:!1}}if(t.roomAbove!==void 0)for(const n of Ie(e).filter(ac)){const{config:{naturalFootprint:r}}=n;yield{...rt,type:"portal",id:"ceilingPortal",fixedZIndex:mn,config:{toRoom:t.roomAbove,relativePoint:{...t.ceilingRelativePoint!==void 0?ke(t.ceilingRelativePoint):{x:r.aabb.x/2,y:r.aabb.y/2},z:-12},direction:Ee.up},aabb:{...r.aabb,z:q.h},state:{...Be(),position:B(r.position,{z:r.aabb.z},{z:q.h*(t.height??Wm)})}}}}const qE=(t,e,n,r)=>{const o=Math.max(0,Math.min(t.x+e.x,n.x+r.x)-Math.max(t.x,n.x)),s=Math.max(0,Math.min(t.y+e.y,n.y+r.y)-Math.max(t.y,n.y));return o*s},ed=({state:{position:t},aabb:e},{state:{position:n},aabb:r})=>qE(t,e,n,r),td={stopAutowalk:5,portal:5,wall:5,blocker:5,doorLegs:5,sceneryPlayer:5,bubbles:5,switch:10,doorFrame:15,ball:18,block:20,barrier:20,floor:20,hushPuppy:20,teleporter:20,lift:30,movingPlatform:30,pushableBlock:30,portableBlock:30,sceneryCrown:30,slidingBlock:30,spring:30,joystick:40,charles:40,conveyor:40,head:50,heels:50,headOverHeels:50,pickup:80,firedDoughnut:90,spikes:98,slidingDeadly:100,moveableDeadly:100,deadlyBlock:100,monster:100,floatingText:200,particle:200,emitter:200},VE=(t,e)=>td[t.type]-td[e.type],KE=(t,e,n=.001)=>{if(!fr(e,t)||t.id===e.id)return!1;const{state:{vels:{gravity:{z:r}}}}=t;return r>0?!1:Vs({state:{position:B(t.state.position,{x:0,y:0,z:-1e-4})},aabb:{...t.aabb,z:n+lh},id:t.id},{state:{position:B(e.state.position,{x:0,y:0,z:e.aabb.z})},aabb:{...e.aabb,z:0},id:e.id})},XE=(t,e)=>{const r=[...bt(e).filter(s=>KE(t,s))];return r.length===0?void 0:r.reduce((s,i)=>{const a=VE(i,s);return a<0||a===0&&ed(t,i)>ed(t,s)?i:s})},JE=({above:t,below:e})=>{const n=e.state.stoodOnBy;if(!Object.isExtensible(n))throw new Error(`${t.id} can't stand on ${e.id} - its standingOn is not extensible`);t.state.standingOnItemId=e.id,n[t.id]=!0};function*YE(t,e,n,r){const o=uy(t.items);for(const[s,i]of o)i.type==="player"&&!r||(yield*qs(s,i,t,e,n))}const nd=t=>bt(t).reduce((e,n)=>({...e,[n.id]:n}),{}),Mi=({roomJson:t,roomPickupsCollected:e,scrollsRead:n,isNewGame:r=!1})=>{const o=nd(YE(t,e,n,r)),s={...nd(GE(t,o)),...o};for(const a of Ie(s)){const c=WE(a,cy(s)).find(u=>fr(a)&&fr(u)&&!(a.type==="wall"&&u.type==="wall"));c!==void 0&&console.error(`in room ${t.id} item ${a.id} @${JSON.stringify(a.state.position)} #${JSON.stringify(a.aabb)} is colliding with (solid item) ${c.id} @${JSON.stringify(c.state.position)} #${JSON.stringify(c.aabb)} on loading room ${t.id}`)}for(const a of Ie(s).filter(nv)){const l=XE(a,Ie(s).filter(c=>c.id!==a.id));l!==void 0&&JE({above:a,below:l})}return{...t,roomJson:t,items:s,roomTime:0}},ZE=t=>()=>Tn(t),lI=ZE(hr),QE=Eh([hr,t=>t.levelEditor.previewedEdits],(t,e)=>el(t,n=>{const r=ch(e);for(const[o,s]of r)s===null?delete n.items[o]:n.items[o]=s})),Vl=p.createContext(null),eP=()=>{const[t,e]=p.useState(()=>Mi({roomJson:hr(U.getState()),roomPickupsCollected:de,scrollsRead:de,isNewGame:!0})),[n,r]=p.useState(t),o=he(hr),s=he(QE);return p.useEffect(()=>{const i=Mi({roomJson:o,roomPickupsCollected:de,scrollsRead:de,isNewGame:!0});if(e(i),o===s)r(i);else{const a=Mi({roomJson:s,roomPickupsCollected:de,scrollsRead:de,isNewGame:!0});r(a)}},[o,s]),{roomState:t,roomStateWithPreviews:n}},tP=({children:t})=>{const e=eP();return f.jsx(Vl,{value:e,children:t})},Vm=()=>{const t=p.useContext(Vl);if(t===null)throw new Error("no room state in context, or no context");return t.roomState},Km=()=>{const t=p.useContext(Vl);if(t===null)throw new Error("no room state in context, or no context");return t.roomStateWithPreviews},nP=t=>Ie(t.items).filter(e=>fr(e)),Xm=(t,e)=>{const n=bt(nP(t));return e==="door"?n.filter(o=>o.type!=="wall"):n},Jm=({roomState:t,jsonItemIds:e,blockPositionDelta:n,timesDelta:r})=>{const o=Ec(Sc(a=>[a,t.roomJson.items[a]]),Sc(([a,l])=>[a,el(l,c=>{c.position=B(c.position,n),rv(c,r)})]),Nv(function*([a,l]){for(const c of qs(a,l,t.roomJson))yield[a,l,c]}),ov(([,,a])=>fr(a))),s=Array.from(o(e));return Ec(Vv(([,a,l])=>{const c=bt(Xm(t,a.type)).filter(u=>u.jsonItemId&&!e.includes(u.jsonItemId));for(const u of Wa(l,c))return console.warn(l.id,"colliding with static item",u.id),!0;for(const u of Wa(l,s.map(([d,h,m])=>m)))return console.warn(l.id,"colliding with other mutating item",u.id),!0;return!1}))(s)},rP=({roomState:t,blockPosition:e,itemTool:n})=>{const r=qs("maybeAddedItem",{...n,position:e},t.roomJson),o=Array.from(Xm(t,n.type));return r.some(s=>{const i=Wa(s,o);return!Th(i)})},oP=()=>{const t=He(),e=he(o=>o.levelEditor.selectedJsonItemIds.length>0),n=Vm(),r=o=>{if(n===null)return;const s=U.getState().levelEditor,{gridResolution:i,selectedJsonItemIds:a}=s,l=hs(o,{x:i,y:i,z:1});if(Jm({roomState:n,jsonItemIds:a,blockPositionDelta:l})){console.warn("nudge would collide");return}t(ph({jsonItemIds:a,positionDelta:l})),t(mh())};return f.jsxs("div",{className:"flex flex-row flex-wrap gap-x-0 gap-y-oneScaledPix items-center",children:[f.jsx(D,{className:"inline-block mr-1 text-lightGrey leading-none",noSlitWords:!0,children:"move"}),f.jsxs("div",{className:"flex flex-row flex-wrap gap-oneScaledPix items-center",children:[f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.left)},shortcutKeys:["ArrowLeft"],tooltipContent:"Hotkey: **⬅**",children:f.jsx(D,{className:"relative leading-none",children:"↖"})}),f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.right)},shortcutKeys:["ArrowRight"],tooltipContent:"Hotkey: **➡**",children:f.jsx(D,{className:"relative leading-none",children:"↘"})}),f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.away)},shortcutKeys:["ArrowUp"],tooltipContent:"Hotkey: **⬆**",children:f.jsx(D,{className:"relative leading-none",children:"↗"})}),f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.towards)},shortcutKeys:["ArrowDown"],tooltipContent:"Hotkey: **⬇**",children:f.jsx(D,{className:"relative leading-none",children:"↙"})}),f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.up)},shortcutKeys:["⇧ArrowUp"],tooltipContent:"Hotkey: **shift-⬆**",children:f.jsx(D,{className:"relative leading-none",children:"⬆"})}),f.jsx(ye,{small:!0,disabled:!e,onClick:()=>{r(Ee.down)},shortcutKeys:["⇧ArrowDown"],tooltipContent:"Hotkey: **shift-⬇**",children:f.jsx(D,{className:"relative leading-none",children:"⬇"})})]})]})},sP=`
## Back

Go back to the previous room

hotkey: **<**
`,iP=`
## Forward

The opposite of back

hotkey: **>**
`,aP=()=>{const t=he(({levelEditor:r})=>{const{editingRoomIdHistory:o}=r;return o.back.length>0}),e=he(({levelEditor:r})=>{const{editingRoomIdHistory:o}=r;return o.forward.length>0}),n=He();return f.jsxs(f.Fragment,{children:[f.jsx(ye,{disabled:!t,onClick:()=>{n(sv())},shortcutKeys:["⇧<"],tooltipContent:sP,children:f.jsx("span",{className:"sprite texture-hud_char_lt relative"})}),f.jsx(ye,{disabled:!e,onClick:()=>{n(iv())},shortcutKeys:["⇧>"],tooltipContent:iP,children:f.jsx("span",{className:"sprite texture-hud_char_gt relative"})})]})},lP=({className:t})=>{const e=He();return f.jsx(vr,{className:t,label:"coalesce",value:he(n=>n.levelEditor.autoCoalesce),onChange:n=>{e(av(n))},shortcutKeys:["L"],tooltipContent:`optimise blocks into single items while editing, or keep separate?
hotkey: **L**`})},cP=`
## Share

copies a link to the clipboard

anyone with the link can play your game
`,uP=()=>{const t=Bm(),{doneNow:e,justDone:n}=Lm();return n>0?f.jsx(ye,{className:"bg-moss",children:f.jsx(D,{className:"relative leading-none",children:"OK!"})}):f.jsx(ye,{disabled:!t,onClick:async()=>{const r=new URL("https://blockstack.ing"),o=r.searchParams,{data:{session:s}}=await Cn.auth.getSession(),i=s?.user.id;if(i===void 0)throw new Error("no user id on supabase session");o.set("campaignName","sequel"),o.set("campaignAuthor",i),o.set("noSaves","1"),navigator.clipboard.writeText(r.toString()).then(e)},tooltipContent:cP,children:f.jsx("span",{className:"sprite sprite-tinted texture-hud_char_ relative"})})},Vo=()=>f.jsx("div",{className:"w-[calc(var(--block)-1px)]"}),dP=()=>{const t=he(r=>r.levelEditor.campaignInProgress),e=he(r=>r.levelEditor.currentlyEditingRoomId),n=He();return f.jsxs("div",{className:"scale-editor flex w-full h-full text-white bg-metallicBlueHalfbrite pb-1 gap-1 flex-wrap justify-start overflow-auto",children:[f.jsx("div",{className:Ae,children:f.jsx(gE,{className:"w-full mb-1"})}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full",children:"Campaign"}),f.jsx(hE,{}),f.jsx(uP,{}),f.jsx(Vo,{}),f.jsx(fE,{}),f.jsx(pE,{})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full pt-1",children:"Room"}),f.jsx(aP,{}),f.jsx(Vo,{}),f.jsx(bE,{}),f.jsx(Vo,{}),f.jsx(GS,{}),f.jsx(um,{value:e,campaign:t,onSelect:r=>{n(la(r))},triggerButtonClassName:"w-full",tooltipContent:"Choose the room to view/edit"}),f.jsx("div",{className:"h-1 w-full"}),f.jsx(DS,{}),f.jsx(zS,{}),f.jsx("div",{className:"h-half w-full"}),f.jsx(qS,{}),f.jsx(VS,{})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full pt-1",children:"Edit"}),f.jsxs("div",{className:Ae,children:[f.jsx(NS,{}),f.jsx(KS,{})]}),f.jsx(FS,{}),f.jsx(Vo,{}),f.jsx(OS,{}),f.jsx(oP,{}),f.jsx("div",{className:"h-1 w-full"}),f.jsxs("div",{className:"flex flex-row justify-between flex-wrap gap-x-2",children:[f.jsx($S,{}),f.jsx(US,{}),f.jsx(lP,{})]})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full pt-1",children:"Blocks"}),f.jsx(j,{itemTool:{type:"block",config:{style:"organic"}},shortcutKeys:["B"],tooltipContent:`## Block 
The basic block            
hotkey: **B**`,children:f.jsx("span",{className:`sprite texture-block_organic ${W}`})}),f.jsx(j,{itemTool:{type:"block",config:{style:"organic",disappearing:{on:"stand"}}},children:f.jsx(Fo,{iconClassName:ge("texture-block_organic_disappearing")})}),f.jsx(j,{itemTool:{type:"block",config:{style:"artificial"}},children:f.jsx("span",{className:`sprite texture-block_artificial ${W}`})}),f.jsx(j,{itemTool:{type:"block",config:{style:"artificial",disappearing:{on:"stand"}}},children:f.jsx(Fo,{iconClassName:ge("texture-block_artificial_disappearing")})}),f.jsx(j,{itemTool:{type:"block",config:{style:"tower"}},shortcutKeys:["T"],tooltipContent:`## Tower
Hotkey: **T**`,children:f.jsx("span",{className:`sprite texture-tower ${W}`})}),f.jsx(j,{itemTool:{type:"block",config:{style:"book"}},children:f.jsx("span",{className:`sprite texture-book_x ${W}`})}),f.jsxs(Dr,{children:[f.jsx(j,{itemTool:{type:"barrier",config:{axis:"x"}},children:f.jsx("span",{className:`sprite texture-barrier_x ${W}`})}),f.jsx(j,{itemTool:{type:"barrier",config:{axis:"y"}},children:f.jsx("span",{className:`sprite texture-barrier_y ${W}`})}),f.jsx(j,{itemTool:{type:"barrier",config:{axis:"x",disappearing:{on:"touch"}}},children:f.jsx(Fo,{iconClassName:ge("texture-barrier_x")})}),f.jsx(j,{itemTool:{type:"barrier",config:{axis:"y",disappearing:{on:"touch"}}},children:f.jsx(Fo,{iconClassName:ge("texture-barrier_y")})})]})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full",children:"Monsters"}),f.jsx(j,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},tooltipContent:`## mojo
the emperor’s worker bots

patrols randomly in a diagonal pattern`,children:f.jsx("span",{className:`sprite texture-dalek_1 [button:hover_&]:texture-animated-dalek" ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},tooltipContent:`## guard
hovers towards the player on the shortest axis

heels can outrun, but not head

place on a toaster to make a charging guard`,children:f.jsx(Ct,{topClasses:"texture-cyberman_towards [button:hover_&]:texture-cyberman_right",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},tooltipContent:`## monster
moves *back and forth* by default

or can be set to *patrol clockwise*`,children:f.jsx("span",{className:`sprite texture-skiHead_greenAndPink_towards [button:hover_&]:texture-skiHead_greenAndPink_right ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:f.jsx("span",{className:`sprite texture-helicopterBug_1 [button:hover_&]:texture-animated-helicopterBug ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},tooltipContent:`## turtle
plods along in a clockwise pattern`,children:f.jsx("span",{className:`sprite texture-turtle_towards_1 [button:hover_&]:texture-animated-turtle_right ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},tooltipContent:`## homing bot
detects a player in a straight line on an axis and rushes towards them`,children:f.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase_all ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},tooltipContent:`## Computer bot
usually patrols randomly, but can be programmed to move towards the player`,children:f.jsx(Ct,{topClasses:"texture-computerBot_towards [button:hover_&]:texture-computerBot_right"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"bubbleRobot",activated:"on",movement:"patrol-randomly-xy8"}},tooltipContent:`## Bubble bot
patrols randomly in 8 directions

fast and dangerous`,children:f.jsx(Ct,{topClasses:ge("texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"),bottomClasses:ge("texture-headlessBase")})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:f.jsx(Ct,{topClasses:"texture-monkey_towards [button:hover_&]:texture-monkey_right"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},children:f.jsx(Ct,{topClasses:"texture-elephant_towards [button:hover_&]:texture-elephant_right"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},tooltipContent:`## Elephant head
Things have gone weird

Stationary, but deadly`,children:f.jsx("span",{className:`sprite texture-elephant_towards [button:hover_&]:texture-elephant_right ${W}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",tooltipContent:`## Emperor's Guardian

very dangerous

moves towards the player, unless they have all four planet crowns

does not *like doughnuts*
`,children:f.jsx(Ct,{topClasses:"texture-ball",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},tooltipContent:`## Emperor
The end boss, usually found guarding his Blacktooth crown`,children:f.jsx("span",{className:`sprite texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full",children:"Pickups"}),f.jsxs(Dr,{children:[f.jsx(j,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:f.jsx(St,{iconClasses:"texture-whiteRabbit",text:"2"})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"shield"}},children:f.jsx(St,{iconClasses:"texture-whiteRabbit",text:"🛡"})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"jumps"}},children:f.jsx(St,{iconClasses:"texture-whiteRabbit",text:"♨"})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"fast"}},children:f.jsx(St,{iconClasses:"texture-whiteRabbit",text:"⚡"})})]}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"bag"}},children:f.jsx("span",{className:`sprite texture-bag ${W}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"hooter"}},tooltipContent:`## hooter

head's doughnut firing hooter`,children:f.jsx("span",{className:`sprite texture-hooter ${W}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:f.jsx("span",{className:`sprite texture-doughnuts ${W}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"reincarnation"}},children:f.jsx("span",{className:`sprite texture-fish_1 [button:hover_&]:texture-animated-fish ${W}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:f.jsx("span",{className:`sprite texture-crown_blacktooth ${W}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"scroll",page:"blacktooth"}},children:f.jsx("span",{className:`sprite texture-scroll ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full",children:"deadly"}),f.jsxs(Dr,{children:[f.jsx(j,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},children:f.jsx("span",{className:`sprite texture-volcano_1 [button:hover_&]:texture-animated-volcano ${W}`})}),f.jsx(j,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},children:f.jsx("span",{className:`sprite texture-toaster_off ${W}`})})]}),f.jsx(j,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},tooltipContent:`## Spiky ball
rolls fast if pushed

deadly to touch`,children:f.jsx("span",{className:`sprite texture-spikyBall_1 [button:hover_&]:texture-spikyBall_2 ${W}`})}),f.jsx(j,{itemTool:{type:"spikes",config:de},tooltipContent:`## spikes

deadly to touch on top

safe to run into the sides`,children:f.jsx("span",{className:`sprite texture-spikes ${W}`})}),f.jsx(j,{itemTool:{type:"moveableDeadly",config:{style:"deadFish"}},tooltipContent:`## dead fish

(deadly to touch)

dead fish decompose very quickly and it rapidly
turns so poisonous that a single lick can kill`,children:f.jsx("span",{className:`sprite texture-fish_1 ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full",children:"control"}),f.jsx(j,{itemTool:{type:"charles",config:de},children:f.jsx(Ct,{topClasses:"texture-charles_towards [button:hover_&]:texture-charles_right"})}),f.jsx(j,{itemTool:{type:"joystick",config:{controls:["charles"]}},tooltipContent:`## Joystick
Controls one or more Charles bots

Change *which* Charles in the json`,children:f.jsx("span",{className:`sprite texture-joystick ${W}`})}),f.jsx(j,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:to}},tooltipContent:`## Switch
toggles when touched.

edit the json to choose:

* de/activate monsters
* turn on/off moving platforms
* make blocks disappear on touch`,children:f.jsx("span",{className:`sprite texture-switch_left [button:hover_&]:texture-switch_right ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full",children:"movable"}),f.jsx(j,{itemTool:{type:"spring",config:{}},children:f.jsx("span",{className:`sprite texture-spring_released [button:hover_&]:texture-spring_compressed ${W}`})}),f.jsxs(Dr,{children:[f.jsx(j,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:f.jsx("span",{className:`sprite texture-cube ${W}`})}),f.jsx(j,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:f.jsx("span",{className:`sprite texture-drum ${W}`})}),f.jsx(j,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:f.jsx("span",{className:`sprite texture-sticks ${W}`})})]}),f.jsx(j,{itemTool:{type:"pushableBlock",config:{}},children:f.jsx("span",{className:`sprite texture-stepStool ${W}`})}),f.jsx(j,{itemTool:{type:"ball",config:de},children:f.jsx("span",{className:`sprite texture-ball ${W}`})}),f.jsx(j,{itemTool:{type:"slidingBlock",config:{style:"puck"}},tooltipContent:`## Sliding puck

Small item that can be stood on and slides when touched`,children:f.jsx("span",{className:`sprite texture-puck ${W}`})}),f.jsx(j,{itemTool:{type:"slidingBlock",config:{style:"book"}},tooltipContent:`## Sliding book

Why are the books slippery?`,children:f.jsx("span",{className:`sprite texture-book_y ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full",children:"misc."}),f.jsxs(j,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[f.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_static ${W} [button:active_&]:top-oneScaledPix`}),f.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_1 [button:hover_&]:texture-animated-lift ${W} [button:active_&]:top-oneScaledPix`})]}),f.jsxs(Dr,{children:[f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"away"}},children:f.jsx(St,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-conveyor_y",text:"↗"})}),f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"towards"}},children:f.jsx(St,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-reversed-conveyor_y",text:"↙"})}),f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"left"}},children:f.jsx(St,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-conveyor_x",text:"↖"})}),f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"right"}},children:f.jsx(St,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-reversed-conveyor_x",text:"↘"})})]}),f.jsx(j,{itemTool:{type:"teleporter",config:{toRoom:"to?",toPosition:ue}},children:f.jsx("span",{className:`sprite texture-teleporter ${W}`})}),f.jsx(j,{itemTool:{type:"movingPlatform",config:{movement:"clockwise",activated:"on",startDirection:"towards"}},tooltipContent:`## Moving Platform
Clockwise or back-and-forth

Can be (de)activated by a switch, or touch 

Why a sandwich?`,children:f.jsx("span",{className:`sprite texture-sandwich ${W}`})}),f.jsx(j,{itemTool:{type:"hushPuppy",config:{}},children:f.jsx("span",{className:`sprite texture-hushPuppy ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full",children:"Structure"}),f.jsx(HS,{}),f.jsx(WS,{}),f.jsx(j,{itemTool:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:{x:1,y:1}}},children:f.jsx("span",{className:`sprite texture-blacktooth_floor ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full",children:"Player"}),f.jsx(j,{itemTool:{type:"player",config:{which:"head"}},tooltipContent:`## Head

Place on of these into one room

This is where head will start the game`,children:f.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${W}`})}),f.jsx(j,{itemTool:{type:"player",config:{which:"heels"}},tooltipContent:`## Heels

Place on of these into one room

This is where head will start the game`,children:f.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${W}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full",children:"NPC’s"}),f.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"head",startDirection:"towards"}},tooltipContent:`##NPC head
Citizens of Freedom

stand around not doing much`,children:f.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${W}`})}),f.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"heels",startDirection:"towards"}},tooltipContent:`##NPC heels
Citizens of Freedom

stand around not doing much`,children:f.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${W}`})}),f.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"headOverHeels",startDirection:"towards"}},tooltipContent:`##NPC head over heels
Citizens of Freedom

stand around not doing much`,children:f.jsx(Ct,{topClasses:"texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right",bottomClasses:"texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right"})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(D,{className:"w-full pt-2",children:"debug"}),f.jsx(TS,{})]})]})},xr=(t,e)=>({get bottomCentre(){return this.c000},get topLeft(){return this.c101},get topRight(){return this.c011},get c000(){return Y(t)},get c001(){return Y(B(t,{z:e.z}))},get c010(){return Y(B(t,{y:e.y}))},get c011(){return Y(B(t,{y:e.y,z:e.z}))},get c100(){return Y(B(t,{x:e.x}))},get c101(){return Y(B(t,{x:e.x,z:e.z}))},get c110(){return Y(B(t,{x:e.x,y:e.y}))},get c111(){return Y(B(t,{x:e.x,y:e.y,z:e.z}))},projectCorner(n){return Y(B(t,{x:n.x*e.x,y:n.y*e.y,z:n.z*e.z}))}}),Li=1e-5,rd=-1,Br=(t,e,n,r,o)=>r-o>t&&n<e-o,hP=0,Ym=1,Zm=2,Qm=3,fP=(t,e,n,r)=>{const{topLeft:o,topRight:s,bottomCentre:i}=xr(t,e),{topLeft:a,topRight:l,bottomCentre:c}=xr(n,r),u=s.y-s.x/2,d=i.y-i.x/2,h=l.y-l.x/2,m=c.y-c.x/2,g=o.y+o.x/2,y=i.y+i.x/2,v=a.y+a.x/2,b=c.y+c.x/2,_=o.x,w=s.x,x=a.x,C=l.x,k=Br(u,d,h,m,Li),S=Br(g,y,v,b,Li),N=Br(_,w,x,C,Li);return k&&S&&N?Ym:S&&N&&Br(u,d,h,m,rd)?Zm:k&&N&&Br(g,y,v,b,rd)?Qm:hP},pP=(t,e,n,r)=>{for(const o of dy){const s=t[o],i=s+e[o],a=n[o],l=a+r[o];if(i<=a)return 1*(o==="z"?-1:1);if(s>=l)return-1*(o==="z"?-1:1)}return od(n)-od(t)},mP=(t,e)=>{if(t.fixedZIndex!==void 0||e.fixedZIndex!==void 0)return 0;const n=t.renderAabb||t.aabb,r=e.renderAabb||e.aabb,o=t.renderAabbOffset?B(t.state.position,t.renderAabbOffset):t.state.position,s=e.renderAabbOffset?B(e.state.position,e.renderAabbOffset):e.state.position;switch(fP(o,n,s,r)){case Ym:return pP(o,n,s,r);case Zm:return Ot(o.y,s.y+r.y)&&Ot(o.z,s.z+r.z)?1:Ot(s.y,o.y+n.y)&&Ot(s.z,o.z+n.z)?-1:0;case Qm:return Ot(o.x,s.x+r.x)&&Ot(o.z,s.z+r.z)?1:Ot(s.x,o.x+n.x)&&Ot(s.z,o.z+n.z)?-1:0;default:return 0}},od=t=>t.x+t.y-t.z;class as extends Error{constructor(e,n,r){super(`CyclicDependencyError: .cyclicDependency property of this error has nodes as an array. ${e.join(" -> ")}`,r),this.cyclicDependency=e,this.hasClosedCycle=n}}const gP=t=>{const e=yP(t);let n=e.length,r=n;const o=new Array(n),s={},i=vP(e);for(;r--;)s[r]||a(e[r],r,new Set);return o;function a(l,c,u){if(u.has(l))throw new as([l],!1);if(s[c])return;s[c]=!0;const d=t.get(l)||new Set,h=Array.from(d);if(c=h.length){u.add(l);do{const m=h[--c];try{a(m,i.get(m),u)}catch(g){throw g instanceof as?g.hasClosedCycle?g:new as([l,...g.cyclicDependency],g.cyclicDependency.includes(l)):g}}while(c);u.delete(l)}o[--n]=l}};function yP(t){const e=new Set;for(const[n,r]of t.entries()){e.add(n);for(const o of r)e.add(o)}return Array.from(e)}function vP(t){const e=new Map;for(let n=0,r=t.length;n<r;n++)e.set(t[n],n);return e}const sd=(t,e,n)=>{t.has(e)||t.set(e,new Set),t.get(e).add(n)},Ko=(t,e,n)=>{const r=t.get(e);r!==void 0&&(r?.delete(n),r.size===0&&t.delete(e))},eg=(t,e=new Set(ds(t)),n=new Map)=>{const r=new Map;for(const[o,s]of n)if(!t[o])n.delete(o);else for(const i of s)t[i]||Ko(n,o,i);for(const o of e)if(o.fixedZIndex===void 0)for(const s of ds(t)){if(s.fixedZIndex!==void 0||r.get(s)?.has(o)||o===s)continue;const i=mP(o,s);if(sd(r,o,s),i===0){Ko(n,o.id,s.id),Ko(n,s.id,o.id);continue}const a=i>0?o.id:s.id,l=i>0?s.id:o.id;sd(n,a,l),Ko(n,l,a)}return n},Kl=(t,e,n=3,r=[])=>{try{return{order:gP(t),brokenLinks:to}}catch(o){if(o instanceof as){const s=o.cyclicDependency;return t.get(s[0])?.delete(s[1]),{order:Kl(t,e,n-1).order,brokenLinks:[...r,[s[0],s[1]]]}}else throw o}};class bP{constructor(e,n){this.renderContext=e,this.appearance=n,this.output=new oe({label:"AppearanceRenderer"})}#e;output;destroy(){this.output.destroy({children:!0})}tick(e){const n=this.appearance({renderContext:this.renderContext,currentRendering:this.#e,tickContext:e});n!=="no-update"&&(this.output.children.at(0)!==n.output&&(this.#e?.output&&(this.output.removeChild(this.#e.output),this.#e.output.destroy({texture:!0,children:!0})),n.output!==void 0&&this.output.addChild(n.output)),this.#e=n)}}class tg extends bP{}const id=(t,e)=>{e.poly([Y({}),Y({x:t.x}),Y({x:t.x,y:t.y}),Y({y:t.y})]).poly([Y({}),Y({z:t.z}),Y({y:t.y,z:t.z}),Y({y:t.y})]).poly([Y({x:t.x}),Y({x:t.x,z:t.z}),Y(t),Y({x:t.x,y:t.y})]).poly([Y({z:t.z}),Y({x:t.x,z:t.z}),Y({x:t.x,y:t.y,z:t.z}),Y({y:t.y,z:t.z})])},ad=(t,e)=>{const n=new ft;return id(t,n),n.stroke({width:.5,color:e,alpha:1}),n.eventMode="static",n.on("pointerenter",()=>{n.fill({color:e,alpha:.5})}),n.on("pointerleave",()=>{n.clear(),id(t,n),n.stroke({width:.5,color:e,alpha:1})}),n},wP={head:"rgba(255,184,0)",wall:"rgba(128,200,0)",portal:"rgba(255,0,255)",pickup:"rgba(0,196,255)",emitter:"rgba(0,255,255)",stopAutowalk:"rgba(255,128,128)",floatingText:"rgba(128,0,255)"};class xP{constructor(e){this.renderContext=e;const{item:n}=e,r=wP[n.type]??"rgba(255,255,255)";if(this.#e=new oe({label:`ItemBoundingBoxRenderer ${n.id}`}),fo("portal")(n)){const s=Y(n.config.relativePoint);this.#e.addChild(new ft().circle(s.x,s.y,5).stroke(r)),this.#e.addChild(new ft().circle(s.x,s.y,2).fill(r))}if(this.#e.addChild(new ft({label:"objectOrigin"}).circle(0,0,2).fill(r)),this.#e.addChild(ad(n.aabb,r)),n.renderAabb){const s="rgba(184, 184, 255)",i=ad(n.renderAabb,s);if(n.renderAabbOffset){const a=Y(n.renderAabbOffset);i.position.set(a.x,a.y),i.circle(0,0,2).fill(s)}this.#e.addChild(i)}this.#e.eventMode="static";let o;this.#e.on("pointerenter",()=>{if(o!==void 0)return;const s=`${n.id} ${n.type}
@(${n.state.position.x}, ${n.state.position.y}, ${n.state.position.z})}
#(${n.aabb.x}, ${n.aabb.y}, ${n.aabb.z})}`;this.#e.addChild(o=new cb({text:s,style:{fill:r,fontSize:6,fontFamily:"Menlo"}})),o.resolution=4}),this.#e.on("pointerleave",()=>{o!==void 0&&(this.#e.removeChild(o),o=void 0)}),e.frontLayer.attach(this.#e)}#e;tick(){}destroy(){this.#e.destroy({children:!0})}get output(){return this.#e}}class _P{constructor(e,n){this.renderContext=e,this.wrappedRenderer=n,this.#e=new oe({label:`ItemPositionRenderer ${e.item.id}`,children:[n.output]}),this.#t()}#e;#t(){const e=Y(this.renderContext.item.state.position);this.#e.x=e.x,this.#e.y=e.y}tick(e){this.wrappedRenderer?.tick(e),e.movedItems.has(this.renderContext.item)&&this.#t()}destroy(){this.#e.destroy({children:!0}),this.wrappedRenderer?.destroy()}get output(){return this.#e}}const ld={x:.5,y:1},cd=t=>typeof t!="string"&&Object.hasOwn(t,"animationId"),Ga=t=>{if(typeof t=="string")return Ga({textureId:t});{const{anchor:e,flipX:n,pivot:r,x:o,y:s,filter:i,times:a,label:l}=t;if(t.times){const u=fh(a);if(Ps(u)>=2){const h=new oe({label:l??"timesXyz"});for(let{x:m}=u;m>=1;m--)for(let{y:g}=u;g>=1;g--)for(let y=1;y<=u.z;y++){const v={...t,textureId:t.textureId??t.textureIdCallback?.(m-1,g-1,y-1),label:`(${m},${g},${y})`};delete v.times;const b=Ga(v),_=kn({x:m-1,y:g-1,z:y-1});b.x+=_.x,b.y+=+_.y,h.addChild(b)}return h}}let c;if(cd(t))c=SP(t);else{const u=t.textureId??t.textureIdCallback?.(0,0,0);c=new Sr(qt().textures[u])}if(e===void 0&&r===void 0)if(cd(t))c.anchor=ld;else{const u=t.textureId??t.textureIdCallback?.(0,0,0),d=qt().data.frames[u];if(d===void 0)throw new Error(`no spritesheet entry for textureId "${u}"`);const h=d.frame;h.pivot!==void 0?c.pivot=h.pivot:c.anchor=ld}else e!==void 0&&(c.anchor=e),r!==void 0&&(c.pivot=r);return o!==void 0&&(c.x=o),s!==void 0&&(c.y=s),i!==void 0&&(c.filters=i),l!==void 0&&(c.label=l),c.eventMode="static",n===!0&&(c.scale.x=-1),c}},G=Ga;function SP({animationId:t,reverse:e,playOnce:n,paused:r,randomiseStartFrame:o}){const s=qt().animations[t],a=(r?[s[0]]:s).map(c=>({texture:c,time:hy}));e&&a.reverse();const l=new pr(a);return l.animationSpeed=Pn.animations[t].animationSpeed,l.gotoAndPlay(o?Math.floor(Math.random()*a.length):0),n!==void 0&&(l.loop=!1,l.onComplete=()=>{l.stop(),n==="and-destroy"&&(l.visible=!1)}),l}const Ks=(t,e)=>{const n=e&&{x:e.x??1,y:e.y??1};return G({...typeof t=="string"?{textureId:t}:t,times:n})};class CP extends Sr{constructor(e){if(!(e instanceof ht)&&!e?.texture)throw new Error("UniqueTextureSprite requires a Texture");super(e)}destroy(e){const n=this.texture!==null;typeof e=="boolean"?super.destroy({texture:n,textureSource:e,children:e}):super.destroy({...e,texture:n})}}const lo=(t,e)=>{const n=e.getLocalBounds(),r=ul.create({width:Math.ceil(n.maxX-n.minX),height:Math.ceil(n.maxY-n.minY)});return e.x-=n.minX,e.y-=n.minY,t.render({container:e,target:r}),new CP({texture:r,label:`renderContainerToSprite Sprite for container ${e.label}`,pivot:{x:Math.floor(-n.minX),y:Math.floor(-n.minY)}})},wo=(t,e)=>e instanceof Sr?e:lo(t,e),zt=t=>je(({renderContext:{item:e}})=>gh(e)?G({...typeof t=="string"?{textureId:t}:t,times:ll(e)}):G(t)),Je=t=>je(({renderContext:{item:e,general:{pixiRenderer:n}}})=>{if(gh(e))return wo(n,Ks(t,ll(e)));{const r=G(t);return r instanceof Sr?r:lo(n,r)}}),je=t=>({renderContext:e,currentRendering:n,tickContext:r})=>n===void 0?{output:t({renderContext:e,currentRendering:void 0,tickContext:r}),renderProps:de}:"no-update",Dt=t=>({renderContext:{general:{pixiRenderer:e},item:n},currentRendering:r})=>{if(r===void 0){const o=ll(n),s={output:wo(e,Ks(t(n.config),o)),renderProps:de};return o&&(s.output.y-=((o.z??1)-1)*q.h),s}else return"no-update"},xo=(t,e)=>bt(Ts(t)).map(n=>{const r=e.items[n];if(r===void 0)throw new Error(`item in stoodOnBy "${n}" is not in the room`);return r});fo("head");const kP=fo("heels"),EP=fo("headOverHeels"),PP=t=>{if(kP(t))return t.state;if(EP(t))return t.state.heels},TP=1e3/25,ng=t=>{const e=Pn.animations[t],n=e.length,{animationSpeed:r}=e;return n*TP/r};ng("bubbles.white");ng("head.fadeOut");const Xl=({config:{activatedOnStoreValue:t}})=>t===void 0?!0:tl(U.getState(),t),AP=({renderContext:{general:{pixiRenderer:t},item:e,room:n},currentRendering:r})=>{const{state:{stoodOnBy:o},config:{times:s}}=e,i=r?.renderProps,a=Xl(e),l=a&&xo(o,n).find(cl)!==void 0;return i===void 0||a!==i.activated||l!==i.flashing?{output:wo(t,Ks({textureId:l?"shadowMask.teleporter.flashing":a?"shadowMask.teleporter":"shadowMask.fullBlock"},s)),renderProps:{flashing:l,activated:a}}:"no-update"},Bi=(t,e=1)=>({renderContext:{item:{state:{facing:n}}},currentRendering:r})=>{const o=r?.renderProps,s=nl(n)??"towards";if(!(o===void 0||s!==o.facingXy4))return"no-update";const a=G(s==="left"||s==="away"?`shadowMask.${t}.away`:`shadowMask.${t}.right`);return a.y=-(q.h*(e-1)),a.scale.x=s==="away"||s==="right"?1:-1,{output:a,renderProps:{facingXy4:s}}},ud={lift:Je("shadowMask.smallBlock"),conveyor:Dt(({direction:t})=>({textureId:"shadowMask.conveyor",flipX:Vt(t)==="x"})),doorLegs:Dt(({direction:t})=>({textureId:t==="right"||t==="towards"?"shadowMask.door.floatingThreshold.double.y":"shadowMask.door.legs.threshold.double.y",flipX:Vt(t)==="y"})),teleporter:AP,floor:"no-mask",barrier:Dt(({axis:t})=>({textureId:"shadowMask.barrier.y",flipX:t==="x"})),spring:Je("shadowMask.smallRound"),block:Dt(({style:t})=>t==="tower"?"shadowMask.tower":"shadowMask.fullBlock"),pushableBlock:Je("shadowMask.stepStool"),movingPlatform:Je("shadowMask.fullBlock"),hushPuppy:Je("shadowMask.hushPuppy"),portableBlock:Dt(({style:t})=>t==="drum"?"shadowMask.smallRound":"shadowMask.smallBlock"),slidingBlock:Dt(({style:t})=>t==="book"?"shadowMask.fullBlock":"shadowMask.smallRound"),deadlyBlock:Dt(({style:t})=>t==="volcano"?"shadowMask.volcano":"shadowMask.toaster"),spikes:Je("shadowMask.spikes"),switch:Je("shadowMask.switch"),pickup:Dt(({gives:t})=>{switch(t){case"scroll":return"shadowMask.scroll";case"doughnuts":return"shadowMask.doughnuts";case"fast":case"extra-life":case"jumps":case"shield":return"shadowMask.whiteRabbit";default:return"blank"}}),slidingDeadly:Je("shadowMask.smallRound"),ball:Je("shadowMask.ball"),"monster.dalek":Je("shadowMask.dalek"),"monster.turtle":Bi("turtle"),"monster.skiHead":Bi("skiHead"),"monster.homingBot":Je("shadowMask.smallRound"),joystick:Je("shadowMask.joystick"),charles:Bi("charles",2)},RP=t=>{switch(t.type){case"monster":return ud[`monster.${t.config.which}`];case"floor":return t.config.floorType==="none"?void 0:"no-mask";default:return ud[t.type]}},IP=new ob({alpha:1-Xr});class OP{constructor(e,n){if(this.renderContext=e,this.#e.filters=IP,n!=="no-mask")if(this.#n=new tg(e,n),e.item.shadowOffset===void 0)this.#e.addChild(this.#n.output);else{const r=new oe({label:"shadowMaskOffset",...Y(e.item.shadowOffset),children:[this.#n.output]});this.#e.addChild(r)}this.#e.addChild(this.#t)}#e=new oe({label:"ItemShadowRenderer"});#t=new oe({label:"shadows"});#n;#r={};get#o(){return U.getState().gameMenus.userSettings.displaySettings.showShadowMasks}#s(e){if(this.#n===void 0)return;const n=this.#n.output.children.at(0);this.#n.tick(e);const r=this.#n.output.children.at(0);if(r===void 0||!(r instanceof Sr)){const{item:o}=this.renderContext;throw new Error(`ItemShadowRenderer: this.#shadowMaskRenderer didn't create a sprite for item "${o.id}" of type "${o.type}". Have got ${r}`)}n!==r&&(this.#o?this.renderContext.frontLayer.attach(r):this.#e.mask=r)}destroy(){this.#e.destroy(!0),this.#n?.destroy();for(const e of Object.values(this.#r))e.sprite.destroy()}tick(e){if(this.#t.parent===null)throw new Error("shadow container not in scene graph");const{movedItems:n,progression:r}=e,{item:o,general:{pixiRenderer:s},room:i}=this.renderContext,a=n.has(o),l=o.state.position.z+o.aabb.z,c=Ie(i.items).filter(function(g){return g.shadowCastTexture!==void 0}),u={id:o.id,state:{position:{...o.state.position,z:l}},aabb:{...o.aabb,z:Gs}},d=Object.groupBy(c,m=>{const g=this.#r[m.id]!==void 0,y=n.has(m);return!a&&!y?g?"keepUnchanged":"noShadow":Vs(u,m)?g?"update":"create":"noShadow"});for(const m of bc(d.keepUnchanged,d.update))this.#r[m.id].renderedOnProgression=r;if(d.create)for(const m of d.create){const{times:g}=m.config,y=wo(s,Ks(m.shadowCastTexture,g));y.label=m.id,this.#t.addChild(y),this.#r[m.id]={sprite:y,renderedOnProgression:r}}for(const m of bc(d.create,d.update)){const{sprite:g}=this.#r[m.id],y=Y({...Kr(yn(m.state.position,o.state.position),m.shadowOffset??ir),z:o.aabb.z});g.x=y.x,g.y=y.y}for(const[m,{sprite:g,renderedOnProgression:y}]of ch(this.#r))y!==r&&(g.destroy(),delete this.#r[m]);const h=(d.keepUnchanged?.length??0)+(d.update?.length??0)+(d.create?.length??0)>0;this.#e.visible=h,h&&this.#s(e)}get output(){return this.#e}}const jP=t=>{const e=RP(t.item);return e===void 0?void 0:new OP(t,e)};class $P{constructor(e,n){this.renderContext=e,this.componentRenderers=n,this.output={graphics:n.graphics?.output,sound:n.sound?.output}}output;tick(e){this.componentRenderers.graphics?.tick(e),this.componentRenderers.sound?.tick(e)}destroy(){this.componentRenderers.graphics?.destroy(),this.componentRenderers.sound?.destroy()}}const ce=new window.AudioContext,qa=()=>{throw new Error(`sounds not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`)},$e=t=>{const e=typeof t=="string"?{soundId:t}:t,{playbackRate:n=1,soundId:r,connectTo:o,loop:s=!1,varyPlaybackRate:i=!1,randomiseStartPoint:a=!1}=e,l=ce.createBufferSource(),c=qa()[r];return l.buffer=c,l.loop=s,l.playbackRate.value=i?n-.05+Math.random()*.1:n,s&&a?l.start(0,c.duration*Math.random()):l.start(),o!==void 0&&l.connect(o),l},Vn=(t,e,n)=>{const r=ce.createGain();return e!==void 0&&(r.gain.value=e),t.connect(r),r.connect(n),r},Fe=({start:t,change:e,loop:n,stop:r,startAndLoopTogether:o=!1,noStartOnFirstFrame:s=!0},i)=>{let a=!0,l,c;return u=>{if(!!u!=!!c)u?t!==void 0&&!(a&&s)?(l?.stop(),l=$e({...t}),Vn(l,t.gain,i),n!==void 0&&(o?(l=$e({...n,loop:!0}),Vn(l,n.gain,i)):l.onended=()=>{c&&(l=$e({...n,loop:!0}),Vn(l,n.gain,i))})):n!==void 0&&(l=$e({...n,loop:!0}),Vn(l,n.gain,i)):(l&&l.loop&&(l.stop(),l.onended=null),r!==void 0&&(l=$e({...r}),Vn(l,r.gain,i)));else if(c!==u&&e!==void 0){const h=$e({...e});Vn(h,e.gain,i)}a=!1,c=u}};class NP{constructor(e){this.renderContext=e,this.output.gain.value=4}output=ce.createGain();#e=Fe({loop:{soundId:"rollingBallLoop",playbackRate:.5}},this.output);tick(){const{renderContext:{item:{state:{vels:{sliding:e},standingOnItemId:n}}}}=this,r=(e.x!==0||e.y!==0)&&n!==null;this.#e(r)}destroy(){}}class zP{constructor(e){this.renderContext=e;const{item:{config:{was:n}}}=e;switch(n.type){case"pickup":{n.gives!=="scroll"&&$e({soundId:"bonus",connectTo:this.output});break}case"disappearing":{$e({soundId:"destroy",connectTo:this.output});break}case"hushPuppy":{this.output.gain.value=.5,$e({soundId:"hushPuppyVanish",connectTo:this.output});break}}}output=ce.createGain();tick(){}destroy(){}}class Jl{constructor(e,n,r=1){this.renderContext=e,this.#e=Fe({start:n},this.output),this.output.gain.value=r}output=ce.createGain();#e;tick({lastRenderRoomTime:e}){const{renderContext:{item:n}}=this,{state:{collidedWith:{roomTime:r,by:o}}}=n,s=r>(e??Pe)&&!Th(Ts(o));this.#e(s)}destroy(){}}class DP{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#e.gain.value=.5,this.#n=new Jl(e,{soundId:"metalHit"},.3),this.#n.output.connect(this.output)}output=ce.createGain();#e=ce.createGain();#t=Fe({start:{soundId:"servoStart",playbackRate:.5},loop:{soundId:"servoLoop",playbackRate:.5},stop:{soundId:"servoStop",playbackRate:.5}},this.#e);#n;tick(e){const{renderContext:{item:n,room:{roomTime:r,items:o}}}=this,{state:{actedOnAt:{roomTime:s,by:i}}}=n,a=r===s&&bt(Ts(i)).some(l=>yh(o[l]));this.#t(a),this.#n.tick(e)}destroy(){}}const _o=t=>{for(const e in t)return!0;return!1},Fi=2;class MP{constructor(e){this.renderContext=e}output=ce.createGain();#e=Fe({start:{soundId:"conveyorStart",playbackRate:Fi},loop:{soundId:"conveyorLoop",playbackRate:Fi},stop:{soundId:"conveyorEnd",playbackRate:Fi}},this.output);tick(){const{renderContext:{item:{state:{stoodOnBy:e}}}}=this,n=_o(e);this.#e(n)}destroy(){this.#e(!1)}}const LP=3;class BP{constructor(e){this.renderContext=e,this.output.gain.value=.7}output=ce.createGain();#e=$e({soundId:"helicopter",loop:!0,connectTo:this.output});tick(){const{renderContext:{item:{state:{vels:{lift:{z:e}}}}}}=this;this.#e.playbackRate.value=Math.max(.5,1+LP*e)}destroy(){}}const dd={skiHead:{soundId:"softBump"},turtle:{soundId:"softBump"},dalek:{soundId:"metalHit"},homingBot:{soundId:"metalHit"},computerBot:{soundId:"metalHit"}},hd={cyberman:{soundId:"jetpackTurnaround",gain:1.2},dalek:{soundId:"mojoTurn",gain:.3}},fd={cyberman:{soundId:"jetpackLoop",gain:.7},emperorsGuardian:{soundId:"jetpackLoop"},dalek:{soundId:"mojoLoop"},bubbleRobot:{soundId:"bubbleRobotLoop"},helicopterBug:{soundId:"helicopter"}},pd={homingBot:{start:{soundId:"detect"},loop:{soundId:"robotWhirLoop",gain:4},startAndLoopTogether:!0},computerBot:{loop:{soundId:"robotBeepingLoop",randomiseStartPoint:!0,varyPlaybackRate:!0}}};class FP{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#t.connect(this.output),this.#t.gain.value=.66;const{item:{config:{which:n}}}=e;dd[n]!==void 0&&(this.#o=new Jl(e,dd[n]),this.#o.output.connect(this.output)),hd[n]!==void 0&&(this.#n=Fe({change:hd[n]},this.#e)),pd[n]!==void 0&&(this.#s=Fe(pd[n],this.#e)),fd[n]!==void 0&&(this.#r=Fe({loop:fd[n]},this.#t))}output=ce.createGain();#e=ce.createGain();#t=ce.createGain();#n;#r;#o;#s;tick(e){const{renderContext:{item:n}}=this,{state:{facing:r,activated:o,busyLickingDoughnutsOffFace:s,vels:{walking:i}}}=n;if(this.#n){const a=uh(r);this.#n(a)}if(this.#o&&this.#o.tick(e),this.#r){const a=o&&!s;this.#r(a)}if(this.#s){const a=!rl(i,ue);this.#s(a)}}destroy(){}}class Ui{constructor(e){this.renderContext=e;const{general:{soundSettings:n},item:{type:r}}=e,{noFootsteps:o}={...ol.soundSettings,...n};o||(this.#e=ce.createGain(),this.#e.gain.value=2,this.#e.connect(this.output),this.#t=Fe({loop:{soundId:`${r==="headOverHeels"?"heels":r}Walk`}},this.#e)),this.#n.gain.value=.8,this.#n.connect(this.output),this.#i.gain.value=1.2,this.#i.connect(this.output),this.#s.connect(this.output),this.#r=Fe({start:{soundId:`${r==="headOverHeels"?"head":r}Jump`}},this.#n),this.#o=Fe({loop:{soundId:`${r==="headOverHeels"?"head":r}Fall`}},this.#n)}output=ce.createGain();#e;#t;#n=ce.createGain();#r;#o;#s=ce.createGain();#l=Fe({start:{soundId:"landing"},noStartOnFirstFrame:!0},this.#s);#i=ce.createGain();#c=Fe({start:{soundId:"carry",playbackRate:.95},stop:{soundId:"carry",playbackRate:1.05}},this.#i);#a={teleportingPhase:null,positionZ:0};tick({lastRenderRoomTime:e}){const{renderContext:{item:n}}=this,{state:{action:r,teleporting:o,jumpStartZ:s,jumped:i,standingOnItemId:a,position:{z:l},vels:{gravity:{z:c}},collidedWith:{roomTime:u,by:d}}}=n,h=PP(n),{teleportingPhase:m,positionZ:g}=this.#a,y=o?o.phase:null,v=i&&l>s&&l>g&&c>0,b=l<g&&c<0&&a===null;this.#o(b),this.#r(v),this.#t!==void 0&&this.#t(!v&&!b&&r==="moving"),h!==void 0&&this.#c(h.carrying!==null);const _=a!==null&&u>(e??Pe)&&d[a];if(this.#l(_),y!==null&&y!==m)if(y==="in"){const w=qa().teleportIn,x=ce.createBufferSource();x.buffer=w,x.connect(this.output),x.start()}else{const w=qa().teleportOut,x=ce.createBufferSource();x.buffer=w,x.connect(this.output),x.start()}this.#a={teleportingPhase:y,positionZ:l}}destroy(){}}class UP{constructor(e){this.renderContext=e}output=ce.createGain();#e=void 0;tick(){const{renderContext:{item:{state:{stoodOnBy:e},config:{style:n}}}}=this;if(n!=="drum")return;const r=this.#e?.stoodOn??!1,o=_o(e);!r&&o&&$e({soundId:"drum",connectTo:this.output}),this.#e={stoodOn:o}}destroy(){}}class HP{constructor(e){this.renderContext=e,this.scrapeBracketed=Fe({loop:{soundId:"stepStoolScraping"}},this.output),this.output.gain.value=.4}output=ce.createGain();scrapeBracketed;tick({movedItems:e}){const{renderContext:{item:n,room:{roomTime:r}}}=this,{state:{actedOnAt:{roomTime:o},standingOnItemId:s}}=n,i=r===o&&s!==null&&e.has(n);this.scrapeBracketed(i)}destroy(){}}class WP{constructor(e){this.renderContext=e}output=ce.createGain();tick({lastRenderRoomTime:e}){const{renderContext:{item:{state:{stoodOnBy:n,stoodOnUntilRoomTime:r}}}}=this,o=_o(n);e!==void 0&&r>e&&!o&&$e({soundId:"springBoing",connectTo:this.output})}destroy(){}}class GP{constructor(e){this.renderContext=e,this.#e.connect(this.output)}output=ce.createGain();#e=ce.createGain();#t=void 0;tick(){const{renderContext:{item:{state:{setting:e},config:n}}}=this,r=n.type==="in-store"?tl(U.getState(),n.path)?"right":"left":e,o=this.#t?.setting;o!==void 0&&o!==r&&$e({soundId:"switchClick",playbackRate:r==="right"?.95:1.05,connectTo:this.#e}),this.#t={setting:r}}destroy(){}}class qP{constructor(e){this.renderContext=e}output=ce.createGain();#e=Fe({loop:{soundId:"teleportWarningSiren"}},this.output);tick(){const{renderContext:{item:e,room:n}}=this;this.#e(Xl(e)&&xo(e.state.stoodOnBy,n).some(cl))}destroy(){}}class VP{constructor(e){this.renderContext=e,$e({soundId:"hooter",connectTo:this.output})}output=ce.createGain();tick(){}destroy(){}}class KP extends Jl{constructor(e){super(e,{soundId:"glassClink",varyPlaybackRate:!0},.8),this.renderContext=e}}const XP=(t,e)=>Ah(xo(t.state.stoodOnBy,e).filter(vh));class JP{constructor(e){this.renderContext=e,this.output.gain.value=2}output=ce.createGain();#e=void 0;tick(e){const{renderContext:{item:n,room:r}}=this,o=XP(n,r);this.#e!==void 0&&o<this.#e&&$e({soundId:"toasterPopUpSoundUrl",connectTo:this.output}),this.#e=o}destroy(){}}const YP={lift:BP,switch:GP,bubbles:zP,head:Ui,heels:Ui,headOverHeels:Ui,teleporter:qP,monster:FP,conveyor:MP,spring:WP,portableBlock:UP,charles:DP,ball:NP,pushableBlock:HP,firedDoughnut:VP,slidingBlock:KP},ZP=t=>{if(t.item.type==="deadlyBlock"&&t.item.config.style==="toaster")return new JP(t);const e=YP[t.item.type];if(e)return new e(t)},QP={floors:{edgeLeftX:Number.POSITIVE_INFINITY,edgeRightX:Number.NEGATIVE_INFINITY,topEdgeY:Number.POSITIVE_INFINITY,bottomEdgeY:Number.NEGATIVE_INFINITY},allItems:{topEdgeY:Number.POSITIVE_INFINITY}},eT=t=>Ie(t.items).reduce((e,n)=>{if(n.type==="floor"){const{config:{naturalFootprint:r},state:{position:o},renderAabb:s,renderAabbOffset:i,aabb:a}=n,l=Y(B(r.position,{x:r.aabb.x,z:r.aabb.z})).x,c=Y(B(r.position,{y:r.aabb.y,z:r.aabb.z})).x,u=Y(B(r.position,r.aabb)).y,d=Y(B(o,i??ue,{z:(s??a).z})).y;return{allItems:e.allItems,floors:{edgeLeftX:Math.min(e.floors.edgeLeftX,l),edgeRightX:Math.max(e.floors.edgeRightX,c),topEdgeY:Math.min(e.floors.topEdgeY,u),bottomEdgeY:Math.max(e.floors.bottomEdgeY,d)}}}else{const r=Y(B(n.state.position,n.renderAabb??ue,n.renderAabbOffset??ue)).y;return{allItems:{topEdgeY:Math.min(e.allItems.topEdgeY,r)},floors:e.floors}}},QP),md=q.h*-1,gd=q.h*Wm,tT=0,nT=q.w*16,Hi=(t,e,n)=>(t-e)/(n-e)*2-1;class rT{constructor(e,n){this.renderContext=e,this.childRenderer=n,n.output.connect(this.output),this.output.rolloffFactor=2,this.output.maxDistance=5,this.output.distanceModel="exponential";const r=eT(e.room).floors;this.soundPositionMinX=r.edgeLeftX,this.soundPositionMaxX=r.edgeRightX}output=ce.createPanner();soundPositionMinX;soundPositionMaxX;tick(e){this.childRenderer.tick(e);const{item:n}=this.renderContext,r=n.state,o=B(r.position,Es(n.aabb,.5)),s=Hi(_E(o),this.soundPositionMaxX,this.soundPositionMinX),i=Hi(o.z,md,gd);if(!Number.isFinite(i))throw new Error(`y position for sound rendering is not finite;
        positionY = numberInRangeToMinus1To1Range(
          itemCentrePosition = ${o.z},
          ${md},
          ${gd},
        );
        itemCentrePosition = addXyz(
          itemState.position = ${JSON.stringify(r.position)},
          scaleXyz(${JSON.stringify(n.aabb)}, 0.5),
        )`);const a=Hi(o.x+o.y,tT,nT);this.output.positionX.value=s,this.output.positionY.value=i,this.output.positionZ.value=a}destroy(){this.childRenderer.destroy()}}const Rr=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,oT=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // we know c.a is either 0 or 1, so no need to do a step()

    finalColor = mix(c, vec4(uColour, 1), c.a);
}
`;class _s extends An{constructor(e){const n=Qt.from({vertex:Rr,fragment:oT,name:"oneColour-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uColour:{value:new Float32Array(3),type:"vec3<f32>"}}}});const r=this.resources.colorReplaceUniforms.uniforms,[o,s,i]=e.toArray();r.uColour[0]=o,r.uColour[1]=s,r.uColour[2]=i}}const sT={pureBlack:new J("#000000"),shadow:new J("#1B2D3B"),midGrey:new J("#505A55"),lightGrey:new J("#929981"),white:new J("#F8FEF8"),pastelBlue:new J("#4893FF"),metallicBlue:new J("#1D4E80"),pink:new J("#B973AF"),moss:new J("#6E7B00"),redShadow:new J("#513D40"),midRed:new J("#A7574B"),lightBeige:new J("#BF8E69"),highlightBeige:new J("#DBB269"),alpha:new J("#105A69"),replaceLight:new J("#048662"),replaceDark:new J("#052229")},iT=`#version 300 es
// keep this one at mediump for the hash function's precision
precision mediump float;

in vec2 vTextureCoord;
out vec4 finalColor;

const float LUT_SIZE = 256.0;
const float magicNumber = 31.0; // Small prime number

uniform sampler2D uTexture;
uniform sampler2D uLut;

/** returns in [0, LUT_SIZE] range
this must match the TypeScript version of the hash function*/
float hashColor(vec3 color) {
    vec3 c255 = floor(color * 255.0);
    
    float hash = mod(
        c255.r + c255.g * magicNumber + c255.b * magicNumber * magicNumber, 
        LUT_SIZE
    );
    return hash;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    float h = hashColor(c.rgb);

    // use the hash to look up the replacement in the LUT:
    vec4 replacementColour = texture(
        uLut, 
        vec2(
            // normalise h to [0, 1] range
            (h + 0.5) / LUT_SIZE, 
            0.5
        )
    );
    
    // use original if either: 
    //      original alpha is 0 (because keep transparent)
    //      or lut alpha is 0 (signals nothing in this slot of the LUT)
    finalColor = mix(c, replacementColour, c.a * replacementColour.a);
}
`,Gr=256,Wi=31,yd=new Map;function aT(t){const e=Math.floor(t.red*255),n=Math.floor(t.green*255),r=Math.floor(t.blue*255);return(e+n*Wi+r*Wi*Wi)%Gr}function lT(t){const e=new Float32Array(Gr*4);for(const[o,s]of fy(t)){const i=$[o],a=aT(i);if(e[a*4+3]>.5)throw new Error("LUT collision - mess with the hash function or lut size until this goes away");e[a*4+0]=s.red,e[a*4+1]=s.green,e[a*4+2]=s.blue,e[a*4+3]=1}const n=new Uint8Array(Gr*4);for(let o=0;o<Gr*4;o++)n[o]=Math.floor(e[o]*255);return ht.from({resource:n,width:Gr,height:1,scaleMode:"nearest"})}class cT extends An{#e;constructor(e){const n=Object.keys(e).length,r=Qt.from({vertex:Rr,fragment:iT,name:"palette-swop-filter"}),o=lT(e);super({glProgram:r,resources:{colorReplaceUniforms:{uOriginal:{value:new Float32Array(3*n),type:"vec3<f32>",size:n},uReplacement:{value:new Float32Array(3*n),type:"vec3<f32>",size:n}},uLut:o.source}}),this.#e=o;const s=this.resources.colorReplaceUniforms.uniforms;Object.entries(e).forEach(([i,a],l)=>{$[i].toArray().forEach((c,u)=>{s.uOriginal[l*3+u]=c}),a.toArray().forEach((c,u)=>{s.uReplacement[l*3+u]=c})})}destroy(e){this.#e?.destroy(!0),this.#e=null,super.destroy(e)}}const uT=t=>Object.entries(t).sort(([e],[n])=>e.localeCompare(n)).map(([e,n])=>`${e}:${n.toHex()}`).join("|"),rn=t=>{const e=uT(t);let n=yd.get(e);return n||(n=new cT(t),yd.set(e,n)),n},dT=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uTargetColor;

vec4 black = vec4(0.0, 0.0, 0.0, 1.0);

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // 1 if black, 0 if non-black
    float isBlack = step(length(c.rgb), 0.01);

    // keep original if either:
    //      * black
    //      * transparent

    finalColor = mix(    
        vec4(uTargetColor, 1),    
        c, 
        max(isBlack, 1.0 - c.a)
    );
}
`;class Ue extends An{uniforms;constructor(e="white"){const n=Qt.from({vertex:Rr,fragment:dT,name:"revert-colourise-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[n,r,o]=new J(e).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}}const hT=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    finalColor = vec4(c.rgb * 0.5, c.a);
}
`;class fT extends An{constructor(){const e=Qt.from({vertex:Rr,fragment:hT,name:"halfbrite-filter"});super({glProgram:e,resources:{}})}}const rg=({basic:t,dimmed:e})=>({replaceLight:t,replaceDark:e}),og=({color:{hue:t,shade:e},planet:n})=>{const r=t==="yellow"?e==="dimmed"||n==="jail"?pm:Qe:Us[t][e].main;return rg(r)},pT=t=>rn({lightBeige:$.lightGrey,redShadow:$.shadow,pink:$.lightGrey,moss:$.lightGrey,midRed:$.midGrey,highlightBeige:$.lightGrey,...t&&og(t)}),mT=rn({midGrey:$.midRed,lightGrey:$.lightBeige,white:$.highlightBeige,metallicBlue:$.redShadow,pink:$.midRed,moss:$.midRed,replaceDark:$.midRed,replaceLight:$.lightBeige}),vd=(t,e)=>{const n=bs(t.color).edges[e],r=n.original;return n.dimInOriginal?fm(r):r},sg=(t,e,n)=>n?rn(rg(Us[t.color.hue][t.color.shade].edges[e])):new Ue(bs(t.color).edges[e].original),yt=t=>rn(og(t)),gT=t=>{switch(t.color.hue){case"white":return rn({replaceLight:$.lightGrey,replaceDark:$.midGrey});default:return yt(t)}},ig=t=>{switch(t.color.hue){case"white":return rn({replaceLight:$.lightBeige,replaceDark:$.midRed,shadow:$.redShadow});case"yellow":return yt({planet:t.planet,color:{hue:"yellow",shade:"dimmed"}});default:return yt(t)}};new fT;const on=to,yT=rn(sT),vT=[new _s($.midRed)],bT=[new _s($.moss)],wT=75;class xT{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output)}output=new oe({label:"ItemFlashOnSwitchedRenderer"});tick(e){const{renderContext:{item:{state:{switchedAtRoomTime:n,switchedSetting:r}},room:{roomTime:o}}}=this;this.output.filters=o-n<wT?r==="left"?bT:vT:on,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const _T=(t,e,n)=>{const o=qt().textures[`door.frame.${t.planet}.${e}.near`]!==void 0?t.planet:"generic",s=t.color.shade==="dimmed"&&qt().textures[`door.frame.${o}.dark.${e}.${n}`]!==void 0;return`door.frame.${o}${s?".dark":""}.${e}.${n}`};function Xs(t,e){const n=e||new oe;for(const r of t)n.addChild(r);return n}function*ST({config:{direction:t,inHiddenWall:e,height:n}},r){const o=ho(t),s=o==="y"?1:16;function*i(a){if(e){if(n!==0){const l=G({textureId:`generic.door.floatingThreshold.${o}`,...Kr(a,{y:-12*n})});l.filters=sg(r,o==="x"?"towards":"right",!0),yield l}}else{yield G({pivot:{x:s,y:9},textureId:`generic.door.legs.base.${o}`,...Kr(a,{})});for(let l=1;l<n;l++)yield G({pivot:{x:s,y:9},textureId:`generic.door.legs.pillar.${o}`,...Kr(a,{y:-l*q.h})})}}yield*i(kn({...ir,[o]:1})),yield*i(ir),e||(yield G({pivot:{x:16,y:q.h*n+13},textureId:`generic.door.legs.threshold.double.${o}`,...kn({...ir,[o]:1})}))}const ag=(t,e)=>{const n=ho(t),r=kr(n),o=8;return t==="towards"||t==="right"?Y({[r]:e[r]-o}):ir},CT=je(({renderContext:{item:t,room:e}})=>Xs(ST(t,e),new oe({filters:yt(e),...ag(t.config.direction,t.aabb)}))),kT=je(({renderContext:{item:{config:{direction:t,part:e,toRoom:n},aabb:r},room:o,general:{gameState:s}}})=>{const i=ho(t),a=s===void 0?o:s.campaign.rooms[n];return G({textureId:_T(o,i,e),filter:yt(a),...ag(t,r)})}),Gi={animationId:"bubbles.cold"},rr=({top:t,bottom:e="headlessBase",filter:n})=>{const r=new oe({filters:n}),o=G(e);r.addChild(o);const s=G(t);return s.y=-12,r.addChild(s),r[Js]=s,r[Yl]=o,r},Js=Symbol(),Yl=Symbol(),ET=({top:t,bottom:e})=>{const n=new oe;return n.addChild(e),t.y=-12,n.addChild(t),n[Js]=t,n[Yl]=e,n},PT=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform vec2 uTextureSize;
uniform sampler2D uTexture;
uniform vec3 uOutline;
uniform float uOutlineWidth;

void main(void) {
    vec2 scaledTexelSize = vec2(1.0f) / vec2(textureSize(uTexture, 0)) * uOutlineWidth;    
    
    // Calculate offset coordinates
    vec2 rightCoord = vec2(vTextureCoord.x + scaledTexelSize.x, vTextureCoord.y);
    vec2 leftCoord = vec2(vTextureCoord.x - scaledTexelSize.x, vTextureCoord.y);
    vec2 belowCoord = vec2(vTextureCoord.x, vTextureCoord.y + scaledTexelSize.y);
    vec2 aboveCoord = vec2(vTextureCoord.x, vTextureCoord.y - scaledTexelSize.y);
    
    // Create boundary masks (1.0 if within bounds, 0.0 if out of bounds)
    // seems to work fine without this, but could multiply colourToX by this to get zero'd out when OOB
    // float rightInBounds = step(rightCoord.x, 1.0);
    // float leftInBounds = step(0.0, leftCoord.x);
    // float belowInBounds = step(belowCoord.y, 1.0);
    // float aboveInBounds = step(0.0, aboveCoord.y);
    
    vec4 colourToRight = texture(uTexture, rightCoord);
    vec4 colourToLeft = texture(uTexture, leftCoord);
    vec4 colourBelow = texture(uTexture, belowCoord);
    vec4 colourAbove = texture(uTexture, aboveCoord);
    
    // Check if any neighbor is opaque (combine all alpha values)
    float hasOpaqueNeighbor = max(max(colourToRight.a, colourToLeft.a), 
                                  max(colourBelow.a, colourAbove.a));

    vec4 originalColour = texture(uTexture, vTextureCoord);
        
    finalColor = mix(
        originalColour, 
        vec4(uOutline, 1), 
        // 1 if: original colour is transparent and has an opaque neighbour - use outline colour
        // 0 if: original colour is opaque or has no opaque neighbour - use original colour (transparent or sprite)
        (1.0 - originalColour.a) * hasOpaqueNeighbor
    );
}
`;class vt extends An{constructor({outlineColor:e,upscale:n,lowRes:r}){const o=Qt.from({vertex:Rr,fragment:PT,name:"outline-filter"});super({glProgram:o,padding:n,resources:{colorReplaceUniforms:{uOutline:{value:new Float32Array(3),type:"vec3<f32>"},uOutlineWidth:{value:new Float32Array(1),type:"f32"}}}});const s=this.resources.colorReplaceUniforms.uniforms,[i,a,l]=e.toArray();s.uOutline[0]=i,s.uOutline[1]=a,s.uOutline[2]=l,s.uOutlineWidth[0]=n,r&&(this.resolution=1/n,this.padding=n,s.uOutlineWidth[0]=1)}}const TT=t=>{const{gameTime:e,lastDiedAt:n}=t.type==="headOverHeels"?t.state.head:t.state;return e-n<EE},qi=t=>{if(t===void 0)return 0;const{shieldCollectedAt:e,gameTime:n}=t;return e!==null&&e+Gu>n?100-Math.ceil((n-e)/(Gu/100)):0},AT=t=>t.type==="headOverHeels"?qi(t.state.head)>0||qi(t.state.heels)>0:qi(t.state)>0,Ys=t=>t,Va=.02,RT=({name:t,action:e,facingXy8:n,teleportingPhase:r,gravityZ:o,paused:s})=>{if(e==="death")return{animationId:`${t}.fadeOut`,paused:s};if(r==="out")return{animationId:`${t}.fadeOut`,paused:s};if(r==="in")return{animationId:`${t}.fadeOut`,paused:s};if(e==="moving")return{animationId:`${t}.walking.${n}`,paused:s};if(e==="jumping")return{textureId:o<Va?`${t}.walking.${n}.2`:`${t}.walking.${n}.1`};if(e==="falling"){const a=`${t}.falling.${n}`;if(fs(a))return{textureId:a}}const i=`${t}.idle.${n}`;return Jh(i)?{animationId:i,paused:s}:{textureId:`${t}.walking.${n}.2`}},Ka=Symbol(),Xa=Symbol(),IT=(t,e)=>{t[Ka].removeChildren(),t[Ka].addChild(G(RT(e)))},lg=rn({pastelBlue:$.pink}),Vi=(t,e,n)=>{const r=new oe,o=new oe;r[Ka]=o,r.addChild(o);const s=G({animationId:e?`shine.${t}InSymbio`:"shine",paused:n,filter:t==="heels"?lg:on,flipX:t==="heels"});return r[Xa]=s,r},bd=({gameTime:t,switchedToAt:e},n,r)=>(n==="headOverHeels"||n===r)&&e+kE>t,OT=t=>{if(!TT(t))return!1;const{gameTime:e,lastDiedAt:n}=t.type==="headOverHeels"?t.state.head:t.state;return(e-n)%qu<qu*PE},wd=(t,e)=>{t.filters?Array.isArray(t.filters)?t.filters=[...t.filters,e]:t.filters=[t.filters,e].flat():t.filters=e},xd=(t,e)=>{t.filters=Array.isArray(t.filters)?t.filters.filter(n=>!(n instanceof e)):t.filters instanceof e?on:[...t.filters]},jT=(t,{highlighted:e,flashing:n},r,o)=>{const s=r?.highlighted??!1;e&&!s?wd(o,new vt({outlineColor:nr[t],upscale:en(U.getState()),lowRes:!1})):!e&&s&&xd(o,vt);const i=r?.flashing??!1;n&&!i?wd(o,new _s(nr[t])):!n&&i&&xd(o,_s)},$T=(t,e,n)=>{e&&!n?t.addChild(t[Xa]):!e&&n&&t.removeChild(t[Xa])},Ki=(t,e,n,r,o,s)=>{n&&IT(e,{name:t,...r,paused:o}),jT(t,r,s,e),$T(e,r.shining,s?.shining??!1)},NT=({renderContext:{item:t,general:{gameState:e,paused:n}},currentRendering:r})=>{const{type:o,state:{action:s,facing:i,teleporting:a,vels:{gravity:{z:l}}}}=t,c=r?.renderProps,u=r?.output,d=uh(i)??"towards",h=e!==void 0&&(t.type==="headOverHeels"?bd(t.state.head,"headOverHeels","headOverHeels"):bd(t.state,t.type,e.currentCharacterName)),m=OT(t),g=AT(t),y=Ps(i),v=a?.phase??null,b={action:s,facingXy8:d,teleportingPhase:v,flashing:m,highlighted:h,shining:g,gravityZ:l},_=c===void 0||c.action!==s||c.facingXy8!==d||c.teleportingPhase!==v||c?.gravityZ>Va!=l>Va;let w;if(o==="headOverHeels"){w=u??ET({top:Vi("head",!0,n),bottom:Vi("heels",!0,n)});const x=w;Ki("head",x[Js],_,b,n,c),Ki("heels",x[Yl],_,b,n,c)}else w=u??Vi(o,!1,n),Ki(o,w,_,b,n,c);return s==="moving"&&u instanceof pr&&(u.animationSpeed=y*py),{output:w,renderProps:b}},Xi=Ys(NT),_d=t=>t-Math.floor(t),zT=({state:{position:t}},e)=>{const n=o=>o.config.direction==="away"||o.config.direction==="left";return Xs(Ie(e.items).filter(o=>o.type==="wall"||o.type==="doorLegs").filter(n).map(o=>{const{id:s,config:{direction:i},state:{position:a}}=o;return G({textureId:"floorOverdraw.cornerNearWall",label:s,...Y(dr(a,t)),times:o.type==="wall"?al(o.config):{[kr(Vt(i))]:2},anchor:{x:0,y:1},flipX:i==="away"})}),new oe({label:"floorOverdraws"}))},DT=`#version 300 es
precision lowp float;

out vec4 finalColor;

in vec2 vTextureCoord;
uniform sampler2D uBackBuffer;
uniform vec3 uTargetColor;
// do not use uTexture in this frag - for some reason it causes pixi's render pipeline
// to take away the backbuffer, which we rely on sampling from

void main() {
    vec3 bg = texture(uBackBuffer, vTextureCoord).rgb;

    float isBlack = step(length(bg), 0.001f); // 1 if black, 0 otherwise
    finalColor = mix(vec4(uTargetColor, 1.0f), vec4(0, 0, 0, 0), isBlack);


}`;class Sd extends An{uniforms;constructor(e="white"){const n=Qt.from({vertex:Rr,fragment:DT,name:"colour-clash-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}},blendRequired:!0}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[n,r,o]=new J(e).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}}const Cd=({colourised:t,direction:e,room:n,times:r,position:o,colourSwap:s})=>G({label:`floorEdge(${e})`,textureId:`floorEdge.${e}`,times:r,filter:s?sg(n,e,t):void 0,...Y(o)}),MT=({room:t,xSize:e,ySize:n,y:r})=>{const o=new oe({label:"floorColourClash"}),s=vd(t,"right");for(let a=0;a<=n;a++){const l=kn({x:0,y:a,z:0}),c=new ft().rect(l.x-(a===0?0:8),l.y,8*3,8).fill(s);c.filters=new Sd(s),o.addChild(c)}const i=vd(t,"towards");for(let a=0;a<=e;a++){const l=kn({x:a,y:0,z:0}),c=new ft().rect(l.x-16,l.y,8*(a===0?2:3),8).fill(i);c.filters=new Sd(i),o.addChild(c)}return o.y=r,o},LT=je(({renderContext:{room:t,item:e,general:{colourised:n,pixiRenderer:r},colourClashLayer:o}})=>{const{color:{shade:s}}=t,{config:i,state:{position:a},aabb:l}=e,{floorType:c,naturalFootprint:u}=i,d=new oe({label:"floorAppearance"}),h=Y({...l,y:0}),m=Y({...l,x:0,y:0}),g=Y({...l,x:0}),y=Y(l);if(c!=="none"){const v=new oe({label:"tiles"}),b=c==="deadly"?`generic${s==="dimmed"?".dark":""}.floor.deadly`:`${i.scenery}${s==="dimmed"?".dark":""}.floor`,_=qt().textures[b];try{Xh(b)}catch(V){throw new Error(`no floor textureId for floorType: ${c}, shade: ${s}`,{cause:V})}const w=yn(u.position,a),x={x:_d(w.x/q.w),y:_d(w.y/q.w)},C=8,k={x:h.x,y:y.y-C,width:g.x-h.x,height:m.y-y.y+2*C},S=yn(kn(Kr(x,{x:.5,y:.5})),{y:l.z},k),N=new ib({texture:_,tilePosition:S,...k});v.addChild(N),v.addChild(zT(e,t));const H=new ft().moveTo(y.x,y.y).lineTo(g.x,g.y).lineTo(g.x,g.y+3).lineTo(m.x,m.y+3).lineTo(h.x,h.y+3).lineTo(h.x,h.y).fill({color:16711680,alpha:.5});v.addChild(H),v.mask=H,v.filters=[gT(t)];const L=new oe({children:[v]});L.filters=new vt({outlineColor:$.pureBlack,upscale:1,lowRes:!1}),d.addChild(lo(r,L))}{const v=new oe({label:"edges"});c==="none"&&v.addChild(new ft().moveTo(g.x,g.y+8).lineTo(g.x,g.y+100).lineTo(h.x,h.y+100).lineTo(h.x,h.y+8).lineTo(m.x,m.y+8).fill(0));const b=Math.ceil(l.y/q.w);v.addChild(Cd({colourised:n,direction:"right",room:t,times:{y:b},position:{z:l.z},colourSwap:n}));const _=Math.ceil(l.x/q.w);if(v.addChild(Cd({colourised:n,direction:"towards",room:t,times:{x:_},position:{z:l.z},colourSwap:n})),d.addChild(lo(r,v)),!n){const w=MT({xSize:_,ySize:b,y:-l.z+1,room:t});d.addChild(w),o.attach(w)}}return d}),BT=["cyberman","dalek","skiHead","bubbleRobot","computerBot","turtle","homingBot"],FT=t=>{let e=2166136261;const n=t.length;for(let r=Math.max(0,n-9);r<n;r++)e^=t.charCodeAt(r),e=Math.imul(e,1540483477),e^=e>>>15;return(e>>>0)/4294967295},UT=200,HT=1,WT=(t,e)=>{const n=FT(e);return Math.sin((t+n*2e4)/UT)*HT},kd=({id:t,config:{which:e},state:n},r,o)=>{if((e==="cyberman"||e==="bubbleRobot")&&n.activated||e==="emperorsGuardian"){const s=o;s[Js].y=-12+WT(r.roomTime,t)}},GT=({renderContext:{item:t,room:e,general:{paused:n}},currentRendering:r})=>{const{config:o,state:s}=t,i=r?.renderProps,{activated:a,busyLickingDoughnutsOffFace:l}=s,c=l?mT:a?void 0:BT.includes(o.which)?pT(e):void 0;switch(o.which){case"skiHead":case"turtle":case"cyberman":case"computerBot":case"elephant":case"elephantHead":case"monkey":{const u=nl(s.facing)??"towards";if(!(i===void 0||a!==i.activated||l!==i.busyLickingDoughnutsOffFace||u!==i.facingXy4))return kd(t,e,r.output),"no-update";const h={facingXy4:u,activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"skiHead":return{output:G({textureId:`${o.which}.${o.style}.${u}`,filter:c}),renderProps:h};case"elephantHead":return{output:G({textureId:`elephant.${u}`,filter:c}),renderProps:h};case"turtle":return{output:G(a&&!l?{animationId:`${o.which}.${u}`,filter:c,paused:n}:{textureId:`${o.which}.${u}.1`,filter:c}),renderProps:h};case"cyberman":return{output:s.activated||s.busyLickingDoughnutsOffFace?rr({top:{textureId:`${o.which}.${u}`,filter:c||yt(e)},bottom:{...Gi,paused:n}}):G({textureId:`${o.which}.${u}`,filter:c}),renderProps:h};case"computerBot":case"elephant":case"monkey":return{output:rr({top:`${o.which}.${u}`,bottom:{animationId:"headlessBase.flash",playOnce:"and-stop"},filter:c}),renderProps:h};default:throw new Error(`unexpected monster ${o}`)}break}case"homingBot":{const u=!my(s.vels.walking,ir);return i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated||u!==i.walking?{filter:c,output:G(a&&!l?{animationId:u?"headlessBase.flash":"headlessBase.scan",filter:c}:{textureId:"headlessBase",filter:c}),renderProps:{activated:a,busyLickingDoughnutsOffFace:l,walking:u}}:"no-update"}case"helicopterBug":case"emperor":case"dalek":case"bubbleRobot":case"emperorsGuardian":{if(!(i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated))return kd(t,e,r.output),"no-update";const d={activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"helicopterBug":case"dalek":return{output:G(a&&!l?{animationId:o.which,filter:c,paused:n}:{textureId:`${o.which}.1`,filter:c}),renderProps:d};case"bubbleRobot":return{output:rr({top:{...Gi,paused:n},filter:c}),renderProps:d};case"emperorsGuardian":return{output:rr({top:"ball",bottom:{...Gi,paused:n},filter:c}),renderProps:d};case"emperor":return{output:G({animationId:"bubbles.cold",filter:c,paused:n}),renderProps:d};default:throw new Error(`unexpected monster ${o}`)}break}default:throw new Error(`unexpected monster ${o}`)}},Xo=new vt({outlineColor:$.pureBlack,upscale:en(U.getState()),lowRes:!0});new Ue;new Ue;new Ue;new Ue($.moss);new Ue;new Ue(nr.head),new Ue(br(nr.head)),new Ue(nr.heels),new Ue(br(nr.heels));function*qT(t){const e=typeof t=="string"?t==="infinite"?"":t:t.toString(),n=Ah(e);let r=0;for(const o of e){const s=`hud.char.${nh(o)}`;try{Xh(s)}catch(i){throw new Error(`no texture id for char "${o}": ${i.message}`,{cause:i})}yield G({textureId:s,x:(r+.5-n/2)*gy.w}),r++}}const cg=(t,e)=>{t.removeChildren();try{Xs(qT(e),t)}catch(n){throw console.error("invalid string is",e,"and on window as window.invalid"),console.error(n),window.invalid=e,new Error(`could not show text "${e}" in container because: "${n.message}"`,{cause:n})}return t},VT=Hm.floatingText,KT=12,Ed=q.h*3,Pd=[$.shadow,$.midGrey,$.redShadow,$.metallicBlue,$.midRed,$.moss,$.pink,$.lightBeige,$.pastelBlue,$.lightGrey,$.highlightBeige],Td=[...Pd,...new Array(20).fill($.white),...Pd.toReversed()],XT=({renderContext:{item:{config:{textLines:t,appearanceRoomTime:e}},room:{roomTime:n},general:{displaySettings:{uncolourised:r}},frontLayer:o},currentRendering:s})=>{const i=s?.output;let a;const c=(n-e)*VT;if(i===void 0){a=new oe({filters:new vt({outlineColor:$.pureBlack,upscale:en(U.getState()),lowRes:!1})}),o?.attach(a);for(let d=0;d<t.length;d++){const h=t[d],m=cg(new oe({label:h,y:d*KT,filters:r?on:new Ue($.pink)}),h.toUpperCase());a.addChild(m)}}else a=i;let u=!1;for(let d=0;d<t.length;d++){const h=a.children[d],[m]=h.filters,g=c+d*-12,y=g>0&&g<Ed;if(h.visible=y,u||=y,y&&m){const v=Math.floor(g/Ed*Td.length);m.targetColor=Td[v]}}return a.visible=u,a.y=-c,{output:a,renderProps:de}},Ad=500,JT=Pn.animations["conveyor.x"].animationSpeed,Rd=Pn.animations["conveyor.x"].length,YT=t=>1-(1-t)**2,ZT=(t,e)=>{for(let n=0;n<t.children.length;n++){const r=t.children[n],o=n%Rd;r.gotoAndStop(e?Rd-o-1:o)}},QT=(t,e)=>{const n=Vt(t),r=G({animationId:`conveyor.${n}`,reverse:t==="towards"||t==="right",times:e}),o=r instanceof pr?new oe({children:[r]}):r;return ZT(o,t==="towards"||t==="right"),o},eA=({renderContext:{item:{config:{direction:t,times:e},state:{stoodOnBy:n}},room:{roomTime:r}},currentRendering:o})=>{const s=o?.renderProps,i=_o(n),a=(!i&&s?.moving?r:s?.roomTimeStoppedMoving)??Pe,l=o?.output??QT(t,e),c=i?0:Math.min(r-a,Ad),u=Math.max(0,1-c/Ad);for(const d of l.children)if(u===0)d.stop();else{const h=JT*YT(u);d.play(),d.animationSpeed=h}return{output:l,renderProps:{moving:i,roomTimeStoppedMoving:a}}},tA=Ys(eA),nA=({renderContext:{item:t,room:e,general:{paused:n}},currentRendering:r})=>{const{state:{stoodOnBy:o},config:{times:s}}=t,i=r?.renderProps,a=Xl(t),l=a&&xo(o,e).some(cl);return i===void 0||a!==i.activated||l!==i.flashing?{output:l?new oe({children:[G({textureId:"teleporter",times:s}),G({animationId:"teleporter.flashing",times:s,paused:n})]}):G({textureId:a?"teleporter":"block.artificial",times:s}),renderProps:{flashing:l,activated:a}}:"no-update"},rA=({renderContext:{item:{state:{facing:t,actedOnAt:{roomTime:e,by:n}}},room:{roomTime:r,items:o}},currentRendering:s})=>{const i=s?.renderProps,a=nl(t)??"towards",l=r===e&&bt(Ts(n)).some(u=>yh(o[u]));return i===void 0||a!==i.facingXy4||l!==i.controlledByJoystick?{output:rr({top:`charles.${a}`,bottom:l?"headlessBase.all":"headlessBase"}),renderProps:{facingXy4:a,controlledByJoystick:l}}:"no-update"},oA=({renderContext:{item:{state:{stoodOnBy:t,stoodOnUntilRoomTime:e}},general:{paused:n}},tickContext:{lastRenderRoomTime:r},currentRendering:o})=>{const s=o?.renderProps,i=_o(t);let a;return o?.output?a=o?.output:(a=G({animationId:"spring.bounce"}),a.loop=!1,a.gotoAndStop(0)),r!==void 0&&e>r&&!i&&!n?a.gotoAndPlay(0):i&&!(s?.compressed??!1)&&a.gotoAndStop(1),{output:a,renderProps:{compressed:i}}},sA=Ys(oA),iA=({renderContext:{item:{config:{which:t,startDirection:e}}},currentRendering:n})=>n?.renderProps===void 0?{output:t==="headOverHeels"?rr({top:{textureId:`head.walking.${e}.2`},bottom:{textureId:`heels.walking.${e}.2`}}):G({textureId:`${t}.walking.${e}.2`}),renderProps:de}:"no-update",aA=({renderContext:{item:{state:{vels:{sliding:t}},config:{startingPhase:e}},general:{paused:n}},tickContext:{deltaMS:r},currentRendering:o})=>{const i=(o?.renderProps?.distanceTravelled??0)+sl(t)*(n?0:r),l=o?.output??G("spikyBall.1"),u=(Math.floor(i*2/sr.w)+e)%2+1;return l.texture=qt().textures[`spikyBall.${u}`],{output:l,renderProps:{distanceTravelled:i}}},lA=Ys(aA),cA=(t,e,n,r)=>`${t}${r?".dark":""}.wall.${e}.${n}`,uA=je(({renderContext:{general:{pixiRenderer:t},item:{id:e,config:n},room:r}})=>{if(n.direction==="right"||n.direction==="towards")throw new Error(`wall is near: ${e}`);const{direction:o,tiles:s}=n,i=kr(Vt(o)),a=new oe({label:"wallTiles"}),l=new oe({label:"wallAnimations"});for(let u=0;u<n.tiles.length;u++){const d=kn({[i]:u});if(a.addChild(G({textureId:cA(r.planet,s[u],o,r.color.shade==="dimmed"),...d,pivot:o==="away"?{x:sr.w,y:sr.h}:{x:0,y:sr.h}})),r.planet==="moonbase"){const h=`moonbase.wall.screen.${s[u]}.away`;Jh(h)&&l.addChild(G({animationId:h,randomiseStartFrame:!0,flipX:o==="left",x:d.x+(o==="away"?-8:8),y:d.y-23}))}}const c=new oe({label:"wallAppearance"});return c.addChild(lo(t,a)),l.children.length>0&&c.addChild(l),c.filters=yt(r),c}),dA=({renderContext:{item:{state:{setting:t},config:e}},currentRendering:n})=>{const r=n?.renderProps,o=e.type==="in-store"?tl(U.getState(),e.path)?"right":"left":t;return r===void 0||o!==r.setting?{output:G(`switch.${o}`),renderProps:{setting:o}}:"no-update"},hA=(t,e,n)=>e==="tower"?"tower":e==="book"?"book.x":e==="organic"&&t?`block.organic.dark${n?".disappearing":""}`:`block.${e}${n?".disappearing":""}`,fA=({renderContext:{general:{pixiRenderer:t},item:{config:{style:e,times:n},state:{disappearing:r}},room:o},currentRendering:s})=>{const i=s?.renderProps,a=r!==null;return i===void 0||i.isDissapearing!==a?{output:wo(t,G({textureId:hA(o.color.shade==="dimmed",e,a),filter:e==="organic"?yt(o):e==="book"?ig(o):void 0,times:n})),renderProps:{isDissapearing:a}}:"no-update"},pA=({state:{stoodOnBy:t,position:e},config:{times:n}},r)=>{const o=new Array(n?.x??1).fill(null).map(()=>new Array(n?.y??1));return xo(t,r).filter(vh).forEach(({id:s,state:{position:i}})=>{const a=yn(i,e),l={x:Math.floor(a.x/q.w),y:Math.floor(a.y/q.d)};l.x<0||l.x>=(n?.x??1)||l.y<0||l.y>=(n?.y??1)||(o[l.x][l.y]=s)}),o},mA=(t,e)=>{let n=0,r=1;for(const o of e)for(const s of o)s!==void 0&&t.items[s]?.state.activated&&(n|=r),r<<=1;return n},gA=({renderContext:{item:t,room:e},currentRendering:n})=>{const{config:{times:r}}=t,o=n===void 0?pA(t,e):n.renderProps.chargePositions,s=mA(e,o);return s!==n?.renderProps.cybermanActivationBitmask?{output:G({textureIdCallback(a,l){const c=o[a][l];return c===void 0||e.items[c]?.state.everActivated?"toaster.off":"toaster.on"},times:r??de}),renderProps:{chargePositions:o,cybermanActivationBitmask:s}}:"no-update"},yA={head:Xi,heels:Xi,headOverHeels:Xi,doorFrame:kT,doorLegs:CT,monster:GT,floatingText:XT,barrier:je(({renderContext:{item:{config:{axis:t,times:e}}}})=>G({textureId:`barrier.${t}`,times:e})),deadlyBlock:je(({renderContext:{item:{config:t},room:e}})=>{switch(t.style){case"volcano":return G({animationId:"volcano",filter:yt(e),times:t.times,randomiseStartFrame:!0});case"toaster":throw new Error("use the special toaster appearance instead");default:throw t.style,new Error("unknown deadly block style")}}),spikes:zt("spikes"),slidingDeadly:lA,slidingBlock:je(({renderContext:{item:{config:{style:t}},room:e}})=>G(t==="book"?{textureId:"book.y",filter:ig(e)}:t)),block:fA,switch:dA,conveyor:tA,lift:je(({renderContext:{general:{paused:t}}})=>{const e=new oe,n={x:oc.w/2,y:oc.h};return e.addChild(G({animationId:"lift",pivot:n,paused:t})),e.addChild(G({textureId:"lift.static",pivot:n})),e}),teleporter:nA,sceneryCrown:je(({renderContext:{item:{config:{planet:t}}}})=>G({textureId:`crown.${t}`})),pickup:je(({renderContext:{item:{config:t},room:e,general:{paused:n}}})=>{if(t.gives==="crown")return G({textureId:`crown.${t.planet}`});const o={shield:"whiteRabbit",jumps:"whiteRabbit",fast:"whiteRabbit","extra-life":"whiteRabbit",bag:"bag",doughnuts:"doughnuts",hooter:"hooter",scroll:{textureId:"scroll",filter:yt(e)},reincarnation:{animationId:"fish",paused:n}}[t.gives];return G(o)}),moveableDeadly:zt("fish.1"),charles:rA,joystick:zt("joystick"),movingPlatform:zt("sandwich"),pushableBlock:zt("stepStool"),portableBlock:je(({renderContext:{item:{config:{style:t}}}})=>G(t)),spring:sA,sceneryPlayer:iA,hushPuppy:zt("hushPuppy"),bubbles:je(({renderContext:{item:{config:{style:t}},general:{paused:e}}})=>G({animationId:`bubbles.${t}`,paused:e})),firedDoughnut:zt({animationId:"bubbles.doughnut"}),ball:zt("ball"),floor:LT,particle:je(({renderContext:{item:{config:{forCharacter:t}}}})=>G({animationId:"particle.fade",anchor:{x:.5,y:.5},filter:t==="heels"?lg:on}))},vA=t=>{if(t.type==="wall"){const{direction:e}=t.config;return e==="right"||e==="towards"?void 0:uA}return t.type==="deadlyBlock"&&t.config.style==="toaster"?gA:yA[t.type]},bA=$.moss,wA=()=>new vt({outlineColor:bA,lowRes:!1,upscale:en(U.getState())});class xA{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output)}output=new oe({label:"PortableItemPickUpNextHighlightRenderer"});#e=!1;tick(e){const{wouldPickUpNext:n}=this.renderContext.item.state;n!==!this.#e&&(this.output.filters=n?[wA()]:on),this.#e=n,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const _A=(t,e,n)=>lv(t)?new xA(e,n):n,SA=$.pastelBlue,CA=$.highlightBeige,kA=$.midRed,EA=$.white,Id=new vt({outlineColor:CA,upscale:en(U.getState()),lowRes:!1}),Od=new vt({outlineColor:kA,upscale:en(U.getState()),lowRes:!1}),PA=new vt({outlineColor:EA,upscale:en(U.getState()),lowRes:!1}),jd=new Ue(SA),$d={left:"↖",away:"↗",right:"↘",towards:"↙"},Nd=(t,e)=>{switch(t){case"back-forth":switch(e){case"left":return"↖↘";case"right":return"↘↖";case"away":return"↗↙";case"towards":return"↙↗";default:throw new Error("Unexpected startDirection")}case"clockwise":switch(e){case"left":return"↖↗↘↙";case"right":return"↘↙↖↘";case"away":return"↗↘↙↖";case"towards":return"↙↖↗↘";default:throw new Error("Unexpected startDirection")}case"towards-analogue":return"➡.⬅"}return""};class TA{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output),this.#e()}output=new oe({label:"EditorAnnotationsRenderer"});#e(){const e=this.renderContext.item;switch(e.type){case"pickup":if(e.config.gives==="shield"||e.config.gives==="extra-life"||e.config.gives==="jumps"||e.config.gives==="fast"){const n={shield:"🛡",jumps:"♨",fast:"⚡","extra-life":"+2"};this.#t({annotationText:n[e.config.gives],yAdj:-16})}break;case"doorFrame":if(e.config.part==="near"){const{rooms:n}=U.getState().levelEditor.campaignInProgress,{config:{toRoom:r,direction:o}}=e,s=!!n[r],i=r.toUpperCase(),a=$d[o],l=o==="away"||o==="right"?`${i}${a}`:`${a}${i}`;this.#t({annotationText:l,yAdj:o==="left"||o==="away"?-48:0,error:!s,clickDispatch:s?()=>la(r):void 0})}break;case"teleporter":{const{rooms:n}=U.getState().levelEditor.campaignInProgress,{config:{toRoom:r}}=e,o=!!n[r];this.#t({annotationText:`➡${r.toUpperCase()}`,yAdj:-12,error:!o,clickDispatch:o?()=>la(r):void 0})}break;case"conveyor":{const{config:{direction:n}}=e,r=$d[n];this.#t({annotationText:r,yAdj:-12})}break;case"movingPlatform":{const{config:{movement:n,startDirection:r}}=e;this.#t({annotationText:Nd(n,r),yAdj:-12})}break;case"monster":{const{config:n}=e;(n.which==="turtle"||n.which==="skiHead")&&this.#t({annotationText:Nd(n.movement,n.startDirection),yAdj:-12})}break}}#t({annotationText:e,yAdj:n=0,error:r=!1,clickDispatch:o}){const{renderContext:{frontLayer:s}}=this,i=new Ue(r?$.midRed:$.white),a=cg(new oe({label:"EditorAnnotationTextContainer",filters:[i,new vt({lowRes:!0,outlineColor:$.pureBlack,upscale:en(U.getState())})]}),e);a.y=n,o!==void 0&&(a.eventMode="static",a.on("click",()=>{U.dispatch(o())}),a.on("mouseover",()=>{U.getState().levelEditor.tool.type==="pointer"&&(U.dispatch(lc(!0)),i.targetColor=$.pastelBlue)}),a.on("mouseout",()=>{U.dispatch(lc(!1)),i.targetColor=$.white}),a.cursor="pointer"),this.output.addChild(a),s.attach(a)}tick(e){this.#n(),this.childRenderer.tick(e)}#n(){const{renderContext:{item:e,room:n}}=this,{clickableAnnotationHovered:r}=U.getState().levelEditor,{jsonItemId:o}=e,s=U.getState(),i=bh(s),a=cv(s),l=pn(s),c=o&&i?.jsonItemId===o&&!r,u=o&&a.includes(o),d=()=>o!==void 0&&(Ie(n.items).some(h=>h.jsonItemId===i?.jsonItemId&&h.type==="switch"&&h.config.type==="in-room"&&h.config.modifies.some(m=>m.targets.includes(o)))||e.type==="switch"&&Ie(n.items).some(({jsonItemId:h})=>h!==void 0&&h===i?.jsonItemId&&e.config.type==="in-room"&&e.config.modifies.some(m=>m.targets.includes(h)))||e.type==="charles"&&Ie(n.items).some(h=>h.jsonItemId===i?.jsonItemId&&h.type==="joystick"&&h.config.controls.some(m=>m===o))||e.type==="joystick"&&e.config.controls.some(h=>i?.jsonItemId===h));this.output.filters=c&&u?[jd,l.type==="eyeDropper"?Od:Id]:c?l.type==="eyeDropper"?Od:Id:u?jd:d()?PA:on}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const AA=(t,e,n)=>e.general.editor?new TA(e,n):n,RA=(t,e)=>{e!==void 0&&U.getState().gameMenus.cheatsOn&&(e.eventMode="static",e.on("pointertap",()=>{U.dispatch(by({item:t}))}))},IA=t=>{const e=U.getState(),n=yy(e),r=!vy(e),{item:o}=t,s=n==="all"||n==="non-wall"&&t.item.type!=="wall",i=[],a=vA(o);if(a!==void 0){const h=new tg(t,a),m=new xT(t,h);i.push(AA(o,t,_A(o,t,m)))}if(r){const h=jP(t);h!==void 0&&i.push(h)}s&&i.push(new xP(t));let l;if(i.length===0)l=void 0;else{const h=i.length===1?i[0]:new OA(i,t);RA(o,h.output),l=new _P(t,h)}const c=t.general.soundSettings.mute??ol.soundSettings.mute,u=t.general.paused||c?void 0:ZP(t),d=u===void 0?void 0:new rT(t,u);return new $P(t,{graphics:l,sound:d})};class OA{constructor(e,n){this.renderContext=n,this.#e=e,this.#t.addChild(...e.map(r=>r.output))}#e;#t=new oe({label:"CompositeRenderer"});tick(e){for(const n of this.#e)n.tick(e)}destroy(){for(const e of this.#e)e.destroy()}get output(){return this.#t}}const jA=fo("wall","doorFrame"),zd=256;function*$A(t){const{left:e,right:n}=Ie(t.items).filter(jA).reduce((r,{aabb:o,renderAabb:s,renderAabbOffset:i,state:{position:a}})=>{const l=s??o,c=B(a,i??ue),u=Y(B(c,{x:l.x})).x,d=Y(B(c,{y:l.y})).x;return{left:Math.min(r.left,u),right:Math.max(r.right,d)}},{left:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY});e!==Number.POSITIVE_INFINITY&&(yield new ft().rect(e-100,-256,100,zd).fill(0)),n!==Number.NEGATIVE_INFINITY&&(yield new ft().rect(n,-256,100,zd).fill(0))}class NA{constructor(e){this.renderContext=e;const{general:{colourised:n,soundSettings:r},room:o}=e;this.initFilters(n,e.room.color);const i=r.mute??ol.soundSettings.mute?void 0:ce.createGain();Xs($A(o),this.#o),this.output={sound:i,graphics:new oe({label:`RoomRenderer(${e.room.id})`})},this.output.graphics.addChild(this.#t),n||(this.#n=new Ic({sortableChildren:!1}),this.output.graphics.addChild(this.#n)),this.output.graphics.addChild(this.#o),this.output.graphics.addChild(this.#r)}#e=!1;#t=new oe({label:"items"});#n;#r=new Ic({sortableChildren:!1});#o=new oe({label:"occlusion"});output;#s=void 0;#l=new Map;#i=new Map;initFilters(e,n){this.#t.filters=e?n.shade==="dimmed"?yT:on:new Ue(n.shade==="dimmed"?fm(bs(n).main.original):bs(n).main.original)}#c(e){const{room:n}=this.renderContext,r={...e,lastRenderRoomTime:this.#s};for(const s of Ie(n.items)){let i=this.#i.get(s.id);if(i===void 0){i=IA({...this.renderContext,colourClashLayer:this.#n,frontLayer:this.#r,item:s}),this.#i.set(s.id,i);const{graphics:a,sound:l}=i.output;if(a&&(this.#t.addChild(a),s.fixedZIndex&&(a.zIndex=s.fixedZIndex)),l){if(!this.output.sound)throw new Error("item renderer has sound, but room renderer does not - this probably means that they disagree on if the user has sound muted");l.connect(this.output.sound)}}try{i.tick(r)}catch(a){throw new Error(`RoomRenderer for room ${this.renderContext.room.id} caught error while ticking Renderer for item "${s.id}" - item in play object is:
           ${JSON.stringify(s,null,2)}`,{cause:a})}}let o=!1;for(const[s,i]of this.#i.entries())n.items[s]===void 0&&(i.destroy(),this.#i.delete(s),o=!0);o&&this.#a()}#a(){if(this.#n)for(const e of this.#n.renderLayerChildren)e.parent===null&&this.#n.detach(e);for(const e of this.#r.renderLayerChildren)e.parent===null&&this.#r.detach(e)}#d(e){const n=eg(this.renderContext.room.items,e.movedItems,this.#l),{order:r}=Kl(n,this.renderContext.room.items);for(let o=0;o<r.length;o++){const s=this.#i.get(r[o]);if(s===void 0)throw new Error(`Item id=${r[o]} does not have a renderer - cannot assign a z-index`);const i=s.output.graphics;if(i)i.zIndex=r.length-o;else throw new Error(`order ${r[o]} was given a z-order by sorting, but item has no graphics`)}}get#u(){return this.#s!==void 0}tick(e){const n=this.#u?e:{...e,movedItems:new Set(Ie(this.renderContext.room.items))};this.#c(n),(!this.#u||n.movedItems.size>0)&&this.#d(n),this.#s=this.renderContext.room.roomTime}destroy(){this.output.graphics.label=this.output.graphics.label+"DESTROYED",this.output.graphics.destroy({children:!0}),this.output.sound?.disconnect(),this.#i.forEach(e=>{e.destroy()}),this.#e=!0}get destroyed(){return this.#e}}const zA=t=>{t.ticker.remove(t.render,t)},ug=p.createContext(null),DA=({children:t})=>{const[e,n]=p.useState(null);return p.useEffect(()=>{const r=new Mh;return r.init({background:$.pureBlack,sharedTicker:!0}).then(()=>{zA(r),n(r)}),()=>{}},[]),e===null?null:f.jsx(ug,{value:e,children:t})},jn=()=>p.useContext(ug),MA=(t,e)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:e},soundSettings:{mute:!0},pixiRenderer:t,gameState:void 0,paused:!1,colourised:!0,upscale:il(U.getState()),editor:!0}),Dd=(t,e,n)=>new NA({room:t,general:MA(e,n)}),LA=()=>{const{renderer:t}=jn(),e=oh();if(!t)throw new Error("this should never be falsey (typescript violation)");const n=Km(),[r,o]=p.useState(()=>Dd(n,t,e));return p.useEffect(()=>{const s=Dd(n,t,e);return o(s),()=>{s.destroy()}},[n,t,e]),r},Md=(t,e,n)=>{const{world:{onItem:{face:r},position:o,itemId:s}}=t;if(r.z>lh)return is(o);if(n.type==="door"){const i=e.items[s];if(i.type!=="wall")return;const{config:a,aabb:l,state:{position:c}}=i,u=uv(al(a)),d=kr(Vt(a.direction)),h=Vt(a.direction);if(u[d]<2)return;const m=c[d],g=c[d]+l[d]-OE,y=c.z,v=c.z+l.z-Wr,b={[d]:Math.max(Math.min(o[d],g),m),[h]:o[h],z:Math.max(Math.min(o.z,v),y)};return is(b)}return B(is(o),r)},BA={z:1,x:0,y:0},FA={z:0,x:0,y:-1},Ld={z:0,x:-1,y:0},UA=(t,{x:e,y:n},r)=>{if(r.type==="item"&&r.item.type==="door"&&t.type==="wall"){const l=t.config.direction;return Es(Ee[l],-1)}const{bottomCentre:o,topLeft:s,topRight:i}=xr(t.state.position,t.aabb);return n<s.y-(s.x-e)/2?n<i.y-(e-i.x)/2?BA:Ld:e<o.x?FA:Ld},HA=3,WA=(t,{x:e,y:n},r)=>{const o=xr(t.state.position,t.aabb);return wy.find(s=>{const i=o.projectCorner(s);return sl(yn(i,{x:e,y:n}))<HA})},Kn=3,Ji=1.5;function _t({x:t,y:e},n,r){const o={x:t-n.x,y:e-n.y},s=o.x*r.y-o.y*r.x;return Math.abs(s)/xy(Math.hypot(r.x,r.y))}const dg={point:{x:-1,y:-1,z:0},normal:{x:0,y:0,z:1}},hg={point:{x:-1,y:0,z:1},normal:{x:0,y:1,z:0}},fg={point:{x:0,y:-1,z:1},normal:{x:1,y:0,z:0}},pg={point:{x:0,y:1,z:1},normal:{x:1,y:0,z:0}},mg={point:{x:1,y:0,z:1},normal:{x:0,y:1,z:0}},gg={point:{x:1,y:-1,z:0},normal:{x:0,y:0,z:1}},yg={point:{x:0,y:-1,z:-1},normal:{x:1,y:0,z:0}},vg={point:{x:-1,y:1,z:0},normal:{x:0,y:0,z:1}},bg={point:{x:-1,y:0,z:-1},normal:{x:0,y:1,z:0}},GA=(t,e,n,r)=>{const o=xr(t.state.position,t.aabb),s=n.x<0,i=n.y<0,a=n.z>0;if((s||i)&&_t(e,o.bottomCentre,{x:0,y:-1})<Ji)return dg;if((s||a)&&_t(e,o.topRight,{x:2,y:-1})<Ji)return hg;if((i||a)&&_t(e,o.topLeft,{x:2,y:1})<Ji)return fg;switch(!0){case a:{const l=o.c111;if(_t(e,l,{x:2,y:1})<Kn)return pg;if(_t(e,l,{x:-2,y:1})<Kn)return mg;break}case i:{const l=o.c100;if(_t(e,l,{x:0,y:-1})<Kn)return gg;if(_t(e,l,{x:2,y:1})<Kn)return yg;break}case s:{const l=o.c010;if(_t(e,l,{x:0,y:-1})<Kn)return vg;if(_t(e,l,{x:-2,y:1})<Kn)return bg;break}}},Bd=(t,e,n)=>n?{position:t.state.position,aabb:t.aabb}:{position:B(t.state.position,t.renderAabbOffset??ue),aabb:t.renderAabb??t.aabb},Fd=({x:t,y:e},n,r)=>{const{bottomCentre:o,topLeft:s,topRight:i}=xr(n,r);return!(t<s.x||t>i.x||e<i.y-(i.x-t)/2||e<s.y-(t-s.x)/2||e>o.y-(t-o.x)/2||e>o.y-(o.x-t)/2)},qA=(t,e,n)=>{const{position:r,aabb:o}=Bd(n,e,!1);if(Fd(t,r,o))return"intersects-rendered";if(e.type==="item"&&n.type==="wall"){const{position:i,aabb:a}=Bd(n,e,!0);if(Fd(t,i,a))return"intersects-unrendered"}return"non-intersecting"},Ud=t=>t.fixedZIndex!==void 0,VA=t=>{const n=t.some(([,a])=>a==="intersects-rendered")?t.filter(([,a])=>a==="intersects-rendered").map(([a])=>a):t.map(([a])=>a);if(n.every(Ud))return n.toSorted((a,l)=>l.fixedZIndex-a.fixedZIndex).at(0);const r=n.filter(a=>!Ud(a));if(r.length===0)return;if(r.length===1)return r[0];const o=Object.fromEntries(r.map(a=>[a.id,a])),s=eg(o),{order:i}=Kl(s,o);return o[i[0]]},wg=(t,e,n,r)=>{const o=n.type==="item"&&n.item.type==="door"?1:r,s=q.w*o,i=q.h,a=o===1?0:q.w/2,l=i/2,c=ah(e);return{x:c==="yz"?Math.round(t.x/s)*s:Math.floor((t.x-a)/s)*s,y:c==="xz"?Math.round(t.y/s)*s:Math.floor((t.y-a)/s)*s,z:c==="xy"?Math.round(t.z/i)*i:Math.floor((t.z+l)/i)*i}},KA=({state:{position:t},aabb:e},n,r,o,s)=>{const i={x:t.x+(n.x<0?0:e.x),y:t.y+(n.y<0?0:e.y),z:t.z+(n.z<0?0:e.z)},a=SE(i,n,r);return wg(a,n,o,s)},XA=t=>e=>{const n=fr(e);return t.type==="item"&&t.item.type==="door"?n&&e.type==="wall":n},Yi=(t,e,n,r)=>{const o=Ie(e.items).filter(XA(n)).map(a=>[a,qA(t,n,a)]).filter(a=>a[1]!=="non-intersecting"),s=VA(Array.from(o)),i=e.id;if(s){const a=UA(s,t,n);if(!(a.z>0&&!Object.isExtensible(s.state.stoodOnBy)))return{roomId:i,scrXy:t,world:{itemId:s.id,onItem:{face:a,corner:WA(s,t),edge:GA(s,t,a)},position:KA(s,a,t,n,r)}}}return{roomId:i,scrXy:t,world:void 0}},JA=(t,e=console.error)=>(...n)=>{try{return t(...n)}catch(r){e(r);return}},YA=t=>xh(e=>e>0?e:e>-1?1:-e+1,t),ZA=({jsonItem:t,blockDragAccVec:e,resizeEdgeDirection:n})=>{const r=t.position,o=aa(t),s=hs(e,n,wh(t)),i=B(o,s),a=YA(i),l=xh((c,u,d,h,m)=>{const g=u<1;return c<0!==g?g?d-m+1:d+h-m:g?d+h-1:d},n,i,r,o,a);return{timesDelta:dr(a,o),positionDelta:dr(l,r)}},Zi=(t,e)=>{const n=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const r=e.target.getBoundingClientRect(),o=e.clientX-r.left,s=e.clientY-r.top;return{x:o/n-t.gameEngineScreenSize.x/2,y:s/n-t.gameEngineScreenSize.y+16}},QA=(t,e)=>{const n=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const r=e.movementX,o=e.movementY;return{x:r/n,y:o/n}},eR=5,tR=(t,e,n)=>{const r=t.world?.onItem.edge,o=hs(...bt(n).map(i=>wh(i))),s=hs(r?.point??ue,o);return Ps(s)>0?r.normal:e?{x:1,y:0,z:0}:{x:0,y:0,z:1}},nR=(t,e,n,r,o,s)=>{if(t===void 0)return;const i=yn(e,t.scrXy),a=sl(i);if(!(o||a>eR))return;const c=tR(t,r,s),u=Um(c,n);return r?{x:0,y:0,z:u.z}:u},Hd=(t,e=!1)=>{const n=U.getState().levelEditor;return wg(t,{x:0,y:0,z:1},n.tool,e?1:n.gridResolution)},Jo=({levelEditor:t},e,n)=>{const r=e.items[n]?.jsonItemId;if(r===void 0)return;const o=Sh(t,r);if(o!==void 0)return[r,o]},ls=(t,...e)=>t.levelEditor.wallsFloorsLocked&&e.some(n=>n.type==="wall"||n.type==="floor"),Qi=(t,e)=>{const n=U.getState();let r;if(e.world){const o=e.world.itemId,s=o&&t.items[o],i=ls(n,s)?void 0:s.jsonItemId;r=i===void 0?void 0:{jsonItemId:i,pointingAtOnItem:e.world.onItem}}else r=void 0;Ge(bh(n),r)||U.dispatch(_h(r))},rR=(t,e,n)=>{const r=n?.world?.itemId;if(r===void 0)return to;const o=e.items[r].jsonItemId;if(o===void 0)return to;const{selectedJsonItemIds:s}=t.levelEditor;return s.includes(o)?s:[o]},oR=t=>{const e=jn(),n=Tn(il),r=He(),o=Vm(),s=p.useRef(void 0),i=p.useRef(void 0),a=p.useRef(void 0);p.useEffect(()=>{if(t===null)return;const l=m=>{const g=Zi(n,m),y=QA(n,m),v=U.getState(),b=pn(v),_=Yi(g,o,b,v.levelEditor.gridResolution),w=!Ge(_.world,s.current?.world);switch(b.type){case"item":{if(!w||(r(ca()),_.world===void 0))break;const x=Jo(v,o,_.world.itemId);if(x===void 0)break;const[,C]=x,k=Md(_,o,b.item);if(k===void 0||rP({roomState:o,blockPosition:k,itemTool:b.item}))break;r(cc({blockPosition:k,pointedAtItemJson:C,preview:!0}));break}case"pointer":{const x=rR(v,o,i.current);if(x.length===0){Qi(o,_);break}const C=x.map(Z=>fv(v,Z));if(ls(v,...C))break;const S=_.roomId===i.current?.roomId?nR(i.current,g,y,m.metaKey||m.shiftKey,a.current!==void 0,C):void 0;if(!S){Qi(o,_);break}x.length===1&&!pv(v,x[0])&&U.dispatch(oi({jsonItemIds:x}));const N=i.current?.world?.onItem.edge,H=N&&C.every(Z=>Ch(Z)),L=a.current??ue,V=B(L,S),O=Hd(V,H);if(a.current=V,rl(Hd(L,H),O))break;const ee=is(O);let M,K;if(H){const[,Z]=Jo(v,o,i.current.world.itemId);({timesDelta:K,positionDelta:M}=ZA({jsonItem:Z,blockDragAccVec:ee,resizeEdgeDirection:N.point}))}else M=ee;if(Jm({roomState:o,jsonItemIds:x,blockPositionDelta:M,timesDelta:K}))break;r(ph({jsonItemIds:x,positionDelta:M,timesDelta:K}));break}case"eyeDropper":Qi(o,_);break}s.current=_},c=m=>{const g=U.getState();if(o.id!==g.levelEditor.currentlyEditingRoomId)return;const y=Zi(n,m),v=pn(U.getState()),b=Yi(y,o,v,g.levelEditor.gridResolution),_=a.current!==void 0,w=!_&&b.roomId===i.current?.roomId&&b.world?.itemId===i.current?.world?.itemId;if(a.current=void 0,i.current=void 0,U.dispatch(dv(!1)),!w&&!_){console.log("mouseUp - not a click or drag end - skipping");return}switch(v.type){case"item":{if(b.world===void 0){r(vn({type:"pointer"}));break}const x=Jo(g,o,b.world.itemId);if(x===void 0)break;const[,C]=x;r(cc({blockPosition:Md(b,o,v.item),pointedAtItemJson:C,preview:!1}));break}case"pointer":{if(w){const x=b.world===void 0?void 0:o.items[b.world.itemId];if(x?.jsonItemId===void 0||ls(g,x)){r(oi({jsonItemIds:[]}));break}r(m.ctrlKey||m.metaKey?hv({jsonItemId:x.jsonItemId}):oi({jsonItemIds:[x.jsonItemId]}))}else _&&r(mh());break}case"eyeDropper":{if(w){const x=b.world?.itemId;if(x===void 0){console.warn("no itemId");break}const C=o.items[x];if(ls(g,C))break;const k=Jo(g,o,x);if(k===void 0)break;const[,S]=k;r(vn({type:"item",item:{type:S.type,config:S.config}}))}break}}},u=m=>{const g=pn(U.getState());switch(a.current=void 0,i.current=void 0,g.type){case"item":{r(ca());break}case"pointer":{r(_h(void 0));break}}},d=m=>{const g=Zi(n,m),y=U.getState(),v=pn(y),b=Yi(g,o,v,y.levelEditor.gridResolution);console.log("setting mouseDownPointingAtRef to",b),i.current=b},h=JA(l);return t.addEventListener("mousemove",h),t.addEventListener("mouseup",c),t.addEventListener("mousedown",d),t.addEventListener("mouseleave",u),t.tabIndex=0,()=>{t.removeEventListener("mousemove",h),t.removeEventListener("mouseup",c),t.removeEventListener("mousedown",d),t.removeEventListener("mouseleave",u)}},[e.stage,n,t,r,o])},sR=()=>{const{cssUpscale:t,canvasSize:e,rotate90:n}=Tn(il);return{transform:n?`scale(${t}) rotate(90deg) translate(0, -${e.y}px)`:`scale(${t})`,width:e.x,height:e.y,transformOrigin:"top left"}},iR=t=>{const e=Km(),n=jn();p.useEffect(()=>{let r=0;const o=({deltaMS:s})=>{if(t.destroyed)return;t.renderContext.room!==e&&console.warn("room renderer does not have the current room");const i=new Set(ds(e.items));e.roomTime+=s,t.tick({deltaMS:s,movedItems:i,progression:r++}),n.render()};return er.shared.add(o),()=>{er.shared.remove(o)}},[t,e,n])},aR=t=>{const e=jn();p.useEffect(()=>{if(t)return t.appendChild(e.canvas),()=>{t.removeChild(e.canvas)}},[t,e])},lR=()=>{const t=jn(),e=Tn(n=>n.upscale.upscale.gameEngineUpscale);t.stage.scale=e},cR=()=>{const t=jn(),e=Tn(_y);p.useEffect(()=>{t.renderer?.resize(e.x,e.y)},[t.renderer,e])},uR=t=>{const e=jn(),[n]=p.useState(()=>new oe),r=Tn(Sy);p.useEffect(()=>{if(t.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return n.addChild(t.output.graphics),e.stage.addChild(n),()=>{e.stage.removeChild(n),n.removeChild(t.output.graphics)}},[t,e,n]),p.useEffect(()=>{n.x=r.x/2,n.y=r.y-16},[n,r])},Wd=(t,e)=>{U.dispatch(Cy(ky(t??Ey(U.getState()),e)))},dR=(t,e)=>{const n=He();p.useLayoutEffect(()=>{Wd()},[]),p.useLayoutEffect(()=>{const r=()=>Wd(t,e);if(e){const o=new ResizeObserver(r);return o.observe(e),()=>o.disconnect()}else return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[n,e,t])},hR=()=>{p.useEffect(()=>Py({actionCreator:vn,effect(t,{dispatch:e}){e(ca())}}))},fR=({levelEditor:t})=>{const{dragInProgress:e,clickableAnnotationHovered:n,hoveredItem:r,selectedJsonItemIds:o}=t;if(e)return ge("cursor-grabbing");if(n)return ge("cursor-pointer");if(r){const s=Sh(t,r.jsonItemId);if(s!==void 0&&Ch(s))if(r.pointingAtOnItem.corner){if(rl(r.pointingAtOnItem.corner,{x:1,y:1,z:1}))return ge("cursor-n-resize")}else{const{edge:i}=r.pointingAtOnItem;if(i){if(Ge(i,vg))return ge("cursor-e-resize");if(Ge(i,dg))return ge("cursor-s-resize");if(Ge(i,gg))return ge("cursor-w-resize");if(Ge(i,hg)||Ge(i,pg))return ge("cursor-ne-resize");if(Ge(i,fg)||Ge(i,mg))return ge("cursor-nw-resize");if(Ge(i,bg))return ge("cursor-se-resize");if(Ge(i,yg))return ge("cursor-sw-resize")}}return o.includes(r.jsonItemId)?ge("cursor-grab"):ge("cursor-default")}return ge("cursor-crosshair")},pR=()=>he(fR);Ty.defaultOptions.scaleMode="nearest";const mR=()=>{const t=LA(),[e,n]=p.useState(null),[r,o]=p.useState(null),s=pR();dR("amigaLowResPal",r??void 0),cR(),uR(t),iR(t),oR(e),aR(e),lR(),hR();const i=sR();return f.jsx("div",{className:`w-full h-full overflow-hidden ${s}`,ref:o,children:f.jsx("div",{style:i,ref:n})})},Gd=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,gR=()=>{const t=Ay(),e=Tn(Ry);p.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",Iy())},[]),p.useEffect(()=>{document.body.classList.remove(...Object.keys(Oy).map(Gd)),document.body.classList.add(Gd(t)),document.body.classList.toggle("portrait-rot",e)},[t,e])},Zs=p.createContext(null);Zs.displayName="PanelGroupContext";const be={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},Zl=10,gn=p.useLayoutEffect,qd=ks.useId,yR=typeof qd=="function"?qd:()=>null;let vR=0;function Ql(t=null){const e=yR(),n=p.useRef(t||e||null);return n.current===null&&(n.current=""+vR++),t??n.current}function xg({children:t,className:e="",collapsedSize:n,collapsible:r,defaultSize:o,forwardedRef:s,id:i,maxSize:a,minSize:l,onCollapse:c,onExpand:u,onResize:d,order:h,style:m,tagName:g="div",...y}){const v=p.useContext(Zs);if(v===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:b,expandPanel:_,getPanelSize:w,getPanelStyle:x,groupId:C,isPanelCollapsed:k,reevaluatePanelConstraints:S,registerPanel:N,resizePanel:H,unregisterPanel:L}=v,V=Ql(i),O=p.useRef({callbacks:{onCollapse:c,onExpand:u,onResize:d},constraints:{collapsedSize:n,collapsible:r,defaultSize:o,maxSize:a,minSize:l},id:V,idIsFromProps:i!==void 0,order:h});p.useRef({didLogMissingDefaultSizeWarning:!1}),gn(()=>{const{callbacks:M,constraints:K}=O.current,X={...K};O.current.id=V,O.current.idIsFromProps=i!==void 0,O.current.order=h,M.onCollapse=c,M.onExpand=u,M.onResize=d,K.collapsedSize=n,K.collapsible=r,K.defaultSize=o,K.maxSize=a,K.minSize=l,(X.collapsedSize!==K.collapsedSize||X.collapsible!==K.collapsible||X.maxSize!==K.maxSize||X.minSize!==K.minSize)&&S(O.current,X)}),gn(()=>{const M=O.current;return N(M),()=>{L(M)}},[h,V,N,L]),p.useImperativeHandle(s,()=>({collapse:()=>{b(O.current)},expand:M=>{_(O.current,M)},getId(){return V},getSize(){return w(O.current)},isCollapsed(){return k(O.current)},isExpanded(){return!k(O.current)},resize:M=>{H(O.current,M)}}),[b,_,w,k,V,H]);const ee=x(O.current,o);return p.createElement(g,{...y,children:t,className:e,id:V,style:{...ee,...m},[be.groupId]:C,[be.panel]:"",[be.panelCollapsible]:r||void 0,[be.panelId]:V,[be.panelSize]:parseFloat(""+ee.flexGrow).toFixed(1)})}const cs=p.forwardRef((t,e)=>p.createElement(xg,{...t,forwardedRef:e}));xg.displayName="Panel";cs.displayName="forwardRef(Panel)";let Ja=null,us=-1,Ut=null;function bR(t,e){if(e){const n=(e&Eg)!==0,r=(e&Pg)!==0,o=(e&Tg)!==0,s=(e&Ag)!==0;if(n)return o?"se-resize":s?"ne-resize":"e-resize";if(r)return o?"sw-resize":s?"nw-resize":"w-resize";if(o)return"s-resize";if(s)return"n-resize"}switch(t){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function wR(){Ut!==null&&(document.head.removeChild(Ut),Ja=null,Ut=null,us=-1)}function ea(t,e){var n,r;const o=bR(t,e);if(Ja!==o){if(Ja=o,Ut===null&&(Ut=document.createElement("style"),document.head.appendChild(Ut)),us>=0){var s;(s=Ut.sheet)===null||s===void 0||s.removeRule(us)}us=(n=(r=Ut.sheet)===null||r===void 0?void 0:r.insertRule(`*{cursor: ${o} !important;}`))!==null&&n!==void 0?n:-1}}function _g(t){return t.type==="keydown"}function Sg(t){return t.type.startsWith("pointer")}function Cg(t){return t.type.startsWith("mouse")}function Qs(t){if(Sg(t)){if(t.isPrimary)return{x:t.clientX,y:t.clientY}}else if(Cg(t))return{x:t.clientX,y:t.clientY};return{x:1/0,y:1/0}}function xR(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function _R(t,e,n){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function SR(t,e){if(t===e)throw new Error("Cannot compare node with itself");const n={a:Xd(t),b:Xd(e)};let r;for(;n.a.at(-1)===n.b.at(-1);)t=n.a.pop(),e=n.b.pop(),r=t;ne(r,"Stacking order can only be calculated for elements with a common ancestor");const o={a:Kd(Vd(n.a)),b:Kd(Vd(n.b))};if(o.a===o.b){const s=r.childNodes,i={a:n.a.at(-1),b:n.b.at(-1)};let a=s.length;for(;a--;){const l=s[a];if(l===i.a)return 1;if(l===i.b)return-1}}return Math.sign(o.a-o.b)}const CR=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function kR(t){var e;const n=getComputedStyle((e=kg(t))!==null&&e!==void 0?e:t).display;return n==="flex"||n==="inline-flex"}function ER(t){const e=getComputedStyle(t);return!!(e.position==="fixed"||e.zIndex!=="auto"&&(e.position!=="static"||kR(t))||+e.opacity<1||"transform"in e&&e.transform!=="none"||"webkitTransform"in e&&e.webkitTransform!=="none"||"mixBlendMode"in e&&e.mixBlendMode!=="normal"||"filter"in e&&e.filter!=="none"||"webkitFilter"in e&&e.webkitFilter!=="none"||"isolation"in e&&e.isolation==="isolate"||CR.test(e.willChange)||e.webkitOverflowScrolling==="touch")}function Vd(t){let e=t.length;for(;e--;){const n=t[e];if(ne(n,"Missing node"),ER(n))return n}return null}function Kd(t){return t&&Number(getComputedStyle(t).zIndex)||0}function Xd(t){const e=[];for(;t;)e.push(t),t=kg(t);return e}function kg(t){const{parentNode:e}=t;return e&&e instanceof ShadowRoot?e.host:e}const Eg=1,Pg=2,Tg=4,Ag=8,PR=xR()==="coarse";let ot=[],ur=!1,Ht=new Map,ei=new Map;const co=new Set;function TR(t,e,n,r,o){var s;const{ownerDocument:i}=e,a={direction:n,element:e,hitAreaMargins:r,setResizeHandlerState:o},l=(s=Ht.get(i))!==null&&s!==void 0?s:0;return Ht.set(i,l+1),co.add(a),Ss(),function(){var u;ei.delete(t),co.delete(a);const d=(u=Ht.get(i))!==null&&u!==void 0?u:1;if(Ht.set(i,d-1),Ss(),d===1&&Ht.delete(i),ot.includes(a)){const h=ot.indexOf(a);h>=0&&ot.splice(h,1),tc(),o("up",!0,null)}}}function AR(t){const{target:e}=t,{x:n,y:r}=Qs(t);ur=!0,ec({target:e,x:n,y:r}),Ss(),ot.length>0&&(Cs("down",t),t.preventDefault(),Rg(e)||t.stopImmediatePropagation())}function ta(t){const{x:e,y:n}=Qs(t);if(ur&&t.buttons===0&&(ur=!1,Cs("up",t)),!ur){const{target:r}=t;ec({target:r,x:e,y:n})}Cs("move",t),tc(),ot.length>0&&t.preventDefault()}function na(t){const{target:e}=t,{x:n,y:r}=Qs(t);ei.clear(),ur=!1,ot.length>0&&(t.preventDefault(),Rg(e)||t.stopImmediatePropagation()),Cs("up",t),ec({target:e,x:n,y:r}),tc(),Ss()}function Rg(t){let e=t;for(;e;){if(e.hasAttribute(be.resizeHandle))return!0;e=e.parentElement}return!1}function ec({target:t,x:e,y:n}){ot.splice(0);let r=null;(t instanceof HTMLElement||t instanceof SVGElement)&&(r=t),co.forEach(o=>{const{element:s,hitAreaMargins:i}=o,a=s.getBoundingClientRect(),{bottom:l,left:c,right:u,top:d}=a,h=PR?i.coarse:i.fine;if(e>=c-h&&e<=u+h&&n>=d-h&&n<=l+h){if(r!==null&&document.contains(r)&&s!==r&&!s.contains(r)&&!r.contains(s)&&SR(r,s)>0){let g=r,y=!1;for(;g&&!g.contains(s);){if(_R(g.getBoundingClientRect(),a)){y=!0;break}g=g.parentElement}if(y)return}ot.push(o)}})}function ra(t,e){ei.set(t,e)}function tc(){let t=!1,e=!1;ot.forEach(r=>{const{direction:o}=r;o==="horizontal"?t=!0:e=!0});let n=0;ei.forEach(r=>{n|=r}),t&&e?ea("intersection",n):t?ea("horizontal",n):e?ea("vertical",n):wR()}let oa;function Ss(){var t;(t=oa)===null||t===void 0||t.abort(),oa=new AbortController;const e={capture:!0,signal:oa.signal};co.size&&(ur?(ot.length>0&&Ht.forEach((n,r)=>{const{body:o}=r;n>0&&(o.addEventListener("contextmenu",na,e),o.addEventListener("pointerleave",ta,e),o.addEventListener("pointermove",ta,e))}),Ht.forEach((n,r)=>{const{body:o}=r;o.addEventListener("pointerup",na,e),o.addEventListener("pointercancel",na,e)})):Ht.forEach((n,r)=>{const{body:o}=r;n>0&&(o.addEventListener("pointerdown",AR,e),o.addEventListener("pointermove",ta,e))}))}function Cs(t,e){co.forEach(n=>{const{setResizeHandlerState:r}=n,o=ot.includes(n);r(t,o,e)})}function RR(){const[t,e]=p.useState(0);return p.useCallback(()=>e(n=>n+1),[])}function ne(t,e){if(!t)throw console.error(e),Error(e)}function En(t,e,n=Zl){return t.toFixed(n)===e.toFixed(n)?0:t>e?1:-1}function Tt(t,e,n=Zl){return En(t,e,n)===0}function qe(t,e,n){return En(t,e,n)===0}function IR(t,e,n){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const o=t[r],s=e[r];if(!qe(o,s,n))return!1}return!0}function or({panelConstraints:t,panelIndex:e,size:n}){const r=t[e];ne(r!=null,`Panel constraints not found for index ${e}`);let{collapsedSize:o=0,collapsible:s,maxSize:i=100,minSize:a=0}=r;if(En(n,a)<0)if(s){const l=(o+a)/2;En(n,l)<0?n=o:n=a}else n=a;return n=Math.min(i,n),n=parseFloat(n.toFixed(Zl)),n}function qr({delta:t,initialLayout:e,panelConstraints:n,pivotIndices:r,prevLayout:o,trigger:s}){if(qe(t,0))return e;const i=[...e],[a,l]=r;ne(a!=null,"Invalid first pivot index"),ne(l!=null,"Invalid second pivot index");let c=0;if(s==="keyboard"){{const d=t<0?l:a,h=n[d];ne(h,`Panel constraints not found for index ${d}`);const{collapsedSize:m=0,collapsible:g,minSize:y=0}=h;if(g){const v=e[d];if(ne(v!=null,`Previous layout not found for panel index ${d}`),qe(v,m)){const b=y-v;En(b,Math.abs(t))>0&&(t=t<0?0-b:b)}}}{const d=t<0?a:l,h=n[d];ne(h,`No panel constraints found for index ${d}`);const{collapsedSize:m=0,collapsible:g,minSize:y=0}=h;if(g){const v=e[d];if(ne(v!=null,`Previous layout not found for panel index ${d}`),qe(v,y)){const b=v-m;En(b,Math.abs(t))>0&&(t=t<0?0-b:b)}}}}{const d=t<0?1:-1;let h=t<0?l:a,m=0;for(;;){const y=e[h];ne(y!=null,`Previous layout not found for panel index ${h}`);const b=or({panelConstraints:n,panelIndex:h,size:100})-y;if(m+=b,h+=d,h<0||h>=n.length)break}const g=Math.min(Math.abs(t),Math.abs(m));t=t<0?0-g:g}{let h=t<0?a:l;for(;h>=0&&h<n.length;){const m=Math.abs(t)-Math.abs(c),g=e[h];ne(g!=null,`Previous layout not found for panel index ${h}`);const y=g-m,v=or({panelConstraints:n,panelIndex:h,size:y});if(!qe(g,v)&&(c+=g-v,i[h]=v,c.toPrecision(3).localeCompare(Math.abs(t).toPrecision(3),void 0,{numeric:!0})>=0))break;t<0?h--:h++}}if(IR(o,i))return o;{const d=t<0?l:a,h=e[d];ne(h!=null,`Previous layout not found for panel index ${d}`);const m=h+c,g=or({panelConstraints:n,panelIndex:d,size:m});if(i[d]=g,!qe(g,m)){let y=m-g,b=t<0?l:a;for(;b>=0&&b<n.length;){const _=i[b];ne(_!=null,`Previous layout not found for panel index ${b}`);const w=_+y,x=or({panelConstraints:n,panelIndex:b,size:w});if(qe(_,x)||(y-=x-_,i[b]=x),qe(y,0))break;t>0?b--:b++}}}const u=i.reduce((d,h)=>h+d,0);return qe(u,100)?i:o}function OR({layout:t,panelsArray:e,pivotIndices:n}){let r=0,o=100,s=0,i=0;const a=n[0];ne(a!=null,"No pivot index found"),e.forEach((d,h)=>{const{constraints:m}=d,{maxSize:g=100,minSize:y=0}=m;h===a?(r=y,o=g):(s+=y,i+=g)});const l=Math.min(o,100-s),c=Math.max(r,100-i),u=t[a];return{valueMax:l,valueMin:c,valueNow:u}}function uo(t,e=document){return Array.from(e.querySelectorAll(`[${be.resizeHandleId}][data-panel-group-id="${t}"]`))}function Ig(t,e,n=document){const o=uo(t,n).findIndex(s=>s.getAttribute(be.resizeHandleId)===e);return o??null}function Og(t,e,n){const r=Ig(t,e,n);return r!=null?[r,r+1]:[-1,-1]}function jR(t){return t instanceof HTMLElement?!0:typeof t=="object"&&t!==null&&"tagName"in t&&"getAttribute"in t}function jg(t,e=document){if(jR(e)&&e.dataset.panelGroupId==t)return e;const n=e.querySelector(`[data-panel-group][data-panel-group-id="${t}"]`);return n||null}function ti(t,e=document){const n=e.querySelector(`[${be.resizeHandleId}="${t}"]`);return n||null}function $R(t,e,n,r=document){var o,s,i,a;const l=ti(e,r),c=uo(t,r),u=l?c.indexOf(l):-1,d=(o=(s=n[u])===null||s===void 0?void 0:s.id)!==null&&o!==void 0?o:null,h=(i=(a=n[u+1])===null||a===void 0?void 0:a.id)!==null&&i!==void 0?i:null;return[d,h]}function NR({committedValuesRef:t,eagerValuesRef:e,groupId:n,layout:r,panelDataArray:o,panelGroupElement:s,setLayout:i}){p.useRef({didWarnAboutMissingResizeHandle:!1}),gn(()=>{if(!s)return;const a=uo(n,s);for(let l=0;l<o.length-1;l++){const{valueMax:c,valueMin:u,valueNow:d}=OR({layout:r,panelsArray:o,pivotIndices:[l,l+1]}),h=a[l];if(h!=null){const m=o[l];ne(m,`No panel data found for index "${l}"`),h.setAttribute("aria-controls",m.id),h.setAttribute("aria-valuemax",""+Math.round(c)),h.setAttribute("aria-valuemin",""+Math.round(u)),h.setAttribute("aria-valuenow",d!=null?""+Math.round(d):"")}}return()=>{a.forEach((l,c)=>{l.removeAttribute("aria-controls"),l.removeAttribute("aria-valuemax"),l.removeAttribute("aria-valuemin"),l.removeAttribute("aria-valuenow")})}},[n,r,o,s]),p.useEffect(()=>{if(!s)return;const a=e.current;ne(a,"Eager values not found");const{panelDataArray:l}=a,c=jg(n,s);ne(c!=null,`No group found for id "${n}"`);const u=uo(n,s);ne(u,`No resize handles found for group id "${n}"`);const d=u.map(h=>{const m=h.getAttribute(be.resizeHandleId);ne(m,"Resize handle element has no handle id attribute");const[g,y]=$R(n,m,l,s);if(g==null||y==null)return()=>{};const v=b=>{if(!b.defaultPrevented)switch(b.key){case"Enter":{b.preventDefault();const _=l.findIndex(w=>w.id===g);if(_>=0){const w=l[_];ne(w,`No panel data found for index ${_}`);const x=r[_],{collapsedSize:C=0,collapsible:k,minSize:S=0}=w.constraints;if(x!=null&&k){const N=qr({delta:qe(x,C)?S-C:C-x,initialLayout:r,panelConstraints:l.map(H=>H.constraints),pivotIndices:Og(n,m,s),prevLayout:r,trigger:"keyboard"});r!==N&&i(N)}}break}}};return h.addEventListener("keydown",v),()=>{h.removeEventListener("keydown",v)}});return()=>{d.forEach(h=>h())}},[s,t,e,n,r,o,i])}function Jd(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function $g(t,e){const n=t==="horizontal",{x:r,y:o}=Qs(e);return n?r:o}function zR(t,e,n,r,o){const s=n==="horizontal",i=ti(e,o);ne(i,`No resize handle element found for id "${e}"`);const a=i.getAttribute(be.groupId);ne(a,"Resize handle element has no group id attribute");let{initialCursorPosition:l}=r;const c=$g(n,t),u=jg(a,o);ne(u,`No group element found for id "${a}"`);const d=u.getBoundingClientRect(),h=s?d.width:d.height;return(c-l)/h*100}function DR(t,e,n,r,o,s){if(_g(t)){const i=n==="horizontal";let a=0;t.shiftKey?a=100:o!=null?a=o:a=10;let l=0;switch(t.key){case"ArrowDown":l=i?0:a;break;case"ArrowLeft":l=i?-a:0;break;case"ArrowRight":l=i?a:0;break;case"ArrowUp":l=i?0:-a;break;case"End":l=100;break;case"Home":l=-100;break}return l}else return r==null?0:zR(t,e,n,r,s)}function MR({panelDataArray:t}){const e=Array(t.length),n=t.map(s=>s.constraints);let r=0,o=100;for(let s=0;s<t.length;s++){const i=n[s];ne(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;a!=null&&(r++,e[s]=a,o-=a)}for(let s=0;s<t.length;s++){const i=n[s];ne(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;if(a!=null)continue;const l=t.length-r,c=o/l;r++,e[s]=c,o-=c}return e}function Xn(t,e,n){e.forEach((r,o)=>{const s=t[o];ne(s,`Panel data not found for index ${o}`);const{callbacks:i,constraints:a,id:l}=s,{collapsedSize:c=0,collapsible:u}=a,d=n[l];if(d==null||r!==d){n[l]=r;const{onCollapse:h,onExpand:m,onResize:g}=i;g&&g(r,d),u&&(h||m)&&(m&&(d==null||Tt(d,c))&&!Tt(r,c)&&m(),h&&(d==null||!Tt(d,c))&&Tt(r,c)&&h())}})}function Yo(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!=e[n])return!1;return!0}function LR({defaultSize:t,dragState:e,layout:n,panelData:r,panelIndex:o,precision:s=3}){const i=n[o];let a;return i==null?a=t!=null?t.toPrecision(s):"1":r.length===1?a="1":a=i.toPrecision(s),{flexBasis:0,flexGrow:a,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function BR(t,e=10){let n=null;return(...o)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{t(...o)},e)}}function Yd(t){try{if(typeof localStorage<"u")t.getItem=e=>localStorage.getItem(e),t.setItem=(e,n)=>{localStorage.setItem(e,n)};else throw new Error("localStorage not supported in this environment")}catch(e){console.error(e),t.getItem=()=>null,t.setItem=()=>{}}}function Ng(t){return`react-resizable-panels:${t}`}function zg(t){return t.map(e=>{const{constraints:n,id:r,idIsFromProps:o,order:s}=e;return o?r:s?`${s}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((e,n)=>e.localeCompare(n)).join(",")}function Dg(t,e){try{const n=Ng(t),r=e.getItem(n);if(r){const o=JSON.parse(r);if(typeof o=="object"&&o!=null)return o}}catch{}return null}function FR(t,e,n){var r,o;const s=(r=Dg(t,n))!==null&&r!==void 0?r:{},i=zg(e);return(o=s[i])!==null&&o!==void 0?o:null}function UR(t,e,n,r,o){var s;const i=Ng(t),a=zg(e),l=(s=Dg(t,o))!==null&&s!==void 0?s:{};l[a]={expandToSizes:Object.fromEntries(n.entries()),layout:r};try{o.setItem(i,JSON.stringify(l))}catch(c){console.error(c)}}function Zd({layout:t,panelConstraints:e}){const n=[...t],r=n.reduce((s,i)=>s+i,0);if(n.length!==e.length)throw Error(`Invalid ${e.length} panel layout: ${n.map(s=>`${s}%`).join(", ")}`);if(!qe(r,100)&&n.length>0)for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=100/r*i;n[s]=a}let o=0;for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=or({panelConstraints:e,panelIndex:s,size:i});i!=a&&(o+=i-a,n[s]=a)}if(!qe(o,0))for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=i+o,l=or({panelConstraints:e,panelIndex:s,size:a});if(i!==l&&(o-=l-i,n[s]=l,qe(o,0)))break}return n}const HR=100,Vr={getItem:t=>(Yd(Vr),Vr.getItem(t)),setItem:(t,e)=>{Yd(Vr),Vr.setItem(t,e)}},Qd={};function Mg({autoSaveId:t=null,children:e,className:n="",direction:r,forwardedRef:o,id:s=null,onLayout:i=null,keyboardResizeBy:a=null,storage:l=Vr,style:c,tagName:u="div",...d}){const h=Ql(s),m=p.useRef(null),[g,y]=p.useState(null),[v,b]=p.useState([]),_=RR(),w=p.useRef({}),x=p.useRef(new Map),C=p.useRef(0),k=p.useRef({autoSaveId:t,direction:r,dragState:g,id:h,keyboardResizeBy:a,onLayout:i,storage:l}),S=p.useRef({layout:v,panelDataArray:[],panelDataArrayChanged:!1});p.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),p.useImperativeHandle(o,()=>({getId:()=>k.current.id,getLayout:()=>{const{layout:E}=S.current;return E},setLayout:E=>{const{onLayout:R}=k.current,{layout:T,panelDataArray:I}=S.current,A=Zd({layout:E,panelConstraints:I.map(z=>z.constraints)});Jd(T,A)||(b(A),S.current.layout=A,R&&R(A),Xn(I,A,w.current))}}),[]),gn(()=>{k.current.autoSaveId=t,k.current.direction=r,k.current.dragState=g,k.current.id=h,k.current.onLayout=i,k.current.storage=l}),NR({committedValuesRef:k,eagerValuesRef:S,groupId:h,layout:v,panelDataArray:S.current.panelDataArray,setLayout:b,panelGroupElement:m.current}),p.useEffect(()=>{const{panelDataArray:E}=S.current;if(t){if(v.length===0||v.length!==E.length)return;let R=Qd[t];R==null&&(R=BR(UR,HR),Qd[t]=R);const T=[...E],I=new Map(x.current);R(t,T,I,v,l)}},[t,v,l]),p.useEffect(()=>{});const N=p.useCallback(E=>{const{onLayout:R}=k.current,{layout:T,panelDataArray:I}=S.current;if(E.constraints.collapsible){const A=I.map(Ne=>Ne.constraints),{collapsedSize:z=0,panelSize:re,pivotIndices:le}=ln(I,E,T);if(ne(re!=null,`Panel size not found for panel "${E.id}"`),!Tt(re,z)){x.current.set(E.id,re);const ze=Qn(I,E)===I.length-1?re-z:z-re,ae=qr({delta:ze,initialLayout:T,panelConstraints:A,pivotIndices:le,prevLayout:T,trigger:"imperative-api"});Yo(T,ae)||(b(ae),S.current.layout=ae,R&&R(ae),Xn(I,ae,w.current))}}},[]),H=p.useCallback((E,R)=>{const{onLayout:T}=k.current,{layout:I,panelDataArray:A}=S.current;if(E.constraints.collapsible){const z=A.map(Ye=>Ye.constraints),{collapsedSize:re=0,panelSize:le=0,minSize:Ne=0,pivotIndices:ze}=ln(A,E,I),ae=R??Ne;if(Tt(le,re)){const Ye=x.current.get(E.id),Ir=Ye!=null&&Ye>=ae?Ye:ae,ni=Qn(A,E)===A.length-1?le-Ir:Ir-le,De=qr({delta:ni,initialLayout:I,panelConstraints:z,pivotIndices:ze,prevLayout:I,trigger:"imperative-api"});Yo(I,De)||(b(De),S.current.layout=De,T&&T(De),Xn(A,De,w.current))}}},[]),L=p.useCallback(E=>{const{layout:R,panelDataArray:T}=S.current,{panelSize:I}=ln(T,E,R);return ne(I!=null,`Panel size not found for panel "${E.id}"`),I},[]),V=p.useCallback((E,R)=>{const{panelDataArray:T}=S.current,I=Qn(T,E);return LR({defaultSize:R,dragState:g,layout:v,panelData:T,panelIndex:I})},[g,v]),O=p.useCallback(E=>{const{layout:R,panelDataArray:T}=S.current,{collapsedSize:I=0,collapsible:A,panelSize:z}=ln(T,E,R);return ne(z!=null,`Panel size not found for panel "${E.id}"`),A===!0&&Tt(z,I)},[]),ee=p.useCallback(E=>{const{layout:R,panelDataArray:T}=S.current,{collapsedSize:I=0,collapsible:A,panelSize:z}=ln(T,E,R);return ne(z!=null,`Panel size not found for panel "${E.id}"`),!A||En(z,I)>0},[]),M=p.useCallback(E=>{const{panelDataArray:R}=S.current;R.push(E),R.sort((T,I)=>{const A=T.order,z=I.order;return A==null&&z==null?0:A==null?-1:z==null?1:A-z}),S.current.panelDataArrayChanged=!0,_()},[_]);gn(()=>{if(S.current.panelDataArrayChanged){S.current.panelDataArrayChanged=!1;const{autoSaveId:E,onLayout:R,storage:T}=k.current,{layout:I,panelDataArray:A}=S.current;let z=null;if(E){const le=FR(E,A,T);le&&(x.current=new Map(Object.entries(le.expandToSizes)),z=le.layout)}z==null&&(z=MR({panelDataArray:A}));const re=Zd({layout:z,panelConstraints:A.map(le=>le.constraints)});Jd(I,re)||(b(re),S.current.layout=re,R&&R(re),Xn(A,re,w.current))}}),gn(()=>{const E=S.current;return()=>{E.layout=[]}},[]);const K=p.useCallback(E=>{let R=!1;const T=m.current;return T&&window.getComputedStyle(T,null).getPropertyValue("direction")==="rtl"&&(R=!0),function(A){A.preventDefault();const z=m.current;if(!z)return()=>null;const{direction:re,dragState:le,id:Ne,keyboardResizeBy:ze,onLayout:ae}=k.current,{layout:Ye,panelDataArray:Ir}=S.current,{initialLayout:So}=le??{},ni=Og(Ne,E,z);let De=DR(A,E,re,le,ze,z);const nc=re==="horizontal";nc&&R&&(De=-De);const Bg=Ir.map(Fg=>Fg.constraints),Or=qr({delta:De,initialLayout:So??Ye,panelConstraints:Bg,pivotIndices:ni,prevLayout:Ye,trigger:_g(A)?"keyboard":"mouse-or-touch"}),rc=!Yo(Ye,Or);(Sg(A)||Cg(A))&&C.current!=De&&(C.current=De,!rc&&De!==0?nc?ra(E,De<0?Eg:Pg):ra(E,De<0?Tg:Ag):ra(E,0)),rc&&(b(Or),S.current.layout=Or,ae&&ae(Or),Xn(Ir,Or,w.current))}},[]),X=p.useCallback((E,R)=>{const{onLayout:T}=k.current,{layout:I,panelDataArray:A}=S.current,z=A.map(Ye=>Ye.constraints),{panelSize:re,pivotIndices:le}=ln(A,E,I);ne(re!=null,`Panel size not found for panel "${E.id}"`);const ze=Qn(A,E)===A.length-1?re-R:R-re,ae=qr({delta:ze,initialLayout:I,panelConstraints:z,pivotIndices:le,prevLayout:I,trigger:"imperative-api"});Yo(I,ae)||(b(ae),S.current.layout=ae,T&&T(ae),Xn(A,ae,w.current))},[]),Z=p.useCallback((E,R)=>{const{layout:T,panelDataArray:I}=S.current,{collapsedSize:A=0,collapsible:z}=R,{collapsedSize:re=0,collapsible:le,maxSize:Ne=100,minSize:ze=0}=E.constraints,{panelSize:ae}=ln(I,E,T);ae!=null&&(z&&le&&Tt(ae,A)?Tt(A,re)||X(E,re):ae<ze?X(E,ze):ae>Ne&&X(E,Ne))},[X]),F=p.useCallback((E,R)=>{const{direction:T}=k.current,{layout:I}=S.current;if(!m.current)return;const A=ti(E,m.current);ne(A,`Drag handle element not found for id "${E}"`);const z=$g(T,R);y({dragHandleId:E,dragHandleRect:A.getBoundingClientRect(),initialCursorPosition:z,initialLayout:I})},[]),ie=p.useCallback(()=>{y(null)},[]),ve=p.useCallback(E=>{const{panelDataArray:R}=S.current,T=Qn(R,E);T>=0&&(R.splice(T,1),delete w.current[E.id],S.current.panelDataArrayChanged=!0,_())},[_]),pe=p.useMemo(()=>({collapsePanel:N,direction:r,dragState:g,expandPanel:H,getPanelSize:L,getPanelStyle:V,groupId:h,isPanelCollapsed:O,isPanelExpanded:ee,reevaluatePanelConstraints:Z,registerPanel:M,registerResizeHandle:K,resizePanel:X,startDragging:F,stopDragging:ie,unregisterPanel:ve,panelGroupElement:m.current}),[N,g,r,H,L,V,h,O,ee,Z,M,K,X,F,ie,ve]),P={display:"flex",flexDirection:r==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return p.createElement(Zs.Provider,{value:pe},p.createElement(u,{...d,children:e,className:n,id:s,ref:m,style:{...P,...c},[be.group]:"",[be.groupDirection]:r,[be.groupId]:h}))}const Lg=p.forwardRef((t,e)=>p.createElement(Mg,{...t,forwardedRef:e}));Mg.displayName="PanelGroup";Lg.displayName="forwardRef(PanelGroup)";function Qn(t,e){return t.findIndex(n=>n===e||n.id===e.id)}function ln(t,e,n){const r=Qn(t,e),s=r===t.length-1?[r-1,r]:[r,r+1],i=n[r];return{...e.constraints,panelSize:i,pivotIndices:s}}function WR({disabled:t,handleId:e,resizeHandler:n,panelGroupElement:r}){p.useEffect(()=>{if(t||n==null||r==null)return;const o=ti(e,r);if(o==null)return;const s=i=>{if(!i.defaultPrevented)switch(i.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{i.preventDefault(),n(i);break}case"F6":{i.preventDefault();const a=o.getAttribute(be.groupId);ne(a,`No group element found for id "${a}"`);const l=uo(a,r),c=Ig(a,e,r);ne(c!==null,`No resize element found for id "${e}"`);const u=i.shiftKey?c>0?c-1:l.length-1:c+1<l.length?c+1:0;l[u].focus();break}}};return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}},[r,t,e,n])}function Ya({children:t=null,className:e="",disabled:n=!1,hitAreaMargins:r,id:o,onBlur:s,onClick:i,onDragging:a,onFocus:l,onPointerDown:c,onPointerUp:u,style:d={},tabIndex:h=0,tagName:m="div",...g}){var y,v;const b=p.useRef(null),_=p.useRef({onClick:i,onDragging:a,onPointerDown:c,onPointerUp:u});p.useEffect(()=>{_.current.onClick=i,_.current.onDragging=a,_.current.onPointerDown=c,_.current.onPointerUp=u});const w=p.useContext(Zs);if(w===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:x,groupId:C,registerResizeHandle:k,startDragging:S,stopDragging:N,panelGroupElement:H}=w,L=Ql(o),[V,O]=p.useState("inactive"),[ee,M]=p.useState(!1),[K,X]=p.useState(null),Z=p.useRef({state:V});gn(()=>{Z.current.state=V}),p.useEffect(()=>{if(n)X(null);else{const pe=k(L);X(()=>pe)}},[n,L,k]);const F=(y=r?.coarse)!==null&&y!==void 0?y:15,ie=(v=r?.fine)!==null&&v!==void 0?v:5;p.useEffect(()=>{if(n||K==null)return;const pe=b.current;ne(pe,"Element ref not attached");let P=!1;return TR(L,pe,x,{coarse:F,fine:ie},(R,T,I)=>{if(!T){O("inactive");return}switch(R){case"down":{O("drag"),P=!1,ne(I,'Expected event to be defined for "down" action'),S(L,I);const{onDragging:A,onPointerDown:z}=_.current;A?.(!0),z?.();break}case"move":{const{state:A}=Z.current;P=!0,A!=="drag"&&O("hover"),ne(I,'Expected event to be defined for "move" action'),K(I);break}case"up":{O("hover"),N();const{onClick:A,onDragging:z,onPointerUp:re}=_.current;z?.(!1),re?.(),P||A?.();break}}})},[F,x,n,ie,k,L,K,S,N]),WR({disabled:n,handleId:L,resizeHandler:K,panelGroupElement:H});const ve={touchAction:"none",userSelect:"none"};return p.createElement(m,{...g,children:t,className:e,id:o,onBlur:()=>{M(!1),s?.()},onFocus:()=>{M(!0),l?.()},ref:b,role:"separator",style:{...ve,...d},tabIndex:h,[be.groupDirection]:x,[be.groupId]:C,[be.resizeHandle]:"",[be.resizeHandleActive]:V==="drag"?"pointer":ee?"keyboard":void 0,[be.resizeHandleEnabled]:!n,[be.resizeHandleId]:L,[be.resizeHandleState]:V})}Ya.displayName="PanelResizeHandle";const GR=jy(()=>Gt(()=>import("./JsonRoomEditor-Buor0pqx.js").then(t=>t.J),__vite__mapDeps([8,1,2,6,9]))),qR=p.lazy(GR),VR=()=>{gR();const t=f.jsx("div",{className:"flex h-full items-center justify-center bg-pureBlack",children:f.jsx("span",{className:"sprite texture-animated-head_walking_right"})});return f.jsx(f.Fragment,{children:f.jsx(tP,{children:f.jsx(Ns,{children:f.jsxs(Lg,{direction:"horizontal",className:"w-full h-full",children:[f.jsx(cs,{id:"jsonEditor",defaultSize:18,minSize:12,collapsible:!0,children:f.jsx(p.Suspense,{fallback:t,children:f.jsx(qR,{})})}),f.jsx(Ya,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-r-[calc(1px*var(--scale))] border-metallicBlue"}),f.jsx(cs,{id:"editingArea",children:f.jsx(DA,{children:f.jsx(mR,{})})}),f.jsx(Ya,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-l-[calc(1px*var(--scale))] border-metallicBlue"}),f.jsx(cs,{id:"toolbar",defaultSize:20,maxSize:33,minSize:10,children:f.jsx(hS,{children:f.jsx(dP,{})})})]})})})})},cI=Object.freeze(Object.defineProperty({__proto__:null,default:VR},Symbol.toStringTag,{value:"Module"}));export{$h as A,Ih as C,An as F,cI as L,ul as R,Jv as S,Nh as V,tb as a,lI as b,nI as h,ge as t,Xv as u};
