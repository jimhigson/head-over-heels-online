import{b as x,c as G,g as K,s as _,p as ee,f as te,h as re,i as oe,j as W,k as R,l as $,m as ne,n as se,o as ie,q as ae,t as le,u as ce}from"./index-x0G9x8PC.js";var T={},C={},j;function de(){if(j)return C;j=1;function e(l,i){var o;if(typeof Symbol>"u"||l[Symbol.iterator]==null){if(Array.isArray(l)||(o=t(l))||i){o&&(l=o);var d=0,s=function(){};return{s,n:function(){return d>=l.length?{done:!0}:{done:!1,value:l[d++]}},e:function(f){throw f},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,h=!1,p;return{s:function(){o=l[Symbol.iterator]()},n:function(){var f=o.next();return u=f.done,f},e:function(f){h=!0,p=f},f:function(){try{!u&&o.return!=null&&o.return()}finally{if(h)throw p}}}}function t(l,i){if(l){if(typeof l=="string")return r(l,i);var o=Object.prototype.toString.call(l).slice(8,-1);if(o==="Object"&&l.constructor&&(o=l.constructor.name),o==="Map"||o==="Set")return Array.from(l);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return r(l,i)}}function r(l,i){(i==null||i>l.length)&&(i=l.length);for(var o=0,d=new Array(i);o<i;o++)d[o]=l[o];return d}var n=x(),a=n.ensureIterable;function y(l){var i=[],o=e(l),d;try{for(o.s();!(d=o.n()).done;){var s=d.value;i.push(s)}}catch(u){o.e(u)}finally{o.f()}return i}C.__toArray=y;function m(l){return y(a(l))}return C.toArray=m,C}var H;function ue(){if(H)return T;H=1;var e=G(),t=e.mark(m),r=x(),n=r.iterableCurry,a=de(),y=a.__toArray;function m(i,o){var d;return e.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(d=Array.isArray(i)?i:y(i),d.length){u.next=3;break}return u.abrupt("return");case 3:if(!o--){u.next=7;break}return u.delegateYield(d,"t0",5);case 5:u.next=3;break;case 7:case"end":return u.stop()}},t)}T.__cycleTimes=m;var l=n(m);return T.cycleTimes=l,T}var S={},O;function ye(){if(O)return S;O=1;var e=x(),t=e.iterableCurry,r=ue(),n=r.__cycleTimes;function a(m){return n(m,1/0)}S.__cycle=a;var y=t(a);return S.cycle=y,S}var A={},B;function fe(){if(B)return A;B=1;var e=G(),t=e.mark(l);function r(o,d){var s;if(typeof Symbol>"u"||o[Symbol.iterator]==null){if(Array.isArray(o)||(s=n(o))||d){s&&(o=s);var u=0,h=function(){};return{s:h,n:function(){return u>=o.length?{done:!0}:{done:!1,value:o[u++]}},e:function(w){throw w},f:h}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,c=!1,f;return{s:function(){s=o[Symbol.iterator]()},n:function(){var w=s.next();return p=w.done,w},e:function(w){c=!0,f=w},f:function(){try{!p&&s.return!=null&&s.return()}finally{if(c)throw f}}}}function n(o,d){if(o){if(typeof o=="string")return a(o,d);var s=Object.prototype.toString.call(o).slice(8,-1);if(s==="Object"&&o.constructor&&(s=o.constructor.name),s==="Map"||s==="Set")return Array.from(o);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return a(o,d)}}function a(o,d){(d==null||d>o.length)&&(d=o.length);for(var s=0,u=new Array(d);s<d;s++)u[s]=o[s];return u}var y=x(),m=y.iterableCurry;function l(o,d){var s,u,h,p;return e.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(d!==0){f.next=2;break}return f.abrupt("return");case 2:s=0,u=r(o),f.prev=4,u.s();case 6:if((h=u.n()).done){f.next=14;break}return p=h.value,f.next=10,p;case 10:if(++s!==d){f.next=12;break}return f.abrupt("break",14);case 12:f.next=6;break;case 14:f.next=19;break;case 16:f.prev=16,f.t0=f.catch(4),u.e(f.t0);case 19:return f.prev=19,u.f(),f.finish(19);case 22:case"end":return f.stop()}},t,null,[[4,16,19,22]])}A.__take=l;var i=m(l);return A.take=i,A}var z,F;function me(){return F||(F=1,z=ye().cycle),z}var pe=me();const ge=K(pe);var E,M;function he(){return M||(M=1,E=fe().take),E}var ve=he();const be=K(ve),Ie={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},P=(e,t)=>[...be(t,ge(Ie[e]))],we=e=>({awayWall:{type:"wall",config:{direction:"away",tiles:P("blacktooth",e.x)},position:{x:0,y:e.y,z:0}},leftWall:{type:"wall",config:{direction:"left",tiles:P("blacktooth",e.y)},position:{x:e.x,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:e.x}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:e.y}},position:{x:0,y:0,z:0}}}),N=e=>({planet:"blacktooth",color:{hue:"cyan",shade:"basic"},size:e,items:{floor:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:e},position:{x:0,y:0,z:0}},...we(e)}}),v=e=>e.campaignInProgress.rooms[e.currentlyEditingRoomId],k={w:16,d:16,h:12},L={x:16,y:16,z:12},ke=["head","heels"],Re=[...ke,"headOverHeels"],g=(...e)=>t=>e.includes(t.type),Te=g("bubbles","stopAutowalk","firedDoughnut","floatingText","emitter","particle"),Ce=(e,t)=>Te(e)||Pe(e)&&(t!==void 0&&ze(t)||e.config.direction.z!==0)||Xe(e)&&e.config.floorType==="none",wt=(e,t)=>!Ce(e,t),Se=["ball","slidingBlock","slidingDeadly"];g(...Se);const Ae=["portableBlock","spring","sceneryPlayer","sceneryCrown","monster","slidingBlock"],xe=["dalek","turtle","elephantHead","homingBot","helicopterBug"],kt=e=>e.type==="slidingBlock"?e.config.style==="puck":e.type==="monster"?xe.includes(e.config.which):Ae.includes(e.type),ze=e=>e.type==="head"||e.type==="heels"||e.type==="headOverHeels";function Rt(e){return Ee.includes(e.type)}const Ee=[...Re,"monster","ball","charles","pushableBlock","movingPlatform","moveableDeadly","pickup","portableBlock","slidingBlock","slidingDeadly","spring","sceneryPlayer","sceneryCrown"],Je=["monster","deadlyBlock","moveableDeadly","slidingDeadly"];g(...Je);const _e=e=>e.config.times!==void 0,Pe=g("portal");g("teleporter");g("heels");g("head");g("heels","headOverHeels");g("head","headOverHeels");g("lift");g("emitter");const qe=g("monster"),Xe=g("floor");g("pickup");g("spring");const Tt=g("joystick");g("monster","movingPlatform");const Ct=e=>qe(e)&&e.config.which==="cyberman"&&e.state.everActivated===!1,St=(e,t={})=>{const r=$e(t),n=_(L,e);return _(ee(r,L),n)},Q=e=>({x:e.direction==="away"?e.tiles.length:e.direction==="towards"?e.times?.x:1,y:e.direction==="left"?e.tiles.length:e.direction==="right"?e.times?.y:1}),At=e=>_e(e)?e.type==="wall"?Q(e.config):e.config.times:void 0,$e=e=>({x:e.x??1,y:e.y??1,z:e.z??1}),De=e=>({x:e.x??1,y:e.y??1});function*We(e,t,r){for(const n of re(e)){const[a,y]=n;if(y.type!=="wall"){yield n;continue}if(y.config.direction!==t){yield n;continue}const{position:m,config:l}=y,i=De(Q(l)),o=oe(W(l.direction)),d=W(l.direction),s=_(r,m);if(s[d]!==0){yield n;continue}if(s[o]<-1){yield n;continue}if(s[o]>i[o]){yield n;continue}if(i[o]===2)continue;const u=s[o]===0;u&&(yield[a,R(y,p=>{p.position=$(m,{[o]:2});const c=p.config;switch(c.direction){case"towards":c.times={x:i[o]-2};break;case"right":c.times={y:i[o]-2};break;default:c.tiles=c.tiles.slice(2)}})]);const h=s[o]===i[o]-2;h&&(yield[a,R(y,p=>{const c=p.config;switch(c.direction){case"towards":c.times={x:i[o]-2};break;case"right":c.times={y:i[o]-2};break;default:c.tiles=c.tiles.slice(0,-2)}})]),!u&&!h&&(yield[`${a}/beforeDoor`,R(y,p=>{const c=p.config;switch(c.direction){case"towards":c.times={x:s[o]};break;case"right":c.times={y:s[o]};break;default:c.tiles=c.tiles.slice(0,s[o])}})],yield[`${a}/afterDoor`,R(y,p=>{p.position={...m,[o]:r[o]+2};const c=p.config;switch(c.direction){case"towards":c.times={x:i[o]-s[o]-2};break;case"right":c.times={y:i[o]-s[o]-2};break;default:c.tiles=c.tiles.slice(s[o]+2)}})])}}const U=(e,t,r)=>{e.items=te(We(e.items,t,r))},b=e=>{const t=structuredClone(ne(v(e))),{history:r}=e;r.redo=[],r.undo.push(t)},je={undo(e){const t=e,{campaignInProgress:r,history:{undo:n,redo:a},currentlyEditingRoomId:y}=t;n.length!==0&&(a.push(r.rooms[y]),r.rooms[y]=n.pop())},redo(e){const t=e,{campaignInProgress:r,history:{redo:n,undo:a},currentlyEditingRoomId:y}=t;n.length!==0&&(a.push(r.rooms[y]),r.rooms[y]=n.pop())}},He={selectCanUndo:e=>e.history.undo.length>0,selectCanRedo:e=>e.history.redo.length>0},V=(e,t)=>{e.planet=t;for(const r of Object.values(e.items))r.type==="floor"&&r.config.floorType==="standable"&&(r.config.scenery=t),r.type==="wall"&&(r.config.direction==="away"||r.config.direction==="left")&&(r.config.tiles=P(t,r.config.tiles.length)),r.type==="pickup"&&r.config.gives==="crown"&&se.includes(t)&&(r.config.planet=t)},xt=({x:e=0,y:t=0})=>t-e,Y=({x:e=0,y:t=0,z:r=0})=>({x:t-e,y:-(e+t)/2-r}),zt=(e,t,r)=>{const n=Y(t),a=ie(e,n);return $(Oe(a,r),t)},Oe=({x:e,y:t},r)=>{switch(r){case"xy":return{x:-(e/2+t),y:e/2-t,z:0};case"xz":return{x:-e,y:0,z:e/2-t};case"yz":return{x:0,y:e,z:-e/2-t};default:throw new Error(`unknown plane ${r}`)}},Be=({x:e=0,y:t=0,z:r=0})=>({x:e*k.w,y:t*k.d,z:r*k.h}),Fe=({x:e=0,y:t=0,z:r=0})=>({x:e/k.w,y:t/k.d,z:r/k.h}),Et=e=>Y(Be(e)),Z=(e,t)=>{const r=t.type==="monster"?t.config.which:t.type;for(let n=1;;n++){const a=n===1?r:`${r}_${n}`;if(!e.items[a])return a}},J=(e,t,r)=>{const n=v(e),a=Z(n,t);n.items[a]={type:t.type,config:t.config,position:r}},Me=e=>e.type==="door",Le=e=>e.type==="monster"&&e.config.which==="cyberman",Ue={applyToolToRoomJson(e,{payload:{blockPosition:t,pointedAtItem:r}}){const n=e,{tool:a}=n;switch(a?.type){case"item":{if(Me(a.item)&&r.type==="wall"){b(n);const y=v(n),m=r.config.direction;U(y,m,t);const l=`room_${n.nextRoomId++}`;J(n,{...a.item,config:{...a.item.config,toRoom:l,direction:m}},t);const i={id:l,...structuredClone(N({x:8,y:8})),color:y.color};V(i,y.planet),n.campaignInProgress.rooms[l]=i;const o=Z(i,a.item),d={x:m==="left"?0:m==="right"?i.size.x:Math.floor(i.size.x/2),y:m==="away"?0:m==="towards"?i.size.x:Math.floor(i.size.x/2),z:t.z},s=ae(m),u={type:"door",config:{toRoom:y.id,direction:s},position:d};i.items[o]=u,U(i,s,d)}else Le(a.item)&&r.type==="deadlyBlock"&&r.config.style==="toaster"&&Fe(r.state.position).z+1===t.z?(b(n),J(n,{...a.item,config:{...a.item.config,activated:"off"}},t)):(b(n),J(n,a.item,t));n.selectedJsonItemIds=[];break}}}},q="room_0",Ge={id:q,...N({x:8,y:8})},X={campaignInProgress:{name:"new campaign",rooms:{[q]:Ge}},nextRoomId:1,currentlyEditingRoomId:q,tool:{type:"pointer"},hoveredJsonItemId:void 0,clickableAnnotationHovered:!1,selectedJsonItemIds:[],halfGridResolution:!1,wallsFloorsLocked:!0,dragInProgress:!1,history:{undo:[],redo:[]}},D=le({name:"levelEditor",initialState:X,reducers:{setTool(e,{payload:t}){const r=e;t.type==="item"&&(r.selectedJsonItemIds=[]),r.tool=t},changeRoomColour(e,{payload:t}){const r=e,n=r.campaignInProgress.rooms[r.currentlyEditingRoomId].color;b(r),Object.assign(n,t)},changeRoomScenery(e,{payload:t}){const r=e,n=v(r);b(r),V(n,t)},changeToRoom(e,{payload:t}){const r=e;if(!r.campaignInProgress.rooms[t]){console.warn(`can't change to room ${t} - it doesn't exist`);return}r.currentlyEditingRoomId=t,r.clickableAnnotationHovered=!1,r.hoveredJsonItemId=void 0,r.selectedJsonItemIds=[],r.history=X.history},roomJsonEdited(e,{payload:t}){const r=e;r.campaignInProgress.rooms[r.currentlyEditingRoomId]=t},setHoveredItemInRoom(e,t){e.hoveredJsonItemId=t.payload},setClickableAnnotationHovered(e,t){e.clickableAnnotationHovered=t.payload},setSelectedItemInRoom(e,{payload:{jsonItemId:t,additive:r=!1}}){if(r)if(t===void 0)e.selectedJsonItemIds=[];else{const n=e.selectedJsonItemIds.indexOf(t);n===-1?e.selectedJsonItemIds.push(t):e.selectedJsonItemIds.splice(n,1)}else e.selectedJsonItemIds=t===void 0?[]:[t]},moveItemInRoom(e,{payload:{jsonItemId:t,positionDelta:r}}){const n=e,a=v(n);b(n);const y=a.items[t];y.position=$(a.items[t].position,r)},deleteSelected(e){const t=e,r=v(t);b(t),t.selectedJsonItemIds.forEach(n=>{delete r.items[n]}),t.selectedJsonItemIds=[]},injected(){},changeGridResolution(e,{payload:t}){const r=e;r.halfGridResolution=t},changeWallsFloorsLocked(e,{payload:t}){const r=e;r.wallsFloorsLocked=t},changeDragInProgress(e,{payload:t}){const r=e;r.dragInProgress=t},...je,...Ue},selectors:{selectCurrentEditingRoomJson:v,selectCurrentEditingRoomColour:e=>v(e).color,selectCurrentEditingRoomScenery:e=>v(e).planet,selectTool:e=>e.tool,selectSelectedJsonItemIds:e=>e.selectedJsonItemIds,selectHoveredJsonItemId:e=>e.hoveredJsonItemId,...He}}),{applyToolToRoomJson:Ke,changeDragInProgress:Ne,changeGridResolution:Qe,changeRoomColour:Ve,changeRoomScenery:Ye,changeToRoom:Ze,changeWallsFloorsLocked:et,deleteSelected:tt,injected:rt,moveItemInRoom:ot,redo:nt,roomJsonEdited:st,setClickableAnnotationHovered:it,setHoveredItemInRoom:at,setSelectedItemInRoom:lt,setTool:ct,undo:dt}=D.actions,{selectCanRedo:ut,selectCanUndo:yt,selectCurrentEditingRoomColour:ft,selectCurrentEditingRoomJson:mt,selectCurrentEditingRoomScenery:pt,selectHoveredJsonItemId:gt,selectSelectedJsonItemIds:ht,selectTool:vt}=D.selectors,bt=ce.withTypes(),Jt=Object.freeze(Object.defineProperty({__proto__:null,applyToolToRoomJson:Ke,changeDragInProgress:Ne,changeGridResolution:Qe,changeRoomColour:Ve,changeRoomScenery:Ye,changeToRoom:Ze,changeWallsFloorsLocked:et,deleteSelected:tt,initialLevelEditorSliceState:X,injected:rt,levelEditorSlice:D,moveItemInRoom:ot,redo:nt,roomJsonEdited:st,selectCanRedo:ut,selectCanUndo:yt,selectCurrentEditingRoomColour:ft,selectCurrentEditingRoomJson:mt,selectCurrentEditingRoomScenery:pt,selectHoveredJsonItemId:gt,selectSelectedJsonItemIds:ht,selectTool:vt,setClickableAnnotationHovered:it,setHoveredItemInRoom:at,setSelectedItemInRoom:lt,setTool:ct,undo:dt,useAppSelectorWithLevelEditorSlice:bt},Symbol.toStringTag,{value:"Module"}));export{Q as A,St as B,wt as C,Rt as D,ze as E,Tt as F,Ct as G,xt as H,kt as I,it as J,gt as K,ht as L,Fe as M,De as N,zt as O,ot as P,Ne as Q,lt as R,Ke as S,at as T,Oe as U,st as V,Jt as W,ct as a,ft as b,Qe as c,tt as d,Ve as e,pt as f,Ye as g,yt as h,ut as i,dt as j,et as k,mt as l,P as m,Ze as n,g as o,Y as p,Et as q,nt as r,vt as s,_e as t,bt as u,At as v,k as w,Be as x,Ee as y,Se as z};
