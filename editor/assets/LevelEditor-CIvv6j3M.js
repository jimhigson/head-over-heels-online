const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebGPURenderer-DlSAMr0I.js","assets/index-FYkCxzNA.js","assets/index-DVQTuc_0.css","assets/colorToUniform-KTpA7KSL.js","assets/SharedSystems-C_wif9Pa.js","assets/Graphics-7cdwISvJ.js","assets/levelEditorSlice-CnbE3eDv.js","assets/WebGLRenderer-B1y4zdSu.js","assets/JsonRoomEditor-DIZz_Eg1.js","assets/JsonRoomEditor-Cpm53wG5.css"])))=>i.map(i=>d[i]);
import{a6 as el,a5 as Sr,a7 as Ot,s as Xg,x as tl,y as It,e as nl,E as Qr,a as Jg,C as re,d as eo,v as to,Z as G,D as la,az as Gt,k as oh,K as En,t as At,T as er,U as Yg,M as Zg,aA as tr,V as sh,aB as Qg,w as ca,aC as ey,aD as ty,j as ny,aE as An,aF as h,aG as ih,aH as qt,aI as m,aJ as ry,aK as Es,aL as ah,aM as oy,aN as he,aO as He,aP as lh,aQ as sy,aR as iy,aS as U,aT as Ge,aU as kr,al as ay,aV as ly,aW as cy,aX as ch,aY as uh,ae as le,ai as Vt,aa as B,aZ as dh,a_ as sr,a$ as uy,b0 as As,b1 as gn,ag as hr,b2 as ho,an as Pr,b3 as dy,b4 as hy,b5 as fy,ab as vt,ac as us,at as Ts,ap as rl,am as hh,ao as Kt,b6 as $e,b7 as fh,b8 as py,af as my,b9 as Tn,aq as ph,au as no,ba as ds,bb as jt,bc as gy,bd as ua,be as yy,av as Rs,bf as ol,bg as sl,bh as Xr,ad as ir,bi as mh,as as il,bj as al,bk as vy,bl as wy,bm as en,ah as by,bn as xy,bo as ll,bp as lc,bq as _y,br as Cy,bs as Sy,bt as cl,bu as ky,bv as Py,bw as Ey,bx as Ay,by as Ty,bz as Ry,bA as Oy,bB as Iy,bC as jy,bD as $y,bE as Ny,bF as My,bG as zy,bH as Dy}from"./index-FYkCxzNA.js";import{r as Ly,u as fe,d as By,g as Fy,c as Uy,s as mn,a as vn,b as Hy,e as cc,f as Wy,h as Gy,i as qy,j as Vy,k as Ky,l as Xy,m as Jy,n as fr,o as Yy,p as Zy,q as ul,t as hs,v as ii,w as gh,x as Qy,y as ev,z as tv,A as nv,B as K,C as rv,D as Pe,E as ov,F as sv,G as yh,H as uc,I as dl,J as iv,K as fs,L as dc,M as pr,N as av,O as lv,P as cv,Q as hl,R as vh,S as wh,T as uv,U as dv,V as hv,W as fo,X as bh,Y as fl,Z as pl,_ as xh,$ as _h,a0 as fv,a1 as hc,a2 as Ch,a3 as pv,a4 as mv,a5 as Sh,a6 as gv,a7 as ai,a8 as yv,a9 as fc,aa as kh,ab as da,ac as Ph,ad as vv,ae as wv,af as Eh}from"./levelEditorSlice-CnbE3eDv.js";import{S as bv,G as ht}from"./Graphics-7cdwISvJ.js";function xv(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function _v(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function Cv(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(n=>typeof n=="function")){const n=t.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${e}[${n}]`)}}var pc=t=>Array.isArray(t)?t:[t];function Sv(t){const e=Array.isArray(t[0])?t[0]:t;return Cv(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function kv(t,e){const n=[],{length:r}=t;for(let o=0;o<r;o++)n.push(t[o].apply(null,e));return n}var Pv=class{constructor(t){this.value=t}deref(){return this.value}},Ev=typeof WeakRef<"u"?WeakRef:Pv,Av=0,mc=1;function So(){return{s:Av,v:void 0,o:null,p:null}}function Ah(t,e={}){let n=So();const{resultEqualityCheck:r}=e;let o,s=0;function i(){let a=n;const{length:l}=arguments;for(let d=0,f=l;d<f;d++){const p=arguments[d];if(typeof p=="function"||typeof p=="object"&&p!==null){let g=a.o;g===null&&(a.o=g=new WeakMap);const y=g.get(p);y===void 0?(a=So(),g.set(p,a)):a=y}else{let g=a.p;g===null&&(a.p=g=new Map);const y=g.get(p);y===void 0?(a=So(),g.set(p,a)):a=y}}const c=a;let u;if(a.s===mc)u=a.v;else if(u=t.apply(null,arguments),s++,r){const d=o?.deref?.()??o;d!=null&&r(d,u)&&(u=d,s!==0&&s--),o=typeof u=="object"&&u!==null||typeof u=="function"?new Ev(u):u}return c.s=mc,c.v=u,u}return i.clearCache=()=>{n=So(),i.resetResultsCount()},i.resultsCount=()=>s,i.resetResultsCount=()=>{s=0},i}function Tv(t,...e){const n=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,r=(...o)=>{let s=0,i=0,a,l={},c=o.pop();typeof c=="object"&&(l=c,c=o.pop()),xv(c,`createSelector expects an output function after the inputs, but received: [${typeof c}]`);const u={...n,...l},{memoize:d,memoizeOptions:f=[],argsMemoize:p=Ah,argsMemoizeOptions:g=[]}=u,y=pc(f),v=pc(g),w=Sv(o),_=d(function(){return s++,c.apply(null,arguments)},...y),b=p(function(){i++;const S=kv(w,arguments);return a=_.apply(null,S),a},...v);return Object.assign(b,{resultFunc:c,memoizedResultFunc:_,dependencies:w,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>a,recomputations:()=>s,resetRecomputations:()=>{s=0},memoize:d,argsMemoize:p})};return Object.assign(r,{withTypes:()=>r}),r}var Th=Tv(Ah),Rv=Object.assign((t,e=Th)=>{_v(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const n=Object.keys(t),r=n.map(s=>t[s]);return e(r,(...s)=>s.reduce((i,a,l)=>(i[n[l]]=a,i),{}))},{withTypes:()=>Rv}),ko={},gc;function Rh(){if(gc)return ko;gc=1;var t=el(),e=t.mark(a);function n(c,u){var d;if(typeof Symbol>"u"||c[Symbol.iterator]==null){if(Array.isArray(c)||(d=r(c))||u){d&&(c=d);var f=0,p=function(){};return{s:p,n:function(){return f>=c.length?{done:!0}:{done:!1,value:c[f++]}},e:function(_){throw _},f:p}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var g=!0,y=!1,v;return{s:function(){d=c[Symbol.iterator]()},n:function(){var _=d.next();return g=_.done,_},e:function(_){y=!0,v=_},f:function(){try{!g&&d.return!=null&&d.return()}finally{if(y)throw v}}}}function r(c,u){if(c){if(typeof c=="string")return o(c,u);var d=Object.prototype.toString.call(c).slice(8,-1);if(d==="Object"&&c.constructor&&(d=c.constructor.name),d==="Map"||d==="Set")return Array.from(c);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return o(c,u)}}function o(c,u){(u==null||u>c.length)&&(u=c.length);for(var d=0,f=new Array(u);d<u;d++)f[d]=c[d];return f}var s=Sr(),i=s.iterableCurry;function a(c,u){var d,f,p,g;return t.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d=0,f=n(c),v.prev=2,f.s();case 4:if((p=f.n()).done){v.next=10;break}return g=p.value,v.next=8,u(g,d++);case 8:v.next=4;break;case 10:v.next=15;break;case 12:v.prev=12,v.t0=v.catch(2),f.e(v.t0);case 15:return v.prev=15,f.f(),v.finish(15);case 18:case"end":return v.stop()}},e,null,[[2,12,15,18]])}ko.__map=a;var l=i(a);return ko.map=l,ko}var Po={},yc;function Ov(){if(yc)return Po;yc=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,p=!1,g;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return f=v.done,v},e:function(v){p=!0,g=v},f:function(){try{!f&&c.return!=null&&c.return()}finally{if(p)throw g}}}}function e(a,l){if(a){if(typeof a=="string")return n(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return n(a,l)}}function n(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var r=Sr(),o=r.iterableCurry;function s(a,l){var c=0,u=t(a),d;try{for(u.s();!(d=u.n()).done;){var f=d.value;if(l(f,c++))return!0}}catch(p){u.e(p)}finally{u.f()}return!1}Po.__some=s;var i=o(s,{reduces:!0});return Po.some=i,Po}var Eo={},vc;function Iv(){if(vc)return Eo;vc=1;var t=el(),e=t.mark(s),n=Sr(),r=n.wrapWithIterableIterator,o=n.ensureIterable;function s(){var a,l,c,u,d,f,p=arguments;return t.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:for(a=p.length,l=new Array(a),c=0;c<a;c++)l[c]=p[c];u=0,d=l;case 2:if(!(u<d.length)){y.next=8;break}return f=d[u],y.delegateYield(o(f),"t0",5);case 5:u++,y.next=2;break;case 8:case"end":return y.stop()}},e)}Eo.__concat=s;var i=r(s);return Eo.concat=i,Eo}var Ao={},wc;function jv(){if(wc)return Ao;wc=1;var t=el(),e=t.mark(c);function n(d,f){var p;if(typeof Symbol>"u"||d[Symbol.iterator]==null){if(Array.isArray(d)||(p=r(d))||f){p&&(d=p);var g=0,y=function(){};return{s:y,n:function(){return g>=d.length?{done:!0}:{done:!1,value:d[g++]}},e:function(x){throw x},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,w=!1,_;return{s:function(){p=d[Symbol.iterator]()},n:function(){var x=p.next();return v=x.done,x},e:function(x){w=!0,_=x},f:function(){try{!v&&p.return!=null&&p.return()}finally{if(w)throw _}}}}function r(d,f){if(d){if(typeof d=="string")return o(d,f);var p=Object.prototype.toString.call(d).slice(8,-1);if(p==="Object"&&d.constructor&&(p=d.constructor.name),p==="Map"||p==="Set")return Array.from(d);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return o(d,f)}}function o(d,f){(f==null||f>d.length)&&(f=d.length);for(var p=0,g=new Array(f);p<f;p++)g[p]=d[p];return g}var s=Sr(),i=s.iterableCurry,a=Rh(),l=a.__map;function c(d,f){var p,g,y;return t.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:p=n(l(d,f)),w.prev=1,p.s();case 3:if((g=p.n()).done){w.next=8;break}return y=g.value,w.delegateYield(y,"t0",6);case 6:w.next=3;break;case 8:w.next=13;break;case 10:w.prev=10,w.t1=w.catch(1),p.e(w.t1);case 13:return w.prev=13,p.f(),w.finish(13);case 16:case"end":return w.stop()}},e,null,[[1,10,13,16]])}Ao.__flatMap=c;var u=i(c);return Ao.flatMap=u,Ao}var To={},bc;function $v(){if(bc)return To;bc=1;var t=Sr(),e=t.iterableCurry,n=Ly(),r=n.__firstOr,o=Symbol("none");function s(a){return r(a,o)===o}To.__isEmpty=s;var i=e(s,{reduces:!0});return To.isEmpty=i,To}var Ro={},xc;function Nv(){if(xc)return Ro;xc=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,p=!1,g;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return f=v.done,v},e:function(v){p=!0,g=v},f:function(){try{!f&&c.return!=null&&c.return()}finally{if(p)throw g}}}}function e(a,l){if(a){if(typeof a=="string")return n(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return n(a,l)}}function n(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var r=Sr(),o=r.ensureIterable;function s(a){var l=o(a),c=0,u=t(l),d;try{for(u.s();!(d=u.n()).done;){var f=d.value;c++}}catch(p){u.e(p)}finally{u.f()}return c}Ro.__size=s;var i=s;return Ro.size=i,Ro}var li,_c;function Mv(){return _c||(_c=1,li=Iv().concat),li}var zv=Mv();const Cc=Ot(zv);var ci,Sc;function Dv(){return Sc||(Sc=1,ci=jv().flatMap),ci}var Lv=Dv();const Bv=Ot(Lv);var ui,kc;function Fv(){return kc||(kc=1,ui=$v().isEmpty),ui}var Uv=Fv();const Oh=Ot(Uv);var di,Pc;function Hv(){return Pc||(Pc=1,di=Rh().map),di}var Wv=Hv();const Ec=Ot(Wv);var hi={},Ac;function Gv(){if(Ac)return hi;Ac=1;var t=function(r){return r};function e(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return r.length||(r=[t]),r.reduce(function(s,i){return function(){return i(s.apply(void 0,arguments))}})}return hi.pipe=e,hi}var fi,Tc;function qv(){return Tc||(Tc=1,fi=Gv().pipe),fi}var Vv=qv();const Rc=Ot(Vv);var pi,Oc;function Kv(){return Oc||(Oc=1,pi=Nv().size),pi}var Xv=Kv();const Ih=Ot(Xv);var mi,Ic;function Jv(){return Ic||(Ic=1,mi=Ov().some),mi}var Yv=Jv();const Zv=Ot(Yv),jh=class ha extends Xg{constructor(e){e={...ha.defaultOptions,...e},super(e),this.enabled=!0,this._state=bv.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(e,n,r,o){e.applyFilter(this,n,r,o)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:n,gl:r,...o}=e;let s,i;return n&&(s=tl.from(n)),r&&(i=It.from(r)),new ha({gpuProgram:s,glProgram:i,...o})}};jh.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let tn=jh;const fa=[];nl.handleByNamedList(Qr.Environment,fa);async function Qv(t){if(!t)for(let e=0;e<fa.length;e++){const n=fa[e];if(n.value.test()){await n.value.load();return}}}let $r;function ew(){if(typeof $r=="boolean")return $r;try{$r=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{$r=!1}return $r}var $h=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))($h||{});class tw{constructor(e){this.items=[],this._name=e}emit(e,n,r,o,s,i,a,l){const{name:c,items:u}=this;for(let d=0,f=u.length;d<f;d++)u[d][c](e,n,r,o,s,i,a,l);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const n=this.items.indexOf(e);return n!==-1&&this.items.splice(n,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const nw=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Nh=class Mh extends Jg{constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;const n=[...nw,...this.config.runners??[]];this._addRunners(...n),this._unsafeEvalCheck()}async init(e={}){const n=e.skipExtensionImports===!0?!0:e.manageImports===!1;await Qv(n),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const r in this._systemsHash)e={...this._systemsHash[r].constructor.defaultOptions,...e};e={...Mh.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let r=0;r<this.runners.init.items.length;r++)await this.runners.init.items[r].init(e);this._initOptions=e}render(e,n){let r=e;if(r instanceof re&&(r={container:r},n&&(eo(to,"passing a second argument is deprecated, please use render options instead"),r.target=n.renderTexture)),r.target||(r.target=this.view.renderTarget),r.target===this.view.renderTarget&&(this._lastObjectRendered=r.container,r.clearColor??(r.clearColor=this.background.colorRgba),r.clear??(r.clear=this.background.clearBeforeRender)),r.clearColor){const o=Array.isArray(r.clearColor)&&r.clearColor.length===4;r.clearColor=o?r.clearColor:G.shared.setValue(r.clearColor).toArray()}r.transform||(r.container.updateLocalTransform(),r.transform=r.container.localTransform),r.container.enableRenderGroup(),this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r)}resize(e,n,r){const o=this.view.resolution;this.view.resize(e,n,r),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),r!==void 0&&r!==o&&this.runners.resolutionChange.emit(r)}clear(e={}){const n=this;e.target||(e.target=n.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=$h.ALL);const{clear:r,clearColor:o,target:s}=e;G.shared.setValue(o??this.background.colorRgba),n.renderTarget.clear(s,r,G.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(n=>{this.runners[n]=new tw(n)})}_addSystems(e){let n;for(n in e){const r=e[n];this._addSystem(r.value,r.name)}}_addSystem(e,n){const r=new e(this);if(this[n])throw new Error(`Whoops! The name "${n}" is already in use`);this[n]=r,this._systemsHash[n]=r;for(const o in this.runners)this.runners[o].add(r);return this}_addPipes(e,n){const r=n.reduce((o,s)=>(o[s.name]=s.value,o),{});e.forEach(o=>{const s=o.value,i=o.name,a=r[i];this.renderPipes[i]=new s(this,a?new a:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(n=>{n.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!ew())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Nh.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let zh=Nh,Oo;function rw(t){return Oo!==void 0||(Oo=(()=>{const e={stencil:!0,failIfMajorPerformanceCaveat:t??zh.defaultOptions.failIfMajorPerformanceCaveat};try{if(!la.get().getWebGLRenderingContext())return!1;let r=la.get().createCanvas().getContext("webgl",e);const o=!!r?.getContextAttributes()?.stencil;if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,o}catch{return!1}})()),Oo}let Io;async function ow(t={}){return Io!==void 0||(Io=await(async()=>{const e=la.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(t)).requestDevice(),!0}catch{return!1}})()),Io}const jc=["webgl","webgpu","canvas"];async function sw(t){let e=[];t.preference?(e.push(t.preference),jc.forEach(s=>{s!==t.preference&&e.push(s)})):e=jc.slice();let n,r={};for(let s=0;s<e.length;s++){const i=e[s];if(i==="webgpu"&&await ow()){const{WebGPURenderer:a}=await Gt(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-DlSAMr0I.js");return{WebGPURenderer:l}},__vite__mapDeps([0,1,2,3,4,5,6]));n=a,r={...t,...t.webgpu};break}else if(i==="webgl"&&rw(t.failIfMajorPerformanceCaveat??zh.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await Gt(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-B1y4zdSu.js");return{WebGLRenderer:l}},__vite__mapDeps([7,1,2,3,4,5,6]));n=a,r={...t,...t.webgl};break}else if(i==="canvas")throw r={...t},new Error("CanvasRenderer is not yet implemented")}if(delete r.webgpu,delete r.webgl,!n)throw new Error("No available renderer for the current environment");const o=new n;return await o.init(r),o}const Dh="8.8.1";class Lh{static init(){globalThis.__PIXI_APP_INIT__?.(this,Dh)}static destroy(){}}Lh.extension=Qr.Application;class iw{constructor(e){this._renderer=e}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,Dh)}destroy(){this._renderer=null}}iw.extension={type:[Qr.WebGLSystem,Qr.WebGPUSystem],name:"initHook",priority:-10};const Bh=class pa{constructor(...e){this.stage=new re,e[0]!==void 0&&eo(to,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await sw(e),pa._plugins.forEach(n=>{n.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return eo(to,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,n=!1){const r=pa._plugins.slice(0);r.reverse(),r.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(n),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Bh._plugins=[];let Fh=Bh;nl.handleByList(Qr.Application,Fh._plugins);nl.add(Lh);var Uh=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,aw=`
in vec2 vTextureCoord;

out vec4 finalColor;

uniform float uAlpha;
uniform sampler2D uTexture;

void main()
{
    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;
}
`,$c=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
 
    var sample = textureSample(uTexture, uSampler, uv);
    
    return sample * alphaUniforms.uAlpha;
}`;const Hh=class Wh extends tn{constructor(e){e={...Wh.defaultOptions,...e};const n=tl.from({vertex:{source:$c,entryPoint:"mainVertex"},fragment:{source:$c,entryPoint:"mainFragment"}}),r=It.from({vertex:Uh,fragment:aw,name:"alpha-filter"}),{alpha:o,...s}=e,i=new oh({uAlpha:{value:o,type:"f32"}});super({...s,gpuProgram:n,glProgram:r,resources:{alphaUniforms:i}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(e){this.resources.alphaUniforms.uniforms.uAlpha=e}};Hh.defaultOptions={alpha:1};let lw=Hh;var cw=`
in vec2 vTextureCoord;
in vec4 vColor;

out vec4 finalColor;

uniform float uColorMatrix[20];
uniform float uAlpha;

uniform sampler2D uTexture;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture(uTexture, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * 0.2);
    float diff = (randomValue - 0.5) *  0.5;

    if (uAlpha == 0.0) {
        finalColor = color;
        return;
    }

    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    vec4 result;

    result.r = (uColorMatrix[0] * color.r);
        result.r += (uColorMatrix[1] * color.g);
        result.r += (uColorMatrix[2] * color.b);
        result.r += (uColorMatrix[3] * color.a);
        result.r += uColorMatrix[4];

    result.g = (uColorMatrix[5] * color.r);
        result.g += (uColorMatrix[6] * color.g);
        result.g += (uColorMatrix[7] * color.b);
        result.g += (uColorMatrix[8] * color.a);
        result.g += uColorMatrix[9];

    result.b = (uColorMatrix[10] * color.r);
       result.b += (uColorMatrix[11] * color.g);
       result.b += (uColorMatrix[12] * color.b);
       result.b += (uColorMatrix[13] * color.a);
       result.b += uColorMatrix[14];

    result.a = (uColorMatrix[15] * color.r);
       result.a += (uColorMatrix[16] * color.g);
       result.a += (uColorMatrix[17] * color.b);
       result.a += (uColorMatrix[18] * color.a);
       result.a += uColorMatrix[19];

    vec3 rgb = mix(color.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    finalColor = vec4(rgb, result.a);
}
`,Nc=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct ColorMatrixUniforms {
  uColorMatrix:array<vec4<f32>, 5>,
  uAlpha:f32,
};


@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;
@group(1) @binding(0) var<uniform> colorMatrixUniforms : ColorMatrixUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
  };
  
fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
  );
}


@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
) -> @location(0) vec4<f32> {


  var c = textureSample(uTexture, uSampler, uv);
  
  if (colorMatrixUniforms.uAlpha == 0.0) {
    return c;
  }

 
    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.r /= c.a;
      c.g /= c.a;
      c.b /= c.a;
    }

    var cm = colorMatrixUniforms.uColorMatrix;


    var result = vec4<f32>(0.);

    result.r = (cm[0][0] * c.r);
    result.r += (cm[0][1] * c.g);
    result.r += (cm[0][2] * c.b);
    result.r += (cm[0][3] * c.a);
    result.r += cm[1][0];

    result.g = (cm[1][1] * c.r);
    result.g += (cm[1][2] * c.g);
    result.g += (cm[1][3] * c.b);
    result.g += (cm[2][0] * c.a);
    result.g += cm[2][1];

    result.b = (cm[2][2] * c.r);
    result.b += (cm[2][3] * c.g);
    result.b += (cm[3][0] * c.b);
    result.b += (cm[3][1] * c.a);
    result.b += cm[3][2];

    result.a = (cm[3][3] * c.r);
    result.a += (cm[4][0] * c.g);
    result.a += (cm[4][1] * c.b);
    result.a += (cm[4][2] * c.a);
    result.a += cm[4][3];

    var rgb = mix(c.rgb, result.rgb, colorMatrixUniforms.uAlpha);

    rgb.r *= result.a;
    rgb.g *= result.a;
    rgb.b *= result.a;

    return vec4(rgb, result.a);
}`;class uw extends tn{constructor(e={}){const n=new oh({uColorMatrix:{value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],type:"f32",size:20},uAlpha:{value:1,type:"f32"}}),r=tl.from({vertex:{source:Nc,entryPoint:"mainVertex"},fragment:{source:Nc,entryPoint:"mainFragment"}}),o=It.from({vertex:Uh,fragment:cw,name:"color-matrix-filter"});super({...e,gpuProgram:r,glProgram:o,resources:{colorMatrixUniforms:n}}),this.alpha=1}_loadMatrix(e,n=!1){let r=e;n&&(this._multiply(r,this.matrix,e),r=this._colorMatrix(r)),this.resources.colorMatrixUniforms.uniforms.uColorMatrix=r,this.resources.colorMatrixUniforms.update()}_multiply(e,n,r){return e[0]=n[0]*r[0]+n[1]*r[5]+n[2]*r[10]+n[3]*r[15],e[1]=n[0]*r[1]+n[1]*r[6]+n[2]*r[11]+n[3]*r[16],e[2]=n[0]*r[2]+n[1]*r[7]+n[2]*r[12]+n[3]*r[17],e[3]=n[0]*r[3]+n[1]*r[8]+n[2]*r[13]+n[3]*r[18],e[4]=n[0]*r[4]+n[1]*r[9]+n[2]*r[14]+n[3]*r[19]+n[4],e[5]=n[5]*r[0]+n[6]*r[5]+n[7]*r[10]+n[8]*r[15],e[6]=n[5]*r[1]+n[6]*r[6]+n[7]*r[11]+n[8]*r[16],e[7]=n[5]*r[2]+n[6]*r[7]+n[7]*r[12]+n[8]*r[17],e[8]=n[5]*r[3]+n[6]*r[8]+n[7]*r[13]+n[8]*r[18],e[9]=n[5]*r[4]+n[6]*r[9]+n[7]*r[14]+n[8]*r[19]+n[9],e[10]=n[10]*r[0]+n[11]*r[5]+n[12]*r[10]+n[13]*r[15],e[11]=n[10]*r[1]+n[11]*r[6]+n[12]*r[11]+n[13]*r[16],e[12]=n[10]*r[2]+n[11]*r[7]+n[12]*r[12]+n[13]*r[17],e[13]=n[10]*r[3]+n[11]*r[8]+n[12]*r[13]+n[13]*r[18],e[14]=n[10]*r[4]+n[11]*r[9]+n[12]*r[14]+n[13]*r[19]+n[14],e[15]=n[15]*r[0]+n[16]*r[5]+n[17]*r[10]+n[18]*r[15],e[16]=n[15]*r[1]+n[16]*r[6]+n[17]*r[11]+n[18]*r[16],e[17]=n[15]*r[2]+n[16]*r[7]+n[17]*r[12]+n[18]*r[17],e[18]=n[15]*r[3]+n[16]*r[8]+n[17]*r[13]+n[18]*r[18],e[19]=n[15]*r[4]+n[16]*r[9]+n[17]*r[14]+n[18]*r[19]+n[19],e}_colorMatrix(e){const n=new Float32Array(e);return n[4]/=255,n[9]/=255,n[14]/=255,n[19]/=255,n}brightness(e,n){const r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,n)}tint(e,n){const[r,o,s]=G.shared.setValue(e).toArray(),i=[r,0,0,0,0,0,o,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(i,n)}greyscale(e,n){const r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,n)}grayscale(e,n){this.greyscale(e,n)}blackAndWhite(e){const n=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(n,e)}hue(e,n){e=(e||0)/180*Math.PI;const r=Math.cos(e),o=Math.sin(e),s=Math.sqrt,i=1/3,a=s(i),l=r+(1-r)*i,c=i*(1-r)-a*o,u=i*(1-r)+a*o,d=i*(1-r)+a*o,f=r+i*(1-r),p=i*(1-r)-a*o,g=i*(1-r)-a*o,y=i*(1-r)+a*o,v=r+i*(1-r),w=[l,c,u,0,0,d,f,p,0,0,g,y,v,0,0,0,0,0,1,0];this._loadMatrix(w,n)}contrast(e,n){const r=(e||0)+1,o=-.5*(r-1),s=[r,0,0,0,o,0,r,0,0,o,0,0,r,0,o,0,0,0,1,0];this._loadMatrix(s,n)}saturate(e=0,n){const r=e*2/3+1,o=(r-1)*-.5,s=[r,o,o,0,0,o,r,o,0,0,o,o,r,0,0,0,0,0,1,0];this._loadMatrix(s,n)}desaturate(){this.saturate(-1)}negative(e){const n=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(n,e)}sepia(e){const n=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(n,e)}technicolor(e){const n=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(n,e)}polaroid(e){const n=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(n,e)}toBGR(e){const n=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(n,e)}kodachrome(e){const n=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(n,e)}browni(e){const n=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(n,e)}vintage(e){const n=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(n,e)}colorTone(e,n,r,o,s){e||(e=.2),n||(n=.15),r||(r=16770432),o||(o=3375104);const i=G.shared,[a,l,c]=i.setValue(r).toArray(),[u,d,f]=i.setValue(o).toArray(),p=[.3,.59,.11,0,0,a,l,c,e,0,u,d,f,n,0,a-u,l-d,c-f,0,0];this._loadMatrix(p,s)}night(e,n){e||(e=.1);const r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,n)}predator(e,n){const r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,n)}lsd(e){const n=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(n,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.resources.colorMatrixUniforms.uniforms.uColorMatrix}set matrix(e){this.resources.colorMatrixUniforms.uniforms.uColorMatrix=e}get alpha(){return this.resources.colorMatrixUniforms.uniforms.uAlpha}set alpha(e){this.resources.colorMatrixUniforms.uniforms.uAlpha=e}}class mr extends En{constructor(...e){let n=e[0];Array.isArray(e[0])&&(n={textures:e[0],autoUpdate:e[1]});const{animationSpeed:r=1,autoPlay:o=!1,autoUpdate:s=!0,loop:i=!0,onComplete:a=null,onFrameChange:l=null,onLoop:c=null,textures:u,updateAnchor:d=!1,...f}=n,[p]=u;super({...f,texture:p instanceof At?p:p.texture}),this._textures=null,this._durations=null,this._autoUpdate=s,this._isConnectedToTicker=!1,this.animationSpeed=r,this.loop=i,this.updateAnchor=d,this.onComplete=a,this.onFrameChange=l,this.onLoop=c,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=u,o&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(er.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(er.shared.add(this.update,this,Yg.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const n=e.deltaTime,r=this.animationSpeed*n,o=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=r/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*n);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o||this.animationSpeed<0&&this.currentFrame>o)&&this.onLoop(),this._updateTexture())}_updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const n=[];for(let r=0;r<e.length;++r)n.push(At.from(e[r]));return new mr(n)}static fromImages(e){const n=[];for(let r=0;r<e.length;++r)n.push(At.from(e[r]));return new mr(n)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof At)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let n=0;n<e.length;n++)this._textures.push(e[n].texture),this._durations.push(e[n].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const n=this.currentFrame;this._currentTime=e,n!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(er.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(er.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class dw{constructor({matrix:e,observer:n}={}){this.dirty=!0,this._matrix=e??new Zg,this.observer=n,this.position=new tr(this,0,0),this.scale=new tr(this,1,1),this.pivot=new tr(this,0,0),this.skew=new tr(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}_onUpdate(e){this.dirty=!0,e===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}}const Gh=class Zo extends sh{constructor(...e){let n=e[0]||{};n instanceof At&&(n={texture:n}),e.length>1&&(eo(to,"use new TilingSprite({ texture, width:100, height:100 }) instead"),n.width=e[1],n.height=e[2]),n={...Zo.defaultOptions,...n};const{texture:r,anchor:o,tilePosition:s,tileScale:i,tileRotation:a,width:l,height:c,applyAnchorToTexture:u,roundPixels:d,...f}=n??{};super({label:"TilingSprite",...f}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new tr({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=u,this.texture=r,this._width=l??r.width,this._height=c??r.height,this._tileTransform=new dw({observer:{_onUpdate:()=>this.onViewUpdate()}}),o&&(this.anchor=o),this.tilePosition=s,this.tileScale=i,this.tileRotation=a,this.roundPixels=d??!1}static from(e,n={}){return typeof e=="string"?new Zo({texture:Qg.get(e),...n}):new Zo({texture:e,...n})}get uvRespectAnchor(){return ca("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){ca("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){typeof e=="number"?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=At.EMPTY);const n=this._texture;n!==e&&(n&&n.dynamic&&n.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,n){typeof e=="object"&&(n=e.height??e.width,e=e.width),this._width=e,this._height=n??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){const e=this._bounds,n=this._anchor,r=this._width,o=this._height;e.minX=-n._x*r,e.maxX=e.minX+r,e.minY=-n._y*o,e.maxY=e.minY+o}containsPoint(e){const n=this._width,r=this._height,o=-n*this._anchor._x;let s=0;return e.x>=o&&e.x<=o+n&&(s=-r*this._anchor._y,e.y>=s&&e.y<=s+r)}destroy(e=!1){if(super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof e=="boolean"?e:e?.texture){const r=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(r)}this._texture=null}};Gh.defaultOptions={texture:At.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let hw=Gh;class fw extends sh{constructor(e,n){const{text:r,resolution:o,style:s,anchor:i,width:a,height:l,roundPixels:c,...u}=e;super({...u}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=n,this.text=r??"",this.style=s,this.resolution=o??null,this.allowChildren=!1,this._anchor=new tr({_onUpdate:()=>{this.onViewUpdate()}}),i&&(this.anchor=i),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){e||(e={}),this._style?.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,n){typeof e=="object"?(n=e.height??e.width,e=e.width):n??(n=e),e!==void 0&&this._setWidth(e,this.bounds.width),n!==void 0&&this._setHeight(n,this.bounds.height)}containsPoint(e){const n=this.bounds.width,r=this.bounds.height,o=-n*this.anchor.x;let s=0;return e.x>=o&&e.x<=o+n&&(s=-r*this.anchor.y,e.y>=s&&e.y<=s+r)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e?.style)&&this._style.destroy(e),this._style=null,this._text=null}}function pw(t,e){let n=t[0]??{};return(typeof n=="string"||t[1])&&(eo(to,`use new ${e}({ text: "hi!", style }) instead`),n={text:n,style:t[1]}),n}class mw extends fw{constructor(...e){const n=pw(e,"Text");super(n,ey),this.renderPipeId="text"}updateBounds(){const e=this._bounds,n=this._anchor,r=ty.measureText(this._text,this._style),{width:o,height:s}=r;e.minX=-n._x*o,e.maxX=e.minX+o,e.minY=-n._y*s,e.maxY=e.minY+s}}class Os extends At{static create(e){return new Os({source:new ny(e)})}resize(e,n,r){return this.source.resize(e,n,r),this}}const qh=class Vh extends re{constructor(e={}){e={...Vh.defaultOptions,...e},super(),this.renderLayerChildren=[],this.sortableChildren=e.sortableChildren,this.sortFunction=e.sortFunction}attach(...e){for(let n=0;n<e.length;n++){const r=e[n];if(r.parentRenderLayer){if(r.parentRenderLayer===this)continue;r.parentRenderLayer.detach(r)}this.renderLayerChildren.push(r),r.parentRenderLayer=this;const o=this.renderGroup||this.parentRenderGroup;o&&(o.structureDidChange=!0)}return e[0]}detach(...e){for(let n=0;n<e.length;n++){const r=e[n],o=this.renderLayerChildren.indexOf(r);o!==-1&&this.renderLayerChildren.splice(o,1),r.parentRenderLayer=null;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)}return e[0]}detachAll(){const e=this.renderLayerChildren;for(let n=0;n<e.length;n++)e[n].parentRenderLayer=null;this.renderLayerChildren.length=0}collectRenderables(e,n,r){const o=this.renderLayerChildren,s=o.length;this.sortableChildren&&this.sortRenderLayerChildren();for(let i=0;i<s;i++)o[i].parent||ca("Container must be added to both layer and scene graph. Layers only handle render order - the scene graph is required for transforms (addChild)",o[i]),o[i].collectRenderables(e,n,this)}sortRenderLayerChildren(){this.renderLayerChildren.sort(this.sortFunction)}_getGlobalBoundsRecursive(e,n,r){if(!e)return;const o=this.renderLayerChildren;for(let s=0;s<o.length;s++)o[s]._getGlobalBoundsRecursive(!0,n,this)}};qh.defaultOptions={sortableChildren:!1,sortFunction:(t,e)=>t.zIndex-e.zIndex};let gw=qh;const Mc=gw,ml="-",yw=t=>{const e=ww(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:i=>{const a=i.split(ml);return a[0]===""&&a.length!==1&&a.shift(),Kh(a,e)||vw(i)},getConflictingClassGroupIds:(i,a)=>{const l=n[i]||[];return a&&r[i]?[...l,...r[i]]:l}}},Kh=(t,e)=>{if(t.length===0)return e.classGroupId;const n=t[0],r=e.nextPart.get(n),o=r?Kh(t.slice(1),r):void 0;if(o)return o;if(e.validators.length===0)return;const s=t.join(ml);return e.validators.find(({validator:i})=>i(s))?.classGroupId},zc=/^\[(.+)\]$/,vw=t=>{if(zc.test(t)){const e=zc.exec(t)[1],n=e?.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},ww=t=>{const{theme:e,prefix:n}=t,r={nextPart:new Map,validators:[]};return xw(Object.entries(t.classGroups),n).forEach(([s,i])=>{ma(i,r,s,e)}),r},ma=(t,e,n,r)=>{t.forEach(o=>{if(typeof o=="string"){const s=o===""?e:Dc(e,o);s.classGroupId=n;return}if(typeof o=="function"){if(bw(o)){ma(o(r),e,n,r);return}e.validators.push({validator:o,classGroupId:n});return}Object.entries(o).forEach(([s,i])=>{ma(i,Dc(e,s),n,r)})})},Dc=(t,e)=>{let n=t;return e.split(ml).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},bw=t=>t.isThemeGetter,xw=(t,e)=>e?t.map(([n,r])=>{const o=r.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([i,a])=>[e+i,a])):s);return[n,o]}):t,_w=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,r=new Map;const o=(s,i)=>{n.set(s,i),e++,e>t&&(e=0,r=n,n=new Map)};return{get(s){let i=n.get(s);if(i!==void 0)return i;if((i=r.get(s))!==void 0)return o(s,i),i},set(s,i){n.has(s)?n.set(s,i):o(s,i)}}},Xh="!",Cw=t=>{const{separator:e,experimentalParseClassName:n}=t,r=e.length===1,o=e[0],s=e.length,i=a=>{const l=[];let c=0,u=0,d;for(let v=0;v<a.length;v++){let w=a[v];if(c===0){if(w===o&&(r||a.slice(v,v+s)===e)){l.push(a.slice(u,v)),u=v+s;continue}if(w==="/"){d=v;continue}}w==="["?c++:w==="]"&&c--}const f=l.length===0?a:a.substring(u),p=f.startsWith(Xh),g=p?f.substring(1):f,y=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:p,baseClassName:g,maybePostfixModifierPosition:y}};return n?a=>n({className:a,parseClassName:i}):i},Sw=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(r=>{r[0]==="["?(e.push(...n.sort(),r),n=[]):n.push(r)}),e.push(...n.sort()),e},kw=t=>({cache:_w(t.cacheSize),parseClassName:Cw(t),...yw(t)}),Pw=/\s+/,Ew=(t,e)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:o}=e,s=[],i=t.trim().split(Pw);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:d,baseClassName:f,maybePostfixModifierPosition:p}=n(c);let g=!!p,y=r(g?f.substring(0,p):f);if(!y){if(!g){a=c+(a.length>0?" "+a:a);continue}if(y=r(f),!y){a=c+(a.length>0?" "+a:a);continue}g=!1}const v=Sw(u).join(":"),w=d?v+Xh:v,_=w+y;if(s.includes(_))continue;s.push(_);const b=o(y,g);for(let x=0;x<b.length;++x){const S=b[x];s.push(w+S)}a=c+(a.length>0?" "+a:a)}return a};function Aw(){let t=0,e,n,r="";for(;t<arguments.length;)(e=arguments[t++])&&(n=Jh(e))&&(r&&(r+=" "),r+=n);return r}const Jh=t=>{if(typeof t=="string")return t;let e,n="";for(let r=0;r<t.length;r++)t[r]&&(e=Jh(t[r]))&&(n&&(n+=" "),n+=e);return n};function Tw(t,...e){let n,r,o,s=i;function i(l){const c=e.reduce((u,d)=>d(u),t());return n=kw(c),r=n.cache.get,o=n.cache.set,s=a,a(l)}function a(l){const c=r(l);if(c)return c;const u=Ew(l,n);return o(l,u),u}return function(){return s(Aw.apply(null,arguments))}}const ge=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},Yh=/^\[(?:([a-z-]+):)?(.+)\]$/i,Rw=/^\d+\/\d+$/,Ow=new Set(["px","full","screen"]),Iw=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,jw=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,$w=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Nw=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Mw=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,bt=t=>ar(t)||Ow.has(t)||Rw.test(t),$t=t=>Er(t,"length",Ww),ar=t=>!!t&&!Number.isNaN(Number(t)),gi=t=>Er(t,"number",ar),Nr=t=>!!t&&Number.isInteger(Number(t)),zw=t=>t.endsWith("%")&&ar(t.slice(0,-1)),te=t=>Yh.test(t),Nt=t=>Iw.test(t),Dw=new Set(["length","size","percentage"]),Lw=t=>Er(t,Dw,Zh),Bw=t=>Er(t,"position",Zh),Fw=new Set(["image","url"]),Uw=t=>Er(t,Fw,qw),Hw=t=>Er(t,"",Gw),Mr=()=>!0,Er=(t,e,n)=>{const r=Yh.exec(t);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):n(r[2]):!1},Ww=t=>jw.test(t)&&!$w.test(t),Zh=()=>!1,Gw=t=>Nw.test(t),qw=t=>Mw.test(t),Vw=()=>{const t=ge("colors"),e=ge("spacing"),n=ge("blur"),r=ge("brightness"),o=ge("borderColor"),s=ge("borderRadius"),i=ge("borderSpacing"),a=ge("borderWidth"),l=ge("contrast"),c=ge("grayscale"),u=ge("hueRotate"),d=ge("invert"),f=ge("gap"),p=ge("gradientColorStops"),g=ge("gradientColorStopPositions"),y=ge("inset"),v=ge("margin"),w=ge("opacity"),_=ge("padding"),b=ge("saturate"),x=ge("scale"),S=ge("sepia"),k=ge("skew"),C=ge("space"),M=ge("translate"),H=()=>["auto","contain","none"],L=()=>["auto","hidden","clip","visible","scroll"],X=()=>["auto",te,e],j=()=>[te,e],ee=()=>["",bt,$t],D=()=>["auto",ar,te],J=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Y=()=>["solid","dashed","dotted","double","none"],Z=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],F=()=>["start","end","center","between","around","evenly","stretch"],ae=()=>["","0",te],ve=()=>["auto","avoid","all","avoid-page","page","left","right","column"],me=()=>[ar,te];return{cacheSize:500,separator:":",theme:{colors:[Mr],spacing:[bt,$t],blur:["none","",Nt,te],brightness:me(),borderColor:[t],borderRadius:["none","","full",Nt,te],borderSpacing:j(),borderWidth:ee(),contrast:me(),grayscale:ae(),hueRotate:me(),invert:ae(),gap:j(),gradientColorStops:[t],gradientColorStopPositions:[zw,$t],inset:X(),margin:X(),opacity:me(),padding:j(),saturate:me(),scale:me(),sepia:ae(),skew:me(),space:j(),translate:j()},classGroups:{aspect:[{aspect:["auto","square","video",te]}],container:["container"],columns:[{columns:[Nt]}],"break-after":[{"break-after":ve()}],"break-before":[{"break-before":ve()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...J(),te]}],overflow:[{overflow:L()}],"overflow-x":[{"overflow-x":L()}],"overflow-y":[{"overflow-y":L()}],overscroll:[{overscroll:H()}],"overscroll-x":[{"overscroll-x":H()}],"overscroll-y":[{"overscroll-y":H()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[y]}],"inset-x":[{"inset-x":[y]}],"inset-y":[{"inset-y":[y]}],start:[{start:[y]}],end:[{end:[y]}],top:[{top:[y]}],right:[{right:[y]}],bottom:[{bottom:[y]}],left:[{left:[y]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Nr,te]}],basis:[{basis:X()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",te]}],grow:[{grow:ae()}],shrink:[{shrink:ae()}],order:[{order:["first","last","none",Nr,te]}],"grid-cols":[{"grid-cols":[Mr]}],"col-start-end":[{col:["auto",{span:["full",Nr,te]},te]}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":[Mr]}],"row-start-end":[{row:["auto",{span:[Nr,te]},te]}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",te]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",te]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...F()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...F(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...F(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[C]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[C]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",te,e]}],"min-w":[{"min-w":[te,e,"min","max","fit"]}],"max-w":[{"max-w":[te,e,"none","full","min","max","fit","prose",{screen:[Nt]},Nt]}],h:[{h:[te,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[te,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[te,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[te,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Nt,$t]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",gi]}],"font-family":[{font:[Mr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",te]}],"line-clamp":[{"line-clamp":["none",ar,gi]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",bt,te]}],"list-image":[{"list-image":["none",te]}],"list-style-type":[{list:["none","disc","decimal",te]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Y(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",bt,$t]}],"underline-offset":[{"underline-offset":["auto",bt,te]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:j()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",te]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",te]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...J(),Bw]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Lw]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Uw]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[g]}],"gradient-via-pos":[{via:[g]}],"gradient-to-pos":[{to:[g]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[...Y(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:Y()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...Y()]}],"outline-offset":[{"outline-offset":[bt,te]}],"outline-w":[{outline:[bt,$t]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:ee()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[bt,$t]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Nt,Hw]}],"shadow-color":[{shadow:[Mr]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":[...Z(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Z()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Nt,te]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[b]}],sepia:[{sepia:[S]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[S]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",te]}],duration:[{duration:me()}],ease:[{ease:["linear","in","out","in-out",te]}],delay:[{delay:me()}],animate:[{animate:["none","spin","ping","pulse","bounce",te]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[x]}],"scale-x":[{"scale-x":[x]}],"scale-y":[{"scale-y":[x]}],rotate:[{rotate:[Nr,te]}],"translate-x":[{"translate-x":[M]}],"translate-y":[{"translate-y":[M]}],"skew-x":[{"skew-x":[k]}],"skew-y":[{"skew-y":[k]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",te]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",te]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":j()}],"scroll-mx":[{"scroll-mx":j()}],"scroll-my":[{"scroll-my":j()}],"scroll-ms":[{"scroll-ms":j()}],"scroll-me":[{"scroll-me":j()}],"scroll-mt":[{"scroll-mt":j()}],"scroll-mr":[{"scroll-mr":j()}],"scroll-mb":[{"scroll-mb":j()}],"scroll-ml":[{"scroll-ml":j()}],"scroll-p":[{"scroll-p":j()}],"scroll-px":[{"scroll-px":j()}],"scroll-py":[{"scroll-py":j()}],"scroll-ps":[{"scroll-ps":j()}],"scroll-pe":[{"scroll-pe":j()}],"scroll-pt":[{"scroll-pt":j()}],"scroll-pr":[{"scroll-pr":j()}],"scroll-pb":[{"scroll-pb":j()}],"scroll-pl":[{"scroll-pl":j()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",te]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[bt,$t,gi]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},gl=Tw(Vw);function Qh(t){if(!ps(t))throw new Error(`Invalid textureId: "${t}"; textureId ∋ {${Object.keys(An.frames).sort().map(e=>`"${e}"`).join(`,
`)}}`)}function ps(t){return An.frames[t]!==void 0}function ef(t){return An.animations[t]!==void 0}const Kw=({className:t,children:e})=>t?h.jsx("div",{className:`contents ${t}`,children:e}):e,Xw=t=>t.replaceAll(/(?<!\.)\./g,"_"),I=({children:t,className:e,noSlitWords:n,classnameCycle:r,onClick:o,noTint:s=!1,TagName:i="span"})=>{const a=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(a.length===0)return null;const l=n?[a.toUpperCase()]:a.toUpperCase().split(/\s+/);return h.jsxs(i,{className:e,onClick:o,children:[h.jsx("span",{className:"sr-only",children:a}),l.map((c,u)=>h.jsx("span",{className:gl("text-nowrap inline-block",u===l.length-1?"":"me-1"),children:Array.from(c).map((d,f)=>{const p=`hud.char.${ih(d)}`;return ps(p)||console.error("no texture for char",d,d.charCodeAt(0),p,"we have:",Object.keys(qt().textures)),h.jsx("span",{className:`sprite ${ps(p)?`texture-${Xw(p)}`:"texture-hud_char_?"}
                  ${s?"":"sprite-tinted"}
                  ${r===void 0?"":r[f%r.length]}`},f)})},u))]})},Jw=t=>t.props.children!==void 0,tt=({children:t,className:e})=>h.jsx(Kw,{className:e,children:Array.isArray(t)?t.map((n,r)=>h.jsx(tt,{children:n},r)):typeof t=="number"?h.jsx(I,{children:String(t)}):typeof t=="string"?h.jsx(I,{children:t}):m.isValidElement(t)?t.type===I||t.type===tt?t:Jw(t)?m.cloneElement(t,void 0,typeof t.props.children=="string"?h.jsx(I,{children:`${t.props.children}`}):h.jsx(tt,{children:t.props.children})):t:t});function Ke(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t?.(o),n===!1||!o.defaultPrevented)return e?.(o)}}function Lc(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function tf(...t){return e=>{let n=!1;const r=t.map(o=>{const s=Lc(o,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():Lc(t[o],null)}}}}function at(...t){return m.useCallback(tf(...t),t)}function Yw(t,e){const n=m.createContext(e),r=s=>{const{children:i,...a}=s,l=m.useMemo(()=>a,Object.values(a));return h.jsx(n.Provider,{value:l,children:i})};r.displayName=t+"Provider";function o(s){const i=m.useContext(n);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[r,o]}function yl(t,e=[]){let n=[];function r(s,i){const a=m.createContext(i),l=n.length;n=[...n,i];const c=d=>{const{scope:f,children:p,...g}=d,y=f?.[t]?.[l]||a,v=m.useMemo(()=>g,Object.values(g));return h.jsx(y.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(d,f){const p=f?.[t]?.[l]||a,g=m.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=n.map(i=>m.createContext(i));return function(a){const l=a?.[t]||s;return m.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[r,Zw(o,...e)]}function Zw(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}var Is=ry();const nf=Ot(Is);var js=m.forwardRef((t,e)=>{const{children:n,...r}=t,o=m.Children.toArray(n),s=o.find(eb);if(s){const i=s.props.children,a=o.map(l=>l===s?m.Children.count(i)>1?m.Children.only(null):m.isValidElement(i)?i.props.children:null:l);return h.jsx(ga,{...r,ref:e,children:m.isValidElement(i)?m.cloneElement(i,void 0,a):null})}return h.jsx(ga,{...r,ref:e,children:n})});js.displayName="Slot";var ga=m.forwardRef((t,e)=>{const{children:n,...r}=t;if(m.isValidElement(n)){const o=nb(n),s=tb(r,n.props);return n.type!==m.Fragment&&(s.ref=e?tf(e,o):o),m.cloneElement(n,s)}return m.Children.count(n)>1?m.Children.only(null):null});ga.displayName="SlotClone";var Qw=({children:t})=>h.jsx(h.Fragment,{children:t});function eb(t){return m.isValidElement(t)&&t.type===Qw}function tb(t,e){const n={...e};for(const r in e){const o=t[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{s(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...t,...n}}function nb(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var rb=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],be=rb.reduce((t,e)=>{const n=m.forwardRef((r,o)=>{const{asChild:s,...i}=r,a=s?js:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(a,{...i,ref:o})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function ob(t,e){t&&Is.flushSync(()=>t.dispatchEvent(e))}function Xt(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t}),m.useMemo(()=>(...n)=>e.current?.(...n),[])}function sb(t,e=globalThis?.document){const n=Xt(t);m.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var ib="DismissableLayer",ya="dismissableLayer.update",ab="dismissableLayer.pointerDownOutside",lb="dismissableLayer.focusOutside",Bc,rf=m.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),vl=m.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=m.useContext(rf),[u,d]=m.useState(null),f=u?.ownerDocument??globalThis?.document,[,p]=m.useState({}),g=at(e,C=>d(C)),y=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),w=y.indexOf(v),_=u?y.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,x=_>=w,S=db(C=>{const M=C.target,H=[...c.branches].some(L=>L.contains(M));!x||H||(o?.(C),i?.(C),C.defaultPrevented||a?.())},f),k=hb(C=>{const M=C.target;[...c.branches].some(L=>L.contains(M))||(s?.(C),i?.(C),C.defaultPrevented||a?.())},f);return sb(C=>{_===c.layers.size-1&&(r?.(C),!C.defaultPrevented&&a&&(C.preventDefault(),a()))},f),m.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Bc=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),Fc(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=Bc)}},[u,f,n,c]),m.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),Fc())},[u,c]),m.useEffect(()=>{const C=()=>p({});return document.addEventListener(ya,C),()=>document.removeEventListener(ya,C)},[]),h.jsx(be.div,{...l,ref:g,style:{pointerEvents:b?x?"auto":"none":void 0,...t.style},onFocusCapture:Ke(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Ke(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Ke(t.onPointerDownCapture,S.onPointerDownCapture)})});vl.displayName=ib;var cb="DismissableLayerBranch",ub=m.forwardRef((t,e)=>{const n=m.useContext(rf),r=m.useRef(null),o=at(e,r);return m.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),h.jsx(be.div,{...t,ref:o})});ub.displayName=cb;function db(t,e=globalThis?.document){const n=Xt(t),r=m.useRef(!1),o=m.useRef(()=>{});return m.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){of(ab,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function hb(t,e=globalThis?.document){const n=Xt(t),r=m.useRef(!1);return m.useEffect(()=>{const o=s=>{s.target&&!r.current&&of(lb,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Fc(){const t=new CustomEvent(ya);document.dispatchEvent(t)}function of(t,e,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?ob(o,s):o.dispatchEvent(s)}var yi=0;function sf(){m.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Uc()),document.body.insertAdjacentElement("beforeend",t[1]??Uc()),yi++,()=>{yi===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),yi--}},[])}function Uc(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var vi="focusScope.autoFocusOnMount",wi="focusScope.autoFocusOnUnmount",Hc={bubbles:!1,cancelable:!0},fb="FocusScope",wl=m.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=t,[a,l]=m.useState(null),c=Xt(o),u=Xt(s),d=m.useRef(null),f=at(e,y=>l(y)),p=m.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;m.useEffect(()=>{if(r){let y=function(b){if(p.paused||!a)return;const x=b.target;a.contains(x)?d.current=x:Lt(d.current,{select:!0})},v=function(b){if(p.paused||!a)return;const x=b.relatedTarget;x!==null&&(a.contains(x)||Lt(d.current,{select:!0}))},w=function(b){if(document.activeElement===document.body)for(const S of b)S.removedNodes.length>0&&Lt(a)};document.addEventListener("focusin",y),document.addEventListener("focusout",v);const _=new MutationObserver(w);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",v),_.disconnect()}}},[r,a,p.paused]),m.useEffect(()=>{if(a){Gc.add(p);const y=document.activeElement;if(!a.contains(y)){const w=new CustomEvent(vi,Hc);a.addEventListener(vi,c),a.dispatchEvent(w),w.defaultPrevented||(pb(wb(af(a)),{select:!0}),document.activeElement===y&&Lt(a))}return()=>{a.removeEventListener(vi,c),setTimeout(()=>{const w=new CustomEvent(wi,Hc);a.addEventListener(wi,u),a.dispatchEvent(w),w.defaultPrevented||Lt(y??document.body,{select:!0}),a.removeEventListener(wi,u),Gc.remove(p)},0)}}},[a,c,u,p]);const g=m.useCallback(y=>{if(!n&&!r||p.paused)return;const v=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,w=document.activeElement;if(v&&w){const _=y.currentTarget,[b,x]=mb(_);b&&x?!y.shiftKey&&w===x?(y.preventDefault(),n&&Lt(b,{select:!0})):y.shiftKey&&w===b&&(y.preventDefault(),n&&Lt(x,{select:!0})):w===_&&y.preventDefault()}},[n,r,p.paused]);return h.jsx(be.div,{tabIndex:-1,...i,ref:f,onKeyDown:g})});wl.displayName=fb;function pb(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(Lt(r,{select:e}),document.activeElement!==n)return}function mb(t){const e=af(t),n=Wc(e,t),r=Wc(e.reverse(),t);return[n,r]}function af(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Wc(t,e){for(const n of t)if(!gb(n,{upTo:e}))return n}function gb(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function yb(t){return t instanceof HTMLInputElement&&"select"in t}function Lt(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&yb(t)&&e&&t.select()}}var Gc=vb();function vb(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=qc(t,e),t.unshift(e)},remove(e){t=qc(t,e),t[0]?.resume()}}}function qc(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function wb(t){return t.filter(e=>e.tagName!=="A")}var wn=globalThis?.document?m.useLayoutEffect:()=>{},bb=Es.useId||(()=>{}),xb=0;function ft(t){const[e,n]=m.useState(bb());return wn(()=>{n(r=>r??String(xb++))},[t]),t||(e?`radix-${e}`:"")}const _b=["top","right","bottom","left"],Jt=Math.min,Ve=Math.max,ms=Math.round,jo=Math.floor,pt=t=>({x:t,y:t}),Cb={left:"right",right:"left",bottom:"top",top:"bottom"},Sb={start:"end",end:"start"};function va(t,e,n){return Ve(t,Jt(e,n))}function Tt(t,e){return typeof t=="function"?t(e):t}function Rt(t){return t.split("-")[0]}function Ar(t){return t.split("-")[1]}function bl(t){return t==="x"?"y":"x"}function xl(t){return t==="y"?"height":"width"}function Yt(t){return["top","bottom"].includes(Rt(t))?"y":"x"}function _l(t){return bl(Yt(t))}function kb(t,e,n){n===void 0&&(n=!1);const r=Ar(t),o=_l(t),s=xl(o);let i=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(i=gs(i)),[i,gs(i)]}function Pb(t){const e=gs(t);return[wa(t),e,wa(e)]}function wa(t){return t.replace(/start|end/g,e=>Sb[e])}function Eb(t,e,n){const r=["left","right"],o=["right","left"],s=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return n?e?o:r:e?r:o;case"left":case"right":return e?s:i;default:return[]}}function Ab(t,e,n,r){const o=Ar(t);let s=Eb(Rt(t),n==="start",r);return o&&(s=s.map(i=>i+"-"+o),e&&(s=s.concat(s.map(wa)))),s}function gs(t){return t.replace(/left|right|bottom|top/g,e=>Cb[e])}function Tb(t){return{top:0,right:0,bottom:0,left:0,...t}}function lf(t){return typeof t!="number"?Tb(t):{top:t,right:t,bottom:t,left:t}}function ys(t){const{x:e,y:n,width:r,height:o}=t;return{width:r,height:o,top:n,left:e,right:e+r,bottom:n+o,x:e,y:n}}function Vc(t,e,n){let{reference:r,floating:o}=t;const s=Yt(e),i=_l(e),a=xl(i),l=Rt(e),c=s==="y",u=r.x+r.width/2-o.width/2,d=r.y+r.height/2-o.height/2,f=r[a]/2-o[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-o.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-o.width,y:d};break;default:p={x:r.x,y:r.y}}switch(Ar(e)){case"start":p[i]-=f*(n&&c?-1:1);break;case"end":p[i]+=f*(n&&c?-1:1);break}return p}const Rb=async(t,e,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:s=[],platform:i}=n,a=s.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:o}),{x:u,y:d}=Vc(c,r,l),f=r,p={},g=0;for(let y=0;y<a.length;y++){const{name:v,fn:w}=a[y],{x:_,y:b,data:x,reset:S}=await w({x:u,y:d,initialPlacement:r,placement:f,strategy:o,middlewareData:p,rects:c,platform:i,elements:{reference:t,floating:e}});u=_??u,d=b??d,p={...p,[v]:{...p[v],...x}},S&&g<=50&&(g++,typeof S=="object"&&(S.placement&&(f=S.placement),S.rects&&(c=S.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:o}):S.rects),{x:u,y:d}=Vc(c,f,l)),y=-1)}return{x:u,y:d,placement:f,strategy:o,middlewareData:p}};async function ro(t,e){var n;e===void 0&&(e={});const{x:r,y:o,platform:s,rects:i,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:p=0}=Tt(e,t),g=lf(p),v=a[f?d==="floating"?"reference":"floating":d],w=ys(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(v)))==null||n?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),_=d==="floating"?{x:r,y:o,width:i.floating.width,height:i.floating.height}:i.reference,b=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),x=await(s.isElement==null?void 0:s.isElement(b))?await(s.getScale==null?void 0:s.getScale(b))||{x:1,y:1}:{x:1,y:1},S=ys(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:b,strategy:l}):_);return{top:(w.top-S.top+g.top)/x.y,bottom:(S.bottom-w.bottom+g.bottom)/x.y,left:(w.left-S.left+g.left)/x.x,right:(S.right-w.right+g.right)/x.x}}const Ob=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:o,rects:s,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Tt(t,e)||{};if(c==null)return{};const d=lf(u),f={x:n,y:r},p=_l(o),g=xl(p),y=await i.getDimensions(c),v=p==="y",w=v?"top":"left",_=v?"bottom":"right",b=v?"clientHeight":"clientWidth",x=s.reference[g]+s.reference[p]-f[p]-s.floating[g],S=f[p]-s.reference[p],k=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let C=k?k[b]:0;(!C||!await(i.isElement==null?void 0:i.isElement(k)))&&(C=a.floating[b]||s.floating[g]);const M=x/2-S/2,H=C/2-y[g]/2-1,L=Jt(d[w],H),X=Jt(d[_],H),j=L,ee=C-y[g]-X,D=C/2-y[g]/2+M,J=va(j,D,ee),Y=!l.arrow&&Ar(o)!=null&&D!==J&&s.reference[g]/2-(D<j?L:X)-y[g]/2<0,Z=Y?D<j?D-j:D-ee:0;return{[p]:f[p]+Z,data:{[p]:J,centerOffset:D-J-Z,...Y&&{alignmentOffset:Z}},reset:Y}}}),Ib=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:y=!0,...v}=Tt(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const w=Rt(o),_=Yt(a),b=Rt(a)===a,x=await(l.isRTL==null?void 0:l.isRTL(c.floating)),S=f||(b||!y?[gs(a)]:Pb(a)),k=g!=="none";!f&&k&&S.push(...Ab(a,y,g,x));const C=[a,...S],M=await ro(e,v),H=[];let L=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&H.push(M[w]),d){const D=kb(o,i,x);H.push(M[D[0]],M[D[1]])}if(L=[...L,{placement:o,overflows:H}],!H.every(D=>D<=0)){var X,j;const D=(((X=s.flip)==null?void 0:X.index)||0)+1,J=C[D];if(J)return{data:{index:D,overflows:L},reset:{placement:J}};let Y=(j=L.filter(Z=>Z.overflows[0]<=0).sort((Z,F)=>Z.overflows[1]-F.overflows[1])[0])==null?void 0:j.placement;if(!Y)switch(p){case"bestFit":{var ee;const Z=(ee=L.filter(F=>{if(k){const ae=Yt(F.placement);return ae===_||ae==="y"}return!0}).map(F=>[F.placement,F.overflows.filter(ae=>ae>0).reduce((ae,ve)=>ae+ve,0)]).sort((F,ae)=>F[1]-ae[1])[0])==null?void 0:ee[0];Z&&(Y=Z);break}case"initialPlacement":Y=a;break}if(o!==Y)return{reset:{placement:Y}}}return{}}}};function Kc(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Xc(t){return _b.some(e=>t[e]>=0)}const jb=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...o}=Tt(t,e);switch(r){case"referenceHidden":{const s=await ro(e,{...o,elementContext:"reference"}),i=Kc(s,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:Xc(i)}}}case"escaped":{const s=await ro(e,{...o,altBoundary:!0}),i=Kc(s,n.floating);return{data:{escapedOffsets:i,escaped:Xc(i)}}}default:return{}}}}};async function $b(t,e){const{placement:n,platform:r,elements:o}=t,s=await(r.isRTL==null?void 0:r.isRTL(o.floating)),i=Rt(n),a=Ar(n),l=Yt(n)==="y",c=["left","top"].includes(i)?-1:1,u=s&&l?-1:1,d=Tt(e,t);let{mainAxis:f,crossAxis:p,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(p=a==="end"?g*-1:g),l?{x:p*u,y:f*c}:{x:f*c,y:p*u}}const Nb=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:o,y:s,placement:i,middlewareData:a}=e,l=await $b(e,t);return i===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:o+l.x,y:s+l.y,data:{...l,placement:i}}}}},Mb=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:o}=e,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:v=>{let{x:w,y:_}=v;return{x:w,y:_}}},...l}=Tt(t,e),c={x:n,y:r},u=await ro(e,l),d=Yt(Rt(o)),f=bl(d);let p=c[f],g=c[d];if(s){const v=f==="y"?"top":"left",w=f==="y"?"bottom":"right",_=p+u[v],b=p-u[w];p=va(_,p,b)}if(i){const v=d==="y"?"top":"left",w=d==="y"?"bottom":"right",_=g+u[v],b=g-u[w];g=va(_,g,b)}const y=a.fn({...e,[f]:p,[d]:g});return{...y,data:{x:y.x-n,y:y.y-r,enabled:{[f]:s,[d]:i}}}}}},zb=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:o,rects:s,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Tt(t,e),u={x:n,y:r},d=Yt(o),f=bl(d);let p=u[f],g=u[d];const y=Tt(a,e),v=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(l){const b=f==="y"?"height":"width",x=s.reference[f]-s.floating[b]+v.mainAxis,S=s.reference[f]+s.reference[b]-v.mainAxis;p<x?p=x:p>S&&(p=S)}if(c){var w,_;const b=f==="y"?"width":"height",x=["top","left"].includes(Rt(o)),S=s.reference[d]-s.floating[b]+(x&&((w=i.offset)==null?void 0:w[d])||0)+(x?0:v.crossAxis),k=s.reference[d]+s.reference[b]+(x?0:((_=i.offset)==null?void 0:_[d])||0)-(x?v.crossAxis:0);g<S?g=S:g>k&&(g=k)}return{[f]:p,[d]:g}}}},Db=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:o,rects:s,platform:i,elements:a}=e,{apply:l=()=>{},...c}=Tt(t,e),u=await ro(e,c),d=Rt(o),f=Ar(o),p=Yt(o)==="y",{width:g,height:y}=s.floating;let v,w;d==="top"||d==="bottom"?(v=d,w=f===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(w=d,v=f==="end"?"top":"bottom");const _=y-u.top-u.bottom,b=g-u.left-u.right,x=Jt(y-u[v],_),S=Jt(g-u[w],b),k=!e.middlewareData.shift;let C=x,M=S;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(M=b),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(C=_),k&&!f){const L=Ve(u.left,0),X=Ve(u.right,0),j=Ve(u.top,0),ee=Ve(u.bottom,0);p?M=g-2*(L!==0||X!==0?L+X:Ve(u.left,u.right)):C=y-2*(j!==0||ee!==0?j+ee:Ve(u.top,u.bottom))}await l({...e,availableWidth:M,availableHeight:C});const H=await i.getDimensions(a.floating);return g!==H.width||y!==H.height?{reset:{rects:!0}}:{}}}};function $s(){return typeof window<"u"}function Tr(t){return cf(t)?(t.nodeName||"").toLowerCase():"#document"}function Xe(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function wt(t){var e;return(e=(cf(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function cf(t){return $s()?t instanceof Node||t instanceof Xe(t).Node:!1}function st(t){return $s()?t instanceof Element||t instanceof Xe(t).Element:!1}function mt(t){return $s()?t instanceof HTMLElement||t instanceof Xe(t).HTMLElement:!1}function Jc(t){return!$s()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Xe(t).ShadowRoot}function po(t){const{overflow:e,overflowX:n,overflowY:r,display:o}=it(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(o)}function Lb(t){return["table","td","th"].includes(Tr(t))}function Ns(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function Cl(t){const e=Sl(),n=st(t)?it(t):t;return["transform","translate","scale","rotate","perspective"].some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function Bb(t){let e=Zt(t);for(;mt(e)&&!gr(e);){if(Cl(e))return e;if(Ns(e))return null;e=Zt(e)}return null}function Sl(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function gr(t){return["html","body","#document"].includes(Tr(t))}function it(t){return Xe(t).getComputedStyle(t)}function Ms(t){return st(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Zt(t){if(Tr(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Jc(t)&&t.host||wt(t);return Jc(e)?e.host:e}function uf(t){const e=Zt(t);return gr(e)?t.ownerDocument?t.ownerDocument.body:t.body:mt(e)&&po(e)?e:uf(e)}function oo(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const o=uf(t),s=o===((r=t.ownerDocument)==null?void 0:r.body),i=Xe(o);if(s){const a=ba(i);return e.concat(i,i.visualViewport||[],po(o)?o:[],a&&n?oo(a):[])}return e.concat(o,oo(o,[],n))}function ba(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function df(t){const e=it(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=mt(t),s=o?t.offsetWidth:n,i=o?t.offsetHeight:r,a=ms(n)!==s||ms(r)!==i;return a&&(n=s,r=i),{width:n,height:r,$:a}}function kl(t){return st(t)?t:t.contextElement}function lr(t){const e=kl(t);if(!mt(e))return pt(1);const n=e.getBoundingClientRect(),{width:r,height:o,$:s}=df(e);let i=(s?ms(n.width):n.width)/r,a=(s?ms(n.height):n.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const Fb=pt(0);function hf(t){const e=Xe(t);return!Sl()||!e.visualViewport?Fb:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Ub(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Xe(t)?!1:e}function bn(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const o=t.getBoundingClientRect(),s=kl(t);let i=pt(1);e&&(r?st(r)&&(i=lr(r)):i=lr(t));const a=Ub(s,n,r)?hf(s):pt(0);let l=(o.left+a.x)/i.x,c=(o.top+a.y)/i.y,u=o.width/i.x,d=o.height/i.y;if(s){const f=Xe(s),p=r&&st(r)?Xe(r):r;let g=f,y=ba(g);for(;y&&r&&p!==g;){const v=lr(y),w=y.getBoundingClientRect(),_=it(y),b=w.left+(y.clientLeft+parseFloat(_.paddingLeft))*v.x,x=w.top+(y.clientTop+parseFloat(_.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,d*=v.y,l+=b,c+=x,g=Xe(y),y=ba(g)}}return ys({width:u,height:d,x:l,y:c})}function Pl(t,e){const n=Ms(t).scrollLeft;return e?e.left+n:bn(wt(t)).left+n}function ff(t,e,n){n===void 0&&(n=!1);const r=t.getBoundingClientRect(),o=r.left+e.scrollLeft-(n?0:Pl(t,r)),s=r.top+e.scrollTop;return{x:o,y:s}}function Hb(t){let{elements:e,rect:n,offsetParent:r,strategy:o}=t;const s=o==="fixed",i=wt(r),a=e?Ns(e.floating):!1;if(r===i||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=pt(1);const u=pt(0),d=mt(r);if((d||!d&&!s)&&((Tr(r)!=="body"||po(i))&&(l=Ms(r)),mt(r))){const p=bn(r);c=lr(r),u.x=p.x+r.clientLeft,u.y=p.y+r.clientTop}const f=i&&!d&&!s?ff(i,l,!0):pt(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:n.y*c.y-l.scrollTop*c.y+u.y+f.y}}function Wb(t){return Array.from(t.getClientRects())}function Gb(t){const e=wt(t),n=Ms(t),r=t.ownerDocument.body,o=Ve(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Ve(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let i=-n.scrollLeft+Pl(t);const a=-n.scrollTop;return it(r).direction==="rtl"&&(i+=Ve(e.clientWidth,r.clientWidth)-o),{width:o,height:s,x:i,y:a}}function qb(t,e){const n=Xe(t),r=wt(t),o=n.visualViewport;let s=r.clientWidth,i=r.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;const c=Sl();(!c||c&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:s,height:i,x:a,y:l}}function Vb(t,e){const n=bn(t,!0,e==="fixed"),r=n.top+t.clientTop,o=n.left+t.clientLeft,s=mt(t)?lr(t):pt(1),i=t.clientWidth*s.x,a=t.clientHeight*s.y,l=o*s.x,c=r*s.y;return{width:i,height:a,x:l,y:c}}function Yc(t,e,n){let r;if(e==="viewport")r=qb(t,n);else if(e==="document")r=Gb(wt(t));else if(st(e))r=Vb(e,n);else{const o=hf(t);r={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return ys(r)}function pf(t,e){const n=Zt(t);return n===e||!st(n)||gr(n)?!1:it(n).position==="fixed"||pf(n,e)}function Kb(t,e){const n=e.get(t);if(n)return n;let r=oo(t,[],!1).filter(a=>st(a)&&Tr(a)!=="body"),o=null;const s=it(t).position==="fixed";let i=s?Zt(t):t;for(;st(i)&&!gr(i);){const a=it(i),l=Cl(i);!l&&a.position==="fixed"&&(o=null),(s?!l&&!o:!l&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||po(i)&&!l&&pf(t,i))?r=r.filter(u=>u!==i):o=a,i=Zt(i)}return e.set(t,r),r}function Xb(t){let{element:e,boundary:n,rootBoundary:r,strategy:o}=t;const i=[...n==="clippingAncestors"?Ns(e)?[]:Kb(e,this._c):[].concat(n),r],a=i[0],l=i.reduce((c,u)=>{const d=Yc(e,u,o);return c.top=Ve(d.top,c.top),c.right=Jt(d.right,c.right),c.bottom=Jt(d.bottom,c.bottom),c.left=Ve(d.left,c.left),c},Yc(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Jb(t){const{width:e,height:n}=df(t);return{width:e,height:n}}function Yb(t,e,n){const r=mt(e),o=wt(e),s=n==="fixed",i=bn(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=pt(0);if(r||!r&&!s)if((Tr(e)!=="body"||po(o))&&(a=Ms(e)),r){const f=bn(e,!0,s,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else o&&(l.x=Pl(o));const c=o&&!r&&!s?ff(o,a):pt(0),u=i.left+a.scrollLeft-l.x-c.x,d=i.top+a.scrollTop-l.y-c.y;return{x:u,y:d,width:i.width,height:i.height}}function bi(t){return it(t).position==="static"}function Zc(t,e){if(!mt(t)||it(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return wt(t)===n&&(n=n.ownerDocument.body),n}function mf(t,e){const n=Xe(t);if(Ns(t))return n;if(!mt(t)){let o=Zt(t);for(;o&&!gr(o);){if(st(o)&&!bi(o))return o;o=Zt(o)}return n}let r=Zc(t,e);for(;r&&Lb(r)&&bi(r);)r=Zc(r,e);return r&&gr(r)&&bi(r)&&!Cl(r)?n:r||Bb(t)||n}const Zb=async function(t){const e=this.getOffsetParent||mf,n=this.getDimensions,r=await n(t.floating);return{reference:Yb(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Qb(t){return it(t).direction==="rtl"}const ex={convertOffsetParentRelativeRectToViewportRelativeRect:Hb,getDocumentElement:wt,getClippingRect:Xb,getOffsetParent:mf,getElementRects:Zb,getClientRects:Wb,getDimensions:Jb,getScale:lr,isElement:st,isRTL:Qb};function gf(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function tx(t,e){let n=null,r;const o=wt(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:f,height:p}=c;if(a||e(),!f||!p)return;const g=jo(d),y=jo(o.clientWidth-(u+f)),v=jo(o.clientHeight-(d+p)),w=jo(u),b={rootMargin:-g+"px "+-y+"px "+-v+"px "+-w+"px",threshold:Ve(0,Jt(1,l))||1};let x=!0;function S(k){const C=k[0].intersectionRatio;if(C!==l){if(!x)return i();C?i(!1,C):r=setTimeout(()=>{i(!1,1e-7)},1e3)}C===1&&!gf(c,t.getBoundingClientRect())&&i(),x=!1}try{n=new IntersectionObserver(S,{...b,root:o.ownerDocument})}catch{n=new IntersectionObserver(S,b)}n.observe(t)}return i(!0),s}function yf(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=kl(t),u=o||s?[...c?oo(c):[],...oo(e)]:[];u.forEach(w=>{o&&w.addEventListener("scroll",n,{passive:!0}),s&&w.addEventListener("resize",n)});const d=c&&a?tx(c,n):null;let f=-1,p=null;i&&(p=new ResizeObserver(w=>{let[_]=w;_&&_.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var b;(b=p)==null||b.observe(e)})),n()}),c&&!l&&p.observe(c),p.observe(e));let g,y=l?bn(t):null;l&&v();function v(){const w=bn(t);y&&!gf(y,w)&&n(),y=w,g=requestAnimationFrame(v)}return n(),()=>{var w;u.forEach(_=>{o&&_.removeEventListener("scroll",n),s&&_.removeEventListener("resize",n)}),d?.(),(w=p)==null||w.disconnect(),p=null,l&&cancelAnimationFrame(g)}}const nx=Nb,rx=Mb,ox=Ib,sx=Db,ix=jb,Qc=Ob,ax=zb,lx=(t,e,n)=>{const r=new Map,o={platform:ex,...n},s={...o.platform,_c:r};return Rb(t,e,{...o,platform:s})};var Qo=typeof document<"u"?m.useLayoutEffect:m.useEffect;function vs(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!vs(t[r],e[r]))return!1;return!0}if(o=Object.keys(t),n=o.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,o[r]))return!1;for(r=n;r--!==0;){const s=o[r];if(!(s==="_owner"&&t.$$typeof)&&!vs(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function vf(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function eu(t,e){const n=vf(t);return Math.round(e*n)/n}function xi(t){const e=m.useRef(t);return Qo(()=>{e.current=t}),e}function wf(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=m.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[f,p]=m.useState(r);vs(f,r)||p(r);const[g,y]=m.useState(null),[v,w]=m.useState(null),_=m.useCallback(F=>{F!==k.current&&(k.current=F,y(F))},[]),b=m.useCallback(F=>{F!==C.current&&(C.current=F,w(F))},[]),x=s||g,S=i||v,k=m.useRef(null),C=m.useRef(null),M=m.useRef(u),H=l!=null,L=xi(l),X=xi(o),j=xi(c),ee=m.useCallback(()=>{if(!k.current||!C.current)return;const F={placement:e,strategy:n,middleware:f};X.current&&(F.platform=X.current),lx(k.current,C.current,F).then(ae=>{const ve={...ae,isPositioned:j.current!==!1};D.current&&!vs(M.current,ve)&&(M.current=ve,Is.flushSync(()=>{d(ve)}))})},[f,e,n,X,j]);Qo(()=>{c===!1&&M.current.isPositioned&&(M.current.isPositioned=!1,d(F=>({...F,isPositioned:!1})))},[c]);const D=m.useRef(!1);Qo(()=>(D.current=!0,()=>{D.current=!1}),[]),Qo(()=>{if(x&&(k.current=x),S&&(C.current=S),x&&S){if(L.current)return L.current(x,S,ee);ee()}},[x,S,ee,L,H]);const J=m.useMemo(()=>({reference:k,floating:C,setReference:_,setFloating:b}),[_,b]),Y=m.useMemo(()=>({reference:x,floating:S}),[x,S]),Z=m.useMemo(()=>{const F={position:n,left:0,top:0};if(!Y.floating)return F;const ae=eu(Y.floating,u.x),ve=eu(Y.floating,u.y);return a?{...F,transform:"translate("+ae+"px, "+ve+"px)",...vf(Y.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:ae,top:ve}},[n,a,Y.floating,u.x,u.y]);return m.useMemo(()=>({...u,update:ee,refs:J,elements:Y,floatingStyles:Z}),[u,ee,J,Y,Z])}const cx=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:o}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?Qc({element:r.current,padding:o}).fn(n):{}:r?Qc({element:r,padding:o}).fn(n):{}}}},bf=(t,e)=>({...nx(t),options:[t,e]}),xf=(t,e)=>({...rx(t),options:[t,e]}),_f=(t,e)=>({...ax(t),options:[t,e]}),Cf=(t,e)=>({...ox(t),options:[t,e]}),Sf=(t,e)=>({...sx(t),options:[t,e]}),kf=(t,e)=>({...ix(t),options:[t,e]}),Pf=(t,e)=>({...cx(t),options:[t,e]});var ux="Arrow",Ef=m.forwardRef((t,e)=>{const{children:n,width:r=10,height:o=5,...s}=t;return h.jsx(be.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});Ef.displayName=ux;var dx=Ef;function hx(t){const[e,n]=m.useState(void 0);return wn(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var El="Popper",[Af,Tf]=yl(El),[fx,Rf]=Af(El),Of=t=>{const{__scopePopper:e,children:n}=t,[r,o]=m.useState(null);return h.jsx(fx,{scope:e,anchor:r,onAnchorChange:o,children:n})};Of.displayName=El;var If="PopperAnchor",jf=m.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,s=Rf(If,n),i=m.useRef(null),a=at(e,i);return m.useEffect(()=>{s.onAnchorChange(r?.current||i.current)}),r?null:h.jsx(be.div,{...o,ref:a})});jf.displayName=If;var Al="PopperContent",[px,mx]=Af(Al),$f=m.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:p="optimized",onPlaced:g,...y}=t,v=Rf(Al,n),[w,_]=m.useState(null),b=at(e,T=>_(T)),[x,S]=m.useState(null),k=hx(x),C=k?.width??0,M=k?.height??0,H=r+(s!=="center"?"-"+s:""),L=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},X=Array.isArray(c)?c:[c],j=X.length>0,ee={padding:L,boundary:X.filter(yx),altBoundary:j},{refs:D,floatingStyles:J,placement:Y,isPositioned:Z,middlewareData:F}=wf({strategy:"fixed",placement:H,whileElementsMounted:(...T)=>yf(...T,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[bf({mainAxis:o+M,alignmentAxis:i}),l&&xf({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?_f():void 0,...ee}),l&&Cf({...ee}),Sf({...ee,apply:({elements:T,rects:z,availableWidth:oe,availableHeight:ue})=>{const{width:Ne,height:Me}=z.reference,ce=T.floating.style;ce.setProperty("--radix-popper-available-width",`${oe}px`),ce.setProperty("--radix-popper-available-height",`${ue}px`),ce.setProperty("--radix-popper-anchor-width",`${Ne}px`),ce.setProperty("--radix-popper-anchor-height",`${Me}px`)}}),x&&Pf({element:x,padding:a}),vx({arrowWidth:C,arrowHeight:M}),f&&kf({strategy:"referenceHidden",...ee})]}),[ae,ve]=zf(Y),me=Xt(g);wn(()=>{Z&&me?.()},[Z,me]);const E=F.arrow?.x,P=F.arrow?.y,R=F.arrow?.centerOffset!==0,[A,O]=m.useState();return wn(()=>{w&&O(window.getComputedStyle(w).zIndex)},[w]),h.jsx("div",{ref:D.setFloating,"data-radix-popper-content-wrapper":"",style:{...J,transform:Z?J.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:A,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:h.jsx(px,{scope:n,placedSide:ae,onArrowChange:S,arrowX:E,arrowY:P,shouldHideArrow:R,children:h.jsx(be.div,{"data-side":ae,"data-align":ve,...y,ref:b,style:{...y.style,animation:Z?void 0:"none"}})})})});$f.displayName=Al;var Nf="PopperArrow",gx={top:"bottom",right:"left",bottom:"top",left:"right"},Mf=m.forwardRef(function(e,n){const{__scopePopper:r,...o}=e,s=mx(Nf,r),i=gx[s.placedSide];return h.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:h.jsx(dx,{...o,ref:n,style:{...o.style,display:"block"}})})});Mf.displayName=Nf;function yx(t){return t!==null}var vx=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=zf(n),d={start:"0%",center:"50%",end:"100%"}[u],f=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let g="",y="";return c==="bottom"?(g=i?d:`${f}px`,y=`${-l}px`):c==="top"?(g=i?d:`${f}px`,y=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,y=i?d:`${p}px`):c==="left"&&(g=`${r.floating.width+l}px`,y=i?d:`${p}px`),{data:{x:g,y}}}});function zf(t){const[e,n="center"]=t.split("-");return[e,n]}var wx=Of,Df=jf,bx=$f,xx=Mf,_x="Portal",Lf=m.forwardRef((t,e)=>{const{container:n,...r}=t,[o,s]=m.useState(!1);wn(()=>s(!0),[]);const i=n||o&&globalThis?.document?.body;return i?nf.createPortal(h.jsx(be.div,{...r,ref:e}),i):null});Lf.displayName=_x;function Cx(t,e){return m.useReducer((n,r)=>e[n][r]??n,t)}var mo=t=>{const{present:e,children:n}=t,r=Sx(e),o=typeof n=="function"?n({present:r.isPresent}):m.Children.only(n),s=at(r.ref,kx(o));return typeof n=="function"||r.isPresent?m.cloneElement(o,{ref:s}):null};mo.displayName="Presence";function Sx(t){const[e,n]=m.useState(),r=m.useRef({}),o=m.useRef(t),s=m.useRef("none"),i=t?"mounted":"unmounted",[a,l]=Cx(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return m.useEffect(()=>{const c=$o(r.current);s.current=a==="mounted"?c:"none"},[a]),wn(()=>{const c=r.current,u=o.current;if(u!==t){const f=s.current,p=$o(c);t?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),wn(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const y=$o(r.current).includes(p.animationName);if(p.target===e&&y&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},f=p=>{p.target===e&&(s.current=$o(r.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:m.useCallback(c=>{c&&(r.current=getComputedStyle(c)),n(c)},[])}}function $o(t){return t?.animationName||"none"}function kx(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function Bf({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,o]=Px({defaultProp:e,onChange:n}),s=t!==void 0,i=s?t:r,a=Xt(n),l=m.useCallback(c=>{if(s){const d=typeof c=="function"?c(t):c;d!==t&&a(d)}else o(c)},[s,t,o,a]);return[i,l]}function Px({defaultProp:t,onChange:e}){const n=m.useState(t),[r]=n,o=m.useRef(r),s=Xt(e);return m.useEffect(()=>{o.current!==r&&(s(r),o.current=r)},[r,o,s]),n}var Ex=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},$n=new WeakMap,No=new WeakMap,Mo={},_i=0,Ff=function(t){return t&&(t.host||Ff(t.parentNode))},Ax=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=Ff(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},Tx=function(t,e,n,r){var o=Ax(e,Array.isArray(t)?t:[t]);Mo[n]||(Mo[n]=new WeakMap);var s=Mo[n],i=[],a=new Set,l=new Set(o),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};o.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(f){if(a.has(f))u(f);else try{var p=f.getAttribute(r),g=p!==null&&p!=="false",y=($n.get(f)||0)+1,v=(s.get(f)||0)+1;$n.set(f,y),s.set(f,v),i.push(f),y===1&&g&&No.set(f,!0),v===1&&f.setAttribute(n,"true"),g||f.setAttribute(r,"true")}catch(w){console.error("aria-hidden: cannot operate on ",f,w)}})};return u(e),a.clear(),_i++,function(){i.forEach(function(d){var f=$n.get(d)-1,p=s.get(d)-1;$n.set(d,f),s.set(d,p),f||(No.has(d)||d.removeAttribute(r),No.delete(d)),p||d.removeAttribute(n)}),_i--,_i||($n=new WeakMap,$n=new WeakMap,No=new WeakMap,Mo={})}},Uf=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),o=Ex(t);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live]"))),Tx(r,o,n,"aria-hidden")):function(){return null}},dt=function(){return dt=Object.assign||function(e){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},dt.apply(this,arguments)};function Hf(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function Rx(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,s;r<o;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}var es="right-scroll-bar-position",ts="width-before-scroll-bar",Ox="with-scroll-bars-hidden",Ix="--removed-body-scroll-bar-size";function Ci(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function jx(t,e){var n=m.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var o=n.value;o!==r&&(n.value=r,n.callback(r,o))}}}})[0];return n.callback=e,n.facade}var $x=typeof window<"u"?m.useLayoutEffect:m.useEffect,tu=new WeakMap;function Nx(t,e){var n=jx(null,function(r){return t.forEach(function(o){return Ci(o,r)})});return $x(function(){var r=tu.get(n);if(r){var o=new Set(r),s=new Set(t),i=n.current;o.forEach(function(a){s.has(a)||Ci(a,null)}),s.forEach(function(a){o.has(a)||Ci(a,i)})}tu.set(n,t)},[t]),n}function Mx(t){return t}function zx(t,e){e===void 0&&(e=Mx);var n=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var i=e(s,r);return n.push(i),function(){n=n.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(r=!0;n.length;){var i=n;n=[],i.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){r=!0;var i=[];if(n.length){var a=n;n=[],a.forEach(s),i=n}var l=function(){var u=i;i=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),n={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),n}}}};return o}function Dx(t){t===void 0&&(t={});var e=zx(null);return e.options=dt({async:!0,ssr:!1},t),e}var Wf=function(t){var e=t.sideCar,n=Hf(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return m.createElement(r,dt({},n))};Wf.isSideCarExport=!0;function Lx(t,e){return t.useMedium(e),Wf}var Gf=Dx(),Si=function(){},zs=m.forwardRef(function(t,e){var n=m.useRef(null),r=m.useState({onScrollCapture:Si,onWheelCapture:Si,onTouchMoveCapture:Si}),o=r[0],s=r[1],i=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,f=t.sideCar,p=t.noIsolation,g=t.inert,y=t.allowPinchZoom,v=t.as,w=v===void 0?"div":v,_=t.gapMode,b=Hf(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=f,S=Nx([n,e]),k=dt(dt({},b),o);return m.createElement(m.Fragment,null,u&&m.createElement(x,{sideCar:Gf,removeScrollBar:c,shards:d,noIsolation:p,inert:g,setCallbacks:s,allowPinchZoom:!!y,lockRef:n,gapMode:_}),i?m.cloneElement(m.Children.only(a),dt(dt({},k),{ref:S})):m.createElement(w,dt({},k,{className:l,ref:S}),a))});zs.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};zs.classNames={fullWidth:ts,zeroRight:es};var Bx=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Fx(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Bx();return e&&t.setAttribute("nonce",e),t}function Ux(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function Hx(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Wx=function(){var t=0,e=null;return{add:function(n){t==0&&(e=Fx())&&(Ux(e,n),Hx(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Gx=function(){var t=Wx();return function(e,n){m.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},qf=function(){var t=Gx(),e=function(n){var r=n.styles,o=n.dynamic;return t(r,o),null};return e},qx={left:0,top:0,right:0,gap:0},ki=function(t){return parseInt(t||"",10)||0},Vx=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],o=e[t==="padding"?"paddingRight":"marginRight"];return[ki(n),ki(r),ki(o)]},Kx=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return qx;var e=Vx(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},Xx=qf(),cr="data-scroll-locked",Jx=function(t,e,n,r){var o=t.left,s=t.top,i=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(Ox,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(cr,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(es,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(ts,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(es," .").concat(es,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(ts," .").concat(ts,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(cr,`] {
    `).concat(Ix,": ").concat(a,`px;
  }
`)},nu=function(){var t=parseInt(document.body.getAttribute(cr)||"0",10);return isFinite(t)?t:0},Yx=function(){m.useEffect(function(){return document.body.setAttribute(cr,(nu()+1).toString()),function(){var t=nu()-1;t<=0?document.body.removeAttribute(cr):document.body.setAttribute(cr,t.toString())}},[])},Zx=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,o=r===void 0?"margin":r;Yx();var s=m.useMemo(function(){return Kx(o)},[o]);return m.createElement(Xx,{styles:Jx(s,!e,o,n?"":"!important")})},xa=!1;if(typeof window<"u")try{var zo=Object.defineProperty({},"passive",{get:function(){return xa=!0,!0}});window.addEventListener("test",zo,zo),window.removeEventListener("test",zo,zo)}catch{xa=!1}var Nn=xa?{passive:!1}:!1,Qx=function(t){return t.tagName==="TEXTAREA"},Vf=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!Qx(t)&&n[e]==="visible")},e0=function(t){return Vf(t,"overflowY")},t0=function(t){return Vf(t,"overflowX")},ru=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=Kf(t,r);if(o){var s=Xf(t,r),i=s[1],a=s[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},n0=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},r0=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},Kf=function(t,e){return t==="v"?e0(e):t0(e)},Xf=function(t,e){return t==="v"?n0(e):r0(e)},o0=function(t,e){return t==="h"&&e==="rtl"?-1:1},s0=function(t,e,n,r,o){var s=o0(t,window.getComputedStyle(e).direction),i=s*r,a=n.target,l=e.contains(a),c=!1,u=i>0,d=0,f=0;do{var p=Xf(t,a),g=p[0],y=p[1],v=p[2],w=y-v-s*g;(g||w)&&Kf(t,a)&&(d+=w,f+=g),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(f)<1)&&(c=!0),c},Do=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},ou=function(t){return[t.deltaX,t.deltaY]},su=function(t){return t&&"current"in t?t.current:t},i0=function(t,e){return t[0]===e[0]&&t[1]===e[1]},a0=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},l0=0,Mn=[];function c0(t){var e=m.useRef([]),n=m.useRef([0,0]),r=m.useRef(),o=m.useState(l0++)[0],s=m.useState(qf)[0],i=m.useRef(t);m.useEffect(function(){i.current=t},[t]),m.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(o));var y=Rx([t.lockRef.current],(t.shards||[]).map(su),!0).filter(Boolean);return y.forEach(function(v){return v.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),y.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(o))})}}},[t.inert,t.lockRef.current,t.shards]);var a=m.useCallback(function(y,v){if("touches"in y&&y.touches.length===2||y.type==="wheel"&&y.ctrlKey)return!i.current.allowPinchZoom;var w=Do(y),_=n.current,b="deltaX"in y?y.deltaX:_[0]-w[0],x="deltaY"in y?y.deltaY:_[1]-w[1],S,k=y.target,C=Math.abs(b)>Math.abs(x)?"h":"v";if("touches"in y&&C==="h"&&k.type==="range")return!1;var M=ru(C,k);if(!M)return!0;if(M?S=C:(S=C==="v"?"h":"v",M=ru(C,k)),!M)return!1;if(!r.current&&"changedTouches"in y&&(b||x)&&(r.current=S),!S)return!0;var H=r.current||S;return s0(H,v,y,H==="h"?b:x)},[]),l=m.useCallback(function(y){var v=y;if(!(!Mn.length||Mn[Mn.length-1]!==s)){var w="deltaY"in v?ou(v):Do(v),_=e.current.filter(function(S){return S.name===v.type&&(S.target===v.target||v.target===S.shadowParent)&&i0(S.delta,w)})[0];if(_&&_.should){v.cancelable&&v.preventDefault();return}if(!_){var b=(i.current.shards||[]).map(su).filter(Boolean).filter(function(S){return S.contains(v.target)}),x=b.length>0?a(v,b[0]):!i.current.noIsolation;x&&v.cancelable&&v.preventDefault()}}},[]),c=m.useCallback(function(y,v,w,_){var b={name:y,delta:v,target:w,should:_,shadowParent:u0(w)};e.current.push(b),setTimeout(function(){e.current=e.current.filter(function(x){return x!==b})},1)},[]),u=m.useCallback(function(y){n.current=Do(y),r.current=void 0},[]),d=m.useCallback(function(y){c(y.type,ou(y),y.target,a(y,t.lockRef.current))},[]),f=m.useCallback(function(y){c(y.type,Do(y),y.target,a(y,t.lockRef.current))},[]);m.useEffect(function(){return Mn.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",l,Nn),document.addEventListener("touchmove",l,Nn),document.addEventListener("touchstart",u,Nn),function(){Mn=Mn.filter(function(y){return y!==s}),document.removeEventListener("wheel",l,Nn),document.removeEventListener("touchmove",l,Nn),document.removeEventListener("touchstart",u,Nn)}},[]);var p=t.removeScrollBar,g=t.inert;return m.createElement(m.Fragment,null,g?m.createElement(s,{styles:a0(o)}):null,p?m.createElement(Zx,{gapMode:t.gapMode}):null)}function u0(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const d0=Lx(Gf,c0);var Tl=m.forwardRef(function(t,e){return m.createElement(zs,dt({},t,{ref:e,sideCar:d0}))});Tl.classNames=zs.classNames;var Rl="Popover",[Jf,iR]=yl(Rl,[Tf]),go=Tf(),[h0,Rn]=Jf(Rl),Yf=t=>{const{__scopePopover:e,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!1}=t,a=go(e),l=m.useRef(null),[c,u]=m.useState(!1),[d=!1,f]=Bf({prop:r,defaultProp:o,onChange:s});return h.jsx(wx,{...a,children:h.jsx(h0,{scope:e,contentId:ft(),triggerRef:l,open:d,onOpenChange:f,onOpenToggle:m.useCallback(()=>f(p=>!p),[f]),hasCustomAnchor:c,onCustomAnchorAdd:m.useCallback(()=>u(!0),[]),onCustomAnchorRemove:m.useCallback(()=>u(!1),[]),modal:i,children:n})})};Yf.displayName=Rl;var Zf="PopoverAnchor",f0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=Rn(Zf,n),s=go(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=o;return m.useEffect(()=>(i(),()=>a()),[i,a]),h.jsx(Df,{...s,...r,ref:e})});f0.displayName=Zf;var Qf="PopoverTrigger",ep=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=Rn(Qf,n),s=go(n),i=at(e,o.triggerRef),a=h.jsx(be.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":op(o.open),...r,ref:i,onClick:Ke(t.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:h.jsx(Df,{asChild:!0,...s,children:a})});ep.displayName=Qf;var p0="PopoverPortal",[aR,m0]=Jf(p0,{forceMount:void 0}),yr="PopoverContent",tp=m.forwardRef((t,e)=>{const n=m0(yr,t.__scopePopover),{forceMount:r=n.forceMount,...o}=t,s=Rn(yr,t.__scopePopover);return h.jsx(mo,{present:r||s.open,children:s.modal?h.jsx(g0,{...o,ref:e}):h.jsx(y0,{...o,ref:e})})});tp.displayName=yr;var g0=m.forwardRef((t,e)=>{const n=Rn(yr,t.__scopePopover),r=m.useRef(null),o=at(e,r),s=m.useRef(!1);return m.useEffect(()=>{const i=r.current;if(i)return Uf(i)},[]),h.jsx(Tl,{as:js,allowPinchZoom:!0,children:h.jsx(np,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ke(t.onCloseAutoFocus,i=>{i.preventDefault(),s.current||n.triggerRef.current?.focus()}),onPointerDownOutside:Ke(t.onPointerDownOutside,i=>{const a=i.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Ke(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),y0=m.forwardRef((t,e)=>{const n=Rn(yr,t.__scopePopover),r=m.useRef(!1),o=m.useRef(!1);return h.jsx(np,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;n.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),np=m.forwardRef((t,e)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=t,f=Rn(yr,n),p=go(n);return sf(),h.jsx(wl,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:h.jsx(vl,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>f.onOpenChange(!1),children:h.jsx(bx,{"data-state":op(f.open),role:"dialog",id:f.contentId,...p,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),rp="PopoverClose",v0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=Rn(rp,n);return h.jsx(be.button,{type:"button",...r,ref:e,onClick:Ke(t.onClick,()=>o.onOpenChange(!1))})});v0.displayName=rp;var w0="PopoverArrow",b0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=go(n);return h.jsx(xx,{...o,...r,ref:e})});b0.displayName=w0;function op(t){return t?"open":"closed"}var x0=ep;function sp(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(e=0;e<o;e++)t[e]&&(n=sp(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function Ol(){for(var t,e,n=0,r="",o=arguments.length;n<o;n++)(t=arguments[n])&&(e=sp(t))&&(r&&(r+=" "),r+=e);return r}function Ae(...t){return gl(Ol(t))}const ip=Yf,ap=x0,lp=m.forwardRef(({className:t,align:e="end",...n},r)=>h.jsx(tp,{ref:r,align:e,className:Ae("z-popups drop-shadow-oneBlock p-0 border-shadow outline-none",t),...n,onKeyDown:o=>{o.stopPropagation()}})),Ds=({children:t,scaleFactor:e})=>{const n=ah();return h.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??n,"--block":`${(e??n)*8}px`},children:t})};var iu=1,_0=.9,C0=.8,S0=.17,Pi=.1,Ei=.999,k0=.9999,P0=.99,E0=/[\\\/_+.#"@\[\(\{&]/,A0=/[\\\/_+.#"@\[\(\{&]/g,T0=/[\s-]/,cp=/[\s-]/g;function _a(t,e,n,r,o,s,i){if(s===e.length)return o===t.length?iu:P0;var a=`${o},${s}`;if(i[a]!==void 0)return i[a];for(var l=r.charAt(s),c=n.indexOf(l,o),u=0,d,f,p,g;c>=0;)d=_a(t,e,n,r,c+1,s+1,i),d>u&&(c===o?d*=iu:E0.test(t.charAt(c-1))?(d*=C0,p=t.slice(o,c-1).match(A0),p&&o>0&&(d*=Math.pow(Ei,p.length))):T0.test(t.charAt(c-1))?(d*=_0,g=t.slice(o,c-1).match(cp),g&&o>0&&(d*=Math.pow(Ei,g.length))):(d*=S0,o>0&&(d*=Math.pow(Ei,c-o))),t.charAt(c)!==e.charAt(s)&&(d*=k0)),(d<Pi&&n.charAt(c-1)===r.charAt(s+1)||r.charAt(s+1)===r.charAt(s)&&n.charAt(c-1)!==r.charAt(s))&&(f=_a(t,e,n,r,c+1,s+2,i),f*Pi>d&&(d=f*Pi)),d>u&&(u=d),c=n.indexOf(l,c+1);return i[a]=u,u}function au(t){return t.toLowerCase().replace(cp," ")}function R0(t,e,n){return t=n&&n.length>0?`${t+" "+n.join(" ")}`:t,_a(t,e,au(t),au(e),0,0,{})}var Il="Dialog",[up,lR]=yl(Il),[O0,lt]=up(Il),dp=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!0}=t,a=m.useRef(null),l=m.useRef(null),[c=!1,u]=Bf({prop:r,defaultProp:o,onChange:s});return h.jsx(O0,{scope:e,triggerRef:a,contentRef:l,contentId:ft(),titleId:ft(),descriptionId:ft(),open:c,onOpenChange:u,onOpenToggle:m.useCallback(()=>u(d=>!d),[u]),modal:i,children:n})};dp.displayName=Il;var hp="DialogTrigger",I0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(hp,n),s=at(e,o.triggerRef);return h.jsx(be.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Nl(o.open),...r,ref:s,onClick:Ke(t.onClick,o.onOpenToggle)})});I0.displayName=hp;var jl="DialogPortal",[j0,fp]=up(jl,{forceMount:void 0}),pp=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:o}=t,s=lt(jl,e);return h.jsx(j0,{scope:e,forceMount:n,children:m.Children.map(r,i=>h.jsx(mo,{present:n||s.open,children:h.jsx(Lf,{asChild:!0,container:o,children:i})}))})};pp.displayName=jl;var ws="DialogOverlay",mp=m.forwardRef((t,e)=>{const n=fp(ws,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,s=lt(ws,t.__scopeDialog);return s.modal?h.jsx(mo,{present:r||s.open,children:h.jsx($0,{...o,ref:e})}):null});mp.displayName=ws;var $0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(ws,n);return h.jsx(Tl,{as:js,allowPinchZoom:!0,shards:[o.contentRef],children:h.jsx(be.div,{"data-state":Nl(o.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),xn="DialogContent",gp=m.forwardRef((t,e)=>{const n=fp(xn,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,s=lt(xn,t.__scopeDialog);return h.jsx(mo,{present:r||s.open,children:s.modal?h.jsx(N0,{...o,ref:e}):h.jsx(M0,{...o,ref:e})})});gp.displayName=xn;var N0=m.forwardRef((t,e)=>{const n=lt(xn,t.__scopeDialog),r=m.useRef(null),o=at(e,n.contentRef,r);return m.useEffect(()=>{const s=r.current;if(s)return Uf(s)},[]),h.jsx(yp,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ke(t.onCloseAutoFocus,s=>{s.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Ke(t.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:Ke(t.onFocusOutside,s=>s.preventDefault())})}),M0=m.forwardRef((t,e)=>{const n=lt(xn,t.__scopeDialog),r=m.useRef(!1),o=m.useRef(!1);return h.jsx(yp,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;n.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),yp=m.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=t,a=lt(xn,n),l=m.useRef(null),c=at(e,l);return sf(),h.jsxs(h.Fragment,{children:[h.jsx(wl,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:h.jsx(vl,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":Nl(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),h.jsxs(h.Fragment,{children:[h.jsx(B0,{titleId:a.titleId}),h.jsx(U0,{contentRef:l,descriptionId:a.descriptionId})]})]})}),$l="DialogTitle",z0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt($l,n);return h.jsx(be.h2,{id:o.titleId,...r,ref:e})});z0.displayName=$l;var vp="DialogDescription",D0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(vp,n);return h.jsx(be.p,{id:o.descriptionId,...r,ref:e})});D0.displayName=vp;var wp="DialogClose",L0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(wp,n);return h.jsx(be.button,{type:"button",...r,ref:e,onClick:Ke(t.onClick,()=>o.onOpenChange(!1))})});L0.displayName=wp;function Nl(t){return t?"open":"closed"}var bp="DialogTitleWarning",[cR,xp]=Yw(bp,{contentName:xn,titleName:$l,docsSlug:"dialog"}),B0=({titleId:t})=>{const e=xp(bp),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return m.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},F0="DialogDescriptionWarning",U0=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${xp(F0).contentName}}.`;return m.useEffect(()=>{const o=t.current?.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},H0=dp,W0=pp,G0=mp,q0=gp,Ai={exports:{}},Ti={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lu;function V0(){if(lu)return Ti;lu=1;var t=oy();function e(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,o=t.useEffect,s=t.useLayoutEffect,i=t.useDebugValue;function a(d,f){var p=f(),g=r({inst:{value:p,getSnapshot:f}}),y=g[0].inst,v=g[1];return s(function(){y.value=p,y.getSnapshot=f,l(y)&&v({inst:y})},[d,p,f]),o(function(){return l(y)&&v({inst:y}),d(function(){l(y)&&v({inst:y})})},[d]),i(p),p}function l(d){var f=d.getSnapshot;d=d.value;try{var p=f();return!n(d,p)}catch{return!0}}function c(d,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return Ti.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,Ti}var cu;function K0(){return cu||(cu=1,Ai.exports=V0()),Ai.exports}var X0=K0(),zr='[cmdk-group=""]',Ri='[cmdk-group-items=""]',J0='[cmdk-group-heading=""]',Ml='[cmdk-item=""]',uu=`${Ml}:not([aria-disabled="true"])`,Ca="cmdk-item-select",dn="data-value",Y0=(t,e,n)=>R0(t,e,n),_p=m.createContext(void 0),yo=()=>m.useContext(_p),Cp=m.createContext(void 0),zl=()=>m.useContext(Cp),Sp=m.createContext(void 0),kp=m.forwardRef((t,e)=>{let n=Jn(()=>{var E,P;return{search:"",value:(P=(E=t.value)!=null?E:t.defaultValue)!=null?P:"",filtered:{count:0,items:new Map,groups:new Set}}}),r=Jn(()=>new Set),o=Jn(()=>new Map),s=Jn(()=>new Map),i=Jn(()=>new Set),a=Pp(t),{label:l,children:c,value:u,onValueChange:d,filter:f,shouldFilter:p,loop:g,disablePointerSelection:y=!1,vimBindings:v=!0,...w}=t,_=ft(),b=ft(),x=ft(),S=m.useRef(null),k=l_();_n(()=>{if(u!==void 0){let E=u.trim();n.current.value=E,C.emit()}},[u]),_n(()=>{k(6,ee)},[]);let C=m.useMemo(()=>({subscribe:E=>(i.current.add(E),()=>i.current.delete(E)),snapshot:()=>n.current,setState:(E,P,R)=>{var A,O,T;if(!Object.is(n.current[E],P)){if(n.current[E]=P,E==="search")j(),L(),k(1,X);else if(E==="value"&&(R||k(5,ee),((A=a.current)==null?void 0:A.value)!==void 0)){let z=P??"";(T=(O=a.current).onValueChange)==null||T.call(O,z);return}C.emit()}},emit:()=>{i.current.forEach(E=>E())}}),[]),M=m.useMemo(()=>({value:(E,P,R)=>{var A;P!==((A=s.current.get(E))==null?void 0:A.value)&&(s.current.set(E,{value:P,keywords:R}),n.current.filtered.items.set(E,H(P,R)),k(2,()=>{L(),C.emit()}))},item:(E,P)=>(r.current.add(E),P&&(o.current.has(P)?o.current.get(P).add(E):o.current.set(P,new Set([E]))),k(3,()=>{j(),L(),n.current.value||X(),C.emit()}),()=>{s.current.delete(E),r.current.delete(E),n.current.filtered.items.delete(E);let R=D();k(4,()=>{j(),R?.getAttribute("id")===E&&X(),C.emit()})}),group:E=>(o.current.has(E)||o.current.set(E,new Set),()=>{s.current.delete(E),o.current.delete(E)}),filter:()=>a.current.shouldFilter,label:l||t["aria-label"],getDisablePointerSelection:()=>a.current.disablePointerSelection,listId:_,inputId:x,labelId:b,listInnerRef:S}),[]);function H(E,P){var R,A;let O=(A=(R=a.current)==null?void 0:R.filter)!=null?A:Y0;return E?O(E,n.current.search,P):0}function L(){if(!n.current.search||a.current.shouldFilter===!1)return;let E=n.current.filtered.items,P=[];n.current.filtered.groups.forEach(A=>{let O=o.current.get(A),T=0;O.forEach(z=>{let oe=E.get(z);T=Math.max(oe,T)}),P.push([A,T])});let R=S.current;J().sort((A,O)=>{var T,z;let oe=A.getAttribute("id"),ue=O.getAttribute("id");return((T=E.get(ue))!=null?T:0)-((z=E.get(oe))!=null?z:0)}).forEach(A=>{let O=A.closest(Ri);O?O.appendChild(A.parentElement===O?A:A.closest(`${Ri} > *`)):R.appendChild(A.parentElement===R?A:A.closest(`${Ri} > *`))}),P.sort((A,O)=>O[1]-A[1]).forEach(A=>{var O;let T=(O=S.current)==null?void 0:O.querySelector(`${zr}[${dn}="${encodeURIComponent(A[0])}"]`);T?.parentElement.appendChild(T)})}function X(){let E=J().find(R=>R.getAttribute("aria-disabled")!=="true"),P=E?.getAttribute(dn);C.setState("value",P||void 0)}function j(){var E,P,R,A;if(!n.current.search||a.current.shouldFilter===!1){n.current.filtered.count=r.current.size;return}n.current.filtered.groups=new Set;let O=0;for(let T of r.current){let z=(P=(E=s.current.get(T))==null?void 0:E.value)!=null?P:"",oe=(A=(R=s.current.get(T))==null?void 0:R.keywords)!=null?A:[],ue=H(z,oe);n.current.filtered.items.set(T,ue),ue>0&&O++}for(let[T,z]of o.current)for(let oe of z)if(n.current.filtered.items.get(oe)>0){n.current.filtered.groups.add(T);break}n.current.filtered.count=O}function ee(){var E,P,R;let A=D();A&&(((E=A.parentElement)==null?void 0:E.firstChild)===A&&((R=(P=A.closest(zr))==null?void 0:P.querySelector(J0))==null||R.scrollIntoView({block:"nearest"})),A.scrollIntoView({block:"nearest"}))}function D(){var E;return(E=S.current)==null?void 0:E.querySelector(`${Ml}[aria-selected="true"]`)}function J(){var E;return Array.from(((E=S.current)==null?void 0:E.querySelectorAll(uu))||[])}function Y(E){let P=J()[E];P&&C.setState("value",P.getAttribute(dn))}function Z(E){var P;let R=D(),A=J(),O=A.findIndex(z=>z===R),T=A[O+E];(P=a.current)!=null&&P.loop&&(T=O+E<0?A[A.length-1]:O+E===A.length?A[0]:A[O+E]),T&&C.setState("value",T.getAttribute(dn))}function F(E){let P=D(),R=P?.closest(zr),A;for(;R&&!A;)R=E>0?i_(R,zr):a_(R,zr),A=R?.querySelector(uu);A?C.setState("value",A.getAttribute(dn)):Z(E)}let ae=()=>Y(J().length-1),ve=E=>{E.preventDefault(),E.metaKey?ae():E.altKey?F(1):Z(1)},me=E=>{E.preventDefault(),E.metaKey?Y(0):E.altKey?F(-1):Z(-1)};return m.createElement(be.div,{ref:e,tabIndex:-1,...w,"cmdk-root":"",onKeyDown:E=>{var P;if((P=w.onKeyDown)==null||P.call(w,E),!E.defaultPrevented)switch(E.key){case"n":case"j":{v&&E.ctrlKey&&ve(E);break}case"ArrowDown":{ve(E);break}case"p":case"k":{v&&E.ctrlKey&&me(E);break}case"ArrowUp":{me(E);break}case"Home":{E.preventDefault(),Y(0);break}case"End":{E.preventDefault(),ae();break}case"Enter":if(!E.nativeEvent.isComposing&&E.keyCode!==229){E.preventDefault();let R=D();if(R){let A=new Event(Ca);R.dispatchEvent(A)}}}}},m.createElement("label",{"cmdk-label":"",htmlFor:M.inputId,id:M.labelId,style:u_},l),Ls(t,E=>m.createElement(Cp.Provider,{value:C},m.createElement(_p.Provider,{value:M},E))))}),Z0=m.forwardRef((t,e)=>{var n,r;let o=ft(),s=m.useRef(null),i=m.useContext(Sp),a=yo(),l=Pp(t),c=(r=(n=l.current)==null?void 0:n.forceMount)!=null?r:i?.forceMount;_n(()=>{if(!c)return a.item(o,i?.id)},[c]);let u=Ep(o,s,[t.value,t.children,s],t.keywords),d=zl(),f=Cn(k=>k.value&&k.value===u.current),p=Cn(k=>c||a.filter()===!1?!0:k.search?k.filtered.items.get(o)>0:!0);m.useEffect(()=>{let k=s.current;if(!(!k||t.disabled))return k.addEventListener(Ca,g),()=>k.removeEventListener(Ca,g)},[p,t.onSelect,t.disabled]);function g(){var k,C;y(),(C=(k=l.current).onSelect)==null||C.call(k,u.current)}function y(){d.setState("value",u.current,!0)}if(!p)return null;let{disabled:v,value:w,onSelect:_,forceMount:b,keywords:x,...S}=t;return m.createElement(be.div,{ref:so([s,e]),...S,id:o,"cmdk-item":"",role:"option","aria-disabled":!!v,"aria-selected":!!f,"data-disabled":!!v,"data-selected":!!f,onPointerMove:v||a.getDisablePointerSelection()?void 0:y,onClick:v?void 0:g},t.children)}),Q0=m.forwardRef((t,e)=>{let{heading:n,children:r,forceMount:o,...s}=t,i=ft(),a=m.useRef(null),l=m.useRef(null),c=ft(),u=yo(),d=Cn(p=>o||u.filter()===!1?!0:p.search?p.filtered.groups.has(i):!0);_n(()=>u.group(i),[]),Ep(i,a,[t.value,t.heading,l]);let f=m.useMemo(()=>({id:i,forceMount:o}),[o]);return m.createElement(be.div,{ref:so([a,e]),...s,"cmdk-group":"",role:"presentation",hidden:d?void 0:!0},n&&m.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:c},n),Ls(t,p=>m.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?c:void 0},m.createElement(Sp.Provider,{value:f},p))))}),e_=m.forwardRef((t,e)=>{let{alwaysRender:n,...r}=t,o=m.useRef(null),s=Cn(i=>!i.search);return!n&&!s?null:m.createElement(be.div,{ref:so([o,e]),...r,"cmdk-separator":"",role:"separator"})}),t_=m.forwardRef((t,e)=>{let{onValueChange:n,...r}=t,o=t.value!=null,s=zl(),i=Cn(u=>u.search),a=Cn(u=>u.value),l=yo(),c=m.useMemo(()=>{var u;let d=(u=l.listInnerRef.current)==null?void 0:u.querySelector(`${Ml}[${dn}="${encodeURIComponent(a)}"]`);return d?.getAttribute("id")},[]);return m.useEffect(()=>{t.value!=null&&s.setState("search",t.value)},[t.value]),m.createElement(be.input,{ref:e,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":c,id:l.inputId,type:"text",value:o?t.value:i,onChange:u=>{o||s.setState("search",u.target.value),n?.(u.target.value)}})}),n_=m.forwardRef((t,e)=>{let{children:n,label:r="Suggestions",...o}=t,s=m.useRef(null),i=m.useRef(null),a=yo();return m.useEffect(()=>{if(i.current&&s.current){let l=i.current,c=s.current,u,d=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let f=l.offsetHeight;c.style.setProperty("--cmdk-list-height",f.toFixed(1)+"px")})});return d.observe(l),()=>{cancelAnimationFrame(u),d.unobserve(l)}}},[]),m.createElement(be.div,{ref:so([s,e]),...o,"cmdk-list":"",role:"listbox","aria-label":r,id:a.listId},Ls(t,l=>m.createElement("div",{ref:so([i,a.listInnerRef]),"cmdk-list-sizer":""},l)))}),r_=m.forwardRef((t,e)=>{let{open:n,onOpenChange:r,overlayClassName:o,contentClassName:s,container:i,...a}=t;return m.createElement(H0,{open:n,onOpenChange:r},m.createElement(W0,{container:i},m.createElement(G0,{"cmdk-overlay":"",className:o}),m.createElement(q0,{"aria-label":t.label,"cmdk-dialog":"",className:s},m.createElement(kp,{ref:e,...a}))))}),o_=m.forwardRef((t,e)=>Cn(n=>n.filtered.count===0)?m.createElement(be.div,{ref:e,...t,"cmdk-empty":"",role:"presentation"}):null),s_=m.forwardRef((t,e)=>{let{progress:n,children:r,label:o="Loading...",...s}=t;return m.createElement(be.div,{ref:e,...s,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},Ls(t,i=>m.createElement("div",{"aria-hidden":!0},i)))}),We=Object.assign(kp,{List:n_,Item:Z0,Input:t_,Group:Q0,Separator:e_,Dialog:r_,Empty:o_,Loading:s_});function i_(t,e){let n=t.nextElementSibling;for(;n;){if(n.matches(e))return n;n=n.nextElementSibling}}function a_(t,e){let n=t.previousElementSibling;for(;n;){if(n.matches(e))return n;n=n.previousElementSibling}}function Pp(t){let e=m.useRef(t);return _n(()=>{e.current=t}),e}var _n=typeof window>"u"?m.useEffect:m.useLayoutEffect;function Jn(t){let e=m.useRef();return e.current===void 0&&(e.current=t()),e}function so(t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}function Cn(t){let e=zl(),n=()=>t(e.snapshot());return X0.useSyncExternalStore(e.subscribe,n,n)}function Ep(t,e,n,r=[]){let o=m.useRef(),s=yo();return _n(()=>{var i;let a=(()=>{var c;for(let u of n){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(c=u.current.textContent)==null?void 0:c.trim():o.current}})(),l=r.map(c=>c.trim());s.value(t,a,l),(i=e.current)==null||i.setAttribute(dn,a),o.current=a}),o}var l_=()=>{let[t,e]=m.useState(),n=Jn(()=>new Map);return _n(()=>{n.current.forEach(r=>r()),n.current=new Map},[t]),(r,o)=>{n.current.set(r,o),e({})}};function c_(t){let e=t.type;return typeof e=="function"?e(t.props):"render"in e?e.render(t.props):t}function Ls({asChild:t,children:e},n){return t&&m.isValidElement(e)?m.cloneElement(c_(e),{ref:e.ref},n(e.props.children)):n(e)}var u_={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Ap=m.forwardRef(({className:t,...e},n)=>h.jsx(We,{ref:n,className:Ae("flex h-full w-full flex-col overflow-hidden bg-metallicBlue text-popover-foreground",t),...e}));Ap.displayName=We.displayName;const Tp=m.forwardRef(({className:t,...e},n)=>h.jsxs("div",{className:"flex items-center border-b px-1 pb-1","cmdk-input-wrapper":"",children:[h.jsx("span",{className:"sprite mr-1 texture-hud_char_gt"}),h.jsx(We.Input,{ref:n,className:Ae("flex h-1 w-full bg-pastelBlue py-1 outline-none placeholder:text-shadow disabled:cursor-not-allowed",t),...e})]}));Tp.displayName=We.Input.displayName;const Rp=m.forwardRef(({className:t,...e},n)=>h.jsx(We.List,{ref:n,className:Ae("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...e}));Rp.displayName=We.List.displayName;const Op=m.forwardRef((t,e)=>h.jsx(We.Empty,{ref:e,className:"pl-1",...t}));Op.displayName=We.Empty.displayName;const Ip=m.forwardRef(({className:t,...e},n)=>h.jsx(We.Group,{ref:n,className:Ae("overflow-hidden",t),...e}));Ip.displayName=We.Group.displayName;const d_=m.forwardRef(({className:t,...e},n)=>h.jsx(We.Separator,{ref:n,className:Ae("-mx-1 h-px bg-shadow",t),...e}));d_.displayName=We.Separator.displayName;const Bs=m.forwardRef(({className:t,...e},n)=>h.jsx(We.Item,{ref:n,className:Ae("relative flex cursor-default select-none items-center text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-midRed hover:bg-pastelBlue data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...e}));Bs.displayName=We.Item.displayName;function Pt(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t?.(o),n===!1||!o.defaultPrevented)return e?.(o)}}function du(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function jp(...t){return e=>{let n=!1;const r=t.map(o=>{const s=du(o,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():du(t[o],null)}}}}function On(...t){return m.useCallback(jp(...t),t)}function $p(t,e=[]){let n=[];function r(s,i){const a=m.createContext(i),l=n.length;n=[...n,i];const c=d=>{const{scope:f,children:p,...g}=d,y=f?.[t]?.[l]||a,v=m.useMemo(()=>g,Object.values(g));return h.jsx(y.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(d,f){const p=f?.[t]?.[l]||a,g=m.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=n.map(i=>m.createContext(i));return function(a){const l=a?.[t]||s;return m.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[r,h_(o,...e)]}function h_(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}function f_(t){const e=p_(t),n=m.forwardRef((r,o)=>{const{children:s,...i}=r,a=m.Children.toArray(s),l=a.find(g_);if(l){const c=l.props.children,u=a.map(d=>d===l?m.Children.count(c)>1?m.Children.only(null):m.isValidElement(c)?c.props.children:null:d);return h.jsx(e,{...i,ref:o,children:m.isValidElement(c)?m.cloneElement(c,void 0,u):null})}return h.jsx(e,{...i,ref:o,children:s})});return n.displayName=`${t}.Slot`,n}function p_(t){const e=m.forwardRef((n,r)=>{const{children:o,...s}=n;if(m.isValidElement(o)){const i=v_(o),a=y_(s,o.props);return o.type!==m.Fragment&&(a.ref=r?jp(r,i):i),m.cloneElement(o,a)}return m.Children.count(o)>1?m.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Np=Symbol("radix.slottable");function m_(t){const e=({children:n})=>h.jsx(h.Fragment,{children:n});return e.displayName=`${t}.Slottable`,e.__radixId=Np,e}function g_(t){return m.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Np}function y_(t,e){const n={...e};for(const r in e){const o=t[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{const l=s(...a);return o(...a),l}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...t,...n}}function v_(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var w_=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],nn=w_.reduce((t,e)=>{const n=f_(`Primitive.${e}`),r=m.forwardRef((o,s)=>{const{asChild:i,...a}=o,l=i?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(l,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function b_(t,e){t&&Is.flushSync(()=>t.dispatchEvent(e))}function Fs(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t}),m.useMemo(()=>(...n)=>e.current?.(...n),[])}function x_(t,e=globalThis?.document){const n=Fs(t);m.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var __="DismissableLayer",Sa="dismissableLayer.update",C_="dismissableLayer.pointerDownOutside",S_="dismissableLayer.focusOutside",hu,Mp=m.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),zp=m.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=m.useContext(Mp),[u,d]=m.useState(null),f=u?.ownerDocument??globalThis?.document,[,p]=m.useState({}),g=On(e,C=>d(C)),y=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),w=y.indexOf(v),_=u?y.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,x=_>=w,S=E_(C=>{const M=C.target,H=[...c.branches].some(L=>L.contains(M));!x||H||(o?.(C),i?.(C),C.defaultPrevented||a?.())},f),k=A_(C=>{const M=C.target;[...c.branches].some(L=>L.contains(M))||(s?.(C),i?.(C),C.defaultPrevented||a?.())},f);return x_(C=>{_===c.layers.size-1&&(r?.(C),!C.defaultPrevented&&a&&(C.preventDefault(),a()))},f),m.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(hu=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),fu(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=hu)}},[u,f,n,c]),m.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),fu())},[u,c]),m.useEffect(()=>{const C=()=>p({});return document.addEventListener(Sa,C),()=>document.removeEventListener(Sa,C)},[]),h.jsx(nn.div,{...l,ref:g,style:{pointerEvents:b?x?"auto":"none":void 0,...t.style},onFocusCapture:Pt(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Pt(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Pt(t.onPointerDownCapture,S.onPointerDownCapture)})});zp.displayName=__;var k_="DismissableLayerBranch",P_=m.forwardRef((t,e)=>{const n=m.useContext(Mp),r=m.useRef(null),o=On(e,r);return m.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),h.jsx(nn.div,{...t,ref:o})});P_.displayName=k_;function E_(t,e=globalThis?.document){const n=Fs(t),r=m.useRef(!1),o=m.useRef(()=>{});return m.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){Dp(C_,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function A_(t,e=globalThis?.document){const n=Fs(t),r=m.useRef(!1);return m.useEffect(()=>{const o=s=>{s.target&&!r.current&&Dp(S_,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function fu(){const t=new CustomEvent(Sa);document.dispatchEvent(t)}function Dp(t,e,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?b_(o,s):o.dispatchEvent(s)}var Qt=globalThis?.document?m.useLayoutEffect:()=>{},T_=Es[" useId ".trim().toString()]||(()=>{}),R_=0;function O_(t){const[e,n]=m.useState(T_());return Qt(()=>{n(r=>r??String(R_++))},[t]),e?`radix-${e}`:""}var I_="Arrow",Lp=m.forwardRef((t,e)=>{const{children:n,width:r=10,height:o=5,...s}=t;return h.jsx(nn.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});Lp.displayName=I_;var j_=Lp;function $_(t){const[e,n]=m.useState(void 0);return Qt(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var Dl="Popper",[Bp,Fp]=$p(Dl),[N_,Up]=Bp(Dl),Hp=t=>{const{__scopePopper:e,children:n}=t,[r,o]=m.useState(null);return h.jsx(N_,{scope:e,anchor:r,onAnchorChange:o,children:n})};Hp.displayName=Dl;var Wp="PopperAnchor",Gp=m.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,s=Up(Wp,n),i=m.useRef(null),a=On(e,i);return m.useEffect(()=>{s.onAnchorChange(r?.current||i.current)}),r?null:h.jsx(nn.div,{...o,ref:a})});Gp.displayName=Wp;var Ll="PopperContent",[M_,z_]=Bp(Ll),qp=m.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:p="optimized",onPlaced:g,...y}=t,v=Up(Ll,n),[w,_]=m.useState(null),b=On(e,T=>_(T)),[x,S]=m.useState(null),k=$_(x),C=k?.width??0,M=k?.height??0,H=r+(s!=="center"?"-"+s:""),L=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},X=Array.isArray(c)?c:[c],j=X.length>0,ee={padding:L,boundary:X.filter(L_),altBoundary:j},{refs:D,floatingStyles:J,placement:Y,isPositioned:Z,middlewareData:F}=wf({strategy:"fixed",placement:H,whileElementsMounted:(...T)=>yf(...T,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[bf({mainAxis:o+M,alignmentAxis:i}),l&&xf({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?_f():void 0,...ee}),l&&Cf({...ee}),Sf({...ee,apply:({elements:T,rects:z,availableWidth:oe,availableHeight:ue})=>{const{width:Ne,height:Me}=z.reference,ce=T.floating.style;ce.setProperty("--radix-popper-available-width",`${oe}px`),ce.setProperty("--radix-popper-available-height",`${ue}px`),ce.setProperty("--radix-popper-anchor-width",`${Ne}px`),ce.setProperty("--radix-popper-anchor-height",`${Me}px`)}}),x&&Pf({element:x,padding:a}),B_({arrowWidth:C,arrowHeight:M}),f&&kf({strategy:"referenceHidden",...ee})]}),[ae,ve]=Xp(Y),me=Fs(g);Qt(()=>{Z&&me?.()},[Z,me]);const E=F.arrow?.x,P=F.arrow?.y,R=F.arrow?.centerOffset!==0,[A,O]=m.useState();return Qt(()=>{w&&O(window.getComputedStyle(w).zIndex)},[w]),h.jsx("div",{ref:D.setFloating,"data-radix-popper-content-wrapper":"",style:{...J,transform:Z?J.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:A,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:h.jsx(M_,{scope:n,placedSide:ae,onArrowChange:S,arrowX:E,arrowY:P,shouldHideArrow:R,children:h.jsx(nn.div,{"data-side":ae,"data-align":ve,...y,ref:b,style:{...y.style,animation:Z?void 0:"none"}})})})});qp.displayName=Ll;var Vp="PopperArrow",D_={top:"bottom",right:"left",bottom:"top",left:"right"},Kp=m.forwardRef(function(e,n){const{__scopePopper:r,...o}=e,s=z_(Vp,r),i=D_[s.placedSide];return h.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:h.jsx(j_,{...o,ref:n,style:{...o.style,display:"block"}})})});Kp.displayName=Vp;function L_(t){return t!==null}var B_=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=Xp(n),d={start:"0%",center:"50%",end:"100%"}[u],f=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let g="",y="";return c==="bottom"?(g=i?d:`${f}px`,y=`${-l}px`):c==="top"?(g=i?d:`${f}px`,y=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,y=i?d:`${p}px`):c==="left"&&(g=`${r.floating.width+l}px`,y=i?d:`${p}px`),{data:{x:g,y}}}});function Xp(t){const[e,n="center"]=t.split("-");return[e,n]}var F_=Hp,U_=Gp,H_=qp,W_=Kp,G_="Portal",Jp=m.forwardRef((t,e)=>{const{container:n,...r}=t,[o,s]=m.useState(!1);Qt(()=>s(!0),[]);const i=n||o&&globalThis?.document?.body;return i?nf.createPortal(h.jsx(nn.div,{...r,ref:e}),i):null});Jp.displayName=G_;function q_(t,e){return m.useReducer((n,r)=>e[n][r]??n,t)}var Bl=t=>{const{present:e,children:n}=t,r=V_(e),o=typeof n=="function"?n({present:r.isPresent}):m.Children.only(n),s=On(r.ref,K_(o));return typeof n=="function"||r.isPresent?m.cloneElement(o,{ref:s}):null};Bl.displayName="Presence";function V_(t){const[e,n]=m.useState(),r=m.useRef(null),o=m.useRef(t),s=m.useRef("none"),i=t?"mounted":"unmounted",[a,l]=q_(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return m.useEffect(()=>{const c=Lo(r.current);s.current=a==="mounted"?c:"none"},[a]),Qt(()=>{const c=r.current,u=o.current;if(u!==t){const f=s.current,p=Lo(c);t?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),Qt(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const y=Lo(r.current).includes(p.animationName);if(p.target===e&&y&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},f=p=>{p.target===e&&(s.current=Lo(r.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:m.useCallback(c=>{r.current=c?getComputedStyle(c):null,n(c)},[])}}function Lo(t){return t?.animationName||"none"}function K_(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var X_=Es[" useInsertionEffect ".trim().toString()]||Qt;function J_({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[o,s,i]=Y_({defaultProp:e,onChange:n}),a=t!==void 0,l=a?t:o;{const u=m.useRef(t!==void 0);m.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,r])}const c=m.useCallback(u=>{if(a){const d=Z_(u)?u(t):u;d!==t&&i.current?.(d)}else s(u)},[a,t,s,i]);return[l,c]}function Y_({defaultProp:t,onChange:e}){const[n,r]=m.useState(t),o=m.useRef(n),s=m.useRef(e);return X_(()=>{s.current=e},[e]),m.useEffect(()=>{o.current!==n&&(s.current?.(n),o.current=n)},[n,o]),[n,r,s]}function Z_(t){return typeof t=="function"}var Q_=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),eC="VisuallyHidden",Yp=m.forwardRef((t,e)=>h.jsx(nn.span,{...t,ref:e,style:{...Q_,...t.style}}));Yp.displayName=eC;var tC=Yp,[Us,uR]=$p("Tooltip",[Fp]),Hs=Fp(),Zp="TooltipProvider",nC=700,ka="tooltip.open",[rC,Fl]=Us(Zp),Qp=t=>{const{__scopeTooltip:e,delayDuration:n=nC,skipDelayDuration:r=300,disableHoverableContent:o=!1,children:s}=t,i=m.useRef(!0),a=m.useRef(!1),l=m.useRef(0);return m.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),h.jsx(rC,{scope:e,isOpenDelayedRef:i,delayDuration:n,onOpen:m.useCallback(()=>{window.clearTimeout(l.current),i.current=!1},[]),onClose:m.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.current=!0,r)},[r]),isPointerInTransitRef:a,onPointerInTransitChange:m.useCallback(c=>{a.current=c},[]),disableHoverableContent:o,children:s})};Qp.displayName=Zp;var io="Tooltip",[oC,vo]=Us(io),em=t=>{const{__scopeTooltip:e,children:n,open:r,defaultOpen:o,onOpenChange:s,disableHoverableContent:i,delayDuration:a}=t,l=Fl(io,t.__scopeTooltip),c=Hs(e),[u,d]=m.useState(null),f=O_(),p=m.useRef(0),g=i??l.disableHoverableContent,y=a??l.delayDuration,v=m.useRef(!1),[w,_]=J_({prop:r,defaultProp:o??!1,onChange:C=>{C?(l.onOpen(),document.dispatchEvent(new CustomEvent(ka))):l.onClose(),s?.(C)},caller:io}),b=m.useMemo(()=>w?v.current?"delayed-open":"instant-open":"closed",[w]),x=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,v.current=!1,_(!0)},[_]),S=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,_(!1)},[_]),k=m.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{v.current=!0,_(!0),p.current=0},y)},[y,_]);return m.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),h.jsx(F_,{...c,children:h.jsx(oC,{scope:e,contentId:f,open:w,stateAttribute:b,trigger:u,onTriggerChange:d,onTriggerEnter:m.useCallback(()=>{l.isOpenDelayedRef.current?k():x()},[l.isOpenDelayedRef,k,x]),onTriggerLeave:m.useCallback(()=>{g?S():(window.clearTimeout(p.current),p.current=0)},[S,g]),onOpen:x,onClose:S,disableHoverableContent:g,children:n})})};em.displayName=io;var Pa="TooltipTrigger",tm=m.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=vo(Pa,n),s=Fl(Pa,n),i=Hs(n),a=m.useRef(null),l=On(e,a,o.onTriggerChange),c=m.useRef(!1),u=m.useRef(!1),d=m.useCallback(()=>c.current=!1,[]);return m.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),h.jsx(U_,{asChild:!0,...i,children:h.jsx(nn.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...r,ref:l,onPointerMove:Pt(t.onPointerMove,f=>{f.pointerType!=="touch"&&!u.current&&!s.isPointerInTransitRef.current&&(o.onTriggerEnter(),u.current=!0)}),onPointerLeave:Pt(t.onPointerLeave,()=>{o.onTriggerLeave(),u.current=!1}),onPointerDown:Pt(t.onPointerDown,()=>{o.open&&o.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:Pt(t.onFocus,()=>{c.current||o.onOpen()}),onBlur:Pt(t.onBlur,o.onClose),onClick:Pt(t.onClick,o.onClose)})})});tm.displayName=Pa;var Ul="TooltipPortal",[sC,iC]=Us(Ul,{forceMount:void 0}),nm=t=>{const{__scopeTooltip:e,forceMount:n,children:r,container:o}=t,s=vo(Ul,e);return h.jsx(sC,{scope:e,forceMount:n,children:h.jsx(Bl,{present:n||s.open,children:h.jsx(Jp,{asChild:!0,container:o,children:r})})})};nm.displayName=Ul;var vr="TooltipContent",rm=m.forwardRef((t,e)=>{const n=iC(vr,t.__scopeTooltip),{forceMount:r=n.forceMount,side:o="top",...s}=t,i=vo(vr,t.__scopeTooltip);return h.jsx(Bl,{present:r||i.open,children:i.disableHoverableContent?h.jsx(om,{side:o,...s,ref:e}):h.jsx(aC,{side:o,...s,ref:e})})}),aC=m.forwardRef((t,e)=>{const n=vo(vr,t.__scopeTooltip),r=Fl(vr,t.__scopeTooltip),o=m.useRef(null),s=On(e,o),[i,a]=m.useState(null),{trigger:l,onClose:c}=n,u=o.current,{onPointerInTransitChange:d}=r,f=m.useCallback(()=>{a(null),d(!1)},[d]),p=m.useCallback((g,y)=>{const v=g.currentTarget,w={x:g.clientX,y:g.clientY},_=hC(w,v.getBoundingClientRect()),b=fC(w,_),x=pC(y.getBoundingClientRect()),S=gC([...b,...x]);a(S),d(!0)},[d]);return m.useEffect(()=>()=>f(),[f]),m.useEffect(()=>{if(l&&u){const g=v=>p(v,u),y=v=>p(v,l);return l.addEventListener("pointerleave",g),u.addEventListener("pointerleave",y),()=>{l.removeEventListener("pointerleave",g),u.removeEventListener("pointerleave",y)}}},[l,u,p,f]),m.useEffect(()=>{if(i){const g=y=>{const v=y.target,w={x:y.clientX,y:y.clientY},_=l?.contains(v)||u?.contains(v),b=!mC(w,i);_?f():b&&(f(),c())};return document.addEventListener("pointermove",g),()=>document.removeEventListener("pointermove",g)}},[l,u,i,c,f]),h.jsx(om,{...t,ref:s})}),[lC,cC]=Us(io,{isInside:!1}),uC=m_("TooltipContent"),om=m.forwardRef((t,e)=>{const{__scopeTooltip:n,children:r,"aria-label":o,onEscapeKeyDown:s,onPointerDownOutside:i,...a}=t,l=vo(vr,n),c=Hs(n),{onClose:u}=l;return m.useEffect(()=>(document.addEventListener(ka,u),()=>document.removeEventListener(ka,u)),[u]),m.useEffect(()=>{if(l.trigger){const d=f=>{f.target?.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),h.jsx(zp,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:h.jsxs(H_,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[h.jsx(uC,{children:r}),h.jsx(lC,{scope:n,isInside:!0,children:h.jsx(tC,{id:l.contentId,role:"tooltip",children:o||r})})]})})});rm.displayName=vr;var sm="TooltipArrow",dC=m.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=Hs(n);return cC(sm,n).isInside?null:h.jsx(W_,{...o,...r,ref:e})});dC.displayName=sm;function hC(t,e){const n=Math.abs(e.top-t.y),r=Math.abs(e.bottom-t.y),o=Math.abs(e.right-t.x),s=Math.abs(e.left-t.x);switch(Math.min(n,r,o,s)){case s:return"left";case o:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function fC(t,e,n=5){const r=[];switch(e){case"top":r.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":r.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":r.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":r.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return r}function pC(t){const{top:e,right:n,bottom:r,left:o}=t;return[{x:o,y:e},{x:n,y:e},{x:n,y:r},{x:o,y:r}]}function mC(t,e){const{x:n,y:r}=t;let o=!1;for(let s=0,i=e.length-1;s<e.length;i=s++){const a=e[s],l=e[i],c=a.x,u=a.y,d=l.x,f=l.y;u>r!=f>r&&n<(d-c)*(r-u)/(f-u)+c&&(o=!o)}return o}function gC(t){const e=t.slice();return e.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),yC(e)}function yC(t){if(t.length<=1)return t.slice();const e=[];for(let r=0;r<t.length;r++){const o=t[r];for(;e.length>=2;){const s=e[e.length-1],i=e[e.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))e.pop();else break}e.push(o)}e.pop();const n=[];for(let r=t.length-1;r>=0;r--){const o=t[r];for(;n.length>=2;){const s=n[n.length-1],i=n[n.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))n.pop();else break}n.push(o)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}var vC=Qp,wC=em;const bC={"":m.Fragment,pre:"pre",code:"code",ol:"ol",ul:"ul",hr:"hr",blockquote:"blockquote",li:"li",a:"a",img:"img",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",p:"p",em:"em",strong:"strong"},pu=t=>t.replace(RegExp("^"+(t.match(/^(\t| )+/)||"")[0],"gm"),""),xC=t=>t&&typeof t!="string"&&["div","ul","ol","pre","h1","h2","h3","h4","h5","h6"].includes(t.t),Oi=t=>t.replace(/^\s+|\s+$/g," "),xe=(t,e=[],n={})=>({t,c:Array.isArray(e)?e:[e],p:n}),Ur=(t,e=!1)=>{let n=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,r=0;const o=xe("");let s,i;e?(s=xe("p"),i=[o,s],o.c.push(s)):(s=o,i=[o]);let a;const l=(d,f=!0)=>(f&&i.push(d),s.c.push(d),f&&(s=d),d),c=d=>{const f=i.findIndex(p=>p.t===d);i=i.slice(0,f),s=i.at(-1)};for(;a=n.exec(t);){const d=t.substring(r,a.index);if(r=n.lastIndex,d!=="")if(s===o&&e){const f=xe("p",Oi(d));o.c.push(f),i=[o,f],s=f}else s.c.push(Oi(d));if(!d.match(/[^\\](\\\\)*\\$/)){if(a[3]||a[4]){const f=xe("pre",a[4]?pu(a[4]):xe("code",pu(a[3]),a[2]?{language:`language-${a[2].toLowerCase()}`}:{}));o.c.push(f),i=[o],s=o}else if(a[6]){const f=a[6],p=f!==">",g=!!f.match(/\./),y=p?g?"ol":"ul":"blockquote",v=a[5].split(`
`).map(_=>_.replace(/^(\*|-|\+|>|\d+\.)\s+/,"")).filter(_=>_.trim()!==""),w=xe(y,p?v.map(_=>xe("li",Ur(_).c)):Ur(v.join(`
`)).c);o.c.push(w),i=[o,w],s=o}else if(a[8]){const f=xe("img",[],{src:a[8],...a[7]?{alt:a[7]}:{}});if(e&&s===o){const p=xe("p",f);o.c.push(p),s=p,i=[o,p]}else l(f,!1)}else if(a[10]){const f=i.find(p=>p.t==="a");f&&(f.p.href=a[11])}else if(a[9])l(xe("a"));else if(a[14]){const f="h"+a[14].length;o.c.push(xe(f,Ur(a[15]).c)),i=[o],s=o}else if(a[13])o.c.push(xe("h1",Ur(a[12]).c)),i=[o],s=o;else if(a[16])l(xe("code",a[16]),!1);else if(a[17]?.[0]===`
`||a[17]===`  
`){if(!(i[1]?.t==="p")){const g=o.c;let y;for(y=g.length-1;y>=0&&!xC(g[y]);y--);if(y!==o.c.length-1){const v=o.c.splice(y+1);o.c.push(xe("p",v))}}const p=xe("p");o.c.push(p),i=[o,p],s=p}else if(a[1])o.c.push(xe("hr")),i=[o],s=o;else if(a[17]){const f=a[17].length===2?"strong":"em";i.findIndex(g=>g.t===f)===-1?l(xe(f)):c(f)}}}const u=Oi(t.substring(r));if(u.length){const d=o.c.at(-1);let f;d?.t==="p"?f=d:e?(f=xe("p"),o.c.push(f)):f=o,f.c.push(u)}return o.c=o.c.filter(d=>typeof d=="string"||d.t!=="p"||d.c?.length>0),o},_C=(t,e={})=>{const n={...bC,...e},r=(o,s=0)=>{const i=o.t===""?m.Fragment:n[o.t];return m.createElement(i,{...o.p,key:s},o.c.length===0?void 0:o.c.map((a,l)=>typeof a=="string"?a:r(a,l)))};return r(Ur(t,!0))},CC=({markdown:t,customComponents:e})=>_C(t,e),Bo="leading-none [&_[class*='texture-hud']]:mb-oneScaledPix",SC={h2:function({children:e}){return h.jsx("h2",{className:`mb-1 sprites-double-height text-metallicBlue zx:text-zxBlue clear-both ${Bo}`,children:h.jsx(tt,{children:e})})},h3:function({children:e}){return h.jsx("h3",{className:"mt-1 mb-1 text-metallicBlue zx:text-zxBlue clear-both",children:h.jsx(tt,{children:e})})},blockquote:function({children:e}){return h.jsx("blockquote",{className:`${Bo} mt-1 mb-1 text-moss zx:text-zxBlue clear-both`,children:h.jsxs(tt,{children:["> ",e]})})},p:function({children:e}){return h.jsx("div",{className:`mb-1 last:mb-0 ${Bo}`,children:h.jsx(tt,{children:e})})},a:function({children:e,href:n}){return h.jsx("a",{className:"bitmap-text-link",href:n,target:"_blank",rel:"noopener noreferrer",children:h.jsx(tt,{children:e})})},li:function({children:e}){return h.jsx("div",{className:`mb-1 clear-both ${Bo}`,children:h.jsxs(tt,{children:[h.jsx(I,{className:"text-metallicBlue zx:text-zxYellow",children:"•"}),e]})})},strong:function({children:e}){return h.jsx(tt,{className:"strong text-midRed zx:text-zxRed",children:e})},em:function({children:e}){return h.jsx(tt,{className:"em text-moss zx:text-zxBlue",children:e})},img:function({src:e}){const n=ah();if(e===void 0)throw new Error("image without src");const r=e.split(/\?|&/);return h.jsx("span",{style:{"--scale":n*2},children:h.jsx("span",{className:gl("sprite float-left mr-1 mb-1 zx:sprite-revert-to-two-tone",r.join(" "))})})},hr:function(){return h.jsx("hr",{className:"bg-metallicBlue zx:bg-zxWhite h-half mb-half border-none"})}},kC=({markdown:t,className:e})=>h.jsx("div",{className:`contents ${e}`,children:h.jsx(CC,{customComponents:SC,markdown:t})}),Hl=({triggerContent:t,tooltipContent:e})=>e?h.jsxs(wC,{children:[h.jsx(tm,{asChild:!0,children:t}),h.jsx(nm,{children:h.jsx(Ds,{scaleFactor:2,children:h.jsx(rm,{side:"bottom",align:"end",className:"bg-highlightBeige text-white p-1 mt-oneScaledPix drop-shadow-oneBlock z-popups",children:typeof e=="string"?h.jsx("div",{className:"max-w-16",children:h.jsx(kC,{markdown:e})}):e})})})]}):t,PC=/^(?<modifiers>[⇧⌘^⌥]*)(?<key>.+)$/,EC=t=>{const e=new Set;for(const n of t){if(e.has(n))return!0;e.add(n)}return!1},Wl=(t,e,n)=>{const r=t?.join(" ");m.useEffect(()=>{if(!t||t.length===0)return;const o=s=>{if(s.target.closest(".monaco-editor")===null)for(const l of t){const c=l.match(PC);if(!c||!c.groups)continue;const{modifiers:u,key:d}=c.groups;if(EC(u)){console.warn(`Invalid shortcut "${l}": duplicate modifiers`);continue}const f=u.includes("^"),p=u.includes("⌘"),g=u.includes("⇧"),y=u.includes("⌥"),v=f||p||g||y,w=f===s.ctrlKey&&p===s.metaKey&&g===s.shiftKey&&y===s.altKey&&(v||!s.ctrlKey&&!s.metaKey&&!s.shiftKey&&!s.altKey);if((y&&s.altKey?s.code.replace(/^Key/,"").toLowerCase():s.key.toLowerCase())===d.toLowerCase()&&w){e||n?.(),s.preventDefault();break}}};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e,n,r])},im=t=>t.replace(/ArrowLeft/g,"⬅").replace(/ArrowRight/g,"➡").replace(/ArrowUp/g,"⬆").replace(/ArrowDown/g,"⬇"),AC=t=>{const e=t.map(im);return e.length===1?`

Hotkey: **${e[0]}**`:`

Hotkeys: ${e.map(n=>`**${n}**`).join(" or ")}`},Gl=(t,e)=>{if(!e)return t;if(t)return`${t}${AC(e)}`;const n=e.map(im);return n.length===1?`Hotkey: **${n[0]}**`:`Hotkeys: ${n.map(r=>`**${r}**`).join(" or ")}`},ur=({className:t,selected:e,disabled:n=!1,onClick:r,ref:o,tooltipContent:s,shortcutKeys:i,...a})=>{Wl(i,n,r);const l=h.jsx("button",{disabled:n,onClick:r,"data-selected":e,className:Ae(`inline-flex items-center justify-center whitespace-nowrap 
          bg-metallicBlue zx:bg-zxBlue border-none border-shadow
          gap-2
           disabled:bg-midGrey disabled:text-lightGrey 
           data-[selected=true]:bg-lightBeige
           [&:not(:disabled):hover:not([data-selected=true])]:bg-pastelBlue 
           `,t),ref:o,...a}),c=Gl(typeof s=="string"?s:void 0,i)??s;return h.jsx(Hl,{triggerContent:l,tooltipContent:c})};var mu=!1,hn,Ea,Aa,ns,rs,am,os,Ta,Ra,Oa,lm,Ia,ja,cm,um;function De(){if(!mu){mu=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),n=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(Ia=/\b(iPhone|iP[ao]d)/.exec(t),ja=/\b(iP[ao]d)/.exec(t),Oa=/Android/i.exec(t),cm=/FBAN\/\w+;/i.exec(t),um=/Mobile/i.exec(t),lm=!!/Win64/.exec(t),e){hn=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN,hn&&document&&document.documentMode&&(hn=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(t);am=r?parseFloat(r[1])+4:hn,Ea=e[2]?parseFloat(e[2]):NaN,Aa=e[3]?parseFloat(e[3]):NaN,ns=e[4]?parseFloat(e[4]):NaN,ns?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),rs=e&&e[1]?parseFloat(e[1]):NaN):rs=NaN}else hn=Ea=Aa=rs=ns=NaN;if(n){if(n[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);os=o?parseFloat(o[1].replace("_",".")):!0}else os=!1;Ta=!!n[2],Ra=!!n[3]}else os=Ta=Ra=!1}}var $a={ie:function(){return De()||hn},ieCompatibilityMode:function(){return De()||am>hn},ie64:function(){return $a.ie()&&lm},firefox:function(){return De()||Ea},opera:function(){return De()||Aa},webkit:function(){return De()||ns},safari:function(){return $a.webkit()},chrome:function(){return De()||rs},windows:function(){return De()||Ta},osx:function(){return De()||os},linux:function(){return De()||Ra},iphone:function(){return De()||Ia},mobile:function(){return De()||Ia||ja||Oa||um},nativeApp:function(){return De()||cm},android:function(){return De()||Oa},ipad:function(){return De()||ja}},TC=$a,RC=!!(typeof window<"u"&&window.document&&window.document.createElement),OC={canUseDOM:RC},dm=OC,hm;dm.canUseDOM&&(hm=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);function IC(t,e){if(!dm.canUseDOM||e&&!("addEventListener"in document))return!1;var n="on"+t,r=n in document;if(!r){var o=document.createElement("div");o.setAttribute(n,"return;"),r=typeof o[n]=="function"}return!r&&hm&&t==="wheel"&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var jC=IC,gu=10,yu=40,vu=800;function fm(t){var e=0,n=0,r=0,o=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*gu,o=n*gu,"deltaY"in t&&(o=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||o)&&t.deltaMode&&(t.deltaMode==1?(r*=yu,o*=yu):(r*=vu,o*=vu)),r&&!e&&(e=r<1?-1:1),o&&!n&&(n=o<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:o}}fm.getEventType=function(){return TC.firefox()?"DOMMouseScroll":jC("wheel")?"wheel":"mousewheel"};var $C=fm;/**
* Checks if an event is supported in the current execution environment.
*
* NOTE: This will not work correctly for non-generic events such as `change`,
* `reset`, `load`, `error`, and `select`.
*
* Borrows from Modernizr.
*
* @param {string} eventNameSuffix Event name, e.g. "click".
* @param {?boolean} capture Check if the capture phase is supported.
* @return {boolean} True if the event is supported.
* @internal
* @license Modernizr 3.0.0pre (Custom Build) | MIT
*/const NC=(t,e,n=!1)=>{const r=m.useRef(0),o=m.useCallback(s=>{if(n)return;const i=s;i.preventDefault(),i.stopPropagation();const a=$C(i);r.current-=a.spinY,r.current>=1&&(e(1),r.current=0),r.current<=-1&&(e(-1),r.current=0)},[e,n]);m.useEffect(()=>{const s=t.current;if(s!==null)return s.addEventListener("wheel",o,{passive:!1}),()=>{s.removeEventListener("wheel",o)}},[t,o])},pm=(t,e,n,r=!1)=>{const o=m.useRef(0);return NC(t,s=>{if(e.length===0)return;const i=(o.current+s+256*e.length)%e.length;o.current=i,n(e[i],i)},r)},MC=({value:t,onSelect:e})=>h.jsx(Bs,{value:t,onSelect:e,className:"px-1",children:h.jsx(I,{children:t})}),Ws=t=>{const{value:e,values:n,onSelect:r,triggerButtonClassName:o="",triggerButtonStyle:s=he,triggerButtonLabel:i="",OptionCommandItem:a=MC,tooltipContent:l}=t,[c,u]=m.useState(!1),d=m.useRef(null);return pm(d,n,f=>{r(f)},!c),h.jsxs(ip,{open:c,onOpenChange:u,children:[h.jsx(ap,{asChild:!0,children:h.jsxs(ur,{className:Ae("h-2 px-1 flex flex-row gap-1 justify-start leading-none",o),style:s,ref:d,tooltipContent:!c&&l,children:[typeof i=="string"?h.jsx(I,{className:"grow overflow-hidden text-left",children:i}):i,h.jsx(I,{className:"grow-0",children:c?"X":"⬇"})]})}),h.jsx(lp,{className:"p-0",children:h.jsx(Ds,{scaleFactor:2,children:h.jsxs(Ap,{value:e,className:"w-[--radix-popper-anchor-width]",children:[t.disableCommandInput===!0?null:h.jsx(Tp,{placeholder:t.placeholder}),h.jsxs(Rp,{children:[h.jsx(Op,{children:h.jsx(I,{children:"Nothing found"})}),h.jsx(Ip,{children:n.map(f=>h.jsx(a,{value:f,onSelect:p=>{u(!1),r(p)}},f))})]})]})})})]})},zC=()=>{const t=He(),e=lh();return h.jsx(h.Fragment,{children:h.jsx(Ws,{value:e,values:sy,onSelect:n=>{t(iy(n))},disableCommandInput:!0,triggerButtonLabel:e,triggerButtonClassName:"w-13"})})};function mm({campaign:t,onSelect:e,headRoomId:n,heelsRoomId:r,value:o,triggerButtonClassName:s,excludeRoomIds:i=[],tooltipContent:a}){const l=Object.keys(t.rooms).filter(c=>!i.includes(c));return h.jsx(Ws,{onSelect:c=>e?.(c),value:o,values:l,triggerButtonClassName:s,placeholder:"search",tooltipContent:a,disableCommandInput:!1,triggerButtonLabel:o??"none",OptionCommandItem:({value:c,onSelect:u})=>h.jsxs(Bs,{value:c,onSelect:u,className:"px-1",children:[n===c&&h.jsx("span",{className:"sprite mr-1 my-1 texture-head_walking_towards_2"}),r===c&&h.jsx("span",{className:"sprite mr-1 my-1 texture-heels_walking_towards_2"}),h.jsx(I,{children:c})]})})}const ye=t=>t,gm="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",DC="h-[calc(2*var(--block)-1px*var(--scale))] w-[calc(2*var(--block)-1px*var(--scale))]",W=ye("[button:not([data-selected=true]):not(:hover)_&]:sprite-revert-to-two-tone-dim"),Te=ye("flex flex-wrap gap-oneScaledPix w-full"),se=({className:t,onClick:e,children:n,disabled:r=!1,isCurrentTool:o=!1,shortcutKeys:s,small:i=!1,tooltipContent:a})=>h.jsx(ur,{disabled:r,selected:o,className:`
        ${i?DC:gm} 
        ${i?"leading-none":""} 
        active:pt-oneScaledPix gap-0 inline-flex overflow-hidden 
        
        ${t??""}`,onClick:e,tooltipContent:a,shortcutKeys:s,children:n}),LC=()=>{const t=fe(e=>e.levelEditor.selectedJsonItemIds.length>0);return h.jsx(se,{className:"bg-midRed",disabled:!t,onClick:()=>U.dispatch(By()),shortcutKeys:["Delete","Backspace"],tooltipContent:`## Delete items
delete selected item(s)`,children:h.jsx("span",{className:"sprite sprite-tinted texture-hud_char_X relative"})})},wr=({className:t,value:e,onChange:n,trueLabel:r="ON",falseLabel:o="OFF",label:s,shortcutKeys:i,tooltipContent:a})=>{const l=Math.max(r.length,o.length)+1,c=r.padStart(l," "),u=o.padEnd(l," ");Wl(i,!1,()=>{n?.(!e,void 0)});const d=h.jsxs("span",{onClick:p=>n?.(!e,p),className:Ae("inline-flex justify-between",t),children:[s&&h.jsx(I,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),h.jsx(I,{className:Ol("inline-block w-min h-min",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:e?c:u})]}),f=Gl(typeof a=="string"?a:void 0,i)??a;return h.jsx(Hl,{triggerContent:d,tooltipContent:f})},BC=({className:t,value:e,onChange:n,values:r,valueLabels:o=[`${r[0]}`,`${r[1]}`,`${r[2]}`],label:s,shortcutKeys:i,tooltipContent:a})=>{const l=r.indexOf(e),c=Math.max(o[0].length,o[1].length+2,o[2].length)+1,u=m.useCallback(()=>{const p=(l+1)%3;n?.(r[p],void 0)},[n,l,r]);Wl(i,!1,()=>{u()});const d=h.jsxs("span",{onClick:u,className:Ae("inline-flex justify-between",t),children:[s&&h.jsx(I,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),h.jsx(I,{className:Ol("inline-block w-min h-min",l===0?"bg-redShadowHalfbrite text-highlightBeige zx:bg-zxBlack zx:text-zxGreen":l===1?"bg-metallicBlueHalfbrite text-pastelBlue zx:bg-zxBlack zx:text-zxBlue":"bg-pinkHalfbrite text-pink zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:l===0?o[0].padEnd(c," "):l===1?o[1].padStart(Math.ceil((c+o[1].length)/2)," ").padEnd(c," "):o[2].padStart(c," ")})]}),f=Gl(typeof a=="string"?a:void 0,i)??a;return h.jsx(Hl,{triggerContent:d,tooltipContent:f})},FC=({className:t})=>{const e=He();return h.jsx(BC,{className:t,label:"snap",values:Fy,value:fe(n=>n.levelEditor.gridResolution),onChange:n=>{e(Uy(n))},valueLabels:["block","half","fine"],shortcutKeys:["S"],tooltipContent:`snaps to either the grid (like the original game)

or, on a half-block grid

or to a fine 2px resolution`})},ym=t=>{const e=fe(mn);return Ge(e?.type==="item"&&e.item,t)},$=({itemTool:t,children:e,className:n,shortcutKeys:r,tooltipContent:o})=>{const s=ym(t);return h.jsx(se,{isCurrentTool:s,className:n,onClick:()=>U.dispatch(vn({type:"item",item:t})),shortcutKeys:r,tooltipContent:o,children:e})},ql=({main:t,children:e,closeOnSelect:n,ref:r})=>{const[o,s]=m.useState(!1);return h.jsxs(ip,{open:o,onOpenChange:s,children:[h.jsx("div",{ref:r,className:Ae(gm,"relative",{"drop-shadow-oneBlock z-popups":o}),children:h.jsxs("span",{className:"content",children:[t,h.jsx(ap,{asChild:!0,children:h.jsx(ur,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:h.jsx(I,{className:"pl-oneScaledPix leading-none py-oneScaledPix",children:o?"X":"⬇"})})})]})}),h.jsx(lp,{children:h.jsx(Ds,{scaleFactor:2,children:h.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:e.map((i,a)=>i===null?null:h.jsx("div",{className:"leading-none",onClick:()=>{n&&s(!1)},children:i},a))})})})]})},Dr=({children:t})=>{const[e,n]=m.useState(0),r=m.useRef(null);pm(r,t,(s,i)=>{n(i)});const o=t[e];return h.jsx(ql,{main:o,closeOnSelect:!0,ref:r,children:t.map((s,i)=>i===e?null:h.jsx("div",{className:"leading-none",onClick:()=>{n(i)},children:s},i))})},UC=()=>{const e=fe(mn)?.type==="pointer";return h.jsx(se,{onClick:()=>U.dispatch(vn({type:"pointer"})),isCurrentTool:e,shortcutKeys:["Escape","."],tooltipContent:"## Pointer",children:h.jsx("span",{className:"sprite texture-editor_tool_pointer relative"})})},N={pureBlack:new G("#000000"),shadow:new G("#325149"),midGrey:new G("#7F7773"),lightGrey:new G("#BBB1AB"),white:new G("#FBFEFB"),pastelBlue:new G("#75ACFF"),metallicBlue:new G("#366CAA"),pink:new G("#D68ED1"),moss:new G("#9E9600"),redShadow:new G("#805E50"),midRed:new G("#CA7463"),lightBeige:new G("#DAA78F"),highlightBeige:new G("#EBC690"),alpha:new G("#1E7790"),replaceLight:new G("#08A086"),replaceDark:new G("#0A4730")},Jr=.4,vm=t=>{const[e,n,r]=t.toUint8RgbArray();return new G({r:e*.75,g:n*.75,b:r*.75})},br=(t,e=Jr)=>{const[n,r,o]=t.toUint8RgbArray();return new G({r:n*e,g:r*e,b:o*e})};function dR(t){t=t.replace(/^#/,"");let e=parseInt(t.substring(0,2),16),n=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16);e=Math.floor(e*Jr),n=Math.floor(n*Jr),r=Math.floor(r*Jr);const o=s=>s.toString(16).padStart(2,"0");return`#${o(e)}${o(n)}${o(r)}`}const Ze={original:new G(kr.zxWhite),basic:N.white,dimmed:N.lightGrey},Qe={original:new G(kr.zxYellow),basic:new G(15654246),dimmed:br(new G(15654246),.5)},wm={original:new G(kr.zxYellow),basic:N.midRed,dimmed:N.redShadow},ct={original:new G(kr.zxMagenta),basic:N.pink,dimmed:br(N.pink,.5)},_e={original:new G(kr.zxCyan),basic:N.pastelBlue,dimmed:br(N.pastelBlue,.5)},ut={original:new G(kr.zxGreen),basic:N.moss,dimmed:br(N.moss,.5)},Gs={white:{basic:{main:Ze,edges:{towards:{..._e,dimInOriginal:!1},right:{...Qe,dimInOriginal:!0}},hud:{lives:Qe,dimmed:ct,icons:_e}},dimmed:{main:Ze,edges:{towards:{...ut,dimInOriginal:!1},right:{..._e,dimInOriginal:!0}},hud:{lives:wm,dimmed:ct,icons:_e}}},yellow:{basic:{main:Qe,edges:{towards:{...ut,dimInOriginal:!1},right:{...Ze,dimInOriginal:!0}},hud:{lives:_e,dimmed:ct,icons:ut}},dimmed:{main:Qe,edges:{towards:{..._e,dimInOriginal:!0},right:{..._e,dimInOriginal:!1}},hud:{lives:_e,dimmed:ct,icons:ut}}},magenta:{basic:{main:ct,edges:{towards:{...ut,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Ze,dimmed:_e,icons:Qe}},dimmed:{main:ct,edges:{towards:{...ut,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Ze,dimmed:_e,icons:Qe}}},cyan:{basic:{main:_e,edges:{towards:{...ct,dimInOriginal:!1},right:{...Ze,dimInOriginal:!1}},hud:{lives:Ze,dimmed:ut,icons:Qe}},dimmed:{main:_e,edges:{towards:{...ct,dimInOriginal:!0},right:{...Ze,dimInOriginal:!0}},hud:{lives:Ze,dimmed:ut,icons:Qe}}},green:{basic:{main:ut,edges:{towards:{..._e,dimInOriginal:!1},right:{...Qe,dimInOriginal:!1}},hud:{lives:Ze,dimmed:ct,icons:_e}},dimmed:{main:ut,edges:{towards:{..._e,dimInOriginal:!0},right:{...Qe,dimInOriginal:!0}},hud:{lives:Ze,dimmed:ct,icons:_e}}}},bs=t=>Gs[t.hue][t.shade],nr={head:N.pastelBlue,heels:N.pink},wu=t=>{const{main:e}=Gs[t].basic;return{backgroundColor:e.basic.toHex(),borderColor:e.dimmed.toHex()}};function HC(){const t=He(),e=fe(Hy);return h.jsxs(h.Fragment,{children:[h.jsx(Ws,{value:e.hue,onSelect:n=>{t(cc({hue:n}))},values:ay,disableCommandInput:!0,OptionCommandItem:({value:n,onSelect:r})=>h.jsx(Bs,{value:n,className:"border-l-3 h-2 w-full p-0",style:wu(n),onSelect:r}),triggerButtonLabel:"colour",triggerButtonClassName:Ae("w-full",`${e.hue==="white"||e.hue==="yellow"?"text-pureBlack":"text-white"}`),triggerButtonStyle:wu(e.hue),tooltipContent:"Change the colour of this room"}),h.jsx(wr,{className:"",label:"shade",value:e.shade==="basic",onChange:n=>{t(cc({shade:n?"basic":"dimmed"}))},falseLabel:"dim",trueLabel:"basic"})]})}function WC(){const t=He(),e=fe(Wy);return h.jsx(Ws,{value:e,onSelect:n=>{t(Gy(n))},values:ly,placeholder:"scenery",triggerButtonClassName:"w-full",triggerButtonLabel:e,tooltipContent:"Change this room’s scenery"})}const _t=({iconClasses:t,text:e,className:n=""})=>h.jsxs("div",{className:`relative w-full h-full ${n}`,children:[h.jsx("span",{className:`sprite absolute top-0 left-0 ${t} ${W}`}),h.jsx(I,{className:"bg-moss text-pureBlack absolute top-0 left-0 pl-oneScaledPix py-oneScaledPix block leading-none",children:e})]}),Fo=({iconClassName:t})=>h.jsx(Ct,{topClasses:ye("texture-bubbles_white_2 [button:hover_&]:texture-animated-bubbles_white"),bottomClasses:t}),Ct=({topClasses:t,bottomClasses:e="texture-headlessBase"})=>h.jsxs("div",{className:"relative w-full h-full",children:[h.jsx("span",{className:`sprite absolute top-[calc(9px*var(--scale))] left-0 ${e} ${W}`}),h.jsx("span",{className:`sprite absolute top-[calc(-3px*var(--scale))] left-0 ${t} ${W}`})]}),GC="[button:not(:disabled):hover_&]:hidden",qC="hidden [button:not(:disabled):hover_&]:inline mt-quarter",VC="hidden [button:not(:disabled):hover_&]:inline",Na=({icon:t,topText:e,bottomText:n})=>h.jsxs("span",{className:"w-full h-full flex flex-col items-center justify-center",children:[h.jsx("span",{className:GC,children:t}),h.jsx(I,{className:qC,children:e}),h.jsx(I,{className:VC,children:n})]}),KC=()=>{const t=He(),e=fe(qy),n=fe(Vy);return h.jsxs("div",{className:"flex flex-row gap-oneScaledPix bg-metallicBlue",children:[h.jsx(se,{disabled:!e,onClick:()=>{t(Ky())},shortcutKeys:["⌘Z","^Z"],children:h.jsx(Na,{icon:h.jsx(I,{children:"⬅"}),topText:"un",bottomText:"do"})}),h.jsx(se,{disabled:!n,onClick:()=>{t(Xy())},shortcutKeys:["⌘⇧Z","^⇧Z"],children:h.jsx(Na,{icon:h.jsx(I,{children:"➡"}),topText:"re",bottomText:"do"})})]})},XC=({className:t})=>{const e=He();return h.jsx(wr,{className:t,label:"scenery",value:fe(n=>n.levelEditor.wallsFloorsLocked),onChange:n=>{e(Jy(n))},falseLabel:"edit",trueLabel:"lock",shortcutKeys:["C"],tooltipContent:"locks walls and floors, to edit their contents"})};function bu(t){return{type:"door",config:{direction:"away",toRoom:t?"+":"nowhere"}}}const JC=()=>{const[t,e]=m.useState(!0),n=fe(i=>fr(i).planet),r=ye(n==="moonbase"?"texture-door_frame_moonbase_x_whole":"texture-door_frame_generic_x_whole"),o=bu(t),s=ym(o);return h.jsx(ql,{main:h.jsx($,{itemTool:o,shortcutKeys:["D"],children:h.jsx(_t,{iconClasses:`sprite top-[calc(-17px*var(--scale))] left-[calc(-2px*var(--scale))] ${r} ${W}`,text:t?"+":""})}),children:[h.jsx(wr,{className:"w-full",value:t,label:"auto + room",onChange:i=>{e(i),s&&U.dispatch(vn({type:"item",item:bu(i)}))}},"autoAddDoor")]})},YC=()=>{const t=fe(r=>fr(r).planet),e={type:"wall",config:{direction:"away",tiles:Array.from(Yy(t,1))}},n=ye(t==="blacktooth"?"texture-blacktooth_wall_plain_away":t==="bookworld"?"texture-bookworld_wall_cowboy_away":t==="jail"?"texture-jail_wall_bars_away":t==="egyptus"?"texture-egyptus_wall_hieroglyphics_away":t==="market"?"texture-market_wall_passage_away":t==="moonbase"?"texture-moonbase_wall_window1_away":t==="penitentiary"?"texture-penitentiary_wall_loop_away":"texture-safari_wall_wall_away");return h.jsx($,{itemTool:e,children:h.jsx("span",{className:`sprite ${n} ${W}`})})},ZC=()=>h.jsx(se,{className:"bg-midRed",onClick:()=>U.dispatch(Zy()),tooltipContent:`## Clear room

Clears the room out, leaving just walls, floors, and doors`,children:h.jsx(I,{className:"relative leading-none",children:"CLR"})}),bm=({currentRoomId:t,direction:e})=>{const n=fe(({levelEditor:i})=>i.campaignInProgress),r=fe(({levelEditor:i})=>i.currentlyEditingRoomId),o=He(),s=e==="above"?"⬆":"⬇";return h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap pt-1 items-center",children:[h.jsxs(I,{className:"text-lightGrey leading-none h-1",children:["Room ",s]}),h.jsx("div",{className:"flex-grow"}),h.jsxs("div",{className:"flex flex-row gap-oneScaledPix",children:[h.jsx(se,{small:!0,className:"bg-highlightBeige w-max px-half",tooltipContent:`Switch to the room *${e}*`,disabled:!t,children:h.jsx(I,{onClick:()=>t&&o(hs(t)),children:`go ${s}`})}),h.jsx(se,{small:!0,className:" bg-moss",tooltipContent:`Add a new room *${e}* this one`,children:h.jsx(I,{onClick:()=>o(ii({direction:e,createNew:!0})),children:"+"})}),h.jsx(se,{small:!0,className:"bg-midRed",tooltipContent:`Break the link with the room *${e}*`,children:h.jsx(I,{onClick:()=>o(ii({direction:e,createNew:!1,roomId:void 0})),children:"x"})})]})]}),h.jsx("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap",children:h.jsx(mm,{value:t,campaign:n,excludeRoomIds:[r],triggerButtonClassName:"w-full",onSelect:i=>{o(ii({direction:e,createNew:!1,roomId:i}))},tooltipContent:`Select a room to place *${e}* this one`})})]})},QC=()=>{const t=fe(({levelEditor:e})=>ul(e).roomAbove);return h.jsx(h.Fragment,{children:h.jsx(bm,{currentRoomId:t,direction:"above"})})},eS=()=>{const t=fe(({levelEditor:e})=>ul(e).roomBelow);return h.jsx(h.Fragment,{children:h.jsx(bm,{currentRoomId:t,direction:"below"})})},tS=()=>{const t=fe(({levelEditor:e})=>e.tool.type==="eyeDropper");return h.jsx(se,{shortcutKeys:["I",","],isCurrentTool:t,onClick:()=>U.dispatch(vn({type:"eyeDropper"})),tooltipContent:`## eye-dropper

click on an item in the room to copy it and put a copy down somewhere else`,children:h.jsx("span",{className:"relative sprite texture-editor_tool_eyedropper leading-none"})})},qs=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const nS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Hr=Array.prototype.slice.call(nS),Uo=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(Hr),rS=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ss=String.fromCharCode.bind(String),xu=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),oS=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),xm=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),sS=t=>{let e,n,r,o,s="";const i=t.length%3;for(let a=0;a<t.length;){if((n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(o=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|o,s+=Hr[e>>18&63]+Hr[e>>12&63]+Hr[e>>6&63]+Hr[e&63]}return i?s.slice(0,i-3)+"===".substring(i):s},iS=typeof btoa=="function"?t=>btoa(t):qs?t=>Buffer.from(t,"binary").toString("base64"):sS,_u=qs?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let r=0,o=t.length;r<o;r+=4096)n.push(ss.apply(null,t.subarray(r,r+4096)));return iS(n.join(""))},aS=(t,e=!1)=>e?oS(_u(t)):_u(t),lS=t=>{if(t=t.replace(/\s+/g,""),!rS.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,o;for(let s=0;s<t.length;)e=Uo[t.charAt(s++)]<<18|Uo[t.charAt(s++)]<<12|(r=Uo[t.charAt(s++)])<<6|(o=Uo[t.charAt(s++)]),n+=r===64?ss(e>>16&255):o===64?ss(e>>16&255,e>>8&255):ss(e>>16&255,e>>8&255,e&255);return n},cS=typeof atob=="function"?t=>atob(xm(t)):qs?t=>Buffer.from(t,"base64").toString("binary"):lS,uS=qs?t=>xu(Buffer.from(t,"base64")):t=>xu(cS(t).split("").map(e=>e.charCodeAt(0))),dS=t=>uS(hS(t)),hS=t=>xm(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),fS=!0,_m="gzip",Cm=async t=>{const e=JSON.stringify(t),r=new TextEncoder().encode(e),o=new Blob([r]),s=new CompressionStream(_m),i=o.stream().pipeThrough(s),a=await new Response(i).arrayBuffer(),l=new Uint8Array(a);return aS(l,fS)},pS=async t=>{try{const e=dS(t),n=new Blob([e]),r=new DecompressionStream(_m),o=n.stream().pipeThrough(r),s=await new Response(o).text();return JSON.parse(s)}catch(e){throw new Error("error decompressing object",{cause:e})}},mS=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Gt(async()=>{const{default:r}=await Promise.resolve().then(()=>Rr);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)};class Vl extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class gS extends Vl{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Cu extends Vl{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Su extends Vl{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ma;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Ma||(Ma={}));var yS=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class vS{constructor(e,{headers:n={},customFetch:r,region:o=Ma.Any}={}){this.url=e,this.headers=n,this.region=o,this.fetch=mS(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,n={}){var r;return yS(this,void 0,void 0,function*(){try{const{headers:o,method:s,body:i}=n;let a={},{region:l}=n;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(a["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:u}).catch(y=>{throw new gS(y)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new Cu(d);if(!d.ok)throw new Su(d);let p=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return p==="application/json"?g=yield d.json():p==="application/octet-stream"?g=yield d.blob():p==="text/event-stream"?g=d:p==="multipart/form-data"?g=yield d.formData():g=yield d.text(),{data:g,error:null,response:d}}catch(o){return{data:null,error:o,response:o instanceof Su||o instanceof Cu?o.context:void 0}}})}}var Ce={},zn={},Dn={},Ln={},Bn={},Fn={},wS=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},xr=wS();const bS=xr.fetch,Sm=xr.fetch.bind(xr),km=xr.Headers,xS=xr.Request,_S=xr.Response,Rr=Object.freeze(Object.defineProperty({__proto__:null,Headers:km,Request:xS,Response:_S,default:Sm,fetch:bS},Symbol.toStringTag,{value:"Module"})),CS=cy(Rr);var Ho={},ku;function Pm(){if(ku)return Ho;ku=1,Object.defineProperty(Ho,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return Ho.default=t,Ho}var Pu;function Em(){if(Pu)return Fn;Pu=1;var t=Fn&&Fn.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Fn,"__esModule",{value:!0});const e=t(CS),n=t(Pm());class r{constructor(s){this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=s.headers,this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=s.shouldThrowOnError,this.signal=s.signal,this.isMaybeSingle=s.isMaybeSingle,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=Object.assign({},this.headers),this.headers[s]=i,this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,f;let p=null,g=null,y=null,v=c.status,w=c.statusText;if(c.ok){if(this.method!=="HEAD"){const S=await c.text();S===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=S:g=JSON.parse(S))}const b=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),x=(d=c.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");b&&x&&x.length>1&&(y=parseInt(x[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(p={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,y=null,v=406,w="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const b=await c.text();try{p=JSON.parse(b),Array.isArray(p)&&c.status===404&&(g=[],p=null,v=200,w="OK")}catch{c.status===404&&b===""?(v=204,w="No Content"):p={message:b}}if(p&&this.isMaybeSingle&&(!((f=p?.details)===null||f===void 0)&&f.includes("0 rows"))&&(p=null,v=200,w="OK"),p&&this.shouldThrowOnError)throw new n.default(p)}return{error:p,data:g,count:y,status:v,statusText:w}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,f;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(d=c?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(f=c?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,i)}returns(){return this}overrideTypes(){return this}}return Fn.default=r,Fn}var Eu;function Am(){if(Eu)return Bn;Eu=1;var t=Bn&&Bn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Bn,"__esModule",{value:!0});const e=t(Em());class n extends e.default{select(o){let s=!1;const i=(o??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(o,{ascending:s=!0,nullsFirst:i,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${o}.${s?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:s,referencedTable:i=s}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${o}`),this}range(o,s,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${o}`),this.url.searchParams.set(c,`${s-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:o=!1,verbose:s=!1,settings:i=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[o?"analyze":null,s?"verbose":null,i?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${f}"; options=${d};`,c==="json"?this:this}rollback(){var o;return((o=this.headers.Prefer)!==null&&o!==void 0?o:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Bn.default=n,Bn}var Au;function Kl(){if(Au)return Ln;Au=1;var t=Ln&&Ln.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ln,"__esModule",{value:!0});const e=t(Am());class n extends e.default{eq(o,s){return this.url.searchParams.append(o,`eq.${s}`),this}neq(o,s){return this.url.searchParams.append(o,`neq.${s}`),this}gt(o,s){return this.url.searchParams.append(o,`gt.${s}`),this}gte(o,s){return this.url.searchParams.append(o,`gte.${s}`),this}lt(o,s){return this.url.searchParams.append(o,`lt.${s}`),this}lte(o,s){return this.url.searchParams.append(o,`lte.${s}`),this}like(o,s){return this.url.searchParams.append(o,`like.${s}`),this}likeAllOf(o,s){return this.url.searchParams.append(o,`like(all).{${s.join(",")}}`),this}likeAnyOf(o,s){return this.url.searchParams.append(o,`like(any).{${s.join(",")}}`),this}ilike(o,s){return this.url.searchParams.append(o,`ilike.${s}`),this}ilikeAllOf(o,s){return this.url.searchParams.append(o,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(o,s){return this.url.searchParams.append(o,`ilike(any).{${s.join(",")}}`),this}is(o,s){return this.url.searchParams.append(o,`is.${s}`),this}in(o,s){const i=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(o,`in.(${i})`),this}contains(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cs.{${s.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(s)}`),this}containedBy(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cd.{${s.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(s)}`),this}rangeGt(o,s){return this.url.searchParams.append(o,`sr.${s}`),this}rangeGte(o,s){return this.url.searchParams.append(o,`nxl.${s}`),this}rangeLt(o,s){return this.url.searchParams.append(o,`sl.${s}`),this}rangeLte(o,s){return this.url.searchParams.append(o,`nxr.${s}`),this}rangeAdjacent(o,s){return this.url.searchParams.append(o,`adj.${s}`),this}overlaps(o,s){return typeof s=="string"?this.url.searchParams.append(o,`ov.${s}`):this.url.searchParams.append(o,`ov.{${s.join(",")}}`),this}textSearch(o,s,{config:i,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=i===void 0?"":`(${i})`;return this.url.searchParams.append(o,`${l}fts${c}.${s}`),this}match(o){return Object.entries(o).forEach(([s,i])=>{this.url.searchParams.append(s,`eq.${i}`)}),this}not(o,s,i){return this.url.searchParams.append(o,`not.${s}.${i}`),this}or(o,{foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${o})`),this}filter(o,s,i){return this.url.searchParams.append(o,`${s}.${i}`),this}}return Ln.default=n,Ln}var Tu;function Tm(){if(Tu)return Dn;Tu=1;var t=Dn&&Dn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Dn,"__esModule",{value:!0});const e=t(Kl());class n{constructor(o,{headers:s={},schema:i,fetch:a}){this.url=o,this.headers=s,this.schema=i,this.fetch=a}select(o,{head:s=!1,count:i}={}){const a=s?"HEAD":"GET";let l=!1;const c=(o??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),i&&(this.headers.Prefer=`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(o,{count:s,defaultToNull:i=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(o)){const c=o.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}upsert(o,{onConflict:s,ignoreDuplicates:i=!1,count:a,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${i?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(o)){const d=o.reduce((f,p)=>f.concat(Object.keys(p)),[]);if(d.length>0){const f=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}update(o,{count:s}={}){const i="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}delete({count:o}={}){const s="DELETE",i=[];return o&&i.push(`count=${o}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Dn.default=n,Dn}var Lr={},Br={},Ru;function SS(){return Ru||(Ru=1,Object.defineProperty(Br,"__esModule",{value:!0}),Br.version=void 0,Br.version="0.0.0-automated"),Br}var Ou;function kS(){if(Ou)return Lr;Ou=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.DEFAULT_HEADERS=void 0;const t=SS();return Lr.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${t.version}`},Lr}var Iu;function PS(){if(Iu)return zn;Iu=1;var t=zn&&zn.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(zn,"__esModule",{value:!0});const e=t(Tm()),n=t(Kl()),r=kS();class o{constructor(i,{headers:a={},schema:l,fetch:c}={}){this.url=i,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new o(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:l=!1,get:c=!1,count:u}={}){let d;const f=new URL(`${this.url}/rpc/${i}`);let p;l||c?(d=l?"HEAD":"GET",Object.entries(a).filter(([y,v])=>v!==void 0).map(([y,v])=>[y,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([y,v])=>{f.searchParams.append(y,v)})):(d="POST",p=a);const g=Object.assign({},this.headers);return u&&(g.Prefer=`count=${u}`),new n.default({method:d,url:f,headers:g,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return zn.default=o,zn}var ju;function ES(){if(ju)return Ce;ju=1;var t=Ce&&Ce.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.PostgrestError=Ce.PostgrestBuilder=Ce.PostgrestTransformBuilder=Ce.PostgrestFilterBuilder=Ce.PostgrestQueryBuilder=Ce.PostgrestClient=void 0;const e=t(PS());Ce.PostgrestClient=e.default;const n=t(Tm());Ce.PostgrestQueryBuilder=n.default;const r=t(Kl());Ce.PostgrestFilterBuilder=r.default;const o=t(Am());Ce.PostgrestTransformBuilder=o.default;const s=t(Em());Ce.PostgrestBuilder=s.default;const i=t(Pm());return Ce.PostgrestError=i.default,Ce.default={PostgrestClient:e.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:s.default,PostgrestError:i.default},Ce}var AS=ES();const TS=Ot(AS),{PostgrestClient:RS,PostgrestQueryBuilder:hR,PostgrestFilterBuilder:fR,PostgrestTransformBuilder:pR,PostgrestBuilder:mR,PostgrestError:gR}=TS;function OS(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const IS=OS(),jS="2.11.15",$S=`realtime-js/${jS}`,NS="1.0.0",Rm=1e4,MS=1e3;var Yr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Yr||(Yr={}));var Re;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Re||(Re={}));var nt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(nt||(nt={}));var za;(function(t){t.websocket="websocket"})(za||(za={}));var fn;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(fn||(fn={}));class zS{constructor(){this.HEADER_LENGTH=1}decode(e,n){return e.constructor===ArrayBuffer?n(this._binaryDecode(e)):n(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const n=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,n,r)}_decodeBroadcast(e,n,r){const o=n.getUint8(1),s=n.getUint8(2);let i=this.HEADER_LENGTH+2;const a=r.decode(e.slice(i,i+o));i=i+o;const l=r.decode(e.slice(i,i+s));i=i+s;const c=JSON.parse(r.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class Om{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var pe;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(pe||(pe={}));const $u=(t,e,n={})=>{var r;const o=(r=n.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,i)=>(s[i]=DS(i,t,e,o),s),{})},DS=(t,e,n,r)=>{const o=e.find(a=>a.name===t),s=o?.type,i=n[t];return s&&!r.includes(s)?Im(s,i):Da(i)},Im=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return US(e,n)}switch(t){case pe.bool:return LS(e);case pe.float4:case pe.float8:case pe.int2:case pe.int4:case pe.int8:case pe.numeric:case pe.oid:return BS(e);case pe.json:case pe.jsonb:return FS(e);case pe.timestamp:return HS(e);case pe.abstime:case pe.date:case pe.daterange:case pe.int4range:case pe.int8range:case pe.money:case pe.reltime:case pe.text:case pe.time:case pe.timestamptz:case pe.timetz:case pe.tsrange:case pe.tstzrange:return Da(e);default:return Da(e)}},Da=t=>t,LS=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},BS=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},FS=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},US=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let s;const i=t.slice(1,n);try{s=JSON.parse("["+i+"]")}catch{s=i?i.split(","):[]}return s.map(a=>Im(e,a))}return t},HS=t=>typeof t=="string"?t.replace(" ","T"):t,jm=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ii{constructor(e,n,r={},o=Rm){this.channel=e,this.event=n,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Nu;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Nu||(Nu={}));class Zr{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Zr.syncState(this.state,o,s,i),this.pendingDiffs.forEach(l=>{this.state=Zr.syncDiff(this.state,l,s,i)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=Zr.syncDiff(this.state,o,s,i),a())}),this.onJoin((o,s,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:s,newPresences:i})}),this.onLeave((o,s,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:s,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,o){const s=this.cloneDeep(e),i=this.transformState(n),a={},l={};return this.map(s,(c,u)=>{i[c]||(l[c]=u)}),this.map(i,(c,u)=>{const d=s[c];if(d){const f=u.map(v=>v.presence_ref),p=d.map(v=>v.presence_ref),g=u.filter(v=>p.indexOf(v.presence_ref)<0),y=d.filter(v=>f.indexOf(v.presence_ref)<0);g.length>0&&(a[c]=g),y.length>0&&(l[c]=y)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},r,o)}static syncDiff(e,n,r,o){const{joins:s,leaves:i}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(s,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(p=>p.presence_ref),f=u.filter(p=>d.indexOf(p.presence_ref)<0);e[a].unshift(...f)}r(a,u,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,o(a,c,l),c.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const o=e[r];return"metas"in o?n[r]=o.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):n[r]=o,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Mu;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Mu||(Mu={}));var zu;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(zu||(zu={}));var kt;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(kt||(kt={}));class Xl{constructor(e,n={config:{}},r){this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Re.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Ii(this,nt.join,this.params,this.timeout),this.rejoinTimer=new Om(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Re.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Re.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Re.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Re.errored,this.rejoinTimer.scheduleTimeout())}),this._on(nt.reply,{},(o,s)=>{this._trigger(this._replyEventName(s),o)}),this.presence=new Zr(this),this.broadcastEndpointURL=jm(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,n=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Re.closed){const{config:{broadcast:s,presence:i,private:a}}=this.params;this._onError(u=>e?.(kt.CHANNEL_ERROR,u)),this._onClose(()=>e?.(kt.CLOSED));const l={},c={broadcast:s,presence:i,postgres_changes:(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){e?.(kt.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,p=(d=f?.length)!==null&&d!==void 0?d:0,g=[];for(let y=0;y<p;y++){const v=f[y],{filter:{event:w,schema:_,table:b,filter:x}}=v,S=u&&u[y];if(S&&S.event===w&&S.schema===_&&S.table===b&&S.filter===x)g.push(Object.assign(Object.assign({},v),{id:S.id}));else{this.unsubscribe(),this.state=Re.errored,e?.(kt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(kt.SUBSCRIBED);return}}).receive("error",u=>{this.state=Re.errored,e?.(kt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e?.(kt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this._on(e,n,r)}async send(e,n={}){var r,o;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var i,a,l;const c=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Re.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(nt.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(o=>{r=new Ii(this,nt.leave,{},e),r.receive("ok",()=>{n(),o("ok")}).receive("timeout",()=>{n(),o("timed out")}).receive("error",()=>{o("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,n,r){const o=new AbortController,s=setTimeout(()=>o.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:o.signal}));return clearTimeout(s),i}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Ii(this,e,n,r);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var o,s;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=nt;if(r&&[a,l,c,u].indexOf(i)>=0&&r!==this._joinRef())return;let f=this._onMessage(i,n,r);if(n&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(p=>{var g,y,v;return((g=p.filter)===null||g===void 0?void 0:g.event)==="*"||((v=(y=p.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(p=>p.callback(f,r)):(s=this.bindings[i])===null||s===void 0||s.filter(p=>{var g,y,v,w,_,b;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in p){const x=p.id,S=(g=p.filter)===null||g===void 0?void 0:g.event;return x&&((y=n.ids)===null||y===void 0?void 0:y.includes(x))&&(S==="*"||S?.toLocaleLowerCase()===((v=n.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const x=(_=(w=p?.filter)===null||w===void 0?void 0:w.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return x==="*"||x===((b=n?.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===i}).map(p=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:y,table:v,commit_timestamp:w,type:_,errors:b}=g;f=Object.assign(Object.assign({},{schema:y,table:v,commit_timestamp:w,eventType:_,new:{},old:{},errors:b}),this._getPayloadRecords(g))}p.callback(f,r)})}_isClosed(){return this.state===Re.closed}_isJoined(){return this.state===Re.joined}_isJoining(){return this.state===Re.joining}_isLeaving(){return this.state===Re.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const o=e.toLocaleLowerCase(),s={type:o,filter:n,callback:r};return this.bindings[o]?this.bindings[o].push(s):this.bindings[o]=[s],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(o=>{var s;return!(((s=o.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&Xl.isEqual(o.filter,n))}),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(nt.close,{},e)}_onError(e){this._on(nt.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Re.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=$u(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=$u(e.columns,e.old_record)),n}}const Du=()=>{},WS=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class GS{constructor(e,n){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Rm,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Du,this.ref=0,this.logger=Du,this.conn=null,this.sendBuffer=[],this.serializer=new zS,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>Gt(async()=>{const{default:l}=await Promise.resolve().then(()=>Rr);return{default:l}},void 0).then(({default:l})=>l(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${za.websocket}`,this.httpEndpoint=jm(e),n?.transport?this.transport=n.transport:this.transport=null,n?.params&&(this.params=n.params),n?.timeout&&(this.timeout=n.timeout),n?.logger&&(this.logger=n.logger),(n?.logLevel||n?.log_level)&&(this.logLevel=n.logLevel||n.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),n?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=n.heartbeatIntervalMs);const o=(r=n?.params)===null||r===void 0?void 0:r.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=n?.reconnectAfterMs?n.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=n?.encode?n.encode:(s,i)=>i(JSON.stringify(s)),this.decode=n?.decode?n.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Om(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(n?.fetch),n?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=n?.worker||!1,this.workerUrl=n?.workerUrl}this.accessToken=n?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=IS),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:NS}))}disconnect(e,n){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,n??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Yr.connecting:return fn.Connecting;case Yr.open:return fn.Open;case Yr.closing:return fn.Closing;default:return fn.Closed}}isConnected(){return this.connectionState()===fn.Open}channel(e,n={config:{}}){const r=`realtime:${e}`,o=this.getChannels().find(s=>s.topic===r);if(o)return o;{const s=new Xl(`realtime:${e}`,n,this);return this.channels.push(s),s}}push(e){const{topic:n,event:r,payload:o,ref:s}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${s})`,o),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let n=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const o={access_token:n,version:$S};n&&r.updateJoinPayload(o),r.joinedOnce&&r._isJoined()&&r._push(nt.access_token,{access_token:n})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(MS,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,n=>{let{topic:r,event:o,payload:s,ref:i}=n;r==="phoenix"&&o==="phx_reply"&&this.heartbeatCallback(n.payload.status=="ok"?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${r} ${o} ${i&&"("+i+")"||""}`,s),Array.from(this.channels).filter(a=>a._isMember(r)).forEach(a=>a._trigger(o,s,i)),this.stateChangeCallbacks.message.forEach(a=>a(n))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(n=>n(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(n=>n(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(nt.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",o=new URLSearchParams(n);return`${e}${r}${o}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([WS],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}}class Jl extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Se(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class qS extends Jl{constructor(e,n){super(e),this.name="StorageApiError",this.status=n}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class La extends Jl{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}var VS=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const $m=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Gt(async()=>{const{default:r}=await Promise.resolve().then(()=>Rr);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},KS=()=>VS(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Gt(()=>Promise.resolve().then(()=>Rr),void 0)).Response:Response}),Ba=t=>{if(Array.isArray(t))return t.map(n=>Ba(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const o=n.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[o]=Ba(r)}),e};var In=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const ji=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),XS=(t,e,n)=>In(void 0,void 0,void 0,function*(){const r=yield KS();t instanceof r&&!n?.noResolveJson?t.json().then(o=>{e(new qS(ji(o),t.status||500))}).catch(o=>{e(new La(ji(o),o))}):e(new La(ji(t),t))}),JS=(t,e,n,r)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),r&&(o.body=JSON.stringify(r)),Object.assign(Object.assign({},o),n))};function wo(t,e,n,r,o,s){return In(this,void 0,void 0,function*(){return new Promise((i,a)=>{t(n,JS(e,r,o,s)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>XS(l,a,r))})})}function xs(t,e,n,r){return In(this,void 0,void 0,function*(){return wo(t,"GET",e,n,r)})}function Ft(t,e,n,r,o){return In(this,void 0,void 0,function*(){return wo(t,"POST",e,r,o,n)})}function YS(t,e,n,r,o){return In(this,void 0,void 0,function*(){return wo(t,"PUT",e,r,o,n)})}function ZS(t,e,n,r){return In(this,void 0,void 0,function*(){return wo(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function Nm(t,e,n,r,o){return In(this,void 0,void 0,function*(){return wo(t,"DELETE",e,r,o,n)})}var Le=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const QS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Lu={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ek{constructor(e,n={},r,o){this.url=e,this.headers=n,this.bucketId=r,this.fetch=$m(o)}uploadOrUpdate(e,n,r,o){return Le(this,void 0,void 0,function*(){try{let s;const i=Object.assign(Object.assign({},Lu),o);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=r,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));const c=this._removeEmptyFolders(n),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:s,headers:a},i?.duplex?{duplex:i.duplex}:{})),f=yield d.json();return d.ok?{data:{path:c,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(s){if(Se(s))return{data:null,error:s};throw s}})}upload(e,n,r){return Le(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,o){return Le(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),i=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",n);try{let l;const c=Object.assign({upsert:Lu.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),f=yield d.json();return d.ok?{data:{path:s,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(Se(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,n){return Le(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const o=Object.assign({},this.headers);n?.upsert&&(o["x-upsert"]="true");const s=yield Ft(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),i=new URL(this.url+s.url),a=i.searchParams.get("token");if(!a)throw new Jl("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}update(e,n,r){return Le(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return Le(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}copy(e,n,r){return Le(this,void 0,void 0,function*(){try{return{data:{path:(yield Ft(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrl(e,n,r){return Le(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),s=yield Ft(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:n},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${i}`)},{data:s,error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrls(e,n,r){return Le(this,void 0,void 0,function*(){try{const o=yield Ft(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${s}`):null})),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}download(e,n){return Le(this,void 0,void 0,function*(){const o=typeof n?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(n?.transform||{}),i=s?`?${s}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield xs(this.fetch,`${this.url}/${o}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Se(a))return{data:null,error:a};throw a}})}info(e){return Le(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield xs(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:Ba(r),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}exists(e){return Le(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield ZS(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Se(r)&&r instanceof La){const o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),o=[],s=n?.download?`download=${n.download===!0?"":n.download}`:"";s!==""&&o.push(s);const a=typeof n?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(n?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return Le(this,void 0,void 0,function*(){try{return{data:yield Nm(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}list(e,n,r){return Le(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},QS),n),{prefix:e||""});return{data:yield Ft(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const tk="2.7.1",nk={"X-Client-Info":`storage-js/${tk}`};var Un=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class rk{constructor(e,n={},r){this.url=e,this.headers=Object.assign(Object.assign({},nk),n),this.fetch=$m(r)}listBuckets(){return Un(this,void 0,void 0,function*(){try{return{data:yield xs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Se(e))return{data:null,error:e};throw e}})}getBucket(e){return Un(this,void 0,void 0,function*(){try{return{data:yield xs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}createBucket(e,n={public:!1}){return Un(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}updateBucket(e,n){return Un(this,void 0,void 0,function*(){try{return{data:yield YS(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Un(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Un(this,void 0,void 0,function*(){try{return{data:yield Nm(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}}class ok extends rk{constructor(e,n={},r){super(e,n,r)}from(e){return new ek(this.url,this.headers,e,this.fetch)}}const sk="2.51.0";let Wr="";typeof Deno<"u"?Wr="deno":typeof document<"u"?Wr="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Wr="react-native":Wr="node";const ik={"X-Client-Info":`supabase-js-${Wr}/${sk}`},ak={headers:ik},lk={schema:"public"},ck={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},uk={};var dk=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const hk=t=>{let e;return t?e=t:typeof fetch>"u"?e=Sm:e=fetch,(...n)=>e(...n)},fk=()=>typeof Headers>"u"?km:Headers,pk=(t,e,n)=>{const r=hk(n),o=fk();return(s,i)=>dk(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:t;let c=new o(i?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(s,Object.assign(Object.assign({},i),{headers:c}))})};var mk=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};function gk(t){return t.endsWith("/")?t:t+"/"}function yk(t,e){var n,r;const{db:o,auth:s,realtime:i,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,f={db:Object.assign(Object.assign({},l),o),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(n=d?.headers)!==null&&n!==void 0?n:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>mk(this,void 0,void 0,function*(){return""})};return t.accessToken?f.accessToken=t.accessToken:delete f.accessToken,f}const Mm="2.71.0",Yn=30*1e3,Fa=3,$i=Fa*Yn,vk="http://localhost:9999",wk="supabase.auth.token",bk={"X-Client-Info":`gotrue-js/${Mm}`},Ua="X-Supabase-Api-Version",zm={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},xk=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,_k=10*60*1e3;class Yl extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Q(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class Ck extends Yl{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function Sk(t){return Q(t)&&t.name==="AuthApiError"}class Dm extends Yl{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class rn extends Yl{constructor(e,n,r,o){super(e,r,o),this.name=n,this.status=r}}class Bt extends rn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function kk(t){return Q(t)&&t.name==="AuthSessionMissingError"}class Wo extends rn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Go extends rn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class qo extends rn{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Pk(t){return Q(t)&&t.name==="AuthImplicitGrantRedirectError"}class Bu extends rn{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ha extends rn{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Ni(t){return Q(t)&&t.name==="AuthRetryableFetchError"}class Fu extends rn{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Wa extends rn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const _s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Uu=` 	
\r=`.split(""),Ek=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Uu.length;e+=1)t[Uu[e].charCodeAt(0)]=-2;for(let e=0;e<_s.length;e+=1)t[_s[e].charCodeAt(0)]=e;return t})();function Hu(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(_s[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(_s[r]),e.queuedBits-=6}}function Lm(t,e,n){const r=Ek[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Wu(t){const e=[],n=i=>{e.push(String.fromCodePoint(i))},r={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},s=i=>{Rk(i,r,n)};for(let i=0;i<t.length;i+=1)Lm(t.charCodeAt(i),o,s);return e.join("")}function Ak(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Tk(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const o=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|o)+65536,n+=1}Ak(r,e)}}function Rk(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function Ok(t){const e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};for(let o=0;o<t.length;o+=1)Lm(t.charCodeAt(o),n,r);return new Uint8Array(e)}function Ik(t){const e=[];return Tk(t,n=>e.push(n)),new Uint8Array(e)}function jk(t){const e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};return t.forEach(o=>Hu(o,n,r)),Hu(null,n,r),e.join("")}function $k(t){return Math.round(Date.now()/1e3)+t}function Nk(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const et=()=>typeof window<"u"&&typeof document<"u",an={tested:!1,writable:!1},Bm=()=>{if(!et())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(an.tested)return an.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),an.tested=!0,an.writable=!0}catch{an.tested=!0,an.writable=!1}return an.writable};function Mk(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((o,s)=>{e[s]=o})}catch{}return n.searchParams.forEach((r,o)=>{e[o]=r}),e}const Fm=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Gt(async()=>{const{default:r}=await Promise.resolve().then(()=>Rr);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},zk=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Zn=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},ln=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Mt=async(t,e)=>{await t.removeItem(e)};class Vs{constructor(){this.promise=new Vs.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Vs.promiseConstructor=Promise;function Mi(t){const e=t.split(".");if(e.length!==3)throw new Wa("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!xk.test(e[r]))throw new Wa("JWT not in base64url format");return{header:JSON.parse(Wu(e[0])),payload:JSON.parse(Wu(e[1])),signature:Ok(e[2]),raw:{header:e[0],payload:e[1]}}}async function Dk(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Lk(t,e){return new Promise((r,o)=>{(async()=>{for(let s=0;s<1/0;s++)try{const i=await t(s);if(!e(s,null,i)){r(i);return}}catch(i){if(!e(s,i)){o(i);return}}})()})}function Bk(t){return("0"+t.toString(16)).substr(-2)}function Fk(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let o="";for(let s=0;s<56;s++)o+=n.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(e),Array.from(e,Bk).join("")}async function Uk(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),o=new Uint8Array(r);return Array.from(o).map(s=>String.fromCharCode(s)).join("")}async function Hk(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await Uk(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Hn(t,e,n=!1){const r=Fk();let o=r;n&&(o+="/PASSWORD_RECOVERY"),await Zn(t,`${e}-code-verifier`,o);const s=await Hk(r);return[s,r===s?"plain":"s256"]}const Wk=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Gk(t){const e=t.headers.get(Ua);if(!e||!e.match(Wk))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function qk(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function Vk(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Kk=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Wn(t){if(!Kk.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function zi(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}var Xk=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n};const un=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Jk=[502,503,504];async function Gu(t){var e;if(!zk(t))throw new Ha(un(t),0);if(Jk.includes(t.status))throw new Ha(un(t),t.status);let n;try{n=await t.json()}catch(s){throw new Dm(un(s),s)}let r;const o=Gk(t);if(o&&o.getTime()>=zm["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new Fu(un(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Bt}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((s,i)=>s&&typeof i=="string",!0))throw new Fu(un(n),t.status,n.weak_password.reasons);throw new Ck(un(n),t.status||500,r)}const Yk=(t,e,n,r)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),n))};async function ie(t,e,n,r){var o;const s=Object.assign({},r?.headers);s[Ua]||(s[Ua]=zm["2024-01-01"].name),r?.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const i=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(i.redirect_to=r.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await Zk(t,e,n+a,{headers:s,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function Zk(t,e,n,r,o,s){const i=Yk(e,r,o,s);let a;try{a=await t(n,Object.assign({},i))}catch(l){throw console.error(l),new Ha(un(l),0)}if(a.ok||await Gu(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await Gu(l)}}function St(t){var e;let n=null;n1(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=$k(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function qu(t){const e=St(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Ut(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function Qk(t){return{data:t,error:null}}function e1(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s}=t,i=Xk(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function t1(t){return t}function n1(t){return t.access_token&&t.refresh_token&&t.expires_in}const Di=["global","local","others"];var r1=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n};class o1{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=Fm(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,n=Di[0]){if(Di.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Di.join(", ")}`);try{return await ie(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await ie(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Ut})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=r1(e,["options"]),o=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await ie(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:e1,redirectTo:n?.redirectTo})}catch(n){if(Q(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await ie(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ut})}catch(n){if(Q(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,o,s,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await ie(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(s=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""},xform:t1});if(u.error)throw u.error;const d=await u.json(),f=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,p=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(g=>{const y=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);c[`${v}Page`]=y}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(Q(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Wn(e);try{return await ie(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ut})}catch(n){if(Q(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){Wn(e);try{return await ie(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Ut})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){Wn(e);try{return await ie(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Ut})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Wn(e.userId);try{const{data:n,error:r}=await ie(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:n,error:r}}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _deleteFactor(e){Wn(e.userId),Wn(e.id);try{return{data:await ie(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}}function Vu(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}function s1(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Gn={debug:!!(globalThis&&Bm()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Um extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class i1 extends Um{}async function a1(t,e,n){Gn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Gn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){Gn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await n()}finally{Gn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(e===0)throw Gn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new i1(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Gn.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}s1();const l1={url:vk,storageKey:wk,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:bk,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ku(t,e,n){return await n()}const qn={};class ao{constructor(e){var n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ao.nextInstanceID,ao.nextInstanceID+=1,this.instanceID>0&&et()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},l1),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new o1({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Fm(o.fetch),this.lock=o.lock||Ku,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:et()&&(!((n=globalThis?.navigator)===null||n===void 0)&&n.locks)?this.lock=a1:this.lock=Ku,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:Bm()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Vu(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=Vu(this.memoryStorage)),et()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,n;return(n=(e=qn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){qn[this.storageKey]=Object.assign(Object.assign({},qn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=qn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){qn[this.storageKey]=Object.assign(Object.assign({},qn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Mm}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const n=Mk(window.location.href);let r="none";if(this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce"),et()&&this.detectSessionInUrl&&r!=="none"){const{data:o,error:s}=await this._getSessionFromURL(n,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),Pk(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:i,redirectType:a}=o;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Q(n)?{error:n}:{error:new Dm("Unexpected error during initialization",n)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,o;try{const s=await ie(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e?.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:St}),{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Q(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var n,r,o;try{let s;if("email"in e){const{email:u,password:d,options:f}=e;let p=null,g=null;this.flowType==="pkce"&&([p,g]=await Hn(this.storage,this.storageKey)),s=await ie(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:u,password:d,data:(n=f?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:g},xform:St})}else if("phone"in e){const{phone:u,password:d,options:f}=e;s=await ie(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(r=f?.data)!==null&&r!==void 0?r:{},channel:(o=f?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:St})}else throw new Go("You must provide either an email or phone number and a password");const{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Q(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let n;if("email"in e){const{email:s,password:i,options:a}=e;n=await ie(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:qu})}else if("phone"in e){const{phone:s,password:i,options:a}=e;n=await ie(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:qu})}else throw new Go("You must provide either an email or phone number and a password");const{data:r,error:o}=n;return o?{data:{user:null,session:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Wo}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOAuth(e){var n,r,o,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;if(n==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}async signInWithSolana(e){var n,r,o,s,i,a,l,c,u,d,f,p;let g,y;if("message"in e)g=e.message,y=e.signature;else{const{chain:v,wallet:w,statement:_,options:b}=e;let x;if(et())if(typeof w=="object")x=w;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))x=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=w}const S=new URL((n=b?.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in x&&x.signIn){const k=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b?.signInWithSolana),{version:"1",domain:S.host,uri:S.href}),_?{statement:_}:null));let C;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")C=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)C=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in C&&"signature"in C&&(typeof C.signedMessage=="string"||C.signedMessage instanceof Uint8Array)&&C.signature instanceof Uint8Array)g=typeof C.signedMessage=="string"?C.signedMessage:new TextDecoder().decode(C.signedMessage),y=C.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${S.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${S.href}`,`Issued At: ${(o=(r=b?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=b?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((i=b?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((a=b?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((c=b?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((d=(u=b?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...b.signInWithSolana.resources.map(C=>`- ${C}`)]:[]].join(`
`);const k=await x.signMessage(new TextEncoder().encode(g),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=k}}try{const{data:v,error:w}=await ie(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:jk(y)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:St});if(w)throw w;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new Wo}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:w})}catch(v){if(Q(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const n=await ln(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(n??"").split("/");try{const{data:s,error:i}=await ie(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:St});if(await Mt(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Wo}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:i})}catch(s){if(Q(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:n,provider:r,token:o,access_token:s,nonce:i}=e,a=await ie(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:St}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Wo}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOtp(e){var n,r,o,s,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Hn(this.storage,this.storageKey));const{error:d}=await ie(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await ie(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(o=l?.data)!==null&&o!==void 0?o:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(i=l?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new Go("You must provide either an email or phone number.")}catch(a){if(Q(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var n,r;try{let o,s;"options"in e&&(o=(n=e.options)===null||n===void 0?void 0:n.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:i,error:a}=await ie(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:St});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(Q(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var n,r,o;try{let s=null,i=null;return this.flowType==="pkce"&&([s,i]=await Hn(this.storage,this.storageKey)),await ie(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:i}),headers:this.headers,xform:Qk})}catch(s){if(Q(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Bt;const{error:o}=await ie(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(Q(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:o,options:s}=e,{error:i}=await ie(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:r,type:o,options:s}=e,{data:i,error:a}=await ie(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:a}}throw new Go("You must provide either an email or phone number and a type")}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await ln(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<$i:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const i=await ln(this.userStorage,this.storageKey+"-user");i?.user?e.user=i.user:e.user=zi()}if(this.storage.isServer&&e.user){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ie(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ut}):await this._useSession(async n=>{var r,o,s;const{data:i,error:a}=n;if(a)throw a;return!(!((r=i.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Bt}:await ie(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:Ut})})}catch(n){if(Q(n))return kk(n)&&(await this._removeSession(),await Mt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:n};throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:o,error:s}=r;if(s)throw s;if(!o.session)throw new Bt;const i=o.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Hn(this.storage,this.storageKey));const{data:c,error:u}=await ie(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Ut});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(r){if(Q(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Bt;const n=Date.now()/1e3;let r=n,o=!0,s=null;const{payload:i}=Mi(e.access_token);if(i.exp&&(r=i.exp,o=r<=n),o){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(n){if(Q(n))return{data:{session:null,user:null},error:n};throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:i,error:a}=n;if(a)throw a;e=(r=i.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Bt;const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(n){if(Q(n))return{data:{user:null,session:null},error:n};throw n}}async _getSessionFromURL(e,n){try{if(!et())throw new qo("No browser detected.");if(e.error||e.error_description||e.error_code)throw new qo(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Bu("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new qo("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Bu("No code detected.");const{data:_,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:o,access_token:s,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!i||!c)throw new qo("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let f=u+d;l&&(f=parseInt(l));const p=f-u;p*1e3<=Yn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const g=f-d;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,u);const{data:y,error:v}=await this._getUser(s);if(v)throw v;const w={provider_token:r,provider_refresh_token:o,access_token:s,expires_in:d,expires_at:f,refresh_token:i,token_type:c,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(r){if(Q(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await ln(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:o,error:s}=n;if(s)return{error:s};const i=(r=o.session)===null||r===void 0?void 0:r.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(Sk(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Mt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const n=Nk(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,o;try{const{data:{session:s},error:i}=n;if(i)throw i;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,n={}){let r=null,o=null;this.flowType==="pkce"&&([r,o]=await Hn(this.storage,this.storageKey,!0));try{return await ie(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:o,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(s){if(Q(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}async linkIdentity(e){var n;try{const{data:r,error:o}=await this._useSession(async s=>{var i,a,l,c,u;const{data:d,error:f}=s;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await ie(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(o)throw o;return et()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(Q(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,o;const{data:s,error:i}=n;if(i)throw i;return await ie(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await Lk(async o=>(o>0&&await Dk(200*Math.pow(2,o-1)),this._debug(n,"refreshing attempt",o),await ie(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:St})),(o,s)=>{const i=200*Math.pow(2,o);return s&&Ni(s)&&Date.now()+i-r<Yn})}catch(r){if(this._debug(n,"error",r),Q(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),et()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const o=await ln(this.storage,this.storageKey);if(o&&this.userStorage){let i=await ln(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:o.user},await Zn(this.userStorage,this.storageKey+"-user",i)),o.user=(e=i?.user)!==null&&e!==void 0?e:zi()}else if(o&&!o.user&&!o.user){const i=await ln(this.storage,this.storageKey+"-user");i&&i?.user?(o.user=i.user,await Mt(this.storage,this.storageKey+"-user"),await Zn(this.storage,this.storageKey,o)):o.user=zi()}if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}const s=((n=o.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<$i;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${$i}s`),s){if(this.autoRefreshToken&&o.refresh_token){const{error:i}=await this._callRefreshToken(o.refresh_token);i&&(console.error(i),Ni(i)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:a}=await this._getUser(o.access_token);!a&&i?.user?(o.user=i.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(r,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Bt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Vs;const{data:s,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new Bt;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(o,"error",s),Q(s)){const i={session:null,error:s};return Ni(s)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(i),i}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,n,r=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const s=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){s.push(l)}});if(await Promise.all(i),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await Zn(this.userStorage,this.storageKey+"-user",{user:n.user});const o=Object.assign({},n);delete o.user;const s=structuredClone(o);await Zn(this.storage,this.storageKey,s)}else{const o=structuredClone(n);await Zn(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await Mt(this.storage,this.storageKey),await Mt(this.storage,this.storageKey+"-code-verifier"),await Mt(this.storage,this.storageKey+"-user"),this.userStorage&&await Mt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&et()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Yn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((r.expires_at*1e3-e)/Yn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Yn}ms, refresh threshold is ${Fa} ticks`),o<=Fa&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Um)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!et()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const o=[`provider=${encodeURIComponent(n)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[s,i]=await Hn(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(i)}`});o.push(a.toString())}if(r?.queryParams){const s=new URLSearchParams(r.queryParams);o.push(s.toString())}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;return s?{data:null,error:s}:await ie(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,o;const{data:s,error:i}=n;if(i)return{data:null,error:i};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await ie(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((o=l?.totp)===null||o===void 0)&&o.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(n){if(Q(n))return{data:null,error:n};throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;if(s)return{data:null,error:s};const{data:i,error:a}=await ie(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(n){if(Q(n))return{data:null,error:n};throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;return s?{data:null,error:s}:await ie(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Q(n))return{data:null,error:n};throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){const{data:{user:e},error:n}=await this.getUser();if(n)return{data:null,error:n};const r=e?.factors||[],o=r.filter(i=>i.factor_type==="totp"&&i.status==="verified"),s=r.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:r,totp:o,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var n,r;const{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Mi(o.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((r=(n=o.user.factors)===null||n===void 0?void 0:n.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;const o=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+_k>o)return r;const{data:s,error:i}=await ie(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=o,r=s.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:g}=await this.getSession();if(g||!p.session)return{data:null,error:g};r=p.session.access_token}const{header:o,payload:s,signature:i,raw:{header:a,payload:l}}=Mi(r);n?.allowExpired||qk(s.exp);const c=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,n?.keys?{keys:n.keys}:n?.jwks);if(!c){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:s,header:o,signature:i},error:null}}const u=Vk(o.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,i,Ik(`${a}.${l}`)))throw new Wa("Invalid JWT signature");return{data:{claims:s,header:o,signature:i},error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}}ao.nextInstanceID=0;const c1=ao;class u1 extends c1{constructor(e){super(e)}}var d1=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class h1{constructor(e,n,r){var o,s,i;if(this.supabaseUrl=e,this.supabaseKey=n,!e)throw new Error("supabaseUrl is required.");if(!n)throw new Error("supabaseKey is required.");const a=gk(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:lk,realtime:uk,auth:Object.assign(Object.assign({},ck),{storageKey:c}),global:ak},d=yk(r??{},u);this.storageKey=(o=d.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(f,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=pk(n,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new RS(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new vS(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new ok(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,n;return d1(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,storageKey:s,flowType:i,lock:a,debug:l},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new u1({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:s,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,flowType:i,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new GS(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r?.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const f1=(t,e,n)=>new h1(t,e,n),Sn=f1("https://pkswdnpftrundnewgnya.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrc3dkbnBmdHJ1bmRuZXdnbnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODI2MzIsImV4cCI6MjA2ODI1ODYzMn0.r_Y1RLOGJ55C0De5SBTVXqO09SMDqgV38sQuE-oDxXE"),p1=async(t,e)=>{const n=await Sn.rpc("save_campaign_version",{p_name:t,p_data:await Cm(e)});if(n.error)throw new Error(`error saving to db ${n.error.message} ${n.error.details}`,{cause:n.error});return n.data},m1=async t=>{const e=await Sn.rpc("get_latest_campaign",{p_name:t.name,p_created_by:t.createdBy,p_version:t.version});if(e.error)throw new Error("could not get campaign",{cause:e.error});const n=await pS(e.data.data);return Object.values(n.rooms).forEach(r=>{delete r.size}),n},Hm=()=>{const[t,e]=m.useState(null);return m.useEffect(()=>{Sn.auth.getUser().then(({data:{user:r}})=>{e(r)});const{data:{subscription:n}}=Sn.auth.onAuthStateChange((r,o)=>{e(o?.user??null)});return()=>n.unsubscribe()},[]),t},Wm=()=>{const[t,e]=m.useState(0);return{justDone:t,doneNow(){e(n=>n+1),setTimeout(()=>e(n=>n-1),g1)}}},g1=2e3,y1=`
## Save

put your campaign on cassette tape, or even floppy disk!

to be shared or worked on later

(really, saves to a cloud database)
`,v1=`
## Load

continue working from your last save
`,Gm=()=>fe(({levelEditor:{savedCampaign:t,campaignInProgress:e}})=>Ge(t,e)),w1=()=>{const t=Hm(),e=Gm(),{doneNow:n,justDone:r}=Wm(),o=async()=>{const i=U.getState(),a=gh(i);console.info("saving...",a);const l=await p1("sequel",a);console.info(`...saved as v${l}`),U.dispatch(Qy({campaign:a})),n()},s=async()=>{try{const i=await m1({name:"sequel"});console.info("loaded",i),U.dispatch(ev({campaign:i}))}catch(i){console.error(i)}};return h.jsxs(h.Fragment,{children:[r>0?h.jsx(se,{disabled:!0,className:"!bg-moss !text-white",children:h.jsx(I,{className:"relative leading-none",children:"OK!"})}):h.jsx(se,{disabled:t===null||e,onClick:o,shortcutKeys:["^S","⌘S"],tooltipContent:y1,children:h.jsxs("div",{className:"flex flex-row items-center",children:[h.jsx("span",{className:Ae("sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative",{"text-lightGrey":t===null})}),h.jsx("span",{className:Ae("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})})]})}),h.jsx(se,{disabled:t===null,onClick:s,tooltipContent:v1,children:h.jsxs("div",{className:"flex flex-row items-center",children:[h.jsx("span",{className:Ae("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})}),h.jsx("span",{className:Ae("sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative",{"text-lightGrey":t===null})})]})})]})},b1=()=>h.jsx(se,{children:h.jsx(I,{className:"relative leading-none",children:"MAP"})}),x1=()=>{const[t,e]=m.useState(!1),[n,r]=m.useState(!1);return h.jsx(ql,{main:h.jsx(se,{onClick:async()=>{const o=U.getState(),s=gh(o),i=await Cm(s),a=new URL("https://blockstack.ing"),l=a.searchParams;l.set("campaignData",i),l.set("noSaves","1"),l.set("cheats","1"),n&&l.set("playAsHeels","1"),t||(a.hash=o.levelEditor.currentlyEditingRoomId),window.open(a.toString(),"playtest")},shortcutKeys:["⌘P","^P"],children:h.jsx(Na,{topText:"pl",bottomText:"ay",icon:h.jsx("span",{className:"sprite texture-joystick mt-half"})})}),children:[h.jsx(wr,{className:"w-full",value:t,label:"from",falseLabel:"room",trueLabel:"start",onChange:o=>e(o)},"fromStart"),h.jsx(wr,{className:"w-full",value:n,label:"as",falseLabel:"head",trueLabel:"heels",onChange:o=>r(o)},"playAsHeels")]})},_1=t=>{switch(t){case"github":return ch;case"discord":return uh;default:throw new Error}},C1=({className:t})=>{const e=Hm(),n=o=>async()=>{const s=new URL(window.location.href);s.hash="";const i=s.toString(),{error:a}=await Sn.auth.signInWithOAuth({provider:o,options:{redirectTo:i}});a&&console.error("Login error:",a)},r=async()=>{const{error:o}=await Sn.auth.signOut();o&&console.error("Logout error:",o)};return h.jsx("div",{className:Ae(t),children:e?h.jsxs("div",{className:"bg-moss overflow-hidden text-center",children:[h.jsx(I,{noSlitWords:!0,className:"overflow-hidden",children:`${_1(e.app_metadata.provider)}${e.email}`}),h.jsx(ur,{className:"px-1 w-full",onClick:r,children:h.jsx(I,{children:"Logout"})})]}):h.jsxs("div",{className:"px-1 bg-midRed",children:[h.jsx(I,{className:"block w-full sprites-double-height pb-1",children:"Not logged in"}),h.jsx(I,{className:"block w-full text-highlightBeige",children:"You will not be able to save"}),h.jsxs("div",{className:"pt-1 flex flex-col gap-half",children:[h.jsx(I,{children:"Log in with:"}),h.jsxs(ur,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:n("github"),children:[h.jsx(I,{children:ch}),h.jsx(I,{children:"GitHub"})]}),h.jsxs(ur,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:n("discord"),children:[h.jsx(I,{children:uh}),h.jsx(I,{children:"Discord"})]})]})]})})},S1=`
## Add room

Add a **new room** to this campaign

Nothing will link to the room so add *doors* and *teleporters* to get into it
`,k1=`
## Delete room

Delete this room
`,P1=()=>{const t=He(),e=fe(n=>Object.keys(n.levelEditor.campaignInProgress.rooms).length>1);return h.jsxs(h.Fragment,{children:[h.jsx(se,{className:"bg-moss",onClick:()=>t(tv()),tooltipContent:S1,children:h.jsx("span",{className:"sprite texture-hud_char_+ relative"})}),h.jsx(se,{className:"bg-midRed",onClick:()=>t(nv()),disabled:!e,tooltipContent:k1,children:h.jsx("span",{className:"sprite texture-hud_char_X relative"})})]})},Oe={x:12,y:12,z:K.h},E1={x:14,y:14,z:K.h},pn={x:16,y:16,z:K.h},Li={...Oe,z:K.h*2},qm=t=>{switch(t.type){case"spring":case"portableBlock":case"moveableDeadly":case"slidingDeadly":case"firedDoughnut":return{aabb:Oe};case"slidingBlock":return t.config.style==="book"?{aabb:pn}:{aabb:Oe};case"lift":return{aabb:{...Oe,z:Oe.z}};case"switch":return{aabb:{...Oe,z:Oe.z}};case"pickup":return t.config.gives==="scroll"?{aabb:{x:16,y:4,z:13}}:{aabb:Oe};case"charles":return{aabb:Li};case"ball":return{aabb:{x:12,y:12,z:12}};case"pushableBlock":case"movingPlatform":return{aabb:pn};case"block":switch(t.config.style){case"artificial":case"organic":case"book":return{aabb:pn};case"tower":return{aabb:{x:11,y:11,z:K.h}};default:throw new Error("unknown block style")}case"monster":switch(t.config.which){case"skiHead":return{aabb:{...Oe,z:21}};case"bubbleRobot":case"cyberman":case"elephant":case"emperorsGuardian":case"monkey":case"computerBot":return{aabb:Li};case"helicopterBug":case"dalek":case"emperor":case"homingBot":case"elephantHead":return{aabb:Oe};case"turtle":return{aabb:Oe};default:throw t.config,new Error("unknown monster type")}case"deadlyBlock":case"spikes":return{aabb:pn};case"bubbles":return{aabb:Oe};case"conveyor":case"hushPuppy":case"teleporter":return{aabb:pn};case"barrier":return{aabb:t.config.axis==="y"?{x:3,y:15,z:K.h}:{x:15,y:3,z:K.h}};case"sceneryPlayer":return t.config.which==="headOverHeels"?{aabb:Li}:{aabb:Oe};case"emitter":return{aabb:le};default:return{aabb:E1}}},rt={aabb:Oe},A1=({config:{direction:t},position:e})=>t==="right"&&e.x===0||t==="towards"&&e.y===0,T1=({x:t=0,y:e=0})=>e-t,q=({x:t=0,y:e=0,z:n=0})=>({x:e-t,y:-(t+e)/2-n}),R1=(t,e,n)=>{const r=q(t),o=Vt(n,r);return B(Vm(e,o),t)},Vm=(t,{x:e,y:n})=>{switch(dh(t)){case"xy":return{x:-e/2-n,y:e/2-n,z:0};case"xz":return{x:-e,y:0,z:e/2-n};case"yz":return{x:0,y:e,z:-e/2-n};default:throw new Error("only axis-aligned planes are supported for unprojection")}},ke=({x:t=0,y:e=0,z:n=0})=>({x:t*K.w,y:e*K.d,z:n*K.h}),is=({x:t=0,y:e=0,z:n=0})=>({x:t/K.w,y:e/K.d,z:n/K.h}),kn=t=>q(ke(t)),Ga=t=>{const e=ke(t.position),{aabb:n}=qm(t);if(n===void 0)throw new Error(`item type= ${t.type} config=${JSON.stringify(t.config)} has no bounding box`);return t.type==="wall"?e:B(e,{x:K.w-n.x>>1,y:K.d-n.y>>1})},Ee=Number.MIN_SAFE_INTEGER,Xu=uy/1e3,Km={firedDoughnut:2*Xu,floatingText:Xu},Xm=10,Ju=6e4,O1=8,I1=750,j1=2500,Yu=200,$1=.15,N1=sr.h-sr.w/2,Jm=N1+2,Ks=9999,Be=()=>({expires:null,stoodOnBy:{},disappearing:null,switchedAtRoomTime:Ee,stoodOnUntilRoomTime:Ee}),Zu=()=>({standingOnItemId:null,vels:{gravity:le,movingFloor:le},latentMovement:[],actedOnAt:{roomTime:Ee,by:he},collidedWith:{roomTime:Ee,by:he}}),M1=t=>{const e=rv.includes(t.type);return{...Be(),position:Ga(t),...e?{standingOnItemId:null,vels:{gravity:le,movingFloor:le,...ov.includes(t.type)?{sliding:le}:{},...t.type==="monster"||t.type==="movingPlatform"?{walking:le}:{}},latentMovement:[],actedOnAt:{roomTime:Ee,by:he},collidedWith:{roomTime:Ee,by:he}}:{},...t.type==="monster"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",timeOfLastDirectionChange:Number.NEGATIVE_INFINITY,...t.config.which==="skiHead"||t.config.which==="turtle"||t.config.which==="elephantHead"||t.config.which==="cyberman"?{facing:Pe[t.config.startDirection]}:{facing:Pe.towards}}:{},...t.type==="pickup"?{disappearing:{on:"touch",byType:t.config.gives==="bag"||t.config.gives==="jumps"?["heels","headOverHeels"]:t.config.gives==="doughnuts"||t.config.gives==="hooter"||t.config.gives==="fast"?["head","headOverHeels"]:["head","heels","headOverHeels"]}}:{},...t.type==="movingPlatform"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",facing:Pe[t.config.startDirection]}:{},...t.type==="switch"?{setting:t.config.initialSetting,touchedOnProgression:-1}:{},...t.type==="block"?{disappearing:t.config.disappearing??null}:{},...t.type==="conveyor"?{disappearing:t.config.disappearing??null}:{},...t.type==="barrier"?{disappearing:t.config.disappearing??null}:{},...t.type==="lift"?{direction:"up",vels:{lift:le}}:{},...t.type==="charles"?{facing:Pe.towards}:{},...t.type==="emitter"?{lastEmittedAtRoomTime:Ee,quantityEmitted:0}:{},...t.type==="firedDoughnut"?{disappearing:{on:"touch"},vels:{fired:t.config.direction?As(Pe[t.config.direction],Km.firedDoughnut):le}}:{}}},Bi=K.h*2,z1=4,Gr=K.h*z1,D1=2,L1=2*K.w,B1=.5,Qu=2;function*F1(t,e){const{config:{direction:n},position:r}=t,o=ho(n),s=Pr(o),i=A1(t),a={...le,[s]:i?-.5:0},l=1,c={[s]:i?-1:0},u=l*K.w,d={...le,[s]:u},f=9,p=8,g=8;{const y={[o]:p,[s]:g,z:Gr};yield{...t,...rt,type:"doorFrame",id:`${e}/frameFar`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"far"},state:{...Be(),position:ke(B(r,{[o]:1.5},a,c)),stoodOnBy:he},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}{const y={[o]:f,[s]:g,z:Gr};yield{...t,...rt,type:"doorFrame",id:`${e}/frameNear`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"near"},state:{...Be(),position:ke(B(r,a,c)),stoodOnBy:he},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}{const y={[o]:2*K.w-f-p,[s]:g,z:Gr-Bi};yield{...t,...rt,type:"doorFrame",id:`${e}/frameTop`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"top"},state:{...Be(),position:B(ke(B(r,a,c)),{[o]:f,z:Bi}),stoodOnBy:he},aabb:B(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}yield{...t,...rt,type:"blocker",id:`${e}/blockerAbove`,jsonItemId:e,config:{},renders:!1,state:{...Be(),position:B(ke(B(r,a,c)),{z:Gr}),stoodOnBy:he},aabb:B(ke({[o]:2,[s]:l,z:Ks}),{[s]:g}),renderAabb:le,fixedZIndex:gn},yield{...t,...rt,type:"portal",id:`${e}/portal`,jsonItemId:e,config:{...sv(t.config,"toRoom","toDoor"),inHidden:i,relativePoint:ke({...le,[s]:i?l+.25:-.25}),direction:Pe[n]},fixedZIndex:gn,state:{...Be(),position:B(ke(B(r,{[s]:i?-.5-l:.5})),{[o]:f}),stoodOnBy:he},aabb:{[o]:D1*K.w-f-p,[s]:u,z:Bi}},r.z!==0&&(yield{...t,...rt,type:"doorLegs",id:`${e}/legs`,jsonItemId:e,config:{...t.config,inHiddenWall:i,style:"none",side:"away",height:r.z},renders:!0,shadowCastTexture:i?{textureId:"shadow.door.floatingThreshold.double.y",flipX:o==="x"}:void 0,state:{...Be(),position:{...ke(B(r,a,c)),z:0}},aabb:B(ke({[o]:2,[s]:.5,z:r.z}),d),renderAabb:i?B(ke({[o]:2,[s]:.5,z:.5})):void 0,renderAabbOffset:i?B({[o]:0,[s]:0,z:(r.z-.5)*K.h},{[s]:d[s]}):void 0,shadowOffset:{z:r.z*K.h,[s]:i?d[s]:void 0}}),yield{type:"stopAutowalk",id:`${e}/stopAutowalk`,jsonItemId:e,aabb:ke({[o]:2,[s]:Qu,z:2}),config:{},fixedZIndex:gn,state:{...Be(),position:ke(hr(r,As(Pe[n],B1),i?le:{[s]:Qu})),stoodOnBy:he}}}const ed={config:he,shadowCastTexture:"shadow.smallRound",aabb:Oe},td=()=>{const t=hy(U.getState());return{action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:Pe.towards,walkStartFacing:Pe.towards,walkDistance:0,vels:{walking:le,gravity:le,movingFloor:le},switchedToAt:Ee,lastDiedAt:Ee,gameTime:0,jumpStartTime:Ee,lives:t?"infinite":O1,jumpStartZ:0}},U1=(t,e)=>{const n=dy(U.getState());return t.config.which==="head"?{id:e,jsonItemId:e,type:"head",...rt,...ed,state:{...Be(),...Zu(),...td(),hasHooter:!1,gameWalkDistance:0,fastStepsStartedAtDistance:Ee,shieldCollectedAt:Ee,doughnuts:n?"infinite":0,position:Ga(t),stoodOnUntilRoomTime:Ee}}:{id:e,jsonItemId:e,type:"heels",...rt,...ed,state:{...Be(),...Zu(),...td(),carrying:null,hasBag:!1,bigJumps:0,isBigJump:!1,shieldCollectedAt:Ee,position:Ga(t),stoodOnUntilRoomTime:Ee}}},lo=(t,e={})=>{const n=yh(e),r=hr(uc,t);return hr(fy(n,uc),r)},Ym=1,H1={x:K.w,y:K.d*Ym,z:Ks},W1={x:K.w,y:0,z:Jm},G1={x:K.w*Ym,y:K.d,z:Ks},q1={x:0,y:K.d,z:Jm},V1=(t,e)=>{const{config:{direction:n},position:r}=e,o=dl(e.config),s=ho(n),i=Pr(s),a=iv(n),l={...le,[i]:a?-1:0};return{type:"wall",id:t,jsonItemId:t,config:e.config,aabb:lo(s==="y"?G1:H1,o),renderAabb:a?le:lo(s==="y"?q1:W1,o),fixedZIndex:a?gn:void 0,state:{...Be(),position:ke(B(r,l)),stoodOnBy:he},shadowCastTexture:s==="y"?"shadow.wall.y":{textureId:"shadow.wall.y",flipX:!0}}},K1=3,nd=10,rd=.52,od=.5,X1=(t,e,n)=>{const{config:{times:r},position:o}=e,s=B(o,{z:-3}),i={...r,z:K1};let a=s,l=i;const c=vt(us(n.items)).filter(f=>f.type==="door");if(o.z===0){const f={};for(const p of c){const{position:g,config:{direction:y}}=p;switch(y){case"towards":!f.towards&&g.y===s.y&&(l=B(l,{y:od}),a=B(a,{y:-.5}),f.towards=!0);break;case"away":!f.away&&g.y===s.y+r.y&&(l=B(l,{y:rd}),f.away=!0);break;case"right":!f.right&&g.x===s.x&&(l=B(l,{x:od}),a=B(a,{x:-.5}),f.right=!0);break;case"left":!f.left&&g.x===s.x+r.x&&(l=B(l,{x:rd}),f.left=!0);break}}}const u=ke(a),d=lo(pn,l);return{type:"floor",id:t,jsonItemId:t,config:{...e.config,naturalFootprint:{aabb:lo(pn,i),position:ke(s)}},aabb:d,renderAabb:{...d,z:nd},renderAabbOffset:{...le,z:d.z-nd},shadowCastTexture:"shadow.fullBlock",state:{...Be(),position:u}}};function*Xs(t,e,n,r=he,o={},s=""){if(!r[t]&&!(e.type==="pickup"&&e.config.gives==="scroll"&&o[e.config.page]))switch(!0){case e.type==="door":return yield*F1(e,t);case e.type==="player":{yield U1(e,t);return}case e.type==="wall":{yield V1(t,e);return}case e.type==="floor":{yield X1(t,e,n);return}case(e.type==="block"&&e.config.disappearing!==void 0&&Ts(fs(e))>=2):{const i=fs(e);for(let a=0;a<i.x;a++)for(let l=0;l<i.y;l++)for(let c=0;c<i.z;c++){const u=rl(e,d=>{d.position={x:e.position.x+a,y:e.position.y+l,z:e.position.z+c},d.config.times=hh});yield*Xs(t,u,n,r,o,`${s}_${a}_${l}_${c}`)}break}case(e.type==="sceneryCrown"&&!U.getState().gameMenus.planetsLiberated[e.config.planet]):return;default:{const i=qm(e),a=e.config.times!==void 0?{aabb:lo(i.aabb,e.config.times),renderAabb:void 0}:i;let l;try{l=M1(e)}catch(c){throw new Error(`loadItemFromJson: error creating initial state for jsonItem ${JSON.stringify(e,null,2)}`,{cause:c})}yield{...e,...rt,...a,id:`${t}${s}`,jsonItemId:t,fixedZIndex:e.type==="emitter"?gn:void 0,shadowCastTexture:J1(e),config:e.config,state:l}}}}const J1=t=>{switch(t.type){case"lift":return"shadow.smallBlock";case"conveyor":return{textureId:"shadow.fullBlock",flipX:Kt(t.config.direction)==="x"};case"barrier":return{textureId:"shadow.barrier.y",flipX:t.config.axis==="x"};case"spring":case"firedDoughnut":case"slidingDeadly":return"shadow.smallRound";case"block":return t.config.style==="tower"?"shadow.smallRound":"shadow.fullBlock";case"pushableBlock":case"movingPlatform":case"hushPuppy":case"deadlyBlock":case"teleporter":case"spikes":return"shadow.fullBlock";case"portableBlock":return t.config.style==="drum"?"shadow.smallRound":"shadow.smallBlock";case"pickup":return t.config.gives==="scroll"?"shadow.scroll":"shadow.smallRound";case"ball":case"charles":case"monster":return"shadow.smallRound";case"slidingBlock":return t.config.style==="book"?"shadow.fullBlock":"shadow.smallRound"}},Js=({aabb:t,state:{position:e}},{aabb:n,state:{position:r}})=>!(e.x+t.x<=r.x||e.x>=r.x+n.x)&&!(e.y+t.y<=r.y||e.y>=r.y+n.y)&&!(e.z+t.z<=r.z||e.z>=r.z+n.z),Y1=(t,e)=>[...vt(e).filter(n=>t.id!==n.id&&Js(t,n))];function*qa(t,e){for(const n of e)t.id!==n.id&&Js(t,n)&&(yield n)}function*Z1(t,e){if(t.roomBelow!==void 0)for(const n of $e(e).filter(dc)){const{config:{naturalFootprint:r}}=n;yield{...rt,type:"portal",id:"floor/portal",fixedZIndex:gn,config:{toRoom:t.roomBelow,relativePoint:{x:r.aabb.x/2,y:r.aabb.y/2,z:r.aabb.z},direction:Pe.down},aabb:r.aabb,state:{...Be(),position:r.position},renders:!1}}if(t.roomAbove!==void 0)for(const n of $e(e).filter(dc)){const{config:{naturalFootprint:r}}=n;yield{...rt,type:"portal",id:"ceilingPortal",fixedZIndex:gn,config:{toRoom:t.roomAbove,relativePoint:{...t.ceilingRelativePoint!==void 0?ke(t.ceilingRelativePoint):{x:r.aabb.x/2,y:r.aabb.y/2},z:-12},direction:Pe.up},aabb:{...r.aabb,z:K.h},state:{...Be(),position:B(r.position,{z:r.aabb.z},{z:K.h*(t.height??Xm)})}}}}const Q1=(t,e,n,r)=>{const o=Math.max(0,Math.min(t.x+e.x,n.x+r.x)-Math.max(t.x,n.x)),s=Math.max(0,Math.min(t.y+e.y,n.y+r.y)-Math.max(t.y,n.y));return o*s},sd=({state:{position:t},aabb:e},{state:{position:n},aabb:r})=>Q1(t,e,n,r),id={stopAutowalk:5,portal:5,wall:5,blocker:5,doorLegs:5,sceneryPlayer:5,bubbles:5,switch:10,doorFrame:15,ball:18,block:20,barrier:20,floor:20,hushPuppy:20,teleporter:20,lift:30,movingPlatform:30,pushableBlock:30,portableBlock:30,sceneryCrown:30,slidingBlock:30,spring:30,joystick:40,charles:40,conveyor:40,head:50,heels:50,headOverHeels:50,pickup:80,firedDoughnut:90,spikes:98,slidingDeadly:100,moveableDeadly:100,deadlyBlock:100,monster:100,floatingText:200,particle:200,emitter:200},eP=(t,e)=>id[t.type]-id[e.type],tP=(t,e,n=.001)=>{if(!pr(e,t)||t.id===e.id)return!1;const{state:{vels:{gravity:{z:r}}}}=t;return r>0?!1:Js({state:{position:B(t.state.position,{x:0,y:0,z:-1e-4})},aabb:{...t.aabb,z:n+fh},id:t.id},{state:{position:B(e.state.position,{x:0,y:0,z:e.aabb.z})},aabb:{...e.aabb,z:0},id:e.id})},nP=(t,e)=>{const r=[...vt(e).filter(s=>tP(t,s))];return r.length===0?void 0:r.reduce((s,i)=>{const a=eP(i,s);return a<0||a===0&&sd(t,i)>sd(t,s)?i:s})},rP=({above:t,below:e})=>{const n=e.state.stoodOnBy;if(!Object.isExtensible(n))throw new Error(`${t.id} can't stand on ${e.id} - its standingOn is not extensible`);t.state.standingOnItemId=e.id,n[t.id]=!0};function*oP(t,e,n,r){const o=my(t.items);for(const[s,i]of o)i.type==="player"&&!r||(yield*Xs(s,i,t,e,n))}const ad=t=>vt(t).reduce((e,n)=>({...e,[n.id]:n}),{}),Fi=({roomJson:t,roomPickupsCollected:e,scrollsRead:n,isNewGame:r=!1})=>{const o=ad(oP(t,e,n,r)),s={...ad(Z1(t,o)),...o};for(const a of $e(s)){const c=Y1(a,py(s)).find(u=>pr(a)&&pr(u)&&!(a.type==="wall"&&u.type==="wall"));c!==void 0&&console.error(`in room ${t.id} item ${a.id} @${JSON.stringify(a.state.position)} #${JSON.stringify(a.aabb)} is colliding with (solid item) ${c.id} @${JSON.stringify(c.state.position)} #${JSON.stringify(c.aabb)} on loading room ${t.id}`)}for(const a of $e(s).filter(av)){const l=nP(a,$e(s).filter(c=>c.id!==a.id));l!==void 0&&rP({above:a,below:l})}return{...t,roomJson:t,items:s,roomTime:0}},sP=t=>()=>Tn(t),yR=sP(fr),iP=Th([fr,t=>t.levelEditor.previewedEdits],(t,e)=>rl(t,n=>{const r=ph(e);for(const[o,s]of r)s===null?delete n.items[o]:n.items[o]=s})),Zl=m.createContext(null),aP=()=>{const[t,e]=m.useState(()=>Fi({roomJson:fr(U.getState()),roomPickupsCollected:he,scrollsRead:he,isNewGame:!0})),[n,r]=m.useState(t),o=fe(fr),s=fe(iP);return m.useEffect(()=>{const i=Fi({roomJson:o,roomPickupsCollected:he,scrollsRead:he,isNewGame:!0});if(e(i),o===s)r(i);else{const a=Fi({roomJson:s,roomPickupsCollected:he,scrollsRead:he,isNewGame:!0});r(a)}},[o,s]),{roomState:t,roomStateWithPreviews:n}},lP=({children:t})=>{const e=aP();return h.jsx(Zl,{value:e,children:t})},Zm=()=>{const t=m.useContext(Zl);if(t===null)throw new Error("no room state in context, or no context");return t.roomState},Qm=()=>{const t=m.useContext(Zl);if(t===null)throw new Error("no room state in context, or no context");return t.roomStateWithPreviews},cP=t=>$e(t.items).filter(e=>pr(e)),eg=(t,e)=>{const n=vt(cP(t));return e==="door"?n.filter(o=>o.type!=="wall"):n},tg=({roomState:t,jsonItemIds:e,blockPositionDelta:n,timesDelta:r})=>{const o=Rc(Ec(a=>[a,t.roomJson.items[a]]),Ec(([a,l])=>[a,rl(l,c=>{c.position=B(c.position,n),lv(c,r)})]),Bv(function*([a,l]){for(const c of Xs(a,l,t.roomJson))yield[a,l,c]}),cv(([,,a])=>pr(a))),s=Array.from(o(e));return Rc(Zv(([,a,l])=>{const c=vt(eg(t,a.type)).filter(u=>u.jsonItemId&&!e.includes(u.jsonItemId));for(const u of qa(l,c))return console.warn(l.id,"colliding with static item",u.id),!0;for(const u of qa(l,s.map(([d,f,p])=>p)))return console.warn(l.id,"colliding with other mutating item",u.id),!0;return!1}))(s)},uP=({roomState:t,blockPosition:e,itemTool:n})=>{const r=Xs("maybeAddedItem",{...n,position:e},t.roomJson),o=Array.from(eg(t,n.type));return r.some(s=>{const i=qa(s,o);return!Oh(i)})},dP=()=>{const t=He(),e=fe(a=>a.levelEditor.selectedJsonItemIds.map(l=>ul(a.levelEditor).items[l])),n=e.length>0,r=Zm(),o=n?no(...e.map(a=>hl(a))):le,s=n?e.map(a=>fs(a)).reduce((a,l)=>({x:Math.max(a.x,l.x),y:Math.max(a.y,l.y),z:Math.max(a.z,l.z)}),hh):le,i=(a=le,l)=>()=>{if(r===null)return;const c=U.getState().levelEditor,{gridResolution:u,selectedJsonItemIds:d}=c,f=l?a:no(a,{x:u,y:u,z:1});if(tg({roomState:r,jsonItemIds:d,blockPositionDelta:f})){console.warn("nudge would collide");return}t(vh({jsonItemIds:d,positionDelta:f,timesDelta:{...le,...l}})),t(wh())};return h.jsxs("div",{className:"flex flex-row flex-wrap gap-x-0 gap-y-oneScaledPix items-center mt-1",children:[h.jsx(I,{className:"inline-block mr-1 text-lightGrey leading-none pr-oneScaledPix",noSlitWords:!0,children:"move  "}),h.jsxs("div",{className:"flex flex-row flex-wrap gap-oneScaledPix items-center",children:[h.jsx(se,{small:!0,disabled:!n,onClick:i(Pe.left),shortcutKeys:["ArrowLeft"],children:h.jsx(I,{className:"relative leading-none",children:"↖"})}),h.jsx(se,{small:!0,disabled:!n,onClick:i(Pe.right),shortcutKeys:["ArrowRight"],children:h.jsx(I,{className:"relative leading-none",children:"↘"})}),h.jsx(se,{small:!0,disabled:!n,onClick:i(Pe.away),shortcutKeys:["ArrowUp"],children:h.jsx(I,{className:"relative leading-none",children:"↗"})}),h.jsx(se,{small:!0,disabled:!n,onClick:i(Pe.towards),shortcutKeys:["ArrowDown"],children:h.jsx(I,{className:"relative leading-none",children:"↙"})}),h.jsx(se,{small:!0,disabled:!n,onClick:i(Pe.up),shortcutKeys:["PageUp"],children:h.jsx(I,{className:"relative leading-none",children:"⬆"})}),h.jsx(se,{small:!0,disabled:!n,onClick:i(Pe.down),shortcutKeys:["PageDown"],children:h.jsx(I,{className:"relative leading-none",children:"⬇"})})]}),h.jsxs("div",{className:"flex flex-row flex-wrap gap-x-0 gap-y-oneScaledPix items-center",children:[h.jsx(I,{className:"inline-block mr-1 text-lightGrey leading-none pr-oneScaledPix",noSlitWords:!0,children:"grow  "}),h.jsxs("div",{className:"flex flex-row flex-wrap gap-oneScaledPix items-center",children:[h.jsx(se,{small:!0,disabled:o.x===0,onClick:i(void 0,{x:1}),shortcutKeys:["⌥ArrowLeft"],children:h.jsx(I,{className:"relative leading-none",children:"↖"})}),h.jsx(se,{small:!0,disabled:o.x===0,onClick:i({x:-1,y:0,z:0},{x:1}),shortcutKeys:["⌥ArrowRight"],children:h.jsx(I,{className:"relative leading-none",children:"↘"})}),h.jsx(se,{small:!0,disabled:o.y===0,onClick:i(void 0,{y:1}),shortcutKeys:["⌥ArrowUp"],children:h.jsx(I,{className:"relative leading-none",children:"↗"})}),h.jsx(se,{small:!0,disabled:o.y===0,onClick:i({x:0,y:-1,z:0},{y:1}),shortcutKeys:["⌥ArrowDown"],children:h.jsx(I,{className:"relative leading-none",children:"↙"})}),h.jsx(se,{small:!0,disabled:o.z===0,onClick:i(void 0,{z:1}),shortcutKeys:["⌥PageUp"],children:h.jsx(I,{className:"relative leading-none",children:"⬆"})}),h.jsx(se,{small:!0,disabled:o.z===0,onClick:i({x:0,y:0,z:-1},{z:1}),shortcutKeys:["⌥PageDown"],children:h.jsx(I,{className:"relative leading-none",children:"⬇"})})]})]}),h.jsxs("div",{className:"flex flex-row flex-wrap gap-x-0 gap-y-oneScaledPix items-center",children:[h.jsx(I,{className:"inline-block mr-1 text-lightGrey leading-none pr-oneScaledPix",noSlitWords:!0,children:"shrink"}),h.jsxs("div",{className:"flex flex-row flex-wrap gap-oneScaledPix items-center",children:[h.jsx(se,{small:!0,disabled:s.x<=1,onClick:i(void 0,{x:-1}),shortcutKeys:["⌥⇧ArrowRight"],children:h.jsx(I,{className:"relative leading-none",children:"↘"})}),h.jsx(se,{small:!0,disabled:s.x<=1,onClick:i({x:1,y:0,z:0},{x:-1}),shortcutKeys:["⌥⇧ArrowLeft"],children:h.jsx(I,{className:"relative leading-none",children:"↖"})}),h.jsx(se,{small:!0,disabled:s.y<=1,onClick:i(void 0,{y:-1}),shortcutKeys:["⌥⇧ArrowDown"],children:h.jsx(I,{className:"relative leading-none",children:"↙"})}),h.jsx(se,{small:!0,disabled:s.y<=1,onClick:i({x:0,y:1,z:0},{y:-1}),shortcutKeys:["⌥⇧ArrowUp"],children:h.jsx(I,{className:"relative leading-none",children:"↗"})}),h.jsx(se,{small:!0,disabled:s.z<=1,onClick:i(void 0,{z:-1}),shortcutKeys:["⌥⇧PageDown"],children:h.jsx(I,{className:"relative leading-none",children:"⬇"})}),h.jsx(se,{small:!0,disabled:s.z<=1,onClick:i({x:0,y:0,z:1},{z:-1}),shortcutKeys:["⌥⇧PageUp"],children:h.jsx(I,{className:"relative leading-none",children:"⬆"})})]})]})]})},hP=`
## Back

Go back to the previous room
`,fP=`
## Forward

The opposite of back
`,pP=()=>{const t=fe(({levelEditor:r})=>{const{editingRoomIdHistory:o}=r;return o.back.length>0}),e=fe(({levelEditor:r})=>{const{editingRoomIdHistory:o}=r;return o.forward.length>0}),n=He();return h.jsxs(h.Fragment,{children:[h.jsx(se,{className:"bg-highlightBeige",disabled:!t,onClick:()=>{n(uv())},shortcutKeys:["⇧<"],tooltipContent:hP,children:h.jsx("span",{className:"sprite texture-hud_char_lt relative"})}),h.jsx(se,{className:"bg-highlightBeige",disabled:!e,onClick:()=>{n(dv())},shortcutKeys:["⇧>"],tooltipContent:fP,children:h.jsx("span",{className:"sprite texture-hud_char_gt relative"})})]})},mP=({className:t})=>{const e=He();return h.jsx(wr,{className:t,label:"coalesce",value:fe(n=>n.levelEditor.autoCoalesce),onChange:n=>{e(hv(n))},shortcutKeys:["L"],tooltipContent:"optimise blocks into single items while editing, or keep separate?"})},gP=`
## Share

copies a link to the clipboard

anyone with the link can play your game
`,yP=()=>{const t=Gm(),{doneNow:e,justDone:n}=Wm();return n>0?h.jsx(se,{className:"bg-moss",children:h.jsx(I,{className:"relative leading-none",children:"OK!"})}):h.jsx(se,{disabled:!t,onClick:async()=>{const r=new URL("https://blockstack.ing"),o=r.searchParams,{data:{session:s}}=await Sn.auth.getSession(),i=s?.user.id;if(i===void 0)throw new Error("no user id on supabase session");o.set("campaignName","sequel"),o.set("campaignAuthor",i),o.set("noSaves","1"),navigator.clipboard.writeText(r.toString()).then(e)},tooltipContent:gP,children:h.jsx("span",{className:"sprite sprite-tinted texture-hud_char_ relative"})})},Vo=()=>h.jsx("div",{className:"w-[calc(var(--block)-1px)]"}),vP=()=>{const t=fe(r=>r.levelEditor.campaignInProgress),e=fe(r=>r.levelEditor.currentlyEditingRoomId),n=He();return h.jsxs("div",{className:"scale-editor flex w-full h-full text-white bg-metallicBlueHalfbrite pb-1 gap-1 flex-wrap justify-start overflow-auto",children:[h.jsx("div",{className:Te,children:h.jsx(C1,{className:"w-full mb-1"})}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full",children:"Campaign"}),h.jsx(w1,{}),h.jsx(yP,{}),h.jsx(Vo,{}),h.jsx(b1,{}),h.jsx(x1,{})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full pt-1",children:"Room"}),h.jsx(pP,{}),h.jsx(Vo,{}),h.jsx(P1,{}),h.jsx(Vo,{}),h.jsx(ZC,{}),h.jsx(mm,{value:e,campaign:t,onSelect:r=>{n(hs(r))},triggerButtonClassName:"w-full",tooltipContent:"Choose the room to view/edit"}),h.jsx("div",{className:"h-1 w-full"}),h.jsx(WC,{}),h.jsx(HC,{}),h.jsx("div",{className:"h-half w-full"}),h.jsx(QC,{}),h.jsx(eS,{})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full pt-1",children:"Edit"}),h.jsxs("div",{className:Te,children:[h.jsx(UC,{}),h.jsx(tS,{})]}),h.jsx(KC,{}),h.jsx(Vo,{}),h.jsx(LC,{}),h.jsx(dP,{}),h.jsx("div",{className:"h-1 w-full"}),h.jsxs("div",{className:"flex flex-row justify-between flex-wrap gap-x-2",children:[h.jsx(FC,{}),h.jsx(XC,{}),h.jsx(mP,{})]})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full pt-1",children:"Blocks"}),h.jsx($,{itemTool:{type:"block",config:{style:"organic"}},shortcutKeys:["B"],tooltipContent:`## Block 
The basic block`,children:h.jsx("span",{className:`sprite texture-block_organic ${W}`})}),h.jsx($,{itemTool:{type:"block",config:{style:"organic",disappearing:{on:"stand"}}},shortcutKeys:["⇧B"],tooltipContent:`## Block 
Disappearing basic block`,children:h.jsx(Fo,{iconClassName:ye("texture-block_organic_disappearing")})}),h.jsx($,{itemTool:{type:"block",config:{style:"artificial"}},shortcutKeys:["⌥B"],tooltipContent:`## Block 
Basic block with a metallic look`,children:h.jsx("span",{className:`sprite texture-block_artificial ${W}`})}),h.jsx($,{itemTool:{type:"block",config:{style:"artificial",disappearing:{on:"stand"}}},shortcutKeys:["⌥⇧B"],tooltipContent:`## Block 
Disappearing metallic look block`,children:h.jsx(Fo,{iconClassName:ye("texture-block_artificial_disappearing")})}),h.jsx($,{itemTool:{type:"block",config:{style:"tower"}},shortcutKeys:["T"],tooltipContent:`## Tower
Very high block`,children:h.jsx("span",{className:`sprite texture-tower ${W}`})}),h.jsx($,{itemTool:{type:"block",config:{style:"book"}},children:h.jsx("span",{className:`sprite texture-book_x ${W}`})}),h.jsxs(Dr,{children:[h.jsx($,{itemTool:{type:"barrier",config:{axis:"x"}},children:h.jsx("span",{className:`sprite texture-barrier_x ${W}`})}),h.jsx($,{itemTool:{type:"barrier",config:{axis:"y"}},children:h.jsx("span",{className:`sprite texture-barrier_y ${W}`})}),h.jsx($,{itemTool:{type:"barrier",config:{axis:"x",disappearing:{on:"touch"}}},children:h.jsx(Fo,{iconClassName:ye("texture-barrier_x")})}),h.jsx($,{itemTool:{type:"barrier",config:{axis:"y",disappearing:{on:"touch"}}},children:h.jsx(Fo,{iconClassName:ye("texture-barrier_y")})})]})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full",children:"Monsters"}),h.jsx($,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},tooltipContent:`## mojo
the emperor’s worker bots

patrols randomly in a diagonal pattern`,children:h.jsx("span",{className:`sprite texture-dalek_1 [button:hover_&]:texture-animated-dalek" ${W}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},tooltipContent:`## guard
hovers towards the player on the shortest axis

heels can outrun, but not head

place on a toaster to make a charging guard`,children:h.jsx(Ct,{topClasses:"texture-cyberman_towards [button:hover_&]:texture-cyberman_right",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),h.jsx($,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},tooltipContent:`## monster
moves *back and forth* by default

or can be set to *patrol clockwise*`,children:h.jsx("span",{className:`sprite texture-skiHead_greenAndPink_towards [button:hover_&]:texture-skiHead_greenAndPink_right ${W}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:h.jsx("span",{className:`sprite texture-helicopterBug_1 [button:hover_&]:texture-animated-helicopterBug ${W}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},tooltipContent:`## turtle
plods along in a clockwise pattern`,children:h.jsx("span",{className:`sprite texture-turtle_towards_1 [button:hover_&]:texture-animated-turtle_right ${W}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},tooltipContent:`## homing bot
detects a player in a straight line on an axis and rushes towards them`,children:h.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase_all ${W}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},tooltipContent:`## Computer bot
usually patrols randomly, but can be programmed to move towards the player`,children:h.jsx(Ct,{topClasses:"texture-computerBot_towards [button:hover_&]:texture-computerBot_right"})}),h.jsx($,{itemTool:{type:"monster",config:{which:"bubbleRobot",activated:"on",movement:"patrol-randomly-xy8"}},tooltipContent:`## Bubble bot
patrols randomly in 8 directions

fast and dangerous`,children:h.jsx(Ct,{topClasses:ye("texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"),bottomClasses:ye("texture-headlessBase")})}),h.jsx($,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:h.jsx(Ct,{topClasses:"texture-monkey_towards [button:hover_&]:texture-monkey_right"})}),h.jsx($,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},children:h.jsx(Ct,{topClasses:"texture-elephant_towards [button:hover_&]:texture-elephant_right"})}),h.jsx($,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},tooltipContent:`## Elephant head
Things have gone weird

Stationary, but deadly`,children:h.jsx("span",{className:`sprite texture-elephant_towards [button:hover_&]:texture-elephant_right ${W}`})}),h.jsx($,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",tooltipContent:`## Emperor's Guardian

very dangerous

moves towards the player, unless they have all four planet crowns

does not *like doughnuts*
`,children:h.jsx(Ct,{topClasses:"texture-ball",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),h.jsx($,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},tooltipContent:`## Emperor
The end boss, usually found guarding his Blacktooth crown`,children:h.jsx("span",{className:`sprite texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold ${W}`})})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full",children:"Pickups"}),h.jsxs(Dr,{children:[h.jsx($,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:h.jsx(_t,{iconClasses:"texture-whiteRabbit",text:"2"})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"shield"}},children:h.jsx(_t,{iconClasses:"texture-whiteRabbit",text:"🛡"})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"jumps"}},children:h.jsx(_t,{iconClasses:"texture-whiteRabbit",text:"♨"})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"fast"}},children:h.jsx(_t,{iconClasses:"texture-whiteRabbit",text:"⚡"})})]}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"bag"}},children:h.jsx("span",{className:`sprite texture-bag ${W}`})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"hooter"}},tooltipContent:`## hooter

head's doughnut firing hooter`,children:h.jsx("span",{className:`sprite texture-hooter ${W}`})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:h.jsx("span",{className:`sprite texture-doughnuts ${W}`})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"reincarnation"}},children:h.jsx("span",{className:`sprite texture-fish_1 [button:hover_&]:texture-animated-fish ${W}`})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:h.jsx("span",{className:`sprite texture-crown_blacktooth ${W}`})}),h.jsx($,{itemTool:{type:"pickup",config:{gives:"scroll",page:"blacktooth"}},children:h.jsx("span",{className:`sprite texture-scroll ${W}`})})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full",children:"deadly"}),h.jsxs(Dr,{children:[h.jsx($,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},children:h.jsx("span",{className:`sprite texture-volcano_1 [button:hover_&]:texture-animated-volcano ${W}`})}),h.jsx($,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},children:h.jsx("span",{className:`sprite texture-toaster_off ${W}`})})]}),h.jsx($,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},tooltipContent:`## Spiky ball
rolls fast if pushed

deadly to touch`,children:h.jsx("span",{className:`sprite texture-spikyBall_1 [button:hover_&]:texture-spikyBall_2 ${W}`})}),h.jsx($,{itemTool:{type:"spikes",config:he},tooltipContent:`## spikes

deadly to touch on top

safe to run into the sides`,children:h.jsx("span",{className:`sprite texture-spikes ${W}`})}),h.jsx($,{itemTool:{type:"moveableDeadly",config:{style:"deadFish"}},tooltipContent:`## dead fish

(deadly to touch)

dead fish decompose very quickly and it rapidly
turns so poisonous that a single lick can kill`,children:h.jsx("span",{className:`sprite texture-fish_1 ${W}`})})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full",children:"control"}),h.jsx($,{itemTool:{type:"charles",config:he},children:h.jsx(Ct,{topClasses:"texture-charles_towards [button:hover_&]:texture-charles_right"})}),h.jsx($,{itemTool:{type:"joystick",config:{controls:["charles"]}},tooltipContent:`## Joystick
Controls one or more Charles bots

Change *which* Charles in the json`,children:h.jsx("span",{className:`sprite texture-joystick ${W}`})}),h.jsx($,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:ds}},tooltipContent:`## Switch
toggles when touched.

edit the json to choose:

* de/activate monsters
* turn on/off moving platforms
* make blocks disappear on touch`,children:h.jsx("span",{className:`sprite texture-switch_left [button:hover_&]:texture-switch_right ${W}`})})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full",children:"movable"}),h.jsx($,{itemTool:{type:"spring",config:{}},children:h.jsx("span",{className:`sprite texture-spring_released [button:hover_&]:texture-spring_compressed ${W}`})}),h.jsxs(Dr,{children:[h.jsx($,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:h.jsx("span",{className:`sprite texture-cube ${W}`})}),h.jsx($,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:h.jsx("span",{className:`sprite texture-drum ${W}`})}),h.jsx($,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:h.jsx("span",{className:`sprite texture-sticks ${W}`})})]}),h.jsx($,{itemTool:{type:"pushableBlock",config:{}},children:h.jsx("span",{className:`sprite texture-stepStool ${W}`})}),h.jsx($,{itemTool:{type:"ball",config:he},children:h.jsx("span",{className:`sprite texture-ball ${W}`})}),h.jsx($,{itemTool:{type:"slidingBlock",config:{style:"puck"}},tooltipContent:`## Sliding puck

Small item that can be stood on and slides when touched`,children:h.jsx("span",{className:`sprite texture-puck ${W}`})}),h.jsx($,{itemTool:{type:"slidingBlock",config:{style:"book"}},tooltipContent:`## Sliding book

Why are the books slippery?`,children:h.jsx("span",{className:`sprite texture-book_y ${W}`})})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full",children:"misc."}),h.jsxs($,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[h.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_static ${W} [button:active_&]:top-oneScaledPix`}),h.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_1 [button:hover_&]:texture-animated-lift ${W} [button:active_&]:top-oneScaledPix`})]}),h.jsxs(Dr,{children:[h.jsx($,{itemTool:{type:"conveyor",config:{direction:"away"}},children:h.jsx(_t,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-conveyor_y",text:"↗"})}),h.jsx($,{itemTool:{type:"conveyor",config:{direction:"towards"}},children:h.jsx(_t,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-reversed-conveyor_y",text:"↙"})}),h.jsx($,{itemTool:{type:"conveyor",config:{direction:"left"}},children:h.jsx(_t,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-conveyor_x",text:"↖"})}),h.jsx($,{itemTool:{type:"conveyor",config:{direction:"right"}},children:h.jsx(_t,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-reversed-conveyor_x",text:"↘"})})]}),h.jsx($,{itemTool:{type:"teleporter",config:{toRoom:"to?",toPosition:le}},children:h.jsx("span",{className:`sprite texture-teleporter ${W}`})}),h.jsx($,{itemTool:{type:"movingPlatform",config:{movement:"clockwise",activated:"on",startDirection:"towards"}},tooltipContent:`## Moving Platform
Clockwise or back-and-forth

Can be (de)activated by a switch, or touch 

Why a sandwich?`,children:h.jsx("span",{className:`sprite texture-sandwich ${W}`})}),h.jsx($,{itemTool:{type:"hushPuppy",config:{}},children:h.jsx("span",{className:`sprite texture-hushPuppy ${W}`})})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full",children:"Structure"}),h.jsx(JC,{}),h.jsx(YC,{}),h.jsx($,{itemTool:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:{x:1,y:1}}},children:h.jsx("span",{className:`sprite texture-blacktooth_floor ${W}`})})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full",children:"Player"}),h.jsx($,{itemTool:{type:"player",config:{which:"head"}},tooltipContent:`## Head

Place on of these into one room

This is where head will start the game`,children:h.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${W}`})}),h.jsx($,{itemTool:{type:"player",config:{which:"heels"}},tooltipContent:`## Heels

Place on of these into one room

This is where head will start the game`,children:h.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${W}`})})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full",children:"NPC’s"}),h.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"head",startDirection:"towards"}},tooltipContent:`##NPC head
Citizens of Freedom

stand around not doing much`,children:h.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${W}`})}),h.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"heels",startDirection:"towards"}},tooltipContent:`##NPC heels
Citizens of Freedom

stand around not doing much`,children:h.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${W}`})}),h.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"headOverHeels",startDirection:"towards"}},tooltipContent:`##NPC head over heels
Citizens of Freedom

stand around not doing much`,children:h.jsx(Ct,{topClasses:"texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right",bottomClasses:"texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right"})})]}),h.jsxs("div",{className:Te,children:[h.jsx(I,{className:"w-full pt-2",children:"debug"}),h.jsx(zC,{})]})]})},_r=(t,e)=>({get bottomCentre(){return this.c000},get topLeft(){return this.c101},get topRight(){return this.c011},get c000(){return q(t)},get c001(){return q(B(t,{z:e.z}))},get c010(){return q(B(t,{y:e.y}))},get c011(){return q(B(t,{y:e.y,z:e.z}))},get c100(){return q(B(t,{x:e.x}))},get c101(){return q(B(t,{x:e.x,z:e.z}))},get c110(){return q(B(t,{x:e.x,y:e.y}))},get c111(){return q(B(t,{x:e.x,y:e.y,z:e.z}))},projectCorner(n){return q(B(t,{x:n.x*e.x,y:n.y*e.y,z:n.z*e.z}))}}),Ui=1e-5,ld=-1,Fr=(t,e,n,r,o)=>r-o>t&&n<e-o,wP=0,ng=1,rg=2,og=3,bP=(t,e,n,r)=>{const{topLeft:o,topRight:s,bottomCentre:i}=_r(t,e),{topLeft:a,topRight:l,bottomCentre:c}=_r(n,r),u=s.y-s.x/2,d=i.y-i.x/2,f=l.y-l.x/2,p=c.y-c.x/2,g=o.y+o.x/2,y=i.y+i.x/2,v=a.y+a.x/2,w=c.y+c.x/2,_=o.x,b=s.x,x=a.x,S=l.x,k=Fr(u,d,f,p,Ui),C=Fr(g,y,v,w,Ui),M=Fr(_,b,x,S,Ui);return k&&C&&M?ng:C&&M&&Fr(u,d,f,p,ld)?rg:k&&M&&Fr(g,y,v,w,ld)?og:wP},xP=(t,e,n,r)=>{for(const o of gy){const s=t[o],i=s+e[o],a=n[o],l=a+r[o];if(i<=a)return 1*(o==="z"?-1:1);if(s>=l)return-1*(o==="z"?-1:1)}return cd(n)-cd(t)},_P=(t,e)=>{if(t.fixedZIndex!==void 0||e.fixedZIndex!==void 0)return 0;const n=t.renderAabb||t.aabb,r=e.renderAabb||e.aabb,o=t.renderAabbOffset?B(t.state.position,t.renderAabbOffset):t.state.position,s=e.renderAabbOffset?B(e.state.position,e.renderAabbOffset):e.state.position;switch(bP(o,n,s,r)){case ng:return xP(o,n,s,r);case rg:return jt(o.y,s.y+r.y)&&jt(o.z,s.z+r.z)?1:jt(s.y,o.y+n.y)&&jt(s.z,o.z+n.z)?-1:0;case og:return jt(o.x,s.x+r.x)&&jt(o.z,s.z+r.z)?1:jt(s.x,o.x+n.x)&&jt(s.z,o.z+n.z)?-1:0;default:return 0}},cd=t=>t.x+t.y-t.z,CP=(t,e,n,r)=>(t.has(e)||t.set(e,new Map),t.get(e).set(n,r),t),Ko=(t,e,n)=>{const r=t.get(e);return r!==void 0&&(r.delete(n),r.size===0&&t.delete(e)),t},sg=(t,e=new Set(us(t)),n=new Map)=>{const r=new Map;for(const[o,s]of n)if(!t[o])n.delete(o);else for(const[i]of s)t[i]||Ko(n,o,i);for(const o of e)if(o.fixedZIndex===void 0)for(const s of us(t)){if(s.fixedZIndex!==void 0||r.get(s)?.has(o)||o===s)continue;const i=_P(o,s);if(r.has(o)||r.set(o,new Set),r.get(o).add(s),i===0){Ko(n,o.id,s.id),Ko(n,s.id,o.id);continue}const a=i>0?o.id:s.id,l=i>0?s.id:o.id;CP(n,l,a,!1),Ko(n,a,l)}return n},ig=t=>{for(const[,l]of t)for(const[c]of l)l.set(c,!1);const e=Array.from(SP(t));let n=e.length,r=n;const o=new Array(n),s={},i=kP(e);for(;r--;)s[r]||a(e[r],r,new Set,null);return o;function a(l,c,u,d){if(u.has(l)){if(d!==null){const g=t.get(d);g?.has(l)&&g.set(l,!0)}return}if(s[c])return;s[c]=!0;const f=t.get(l),p=Array.from(f?.entries()??ua);if(c=p.length){u.add(l);do{const[g,y]=p[--c];y||a(g,i.get(g),u,l)}while(c);u.delete(l)}o[--n]=l}};function SP(t){const e=new Set;for(const[n,r]of t.entries()){e.add(n);for(const o of r.keys())e.add(o)}return e}function kP(t){const e=new Map;for(let n=0,r=t.length;n<r;n++)e.set(t[n],n);return e}class PP{constructor(e,n){this.renderContext=e,this.appearance=n,this.output=new re({label:"AppearanceRenderer"})}#e;output;destroy(){this.output.destroy({children:!0})}tick(e){const n=this.appearance({renderContext:this.renderContext,currentRendering:this.#e,tickContext:e});n!=="no-update"&&(this.output.children.at(0)!==n.output&&(this.#e?.output&&(this.output.removeChild(this.#e.output),this.#e.output.destroy({texture:!0,children:!0})),n.output!==void 0&&this.output.addChild(n.output)),this.#e=n)}}class ag extends PP{}const ud=(t,e)=>{e.poly([q({}),q({x:t.x}),q({x:t.x,y:t.y}),q({y:t.y})]).poly([q({}),q({z:t.z}),q({y:t.y,z:t.z}),q({y:t.y})]).poly([q({x:t.x}),q({x:t.x,z:t.z}),q(t),q({x:t.x,y:t.y})]).poly([q({z:t.z}),q({x:t.x,z:t.z}),q({x:t.x,y:t.y,z:t.z}),q({y:t.y,z:t.z})])},dd=(t,e)=>{const n=new ht;return ud(t,n),n.stroke({width:.5,color:e,alpha:1}),n.eventMode="static",n.on("pointerenter",()=>{n.fill({color:e,alpha:.5})}),n.on("pointerleave",()=>{n.clear(),ud(t,n),n.stroke({width:.5,color:e,alpha:1})}),n},EP={head:"rgba(255,184,0)",wall:"rgba(128,200,0)",portal:"rgba(255,0,255)",pickup:"rgba(0,196,255)",emitter:"rgba(0,255,255)",stopAutowalk:"rgba(255,128,128)",floatingText:"rgba(128,0,255)"};class AP{constructor(e){this.renderContext=e;const{item:n}=e,r=EP[n.type]??"rgba(255,255,255)";if(this.#e=new re({label:`ItemBoundingBoxRenderer ${n.id}`}),fo("portal")(n)){const s=q(n.config.relativePoint);this.#e.addChild(new ht().circle(s.x,s.y,5).stroke(r)),this.#e.addChild(new ht().circle(s.x,s.y,2).fill(r))}if(this.#e.addChild(new ht({label:"objectOrigin"}).circle(0,0,2).fill(r)),this.#e.addChild(dd(n.aabb,r)),n.renderAabb){const s="rgba(184, 184, 255)",i=dd(n.renderAabb,s);if(n.renderAabbOffset){const a=q(n.renderAabbOffset);i.position.set(a.x,a.y),i.circle(0,0,2).fill(s)}this.#e.addChild(i)}this.#e.eventMode="static";let o;this.#e.on("pointerenter",()=>{if(o!==void 0)return;const s=`${n.id} ${n.type}
@(${n.state.position.x}, ${n.state.position.y}, ${n.state.position.z})}
#(${n.aabb.x}, ${n.aabb.y}, ${n.aabb.z})}`;this.#e.addChild(o=new mw({text:s,style:{fill:r,fontSize:6,fontFamily:"Menlo"}})),o.resolution=4}),this.#e.on("pointerleave",()=>{o!==void 0&&(this.#e.removeChild(o),o=void 0)}),e.frontLayer.attach(this.#e)}#e;tick(){}destroy(){this.#e.destroy({children:!0})}get output(){return this.#e}}class TP extends En{constructor(...e){const[n]=e;super(n)}destroy(e){const n=this.texture!==null;typeof e=="boolean"?super.destroy({texture:n,textureSource:e,children:e}):super.destroy({...e,texture:n})}}const RP={Container:"📦",Sprite:"🖼️",UniqueTextureSprite:"✨",Graphics:"🎨",Text:"📝",AnimatedSprite:"🎬",TilingSprite:"🔲",BitmapText:"🔤",Mesh:"🔺",NineSliceSprite:"🔳"},Cs=(t,e="",n=!0,r=!0,o=[])=>{const s=[];r&&s.push("");const i=t.constructor.name,a=i.startsWith("_")?i.slice(1):i;let l=RP[a]||"📌";o.forEach((p,g)=>{p.mask===t&&(g===0?l+="😷":l+=`😷^${g+1}`)});const c=t.label&&t.label!==a?` "${t.label}"`:"",u=[];try{(t.x!==0||t.y!==0)&&u.push(`@(${t.x}, ${t.y})`)}catch{u.push("@(ERROR)")}if(t.children.length>2&&u.push(`children: ${t.children.length}`),t.visible||u.push("hidden"),t.alpha<1&&u.push(`alpha: ${t.alpha.toFixed(2)}`),t.mask&&u.push("😷 masked"),t instanceof En){const p=t;if(p.texture===null||p.texture===void 0)u.push("texture: NO TEXTURE");else{const g=p.texture.label||"(anon texture)";u.push(`texture: "${g}"`)}}const d=r?"":e+(n?"└── ":"├── ");if(s.push(`${d}${l} ${a}${c}`),u.length>0){const p=t.children.length>0,g=r?p?"│  ":"   ":e+(n?"    ":"│   ")+(p?"│  ":"   ");u.forEach(y=>{s.push(`${g}→ ${y}`)})}const f=r?"":e+(n?"    ":"│   ");return t.children.forEach((p,g)=>{const y=g===t.children.length-1;s.push(Cs(p,f,y,!1,[t,...o]))}),s.join(`
`)+(r?`
`:"")},OP=(t,e,n)=>{const r=e.getLocalBounds(),o=Math.ceil(r.maxX-r.minX),s=Math.ceil(r.maxY-r.minY),i=n!==void 0?n.width===o&&n.height===s:!1,a=i?n:Os.create({width:o,height:s,antialias:!1,autoGenerateMipmaps:!1});a.label=`renderTexture of ${e.label??"(anon)"}`,n&&!i&&n.destroy();const{x:l,y:c}=e;e.x-=r.minX,e.y-=r.minY;try{t.render({container:e,target:a,clear:i})}catch(u){throw new Error(`renderContainerToTexture: failed to render to texture. Container:
 ${Cs(e)}`,{cause:u})}return e.x=l,e.y=c,a},Cr=(t,e,n,r)=>{const o=e.getLocalBounds(),s=n?.texture&&n?.texture instanceof Os?n.texture:void 0,i=OP(t,e,s),a=n||new TP;return a.texture=i,a.label=r??`sprite of container (${e.label})`,a.pivot={x:Math.floor(-o.minX),y:Math.floor(-o.minY)},a},bo=(t,e)=>e instanceof En?e:Cr(t,e),lg=new uw;lg.matrix=[0,0,0,1,0,0,.3,0,0,0,0,0,.3,0,0,0,0,0,1,0];class IP{constructor(e,n){this.renderContext=e,this.wrappedRenderer=n,this.output=new re({label:`ItemPositionRenderer ${e.item.id}`,children:[n.output]}),this.#t()}output;#e=new Map;#t(){const e=q(this.renderContext.item.state.position);this.output.x=e.x,this.output.y=e.y}tick(e){this.wrappedRenderer?.tick(e),e.movedItems.has(this.renderContext.item)&&this.#t(),this.#s()}#n(){const e=this.renderContext.item.id,n=this.renderContext.zEdges.get(e);if(!n)return ua;let r;for(const[o,s]of n)s&&(r||(r=new Set),r.add(o));return r??ua}#r(e,n){const r=new re({label:`maskWith: ${e}`,children:[n,this.output.children[0]]});return this.output.addChild(r),r.setMask({mask:n,inverse:!0}),this.#e.set(e,r),r}#o(e,n){const[r,o]=n.children,s=n.parent;s.removeChild(n),s.addChild(o),n.mask=null,r.destroy(),n.destroy(),this.#e.delete(e)}#s(){const{pixiRenderer:e}=this.renderContext.general,n=this.#n();for(const r of this.#e.keys())if(!n.has(r)){const o=this.#e.get(r);if(o)try{this.#o(r,o)}catch(s){throw new Error(`error while destroying masking container ${Cs(o)} 
              for our rendering: ${Cs(this.output)}`,{cause:s})}}for(const r of n){const o=this.#e.get(r),s=o?.children[0],i=this.renderContext.getItemRenderPipeline(r)?.itemAppearanceRenderer?.output;if(i===void 0)throw new Error("nothing to use as a mask");const a=i.filters;i.filters=lg;const l=Cr(e,i,s,`red mask: ${r}`);i.filters=a,o===void 0&&this.#r(r,l);const c=this.renderContext.room.items[r],u=Vt(q(c.state.position),q(this.renderContext.item.state.position));l.x=u.x,l.y=u.y}}destroy(){this.output.destroy({children:!0}),this.wrappedRenderer?.destroy()}}const hd={x:.5,y:1},fd=t=>typeof t!="string"&&Object.hasOwn(t,"animationId"),Va=t=>{if(typeof t=="string")return Va({textureId:t});{const{anchor:e,flipX:n,pivot:r,x:o,y:s,filter:i,times:a,label:l}=t;if(t.times){const u=yh(a);if(Ts(u)>=2){const f=new re({label:l??"timesXyz"});for(let{x:p}=u;p>=1;p--)for(let{y:g}=u;g>=1;g--)for(let y=1;y<=u.z;y++){const v={...t,textureId:t.textureId??t.textureIdCallback?.(p-1,g-1,y-1),label:`(${p},${g},${y})`};delete v.times;const w=Va(v),_=kn({x:p-1,y:g-1,z:y-1});w.x+=_.x,w.y+=+_.y,f.addChild(w)}return f}}let c;if(fd(t))c=jP(t);else{const u=t.textureId??t.textureIdCallback?.(0,0,0);c=new En(qt().textures[u])}if(e===void 0&&r===void 0)if(fd(t))c.anchor=hd;else{const u=t.textureId??t.textureIdCallback?.(0,0,0),d=qt().data.frames[u];if(d===void 0)throw new Error(`no spritesheet entry for textureId "${u}"`);const f=d.frame;f.pivot!==void 0?c.pivot=f.pivot:c.anchor=hd}else e!==void 0&&(c.anchor=e),r!==void 0&&(c.pivot=r);return o!==void 0&&(c.x=o),s!==void 0&&(c.y=s),i!==void 0&&(c.filters=i),l!==void 0&&(c.label=l),c.eventMode="static",n===!0&&(c.scale.x=-1),c}},V=Va;function jP({animationId:t,reverse:e,playOnce:n,paused:r,randomiseStartFrame:o}){const s=qt().animations[t],a=(r?[s[0]]:s).map(c=>({texture:c,time:yy}));e&&a.reverse();const l=new mr(a);return l.animationSpeed=An.animations[t].animationSpeed,l.gotoAndPlay(o?Math.floor(Math.random()*a.length):0),n!==void 0&&(l.loop=!1,l.onComplete=()=>{l.stop(),n==="and-destroy"&&(l.visible=!1)}),l}const Ys=(t,e)=>{const n=e&&{x:e.x??1,y:e.y??1};return V({...typeof t=="string"?{textureId:t}:t,times:n})},zt=t=>Ie(({renderContext:{item:e}})=>bh(e)?V({...typeof t=="string"?{textureId:t}:t,times:fl(e)}):V(t)),Je=t=>Ie(({renderContext:{item:e,general:{pixiRenderer:n}}})=>{if(bh(e))return bo(n,Ys(t,fl(e)));{const r=V(t);return r instanceof En?r:Cr(n,r)}}),Ie=t=>({renderContext:e,currentRendering:n,tickContext:r})=>n===void 0?{output:t({renderContext:e,currentRendering:void 0,tickContext:r}),renderProps:he}:"no-update",Dt=t=>({renderContext:{general:{pixiRenderer:e},item:n},currentRendering:r})=>{if(r===void 0){const o=fl(n),s={output:bo(e,Ys(t(n.config),o)),renderProps:he};return o&&(s.output.y-=((o.z??1)-1)*K.h),s}else return"no-update"},xo=(t,e)=>vt(Rs(t)).map(n=>{const r=e.items[n];if(r===void 0)throw new Error(`item in stoodOnBy "${n}" is not in the room`);return r});fo("head");const $P=fo("heels"),NP=fo("headOverHeels"),MP=t=>{if($P(t))return t.state;if(NP(t))return t.state.heels},zP=1e3/25,cg=t=>{const e=An.animations[t],n=e.length,{animationSpeed:r}=e;return n*zP/r};cg("bubbles.white");cg("head.fadeOut");const Ql=({config:{activatedOnStoreValue:t}})=>t===void 0?!0:ol(U.getState(),t),DP=({renderContext:{general:{pixiRenderer:t},item:e,room:n},currentRendering:r})=>{const{state:{stoodOnBy:o},config:{times:s}}=e,i=r?.renderProps,a=Ql(e),l=a&&xo(o,n).find(pl)!==void 0;return i===void 0||a!==i.activated||l!==i.flashing?{output:bo(t,Ys({textureId:l?"shadowMask.teleporter.flashing":a?"shadowMask.teleporter":"shadowMask.fullBlock"},s)),renderProps:{flashing:l,activated:a}}:"no-update"},Hi=(t,e=1)=>({renderContext:{item:{state:{facing:n}}},currentRendering:r})=>{const o=r?.renderProps,s=sl(n)??"towards";if(!(o===void 0||s!==o.facingXy4))return"no-update";const a=V(s==="left"||s==="away"?`shadowMask.${t}.away`:`shadowMask.${t}.right`);return a.y=-(K.h*(e-1)),a.scale.x=s==="away"||s==="right"?1:-1,{output:a,renderProps:{facingXy4:s}}},pd={lift:Je("shadowMask.smallBlock"),conveyor:Dt(({direction:t})=>({textureId:"shadowMask.conveyor",flipX:Kt(t)==="x"})),doorLegs:Dt(({direction:t})=>({textureId:t==="right"||t==="towards"?"shadowMask.door.floatingThreshold.double.y":"shadowMask.door.legs.threshold.double.y",flipX:Kt(t)==="y"})),teleporter:DP,floor:"no-mask",barrier:Dt(({axis:t})=>({textureId:"shadowMask.barrier.y",flipX:t==="x"})),spring:Je("shadowMask.smallRound"),block:Dt(({style:t})=>t==="tower"?"shadowMask.tower":"shadowMask.fullBlock"),pushableBlock:Je("shadowMask.stepStool"),movingPlatform:Je("shadowMask.fullBlock"),hushPuppy:Je("shadowMask.hushPuppy"),portableBlock:Dt(({style:t})=>t==="drum"?"shadowMask.smallRound":"shadowMask.smallBlock"),slidingBlock:Dt(({style:t})=>t==="book"?"shadowMask.fullBlock":"shadowMask.smallRound"),deadlyBlock:Dt(({style:t})=>t==="volcano"?"shadowMask.volcano":"shadowMask.toaster"),spikes:Je("shadowMask.spikes"),switch:Je("shadowMask.switch"),pickup:Dt(({gives:t})=>{switch(t){case"scroll":return"shadowMask.scroll";case"doughnuts":return"shadowMask.doughnuts";case"fast":case"extra-life":case"jumps":case"shield":return"shadowMask.whiteRabbit";default:return"blank"}}),slidingDeadly:Je("shadowMask.smallRound"),ball:Je("shadowMask.ball"),"monster.dalek":Je("shadowMask.dalek"),"monster.turtle":Hi("turtle"),"monster.skiHead":Hi("skiHead"),"monster.homingBot":Je("shadowMask.smallRound"),joystick:Je("shadowMask.joystick"),charles:Hi("charles",2)},LP=t=>{switch(t.type){case"monster":return pd[`monster.${t.config.which}`];case"floor":return t.config.floorType==="none"?void 0:"no-mask";default:return pd[t.type]}},BP=new lw({alpha:1-Jr});class FP{constructor(e,n){if(this.renderContext=e,this.#e.filters=BP,n!=="no-mask")if(this.#n=new ag(e,n),e.item.shadowOffset===void 0)this.#e.addChild(this.#n.output);else{const r=new re({label:"shadowMaskOffset",...q(e.item.shadowOffset),children:[this.#n.output]});this.#e.addChild(r)}this.#e.addChild(this.#t)}#e=new re({label:"ItemShadowRenderer"});#t=new re({label:"shadows"});#n;#r={};get#o(){return U.getState().gameMenus.userSettings.displaySettings.showShadowMasks}#s(e){if(this.#n===void 0)return;const n=this.#n.output.children.at(0);this.#n.tick(e);const r=this.#n.output.children.at(0);if(r===void 0||!(r instanceof En)){const{item:o}=this.renderContext;throw new Error(`ItemShadowRenderer: this.#shadowMaskRenderer didn't create a sprite for item "${o.id}" of type "${o.type}". Have got ${r}`)}n!==r&&(this.#o?this.renderContext.frontLayer.attach(r):this.#e.mask=r)}destroy(){this.#e.destroy(!0),this.#n?.destroy();for(const e of Object.values(this.#r))e.sprite.destroy()}tick(e){if(this.#t.parent===null)throw new Error("shadow container not in scene graph");const{movedItems:n,progression:r}=e,{item:o,general:{pixiRenderer:s},room:i}=this.renderContext,a=n.has(o),l=o.state.position.z+o.aabb.z,c=$e(i.items).filter(function(g){return g.shadowCastTexture!==void 0}),u={id:o.id,state:{position:{...o.state.position,z:l}},aabb:{...o.aabb,z:Ks}},d=Object.groupBy(c,p=>{const g=this.#r[p.id]!==void 0,y=n.has(p);return!a&&!y?g?"keepUnchanged":"noShadow":Js(u,p)?g?"update":"create":"noShadow"});for(const p of Cc(d.keepUnchanged,d.update))this.#r[p.id].renderedOnProgression=r;if(d.create)for(const p of d.create){const{times:g}=p.config,y=bo(s,Ys(p.shadowCastTexture,g));y.label=p.id,this.#t.addChild(y),this.#r[p.id]={sprite:y,renderedOnProgression:r}}for(const p of Cc(d.create,d.update)){const{sprite:g}=this.#r[p.id],y=q({...Xr(Vt(p.state.position,o.state.position),p.shadowOffset??ir),z:o.aabb.z});g.x=y.x,g.y=y.y}for(const[p,{sprite:g,renderedOnProgression:y}]of ph(this.#r))y!==r&&(g.destroy(),delete this.#r[p]);const f=(d.keepUnchanged?.length??0)+(d.update?.length??0)+(d.create?.length??0)>0;this.#e.visible=f,f&&this.#s(e)}get output(){return this.#e}}const UP=t=>{const e=LP(t.item);return e===void 0?void 0:new FP(t,e)};class HP{constructor(e,n){this.renderContext=e,this.componentRenderers=n,this.output={graphics:n.graphics?.output,sound:n.sound?.output}}output;tick(e){this.componentRenderers.graphics?.tick(e),this.componentRenderers.sound?.tick(e)}destroy(){this.componentRenderers.graphics?.destroy(),this.componentRenderers.sound?.destroy()}}const de=new window.AudioContext,Ka=()=>{throw new Error(`sounds not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`)},je=t=>{const e=typeof t=="string"?{soundId:t}:t,{playbackRate:n=1,soundId:r,connectTo:o,loop:s=!1,varyPlaybackRate:i=!1,randomiseStartPoint:a=!1}=e,l=de.createBufferSource(),c=Ka()[r];return l.buffer=c,l.loop=s,l.playbackRate.value=i?n-.05+Math.random()*.1:n,s&&a?l.start(0,c.duration*Math.random()):l.start(),o!==void 0&&l.connect(o),l},Vn=(t,e,n)=>{const r=de.createGain();return e!==void 0&&(r.gain.value=e),t.connect(r),r.connect(n),r},Fe=({start:t,change:e,loop:n,stop:r,startAndLoopTogether:o=!1,noStartOnFirstFrame:s=!0},i)=>{let a=!0,l,c;return u=>{if(!!u!=!!c)u?t!==void 0&&!(a&&s)?(l?.stop(),l=je({...t}),Vn(l,t.gain,i),n!==void 0&&(o?(l=je({...n,loop:!0}),Vn(l,n.gain,i)):l.onended=()=>{c&&(l=je({...n,loop:!0}),Vn(l,n.gain,i))})):n!==void 0&&(l=je({...n,loop:!0}),Vn(l,n.gain,i)):(l&&l.loop&&(l.stop(),l.onended=null),r!==void 0&&(l=je({...r}),Vn(l,r.gain,i)));else if(c!==u&&e!==void 0){const f=je({...e});Vn(f,e.gain,i)}a=!1,c=u}};class WP{constructor(e){this.renderContext=e,this.output.gain.value=4}output=de.createGain();#e=Fe({loop:{soundId:"rollingBallLoop",playbackRate:.5}},this.output);tick(){const{renderContext:{item:{state:{vels:{sliding:e},standingOnItemId:n}}}}=this,r=(e.x!==0||e.y!==0)&&n!==null;this.#e(r)}destroy(){}}class GP{constructor(e){this.renderContext=e;const{item:{config:{was:n}}}=e;switch(n.type){case"pickup":{n.gives!=="scroll"&&je({soundId:"bonus",connectTo:this.output});break}case"disappearing":{je({soundId:"destroy",connectTo:this.output});break}case"hushPuppy":{this.output.gain.value=.5,je({soundId:"hushPuppyVanish",connectTo:this.output});break}}}output=de.createGain();tick(){}destroy(){}}class ec{constructor(e,n,r=1){this.renderContext=e,this.#e=Fe({start:n},this.output),this.output.gain.value=r}output=de.createGain();#e;tick({lastRenderRoomTime:e}){const{renderContext:{item:n}}=this,{state:{collidedWith:{roomTime:r,by:o}}}=n,s=r>(e??Ee)&&!Oh(Rs(o));this.#e(s)}destroy(){}}class qP{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#e.gain.value=.5,this.#n=new ec(e,{soundId:"metalHit"},.3),this.#n.output.connect(this.output)}output=de.createGain();#e=de.createGain();#t=Fe({start:{soundId:"servoStart",playbackRate:.5},loop:{soundId:"servoLoop",playbackRate:.5},stop:{soundId:"servoStop",playbackRate:.5}},this.#e);#n;tick(e){const{renderContext:{item:n,room:{roomTime:r,items:o}}}=this,{state:{actedOnAt:{roomTime:s,by:i}}}=n,a=r===s&&vt(Rs(i)).some(l=>xh(o[l]));this.#t(a),this.#n.tick(e)}destroy(){}}const _o=t=>{for(const e in t)return!0;return!1},Wi=2;class VP{constructor(e){this.renderContext=e}output=de.createGain();#e=Fe({start:{soundId:"conveyorStart",playbackRate:Wi},loop:{soundId:"conveyorLoop",playbackRate:Wi},stop:{soundId:"conveyorEnd",playbackRate:Wi}},this.output);tick(){const{renderContext:{item:{state:{stoodOnBy:e}}}}=this,n=_o(e);this.#e(n)}destroy(){this.#e(!1)}}const KP=3;class XP{constructor(e){this.renderContext=e,this.output.gain.value=.7}output=de.createGain();#e=je({soundId:"helicopter",loop:!0,connectTo:this.output});tick(){const{renderContext:{item:{state:{vels:{lift:{z:e}}}}}}=this;this.#e.playbackRate.value=Math.max(.5,1+KP*e)}destroy(){}}const md={skiHead:{soundId:"softBump"},turtle:{soundId:"softBump"},dalek:{soundId:"metalHit"},homingBot:{soundId:"metalHit"},computerBot:{soundId:"metalHit"}},gd={cyberman:{soundId:"jetpackTurnaround",gain:1.2},dalek:{soundId:"mojoTurn",gain:.3}},yd={cyberman:{soundId:"jetpackLoop",gain:.7},emperorsGuardian:{soundId:"jetpackLoop"},dalek:{soundId:"mojoLoop"},bubbleRobot:{soundId:"bubbleRobotLoop"},helicopterBug:{soundId:"helicopter"}},vd={homingBot:{start:{soundId:"detect"},loop:{soundId:"robotWhirLoop",gain:4},startAndLoopTogether:!0},computerBot:{loop:{soundId:"robotBeepingLoop",randomiseStartPoint:!0,varyPlaybackRate:!0}}};class JP{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#t.connect(this.output),this.#t.gain.value=.66;const{item:{config:{which:n}}}=e;md[n]!==void 0&&(this.#o=new ec(e,md[n]),this.#o.output.connect(this.output)),gd[n]!==void 0&&(this.#n=Fe({change:gd[n]},this.#e)),vd[n]!==void 0&&(this.#s=Fe(vd[n],this.#e)),yd[n]!==void 0&&(this.#r=Fe({loop:yd[n]},this.#t))}output=de.createGain();#e=de.createGain();#t=de.createGain();#n;#r;#o;#s;tick(e){const{renderContext:{item:n}}=this,{state:{facing:r,activated:o,busyLickingDoughnutsOffFace:s,vels:{walking:i}}}=n;if(this.#n){const a=mh(r);this.#n(a)}if(this.#o&&this.#o.tick(e),this.#r){const a=o&&!s;this.#r(a)}if(this.#s){const a=!il(i,le);this.#s(a)}}destroy(){}}class Gi{constructor(e){this.renderContext=e;const{general:{soundSettings:n},item:{type:r}}=e,{noFootsteps:o}={...al.soundSettings,...n};o||(this.#e=de.createGain(),this.#e.gain.value=2,this.#e.connect(this.output),this.#t=Fe({loop:{soundId:`${r==="headOverHeels"?"heels":r}Walk`}},this.#e)),this.#n.gain.value=.8,this.#n.connect(this.output),this.#i.gain.value=1.2,this.#i.connect(this.output),this.#s.connect(this.output),this.#r=Fe({start:{soundId:`${r==="headOverHeels"?"head":r}Jump`}},this.#n),this.#o=Fe({loop:{soundId:`${r==="headOverHeels"?"head":r}Fall`}},this.#n)}output=de.createGain();#e;#t;#n=de.createGain();#r;#o;#s=de.createGain();#a=Fe({start:{soundId:"landing"},noStartOnFirstFrame:!0},this.#s);#i=de.createGain();#c=Fe({start:{soundId:"carry",playbackRate:.95},stop:{soundId:"carry",playbackRate:1.05}},this.#i);#l={teleportingPhase:null,positionZ:0};tick({lastRenderRoomTime:e}){const{renderContext:{item:n}}=this,{state:{action:r,teleporting:o,jumpStartZ:s,jumped:i,standingOnItemId:a,position:{z:l},vels:{gravity:{z:c}},collidedWith:{roomTime:u,by:d}}}=n,f=MP(n),{teleportingPhase:p,positionZ:g}=this.#l,y=o?o.phase:null,v=i&&l>s&&l>g&&c>0,w=l<g&&c<0&&a===null;this.#o(w),this.#r(v),this.#t!==void 0&&this.#t(!v&&!w&&r==="moving"),f!==void 0&&this.#c(f.carrying!==null);const _=a!==null&&u>(e??Ee)&&d[a];if(this.#a(_),y!==null&&y!==p)if(y==="in"){const b=Ka().teleportIn,x=de.createBufferSource();x.buffer=b,x.connect(this.output),x.start()}else{const b=Ka().teleportOut,x=de.createBufferSource();x.buffer=b,x.connect(this.output),x.start()}this.#l={teleportingPhase:y,positionZ:l}}destroy(){}}class YP{constructor(e){this.renderContext=e}output=de.createGain();#e=void 0;tick(){const{renderContext:{item:{state:{stoodOnBy:e},config:{style:n}}}}=this;if(n!=="drum")return;const r=this.#e?.stoodOn??!1,o=_o(e);!r&&o&&je({soundId:"drum",connectTo:this.output}),this.#e={stoodOn:o}}destroy(){}}class ZP{constructor(e){this.renderContext=e,this.scrapeBracketed=Fe({loop:{soundId:"stepStoolScraping"}},this.output),this.output.gain.value=.4}output=de.createGain();scrapeBracketed;tick({movedItems:e}){const{renderContext:{item:n,room:{roomTime:r}}}=this,{state:{actedOnAt:{roomTime:o},standingOnItemId:s}}=n,i=r===o&&s!==null&&e.has(n);this.scrapeBracketed(i)}destroy(){}}class QP{constructor(e){this.renderContext=e}output=de.createGain();tick({lastRenderRoomTime:e}){const{renderContext:{item:{state:{stoodOnBy:n,stoodOnUntilRoomTime:r}}}}=this,o=_o(n);e!==void 0&&r>e&&!o&&je({soundId:"springBoing",connectTo:this.output})}destroy(){}}class eE{constructor(e){this.renderContext=e,this.#e.connect(this.output)}output=de.createGain();#e=de.createGain();#t=void 0;tick(){const{renderContext:{item:{state:{setting:e},config:n}}}=this,r=n.type==="in-store"?ol(U.getState(),n.path)?"right":"left":e,o=this.#t?.setting;o!==void 0&&o!==r&&je({soundId:"switchClick",playbackRate:r==="right"?.95:1.05,connectTo:this.#e}),this.#t={setting:r}}destroy(){}}class tE{constructor(e){this.renderContext=e}output=de.createGain();#e=Fe({loop:{soundId:"teleportWarningSiren"}},this.output);tick(){const{renderContext:{item:e,room:n}}=this;this.#e(Ql(e)&&xo(e.state.stoodOnBy,n).some(pl))}destroy(){}}class nE{constructor(e){this.renderContext=e,je({soundId:"hooter",connectTo:this.output})}output=de.createGain();tick(){}destroy(){}}class rE extends ec{constructor(e){super(e,{soundId:"glassClink",varyPlaybackRate:!0},.8),this.renderContext=e}}const oE=(t,e)=>Ih(xo(t.state.stoodOnBy,e).filter(_h));class sE{constructor(e){this.renderContext=e,this.output.gain.value=2}output=de.createGain();#e=void 0;tick(e){const{renderContext:{item:n,room:r}}=this,o=oE(n,r);this.#e!==void 0&&o<this.#e&&je({soundId:"toasterPopUpSoundUrl",connectTo:this.output}),this.#e=o}destroy(){}}const iE={lift:XP,switch:eE,bubbles:GP,head:Gi,heels:Gi,headOverHeels:Gi,teleporter:tE,monster:JP,conveyor:VP,spring:QP,portableBlock:YP,charles:qP,ball:WP,pushableBlock:ZP,firedDoughnut:nE,slidingBlock:rE},aE=t=>{if(t.item.type==="deadlyBlock"&&t.item.config.style==="toaster")return new sE(t);const e=iE[t.item.type];if(e)return new e(t)},lE={floors:{edgeLeftX:Number.POSITIVE_INFINITY,edgeRightX:Number.NEGATIVE_INFINITY,topEdgeY:Number.POSITIVE_INFINITY,bottomEdgeY:Number.NEGATIVE_INFINITY},allItems:{topEdgeY:Number.POSITIVE_INFINITY}},cE=t=>$e(t.items).reduce((e,n)=>{if(n.type==="floor"){const{config:{naturalFootprint:r},state:{position:o},renderAabb:s,renderAabbOffset:i,aabb:a}=n,l=q(B(r.position,{x:r.aabb.x,z:r.aabb.z})).x,c=q(B(r.position,{y:r.aabb.y,z:r.aabb.z})).x,u=q(B(r.position,r.aabb)).y,d=q(B(o,i??le,{z:(s??a).z})).y;return{allItems:e.allItems,floors:{edgeLeftX:Math.min(e.floors.edgeLeftX,l),edgeRightX:Math.max(e.floors.edgeRightX,c),topEdgeY:Math.min(e.floors.topEdgeY,u),bottomEdgeY:Math.max(e.floors.bottomEdgeY,d)}}}else{const r=q(B(n.state.position,n.renderAabb??le,n.renderAabbOffset??le)).y;return{allItems:{topEdgeY:Math.min(e.allItems.topEdgeY,r)},floors:e.floors}}},lE),wd=K.h*-1,bd=K.h*Xm,uE=0,dE=K.w*16,qi=(t,e,n)=>(t-e)/(n-e)*2-1;class hE{constructor(e,n){this.renderContext=e,this.childRenderer=n,n.output.connect(this.output),this.output.rolloffFactor=2,this.output.maxDistance=5,this.output.distanceModel="exponential";const r=cE(e.room).floors;this.soundPositionMinX=r.edgeLeftX,this.soundPositionMaxX=r.edgeRightX}output=de.createPanner();soundPositionMinX;soundPositionMaxX;tick(e){this.childRenderer.tick(e);const{item:n}=this.renderContext,r=n.state,o=B(r.position,As(n.aabb,.5)),s=qi(T1(o),this.soundPositionMaxX,this.soundPositionMinX),i=qi(o.z,wd,bd);if(!Number.isFinite(i))throw new Error(`y position for sound rendering is not finite;
        positionY = numberInRangeToMinus1To1Range(
          itemCentrePosition = ${o.z},
          ${wd},
          ${bd},
        );
        itemCentrePosition = addXyz(
          itemState.position = ${JSON.stringify(r.position)},
          scaleXyz(${JSON.stringify(n.aabb)}, 0.5),
        )`);const a=qi(o.x+o.y,uE,dE);this.output.positionX.value=s,this.output.positionY.value=i,this.output.positionZ.value=a}destroy(){this.childRenderer.destroy()}}const Or=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,fE=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // we know c.a is either 0 or 1, so no need to do a step()

    finalColor = mix(c, vec4(uColour, 1), c.a);
}
`;class Ss extends tn{constructor(e){const n=It.from({vertex:Or,fragment:fE,name:"oneColour-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uColour:{value:new Float32Array(3),type:"vec3<f32>"}}}});const r=this.resources.colorReplaceUniforms.uniforms,[o,s,i]=e.toArray();r.uColour[0]=o,r.uColour[1]=s,r.uColour[2]=i}}const pE={pureBlack:new G("#000000"),shadow:new G("#1B2D3B"),midGrey:new G("#505A55"),lightGrey:new G("#929981"),white:new G("#F8FEF8"),pastelBlue:new G("#4893FF"),metallicBlue:new G("#1D4E80"),pink:new G("#B973AF"),moss:new G("#6E7B00"),redShadow:new G("#513D40"),midRed:new G("#A7574B"),lightBeige:new G("#BF8E69"),highlightBeige:new G("#DBB269"),alpha:new G("#105A69"),replaceLight:new G("#048662"),replaceDark:new G("#052229")},mE=`#version 300 es
// keep this one at mediump for the hash function's precision
precision mediump float;

in vec2 vTextureCoord;
out vec4 finalColor;

const float LUT_SIZE = 256.0;
const float magicNumber = 31.0; // Small prime number

uniform sampler2D uTexture;
uniform sampler2D uLut;

/** returns in [0, LUT_SIZE] range
this must match the TypeScript version of the hash function*/
float hashColor(vec3 color) {
    vec3 c255 = floor(color * 255.0);
    
    float hash = mod(
        c255.r + c255.g * magicNumber + c255.b * magicNumber * magicNumber, 
        LUT_SIZE
    );
    return hash;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    float h = hashColor(c.rgb);

    // use the hash to look up the replacement in the LUT:
    vec4 replacementColour = texture(
        uLut, 
        vec2(
            // normalise h to [0, 1] range
            (h + 0.5) / LUT_SIZE, 
            0.5
        )
    );
    
    // use original if either: 
    //      original alpha is 0 (because keep transparent)
    //      or lut alpha is 0 (signals nothing in this slot of the LUT)
    finalColor = mix(c, replacementColour, c.a * replacementColour.a);
}
`,qr=256,Vi=31,xd=new Map;function gE(t){const e=Math.floor(t.red*255),n=Math.floor(t.green*255),r=Math.floor(t.blue*255);return(e+n*Vi+r*Vi*Vi)%qr}function yE(t){const e=new Float32Array(qr*4);for(const[o,s]of vy(t)){const i=N[o],a=gE(i);if(e[a*4+3]>.5)throw new Error("LUT collision - mess with the hash function or lut size until this goes away");e[a*4+0]=s.red,e[a*4+1]=s.green,e[a*4+2]=s.blue,e[a*4+3]=1}const n=new Uint8Array(qr*4);for(let o=0;o<qr*4;o++)n[o]=Math.floor(e[o]*255);return At.from({resource:n,width:qr,height:1,scaleMode:"nearest"})}class vE extends tn{#e;constructor(e){const n=Object.keys(e).length,r=It.from({vertex:Or,fragment:mE,name:"palette-swop-filter"}),o=yE(e);super({glProgram:r,resources:{colorReplaceUniforms:{uOriginal:{value:new Float32Array(3*n),type:"vec3<f32>",size:n},uReplacement:{value:new Float32Array(3*n),type:"vec3<f32>",size:n}},uLut:o.source}}),this.#e=o;const s=this.resources.colorReplaceUniforms.uniforms;Object.entries(e).forEach(([i,a],l)=>{N[i].toArray().forEach((c,u)=>{s.uOriginal[l*3+u]=c}),a.toArray().forEach((c,u)=>{s.uReplacement[l*3+u]=c})})}destroy(e){this.#e?.destroy(!0),this.#e=null,super.destroy(e)}}const wE=t=>Object.entries(t).sort(([e],[n])=>e.localeCompare(n)).map(([e,n])=>`${e}:${n.toHex()}`).join("|"),on=t=>{const e=wE(t);let n=xd.get(e);return n||(n=new vE(t),xd.set(e,n)),n},bE=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uTargetColor;

vec4 black = vec4(0.0, 0.0, 0.0, 1.0);

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // 1 if black, 0 if non-black
    float isBlack = step(length(c.rgb), 0.01);

    // keep original if either:
    //      * black
    //      * transparent

    finalColor = mix(    
        vec4(uTargetColor, 1),    
        c, 
        max(isBlack, 1.0 - c.a)
    );
}
`;class Ue extends tn{uniforms;constructor(e="white"){const n=It.from({vertex:Or,fragment:bE,name:"revert-colourise-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[n,r,o]=new G(e).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}}const xE=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    finalColor = vec4(c.rgb * 0.5, c.a);
}
`;class _E extends tn{constructor(){const e=It.from({vertex:Or,fragment:xE,name:"halfbrite-filter"});super({glProgram:e,resources:{}})}}const ug=({basic:t,dimmed:e})=>({replaceLight:t,replaceDark:e}),dg=({color:{hue:t,shade:e},planet:n})=>{const r=t==="yellow"?e==="dimmed"||n==="jail"?wm:Qe:Gs[t][e].main;return ug(r)},CE=t=>on({lightBeige:N.lightGrey,redShadow:N.shadow,pink:N.lightGrey,moss:N.lightGrey,midRed:N.midGrey,highlightBeige:N.lightGrey,...t&&dg(t)}),SE=on({midGrey:N.midRed,lightGrey:N.lightBeige,white:N.highlightBeige,metallicBlue:N.redShadow,pink:N.midRed,moss:N.midRed,replaceDark:N.midRed,replaceLight:N.lightBeige}),_d=(t,e)=>{const n=bs(t.color).edges[e],r=n.original;return n.dimInOriginal?vm(r):r},hg=(t,e,n)=>n?on(ug(Gs[t.color.hue][t.color.shade].edges[e])):new Ue(bs(t.color).edges[e].original),gt=t=>on(dg(t)),kE=t=>{switch(t.color.hue){case"white":return on({replaceLight:N.lightGrey,replaceDark:N.midGrey});default:return gt(t)}},fg=t=>{switch(t.color.hue){case"white":return on({replaceLight:N.lightBeige,replaceDark:N.midRed,shadow:N.redShadow});case"yellow":return gt({planet:t.planet,color:{hue:"yellow",shade:"dimmed"}});default:return gt(t)}};new _E;const sn=ds,PE=on(pE),EE=[new Ss(N.midRed)],AE=[new Ss(N.moss)],TE=75;class RE{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output)}output=new re({label:"ItemFlashOnSwitchedRenderer"});tick(e){const{renderContext:{item:{state:{switchedAtRoomTime:n,switchedSetting:r}},room:{roomTime:o}}}=this;this.output.filters=o-n<TE?r==="left"?AE:EE:sn,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const OE=(t,e,n)=>{const o=qt().textures[`door.frame.${t.planet}.${e}.near`]!==void 0?t.planet:"generic",s=t.color.shade==="dimmed"&&qt().textures[`door.frame.${o}.dark.${e}.${n}`]!==void 0;return`door.frame.${o}${s?".dark":""}.${e}.${n}`};function Zs(t,e){const n=e||new re;for(const r of t)n.addChild(r);return n}function*IE({config:{direction:t,inHiddenWall:e,height:n}},r){const o=ho(t),s=o==="y"?1:16;function*i(a){if(e){if(n!==0){const l=V({textureId:`generic.door.floatingThreshold.${o}`,...Xr(a,{y:-12*n})});l.filters=hg(r,o==="x"?"towards":"right",!0),yield l}}else{yield V({pivot:{x:s,y:9},textureId:`generic.door.legs.base.${o}`,...Xr(a,{})});for(let l=1;l<n;l++)yield V({pivot:{x:s,y:9},textureId:`generic.door.legs.pillar.${o}`,...Xr(a,{y:-l*K.h})})}}yield*i(kn({...ir,[o]:1})),yield*i(ir),e||(yield V({pivot:{x:16,y:K.h*n+13},textureId:`generic.door.legs.threshold.double.${o}`,...kn({...ir,[o]:1})}))}const pg=(t,e)=>{const n=ho(t),r=Pr(n),o=8;return t==="towards"||t==="right"?q({[r]:e[r]-o}):ir},jE=Ie(({renderContext:{item:t,room:e}})=>Zs(IE(t,e),new re({filters:gt(e),...pg(t.config.direction,t.aabb)}))),$E=Ie(({renderContext:{item:{config:{direction:t,part:e,toRoom:n},aabb:r},room:o,general:{gameState:s}}})=>{const i=ho(t),a=s===void 0?o:s.campaign.rooms[n];return V({textureId:OE(o,i,e),filter:gt(a),...pg(t,r)})}),Ki={animationId:"bubbles.cold"},rr=({top:t,bottom:e="headlessBase",filter:n})=>{const r=new re({filters:n}),o=V(e);r.addChild(o);const s=V(t);return s.y=-12,r.addChild(s),r[Qs]=s,r[tc]=o,r},Qs=Symbol(),tc=Symbol(),NE=({top:t,bottom:e})=>{const n=new re;return n.addChild(e),t.y=-12,n.addChild(t),n[Qs]=t,n[tc]=e,n},ME=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform vec2 uTextureSize;
uniform sampler2D uTexture;
uniform vec3 uOutline;
uniform float uOutlineWidth;

void main(void) {
    vec2 scaledTexelSize = vec2(1.0f) / vec2(textureSize(uTexture, 0)) * uOutlineWidth;    
    
    // Calculate offset coordinates
    vec2 rightCoord = vec2(vTextureCoord.x + scaledTexelSize.x, vTextureCoord.y);
    vec2 leftCoord = vec2(vTextureCoord.x - scaledTexelSize.x, vTextureCoord.y);
    vec2 belowCoord = vec2(vTextureCoord.x, vTextureCoord.y + scaledTexelSize.y);
    vec2 aboveCoord = vec2(vTextureCoord.x, vTextureCoord.y - scaledTexelSize.y);
    
    // Create boundary masks (1.0 if within bounds, 0.0 if out of bounds)
    // seems to work fine without this, but could multiply colourToX by this to get zero'd out when OOB
    // float rightInBounds = step(rightCoord.x, 1.0);
    // float leftInBounds = step(0.0, leftCoord.x);
    // float belowInBounds = step(belowCoord.y, 1.0);
    // float aboveInBounds = step(0.0, aboveCoord.y);
    
    vec4 colourToRight = texture(uTexture, rightCoord);
    vec4 colourToLeft = texture(uTexture, leftCoord);
    vec4 colourBelow = texture(uTexture, belowCoord);
    vec4 colourAbove = texture(uTexture, aboveCoord);
    
    // Check if any neighbor is opaque (combine all alpha values)
    float hasOpaqueNeighbor = max(max(colourToRight.a, colourToLeft.a), 
                                  max(colourBelow.a, colourAbove.a));

    vec4 originalColour = texture(uTexture, vTextureCoord);
        
    finalColor = mix(
        originalColour, 
        vec4(uOutline, 1), 
        // 1 if: original colour is transparent and has an opaque neighbour - use outline colour
        // 0 if: original colour is opaque or has no opaque neighbour - use original colour (transparent or sprite)
        (1.0 - originalColour.a) * hasOpaqueNeighbor
    );
}
`;class yt extends tn{constructor({outlineColor:e,upscale:n,lowRes:r}){const o=It.from({vertex:Or,fragment:ME,name:"outline-filter"});super({glProgram:o,padding:n,resources:{colorReplaceUniforms:{uOutline:{value:new Float32Array(3),type:"vec3<f32>"},uOutlineWidth:{value:new Float32Array(1),type:"f32"}}}});const s=this.resources.colorReplaceUniforms.uniforms,[i,a,l]=e.toArray();s.uOutline[0]=i,s.uOutline[1]=a,s.uOutline[2]=l,s.uOutlineWidth[0]=n,r&&(this.resolution=1/n,this.padding=n,s.uOutlineWidth[0]=1)}}const zE=t=>{const{gameTime:e,lastDiedAt:n}=t.type==="headOverHeels"?t.state.head:t.state;return e-n<j1},Xi=t=>{if(t===void 0)return 0;const{shieldCollectedAt:e,gameTime:n}=t;return e!==null&&e+Ju>n?100-Math.ceil((n-e)/(Ju/100)):0},DE=t=>t.type==="headOverHeels"?Xi(t.state.head)>0||Xi(t.state.heels)>0:Xi(t.state)>0,ei=t=>t,Xa=.02,LE=({name:t,action:e,facingXy8:n,teleportingPhase:r,gravityZ:o,paused:s})=>{if(e==="death")return{animationId:`${t}.fadeOut`,paused:s};if(r==="out")return{animationId:`${t}.fadeOut`,paused:s};if(r==="in")return{animationId:`${t}.fadeOut`,paused:s};if(e==="moving")return{animationId:`${t}.walking.${n}`,paused:s};if(e==="jumping")return{textureId:o<Xa?`${t}.walking.${n}.2`:`${t}.walking.${n}.1`};if(e==="falling"){const a=`${t}.falling.${n}`;if(ps(a))return{textureId:a}}const i=`${t}.idle.${n}`;return ef(i)?{animationId:i,paused:s}:{textureId:`${t}.walking.${n}.2`}},Ja=Symbol(),Ya=Symbol(),BE=(t,e)=>{t[Ja].removeChildren(),t[Ja].addChild(V(LE(e)))},mg=on({pastelBlue:N.pink}),Ji=(t,e,n)=>{const r=new re,o=new re;r[Ja]=o,r.addChild(o);const s=V({animationId:e?`shine.${t}InSymbio`:"shine",paused:n,filter:t==="heels"?mg:sn,flipX:t==="heels"});return r[Ya]=s,r},Cd=({gameTime:t,switchedToAt:e},n,r)=>(n==="headOverHeels"||n===r)&&e+I1>t,FE=t=>{if(!zE(t))return!1;const{gameTime:e,lastDiedAt:n}=t.type==="headOverHeels"?t.state.head:t.state;return(e-n)%Yu<Yu*$1},Sd=(t,e)=>{t.filters?Array.isArray(t.filters)?t.filters=[...t.filters,e]:t.filters=[t.filters,e].flat():t.filters=e},kd=(t,e)=>{t.filters=Array.isArray(t.filters)?t.filters.filter(n=>!(n instanceof e)):t.filters instanceof e?sn:[...t.filters]},UE=(t,{highlighted:e,flashing:n},r,o)=>{const s=r?.highlighted??!1;e&&!s?Sd(o,new yt({outlineColor:nr[t],upscale:en(U.getState()),lowRes:!1})):!e&&s&&kd(o,yt);const i=r?.flashing??!1;n&&!i?Sd(o,new Ss(nr[t])):!n&&i&&kd(o,Ss)},HE=(t,e,n)=>{e&&!n?t.addChild(t[Ya]):!e&&n&&t.removeChild(t[Ya])},Yi=(t,e,n,r,o,s)=>{n&&BE(e,{name:t,...r,paused:o}),UE(t,r,s,e),HE(e,r.shining,s?.shining??!1)},WE=({renderContext:{item:t,general:{gameState:e,paused:n}},currentRendering:r})=>{const{type:o,state:{action:s,facing:i,teleporting:a,vels:{gravity:{z:l}}}}=t,c=r?.renderProps,u=r?.output,d=mh(i)??"towards",f=e!==void 0&&(t.type==="headOverHeels"?Cd(t.state.head,"headOverHeels","headOverHeels"):Cd(t.state,t.type,e.currentCharacterName)),p=FE(t),g=DE(t),y=Ts(i),v=a?.phase??null,w={action:s,facingXy8:d,teleportingPhase:v,flashing:p,highlighted:f,shining:g,gravityZ:l},_=c===void 0||c.action!==s||c.facingXy8!==d||c.teleportingPhase!==v||c?.gravityZ>Xa!=l>Xa;let b;if(o==="headOverHeels"){b=u??NE({top:Ji("head",!0,n),bottom:Ji("heels",!0,n)});const x=b;Yi("head",x[Qs],_,w,n,c),Yi("heels",x[tc],_,w,n,c)}else b=u??Ji(o,!1,n),Yi(o,b,_,w,n,c);return s==="moving"&&u instanceof mr&&(u.animationSpeed=y*wy),{output:b,renderProps:w}},Zi=ei(WE),Pd=t=>t-Math.floor(t),GE=({state:{position:t}},e)=>{const n=o=>o.config.direction==="away"||o.config.direction==="left";return Zs($e(e.items).filter(o=>o.type==="wall"||o.type==="doorLegs").filter(n).map(o=>{const{id:s,config:{direction:i},state:{position:a}}=o;return V({textureId:"floorOverdraw.cornerNearWall",label:s,...q(hr(a,t)),times:o.type==="wall"?dl(o.config):{[Pr(Kt(i))]:2},anchor:{x:0,y:1},flipX:i==="away"})}),new re({label:"floorOverdraws"}))},qE=`#version 300 es
precision lowp float;

out vec4 finalColor;

in vec2 vTextureCoord;
uniform sampler2D uBackBuffer;
uniform vec3 uTargetColor;
// do not use uTexture in this frag - for some reason it causes pixi's render pipeline
// to take away the backbuffer, which we rely on sampling from

void main() {
    vec3 bg = texture(uBackBuffer, vTextureCoord).rgb;

    float isBlack = step(length(bg), 0.001f); // 1 if black, 0 otherwise
    finalColor = mix(vec4(uTargetColor, 1.0f), vec4(0, 0, 0, 0), isBlack);


}`;class Ed extends tn{uniforms;constructor(e="white"){const n=It.from({vertex:Or,fragment:qE,name:"colour-clash-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}},blendRequired:!0}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[n,r,o]=new G(e).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}}const Ad=({colourised:t,direction:e,room:n,times:r,position:o,colourSwap:s})=>V({label:`floorEdge(${e})`,textureId:`floorEdge.${e}`,times:r,filter:s?hg(n,e,t):void 0,...q(o)}),VE=({room:t,xSize:e,ySize:n,y:r})=>{const o=new re({label:"floorColourClash"}),s=_d(t,"right");for(let a=0;a<=n;a++){const l=kn({x:0,y:a,z:0}),c=new ht().rect(l.x-(a===0?0:8),l.y,8*3,8).fill(s);c.filters=new Ed(s),o.addChild(c)}const i=_d(t,"towards");for(let a=0;a<=e;a++){const l=kn({x:a,y:0,z:0}),c=new ht().rect(l.x-16,l.y,8*(a===0?2:3),8).fill(i);c.filters=new Ed(i),o.addChild(c)}return o.y=r,o},KE=Ie(({renderContext:{room:t,item:e,general:{colourised:n,pixiRenderer:r},colourClashLayer:o}})=>{const{color:{shade:s}}=t,{config:i,state:{position:a},aabb:l}=e,{floorType:c,naturalFootprint:u}=i,d=new re({label:"floorAppearance"}),f=q({...l,y:0}),p=q({...l,x:0,y:0}),g=q({...l,x:0}),y=q(l);if(c!=="none"){const v=new re({label:"tiles"}),w=c==="deadly"?`generic${s==="dimmed"?".dark":""}.floor.deadly`:`${i.scenery}${s==="dimmed"?".dark":""}.floor`,_=qt().textures[w];try{Qh(w)}catch(X){throw new Error(`no floor textureId for floorType: ${c}, shade: ${s}`,{cause:X})}const b=Vt(u.position,a),x={x:Pd(b.x/K.w),y:Pd(b.y/K.w)},S=8,k={x:f.x,y:y.y-S,width:g.x-f.x,height:p.y-y.y+2*S},C=Vt(kn(Xr(x,{x:.5,y:.5})),{y:l.z},k),M=new hw({texture:_,tilePosition:C,...k});v.addChild(M),v.addChild(GE(e,t));const H=new ht().moveTo(y.x,y.y).lineTo(g.x,g.y).lineTo(g.x,g.y+3).lineTo(p.x,p.y+3).lineTo(f.x,f.y+3).lineTo(f.x,f.y).fill({color:16711680,alpha:.5});v.addChild(H),v.mask=H,v.filters=[kE(t)];const L=new re({children:[v]});L.filters=new yt({outlineColor:N.pureBlack,upscale:1,lowRes:!1}),d.addChild(Cr(r,L))}{const v=new re({label:"edges"});c==="none"&&v.addChild(new ht().moveTo(g.x,g.y+8).lineTo(g.x,g.y+100).lineTo(f.x,f.y+100).lineTo(f.x,f.y+8).lineTo(p.x,p.y+8).fill(0));const w=Math.ceil(l.y/K.w);v.addChild(Ad({colourised:n,direction:"right",room:t,times:{y:w},position:{z:l.z},colourSwap:n}));const _=Math.ceil(l.x/K.w);if(v.addChild(Ad({colourised:n,direction:"towards",room:t,times:{x:_},position:{z:l.z},colourSwap:n})),d.addChild(Cr(r,v)),!n){const b=VE({xSize:_,ySize:w,y:-l.z+1,room:t});d.addChild(b),o.attach(b)}}return d}),XE=["cyberman","dalek","skiHead","bubbleRobot","computerBot","turtle","homingBot"],JE=t=>{let e=2166136261;const n=t.length;for(let r=Math.max(0,n-9);r<n;r++)e^=t.charCodeAt(r),e=Math.imul(e,1540483477),e^=e>>>15;return(e>>>0)/4294967295},YE=200,ZE=1,QE=(t,e)=>{const n=JE(e);return Math.sin((t+n*2e4)/YE)*ZE},Td=({id:t,config:{which:e},state:n},r,o)=>{if((e==="cyberman"||e==="bubbleRobot")&&n.activated||e==="emperorsGuardian"){const s=o;s[Qs].y=-12+QE(r.roomTime,t)}},eA=({renderContext:{item:t,room:e,general:{paused:n}},currentRendering:r})=>{const{config:o,state:s}=t,i=r?.renderProps,{activated:a,busyLickingDoughnutsOffFace:l}=s,c=l?SE:a?void 0:XE.includes(o.which)?CE(e):void 0;switch(o.which){case"skiHead":case"turtle":case"cyberman":case"computerBot":case"elephant":case"elephantHead":case"monkey":{const u=sl(s.facing)??"towards";if(!(i===void 0||a!==i.activated||l!==i.busyLickingDoughnutsOffFace||u!==i.facingXy4))return Td(t,e,r.output),"no-update";const f={facingXy4:u,activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"skiHead":return{output:V({textureId:`${o.which}.${o.style}.${u}`,filter:c}),renderProps:f};case"elephantHead":return{output:V({textureId:`elephant.${u}`,filter:c}),renderProps:f};case"turtle":return{output:V(a&&!l?{animationId:`${o.which}.${u}`,filter:c,paused:n}:{textureId:`${o.which}.${u}.1`,filter:c}),renderProps:f};case"cyberman":return{output:s.activated||s.busyLickingDoughnutsOffFace?rr({top:{textureId:`${o.which}.${u}`,filter:c||gt(e)},bottom:{...Ki,paused:n}}):V({textureId:`${o.which}.${u}`,filter:c}),renderProps:f};case"computerBot":case"elephant":case"monkey":return{output:rr({top:`${o.which}.${u}`,bottom:{animationId:"headlessBase.flash",playOnce:"and-stop"},filter:c}),renderProps:f};default:throw new Error(`unexpected monster ${o}`)}break}case"homingBot":{const u=!by(s.vels.walking,ir);return i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated||u!==i.walking?{filter:c,output:V(a&&!l?{animationId:u?"headlessBase.flash":"headlessBase.scan",filter:c}:{textureId:"headlessBase",filter:c}),renderProps:{activated:a,busyLickingDoughnutsOffFace:l,walking:u}}:"no-update"}case"helicopterBug":case"emperor":case"dalek":case"bubbleRobot":case"emperorsGuardian":{if(!(i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated))return Td(t,e,r.output),"no-update";const d={activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"helicopterBug":case"dalek":return{output:V(a&&!l?{animationId:o.which,filter:c,paused:n}:{textureId:`${o.which}.1`,filter:c}),renderProps:d};case"bubbleRobot":return{output:rr({top:{...Ki,paused:n},filter:c}),renderProps:d};case"emperorsGuardian":return{output:rr({top:"ball",bottom:{...Ki,paused:n},filter:c}),renderProps:d};case"emperor":return{output:V({animationId:"bubbles.cold",filter:c,paused:n}),renderProps:d};default:throw new Error(`unexpected monster ${o}`)}break}default:throw new Error(`unexpected monster ${o}`)}},Xo=new yt({outlineColor:N.pureBlack,upscale:en(U.getState()),lowRes:!0});new Ue;new Ue;new Ue;new Ue(N.moss);new Ue;new Ue(nr.head),new Ue(br(nr.head)),new Ue(nr.heels),new Ue(br(nr.heels));function*tA(t){const e=typeof t=="string"?t==="infinite"?"":t:t.toString(),n=Ih(e);let r=0;for(const o of e){const s=`hud.char.${ih(o)}`;try{Qh(s)}catch(i){throw new Error(`no texture id for char "${o}": ${i.message}`,{cause:i})}yield V({textureId:s,x:(r+.5-n/2)*xy.w}),r++}}const gg=(t,e)=>{t.removeChildren();try{Zs(tA(e),t)}catch(n){throw console.error("invalid string is",e,"and on window as window.invalid"),console.error(n),window.invalid=e,new Error(`could not show text "${e}" in container because: "${n.message}"`,{cause:n})}return t},nA=Km.floatingText,rA=12,Rd=K.h*3,Od=[N.shadow,N.midGrey,N.redShadow,N.metallicBlue,N.midRed,N.moss,N.pink,N.lightBeige,N.pastelBlue,N.lightGrey,N.highlightBeige],Id=[...Od,...new Array(20).fill(N.white),...Od.toReversed()],oA=({renderContext:{item:{config:{textLines:t,appearanceRoomTime:e}},room:{roomTime:n},general:{displaySettings:{uncolourised:r}},frontLayer:o},currentRendering:s})=>{const i=s?.output;let a;const c=(n-e)*nA;if(i===void 0){a=new re({filters:new yt({outlineColor:N.pureBlack,upscale:en(U.getState()),lowRes:!1})}),o?.attach(a);for(let d=0;d<t.length;d++){const f=t[d],p=gg(new re({label:f,y:d*rA,filters:r?sn:new Ue(N.pink)}),f.toUpperCase());a.addChild(p)}}else a=i;let u=!1;for(let d=0;d<t.length;d++){const f=a.children[d],[p]=f.filters,g=c+d*-12,y=g>0&&g<Rd;if(f.visible=y,u||=y,y&&p){const v=Math.floor(g/Rd*Id.length);p.targetColor=Id[v]}}return a.visible=u,a.y=-c,{output:a,renderProps:he}},jd=500,sA=An.animations["conveyor.x"].animationSpeed,$d=An.animations["conveyor.x"].length,iA=t=>1-(1-t)**2,aA=(t,e)=>{for(let n=0;n<t.children.length;n++){const r=t.children[n],o=n%$d;r.gotoAndStop(e?$d-o-1:o)}},lA=(t,e)=>{const n=Kt(t),r=V({animationId:`conveyor.${n}`,reverse:t==="towards"||t==="right",times:e}),o=r instanceof mr?new re({children:[r]}):r;return aA(o,t==="towards"||t==="right"),o},cA=({renderContext:{item:{config:{direction:t,times:e},state:{stoodOnBy:n}},room:{roomTime:r}},currentRendering:o})=>{const s=o?.renderProps,i=_o(n),a=(!i&&s?.moving?r:s?.roomTimeStoppedMoving)??Ee,l=o?.output??lA(t,e),c=i?0:Math.min(r-a,jd),u=Math.max(0,1-c/jd);for(const d of l.children)if(u===0)d.stop();else{const f=sA*iA(u);d.play(),d.animationSpeed=f}return{output:l,renderProps:{moving:i,roomTimeStoppedMoving:a}}},uA=ei(cA),dA=({renderContext:{item:t,room:e,general:{paused:n}},currentRendering:r})=>{const{state:{stoodOnBy:o},config:{times:s}}=t,i=r?.renderProps,a=Ql(t),l=a&&xo(o,e).some(pl);return i===void 0||a!==i.activated||l!==i.flashing?{output:l?new re({children:[V({textureId:"teleporter",times:s}),V({animationId:"teleporter.flashing",times:s,paused:n})]}):V({textureId:a?"teleporter":"block.artificial",times:s}),renderProps:{flashing:l,activated:a}}:"no-update"},hA=({renderContext:{item:{state:{facing:t,actedOnAt:{roomTime:e,by:n}}},room:{roomTime:r,items:o}},currentRendering:s})=>{const i=s?.renderProps,a=sl(t)??"towards",l=r===e&&vt(Rs(n)).some(u=>xh(o[u]));return i===void 0||a!==i.facingXy4||l!==i.controlledByJoystick?{output:rr({top:`charles.${a}`,bottom:l?"headlessBase.all":"headlessBase"}),renderProps:{facingXy4:a,controlledByJoystick:l}}:"no-update"},fA=({renderContext:{item:{state:{stoodOnBy:t,stoodOnUntilRoomTime:e}},general:{paused:n}},tickContext:{lastRenderRoomTime:r},currentRendering:o})=>{const s=o?.renderProps,i=_o(t);let a;return o?.output?a=o?.output:(a=V({animationId:"spring.bounce"}),a.loop=!1,a.gotoAndStop(0)),r!==void 0&&e>r&&!i&&!n?a.gotoAndPlay(0):i&&!(s?.compressed??!1)&&a.gotoAndStop(1),{output:a,renderProps:{compressed:i}}},pA=ei(fA),mA=({renderContext:{item:{config:{which:t,startDirection:e}}},currentRendering:n})=>n?.renderProps===void 0?{output:t==="headOverHeels"?rr({top:{textureId:`head.walking.${e}.2`},bottom:{textureId:`heels.walking.${e}.2`}}):V({textureId:`${t}.walking.${e}.2`}),renderProps:he}:"no-update",gA=({renderContext:{item:{state:{vels:{sliding:t}},config:{startingPhase:e}},general:{paused:n}},tickContext:{deltaMS:r},currentRendering:o})=>{const i=(o?.renderProps?.distanceTravelled??0)+ll(t)*(n?0:r),l=o?.output??V("spikyBall.1"),u=(Math.floor(i*2/sr.w)+e)%2+1;return l.texture=qt().textures[`spikyBall.${u}`],{output:l,renderProps:{distanceTravelled:i}}},yA=ei(gA),vA=(t,e,n,r)=>`${t}${r?".dark":""}.wall.${e}.${n}`,wA=Ie(({renderContext:{general:{pixiRenderer:t},item:{id:e,config:n},room:r}})=>{if(n.direction==="right"||n.direction==="towards")throw new Error(`wall is near: ${e}`);const{direction:o,tiles:s}=n,i=Pr(Kt(o)),a=new re({label:"wallTiles"}),l=new re({label:"wallAnimations"});for(let u=0;u<n.tiles.length;u++){const d=kn({[i]:u});if(a.addChild(V({textureId:vA(r.planet,s[u],o,r.color.shade==="dimmed"),...d,pivot:o==="away"?{x:sr.w,y:sr.h}:{x:0,y:sr.h}})),r.planet==="moonbase"){const f=`moonbase.wall.screen.${s[u]}.away`;ef(f)&&l.addChild(V({animationId:f,randomiseStartFrame:!0,flipX:o==="left",x:d.x+(o==="away"?-8:8),y:d.y-23}))}}const c=new re({label:"wallAppearance"});return c.addChild(Cr(t,a)),l.children.length>0&&c.addChild(l),c.filters=gt(r),c}),bA=({renderContext:{item:{state:{setting:t},config:e}},currentRendering:n})=>{const r=n?.renderProps,o=e.type==="in-store"?ol(U.getState(),e.path)?"right":"left":t;return r===void 0||o!==r.setting?{output:V(`switch.${o}`),renderProps:{setting:o}}:"no-update"},xA=(t,e,n)=>e==="tower"?"tower":e==="book"?"book.x":e==="organic"&&t?`block.organic.dark${n?".disappearing":""}`:`block.${e}${n?".disappearing":""}`,_A=({renderContext:{general:{pixiRenderer:t},item:{config:{style:e,times:n},state:{disappearing:r}},room:o},currentRendering:s})=>{const i=s?.renderProps,a=r!==null;return i===void 0||i.isDissapearing!==a?{output:bo(t,V({textureId:xA(o.color.shade==="dimmed",e,a),filter:e==="organic"?gt(o):e==="book"?fg(o):void 0,times:n})),renderProps:{isDissapearing:a}}:"no-update"},CA=({state:{stoodOnBy:t,position:e},config:{times:n}},r)=>{const o=new Array(n?.x??1).fill(null).map(()=>new Array(n?.y??1));return xo(t,r).filter(_h).forEach(({id:s,state:{position:i}})=>{const a=Vt(i,e),l={x:Math.floor(a.x/K.w),y:Math.floor(a.y/K.d)};l.x<0||l.x>=(n?.x??1)||l.y<0||l.y>=(n?.y??1)||(o[l.x][l.y]=s)}),o},SA=(t,e)=>{let n=0,r=1;for(const o of e)for(const s of o)s!==void 0&&t.items[s]?.state.activated&&(n|=r),r<<=1;return n},kA=({renderContext:{item:t,room:e},currentRendering:n})=>{const{config:{times:r}}=t,o=n===void 0?CA(t,e):n.renderProps.chargePositions,s=SA(e,o);return s!==n?.renderProps.cybermanActivationBitmask?{output:V({textureIdCallback(a,l){const c=o[a][l];return c===void 0||e.items[c]?.state.everActivated?"toaster.off":"toaster.on"},times:r??he}),renderProps:{chargePositions:o,cybermanActivationBitmask:s}}:"no-update"},PA={head:Zi,heels:Zi,headOverHeels:Zi,doorFrame:$E,doorLegs:jE,monster:eA,floatingText:oA,barrier:Ie(({renderContext:{item:{config:{axis:t,times:e}}}})=>V({textureId:`barrier.${t}`,times:e})),deadlyBlock:Ie(({renderContext:{item:{config:t},room:e}})=>{switch(t.style){case"volcano":return V({animationId:"volcano",filter:gt(e),times:t.times,randomiseStartFrame:!0});case"toaster":throw new Error("use the special toaster appearance instead");default:throw t.style,new Error("unknown deadly block style")}}),spikes:zt("spikes"),slidingDeadly:yA,slidingBlock:Ie(({renderContext:{item:{config:{style:t}},room:e}})=>V(t==="book"?{textureId:"book.y",filter:fg(e)}:t)),block:_A,switch:bA,conveyor:uA,lift:Ie(({renderContext:{general:{paused:t}}})=>{const e=new re,n={x:lc.w/2,y:lc.h};return e.addChild(V({animationId:"lift",pivot:n,paused:t})),e.addChild(V({textureId:"lift.static",pivot:n})),e}),teleporter:dA,sceneryCrown:Ie(({renderContext:{item:{config:{planet:t}}}})=>V({textureId:`crown.${t}`})),pickup:Ie(({renderContext:{item:{config:t},room:e,general:{paused:n}}})=>{if(t.gives==="crown")return V({textureId:`crown.${t.planet}`});const o={shield:"whiteRabbit",jumps:"whiteRabbit",fast:"whiteRabbit","extra-life":"whiteRabbit",bag:"bag",doughnuts:"doughnuts",hooter:"hooter",scroll:{textureId:"scroll",filter:gt(e)},reincarnation:{animationId:"fish",paused:n}}[t.gives];return V(o)}),moveableDeadly:zt("fish.1"),charles:hA,joystick:zt("joystick"),movingPlatform:zt("sandwich"),pushableBlock:zt("stepStool"),portableBlock:Ie(({renderContext:{item:{config:{style:t}}}})=>V(t)),spring:pA,sceneryPlayer:mA,hushPuppy:zt("hushPuppy"),bubbles:Ie(({renderContext:{item:{config:{style:t}},general:{paused:e}}})=>V({animationId:`bubbles.${t}`,paused:e})),firedDoughnut:zt({animationId:"bubbles.doughnut"}),ball:zt("ball"),floor:KE,particle:Ie(({renderContext:{item:{config:{forCharacter:t}}}})=>V({animationId:"particle.fade",anchor:{x:.5,y:.5},filter:t==="heels"?mg:sn}))},EA=t=>{if(t.type==="wall"){const{direction:e}=t.config;return e==="right"||e==="towards"?void 0:wA}return t.type==="deadlyBlock"&&t.config.style==="toaster"?kA:PA[t.type]},AA=N.moss,TA=()=>new yt({outlineColor:AA,lowRes:!1,upscale:en(U.getState())});class RA{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output)}output=new re({label:"PortableItemPickUpNextHighlightRenderer"});#e=!1;tick(e){const{wouldPickUpNext:n}=this.renderContext.item.state;n!==!this.#e&&(this.output.filters=n?[TA()]:sn),this.#e=n,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const OA=(t,e,n)=>fv(t)?new RA(e,n):n,IA=N.pastelBlue,jA=N.highlightBeige,$A=N.midRed,NA=N.white,Nd=new yt({outlineColor:jA,upscale:en(U.getState()),lowRes:!1}),Md=new yt({outlineColor:$A,upscale:en(U.getState()),lowRes:!1}),MA=new yt({outlineColor:NA,upscale:en(U.getState()),lowRes:!1}),zd=new Ue(IA),Dd={left:"↖",away:"↗",right:"↘",towards:"↙"},Ld=(t,e)=>{switch(t){case"back-forth":switch(e){case"left":return"↖↘";case"right":return"↘↖";case"away":return"↗↙";case"towards":return"↙↗";default:throw new Error("Unexpected startDirection")}case"clockwise":switch(e){case"left":return"↖↗↘↙";case"right":return"↘↙↖↘";case"away":return"↗↘↙↖";case"towards":return"↙↖↗↘";default:throw new Error("Unexpected startDirection")}case"towards-analogue":return"➡.⬅"}return""};class zA{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output),this.#e()}output=new re({label:"EditorAnnotationsRenderer"});#e(){const e=this.renderContext.item;switch(e.type){case"pickup":if(e.config.gives==="shield"||e.config.gives==="extra-life"||e.config.gives==="jumps"||e.config.gives==="fast"){const n={shield:"🛡",jumps:"♨",fast:"⚡","extra-life":"+2"};this.#t({annotationText:n[e.config.gives],yAdj:-16})}break;case"doorFrame":if(e.config.part==="near"){const{rooms:n}=U.getState().levelEditor.campaignInProgress,{config:{toRoom:r,direction:o}}=e,s=!!n[r],i=r.toUpperCase(),a=Dd[o],l=o==="away"||o==="right"?`${i}${a}`:`${a}${i}`;this.#t({annotationText:l,yAdj:o==="left"||o==="away"?-48:0,error:!s,clickDispatch:s?()=>hs(r):void 0})}break;case"teleporter":{const{rooms:n}=U.getState().levelEditor.campaignInProgress,{config:{toRoom:r}}=e,o=!!n[r];this.#t({annotationText:`➡${r.toUpperCase()}`,yAdj:-12,error:!o,clickDispatch:o?()=>hs(r):void 0})}break;case"conveyor":{const{config:{direction:n}}=e,r=Dd[n];this.#t({annotationText:r,yAdj:-12})}break;case"movingPlatform":{const{config:{movement:n,startDirection:r}}=e;this.#t({annotationText:Ld(n,r),yAdj:-12})}break;case"monster":{const{config:n}=e;(n.which==="turtle"||n.which==="skiHead")&&this.#t({annotationText:Ld(n.movement,n.startDirection),yAdj:-12})}break}}#t({annotationText:e,yAdj:n=0,error:r=!1,clickDispatch:o}){const{renderContext:{frontLayer:s}}=this,i=new Ue(r?N.midRed:N.white),a=gg(new re({label:"EditorAnnotationTextContainer",filters:[i,new yt({lowRes:!0,outlineColor:N.pureBlack,upscale:en(U.getState())})]}),e);a.y=n,o!==void 0&&(a.eventMode="static",a.on("click",()=>{U.dispatch(o())}),a.on("mouseover",()=>{U.getState().levelEditor.tool.type==="pointer"&&(U.dispatch(hc(!0)),i.targetColor=N.pastelBlue)}),a.on("mouseout",()=>{U.dispatch(hc(!1)),i.targetColor=N.white}),a.cursor="pointer"),this.output.addChild(a),s.attach(a)}tick(e){this.#n(),this.childRenderer.tick(e)}#n(){const{renderContext:{item:e,room:n}}=this,{clickableAnnotationHovered:r}=U.getState().levelEditor,{jsonItemId:o}=e,s=U.getState(),i=Ch(s),a=pv(s),l=mn(s),c=o&&i?.jsonItemId===o&&!r,u=o&&a.includes(o),d=()=>o!==void 0&&($e(n.items).some(f=>f.jsonItemId===i?.jsonItemId&&f.type==="switch"&&f.config.type==="in-room"&&f.config.modifies.some(p=>p.targets.includes(o)))||e.type==="switch"&&$e(n.items).some(({jsonItemId:f})=>f!==void 0&&f===i?.jsonItemId&&e.config.type==="in-room"&&e.config.modifies.some(p=>p.targets.includes(f)))||e.type==="charles"&&$e(n.items).some(f=>f.jsonItemId===i?.jsonItemId&&f.type==="joystick"&&f.config.controls.some(p=>p===o))||e.type==="joystick"&&e.config.controls.some(f=>i?.jsonItemId===f));this.output.filters=c&&u?[zd,l.type==="eyeDropper"?Md:Nd]:c?l.type==="eyeDropper"?Md:Nd:u?zd:d()?MA:sn}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const DA=(t,e,n)=>e.general.editor?new zA(e,n):n,LA=(t,e)=>{e!==void 0&&U.getState().gameMenus.cheatsOn&&(e.eventMode="static",e.on("pointertap",()=>{U.dispatch(Sy({item:t,pixiContainer:e}))}))},BA=t=>{const e=U.getState(),n=_y(e),r=!Cy(e),{item:o}=t,s=n==="all"||n==="non-wall"&&t.item.type!=="wall",i=[],a=EA(o);let l;if(a!==void 0){l=new ag(t,a);const p=new RE(t,l);i.push(DA(o,t,OA(o,t,p)))}if(r){const p=UP(t);p!==void 0&&i.push(p)}s&&i.push(new AP(t));let c;if(i.length===0)c=void 0;else{const p=i.length===1?i[0]:new FA(i,t);c=new IP(t,p),LA(o,c.output)}const u=t.general.soundSettings.mute??al.soundSettings.mute,d=t.general.paused||u?void 0:aE(t),f=d===void 0?void 0:new hE(t,d);return{top:new HP(t,{graphics:c,sound:f}),itemAppearanceRenderer:l}};class FA{constructor(e,n){this.renderContext=n,this.#e=e,this.#t.addChild(...e.map(r=>r.output))}#e;#t=new re({label:"CompositeRenderer"});tick(e){for(const n of this.#e)n.tick(e)}destroy(){for(const e of this.#e)e.destroy()}get output(){return this.#t}}const UA=fo("wall","doorFrame"),Bd=256;function*HA(t){const{left:e,right:n}=$e(t.items).filter(UA).reduce((r,{aabb:o,renderAabb:s,renderAabbOffset:i,state:{position:a}})=>{const l=s??o,c=B(a,i??le),u=q(B(c,{x:l.x})).x,d=q(B(c,{y:l.y})).x;return{left:Math.min(r.left,u),right:Math.max(r.right,d)}},{left:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY});e!==Number.POSITIVE_INFINITY&&(yield new ht().rect(e-100,-256,100,Bd).fill(0)),n!==Number.NEGATIVE_INFINITY&&(yield new ht().rect(n,-256,100,Bd).fill(0))}class WA{constructor(e){this.renderContext=e;const{general:{colourised:n,soundSettings:r},room:o}=e;this.initFilters(n,e.room.color);const i=r.mute??al.soundSettings.mute?void 0:de.createGain();Zs(HA(o),this.#o),this.output={sound:i,graphics:new re({label:`RoomRenderer(${e.room.id})`})},this.output.graphics.addChild(this.#t),n||(this.#n=new Mc({sortableChildren:!1}),this.output.graphics.addChild(this.#n)),this.output.graphics.addChild(this.#o),this.output.graphics.addChild(this.#r)}#e=!1;#t=new re({label:"items"});#n;#r=new Mc({sortableChildren:!1});#o=new re({label:"occlusion"});output;#s=void 0;#a=new Map;#i=new Map;initFilters(e,n){this.#t.filters=e?n.shade==="dimmed"?PE:sn:new Ue(n.shade==="dimmed"?vm(bs(n).main.original):bs(n).main.original)}#c=e=>this.#i.get(e);#l(e,n){let r=this.#i.get(n.id);if(r===void 0){r=BA({...this.renderContext,colourClashLayer:this.#n,frontLayer:this.#r,item:n,zEdges:this.#a,getItemRenderPipeline:this.#c}),this.#i.set(n.id,r);const{graphics:o,sound:s}=r.top.output;if(o&&(this.#t.addChild(o),n.fixedZIndex&&(o.zIndex=n.fixedZIndex)),s){if(!this.output.sound)throw new Error("item renderer has sound, but room renderer does not - this probably means that they disagree on if the user has sound muted");s.connect(this.output.sound)}}try{r.top.tick(e)}catch(o){throw new Error(`RoomRenderer: error while ticking item "${n.id}"
in room "${this.renderContext.room.id}"
item in play object is:
           
${JSON.stringify(n,null,2)}`,{cause:o})}}#d(e){const{room:n}=this.renderContext,r={...e,lastRenderRoomTime:this.#s},o=new Set,s=a=>{if(o.has(a))return;const l=this.#a.get(a);if(l)for(const[c,u]of l.entries())u&&s(c);this.#l(r,n.items[a]),o.add(a)};for(const a in n.items)s(a);let i=!1;for(const[a,l]of this.#i.entries())n.items[a]===void 0&&(l.top.destroy(),this.#i.delete(a),i=!0);i&&this.#h()}#h(){if(this.#n)for(const e of this.#n.renderLayerChildren)e.parent===null&&this.#n.detach(e);for(const e of this.#r.renderLayerChildren)e.parent===null&&this.#r.detach(e)}#f(e){for(let n=0;n<e.length;n++){const r=this.#i.get(e[n]);if(r===void 0)throw new Error(`Item id=${e[n]} does not have a renderer - cannot assign a z-index`);const o=r.top.output.graphics;if(!o)throw new Error(`order ${e[n]} was given a z-order by sorting, but item has no graphics`);o.zIndex=n}}get#u(){return this.#s!==void 0}tick(e){const n=this.#u?e:{...e,movedItems:new Set($e(this.renderContext.room.items))};sg(this.renderContext.room.items,n.movedItems,this.#a);const r=ig(this.#a);this.#d(n),(!this.#u||n.movedItems.size>0)&&this.#f(r),this.#s=this.renderContext.room.roomTime}destroy(){this.output.graphics.label=this.output.graphics.label+"DESTROYED",this.output.graphics.destroy({children:!0}),this.output.sound?.disconnect(),this.#i.forEach(e=>{e.top.destroy()}),this.#e=!0}get destroyed(){return this.#e}}const GA=t=>{t.ticker.remove(t.render,t)},yg=m.createContext(null),qA=({children:t})=>{const[e,n]=m.useState(null);return m.useEffect(()=>{const r=new Fh;return r.init({background:N.pureBlack,sharedTicker:!0}).then(()=>{GA(r),n(r)}),()=>{}},[]),e===null?null:h.jsx(yg,{value:e,children:t})},jn=()=>m.useContext(yg),VA=(t,e)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:e},soundSettings:{mute:!0},pixiRenderer:t,gameState:void 0,paused:!1,colourised:!0,upscale:cl(U.getState()),editor:!0}),Fd=(t,e,n)=>new WA({room:t,general:VA(e,n)}),KA=()=>{const{renderer:t}=jn(),e=lh();if(!t)throw new Error("this should never be falsey (typescript violation)");const n=Qm(),[r,o]=m.useState(()=>Fd(n,t,e));return m.useEffect(()=>{const s=Fd(n,t,e);return o(s),()=>{s.destroy()}},[n,t,e]),r},Ud=(t,e,n)=>{const{world:{onItem:{face:r},position:o,itemId:s}}=t;if(r.z>fh)return is(o);if(n.type==="door"){const i=e.items[s];if(i.type!=="wall")return;const{config:a,aabb:l,state:{position:c}}=i,u=mv(dl(a)),d=Pr(Kt(a.direction)),f=Kt(a.direction);if(u[d]<2)return;const p=c[d],g=c[d]+l[d]-L1,y=c.z,v=c.z+l.z-Gr,w={[d]:Math.max(Math.min(o[d],g),p),[f]:o[f],z:Math.max(Math.min(o.z,v),y)};return is(w)}return B(is(o),r)},XA={z:1,x:0,y:0},JA={z:0,x:0,y:-1},Hd={z:0,x:-1,y:0},YA=(t,{x:e,y:n},r)=>{if(r.type==="item"&&r.item.type==="door"&&t.type==="wall"){const l=t.config.direction;return As(Pe[l],-1)}const{bottomCentre:o,topLeft:s,topRight:i}=_r(t.state.position,t.aabb);return n<s.y-(s.x-e)/2?n<i.y-(e-i.x)/2?XA:Hd:e<o.x?JA:Hd},ZA=3,QA=(t,{x:e,y:n},r)=>{const o=_r(t.state.position,t.aabb);return ky.find(s=>{const i=o.projectCorner(s);return ll(Vt(i,{x:e,y:n}))<ZA})},Kn=3,Qi=1.5;function xt({x:t,y:e},n,r){const o={x:t-n.x,y:e-n.y},s=o.x*r.y-o.y*r.x;return Math.abs(s)/Py(Math.hypot(r.x,r.y))}const vg={point:{x:-1,y:-1,z:0},normal:{x:0,y:0,z:1}},wg={point:{x:-1,y:0,z:1},normal:{x:0,y:1,z:0}},bg={point:{x:0,y:-1,z:1},normal:{x:1,y:0,z:0}},xg={point:{x:0,y:1,z:1},normal:{x:1,y:0,z:0}},_g={point:{x:1,y:0,z:1},normal:{x:0,y:1,z:0}},Cg={point:{x:1,y:-1,z:0},normal:{x:0,y:0,z:1}},Sg={point:{x:0,y:-1,z:-1},normal:{x:1,y:0,z:0}},kg={point:{x:-1,y:1,z:0},normal:{x:0,y:0,z:1}},Pg={point:{x:-1,y:0,z:-1},normal:{x:0,y:1,z:0}},eT=(t,e,n,r)=>{const o=_r(t.state.position,t.aabb),s=n.x<0,i=n.y<0,a=n.z>0;if((s||i)&&xt(e,o.bottomCentre,{x:0,y:-1})<Qi)return vg;if((s||a)&&xt(e,o.topRight,{x:2,y:-1})<Qi)return wg;if((i||a)&&xt(e,o.topLeft,{x:2,y:1})<Qi)return bg;switch(!0){case a:{const l=o.c111;if(xt(e,l,{x:2,y:1})<Kn)return xg;if(xt(e,l,{x:-2,y:1})<Kn)return _g;break}case i:{const l=o.c100;if(xt(e,l,{x:0,y:-1})<Kn)return Cg;if(xt(e,l,{x:2,y:1})<Kn)return Sg;break}case s:{const l=o.c010;if(xt(e,l,{x:0,y:-1})<Kn)return kg;if(xt(e,l,{x:-2,y:1})<Kn)return Pg;break}}},Wd=(t,e,n)=>n?{position:t.state.position,aabb:t.aabb}:{position:B(t.state.position,t.renderAabbOffset??le),aabb:t.renderAabb??t.aabb},Gd=({x:t,y:e},n,r)=>{const{bottomCentre:o,topLeft:s,topRight:i}=_r(n,r);return!(t<s.x||t>i.x||e<i.y-(i.x-t)/2||e<s.y-(t-s.x)/2||e>o.y-(t-o.x)/2||e>o.y-(o.x-t)/2)},tT=(t,e,n)=>{const{position:r,aabb:o}=Wd(n,e,!1);if(Gd(t,r,o))return"intersects-rendered";if(e.type==="item"&&n.type==="wall"){const{position:i,aabb:a}=Wd(n,e,!0);if(Gd(t,i,a))return"intersects-unrendered"}return"non-intersecting"},qd=t=>t.fixedZIndex!==void 0,nT=t=>{const n=t.some(([,a])=>a==="intersects-rendered")?t.filter(([,a])=>a==="intersects-rendered").map(([a])=>a):t.map(([a])=>a);if(n.every(qd))return n.toSorted((a,l)=>l.fixedZIndex-a.fixedZIndex).at(0);const r=n.filter(a=>!qd(a));if(r.length===0)return;if(r.length===1)return r[0];const o=Object.fromEntries(r.map(a=>[a.id,a])),s=sg(o),i=ig(s);return o[i.at(-1)]},Eg=(t,e,n,r)=>{const o=n.type==="item"&&n.item.type==="door"?1:r,s=K.w*o,i=K.h,a=o===1?0:K.w/2,l=i/2,c=dh(e);return{x:c==="yz"?Math.round(t.x/s)*s:Math.floor((t.x-a)/s)*s,y:c==="xz"?Math.round(t.y/s)*s:Math.floor((t.y-a)/s)*s,z:c==="xy"?Math.round(t.z/i)*i:Math.floor((t.z+l)/i)*i}},rT=({state:{position:t},aabb:e},n,r,o,s)=>{const i={x:t.x+(n.x<0?0:e.x),y:t.y+(n.y<0?0:e.y),z:t.z+(n.z<0?0:e.z)},a=R1(i,n,r);return Eg(a,n,o,s)},oT=t=>e=>{const n=pr(e);return t.type==="item"&&t.item.type==="door"?n&&e.type==="wall":n},ea=(t,e,n,r)=>{const o=$e(e.items).filter(oT(n)).map(a=>[a,tT(t,n,a)]).filter(a=>a[1]!=="non-intersecting"),s=nT(Array.from(o)),i=e.id;if(s){const a=YA(s,t,n);if(!(a.z>0&&!Object.isExtensible(s.state.stoodOnBy)))return{roomId:i,scrXy:t,world:{itemId:s.id,onItem:{face:a,corner:QA(s,t),edge:eT(s,t,a)},position:rT(s,a,t,n,r)}}}return{roomId:i,scrXy:t,world:void 0}},sT=(t,e=console.error)=>(...n)=>{try{return t(...n)}catch(r){e(r);return}},iT=t=>Sh(e=>e>0?e:e>-1?1:-e+1,t),aT=({jsonItem:t,blockDragAccVec:e,resizeEdgeDirection:n})=>{const r=t.position,o=fs(t),s=no(e,n,hl(t)),i=B(o,s),a=iT(i),l=Sh((c,u,d,f,p)=>{const g=u<1;return c<0!==g?g?d-p+1:d+f-p:g?d+f-1:d},n,i,r,o,a);return{timesDelta:hr(a,o),positionDelta:hr(l,r)}},ta=(t,e)=>{const n=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const r=e.target.getBoundingClientRect(),o=e.clientX-r.left,s=e.clientY-r.top;return{x:o/n-t.gameEngineScreenSize.x/2,y:s/n-t.gameEngineScreenSize.y+16}},lT=(t,e)=>{const n=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const r=e.movementX,o=e.movementY;return{x:r/n,y:o/n}},cT=5,uT=(t,e,n)=>{const r=t.world?.onItem.edge,o=no(...vt(n).map(i=>hl(i))),s=no(r?.point??le,o);return Ts(s)>0?r.normal:e?{x:1,y:0,z:0}:{x:0,y:0,z:1}},dT=(t,e,n,r,o,s)=>{if(t===void 0)return;const i=Vt(e,t.scrXy),a=ll(i);if(!(o||a>cT))return;const c=uT(t,r,s),u=Vm(c,n);return r?{x:0,y:0,z:u.z}:u},Vd=(t,e=!1)=>{const n=U.getState().levelEditor;return Eg(t,{x:0,y:0,z:1},n.tool,e?1:n.gridResolution)},Jo=({levelEditor:t},e,n)=>{const r=e.items[n]?.jsonItemId;if(r===void 0)return;const o=Ph(t,r);if(o!==void 0)return[r,o]},as=(t,...e)=>t.levelEditor.wallsFloorsLocked&&e.some(n=>n.type==="wall"||n.type==="floor"),na=(t,e)=>{const n=U.getState();let r;if(e.world){const o=e.world.itemId,s=o&&t.items[o],i=as(n,s)?void 0:s.jsonItemId;r=i===void 0?void 0:{jsonItemId:i,pointingAtOnItem:e.world.onItem}}else r=void 0;Ge(Ch(n),r)||U.dispatch(kh(r))},hT=(t,e,n)=>{const r=n?.world?.itemId;if(r===void 0)return ds;const o=e.items[r].jsonItemId;if(o===void 0)return ds;const{selectedJsonItemIds:s}=t.levelEditor;return s.includes(o)?s:[o]},fT=t=>{const e=jn(),n=Tn(cl),r=He(),o=Zm(),s=m.useRef(void 0),i=m.useRef(void 0),a=m.useRef(void 0);m.useEffect(()=>{if(t===null)return;const l=p=>{const g=ta(n,p),y=lT(n,p),v=U.getState(),w=mn(v),_=ea(g,o,w,v.levelEditor.gridResolution),b=!Ge(_.world,s.current?.world);switch(w.type){case"item":{if(!b||(r(da()),_.world===void 0))break;const x=Jo(v,o,_.world.itemId);if(x===void 0)break;const[,S]=x,k=Ud(_,o,w.item);if(k===void 0||uP({roomState:o,blockPosition:k,itemTool:w.item}))break;r(fc({blockPosition:k,pointedAtItemJson:S,preview:!0}));break}case"pointer":{const x=hT(v,o,i.current);if(x.length===0){na(o,_);break}const S=x.map(Z=>vv(v,Z));if(as(v,...S))break;const C=_.roomId===i.current?.roomId?dT(i.current,g,y,p.metaKey||p.shiftKey,a.current!==void 0,S):void 0;if(!C){na(o,_);break}x.length===1&&!wv(v,x[0])&&U.dispatch(ai({jsonItemIds:x}));const M=i.current?.world?.onItem.edge,H=M&&S.every(Z=>Eh(Z)),L=a.current??le,X=B(L,C),j=Vd(X,H);if(a.current=X,il(Vd(L,H),j))break;const ee=is(j);let D,J;if(H){const[,Z]=Jo(v,o,i.current.world.itemId);({timesDelta:J,positionDelta:D}=aT({jsonItem:Z,blockDragAccVec:ee,resizeEdgeDirection:M.point}))}else D=ee;if(tg({roomState:o,jsonItemIds:x,blockPositionDelta:D,timesDelta:J}))break;r(vh({jsonItemIds:x,positionDelta:D,timesDelta:J}));break}case"eyeDropper":na(o,_);break}s.current=_},c=p=>{const g=U.getState();if(o.id!==g.levelEditor.currentlyEditingRoomId)return;const y=ta(n,p),v=mn(U.getState()),w=ea(y,o,v,g.levelEditor.gridResolution),_=a.current!==void 0,b=!_&&w.roomId===i.current?.roomId&&w.world?.itemId===i.current?.world?.itemId;if(a.current=void 0,i.current=void 0,U.dispatch(gv(!1)),!b&&!_){console.log("mouseUp - not a click or drag end - skipping");return}switch(v.type){case"item":{if(w.world===void 0){r(vn({type:"pointer"}));break}const x=Jo(g,o,w.world.itemId);if(x===void 0)break;const[,S]=x;r(fc({blockPosition:Ud(w,o,v.item),pointedAtItemJson:S,preview:!1}));break}case"pointer":{if(b){const x=w.world===void 0?void 0:o.items[w.world.itemId];if(x?.jsonItemId===void 0||as(g,x)){r(ai({jsonItemIds:[]}));break}r(p.ctrlKey||p.metaKey?yv({jsonItemId:x.jsonItemId}):ai({jsonItemIds:[x.jsonItemId]}))}else _&&r(wh());break}case"eyeDropper":{if(b){const x=w.world?.itemId;if(x===void 0){console.warn("no itemId");break}const S=o.items[x];if(as(g,S))break;const k=Jo(g,o,x);if(k===void 0)break;const[,C]=k;r(vn({type:"item",item:{type:C.type,config:C.config}}))}break}}},u=p=>{const g=mn(U.getState());switch(a.current=void 0,i.current=void 0,g.type){case"item":{r(da());break}case"pointer":{r(kh(void 0));break}}},d=p=>{const g=ta(n,p),y=U.getState(),v=mn(y),w=ea(g,o,v,y.levelEditor.gridResolution);console.log("setting mouseDownPointingAtRef to",w),i.current=w},f=sT(l);return t.addEventListener("mousemove",f),t.addEventListener("mouseup",c),t.addEventListener("mousedown",d),t.addEventListener("mouseleave",u),t.tabIndex=0,()=>{t.removeEventListener("mousemove",f),t.removeEventListener("mouseup",c),t.removeEventListener("mousedown",d),t.removeEventListener("mouseleave",u)}},[e.stage,n,t,r,o])},pT=()=>{const{cssUpscale:t,canvasSize:e,rotate90:n}=Tn(cl);return{transform:n?`scale(${t}) rotate(90deg) translate(0, -${e.y}px)`:`scale(${t})`,width:e.x,height:e.y,transformOrigin:"top left"}},mT=t=>{const e=Qm(),n=jn();m.useEffect(()=>{let r=0;const o=({deltaMS:s})=>{if(t.destroyed)return;t.renderContext.room!==e&&console.warn("room renderer does not have the current room");const i=new Set(us(e.items));e.roomTime+=s,t.tick({deltaMS:s,movedItems:i,progression:r++}),n.render()};return er.shared.add(o),()=>{er.shared.remove(o)}},[t,e,n])},gT=t=>{const e=jn();m.useEffect(()=>{if(t)return t.appendChild(e.canvas),()=>{t.removeChild(e.canvas)}},[t,e])},yT=()=>{const t=jn(),e=Tn(n=>n.upscale.upscale.gameEngineUpscale);t.stage.scale=e},vT=()=>{const t=jn(),e=Tn(Ey);m.useEffect(()=>{t.renderer?.resize(e.x,e.y)},[t.renderer,e])},wT=t=>{const e=jn(),[n]=m.useState(()=>new re),r=Tn(Ay);m.useEffect(()=>{if(t.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return n.addChild(t.output.graphics),e.stage.addChild(n),()=>{e.stage.removeChild(n),n.removeChild(t.output.graphics)}},[t,e,n]),m.useEffect(()=>{n.x=r.x/2,n.y=r.y-16},[n,r])},Kd=(t,e)=>{U.dispatch(Ty(Ry(t??Oy(U.getState()),e)))},bT=(t,e)=>{const n=He();m.useLayoutEffect(()=>{Kd()},[]),m.useLayoutEffect(()=>{const r=()=>Kd(t,e);if(e){const o=new ResizeObserver(r);return o.observe(e),()=>o.disconnect()}else return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[n,e,t])},xT=()=>{m.useEffect(()=>Iy({actionCreator:vn,effect(t,{dispatch:e}){e(da())}}))},_T=({levelEditor:t})=>{const{dragInProgress:e,clickableAnnotationHovered:n,hoveredItem:r,selectedJsonItemIds:o}=t;if(e)return ye("cursor-grabbing");if(n)return ye("cursor-pointer");if(r){const s=Ph(t,r.jsonItemId);if(s!==void 0&&Eh(s))if(r.pointingAtOnItem.corner){if(il(r.pointingAtOnItem.corner,{x:1,y:1,z:1}))return ye("cursor-n-resize")}else{const{edge:i}=r.pointingAtOnItem;if(i){if(Ge(i,kg))return ye("cursor-e-resize");if(Ge(i,vg))return ye("cursor-s-resize");if(Ge(i,Cg))return ye("cursor-w-resize");if(Ge(i,wg)||Ge(i,xg))return ye("cursor-ne-resize");if(Ge(i,bg)||Ge(i,_g))return ye("cursor-nw-resize");if(Ge(i,Pg))return ye("cursor-se-resize");if(Ge(i,Sg))return ye("cursor-sw-resize")}}return o.includes(r.jsonItemId)?ye("cursor-grab"):ye("cursor-default")}return ye("cursor-crosshair")},CT=()=>fe(_T);jy.defaultOptions.scaleMode="nearest";const ST=()=>{const t=KA(),[e,n]=m.useState(null),[r,o]=m.useState(null),s=CT();bT("amigaLowResPal",r??void 0),vT(),wT(t),mT(t),fT(e),gT(e),yT(),xT();const i=pT();return h.jsx("div",{className:`w-full h-full overflow-hidden ${s}`,ref:o,children:h.jsx("div",{style:i,ref:n})})},Xd=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,kT=()=>{const t=$y(),e=Tn(Ny);m.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",My())},[]),m.useEffect(()=>{document.body.classList.remove(...Object.keys(zy).map(Xd)),document.body.classList.add(Xd(t)),document.body.classList.toggle("portrait-rot",e)},[t,e])},ti=m.createContext(null);ti.displayName="PanelGroupContext";const we={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},nc=10,yn=m.useLayoutEffect,Jd=Es.useId,PT=typeof Jd=="function"?Jd:()=>null;let ET=0;function rc(t=null){const e=PT(),n=m.useRef(t||e||null);return n.current===null&&(n.current=""+ET++),t??n.current}function Ag({children:t,className:e="",collapsedSize:n,collapsible:r,defaultSize:o,forwardedRef:s,id:i,maxSize:a,minSize:l,onCollapse:c,onExpand:u,onResize:d,order:f,style:p,tagName:g="div",...y}){const v=m.useContext(ti);if(v===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:w,expandPanel:_,getPanelSize:b,getPanelStyle:x,groupId:S,isPanelCollapsed:k,reevaluatePanelConstraints:C,registerPanel:M,resizePanel:H,unregisterPanel:L}=v,X=rc(i),j=m.useRef({callbacks:{onCollapse:c,onExpand:u,onResize:d},constraints:{collapsedSize:n,collapsible:r,defaultSize:o,maxSize:a,minSize:l},id:X,idIsFromProps:i!==void 0,order:f});m.useRef({didLogMissingDefaultSizeWarning:!1}),yn(()=>{const{callbacks:D,constraints:J}=j.current,Y={...J};j.current.id=X,j.current.idIsFromProps=i!==void 0,j.current.order=f,D.onCollapse=c,D.onExpand=u,D.onResize=d,J.collapsedSize=n,J.collapsible=r,J.defaultSize=o,J.maxSize=a,J.minSize=l,(Y.collapsedSize!==J.collapsedSize||Y.collapsible!==J.collapsible||Y.maxSize!==J.maxSize||Y.minSize!==J.minSize)&&C(j.current,Y)}),yn(()=>{const D=j.current;return M(D),()=>{L(D)}},[f,X,M,L]),m.useImperativeHandle(s,()=>({collapse:()=>{w(j.current)},expand:D=>{_(j.current,D)},getId(){return X},getSize(){return b(j.current)},isCollapsed(){return k(j.current)},isExpanded(){return!k(j.current)},resize:D=>{H(j.current,D)}}),[w,_,b,k,X,H]);const ee=x(j.current,o);return m.createElement(g,{...y,children:t,className:e,id:X,style:{...ee,...p},[we.groupId]:S,[we.panel]:"",[we.panelCollapsible]:r||void 0,[we.panelId]:X,[we.panelSize]:parseFloat(""+ee.flexGrow).toFixed(1)})}const ls=m.forwardRef((t,e)=>m.createElement(Ag,{...t,forwardedRef:e}));Ag.displayName="Panel";ls.displayName="forwardRef(Panel)";let Za=null,cs=-1,Ht=null;function AT(t,e){if(e){const n=(e&jg)!==0,r=(e&$g)!==0,o=(e&Ng)!==0,s=(e&Mg)!==0;if(n)return o?"se-resize":s?"ne-resize":"e-resize";if(r)return o?"sw-resize":s?"nw-resize":"w-resize";if(o)return"s-resize";if(s)return"n-resize"}switch(t){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function TT(){Ht!==null&&(document.head.removeChild(Ht),Za=null,Ht=null,cs=-1)}function ra(t,e){var n,r;const o=AT(t,e);if(Za!==o){if(Za=o,Ht===null&&(Ht=document.createElement("style"),document.head.appendChild(Ht)),cs>=0){var s;(s=Ht.sheet)===null||s===void 0||s.removeRule(cs)}cs=(n=(r=Ht.sheet)===null||r===void 0?void 0:r.insertRule(`*{cursor: ${o} !important;}`))!==null&&n!==void 0?n:-1}}function Tg(t){return t.type==="keydown"}function Rg(t){return t.type.startsWith("pointer")}function Og(t){return t.type.startsWith("mouse")}function ni(t){if(Rg(t)){if(t.isPrimary)return{x:t.clientX,y:t.clientY}}else if(Og(t))return{x:t.clientX,y:t.clientY};return{x:1/0,y:1/0}}function RT(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function OT(t,e,n){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function IT(t,e){if(t===e)throw new Error("Cannot compare node with itself");const n={a:Qd(t),b:Qd(e)};let r;for(;n.a.at(-1)===n.b.at(-1);)t=n.a.pop(),e=n.b.pop(),r=t;ne(r,"Stacking order can only be calculated for elements with a common ancestor");const o={a:Zd(Yd(n.a)),b:Zd(Yd(n.b))};if(o.a===o.b){const s=r.childNodes,i={a:n.a.at(-1),b:n.b.at(-1)};let a=s.length;for(;a--;){const l=s[a];if(l===i.a)return 1;if(l===i.b)return-1}}return Math.sign(o.a-o.b)}const jT=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function $T(t){var e;const n=getComputedStyle((e=Ig(t))!==null&&e!==void 0?e:t).display;return n==="flex"||n==="inline-flex"}function NT(t){const e=getComputedStyle(t);return!!(e.position==="fixed"||e.zIndex!=="auto"&&(e.position!=="static"||$T(t))||+e.opacity<1||"transform"in e&&e.transform!=="none"||"webkitTransform"in e&&e.webkitTransform!=="none"||"mixBlendMode"in e&&e.mixBlendMode!=="normal"||"filter"in e&&e.filter!=="none"||"webkitFilter"in e&&e.webkitFilter!=="none"||"isolation"in e&&e.isolation==="isolate"||jT.test(e.willChange)||e.webkitOverflowScrolling==="touch")}function Yd(t){let e=t.length;for(;e--;){const n=t[e];if(ne(n,"Missing node"),NT(n))return n}return null}function Zd(t){return t&&Number(getComputedStyle(t).zIndex)||0}function Qd(t){const e=[];for(;t;)e.push(t),t=Ig(t);return e}function Ig(t){const{parentNode:e}=t;return e&&e instanceof ShadowRoot?e.host:e}const jg=1,$g=2,Ng=4,Mg=8,MT=RT()==="coarse";let ot=[],dr=!1,Wt=new Map,ri=new Map;const co=new Set;function zT(t,e,n,r,o){var s;const{ownerDocument:i}=e,a={direction:n,element:e,hitAreaMargins:r,setResizeHandlerState:o},l=(s=Wt.get(i))!==null&&s!==void 0?s:0;return Wt.set(i,l+1),co.add(a),ks(),function(){var u;ri.delete(t),co.delete(a);const d=(u=Wt.get(i))!==null&&u!==void 0?u:1;if(Wt.set(i,d-1),ks(),d===1&&Wt.delete(i),ot.includes(a)){const f=ot.indexOf(a);f>=0&&ot.splice(f,1),sc(),o("up",!0,null)}}}function DT(t){const{target:e}=t,{x:n,y:r}=ni(t);dr=!0,oc({target:e,x:n,y:r}),ks(),ot.length>0&&(Ps("down",t),t.preventDefault(),zg(e)||t.stopImmediatePropagation())}function oa(t){const{x:e,y:n}=ni(t);if(dr&&t.buttons===0&&(dr=!1,Ps("up",t)),!dr){const{target:r}=t;oc({target:r,x:e,y:n})}Ps("move",t),sc(),ot.length>0&&t.preventDefault()}function sa(t){const{target:e}=t,{x:n,y:r}=ni(t);ri.clear(),dr=!1,ot.length>0&&(t.preventDefault(),zg(e)||t.stopImmediatePropagation()),Ps("up",t),oc({target:e,x:n,y:r}),sc(),ks()}function zg(t){let e=t;for(;e;){if(e.hasAttribute(we.resizeHandle))return!0;e=e.parentElement}return!1}function oc({target:t,x:e,y:n}){ot.splice(0);let r=null;(t instanceof HTMLElement||t instanceof SVGElement)&&(r=t),co.forEach(o=>{const{element:s,hitAreaMargins:i}=o,a=s.getBoundingClientRect(),{bottom:l,left:c,right:u,top:d}=a,f=MT?i.coarse:i.fine;if(e>=c-f&&e<=u+f&&n>=d-f&&n<=l+f){if(r!==null&&document.contains(r)&&s!==r&&!s.contains(r)&&!r.contains(s)&&IT(r,s)>0){let g=r,y=!1;for(;g&&!g.contains(s);){if(OT(g.getBoundingClientRect(),a)){y=!0;break}g=g.parentElement}if(y)return}ot.push(o)}})}function ia(t,e){ri.set(t,e)}function sc(){let t=!1,e=!1;ot.forEach(r=>{const{direction:o}=r;o==="horizontal"?t=!0:e=!0});let n=0;ri.forEach(r=>{n|=r}),t&&e?ra("intersection",n):t?ra("horizontal",n):e?ra("vertical",n):TT()}let aa;function ks(){var t;(t=aa)===null||t===void 0||t.abort(),aa=new AbortController;const e={capture:!0,signal:aa.signal};co.size&&(dr?(ot.length>0&&Wt.forEach((n,r)=>{const{body:o}=r;n>0&&(o.addEventListener("contextmenu",sa,e),o.addEventListener("pointerleave",oa,e),o.addEventListener("pointermove",oa,e))}),Wt.forEach((n,r)=>{const{body:o}=r;o.addEventListener("pointerup",sa,e),o.addEventListener("pointercancel",sa,e)})):Wt.forEach((n,r)=>{const{body:o}=r;n>0&&(o.addEventListener("pointerdown",DT,e),o.addEventListener("pointermove",oa,e))}))}function Ps(t,e){co.forEach(n=>{const{setResizeHandlerState:r}=n,o=ot.includes(n);r(t,o,e)})}function LT(){const[t,e]=m.useState(0);return m.useCallback(()=>e(n=>n+1),[])}function ne(t,e){if(!t)throw console.error(e),Error(e)}function Pn(t,e,n=nc){return t.toFixed(n)===e.toFixed(n)?0:t>e?1:-1}function Et(t,e,n=nc){return Pn(t,e,n)===0}function qe(t,e,n){return Pn(t,e,n)===0}function BT(t,e,n){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const o=t[r],s=e[r];if(!qe(o,s,n))return!1}return!0}function or({panelConstraints:t,panelIndex:e,size:n}){const r=t[e];ne(r!=null,`Panel constraints not found for index ${e}`);let{collapsedSize:o=0,collapsible:s,maxSize:i=100,minSize:a=0}=r;if(Pn(n,a)<0)if(s){const l=(o+a)/2;Pn(n,l)<0?n=o:n=a}else n=a;return n=Math.min(i,n),n=parseFloat(n.toFixed(nc)),n}function Vr({delta:t,initialLayout:e,panelConstraints:n,pivotIndices:r,prevLayout:o,trigger:s}){if(qe(t,0))return e;const i=[...e],[a,l]=r;ne(a!=null,"Invalid first pivot index"),ne(l!=null,"Invalid second pivot index");let c=0;if(s==="keyboard"){{const d=t<0?l:a,f=n[d];ne(f,`Panel constraints not found for index ${d}`);const{collapsedSize:p=0,collapsible:g,minSize:y=0}=f;if(g){const v=e[d];if(ne(v!=null,`Previous layout not found for panel index ${d}`),qe(v,p)){const w=y-v;Pn(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}{const d=t<0?a:l,f=n[d];ne(f,`No panel constraints found for index ${d}`);const{collapsedSize:p=0,collapsible:g,minSize:y=0}=f;if(g){const v=e[d];if(ne(v!=null,`Previous layout not found for panel index ${d}`),qe(v,y)){const w=v-p;Pn(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}}{const d=t<0?1:-1;let f=t<0?l:a,p=0;for(;;){const y=e[f];ne(y!=null,`Previous layout not found for panel index ${f}`);const w=or({panelConstraints:n,panelIndex:f,size:100})-y;if(p+=w,f+=d,f<0||f>=n.length)break}const g=Math.min(Math.abs(t),Math.abs(p));t=t<0?0-g:g}{let f=t<0?a:l;for(;f>=0&&f<n.length;){const p=Math.abs(t)-Math.abs(c),g=e[f];ne(g!=null,`Previous layout not found for panel index ${f}`);const y=g-p,v=or({panelConstraints:n,panelIndex:f,size:y});if(!qe(g,v)&&(c+=g-v,i[f]=v,c.toPrecision(3).localeCompare(Math.abs(t).toPrecision(3),void 0,{numeric:!0})>=0))break;t<0?f--:f++}}if(BT(o,i))return o;{const d=t<0?l:a,f=e[d];ne(f!=null,`Previous layout not found for panel index ${d}`);const p=f+c,g=or({panelConstraints:n,panelIndex:d,size:p});if(i[d]=g,!qe(g,p)){let y=p-g,w=t<0?l:a;for(;w>=0&&w<n.length;){const _=i[w];ne(_!=null,`Previous layout not found for panel index ${w}`);const b=_+y,x=or({panelConstraints:n,panelIndex:w,size:b});if(qe(_,x)||(y-=x-_,i[w]=x),qe(y,0))break;t>0?w--:w++}}}const u=i.reduce((d,f)=>f+d,0);return qe(u,100)?i:o}function FT({layout:t,panelsArray:e,pivotIndices:n}){let r=0,o=100,s=0,i=0;const a=n[0];ne(a!=null,"No pivot index found"),e.forEach((d,f)=>{const{constraints:p}=d,{maxSize:g=100,minSize:y=0}=p;f===a?(r=y,o=g):(s+=y,i+=g)});const l=Math.min(o,100-s),c=Math.max(r,100-i),u=t[a];return{valueMax:l,valueMin:c,valueNow:u}}function uo(t,e=document){return Array.from(e.querySelectorAll(`[${we.resizeHandleId}][data-panel-group-id="${t}"]`))}function Dg(t,e,n=document){const o=uo(t,n).findIndex(s=>s.getAttribute(we.resizeHandleId)===e);return o??null}function Lg(t,e,n){const r=Dg(t,e,n);return r!=null?[r,r+1]:[-1,-1]}function UT(t){return t instanceof HTMLElement?!0:typeof t=="object"&&t!==null&&"tagName"in t&&"getAttribute"in t}function Bg(t,e=document){if(UT(e)&&e.dataset.panelGroupId==t)return e;const n=e.querySelector(`[data-panel-group][data-panel-group-id="${t}"]`);return n||null}function oi(t,e=document){const n=e.querySelector(`[${we.resizeHandleId}="${t}"]`);return n||null}function HT(t,e,n,r=document){var o,s,i,a;const l=oi(e,r),c=uo(t,r),u=l?c.indexOf(l):-1,d=(o=(s=n[u])===null||s===void 0?void 0:s.id)!==null&&o!==void 0?o:null,f=(i=(a=n[u+1])===null||a===void 0?void 0:a.id)!==null&&i!==void 0?i:null;return[d,f]}function WT({committedValuesRef:t,eagerValuesRef:e,groupId:n,layout:r,panelDataArray:o,panelGroupElement:s,setLayout:i}){m.useRef({didWarnAboutMissingResizeHandle:!1}),yn(()=>{if(!s)return;const a=uo(n,s);for(let l=0;l<o.length-1;l++){const{valueMax:c,valueMin:u,valueNow:d}=FT({layout:r,panelsArray:o,pivotIndices:[l,l+1]}),f=a[l];if(f!=null){const p=o[l];ne(p,`No panel data found for index "${l}"`),f.setAttribute("aria-controls",p.id),f.setAttribute("aria-valuemax",""+Math.round(c)),f.setAttribute("aria-valuemin",""+Math.round(u)),f.setAttribute("aria-valuenow",d!=null?""+Math.round(d):"")}}return()=>{a.forEach((l,c)=>{l.removeAttribute("aria-controls"),l.removeAttribute("aria-valuemax"),l.removeAttribute("aria-valuemin"),l.removeAttribute("aria-valuenow")})}},[n,r,o,s]),m.useEffect(()=>{if(!s)return;const a=e.current;ne(a,"Eager values not found");const{panelDataArray:l}=a,c=Bg(n,s);ne(c!=null,`No group found for id "${n}"`);const u=uo(n,s);ne(u,`No resize handles found for group id "${n}"`);const d=u.map(f=>{const p=f.getAttribute(we.resizeHandleId);ne(p,"Resize handle element has no handle id attribute");const[g,y]=HT(n,p,l,s);if(g==null||y==null)return()=>{};const v=w=>{if(!w.defaultPrevented)switch(w.key){case"Enter":{w.preventDefault();const _=l.findIndex(b=>b.id===g);if(_>=0){const b=l[_];ne(b,`No panel data found for index ${_}`);const x=r[_],{collapsedSize:S=0,collapsible:k,minSize:C=0}=b.constraints;if(x!=null&&k){const M=Vr({delta:qe(x,S)?C-S:S-x,initialLayout:r,panelConstraints:l.map(H=>H.constraints),pivotIndices:Lg(n,p,s),prevLayout:r,trigger:"keyboard"});r!==M&&i(M)}}break}}};return f.addEventListener("keydown",v),()=>{f.removeEventListener("keydown",v)}});return()=>{d.forEach(f=>f())}},[s,t,e,n,r,o,i])}function eh(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Fg(t,e){const n=t==="horizontal",{x:r,y:o}=ni(e);return n?r:o}function GT(t,e,n,r,o){const s=n==="horizontal",i=oi(e,o);ne(i,`No resize handle element found for id "${e}"`);const a=i.getAttribute(we.groupId);ne(a,"Resize handle element has no group id attribute");let{initialCursorPosition:l}=r;const c=Fg(n,t),u=Bg(a,o);ne(u,`No group element found for id "${a}"`);const d=u.getBoundingClientRect(),f=s?d.width:d.height;return(c-l)/f*100}function qT(t,e,n,r,o,s){if(Tg(t)){const i=n==="horizontal";let a=0;t.shiftKey?a=100:o!=null?a=o:a=10;let l=0;switch(t.key){case"ArrowDown":l=i?0:a;break;case"ArrowLeft":l=i?-a:0;break;case"ArrowRight":l=i?a:0;break;case"ArrowUp":l=i?0:-a;break;case"End":l=100;break;case"Home":l=-100;break}return l}else return r==null?0:GT(t,e,n,r,s)}function VT({panelDataArray:t}){const e=Array(t.length),n=t.map(s=>s.constraints);let r=0,o=100;for(let s=0;s<t.length;s++){const i=n[s];ne(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;a!=null&&(r++,e[s]=a,o-=a)}for(let s=0;s<t.length;s++){const i=n[s];ne(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;if(a!=null)continue;const l=t.length-r,c=o/l;r++,e[s]=c,o-=c}return e}function Xn(t,e,n){e.forEach((r,o)=>{const s=t[o];ne(s,`Panel data not found for index ${o}`);const{callbacks:i,constraints:a,id:l}=s,{collapsedSize:c=0,collapsible:u}=a,d=n[l];if(d==null||r!==d){n[l]=r;const{onCollapse:f,onExpand:p,onResize:g}=i;g&&g(r,d),u&&(f||p)&&(p&&(d==null||Et(d,c))&&!Et(r,c)&&p(),f&&(d==null||!Et(d,c))&&Et(r,c)&&f())}})}function Yo(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!=e[n])return!1;return!0}function KT({defaultSize:t,dragState:e,layout:n,panelData:r,panelIndex:o,precision:s=3}){const i=n[o];let a;return i==null?a=t!=null?t.toPrecision(s):"1":r.length===1?a="1":a=i.toPrecision(s),{flexBasis:0,flexGrow:a,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function XT(t,e=10){let n=null;return(...o)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{t(...o)},e)}}function th(t){try{if(typeof localStorage<"u")t.getItem=e=>localStorage.getItem(e),t.setItem=(e,n)=>{localStorage.setItem(e,n)};else throw new Error("localStorage not supported in this environment")}catch(e){console.error(e),t.getItem=()=>null,t.setItem=()=>{}}}function Ug(t){return`react-resizable-panels:${t}`}function Hg(t){return t.map(e=>{const{constraints:n,id:r,idIsFromProps:o,order:s}=e;return o?r:s?`${s}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((e,n)=>e.localeCompare(n)).join(",")}function Wg(t,e){try{const n=Ug(t),r=e.getItem(n);if(r){const o=JSON.parse(r);if(typeof o=="object"&&o!=null)return o}}catch{}return null}function JT(t,e,n){var r,o;const s=(r=Wg(t,n))!==null&&r!==void 0?r:{},i=Hg(e);return(o=s[i])!==null&&o!==void 0?o:null}function YT(t,e,n,r,o){var s;const i=Ug(t),a=Hg(e),l=(s=Wg(t,o))!==null&&s!==void 0?s:{};l[a]={expandToSizes:Object.fromEntries(n.entries()),layout:r};try{o.setItem(i,JSON.stringify(l))}catch(c){console.error(c)}}function nh({layout:t,panelConstraints:e}){const n=[...t],r=n.reduce((s,i)=>s+i,0);if(n.length!==e.length)throw Error(`Invalid ${e.length} panel layout: ${n.map(s=>`${s}%`).join(", ")}`);if(!qe(r,100)&&n.length>0)for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=100/r*i;n[s]=a}let o=0;for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=or({panelConstraints:e,panelIndex:s,size:i});i!=a&&(o+=i-a,n[s]=a)}if(!qe(o,0))for(let s=0;s<e.length;s++){const i=n[s];ne(i!=null,`No layout data found for index ${s}`);const a=i+o,l=or({panelConstraints:e,panelIndex:s,size:a});if(i!==l&&(o-=l-i,n[s]=l,qe(o,0)))break}return n}const ZT=100,Kr={getItem:t=>(th(Kr),Kr.getItem(t)),setItem:(t,e)=>{th(Kr),Kr.setItem(t,e)}},rh={};function Gg({autoSaveId:t=null,children:e,className:n="",direction:r,forwardedRef:o,id:s=null,onLayout:i=null,keyboardResizeBy:a=null,storage:l=Kr,style:c,tagName:u="div",...d}){const f=rc(s),p=m.useRef(null),[g,y]=m.useState(null),[v,w]=m.useState([]),_=LT(),b=m.useRef({}),x=m.useRef(new Map),S=m.useRef(0),k=m.useRef({autoSaveId:t,direction:r,dragState:g,id:f,keyboardResizeBy:a,onLayout:i,storage:l}),C=m.useRef({layout:v,panelDataArray:[],panelDataArrayChanged:!1});m.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),m.useImperativeHandle(o,()=>({getId:()=>k.current.id,getLayout:()=>{const{layout:P}=C.current;return P},setLayout:P=>{const{onLayout:R}=k.current,{layout:A,panelDataArray:O}=C.current,T=nh({layout:P,panelConstraints:O.map(z=>z.constraints)});eh(A,T)||(w(T),C.current.layout=T,R&&R(T),Xn(O,T,b.current))}}),[]),yn(()=>{k.current.autoSaveId=t,k.current.direction=r,k.current.dragState=g,k.current.id=f,k.current.onLayout=i,k.current.storage=l}),WT({committedValuesRef:k,eagerValuesRef:C,groupId:f,layout:v,panelDataArray:C.current.panelDataArray,setLayout:w,panelGroupElement:p.current}),m.useEffect(()=>{const{panelDataArray:P}=C.current;if(t){if(v.length===0||v.length!==P.length)return;let R=rh[t];R==null&&(R=XT(YT,ZT),rh[t]=R);const A=[...P],O=new Map(x.current);R(t,A,O,v,l)}},[t,v,l]),m.useEffect(()=>{});const M=m.useCallback(P=>{const{onLayout:R}=k.current,{layout:A,panelDataArray:O}=C.current;if(P.constraints.collapsible){const T=O.map(Ne=>Ne.constraints),{collapsedSize:z=0,panelSize:oe,pivotIndices:ue}=cn(O,P,A);if(ne(oe!=null,`Panel size not found for panel "${P.id}"`),!Et(oe,z)){x.current.set(P.id,oe);const Me=Qn(O,P)===O.length-1?oe-z:z-oe,ce=Vr({delta:Me,initialLayout:A,panelConstraints:T,pivotIndices:ue,prevLayout:A,trigger:"imperative-api"});Yo(A,ce)||(w(ce),C.current.layout=ce,R&&R(ce),Xn(O,ce,b.current))}}},[]),H=m.useCallback((P,R)=>{const{onLayout:A}=k.current,{layout:O,panelDataArray:T}=C.current;if(P.constraints.collapsible){const z=T.map(Ye=>Ye.constraints),{collapsedSize:oe=0,panelSize:ue=0,minSize:Ne=0,pivotIndices:Me}=cn(T,P,O),ce=R??Ne;if(Et(ue,oe)){const Ye=x.current.get(P.id),Ir=Ye!=null&&Ye>=ce?Ye:ce,si=Qn(T,P)===T.length-1?ue-Ir:Ir-ue,ze=Vr({delta:si,initialLayout:O,panelConstraints:z,pivotIndices:Me,prevLayout:O,trigger:"imperative-api"});Yo(O,ze)||(w(ze),C.current.layout=ze,A&&A(ze),Xn(T,ze,b.current))}}},[]),L=m.useCallback(P=>{const{layout:R,panelDataArray:A}=C.current,{panelSize:O}=cn(A,P,R);return ne(O!=null,`Panel size not found for panel "${P.id}"`),O},[]),X=m.useCallback((P,R)=>{const{panelDataArray:A}=C.current,O=Qn(A,P);return KT({defaultSize:R,dragState:g,layout:v,panelData:A,panelIndex:O})},[g,v]),j=m.useCallback(P=>{const{layout:R,panelDataArray:A}=C.current,{collapsedSize:O=0,collapsible:T,panelSize:z}=cn(A,P,R);return ne(z!=null,`Panel size not found for panel "${P.id}"`),T===!0&&Et(z,O)},[]),ee=m.useCallback(P=>{const{layout:R,panelDataArray:A}=C.current,{collapsedSize:O=0,collapsible:T,panelSize:z}=cn(A,P,R);return ne(z!=null,`Panel size not found for panel "${P.id}"`),!T||Pn(z,O)>0},[]),D=m.useCallback(P=>{const{panelDataArray:R}=C.current;R.push(P),R.sort((A,O)=>{const T=A.order,z=O.order;return T==null&&z==null?0:T==null?-1:z==null?1:T-z}),C.current.panelDataArrayChanged=!0,_()},[_]);yn(()=>{if(C.current.panelDataArrayChanged){C.current.panelDataArrayChanged=!1;const{autoSaveId:P,onLayout:R,storage:A}=k.current,{layout:O,panelDataArray:T}=C.current;let z=null;if(P){const ue=JT(P,T,A);ue&&(x.current=new Map(Object.entries(ue.expandToSizes)),z=ue.layout)}z==null&&(z=VT({panelDataArray:T}));const oe=nh({layout:z,panelConstraints:T.map(ue=>ue.constraints)});eh(O,oe)||(w(oe),C.current.layout=oe,R&&R(oe),Xn(T,oe,b.current))}}),yn(()=>{const P=C.current;return()=>{P.layout=[]}},[]);const J=m.useCallback(P=>{let R=!1;const A=p.current;return A&&window.getComputedStyle(A,null).getPropertyValue("direction")==="rtl"&&(R=!0),function(T){T.preventDefault();const z=p.current;if(!z)return()=>null;const{direction:oe,dragState:ue,id:Ne,keyboardResizeBy:Me,onLayout:ce}=k.current,{layout:Ye,panelDataArray:Ir}=C.current,{initialLayout:Co}=ue??{},si=Lg(Ne,P,z);let ze=qT(T,P,oe,ue,Me,z);const ic=oe==="horizontal";ic&&R&&(ze=-ze);const Vg=Ir.map(Kg=>Kg.constraints),jr=Vr({delta:ze,initialLayout:Co??Ye,panelConstraints:Vg,pivotIndices:si,prevLayout:Ye,trigger:Tg(T)?"keyboard":"mouse-or-touch"}),ac=!Yo(Ye,jr);(Rg(T)||Og(T))&&S.current!=ze&&(S.current=ze,!ac&&ze!==0?ic?ia(P,ze<0?jg:$g):ia(P,ze<0?Ng:Mg):ia(P,0)),ac&&(w(jr),C.current.layout=jr,ce&&ce(jr),Xn(Ir,jr,b.current))}},[]),Y=m.useCallback((P,R)=>{const{onLayout:A}=k.current,{layout:O,panelDataArray:T}=C.current,z=T.map(Ye=>Ye.constraints),{panelSize:oe,pivotIndices:ue}=cn(T,P,O);ne(oe!=null,`Panel size not found for panel "${P.id}"`);const Me=Qn(T,P)===T.length-1?oe-R:R-oe,ce=Vr({delta:Me,initialLayout:O,panelConstraints:z,pivotIndices:ue,prevLayout:O,trigger:"imperative-api"});Yo(O,ce)||(w(ce),C.current.layout=ce,A&&A(ce),Xn(T,ce,b.current))},[]),Z=m.useCallback((P,R)=>{const{layout:A,panelDataArray:O}=C.current,{collapsedSize:T=0,collapsible:z}=R,{collapsedSize:oe=0,collapsible:ue,maxSize:Ne=100,minSize:Me=0}=P.constraints,{panelSize:ce}=cn(O,P,A);ce!=null&&(z&&ue&&Et(ce,T)?Et(T,oe)||Y(P,oe):ce<Me?Y(P,Me):ce>Ne&&Y(P,Ne))},[Y]),F=m.useCallback((P,R)=>{const{direction:A}=k.current,{layout:O}=C.current;if(!p.current)return;const T=oi(P,p.current);ne(T,`Drag handle element not found for id "${P}"`);const z=Fg(A,R);y({dragHandleId:P,dragHandleRect:T.getBoundingClientRect(),initialCursorPosition:z,initialLayout:O})},[]),ae=m.useCallback(()=>{y(null)},[]),ve=m.useCallback(P=>{const{panelDataArray:R}=C.current,A=Qn(R,P);A>=0&&(R.splice(A,1),delete b.current[P.id],C.current.panelDataArrayChanged=!0,_())},[_]),me=m.useMemo(()=>({collapsePanel:M,direction:r,dragState:g,expandPanel:H,getPanelSize:L,getPanelStyle:X,groupId:f,isPanelCollapsed:j,isPanelExpanded:ee,reevaluatePanelConstraints:Z,registerPanel:D,registerResizeHandle:J,resizePanel:Y,startDragging:F,stopDragging:ae,unregisterPanel:ve,panelGroupElement:p.current}),[M,g,r,H,L,X,f,j,ee,Z,D,J,Y,F,ae,ve]),E={display:"flex",flexDirection:r==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return m.createElement(ti.Provider,{value:me},m.createElement(u,{...d,children:e,className:n,id:s,ref:p,style:{...E,...c},[we.group]:"",[we.groupDirection]:r,[we.groupId]:f}))}const qg=m.forwardRef((t,e)=>m.createElement(Gg,{...t,forwardedRef:e}));Gg.displayName="PanelGroup";qg.displayName="forwardRef(PanelGroup)";function Qn(t,e){return t.findIndex(n=>n===e||n.id===e.id)}function cn(t,e,n){const r=Qn(t,e),s=r===t.length-1?[r-1,r]:[r,r+1],i=n[r];return{...e.constraints,panelSize:i,pivotIndices:s}}function QT({disabled:t,handleId:e,resizeHandler:n,panelGroupElement:r}){m.useEffect(()=>{if(t||n==null||r==null)return;const o=oi(e,r);if(o==null)return;const s=i=>{if(!i.defaultPrevented)switch(i.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{i.preventDefault(),n(i);break}case"F6":{i.preventDefault();const a=o.getAttribute(we.groupId);ne(a,`No group element found for id "${a}"`);const l=uo(a,r),c=Dg(a,e,r);ne(c!==null,`No resize element found for id "${e}"`);const u=i.shiftKey?c>0?c-1:l.length-1:c+1<l.length?c+1:0;l[u].focus();break}}};return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}},[r,t,e,n])}function Qa({children:t=null,className:e="",disabled:n=!1,hitAreaMargins:r,id:o,onBlur:s,onClick:i,onDragging:a,onFocus:l,onPointerDown:c,onPointerUp:u,style:d={},tabIndex:f=0,tagName:p="div",...g}){var y,v;const w=m.useRef(null),_=m.useRef({onClick:i,onDragging:a,onPointerDown:c,onPointerUp:u});m.useEffect(()=>{_.current.onClick=i,_.current.onDragging=a,_.current.onPointerDown=c,_.current.onPointerUp=u});const b=m.useContext(ti);if(b===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:x,groupId:S,registerResizeHandle:k,startDragging:C,stopDragging:M,panelGroupElement:H}=b,L=rc(o),[X,j]=m.useState("inactive"),[ee,D]=m.useState(!1),[J,Y]=m.useState(null),Z=m.useRef({state:X});yn(()=>{Z.current.state=X}),m.useEffect(()=>{if(n)Y(null);else{const me=k(L);Y(()=>me)}},[n,L,k]);const F=(y=r?.coarse)!==null&&y!==void 0?y:15,ae=(v=r?.fine)!==null&&v!==void 0?v:5;m.useEffect(()=>{if(n||J==null)return;const me=w.current;ne(me,"Element ref not attached");let E=!1;return zT(L,me,x,{coarse:F,fine:ae},(R,A,O)=>{if(!A){j("inactive");return}switch(R){case"down":{j("drag"),E=!1,ne(O,'Expected event to be defined for "down" action'),C(L,O);const{onDragging:T,onPointerDown:z}=_.current;T?.(!0),z?.();break}case"move":{const{state:T}=Z.current;E=!0,T!=="drag"&&j("hover"),ne(O,'Expected event to be defined for "move" action'),J(O);break}case"up":{j("hover"),M();const{onClick:T,onDragging:z,onPointerUp:oe}=_.current;z?.(!1),oe?.(),E||T?.();break}}})},[F,x,n,ae,k,L,J,C,M]),QT({disabled:n,handleId:L,resizeHandler:J,panelGroupElement:H});const ve={touchAction:"none",userSelect:"none"};return m.createElement(p,{...g,children:t,className:e,id:o,onBlur:()=>{D(!1),s?.()},onFocus:()=>{D(!0),l?.()},ref:w,role:"separator",style:{...ve,...d},tabIndex:f,[we.groupDirection]:x,[we.groupId]:S,[we.resizeHandle]:"",[we.resizeHandleActive]:X==="drag"?"pointer":ee?"keyboard":void 0,[we.resizeHandleEnabled]:!n,[we.resizeHandleId]:L,[we.resizeHandleState]:X})}Qa.displayName="PanelResizeHandle";const eR=Dy(()=>Gt(()=>import("./JsonRoomEditor-DIZz_Eg1.js").then(t=>t.J),__vite__mapDeps([8,1,2,6,9]))),tR=m.lazy(eR),nR=()=>{kT();const t=h.jsx("div",{className:"flex h-full items-center justify-center bg-pureBlack",children:h.jsx("span",{className:"sprite texture-animated-head_walking_right"})});return h.jsx(h.Fragment,{children:h.jsx(lP,{children:h.jsx(Ds,{children:h.jsxs(qg,{direction:"horizontal",className:"w-full h-full",children:[h.jsx(ls,{id:"jsonEditor",defaultSize:18,minSize:12,collapsible:!0,children:h.jsx(m.Suspense,{fallback:t,children:h.jsx(tR,{})})}),h.jsx(Qa,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-r-[calc(1px*var(--scale))] border-metallicBlue"}),h.jsx(ls,{id:"editingArea",children:h.jsx(qA,{children:h.jsx(ST,{})})}),h.jsx(Qa,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-l-[calc(1px*var(--scale))] border-metallicBlue"}),h.jsx(ls,{id:"toolbar",defaultSize:20,maxSize:33,minSize:10,children:h.jsx(vC,{children:h.jsx(vP,{})})})]})})})})},vR=Object.freeze(Object.defineProperty({__proto__:null,default:nR},Symbol.toStringTag,{value:"Module"}));export{zh as A,$h as C,tn as F,vR as L,Os as R,tw as S,Dh as V,iw as a,yR as b,dR as h,ye as t,ew as u};
