const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebGPURenderer-BGO3OiQn.js","assets/index-DGv966ue.js","assets/index-DH5LQSzF.css","assets/colorToUniform-KTpA7KSL.js","assets/SharedSystems-Bjp2acED.js","assets/Graphics-COuanShy.js","assets/levelEditorSlice-D5w0pLeb.js","assets/WebGLRenderer-CpQ7xynC.js","assets/JsonRoomEditor-BF7Hwxx1.js","assets/JsonRoomEditor-Cpm53wG5.css"])))=>i.map(i=>d[i]);
import{a6 as Ca,a5 as fn,a7 as Et,s as vm,x as ud,y as Tt,e as Pa,E as Fn,a as wm,C as te,d as Un,v as Hn,Z as G,D as Ni,az as Ht,k as bm,K as pn,t as kt,T as Vr,U as xm,M as _m,aA as Kr,V as dd,aB as Sm,w as Mi,aC as km,aD as Cm,j as Pm,aE as xr,aF as f,aG as hd,aH as Wt,aI as m,aJ as Am,aK as fd,aL as Em,aM as Tm,aN as le,aO as Xe,aP as pd,aQ as Rm,aR as Im,aS as L,aT as Be,aU as mn,al as Om,aV as jm,aW as $m,aX as md,aY as gd,ae as fe,aZ as zm,ai as fr,aa as W,a_ as yd,a$ as Pe,b0 as ds,b1 as ur,ag as rn,b2 as eo,an as gn,b3 as Nm,b4 as Mm,b5 as Dm,ab as gt,ac as Yo,ao as Gt,ad as dr,b6 as vd,b7 as He,b8 as Lm,af as Bm,b9 as _r,ap as wd,at as bd,ba as Zo,bb as Rt,bc as Fm,bd as Um,av as hs,be as Aa,bf as Ea,bg as Mn,bh as xd,ar as Ta,bi as Ra,bj as Hm,as as _d,bk as Wm,bl as Jt,ah as Gm,bm as qm,bn as Ia,bo as Mo,bp as Sl,bq as Vm,br as Km,bs as Xm,bt as Oa,bu as Jm,au as Di,bv as Ym,bw as Zm,bx as Qm,by as eg,bz as tg,bA as rg,bB as ng,bC as og,bD as sg,bE as ig,bF as ag,bG as lg}from"./index-DGv966ue.js";import{r as cg,u as me,d as ug,c as dg,s as cr,a as nn,b as hg,e as kl,f as fg,g as pg,h as mg,i as gg,j as yg,k as vg,l as wg,m as on,n as bg,o as xg,p as Sd,q as $s,t as kd,v as _g,w as Sg,x as kg,y as Cg,z as Pg,A as Ce,B as Ag,C as Eg,D as Tg,E as ja,F as Rg,G as sn,H as Ig,I as Og,J as jg,K as Cd,L as Pd,M as Li,N as to,O as Ad,P as $a,Q as za,R as Ed,S as Td,T as $g,U as Cl,V as Rd,W as zg,X as Ng,Y as Mg,Z as Id,_ as Od,$ as Dg,a0 as zs,a1 as Lg,a2 as Pl,a3 as jd,a4 as Bi,a5 as $d,a6 as Bg,a7 as Fg,a8 as zd}from"./levelEditorSlice-D5w0pLeb.js";import{S as Ug,G as ut}from"./Graphics-COuanShy.js";function Hg(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function Wg(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function Gg(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(r=>typeof r=="function")){const r=t.map(n=>typeof n=="function"?`function ${n.name||"unnamed"}()`:typeof n).join(", ");throw new TypeError(`${e}[${r}]`)}}var Al=t=>Array.isArray(t)?t:[t];function qg(t){const e=Array.isArray(t[0])?t[0]:t;return Gg(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function Vg(t,e){const r=[],{length:n}=t;for(let o=0;o<n;o++)r.push(t[o].apply(null,e));return r}var Kg=class{constructor(t){this.value=t}deref(){return this.value}},Xg=typeof WeakRef<"u"?WeakRef:Kg,Jg=0,El=1;function ho(){return{s:Jg,v:void 0,o:null,p:null}}function Nd(t,e={}){let r=ho();const{resultEqualityCheck:n}=e;let o,s=0;function i(){let a=r;const{length:l}=arguments;for(let d=0,h=l;d<h;d++){const p=arguments[d];if(typeof p=="function"||typeof p=="object"&&p!==null){let y=a.o;y===null&&(a.o=y=new WeakMap);const g=y.get(p);g===void 0?(a=ho(),y.set(p,a)):a=g}else{let y=a.p;y===null&&(a.p=y=new Map);const g=y.get(p);g===void 0?(a=ho(),y.set(p,a)):a=g}}const c=a;let u;if(a.s===El)u=a.v;else if(u=t.apply(null,arguments),s++,n){const d=o?.deref?.()??o;d!=null&&n(d,u)&&(u=d,s!==0&&s--),o=typeof u=="object"&&u!==null||typeof u=="function"?new Xg(u):u}return c.s=El,c.v=u,u}return i.clearCache=()=>{r=ho(),i.resetResultsCount()},i.resultsCount=()=>s,i.resetResultsCount=()=>{s=0},i}function Yg(t,...e){const r=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,n=(...o)=>{let s=0,i=0,a,l={},c=o.pop();typeof c=="object"&&(l=c,c=o.pop()),Hg(c,`createSelector expects an output function after the inputs, but received: [${typeof c}]`);const u={...r,...l},{memoize:d,memoizeOptions:h=[],argsMemoize:p=Nd,argsMemoizeOptions:y=[]}=u,g=Al(h),v=Al(y),w=qg(o),_=d(function(){return s++,c.apply(null,arguments)},...g),b=p(function(){i++;const k=Vg(w,arguments);return a=_.apply(null,k),a},...v);return Object.assign(b,{resultFunc:c,memoizedResultFunc:_,dependencies:w,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>a,recomputations:()=>s,resetRecomputations:()=>{s=0},memoize:d,argsMemoize:p})};return Object.assign(n,{withTypes:()=>n}),n}var Md=Yg(Nd),Zg=Object.assign((t,e=Md)=>{Wg(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const r=Object.keys(t),n=r.map(s=>t[s]);return e(n,(...s)=>s.reduce((i,a,l)=>(i[r[l]]=a,i),{}))},{withTypes:()=>Zg}),fo={},Tl;function Dd(){if(Tl)return fo;Tl=1;var t=Ca(),e=t.mark(a);function r(c,u){var d;if(typeof Symbol>"u"||c[Symbol.iterator]==null){if(Array.isArray(c)||(d=n(c))||u){d&&(c=d);var h=0,p=function(){};return{s:p,n:function(){return h>=c.length?{done:!0}:{done:!1,value:c[h++]}},e:function(_){throw _},f:p}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y=!0,g=!1,v;return{s:function(){d=c[Symbol.iterator]()},n:function(){var _=d.next();return y=_.done,_},e:function(_){g=!0,v=_},f:function(){try{!y&&d.return!=null&&d.return()}finally{if(g)throw v}}}}function n(c,u){if(c){if(typeof c=="string")return o(c,u);var d=Object.prototype.toString.call(c).slice(8,-1);if(d==="Object"&&c.constructor&&(d=c.constructor.name),d==="Map"||d==="Set")return Array.from(c);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return o(c,u)}}function o(c,u){(u==null||u>c.length)&&(u=c.length);for(var d=0,h=new Array(u);d<u;d++)h[d]=c[d];return h}var s=fn(),i=s.iterableCurry;function a(c,u){var d,h,p,y;return t.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d=0,h=r(c),v.prev=2,h.s();case 4:if((p=h.n()).done){v.next=10;break}return y=p.value,v.next=8,u(y,d++);case 8:v.next=4;break;case 10:v.next=15;break;case 12:v.prev=12,v.t0=v.catch(2),h.e(v.t0);case 15:return v.prev=15,h.f(),v.finish(15);case 18:case"end":return v.stop()}},e,null,[[2,12,15,18]])}fo.__map=a;var l=i(a);return fo.map=l,fo}var po={},Rl;function Qg(){if(Rl)return po;Rl=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,p=!1,y;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return h=v.done,v},e:function(v){p=!0,y=v},f:function(){try{!h&&c.return!=null&&c.return()}finally{if(p)throw y}}}}function e(a,l){if(a){if(typeof a=="string")return r(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return r(a,l)}}function r(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var n=fn(),o=n.iterableCurry;function s(a,l){var c=0,u=t(a),d;try{for(u.s();!(d=u.n()).done;){var h=d.value;if(l(h,c++))return!0}}catch(p){u.e(p)}finally{u.f()}return!1}po.__some=s;var i=o(s,{reduces:!0});return po.some=i,po}var mo={},Il;function ey(){if(Il)return mo;Il=1;var t=Ca(),e=t.mark(s),r=fn(),n=r.wrapWithIterableIterator,o=r.ensureIterable;function s(){var a,l,c,u,d,h,p=arguments;return t.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:for(a=p.length,l=new Array(a),c=0;c<a;c++)l[c]=p[c];u=0,d=l;case 2:if(!(u<d.length)){g.next=8;break}return h=d[u],g.delegateYield(o(h),"t0",5);case 5:u++,g.next=2;break;case 8:case"end":return g.stop()}},e)}mo.__concat=s;var i=n(s);return mo.concat=i,mo}var go={},Ol;function ty(){if(Ol)return go;Ol=1;var t=Ca(),e=t.mark(c);function r(d,h){var p;if(typeof Symbol>"u"||d[Symbol.iterator]==null){if(Array.isArray(d)||(p=n(d))||h){p&&(d=p);var y=0,g=function(){};return{s:g,n:function(){return y>=d.length?{done:!0}:{done:!1,value:d[y++]}},e:function(x){throw x},f:g}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,w=!1,_;return{s:function(){p=d[Symbol.iterator]()},n:function(){var x=p.next();return v=x.done,x},e:function(x){w=!0,_=x},f:function(){try{!v&&p.return!=null&&p.return()}finally{if(w)throw _}}}}function n(d,h){if(d){if(typeof d=="string")return o(d,h);var p=Object.prototype.toString.call(d).slice(8,-1);if(p==="Object"&&d.constructor&&(p=d.constructor.name),p==="Map"||p==="Set")return Array.from(d);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return o(d,h)}}function o(d,h){(h==null||h>d.length)&&(h=d.length);for(var p=0,y=new Array(h);p<h;p++)y[p]=d[p];return y}var s=fn(),i=s.iterableCurry,a=Dd(),l=a.__map;function c(d,h){var p,y,g;return t.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:p=r(l(d,h)),w.prev=1,p.s();case 3:if((y=p.n()).done){w.next=8;break}return g=y.value,w.delegateYield(g,"t0",6);case 6:w.next=3;break;case 8:w.next=13;break;case 10:w.prev=10,w.t1=w.catch(1),p.e(w.t1);case 13:return w.prev=13,p.f(),w.finish(13);case 16:case"end":return w.stop()}},e,null,[[1,10,13,16]])}go.__flatMap=c;var u=i(c);return go.flatMap=u,go}var yo={},jl;function ry(){if(jl)return yo;jl=1;var t=fn(),e=t.iterableCurry,r=cg(),n=r.__firstOr,o=Symbol("none");function s(a){return n(a,o)===o}yo.__isEmpty=s;var i=e(s,{reduces:!0});return yo.isEmpty=i,yo}var vo={},$l;function ny(){if($l)return vo;$l=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,p=!1,y;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return h=v.done,v},e:function(v){p=!0,y=v},f:function(){try{!h&&c.return!=null&&c.return()}finally{if(p)throw y}}}}function e(a,l){if(a){if(typeof a=="string")return r(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return r(a,l)}}function r(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var n=fn(),o=n.ensureIterable;function s(a){var l=o(a),c=0,u=t(l),d;try{for(u.s();!(d=u.n()).done;){var h=d.value;c++}}catch(p){u.e(p)}finally{u.f()}return c}vo.__size=s;var i=s;return vo.size=i,vo}var Ns,zl;function oy(){return zl||(zl=1,Ns=ey().concat),Ns}var sy=oy();const Nl=Et(sy);var Ms,Ml;function iy(){return Ml||(Ml=1,Ms=ty().flatMap),Ms}var ay=iy();const ly=Et(ay);var Ds,Dl;function cy(){return Dl||(Dl=1,Ds=ry().isEmpty),Ds}var uy=cy();const Ld=Et(uy);var Ls,Ll;function dy(){return Ll||(Ll=1,Ls=Dd().map),Ls}var hy=dy();const Bl=Et(hy);var Bs={},Fl;function fy(){if(Fl)return Bs;Fl=1;var t=function(n){return n};function e(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return n.length||(n=[t]),n.reduce(function(s,i){return function(){return i(s.apply(void 0,arguments))}})}return Bs.pipe=e,Bs}var Fs,Ul;function py(){return Ul||(Ul=1,Fs=fy().pipe),Fs}var my=py();const Hl=Et(my);var Us,Wl;function gy(){return Wl||(Wl=1,Us=ny().size),Us}var yy=gy();const Bd=Et(yy);var Hs,Gl;function vy(){return Gl||(Gl=1,Hs=Qg().some),Hs}var wy=vy();const by=Et(wy),Fd=class Fi extends vm{constructor(e){e={...Fi.defaultOptions,...e},super(e),this.enabled=!0,this._state=Ug.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(e,r,n,o){e.applyFilter(this,r,n,o)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:r,gl:n,...o}=e;let s,i;return r&&(s=ud.from(r)),n&&(i=Tt.from(n)),new Fi({gpuProgram:s,glProgram:i,...o})}};Fd.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let Yt=Fd;const Ui=[];Pa.handleByNamedList(Fn.Environment,Ui);async function xy(t){if(!t)for(let e=0;e<Ui.length;e++){const r=Ui[e];if(r.value.test()){await r.value.load();return}}}let Sn;function _y(){if(typeof Sn=="boolean")return Sn;try{Sn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Sn=!1}return Sn}var Ud=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(Ud||{});class Sy{constructor(e){this.items=[],this._name=e}emit(e,r,n,o,s,i,a,l){const{name:c,items:u}=this;for(let d=0,h=u.length;d<h;d++)u[d][c](e,r,n,o,s,i,a,l);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const r=this.items.indexOf(e);return r!==-1&&this.items.splice(r,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const ky=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Hd=class Wd extends wm{constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;const r=[...ky,...this.config.runners??[]];this._addRunners(...r),this._unsafeEvalCheck()}async init(e={}){const r=e.skipExtensionImports===!0?!0:e.manageImports===!1;await xy(r),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const n in this._systemsHash)e={...this._systemsHash[n].constructor.defaultOptions,...e};e={...Wd.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let n=0;n<this.runners.init.items.length;n++)await this.runners.init.items[n].init(e);this._initOptions=e}render(e,r){let n=e;if(n instanceof te&&(n={container:n},r&&(Un(Hn,"passing a second argument is deprecated, please use render options instead"),n.target=r.renderTexture)),n.target||(n.target=this.view.renderTarget),n.target===this.view.renderTarget&&(this._lastObjectRendered=n.container,n.clearColor??(n.clearColor=this.background.colorRgba),n.clear??(n.clear=this.background.clearBeforeRender)),n.clearColor){const o=Array.isArray(n.clearColor)&&n.clearColor.length===4;n.clearColor=o?n.clearColor:G.shared.setValue(n.clearColor).toArray()}n.transform||(n.container.updateLocalTransform(),n.transform=n.container.localTransform),n.container.enableRenderGroup(),this.runners.prerender.emit(n),this.runners.renderStart.emit(n),this.runners.render.emit(n),this.runners.renderEnd.emit(n),this.runners.postrender.emit(n)}resize(e,r,n){const o=this.view.resolution;this.view.resize(e,r,n),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),n!==void 0&&n!==o&&this.runners.resolutionChange.emit(n)}clear(e={}){const r=this;e.target||(e.target=r.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=Ud.ALL);const{clear:n,clearColor:o,target:s}=e;G.shared.setValue(o??this.background.colorRgba),r.renderTarget.clear(s,n,G.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(r=>{this.runners[r]=new Sy(r)})}_addSystems(e){let r;for(r in e){const n=e[r];this._addSystem(n.value,n.name)}}_addSystem(e,r){const n=new e(this);if(this[r])throw new Error(`Whoops! The name "${r}" is already in use`);this[r]=n,this._systemsHash[r]=n;for(const o in this.runners)this.runners[o].add(n);return this}_addPipes(e,r){const n=r.reduce((o,s)=>(o[s.name]=s.value,o),{});e.forEach(o=>{const s=o.value,i=o.name,a=n[i];this.renderPipes[i]=new s(this,a?new a:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(r=>{r.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!_y())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Hd.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Gd=Hd,wo;function Cy(t){return wo!==void 0||(wo=(()=>{const e={stencil:!0,failIfMajorPerformanceCaveat:t??Gd.defaultOptions.failIfMajorPerformanceCaveat};try{if(!Ni.get().getWebGLRenderingContext())return!1;let n=Ni.get().createCanvas().getContext("webgl",e);const o=!!n?.getContextAttributes()?.stencil;if(n){const s=n.getExtension("WEBGL_lose_context");s&&s.loseContext()}return n=null,o}catch{return!1}})()),wo}let bo;async function Py(t={}){return bo!==void 0||(bo=await(async()=>{const e=Ni.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(t)).requestDevice(),!0}catch{return!1}})()),bo}const ql=["webgl","webgpu","canvas"];async function Ay(t){let e=[];t.preference?(e.push(t.preference),ql.forEach(s=>{s!==t.preference&&e.push(s)})):e=ql.slice();let r,n={};for(let s=0;s<e.length;s++){const i=e[s];if(i==="webgpu"&&await Py()){const{WebGPURenderer:a}=await Ht(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-BGO3OiQn.js");return{WebGPURenderer:l}},__vite__mapDeps([0,1,2,3,4,5,6]));r=a,n={...t,...t.webgpu};break}else if(i==="webgl"&&Cy(t.failIfMajorPerformanceCaveat??Gd.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await Ht(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-CpQ7xynC.js");return{WebGLRenderer:l}},__vite__mapDeps([7,1,2,3,4,5,6]));r=a,n={...t,...t.webgl};break}else if(i==="canvas")throw n={...t},new Error("CanvasRenderer is not yet implemented")}if(delete n.webgpu,delete n.webgl,!r)throw new Error("No available renderer for the current environment");const o=new r;return await o.init(n),o}const qd="8.8.1";class Vd{static init(){globalThis.__PIXI_APP_INIT__?.(this,qd)}static destroy(){}}Vd.extension=Fn.Application;class Ey{constructor(e){this._renderer=e}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,qd)}destroy(){this._renderer=null}}Ey.extension={type:[Fn.WebGLSystem,Fn.WebGPUSystem],name:"initHook",priority:-10};const Kd=class Hi{constructor(...e){this.stage=new te,e[0]!==void 0&&Un(Hn,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await Ay(e),Hi._plugins.forEach(r=>{r.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return Un(Hn,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,r=!1){const n=Hi._plugins.slice(0);n.reverse(),n.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(r),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Kd._plugins=[];let Xd=Kd;Pa.handleByList(Fn.Application,Xd._plugins);Pa.add(Vd);var Ty=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Ry=`
in vec2 vTextureCoord;

out vec4 finalColor;

uniform float uAlpha;
uniform sampler2D uTexture;

void main()
{
    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;
}
`,Vl=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
 
    var sample = textureSample(uTexture, uSampler, uv);
    
    return sample * alphaUniforms.uAlpha;
}`;const Jd=class Yd extends Yt{constructor(e){e={...Yd.defaultOptions,...e};const r=ud.from({vertex:{source:Vl,entryPoint:"mainVertex"},fragment:{source:Vl,entryPoint:"mainFragment"}}),n=Tt.from({vertex:Ty,fragment:Ry,name:"alpha-filter"}),{alpha:o,...s}=e,i=new bm({uAlpha:{value:o,type:"f32"}});super({...s,gpuProgram:r,glProgram:n,resources:{alphaUniforms:i}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(e){this.resources.alphaUniforms.uniforms.uAlpha=e}};Jd.defaultOptions={alpha:1};let Iy=Jd;class Wn extends pn{constructor(...e){let r=e[0];Array.isArray(e[0])&&(r={textures:e[0],autoUpdate:e[1]});const{animationSpeed:n=1,autoPlay:o=!1,autoUpdate:s=!0,loop:i=!0,onComplete:a=null,onFrameChange:l=null,onLoop:c=null,textures:u,updateAnchor:d=!1,...h}=r,[p]=u;super({...h,texture:p instanceof kt?p:p.texture}),this._textures=null,this._durations=null,this._autoUpdate=s,this._isConnectedToTicker=!1,this.animationSpeed=n,this.loop=i,this.updateAnchor=d,this.onComplete=a,this.onFrameChange=l,this.onLoop=c,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=u,o&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Vr.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Vr.shared.add(this.update,this,xm.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const r=e.deltaTime,n=this.animationSpeed*r,o=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=n/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*r);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=n;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o||this.animationSpeed<0&&this.currentFrame>o)&&this.onLoop(),this._updateTexture())}_updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const r=[];for(let n=0;n<e.length;++n)r.push(kt.from(e[n]));return new Wn(r)}static fromImages(e){const r=[];for(let n=0;n<e.length;++n)r.push(kt.from(e[n]));return new Wn(r)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof kt)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let r=0;r<e.length;r++)this._textures.push(e[r].texture),this._durations.push(e[r].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const r=this.currentFrame;this._currentTime=e,r!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Vr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Vr.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class Oy{constructor({matrix:e,observer:r}={}){this.dirty=!0,this._matrix=e??new _m,this.observer=r,this.position=new Kr(this,0,0),this.scale=new Kr(this,1,1),this.pivot=new Kr(this,0,0),this.skew=new Kr(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}_onUpdate(e){this.dirty=!0,e===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}}const Zd=class Do extends dd{constructor(...e){let r=e[0]||{};r instanceof kt&&(r={texture:r}),e.length>1&&(Un(Hn,"use new TilingSprite({ texture, width:100, height:100 }) instead"),r.width=e[1],r.height=e[2]),r={...Do.defaultOptions,...r};const{texture:n,anchor:o,tilePosition:s,tileScale:i,tileRotation:a,width:l,height:c,applyAnchorToTexture:u,roundPixels:d,...h}=r??{};super({label:"TilingSprite",...h}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new Kr({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=u,this.texture=n,this._width=l??n.width,this._height=c??n.height,this._tileTransform=new Oy({observer:{_onUpdate:()=>this.onViewUpdate()}}),o&&(this.anchor=o),this.tilePosition=s,this.tileScale=i,this.tileRotation=a,this.roundPixels=d??!1}static from(e,r={}){return typeof e=="string"?new Do({texture:Sm.get(e),...r}):new Do({texture:e,...r})}get uvRespectAnchor(){return Mi("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){Mi("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){typeof e=="number"?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=kt.EMPTY);const r=this._texture;r!==e&&(r&&r.dynamic&&r.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,r){typeof e=="object"&&(r=e.height??e.width,e=e.width),this._width=e,this._height=r??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){const e=this._bounds,r=this._anchor,n=this._width,o=this._height;e.minX=-r._x*n,e.maxX=e.minX+n,e.minY=-r._y*o,e.maxY=e.minY+o}containsPoint(e){const r=this._width,n=this._height,o=-r*this._anchor._x;let s=0;return e.x>=o&&e.x<=o+r&&(s=-n*this._anchor._y,e.y>=s&&e.y<=s+n)}destroy(e=!1){if(super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof e=="boolean"?e:e?.texture){const n=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(n)}this._texture=null}};Zd.defaultOptions={texture:kt.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let jy=Zd;class $y extends dd{constructor(e,r){const{text:n,resolution:o,style:s,anchor:i,width:a,height:l,roundPixels:c,...u}=e;super({...u}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=r,this.text=n??"",this.style=s,this.resolution=o??null,this.allowChildren=!1,this._anchor=new Kr({_onUpdate:()=>{this.onViewUpdate()}}),i&&(this.anchor=i),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){e||(e={}),this._style?.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,r){typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,this.bounds.width),r!==void 0&&this._setHeight(r,this.bounds.height)}containsPoint(e){const r=this.bounds.width,n=this.bounds.height,o=-r*this.anchor.x;let s=0;return e.x>=o&&e.x<=o+r&&(s=-n*this.anchor.y,e.y>=s&&e.y<=s+n)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e?.style)&&this._style.destroy(e),this._style=null,this._text=null}}function zy(t,e){let r=t[0]??{};return(typeof r=="string"||t[1])&&(Un(Hn,`use new ${e}({ text: "hi!", style }) instead`),r={text:r,style:t[1]}),r}class Ny extends $y{constructor(...e){const r=zy(e,"Text");super(r,km),this.renderPipeId="text"}updateBounds(){const e=this._bounds,r=this._anchor,n=Cm.measureText(this._text,this._style),{width:o,height:s}=n;e.minX=-r._x*o,e.maxX=e.minX+o,e.minY=-r._y*s,e.maxY=e.minY+s}}class Na extends kt{static create(e){return new Na({source:new Pm(e)})}resize(e,r,n){return this.source.resize(e,r,n),this}}const Qd=class eh extends te{constructor(e={}){e={...eh.defaultOptions,...e},super(),this.renderLayerChildren=[],this.sortableChildren=e.sortableChildren,this.sortFunction=e.sortFunction}attach(...e){for(let r=0;r<e.length;r++){const n=e[r];if(n.parentRenderLayer){if(n.parentRenderLayer===this)continue;n.parentRenderLayer.detach(n)}this.renderLayerChildren.push(n),n.parentRenderLayer=this;const o=this.renderGroup||this.parentRenderGroup;o&&(o.structureDidChange=!0)}return e[0]}detach(...e){for(let r=0;r<e.length;r++){const n=e[r],o=this.renderLayerChildren.indexOf(n);o!==-1&&this.renderLayerChildren.splice(o,1),n.parentRenderLayer=null;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)}return e[0]}detachAll(){const e=this.renderLayerChildren;for(let r=0;r<e.length;r++)e[r].parentRenderLayer=null;this.renderLayerChildren.length=0}collectRenderables(e,r,n){const o=this.renderLayerChildren,s=o.length;this.sortableChildren&&this.sortRenderLayerChildren();for(let i=0;i<s;i++)o[i].parent||Mi("Container must be added to both layer and scene graph. Layers only handle render order - the scene graph is required for transforms (addChild)",o[i]),o[i].collectRenderables(e,r,this)}sortRenderLayerChildren(){this.renderLayerChildren.sort(this.sortFunction)}_getGlobalBoundsRecursive(e,r,n){if(!e)return;const o=this.renderLayerChildren;for(let s=0;s<o.length;s++)o[s]._getGlobalBoundsRecursive(!0,r,this)}};Qd.defaultOptions={sortableChildren:!1,sortFunction:(t,e)=>t.zIndex-e.zIndex};let My=Qd;const Kl=My,Ma="-",Dy=t=>{const e=By(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:i=>{const a=i.split(Ma);return a[0]===""&&a.length!==1&&a.shift(),th(a,e)||Ly(i)},getConflictingClassGroupIds:(i,a)=>{const l=r[i]||[];return a&&n[i]?[...l,...n[i]]:l}}},th=(t,e)=>{if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),o=n?th(t.slice(1),n):void 0;if(o)return o;if(e.validators.length===0)return;const s=t.join(Ma);return e.validators.find(({validator:i})=>i(s))?.classGroupId},Xl=/^\[(.+)\]$/,Ly=t=>{if(Xl.test(t)){const e=Xl.exec(t)[1],r=e?.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},By=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return Uy(Object.entries(t.classGroups),r).forEach(([s,i])=>{Wi(i,n,s,e)}),n},Wi=(t,e,r,n)=>{t.forEach(o=>{if(typeof o=="string"){const s=o===""?e:Jl(e,o);s.classGroupId=r;return}if(typeof o=="function"){if(Fy(o)){Wi(o(n),e,r,n);return}e.validators.push({validator:o,classGroupId:r});return}Object.entries(o).forEach(([s,i])=>{Wi(i,Jl(e,s),r,n)})})},Jl=(t,e)=>{let r=t;return e.split(Ma).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},Fy=t=>t.isThemeGetter,Uy=(t,e)=>e?t.map(([r,n])=>{const o=n.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([i,a])=>[e+i,a])):s);return[r,o]}):t,Hy=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const o=(s,i)=>{r.set(s,i),e++,e>t&&(e=0,n=r,r=new Map)};return{get(s){let i=r.get(s);if(i!==void 0)return i;if((i=n.get(s))!==void 0)return o(s,i),i},set(s,i){r.has(s)?r.set(s,i):o(s,i)}}},rh="!",Wy=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,o=e[0],s=e.length,i=a=>{const l=[];let c=0,u=0,d;for(let v=0;v<a.length;v++){let w=a[v];if(c===0){if(w===o&&(n||a.slice(v,v+s)===e)){l.push(a.slice(u,v)),u=v+s;continue}if(w==="/"){d=v;continue}}w==="["?c++:w==="]"&&c--}const h=l.length===0?a:a.substring(u),p=h.startsWith(rh),y=p?h.substring(1):h,g=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:p,baseClassName:y,maybePostfixModifierPosition:g}};return r?a=>r({className:a,parseClassName:i}):i},Gy=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},qy=t=>({cache:Hy(t.cacheSize),parseClassName:Wy(t),...Dy(t)}),Vy=/\s+/,Ky=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:o}=e,s=[],i=t.trim().split(Vy);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:p}=r(c);let y=!!p,g=n(y?h.substring(0,p):h);if(!g){if(!y){a=c+(a.length>0?" "+a:a);continue}if(g=n(h),!g){a=c+(a.length>0?" "+a:a);continue}y=!1}const v=Gy(u).join(":"),w=d?v+rh:v,_=w+g;if(s.includes(_))continue;s.push(_);const b=o(g,y);for(let x=0;x<b.length;++x){const k=b[x];s.push(w+k)}a=c+(a.length>0?" "+a:a)}return a};function Xy(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=nh(e))&&(n&&(n+=" "),n+=r);return n}const nh=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=nh(t[n]))&&(r&&(r+=" "),r+=e);return r};function Jy(t,...e){let r,n,o,s=i;function i(l){const c=e.reduce((u,d)=>d(u),t());return r=qy(c),n=r.cache.get,o=r.cache.set,s=a,a(l)}function a(l){const c=n(l);if(c)return c;const u=Ky(l,r);return o(l,u),u}return function(){return s(Xy.apply(null,arguments))}}const he=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},oh=/^\[(?:([a-z-]+):)?(.+)\]$/i,Yy=/^\d+\/\d+$/,Zy=new Set(["px","full","screen"]),Qy=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,ev=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,tv=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,rv=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,nv=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,vt=t=>Zr(t)||Zy.has(t)||Yy.test(t),It=t=>yn(t,"length",dv),Zr=t=>!!t&&!Number.isNaN(Number(t)),Ws=t=>yn(t,"number",Zr),kn=t=>!!t&&Number.isInteger(Number(t)),ov=t=>t.endsWith("%")&&Zr(t.slice(0,-1)),Z=t=>oh.test(t),Ot=t=>Qy.test(t),sv=new Set(["length","size","percentage"]),iv=t=>yn(t,sv,sh),av=t=>yn(t,"position",sh),lv=new Set(["image","url"]),cv=t=>yn(t,lv,fv),uv=t=>yn(t,"",hv),Cn=()=>!0,yn=(t,e,r)=>{const n=oh.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},dv=t=>ev.test(t)&&!tv.test(t),sh=()=>!1,hv=t=>rv.test(t),fv=t=>nv.test(t),pv=()=>{const t=he("colors"),e=he("spacing"),r=he("blur"),n=he("brightness"),o=he("borderColor"),s=he("borderRadius"),i=he("borderSpacing"),a=he("borderWidth"),l=he("contrast"),c=he("grayscale"),u=he("hueRotate"),d=he("invert"),h=he("gap"),p=he("gradientColorStops"),y=he("gradientColorStopPositions"),g=he("inset"),v=he("margin"),w=he("opacity"),_=he("padding"),b=he("saturate"),x=he("scale"),k=he("sepia"),C=he("skew"),S=he("space"),z=he("translate"),K=()=>["auto","contain","none"],D=()=>["auto","hidden","clip","visible","scroll"],q=()=>["auto",Z,e],O=()=>[Z,e],se=()=>["",vt,It],M=()=>["auto",Zr,Z],X=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],V=()=>["solid","dashed","dotted","double","none"],re=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],J=()=>["start","end","center","between","around","evenly","stretch"],ie=()=>["","0",Z],be=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ge=()=>[Zr,Z];return{cacheSize:500,separator:":",theme:{colors:[Cn],spacing:[vt,It],blur:["none","",Ot,Z],brightness:ge(),borderColor:[t],borderRadius:["none","","full",Ot,Z],borderSpacing:O(),borderWidth:se(),contrast:ge(),grayscale:ie(),hueRotate:ge(),invert:ie(),gap:O(),gradientColorStops:[t],gradientColorStopPositions:[ov,It],inset:q(),margin:q(),opacity:ge(),padding:O(),saturate:ge(),scale:ge(),sepia:ie(),skew:ge(),space:O(),translate:O()},classGroups:{aspect:[{aspect:["auto","square","video",Z]}],container:["container"],columns:[{columns:[Ot]}],"break-after":[{"break-after":be()}],"break-before":[{"break-before":be()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...X(),Z]}],overflow:[{overflow:D()}],"overflow-x":[{"overflow-x":D()}],"overflow-y":[{"overflow-y":D()}],overscroll:[{overscroll:K()}],"overscroll-x":[{"overscroll-x":K()}],"overscroll-y":[{"overscroll-y":K()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",kn,Z]}],basis:[{basis:q()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Z]}],grow:[{grow:ie()}],shrink:[{shrink:ie()}],order:[{order:["first","last","none",kn,Z]}],"grid-cols":[{"grid-cols":[Cn]}],"col-start-end":[{col:["auto",{span:["full",kn,Z]},Z]}],"col-start":[{"col-start":M()}],"col-end":[{"col-end":M()}],"grid-rows":[{"grid-rows":[Cn]}],"row-start-end":[{row:["auto",{span:[kn,Z]},Z]}],"row-start":[{"row-start":M()}],"row-end":[{"row-end":M()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Z]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Z]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...J()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...J(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...J(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Z,e]}],"min-w":[{"min-w":[Z,e,"min","max","fit"]}],"max-w":[{"max-w":[Z,e,"none","full","min","max","fit","prose",{screen:[Ot]},Ot]}],h:[{h:[Z,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Z,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Z,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Z,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Ot,It]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ws]}],"font-family":[{font:[Cn]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Z]}],"line-clamp":[{"line-clamp":["none",Zr,Ws]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",vt,Z]}],"list-image":[{"list-image":["none",Z]}],"list-style-type":[{list:["none","disc","decimal",Z]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...V(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",vt,It]}],"underline-offset":[{"underline-offset":["auto",vt,Z]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:O()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Z]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Z]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...X(),av]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",iv]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},cv]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[...V(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:V()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...V()]}],"outline-offset":[{"outline-offset":[vt,Z]}],"outline-w":[{outline:[vt,It]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:se()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[vt,It]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Ot,uv]}],"shadow-color":[{shadow:[Cn]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":[...re(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":re()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Ot,Z]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[b]}],sepia:[{sepia:[k]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[k]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Z]}],duration:[{duration:ge()}],ease:[{ease:["linear","in","out","in-out",Z]}],delay:[{delay:ge()}],animate:[{animate:["none","spin","ping","pulse","bounce",Z]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[x]}],"scale-x":[{"scale-x":[x]}],"scale-y":[{"scale-y":[x]}],rotate:[{rotate:[kn,Z]}],"translate-x":[{"translate-x":[z]}],"translate-y":[{"translate-y":[z]}],"skew-x":[{"skew-x":[C]}],"skew-y":[{"skew-y":[C]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Z]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Z]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":O()}],"scroll-mx":[{"scroll-mx":O()}],"scroll-my":[{"scroll-my":O()}],"scroll-ms":[{"scroll-ms":O()}],"scroll-me":[{"scroll-me":O()}],"scroll-mt":[{"scroll-mt":O()}],"scroll-mr":[{"scroll-mr":O()}],"scroll-mb":[{"scroll-mb":O()}],"scroll-ml":[{"scroll-ml":O()}],"scroll-p":[{"scroll-p":O()}],"scroll-px":[{"scroll-px":O()}],"scroll-py":[{"scroll-py":O()}],"scroll-ps":[{"scroll-ps":O()}],"scroll-pe":[{"scroll-pe":O()}],"scroll-pt":[{"scroll-pt":O()}],"scroll-pr":[{"scroll-pr":O()}],"scroll-pb":[{"scroll-pb":O()}],"scroll-pl":[{"scroll-pl":O()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Z]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[vt,It,Ws]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},ih=Jy(pv);function ah(t){if(!Qo(t))throw new Error(`Invalid textureId: "${t}"; textureId ∋ {${Object.keys(xr.frames).sort().map(e=>`"${e}"`).join(`,
`)}}`)}function Qo(t){return xr.frames[t]!==void 0}function lh(t){return xr.animations[t]!==void 0}const mv=t=>t.replaceAll(".","_"),F=({children:t,className:e,noSlitWords:r,classnameCycle:n,onClick:o,noTint:s=!1,TagName:i="span"})=>{const a=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(a.length===0)return null;const l=r?[a.toUpperCase()]:a.toUpperCase().split(/\s+/);return f.jsxs(i,{className:e,onClick:o,children:[f.jsx("span",{className:"sr-only",children:a}),l.map((c,u)=>f.jsx("span",{className:ih("text-nowrap inline-block",u===l.length-1?"":"me-1"),children:Array.from(c).map((d,h)=>{const p=`hud.char.${hd(d)}`;return Qo(p)||console.error("no texture for char",d,d.charCodeAt(0),p,"we have:",Object.keys(Wt().textures)),f.jsx("span",{className:`sprite ${Qo(p)?`texture-${mv(p)}`:"texture-hud_char_?"}
                  ${s?"":"sprite-tinted"}
                  ${n===void 0?"":n[h%n.length]}`},h)})},u))]})};function We(t,e,{checkForDefaultPrevented:r=!0}={}){return function(o){if(t?.(o),r===!1||!o.defaultPrevented)return e?.(o)}}function Yl(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function ch(...t){return e=>{let r=!1;const n=t.map(o=>{const s=Yl(o,e);return!r&&typeof s=="function"&&(r=!0),s});if(r)return()=>{for(let o=0;o<n.length;o++){const s=n[o];typeof s=="function"?s():Yl(t[o],null)}}}}function st(...t){return m.useCallback(ch(...t),t)}function gv(t,e){const r=m.createContext(e),n=s=>{const{children:i,...a}=s,l=m.useMemo(()=>a,Object.values(a));return f.jsx(r.Provider,{value:l,children:i})};n.displayName=t+"Provider";function o(s){const i=m.useContext(r);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[n,o]}function Da(t,e=[]){let r=[];function n(s,i){const a=m.createContext(i),l=r.length;r=[...r,i];const c=d=>{const{scope:h,children:p,...y}=d,g=h?.[t]?.[l]||a,v=m.useMemo(()=>y,Object.values(y));return f.jsx(g.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(d,h){const p=h?.[t]?.[l]||a,y=m.useContext(p);if(y)return y;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=r.map(i=>m.createContext(i));return function(a){const l=a?.[t]||s;return m.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[n,yv(o,...e)]}function yv(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=n.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return r.scopeName=e.scopeName,r}var La=Am();const vv=Et(La);var fs=m.forwardRef((t,e)=>{const{children:r,...n}=t,o=m.Children.toArray(r),s=o.find(bv);if(s){const i=s.props.children,a=o.map(l=>l===s?m.Children.count(i)>1?m.Children.only(null):m.isValidElement(i)?i.props.children:null:l);return f.jsx(Gi,{...n,ref:e,children:m.isValidElement(i)?m.cloneElement(i,void 0,a):null})}return f.jsx(Gi,{...n,ref:e,children:r})});fs.displayName="Slot";var Gi=m.forwardRef((t,e)=>{const{children:r,...n}=t;if(m.isValidElement(r)){const o=_v(r),s=xv(n,r.props);return r.type!==m.Fragment&&(s.ref=e?ch(e,o):o),m.cloneElement(r,s)}return m.Children.count(r)>1?m.Children.only(null):null});Gi.displayName="SlotClone";var wv=({children:t})=>f.jsx(f.Fragment,{children:t});function bv(t){return m.isValidElement(t)&&t.type===wv}function xv(t,e){const r={...e};for(const n in e){const o=t[n],s=e[n];/^on[A-Z]/.test(n)?o&&s?r[n]=(...a)=>{s(...a),o(...a)}:o&&(r[n]=o):n==="style"?r[n]={...o,...s}:n==="className"&&(r[n]=[o,s].filter(Boolean).join(" "))}return{...t,...r}}function _v(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var Sv=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],we=Sv.reduce((t,e)=>{const r=m.forwardRef((n,o)=>{const{asChild:s,...i}=n,a=s?fs:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),f.jsx(a,{...i,ref:o})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function kv(t,e){t&&La.flushSync(()=>t.dispatchEvent(e))}function qt(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t}),m.useMemo(()=>(...r)=>e.current?.(...r),[])}function Cv(t,e=globalThis?.document){const r=qt(t);m.useEffect(()=>{const n=o=>{o.key==="Escape"&&r(o)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[r,e])}var Pv="DismissableLayer",qi="dismissableLayer.update",Av="dismissableLayer.pointerDownOutside",Ev="dismissableLayer.focusOutside",Zl,uh=m.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ba=m.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=m.useContext(uh),[u,d]=m.useState(null),h=u?.ownerDocument??globalThis?.document,[,p]=m.useState({}),y=st(e,S=>d(S)),g=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),w=g.indexOf(v),_=u?g.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,x=_>=w,k=Iv(S=>{const z=S.target,K=[...c.branches].some(D=>D.contains(z));!x||K||(o?.(S),i?.(S),S.defaultPrevented||a?.())},h),C=Ov(S=>{const z=S.target;[...c.branches].some(D=>D.contains(z))||(s?.(S),i?.(S),S.defaultPrevented||a?.())},h);return Cv(S=>{_===c.layers.size-1&&(n?.(S),!S.defaultPrevented&&a&&(S.preventDefault(),a()))},h),m.useEffect(()=>{if(u)return r&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Zl=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),Ql(),()=>{r&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=Zl)}},[u,h,r,c]),m.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),Ql())},[u,c]),m.useEffect(()=>{const S=()=>p({});return document.addEventListener(qi,S),()=>document.removeEventListener(qi,S)},[]),f.jsx(we.div,{...l,ref:y,style:{pointerEvents:b?x?"auto":"none":void 0,...t.style},onFocusCapture:We(t.onFocusCapture,C.onFocusCapture),onBlurCapture:We(t.onBlurCapture,C.onBlurCapture),onPointerDownCapture:We(t.onPointerDownCapture,k.onPointerDownCapture)})});Ba.displayName=Pv;var Tv="DismissableLayerBranch",Rv=m.forwardRef((t,e)=>{const r=m.useContext(uh),n=m.useRef(null),o=st(e,n);return m.useEffect(()=>{const s=n.current;if(s)return r.branches.add(s),()=>{r.branches.delete(s)}},[r.branches]),f.jsx(we.div,{...t,ref:o})});Rv.displayName=Tv;function Iv(t,e=globalThis?.document){const r=qt(t),n=m.useRef(!1),o=m.useRef(()=>{});return m.useEffect(()=>{const s=a=>{if(a.target&&!n.current){let l=function(){dh(Av,r,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);n.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,r]),{onPointerDownCapture:()=>n.current=!0}}function Ov(t,e=globalThis?.document){const r=qt(t),n=m.useRef(!1);return m.useEffect(()=>{const o=s=>{s.target&&!n.current&&dh(Ev,r,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function Ql(){const t=new CustomEvent(qi);document.dispatchEvent(t)}function dh(t,e,r,{discrete:n}){const o=r.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&o.addEventListener(t,e,{once:!0}),n?kv(o,s):o.dispatchEvent(s)}var Gs=0;function hh(){m.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??ec()),document.body.insertAdjacentElement("beforeend",t[1]??ec()),Gs++,()=>{Gs===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Gs--}},[])}function ec(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var qs="focusScope.autoFocusOnMount",Vs="focusScope.autoFocusOnUnmount",tc={bubbles:!1,cancelable:!0},jv="FocusScope",Fa=m.forwardRef((t,e)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=t,[a,l]=m.useState(null),c=qt(o),u=qt(s),d=m.useRef(null),h=st(e,g=>l(g)),p=m.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;m.useEffect(()=>{if(n){let g=function(b){if(p.paused||!a)return;const x=b.target;a.contains(x)?d.current=x:Mt(d.current,{select:!0})},v=function(b){if(p.paused||!a)return;const x=b.relatedTarget;x!==null&&(a.contains(x)||Mt(d.current,{select:!0}))},w=function(b){if(document.activeElement===document.body)for(const k of b)k.removedNodes.length>0&&Mt(a)};document.addEventListener("focusin",g),document.addEventListener("focusout",v);const _=new MutationObserver(w);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",v),_.disconnect()}}},[n,a,p.paused]),m.useEffect(()=>{if(a){nc.add(p);const g=document.activeElement;if(!a.contains(g)){const w=new CustomEvent(qs,tc);a.addEventListener(qs,c),a.dispatchEvent(w),w.defaultPrevented||($v(Lv(fh(a)),{select:!0}),document.activeElement===g&&Mt(a))}return()=>{a.removeEventListener(qs,c),setTimeout(()=>{const w=new CustomEvent(Vs,tc);a.addEventListener(Vs,u),a.dispatchEvent(w),w.defaultPrevented||Mt(g??document.body,{select:!0}),a.removeEventListener(Vs,u),nc.remove(p)},0)}}},[a,c,u,p]);const y=m.useCallback(g=>{if(!r&&!n||p.paused)return;const v=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,w=document.activeElement;if(v&&w){const _=g.currentTarget,[b,x]=zv(_);b&&x?!g.shiftKey&&w===x?(g.preventDefault(),r&&Mt(b,{select:!0})):g.shiftKey&&w===b&&(g.preventDefault(),r&&Mt(x,{select:!0})):w===_&&g.preventDefault()}},[r,n,p.paused]);return f.jsx(we.div,{tabIndex:-1,...i,ref:h,onKeyDown:y})});Fa.displayName=jv;function $v(t,{select:e=!1}={}){const r=document.activeElement;for(const n of t)if(Mt(n,{select:e}),document.activeElement!==r)return}function zv(t){const e=fh(t),r=rc(e,t),n=rc(e.reverse(),t);return[r,n]}function fh(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const o=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||o?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function rc(t,e){for(const r of t)if(!Nv(r,{upTo:e}))return r}function Nv(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Mv(t){return t instanceof HTMLInputElement&&"select"in t}function Mt(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&Mv(t)&&e&&t.select()}}var nc=Dv();function Dv(){let t=[];return{add(e){const r=t[0];e!==r&&r?.pause(),t=oc(t,e),t.unshift(e)},remove(e){t=oc(t,e),t[0]?.resume()}}}function oc(t,e){const r=[...t],n=r.indexOf(e);return n!==-1&&r.splice(n,1),r}function Lv(t){return t.filter(e=>e.tagName!=="A")}var pr=globalThis?.document?m.useLayoutEffect:()=>{},Bv=fd.useId||(()=>{}),Fv=0;function dt(t){const[e,r]=m.useState(Bv());return pr(()=>{r(n=>n??String(Fv++))},[t]),t||(e?`radix-${e}`:"")}const Uv=["top","right","bottom","left"],Vt=Math.min,Ue=Math.max,es=Math.round,xo=Math.floor,ht=t=>({x:t,y:t}),Hv={left:"right",right:"left",bottom:"top",top:"bottom"},Wv={start:"end",end:"start"};function Vi(t,e,r){return Ue(t,Vt(e,r))}function Pt(t,e){return typeof t=="function"?t(e):t}function At(t){return t.split("-")[0]}function vn(t){return t.split("-")[1]}function Ua(t){return t==="x"?"y":"x"}function Ha(t){return t==="y"?"height":"width"}function Kt(t){return["top","bottom"].includes(At(t))?"y":"x"}function Wa(t){return Ua(Kt(t))}function Gv(t,e,r){r===void 0&&(r=!1);const n=vn(t),o=Wa(t),s=Ha(o);let i=o==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(i=ts(i)),[i,ts(i)]}function qv(t){const e=ts(t);return[Ki(t),e,Ki(e)]}function Ki(t){return t.replace(/start|end/g,e=>Wv[e])}function Vv(t,e,r){const n=["left","right"],o=["right","left"],s=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return r?e?o:n:e?n:o;case"left":case"right":return e?s:i;default:return[]}}function Kv(t,e,r,n){const o=vn(t);let s=Vv(At(t),r==="start",n);return o&&(s=s.map(i=>i+"-"+o),e&&(s=s.concat(s.map(Ki)))),s}function ts(t){return t.replace(/left|right|bottom|top/g,e=>Hv[e])}function Xv(t){return{top:0,right:0,bottom:0,left:0,...t}}function ph(t){return typeof t!="number"?Xv(t):{top:t,right:t,bottom:t,left:t}}function rs(t){const{x:e,y:r,width:n,height:o}=t;return{width:n,height:o,top:r,left:e,right:e+n,bottom:r+o,x:e,y:r}}function sc(t,e,r){let{reference:n,floating:o}=t;const s=Kt(e),i=Wa(e),a=Ha(i),l=At(e),c=s==="y",u=n.x+n.width/2-o.width/2,d=n.y+n.height/2-o.height/2,h=n[a]/2-o[a]/2;let p;switch(l){case"top":p={x:u,y:n.y-o.height};break;case"bottom":p={x:u,y:n.y+n.height};break;case"right":p={x:n.x+n.width,y:d};break;case"left":p={x:n.x-o.width,y:d};break;default:p={x:n.x,y:n.y}}switch(vn(e)){case"start":p[i]-=h*(r&&c?-1:1);break;case"end":p[i]+=h*(r&&c?-1:1);break}return p}const Jv=async(t,e,r)=>{const{placement:n="bottom",strategy:o="absolute",middleware:s=[],platform:i}=r,a=s.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:o}),{x:u,y:d}=sc(c,n,l),h=n,p={},y=0;for(let g=0;g<a.length;g++){const{name:v,fn:w}=a[g],{x:_,y:b,data:x,reset:k}=await w({x:u,y:d,initialPlacement:n,placement:h,strategy:o,middlewareData:p,rects:c,platform:i,elements:{reference:t,floating:e}});u=_??u,d=b??d,p={...p,[v]:{...p[v],...x}},k&&y<=50&&(y++,typeof k=="object"&&(k.placement&&(h=k.placement),k.rects&&(c=k.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:o}):k.rects),{x:u,y:d}=sc(c,h,l)),g=-1)}return{x:u,y:d,placement:h,strategy:o,middlewareData:p}};async function Gn(t,e){var r;e===void 0&&(e={});const{x:n,y:o,platform:s,rects:i,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=Pt(e,t),y=ph(p),v=a[h?d==="floating"?"reference":"floating":d],w=rs(await s.getClippingRect({element:(r=await(s.isElement==null?void 0:s.isElement(v)))==null||r?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),_=d==="floating"?{x:n,y:o,width:i.floating.width,height:i.floating.height}:i.reference,b=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),x=await(s.isElement==null?void 0:s.isElement(b))?await(s.getScale==null?void 0:s.getScale(b))||{x:1,y:1}:{x:1,y:1},k=rs(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:b,strategy:l}):_);return{top:(w.top-k.top+y.top)/x.y,bottom:(k.bottom-w.bottom+y.bottom)/x.y,left:(w.left-k.left+y.left)/x.x,right:(k.right-w.right+y.right)/x.x}}const Yv=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:n,placement:o,rects:s,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Pt(t,e)||{};if(c==null)return{};const d=ph(u),h={x:r,y:n},p=Wa(o),y=Ha(p),g=await i.getDimensions(c),v=p==="y",w=v?"top":"left",_=v?"bottom":"right",b=v?"clientHeight":"clientWidth",x=s.reference[y]+s.reference[p]-h[p]-s.floating[y],k=h[p]-s.reference[p],C=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let S=C?C[b]:0;(!S||!await(i.isElement==null?void 0:i.isElement(C)))&&(S=a.floating[b]||s.floating[y]);const z=x/2-k/2,K=S/2-g[y]/2-1,D=Vt(d[w],K),q=Vt(d[_],K),O=D,se=S-g[y]-q,M=S/2-g[y]/2+z,X=Vi(O,M,se),V=!l.arrow&&vn(o)!=null&&M!==X&&s.reference[y]/2-(M<O?D:q)-g[y]/2<0,re=V?M<O?M-O:M-se:0;return{[p]:h[p]+re,data:{[p]:X,centerOffset:M-X-re,...V&&{alignmentOffset:re}},reset:V}}}),Zv=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,n;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:g=!0,...v}=Pt(t,e);if((r=s.arrow)!=null&&r.alignmentOffset)return{};const w=At(o),_=Kt(a),b=At(a)===a,x=await(l.isRTL==null?void 0:l.isRTL(c.floating)),k=h||(b||!g?[ts(a)]:qv(a)),C=y!=="none";!h&&C&&k.push(...Kv(a,g,y,x));const S=[a,...k],z=await Gn(e,v),K=[];let D=((n=s.flip)==null?void 0:n.overflows)||[];if(u&&K.push(z[w]),d){const M=Gv(o,i,x);K.push(z[M[0]],z[M[1]])}if(D=[...D,{placement:o,overflows:K}],!K.every(M=>M<=0)){var q,O;const M=(((q=s.flip)==null?void 0:q.index)||0)+1,X=S[M];if(X)return{data:{index:M,overflows:D},reset:{placement:X}};let V=(O=D.filter(re=>re.overflows[0]<=0).sort((re,J)=>re.overflows[1]-J.overflows[1])[0])==null?void 0:O.placement;if(!V)switch(p){case"bestFit":{var se;const re=(se=D.filter(J=>{if(C){const ie=Kt(J.placement);return ie===_||ie==="y"}return!0}).map(J=>[J.placement,J.overflows.filter(ie=>ie>0).reduce((ie,be)=>ie+be,0)]).sort((J,ie)=>J[1]-ie[1])[0])==null?void 0:se[0];re&&(V=re);break}case"initialPlacement":V=a;break}if(o!==V)return{reset:{placement:V}}}return{}}}};function ic(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function ac(t){return Uv.some(e=>t[e]>=0)}const Qv=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:n="referenceHidden",...o}=Pt(t,e);switch(n){case"referenceHidden":{const s=await Gn(e,{...o,elementContext:"reference"}),i=ic(s,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:ac(i)}}}case"escaped":{const s=await Gn(e,{...o,altBoundary:!0}),i=ic(s,r.floating);return{data:{escapedOffsets:i,escaped:ac(i)}}}default:return{}}}}};async function ew(t,e){const{placement:r,platform:n,elements:o}=t,s=await(n.isRTL==null?void 0:n.isRTL(o.floating)),i=At(r),a=vn(r),l=Kt(r)==="y",c=["left","top"].includes(i)?-1:1,u=s&&l?-1:1,d=Pt(e,t);let{mainAxis:h,crossAxis:p,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof y=="number"&&(p=a==="end"?y*-1:y),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}const tw=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,n;const{x:o,y:s,placement:i,middlewareData:a}=e,l=await ew(e,t);return i===((r=a.offset)==null?void 0:r.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:o+l.x,y:s+l.y,data:{...l,placement:i}}}}},rw=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:n,placement:o}=e,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:v=>{let{x:w,y:_}=v;return{x:w,y:_}}},...l}=Pt(t,e),c={x:r,y:n},u=await Gn(e,l),d=Kt(At(o)),h=Ua(d);let p=c[h],y=c[d];if(s){const v=h==="y"?"top":"left",w=h==="y"?"bottom":"right",_=p+u[v],b=p-u[w];p=Vi(_,p,b)}if(i){const v=d==="y"?"top":"left",w=d==="y"?"bottom":"right",_=y+u[v],b=y-u[w];y=Vi(_,y,b)}const g=a.fn({...e,[h]:p,[d]:y});return{...g,data:{x:g.x-r,y:g.y-n,enabled:{[h]:s,[d]:i}}}}}},nw=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:n,placement:o,rects:s,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Pt(t,e),u={x:r,y:n},d=Kt(o),h=Ua(d);let p=u[h],y=u[d];const g=Pt(a,e),v=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const b=h==="y"?"height":"width",x=s.reference[h]-s.floating[b]+v.mainAxis,k=s.reference[h]+s.reference[b]-v.mainAxis;p<x?p=x:p>k&&(p=k)}if(c){var w,_;const b=h==="y"?"width":"height",x=["top","left"].includes(At(o)),k=s.reference[d]-s.floating[b]+(x&&((w=i.offset)==null?void 0:w[d])||0)+(x?0:v.crossAxis),C=s.reference[d]+s.reference[b]+(x?0:((_=i.offset)==null?void 0:_[d])||0)-(x?v.crossAxis:0);y<k?y=k:y>C&&(y=C)}return{[h]:p,[d]:y}}}},ow=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var r,n;const{placement:o,rects:s,platform:i,elements:a}=e,{apply:l=()=>{},...c}=Pt(t,e),u=await Gn(e,c),d=At(o),h=vn(o),p=Kt(o)==="y",{width:y,height:g}=s.floating;let v,w;d==="top"||d==="bottom"?(v=d,w=h===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(w=d,v=h==="end"?"top":"bottom");const _=g-u.top-u.bottom,b=y-u.left-u.right,x=Vt(g-u[v],_),k=Vt(y-u[w],b),C=!e.middlewareData.shift;let S=x,z=k;if((r=e.middlewareData.shift)!=null&&r.enabled.x&&(z=b),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(S=_),C&&!h){const D=Ue(u.left,0),q=Ue(u.right,0),O=Ue(u.top,0),se=Ue(u.bottom,0);p?z=y-2*(D!==0||q!==0?D+q:Ue(u.left,u.right)):S=g-2*(O!==0||se!==0?O+se:Ue(u.top,u.bottom))}await l({...e,availableWidth:z,availableHeight:S});const K=await i.getDimensions(a.floating);return y!==K.width||g!==K.height?{reset:{rects:!0}}:{}}}};function ps(){return typeof window<"u"}function wn(t){return mh(t)?(t.nodeName||"").toLowerCase():"#document"}function Ge(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function yt(t){var e;return(e=(mh(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function mh(t){return ps()?t instanceof Node||t instanceof Ge(t).Node:!1}function nt(t){return ps()?t instanceof Element||t instanceof Ge(t).Element:!1}function ft(t){return ps()?t instanceof HTMLElement||t instanceof Ge(t).HTMLElement:!1}function lc(t){return!ps()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Ge(t).ShadowRoot}function ro(t){const{overflow:e,overflowX:r,overflowY:n,display:o}=ot(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+r)&&!["inline","contents"].includes(o)}function sw(t){return["table","td","th"].includes(wn(t))}function ms(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function Ga(t){const e=qa(),r=nt(t)?ot(t):t;return["transform","translate","scale","rotate","perspective"].some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(n=>(r.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(r.contain||"").includes(n))}function iw(t){let e=Xt(t);for(;ft(e)&&!an(e);){if(Ga(e))return e;if(ms(e))return null;e=Xt(e)}return null}function qa(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function an(t){return["html","body","#document"].includes(wn(t))}function ot(t){return Ge(t).getComputedStyle(t)}function gs(t){return nt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Xt(t){if(wn(t)==="html")return t;const e=t.assignedSlot||t.parentNode||lc(t)&&t.host||yt(t);return lc(e)?e.host:e}function gh(t){const e=Xt(t);return an(e)?t.ownerDocument?t.ownerDocument.body:t.body:ft(e)&&ro(e)?e:gh(e)}function qn(t,e,r){var n;e===void 0&&(e=[]),r===void 0&&(r=!0);const o=gh(t),s=o===((n=t.ownerDocument)==null?void 0:n.body),i=Ge(o);if(s){const a=Xi(i);return e.concat(i,i.visualViewport||[],ro(o)?o:[],a&&r?qn(a):[])}return e.concat(o,qn(o,[],r))}function Xi(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function yh(t){const e=ot(t);let r=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const o=ft(t),s=o?t.offsetWidth:r,i=o?t.offsetHeight:n,a=es(r)!==s||es(n)!==i;return a&&(r=s,n=i),{width:r,height:n,$:a}}function Va(t){return nt(t)?t:t.contextElement}function Qr(t){const e=Va(t);if(!ft(e))return ht(1);const r=e.getBoundingClientRect(),{width:n,height:o,$:s}=yh(e);let i=(s?es(r.width):r.width)/n,a=(s?es(r.height):r.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const aw=ht(0);function vh(t){const e=Ge(t);return!qa()||!e.visualViewport?aw:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function lw(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==Ge(t)?!1:e}function mr(t,e,r,n){e===void 0&&(e=!1),r===void 0&&(r=!1);const o=t.getBoundingClientRect(),s=Va(t);let i=ht(1);e&&(n?nt(n)&&(i=Qr(n)):i=Qr(t));const a=lw(s,r,n)?vh(s):ht(0);let l=(o.left+a.x)/i.x,c=(o.top+a.y)/i.y,u=o.width/i.x,d=o.height/i.y;if(s){const h=Ge(s),p=n&&nt(n)?Ge(n):n;let y=h,g=Xi(y);for(;g&&n&&p!==y;){const v=Qr(g),w=g.getBoundingClientRect(),_=ot(g),b=w.left+(g.clientLeft+parseFloat(_.paddingLeft))*v.x,x=w.top+(g.clientTop+parseFloat(_.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,d*=v.y,l+=b,c+=x,y=Ge(g),g=Xi(y)}}return rs({width:u,height:d,x:l,y:c})}function Ka(t,e){const r=gs(t).scrollLeft;return e?e.left+r:mr(yt(t)).left+r}function wh(t,e,r){r===void 0&&(r=!1);const n=t.getBoundingClientRect(),o=n.left+e.scrollLeft-(r?0:Ka(t,n)),s=n.top+e.scrollTop;return{x:o,y:s}}function cw(t){let{elements:e,rect:r,offsetParent:n,strategy:o}=t;const s=o==="fixed",i=yt(n),a=e?ms(e.floating):!1;if(n===i||a&&s)return r;let l={scrollLeft:0,scrollTop:0},c=ht(1);const u=ht(0),d=ft(n);if((d||!d&&!s)&&((wn(n)!=="body"||ro(i))&&(l=gs(n)),ft(n))){const p=mr(n);c=Qr(n),u.x=p.x+n.clientLeft,u.y=p.y+n.clientTop}const h=i&&!d&&!s?wh(i,l,!0):ht(0);return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:r.y*c.y-l.scrollTop*c.y+u.y+h.y}}function uw(t){return Array.from(t.getClientRects())}function dw(t){const e=yt(t),r=gs(t),n=t.ownerDocument.body,o=Ue(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),s=Ue(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+Ka(t);const a=-r.scrollTop;return ot(n).direction==="rtl"&&(i+=Ue(e.clientWidth,n.clientWidth)-o),{width:o,height:s,x:i,y:a}}function hw(t,e){const r=Ge(t),n=yt(t),o=r.visualViewport;let s=n.clientWidth,i=n.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;const c=qa();(!c||c&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:s,height:i,x:a,y:l}}function fw(t,e){const r=mr(t,!0,e==="fixed"),n=r.top+t.clientTop,o=r.left+t.clientLeft,s=ft(t)?Qr(t):ht(1),i=t.clientWidth*s.x,a=t.clientHeight*s.y,l=o*s.x,c=n*s.y;return{width:i,height:a,x:l,y:c}}function cc(t,e,r){let n;if(e==="viewport")n=hw(t,r);else if(e==="document")n=dw(yt(t));else if(nt(e))n=fw(e,r);else{const o=vh(t);n={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return rs(n)}function bh(t,e){const r=Xt(t);return r===e||!nt(r)||an(r)?!1:ot(r).position==="fixed"||bh(r,e)}function pw(t,e){const r=e.get(t);if(r)return r;let n=qn(t,[],!1).filter(a=>nt(a)&&wn(a)!=="body"),o=null;const s=ot(t).position==="fixed";let i=s?Xt(t):t;for(;nt(i)&&!an(i);){const a=ot(i),l=Ga(i);!l&&a.position==="fixed"&&(o=null),(s?!l&&!o:!l&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||ro(i)&&!l&&bh(t,i))?n=n.filter(u=>u!==i):o=a,i=Xt(i)}return e.set(t,n),n}function mw(t){let{element:e,boundary:r,rootBoundary:n,strategy:o}=t;const i=[...r==="clippingAncestors"?ms(e)?[]:pw(e,this._c):[].concat(r),n],a=i[0],l=i.reduce((c,u)=>{const d=cc(e,u,o);return c.top=Ue(d.top,c.top),c.right=Vt(d.right,c.right),c.bottom=Vt(d.bottom,c.bottom),c.left=Ue(d.left,c.left),c},cc(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function gw(t){const{width:e,height:r}=yh(t);return{width:e,height:r}}function yw(t,e,r){const n=ft(e),o=yt(e),s=r==="fixed",i=mr(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=ht(0);if(n||!n&&!s)if((wn(e)!=="body"||ro(o))&&(a=gs(e)),n){const h=mr(e,!0,s,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else o&&(l.x=Ka(o));const c=o&&!n&&!s?wh(o,a):ht(0),u=i.left+a.scrollLeft-l.x-c.x,d=i.top+a.scrollTop-l.y-c.y;return{x:u,y:d,width:i.width,height:i.height}}function Ks(t){return ot(t).position==="static"}function uc(t,e){if(!ft(t)||ot(t).position==="fixed")return null;if(e)return e(t);let r=t.offsetParent;return yt(t)===r&&(r=r.ownerDocument.body),r}function xh(t,e){const r=Ge(t);if(ms(t))return r;if(!ft(t)){let o=Xt(t);for(;o&&!an(o);){if(nt(o)&&!Ks(o))return o;o=Xt(o)}return r}let n=uc(t,e);for(;n&&sw(n)&&Ks(n);)n=uc(n,e);return n&&an(n)&&Ks(n)&&!Ga(n)?r:n||iw(t)||r}const vw=async function(t){const e=this.getOffsetParent||xh,r=this.getDimensions,n=await r(t.floating);return{reference:yw(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function ww(t){return ot(t).direction==="rtl"}const bw={convertOffsetParentRelativeRectToViewportRelativeRect:cw,getDocumentElement:yt,getClippingRect:mw,getOffsetParent:xh,getElementRects:vw,getClientRects:uw,getDimensions:gw,getScale:Qr,isElement:nt,isRTL:ww};function _h(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function xw(t,e){let r=null,n;const o=yt(t);function s(){var a;clearTimeout(n),(a=r)==null||a.disconnect(),r=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:h,height:p}=c;if(a||e(),!h||!p)return;const y=xo(d),g=xo(o.clientWidth-(u+h)),v=xo(o.clientHeight-(d+p)),w=xo(u),b={rootMargin:-y+"px "+-g+"px "+-v+"px "+-w+"px",threshold:Ue(0,Vt(1,l))||1};let x=!0;function k(C){const S=C[0].intersectionRatio;if(S!==l){if(!x)return i();S?i(!1,S):n=setTimeout(()=>{i(!1,1e-7)},1e3)}S===1&&!_h(c,t.getBoundingClientRect())&&i(),x=!1}try{r=new IntersectionObserver(k,{...b,root:o.ownerDocument})}catch{r=new IntersectionObserver(k,b)}r.observe(t)}return i(!0),s}function _w(t,e,r,n){n===void 0&&(n={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=Va(t),u=o||s?[...c?qn(c):[],...qn(e)]:[];u.forEach(w=>{o&&w.addEventListener("scroll",r,{passive:!0}),s&&w.addEventListener("resize",r)});const d=c&&a?xw(c,r):null;let h=-1,p=null;i&&(p=new ResizeObserver(w=>{let[_]=w;_&&_.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var b;(b=p)==null||b.observe(e)})),r()}),c&&!l&&p.observe(c),p.observe(e));let y,g=l?mr(t):null;l&&v();function v(){const w=mr(t);g&&!_h(g,w)&&r(),g=w,y=requestAnimationFrame(v)}return r(),()=>{var w;u.forEach(_=>{o&&_.removeEventListener("scroll",r),s&&_.removeEventListener("resize",r)}),d?.(),(w=p)==null||w.disconnect(),p=null,l&&cancelAnimationFrame(y)}}const Sw=tw,kw=rw,Cw=Zv,Pw=ow,Aw=Qv,dc=Yv,Ew=nw,Tw=(t,e,r)=>{const n=new Map,o={platform:bw,...r},s={...o.platform,_c:n};return Jv(t,e,{...o,platform:s})};var Lo=typeof document<"u"?m.useLayoutEffect:m.useEffect;function ns(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,n,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(n=r;n--!==0;)if(!ns(t[n],e[n]))return!1;return!0}if(o=Object.keys(t),r=o.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(e,o[n]))return!1;for(n=r;n--!==0;){const s=o[n];if(!(s==="_owner"&&t.$$typeof)&&!ns(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Sh(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function hc(t,e){const r=Sh(t);return Math.round(e*r)/r}function Xs(t){const e=m.useRef(t);return Lo(()=>{e.current=t}),e}function Rw(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:n=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=m.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=m.useState(n);ns(h,n)||p(n);const[y,g]=m.useState(null),[v,w]=m.useState(null),_=m.useCallback(J=>{J!==C.current&&(C.current=J,g(J))},[]),b=m.useCallback(J=>{J!==S.current&&(S.current=J,w(J))},[]),x=s||y,k=i||v,C=m.useRef(null),S=m.useRef(null),z=m.useRef(u),K=l!=null,D=Xs(l),q=Xs(o),O=Xs(c),se=m.useCallback(()=>{if(!C.current||!S.current)return;const J={placement:e,strategy:r,middleware:h};q.current&&(J.platform=q.current),Tw(C.current,S.current,J).then(ie=>{const be={...ie,isPositioned:O.current!==!1};M.current&&!ns(z.current,be)&&(z.current=be,La.flushSync(()=>{d(be)}))})},[h,e,r,q,O]);Lo(()=>{c===!1&&z.current.isPositioned&&(z.current.isPositioned=!1,d(J=>({...J,isPositioned:!1})))},[c]);const M=m.useRef(!1);Lo(()=>(M.current=!0,()=>{M.current=!1}),[]),Lo(()=>{if(x&&(C.current=x),k&&(S.current=k),x&&k){if(D.current)return D.current(x,k,se);se()}},[x,k,se,D,K]);const X=m.useMemo(()=>({reference:C,floating:S,setReference:_,setFloating:b}),[_,b]),V=m.useMemo(()=>({reference:x,floating:k}),[x,k]),re=m.useMemo(()=>{const J={position:r,left:0,top:0};if(!V.floating)return J;const ie=hc(V.floating,u.x),be=hc(V.floating,u.y);return a?{...J,transform:"translate("+ie+"px, "+be+"px)",...Sh(V.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:ie,top:be}},[r,a,V.floating,u.x,u.y]);return m.useMemo(()=>({...u,update:se,refs:X,elements:V,floatingStyles:re}),[u,se,X,V,re])}const Iw=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:n,padding:o}=typeof t=="function"?t(r):t;return n&&e(n)?n.current!=null?dc({element:n.current,padding:o}).fn(r):{}:n?dc({element:n,padding:o}).fn(r):{}}}},Ow=(t,e)=>({...Sw(t),options:[t,e]}),jw=(t,e)=>({...kw(t),options:[t,e]}),$w=(t,e)=>({...Ew(t),options:[t,e]}),zw=(t,e)=>({...Cw(t),options:[t,e]}),Nw=(t,e)=>({...Pw(t),options:[t,e]}),Mw=(t,e)=>({...Aw(t),options:[t,e]}),Dw=(t,e)=>({...Iw(t),options:[t,e]});var Lw="Arrow",kh=m.forwardRef((t,e)=>{const{children:r,width:n=10,height:o=5,...s}=t;return f.jsx(we.svg,{...s,ref:e,width:n,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:f.jsx("polygon",{points:"0,0 30,0 15,10"})})});kh.displayName=Lw;var Bw=kh;function Fw(t){const[e,r]=m.useState(void 0);return pr(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;r({width:i,height:a})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else r(void 0)},[t]),e}var Xa="Popper",[Ch,Ph]=Da(Xa),[Uw,Ah]=Ch(Xa),Eh=t=>{const{__scopePopper:e,children:r}=t,[n,o]=m.useState(null);return f.jsx(Uw,{scope:e,anchor:n,onAnchorChange:o,children:r})};Eh.displayName=Xa;var Th="PopperAnchor",Rh=m.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:n,...o}=t,s=Ah(Th,r),i=m.useRef(null),a=st(e,i);return m.useEffect(()=>{s.onAnchorChange(n?.current||i.current)}),n?null:f.jsx(we.div,{...o,ref:a})});Rh.displayName=Th;var Ja="PopperContent",[Hw,Ww]=Ch(Ja),Ih=m.forwardRef((t,e)=>{const{__scopePopper:r,side:n="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:y,...g}=t,v=Ah(Ja,r),[w,_]=m.useState(null),b=st(e,T=>_(T)),[x,k]=m.useState(null),C=Fw(x),S=C?.width??0,z=C?.height??0,K=n+(s!=="center"?"-"+s:""),D=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},q=Array.isArray(c)?c:[c],O=q.length>0,se={padding:D,boundary:q.filter(qw),altBoundary:O},{refs:M,floatingStyles:X,placement:V,isPositioned:re,middlewareData:J}=Rw({strategy:"fixed",placement:K,whileElementsMounted:(...T)=>_w(...T,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[Ow({mainAxis:o+z,alignmentAxis:i}),l&&jw({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?$w():void 0,...se}),l&&zw({...se}),Nw({...se,apply:({elements:T,rects:N,availableWidth:ne,availableHeight:ce})=>{const{width:qe,height:Ve}=N.reference,ue=T.floating.style;ue.setProperty("--radix-popper-available-width",`${ne}px`),ue.setProperty("--radix-popper-available-height",`${ce}px`),ue.setProperty("--radix-popper-anchor-width",`${qe}px`),ue.setProperty("--radix-popper-anchor-height",`${Ve}px`)}}),x&&Dw({element:x,padding:a}),Vw({arrowWidth:S,arrowHeight:z}),h&&Mw({strategy:"referenceHidden",...se})]}),[ie,be]=$h(V),ge=qt(y);pr(()=>{re&&ge?.()},[re,ge]);const A=J.arrow?.x,P=J.arrow?.y,R=J.arrow?.centerOffset!==0,[E,I]=m.useState();return pr(()=>{w&&I(window.getComputedStyle(w).zIndex)},[w]),f.jsx("div",{ref:M.setFloating,"data-radix-popper-content-wrapper":"",style:{...X,transform:re?X.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:E,"--radix-popper-transform-origin":[J.transformOrigin?.x,J.transformOrigin?.y].join(" "),...J.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:f.jsx(Hw,{scope:r,placedSide:ie,onArrowChange:k,arrowX:A,arrowY:P,shouldHideArrow:R,children:f.jsx(we.div,{"data-side":ie,"data-align":be,...g,ref:b,style:{...g.style,animation:re?void 0:"none"}})})})});Ih.displayName=Ja;var Oh="PopperArrow",Gw={top:"bottom",right:"left",bottom:"top",left:"right"},jh=m.forwardRef(function(e,r){const{__scopePopper:n,...o}=e,s=Ww(Oh,n),i=Gw[s.placedSide];return f.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:f.jsx(Bw,{...o,ref:r,style:{...o.style,display:"block"}})})});jh.displayName=Oh;function qw(t){return t!==null}var Vw=t=>({name:"transformOrigin",options:t,fn(e){const{placement:r,rects:n,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=$h(r),d={start:"0%",center:"50%",end:"100%"}[u],h=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let y="",g="";return c==="bottom"?(y=i?d:`${h}px`,g=`${-l}px`):c==="top"?(y=i?d:`${h}px`,g=`${n.floating.height+l}px`):c==="right"?(y=`${-l}px`,g=i?d:`${p}px`):c==="left"&&(y=`${n.floating.width+l}px`,g=i?d:`${p}px`),{data:{x:y,y:g}}}});function $h(t){const[e,r="center"]=t.split("-");return[e,r]}var Kw=Eh,zh=Rh,Xw=Ih,Jw=jh,Yw="Portal",Nh=m.forwardRef((t,e)=>{const{container:r,...n}=t,[o,s]=m.useState(!1);pr(()=>s(!0),[]);const i=r||o&&globalThis?.document?.body;return i?vv.createPortal(f.jsx(we.div,{...n,ref:e}),i):null});Nh.displayName=Yw;function Zw(t,e){return m.useReducer((r,n)=>e[r][n]??r,t)}var no=t=>{const{present:e,children:r}=t,n=Qw(e),o=typeof r=="function"?r({present:n.isPresent}):m.Children.only(r),s=st(n.ref,eb(o));return typeof r=="function"||n.isPresent?m.cloneElement(o,{ref:s}):null};no.displayName="Presence";function Qw(t){const[e,r]=m.useState(),n=m.useRef({}),o=m.useRef(t),s=m.useRef("none"),i=t?"mounted":"unmounted",[a,l]=Zw(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return m.useEffect(()=>{const c=_o(n.current);s.current=a==="mounted"?c:"none"},[a]),pr(()=>{const c=n.current,u=o.current;if(u!==t){const h=s.current,p=_o(c);t?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&h!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),pr(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const g=_o(n.current).includes(p.animationName);if(p.target===e&&g&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},h=p=>{p.target===e&&(s.current=_o(n.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:m.useCallback(c=>{c&&(n.current=getComputedStyle(c)),r(c)},[])}}function _o(t){return t?.animationName||"none"}function eb(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function Mh({prop:t,defaultProp:e,onChange:r=()=>{}}){const[n,o]=tb({defaultProp:e,onChange:r}),s=t!==void 0,i=s?t:n,a=qt(r),l=m.useCallback(c=>{if(s){const d=typeof c=="function"?c(t):c;d!==t&&a(d)}else o(c)},[s,t,o,a]);return[i,l]}function tb({defaultProp:t,onChange:e}){const r=m.useState(t),[n]=r,o=m.useRef(n),s=qt(e);return m.useEffect(()=>{o.current!==n&&(s(n),o.current=n)},[n,o,s]),r}var rb=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Ar=new WeakMap,So=new WeakMap,ko={},Js=0,Dh=function(t){return t&&(t.host||Dh(t.parentNode))},nb=function(t,e){return e.map(function(r){if(t.contains(r))return r;var n=Dh(r);return n&&t.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},ob=function(t,e,r,n){var o=nb(e,Array.isArray(t)?t:[t]);ko[r]||(ko[r]=new WeakMap);var s=ko[r],i=[],a=new Set,l=new Set(o),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};o.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var p=h.getAttribute(n),y=p!==null&&p!=="false",g=(Ar.get(h)||0)+1,v=(s.get(h)||0)+1;Ar.set(h,g),s.set(h,v),i.push(h),g===1&&y&&So.set(h,!0),v===1&&h.setAttribute(r,"true"),y||h.setAttribute(n,"true")}catch(w){console.error("aria-hidden: cannot operate on ",h,w)}})};return u(e),a.clear(),Js++,function(){i.forEach(function(d){var h=Ar.get(d)-1,p=s.get(d)-1;Ar.set(d,h),s.set(d,p),h||(So.has(d)||d.removeAttribute(n),So.delete(d)),p||d.removeAttribute(r)}),Js--,Js||(Ar=new WeakMap,Ar=new WeakMap,So=new WeakMap,ko={})}},Lh=function(t,e,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(t)?t:[t]),o=rb(t);return o?(n.push.apply(n,Array.from(o.querySelectorAll("[aria-live]"))),ob(n,o,r,"aria-hidden")):function(){return null}},ct=function(){return ct=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ct.apply(this,arguments)};function Bh(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r}function sb(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))}var Bo="right-scroll-bar-position",Fo="width-before-scroll-bar",ib="with-scroll-bars-hidden",ab="--removed-body-scroll-bar-size";function Ys(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function lb(t,e){var r=m.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(n){var o=r.value;o!==n&&(r.value=n,r.callback(n,o))}}}})[0];return r.callback=e,r.facade}var cb=typeof window<"u"?m.useLayoutEffect:m.useEffect,fc=new WeakMap;function ub(t,e){var r=lb(null,function(n){return t.forEach(function(o){return Ys(o,n)})});return cb(function(){var n=fc.get(r);if(n){var o=new Set(n),s=new Set(t),i=r.current;o.forEach(function(a){s.has(a)||Ys(a,null)}),s.forEach(function(a){o.has(a)||Ys(a,i)})}fc.set(r,t)},[t]),r}function db(t){return t}function hb(t,e){e===void 0&&(e=db);var r=[],n=!1,o={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(s){var i=e(s,n);return r.push(i),function(){r=r.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(n=!0;r.length;){var i=r;r=[],i.forEach(s)}r={push:function(a){return s(a)},filter:function(){return r}}},assignMedium:function(s){n=!0;var i=[];if(r.length){var a=r;r=[],a.forEach(s),i=r}var l=function(){var u=i;i=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),r={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),r}}}};return o}function fb(t){t===void 0&&(t={});var e=hb(null);return e.options=ct({async:!0,ssr:!1},t),e}var Fh=function(t){var e=t.sideCar,r=Bh(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return m.createElement(n,ct({},r))};Fh.isSideCarExport=!0;function pb(t,e){return t.useMedium(e),Fh}var Uh=fb(),Zs=function(){},ys=m.forwardRef(function(t,e){var r=m.useRef(null),n=m.useState({onScrollCapture:Zs,onWheelCapture:Zs,onTouchMoveCapture:Zs}),o=n[0],s=n[1],i=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,h=t.sideCar,p=t.noIsolation,y=t.inert,g=t.allowPinchZoom,v=t.as,w=v===void 0?"div":v,_=t.gapMode,b=Bh(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=h,k=ub([r,e]),C=ct(ct({},b),o);return m.createElement(m.Fragment,null,u&&m.createElement(x,{sideCar:Uh,removeScrollBar:c,shards:d,noIsolation:p,inert:y,setCallbacks:s,allowPinchZoom:!!g,lockRef:r,gapMode:_}),i?m.cloneElement(m.Children.only(a),ct(ct({},C),{ref:k})):m.createElement(w,ct({},C,{className:l,ref:k}),a))});ys.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};ys.classNames={fullWidth:Fo,zeroRight:Bo};var mb=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function gb(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=mb();return e&&t.setAttribute("nonce",e),t}function yb(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function vb(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var wb=function(){var t=0,e=null;return{add:function(r){t==0&&(e=gb())&&(yb(e,r),vb(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},bb=function(){var t=wb();return function(e,r){m.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},Hh=function(){var t=bb(),e=function(r){var n=r.styles,o=r.dynamic;return t(n,o),null};return e},xb={left:0,top:0,right:0,gap:0},Qs=function(t){return parseInt(t||"",10)||0},_b=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],n=e[t==="padding"?"paddingTop":"marginTop"],o=e[t==="padding"?"paddingRight":"marginRight"];return[Qs(r),Qs(n),Qs(o)]},Sb=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return xb;var e=_b(t),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-r+e[2]-e[0])}},kb=Hh(),en="data-scroll-locked",Cb=function(t,e,r,n){var o=t.left,s=t.top,i=t.right,a=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(ib,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(a,"px ").concat(n,`;
  }
  body[`).concat(en,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(a,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Bo,` {
    right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Fo,` {
    margin-right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Bo," .").concat(Bo,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Fo," .").concat(Fo,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(en,`] {
    `).concat(ab,": ").concat(a,`px;
  }
`)},pc=function(){var t=parseInt(document.body.getAttribute(en)||"0",10);return isFinite(t)?t:0},Pb=function(){m.useEffect(function(){return document.body.setAttribute(en,(pc()+1).toString()),function(){var t=pc()-1;t<=0?document.body.removeAttribute(en):document.body.setAttribute(en,t.toString())}},[])},Ab=function(t){var e=t.noRelative,r=t.noImportant,n=t.gapMode,o=n===void 0?"margin":n;Pb();var s=m.useMemo(function(){return Sb(o)},[o]);return m.createElement(kb,{styles:Cb(s,!e,o,r?"":"!important")})},Ji=!1;if(typeof window<"u")try{var Co=Object.defineProperty({},"passive",{get:function(){return Ji=!0,!0}});window.addEventListener("test",Co,Co),window.removeEventListener("test",Co,Co)}catch{Ji=!1}var Er=Ji?{passive:!1}:!1,Eb=function(t){return t.tagName==="TEXTAREA"},Wh=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!Eb(t)&&r[e]==="visible")},Tb=function(t){return Wh(t,"overflowY")},Rb=function(t){return Wh(t,"overflowX")},mc=function(t,e){var r=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var o=Gh(t,n);if(o){var s=qh(t,n),i=s[1],a=s[2];if(i>a)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},Ib=function(t){var e=t.scrollTop,r=t.scrollHeight,n=t.clientHeight;return[e,r,n]},Ob=function(t){var e=t.scrollLeft,r=t.scrollWidth,n=t.clientWidth;return[e,r,n]},Gh=function(t,e){return t==="v"?Tb(e):Rb(e)},qh=function(t,e){return t==="v"?Ib(e):Ob(e)},jb=function(t,e){return t==="h"&&e==="rtl"?-1:1},$b=function(t,e,r,n,o){var s=jb(t,window.getComputedStyle(e).direction),i=s*n,a=r.target,l=e.contains(a),c=!1,u=i>0,d=0,h=0;do{var p=qh(t,a),y=p[0],g=p[1],v=p[2],w=g-v-s*y;(y||w)&&Gh(t,a)&&(d+=w,h+=y),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},Po=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},gc=function(t){return[t.deltaX,t.deltaY]},yc=function(t){return t&&"current"in t?t.current:t},zb=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Nb=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Mb=0,Tr=[];function Db(t){var e=m.useRef([]),r=m.useRef([0,0]),n=m.useRef(),o=m.useState(Mb++)[0],s=m.useState(Hh)[0],i=m.useRef(t);m.useEffect(function(){i.current=t},[t]),m.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(o));var g=sb([t.lockRef.current],(t.shards||[]).map(yc),!0).filter(Boolean);return g.forEach(function(v){return v.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),g.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(o))})}}},[t.inert,t.lockRef.current,t.shards]);var a=m.useCallback(function(g,v){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!i.current.allowPinchZoom;var w=Po(g),_=r.current,b="deltaX"in g?g.deltaX:_[0]-w[0],x="deltaY"in g?g.deltaY:_[1]-w[1],k,C=g.target,S=Math.abs(b)>Math.abs(x)?"h":"v";if("touches"in g&&S==="h"&&C.type==="range")return!1;var z=mc(S,C);if(!z)return!0;if(z?k=S:(k=S==="v"?"h":"v",z=mc(S,C)),!z)return!1;if(!n.current&&"changedTouches"in g&&(b||x)&&(n.current=k),!k)return!0;var K=n.current||k;return $b(K,v,g,K==="h"?b:x)},[]),l=m.useCallback(function(g){var v=g;if(!(!Tr.length||Tr[Tr.length-1]!==s)){var w="deltaY"in v?gc(v):Po(v),_=e.current.filter(function(k){return k.name===v.type&&(k.target===v.target||v.target===k.shadowParent)&&zb(k.delta,w)})[0];if(_&&_.should){v.cancelable&&v.preventDefault();return}if(!_){var b=(i.current.shards||[]).map(yc).filter(Boolean).filter(function(k){return k.contains(v.target)}),x=b.length>0?a(v,b[0]):!i.current.noIsolation;x&&v.cancelable&&v.preventDefault()}}},[]),c=m.useCallback(function(g,v,w,_){var b={name:g,delta:v,target:w,should:_,shadowParent:Lb(w)};e.current.push(b),setTimeout(function(){e.current=e.current.filter(function(x){return x!==b})},1)},[]),u=m.useCallback(function(g){r.current=Po(g),n.current=void 0},[]),d=m.useCallback(function(g){c(g.type,gc(g),g.target,a(g,t.lockRef.current))},[]),h=m.useCallback(function(g){c(g.type,Po(g),g.target,a(g,t.lockRef.current))},[]);m.useEffect(function(){return Tr.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Er),document.addEventListener("touchmove",l,Er),document.addEventListener("touchstart",u,Er),function(){Tr=Tr.filter(function(g){return g!==s}),document.removeEventListener("wheel",l,Er),document.removeEventListener("touchmove",l,Er),document.removeEventListener("touchstart",u,Er)}},[]);var p=t.removeScrollBar,y=t.inert;return m.createElement(m.Fragment,null,y?m.createElement(s,{styles:Nb(o)}):null,p?m.createElement(Ab,{gapMode:t.gapMode}):null)}function Lb(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Bb=pb(Uh,Db);var Ya=m.forwardRef(function(t,e){return m.createElement(ys,ct({},t,{ref:e,sideCar:Bb}))});Ya.classNames=ys.classNames;var Za="Popover",[Vh,eE]=Da(Za,[Ph]),oo=Ph(),[Fb,Sr]=Vh(Za),Kh=t=>{const{__scopePopover:e,children:r,open:n,defaultOpen:o,onOpenChange:s,modal:i=!1}=t,a=oo(e),l=m.useRef(null),[c,u]=m.useState(!1),[d=!1,h]=Mh({prop:n,defaultProp:o,onChange:s});return f.jsx(Kw,{...a,children:f.jsx(Fb,{scope:e,contentId:dt(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:m.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:c,onCustomAnchorAdd:m.useCallback(()=>u(!0),[]),onCustomAnchorRemove:m.useCallback(()=>u(!1),[]),modal:i,children:r})})};Kh.displayName=Za;var Xh="PopoverAnchor",Ub=m.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=Sr(Xh,r),s=oo(r),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=o;return m.useEffect(()=>(i(),()=>a()),[i,a]),f.jsx(zh,{...s,...n,ref:e})});Ub.displayName=Xh;var Jh="PopoverTrigger",Yh=m.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=Sr(Jh,r),s=oo(r),i=st(e,o.triggerRef),a=f.jsx(we.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":tf(o.open),...n,ref:i,onClick:We(t.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:f.jsx(zh,{asChild:!0,...s,children:a})});Yh.displayName=Jh;var Hb="PopoverPortal",[tE,Wb]=Vh(Hb,{forceMount:void 0}),ln="PopoverContent",Zh=m.forwardRef((t,e)=>{const r=Wb(ln,t.__scopePopover),{forceMount:n=r.forceMount,...o}=t,s=Sr(ln,t.__scopePopover);return f.jsx(no,{present:n||s.open,children:s.modal?f.jsx(Gb,{...o,ref:e}):f.jsx(qb,{...o,ref:e})})});Zh.displayName=ln;var Gb=m.forwardRef((t,e)=>{const r=Sr(ln,t.__scopePopover),n=m.useRef(null),o=st(e,n),s=m.useRef(!1);return m.useEffect(()=>{const i=n.current;if(i)return Lh(i)},[]),f.jsx(Ya,{as:fs,allowPinchZoom:!0,children:f.jsx(Qh,{...t,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:We(t.onCloseAutoFocus,i=>{i.preventDefault(),s.current||r.triggerRef.current?.focus()}),onPointerDownOutside:We(t.onPointerDownOutside,i=>{const a=i.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:We(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),qb=m.forwardRef((t,e)=>{const r=Sr(ln,t.__scopePopover),n=m.useRef(!1),o=m.useRef(!1);return f.jsx(Qh,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(n.current||r.triggerRef.current?.focus(),s.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(n.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;r.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),Qh=m.forwardRef((t,e)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=t,h=Sr(ln,r),p=oo(r);return hh(),f.jsx(Fa,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:s,children:f.jsx(Ba,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1),children:f.jsx(Xw,{"data-state":tf(h.open),role:"dialog",id:h.contentId,...p,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),ef="PopoverClose",Vb=m.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=Sr(ef,r);return f.jsx(we.button,{type:"button",...n,ref:e,onClick:We(t.onClick,()=>o.onOpenChange(!1))})});Vb.displayName=ef;var Kb="PopoverArrow",Xb=m.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=oo(r);return f.jsx(Jw,{...o,...n,ref:e})});Xb.displayName=Kb;function tf(t){return t?"open":"closed"}var Jb=Yh;function rf(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(e=0;e<o;e++)t[e]&&(r=rf(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function nf(){for(var t,e,r=0,n="",o=arguments.length;r<o;r++)(t=arguments[r])&&(e=rf(t))&&(n&&(n+=" "),n+=e);return n}function Ae(...t){return ih(nf(t))}const of=Kh,sf=Jb,af=m.forwardRef(({className:t,align:e="end",...r},n)=>f.jsx(Zh,{ref:n,align:e,className:Ae("z-popups drop-shadow-oneBlock p-0 border-shadow outline-none",t),...r,onKeyDown:o=>{o.stopPropagation()}})),Qa=({children:t,scaleFactor:e})=>{const r=Em();return f.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??r,"--block":`${(e??r)*8}px`},children:t})};var vc=1,Yb=.9,Zb=.8,Qb=.17,ei=.1,ti=.999,ex=.9999,tx=.99,rx=/[\\\/_+.#"@\[\(\{&]/,nx=/[\\\/_+.#"@\[\(\{&]/g,ox=/[\s-]/,lf=/[\s-]/g;function Yi(t,e,r,n,o,s,i){if(s===e.length)return o===t.length?vc:tx;var a=`${o},${s}`;if(i[a]!==void 0)return i[a];for(var l=n.charAt(s),c=r.indexOf(l,o),u=0,d,h,p,y;c>=0;)d=Yi(t,e,r,n,c+1,s+1,i),d>u&&(c===o?d*=vc:rx.test(t.charAt(c-1))?(d*=Zb,p=t.slice(o,c-1).match(nx),p&&o>0&&(d*=Math.pow(ti,p.length))):ox.test(t.charAt(c-1))?(d*=Yb,y=t.slice(o,c-1).match(lf),y&&o>0&&(d*=Math.pow(ti,y.length))):(d*=Qb,o>0&&(d*=Math.pow(ti,c-o))),t.charAt(c)!==e.charAt(s)&&(d*=ex)),(d<ei&&r.charAt(c-1)===n.charAt(s+1)||n.charAt(s+1)===n.charAt(s)&&r.charAt(c-1)!==n.charAt(s))&&(h=Yi(t,e,r,n,c+1,s+2,i),h*ei>d&&(d=h*ei)),d>u&&(u=d),c=r.indexOf(l,c+1);return i[a]=u,u}function wc(t){return t.toLowerCase().replace(lf," ")}function sx(t,e,r){return t=r&&r.length>0?`${t+" "+r.join(" ")}`:t,Yi(t,e,wc(t),wc(e),0,0,{})}var el="Dialog",[cf,rE]=Da(el),[ix,it]=cf(el),uf=t=>{const{__scopeDialog:e,children:r,open:n,defaultOpen:o,onOpenChange:s,modal:i=!0}=t,a=m.useRef(null),l=m.useRef(null),[c=!1,u]=Mh({prop:n,defaultProp:o,onChange:s});return f.jsx(ix,{scope:e,triggerRef:a,contentRef:l,contentId:dt(),titleId:dt(),descriptionId:dt(),open:c,onOpenChange:u,onOpenToggle:m.useCallback(()=>u(d=>!d),[u]),modal:i,children:r})};uf.displayName=el;var df="DialogTrigger",ax=m.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=it(df,r),s=st(e,o.triggerRef);return f.jsx(we.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":nl(o.open),...n,ref:s,onClick:We(t.onClick,o.onOpenToggle)})});ax.displayName=df;var tl="DialogPortal",[lx,hf]=cf(tl,{forceMount:void 0}),ff=t=>{const{__scopeDialog:e,forceMount:r,children:n,container:o}=t,s=it(tl,e);return f.jsx(lx,{scope:e,forceMount:r,children:m.Children.map(n,i=>f.jsx(no,{present:r||s.open,children:f.jsx(Nh,{asChild:!0,container:o,children:i})}))})};ff.displayName=tl;var os="DialogOverlay",pf=m.forwardRef((t,e)=>{const r=hf(os,t.__scopeDialog),{forceMount:n=r.forceMount,...o}=t,s=it(os,t.__scopeDialog);return s.modal?f.jsx(no,{present:n||s.open,children:f.jsx(cx,{...o,ref:e})}):null});pf.displayName=os;var cx=m.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=it(os,r);return f.jsx(Ya,{as:fs,allowPinchZoom:!0,shards:[o.contentRef],children:f.jsx(we.div,{"data-state":nl(o.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),gr="DialogContent",mf=m.forwardRef((t,e)=>{const r=hf(gr,t.__scopeDialog),{forceMount:n=r.forceMount,...o}=t,s=it(gr,t.__scopeDialog);return f.jsx(no,{present:n||s.open,children:s.modal?f.jsx(ux,{...o,ref:e}):f.jsx(dx,{...o,ref:e})})});mf.displayName=gr;var ux=m.forwardRef((t,e)=>{const r=it(gr,t.__scopeDialog),n=m.useRef(null),o=st(e,r.contentRef,n);return m.useEffect(()=>{const s=n.current;if(s)return Lh(s)},[]),f.jsx(gf,{...t,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:We(t.onCloseAutoFocus,s=>{s.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:We(t.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:We(t.onFocusOutside,s=>s.preventDefault())})}),dx=m.forwardRef((t,e)=>{const r=it(gr,t.__scopeDialog),n=m.useRef(!1),o=m.useRef(!1);return f.jsx(gf,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(n.current||r.triggerRef.current?.focus(),s.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(n.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;r.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),gf=m.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=t,a=it(gr,r),l=m.useRef(null),c=st(e,l);return hh(),f.jsxs(f.Fragment,{children:[f.jsx(Fa,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:s,children:f.jsx(Ba,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":nl(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),f.jsxs(f.Fragment,{children:[f.jsx(mx,{titleId:a.titleId}),f.jsx(yx,{contentRef:l,descriptionId:a.descriptionId})]})]})}),rl="DialogTitle",hx=m.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=it(rl,r);return f.jsx(we.h2,{id:o.titleId,...n,ref:e})});hx.displayName=rl;var yf="DialogDescription",fx=m.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=it(yf,r);return f.jsx(we.p,{id:o.descriptionId,...n,ref:e})});fx.displayName=yf;var vf="DialogClose",px=m.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=it(vf,r);return f.jsx(we.button,{type:"button",...n,ref:e,onClick:We(t.onClick,()=>o.onOpenChange(!1))})});px.displayName=vf;function nl(t){return t?"open":"closed"}var wf="DialogTitleWarning",[nE,bf]=gv(wf,{contentName:gr,titleName:rl,docsSlug:"dialog"}),mx=({titleId:t})=>{const e=bf(wf),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return m.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},gx="DialogDescriptionWarning",yx=({contentRef:t,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${bf(gx).contentName}}.`;return m.useEffect(()=>{const o=t.current?.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(n))},[n,t,e]),null},vx=uf,wx=ff,bx=pf,xx=mf,ri={exports:{}},ni={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bc;function _x(){if(bc)return ni;bc=1;var t=Tm();function e(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var r=typeof Object.is=="function"?Object.is:e,n=t.useState,o=t.useEffect,s=t.useLayoutEffect,i=t.useDebugValue;function a(d,h){var p=h(),y=n({inst:{value:p,getSnapshot:h}}),g=y[0].inst,v=y[1];return s(function(){g.value=p,g.getSnapshot=h,l(g)&&v({inst:g})},[d,p,h]),o(function(){return l(g)&&v({inst:g}),d(function(){l(g)&&v({inst:g})})},[d]),i(p),p}function l(d){var h=d.getSnapshot;d=d.value;try{var p=h();return!r(d,p)}catch{return!0}}function c(d,h){return h()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return ni.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,ni}var xc;function Sx(){return xc||(xc=1,ri.exports=_x()),ri.exports}var kx=Sx(),Pn='[cmdk-group=""]',oi='[cmdk-group-items=""]',Cx='[cmdk-group-heading=""]',ol='[cmdk-item=""]',_c=`${ol}:not([aria-disabled="true"])`,Zi="cmdk-item-select",sr="data-value",Px=(t,e,r)=>sx(t,e,r),xf=m.createContext(void 0),so=()=>m.useContext(xf),_f=m.createContext(void 0),sl=()=>m.useContext(_f),Sf=m.createContext(void 0),kf=m.forwardRef((t,e)=>{let r=Hr(()=>{var A,P;return{search:"",value:(P=(A=t.value)!=null?A:t.defaultValue)!=null?P:"",filtered:{count:0,items:new Map,groups:new Set}}}),n=Hr(()=>new Set),o=Hr(()=>new Map),s=Hr(()=>new Map),i=Hr(()=>new Set),a=Cf(t),{label:l,children:c,value:u,onValueChange:d,filter:h,shouldFilter:p,loop:y,disablePointerSelection:g=!1,vimBindings:v=!0,...w}=t,_=dt(),b=dt(),x=dt(),k=m.useRef(null),C=Mx();yr(()=>{if(u!==void 0){let A=u.trim();r.current.value=A,S.emit()}},[u]),yr(()=>{C(6,se)},[]);let S=m.useMemo(()=>({subscribe:A=>(i.current.add(A),()=>i.current.delete(A)),snapshot:()=>r.current,setState:(A,P,R)=>{var E,I,T;if(!Object.is(r.current[A],P)){if(r.current[A]=P,A==="search")O(),D(),C(1,q);else if(A==="value"&&(R||C(5,se),((E=a.current)==null?void 0:E.value)!==void 0)){let N=P??"";(T=(I=a.current).onValueChange)==null||T.call(I,N);return}S.emit()}},emit:()=>{i.current.forEach(A=>A())}}),[]),z=m.useMemo(()=>({value:(A,P,R)=>{var E;P!==((E=s.current.get(A))==null?void 0:E.value)&&(s.current.set(A,{value:P,keywords:R}),r.current.filtered.items.set(A,K(P,R)),C(2,()=>{D(),S.emit()}))},item:(A,P)=>(n.current.add(A),P&&(o.current.has(P)?o.current.get(P).add(A):o.current.set(P,new Set([A]))),C(3,()=>{O(),D(),r.current.value||q(),S.emit()}),()=>{s.current.delete(A),n.current.delete(A),r.current.filtered.items.delete(A);let R=M();C(4,()=>{O(),R?.getAttribute("id")===A&&q(),S.emit()})}),group:A=>(o.current.has(A)||o.current.set(A,new Set),()=>{s.current.delete(A),o.current.delete(A)}),filter:()=>a.current.shouldFilter,label:l||t["aria-label"],getDisablePointerSelection:()=>a.current.disablePointerSelection,listId:_,inputId:x,labelId:b,listInnerRef:k}),[]);function K(A,P){var R,E;let I=(E=(R=a.current)==null?void 0:R.filter)!=null?E:Px;return A?I(A,r.current.search,P):0}function D(){if(!r.current.search||a.current.shouldFilter===!1)return;let A=r.current.filtered.items,P=[];r.current.filtered.groups.forEach(E=>{let I=o.current.get(E),T=0;I.forEach(N=>{let ne=A.get(N);T=Math.max(ne,T)}),P.push([E,T])});let R=k.current;X().sort((E,I)=>{var T,N;let ne=E.getAttribute("id"),ce=I.getAttribute("id");return((T=A.get(ce))!=null?T:0)-((N=A.get(ne))!=null?N:0)}).forEach(E=>{let I=E.closest(oi);I?I.appendChild(E.parentElement===I?E:E.closest(`${oi} > *`)):R.appendChild(E.parentElement===R?E:E.closest(`${oi} > *`))}),P.sort((E,I)=>I[1]-E[1]).forEach(E=>{var I;let T=(I=k.current)==null?void 0:I.querySelector(`${Pn}[${sr}="${encodeURIComponent(E[0])}"]`);T?.parentElement.appendChild(T)})}function q(){let A=X().find(R=>R.getAttribute("aria-disabled")!=="true"),P=A?.getAttribute(sr);S.setState("value",P||void 0)}function O(){var A,P,R,E;if(!r.current.search||a.current.shouldFilter===!1){r.current.filtered.count=n.current.size;return}r.current.filtered.groups=new Set;let I=0;for(let T of n.current){let N=(P=(A=s.current.get(T))==null?void 0:A.value)!=null?P:"",ne=(E=(R=s.current.get(T))==null?void 0:R.keywords)!=null?E:[],ce=K(N,ne);r.current.filtered.items.set(T,ce),ce>0&&I++}for(let[T,N]of o.current)for(let ne of N)if(r.current.filtered.items.get(ne)>0){r.current.filtered.groups.add(T);break}r.current.filtered.count=I}function se(){var A,P,R;let E=M();E&&(((A=E.parentElement)==null?void 0:A.firstChild)===E&&((R=(P=E.closest(Pn))==null?void 0:P.querySelector(Cx))==null||R.scrollIntoView({block:"nearest"})),E.scrollIntoView({block:"nearest"}))}function M(){var A;return(A=k.current)==null?void 0:A.querySelector(`${ol}[aria-selected="true"]`)}function X(){var A;return Array.from(((A=k.current)==null?void 0:A.querySelectorAll(_c))||[])}function V(A){let P=X()[A];P&&S.setState("value",P.getAttribute(sr))}function re(A){var P;let R=M(),E=X(),I=E.findIndex(N=>N===R),T=E[I+A];(P=a.current)!=null&&P.loop&&(T=I+A<0?E[E.length-1]:I+A===E.length?E[0]:E[I+A]),T&&S.setState("value",T.getAttribute(sr))}function J(A){let P=M(),R=P?.closest(Pn),E;for(;R&&!E;)R=A>0?zx(R,Pn):Nx(R,Pn),E=R?.querySelector(_c);E?S.setState("value",E.getAttribute(sr)):re(A)}let ie=()=>V(X().length-1),be=A=>{A.preventDefault(),A.metaKey?ie():A.altKey?J(1):re(1)},ge=A=>{A.preventDefault(),A.metaKey?V(0):A.altKey?J(-1):re(-1)};return m.createElement(we.div,{ref:e,tabIndex:-1,...w,"cmdk-root":"",onKeyDown:A=>{var P;if((P=w.onKeyDown)==null||P.call(w,A),!A.defaultPrevented)switch(A.key){case"n":case"j":{v&&A.ctrlKey&&be(A);break}case"ArrowDown":{be(A);break}case"p":case"k":{v&&A.ctrlKey&&ge(A);break}case"ArrowUp":{ge(A);break}case"Home":{A.preventDefault(),V(0);break}case"End":{A.preventDefault(),ie();break}case"Enter":if(!A.nativeEvent.isComposing&&A.keyCode!==229){A.preventDefault();let R=M();if(R){let E=new Event(Zi);R.dispatchEvent(E)}}}}},m.createElement("label",{"cmdk-label":"",htmlFor:z.inputId,id:z.labelId,style:Lx},l),vs(t,A=>m.createElement(_f.Provider,{value:S},m.createElement(xf.Provider,{value:z},A))))}),Ax=m.forwardRef((t,e)=>{var r,n;let o=dt(),s=m.useRef(null),i=m.useContext(Sf),a=so(),l=Cf(t),c=(n=(r=l.current)==null?void 0:r.forceMount)!=null?n:i?.forceMount;yr(()=>{if(!c)return a.item(o,i?.id)},[c]);let u=Pf(o,s,[t.value,t.children,s],t.keywords),d=sl(),h=vr(C=>C.value&&C.value===u.current),p=vr(C=>c||a.filter()===!1?!0:C.search?C.filtered.items.get(o)>0:!0);m.useEffect(()=>{let C=s.current;if(!(!C||t.disabled))return C.addEventListener(Zi,y),()=>C.removeEventListener(Zi,y)},[p,t.onSelect,t.disabled]);function y(){var C,S;g(),(S=(C=l.current).onSelect)==null||S.call(C,u.current)}function g(){d.setState("value",u.current,!0)}if(!p)return null;let{disabled:v,value:w,onSelect:_,forceMount:b,keywords:x,...k}=t;return m.createElement(we.div,{ref:Vn([s,e]),...k,id:o,"cmdk-item":"",role:"option","aria-disabled":!!v,"aria-selected":!!h,"data-disabled":!!v,"data-selected":!!h,onPointerMove:v||a.getDisablePointerSelection()?void 0:g,onClick:v?void 0:y},t.children)}),Ex=m.forwardRef((t,e)=>{let{heading:r,children:n,forceMount:o,...s}=t,i=dt(),a=m.useRef(null),l=m.useRef(null),c=dt(),u=so(),d=vr(p=>o||u.filter()===!1?!0:p.search?p.filtered.groups.has(i):!0);yr(()=>u.group(i),[]),Pf(i,a,[t.value,t.heading,l]);let h=m.useMemo(()=>({id:i,forceMount:o}),[o]);return m.createElement(we.div,{ref:Vn([a,e]),...s,"cmdk-group":"",role:"presentation",hidden:d?void 0:!0},r&&m.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:c},r),vs(t,p=>m.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?c:void 0},m.createElement(Sf.Provider,{value:h},p))))}),Tx=m.forwardRef((t,e)=>{let{alwaysRender:r,...n}=t,o=m.useRef(null),s=vr(i=>!i.search);return!r&&!s?null:m.createElement(we.div,{ref:Vn([o,e]),...n,"cmdk-separator":"",role:"separator"})}),Rx=m.forwardRef((t,e)=>{let{onValueChange:r,...n}=t,o=t.value!=null,s=sl(),i=vr(u=>u.search),a=vr(u=>u.value),l=so(),c=m.useMemo(()=>{var u;let d=(u=l.listInnerRef.current)==null?void 0:u.querySelector(`${ol}[${sr}="${encodeURIComponent(a)}"]`);return d?.getAttribute("id")},[]);return m.useEffect(()=>{t.value!=null&&s.setState("search",t.value)},[t.value]),m.createElement(we.input,{ref:e,...n,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":c,id:l.inputId,type:"text",value:o?t.value:i,onChange:u=>{o||s.setState("search",u.target.value),r?.(u.target.value)}})}),Ix=m.forwardRef((t,e)=>{let{children:r,label:n="Suggestions",...o}=t,s=m.useRef(null),i=m.useRef(null),a=so();return m.useEffect(()=>{if(i.current&&s.current){let l=i.current,c=s.current,u,d=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let h=l.offsetHeight;c.style.setProperty("--cmdk-list-height",h.toFixed(1)+"px")})});return d.observe(l),()=>{cancelAnimationFrame(u),d.unobserve(l)}}},[]),m.createElement(we.div,{ref:Vn([s,e]),...o,"cmdk-list":"",role:"listbox","aria-label":n,id:a.listId},vs(t,l=>m.createElement("div",{ref:Vn([i,a.listInnerRef]),"cmdk-list-sizer":""},l)))}),Ox=m.forwardRef((t,e)=>{let{open:r,onOpenChange:n,overlayClassName:o,contentClassName:s,container:i,...a}=t;return m.createElement(vx,{open:r,onOpenChange:n},m.createElement(wx,{container:i},m.createElement(bx,{"cmdk-overlay":"",className:o}),m.createElement(xx,{"aria-label":t.label,"cmdk-dialog":"",className:s},m.createElement(kf,{ref:e,...a}))))}),jx=m.forwardRef((t,e)=>vr(r=>r.filtered.count===0)?m.createElement(we.div,{ref:e,...t,"cmdk-empty":"",role:"presentation"}):null),$x=m.forwardRef((t,e)=>{let{progress:r,children:n,label:o="Loading...",...s}=t;return m.createElement(we.div,{ref:e,...s,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},vs(t,i=>m.createElement("div",{"aria-hidden":!0},i)))}),Le=Object.assign(kf,{List:Ix,Item:Ax,Input:Rx,Group:Ex,Separator:Tx,Dialog:Ox,Empty:jx,Loading:$x});function zx(t,e){let r=t.nextElementSibling;for(;r;){if(r.matches(e))return r;r=r.nextElementSibling}}function Nx(t,e){let r=t.previousElementSibling;for(;r;){if(r.matches(e))return r;r=r.previousElementSibling}}function Cf(t){let e=m.useRef(t);return yr(()=>{e.current=t}),e}var yr=typeof window>"u"?m.useEffect:m.useLayoutEffect;function Hr(t){let e=m.useRef();return e.current===void 0&&(e.current=t()),e}function Vn(t){return e=>{t.forEach(r=>{typeof r=="function"?r(e):r!=null&&(r.current=e)})}}function vr(t){let e=sl(),r=()=>t(e.snapshot());return kx.useSyncExternalStore(e.subscribe,r,r)}function Pf(t,e,r,n=[]){let o=m.useRef(),s=so();return yr(()=>{var i;let a=(()=>{var c;for(let u of r){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(c=u.current.textContent)==null?void 0:c.trim():o.current}})(),l=n.map(c=>c.trim());s.value(t,a,l),(i=e.current)==null||i.setAttribute(sr,a),o.current=a}),o}var Mx=()=>{let[t,e]=m.useState(),r=Hr(()=>new Map);return yr(()=>{r.current.forEach(n=>n()),r.current=new Map},[t]),(n,o)=>{r.current.set(n,o),e({})}};function Dx(t){let e=t.type;return typeof e=="function"?e(t.props):"render"in e?e.render(t.props):t}function vs({asChild:t,children:e},r){return t&&m.isValidElement(e)?m.cloneElement(Dx(e),{ref:e.ref},r(e.props.children)):r(e)}var Lx={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Af=m.forwardRef(({className:t,...e},r)=>f.jsx(Le,{ref:r,className:Ae("flex h-full w-full flex-col overflow-hidden bg-metallicBlue text-popover-foreground",t),...e}));Af.displayName=Le.displayName;const Ef=m.forwardRef(({className:t,...e},r)=>f.jsxs("div",{className:"flex items-center border-b px-1 pb-1","cmdk-input-wrapper":"",children:[f.jsx("span",{className:"sprite mr-1 texture-hud_char_gt"}),f.jsx(Le.Input,{ref:r,className:Ae("flex h-1 w-full bg-pastelBlue py-1 outline-none placeholder:text-shadow disabled:cursor-not-allowed",t),...e})]}));Ef.displayName=Le.Input.displayName;const Tf=m.forwardRef(({className:t,...e},r)=>f.jsx(Le.List,{ref:r,className:Ae("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...e}));Tf.displayName=Le.List.displayName;const Rf=m.forwardRef((t,e)=>f.jsx(Le.Empty,{ref:e,className:"pl-1",...t}));Rf.displayName=Le.Empty.displayName;const If=m.forwardRef(({className:t,...e},r)=>f.jsx(Le.Group,{ref:r,className:Ae("overflow-hidden",t),...e}));If.displayName=Le.Group.displayName;const Bx=m.forwardRef(({className:t,...e},r)=>f.jsx(Le.Separator,{ref:r,className:Ae("-mx-1 h-px bg-shadow",t),...e}));Bx.displayName=Le.Separator.displayName;const ws=m.forwardRef(({className:t,...e},r)=>f.jsx(Le.Item,{ref:r,className:Ae("relative flex cursor-default select-none items-center text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-midRed hover:bg-pastelBlue data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...e}));ws.displayName=Le.Item.displayName;const Ct=m.forwardRef(({className:t,selected:e,disabled:r=!1,onClick:n,...o},s)=>f.jsx("button",{disabled:r,onClick:n,"data-selected":e,className:Ae(`inline-flex items-center justify-center whitespace-nowrap 
          bg-metallicBlue zx:bg-zxBlue border-none border-shadow
          gap-2
           disabled:bg-midGrey disabled:text-lightGrey 
           data-[selected=true]:bg-lightBeige
           [&:not(:disabled):hover:not([data-selected=true])]:bg-pastelBlue 
           `,t),ref:s,...o}));Ct.displayName="Button";var Sc=!1,ir,Qi,ea,Uo,Ho,Of,Wo,ta,ra,na,jf,oa,sa,$f,zf;function $e(){if(!Sc){Sc=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),r=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(oa=/\b(iPhone|iP[ao]d)/.exec(t),sa=/\b(iP[ao]d)/.exec(t),na=/Android/i.exec(t),$f=/FBAN\/\w+;/i.exec(t),zf=/Mobile/i.exec(t),jf=!!/Win64/.exec(t),e){ir=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN,ir&&document&&document.documentMode&&(ir=document.documentMode);var n=/(?:Trident\/(\d+.\d+))/.exec(t);Of=n?parseFloat(n[1])+4:ir,Qi=e[2]?parseFloat(e[2]):NaN,ea=e[3]?parseFloat(e[3]):NaN,Uo=e[4]?parseFloat(e[4]):NaN,Uo?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),Ho=e&&e[1]?parseFloat(e[1]):NaN):Ho=NaN}else ir=Qi=ea=Ho=Uo=NaN;if(r){if(r[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);Wo=o?parseFloat(o[1].replace("_",".")):!0}else Wo=!1;ta=!!r[2],ra=!!r[3]}else Wo=ta=ra=!1}}var ia={ie:function(){return $e()||ir},ieCompatibilityMode:function(){return $e()||Of>ir},ie64:function(){return ia.ie()&&jf},firefox:function(){return $e()||Qi},opera:function(){return $e()||ea},webkit:function(){return $e()||Uo},safari:function(){return ia.webkit()},chrome:function(){return $e()||Ho},windows:function(){return $e()||ta},osx:function(){return $e()||Wo},linux:function(){return $e()||ra},iphone:function(){return $e()||oa},mobile:function(){return $e()||oa||sa||na||zf},nativeApp:function(){return $e()||$f},android:function(){return $e()||na},ipad:function(){return $e()||sa}},Fx=ia,Ux=!!(typeof window<"u"&&window.document&&window.document.createElement),Hx={canUseDOM:Ux},Nf=Hx,Mf;Nf.canUseDOM&&(Mf=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);function Wx(t,e){if(!Nf.canUseDOM||e&&!("addEventListener"in document))return!1;var r="on"+t,n=r in document;if(!n){var o=document.createElement("div");o.setAttribute(r,"return;"),n=typeof o[r]=="function"}return!n&&Mf&&t==="wheel"&&(n=document.implementation.hasFeature("Events.wheel","3.0")),n}var Gx=Wx,kc=10,Cc=40,Pc=800;function Df(t){var e=0,r=0,n=0,o=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),n=e*kc,o=r*kc,"deltaY"in t&&(o=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||o)&&t.deltaMode&&(t.deltaMode==1?(n*=Cc,o*=Cc):(n*=Pc,o*=Pc)),n&&!e&&(e=n<1?-1:1),o&&!r&&(r=o<1?-1:1),{spinX:e,spinY:r,pixelX:n,pixelY:o}}Df.getEventType=function(){return Fx.firefox()?"DOMMouseScroll":Gx("wheel")?"wheel":"mousewheel"};var qx=Df;/**
* Checks if an event is supported in the current execution environment.
*
* NOTE: This will not work correctly for non-generic events such as `change`,
* `reset`, `load`, `error`, and `select`.
*
* Borrows from Modernizr.
*
* @param {string} eventNameSuffix Event name, e.g. "click".
* @param {?boolean} capture Check if the capture phase is supported.
* @return {boolean} True if the event is supported.
* @internal
* @license Modernizr 3.0.0pre (Custom Build) | MIT
*/const Vx=(t,e,r=!1)=>{const n=m.useRef(0),o=m.useCallback(s=>{if(r)return;const i=s;i.preventDefault(),i.stopPropagation();const a=qx(i);n.current-=a.spinY,n.current>=1&&(e(1),n.current=0),n.current<=-1&&(e(-1),n.current=0)},[e,r]);m.useEffect(()=>{const s=t.current;if(s!==null)return s.addEventListener("wheel",o,{passive:!1}),()=>{s.removeEventListener("wheel",o)}},[t,o])},Lf=(t,e,r,n=!1)=>{const o=m.useRef(0);return Vx(t,s=>{if(e.length===0)return;const i=(o.current+s+256*e.length)%e.length;o.current=i,r(e[i],i)},n)},Kx=({value:t,onSelect:e})=>f.jsx(ws,{value:t,onSelect:e,className:"px-1",children:f.jsx(F,{children:t})}),bs=t=>{const{value:e,values:r,onSelect:n,triggerButtonClassName:o="",triggerButtonStyle:s=le,triggerButtonLabel:i="",OptionCommandItem:a=Kx}=t,[l,c]=m.useState(!1),u=m.useRef(null);return Lf(u,r,d=>{n(d)},!l),f.jsxs(of,{open:l,onOpenChange:c,children:[f.jsx(sf,{asChild:!0,children:f.jsxs(Ct,{className:Ae("h-2 px-1 flex flex-row gap-1 justify-start leading-none",o),style:s,ref:u,children:[typeof i=="string"?f.jsx(F,{className:"grow overflow-hidden text-left",children:i}):i,f.jsx(F,{className:"grow-0",children:l?"X":"⬇"})]})}),f.jsx(af,{className:"p-0",children:f.jsx(Qa,{scaleFactor:2,children:f.jsxs(Af,{value:e,onValueChange:d=>n(d),className:"w-[--radix-popper-anchor-width]",children:[t.disableCommandInput===!0?null:f.jsx(Ef,{placeholder:t.placeholder}),f.jsxs(Tf,{children:[f.jsx(Rf,{children:f.jsx(F,{children:"Nothing found"})}),f.jsx(If,{children:r.map(d=>f.jsx(a,{value:d,onSelect:h=>{c(!1),n(h)}},d))})]})]})})})]})},Xx=()=>{const t=Xe(),e=pd();return f.jsx(f.Fragment,{children:f.jsx(bs,{value:e,values:Rm,onSelect:r=>{t(Im(r))},disableCommandInput:!0,triggerButtonLabel:e,triggerButtonClassName:"w-13"})})};function Bf({campaign:t,onSelect:e,headRoomId:r,heelsRoomId:n,value:o,triggerButtonClassName:s,excludeRoomIds:i=[]}){const a=Object.keys(t.rooms).filter(l=>!i.includes(l));return f.jsx(bs,{onSelect:l=>e?.(l),value:o,values:a,triggerButtonClassName:s,placeholder:"search",disableCommandInput:!1,triggerButtonLabel:o??"none",OptionCommandItem:({value:l,onSelect:c})=>f.jsxs(ws,{value:l,onSelect:c,className:"px-1",children:[r===l&&f.jsx("span",{className:"sprite mr-1 my-1 texture-head_walking_towards_2"}),n===l&&f.jsx("span",{className:"sprite mr-1 my-1 texture-heels_walking_towards_2"}),f.jsx(F,{children:l})]})})}const H={w:16,d:16,h:12},Ac={x:16,y:16,z:12},pe=t=>t,Ff="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",Jx="h-[calc(2*var(--block)-1px*var(--scale))] w-[calc(2*var(--block)-1px*var(--scale))]",B=pe("[button:not([data-selected=true]):not(:hover)_&]:sprite-revert-to-two-tone-dim"),Ee=pe("flex flex-wrap gap-oneScaledPix w-full"),Yx=/^(?<modifiers>[⇧⌘^]*)(?<key>.+)$/,Zx=t=>{const e=new Set;for(const r of t){if(e.has(r))return!0;e.add(r)}return!1},Uf=(t,e,r)=>{const n=t?.join(" ");m.useEffect(()=>{if(!t||t.length===0)return;const o=s=>{if(s.target.closest(".monaco-editor")===null)for(const l of t){const c=l.match(Yx);if(!c||!c.groups)continue;const{modifiers:u,key:d}=c.groups;if(Zx(u)){console.warn(`Invalid shortcut "${l}": duplicate modifiers`);continue}const h=u.includes("^"),p=u.includes("⌘"),y=u.includes("⇧"),g=h||p||y,v=h===s.ctrlKey&&p===s.metaKey&&y===s.shiftKey&&(g||!s.ctrlKey&&!s.metaKey&&!s.shiftKey);if(s.key.toLowerCase()===d.toLowerCase()&&v){e||r?.(),s.preventDefault();break}}};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e,r,n])},xe=({className:t,onClick:e,children:r,disabled:n=!1,isCurrentTool:o=!1,shortcutKeys:s,small:i=!1})=>(Uf(s,n,e),f.jsx(Ct,{disabled:n,selected:o,className:`
        ${i?Jx:Ff} 
        active:pt-oneScaledPix  gap-0 inline-flex overflow-hidden 
        
        ${t??""}`,onClick:e,children:r})),Qx=()=>{const t=me(e=>e.levelEditor.selectedJsonItemIds.length>0);return f.jsx(xe,{className:"bg-midRed",disabled:!t,onClick:()=>L.dispatch(ug()),shortcutKeys:["Delete","Backspace"],children:f.jsx("span",{className:"sprite sprite-tinted texture-hud_char_X relative"})})},Kn=({className:t,value:e,onChange:r,trueLabel:n="ON",falseLabel:o="OFF",label:s,shortcutKeys:i})=>{const a=Math.max(n.length,o.length)+1,l=n.padStart(a," "),c=o.padEnd(a," ");return Uf(i,!1,()=>{r?.(!e,void 0)}),f.jsxs("span",{onClick:u=>r?.(!e,u),className:Ae("inline-flex justify-between",t),children:[s&&f.jsx(F,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),f.jsx(F,{className:nf("inline-block w-min h-min",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:e?l:c})]})},e0=({className:t})=>{const e=Xe();return f.jsx(Kn,{className:t,label:"snap",value:me(r=>r.levelEditor.halfGridResolution),onChange:r=>{e(dg(r))},falseLabel:"Block",trueLabel:"Half",shortcutKeys:["S"]})},j=({itemTool:t,children:e,className:r,shortcutKeys:n})=>{const o=me(cr),s=Be(o?.type==="item"&&o.item,t);return f.jsx(xe,{isCurrentTool:s,className:r,onClick:()=>L.dispatch(nn({type:"item",item:t})),shortcutKeys:n,children:e})},Hf=({main:t,children:e,closeOnSelect:r,ref:n})=>{const[o,s]=m.useState(!1);return f.jsxs(of,{open:o,onOpenChange:s,children:[f.jsx("div",{ref:n,className:Ae(Ff,"relative",{"drop-shadow-oneBlock z-popups":o}),children:f.jsxs("span",{className:"content",children:[t,f.jsx(sf,{asChild:!0,children:f.jsx(Ct,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:f.jsx(F,{className:"pl-oneScaledPix",children:o?"X":"⬇"})})})]})}),f.jsx(af,{children:f.jsx(Qa,{scaleFactor:2,children:f.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:e.map((i,a)=>i===null?null:f.jsx("div",{className:"leading-none",onClick:()=>{r&&s(!1)},children:i},a))})})})]})},An=({children:t})=>{const[e,r]=m.useState(0),n=m.useRef(null);Lf(n,t,(s,i)=>{r(i)});const o=t[e];return f.jsx(Hf,{main:o,closeOnSelect:!0,ref:n,children:t.map((s,i)=>i===e?null:f.jsx("div",{className:"leading-none",onClick:()=>{r(i)},children:s},i))})},t0=()=>{const e=me(cr)?.type==="pointer";return f.jsx(xe,{onClick:()=>L.dispatch(nn({type:"pointer"})),isCurrentTool:e,shortcutKeys:["Escape","."],children:f.jsx("span",{className:"sprite texture-editor_tool_pointer relative"})})},$={pureBlack:new G("#000000"),shadow:new G("#325149"),midGrey:new G("#7F7773"),lightGrey:new G("#BBB1AB"),white:new G("#FBFEFB"),pastelBlue:new G("#75ACFF"),metallicBlue:new G("#366CAA"),pink:new G("#D68ED1"),moss:new G("#9E9600"),redShadow:new G("#805E50"),midRed:new G("#CA7463"),lightBeige:new G("#DAA78F"),highlightBeige:new G("#EBC690"),alpha:new G("#1E7790"),replaceLight:new G("#08A086"),replaceDark:new G("#0A4730")},Dn=.33,Wf=t=>{const[e,r,n]=t.toUint8RgbArray();return new G({r:e*.75,g:r*.75,b:n*.75})},cn=(t,e=Dn)=>{const[r,n,o]=t.toUint8RgbArray();return new G({r:r*e,g:n*e,b:o*e})};function oE(t){t=t.replace(/^#/,"");let e=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),n=parseInt(t.substring(4,6),16);e=Math.floor(e*Dn),r=Math.floor(r*Dn),n=Math.floor(n*Dn);const o=s=>s.toString(16).padStart(2,"0");return`#${o(e)}${o(r)}${o(n)}`}const Ye={original:new G(mn.zxWhite),basic:$.white,dimmed:$.lightGrey},Ze={original:new G(mn.zxYellow),basic:new G(15654246),dimmed:cn(new G(15654246),.5)},Gf={original:new G(mn.zxYellow),basic:$.midRed,dimmed:$.redShadow},at={original:new G(mn.zxMagenta),basic:$.pink,dimmed:cn($.pink,.5)},_e={original:new G(mn.zxCyan),basic:$.pastelBlue,dimmed:cn($.pastelBlue,.5)},lt={original:new G(mn.zxGreen),basic:$.moss,dimmed:cn($.moss,.5)},xs={white:{basic:{main:Ye,edges:{towards:{..._e,dimInOriginal:!1},right:{...Ze,dimInOriginal:!0}},hud:{lives:Ze,dimmed:at,icons:_e}},dimmed:{main:Ye,edges:{towards:{...lt,dimInOriginal:!1},right:{..._e,dimInOriginal:!0}},hud:{lives:Gf,dimmed:at,icons:_e}}},yellow:{basic:{main:Ze,edges:{towards:{...lt,dimInOriginal:!1},right:{...Ye,dimInOriginal:!0}},hud:{lives:_e,dimmed:at,icons:lt}},dimmed:{main:Ze,edges:{towards:{..._e,dimInOriginal:!0},right:{..._e,dimInOriginal:!1}},hud:{lives:_e,dimmed:at,icons:lt}}},magenta:{basic:{main:at,edges:{towards:{...lt,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Ye,dimmed:_e,icons:Ze}},dimmed:{main:at,edges:{towards:{...lt,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Ye,dimmed:_e,icons:Ze}}},cyan:{basic:{main:_e,edges:{towards:{...at,dimInOriginal:!1},right:{...Ye,dimInOriginal:!1}},hud:{lives:Ye,dimmed:lt,icons:Ze}},dimmed:{main:_e,edges:{towards:{...at,dimInOriginal:!0},right:{...Ye,dimInOriginal:!0}},hud:{lives:Ye,dimmed:lt,icons:Ze}}},green:{basic:{main:lt,edges:{towards:{..._e,dimInOriginal:!1},right:{...Ze,dimInOriginal:!1}},hud:{lives:Ye,dimmed:at,icons:_e}},dimmed:{main:lt,edges:{towards:{..._e,dimInOriginal:!0},right:{...Ze,dimInOriginal:!0}},hud:{lives:Ye,dimmed:at,icons:_e}}}},ss=t=>xs[t.hue][t.shade],Xr={head:$.pastelBlue,heels:$.pink},Ec=t=>{const{main:e}=xs[t].basic;return{backgroundColor:e.basic.toHex(),borderColor:e.dimmed.toHex()}};function r0(){const t=Xe(),e=me(hg);return f.jsxs(f.Fragment,{children:[f.jsx(bs,{value:e.hue,onSelect:r=>{t(kl({hue:r}))},values:Om,disableCommandInput:!0,OptionCommandItem:({value:r,onSelect:n})=>f.jsx(ws,{value:r,className:"border-l-3 h-2 w-full p-0",style:Ec(r),onSelect:n}),triggerButtonLabel:"colour",triggerButtonClassName:Ae("w-full",`${e.hue==="white"||e.hue==="yellow"?"text-pureBlack":"text-white"}`),triggerButtonStyle:Ec(e.hue)}),f.jsx(Kn,{className:"",label:"shade",value:e.shade==="basic",onChange:r=>{t(kl({shade:r?"basic":"dimmed"}))},falseLabel:"dim",trueLabel:"basic"})]})}function n0(){const t=Xe(),e=me(fg);return f.jsx(bs,{value:e,onSelect:r=>{t(pg(r))},values:jm,placeholder:"scenery",triggerButtonClassName:"w-full",triggerButtonLabel:e})}const jt=({iconClasses:t,text:e})=>f.jsxs("div",{className:"relative w-full h-full",children:[f.jsx("span",{className:`sprite absolute top-0 left-0 ${t} ${B}`}),f.jsx(F,{className:"bg-metallicBlueHalfbrite absolute top-0 right-0 pl-oneScaledPix block",children:e})]}),Ao=({iconClassName:t})=>f.jsx(bt,{topClasses:pe("texture-bubbles_white_2 [button:hover_&]:texture-animated-bubbles_white"),bottomClasses:t}),bt=({topClasses:t,bottomClasses:e="texture-headlessBase"})=>f.jsxs("div",{className:"relative w-full h-full",children:[f.jsx("span",{className:`sprite absolute top-[calc(9px*var(--scale))] left-0 ${e} ${B}`}),f.jsx("span",{className:`sprite absolute top-[calc(-3px*var(--scale))] left-0 ${t} ${B}`})]}),o0="[button:not(:disabled):hover_&]:hidden",s0="hidden [button:not(:disabled):hover_&]:inline mt-quarter",i0="hidden [button:not(:disabled):hover_&]:inline",Xn=({icon:t,topText:e,bottomText:r})=>f.jsxs("span",{className:"w-full h-full flex flex-col items-center justify-center",children:[f.jsx("span",{className:o0,children:t}),f.jsx(F,{className:s0,children:e}),f.jsx(F,{className:i0,children:r})]}),a0=()=>{const t=Xe(),e=me(mg),r=me(gg);return f.jsxs("div",{className:"flex flex-row gap-oneScaledPix bg-metallicBlue",children:[f.jsx(xe,{disabled:!e,onClick:()=>{t(yg())},shortcutKeys:["⌘Z","^Z"],children:f.jsx(Xn,{icon:f.jsx(F,{children:"⬅"}),topText:"un",bottomText:"do"})}),f.jsx(xe,{disabled:!r,onClick:()=>{t(vg())},shortcutKeys:["⌘⇧Z","^⇧Z"],children:f.jsx(Xn,{icon:f.jsx(F,{children:"➡"}),topText:"re",bottomText:"do"})})]})},l0=({className:t})=>{const e=Xe();return f.jsx(Kn,{className:t,label:"scenery",value:me(r=>r.levelEditor.wallsFloorsLocked),onChange:r=>{e(wg(r))},falseLabel:"edit",trueLabel:"lock",shortcutKeys:["C"]})},c0=()=>{const t=me(r=>on(r).planet),e=pe(t==="moonbase"?"texture-door_frame_moonbase_x_whole":"texture-door_frame_generic_x_whole");return f.jsx(j,{itemTool:{type:"door",config:{direction:"away",toRoom:"(placeholder)"}},shortcutKeys:["D"],children:f.jsx("span",{className:`sprite ${e} ${B}`})})},u0=()=>{const t=me(n=>on(n).planet),e={type:"wall",config:{direction:"away",tiles:Array.from(bg(t,1))}},r=pe(t==="blacktooth"?"texture-blacktooth_wall_plain_away":t==="bookworld"?"texture-bookworld_wall_cowboy_away":t==="jail"?"texture-jail_wall_bars_away":t==="egyptus"?"texture-egyptus_wall_hieroglyphics_away":t==="market"?"texture-market_wall_passage_away":t==="moonbase"?"texture-moonbase_wall_window1_away":t==="penitentiary"?"texture-penitentiary_wall_loop_away":"texture-safari_wall_wall_away");return f.jsx(j,{itemTool:e,children:f.jsx("span",{className:`sprite ${r} ${B}`})})},d0=()=>f.jsx(xe,{className:"bg-midRed",onClick:()=>L.dispatch(xg()),children:f.jsx(F,{className:"relative leading-none",children:"CLR"})}),qf=({currentRoomId:t,direction:e})=>{const r=me(({levelEditor:s})=>s.campaignInProgress),n=me(({levelEditor:s})=>s.currentlyEditingRoomId),o=Xe();return f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap pt-1",children:[f.jsxs(F,{className:"text-lightGrey leading-none",children:["Room ",e==="roomAbove"?"⬆":"⬇"]}),f.jsx("div",{className:"flex-grow"}),f.jsxs("div",{className:"flex flex-row gap-oneScaledPix",children:[f.jsx(Ct,{className:"w-2 leading-none bg-moss",children:f.jsx(F,{onClick:()=>o($s({direction:e,createNew:!0})),children:"+"})}),f.jsx(Ct,{className:"w-2 leading-none bg-midRed",children:f.jsx(F,{onClick:()=>o($s({direction:e,createNew:!1,roomId:void 0})),children:"x"})})]})]}),f.jsx("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap",children:f.jsx(Bf,{value:t,campaign:r,excludeRoomIds:[n],triggerButtonClassName:"w-full",onSelect:s=>{o($s({direction:e,createNew:!1,roomId:s}))}})})]})},h0=()=>{const t=me(({levelEditor:e})=>Sd(e).roomAbove);return f.jsx(f.Fragment,{children:f.jsx(qf,{currentRoomId:t,direction:"roomAbove"})})},f0=()=>{const t=me(({levelEditor:e})=>Sd(e).roomBelow);return f.jsx(f.Fragment,{children:f.jsx(qf,{currentRoomId:t,direction:"roomBelow"})})},p0=()=>{const t=me(({levelEditor:e})=>e.tool.type==="eyeDropper");return f.jsx(xe,{shortcutKeys:["I",","],isCurrentTool:t,onClick:()=>L.dispatch(nn({type:"eyeDropper"})),children:f.jsx("span",{className:"relative sprite texture-editor_tool_eyedropper leading-none"})})},_s=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const m0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",In=Array.prototype.slice.call(m0),Eo=(t=>{let e={};return t.forEach((r,n)=>e[r]=n),e})(In),g0=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Go=String.fromCharCode.bind(String),Tc=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),y0=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),Vf=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),v0=t=>{let e,r,n,o,s="";const i=t.length%3;for(let a=0;a<t.length;){if((r=t.charCodeAt(a++))>255||(n=t.charCodeAt(a++))>255||(o=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=r<<16|n<<8|o,s+=In[e>>18&63]+In[e>>12&63]+In[e>>6&63]+In[e&63]}return i?s.slice(0,i-3)+"===".substring(i):s},w0=typeof btoa=="function"?t=>btoa(t):_s?t=>Buffer.from(t,"binary").toString("base64"):v0,Rc=_s?t=>Buffer.from(t).toString("base64"):t=>{let r=[];for(let n=0,o=t.length;n<o;n+=4096)r.push(Go.apply(null,t.subarray(n,n+4096)));return w0(r.join(""))},b0=(t,e=!1)=>e?y0(Rc(t)):Rc(t),x0=t=>{if(t=t.replace(/\s+/g,""),!g0.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,r="",n,o;for(let s=0;s<t.length;)e=Eo[t.charAt(s++)]<<18|Eo[t.charAt(s++)]<<12|(n=Eo[t.charAt(s++)])<<6|(o=Eo[t.charAt(s++)]),r+=n===64?Go(e>>16&255):o===64?Go(e>>16&255,e>>8&255):Go(e>>16&255,e>>8&255,e&255);return r},_0=typeof atob=="function"?t=>atob(Vf(t)):_s?t=>Buffer.from(t,"base64").toString("binary"):x0,S0=_s?t=>Tc(Buffer.from(t,"base64")):t=>Tc(_0(t).split("").map(e=>e.charCodeAt(0))),k0=t=>S0(C0(t)),C0=t=>Vf(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),P0=!0,Kf="gzip",Xf=async t=>{const e=JSON.stringify(t),n=new TextEncoder().encode(e),o=new Blob([n]),s=new CompressionStream(Kf),i=o.stream().pipeThrough(s),a=await new Response(i).arrayBuffer(),l=new Uint8Array(a);return b0(l,P0)},A0=async t=>{try{const e=k0(t),r=new Blob([e]),n=new DecompressionStream(Kf),o=r.stream().pipeThrough(n),s=await new Response(o).text();return JSON.parse(s)}catch(e){throw new Error("error decompressing object",{cause:e})}},E0=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Ht(async()=>{const{default:n}=await Promise.resolve().then(()=>bn);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)};class il extends Error{constructor(e,r="FunctionsError",n){super(e),this.name=r,this.context=n}}class T0 extends il{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ic extends il{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Oc extends il{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var aa;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(aa||(aa={}));var R0=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class I0{constructor(e,{headers:r={},customFetch:n,region:o=aa.Any}={}){this.url=e,this.headers=r,this.region=o,this.fetch=E0(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,r={}){var n;return R0(this,void 0,void 0,function*(){try{const{headers:o,method:s,body:i}=r;let a={},{region:l}=r;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(a["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:u}).catch(g=>{throw new T0(g)}),h=d.headers.get("x-relay-error");if(h&&h==="true")throw new Ic(d);if(!d.ok)throw new Oc(d);let p=((n=d.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),y;return p==="application/json"?y=yield d.json():p==="application/octet-stream"?y=yield d.blob():p==="text/event-stream"?y=d:p==="multipart/form-data"?y=yield d.formData():y=yield d.text(),{data:y,error:null,response:d}}catch(o){return{data:null,error:o,response:o instanceof Oc||o instanceof Ic?o.context:void 0}}})}}var Se={},Rr={},Ir={},Or={},jr={},$r={},O0=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},un=O0();const j0=un.fetch,Jf=un.fetch.bind(un),Yf=un.Headers,$0=un.Request,z0=un.Response,bn=Object.freeze(Object.defineProperty({__proto__:null,Headers:Yf,Request:$0,Response:z0,default:Jf,fetch:j0},Symbol.toStringTag,{value:"Module"})),N0=$m(bn);var To={},jc;function Zf(){if(jc)return To;jc=1,Object.defineProperty(To,"__esModule",{value:!0});class t extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return To.default=t,To}var $c;function Qf(){if($c)return $r;$c=1;var t=$r&&$r.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty($r,"__esModule",{value:!0});const e=t(N0),r=t(Zf());class n{constructor(s){this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=s.headers,this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=s.shouldThrowOnError,this.signal=s.signal,this.isMaybeSingle=s.isMaybeSingle,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=Object.assign({},this.headers),this.headers[s]=i,this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,h;let p=null,y=null,g=null,v=c.status,w=c.statusText;if(c.ok){if(this.method!=="HEAD"){const k=await c.text();k===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?y=k:y=JSON.parse(k))}const b=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),x=(d=c.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");b&&x&&x.length>1&&(g=parseInt(x[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(y)&&(y.length>1?(p={code:"PGRST116",details:`Results contain ${y.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},y=null,g=null,v=406,w="Not Acceptable"):y.length===1?y=y[0]:y=null)}else{const b=await c.text();try{p=JSON.parse(b),Array.isArray(p)&&c.status===404&&(y=[],p=null,v=200,w="OK")}catch{c.status===404&&b===""?(v=204,w="No Content"):p={message:b}}if(p&&this.isMaybeSingle&&(!((h=p?.details)===null||h===void 0)&&h.includes("0 rows"))&&(p=null,v=200,w="OK"),p&&this.shouldThrowOnError)throw new r.default(p)}return{error:p,data:y,count:g,status:v,statusText:w}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,h;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(d=c?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(h=c?.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,i)}returns(){return this}overrideTypes(){return this}}return $r.default=n,$r}var zc;function ep(){if(zc)return jr;zc=1;var t=jr&&jr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(jr,"__esModule",{value:!0});const e=t(Qf());class r extends e.default{select(o){let s=!1;const i=(o??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(o,{ascending:s=!0,nullsFirst:i,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${o}.${s?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:s,referencedTable:i=s}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${o}`),this}range(o,s,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${o}`),this.url.searchParams.set(c,`${s-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:o=!1,verbose:s=!1,settings:i=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[o?"analyze":null,s?"verbose":null,i?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),h=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${h}"; options=${d};`,c==="json"?this:this}rollback(){var o;return((o=this.headers.Prefer)!==null&&o!==void 0?o:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return jr.default=r,jr}var Nc;function al(){if(Nc)return Or;Nc=1;var t=Or&&Or.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Or,"__esModule",{value:!0});const e=t(ep());class r extends e.default{eq(o,s){return this.url.searchParams.append(o,`eq.${s}`),this}neq(o,s){return this.url.searchParams.append(o,`neq.${s}`),this}gt(o,s){return this.url.searchParams.append(o,`gt.${s}`),this}gte(o,s){return this.url.searchParams.append(o,`gte.${s}`),this}lt(o,s){return this.url.searchParams.append(o,`lt.${s}`),this}lte(o,s){return this.url.searchParams.append(o,`lte.${s}`),this}like(o,s){return this.url.searchParams.append(o,`like.${s}`),this}likeAllOf(o,s){return this.url.searchParams.append(o,`like(all).{${s.join(",")}}`),this}likeAnyOf(o,s){return this.url.searchParams.append(o,`like(any).{${s.join(",")}}`),this}ilike(o,s){return this.url.searchParams.append(o,`ilike.${s}`),this}ilikeAllOf(o,s){return this.url.searchParams.append(o,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(o,s){return this.url.searchParams.append(o,`ilike(any).{${s.join(",")}}`),this}is(o,s){return this.url.searchParams.append(o,`is.${s}`),this}in(o,s){const i=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(o,`in.(${i})`),this}contains(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cs.{${s.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(s)}`),this}containedBy(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cd.{${s.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(s)}`),this}rangeGt(o,s){return this.url.searchParams.append(o,`sr.${s}`),this}rangeGte(o,s){return this.url.searchParams.append(o,`nxl.${s}`),this}rangeLt(o,s){return this.url.searchParams.append(o,`sl.${s}`),this}rangeLte(o,s){return this.url.searchParams.append(o,`nxr.${s}`),this}rangeAdjacent(o,s){return this.url.searchParams.append(o,`adj.${s}`),this}overlaps(o,s){return typeof s=="string"?this.url.searchParams.append(o,`ov.${s}`):this.url.searchParams.append(o,`ov.{${s.join(",")}}`),this}textSearch(o,s,{config:i,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=i===void 0?"":`(${i})`;return this.url.searchParams.append(o,`${l}fts${c}.${s}`),this}match(o){return Object.entries(o).forEach(([s,i])=>{this.url.searchParams.append(s,`eq.${i}`)}),this}not(o,s,i){return this.url.searchParams.append(o,`not.${s}.${i}`),this}or(o,{foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${o})`),this}filter(o,s,i){return this.url.searchParams.append(o,`${s}.${i}`),this}}return Or.default=r,Or}var Mc;function tp(){if(Mc)return Ir;Mc=1;var t=Ir&&Ir.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ir,"__esModule",{value:!0});const e=t(al());class r{constructor(o,{headers:s={},schema:i,fetch:a}){this.url=o,this.headers=s,this.schema=i,this.fetch=a}select(o,{head:s=!1,count:i}={}){const a=s?"HEAD":"GET";let l=!1;const c=(o??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),i&&(this.headers.Prefer=`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(o,{count:s,defaultToNull:i=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(o)){const c=o.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}upsert(o,{onConflict:s,ignoreDuplicates:i=!1,count:a,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${i?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(o)){const d=o.reduce((h,p)=>h.concat(Object.keys(p)),[]);if(d.length>0){const h=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}update(o,{count:s}={}){const i="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}delete({count:o}={}){const s="DELETE",i=[];return o&&i.push(`count=${o}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Ir.default=r,Ir}var En={},Tn={},Dc;function M0(){return Dc||(Dc=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.version=void 0,Tn.version="0.0.0-automated"),Tn}var Lc;function D0(){if(Lc)return En;Lc=1,Object.defineProperty(En,"__esModule",{value:!0}),En.DEFAULT_HEADERS=void 0;const t=M0();return En.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${t.version}`},En}var Bc;function L0(){if(Bc)return Rr;Bc=1;var t=Rr&&Rr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Rr,"__esModule",{value:!0});const e=t(tp()),r=t(al()),n=D0();class o{constructor(i,{headers:a={},schema:l,fetch:c}={}){this.url=i,this.headers=Object.assign(Object.assign({},n.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new o(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:l=!1,get:c=!1,count:u}={}){let d;const h=new URL(`${this.url}/rpc/${i}`);let p;l||c?(d=l?"HEAD":"GET",Object.entries(a).filter(([g,v])=>v!==void 0).map(([g,v])=>[g,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([g,v])=>{h.searchParams.append(g,v)})):(d="POST",p=a);const y=Object.assign({},this.headers);return u&&(y.Prefer=`count=${u}`),new r.default({method:d,url:h,headers:y,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return Rr.default=o,Rr}var Fc;function B0(){if(Fc)return Se;Fc=1;var t=Se&&Se.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Se,"__esModule",{value:!0}),Se.PostgrestError=Se.PostgrestBuilder=Se.PostgrestTransformBuilder=Se.PostgrestFilterBuilder=Se.PostgrestQueryBuilder=Se.PostgrestClient=void 0;const e=t(L0());Se.PostgrestClient=e.default;const r=t(tp());Se.PostgrestQueryBuilder=r.default;const n=t(al());Se.PostgrestFilterBuilder=n.default;const o=t(ep());Se.PostgrestTransformBuilder=o.default;const s=t(Qf());Se.PostgrestBuilder=s.default;const i=t(Zf());return Se.PostgrestError=i.default,Se.default={PostgrestClient:e.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:s.default,PostgrestError:i.default},Se}var F0=B0();const U0=Et(F0),{PostgrestClient:H0,PostgrestQueryBuilder:sE,PostgrestFilterBuilder:iE,PostgrestTransformBuilder:aE,PostgrestBuilder:lE,PostgrestError:cE}=U0;function W0(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const G0=W0(),q0="2.11.15",V0=`realtime-js/${q0}`,K0="1.0.0",rp=1e4,X0=1e3;var Ln;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Ln||(Ln={}));var Te;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Te||(Te={}));var et;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(et||(et={}));var la;(function(t){t.websocket="websocket"})(la||(la={}));var ar;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(ar||(ar={}));class J0{constructor(){this.HEADER_LENGTH=1}decode(e,r){return e.constructor===ArrayBuffer?r(this._binaryDecode(e)):r(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const r=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,r,n)}_decodeBroadcast(e,r,n){const o=r.getUint8(1),s=r.getUint8(2);let i=this.HEADER_LENGTH+2;const a=n.decode(e.slice(i,i+o));i=i+o;const l=n.decode(e.slice(i,i+s));i=i+s;const c=JSON.parse(n.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class np{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var de;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(de||(de={}));const Uc=(t,e,r={})=>{var n;const o=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((s,i)=>(s[i]=Y0(i,t,e,o),s),{})},Y0=(t,e,r,n)=>{const o=e.find(a=>a.name===t),s=o?.type,i=r[t];return s&&!n.includes(s)?op(s,i):ca(i)},op=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return t_(e,r)}switch(t){case de.bool:return Z0(e);case de.float4:case de.float8:case de.int2:case de.int4:case de.int8:case de.numeric:case de.oid:return Q0(e);case de.json:case de.jsonb:return e_(e);case de.timestamp:return r_(e);case de.abstime:case de.date:case de.daterange:case de.int4range:case de.int8range:case de.money:case de.reltime:case de.text:case de.time:case de.timestamptz:case de.timetz:case de.tsrange:case de.tstzrange:return ca(e);default:return ca(e)}},ca=t=>t,Z0=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Q0=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},e_=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},t_=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let s;const i=t.slice(1,r);try{s=JSON.parse("["+i+"]")}catch{s=i?i.split(","):[]}return s.map(a=>op(e,a))}return t},r_=t=>typeof t=="string"?t.replace(" ","T"):t,sp=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class si{constructor(e,r,n={},o=rp){this.channel=e,this.event=r,this.payload=n,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Hc;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Hc||(Hc={}));class Bn{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Bn.syncState(this.state,o,s,i),this.pendingDiffs.forEach(l=>{this.state=Bn.syncDiff(this.state,l,s,i)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=Bn.syncDiff(this.state,o,s,i),a())}),this.onJoin((o,s,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:s,newPresences:i})}),this.onLeave((o,s,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:s,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,o){const s=this.cloneDeep(e),i=this.transformState(r),a={},l={};return this.map(s,(c,u)=>{i[c]||(l[c]=u)}),this.map(i,(c,u)=>{const d=s[c];if(d){const h=u.map(v=>v.presence_ref),p=d.map(v=>v.presence_ref),y=u.filter(v=>p.indexOf(v.presence_ref)<0),g=d.filter(v=>h.indexOf(v.presence_ref)<0);y.length>0&&(a[c]=y),g.length>0&&(l[c]=g)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},n,o)}static syncDiff(e,r,n,o){const{joins:s,leaves:i}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),o||(o=()=>{}),this.map(s,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(p=>p.presence_ref),h=u.filter(p=>d.indexOf(p.presence_ref)<0);e[a].unshift(...h)}n(a,u,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,o(a,c,l),c.length===0&&delete e[a]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const o=e[n];return"metas"in o?r[n]=o.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):r[n]=o,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Wc;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Wc||(Wc={}));var Gc;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Gc||(Gc={}));var _t;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(_t||(_t={}));class ll{constructor(e,r={config:{}},n){this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=Te.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new si(this,et.join,this.params,this.timeout),this.rejoinTimer=new np(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Te.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Te.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Te.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Te.errored,this.rejoinTimer.scheduleTimeout())}),this._on(et.reply,{},(o,s)=>{this._trigger(this._replyEventName(s),o)}),this.presence=new Bn(this),this.broadcastEndpointURL=sp(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,r=this.timeout){var n,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Te.closed){const{config:{broadcast:s,presence:i,private:a}}=this.params;this._onError(u=>e?.(_t.CHANNEL_ERROR,u)),this._onClose(()=>e?.(_t.CLOSED));const l={},c={broadcast:s,presence:i,postgres_changes:(o=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){e?.(_t.SUBSCRIBED);return}else{const h=this.bindings.postgres_changes,p=(d=h?.length)!==null&&d!==void 0?d:0,y=[];for(let g=0;g<p;g++){const v=h[g],{filter:{event:w,schema:_,table:b,filter:x}}=v,k=u&&u[g];if(k&&k.event===w&&k.schema===_&&k.table===b&&k.filter===x)y.push(Object.assign(Object.assign({},v),{id:k.id}));else{this.unsubscribe(),this.state=Te.errored,e?.(_t.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(_t.SUBSCRIBED);return}}).receive("error",u=>{this.state=Te.errored,e?.(_t.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e?.(_t.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this._on(e,r,n)}async send(e,r={}){var n,o;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var i,a,l;const c=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Te.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(et.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(o=>{n=new si(this,et.leave,{},e),n.receive("ok",()=>{r(),o("ok")}).receive("timeout",()=>{r(),o("timed out")}).receive("error",()=>{o("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,r,n){const o=new AbortController,s=setTimeout(()=>o.abort(),n),i=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:o.signal}));return clearTimeout(s),i}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new si(this,e,r,n);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var o,s;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=et;if(n&&[a,l,c,u].indexOf(i)>=0&&n!==this._joinRef())return;let h=this._onMessage(i,r,n);if(r&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(p=>{var y,g,v;return((y=p.filter)===null||y===void 0?void 0:y.event)==="*"||((v=(g=p.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(p=>p.callback(h,n)):(s=this.bindings[i])===null||s===void 0||s.filter(p=>{var y,g,v,w,_,b;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in p){const x=p.id,k=(y=p.filter)===null||y===void 0?void 0:y.event;return x&&((g=r.ids)===null||g===void 0?void 0:g.includes(x))&&(k==="*"||k?.toLocaleLowerCase()===((v=r.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const x=(_=(w=p?.filter)===null||w===void 0?void 0:w.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return x==="*"||x===((b=r?.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===i}).map(p=>{if(typeof h=="object"&&"ids"in h){const y=h.data,{schema:g,table:v,commit_timestamp:w,type:_,errors:b}=y;h=Object.assign(Object.assign({},{schema:g,table:v,commit_timestamp:w,eventType:_,new:{},old:{},errors:b}),this._getPayloadRecords(y))}p.callback(h,n)})}_isClosed(){return this.state===Te.closed}_isJoined(){return this.state===Te.joined}_isJoining(){return this.state===Te.joining}_isLeaving(){return this.state===Te.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const o=e.toLocaleLowerCase(),s={type:o,filter:r,callback:n};return this.bindings[o]?this.bindings[o].push(s):this.bindings[o]=[s],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(o=>{var s;return!(((s=o.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===n&&ll.isEqual(o.filter,r))}),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(et.close,{},e)}_onError(e){this._on(et.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Te.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=Uc(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=Uc(e.columns,e.old_record)),r}}const qc=()=>{},n_=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class o_{constructor(e,r){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=rp,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=qc,this.ref=0,this.logger=qc,this.conn=null,this.sendBuffer=[],this.serializer=new J0,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>Ht(async()=>{const{default:l}=await Promise.resolve().then(()=>bn);return{default:l}},void 0).then(({default:l})=>l(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${la.websocket}`,this.httpEndpoint=sp(e),r?.transport?this.transport=r.transport:this.transport=null,r?.params&&(this.params=r.params),r?.timeout&&(this.timeout=r.timeout),r?.logger&&(this.logger=r.logger),(r?.logLevel||r?.log_level)&&(this.logLevel=r.logLevel||r.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),r?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=r.heartbeatIntervalMs);const o=(n=r?.params)===null||n===void 0?void 0:n.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=r?.reconnectAfterMs?r.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=r?.encode?r.encode:(s,i)=>i(JSON.stringify(s)),this.decode=r?.decode?r.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new np(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(r?.fetch),r?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=r?.worker||!1,this.workerUrl=r?.workerUrl}this.accessToken=r?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=G0),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:K0}))}disconnect(e,r){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,r??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(n=>n.teardown()))}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Ln.connecting:return ar.Connecting;case Ln.open:return ar.Open;case Ln.closing:return ar.Closing;default:return ar.Closed}}isConnected(){return this.connectionState()===ar.Open}channel(e,r={config:{}}){const n=`realtime:${e}`,o=this.getChannels().find(s=>s.topic===n);if(o)return o;{const s=new ll(`realtime:${e}`,r,this);return this.channels.push(s),s}}push(e){const{topic:r,event:n,payload:o,ref:s}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${r} ${n} (${s})`,o),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let r=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const o={access_token:r,version:V0};r&&n.updateJoinPayload(o),n.joinedOnce&&n._isJoined()&&n._push(et.access_token,{access_token:r})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(X0,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,r=>{let{topic:n,event:o,payload:s,ref:i}=r;n==="phoenix"&&o==="phx_reply"&&this.heartbeatCallback(r.payload.status=="ok"?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${n} ${o} ${i&&"("+i+")"||""}`,s),Array.from(this.channels).filter(a=>a._isMember(n)).forEach(a=>a._trigger(o,s,i)),this.stateChangeCallbacks.message.forEach(a=>a(r))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(r=>r(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(r=>r(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(et.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",o=new URLSearchParams(r);return`${e}${n}${o}`}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([n_],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}}class cl extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ke(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class s_ extends cl{constructor(e,r){super(e),this.name="StorageApiError",this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ua extends cl{constructor(e,r){super(e),this.name="StorageUnknownError",this.originalError=r}}var i_=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const ip=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Ht(async()=>{const{default:n}=await Promise.resolve().then(()=>bn);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},a_=()=>i_(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ht(()=>Promise.resolve().then(()=>bn),void 0)).Response:Response}),da=t=>{if(Array.isArray(t))return t.map(r=>da(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const o=r.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[o]=da(n)}),e};var kr=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const ii=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),l_=(t,e,r)=>kr(void 0,void 0,void 0,function*(){const n=yield a_();t instanceof n&&!r?.noResolveJson?t.json().then(o=>{e(new s_(ii(o),t.status||500))}).catch(o=>{e(new ua(ii(o),o))}):e(new ua(ii(t),t))}),c_=(t,e,r,n)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n&&(o.body=JSON.stringify(n)),Object.assign(Object.assign({},o),r))};function io(t,e,r,n,o,s){return kr(this,void 0,void 0,function*(){return new Promise((i,a)=>{t(r,c_(e,n,o,s)).then(l=>{if(!l.ok)throw l;return n?.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>l_(l,a,n))})})}function is(t,e,r,n){return kr(this,void 0,void 0,function*(){return io(t,"GET",e,r,n)})}function Lt(t,e,r,n,o){return kr(this,void 0,void 0,function*(){return io(t,"POST",e,n,o,r)})}function u_(t,e,r,n,o){return kr(this,void 0,void 0,function*(){return io(t,"PUT",e,n,o,r)})}function d_(t,e,r,n){return kr(this,void 0,void 0,function*(){return io(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function ap(t,e,r,n,o){return kr(this,void 0,void 0,function*(){return io(t,"DELETE",e,n,o,r)})}var ze=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const h_={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Vc={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class f_{constructor(e,r={},n,o){this.url=e,this.headers=r,this.bucketId=n,this.fetch=ip(o)}uploadOrUpdate(e,r,n,o){return ze(this,void 0,void 0,function*(){try{let s;const i=Object.assign(Object.assign({},Vc),o);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&n instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",n)):typeof FormData<"u"&&n instanceof FormData?(s=n,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=n,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));const c=this._removeEmptyFolders(r),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:s,headers:a},i?.duplex?{duplex:i.duplex}:{})),h=yield d.json();return d.ok?{data:{path:c,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(s){if(ke(s))return{data:null,error:s};throw s}})}upload(e,r,n){return ze(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,r,n)})}uploadToSignedUrl(e,r,n,o){return ze(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),i=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",r);try{let l;const c=Object.assign({upsert:Vc.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),h=yield d.json();return d.ok?{data:{path:s,fullPath:h.Key},error:null}:{data:null,error:h}}catch(l){if(ke(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,r){return ze(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const o=Object.assign({},this.headers);r?.upsert&&(o["x-upsert"]="true");const s=yield Lt(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:o}),i=new URL(this.url+s.url),a=i.searchParams.get("token");if(!a)throw new cl("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(n){if(ke(n))return{data:null,error:n};throw n}})}update(e,r,n){return ze(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,r,n)})}move(e,r,n){return ze(this,void 0,void 0,function*(){try{return{data:yield Lt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(ke(o))return{data:null,error:o};throw o}})}copy(e,r,n){return ze(this,void 0,void 0,function*(){try{return{data:{path:(yield Lt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(ke(o))return{data:null,error:o};throw o}})}createSignedUrl(e,r,n){return ze(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),s=yield Lt(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:r},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${i}`)},{data:s,error:null}}catch(o){if(ke(o))return{data:null,error:o};throw o}})}createSignedUrls(e,r,n){return ze(this,void 0,void 0,function*(){try{const o=yield Lt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:e},{headers:this.headers}),s=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${s}`):null})),error:null}}catch(o){if(ke(o))return{data:null,error:o};throw o}})}download(e,r){return ze(this,void 0,void 0,function*(){const o=typeof r?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(r?.transform||{}),i=s?`?${s}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield is(this.fetch,`${this.url}/${o}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(ke(a))return{data:null,error:a};throw a}})}info(e){return ze(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{const n=yield is(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:da(n),error:null}}catch(n){if(ke(n))return{data:null,error:n};throw n}})}exists(e){return ze(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{return yield d_(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(ke(n)&&n instanceof ua){const o=n.originalError;if([400,404].includes(o?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,r){const n=this._getFinalPath(e),o=[],s=r?.download?`download=${r.download===!0?"":r.download}`:"";s!==""&&o.push(s);const a=typeof r?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(r?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${c}`)}}}remove(e){return ze(this,void 0,void 0,function*(){try{return{data:yield ap(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(r){if(ke(r))return{data:null,error:r};throw r}})}list(e,r,n){return ze(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},h_),r),{prefix:e||""});return{data:yield Lt(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},n),error:null}}catch(o){if(ke(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const r=[];return e.width&&r.push(`width=${e.width}`),e.height&&r.push(`height=${e.height}`),e.resize&&r.push(`resize=${e.resize}`),e.format&&r.push(`format=${e.format}`),e.quality&&r.push(`quality=${e.quality}`),r.join("&")}}const p_="2.7.1",m_={"X-Client-Info":`storage-js/${p_}`};var zr=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class g_{constructor(e,r={},n){this.url=e,this.headers=Object.assign(Object.assign({},m_),r),this.fetch=ip(n)}listBuckets(){return zr(this,void 0,void 0,function*(){try{return{data:yield is(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(ke(e))return{data:null,error:e};throw e}})}getBucket(e){return zr(this,void 0,void 0,function*(){try{return{data:yield is(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(ke(r))return{data:null,error:r};throw r}})}createBucket(e,r={public:!1}){return zr(this,void 0,void 0,function*(){try{return{data:yield Lt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ke(n))return{data:null,error:n};throw n}})}updateBucket(e,r){return zr(this,void 0,void 0,function*(){try{return{data:yield u_(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ke(n))return{data:null,error:n};throw n}})}emptyBucket(e){return zr(this,void 0,void 0,function*(){try{return{data:yield Lt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(ke(r))return{data:null,error:r};throw r}})}deleteBucket(e){return zr(this,void 0,void 0,function*(){try{return{data:yield ap(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(ke(r))return{data:null,error:r};throw r}})}}class y_ extends g_{constructor(e,r={},n){super(e,r,n)}from(e){return new f_(this.url,this.headers,e,this.fetch)}}const v_="2.51.0";let On="";typeof Deno<"u"?On="deno":typeof document<"u"?On="web":typeof navigator<"u"&&navigator.product==="ReactNative"?On="react-native":On="node";const w_={"X-Client-Info":`supabase-js-${On}/${v_}`},b_={headers:w_},x_={schema:"public"},__={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},S_={};var k_=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const C_=t=>{let e;return t?e=t:typeof fetch>"u"?e=Jf:e=fetch,(...r)=>e(...r)},P_=()=>typeof Headers>"u"?Yf:Headers,A_=(t,e,r)=>{const n=C_(r),o=P_();return(s,i)=>k_(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:t;let c=new o(i?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(s,Object.assign(Object.assign({},i),{headers:c}))})};var E_=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};function T_(t){return t.endsWith("/")?t:t+"/"}function R_(t,e){var r,n;const{db:o,auth:s,realtime:i,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,h={db:Object.assign(Object.assign({},l),o),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(r=d?.headers)!==null&&r!==void 0?r:{}),(n=a?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>E_(this,void 0,void 0,function*(){return""})};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}const lp="2.71.0",Wr=30*1e3,ha=3,ai=ha*Wr,I_="http://localhost:9999",O_="supabase.auth.token",j_={"X-Client-Info":`gotrue-js/${lp}`},fa="X-Supabase-Api-Version",cp={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},$_=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,z_=10*60*1e3;class ul extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function Y(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class N_ extends ul{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function M_(t){return Y(t)&&t.name==="AuthApiError"}class up extends ul{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class Zt extends ul{constructor(e,r,n,o){super(e,n,o),this.name=r,this.status=n}}class Dt extends Zt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function D_(t){return Y(t)&&t.name==="AuthSessionMissingError"}class Ro extends Zt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Io extends Zt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Oo extends Zt{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function L_(t){return Y(t)&&t.name==="AuthImplicitGrantRedirectError"}class Kc extends Zt{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class pa extends Zt{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function li(t){return Y(t)&&t.name==="AuthRetryableFetchError"}class Xc extends Zt{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class ma extends Zt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const as="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Jc=` 	
\r=`.split(""),B_=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Jc.length;e+=1)t[Jc[e].charCodeAt(0)]=-2;for(let e=0;e<as.length;e+=1)t[as[e].charCodeAt(0)]=e;return t})();function Yc(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(as[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(as[n]),e.queuedBits-=6}}function dp(t,e,r){const n=B_[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Zc(t){const e=[],r=i=>{e.push(String.fromCodePoint(i))},n={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},s=i=>{H_(i,n,r)};for(let i=0;i<t.length;i+=1)dp(t.charCodeAt(i),o,s);return e.join("")}function F_(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function U_(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&n<=56319){const o=(n-55296)*1024&65535;n=(t.charCodeAt(r+1)-56320&65535|o)+65536,r+=1}F_(n,e)}}function H_(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let n=1;n<6;n+=1)if((t>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function W_(t){const e=[],r={queue:0,queuedBits:0},n=o=>{e.push(o)};for(let o=0;o<t.length;o+=1)dp(t.charCodeAt(o),r,n);return new Uint8Array(e)}function G_(t){const e=[];return U_(t,r=>e.push(r)),new Uint8Array(e)}function q_(t){const e=[],r={queue:0,queuedBits:0},n=o=>{e.push(o)};return t.forEach(o=>Yc(o,r,n)),Yc(null,r,n),e.join("")}function V_(t){return Math.round(Date.now()/1e3)+t}function K_(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const Qe=()=>typeof window<"u"&&typeof document<"u",tr={tested:!1,writable:!1},hp=()=>{if(!Qe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(tr.tested)return tr.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),tr.tested=!0,tr.writable=!0}catch{tr.tested=!0,tr.writable=!1}return tr.writable};function X_(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((o,s)=>{e[s]=o})}catch{}return r.searchParams.forEach((n,o)=>{e[o]=n}),e}const fp=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Ht(async()=>{const{default:n}=await Promise.resolve().then(()=>bn);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},J_=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Gr=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},rr=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},$t=async(t,e)=>{await t.removeItem(e)};class Ss{constructor(){this.promise=new Ss.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}Ss.promiseConstructor=Promise;function ci(t){const e=t.split(".");if(e.length!==3)throw new ma("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!$_.test(e[n]))throw new ma("JWT not in base64url format");return{header:JSON.parse(Zc(e[0])),payload:JSON.parse(Zc(e[1])),signature:W_(e[2]),raw:{header:e[0],payload:e[1]}}}async function Y_(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Z_(t,e){return new Promise((n,o)=>{(async()=>{for(let s=0;s<1/0;s++)try{const i=await t(s);if(!e(s,null,i)){n(i);return}}catch(i){if(!e(s,i)){o(i);return}}})()})}function Q_(t){return("0"+t.toString(16)).substr(-2)}function eS(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let o="";for(let s=0;s<56;s++)o+=r.charAt(Math.floor(Math.random()*n));return o}return crypto.getRandomValues(e),Array.from(e,Q_).join("")}async function tS(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),o=new Uint8Array(n);return Array.from(o).map(s=>String.fromCharCode(s)).join("")}async function rS(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await tS(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Nr(t,e,r=!1){const n=eS();let o=n;r&&(o+="/PASSWORD_RECOVERY"),await Gr(t,`${e}-code-verifier`,o);const s=await rS(n);return[s,n===s?"plain":"s256"]}const nS=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function oS(t){const e=t.headers.get(fa);if(!e||!e.match(nS))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function sS(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function iS(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const aS=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Mr(t){if(!aS.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ui(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}var lS=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};const or=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),cS=[502,503,504];async function Qc(t){var e;if(!J_(t))throw new pa(or(t),0);if(cS.includes(t.status))throw new pa(or(t),t.status);let r;try{r=await t.json()}catch(s){throw new up(or(s),s)}let n;const o=oS(t);if(o&&o.getTime()>=cp["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new Xc(or(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Dt}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((s,i)=>s&&typeof i=="string",!0))throw new Xc(or(r),t.status,r.weak_password.reasons);throw new N_(or(r),t.status||500,n)}const uS=(t,e,r,n)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(n),Object.assign(Object.assign({},o),r))};async function oe(t,e,r,n){var o;const s=Object.assign({},n?.headers);s[fa]||(s[fa]=cp["2024-01-01"].name),n?.jwt&&(s.Authorization=`Bearer ${n.jwt}`);const i=(o=n?.query)!==null&&o!==void 0?o:{};n?.redirectTo&&(i.redirect_to=n.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await dS(t,e,r+a,{headers:s,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(l):{data:Object.assign({},l),error:null}}async function dS(t,e,r,n,o,s){const i=uS(e,n,o,s);let a;try{a=await t(r,Object.assign({},i))}catch(l){throw console.error(l),new pa(or(l),0)}if(a.ok||await Qc(a),n?.noResolveJson)return a;try{return await a.json()}catch(l){await Qc(l)}}function xt(t){var e;let r=null;mS(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=V_(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function eu(t){const e=xt(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Bt(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function hS(t){return{data:t,error:null}}function fS(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:o,verification_type:s}=t,i=lS(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:r,hashed_token:n,redirect_to:o,verification_type:s},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function pS(t){return t}function mS(t){return t.access_token&&t.refresh_token&&t.expires_in}const di=["global","local","others"];var gS=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};class yS{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=fp(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,r=di[0]){if(di.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${di.join(", ")}`);try{return await oe(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Y(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await oe(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Bt})}catch(n){if(Y(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=gS(e,["options"]),o=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(o.new_email=n?.newEmail,delete o.newEmail),await oe(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:fS,redirectTo:r?.redirectTo})}catch(r){if(Y(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await oe(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Bt})}catch(r){if(Y(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,o,s,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await oe(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(s=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""},xform:pS});if(u.error)throw u.error;const d=await u.json(),h=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,p=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(y=>{const g=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(y.split(";")[1].split("=")[1]);c[`${v}Page`]=g}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(Y(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Mr(e);try{return await oe(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Bt})}catch(r){if(Y(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){Mr(e);try{return await oe(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:Bt})}catch(n){if(Y(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){Mr(e);try{return await oe(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:Bt})}catch(n){if(Y(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Mr(e.userId);try{const{data:r,error:n}=await oe(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:r,error:n}}catch(r){if(Y(r))return{data:null,error:r};throw r}}async _deleteFactor(e){Mr(e.userId),Mr(e.id);try{return{data:await oe(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(Y(r))return{data:null,error:r};throw r}}}function tu(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}function vS(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Dr={debug:!!(globalThis&&hp()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class pp extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class wS extends pp{}async function bS(t,e,r){Dr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Dr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async o=>{if(o){Dr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await r()}finally{Dr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(e===0)throw Dr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new wS(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Dr.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}vS();const xS={url:I_,storageKey:O_,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:j_,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ru(t,e,r){return await r()}const Lr={};class Jn{constructor(e){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Jn.nextInstanceID,Jn.nextInstanceID+=1,this.instanceID>0&&Qe()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},xS),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new yS({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=fp(o.fetch),this.lock=o.lock||ru,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:Qe()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=bS:this.lock=ru,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:hp()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=tu(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=tu(this.memoryStorage)),Qe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,r;return(r=(e=Lr[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Lr[this.storageKey]=Object.assign(Object.assign({},Lr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Lr[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Lr[this.storageKey]=Object.assign(Object.assign({},Lr[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${lp}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const r=X_(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),Qe()&&this.detectSessionInUrl&&n!=="none"){const{data:o,error:s}=await this._getSessionFromURL(r,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),L_(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:i,redirectType:a}=o;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Y(r)?{error:r}:{error:new up("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,o;try{const s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:xt}),{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Y(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var r,n,o;try{let s;if("email"in e){const{email:u,password:d,options:h}=e;let p=null,y=null;this.flowType==="pkce"&&([p,y]=await Nr(this.storage,this.storageKey)),s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h?.emailRedirectTo,body:{email:u,password:d,data:(r=h?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:p,code_challenge_method:y},xform:xt})}else if("phone"in e){const{phone:u,password:d,options:h}=e;s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(n=h?.data)!==null&&n!==void 0?n:{},channel:(o=h?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:xt})}else throw new Io("You must provide either an email or phone number and a password");const{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Y(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let r;if("email"in e){const{email:s,password:i,options:a}=e;r=await oe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:eu})}else if("phone"in e){const{phone:s,password:i,options:a}=e;r=await oe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:eu})}else throw new Io("You must provide either an email or phone number and a password");const{data:n,error:o}=r;return o?{data:{user:null,session:null},error:o}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Ro}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:o})}catch(r){if(Y(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,n,o,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;if(r==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(e){var r,n,o,s,i,a,l,c,u,d,h,p;let y,g;if("message"in e)y=e.message,g=e.signature;else{const{chain:v,wallet:w,statement:_,options:b}=e;let x;if(Qe())if(typeof w=="object")x=w;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))x=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=w}const k=new URL((r=b?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in x&&x.signIn){const C=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b?.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),_?{statement:_}:null));let S;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")S=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)S=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)y=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),g=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${k.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(o=(n=b?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=b?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((i=b?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((a=b?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((c=b?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((d=(u=b?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...b.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const C=await x.signMessage(new TextEncoder().encode(y),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=C}}try{const{data:v,error:w}=await oe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:q_(g)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:xt});if(w)throw w;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new Ro}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:w})}catch(v){if(Y(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const r=await rr(this.storage,`${this.storageKey}-code-verifier`),[n,o]=(r??"").split("/");try{const{data:s,error:i}=await oe(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:xt});if(await $t(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Ro}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:i})}catch(s){if(Y(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:r,provider:n,token:o,access_token:s,nonce:i}=e,a=await oe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:o,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:xt}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Ro}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(r){if(Y(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,n,o,s,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Nr(this.storage,this.storageKey));const{error:d}=await oe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=l?.data)!==null&&r!==void 0?r:{},create_user:(n=l?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await oe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(o=l?.data)!==null&&o!==void 0?o:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(i=l?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new Io("You must provide either an email or phone number.")}catch(a){if(Y(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var r,n;try{let o,s;"options"in e&&(o=(r=e.options)===null||r===void 0?void 0:r.redirectTo,s=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:i,error:a}=await oe(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:xt});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(Y(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var r,n,o;try{let s=null,i=null;return this.flowType==="pkce"&&([s,i]=await Nr(this.storage,this.storageKey)),await oe(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:i}),headers:this.headers,xform:hS})}catch(s){if(Y(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new Dt;const{error:o}=await oe(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(Y(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:o,options:s}=e,{error:i}=await oe(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:n,type:o,options:s}=e,{data:i,error:a}=await oe(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:a}}throw new Io("You must provide either an email or phone number and a type")}catch(r){if(Y(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await rr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<ai:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const i=await rr(this.userStorage,this.storageKey+"-user");i?.user?e.user=i.user:e.user=ui()}if(this.storage.isServer&&e.user){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await oe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Bt}):await this._useSession(async r=>{var n,o,s;const{data:i,error:a}=r;if(a)throw a;return!(!((n=i.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Dt}:await oe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:Bt})})}catch(r){if(Y(r))return D_(r)&&(await this._removeSession(),await $t(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:o,error:s}=n;if(s)throw s;if(!o.session)throw new Dt;const i=o.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Nr(this.storage,this.storageKey));const{data:c,error:u}=await oe(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Bt});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(n){if(Y(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Dt;const r=Date.now()/1e3;let n=r,o=!0,s=null;const{payload:i}=ci(e.access_token);if(i.exp&&(n=i.exp,o=n<=r),o){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(r){if(Y(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:i,error:a}=r;if(a)throw a;e=(n=i.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new Dt;const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Y(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!Qe())throw new Oo("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Oo(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new Kc("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Oo("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Kc("No code detected.");const{data:_,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:o,access_token:s,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!i||!c)throw new Oo("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let h=u+d;l&&(h=parseInt(l));const p=h-u;p*1e3<=Wr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const y=h-d;u-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,h,u):u-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,h,u);const{data:g,error:v}=await this._getUser(s);if(v)throw v;const w={provider_token:n,provider_refresh_token:o,access_token:s,expires_in:d,expires_at:h,refresh_token:i,token_type:c,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(n){if(Y(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await rr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:o,error:s}=r;if(s)return{error:s};const i=(n=o.session)===null||n===void 0?void 0:n.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(M_(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await $t(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const r=K_(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,o;try{const{data:{session:s},error:i}=r;if(i)throw i;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,r={}){let n=null,o=null;this.flowType==="pkce"&&([n,o]=await Nr(this.storage,this.storageKey,!0));try{return await oe(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:o,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(s){if(Y(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(Y(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{const{data:n,error:o}=await this._useSession(async s=>{var i,a,l,c,u;const{data:d,error:h}=s;if(h)throw h;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await oe(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(o)throw o;return Qe()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(Y(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,o;const{data:s,error:i}=r;if(i)throw i;return await oe(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0})})}catch(r){if(Y(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await Z_(async o=>(o>0&&await Y_(200*Math.pow(2,o-1)),this._debug(r,"refreshing attempt",o),await oe(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:xt})),(o,s)=>{const i=200*Math.pow(2,o);return s&&li(s)&&Date.now()+i-n<Wr})}catch(n){if(this._debug(r,"error",n),Y(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),Qe()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const o=await rr(this.storage,this.storageKey);if(o&&this.userStorage){let i=await rr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:o.user},await Gr(this.userStorage,this.storageKey+"-user",i)),o.user=(e=i?.user)!==null&&e!==void 0?e:ui()}else if(o&&!o.user&&!o.user){const i=await rr(this.storage,this.storageKey+"-user");i&&i?.user?(o.user=i.user,await $t(this.storage,this.storageKey+"-user"),await Gr(this.storage,this.storageKey,o)):o.user=ui()}if(this._debug(n,"session from storage",o),!this._isValidSession(o)){this._debug(n,"session is not valid"),o!==null&&await this._removeSession();return}const s=((r=o.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<ai;if(this._debug(n,`session has${s?"":" not"} expired with margin of ${ai}s`),s){if(this.autoRefreshToken&&o.refresh_token){const{error:i}=await this._callRefreshToken(o.refresh_token);i&&(console.error(i),li(i)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:a}=await this._getUser(o.access_token);!a&&i?.user?(o.user=i.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(n,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(n,"error",o),console.error(o);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new Dt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Ss;const{data:s,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new Dt;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(o,"error",s),Y(s)){const i={session:null,error:s};return li(s)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(i),i}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,r,n=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const s=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,r)}catch(l){s.push(l)}});if(await Promise.all(i),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const r=Object.assign({},e),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Gr(this.userStorage,this.storageKey+"-user",{user:r.user});const o=Object.assign({},r);delete o.user;const s=structuredClone(o);await Gr(this.storage,this.storageKey,s)}else{const o=structuredClone(r);await Gr(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await $t(this.storage,this.storageKey),await $t(this.storage,this.storageKey+"-code-verifier"),await $t(this.storage,this.storageKey+"-user"),this.userStorage&&await $t(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Qe()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Wr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((n.expires_at*1e3-e)/Wr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Wr}ms, refresh threshold is ${ha} ticks`),o<=ha&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof pp)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Qe()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const o=[`provider=${encodeURIComponent(r)}`];if(n?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&o.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[s,i]=await Nr(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(i)}`});o.push(a.toString())}if(n?.queryParams){const s=new URLSearchParams(n.queryParams);o.push(s.toString())}return n?.skipBrowserRedirect&&o.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;return s?{data:null,error:s}:await oe(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Y(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,o;const{data:s,error:i}=r;if(i)return{data:null,error:i};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await oe(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((o=l?.totp)===null||o===void 0)&&o.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(r){if(Y(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;if(s)return{data:null,error:s};const{data:i,error:a}=await oe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(r){if(Y(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;return s?{data:null,error:s}:await oe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Y(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=e?.factors||[],o=n.filter(i=>i.factor_type==="totp"&&i.status==="verified"),s=n.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:n,totp:o,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,n;const{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=ci(o.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((n=(r=o.user.factors)===null||r===void 0?void 0:r.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,r={keys:[]}){let n=r.keys.find(a=>a.kid===e);if(n)return n;const o=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+z_>o)return n;const{data:s,error:i}=await oe(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=o,n=s.keys.find(a=>a.kid===e),!n)?null:n}async getClaims(e,r={}){try{let n=e;if(!n){const{data:p,error:y}=await this.getSession();if(y||!p.session)return{data:null,error:y};n=p.session.access_token}const{header:o,payload:s,signature:i,raw:{header:a,payload:l}}=ci(n);r?.allowExpired||sS(s.exp);const c=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!c){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:s,header:o,signature:i},error:null}}const u=iS(o.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,i,G_(`${a}.${l}`)))throw new ma("Invalid JWT signature");return{data:{claims:s,header:o,signature:i},error:null}}catch(n){if(Y(n))return{data:null,error:n};throw n}}}Jn.nextInstanceID=0;const _S=Jn;class SS extends _S{constructor(e){super(e)}}var kS=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class CS{constructor(e,r,n){var o,s,i;if(this.supabaseUrl=e,this.supabaseKey=r,!e)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const a=T_(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:x_,realtime:S_,auth:Object.assign(Object.assign({},__),{storageKey:c}),global:b_},d=R_(n??{},u);this.storageKey=(o=d.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=A_(r,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new H0(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new I0(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new y_(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,r={},n={}){return this.rest.rpc(e,r,n)}channel(e,r={config:{}}){return this.realtime.channel(e,r)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,r;return kS(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&r!==void 0?r:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:o,storageKey:s,flowType:i,lock:a,debug:l},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SS({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:s,autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:o,flowType:i,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new o_(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n?.access_token)})}_handleTokenChanged(e,r,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const PS=(t,e,r)=>new CS(t,e,r),dn=PS("https://pkswdnpftrundnewgnya.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrc3dkbnBmdHJ1bmRuZXdnbnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODI2MzIsImV4cCI6MjA2ODI1ODYzMn0.r_Y1RLOGJ55C0De5SBTVXqO09SMDqgV38sQuE-oDxXE"),AS=async(t,e)=>{const r=await dn.rpc("save_campaign_version",{p_name:t,p_data:await Xf(e)});if(r.error)throw new Error(`error saving to db ${r.error.message} ${r.error.details}`,{cause:r.error});return r.data},ES=async t=>{const e=await dn.rpc("get_latest_campaign",{p_name:t});if(e.error)throw e.error;return await A0(e.data.data)},mp=()=>{const[t,e]=m.useState(null);return m.useEffect(()=>{dn.auth.getUser().then(({data:{user:n}})=>{e(n)});const{data:{subscription:r}}=dn.auth.onAuthStateChange((n,o)=>{e(o?.user??null)});return()=>r.unsubscribe()},[]),t},TS=2e3,RS=()=>{const t=mp(),e=me(({levelEditor:{savedCampaign:i,campaignInProgress:a}})=>Be(i,a)),[r,n]=m.useState(0),o=async()=>{const i=L.getState(),a=kd(i);console.info("saving...",a);const l=await AS("sequel",a);console.info(`...saved as v${l}`),L.dispatch(_g({campaign:a})),n(c=>c+1),setTimeout(()=>n(c=>c-1),TS)},s=async()=>{try{const i=await ES("sequel");console.info("loaded",i),L.dispatch(Sg({campaign:i}))}catch(i){console.error(i)}};return f.jsxs(f.Fragment,{children:[r>0?f.jsx(xe,{disabled:!0,className:"!bg-moss !text-white",children:f.jsx(F,{className:"relative leading-none",children:"OK!"})}):f.jsx(xe,{disabled:t===null||e,onClick:o,shortcutKeys:["^S","⌘S"],children:f.jsx(Xn,{icon:f.jsxs("div",{className:"flex flex-row items-center",children:[f.jsx("span",{className:Ae("sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative",{"text-lightGrey":t===null})}),f.jsx("span",{className:Ae("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})})]}),topText:"sa",bottomText:"ve"})}),f.jsx(xe,{disabled:t===null,onClick:s,children:f.jsx(Xn,{icon:f.jsxs("div",{className:"flex flex-row items-center",children:[f.jsx("span",{className:Ae("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})}),f.jsx("span",{className:Ae("sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative",{"text-lightGrey":t===null})})]}),topText:"lo",bottomText:"ad"})})]})},IS=()=>f.jsx(xe,{children:f.jsx(F,{className:"relative leading-none",children:"MAP"})}),OS=()=>{const[t,e]=m.useState(!0),[r,n]=m.useState(!0);return f.jsx(Hf,{main:f.jsx(xe,{onClick:async()=>{const o=L.getState(),s=kd(o),i=await Xf(s),a=new URL("https://blockstack.ing"),l=a.searchParams;l.set("campaignData",i),l.set("noSaves","1"),l.set("cheats","1"),r&&l.set("playAsHeels","1"),t||(a.hash=o.levelEditor.currentlyEditingRoomId),window.open(a.toString(),"playtest")},shortcutKeys:["⌘P","^P"],children:f.jsx(Xn,{topText:"pl",bottomText:"ay",icon:f.jsx("span",{className:"sprite texture-joystick mt-half"})})}),children:[f.jsx(Kn,{className:"w-full",value:t,label:"from",falseLabel:"room",trueLabel:"start",onChange:o=>e(o)},"fromStart"),f.jsx(Kn,{className:"w-full",value:r,label:"as",falseLabel:"head",trueLabel:"heels",onChange:o=>n(o)},"playAsHeels")]})},jS=t=>{switch(t){case"github":return md;case"discord":return gd;default:throw new Error}},$S=({className:t})=>{const e=mp(),r=o=>async()=>{const s=new URL(window.location.href);s.hash="";const i=s.toString(),{error:a}=await dn.auth.signInWithOAuth({provider:o,options:{redirectTo:i}});a&&console.error("Login error:",a)},n=async()=>{const{error:o}=await dn.auth.signOut();o&&console.error("Logout error:",o)};return f.jsx("div",{className:Ae(t),children:e?f.jsxs("div",{className:"bg-moss",children:[f.jsx(F,{noSlitWords:!0,className:"overflow-hidden",children:`${jS(e.app_metadata.provider)}${e.email}`}),f.jsx(Ct,{className:"px-1 w-full",onClick:n,children:f.jsx(F,{children:"Logout"})})]}):f.jsxs("div",{className:"px-1 bg-midRed",children:[f.jsx(F,{className:"block w-full sprites-double-height pb-1",children:"Not logged in"}),f.jsx(F,{className:"block w-full text-highlightBeige",children:"You will not be able to save"}),f.jsxs("div",{className:"pt-1 flex flex-col gap-half",children:[f.jsx(F,{children:"Log in with:"}),f.jsxs(Ct,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:r("github"),children:[f.jsx(F,{children:md}),f.jsx(F,{children:"GitHub"})]}),f.jsxs(Ct,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:r("discord"),children:[f.jsx(F,{children:gd}),f.jsx(F,{children:"Discord"})]})]})]})})},zS=()=>{const t=Xe(),e=me(r=>Object.keys(r.levelEditor.campaignInProgress.rooms).length>1);return f.jsxs(f.Fragment,{children:[f.jsx(xe,{className:"bg-moss",onClick:()=>t(kg()),children:f.jsx("span",{className:"sprite texture-hud_char_+ relative"})}),f.jsx(xe,{className:"bg-midRed",onClick:()=>t(Cg()),disabled:!e,children:f.jsx("span",{className:"sprite texture-hud_char_X relative"})})]})},Re={x:12,y:12,z:H.h},NS={x:14,y:14,z:H.h},lr={x:16,y:16,z:H.h},hi={...Re,z:H.h*2},gp=t=>{switch(t.type){case"spring":case"portableBlock":case"moveableDeadly":case"slidingDeadly":case"firedDoughnut":return{aabb:Re};case"slidingBlock":return t.config.style==="book"?{aabb:lr}:{aabb:Re};case"lift":return{aabb:{...Re,z:Re.z}};case"switch":return{aabb:{...Re,z:Re.z}};case"pickup":return t.config.gives==="scroll"?{aabb:{x:16,y:4,z:13}}:{aabb:Re};case"charles":return{aabb:hi};case"ball":return{aabb:{x:12,y:12,z:12}};case"pushableBlock":case"movingPlatform":return{aabb:lr};case"block":switch(t.config.style){case"artificial":case"organic":case"book":return{aabb:lr};case"tower":return{aabb:{x:11,y:11,z:H.h}};default:throw new Error("unknown block style")}case"monster":switch(t.config.which){case"skiHead":return{aabb:{...Re,z:21}};case"bubbleRobot":case"cyberman":case"elephant":case"emperorsGuardian":case"monkey":case"computerBot":return{aabb:hi};case"helicopterBug":case"dalek":case"emperor":case"homingBot":case"elephantHead":return{aabb:Re};case"turtle":return{aabb:Re};default:throw t.config,new Error("unknown monster type")}case"deadlyBlock":case"spikes":return{aabb:lr};case"bubbles":return{aabb:Re};case"conveyor":case"hushPuppy":case"teleporter":return{aabb:lr};case"barrier":return{aabb:t.config.axis==="y"?{x:3,y:15,z:H.h}:{x:15,y:3,z:H.h}};case"sceneryPlayer":return t.config.which==="headOverHeels"?{aabb:hi}:{aabb:Re};case"emitter":return{aabb:fe};default:return{aabb:NS}}},tt={aabb:Re},MS=({config:{direction:t},position:e})=>t==="right"&&e.x===0||t==="towards"&&e.y===0,nu=zm/1e3,yp={firedDoughnut:2*nu,floatingText:nu},ao=11,ou=6e4,DS=9999,LS=8,BS=750,FS=2500,su=200,US=.15,vp=50,fi=({x:t=0,y:e=0})=>e-t,Q=({x:t=0,y:e=0,z:r=0})=>({x:e-t,y:-(t+e)/2-r}),HS=(t,e,r)=>{const n=Q(t),o=fr(r,n);return W(wp(e,o),t)},wp=(t,{x:e,y:r})=>{switch(yd(t)){case"xy":return{x:-e/2-r,y:e/2-r,z:0};case"xz":return{x:-e,y:0,z:e/2-r};case"yz":return{x:0,y:e,z:-e/2-r};default:throw new Error("only axis-aligned planes are supported for unprojection")}},ye=({x:t=0,y:e=0,z:r=0})=>({x:t*H.w,y:e*H.d,z:r*H.h}),qo=({x:t=0,y:e=0,z:r=0})=>({x:t/H.w,y:e/H.d,z:r/H.h}),wr=t=>Q(ye(t)),ga=t=>{const e=ye(t.position),{aabb:r}=gp(t);if(r===void 0)throw new Error(`item type= ${t.type} config=${JSON.stringify(t.config)} has no bounding box`);return t.type==="wall"?e:W(e,{x:H.w-r.x>>1,y:H.d-r.y>>1})},Ne=()=>({expires:null,stoodOnBy:{},disappearing:null,switchedAtRoomTime:Pe,stoodOnUntilRoomTime:Pe}),iu=()=>({standingOnItemId:null,vels:{gravity:fe,movingFloor:fe},latentMovement:[],actedOnAt:{roomTime:Pe,by:le},collidedWith:{roomTime:Pe,by:le}}),WS=t=>{const e=Pg.includes(t.type);return{...Ne(),position:ga(t),...e?{standingOnItemId:null,vels:{gravity:fe,movingFloor:fe,...Ag.includes(t.type)?{sliding:fe}:{},...t.type==="monster"||t.type==="movingPlatform"?{walking:fe}:{}},latentMovement:[],actedOnAt:{roomTime:Pe,by:le},collidedWith:{roomTime:Pe,by:le}}:{},...t.type==="monster"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",timeOfLastDirectionChange:Number.NEGATIVE_INFINITY,...t.config.which==="skiHead"||t.config.which==="turtle"||t.config.which==="elephantHead"||t.config.which==="cyberman"?{facing:Ce[t.config.startDirection]}:{facing:Ce.towards}}:{},...t.type==="pickup"?{disappearing:{on:"touch",byType:t.config.gives==="bag"||t.config.gives==="jumps"?["heels","headOverHeels"]:t.config.gives==="doughnuts"||t.config.gives==="hooter"||t.config.gives==="fast"?["head","headOverHeels"]:["head","heels","headOverHeels"]}}:{},...t.type==="movingPlatform"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",facing:Ce[t.config.startDirection]}:{},...t.type==="switch"?{setting:t.config.initialSetting,touchedOnProgression:-1}:{},...t.type==="block"?{disappearing:t.config.disappearing??null}:{},...t.type==="conveyor"?{disappearing:t.config.disappearing??null}:{},...t.type==="barrier"?{disappearing:t.config.disappearing??null}:{},...t.type==="lift"?{direction:"up",vels:{lift:fe}}:{},...t.type==="charles"?{facing:Ce.towards}:{},...t.type==="emitter"?{lastEmittedAtRoomTime:Pe,quantityEmitted:0}:{},...t.type==="firedDoughnut"?{disappearing:{on:"touch"},vels:{fired:t.config.direction?ds(Ce[t.config.direction],yp.firedDoughnut):fe}}:{}}},pi=H.h*2,bp=4,jn=H.h*bp,GS=2,qS=2*H.w;function*VS(t,e){const{config:{direction:r},position:n}=t,o=eo(r),s=gn(o),i=MS(t),a={...fe,[s]:i?-.5:0},l=1,c={[s]:i?-1:0},u=l*H.w,d={...fe,[s]:u},h=9,p=8,y=8;{const g={[o]:p,[s]:y,z:jn};yield{...t,...tt,type:"doorFrame",id:`${e}/frameFar`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"far"},state:{...Ne(),position:ye(W(n,{[o]:1.5},a,c)),stoodOnBy:le},aabb:W(g,d),renderAabb:g,renderAabbOffset:i?d:void 0}}{const g={[o]:h,[s]:y,z:jn};yield{...t,...tt,type:"doorFrame",id:`${e}/frameNear`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"near"},state:{...Ne(),position:ye(W(n,a,c)),stoodOnBy:le},aabb:W(g,d),renderAabb:g,renderAabbOffset:i?d:void 0}}{const g={[o]:2*H.w-h-p,[s]:y,z:jn-pi};yield{...t,...tt,type:"doorFrame",id:`${e}/frameTop`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"top"},state:{...Ne(),position:W(ye(W(n,a,c)),{[o]:h,z:pi}),stoodOnBy:le},aabb:W(g,d),renderAabb:g,renderAabbOffset:i?d:void 0}}yield{...t,...tt,type:"blocker",id:`${e}/blockerAbove`,jsonItemId:e,config:{},renders:!1,state:{...Ne(),position:W(ye(W(n,a,c)),{z:jn}),stoodOnBy:le},aabb:W(ye({[o]:2,[s]:l,z:ao-bp-n.z}),{[s]:y}),renderAabb:fe,fixedZIndex:ur},yield{...t,...tt,type:"portal",id:`${e}/portal`,jsonItemId:e,config:{...Eg(t.config,"toRoom","toDoor"),inHidden:i,relativePoint:ye({...fe,[s]:i?.25:-.25}),direction:Ce[r]},fixedZIndex:ur,state:{...Ne(),position:W(ye(W(n,{[s]:i?-.5:.5})),{[o]:h}),stoodOnBy:le},aabb:{[o]:GS*H.w-h-p,[s]:0,z:pi}},n.z!==0&&(yield{...t,...tt,type:"doorLegs",id:`${e}/legs`,jsonItemId:e,config:{...t.config,inHiddenWall:i,style:"none",side:"away",height:n.z},renders:!0,shadowCastTexture:i?{textureId:"shadow.door.floatingThreshold.double.y",flipX:o==="x"}:void 0,state:{...Ne(),position:{...ye(W(n,a,c)),z:0}},aabb:W(ye({[o]:2,[s]:.5,z:n.z}),d),renderAabb:i?W(ye({[o]:2,[s]:.5,z:.5})):void 0,renderAabbOffset:i?W({[o]:0,[s]:0,z:(n.z-.5)*H.h},{[s]:d[s]}):void 0,shadowOffset:{z:n.z*H.h,[s]:i?d[s]:void 0}}),yield{type:"stopAutowalk",id:`${e}/stopAutowalk`,jsonItemId:e,aabb:ye({[o]:2,[s]:0,z:2}),config:{},fixedZIndex:ur,state:{...Ne(),position:ye(rn(n,ds(Ce[r],.75))),stoodOnBy:le}}}const au={config:le,shadowCastTexture:"shadow.smallRound",aabb:Re},lu=()=>{const t=Mm(L.getState());return{action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:Ce.towards,walkStartFacing:Ce.towards,walkDistance:0,vels:{walking:fe,gravity:fe,movingFloor:fe},switchedToAt:Pe,lastDiedAt:Pe,gameTime:0,jumpStartTime:Pe,lives:t?"infinite":LS,jumpStartZ:0}},KS=(t,e)=>{const r=Nm(L.getState());return t.config.which==="head"?{id:e,jsonItemId:e,type:"head",...tt,...au,state:{...Ne(),...iu(),...lu(),hasHooter:!1,gameWalkDistance:0,fastStepsStartedAtDistance:Pe,shieldCollectedAt:Pe,doughnuts:r?"infinite":0,position:ga(t),stoodOnUntilRoomTime:Pe}}:{id:e,jsonItemId:e,type:"heels",...tt,...au,state:{...Ne(),...iu(),...lu(),carrying:null,hasBag:!1,bigJumps:0,isBigJump:!1,shieldCollectedAt:Pe,position:ga(t),stoodOnUntilRoomTime:Pe}}},Yn=(t,e={})=>{const r=Tg(e),n=rn(Ac,t);return rn(Dm(r,Ac),n)},xp=1,XS=(t=ao)=>({x:H.w,y:H.d*xp,z:t*H.h}),JS={x:H.w,y:0,z:vp},YS=(t=ao)=>({x:H.w*xp,y:H.d,z:t*H.h}),ZS={x:0,y:H.d,z:vp},QS=(t,e,r)=>{const{config:{direction:n},position:o}=e,s=ja(e.config),{size:{z:i}}=r,a=eo(n),l=gn(a),c=Rg(n),u={...fe,[l]:c?-1:0};return{type:"wall",id:t,jsonItemId:t,config:e.config,aabb:Yn(a==="y"?YS(i):XS(i),s),renderAabb:c?fe:Yn(a==="y"?ZS:JS,s),fixedZIndex:c?ur:void 0,state:{...Ne(),position:ye(W(o,u)),stoodOnBy:le},shadowCastTexture:a==="y"?"shadow.wall.y":{textureId:"shadow.wall.y",flipX:!0}}},ek=3,cu=10,uu=.52,du=.5,tk=(t,e,r)=>{const{config:{times:n},position:o}=e,s=W(o,{z:-3}),i={...n,z:ek};let a=s,l=i;const c=gt(Yo(r.items)).filter(h=>h.type==="door");if(o.z===0){const h={};for(const p of c){const{position:y,config:{direction:g}}=p;switch(g){case"towards":!h.towards&&y.y===s.y&&(l=W(l,{y:du}),a=W(a,{y:-.5}),h.towards=!0);break;case"away":!h.away&&y.y===s.y+n.y&&(l=W(l,{y:uu}),h.away=!0);break;case"right":!h.right&&y.x===s.x&&(l=W(l,{x:du}),a=W(a,{x:-.5}),h.right=!0);break;case"left":!h.left&&y.x===s.x+n.x&&(l=W(l,{x:uu}),h.left=!0);break}}}const u=ye(a),d=Yn(lr,l);return{type:"floor",id:t,jsonItemId:t,config:{...e.config,naturalFootprint:{aabb:Yn(lr,i),position:ye(s)}},aabb:d,renderAabb:{...d,z:cu},renderAabbOffset:{...fe,z:d.z-cu},shadowCastTexture:"shadow.fullBlock",state:{...Ne(),position:u}}};function*dl(t,e,r,n=le,o={}){if(!n[t]&&!(e.type==="pickup"&&e.config.gives==="scroll"&&o[e.config.page]))switch(e.type){case"door":return yield*VS(e,t);case"player":{yield KS(e,t);return}case"wall":{yield QS(t,e,r);return}case"floor":{yield tk(t,e,r);return}case"sceneryCrown":if(!L.getState().gameMenus.planetsLiberated[e.config.planet])return;default:{const s=gp(e),i=e.config.times!==void 0?{aabb:Yn(s.aabb,e.config.times),renderAabb:void 0}:s;let a;try{a=WS(e)}catch(l){throw new Error(`loadItemFromJson: error creating initial state for jsonItem ${JSON.stringify(e,null,2)}`,{cause:l})}yield{...e,...tt,...i,id:t,jsonItemId:t,fixedZIndex:e.type==="emitter"?ur:void 0,shadowCastTexture:rk(e),config:e.config,state:a}}}}const rk=t=>{switch(t.type){case"lift":return"shadow.smallBlock";case"conveyor":return{textureId:"shadow.fullBlock",flipX:Gt(t.config.direction)==="x"};case"barrier":return{textureId:"shadow.barrier.y",flipX:t.config.axis==="x"};case"spring":case"firedDoughnut":case"slidingDeadly":return"shadow.smallRound";case"block":return t.config.style==="tower"?"shadow.smallRound":"shadow.fullBlock";case"pushableBlock":case"movingPlatform":case"hushPuppy":case"deadlyBlock":case"teleporter":case"spikes":return"shadow.fullBlock";case"portableBlock":return t.config.style==="drum"?"shadow.smallRound":"shadow.smallBlock";case"pickup":return t.config.gives==="scroll"?"shadow.scroll":"shadow.smallRound";case"ball":case"charles":case"monster":return"shadow.smallRound";case"slidingBlock":return t.config.style==="book"?"shadow.fullBlock":"shadow.smallRound"}},ks=({aabb:t,state:{position:e}},{aabb:r,state:{position:n}})=>!(e.x+t.x<=n.x||e.x>=n.x+r.x)&&!(e.y+t.y<=n.y||e.y>=n.y+r.y)&&!(e.z+t.z<=n.z||e.z>=n.z+r.z),nk=(t,e)=>[...gt(e).filter(r=>t.id!==r.id&&ks(t,r))];function*ya(t,e){for(const r of e)t.id!==r.id&&ks(t,r)&&(yield r)}function*ok(t){const e=t.size.z??ao,r=ye({...t.size,z:1}),n=ye({...dr,z:-1});if(t.roomBelow!==void 0&&(yield{...tt,type:"portal",id:"floor/portal",fixedZIndex:ur,config:{toRoom:t.roomBelow,relativePoint:{x:r.x/2,y:r.y/2,z:r.z},direction:Ce.down},aabb:r,state:{...Ne(),position:n},renders:!1}),t.roomAbove!==void 0){const o=W(n,{z:H.h*e});yield{...tt,type:"portal",id:"ceiling",fixedZIndex:ur,config:{toRoom:t.roomAbove,relativePoint:{...t.ceilingRelativePoint!==void 0?ye(t.ceilingRelativePoint):{x:r.x/2,y:r.y/2},z:-12},direction:Ce.up},aabb:r,state:{...Ne(),position:o}}}}const sk=(t,e,r,n)=>{const o=Math.max(0,Math.min(t.x+e.x,r.x+n.x)-Math.max(t.x,r.x)),s=Math.max(0,Math.min(t.y+e.y,r.y+n.y)-Math.max(t.y,r.y));return o*s},hu=({state:{position:t},aabb:e},{state:{position:r},aabb:n})=>sk(t,e,r,n),fu={stopAutowalk:5,portal:5,wall:5,blocker:5,doorLegs:5,sceneryPlayer:5,bubbles:5,switch:10,doorFrame:15,ball:18,block:20,barrier:20,floor:20,hushPuppy:20,teleporter:20,lift:30,movingPlatform:30,pushableBlock:30,portableBlock:30,sceneryCrown:30,slidingBlock:30,spring:30,joystick:40,charles:40,conveyor:40,head:50,heels:50,headOverHeels:50,pickup:80,firedDoughnut:90,spikes:98,slidingDeadly:100,moveableDeadly:100,deadlyBlock:100,monster:100,floatingText:200,particle:200,emitter:200},ik=(t,e)=>fu[t.type]-fu[e.type],ak=(t,e,r=.001)=>{if(!sn(e,t)||t.id===e.id)return!1;const{state:{vels:{gravity:{z:n}}}}=t;return n>0?!1:ks({state:{position:W(t.state.position,{x:0,y:0,z:-1e-4})},aabb:{...t.aabb,z:r+vd},id:t.id},{state:{position:W(e.state.position,{x:0,y:0,z:e.aabb.z})},aabb:{...e.aabb,z:0},id:e.id})},lk=(t,e)=>{const n=[...gt(e).filter(s=>ak(t,s))];return n.length===0?void 0:n.reduce((s,i)=>{const a=ik(i,s);return a<0||a===0&&hu(t,i)>hu(t,s)?i:s})},ck=({above:t,below:e})=>{const r=e.state.stoodOnBy;if(!Object.isExtensible(r))throw new Error(`${t.id} can't stand on ${e.id} - its standingOn is not extensible`);t.state.standingOnItemId=e.id,r[t.id]=!0};function*uk(t,e,r,n){const o=Bm(t.items);for(const[s,i]of o)i.type==="player"&&!n||(yield*dl(s,i,t,e,r))}const pu=t=>gt(t).reduce((e,r)=>({...e,[r.id]:r}),{}),mi=({roomJson:t,roomPickupsCollected:e,scrollsRead:r,isNewGame:n=!1})=>{const o={...pu(ok(t)),...pu(uk(t,e,r,n))};for(const i of He(o)){const l=nk(i,Lm(o)).find(c=>sn(i)&&sn(c)&&!(i.type==="wall"&&c.type==="wall"));l!==void 0&&console.error(`in room ${t.id} item ${i.id} @${JSON.stringify(i.state.position)} #${JSON.stringify(i.aabb)} is colliding with (solid item) ${l.id} @${JSON.stringify(l.state.position)} #${JSON.stringify(l.aabb)} on loading room ${t.id}`)}for(const i of He(o).filter(Ig)){const a=lk(i,He(o).filter(l=>l.id!==i.id));a!==void 0&&ck({above:i,below:a})}return{...t,roomJson:t,items:o,roomTime:0}},dk=t=>()=>_r(t),uE=dk(on),hk=Md([on,t=>t.levelEditor.previewedEdits],(t,e)=>wd(t,r=>{const n=bd(e);for(const[o,s]of n)s===null?delete r.items[o]:r.items[o]=s})),hl=m.createContext(null),fk=()=>{const[t,e]=m.useState(()=>mi({roomJson:on(L.getState()),roomPickupsCollected:le,scrollsRead:le,isNewGame:!0})),[r,n]=m.useState(t),o=me(on),s=me(hk);return m.useEffect(()=>{const i=mi({roomJson:o,roomPickupsCollected:le,scrollsRead:le,isNewGame:!0});if(e(i),o===s)n(i);else{const a=mi({roomJson:s,roomPickupsCollected:le,scrollsRead:le,isNewGame:!0});n(a)}},[o,s]),{roomState:t,roomStateWithPreviews:r}},pk=({children:t})=>{const e=fk();return f.jsx(hl,{value:e,children:t})},_p=()=>{const t=m.useContext(hl);if(t===null)throw new Error("no room state in context, or no context");return t.roomState},Sp=()=>{const t=m.useContext(hl);if(t===null)throw new Error("no room state in context, or no context");return t.roomStateWithPreviews},mk=t=>He(t.items).filter(e=>sn(e)),kp=(t,e)=>{const r=gt(mk(t));return e==="door"?r.filter(o=>o.type!=="wall"):r},Cp=({roomState:t,jsonItemIds:e,blockPositionDelta:r,timesDelta:n})=>{const o=Hl(Bl(a=>[a,t.roomJson.items[a]]),Bl(([a,l])=>[a,wd(l,c=>{c.position=W(c.position,r),Og(c,n)})]),ly(function*([a,l]){for(const c of dl(a,l,t.roomJson))yield[a,l,c]}),jg(([,,a])=>sn(a))),s=Array.from(o(e));return Hl(by(([,a,l])=>{const c=gt(kp(t,a.type)).filter(u=>u.jsonItemId&&!e.includes(u.jsonItemId));for(const u of ya(l,c))return console.warn(l.id,"colliding with static item",u.id),!0;for(const u of ya(l,s.map(([d,h,p])=>p)))return console.warn(l.id,"colliding with other mutating item",u.id),!0;return!1}))(s)},gk=({roomState:t,blockPosition:e,itemTool:r})=>{const n=dl("maybeAddedItem",{...r,position:e},t.roomJson),o=Array.from(kp(t,r.type));return n.some(s=>{const i=ya(s,o);return!Ld(i)})},yk=()=>{const t=Xe(),e=me(o=>o.levelEditor.selectedJsonItemIds.length>0),r=_p(),n=o=>{if(r===null)return;const i=L.getState().levelEditor.selectedJsonItemIds;if(Cp({roomState:r,jsonItemIds:i,blockPositionDelta:o})){console.warn("nudge would collide");return}t(Cd({jsonItemIds:i,positionDelta:o})),t(Pd())};return f.jsxs("div",{className:"flex flex-row flex-wrap gap-x-0 gap-y-oneScaledPix items-center",children:[f.jsx(F,{className:"inline-block mr-1 text-lightGrey leading-none",noSlitWords:!0,children:"move"}),f.jsxs("div",{className:"flex flex-row flex-wrap gap-oneScaledPix items-center",children:[f.jsx(xe,{small:!0,disabled:!e,onClick:()=>{n(Ce.left)},shortcutKeys:["ArrowLeft"],children:f.jsx(F,{className:"relative leading-none",children:"↖"})}),f.jsx(xe,{small:!0,disabled:!e,onClick:()=>{n(Ce.right)},shortcutKeys:["ArrowRight"],children:f.jsx(F,{className:"relative leading-none",children:"↘"})}),f.jsx(xe,{small:!0,disabled:!e,onClick:()=>{n(Ce.away)},shortcutKeys:["ArrowUp"],children:f.jsx(F,{className:"relative leading-none",children:"↗"})}),f.jsx(xe,{small:!0,disabled:!e,onClick:()=>{n(Ce.towards)},shortcutKeys:["ArrowDown"],children:f.jsx(F,{className:"relative leading-none",children:"↙"})}),f.jsx(xe,{small:!0,disabled:!e,onClick:()=>{n(Ce.up)},shortcutKeys:["⇧ArrowUp"],children:f.jsx(F,{className:"relative leading-none",children:"⬆"})}),f.jsx(xe,{small:!0,disabled:!e,onClick:()=>{n(Ce.down)},shortcutKeys:["⇧ArrowDown"],children:f.jsx(F,{className:"relative leading-none",children:"⬇"})})]})]})},vk=()=>{const t=me(n=>n.levelEditor.campaignInProgress),e=me(n=>n.levelEditor.currentlyEditingRoomId),r=Xe();return f.jsxs("div",{className:"scale-editor flex w-full h-full text-white bg-metallicBlueHalfbrite pb-1 gap-1 flex-wrap justify-start overflow-auto",children:[f.jsx("div",{className:Ee,children:f.jsx($S,{className:"w-full mb-1"})}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full",children:"Campaign"}),f.jsx(RS,{}),f.jsx(IS,{}),f.jsx(OS,{})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full pt-2",children:"Room"}),f.jsx(zS,{}),f.jsx(Bf,{value:e,campaign:t,onSelect:n=>{r(Li(n))},triggerButtonClassName:"w-full"}),f.jsx("div",{className:"h-1 w-full"}),f.jsx(n0,{}),f.jsx(r0,{}),f.jsx("div",{className:"h-1 w-full"}),f.jsx(h0,{}),f.jsx(f0,{})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full pt-2",children:"Edit"}),f.jsxs("div",{className:Ee,children:[f.jsx(t0,{}),f.jsx(p0,{})]}),f.jsx(a0,{}),f.jsx(Qx,{}),f.jsx(d0,{}),f.jsx(yk,{}),f.jsx("div",{className:"h-1 w-full"}),f.jsxs("div",{className:"flex flex-row justify-between flex-wrap gap-x-2",children:[f.jsx(e0,{}),f.jsx(l0,{})]})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full pt-2",children:"Blocks"}),f.jsx(j,{itemTool:{type:"block",config:{style:"organic"}},shortcutKeys:["B"],children:f.jsx("span",{className:`sprite texture-block_organic ${B}`})}),f.jsx(j,{itemTool:{type:"block",config:{style:"organic",disappearing:{on:"stand"}}},children:f.jsx(Ao,{iconClassName:pe("texture-block_organic_disappearing")})}),f.jsx(j,{itemTool:{type:"block",config:{style:"artificial"}},children:f.jsx("span",{className:`sprite texture-block_artificial ${B}`})}),f.jsx(j,{itemTool:{type:"block",config:{style:"artificial",disappearing:{on:"stand"}}},children:f.jsx(Ao,{iconClassName:pe("texture-block_artificial_disappearing")})}),f.jsx(j,{itemTool:{type:"block",config:{style:"tower"}},children:f.jsx("span",{className:`sprite texture-tower ${B}`})}),f.jsx(j,{itemTool:{type:"block",config:{style:"book"}},children:f.jsx("span",{className:`sprite texture-book_x ${B}`})}),f.jsxs(An,{children:[f.jsx(j,{itemTool:{type:"barrier",config:{axis:"x"}},children:f.jsx("span",{className:`sprite texture-barrier_x ${B}`})}),f.jsx(j,{itemTool:{type:"barrier",config:{axis:"y"}},children:f.jsx("span",{className:`sprite texture-barrier_y ${B}`})}),f.jsx(j,{itemTool:{type:"barrier",config:{axis:"x",disappearing:{on:"touch"}}},children:f.jsx(Ao,{iconClassName:pe("texture-barrier_x")})}),f.jsx(j,{itemTool:{type:"barrier",config:{axis:"y",disappearing:{on:"touch"}}},children:f.jsx(Ao,{iconClassName:pe("texture-barrier_y")})})]})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full",children:"Monsters"}),f.jsx(j,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},children:f.jsx("span",{className:`sprite texture-dalek_1 [button:hover_&]:texture-animated-dalek" ${B}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},children:f.jsx(bt,{topClasses:"texture-cyberman_towards [button:hover_&]:texture-cyberman_right",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-skiHead_greenAndPink_towards [button:hover_&]:texture-skiHead_greenAndPink_right ${B}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:f.jsx("span",{className:`sprite texture-helicopterBug_1 [button:hover_&]:texture-animated-helicopterBug ${B}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-turtle_towards_1 [button:hover_&]:texture-animated-turtle_right ${B}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},children:f.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase_all ${B}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},children:f.jsx(bt,{topClasses:"texture-computerBot_towards [button:hover_&]:texture-computerBot_right"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"bubbleRobot",activated:"on",movement:"patrol-randomly-xy8"}},children:f.jsx(bt,{topClasses:pe("texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"),bottomClasses:pe("texture-headlessBase")})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:f.jsx(bt,{topClasses:"texture-monkey_towards [button:hover_&]:texture-monkey_right"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},children:f.jsx(bt,{topClasses:"texture-elephant_towards [button:hover_&]:texture-elephant_right"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-elephant_towards [button:hover_&]:texture-elephant_right ${B}`})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",children:f.jsx(bt,{topClasses:"texture-ball",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),f.jsx(j,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},children:f.jsx("span",{className:`sprite texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold ${B}`})})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full",children:"Pickups"}),f.jsxs(An,{children:[f.jsx(j,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:f.jsx(jt,{iconClasses:"texture-whiteRabbit",text:"2"})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"shield"}},children:f.jsx(jt,{iconClasses:"texture-whiteRabbit",text:"🛡"})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"jumps"}},children:f.jsx(jt,{iconClasses:"texture-whiteRabbit",text:"♨"})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"fast"}},children:f.jsx(jt,{iconClasses:"texture-whiteRabbit",text:"⚡"})})]}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"bag"}},children:f.jsx("span",{className:`sprite texture-bag ${B}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"hooter"}},children:f.jsx("span",{className:`sprite texture-hooter ${B}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:f.jsx("span",{className:`sprite texture-doughnuts ${B}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"reincarnation"}},children:f.jsx("span",{className:`sprite texture-fish_1 [button:hover_&]:texture-animated-fish ${B}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:f.jsx("span",{className:`sprite texture-crown_blacktooth ${B}`})}),f.jsx(j,{itemTool:{type:"pickup",config:{gives:"scroll",page:"blacktooth"}},children:f.jsx("span",{className:`sprite texture-scroll ${B}`})})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full",children:"deadly"}),f.jsxs(An,{children:[f.jsx(j,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},children:f.jsx("span",{className:`sprite texture-volcano_1 [button:hover_&]:texture-animated-volcano ${B}`})}),f.jsx(j,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},children:f.jsx("span",{className:`sprite texture-toaster_off ${B}`})})]}),f.jsx(j,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},children:f.jsx("span",{className:`sprite texture-spikyBall_1 [button:hover_&]:texture-spikyBall_2 ${B}`})}),f.jsx(j,{itemTool:{type:"spikes",config:le},children:f.jsx("span",{className:`sprite texture-spikes ${B}`})}),f.jsx(j,{itemTool:{type:"moveableDeadly",config:{style:"deadFish"}},children:f.jsx("span",{className:`sprite texture-fish_1 ${B}`})})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full",children:"control"}),f.jsx(j,{itemTool:{type:"charles",config:le},children:f.jsx(bt,{topClasses:"texture-charles_towards [button:hover_&]:texture-charles_right"})}),f.jsx(j,{itemTool:{type:"joystick",config:{controls:["charles"]}},children:f.jsx("span",{className:`sprite texture-joystick ${B}`})}),f.jsx(j,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:Zo}},children:f.jsx("span",{className:`sprite texture-switch_left [button:hover_&]:texture-switch_right ${B}`})})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full",children:"movable"}),f.jsx(j,{itemTool:{type:"spring",config:{}},children:f.jsx("span",{className:`sprite texture-spring_released [button:hover_&]:texture-spring_compressed ${B}`})}),f.jsxs(An,{children:[f.jsx(j,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:f.jsx("span",{className:`sprite texture-cube ${B}`})}),f.jsx(j,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:f.jsx("span",{className:`sprite texture-drum ${B}`})}),f.jsx(j,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:f.jsx("span",{className:`sprite texture-sticks ${B}`})})]}),f.jsx(j,{itemTool:{type:"pushableBlock",config:{}},children:f.jsx("span",{className:`sprite texture-stepStool ${B}`})}),f.jsx(j,{itemTool:{type:"ball",config:le},children:f.jsx("span",{className:`sprite texture-ball ${B}`})}),f.jsx(j,{itemTool:{type:"slidingBlock",config:{style:"puck"}},children:f.jsx("span",{className:`sprite texture-puck ${B}`})}),f.jsx(j,{itemTool:{type:"slidingBlock",config:{style:"book"}},children:f.jsx("span",{className:`sprite texture-book_y ${B}`})})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full",children:"misc."}),f.jsxs(j,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[f.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_static ${B} [button:active_&]:top-oneScaledPix`}),f.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_1 [button:hover_&]:texture-animated-lift ${B} [button:active_&]:top-oneScaledPix`})]}),f.jsxs(An,{children:[f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"away"}},children:f.jsx(jt,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-conveyor_y",text:"↗"})}),f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"towards"}},children:f.jsx(jt,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-reversed-conveyor_y",text:"↙"})}),f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"left"}},children:f.jsx(jt,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-conveyor_x",text:"↖"})}),f.jsx(j,{itemTool:{type:"conveyor",config:{direction:"right"}},children:f.jsx(jt,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-reversed-conveyor_x",text:"↘"})})]}),f.jsx(j,{itemTool:{type:"teleporter",config:{toRoom:"to?",toPosition:fe}},children:f.jsx("span",{className:`sprite texture-teleporter ${B}`})}),f.jsx(j,{itemTool:{type:"movingPlatform",config:{movement:"clockwise",activated:"on",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-sandwich ${B}`})}),f.jsx(j,{itemTool:{type:"hushPuppy",config:{}},children:f.jsx("span",{className:`sprite texture-hushPuppy ${B}`})})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full",children:"Structure"}),f.jsx(c0,{}),f.jsx(u0,{}),f.jsx(j,{itemTool:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:{x:1,y:1}}},children:f.jsx("span",{className:`sprite texture-blacktooth_floor ${B}`})})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full",children:"Player"}),f.jsx(j,{itemTool:{type:"player",config:{which:"head"}},children:f.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${B}`})}),f.jsx(j,{itemTool:{type:"player",config:{which:"heels"}},children:f.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${B}`})})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full",children:"NPC’s"}),f.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"head",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${B}`})}),f.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"heels",startDirection:"towards"}},children:f.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${B}`})}),f.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"headOverHeels",startDirection:"towards"}},children:f.jsx(bt,{topClasses:"texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right",bottomClasses:"texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right"})})]}),f.jsxs("div",{className:Ee,children:[f.jsx(F,{className:"w-full pt-2",children:"debug"}),f.jsx(Xx,{})]})]})},hn=(t,e)=>({get bottomCentre(){return this.c000},get topLeft(){return this.c101},get topRight(){return this.c011},get c000(){return Q(t)},get c001(){return Q(W(t,{z:e.z}))},get c010(){return Q(W(t,{y:e.y}))},get c011(){return Q(W(t,{y:e.y,z:e.z}))},get c100(){return Q(W(t,{x:e.x}))},get c101(){return Q(W(t,{x:e.x,z:e.z}))},get c110(){return Q(W(t,{x:e.x,y:e.y}))},get c111(){return Q(W(t,{x:e.x,y:e.y,z:e.z}))},projectCorner(r){return Q(W(t,{x:r.x*e.x,y:r.y*e.y,z:r.z*e.z}))}}),gi=1e-5,mu=-1,Rn=(t,e,r,n,o)=>n-o>t&&r<e-o,wk=0,Pp=1,Ap=2,Ep=3,bk=(t,e,r,n)=>{const{topLeft:o,topRight:s,bottomCentre:i}=hn(t,e),{topLeft:a,topRight:l,bottomCentre:c}=hn(r,n),u=s.y-s.x/2,d=i.y-i.x/2,h=l.y-l.x/2,p=c.y-c.x/2,y=o.y+o.x/2,g=i.y+i.x/2,v=a.y+a.x/2,w=c.y+c.x/2,_=o.x,b=s.x,x=a.x,k=l.x,C=Rn(u,d,h,p,gi),S=Rn(y,g,v,w,gi),z=Rn(_,b,x,k,gi);return C&&S&&z?Pp:S&&z&&Rn(u,d,h,p,mu)?Ap:C&&z&&Rn(y,g,v,w,mu)?Ep:wk},xk=(t,e,r,n)=>{for(const o of Fm){const s=t[o],i=s+e[o],a=r[o],l=a+n[o];if(i<=a)return 1*(o==="z"?-1:1);if(s>=l)return-1*(o==="z"?-1:1)}return gu(r)-gu(t)},_k=(t,e)=>{if(t.fixedZIndex!==void 0||e.fixedZIndex!==void 0)return 0;const r=t.renderAabb||t.aabb,n=e.renderAabb||e.aabb,o=t.renderAabbOffset?W(t.state.position,t.renderAabbOffset):t.state.position,s=e.renderAabbOffset?W(e.state.position,e.renderAabbOffset):e.state.position;switch(bk(o,r,s,n)){case Pp:return xk(o,r,s,n);case Ap:return Rt(o.y,s.y+n.y)&&Rt(o.z,s.z+n.z)?1:Rt(s.y,o.y+r.y)&&Rt(s.z,o.z+r.z)?-1:0;case Ep:return Rt(o.x,s.x+n.x)&&Rt(o.z,s.z+n.z)?1:Rt(s.x,o.x+r.x)&&Rt(s.z,o.z+r.z)?-1:0;default:return 0}},gu=t=>t.x+t.y-t.z;class Vo extends Error{constructor(e,r,n){super(`CyclicDependencyError: .cyclicDependency property of this error has nodes as an array. ${e.join(" -> ")}`,n),this.cyclicDependency=e,this.hasClosedCycle=r}}const Sk=t=>{const e=kk(t);let r=e.length,n=r;const o=new Array(r),s={},i=Ck(e);for(;n--;)s[n]||a(e[n],n,new Set);return o;function a(l,c,u){if(u.has(l))throw new Vo([l],!1);if(s[c])return;s[c]=!0;const d=t.get(l)||new Set,h=Array.from(d);if(c=h.length){u.add(l);do{const p=h[--c];try{a(p,i.get(p),u)}catch(y){throw y instanceof Vo?y.hasClosedCycle?y:new Vo([l,...y.cyclicDependency],y.cyclicDependency.includes(l)):y}}while(c);u.delete(l)}o[--r]=l}};function kk(t){const e=new Set;for(const[r,n]of t.entries()){e.add(r);for(const o of n)e.add(o)}return Array.from(e)}function Ck(t){const e=new Map;for(let r=0,n=t.length;r<n;r++)e.set(t[r],r);return e}const yu=(t,e,r)=>{t.has(e)||t.set(e,new Set),t.get(e).add(r)},jo=(t,e,r)=>{const n=t.get(e);n!==void 0&&(n?.delete(r),n.size===0&&t.delete(e))},Tp=(t,e=new Set(Yo(t)),r=new Map)=>{const n=new Map;for(const[o,s]of r)if(!t[o])r.delete(o);else for(const i of s)t[i]||jo(r,o,i);for(const o of e)if(o.fixedZIndex===void 0)for(const s of Yo(t)){if(s.fixedZIndex!==void 0||n.get(s)?.has(o)||o===s)continue;const i=_k(o,s);if(yu(n,o,s),i===0){jo(r,o.id,s.id),jo(r,s.id,o.id);continue}const a=i>0?o.id:s.id,l=i>0?s.id:o.id;yu(r,a,l),jo(r,l,a)}return r},fl=(t,e,r=3)=>{try{return{order:Sk(t),impossible:!1}}catch(n){if(n instanceof Vo){const o=n.cyclicDependency;return t.get(o[0])?.delete(o[1]),console.warn("cyclc dependency detected: ",o.join(" --front-of--> "),`breaking link ${o[0]} --front-of--> ${o[1]}`),{order:fl(t,e,r-1).order,impossible:!0}}else throw n}};class Pk{constructor(e,r){this.renderContext=e,this.appearance=r,this.output=new te({label:"AppearanceRenderer"})}#e;output;destroy(){this.output.destroy({children:!0})}tick(e){const r=this.appearance({renderContext:this.renderContext,currentRendering:this.#e,tickContext:e});r!=="no-update"&&(this.output.children.at(0)!==r.output&&(this.#e?.output&&this.output.removeChild(this.#e.output),r.output!==void 0&&this.output.addChild(r.output)),this.#e=r)}}class Rp extends Pk{}const vu=(t,e)=>{e.poly([Q({}),Q({x:t.x}),Q({x:t.x,y:t.y}),Q({y:t.y})]).poly([Q({}),Q({z:t.z}),Q({y:t.y,z:t.z}),Q({y:t.y})]).poly([Q({x:t.x}),Q({x:t.x,z:t.z}),Q(t),Q({x:t.x,y:t.y})]).poly([Q({z:t.z}),Q({x:t.x,z:t.z}),Q({x:t.x,y:t.y,z:t.z}),Q({y:t.y,z:t.z})])},wu=(t,e)=>{const r=new ut;return vu(t,r),r.stroke({width:.5,color:e,alpha:1}),r.eventMode="static",r.on("pointerenter",()=>{r.fill({color:e,alpha:.5})}),r.on("pointerleave",()=>{r.clear(),vu(t,r),r.stroke({width:.5,color:e,alpha:1})}),r},Ak={head:"rgba(255,184,0)",wall:"rgba(128,200,0)",portal:"rgba(255,0,255)",pickup:"rgba(0,196,255)",emitter:"rgba(0,255,255)",stopAutowalk:"rgba(255,128,128)",floatingText:"rgba(128,0,255)"};class Ek{constructor(e){this.renderContext=e;const{item:r}=e,n=Ak[r.type]??"rgba(255,255,255)";if(this.#e=new te({label:`ItemBoundingBoxRenderer ${r.id}`}),to("portal")(r)){const s=Q(r.config.relativePoint);this.#e.addChild(new ut().circle(s.x,s.y,5).stroke(n)),this.#e.addChild(new ut().circle(s.x,s.y,2).fill(n))}if(this.#e.addChild(new ut({label:"objectOrigin"}).circle(0,0,2).fill(n)),this.#e.addChild(wu(r.aabb,n)),r.renderAabb){const s="rgba(184, 184, 255)",i=wu(r.renderAabb,s);if(r.renderAabbOffset){const a=Q(r.renderAabbOffset);i.position.set(a.x,a.y),i.circle(0,0,2).fill(s)}this.#e.addChild(i)}this.#e.eventMode="static";let o;this.#e.on("pointerenter",()=>{if(o!==void 0)return;const s=`${r.id} ${r.type}
@(${r.state.position.x}, ${r.state.position.y}, ${r.state.position.z})}
#(${r.aabb.x}, ${r.aabb.y}, ${r.aabb.z})}`;this.#e.addChild(o=new Ny({text:s,style:{fill:n,fontSize:6,fontFamily:"Menlo"}})),o.resolution=4}),this.#e.on("pointerleave",()=>{o!==void 0&&(this.#e.removeChild(o),o=void 0)}),e.frontLayer.attach(this.#e)}#e;tick(){}destroy(){this.#e.destroy({children:!0})}get output(){return this.#e}}class Tk{constructor(e,r){this.renderContext=e,this.wrappedRenderer=r,this.#e=new te({label:`ItemPositionRenderer ${e.item.id}`,children:[r.output]}),this.#t()}#e;#t(){const e=Q(this.renderContext.item.state.position);this.#e.x=e.x,this.#e.y=e.y}tick(e){this.wrappedRenderer?.tick(e),e.movedItems.has(this.renderContext.item)&&this.#t()}destroy(){this.#e.destroy({children:!0}),this.wrappedRenderer?.destroy()}get output(){return this.#e}}const bu={x:.5,y:1},xu=t=>typeof t!="string"&&Object.hasOwn(t,"animationId"),va=t=>{if(typeof t=="string")return va({textureId:t});{const{anchor:e,flipX:r,pivot:n,x:o,y:s,filter:i,times:a,label:l}=t;let c;if(xu(t)?c=Rk(t):c=new pn(Wt().textures[t.textureId]),t.hasOwnProperty("times")){const u={x:1,y:1,z:1,...a},d=new te({label:l??"timesXyz"});for(let{x:h}=u;h>=1;h--)for(let{y:p}=u;p>=1;p--)for(let y=1;y<=u.z;y++){const g={...t,textureId:t.textureId??t.textureIdCallback?.(h-1,p-1,y-1),label:`(${h},${p},${y})`};delete g.times;const v=va(g),w=wr({x:h-1,y:p-1,z:y-1});v.x+=w.x,v.y+=+w.y,d.addChild(v)}return d}if(e===void 0&&n===void 0)if(xu(t))c.anchor=bu;else{const u=Wt().data.frames[t.textureId];if(u===void 0)throw new Error(`no spritesheet entry for textureId "${t.textureId}"`);const d=u.frame;d.pivot!==void 0?c.pivot=d.pivot:c.anchor=bu}else e!==void 0&&(c.anchor=e),n!==void 0&&(c.pivot=n);return o!==void 0&&(c.x=o),s!==void 0&&(c.y=s),i!==void 0&&(c.filters=i),l!==void 0&&(c.label=l),c.eventMode="static",r===!0&&(c.scale.x=-1),c}},U=va;function Rk({animationId:t,reverse:e,playOnce:r,paused:n,randomiseStartFrame:o}){const s=Wt().animations[t],a=(n?[s[0]]:s).map(c=>({texture:c,time:Um}));e&&a.reverse();const l=new Wn(a);return l.animationSpeed=xr.animations[t].animationSpeed,l.gotoAndPlay(o?Math.floor(Math.random()*a.length):0),r!==void 0&&(l.loop=!1,l.onComplete=()=>{l.stop(),r==="and-destroy"&&(l.visible=!1)}),l}const Ip=(t,e)=>{const r=e.getLocalBounds(),n=Na.create({width:r.maxX-r.minX,height:r.maxY-r.minY});return e.x-=r.minX,e.y-=r.minY,t.render({container:e,target:n}),new pn({texture:n,label:"shadowMaskSprite (of renderTexture)",pivot:{x:-r.minX,y:-r.minY}})},Cs=(t,e,r)=>{const n=r&&{x:r.x??1,y:r.y??1},o=U({...typeof e=="string"?{textureId:e}:e,times:n});return o instanceof pn?o:Ip(t,o)},zt=t=>Ie(({renderContext:{item:e}})=>Ad(e)?U({...typeof t=="string"?{textureId:t}:t,times:$a(e)}):U(t)),Ke=t=>Ie(({renderContext:{item:e,general:{pixiRenderer:r}}})=>{if(Ad(e))return Cs(r,t,$a(e));{const n=U(t);return n instanceof pn?n:Ip(r,n)}}),Ie=t=>({renderContext:e,currentRendering:r,tickContext:n})=>r===void 0?{output:t({renderContext:e,currentRendering:void 0,tickContext:n}),renderProps:le}:"no-update",Nt=t=>({renderContext:{general:{pixiRenderer:e},item:r},currentRendering:n})=>{if(n===void 0){const o=$a(r),s={output:Cs(e,t(r.config),o),renderProps:le};return o&&(s.output.y-=((o.z??1)-1)*H.h),s}else return"no-update"},lo=(t,e)=>gt(hs(t)).map(r=>{const n=e.items[r];if(n===void 0)throw new Error(`item in stoodOnBy "${r}" is not in the room`);return n});to("head");const Ik=to("heels"),Ok=to("headOverHeels"),jk=t=>{if(Ik(t))return t.state;if(Ok(t))return t.state.heels},$k=1e3/25,Op=t=>{const e=xr.animations[t],r=e.length,{animationSpeed:n}=e;return r*$k/n};Op("bubbles.white");Op("head.fadeOut");const pl=({config:{activatedOnStoreValue:t}})=>t===void 0?!0:Aa(L.getState(),t),zk=({renderContext:{general:{pixiRenderer:t},item:e,room:r},currentRendering:n})=>{const{state:{stoodOnBy:o},config:{times:s}}=e,i=n?.renderProps,a=pl(e),l=a&&lo(o,r).find(za)!==void 0;return i===void 0||a!==i.activated||l!==i.flashing?{output:Cs(t,{textureId:l?"shadowMask.teleporter.flashing":a?"shadowMask.teleporter":"shadowMask.fullBlock"},s),renderProps:{flashing:l,activated:a}}:"no-update"},yi=(t,e=1)=>({renderContext:{item:{state:{facing:r}}},currentRendering:n})=>{const o=n?.renderProps,s=Ea(r)??"towards";if(!(o===void 0||s!==o.facingXy4))return"no-update";const a=U(s==="left"||s==="away"?`shadowMask.${t}.away`:`shadowMask.${t}.right`);return a.y=-(H.h*(e-1)),a.scale.x=s==="away"||s==="right"?1:-1,{output:a,renderProps:{facingXy4:s}}},_u={lift:Ke("shadowMask.smallBlock"),conveyor:Nt(({direction:t})=>({textureId:"shadowMask.conveyor",flipX:Gt(t)==="x"})),doorLegs:Nt(({direction:t})=>({textureId:t==="right"||t==="towards"?"shadowMask.door.floatingThreshold.double.y":"shadowMask.door.legs.threshold.double.y",flipX:Gt(t)==="y"})),teleporter:zk,floor:"no-mask",barrier:Nt(({axis:t})=>({textureId:"shadowMask.barrier.y",flipX:t==="x"})),spring:Ke("shadowMask.smallRound"),block:Nt(({style:t})=>t==="tower"?"shadowMask.tower":"shadowMask.fullBlock"),pushableBlock:Ke("shadowMask.stepStool"),movingPlatform:Ke("shadowMask.fullBlock"),hushPuppy:Ke("shadowMask.hushPuppy"),portableBlock:Nt(({style:t})=>t==="drum"?"shadowMask.smallRound":"shadowMask.smallBlock"),slidingBlock:Nt(({style:t})=>t==="book"?"shadowMask.fullBlock":"shadowMask.smallRound"),deadlyBlock:Nt(({style:t})=>t==="volcano"?"shadowMask.volcano":"shadowMask.toaster"),spikes:Ke("shadowMask.spikes"),switch:Ke("shadowMask.switch"),pickup:Nt(({gives:t})=>{switch(t){case"scroll":return"shadowMask.scroll";case"doughnuts":return"shadowMask.doughnuts";case"fast":case"extra-life":case"jumps":case"shield":return"shadowMask.whiteRabbit";default:return"blank"}}),slidingDeadly:Ke("shadowMask.smallRound"),ball:Ke("shadowMask.ball"),"monster.dalek":Ke("shadowMask.dalek"),"monster.turtle":yi("turtle"),"monster.skiHead":yi("skiHead"),"monster.homingBot":Ke("shadowMask.smallRound"),joystick:Ke("shadowMask.joystick"),charles:yi("charles",2)},Nk=t=>{switch(t.type){case"monster":return _u[`monster.${t.config.which}`];case"floor":return t.config.floorType==="none"?void 0:"no-mask";default:return _u[t.type]}},Mk=new Iy({alpha:1-Dn});class Dk{constructor(e,r){if(this.renderContext=e,this.#e.filters=Mk,r!=="no-mask")if(this.#r=new Rp(e,r),e.item.shadowOffset===void 0)this.#e.addChild(this.#r.output);else{const n=new te({label:"shadowMaskOffset",...Q(e.item.shadowOffset),children:[this.#r.output]});this.#e.addChild(n)}this.#e.addChild(this.#t)}#e=new te({label:"ItemShadowRenderer"});#t=new te({label:"shadows"});#r;#n={};get#o(){return L.getState().gameMenus.userSettings.displaySettings.showShadowMasks}#s(e){if(this.#r===void 0)return;const r=this.#r.output.children.at(0);this.#r.tick(e);const n=this.#r.output.children.at(0);if(n===void 0||!(n instanceof pn)){const{item:o}=this.renderContext;throw new Error(`ItemShadowRenderer: this.#shadowMaskRenderer didn't create a sprite for item "${o.id}" of type "${o.type}". Have got ${n}`)}r!==n&&(this.#o?this.renderContext.frontLayer.attach(n):this.#e.mask=n)}destroy(){this.#e.destroy(!0),this.#r?.destroy()}tick(e){if(this.#t.parent===null)throw new Error("shadow container not in scene graph");const{movedItems:r,progression:n}=e,{item:o,general:{pixiRenderer:s},room:i}=this.renderContext,a=r.has(o),l=o.state.position.z+o.aabb.z,c=He(i.items).filter(function(y){return y.shadowCastTexture!==void 0}),u={id:o.id,state:{position:{...o.state.position,z:l}},aabb:{...o.aabb,z:DS}},d=Object.groupBy(c,p=>{const y=this.#n[p.id]!==void 0,g=r.has(p);return!a&&!g?y?"keepUnchanged":"noShadow":ks(u,p)?y?"update":"create":"noShadow"});for(const p of Nl(d.keepUnchanged,d.update))this.#n[p.id].renderedOnProgression=n;if(d.create)for(const p of d.create){const{times:y}=p.config,g=Cs(s,p.shadowCastTexture,y);g.label=p.id,this.#t.addChild(g),this.#n[p.id]={sprite:g,renderedOnProgression:n}}for(const p of Nl(d.create,d.update)){const{sprite:y}=this.#n[p.id],g=Q({...Mn(fr(p.state.position,o.state.position),p.shadowOffset??dr),z:o.aabb.z});y.x=g.x,y.y=g.y}for(const[p,{sprite:y,renderedOnProgression:g}]of bd(this.#n))g!==n&&(y.destroy(),delete this.#n[p]);const h=(d.keepUnchanged?.length??0)+(d.update?.length??0)+(d.create?.length??0)>0;this.#e.visible=h,h&&this.#s(e)}get output(){return this.#e}}const Lk=t=>{const e=Nk(t.item);return e===void 0?void 0:new Dk(t,e)};class Bk{constructor(e,r){this.renderContext=e,this.componentRenderers=r,this.output={graphics:r.graphics?.output,sound:r.sound?.output}}output;tick(e){this.componentRenderers.graphics?.tick(e),this.componentRenderers.sound?.tick(e)}destroy(){this.componentRenderers.graphics?.destroy(),this.componentRenderers.sound?.destroy()}}const ae=new window.AudioContext,wa=()=>{throw new Error(`sounds not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`)},Oe=t=>{const e=typeof t=="string"?{soundId:t}:t,{playbackRate:r=1,soundId:n,connectTo:o,loop:s=!1,varyPlaybackRate:i=!1,randomiseStartPoint:a=!1}=e,l=ae.createBufferSource(),c=wa()[n];return l.buffer=c,l.loop=s,l.playbackRate.value=i?r-.05+Math.random()*.1:r,s&&a?l.start(0,c.duration*Math.random()):l.start(),o!==void 0&&l.connect(o),l},Br=(t,e,r)=>{const n=ae.createGain();return e!==void 0&&(n.gain.value=e),t.connect(n),n.connect(r),n},Me=({start:t,change:e,loop:r,stop:n,startAndLoopTogether:o=!1,noStartOnFirstFrame:s=!0},i)=>{let a=!0,l,c;return u=>{if(!!u!=!!c)u?t!==void 0&&!(a&&s)?(l?.stop(),l=Oe({...t}),Br(l,t.gain,i),r!==void 0&&(o?(l=Oe({...r,loop:!0}),Br(l,r.gain,i)):l.onended=()=>{c&&(l=Oe({...r,loop:!0}),Br(l,r.gain,i))})):r!==void 0&&(l=Oe({...r,loop:!0}),Br(l,r.gain,i)):(l&&l.loop&&(l.stop(),l.onended=null),n!==void 0&&(l=Oe({...n}),Br(l,n.gain,i)));else if(c!==u&&e!==void 0){const h=Oe({...e});Br(h,e.gain,i)}a=!1,c=u}};class Fk{constructor(e){this.renderContext=e,this.output.gain.value=4}output=ae.createGain();#e=Me({loop:{soundId:"rollingBallLoop",playbackRate:.5}},this.output);tick(){const{renderContext:{item:{state:{vels:{sliding:e},standingOnItemId:r}}}}=this,n=(e.x!==0||e.y!==0)&&r!==null;this.#e(n)}destroy(){}}class Uk{constructor(e){this.renderContext=e;const{item:{config:{was:r}}}=e;switch(r.type){case"pickup":{r.gives!=="scroll"&&Oe({soundId:"bonus",connectTo:this.output});break}case"disappearing":{Oe({soundId:"destroy",connectTo:this.output});break}case"hushPuppy":{this.output.gain.value=.5,Oe({soundId:"hushPuppyVanish",connectTo:this.output});break}}}output=ae.createGain();tick(){}destroy(){}}class ml{constructor(e,r,n=1){this.renderContext=e,this.#e=Me({start:r},this.output),this.output.gain.value=n}output=ae.createGain();#e;tick({lastRenderRoomTime:e}){const{renderContext:{item:r}}=this,{state:{collidedWith:{roomTime:n,by:o}}}=r,s=n>(e??Pe)&&!Ld(hs(o));this.#e(s)}destroy(){}}class Hk{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#e.gain.value=.5,this.#r=new ml(e,{soundId:"metalHit"},.3),this.#r.output.connect(this.output)}output=ae.createGain();#e=ae.createGain();#t=Me({start:{soundId:"servoStart",playbackRate:.5},loop:{soundId:"servoLoop",playbackRate:.5},stop:{soundId:"servoStop",playbackRate:.5}},this.#e);#r;tick(e){const{renderContext:{item:r,room:{roomTime:n,items:o}}}=this,{state:{actedOnAt:{roomTime:s,by:i}}}=r,a=n===s&&gt(hs(i)).some(l=>Ed(o[l]));this.#t(a),this.#r.tick(e)}destroy(){}}const co=t=>{for(const e in t)return!0;return!1},vi=2;class Wk{constructor(e){this.renderContext=e}output=ae.createGain();#e=Me({start:{soundId:"conveyorStart",playbackRate:vi},loop:{soundId:"conveyorLoop",playbackRate:vi},stop:{soundId:"conveyorEnd",playbackRate:vi}},this.output);tick(){const{renderContext:{item:{state:{stoodOnBy:e}}}}=this,r=co(e);this.#e(r)}destroy(){this.#e(!1)}}const Gk=3;class qk{constructor(e){this.renderContext=e,this.output.gain.value=.7}output=ae.createGain();#e=Oe({soundId:"helicopter",loop:!0,connectTo:this.output});tick(){const{renderContext:{item:{state:{vels:{lift:{z:e}}}}}}=this;this.#e.playbackRate.value=Math.max(.5,1+Gk*e)}destroy(){}}const Su={skiHead:{soundId:"softBump"},turtle:{soundId:"softBump"},dalek:{soundId:"metalHit"},homingBot:{soundId:"metalHit"},computerBot:{soundId:"metalHit"}},ku={cyberman:{soundId:"jetpackTurnaround",gain:1.2},dalek:{soundId:"mojoTurn",gain:.3}},Cu={cyberman:{soundId:"jetpackLoop",gain:.7},emperorsGuardian:{soundId:"jetpackLoop"},dalek:{soundId:"mojoLoop"},bubbleRobot:{soundId:"bubbleRobotLoop"},helicopterBug:{soundId:"helicopter"}},Pu={homingBot:{start:{soundId:"detect"},loop:{soundId:"robotWhirLoop",gain:4},startAndLoopTogether:!0},computerBot:{loop:{soundId:"robotBeepingLoop",randomiseStartPoint:!0,varyPlaybackRate:!0}}};class Vk{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#t.connect(this.output),this.#t.gain.value=.66;const{item:{config:{which:r}}}=e;Su[r]!==void 0&&(this.#o=new ml(e,Su[r]),this.#o.output.connect(this.output)),ku[r]!==void 0&&(this.#r=Me({change:ku[r]},this.#e)),Pu[r]!==void 0&&(this.#s=Me(Pu[r],this.#e)),Cu[r]!==void 0&&(this.#n=Me({loop:Cu[r]},this.#t))}output=ae.createGain();#e=ae.createGain();#t=ae.createGain();#r;#n;#o;#s;tick(e){const{renderContext:{item:r}}=this,{state:{facing:n,activated:o,busyLickingDoughnutsOffFace:s,vels:{walking:i}}}=r;if(this.#r){const a=xd(n);this.#r(a)}if(this.#o&&this.#o.tick(e),this.#n){const a=o&&!s;this.#n(a)}if(this.#s){const a=!Ta(i,fe);this.#s(a)}}destroy(){}}class wi{constructor(e){this.renderContext=e;const{general:{soundSettings:r},item:{type:n}}=e,{noFootsteps:o}={...Ra.soundSettings,...r};o||(this.#e=ae.createGain(),this.#e.gain.value=2,this.#e.connect(this.output),this.#t=Me({loop:{soundId:`${n==="headOverHeels"?"heels":n}Walk`}},this.#e)),this.#r.gain.value=.8,this.#r.connect(this.output),this.#i.gain.value=1.2,this.#i.connect(this.output),this.#s.connect(this.output),this.#n=Me({start:{soundId:`${n==="headOverHeels"?"head":n}Jump`}},this.#r),this.#o=Me({loop:{soundId:`${n==="headOverHeels"?"head":n}Fall`}},this.#r)}output=ae.createGain();#e;#t;#r=ae.createGain();#n;#o;#s=ae.createGain();#l=Me({start:{soundId:"landing"},noStartOnFirstFrame:!0},this.#s);#i=ae.createGain();#c=Me({start:{soundId:"carry",playbackRate:.95},stop:{soundId:"carry",playbackRate:1.05}},this.#i);#a={teleportingPhase:null,positionZ:0};tick({lastRenderRoomTime:e}){const{renderContext:{item:r}}=this,{state:{action:n,teleporting:o,jumpStartZ:s,jumped:i,standingOnItemId:a,position:{z:l},vels:{gravity:{z:c}},collidedWith:{roomTime:u,by:d}}}=r,h=jk(r),{teleportingPhase:p,positionZ:y}=this.#a,g=o?o.phase:null,v=i&&l>s&&l>y&&c>0,w=l<y&&c<0&&a===null;this.#o(w),this.#n(v),this.#t!==void 0&&this.#t(!v&&!w&&n==="moving"),h!==void 0&&this.#c(h.carrying!==null);const _=a!==null&&u>(e??Pe)&&d[a];if(this.#l(_),g!==null&&g!==p)if(g==="in"){const b=wa().teleportIn,x=ae.createBufferSource();x.buffer=b,x.connect(this.output),x.start()}else{const b=wa().teleportOut,x=ae.createBufferSource();x.buffer=b,x.connect(this.output),x.start()}this.#a={teleportingPhase:g,positionZ:l}}destroy(){}}class Kk{constructor(e){this.renderContext=e}output=ae.createGain();#e=void 0;tick(){const{renderContext:{item:{state:{stoodOnBy:e},config:{style:r}}}}=this;if(r!=="drum")return;const n=this.#e?.stoodOn??!1,o=co(e);!n&&o&&Oe({soundId:"drum",connectTo:this.output}),this.#e={stoodOn:o}}destroy(){}}class Xk{constructor(e){this.renderContext=e,this.scrapeBracketed=Me({loop:{soundId:"stepStoolScraping"}},this.output),this.output.gain.value=.4}output=ae.createGain();scrapeBracketed;tick({movedItems:e}){const{renderContext:{item:r,room:{roomTime:n}}}=this,{state:{actedOnAt:{roomTime:o},standingOnItemId:s}}=r,i=n===o&&s!==null&&e.has(r);this.scrapeBracketed(i)}destroy(){}}class Jk{constructor(e){this.renderContext=e}output=ae.createGain();tick({lastRenderRoomTime:e}){const{renderContext:{item:{state:{stoodOnBy:r,stoodOnUntilRoomTime:n}}}}=this,o=co(r);e!==void 0&&n>e&&!o&&Oe({soundId:"springBoing",connectTo:this.output})}destroy(){}}class Yk{constructor(e){this.renderContext=e,this.#e.connect(this.output)}output=ae.createGain();#e=ae.createGain();#t=void 0;tick(){const{renderContext:{item:{state:{setting:e},config:r}}}=this,n=r.type==="in-store"?Aa(L.getState(),r.path)?"right":"left":e,o=this.#t?.setting;o!==void 0&&o!==n&&Oe({soundId:"switchClick",playbackRate:n==="right"?.95:1.05,connectTo:this.#e}),this.#t={setting:n}}destroy(){}}class Zk{constructor(e){this.renderContext=e}output=ae.createGain();#e=Me({loop:{soundId:"teleportWarningSiren"}},this.output);tick(){const{renderContext:{item:e,room:r}}=this;this.#e(pl(e)&&lo(e.state.stoodOnBy,r).some(za))}destroy(){}}class Qk{constructor(e){this.renderContext=e,Oe({soundId:"hooter",connectTo:this.output})}output=ae.createGain();tick(){}destroy(){}}class eC extends ml{constructor(e){super(e,{soundId:"glassClink",varyPlaybackRate:!0},.8),this.renderContext=e}}const tC=(t,e)=>Bd(lo(t.state.stoodOnBy,e).filter(Td));class rC{constructor(e){this.renderContext=e,this.output.gain.value=2}output=ae.createGain();#e=void 0;tick(e){const{renderContext:{item:r,room:n}}=this,o=tC(r,n);this.#e!==void 0&&o<this.#e&&Oe({soundId:"toasterPopUpSoundUrl",connectTo:this.output}),this.#e=o}destroy(){}}const nC={lift:qk,switch:Yk,bubbles:Uk,head:wi,heels:wi,headOverHeels:wi,teleporter:Zk,monster:Vk,conveyor:Wk,spring:Jk,portableBlock:Kk,charles:Hk,ball:Fk,pushableBlock:Xk,firedDoughnut:Qk,slidingBlock:eC},oC=t=>{if(t.item.type==="deadlyBlock"&&t.item.config.style==="toaster")return new rC(t);const e=nC[t.item.type];if(e)return new e(t)},Au=H.h*ao,Eu=H.h*-1,sC=H.w*16,iC=0,bi=(t,e,r)=>(t-e)/(r-e)*2-1;class aC{constructor(e,r){this.renderContext=e,this.childRenderer=r,r.output.connect(this.output),this.output.rolloffFactor=2,this.output.maxDistance=5,this.output.distanceModel="exponential";const{room:{size:{y:n,x:o}}}=e;this.positionMinX=fi(ye({x:0,y:n})),this.positionMaxX=fi(ye({x:o,y:0}))}output=ae.createPanner();positionMinX;positionMaxX;tick(e){this.childRenderer.tick(e);const{item:r}=this.renderContext,n=r.state,o=W(n.position,ds(r.aabb,.5)),s=bi(fi(o),this.positionMaxX,this.positionMinX),i=bi(o.z,Eu,Au);if(!Number.isFinite(i))throw new Error(`y position for sound rendering is not finite;
        positionY = numberInRangeToMinus1To1Range(
          itemCentrePosition = ${o.z},
          ${Eu},
          ${Au},
        );
        itemCentrePosition = addXyz(
          itemState.position = ${JSON.stringify(n.position)},
          scaleXyz(${JSON.stringify(r.aabb)}, 0.5),
        )`);const a=bi(o.x+o.y,iC,sC);this.output.positionX.value=s,this.output.positionY.value=i,this.output.positionZ.value=a}destroy(){this.childRenderer.destroy()}}const Cr=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,lC=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // we know c.a is either 0 or 1, so no need to do a step()

    finalColor = mix(c, vec4(uColour, 1), c.a);
}
`;class ls extends Yt{constructor(e){const r=Tt.from({vertex:Cr,fragment:lC,name:"oneColour-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uColour:{value:new Float32Array(3),type:"vec3<f32>"}}}});const n=this.resources.colorReplaceUniforms.uniforms,[o,s,i]=e.toArray();n.uColour[0]=o,n.uColour[1]=s,n.uColour[2]=i}}const cC={pureBlack:new G("#000000"),shadow:new G("#1B2D3B"),midGrey:new G("#505A55"),lightGrey:new G("#929981"),white:new G("#F8FEF8"),pastelBlue:new G("#4893FF"),metallicBlue:new G("#1D4E80"),pink:new G("#B973AF"),moss:new G("#6E7B00"),redShadow:new G("#513D40"),midRed:new G("#A7574B"),lightBeige:new G("#BF8E69"),highlightBeige:new G("#DBB269"),alpha:new G("#105A69"),replaceLight:new G("#048662"),replaceDark:new G("#052229")},uC=`#version 300 es
// keep this one at mediump for the hash function's precision
precision mediump float;

in vec2 vTextureCoord;
out vec4 finalColor;

const float LUT_SIZE = 256.0;
const float magicNumber = 31.0; // Small prime number

uniform sampler2D uTexture;
uniform sampler2D uLut;

/** returns in [0, LUT_SIZE] range
this must match the TypeScript version of the hash function*/
float hashColor(vec3 color) {
    vec3 c255 = floor(color * 255.0);
    
    float hash = mod(
        c255.r + c255.g * magicNumber + c255.b * magicNumber * magicNumber, 
        LUT_SIZE
    );
    return hash;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    float h = hashColor(c.rgb);

    // use the hash to look up the replacement in the LUT:
    vec4 replacementColour = texture(
        uLut, 
        vec2(
            // normalise h to [0, 1] range
            (h + 0.5) / LUT_SIZE, 
            0.5
        )
    );
    
    // use original if either: 
    //      original alpha is 0 (because keep transparent)
    //      or lut alpha is 0 (signals nothing in this slot of the LUT)
    finalColor = mix(c, replacementColour, c.a * replacementColour.a);
}
`,$n=256,xi=31;function dC(t){const e=Math.floor(t.red*255),r=Math.floor(t.green*255),n=Math.floor(t.blue*255);return(e+r*xi+n*xi*xi)%$n}function hC(t){const e=new Float32Array($n*4);for(const[o,s]of Hm(t)){const i=$[o],a=dC(i);if(e[a*4+3]>.5)throw new Error("LUT collision - mess with the hash function or lut size until this goes away");e[a*4+0]=s.red,e[a*4+1]=s.green,e[a*4+2]=s.blue,e[a*4+3]=1}const r=new Uint8Array($n*4);for(let o=0;o<$n*4;o++)r[o]=Math.floor(e[o]*255);return kt.from({resource:r,width:$n,height:1,scaleMode:"nearest"})}class Qt extends Yt{#e;constructor(e){const r=Object.keys(e).length,n=Tt.from({vertex:Cr,fragment:uC,name:"palette-swop-filter"}),o=hC(e);super({glProgram:n,resources:{colorReplaceUniforms:{uOriginal:{value:new Float32Array(3*r),type:"vec3<f32>",size:r},uReplacement:{value:new Float32Array(3*r),type:"vec3<f32>",size:r}},uLut:o.source}}),this.#e=o;const s=this.resources.colorReplaceUniforms.uniforms;Object.entries(e).forEach(([i,a],l)=>{$[i].toArray().forEach((c,u)=>{s.uOriginal[l*3+u]=c}),a.toArray().forEach((c,u)=>{s.uReplacement[l*3+u]=c})})}destroy(e){this.#e?.destroy(!0),this.#e=null,super.destroy(e)}}const fC=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uTargetColor;

vec4 black = vec4(0.0, 0.0, 0.0, 1.0);

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // 1 if black, 0 if non-black
    float isBlack = step(length(c.rgb), 0.01);

    // keep original if either:
    //      * black
    //      * transparent

    finalColor = mix(    
        vec4(uTargetColor, 1),    
        c, 
        max(isBlack, 1.0 - c.a)
    );
}
`;class De extends Yt{uniforms;constructor(e="white"){const r=Tt.from({vertex:Cr,fragment:fC,name:"revert-colourise-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[r,n,o]=new G(e).toArray();this.uniforms.uTargetColor[0]=r,this.uniforms.uTargetColor[1]=n,this.uniforms.uTargetColor[2]=o}}const pC=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    finalColor = vec4(c.rgb * 0.5, c.a);
}
`;class mC extends Yt{constructor(){const e=Tt.from({vertex:Cr,fragment:pC,name:"halfbrite-filter"});super({glProgram:e,resources:{}})}}const jp=({basic:t,dimmed:e})=>({replaceLight:t,replaceDark:e}),$p=({color:{hue:t,shade:e},planet:r})=>{const n=t==="yellow"?e==="dimmed"||r==="jail"?Gf:Ze:xs[t][e].main;return jp(n)},gC=t=>new Qt({lightBeige:$.lightGrey,redShadow:$.shadow,pink:$.lightGrey,moss:$.lightGrey,midRed:$.midGrey,highlightBeige:$.lightGrey,...t&&$p(t)}),yC=new Qt({midGrey:$.midRed,lightGrey:$.lightBeige,white:$.highlightBeige,metallicBlue:$.redShadow,pink:$.midRed,moss:$.midRed,replaceDark:$.midRed,replaceLight:$.lightBeige}),Tu=(t,e)=>{const r=ss(t.color).edges[e],n=r.original;return r.dimInOriginal?Wf(n):n},zp=(t,e,r)=>r?new Qt(jp(xs[t.color.hue][t.color.shade].edges[e])):new De(ss(t.color).edges[e].original),pt=t=>new Qt($p(t)),vC=t=>{switch(t.color.hue){case"white":return new Qt({replaceLight:$.lightGrey,replaceDark:$.midGrey});default:return pt(t)}},Np=t=>{switch(t.color.hue){case"white":return new Qt({replaceLight:$.lightBeige,replaceDark:$.midRed,shadow:$.redShadow});case"yellow":return pt({planet:t.planet,color:{hue:"yellow",shade:"dimmed"}});default:return pt(t)}};new mC;const er=Zo,wC=new Qt(cC),bC=[new ls($.midRed)],xC=[new ls($.moss)],_C=75;class SC{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output)}output=new te({label:"ItemFlashOnSwitchedRenderer"});tick(e){const{renderContext:{item:{state:{switchedAtRoomTime:r,switchedSetting:n}},room:{roomTime:o}}}=this;this.output.filters=o-r<_C?n==="left"?xC:bC:er,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const kC=(t,e,r)=>{const o=Wt().textures[`door.frame.${t.planet}.${e}.near`]!==void 0?t.planet:"generic",s=t.color.shade==="dimmed"&&Wt().textures[`door.frame.${o}.dark.${e}.${r}`]!==void 0;return`door.frame.${o}${s?".dark":""}.${e}.${r}`};function Ps(t,e){const r=e||new te;for(const n of t)r.addChild(n);return r}function*CC({config:{direction:t,inHiddenWall:e,height:r}},n){const o=eo(t),s=o==="y"?1:16;function*i(a){if(e){if(r!==0){const l=U({textureId:`generic.door.floatingThreshold.${o}`,...Mn(a,{y:-12*r})});l.filters=zp(n,o==="x"?"towards":"right",!0),yield l}}else{yield U({pivot:{x:s,y:9},textureId:`generic.door.legs.base.${o}`,...Mn(a,{})});for(let l=1;l<r;l++)yield U({pivot:{x:s,y:9},textureId:`generic.door.legs.pillar.${o}`,...Mn(a,{y:-l*H.h})})}}yield*i(wr({...dr,[o]:1})),yield*i(dr),e||(yield U({pivot:{x:16,y:H.h*r+13},textureId:`generic.door.legs.threshold.double.${o}`,...wr({...dr,[o]:1})}))}const Mp=(t,e)=>{const r=eo(t),n=gn(r),o=8;return t==="towards"||t==="right"?Q({[n]:e[n]-o}):dr},PC=Ie(({renderContext:{item:t,room:e}})=>Ps(CC(t,e),new te({filters:pt(e),...Mp(t.config.direction,t.aabb)}))),AC=Ie(({renderContext:{item:{config:{direction:t,part:e,toRoom:r},aabb:n},room:o,general:{gameState:s}}})=>{const i=eo(t),a=s===void 0?o:s.campaign.rooms[r];return U({textureId:kC(o,i,e),filter:pt(a),...Mp(t,n)})}),_i={animationId:"bubbles.cold"},Jr=({top:t,bottom:e="headlessBase",filter:r})=>{const n=new te({filters:r}),o=U(e);n.addChild(o);const s=U(t);return s.y=-12,n.addChild(s),n[As]=s,n[gl]=o,n},As=Symbol(),gl=Symbol(),EC=({top:t,bottom:e})=>{const r=new te;return r.addChild(e),t.y=-12,r.addChild(t),r[As]=t,r[gl]=e,r},TC=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform vec2 uTextureSize;
uniform sampler2D uTexture;
uniform vec3 uOutline;
uniform float uOutlineWidth;

void main(void) {
    vec2 scaledTexelSize = vec2(1.0f) / vec2(textureSize(uTexture, 0)) * uOutlineWidth;    
    
    // Calculate offset coordinates
    vec2 rightCoord = vec2(vTextureCoord.x + scaledTexelSize.x, vTextureCoord.y);
    vec2 leftCoord = vec2(vTextureCoord.x - scaledTexelSize.x, vTextureCoord.y);
    vec2 belowCoord = vec2(vTextureCoord.x, vTextureCoord.y + scaledTexelSize.y);
    vec2 aboveCoord = vec2(vTextureCoord.x, vTextureCoord.y - scaledTexelSize.y);
    
    // Create boundary masks (1.0 if within bounds, 0.0 if out of bounds)
    // seems to work fine without this, but could multiply colourToX by this to get zero'd out when OOB
    // float rightInBounds = step(rightCoord.x, 1.0);
    // float leftInBounds = step(0.0, leftCoord.x);
    // float belowInBounds = step(belowCoord.y, 1.0);
    // float aboveInBounds = step(0.0, aboveCoord.y);
    
    vec4 colourToRight = texture(uTexture, rightCoord);
    vec4 colourToLeft = texture(uTexture, leftCoord);
    vec4 colourBelow = texture(uTexture, belowCoord);
    vec4 colourAbove = texture(uTexture, aboveCoord);
    
    // Check if any neighbor is opaque (combine all alpha values)
    float hasOpaqueNeighbor = max(max(colourToRight.a, colourToLeft.a), 
                                  max(colourBelow.a, colourAbove.a));

    vec4 originalColour = texture(uTexture, vTextureCoord);
        
    finalColor = mix(
        originalColour, 
        vec4(uOutline, 1), 
        // 1 if: original colour is transparent and has an opaque neighbour - use outline colour
        // 0 if: original colour is opaque or has no opaque neighbour - use original colour (transparent or sprite)
        (1.0 - originalColour.a) * hasOpaqueNeighbor
    );
}
`;class mt extends Yt{constructor({outlineColor:e,upscale:r,lowRes:n}){const o=Tt.from({vertex:Cr,fragment:TC,name:"outline-filter"});super({glProgram:o,padding:r,resources:{colorReplaceUniforms:{uOutline:{value:new Float32Array(3),type:"vec3<f32>"},uOutlineWidth:{value:new Float32Array(1),type:"f32"}}}});const s=this.resources.colorReplaceUniforms.uniforms,[i,a,l]=e.toArray();s.uOutline[0]=i,s.uOutline[1]=a,s.uOutline[2]=l,s.uOutlineWidth[0]=r,n&&(this.resolution=1/r,this.padding=r,s.uOutlineWidth[0]=1)}}const RC=t=>{const{gameTime:e,lastDiedAt:r}=t.type==="headOverHeels"?t.state.head:t.state;return e-r<FS},Si=t=>{if(t===void 0)return 0;const{shieldCollectedAt:e,gameTime:r}=t;return e!==null&&e+ou>r?100-Math.ceil((r-e)/(ou/100)):0},IC=t=>t.type==="headOverHeels"?Si(t.state.head)>0||Si(t.state.heels)>0:Si(t.state)>0,Es=t=>t,ba=.02,OC=({name:t,action:e,facingXy8:r,teleportingPhase:n,gravityZ:o,paused:s})=>{if(e==="death")return{animationId:`${t}.fadeOut`,paused:s};if(n==="out")return{animationId:`${t}.fadeOut`,paused:s};if(n==="in")return{animationId:`${t}.fadeOut`,paused:s};if(e==="moving")return{animationId:`${t}.walking.${r}`,paused:s};if(e==="jumping")return{textureId:o<ba?`${t}.walking.${r}.2`:`${t}.walking.${r}.1`};if(e==="falling"){const a=`${t}.falling.${r}`;if(Qo(a))return{textureId:a}}const i=`${t}.idle.${r}`;return lh(i)?{animationId:i,paused:s}:{textureId:`${t}.walking.${r}.2`}},xa=Symbol(),_a=Symbol(),jC=(t,e)=>{t[xa].removeChildren(),t[xa].addChild(U(OC(e)))},Dp=new Qt({pastelBlue:$.pink}),ki=(t,e,r)=>{const n=new te,o=new te;n[xa]=o,n.addChild(o);const s=U({animationId:e?`shine.${t}InSymbio`:"shine",paused:r,filter:t==="heels"?Dp:er,flipX:t==="heels"});return n[_a]=s,n},Ru=({gameTime:t,switchedToAt:e},r,n)=>(r==="headOverHeels"||r===n)&&e+BS>t,$C=t=>{if(!RC(t))return!1;const{gameTime:e,lastDiedAt:r}=t.type==="headOverHeels"?t.state.head:t.state;return(e-r)%su<su*US},Iu=(t,e)=>{t.filters?Array.isArray(t.filters)?t.filters=[...t.filters,e]:t.filters=[t.filters,e].flat():t.filters=e},Ou=(t,e)=>{t.filters=Array.isArray(t.filters)?t.filters.filter(r=>!(r instanceof e)):t.filters instanceof e?er:[...t.filters]},zC=(t,{highlighted:e,flashing:r},n,o)=>{const s=n?.highlighted??!1;e&&!s?Iu(o,new mt({outlineColor:Xr[t],upscale:Jt(L.getState()),lowRes:!1})):!e&&s&&Ou(o,mt);const i=n?.flashing??!1;r&&!i?Iu(o,new ls(Xr[t])):!r&&i&&Ou(o,ls)},NC=(t,e,r)=>{e&&!r?t.addChild(t[_a]):!e&&r&&t.removeChild(t[_a])},Ci=(t,e,r,n,o,s)=>{r&&jC(e,{name:t,...n,paused:o}),zC(t,n,s,e),NC(e,n.shining,s?.shining??!1)},MC=({renderContext:{item:t,general:{gameState:e,paused:r}},currentRendering:n})=>{const{type:o,state:{action:s,facing:i,teleporting:a,vels:{gravity:{z:l}}}}=t,c=n?.renderProps,u=n?.output,d=xd(i)??"towards",h=e!==void 0&&(t.type==="headOverHeels"?Ru(t.state.head,"headOverHeels","headOverHeels"):Ru(t.state,t.type,e.currentCharacterName)),p=$C(t),y=IC(t),g=_d(i),v=a?.phase??null,w={action:s,facingXy8:d,teleportingPhase:v,flashing:p,highlighted:h,shining:y,gravityZ:l},_=c===void 0||c.action!==s||c.facingXy8!==d||c.teleportingPhase!==v||c?.gravityZ>ba!=l>ba;let b;if(o==="headOverHeels"){b=u??EC({top:ki("head",!0,r),bottom:ki("heels",!0,r)});const x=b;Ci("head",x[As],_,w,r,c),Ci("heels",x[gl],_,w,r,c)}else b=u??ki(o,!1,r),Ci(o,b,_,w,r,c);return s==="moving"&&u instanceof Wn&&(u.animationSpeed=g*Wm),{output:b,renderProps:w}},Pi=Es(MC),ju=t=>t-Math.floor(t),DC=({state:{position:t}},e)=>{const r=o=>o.config.direction==="away"||o.config.direction==="left";return Ps(He(e.items).filter(o=>o.type==="wall"||o.type==="doorLegs").filter(r).map(o=>{const{id:s,config:{direction:i},state:{position:a}}=o;return U({textureId:"floorOverdraw.cornerNearWall",label:s,...Q(rn(a,t)),times:o.type==="wall"?ja(o.config):{[gn(Gt(i))]:2},anchor:{x:0,y:1},flipX:i==="away"})}),new te({label:"floorOverdraws"}))},LC=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    finalColor = texture(uTexture, vTextureCoord);
}
`;class BC extends Yt{constructor(){const e=Tt.from({vertex:Cr,fragment:LC,name:"null-filter"});super({glProgram:e,resources:{}})}}const FC=`#version 300 es
precision lowp float;

out vec4 finalColor;

in vec2 vTextureCoord;
uniform sampler2D uBackBuffer;
uniform vec3 uTargetColor;
// do not use uTexture in this frag - for some reason it causes pixi's render pipeline
// to take away the backbuffer, which we rely on sampling from

void main() {
    vec3 bg = texture(uBackBuffer, vTextureCoord).rgb;

    float isBlack = step(length(bg), 0.001f); // 1 if black, 0 otherwise
    finalColor = mix(vec4(uTargetColor, 1.0f), vec4(0, 0, 0, 0), isBlack);


}`;class $u extends Yt{uniforms;constructor(e="white"){const r=Tt.from({vertex:Cr,fragment:FC,name:"colour-clash-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}},blendRequired:!0}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[r,n,o]=new G(e).toArray();this.uniforms.uTargetColor[0]=r,this.uniforms.uTargetColor[1]=n,this.uniforms.uTargetColor[2]=o}}const zu=({colourised:t,direction:e,room:r,times:n,position:o,colourSwap:s})=>U({label:`floorEdge(${e})`,textureId:`floorEdge.${e}`,times:n,filter:s?zp(r,e,t):void 0,...Q(o)}),UC=({room:t,xSize:e,ySize:r,y:n})=>{const o=new te({label:"floorColourClash"}),s=Tu(t,"right");for(let a=0;a<=r;a++){const l=wr({x:0,y:a,z:0}),c=new ut().rect(l.x-(a===0?0:8),l.y,8*3,8).fill(s);c.filters=new $u(s),o.addChild(c)}const i=Tu(t,"towards");for(let a=0;a<=e;a++){const l=wr({x:a,y:0,z:0}),c=new ut().rect(l.x-16,l.y,8*(a===0?2:3),8).fill(i);c.filters=new $u(i),o.addChild(c)}return o.y=n,o},HC=Ie(({renderContext:{room:t,item:e,general:{colourised:r},colourClashLayer:n}})=>{const{color:{shade:o}}=t,{config:s,state:{position:i},aabb:a}=e,{floorType:l,naturalFootprint:c}=s,u=new te({label:"floorAppearance"}),d=Q({...a,y:0}),h=Q({...a,x:0,y:0}),p=Q({...a,x:0}),y=Q(a);if(l!=="none"){const g=new te({label:"tiles"}),v=l==="deadly"?`generic${o==="dimmed"?".dark":""}.floor.deadly`:`${s.scenery}${o==="dimmed"?".dark":""}.floor`,w=Wt().textures[v];try{ah(v)}catch(O){throw new Error(`no floor textureId for floorType: ${l}, shade: ${o}`,{cause:O})}const _=fr(c.position,i),b={x:ju(_.x/H.w),y:ju(_.y/H.w)},x=8,k={x:d.x,y:y.y-x,width:p.x-d.x,height:h.y-y.y+2*x},C=fr(wr(Mn(b,{x:.5,y:.5})),{y:a.z},k),S=new jy({texture:w,tilePosition:C,...k});g.addChild(S),g.addChild(DC(e,t));const z=new ut().moveTo(y.x,y.y).lineTo(p.x,p.y).lineTo(p.x,p.y+3).lineTo(h.x,h.y+3).lineTo(d.x,d.y+3).lineTo(d.x,d.y).fill({color:16711680,alpha:.5});g.addChild(z),g.mask=z,g.filters=[vC(t)];const K=new te({children:[g]});K.filters=new mt({outlineColor:$.pureBlack,upscale:1,lowRes:!1});const D=new te({children:[K]}),q=new BC;q.enabled=!1,D.filters=q,D.cacheAsTexture(!0),u.addChild(D),u.addChild(U({textureId:"blank",x:p.x,y:h.y+8}))}{const g=new te({label:"edges"});l==="none"&&g.addChild(new ut().moveTo(p.x,p.y+8).lineTo(p.x,p.y+100).lineTo(d.x,d.y+100).lineTo(d.x,d.y+8).lineTo(h.x,h.y+8).fill(0));const v=Math.ceil(a.y/H.w);g.addChild(zu({colourised:r,direction:"right",room:t,times:{y:v},position:{z:a.z},colourSwap:r}));const w=Math.ceil(a.x/H.w);if(g.addChild(zu({colourised:r,direction:"towards",room:t,times:{x:w},position:{z:a.z},colourSwap:r})),u.addChild(g),!r){const _=UC({xSize:w,ySize:v,y:-a.z+1,room:t});u.addChild(_),n.attach(_)}}return u}),WC=["cyberman","dalek","skiHead","bubbleRobot","computerBot","turtle"],GC=t=>{let e=2166136261;const r=t.length;for(let n=Math.max(0,r-9);n<r;n++)e^=t.charCodeAt(n),e=Math.imul(e,1540483477),e^=e>>>15;return(e>>>0)/4294967295},qC=200,VC=1,KC=(t,e)=>{const r=GC(e);return Math.sin((t+r*2e4)/qC)*VC},Nu=({id:t,config:{which:e},state:r},n,o)=>{if((e==="cyberman"||e==="bubbleRobot")&&r.activated||e==="emperorsGuardian"){const s=o;s[As].y=-12+KC(n.roomTime,t)}},XC=({renderContext:{item:t,room:e,general:{paused:r}},currentRendering:n})=>{const{config:o,state:s}=t,i=n?.renderProps,{activated:a,busyLickingDoughnutsOffFace:l}=s,c=l?yC:a?void 0:WC.includes(o.which)?gC(e):void 0;switch(o.which){case"skiHead":case"turtle":case"cyberman":case"computerBot":case"elephant":case"elephantHead":case"monkey":{const u=Ea(s.facing)??"towards";if(!(i===void 0||a!==i.activated||l!==i.busyLickingDoughnutsOffFace||u!==i.facingXy4))return Nu(t,e,n.output),"no-update";const h={facingXy4:u,activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"skiHead":return{output:U({textureId:`${o.which}.${o.style}.${u}`,filter:c}),renderProps:h};case"elephantHead":return{output:U({textureId:`elephant.${u}`,filter:c}),renderProps:h};case"turtle":return{output:U(a&&!l?{animationId:`${o.which}.${u}`,filter:c,paused:r}:{textureId:`${o.which}.${u}.1`,filter:c}),renderProps:h};case"cyberman":return{output:s.activated||s.busyLickingDoughnutsOffFace?Jr({top:{textureId:`${o.which}.${u}`,filter:c||pt(e)},bottom:{..._i,paused:r}}):U({textureId:`${o.which}.${u}`,filter:c}),renderProps:h};case"computerBot":case"elephant":case"monkey":return{output:Jr({top:`${o.which}.${u}`,bottom:{animationId:"headlessBase.flash",playOnce:"and-stop"},filter:c}),renderProps:h};default:throw new Error(`unexpected monster ${o}`)}break}case"homingBot":{const u=!Gm(s.vels.walking,dr);return i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated||u!==i.walking?{filter:c,output:U({animationId:u?"headlessBase.flash":"headlessBase.scan",filter:c}),renderProps:{activated:a,busyLickingDoughnutsOffFace:l,walking:u}}:"no-update"}case"helicopterBug":case"emperor":case"dalek":case"bubbleRobot":case"emperorsGuardian":{if(!(i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated))return Nu(t,e,n.output),"no-update";const d={activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"helicopterBug":case"dalek":return{output:U(a&&!l?{animationId:o.which,filter:c,paused:r}:{textureId:`${o.which}.1`,filter:c}),renderProps:d};case"bubbleRobot":return{output:Jr({top:{..._i,paused:r},filter:c}),renderProps:d};case"emperorsGuardian":return{output:Jr({top:"ball",bottom:{..._i,paused:r},filter:c}),renderProps:d};case"emperor":return{output:U({animationId:"bubbles.cold",filter:c,paused:r}),renderProps:d};default:throw new Error(`unexpected monster ${o}`)}break}default:throw new Error(`unexpected monster ${o}`)}},$o=new mt({outlineColor:$.pureBlack,upscale:Jt(L.getState()),lowRes:!0});new De;new De;new De;new De($.moss);new De;new De(Xr.head),new De(cn(Xr.head)),new De(Xr.heels),new De(cn(Xr.heels));function*JC(t){const e=typeof t=="string"?t==="infinite"?"":t:t.toString(),r=Bd(e);let n=0;for(const o of e){const s=`hud.char.${hd(o)}`;try{ah(s)}catch(i){throw new Error(`no texture id for char "${o}": ${i.message}`,{cause:i})}yield U({textureId:s,x:(n+.5-r/2)*qm.w}),n++}}const Lp=(t,e)=>{t.removeChildren();try{Ps(JC(e),t)}catch(r){throw console.error("invalid string is",e,"and on window as window.invalid"),console.error(r),window.invalid=e,new Error(`could not show text "${e}" in container because: "${r.message}"`,{cause:r})}return t},YC=yp.floatingText,ZC=12,Mu=H.h*3,Du=[$.shadow,$.midGrey,$.redShadow,$.metallicBlue,$.midRed,$.moss,$.pink,$.lightBeige,$.pastelBlue,$.lightGrey,$.highlightBeige],Lu=[...Du,...new Array(20).fill($.white),...Du.toReversed()],QC=({renderContext:{item:{config:{textLines:t,appearanceRoomTime:e}},room:{roomTime:r},general:{displaySettings:{uncolourised:n}},frontLayer:o},currentRendering:s})=>{const i=s?.output;let a;const c=(r-e)*YC;if(i===void 0){a=new te({filters:new mt({outlineColor:$.pureBlack,upscale:Jt(L.getState()),lowRes:!1})}),o?.attach(a);for(let d=0;d<t.length;d++){const h=t[d],p=Lp(new te({label:h,y:d*ZC,filters:n?er:new De($.pink)}),h.toUpperCase());a.addChild(p)}}else a=i;let u=!1;for(let d=0;d<t.length;d++){const h=a.children[d],[p]=h.filters,y=c+d*-12,g=y>0&&y<Mu;if(h.visible=g,u||=g,g&&p){const v=Math.floor(y/Mu*Lu.length);p.targetColor=Lu[v]}}return a.visible=u,a.y=-c,{output:a,renderProps:le}},Bu=500,eP=xr.animations["conveyor.x"].animationSpeed,Fu=xr.animations["conveyor.x"].length,tP=t=>1-(1-t)**2,rP=(t,e)=>{for(let r=0;r<t.children.length;r++){const n=t.children[r],o=r%Fu;n.gotoAndStop(e?Fu-o-1:o)}return t},nP=({renderContext:{item:{config:{direction:t,times:e},state:{stoodOnBy:r}},room:{roomTime:n}},currentRendering:o})=>{const s=o?.renderProps,i=co(r),a=(!i&&s?.moving?n:s?.roomTimeStoppedMoving)??Pe,l=Gt(t),c=o?.output??rP(U({animationId:`conveyor.${l}`,reverse:t==="towards"||t==="right",times:e}),t==="towards"||t==="right"),u=i?0:Math.min(n-a,Bu),d=Math.max(0,1-u/Bu);for(const h of c.children)if(d===0)h.stop();else{const p=eP*tP(d);h.play(),h.animationSpeed=p}return{output:c,renderProps:{moving:i,roomTimeStoppedMoving:a}}},oP=Es(nP),sP=({renderContext:{item:t,room:e,general:{paused:r}},currentRendering:n})=>{const{state:{stoodOnBy:o},config:{times:s}}=t,i=n?.renderProps,a=pl(t),l=a&&lo(o,e).some(za);return i===void 0||a!==i.activated||l!==i.flashing?{output:l?new te({children:[U({textureId:"teleporter",times:s}),U({animationId:"teleporter.flashing",times:s,paused:r})]}):U({textureId:a?"teleporter":"block.artificial",times:s}),renderProps:{flashing:l,activated:a}}:"no-update"},iP=({renderContext:{item:{state:{facing:t,actedOnAt:{roomTime:e,by:r}}},room:{roomTime:n,items:o}},currentRendering:s})=>{const i=s?.renderProps,a=Ea(t)??"towards",l=n===e&&gt(hs(r)).some(u=>Ed(o[u]));return i===void 0||a!==i.facingXy4||l!==i.controlledByJoystick?{output:Jr({top:`charles.${a}`,bottom:l?"headlessBase.all":"headlessBase"}),renderProps:{facingXy4:a,controlledByJoystick:l}}:"no-update"},aP=({renderContext:{item:{state:{stoodOnBy:t,stoodOnUntilRoomTime:e}},general:{paused:r}},tickContext:{lastRenderRoomTime:n},currentRendering:o})=>{const s=o?.renderProps,i=co(t);let a;return o?.output?a=o?.output:(a=U({animationId:"spring.bounce"}),a.loop=!1,a.gotoAndStop(0)),n!==void 0&&e>n&&!i&&!r?a.gotoAndPlay(0):i&&!(s?.compressed??!1)&&a.gotoAndStop(1),{output:a,renderProps:{compressed:i}}},lP=Es(aP),cP=({renderContext:{item:{config:{which:t,startDirection:e}}},currentRendering:r})=>r?.renderProps===void 0?{output:t==="headOverHeels"?Jr({top:{textureId:`head.walking.${e}.2`},bottom:{textureId:`heels.walking.${e}.2`}}):U({textureId:`${t}.walking.${e}.2`}),renderProps:le}:"no-update",uP=({renderContext:{item:{state:{vels:{sliding:t}},config:{startingPhase:e}},general:{paused:r}},tickContext:{deltaMS:n},currentRendering:o})=>{const i=(o?.renderProps?.distanceTravelled??0)+Ia(t)*(r?0:n),l=o?.output??U("spikyBall.1"),u=(Math.floor(i*2/Mo.w)+e)%2+1;return l.texture=Wt().textures[`spikyBall.${u}`],{output:l,renderProps:{distanceTravelled:i}}},dP=Es(uP),hP=(t,e,r,n)=>`${t}${n?".dark":""}.wall.${e}.${r}`,fP=Ie(({renderContext:{item:{id:t,config:e},room:r}})=>{if(e.direction==="right"||e.direction==="towards")throw new Error(`wall is near: ${t}`);const{direction:n,tiles:o}=e,s=gn(Gt(n)),i=new te({label:"wallTiles"});for(let a=0;a<e.tiles.length;a++){let l=U({textureId:hP(r.planet,o[a],n,r.color.shade==="dimmed"),y:1,pivot:n==="away"?{x:Mo.w,y:Mo.h+1}:{x:0,y:Mo.h+1}});const c=wr({[s]:a});if(r.planet==="moonbase"){const u=`moonbase.wall.screen.${o[a]}.away`;lh(u)&&(l=new te({children:[l]}),l.addChild(U({animationId:u,randomiseStartFrame:!0,flipX:n==="left",x:n==="away"?-8:8,y:-23})))}l.x+=c.x,l.y+=c.y,i.addChild(l),i.filters=pt(r)}return i}),pP=({renderContext:{item:{state:{setting:t},config:e}},currentRendering:r})=>{const n=r?.renderProps,o=e.type==="in-store"?Aa(L.getState(),e.path)?"right":"left":t;return n===void 0||o!==n.setting?{output:U(`switch.${o}`),renderProps:{setting:o}}:"no-update"},mP=(t,e,r)=>e==="tower"?"tower":e==="book"?"book.x":e==="organic"&&t?`block.organic.dark${r?".disappearing":""}`:`block.${e}${r?".disappearing":""}`,gP=({renderContext:{item:{config:{style:t,times:e},state:{disappearing:r}},room:n},currentRendering:o})=>{const s=o?.renderProps,i=r!==null;return s===void 0||s.isDissapearing!==i?{output:U({textureId:mP(n.color.shade==="dimmed",t,i),filter:t==="organic"?pt(n):t==="book"?Np(n):void 0,times:e}),renderProps:{isDissapearing:i}}:"no-update"},yP=({state:{stoodOnBy:t,position:e},config:{times:r}},n)=>{const o=new Array(r?.x??1).fill(null).map(()=>new Array(r?.y??1));return lo(t,n).filter(Td).forEach(({id:s,state:{position:i}})=>{const a=fr(i,e),l={x:Math.floor(a.x/H.w),y:Math.floor(a.y/H.d)};l.x<0||l.x>=(r?.x??1)||l.y<0||l.y>=(r?.y??1)||(o[l.x][l.y]=s)}),o},vP=(t,e)=>{let r=0,n=1;for(const o of e)for(const s of o)s!==void 0&&t.items[s]?.state.activated&&(r|=n),n<<=1;return r},wP=({renderContext:{item:t,room:e},currentRendering:r})=>{const{config:{times:n}}=t,o=r===void 0?yP(t,e):r.renderProps.chargePositions,s=vP(e,o);return s!==r?.renderProps.cybermanActivationBitmask?{output:U({textureIdCallback(a,l){const c=o[a][l];return c===void 0||e.items[c]?.state.everActivated?"toaster.off":"toaster.on"},times:n??le}),renderProps:{chargePositions:o,cybermanActivationBitmask:s}}:"no-update"},bP={head:Pi,heels:Pi,headOverHeels:Pi,doorFrame:AC,doorLegs:PC,monster:XC,floatingText:QC,barrier:Ie(({renderContext:{item:{config:{axis:t,times:e}}}})=>U({textureId:`barrier.${t}`,times:e})),deadlyBlock:Ie(({renderContext:{item:{config:t},room:e}})=>{switch(t.style){case"volcano":return U({animationId:"volcano",filter:pt(e),times:t.times,randomiseStartFrame:!0});case"toaster":throw new Error("use the special toaster appearance instead");default:throw t.style,new Error("unknown deadly block style")}}),spikes:zt("spikes"),slidingDeadly:dP,slidingBlock:Ie(({renderContext:{item:{config:{style:t}},room:e}})=>U(t==="book"?{textureId:"book.y",filter:Np(e)}:t)),block:gP,switch:pP,conveyor:oP,lift:Ie(({renderContext:{general:{paused:t}}})=>{const e=new te,r={x:Sl.w/2,y:Sl.h};return e.addChild(U({animationId:"lift",pivot:r,paused:t})),e.addChild(U({textureId:"lift.static",pivot:r})),e}),teleporter:sP,sceneryCrown:Ie(({renderContext:{item:{config:{planet:t}}}})=>U({textureId:`crown.${t}`})),pickup:Ie(({renderContext:{item:{config:t},room:e,general:{paused:r}}})=>{if(t.gives==="crown")return U({textureId:`crown.${t.planet}`});const o={shield:"whiteRabbit",jumps:"whiteRabbit",fast:"whiteRabbit","extra-life":"whiteRabbit",bag:"bag",doughnuts:"doughnuts",hooter:"hooter",scroll:{textureId:"scroll",filter:pt(e)},reincarnation:{animationId:"fish",paused:r}}[t.gives];return U(o)}),moveableDeadly:zt("fish.1"),charles:iP,joystick:zt("joystick"),movingPlatform:zt("sandwich"),pushableBlock:zt("stepStool"),portableBlock:Ie(({renderContext:{item:{config:{style:t}}}})=>U(t)),spring:lP,sceneryPlayer:cP,hushPuppy:zt("hushPuppy"),bubbles:Ie(({renderContext:{item:{config:{style:t}},general:{paused:e}}})=>U({animationId:`bubbles.${t}`,paused:e})),firedDoughnut:zt({animationId:"bubbles.doughnut"}),ball:zt("ball"),floor:HC,particle:Ie(({renderContext:{item:{config:{forCharacter:t}}}})=>U({animationId:"particle.fade",anchor:{x:.5,y:.5},filter:t==="heels"?Dp:er}))},xP=t=>{if(t.type==="wall"){const{direction:e}=t.config;return e==="right"||e==="towards"?void 0:fP}return t.type==="deadlyBlock"&&t.config.style==="toaster"?wP:bP[t.type]},_P=$.moss,SP=()=>new mt({outlineColor:_P,lowRes:!1,upscale:Jt(L.getState())});class kP{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output)}output=new te({label:"PortableItemPickUpNextHighlightRenderer"});#e=!1;tick(e){const{wouldPickUpNext:r}=this.renderContext.item.state;r!==!this.#e&&(this.output.filters=r?[SP()]:er),this.#e=r,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const CP=(t,e,r)=>$g(t)?new kP(e,r):r,PP=$.pastelBlue,AP=$.highlightBeige,EP=$.midRed,TP=$.white,Uu=new mt({outlineColor:AP,upscale:Jt(L.getState()),lowRes:!1}),Hu=new mt({outlineColor:EP,upscale:Jt(L.getState()),lowRes:!1}),RP=new mt({outlineColor:TP,upscale:Jt(L.getState()),lowRes:!1}),Wu=new De(PP),Gu={left:"↖",away:"↗",right:"↘",towards:"↙"};class IP{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output),this.#e()}output=new te({label:"EditorAnnotationsRenderer"});#e(){const e=this.renderContext.item;switch(e.type){case"pickup":if(e.config.gives==="shield"||e.config.gives==="extra-life"||e.config.gives==="jumps"||e.config.gives==="fast"){const r={shield:"🛡",jumps:"♨",fast:"⚡","extra-life":"+2"};this.#t({annotationText:r[e.config.gives],yAdj:-16})}break;case"doorFrame":if(e.config.part==="near"){const{rooms:r}=L.getState().levelEditor.campaignInProgress,{config:{toRoom:n,direction:o}}=e,s=!!r[n],i=n.toUpperCase(),a=Gu[o],l=o==="away"||o==="right"?`${i}${a}`:`${a}${i}`;this.#t({annotationText:l,yAdj:o==="left"||o==="away"?-48:0,error:!s,clickDispatch:s?()=>Li(n):void 0})}break;case"teleporter":{const{rooms:r}=L.getState().levelEditor.campaignInProgress,{config:{toRoom:n}}=e,o=!!r[n];this.#t({annotationText:`➡${n.toUpperCase()}`,yAdj:-12,error:!o,clickDispatch:o?()=>Li(n):void 0})}break;case"conveyor":{const{config:{direction:r}}=e,n=Gu[r];this.#t({annotationText:n,yAdj:-12})}break}}#t({annotationText:e,yAdj:r=0,error:n=!1,clickDispatch:o}){const{renderContext:{frontLayer:s}}=this,i=new De(n?$.midRed:$.white),a=Lp(new te({label:"EditorAnnotationTextContainer",filters:[i,new mt({lowRes:!0,outlineColor:$.pureBlack,upscale:Jt(L.getState())})]}),e);a.y=r,o!==void 0&&(a.eventMode="static",a.on("click",()=>{L.dispatch(o())}),a.on("mouseover",()=>{L.getState().levelEditor.tool.type==="pointer"&&(L.dispatch(Cl(!0)),i.targetColor=$.pastelBlue)}),a.on("mouseout",()=>{L.dispatch(Cl(!1)),i.targetColor=$.white}),a.cursor="pointer"),this.output.addChild(a),s.attach(a)}tick(e){this.#r(),this.childRenderer.tick(e)}#r(){const{renderContext:{item:e,room:r}}=this,{clickableAnnotationHovered:n}=L.getState().levelEditor,{jsonItemId:o}=e,s=L.getState(),i=Rd(s),a=zg(s),l=cr(s),c=o&&i?.jsonItemId===o&&!n,u=o&&a.includes(o),d=()=>o!==void 0&&(He(r.items).some(h=>h.jsonItemId===i?.jsonItemId&&h.type==="switch"&&h.config.type==="in-room"&&h.config.modifies.some(p=>p.targets.includes(o)))||e.type==="switch"&&He(r.items).some(({jsonItemId:h})=>h!==void 0&&h===i?.jsonItemId&&e.config.type==="in-room"&&e.config.modifies.some(p=>p.targets.includes(h)))||e.type==="charles"&&He(r.items).some(h=>h.jsonItemId===i?.jsonItemId&&h.type==="joystick"&&h.config.controls.some(p=>p===o))||e.type==="joystick"&&e.config.controls.some(h=>i?.jsonItemId===h));this.output.filters=c&&u?[Wu,l.type==="eyeDropper"?Hu:Uu]:c?l.type==="eyeDropper"?Hu:Uu:u?Wu:d()?RP:er}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const OP=(t,e,r)=>e.general.editor?new IP(e,r):r,jP=(t,e)=>{e!==void 0&&L.getState().gameMenus.cheatsOn&&(e.eventMode="static",e.on("pointertap",()=>{L.dispatch(Xm({item:t}))}))},$P=t=>{const e=L.getState(),r=Vm(e),n=!Km(e),{item:o}=t,s=r==="all"||r==="non-wall"&&t.item.type!=="wall",i=[],a=xP(o);if(a!==void 0){const h=new Rp(t,a),p=new SC(t,h);i.push(OP(o,t,CP(o,t,p)))}if(n){const h=Lk(t);h!==void 0&&i.push(h)}s&&i.push(new Ek(t));let l;if(i.length===0)l=void 0;else{const h=i.length===1?i[0]:new zP(i,t);jP(o,h.output),l=new Tk(t,h)}const c=t.general.soundSettings.mute??Ra.soundSettings.mute,u=t.general.paused||c?void 0:oC(t),d=u===void 0?void 0:new aC(t,u);return new Bk(t,{graphics:l,sound:d})};class zP{constructor(e,r){this.renderContext=r,this.#e=e,this.#t.addChild(...e.map(n=>n.output))}#e;#t=new te({label:"CompositeRenderer"});tick(e){for(const r of this.#e)r.tick(e)}destroy(){for(const e of this.#e)e.destroy()}get output(){return this.#t}}const NP=to("wall","doorFrame"),qu=256;function*MP(t){const{left:e,right:r}=He(t.items).filter(NP).reduce((n,{aabb:o,renderAabb:s,renderAabbOffset:i,state:{position:a}})=>{const l=s??o,c=W(a,i??fe),u=Q(W(c,{x:l.x})).x,d=Q(W(c,{y:l.y})).x;return{left:Math.min(n.left,u),right:Math.max(n.right,d)}},{left:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY});e!==Number.POSITIVE_INFINITY&&(yield new ut().rect(e-100,-256,100,qu).fill(0)),r!==Number.NEGATIVE_INFINITY&&(yield new ut().rect(r,-256,100,qu).fill(0))}class DP{constructor(e){this.renderContext=e;const{general:{colourised:r,soundSettings:n},room:o}=e;this.initFilters(r,e.room.color);const i=n.mute??Ra.soundSettings.mute?void 0:ae.createGain();Ps(MP(o),this.#o),this.output={sound:i,graphics:new te({label:`RoomRenderer(${e.room.id})`})},this.output.graphics.addChild(this.#t),r||(this.#r=new Kl({sortableChildren:!1}),this.output.graphics.addChild(this.#r)),this.output.graphics.addChild(this.#o),this.output.graphics.addChild(this.#n)}#e=!1;#t=new te({label:"items"});#r;#n=new Kl({sortableChildren:!1});#o=new te({label:"occlusion"});output;#s=void 0;#l=new Map;#i=new Map;initFilters(e,r){this.#t.filters=e?r.shade==="dimmed"?wC:er:new De(r.shade==="dimmed"?Wf(ss(r).main.original):ss(r).main.original)}#c(e){const{room:r}=this.renderContext,n={...e,lastRenderRoomTime:this.#s};for(const s of He(r.items)){let i=this.#i.get(s.id);if(i===void 0){i=$P({...this.renderContext,colourClashLayer:this.#r,frontLayer:this.#n,item:s}),this.#i.set(s.id,i);const{graphics:a,sound:l}=i.output;if(a&&(this.#t.addChild(a),s.fixedZIndex&&(a.zIndex=s.fixedZIndex)),l){if(!this.output.sound)throw new Error("item renderer has sound, but room renderer does not - this probably means that they disagree on if the user has sound muted");l.connect(this.output.sound)}}try{i.tick(n)}catch(a){throw new Error(`RoomRenderer caught error while ticking Renderer for item "${s.id}" - item in play object is:
           ${JSON.stringify(s,null,2)}`,{cause:a})}}let o=!1;for(const[s,i]of this.#i.entries())r.items[s]===void 0&&(i.destroy(),this.#i.delete(s),o=!0);o&&this.#a()}#a(){if(this.#r)for(const e of this.#r.renderLayerChildren)e.parent===null&&this.#r.detach(e);for(const e of this.#n.renderLayerChildren)e.parent===null&&this.#n.detach(e)}#d(e){const r=Tp(this.renderContext.room.items,e.movedItems,this.#l),{order:n}=fl(r,this.renderContext.room.items);for(let o=0;o<n.length;o++){const s=this.#i.get(n[o]);if(s===void 0)throw new Error(`Item id=${n[o]} does not have a renderer - cannot assign a z-index`);const i=s.output.graphics;if(i)i.zIndex=n.length-o;else throw new Error(`order ${n[o]} was given a z-order by sorting, but item has no graphics`)}}get#u(){return this.#s!==void 0}tick(e){const r=this.#u?e:{...e,movedItems:new Set(He(this.renderContext.room.items))};this.#c(r),(!this.#u||r.movedItems.size>0)&&this.#d(r),this.#s=this.renderContext.room.roomTime}destroy(){this.output.graphics.label=this.output.graphics.label+"DESTROYED",this.output.graphics.destroy({children:!0}),this.output.sound?.disconnect(),this.#i.forEach(e=>{e.destroy()}),this.#e=!0}get destroyed(){return this.#e}}const LP=t=>{t.ticker.remove(t.render,t)},Bp=m.createContext(null),BP=({children:t})=>{const[e,r]=m.useState(null);return m.useEffect(()=>{const n=new Xd;return n.init({background:$.pureBlack,sharedTicker:!0}).then(()=>{LP(n),r(n)}),()=>{}},[]),e===null?null:f.jsx(Bp,{value:e,children:t})},Pr=()=>m.useContext(Bp),FP=(t,e)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:e},soundSettings:{mute:!0},pixiRenderer:t,gameState:void 0,paused:!1,colourised:!0,upscale:Oa(L.getState()),editor:!0}),Vu=(t,e,r)=>new DP({room:t,general:FP(e,r)}),UP=()=>{const{renderer:t}=Pr(),e=pd();if(!t)throw new Error("this should never be falsey (typescript violation)");const r=Sp(),[n,o]=m.useState(()=>Vu(r,t,e));return m.useEffect(()=>{const s=Vu(r,t,e);return o(s),()=>{s.destroy()}},[r,t,e]),n},Ku=(t,e,r)=>{const{world:{onItem:{face:n},position:o,itemId:s}}=t;if(n.z>vd)return qo(o);if(r.type==="door"){const i=e.items[s];if(i.type!=="wall")return;const{config:a,aabb:l,state:{position:c}}=i,u=Ng(ja(a)),d=gn(Gt(a.direction)),h=Gt(a.direction);if(u[d]<2)return;const p=c[d],y=c[d]+l[d]-qS,g=c.z,v=c.z+l.z-jn,w={[d]:Math.max(Math.min(o[d],y),p),[h]:o[h],z:Math.max(Math.min(o.z,v),g)};return qo(w)}return W(qo(o),n)},HP={z:1,x:0,y:0},WP={z:0,x:0,y:-1},Xu={z:0,x:-1,y:0},GP=(t,{x:e,y:r},n)=>{if(n.type==="item"&&n.item.type==="door"&&t.type==="wall"){const l=t.config.direction;return ds(Ce[l],-1)}const{bottomCentre:o,topLeft:s,topRight:i}=hn(t.state.position,t.aabb);return r<s.y-(s.x-e)/2?r<i.y-(e-i.x)/2?HP:Xu:e<o.x?WP:Xu},qP=3,VP=(t,{x:e,y:r},n)=>{const o=hn(t.state.position,t.aabb);return Jm.find(s=>{const i=o.projectCorner(s);return Ia(fr(i,{x:e,y:r}))<qP})},Fr=3,Ai=1.5;function wt({x:t,y:e},r,n){const o={x:t-r.x,y:e-r.y},s=o.x*n.y-o.y*n.x;return Math.abs(s)/Math.hypot(n.x,n.y)}const Fp={point:{x:-1,y:-1,z:0},normal:{x:0,y:0,z:1}},Up={point:{x:-1,y:0,z:1},normal:{x:0,y:1,z:0}},Hp={point:{x:0,y:-1,z:1},normal:{x:1,y:0,z:0}},Wp={point:{x:0,y:1,z:1},normal:{x:1,y:0,z:0}},Gp={point:{x:1,y:0,z:1},normal:{x:0,y:1,z:0}},qp={point:{x:1,y:-1,z:0},normal:{x:0,y:0,z:1}},Vp={point:{x:0,y:-1,z:-1},normal:{x:1,y:0,z:0}},Kp={point:{x:-1,y:1,z:0},normal:{x:0,y:0,z:1}},Xp={point:{x:-1,y:0,z:-1},normal:{x:0,y:1,z:0}},KP=(t,e,r,n)=>{const o=hn(t.state.position,t.aabb),s=r.x<0,i=r.y<0,a=r.z>0;if((s||i)&&wt(e,o.bottomCentre,{x:0,y:-1})<Ai)return Fp;if((s||a)&&wt(e,o.topRight,{x:2,y:-1})<Ai)return Up;if((i||a)&&wt(e,o.topLeft,{x:2,y:1})<Ai)return Hp;switch(!0){case a:{const l=o.c111;if(wt(e,l,{x:2,y:1})<Fr)return Wp;if(wt(e,l,{x:-2,y:1})<Fr)return Gp;break}case i:{const l=o.c100;if(wt(e,l,{x:0,y:-1})<Fr)return qp;if(wt(e,l,{x:2,y:1})<Fr)return Vp;break}case s:{const l=o.c010;if(wt(e,l,{x:0,y:-1})<Fr)return Kp;if(wt(e,l,{x:-2,y:1})<Fr)return Xp;break}}},Ju=(t,e,r)=>r?{position:t.state.position,aabb:t.aabb}:{position:W(t.state.position,t.renderAabbOffset??fe),aabb:t.renderAabb??t.aabb},Yu=({x:t,y:e},r,n)=>{const{bottomCentre:o,topLeft:s,topRight:i}=hn(r,n);return!(t<s.x||t>i.x||e<i.y-(i.x-t)/2||e<s.y-(t-s.x)/2||e>o.y-(t-o.x)/2||e>o.y-(o.x-t)/2)},XP=(t,e,r)=>{const{position:n,aabb:o}=Ju(r,e,!1);if(Yu(t,n,o))return"intersects-rendered";if(e.type==="item"&&r.type==="wall"){const{position:i,aabb:a}=Ju(r,e,!0);if(Yu(t,i,a))return"intersects-unrendered"}return"non-intersecting"},Zu=t=>t.fixedZIndex!==void 0,JP=t=>{const r=t.some(([,a])=>a==="intersects-rendered")?t.filter(([,a])=>a==="intersects-rendered").map(([a])=>a):t.map(([a])=>a);if(r.every(Zu))return r.toSorted((a,l)=>l.fixedZIndex-a.fixedZIndex).at(0);const n=r.filter(a=>!Zu(a));if(n.length===0)return;if(n.length===1)return n[0];const o=Object.fromEntries(n.map(a=>[a.id,a])),s=Tp(o),{order:i}=fl(s,o);return o[i[0]]},Jp=(t,e,r,n)=>{const o=!n||r.type==="item"&&r.item.type==="door",s=o?H.w:H.w/2,i=H.h,a=o?0:s/2,l=i/2,c=yd(e);return{x:c==="yz"?Math.round(t.x/s)*s:Math.floor((t.x-a)/s)*s,y:c==="xz"?Math.round(t.y/s)*s:Math.floor((t.y-a)/s)*s,z:c==="xy"?Math.round(t.z/i)*i:Math.floor((t.z+l)/i)*i}},YP=({state:{position:t},aabb:e},r,n,o,s)=>{const i={x:t.x+(r.x<0?0:e.x),y:t.y+(r.y<0?0:e.y),z:t.z+(r.z<0?0:e.z)},a=HS(i,r,n);return Jp(a,r,o,s)},ZP=t=>e=>{const r=sn(e);return t.type==="item"&&t.item.type==="door"?r&&e.type==="wall":r},Ei=(t,e,r,n)=>{const o=He(e.items).filter(ZP(r)).map(a=>[a,XP(t,r,a)]).filter(a=>a[1]!=="non-intersecting"),s=JP(Array.from(o)),i=e.id;if(s){const a=GP(s,t,r);if(!(a.z>0&&!Object.isExtensible(s.state.stoodOnBy)))return{roomId:i,scrXy:t,world:{itemId:s.id,onItem:{face:a,corner:VP(s,t),edge:KP(s,t,a)},position:YP(s,a,t,r,n)}}}return{roomId:i,scrXy:t,world:void 0}},QP=(t,e=console.error)=>(...r)=>{try{return t(...r)}catch(n){e(n);return}},eA=t=>Od(e=>e>0?e:e>-1?1:-e+1,t),tA=({jsonItem:t,blockDragAccVec:e,resizeEdgeDirection:r})=>{const n=t.position,o=Mg(t),s=Di(e,r,Id(t)),i=W(o,s),a=eA(i),l=Od((c,u,d,h,p)=>{const y=u<1;return c<0!==y?y?d-p+1:d+h-p:y?d+h-1:d},r,i,n,o,a);return{timesDelta:rn(a,o),positionDelta:rn(l,n)}},Ti=(t,e)=>{const r=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const n=e.target.getBoundingClientRect(),o=e.clientX-n.left,s=e.clientY-n.top;return{x:o/r-t.gameEngineScreenSize.x/2,y:s/r-t.gameEngineScreenSize.y+16}},rA=(t,e)=>{const r=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const n=e.movementX,o=e.movementY;return{x:n/r,y:o/r}},nA=5,oA=(t,e,r)=>{const n=t.world?.onItem.edge,o=Di(...gt(r).map(i=>Id(i))),s=Di(n?.point??fe,o);return _d(s)>0?n.normal:e?{x:1,y:0,z:0}:{x:0,y:0,z:1}},sA=(t,e,r,n,o,s)=>{if(t===void 0)return;const i=fr(e,t.scrXy),a=Ia(i);if(!(o||a>nA))return;const c=oA(t,n,s),u=wp(c,r);return n?{x:0,y:0,z:u.z}:u},Qu=(t,e=!1)=>{const r=L.getState().levelEditor;return Jp(t,{x:0,y:0,z:1},r.tool,!e&&r.halfGridResolution)},zo=({levelEditor:t},e,r)=>{const n=e.items[r]?.jsonItemId;if(n===void 0)return;const o=$d(t,n);if(o!==void 0)return[n,o]},Ko=(t,...e)=>t.levelEditor.wallsFloorsLocked&&e.some(r=>r.type==="wall"||r.type==="floor"),Ri=(t,e)=>{const r=L.getState();let n;if(e.world){const o=e.world.itemId,s=o&&t.items[o],i=Ko(r,s)?void 0:s.jsonItemId;n=i===void 0?void 0:{jsonItemId:i,pointingAtOnItem:e.world.onItem}}else n=void 0;Be(Rd(r),n)||L.dispatch(jd(n))},iA=(t,e,r)=>{const n=r?.world?.itemId;if(n===void 0)return Zo;const o=e.items[n].jsonItemId;if(o===void 0)return Zo;const{selectedJsonItemIds:s}=t.levelEditor;return s.includes(o)?s:[o]},aA=t=>{const e=Pr(),r=_r(Oa),n=Xe(),o=_p(),s=m.useRef(void 0),i=m.useRef(void 0),a=m.useRef(void 0);m.useEffect(()=>{if(t===null)return;const l=p=>{const y=Ti(r,p),g=rA(r,p),v=L.getState(),w=cr(v),_=Ei(y,o,w,v.levelEditor.halfGridResolution),b=!Be(_.world,s.current?.world);switch(w.type){case"item":{if(!b||(n(Bi()),_.world===void 0))break;const x=zo(v,o,_.world.itemId);if(x===void 0)break;const[,k]=x,C=Ku(_,o,w.item);if(C===void 0||gk({roomState:o,blockPosition:C,itemTool:w.item}))break;n(Pl({blockPosition:C,pointedAtItemJson:k,preview:!0}));break}case"pointer":{const x=iA(v,o,i.current);if(x.length===0){Ri(o,_);break}const k=x.map(re=>Bg(v,re));if(Ko(v,...k))break;const S=_.roomId===i.current?.roomId?sA(i.current,y,g,p.metaKey||p.shiftKey,a.current!==void 0,k):void 0;if(!S){Ri(o,_);break}x.length===1&&!Fg(v,x[0])&&L.dispatch(zs({jsonItemIds:x}));const z=i.current?.world?.onItem.edge,K=z&&k.every(re=>zd(re)),D=a.current??fe,q=W(D,S),O=Qu(q,K);if(a.current=q,Ta(Qu(D,K),O))break;const se=qo(O);let M,X;if(K){const[,re]=zo(v,o,i.current.world.itemId);({timesDelta:X,positionDelta:M}=tA({jsonItem:re,blockDragAccVec:se,resizeEdgeDirection:z.point}))}else M=se;if(Cp({roomState:o,jsonItemIds:x,blockPositionDelta:M,timesDelta:X}))break;n(Cd({jsonItemIds:x,positionDelta:M,timesDelta:X}));break}case"eyeDropper":Ri(o,_);break}s.current=_},c=p=>{const y=L.getState();if(o.id!==y.levelEditor.currentlyEditingRoomId)return;const g=Ti(r,p),v=cr(L.getState()),w=Ei(g,o,v,y.levelEditor.halfGridResolution),_=a.current!==void 0,b=!_&&w.roomId===i.current?.roomId&&w.world?.itemId===i.current?.world?.itemId;if(a.current=void 0,i.current=void 0,L.dispatch(Dg(!1)),!b&&!_){console.log("mouseUp - not a click or drag end - skipping");return}switch(v.type){case"item":{if(w.world===void 0){n(nn({type:"pointer"}));break}const x=zo(y,o,w.world.itemId);if(x===void 0)break;const[,k]=x;n(Pl({blockPosition:Ku(w,o,v.item),pointedAtItemJson:k,preview:!1}));break}case"pointer":{if(b){const x=w.world===void 0?void 0:o.items[w.world.itemId];if(x?.jsonItemId===void 0||Ko(y,x)){n(zs({jsonItemIds:[]}));break}n(p.ctrlKey||p.metaKey?Lg({jsonItemId:x.jsonItemId}):zs({jsonItemIds:[x.jsonItemId]}))}else _&&n(Pd());break}case"eyeDropper":{if(b){const x=w.world?.itemId;if(x===void 0){console.warn("no itemId");break}const k=o.items[x];if(Ko(y,k))break;const C=zo(y,o,x);if(C===void 0)break;const[,S]=C;n(nn({type:"item",item:{type:S.type,config:S.config}}))}break}}},u=p=>{const y=cr(L.getState());switch(a.current=void 0,i.current=void 0,y.type){case"item":{n(Bi());break}case"pointer":{n(jd(void 0));break}}},d=p=>{const y=Ti(r,p),g=L.getState(),v=cr(g),w=Ei(y,o,v,g.levelEditor.halfGridResolution);console.log("setting mouseDownPointingAtRef to",w),i.current=w},h=QP(l);return t.addEventListener("mousemove",h),t.addEventListener("mouseup",c),t.addEventListener("mousedown",d),t.addEventListener("mouseleave",u),t.tabIndex=0,()=>{t.removeEventListener("mousemove",h),t.removeEventListener("mouseup",c),t.removeEventListener("mousedown",d),t.removeEventListener("mouseleave",u)}},[e.stage,r,t,n,o])},lA=()=>{const{cssUpscale:t,canvasSize:e,rotate90:r}=_r(Oa);return{transform:r?`scale(${t}) rotate(90deg) translate(0, -${e.y}px)`:`scale(${t})`,width:e.x,height:e.y,transformOrigin:"top left"}},cA=t=>{const e=Sp(),r=Pr();m.useEffect(()=>{let n=0;const o=({deltaMS:s})=>{if(t.destroyed)return;t.renderContext.room!==e&&console.warn("room renderer does not have the current room");const i=new Set(Yo(e.items));e.roomTime+=s,t.tick({deltaMS:s,movedItems:i,progression:n++}),r.render()};return Vr.shared.add(o),()=>{Vr.shared.remove(o)}},[t,e,r])},uA=t=>{const e=Pr();m.useEffect(()=>{if(t)return t.appendChild(e.canvas),()=>{t.removeChild(e.canvas)}},[t,e])},dA=()=>{const t=Pr(),e=_r(r=>r.upscale.upscale.gameEngineUpscale);t.stage.scale=e},hA=()=>{const t=Pr(),e=_r(Ym);m.useEffect(()=>{t.renderer?.resize(e.x,e.y)},[t.renderer,e])},fA=t=>{const e=Pr(),[r]=m.useState(()=>new te),n=_r(Zm);m.useEffect(()=>{if(t.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return r.addChild(t.output.graphics),e.stage.addChild(r),()=>{e.stage.removeChild(r),r.removeChild(t.output.graphics)}},[t,e,r]),m.useEffect(()=>{r.x=n.x/2,r.y=n.y-16},[r,n])},ed=(t,e)=>{L.dispatch(Qm(eg(t??tg(L.getState()),e)))},pA=(t,e)=>{const r=Xe();m.useLayoutEffect(()=>{ed()},[]),m.useLayoutEffect(()=>{const n=()=>ed(t,e);if(e){const o=new ResizeObserver(n);return o.observe(e),()=>o.disconnect()}else return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[r,e,t])},mA=()=>{m.useEffect(()=>rg({actionCreator:nn,effect(t,{dispatch:e}){e(Bi())}}))},gA=({levelEditor:t})=>{const{dragInProgress:e,clickableAnnotationHovered:r,hoveredItem:n,selectedJsonItemIds:o}=t;if(e)return pe("cursor-grabbing");if(r)return pe("cursor-pointer");if(n){const s=$d(t,n.jsonItemId);if(s!==void 0&&zd(s))if(n.pointingAtOnItem.corner){if(Ta(n.pointingAtOnItem.corner,{x:1,y:1,z:1}))return pe("cursor-n-resize")}else{const{edge:i}=n.pointingAtOnItem;if(i){if(Be(i,Kp))return pe("cursor-e-resize");if(Be(i,Fp))return pe("cursor-s-resize");if(Be(i,qp))return pe("cursor-w-resize");if(Be(i,Up)||Be(i,Wp))return pe("cursor-ne-resize");if(Be(i,Hp)||Be(i,Gp))return pe("cursor-nw-resize");if(Be(i,Xp))return pe("cursor-se-resize");if(Be(i,Vp))return pe("cursor-sw-resize")}}return o.includes(n.jsonItemId)?pe("cursor-grab"):pe("cursor-default")}return pe("cursor-crosshair")},yA=()=>me(gA);ng.defaultOptions.scaleMode="nearest";const vA=()=>{const t=UP(),[e,r]=m.useState(null),[n,o]=m.useState(null),s=yA();pA("amigaLowResPal",n??void 0),hA(),fA(t),cA(t),aA(e),uA(e),dA(),mA();const i=lA();return f.jsx("div",{className:`w-full h-full overflow-hidden ${s}`,ref:o,children:f.jsx("div",{style:i,ref:r})})},td=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,wA=()=>{const t=og(),e=_r(sg);m.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",ig())},[]),m.useEffect(()=>{document.body.classList.remove(...Object.keys(ag).map(td)),document.body.classList.add(td(t)),document.body.classList.toggle("portrait-rot",e)},[t,e])},Ts=m.createContext(null);Ts.displayName="PanelGroupContext";const ve={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},yl=10,hr=m.useLayoutEffect,rd=fd.useId,bA=typeof rd=="function"?rd:()=>null;let xA=0;function vl(t=null){const e=bA(),r=m.useRef(t||e||null);return r.current===null&&(r.current=""+xA++),t??r.current}function Yp({children:t,className:e="",collapsedSize:r,collapsible:n,defaultSize:o,forwardedRef:s,id:i,maxSize:a,minSize:l,onCollapse:c,onExpand:u,onResize:d,order:h,style:p,tagName:y="div",...g}){const v=m.useContext(Ts);if(v===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:w,expandPanel:_,getPanelSize:b,getPanelStyle:x,groupId:k,isPanelCollapsed:C,reevaluatePanelConstraints:S,registerPanel:z,resizePanel:K,unregisterPanel:D}=v,q=vl(i),O=m.useRef({callbacks:{onCollapse:c,onExpand:u,onResize:d},constraints:{collapsedSize:r,collapsible:n,defaultSize:o,maxSize:a,minSize:l},id:q,idIsFromProps:i!==void 0,order:h});m.useRef({didLogMissingDefaultSizeWarning:!1}),hr(()=>{const{callbacks:M,constraints:X}=O.current,V={...X};O.current.id=q,O.current.idIsFromProps=i!==void 0,O.current.order=h,M.onCollapse=c,M.onExpand=u,M.onResize=d,X.collapsedSize=r,X.collapsible=n,X.defaultSize=o,X.maxSize=a,X.minSize=l,(V.collapsedSize!==X.collapsedSize||V.collapsible!==X.collapsible||V.maxSize!==X.maxSize||V.minSize!==X.minSize)&&S(O.current,V)}),hr(()=>{const M=O.current;return z(M),()=>{D(M)}},[h,q,z,D]),m.useImperativeHandle(s,()=>({collapse:()=>{w(O.current)},expand:M=>{_(O.current,M)},getId(){return q},getSize(){return b(O.current)},isCollapsed(){return C(O.current)},isExpanded(){return!C(O.current)},resize:M=>{K(O.current,M)}}),[w,_,b,C,q,K]);const se=x(O.current,o);return m.createElement(y,{...g,children:t,className:e,id:q,style:{...se,...p},[ve.groupId]:k,[ve.panel]:"",[ve.panelCollapsible]:n||void 0,[ve.panelId]:q,[ve.panelSize]:parseFloat(""+se.flexGrow).toFixed(1)})}const Xo=m.forwardRef((t,e)=>m.createElement(Yp,{...t,forwardedRef:e}));Yp.displayName="Panel";Xo.displayName="forwardRef(Panel)";let Sa=null,Jo=-1,Ft=null;function _A(t,e){if(e){const r=(e&rm)!==0,n=(e&nm)!==0,o=(e&om)!==0,s=(e&sm)!==0;if(r)return o?"se-resize":s?"ne-resize":"e-resize";if(n)return o?"sw-resize":s?"nw-resize":"w-resize";if(o)return"s-resize";if(s)return"n-resize"}switch(t){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function SA(){Ft!==null&&(document.head.removeChild(Ft),Sa=null,Ft=null,Jo=-1)}function Ii(t,e){var r,n;const o=_A(t,e);if(Sa!==o){if(Sa=o,Ft===null&&(Ft=document.createElement("style"),document.head.appendChild(Ft)),Jo>=0){var s;(s=Ft.sheet)===null||s===void 0||s.removeRule(Jo)}Jo=(r=(n=Ft.sheet)===null||n===void 0?void 0:n.insertRule(`*{cursor: ${o} !important;}`))!==null&&r!==void 0?r:-1}}function Zp(t){return t.type==="keydown"}function Qp(t){return t.type.startsWith("pointer")}function em(t){return t.type.startsWith("mouse")}function Rs(t){if(Qp(t)){if(t.isPrimary)return{x:t.clientX,y:t.clientY}}else if(em(t))return{x:t.clientX,y:t.clientY};return{x:1/0,y:1/0}}function kA(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function CA(t,e,r){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function PA(t,e){if(t===e)throw new Error("Cannot compare node with itself");const r={a:sd(t),b:sd(e)};let n;for(;r.a.at(-1)===r.b.at(-1);)t=r.a.pop(),e=r.b.pop(),n=t;ee(n,"Stacking order can only be calculated for elements with a common ancestor");const o={a:od(nd(r.a)),b:od(nd(r.b))};if(o.a===o.b){const s=n.childNodes,i={a:r.a.at(-1),b:r.b.at(-1)};let a=s.length;for(;a--;){const l=s[a];if(l===i.a)return 1;if(l===i.b)return-1}}return Math.sign(o.a-o.b)}const AA=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function EA(t){var e;const r=getComputedStyle((e=tm(t))!==null&&e!==void 0?e:t).display;return r==="flex"||r==="inline-flex"}function TA(t){const e=getComputedStyle(t);return!!(e.position==="fixed"||e.zIndex!=="auto"&&(e.position!=="static"||EA(t))||+e.opacity<1||"transform"in e&&e.transform!=="none"||"webkitTransform"in e&&e.webkitTransform!=="none"||"mixBlendMode"in e&&e.mixBlendMode!=="normal"||"filter"in e&&e.filter!=="none"||"webkitFilter"in e&&e.webkitFilter!=="none"||"isolation"in e&&e.isolation==="isolate"||AA.test(e.willChange)||e.webkitOverflowScrolling==="touch")}function nd(t){let e=t.length;for(;e--;){const r=t[e];if(ee(r,"Missing node"),TA(r))return r}return null}function od(t){return t&&Number(getComputedStyle(t).zIndex)||0}function sd(t){const e=[];for(;t;)e.push(t),t=tm(t);return e}function tm(t){const{parentNode:e}=t;return e&&e instanceof ShadowRoot?e.host:e}const rm=1,nm=2,om=4,sm=8,RA=kA()==="coarse";let rt=[],tn=!1,Ut=new Map,Is=new Map;const Zn=new Set;function IA(t,e,r,n,o){var s;const{ownerDocument:i}=e,a={direction:r,element:e,hitAreaMargins:n,setResizeHandlerState:o},l=(s=Ut.get(i))!==null&&s!==void 0?s:0;return Ut.set(i,l+1),Zn.add(a),cs(),function(){var u;Is.delete(t),Zn.delete(a);const d=(u=Ut.get(i))!==null&&u!==void 0?u:1;if(Ut.set(i,d-1),cs(),d===1&&Ut.delete(i),rt.includes(a)){const h=rt.indexOf(a);h>=0&&rt.splice(h,1),bl(),o("up",!0,null)}}}function OA(t){const{target:e}=t,{x:r,y:n}=Rs(t);tn=!0,wl({target:e,x:r,y:n}),cs(),rt.length>0&&(us("down",t),t.preventDefault(),im(e)||t.stopImmediatePropagation())}function Oi(t){const{x:e,y:r}=Rs(t);if(tn&&t.buttons===0&&(tn=!1,us("up",t)),!tn){const{target:n}=t;wl({target:n,x:e,y:r})}us("move",t),bl(),rt.length>0&&t.preventDefault()}function ji(t){const{target:e}=t,{x:r,y:n}=Rs(t);Is.clear(),tn=!1,rt.length>0&&(t.preventDefault(),im(e)||t.stopImmediatePropagation()),us("up",t),wl({target:e,x:r,y:n}),bl(),cs()}function im(t){let e=t;for(;e;){if(e.hasAttribute(ve.resizeHandle))return!0;e=e.parentElement}return!1}function wl({target:t,x:e,y:r}){rt.splice(0);let n=null;(t instanceof HTMLElement||t instanceof SVGElement)&&(n=t),Zn.forEach(o=>{const{element:s,hitAreaMargins:i}=o,a=s.getBoundingClientRect(),{bottom:l,left:c,right:u,top:d}=a,h=RA?i.coarse:i.fine;if(e>=c-h&&e<=u+h&&r>=d-h&&r<=l+h){if(n!==null&&document.contains(n)&&s!==n&&!s.contains(n)&&!n.contains(s)&&PA(n,s)>0){let y=n,g=!1;for(;y&&!y.contains(s);){if(CA(y.getBoundingClientRect(),a)){g=!0;break}y=y.parentElement}if(g)return}rt.push(o)}})}function $i(t,e){Is.set(t,e)}function bl(){let t=!1,e=!1;rt.forEach(n=>{const{direction:o}=n;o==="horizontal"?t=!0:e=!0});let r=0;Is.forEach(n=>{r|=n}),t&&e?Ii("intersection",r):t?Ii("horizontal",r):e?Ii("vertical",r):SA()}let zi;function cs(){var t;(t=zi)===null||t===void 0||t.abort(),zi=new AbortController;const e={capture:!0,signal:zi.signal};Zn.size&&(tn?(rt.length>0&&Ut.forEach((r,n)=>{const{body:o}=n;r>0&&(o.addEventListener("contextmenu",ji,e),o.addEventListener("pointerleave",Oi,e),o.addEventListener("pointermove",Oi,e))}),Ut.forEach((r,n)=>{const{body:o}=n;o.addEventListener("pointerup",ji,e),o.addEventListener("pointercancel",ji,e)})):Ut.forEach((r,n)=>{const{body:o}=n;r>0&&(o.addEventListener("pointerdown",OA,e),o.addEventListener("pointermove",Oi,e))}))}function us(t,e){Zn.forEach(r=>{const{setResizeHandlerState:n}=r,o=rt.includes(r);n(t,o,e)})}function jA(){const[t,e]=m.useState(0);return m.useCallback(()=>e(r=>r+1),[])}function ee(t,e){if(!t)throw console.error(e),Error(e)}function br(t,e,r=yl){return t.toFixed(r)===e.toFixed(r)?0:t>e?1:-1}function St(t,e,r=yl){return br(t,e,r)===0}function Fe(t,e,r){return br(t,e,r)===0}function $A(t,e,r){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++){const o=t[n],s=e[n];if(!Fe(o,s,r))return!1}return!0}function Yr({panelConstraints:t,panelIndex:e,size:r}){const n=t[e];ee(n!=null,`Panel constraints not found for index ${e}`);let{collapsedSize:o=0,collapsible:s,maxSize:i=100,minSize:a=0}=n;if(br(r,a)<0)if(s){const l=(o+a)/2;br(r,l)<0?r=o:r=a}else r=a;return r=Math.min(i,r),r=parseFloat(r.toFixed(yl)),r}function zn({delta:t,initialLayout:e,panelConstraints:r,pivotIndices:n,prevLayout:o,trigger:s}){if(Fe(t,0))return e;const i=[...e],[a,l]=n;ee(a!=null,"Invalid first pivot index"),ee(l!=null,"Invalid second pivot index");let c=0;if(s==="keyboard"){{const d=t<0?l:a,h=r[d];ee(h,`Panel constraints not found for index ${d}`);const{collapsedSize:p=0,collapsible:y,minSize:g=0}=h;if(y){const v=e[d];if(ee(v!=null,`Previous layout not found for panel index ${d}`),Fe(v,p)){const w=g-v;br(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}{const d=t<0?a:l,h=r[d];ee(h,`No panel constraints found for index ${d}`);const{collapsedSize:p=0,collapsible:y,minSize:g=0}=h;if(y){const v=e[d];if(ee(v!=null,`Previous layout not found for panel index ${d}`),Fe(v,g)){const w=v-p;br(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}}{const d=t<0?1:-1;let h=t<0?l:a,p=0;for(;;){const g=e[h];ee(g!=null,`Previous layout not found for panel index ${h}`);const w=Yr({panelConstraints:r,panelIndex:h,size:100})-g;if(p+=w,h+=d,h<0||h>=r.length)break}const y=Math.min(Math.abs(t),Math.abs(p));t=t<0?0-y:y}{let h=t<0?a:l;for(;h>=0&&h<r.length;){const p=Math.abs(t)-Math.abs(c),y=e[h];ee(y!=null,`Previous layout not found for panel index ${h}`);const g=y-p,v=Yr({panelConstraints:r,panelIndex:h,size:g});if(!Fe(y,v)&&(c+=y-v,i[h]=v,c.toPrecision(3).localeCompare(Math.abs(t).toPrecision(3),void 0,{numeric:!0})>=0))break;t<0?h--:h++}}if($A(o,i))return o;{const d=t<0?l:a,h=e[d];ee(h!=null,`Previous layout not found for panel index ${d}`);const p=h+c,y=Yr({panelConstraints:r,panelIndex:d,size:p});if(i[d]=y,!Fe(y,p)){let g=p-y,w=t<0?l:a;for(;w>=0&&w<r.length;){const _=i[w];ee(_!=null,`Previous layout not found for panel index ${w}`);const b=_+g,x=Yr({panelConstraints:r,panelIndex:w,size:b});if(Fe(_,x)||(g-=x-_,i[w]=x),Fe(g,0))break;t>0?w--:w++}}}const u=i.reduce((d,h)=>h+d,0);return Fe(u,100)?i:o}function zA({layout:t,panelsArray:e,pivotIndices:r}){let n=0,o=100,s=0,i=0;const a=r[0];ee(a!=null,"No pivot index found"),e.forEach((d,h)=>{const{constraints:p}=d,{maxSize:y=100,minSize:g=0}=p;h===a?(n=g,o=y):(s+=g,i+=y)});const l=Math.min(o,100-s),c=Math.max(n,100-i),u=t[a];return{valueMax:l,valueMin:c,valueNow:u}}function Qn(t,e=document){return Array.from(e.querySelectorAll(`[${ve.resizeHandleId}][data-panel-group-id="${t}"]`))}function am(t,e,r=document){const o=Qn(t,r).findIndex(s=>s.getAttribute(ve.resizeHandleId)===e);return o??null}function lm(t,e,r){const n=am(t,e,r);return n!=null?[n,n+1]:[-1,-1]}function NA(t){return t instanceof HTMLElement?!0:typeof t=="object"&&t!==null&&"tagName"in t&&"getAttribute"in t}function cm(t,e=document){if(NA(e)&&e.dataset.panelGroupId==t)return e;const r=e.querySelector(`[data-panel-group][data-panel-group-id="${t}"]`);return r||null}function Os(t,e=document){const r=e.querySelector(`[${ve.resizeHandleId}="${t}"]`);return r||null}function MA(t,e,r,n=document){var o,s,i,a;const l=Os(e,n),c=Qn(t,n),u=l?c.indexOf(l):-1,d=(o=(s=r[u])===null||s===void 0?void 0:s.id)!==null&&o!==void 0?o:null,h=(i=(a=r[u+1])===null||a===void 0?void 0:a.id)!==null&&i!==void 0?i:null;return[d,h]}function DA({committedValuesRef:t,eagerValuesRef:e,groupId:r,layout:n,panelDataArray:o,panelGroupElement:s,setLayout:i}){m.useRef({didWarnAboutMissingResizeHandle:!1}),hr(()=>{if(!s)return;const a=Qn(r,s);for(let l=0;l<o.length-1;l++){const{valueMax:c,valueMin:u,valueNow:d}=zA({layout:n,panelsArray:o,pivotIndices:[l,l+1]}),h=a[l];if(h!=null){const p=o[l];ee(p,`No panel data found for index "${l}"`),h.setAttribute("aria-controls",p.id),h.setAttribute("aria-valuemax",""+Math.round(c)),h.setAttribute("aria-valuemin",""+Math.round(u)),h.setAttribute("aria-valuenow",d!=null?""+Math.round(d):"")}}return()=>{a.forEach((l,c)=>{l.removeAttribute("aria-controls"),l.removeAttribute("aria-valuemax"),l.removeAttribute("aria-valuemin"),l.removeAttribute("aria-valuenow")})}},[r,n,o,s]),m.useEffect(()=>{if(!s)return;const a=e.current;ee(a,"Eager values not found");const{panelDataArray:l}=a,c=cm(r,s);ee(c!=null,`No group found for id "${r}"`);const u=Qn(r,s);ee(u,`No resize handles found for group id "${r}"`);const d=u.map(h=>{const p=h.getAttribute(ve.resizeHandleId);ee(p,"Resize handle element has no handle id attribute");const[y,g]=MA(r,p,l,s);if(y==null||g==null)return()=>{};const v=w=>{if(!w.defaultPrevented)switch(w.key){case"Enter":{w.preventDefault();const _=l.findIndex(b=>b.id===y);if(_>=0){const b=l[_];ee(b,`No panel data found for index ${_}`);const x=n[_],{collapsedSize:k=0,collapsible:C,minSize:S=0}=b.constraints;if(x!=null&&C){const z=zn({delta:Fe(x,k)?S-k:k-x,initialLayout:n,panelConstraints:l.map(K=>K.constraints),pivotIndices:lm(r,p,s),prevLayout:n,trigger:"keyboard"});n!==z&&i(z)}}break}}};return h.addEventListener("keydown",v),()=>{h.removeEventListener("keydown",v)}});return()=>{d.forEach(h=>h())}},[s,t,e,r,n,o,i])}function id(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function um(t,e){const r=t==="horizontal",{x:n,y:o}=Rs(e);return r?n:o}function LA(t,e,r,n,o){const s=r==="horizontal",i=Os(e,o);ee(i,`No resize handle element found for id "${e}"`);const a=i.getAttribute(ve.groupId);ee(a,"Resize handle element has no group id attribute");let{initialCursorPosition:l}=n;const c=um(r,t),u=cm(a,o);ee(u,`No group element found for id "${a}"`);const d=u.getBoundingClientRect(),h=s?d.width:d.height;return(c-l)/h*100}function BA(t,e,r,n,o,s){if(Zp(t)){const i=r==="horizontal";let a=0;t.shiftKey?a=100:o!=null?a=o:a=10;let l=0;switch(t.key){case"ArrowDown":l=i?0:a;break;case"ArrowLeft":l=i?-a:0;break;case"ArrowRight":l=i?a:0;break;case"ArrowUp":l=i?0:-a;break;case"End":l=100;break;case"Home":l=-100;break}return l}else return n==null?0:LA(t,e,r,n,s)}function FA({panelDataArray:t}){const e=Array(t.length),r=t.map(s=>s.constraints);let n=0,o=100;for(let s=0;s<t.length;s++){const i=r[s];ee(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;a!=null&&(n++,e[s]=a,o-=a)}for(let s=0;s<t.length;s++){const i=r[s];ee(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;if(a!=null)continue;const l=t.length-n,c=o/l;n++,e[s]=c,o-=c}return e}function Ur(t,e,r){e.forEach((n,o)=>{const s=t[o];ee(s,`Panel data not found for index ${o}`);const{callbacks:i,constraints:a,id:l}=s,{collapsedSize:c=0,collapsible:u}=a,d=r[l];if(d==null||n!==d){r[l]=n;const{onCollapse:h,onExpand:p,onResize:y}=i;y&&y(n,d),u&&(h||p)&&(p&&(d==null||St(d,c))&&!St(n,c)&&p(),h&&(d==null||!St(d,c))&&St(n,c)&&h())}})}function No(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!=e[r])return!1;return!0}function UA({defaultSize:t,dragState:e,layout:r,panelData:n,panelIndex:o,precision:s=3}){const i=r[o];let a;return i==null?a=t!=null?t.toPrecision(s):"1":n.length===1?a="1":a=i.toPrecision(s),{flexBasis:0,flexGrow:a,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function HA(t,e=10){let r=null;return(...o)=>{r!==null&&clearTimeout(r),r=setTimeout(()=>{t(...o)},e)}}function ad(t){try{if(typeof localStorage<"u")t.getItem=e=>localStorage.getItem(e),t.setItem=(e,r)=>{localStorage.setItem(e,r)};else throw new Error("localStorage not supported in this environment")}catch(e){console.error(e),t.getItem=()=>null,t.setItem=()=>{}}}function dm(t){return`react-resizable-panels:${t}`}function hm(t){return t.map(e=>{const{constraints:r,id:n,idIsFromProps:o,order:s}=e;return o?n:s?`${s}:${JSON.stringify(r)}`:JSON.stringify(r)}).sort((e,r)=>e.localeCompare(r)).join(",")}function fm(t,e){try{const r=dm(t),n=e.getItem(r);if(n){const o=JSON.parse(n);if(typeof o=="object"&&o!=null)return o}}catch{}return null}function WA(t,e,r){var n,o;const s=(n=fm(t,r))!==null&&n!==void 0?n:{},i=hm(e);return(o=s[i])!==null&&o!==void 0?o:null}function GA(t,e,r,n,o){var s;const i=dm(t),a=hm(e),l=(s=fm(t,o))!==null&&s!==void 0?s:{};l[a]={expandToSizes:Object.fromEntries(r.entries()),layout:n};try{o.setItem(i,JSON.stringify(l))}catch(c){console.error(c)}}function ld({layout:t,panelConstraints:e}){const r=[...t],n=r.reduce((s,i)=>s+i,0);if(r.length!==e.length)throw Error(`Invalid ${e.length} panel layout: ${r.map(s=>`${s}%`).join(", ")}`);if(!Fe(n,100)&&r.length>0)for(let s=0;s<e.length;s++){const i=r[s];ee(i!=null,`No layout data found for index ${s}`);const a=100/n*i;r[s]=a}let o=0;for(let s=0;s<e.length;s++){const i=r[s];ee(i!=null,`No layout data found for index ${s}`);const a=Yr({panelConstraints:e,panelIndex:s,size:i});i!=a&&(o+=i-a,r[s]=a)}if(!Fe(o,0))for(let s=0;s<e.length;s++){const i=r[s];ee(i!=null,`No layout data found for index ${s}`);const a=i+o,l=Yr({panelConstraints:e,panelIndex:s,size:a});if(i!==l&&(o-=l-i,r[s]=l,Fe(o,0)))break}return r}const qA=100,Nn={getItem:t=>(ad(Nn),Nn.getItem(t)),setItem:(t,e)=>{ad(Nn),Nn.setItem(t,e)}},cd={};function pm({autoSaveId:t=null,children:e,className:r="",direction:n,forwardedRef:o,id:s=null,onLayout:i=null,keyboardResizeBy:a=null,storage:l=Nn,style:c,tagName:u="div",...d}){const h=vl(s),p=m.useRef(null),[y,g]=m.useState(null),[v,w]=m.useState([]),_=jA(),b=m.useRef({}),x=m.useRef(new Map),k=m.useRef(0),C=m.useRef({autoSaveId:t,direction:n,dragState:y,id:h,keyboardResizeBy:a,onLayout:i,storage:l}),S=m.useRef({layout:v,panelDataArray:[],panelDataArrayChanged:!1});m.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),m.useImperativeHandle(o,()=>({getId:()=>C.current.id,getLayout:()=>{const{layout:P}=S.current;return P},setLayout:P=>{const{onLayout:R}=C.current,{layout:E,panelDataArray:I}=S.current,T=ld({layout:P,panelConstraints:I.map(N=>N.constraints)});id(E,T)||(w(T),S.current.layout=T,R&&R(T),Ur(I,T,b.current))}}),[]),hr(()=>{C.current.autoSaveId=t,C.current.direction=n,C.current.dragState=y,C.current.id=h,C.current.onLayout=i,C.current.storage=l}),DA({committedValuesRef:C,eagerValuesRef:S,groupId:h,layout:v,panelDataArray:S.current.panelDataArray,setLayout:w,panelGroupElement:p.current}),m.useEffect(()=>{const{panelDataArray:P}=S.current;if(t){if(v.length===0||v.length!==P.length)return;let R=cd[t];R==null&&(R=HA(GA,qA),cd[t]=R);const E=[...P],I=new Map(x.current);R(t,E,I,v,l)}},[t,v,l]),m.useEffect(()=>{});const z=m.useCallback(P=>{const{onLayout:R}=C.current,{layout:E,panelDataArray:I}=S.current;if(P.constraints.collapsible){const T=I.map(qe=>qe.constraints),{collapsedSize:N=0,panelSize:ne,pivotIndices:ce}=nr(I,P,E);if(ee(ne!=null,`Panel size not found for panel "${P.id}"`),!St(ne,N)){x.current.set(P.id,ne);const Ve=qr(I,P)===I.length-1?ne-N:N-ne,ue=zn({delta:Ve,initialLayout:E,panelConstraints:T,pivotIndices:ce,prevLayout:E,trigger:"imperative-api"});No(E,ue)||(w(ue),S.current.layout=ue,R&&R(ue),Ur(I,ue,b.current))}}},[]),K=m.useCallback((P,R)=>{const{onLayout:E}=C.current,{layout:I,panelDataArray:T}=S.current;if(P.constraints.collapsible){const N=T.map(Je=>Je.constraints),{collapsedSize:ne=0,panelSize:ce=0,minSize:qe=0,pivotIndices:Ve}=nr(T,P,I),ue=R??qe;if(St(ce,ne)){const Je=x.current.get(P.id),xn=Je!=null&&Je>=ue?Je:ue,js=qr(T,P)===T.length-1?ce-xn:xn-ce,je=zn({delta:js,initialLayout:I,panelConstraints:N,pivotIndices:Ve,prevLayout:I,trigger:"imperative-api"});No(I,je)||(w(je),S.current.layout=je,E&&E(je),Ur(T,je,b.current))}}},[]),D=m.useCallback(P=>{const{layout:R,panelDataArray:E}=S.current,{panelSize:I}=nr(E,P,R);return ee(I!=null,`Panel size not found for panel "${P.id}"`),I},[]),q=m.useCallback((P,R)=>{const{panelDataArray:E}=S.current,I=qr(E,P);return UA({defaultSize:R,dragState:y,layout:v,panelData:E,panelIndex:I})},[y,v]),O=m.useCallback(P=>{const{layout:R,panelDataArray:E}=S.current,{collapsedSize:I=0,collapsible:T,panelSize:N}=nr(E,P,R);return ee(N!=null,`Panel size not found for panel "${P.id}"`),T===!0&&St(N,I)},[]),se=m.useCallback(P=>{const{layout:R,panelDataArray:E}=S.current,{collapsedSize:I=0,collapsible:T,panelSize:N}=nr(E,P,R);return ee(N!=null,`Panel size not found for panel "${P.id}"`),!T||br(N,I)>0},[]),M=m.useCallback(P=>{const{panelDataArray:R}=S.current;R.push(P),R.sort((E,I)=>{const T=E.order,N=I.order;return T==null&&N==null?0:T==null?-1:N==null?1:T-N}),S.current.panelDataArrayChanged=!0,_()},[_]);hr(()=>{if(S.current.panelDataArrayChanged){S.current.panelDataArrayChanged=!1;const{autoSaveId:P,onLayout:R,storage:E}=C.current,{layout:I,panelDataArray:T}=S.current;let N=null;if(P){const ce=WA(P,T,E);ce&&(x.current=new Map(Object.entries(ce.expandToSizes)),N=ce.layout)}N==null&&(N=FA({panelDataArray:T}));const ne=ld({layout:N,panelConstraints:T.map(ce=>ce.constraints)});id(I,ne)||(w(ne),S.current.layout=ne,R&&R(ne),Ur(T,ne,b.current))}}),hr(()=>{const P=S.current;return()=>{P.layout=[]}},[]);const X=m.useCallback(P=>{let R=!1;const E=p.current;return E&&window.getComputedStyle(E,null).getPropertyValue("direction")==="rtl"&&(R=!0),function(T){T.preventDefault();const N=p.current;if(!N)return()=>null;const{direction:ne,dragState:ce,id:qe,keyboardResizeBy:Ve,onLayout:ue}=C.current,{layout:Je,panelDataArray:xn}=S.current,{initialLayout:uo}=ce??{},js=lm(qe,P,N);let je=BA(T,P,ne,ce,Ve,N);const xl=ne==="horizontal";xl&&R&&(je=-je);const gm=xn.map(ym=>ym.constraints),_n=zn({delta:je,initialLayout:uo??Je,panelConstraints:gm,pivotIndices:js,prevLayout:Je,trigger:Zp(T)?"keyboard":"mouse-or-touch"}),_l=!No(Je,_n);(Qp(T)||em(T))&&k.current!=je&&(k.current=je,!_l&&je!==0?xl?$i(P,je<0?rm:nm):$i(P,je<0?om:sm):$i(P,0)),_l&&(w(_n),S.current.layout=_n,ue&&ue(_n),Ur(xn,_n,b.current))}},[]),V=m.useCallback((P,R)=>{const{onLayout:E}=C.current,{layout:I,panelDataArray:T}=S.current,N=T.map(Je=>Je.constraints),{panelSize:ne,pivotIndices:ce}=nr(T,P,I);ee(ne!=null,`Panel size not found for panel "${P.id}"`);const Ve=qr(T,P)===T.length-1?ne-R:R-ne,ue=zn({delta:Ve,initialLayout:I,panelConstraints:N,pivotIndices:ce,prevLayout:I,trigger:"imperative-api"});No(I,ue)||(w(ue),S.current.layout=ue,E&&E(ue),Ur(T,ue,b.current))},[]),re=m.useCallback((P,R)=>{const{layout:E,panelDataArray:I}=S.current,{collapsedSize:T=0,collapsible:N}=R,{collapsedSize:ne=0,collapsible:ce,maxSize:qe=100,minSize:Ve=0}=P.constraints,{panelSize:ue}=nr(I,P,E);ue!=null&&(N&&ce&&St(ue,T)?St(T,ne)||V(P,ne):ue<Ve?V(P,Ve):ue>qe&&V(P,qe))},[V]),J=m.useCallback((P,R)=>{const{direction:E}=C.current,{layout:I}=S.current;if(!p.current)return;const T=Os(P,p.current);ee(T,`Drag handle element not found for id "${P}"`);const N=um(E,R);g({dragHandleId:P,dragHandleRect:T.getBoundingClientRect(),initialCursorPosition:N,initialLayout:I})},[]),ie=m.useCallback(()=>{g(null)},[]),be=m.useCallback(P=>{const{panelDataArray:R}=S.current,E=qr(R,P);E>=0&&(R.splice(E,1),delete b.current[P.id],S.current.panelDataArrayChanged=!0,_())},[_]),ge=m.useMemo(()=>({collapsePanel:z,direction:n,dragState:y,expandPanel:K,getPanelSize:D,getPanelStyle:q,groupId:h,isPanelCollapsed:O,isPanelExpanded:se,reevaluatePanelConstraints:re,registerPanel:M,registerResizeHandle:X,resizePanel:V,startDragging:J,stopDragging:ie,unregisterPanel:be,panelGroupElement:p.current}),[z,y,n,K,D,q,h,O,se,re,M,X,V,J,ie,be]),A={display:"flex",flexDirection:n==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return m.createElement(Ts.Provider,{value:ge},m.createElement(u,{...d,children:e,className:r,id:s,ref:p,style:{...A,...c},[ve.group]:"",[ve.groupDirection]:n,[ve.groupId]:h}))}const mm=m.forwardRef((t,e)=>m.createElement(pm,{...t,forwardedRef:e}));pm.displayName="PanelGroup";mm.displayName="forwardRef(PanelGroup)";function qr(t,e){return t.findIndex(r=>r===e||r.id===e.id)}function nr(t,e,r){const n=qr(t,e),s=n===t.length-1?[n-1,n]:[n,n+1],i=r[n];return{...e.constraints,panelSize:i,pivotIndices:s}}function VA({disabled:t,handleId:e,resizeHandler:r,panelGroupElement:n}){m.useEffect(()=>{if(t||r==null||n==null)return;const o=Os(e,n);if(o==null)return;const s=i=>{if(!i.defaultPrevented)switch(i.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{i.preventDefault(),r(i);break}case"F6":{i.preventDefault();const a=o.getAttribute(ve.groupId);ee(a,`No group element found for id "${a}"`);const l=Qn(a,n),c=am(a,e,n);ee(c!==null,`No resize element found for id "${e}"`);const u=i.shiftKey?c>0?c-1:l.length-1:c+1<l.length?c+1:0;l[u].focus();break}}};return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}},[n,t,e,r])}function ka({children:t=null,className:e="",disabled:r=!1,hitAreaMargins:n,id:o,onBlur:s,onClick:i,onDragging:a,onFocus:l,onPointerDown:c,onPointerUp:u,style:d={},tabIndex:h=0,tagName:p="div",...y}){var g,v;const w=m.useRef(null),_=m.useRef({onClick:i,onDragging:a,onPointerDown:c,onPointerUp:u});m.useEffect(()=>{_.current.onClick=i,_.current.onDragging=a,_.current.onPointerDown=c,_.current.onPointerUp=u});const b=m.useContext(Ts);if(b===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:x,groupId:k,registerResizeHandle:C,startDragging:S,stopDragging:z,panelGroupElement:K}=b,D=vl(o),[q,O]=m.useState("inactive"),[se,M]=m.useState(!1),[X,V]=m.useState(null),re=m.useRef({state:q});hr(()=>{re.current.state=q}),m.useEffect(()=>{if(r)V(null);else{const ge=C(D);V(()=>ge)}},[r,D,C]);const J=(g=n?.coarse)!==null&&g!==void 0?g:15,ie=(v=n?.fine)!==null&&v!==void 0?v:5;m.useEffect(()=>{if(r||X==null)return;const ge=w.current;ee(ge,"Element ref not attached");let A=!1;return IA(D,ge,x,{coarse:J,fine:ie},(R,E,I)=>{if(!E){O("inactive");return}switch(R){case"down":{O("drag"),A=!1,ee(I,'Expected event to be defined for "down" action'),S(D,I);const{onDragging:T,onPointerDown:N}=_.current;T?.(!0),N?.();break}case"move":{const{state:T}=re.current;A=!0,T!=="drag"&&O("hover"),ee(I,'Expected event to be defined for "move" action'),X(I);break}case"up":{O("hover"),z();const{onClick:T,onDragging:N,onPointerUp:ne}=_.current;N?.(!1),ne?.(),A||T?.();break}}})},[J,x,r,ie,C,D,X,S,z]),VA({disabled:r,handleId:D,resizeHandler:X,panelGroupElement:K});const be={touchAction:"none",userSelect:"none"};return m.createElement(p,{...y,children:t,className:e,id:o,onBlur:()=>{M(!1),s?.()},onFocus:()=>{M(!0),l?.()},ref:w,role:"separator",style:{...be,...d},tabIndex:h,[ve.groupDirection]:x,[ve.groupId]:k,[ve.resizeHandle]:"",[ve.resizeHandleActive]:q==="drag"?"pointer":se?"keyboard":void 0,[ve.resizeHandleEnabled]:!r,[ve.resizeHandleId]:D,[ve.resizeHandleState]:q})}ka.displayName="PanelResizeHandle";const KA=lg(()=>Ht(()=>import("./JsonRoomEditor-BF7Hwxx1.js").then(t=>t.J),__vite__mapDeps([8,1,2,6,9]))),XA=m.lazy(KA),JA=()=>{wA();const t=f.jsx("div",{className:"flex h-full items-center justify-center bg-pureBlack",children:f.jsx("span",{className:"sprite texture-animated-head_walking_right"})});return f.jsx(f.Fragment,{children:f.jsx(pk,{children:f.jsx(Qa,{children:f.jsxs(mm,{direction:"horizontal",className:"w-full h-full",children:[f.jsx(Xo,{id:"jsonEditor",defaultSize:18,minSize:12,collapsible:!0,children:f.jsx(m.Suspense,{fallback:t,children:f.jsx(XA,{})})}),f.jsx(ka,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-r-[calc(1px*var(--scale))] border-metallicBlue"}),f.jsx(Xo,{id:"editingArea",children:f.jsx(BP,{children:f.jsx(vA,{})})}),f.jsx(ka,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-l-[calc(1px*var(--scale))] border-metallicBlue"}),f.jsx(Xo,{id:"toolbar",defaultSize:20,maxSize:33,minSize:10,children:f.jsx(vk,{})})]})})})})},dE=Object.freeze(Object.defineProperty({__proto__:null,default:JA},Symbol.toStringTag,{value:"Module"}));export{Gd as A,Ud as C,Yt as F,dE as L,Na as R,Sy as S,qd as V,Ey as a,uE as b,oE as h,pe as t,_y as u};
