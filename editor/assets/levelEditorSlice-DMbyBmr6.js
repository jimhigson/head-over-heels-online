import{u as E,x as Y,y as K,z as _,A as re,F as ne,H as se,I as ie,J as B,K as R,L as $,N as ae,O as ce,Q as le,W as de,X as ue,Y as ye,Z as me,_ as fe,$ as pe}from"./index-F6GOuoSH.js";var T={},C={},O;function ge(){if(O)return C;O=1;function e(i,l){var r;if(typeof Symbol>"u"||i[Symbol.iterator]==null){if(Array.isArray(i)||(r=t(i))||l){r&&(i=r);var u=0,a=function(){};return{s:a,n:function(){return u>=i.length?{done:!0}:{done:!1,value:i[u++]}},e:function(m){throw m},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y=!0,h=!1,p;return{s:function(){r=i[Symbol.iterator]()},n:function(){var m=r.next();return y=m.done,m},e:function(m){h=!0,p=m},f:function(){try{!y&&r.return!=null&&r.return()}finally{if(h)throw p}}}}function t(i,l){if(i){if(typeof i=="string")return o(i,l);var r=Object.prototype.toString.call(i).slice(8,-1);if(r==="Object"&&i.constructor&&(r=i.constructor.name),r==="Map"||r==="Set")return Array.from(i);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(i,l)}}function o(i,l){(l==null||l>i.length)&&(l=i.length);for(var r=0,u=new Array(l);r<l;r++)u[r]=i[r];return u}var n=E(),s=n.ensureIterable;function c(i){var l=[],r=e(i),u;try{for(r.s();!(u=r.n()).done;){var a=u.value;l.push(a)}}catch(y){r.e(y)}finally{r.f()}return l}C.__toArray=c;function f(i){return c(s(i))}return C.toArray=f,C}var W;function he(){if(W)return T;W=1;var e=Y(),t=e.mark(f),o=E(),n=o.iterableCurry,s=ge(),c=s.__toArray;function f(l,r){var u;return e.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(u=Array.isArray(l)?l:c(l),u.length){y.next=3;break}return y.abrupt("return");case 3:if(!r--){y.next=7;break}return y.delegateYield(u,"t0",5);case 5:y.next=3;break;case 7:case"end":return y.stop()}},t)}T.__cycleTimes=f;var i=n(f);return T.cycleTimes=i,T}var S={},F;function ve(){if(F)return S;F=1;var e=E(),t=e.iterableCurry,o=he(),n=o.__cycleTimes;function s(f){return n(f,1/0)}S.__cycle=s;var c=t(s);return S.cycle=c,S}var A={},H;function Ie(){if(H)return A;H=1;var e=Y(),t=e.mark(i);function o(r,u){var a;if(typeof Symbol>"u"||r[Symbol.iterator]==null){if(Array.isArray(r)||(a=n(r))||u){a&&(r=a);var y=0,h=function(){};return{s:h,n:function(){return y>=r.length?{done:!0}:{done:!1,value:r[y++]}},e:function(w){throw w},f:h}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,d=!1,m;return{s:function(){a=r[Symbol.iterator]()},n:function(){var w=a.next();return p=w.done,w},e:function(w){d=!0,m=w},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(d)throw m}}}}function n(r,u){if(r){if(typeof r=="string")return s(r,u);var a=Object.prototype.toString.call(r).slice(8,-1);if(a==="Object"&&r.constructor&&(a=r.constructor.name),a==="Map"||a==="Set")return Array.from(r);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return s(r,u)}}function s(r,u){(u==null||u>r.length)&&(u=r.length);for(var a=0,y=new Array(u);a<u;a++)y[a]=r[a];return y}var c=E(),f=c.iterableCurry;function i(r,u){var a,y,h,p;return e.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(u!==0){m.next=2;break}return m.abrupt("return");case 2:a=0,y=o(r),m.prev=4,y.s();case 6:if((h=y.n()).done){m.next=14;break}return p=h.value,m.next=10,p;case 10:if(++a!==u){m.next=12;break}return m.abrupt("break",14);case 12:m.next=6;break;case 14:m.next=19;break;case 16:m.prev=16,m.t0=m.catch(4),y.e(m.t0);case 19:return m.prev=19,y.f(),m.finish(19);case 22:case"end":return m.stop()}},t,null,[[4,16,19,22]])}A.__take=i;var l=f(i);return A.take=l,A}var J,j;function be(){return j||(j=1,J=ve().cycle),J}var we=be();const ke=K(we);var x,L;function Re(){return L||(L=1,x=Ie().take),x}var Te=Re();const Ce=K(Te),Se={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},P=(e,t)=>[...Ce(t,ke(Se[e]))],Ae=e=>({awayWall:{type:"wall",config:{direction:"away",tiles:P("blacktooth",e.x)},position:{x:0,y:e.y,z:0}},leftWall:{type:"wall",config:{direction:"left",tiles:P("blacktooth",e.y)},position:{x:e.x,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:e.x}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:e.y}},position:{x:0,y:0,z:0}}}),Q=e=>({planet:"blacktooth",color:{hue:"cyan",shade:"basic"},size:e,items:{floor:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:e},position:{x:0,y:0,z:0}},...Ae(e)}}),v=e=>e.campaignInProgress.rooms[e.currentlyEditingRoomId],M=(e,t)=>e.campaignInProgress.rooms[t],Dt=(e,t)=>e.campaignInProgress.rooms[e.currentlyEditingRoomId]?.items[t],k={w:16,d:16,h:12},U={x:16,y:16,z:12},Ee=["head","heels"],Je=[...Ee,"headOverHeels"],g=(...e)=>t=>e.includes(t.type),xe=g("bubbles","stopAutowalk","firedDoughnut","floatingText","emitter","particle"),ze=(e,t)=>xe(e)||Oe(e)&&(t!==void 0&&De(t)||e.config.direction.z!==0)||Fe(e)&&e.config.floorType==="none",$t=(e,t)=>!ze(e,t),_e=["ball","slidingBlock","slidingDeadly"];g(..._e);const Pe=["portableBlock","spring","sceneryPlayer","sceneryCrown","monster","slidingBlock"],Xe=["dalek","turtle","elephantHead","homingBot","helicopterBug"],qt=e=>e.type==="slidingBlock"?e.config.style==="puck":e.type==="monster"?Xe.includes(e.config.which):Pe.includes(e.type),De=e=>e.type==="head"||e.type==="heels"||e.type==="headOverHeels";function Bt(e){return $e.includes(e.type)}const $e=[...Je,"monster","ball","charles","pushableBlock","movingPlatform","moveableDeadly","pickup","portableBlock","slidingBlock","slidingDeadly","spring","sceneryPlayer","sceneryCrown"],qe=["monster","deadlyBlock","moveableDeadly","slidingDeadly"];g(...qe);const Be=e=>e.config.times!==void 0,Oe=g("portal");g("teleporter");g("heels");g("head");g("heels","headOverHeels");g("head","headOverHeels");g("lift");g("emitter");const We=g("monster"),Fe=g("floor");g("pickup");g("spring");const Ot=g("joystick");g("monster","movingPlatform");const Wt=e=>We(e)&&e.config.which==="cyberman"&&e.state.everActivated===!1,Ft=(e,t={})=>{const o=He(t),n=_(U,e);return _(re(o,U),n)},V=e=>({x:e.direction==="away"?e.tiles.length:e.direction==="towards"?e.times?.x:1,y:e.direction==="left"?e.tiles.length:e.direction==="right"?e.times?.y:1}),Ht=e=>Be(e)?e.type==="wall"?V(e.config):e.config.times:void 0,He=e=>({x:e.x??1,y:e.y??1,z:e.z??1}),je=e=>({x:e.x??1,y:e.y??1});function*Le(e,t,o){for(const n of se(e)){const[s,c]=n;if(c.type!=="wall"){yield n;continue}if(c.config.direction!==t){yield n;continue}const{position:f,config:i}=c,l=je(V(i)),r=ie(B(i.direction)),u=B(i.direction),a=_(o,f);if(a[u]!==0){yield n;continue}if(a[r]<-1){yield n;continue}if(a[r]>l[r]){yield n;continue}if(l[r]===2)continue;const y=a[r]===0;y&&(yield[s,R(c,p=>{p.position=$(f,{[r]:2});const d=p.config;switch(d.direction){case"towards":d.times={x:l[r]-2};break;case"right":d.times={y:l[r]-2};break;default:d.tiles=d.tiles.slice(2)}})]);const h=a[r]===l[r]-2;h&&(yield[s,R(c,p=>{const d=p.config;switch(d.direction){case"towards":d.times={x:l[r]-2};break;case"right":d.times={y:l[r]-2};break;default:d.tiles=d.tiles.slice(0,-2)}})]),!y&&!h&&(yield[`${s}/beforeDoor`,R(c,p=>{const d=p.config;switch(d.direction){case"towards":d.times={x:a[r]};break;case"right":d.times={y:a[r]};break;default:d.tiles=d.tiles.slice(0,a[r])}})],yield[`${s}/afterDoor`,R(c,p=>{p.position={...f,[r]:o[r]+2};const d=p.config;switch(d.direction){case"towards":d.times={x:l[r]-a[r]-2};break;case"right":d.times={y:l[r]-a[r]-2};break;default:d.tiles=d.tiles.slice(a[r]+2)}})])}}const G=(e,t,o)=>{e.items=ne(Le(e.items,t,o))},I=e=>{const t=structuredClone(ae(v(e))),{history:o}=e;o.redo=[],o.undo.push(t)},Me={undo(e){const t=e,{campaignInProgress:o,history:{undo:n,redo:s},currentlyEditingRoomId:c}=t;n.length!==0&&(s.push(o.rooms[c]),o.rooms[c]=n.pop())},redo(e){const t=e,{campaignInProgress:o,history:{redo:n,undo:s},currentlyEditingRoomId:c}=t;n.length!==0&&(s.push(o.rooms[c]),o.rooms[c]=n.pop())}},Ue={selectCanUndo:e=>e.history.undo.length>0,selectCanRedo:e=>e.history.redo.length>0},jt=({x:e=0,y:t=0})=>t-e,Z=({x:e=0,y:t=0,z:o=0})=>({x:t-e,y:-(e+t)/2-o}),Lt=(e,t,o)=>{const n=Z(t),s=ce(e,n);return $(Ge(s,o),t)},Ge=({x:e,y:t},o)=>{switch(o){case"xy":return{x:-(e/2+t),y:e/2-t,z:0};case"xz":return{x:-e,y:0,z:e/2-t};case"yz":return{x:0,y:e,z:-e/2-t};default:throw new Error(`unknown plane ${o}`)}},Ne=({x:e=0,y:t=0,z:o=0})=>({x:e*k.w,y:t*k.d,z:o*k.h}),Ye=({x:e=0,y:t=0,z:o=0})=>({x:e/k.w,y:t/k.d,z:o/k.h}),Mt=e=>Z(Ne(e)),ee=(e,t)=>{e.planet=t;for(const o of Object.values(e.items))o.type==="floor"&&o.config.floorType==="standable"&&(o.config.scenery=t),o.type==="wall"&&(o.config.direction==="away"||o.config.direction==="left")&&(o.config.tiles=P(t,o.config.tiles.length)),o.type==="pickup"&&o.config.gives==="crown"&&le.includes(t)&&(o.config.planet=t)},te=(e,t,o)=>{const n=`room_${e.nextRoomId++}`,s={id:n,...structuredClone(Q({x:8,y:8})),color:o};return ee(s,t),e.campaignInProgress.rooms[n]=s,s},oe=(e,t)=>{const o=t.type==="monster"?t.config.which:t.type;for(let n=1;;n++){const s=n===1?o:`${o}_${n}`;if(!e.items[s])return s}},z=(e,t,o)=>{const n=v(e),s=oe(n,t);n.items[s]={type:t.type,config:t.config,position:o}},Ke=e=>e.type==="door",Qe=e=>e.type==="monster"&&e.config.which==="cyberman",Ve={applyToolToRoomJson(e,{payload:{blockPosition:t,pointedAtItem:o}}){const n=e,{tool:s}=n;switch(s?.type){case"item":{if(Ke(s.item)&&o.type==="wall"){I(n);const c=v(n),f=o.config.direction;G(c,f,t);const i=te(n,c.planet,c.color);z(n,{...s.item,config:{...s.item.config,toRoom:i.id,direction:f}},t);const l=oe(i,s.item),r={x:f==="left"?0:f==="right"?i.size.x:Math.floor(i.size.x/2),y:f==="away"?0:f==="towards"?i.size.x:Math.floor(i.size.x/2),z:t.z},u=de(f),a={type:"door",config:{toRoom:c.id,direction:u},position:r};i.items[l]=a,G(i,u,r)}else Qe(s.item)&&o.type==="deadlyBlock"&&o.config.style==="toaster"&&Ye(o.state.position).z+1===t.z?(I(n),z(n,{...s.item,config:{...s.item.config,activated:"off"}},t)):(I(n),z(n,s.item,t));n.selectedJsonItemIds=[];break}}}},Ze={moveItemInRoom(e,{payload:{jsonItemId:t,positionDelta:o}}){const n=e,s=v(n);I(n);const c=s.items[t];c.position=$(s.items[t].position,o)},changeDragInProgress(e,{payload:t}){const o=e;o.dragInProgress=t}},et={changeGridResolution(e,{payload:t}){const o=e;o.halfGridResolution=t},changeWallsFloorsLocked(e,{payload:t}){const o=e;o.wallsFloorsLocked=t}},tt={setSelectedItemInRoom(e,{payload:{jsonItemId:t,additive:o=!1}}){if(o)if(t===void 0)e.selectedJsonItemIds=[];else{const n=e.selectedJsonItemIds.indexOf(t);n===-1?e.selectedJsonItemIds.push(t):e.selectedJsonItemIds.splice(n,1)}else e.selectedJsonItemIds=t===void 0?[]:[t]},setHoveredItemInRoom(e,t){e.hoveredJsonItemId=t.payload},setClickableAnnotationHovered(e,t){e.clickableAnnotationHovered=t.payload}},ot=e=>ye(e.items),rt=e=>ue(ot(e)),N=(e,t)=>{rt(e).filter(o=>o.type==="floor").filter(o=>o.position.z===0).forEach(o=>{o.config={...o.config,floorType:t,scenery:t==="standable"?e.planet:void 0}})},nt={changeRoomColour(e,{payload:t}){const o=e,n=o.campaignInProgress.rooms[o.currentlyEditingRoomId].color;I(o),Object.assign(n,t)},changeRoomScenery(e,{payload:t}){const o=e,n=v(o);I(o),ee(n,t)},roomJsonEdited(e,{payload:t}){const o=e;o.campaignInProgress.rooms[o.currentlyEditingRoomId]=t},deleteSelected(e){const t=e,o=v(t);I(t),t.selectedJsonItemIds.forEach(n=>{delete o.items[n]}),t.selectedJsonItemIds=[]},clearRoom(e){const t=e,o=v(t);I(t);for(const n of me(o.items)){const s=o.items[n];s.type!=="floor"&&s.type!=="wall"&&s.type!=="door"&&(delete o.items[n],t.selectedJsonItemIds=t.selectedJsonItemIds.filter(c=>c!==n))}},setRoomAboveOrBelow(e,{payload:t}){const o=e,n=t.direction,s=n==="roomAbove"?"roomBelow":"roomAbove",c=v(o),f=t.createNew?te(o,c.planet,c.color).id:t.roomId,i=c[n]&&M(o,c[n]);i?.[s]===o.currentlyEditingRoomId&&(i[s]=void 0),c[n]=f;const l=f&&M(o,f);l!==void 0&&(l[s]=c.id),l?N(n==="roomBelow"?c:l,"none"):N(n==="roomBelow"?c:i,"standable")}},X="room_0",st={id:X,...Q({x:8,y:8})},D={campaignInProgress:{name:"new campaign",rooms:{[X]:st}},nextRoomId:1,currentlyEditingRoomId:X,tool:{type:"pointer"},hoveredJsonItemId:void 0,clickableAnnotationHovered:!1,selectedJsonItemIds:[],halfGridResolution:!1,wallsFloorsLocked:!0,dragInProgress:!1,history:{undo:[],redo:[]}},q=fe({name:"levelEditor",initialState:D,reducers:{setTool(e,{payload:t}){const o=e;t.type==="item"&&(o.selectedJsonItemIds=[]),o.tool=t},changeToRoom(e,{payload:t}){const o=e;if(!o.campaignInProgress.rooms[t]){console.warn(`can't change to room ${t} - it doesn't exist`);return}o.currentlyEditingRoomId=t,o.clickableAnnotationHovered=!1,o.hoveredJsonItemId=void 0,o.selectedJsonItemIds=[],o.history=D.history},injected(){},...et,...Me,...Ve,...Ze,...tt,...nt},selectors:{selectCurrentEditingRoomJson:v,selectCurrentEditingRoomColour:e=>v(e).color,selectCurrentEditingRoomScenery:e=>v(e).planet,selectTool:e=>e.tool,selectSelectedJsonItemIds:e=>e.selectedJsonItemIds,selectHoveredJsonItemId:e=>e.hoveredJsonItemId,...Ue}}),{applyToolToRoomJson:it,changeDragInProgress:at,changeGridResolution:ct,changeRoomColour:lt,changeRoomScenery:dt,changeToRoom:ut,changeWallsFloorsLocked:yt,clearRoom:mt,deleteSelected:ft,injected:pt,moveItemInRoom:gt,redo:ht,roomJsonEdited:vt,setClickableAnnotationHovered:It,setHoveredItemInRoom:bt,setRoomAboveOrBelow:wt,setSelectedItemInRoom:kt,setTool:Rt,undo:Tt}=q.actions,{selectCanRedo:Ct,selectCanUndo:St,selectCurrentEditingRoomColour:At,selectCurrentEditingRoomJson:Et,selectCurrentEditingRoomScenery:Jt,selectHoveredJsonItemId:xt,selectSelectedJsonItemIds:zt,selectTool:_t}=q.selectors,Pt=pe.withTypes(),Ut=Object.freeze(Object.defineProperty({__proto__:null,applyToolToRoomJson:it,changeDragInProgress:at,changeGridResolution:ct,changeRoomColour:lt,changeRoomScenery:dt,changeToRoom:ut,changeWallsFloorsLocked:yt,clearRoom:mt,deleteSelected:ft,initialLevelEditorSliceState:D,injected:pt,levelEditorSlice:q,moveItemInRoom:gt,redo:ht,roomJsonEdited:vt,selectCanRedo:Ct,selectCanUndo:St,selectCurrentEditingRoomColour:At,selectCurrentEditingRoomJson:Et,selectCurrentEditingRoomScenery:Jt,selectHoveredJsonItemId:xt,selectSelectedJsonItemIds:zt,selectTool:_t,setClickableAnnotationHovered:It,setHoveredItemInRoom:bt,setRoomAboveOrBelow:wt,setSelectedItemInRoom:kt,setTool:Rt,undo:Tt,useAppSelectorWithLevelEditorSlice:Pt},Symbol.toStringTag,{value:"Module"}));export{Ne as A,$e as B,_e as C,V as D,Ft as E,$t as F,Bt as G,De as H,Ot as I,Wt as J,jt as K,qt as L,It as M,xt as N,zt as O,Ye as P,je as Q,Lt as R,gt as S,at as T,Dt as U,kt as V,it as W,bt as X,Ge as Y,vt as Z,Ut as _,Rt as a,At as b,ct as c,ft as d,lt as e,Jt as f,dt as g,St as h,Ct as i,Tt as j,yt as k,Et as l,P as m,mt as n,v as o,wt as p,ut as q,ht as r,_t as s,Z as t,Pt as u,g as v,Mt as w,Be as x,Ht as y,k as z};
