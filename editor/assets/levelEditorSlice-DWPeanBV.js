import{b as S,c as G,g as M,f as B,h as K,p as Q,i as q,s as V,j as R,k as Z,l as N,m as ee,o as te,n as re,u as oe}from"./index-P3ygAdDe.js";var w={},C={},x;function ne(){if(x)return C;x=1;function t(i,a){var e;if(typeof Symbol>"u"||i[Symbol.iterator]==null){if(Array.isArray(i)||(e=o(i))||a){e&&(i=e);var c=0,s=function(){};return{s,n:function(){return c>=i.length?{done:!0}:{done:!1,value:i[c++]}},e:function(d){throw d},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,g=!1,p;return{s:function(){e=i[Symbol.iterator]()},n:function(){var d=e.next();return u=d.done,d},e:function(d){g=!0,p=d},f:function(){try{!u&&e.return!=null&&e.return()}finally{if(g)throw p}}}}function o(i,a){if(i){if(typeof i=="string")return r(i,a);var e=Object.prototype.toString.call(i).slice(8,-1);if(e==="Object"&&i.constructor&&(e=i.constructor.name),e==="Map"||e==="Set")return Array.from(i);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return r(i,a)}}function r(i,a){(a==null||a>i.length)&&(a=i.length);for(var e=0,c=new Array(a);e<a;e++)c[e]=i[e];return c}var n=S(),y=n.ensureIterable;function f(i){var a=[],e=t(i),c;try{for(e.s();!(c=e.n()).done;){var s=c.value;a.push(s)}}catch(u){e.e(u)}finally{e.f()}return a}C.__toArray=f;function m(i){return f(y(i))}return C.toArray=m,C}var $;function ie(){if($)return w;$=1;var t=G(),o=t.mark(m),r=S(),n=r.iterableCurry,y=ne(),f=y.__toArray;function m(a,e){var c;return t.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(c=Array.isArray(a)?a:f(a),c.length){u.next=3;break}return u.abrupt("return");case 3:if(!e--){u.next=7;break}return u.delegateYield(c,"t0",5);case 5:u.next=3;break;case 7:case"end":return u.stop()}},o)}w.__cycleTimes=m;var i=n(m);return w.cycleTimes=i,w}var T={},z;function se(){if(z)return T;z=1;var t=S(),o=t.iterableCurry,r=ie(),n=r.__cycleTimes;function y(m){return n(m,1/0)}T.__cycle=y;var f=o(y);return T.cycle=f,T}var k={},W;function ae(){if(W)return k;W=1;var t=G(),o=t.mark(i);function r(e,c){var s;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(s=n(e))||c){s&&(e=s);var u=0,g=function(){};return{s:g,n:function(){return u>=e.length?{done:!0}:{done:!1,value:e[u++]}},e:function(I){throw I},f:g}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,l=!1,d;return{s:function(){s=e[Symbol.iterator]()},n:function(){var I=s.next();return p=I.done,I},e:function(I){l=!0,d=I},f:function(){try{!p&&s.return!=null&&s.return()}finally{if(l)throw d}}}}function n(e,c){if(e){if(typeof e=="string")return y(e,c);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return y(e,c)}}function y(e,c){(c==null||c>e.length)&&(c=e.length);for(var s=0,u=new Array(c);s<c;s++)u[s]=e[s];return u}var f=S(),m=f.iterableCurry;function i(e,c){var s,u,g,p;return t.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(c!==0){d.next=2;break}return d.abrupt("return");case 2:s=0,u=r(e),d.prev=4,u.s();case 6:if((g=u.n()).done){d.next=14;break}return p=g.value,d.next=10,p;case 10:if(++s!==c){d.next=12;break}return d.abrupt("break",14);case 12:d.next=6;break;case 14:d.next=19;break;case 16:d.prev=16,d.t0=d.catch(4),u.e(d.t0);case 19:return d.prev=19,u.f(),d.finish(19);case 22:case"end":return d.stop()}},o,null,[[4,16,19,22]])}k.__take=i;var a=m(i);return k.take=a,k}var A,D;function le(){return D||(D=1,A=se().cycle),A}var ce=le();const ue=M(ce);var E,P;function de(){return P||(P=1,E=ae().take),E}var fe=de();const ye=M(fe),me={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","more-fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},_=(t,o)=>[...ye(o,ue(me[t]))],pe={awayWall:{type:"wall",config:{direction:"away",times:{x:8},tiles:_("blacktooth",8)},position:{x:0,y:8,z:0}},leftWall:{type:"wall",config:{direction:"left",times:{y:8},tiles:_("blacktooth",8)},position:{x:8,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:8}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:8}},position:{x:0,y:0,z:0}}},j={x:8,y:8},H={planet:"blacktooth",color:{hue:"cyan",shade:"basic"},size:j,items:{...pe,floor:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:j},position:{x:0,y:0,z:0}}}},h=t=>t.campaignInProgress.rooms[t.currentlyEditingRoomId];function*ge(t,o,r){for(const n of K(t)){const[y,f]=n;if(f.type!=="wall"){yield n;continue}if(f.config.direction!==o){yield n;continue}const{position:m,config:i}=f,a={x:1,y:1,...i.times},e=Q(q(i.direction)),c=q(i.direction),s=V(r,m);if(s[c]!==0){yield n;continue}if(s[e]<-1){yield n;continue}if(s[e]>a[e]){yield n;continue}if(a[e]===2)continue;s[e]===0&&(yield[y,R(f,p=>{p.position=Z(m,{[e]:2});const l=p.config;l.times={[e]:a[e]-2},l.tiles&&(l.tiles=l.tiles.slice(2))})]),s[e]===a[e]-2&&(yield[y,R(f,p=>{const l=p.config;l.times={[e]:a[e]-2},l.tiles&&(l.tiles=l.tiles.slice(0,l.tiles.length-2))})]),yield[`${y}/beforeDoor`,R(f,p=>{const l=p.config;l.times={[e]:s[e]},l.tiles&&(l.tiles=l.tiles.slice(0,s[e]))})],yield[`${y}/afterDoor`,R(f,p=>{p.position={...m,[e]:r[e]+2};const l=p.config;l.times={[e]:a[e]-s[e]-2},l.tiles&&(l.tiles=l.tiles.slice(s[e]+2))})]}}const O=(t,o,r)=>{t.items=B(ge(t.items,o,r))},b=t=>{const o=structuredClone(N(h(t))),{history:r}=t;r.redo=[],r.undo.push(o)},he={undo(t){const o=t,{campaignInProgress:r,history:{undo:n,redo:y},currentlyEditingRoomId:f}=o;n.length!==0&&(y.push(r.rooms[f]),r.rooms[f]=n.pop())},redo(t){const o=t,{campaignInProgress:r,history:{redo:n,undo:y},currentlyEditingRoomId:f}=o;n.length!==0&&(y.push(r.rooms[f]),r.rooms[f]=n.pop())}},ve={selectCanUndo:t=>t.history.undo.length>0,selectCanRedo:t=>t.history.redo.length>0},L=(t,o)=>{t.planet=o;for(const r of Object.values(t.items))r.type==="floor"&&r.config.floorType==="standable"&&(r.config.scenery=o),r.type==="wall"&&(r.config.direction==="away"||r.config.direction==="left")&&(r.config.tiles=_(o,r.config.tiles.length)),r.type==="pickup"&&r.config.gives==="crown"&&ee.includes(o)&&(r.config.planet=o)},X=(t,o)=>`${o}#${t.nextItemId++}`,F=(t,o,r,n)=>{const y=X(t,o),f=h(t);t.nextItemId++,f.items[y]={type:o,config:r,position:n}},Ie=t=>t.type==="door",be={applyToolToRoomJson(t,{payload:{blockPosition:o,pointedAtItem:r}}){const n=t,{tool:y}=n;switch(y?.type){case"item":{const f=y.item;if(Ie(f)&&r.type==="wall"){b(n);const m=h(n),i=r.config.direction;O(m,i,o);const a=`room#${n.nextRoomId++}`;console.log(a,"toRoomId"),F(n,f.type,{...y.item.config,toRoom:a,direction:i},o);const e={id:a,...structuredClone(H),color:m.color};L(e,m.planet),n.campaignInProgress.rooms[a]=e;const c=X(n,"door"),s={x:i==="left"?0:i==="right"?e.size.x:Math.floor(e.size.x/2),y:i==="away"?0:i==="towards"?e.size.x:Math.floor(e.size.x/2),z:o.z},u=te(i),g={type:"door",config:{toRoom:m.id,direction:u},position:s};e.items[c]=g,O(e,u,s)}else b(n),F(n,y.item.type,y.item.config,o);n.selectedJsonItemIds=[];break}}}},J="room#0",Re={id:J,...structuredClone(H)},U={campaignInProgress:{name:"new campaign",rooms:{[J]:Re}},nextRoomId:1,nextItemId:0,currentlyEditingRoomId:J,tool:{type:"pointer"},selectedJsonItemIds:[],halfGridResolution:!1,history:{undo:[],redo:[]}},Y=re({name:"levelEditor",initialState:U,reducers:{setTool(t,{payload:o}){const r=t;r.tool=o},changeRoomColour(t,{payload:o}){const r=t,n=r.campaignInProgress.rooms[r.currentlyEditingRoomId].color;b(r),Object.assign(n,o)},changeRoomScenery(t,{payload:o}){const r=t,n=h(r);b(r),L(n,o)},changeToRoom(t,{payload:o}){const r=t;r.currentlyEditingRoomId=o,r.history=U.history},roomJsonEdited(t,{payload:o}){const r=t;r.campaignInProgress.rooms[r.currentlyEditingRoomId]=o},setSelectedItemInRoom(t,{payload:{jsonItemId:o,additive:r}}){if(r)if(o===void 0)t.selectedJsonItemIds=[];else{const n=t.selectedJsonItemIds.indexOf(o);n===-1?t.selectedJsonItemIds.push(o):t.selectedJsonItemIds.splice(n,1)}else t.selectedJsonItemIds=o===void 0?[]:[o]},deleteSelected(t){const o=t,r=h(o);b(o),o.selectedJsonItemIds.forEach(n=>{delete r.items[n]}),o.selectedJsonItemIds=[]},injected(){},changeGridResolution(t,{payload:o}){const r=t;r.halfGridResolution=o},...he,...be},selectors:{selectCurrentEditingRoomJson:h,selectCurrentEditingRoomColour:t=>h(t).color,selectCurrentEditingRoomScenery:t=>h(t).planet,selectTool:t=>t.tool,selectSelectedJsonItemIds:t=>t.selectedJsonItemIds,...ve}}),{applyToolToRoomJson:Ce,changeGridResolution:Te,changeRoomColour:ke,changeRoomScenery:Se,changeToRoom:Ae,deleteSelected:Ee,injected:_e,redo:Je,roomJsonEdited:qe,setSelectedItemInRoom:xe,setTool:$e,undo:ze}=Y.actions,{selectCurrentEditingRoomJson:We,selectTool:De,selectCurrentEditingRoomColour:Pe,selectCurrentEditingRoomScenery:je,selectSelectedJsonItemIds:Oe,selectCanRedo:Fe,selectCanUndo:Ue}=Y.selectors,Ge=oe.withTypes();export{Ce as applyToolToRoomJson,Te as changeGridResolution,ke as changeRoomColour,Se as changeRoomScenery,Ae as changeToRoom,Ee as deleteSelected,U as initialLevelEditorSliceState,_e as injected,Y as levelEditorSlice,Je as redo,qe as roomJsonEdited,Fe as selectCanRedo,Ue as selectCanUndo,Pe as selectCurrentEditingRoomColour,We as selectCurrentEditingRoomJson,je as selectCurrentEditingRoomScenery,Oe as selectSelectedJsonItemIds,De as selectTool,xe as setSelectedItemInRoom,$e as setTool,ze as undo,Ge as useAppSelectorWithLevelEditorSlice};
