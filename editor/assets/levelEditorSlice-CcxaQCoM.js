import{b as A,c as G,g as L,s as _,p as Z,f as N,h as ee,i as te,j as $,k,l as re,m as oe,n as ne,o as ie,q as se,u as ae}from"./index-Dqnnq9tl.js";var R={},T={},D;function le(){if(D)return T;D=1;function e(s,a){var t;if(typeof Symbol>"u"||s[Symbol.iterator]==null){if(Array.isArray(s)||(t=r(s))||a){t&&(s=t);var d=0,i=function(){};return{s:i,n:function(){return d>=s.length?{done:!0}:{done:!1,value:s[d++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,h=!1,p;return{s:function(){t=s[Symbol.iterator]()},n:function(){var u=t.next();return c=u.done,u},e:function(u){h=!0,p=u},f:function(){try{!c&&t.return!=null&&t.return()}finally{if(h)throw p}}}}function r(s,a){if(s){if(typeof s=="string")return o(s,a);var t=Object.prototype.toString.call(s).slice(8,-1);if(t==="Object"&&s.constructor&&(t=s.constructor.name),t==="Map"||t==="Set")return Array.from(s);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return o(s,a)}}function o(s,a){(a==null||a>s.length)&&(a=s.length);for(var t=0,d=new Array(a);t<a;t++)d[t]=s[t];return d}var n=A(),f=n.ensureIterable;function y(s){var a=[],t=e(s),d;try{for(t.s();!(d=t.n()).done;){var i=d.value;a.push(i)}}catch(c){t.e(c)}finally{t.f()}return a}T.__toArray=y;function m(s){return y(f(s))}return T.toArray=m,T}var O;function ce(){if(O)return R;O=1;var e=G(),r=e.mark(m),o=A(),n=o.iterableCurry,f=le(),y=f.__toArray;function m(a,t){var d;return e.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(d=Array.isArray(a)?a:y(a),d.length){c.next=3;break}return c.abrupt("return");case 3:if(!t--){c.next=7;break}return c.delegateYield(d,"t0",5);case 5:c.next=3;break;case 7:case"end":return c.stop()}},r)}R.__cycleTimes=m;var s=n(m);return R.cycleTimes=s,R}var C={},j;function de(){if(j)return C;j=1;var e=A(),r=e.iterableCurry,o=ce(),n=o.__cycleTimes;function f(m){return n(m,1/0)}C.__cycle=f;var y=r(f);return C.cycle=y,C}var S={},B;function ue(){if(B)return S;B=1;var e=G(),r=e.mark(s);function o(t,d){var i;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(i=n(t))||d){i&&(t=i);var c=0,h=function(){};return{s:h,n:function(){return c>=t.length?{done:!0}:{done:!1,value:t[c++]}},e:function(I){throw I},f:h}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,l=!1,u;return{s:function(){i=t[Symbol.iterator]()},n:function(){var I=i.next();return p=I.done,I},e:function(I){l=!0,u=I},f:function(){try{!p&&i.return!=null&&i.return()}finally{if(l)throw u}}}}function n(t,d){if(t){if(typeof t=="string")return f(t,d);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return f(t,d)}}function f(t,d){(d==null||d>t.length)&&(d=t.length);for(var i=0,c=new Array(d);i<d;i++)c[i]=t[i];return c}var y=A(),m=y.iterableCurry;function s(t,d){var i,c,h,p;return e.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(d!==0){u.next=2;break}return u.abrupt("return");case 2:i=0,c=o(t),u.prev=4,c.s();case 6:if((h=c.n()).done){u.next=14;break}return p=h.value,u.next=10,p;case 10:if(++i!==d){u.next=12;break}return u.abrupt("break",14);case 12:u.next=6;break;case 14:u.next=19;break;case 16:u.prev=16,u.t0=u.catch(4),c.e(u.t0);case 19:return u.prev=19,c.f(),u.finish(19);case 22:case"end":return u.stop()}},r,null,[[4,16,19,22]])}S.__take=s;var a=m(s);return S.take=a,S}var E,W;function ye(){return W||(W=1,E=de().cycle),E}var fe=ye();const me=L(fe);var x,F;function pe(){return F||(F=1,x=ue().take),x}var ge=pe();const he=L(ge),be={jail:["bars"],blacktooth:["plain","plain","armour","shield","shield","armour"],bookworld:["book","book","cowboy"],egyptus:["hieroglyphics","hieroglyphics","hieroglyphics","sarcophagus","sarcophagus"],market:["passage","more-fruits","fruits","more-fruits","fruits"],moonbase:["coil","window1","window2","window3"],penitentiary:["loop","loop","skeleton"],safari:["wall","shield","wall","window","window","wall","shield"]},z=(e,r)=>[...he(r,me(be[e]))],ve={awayWall:{type:"wall",config:{direction:"away",tiles:z("blacktooth",8)},position:{x:0,y:8,z:0}},leftWall:{type:"wall",config:{direction:"left",tiles:z("blacktooth",8)},position:{x:8,y:0,z:0}},towardsWall:{type:"wall",config:{direction:"towards",times:{x:8}},position:{x:0,y:0,z:0}},rightWall:{type:"wall",config:{direction:"right",times:{y:8}},position:{x:0,y:0,z:0}}},H={x:8,y:8},Y={planet:"blacktooth",color:{hue:"cyan",shade:"basic"},size:H,items:{...ve,floor:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:H},position:{x:0,y:0,z:0}}}},b=e=>e.campaignInProgress.rooms[e.currentlyEditingRoomId],ct={w:16,d:16,h:12},M={x:16,y:16,z:12},Ie=["head","heels"],we=[...Ie,"headOverHeels"],g=(...e)=>r=>e.includes(r.type),ke=g("bubbles","stopAutowalk","firedDoughnut","floatingText","emitter","particle"),Re=(e,r)=>ke(e)||ze(e)&&(r!==void 0&&Ae(r)||e.config.direction.z!==0)||qe(e)&&e.config.floorType==="none",dt=(e,r)=>!Re(e,r),Te=["ball","slidingBlock","slidingDeadly"];g(...Te);const Ce=["portableBlock","spring","sceneryPlayer","sceneryCrown","monster","slidingBlock"],Se=["dalek","turtle","elephantHead","homingBot","helicopterBug"],ut=e=>e.type==="slidingBlock"?e.config.style==="puck":e.type==="monster"?Se.includes(e.config.which):Ce.includes(e.type),Ae=e=>e.type==="head"||e.type==="heels"||e.type==="headOverHeels";function yt(e){return Ee.includes(e.type)}const Ee=[...we,"monster","ball","charles","pushableBlock","movingPlatform","moveableDeadly","pickup","portableBlock","slidingBlock","slidingDeadly","spring","sceneryPlayer","sceneryCrown"],xe=["monster","deadlyBlock","moveableDeadly","slidingDeadly"];g(...xe);const _e=e=>e.config.times!==void 0,ze=g("portal");g("teleporter");g("heels");g("head");g("heels","headOverHeels");g("head","headOverHeels");g("lift");g("emitter");const Je=g("monster"),qe=g("floor");g("pickup");g("spring");const ft=g("joystick");g("monster","movingPlatform");const mt=e=>Je(e)&&e.config.which==="cyberman"&&e.state.everActivated===!1,pt=(e,r={})=>{const o=Pe(r),n=_(M,e);return _(Z(o,M),n)},K=e=>({x:e.direction==="away"?e.tiles.length:e.direction==="towards"?e.times?.x:1,y:e.direction==="left"?e.tiles.length:e.direction==="right"?e.times?.y:1}),gt=e=>_e(e)?e.type==="wall"?K(e.config):e.config.times:void 0,Pe=e=>({x:e.x??1,y:e.y??1,z:e.z??1}),$e=e=>({x:e.x??1,y:e.y??1});function*De(e,r,o){for(const n of ee(e)){const[f,y]=n;if(y.type!=="wall"){yield n;continue}if(y.config.direction!==r){yield n;continue}const{position:m,config:s}=y,a=$e(K(s)),t=te($(s.direction)),d=$(s.direction),i=_(o,m);if(i[d]!==0){yield n;continue}if(i[t]<-1){yield n;continue}if(i[t]>a[t]){yield n;continue}if(a[t]===2)continue;const c=i[t]===0;c&&(yield[f,k(y,p=>{p.position=re(m,{[t]:2});const l=p.config;switch(l.direction){case"towards":l.times={x:a[t]-2};break;case"right":l.times={y:a[t]-2};break;default:l.tiles=l.tiles.slice(2)}})]);const h=i[t]===a[t]-2;h&&(yield[f,k(y,p=>{const l=p.config;switch(l.direction){case"towards":l.times={x:a[t]-2};break;case"right":l.times={y:a[t]-2};break;default:l.tiles=l.tiles.slice(0,-2)}})]),!c&&!h&&(yield[`${f}/beforeDoor`,k(y,p=>{const l=p.config;switch(l.direction){case"towards":l.times={x:i[t]};break;case"right":l.times={y:i[t]};break;default:l.tiles=l.tiles.slice(0,i[t])}})],yield[`${f}/afterDoor`,k(y,p=>{p.position={...m,[t]:o[t]+2};const l=p.config;switch(l.direction){case"towards":l.times={x:a[t]-i[t]-2};break;case"right":l.times={y:a[t]-i[t]-2};break;default:l.tiles=l.tiles.slice(i[t]+2)}})])}}const X=(e,r,o)=>{e.items=N(De(e.items,r,o))},w=e=>{const r=structuredClone(oe(b(e))),{history:o}=e;o.redo=[],o.undo.push(r)},Oe={undo(e){const r=e,{campaignInProgress:o,history:{undo:n,redo:f},currentlyEditingRoomId:y}=r;n.length!==0&&(f.push(o.rooms[y]),o.rooms[y]=n.pop())},redo(e){const r=e,{campaignInProgress:o,history:{redo:n,undo:f},currentlyEditingRoomId:y}=r;n.length!==0&&(f.push(o.rooms[y]),o.rooms[y]=n.pop())}},je={selectCanUndo:e=>e.history.undo.length>0,selectCanRedo:e=>e.history.redo.length>0},Q=(e,r)=>{e.planet=r;for(const o of Object.values(e.items))o.type==="floor"&&o.config.floorType==="standable"&&(o.config.scenery=r),o.type==="wall"&&(o.config.direction==="away"||o.config.direction==="left")&&(o.config.tiles=z(r,o.config.tiles.length)),o.type==="pickup"&&o.config.gives==="crown"&&ne.includes(r)&&(o.config.planet=r)},V=(e,r)=>`${r}#${e.nextItemId++}`,U=(e,r,o,n)=>{const f=V(e,r),y=b(e);e.nextItemId++,y.items[f]={type:r,config:o,position:n}},Be=e=>e.type==="door",We={applyToolToRoomJson(e,{payload:{blockPosition:r,pointedAtItem:o}}){const n=e,{tool:f}=n;switch(f?.type){case"item":{const y=f.item;if(Be(y)&&o.type==="wall"){w(n);const m=b(n),s=o.config.direction;X(m,s,r);const a=`room#${n.nextRoomId++}`;console.log(a,"toRoomId"),U(n,y.type,{...f.item.config,toRoom:a,direction:s},r);const t={id:a,...structuredClone(Y),color:m.color};Q(t,m.planet),n.campaignInProgress.rooms[a]=t;const d=V(n,"door"),i={x:s==="left"?0:s==="right"?t.size.x:Math.floor(t.size.x/2),y:s==="away"?0:s==="towards"?t.size.x:Math.floor(t.size.x/2),z:r.z},c=ie(s),h={type:"door",config:{toRoom:m.id,direction:c},position:i};t.items[d]=h,X(t,c,i)}else w(n),U(n,f.item.type,f.item.config,r);n.selectedJsonItemIds=[];break}}}},J="room#0",Fe={id:J,...structuredClone(Y)},q={campaignInProgress:{name:"new campaign",rooms:{[J]:Fe}},nextRoomId:1,nextItemId:0,currentlyEditingRoomId:J,tool:{type:"pointer"},selectedJsonItemIds:[],halfGridResolution:!1,history:{undo:[],redo:[]}},P=se({name:"levelEditor",initialState:q,reducers:{setTool(e,{payload:r}){const o=e;o.tool=r},changeRoomColour(e,{payload:r}){const o=e,n=o.campaignInProgress.rooms[o.currentlyEditingRoomId].color;w(o),Object.assign(n,r)},changeRoomScenery(e,{payload:r}){const o=e,n=b(o);w(o),Q(n,r)},changeToRoom(e,{payload:r}){const o=e;o.currentlyEditingRoomId=r,o.history=q.history},roomJsonEdited(e,{payload:r}){const o=e;o.campaignInProgress.rooms[o.currentlyEditingRoomId]=r},setSelectedItemInRoom(e,{payload:{jsonItemId:r,additive:o}}){if(o)if(r===void 0)e.selectedJsonItemIds=[];else{const n=e.selectedJsonItemIds.indexOf(r);n===-1?e.selectedJsonItemIds.push(r):e.selectedJsonItemIds.splice(n,1)}else e.selectedJsonItemIds=r===void 0?[]:[r]},deleteSelected(e){const r=e,o=b(r);w(r),r.selectedJsonItemIds.forEach(n=>{delete o.items[n]}),r.selectedJsonItemIds=[]},injected(){},changeGridResolution(e,{payload:r}){const o=e;o.halfGridResolution=r},...Oe,...We},selectors:{selectCurrentEditingRoomJson:b,selectCurrentEditingRoomColour:e=>b(e).color,selectCurrentEditingRoomScenery:e=>b(e).planet,selectTool:e=>e.tool,selectSelectedJsonItemIds:e=>e.selectedJsonItemIds,...je}}),{applyToolToRoomJson:He,changeGridResolution:Me,changeRoomColour:Xe,changeRoomScenery:Ue,changeToRoom:Ge,deleteSelected:Le,injected:Ye,redo:Ke,roomJsonEdited:Qe,setSelectedItemInRoom:Ve,setTool:Ze,undo:Ne}=P.actions,{selectCurrentEditingRoomJson:et,selectTool:tt,selectCurrentEditingRoomColour:rt,selectCurrentEditingRoomScenery:ot,selectSelectedJsonItemIds:nt,selectCanRedo:it,selectCanUndo:st}=P.selectors,at=ae.withTypes(),ht=Object.freeze(Object.defineProperty({__proto__:null,applyToolToRoomJson:He,changeGridResolution:Me,changeRoomColour:Xe,changeRoomScenery:Ue,changeToRoom:Ge,deleteSelected:Le,initialLevelEditorSliceState:q,injected:Ye,levelEditorSlice:P,redo:Ke,roomJsonEdited:Qe,selectCanRedo:it,selectCanUndo:st,selectCurrentEditingRoomColour:rt,selectCurrentEditingRoomJson:et,selectCurrentEditingRoomScenery:ot,selectSelectedJsonItemIds:nt,selectTool:tt,setSelectedItemInRoom:Ve,setTool:Ze,undo:Ne,useAppSelectorWithLevelEditorSlice:at},Symbol.toStringTag,{value:"Module"}));export{ft as A,mt as B,ut as C,$e as D,Ve as E,He as F,Le as G,nt as H,Qe as I,ht as J,Ze as a,rt as b,Me as c,Xe as d,ot as e,Ue as f,st as g,it as h,Ne as i,et as j,z as k,Ge as l,ct as m,g as n,_e as o,gt as p,Ee as q,Ke as r,tt as s,Te as t,at as u,pt as v,K as w,dt as x,yt as y,Ae as z};
