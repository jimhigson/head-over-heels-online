const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebGPURenderer-DdPOCf_e.js","assets/index-DIc_YSPQ.js","assets/index-BlUj_3er.css","assets/colorToUniform-KTpA7KSL.js","assets/SharedSystems-efa7YE0Z.js","assets/Graphics-CK_DdYc1.js","assets/levelEditorSlice-OtfEUiWm.js","assets/WebGLRenderer-DXiZUeFS.js","assets/JsonRoomEditor-CGkRczBH.js","assets/JsonRoomEditor-Cpm53wG5.css"])))=>i.map(i=>d[i]);
import{a6 as cl,a5 as Cr,a7 as yt,s as ly,x as ul,y as Ot,e as dl,E as no,a as cy,C as ne,d as ro,v as oo,Z as H,D as ga,az as Gt,k as fh,K as Pn,t as Tt,T as Qn,U as uy,M as dy,aA as er,V as ph,aB as hy,w as ya,aC as fy,aD as py,j as my,aE as En,aF as f,aG as mh,aH as qt,aI as m,aJ as gy,aK as Ns,aL as gh,aM as yy,aN as fe,aO as He,aP as yh,aQ as vy,aR as wy,aS as W,aT as Ge,aU as Sr,am as by,aV as xy,aW as _y,aX as vh,aY as wh,aZ as kr,af as le,aj as Vt,aa as D,a_ as bh,a$ as Cy,b0 as sr,b1 as Ms,b2 as mn,ah as hr,b3 as go,ao as Pr,b4 as Sy,b5 as ky,b6 as Py,ac as vt,ad as ys,au as zs,aq as Ds,an as xh,ap as Kt,b7 as $e,b8 as _h,b9 as Ey,ag as Ty,ar as Ch,av as so,ba as vs,bb as jt,bc as Ay,bd as va,be as Ry,ab as Ls,bf as hl,bg as fl,bh as Zr,ae as ir,bi as Sh,at as pl,bj as ml,bk as Oy,bl as Iy,bm as kh,bn as jy,ai as $y,bo as Ny,bp as gl,bq as gc,br as My,bs as zy,bt as Dy,bu as yl,bv as Ly,bw as By,bx as Fy,by as Uy,bz as Hy,bA as Ph,bB as Ao,bC as Wy,bD as Gy,bE as qy,bF as Vy,bG as Ky,bH as Xy}from"./index-DIc_YSPQ.js";import{r as Jy,u as ge,d as Yy,g as Zy,c as Qy,s as pn,a as Tn,b as ev,e as yc,f as tv,h as nv,i as rv,j as ov,k as sv,l as iv,m as av,n as Bs,o as lv,p as cv,q as vl,t as io,v as gi,w as Eh,x as uv,y as dv,z as hv,A as fv,B as V,C as pv,D as Pe,E as mv,F as gv,G as Th,H as vc,I as wl,J as yv,K as ws,L as wc,M as yn,N as vv,O as wv,P as bv,Q as bl,R as Ah,S as Rh,T as xv,U as _v,V as Cv,W as yo,X as Oh,Y as xl,Z as _l,_ as Ih,$ as jh,a0 as Sv,a1 as bc,a2 as $h,a3 as kv,a4 as Pv,a5 as Nh,a6 as wa,a7 as xc,a8 as Mh,a9 as zh,aa as Ev,ab as Tv,ac as yi,ad as Dh,ae as Av,af as Rv}from"./levelEditorSlice-OtfEUiWm.js";import{S as Ov,G as ht}from"./Graphics-CK_DdYc1.js";function Iv(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function jv(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function $v(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(n=>typeof n=="function")){const n=t.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${e}[${n}]`)}}var _c=t=>Array.isArray(t)?t:[t];function Nv(t){const e=Array.isArray(t[0])?t[0]:t;return $v(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function Mv(t,e){const n=[],{length:r}=t;for(let o=0;o<r;o++)n.push(t[o].apply(null,e));return n}var zv=class{constructor(t){this.value=t}deref(){return this.value}},Dv=typeof WeakRef<"u"?WeakRef:zv,Lv=0,Cc=1;function Ro(){return{s:Lv,v:void 0,o:null,p:null}}function Lh(t,e={}){let n=Ro();const{resultEqualityCheck:r}=e;let o,s=0;function i(){let a=n;const{length:l}=arguments;for(let d=0,h=l;d<h;d++){const p=arguments[d];if(typeof p=="function"||typeof p=="object"&&p!==null){let g=a.o;g===null&&(a.o=g=new WeakMap);const y=g.get(p);y===void 0?(a=Ro(),g.set(p,a)):a=y}else{let g=a.p;g===null&&(a.p=g=new Map);const y=g.get(p);y===void 0?(a=Ro(),g.set(p,a)):a=y}}const c=a;let u;if(a.s===Cc)u=a.v;else if(u=t.apply(null,arguments),s++,r){const d=o?.deref?.()??o;d!=null&&r(d,u)&&(u=d,s!==0&&s--),o=typeof u=="object"&&u!==null||typeof u=="function"?new Dv(u):u}return c.s=Cc,c.v=u,u}return i.clearCache=()=>{n=Ro(),i.resetResultsCount()},i.resultsCount=()=>s,i.resetResultsCount=()=>{s=0},i}function Bv(t,...e){const n=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,r=(...o)=>{let s=0,i=0,a,l={},c=o.pop();typeof c=="object"&&(l=c,c=o.pop()),Iv(c,`createSelector expects an output function after the inputs, but received: [${typeof c}]`);const u={...n,...l},{memoize:d,memoizeOptions:h=[],argsMemoize:p=Lh,argsMemoizeOptions:g=[]}=u,y=_c(h),v=_c(g),w=Nv(o),x=d(function(){return s++,c.apply(null,arguments)},...y),b=p(function(){i++;const S=Mv(w,arguments);return a=x.apply(null,S),a},...v);return Object.assign(b,{resultFunc:c,memoizedResultFunc:x,dependencies:w,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>a,recomputations:()=>s,resetRecomputations:()=>{s=0},memoize:d,argsMemoize:p})};return Object.assign(r,{withTypes:()=>r}),r}var vo=Bv(Lh),Fv=Object.assign((t,e=vo)=>{jv(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const n=Object.keys(t),r=n.map(s=>t[s]);return e(r,(...s)=>s.reduce((i,a,l)=>(i[n[l]]=a,i),{}))},{withTypes:()=>Fv}),Oo={},Sc;function Bh(){if(Sc)return Oo;Sc=1;var t=cl(),e=t.mark(a);function n(c,u){var d;if(typeof Symbol>"u"||c[Symbol.iterator]==null){if(Array.isArray(c)||(d=r(c))||u){d&&(c=d);var h=0,p=function(){};return{s:p,n:function(){return h>=c.length?{done:!0}:{done:!1,value:c[h++]}},e:function(x){throw x},f:p}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var g=!0,y=!1,v;return{s:function(){d=c[Symbol.iterator]()},n:function(){var x=d.next();return g=x.done,x},e:function(x){y=!0,v=x},f:function(){try{!g&&d.return!=null&&d.return()}finally{if(y)throw v}}}}function r(c,u){if(c){if(typeof c=="string")return o(c,u);var d=Object.prototype.toString.call(c).slice(8,-1);if(d==="Object"&&c.constructor&&(d=c.constructor.name),d==="Map"||d==="Set")return Array.from(c);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return o(c,u)}}function o(c,u){(u==null||u>c.length)&&(u=c.length);for(var d=0,h=new Array(u);d<u;d++)h[d]=c[d];return h}var s=Cr(),i=s.iterableCurry;function a(c,u){var d,h,p,g;return t.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d=0,h=n(c),v.prev=2,h.s();case 4:if((p=h.n()).done){v.next=10;break}return g=p.value,v.next=8,u(g,d++);case 8:v.next=4;break;case 10:v.next=15;break;case 12:v.prev=12,v.t0=v.catch(2),h.e(v.t0);case 15:return v.prev=15,h.f(),v.finish(15);case 18:case"end":return v.stop()}},e,null,[[2,12,15,18]])}Oo.__map=a;var l=i(a);return Oo.map=l,Oo}var Io={},kc;function Uv(){if(kc)return Io;kc=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,p=!1,g;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return h=v.done,v},e:function(v){p=!0,g=v},f:function(){try{!h&&c.return!=null&&c.return()}finally{if(p)throw g}}}}function e(a,l){if(a){if(typeof a=="string")return n(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return n(a,l)}}function n(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var r=Cr(),o=r.iterableCurry;function s(a,l){var c=0,u=t(a),d;try{for(u.s();!(d=u.n()).done;){var h=d.value;if(l(h,c++))return!0}}catch(p){u.e(p)}finally{u.f()}return!1}Io.__some=s;var i=o(s,{reduces:!0});return Io.some=i,Io}var jo={},Pc;function Hv(){if(Pc)return jo;Pc=1;var t=cl(),e=t.mark(s),n=Cr(),r=n.wrapWithIterableIterator,o=n.ensureIterable;function s(){var a,l,c,u,d,h,p=arguments;return t.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:for(a=p.length,l=new Array(a),c=0;c<a;c++)l[c]=p[c];u=0,d=l;case 2:if(!(u<d.length)){y.next=8;break}return h=d[u],y.delegateYield(o(h),"t0",5);case 5:u++,y.next=2;break;case 8:case"end":return y.stop()}},e)}jo.__concat=s;var i=r(s);return jo.concat=i,jo}var $o={},Ec;function Wv(){if(Ec)return $o;Ec=1;var t=cl(),e=t.mark(c);function n(d,h){var p;if(typeof Symbol>"u"||d[Symbol.iterator]==null){if(Array.isArray(d)||(p=r(d))||h){p&&(d=p);var g=0,y=function(){};return{s:y,n:function(){return g>=d.length?{done:!0}:{done:!1,value:d[g++]}},e:function(_){throw _},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,w=!1,x;return{s:function(){p=d[Symbol.iterator]()},n:function(){var _=p.next();return v=_.done,_},e:function(_){w=!0,x=_},f:function(){try{!v&&p.return!=null&&p.return()}finally{if(w)throw x}}}}function r(d,h){if(d){if(typeof d=="string")return o(d,h);var p=Object.prototype.toString.call(d).slice(8,-1);if(p==="Object"&&d.constructor&&(p=d.constructor.name),p==="Map"||p==="Set")return Array.from(d);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return o(d,h)}}function o(d,h){(h==null||h>d.length)&&(h=d.length);for(var p=0,g=new Array(h);p<h;p++)g[p]=d[p];return g}var s=Cr(),i=s.iterableCurry,a=Bh(),l=a.__map;function c(d,h){var p,g,y;return t.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:p=n(l(d,h)),w.prev=1,p.s();case 3:if((g=p.n()).done){w.next=8;break}return y=g.value,w.delegateYield(y,"t0",6);case 6:w.next=3;break;case 8:w.next=13;break;case 10:w.prev=10,w.t1=w.catch(1),p.e(w.t1);case 13:return w.prev=13,p.f(),w.finish(13);case 16:case"end":return w.stop()}},e,null,[[1,10,13,16]])}$o.__flatMap=c;var u=i(c);return $o.flatMap=u,$o}var No={},Tc;function Gv(){if(Tc)return No;Tc=1;var t=Cr(),e=t.iterableCurry,n=Jy(),r=n.__firstOr,o=Symbol("none");function s(a){return r(a,o)===o}No.__isEmpty=s;var i=e(s,{reduces:!0});return No.isEmpty=i,No}var Mo={},Ac;function qv(){if(Ac)return Mo;Ac=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,p=!1,g;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return h=v.done,v},e:function(v){p=!0,g=v},f:function(){try{!h&&c.return!=null&&c.return()}finally{if(p)throw g}}}}function e(a,l){if(a){if(typeof a=="string")return n(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return n(a,l)}}function n(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var r=Cr(),o=r.ensureIterable;function s(a){var l=o(a),c=0,u=t(l),d;try{for(u.s();!(d=u.n()).done;){var h=d.value;c++}}catch(p){u.e(p)}finally{u.f()}return c}Mo.__size=s;var i=s;return Mo.size=i,Mo}var vi,Rc;function Vv(){return Rc||(Rc=1,vi=Hv().concat),vi}var Kv=Vv();const Oc=yt(Kv);var wi,Ic;function Xv(){return Ic||(Ic=1,wi=Wv().flatMap),wi}var Jv=Xv();const Yv=yt(Jv);var bi,jc;function Zv(){return jc||(jc=1,bi=Gv().isEmpty),bi}var Qv=Zv();const Fh=yt(Qv);var xi,$c;function ew(){return $c||($c=1,xi=Bh().map),xi}var tw=ew();const Nc=yt(tw);var _i={},Mc;function nw(){if(Mc)return _i;Mc=1;var t=function(r){return r};function e(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return r.length||(r=[t]),r.reduce(function(s,i){return function(){return i(s.apply(void 0,arguments))}})}return _i.pipe=e,_i}var Ci,zc;function rw(){return zc||(zc=1,Ci=nw().pipe),Ci}var ow=rw();const Dc=yt(ow);var Si,Lc;function sw(){return Lc||(Lc=1,Si=qv().size),Si}var iw=sw();const Uh=yt(iw);var ki,Bc;function aw(){return Bc||(Bc=1,ki=Uv().some),ki}var lw=aw();const cw=yt(lw),Hh=class ba extends ly{constructor(e){e={...ba.defaultOptions,...e},super(e),this.enabled=!0,this._state=Ov.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(e,n,r,o){e.applyFilter(this,n,r,o)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:n,gl:r,...o}=e;let s,i;return n&&(s=ul.from(n)),r&&(i=Ot.from(r)),new ba({gpuProgram:s,glProgram:i,...o})}};Hh.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let en=Hh;const xa=[];dl.handleByNamedList(no.Environment,xa);async function uw(t){if(!t)for(let e=0;e<xa.length;e++){const n=xa[e];if(n.value.test()){await n.value.load();return}}}let $r;function dw(){if(typeof $r=="boolean")return $r;try{$r=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{$r=!1}return $r}var Wh=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(Wh||{});class hw{constructor(e){this.items=[],this._name=e}emit(e,n,r,o,s,i,a,l){const{name:c,items:u}=this;for(let d=0,h=u.length;d<h;d++)u[d][c](e,n,r,o,s,i,a,l);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const n=this.items.indexOf(e);return n!==-1&&this.items.splice(n,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const fw=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Gh=class qh extends cy{constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;const n=[...fw,...this.config.runners??[]];this._addRunners(...n),this._unsafeEvalCheck()}async init(e={}){const n=e.skipExtensionImports===!0?!0:e.manageImports===!1;await uw(n),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const r in this._systemsHash)e={...this._systemsHash[r].constructor.defaultOptions,...e};e={...qh.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let r=0;r<this.runners.init.items.length;r++)await this.runners.init.items[r].init(e);this._initOptions=e}render(e,n){let r=e;if(r instanceof ne&&(r={container:r},n&&(ro(oo,"passing a second argument is deprecated, please use render options instead"),r.target=n.renderTexture)),r.target||(r.target=this.view.renderTarget),r.target===this.view.renderTarget&&(this._lastObjectRendered=r.container,r.clearColor??(r.clearColor=this.background.colorRgba),r.clear??(r.clear=this.background.clearBeforeRender)),r.clearColor){const o=Array.isArray(r.clearColor)&&r.clearColor.length===4;r.clearColor=o?r.clearColor:H.shared.setValue(r.clearColor).toArray()}r.transform||(r.container.updateLocalTransform(),r.transform=r.container.localTransform),r.container.enableRenderGroup(),this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r)}resize(e,n,r){const o=this.view.resolution;this.view.resize(e,n,r),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),r!==void 0&&r!==o&&this.runners.resolutionChange.emit(r)}clear(e={}){const n=this;e.target||(e.target=n.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=Wh.ALL);const{clear:r,clearColor:o,target:s}=e;H.shared.setValue(o??this.background.colorRgba),n.renderTarget.clear(s,r,H.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(n=>{this.runners[n]=new hw(n)})}_addSystems(e){let n;for(n in e){const r=e[n];this._addSystem(r.value,r.name)}}_addSystem(e,n){const r=new e(this);if(this[n])throw new Error(`Whoops! The name "${n}" is already in use`);this[n]=r,this._systemsHash[n]=r;for(const o in this.runners)this.runners[o].add(r);return this}_addPipes(e,n){const r=n.reduce((o,s)=>(o[s.name]=s.value,o),{});e.forEach(o=>{const s=o.value,i=o.name,a=r[i];this.renderPipes[i]=new s(this,a?new a:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(n=>{n.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!dw())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Gh.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Vh=Gh,zo;function pw(t){return zo!==void 0||(zo=(()=>{const e={stencil:!0,failIfMajorPerformanceCaveat:t??Vh.defaultOptions.failIfMajorPerformanceCaveat};try{if(!ga.get().getWebGLRenderingContext())return!1;let r=ga.get().createCanvas().getContext("webgl",e);const o=!!r?.getContextAttributes()?.stencil;if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,o}catch{return!1}})()),zo}let Do;async function mw(t={}){return Do!==void 0||(Do=await(async()=>{const e=ga.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(t)).requestDevice(),!0}catch{return!1}})()),Do}const Fc=["webgl","webgpu","canvas"];async function gw(t){let e=[];t.preference?(e.push(t.preference),Fc.forEach(s=>{s!==t.preference&&e.push(s)})):e=Fc.slice();let n,r={};for(let s=0;s<e.length;s++){const i=e[s];if(i==="webgpu"&&await mw()){const{WebGPURenderer:a}=await Gt(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-DdPOCf_e.js");return{WebGPURenderer:l}},__vite__mapDeps([0,1,2,3,4,5,6]));n=a,r={...t,...t.webgpu};break}else if(i==="webgl"&&pw(t.failIfMajorPerformanceCaveat??Vh.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await Gt(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-DXiZUeFS.js");return{WebGLRenderer:l}},__vite__mapDeps([7,1,2,3,4,5,6]));n=a,r={...t,...t.webgl};break}else if(i==="canvas")throw r={...t},new Error("CanvasRenderer is not yet implemented")}if(delete r.webgpu,delete r.webgl,!n)throw new Error("No available renderer for the current environment");const o=new n;return await o.init(r),o}const Kh="8.8.1";class Xh{static init(){globalThis.__PIXI_APP_INIT__?.(this,Kh)}static destroy(){}}Xh.extension=no.Application;class yw{constructor(e){this._renderer=e}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,Kh)}destroy(){this._renderer=null}}yw.extension={type:[no.WebGLSystem,no.WebGPUSystem],name:"initHook",priority:-10};const Jh=class _a{constructor(...e){this.stage=new ne,e[0]!==void 0&&ro(oo,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await gw(e),_a._plugins.forEach(n=>{n.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return ro(oo,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,n=!1){const r=_a._plugins.slice(0);r.reverse(),r.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(n),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Jh._plugins=[];let Yh=Jh;dl.handleByList(no.Application,Yh._plugins);dl.add(Xh);var Zh=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,vw=`
in vec2 vTextureCoord;

out vec4 finalColor;

uniform float uAlpha;
uniform sampler2D uTexture;

void main()
{
    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;
}
`,Uc=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
 
    var sample = textureSample(uTexture, uSampler, uv);
    
    return sample * alphaUniforms.uAlpha;
}`;const Qh=class ef extends en{constructor(e){e={...ef.defaultOptions,...e};const n=ul.from({vertex:{source:Uc,entryPoint:"mainVertex"},fragment:{source:Uc,entryPoint:"mainFragment"}}),r=Ot.from({vertex:Zh,fragment:vw,name:"alpha-filter"}),{alpha:o,...s}=e,i=new fh({uAlpha:{value:o,type:"f32"}});super({...s,gpuProgram:n,glProgram:r,resources:{alphaUniforms:i}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(e){this.resources.alphaUniforms.uniforms.uAlpha=e}};Qh.defaultOptions={alpha:1};let ww=Qh;var bw=`
in vec2 vTextureCoord;
in vec4 vColor;

out vec4 finalColor;

uniform float uColorMatrix[20];
uniform float uAlpha;

uniform sampler2D uTexture;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture(uTexture, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * 0.2);
    float diff = (randomValue - 0.5) *  0.5;

    if (uAlpha == 0.0) {
        finalColor = color;
        return;
    }

    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    vec4 result;

    result.r = (uColorMatrix[0] * color.r);
        result.r += (uColorMatrix[1] * color.g);
        result.r += (uColorMatrix[2] * color.b);
        result.r += (uColorMatrix[3] * color.a);
        result.r += uColorMatrix[4];

    result.g = (uColorMatrix[5] * color.r);
        result.g += (uColorMatrix[6] * color.g);
        result.g += (uColorMatrix[7] * color.b);
        result.g += (uColorMatrix[8] * color.a);
        result.g += uColorMatrix[9];

    result.b = (uColorMatrix[10] * color.r);
       result.b += (uColorMatrix[11] * color.g);
       result.b += (uColorMatrix[12] * color.b);
       result.b += (uColorMatrix[13] * color.a);
       result.b += uColorMatrix[14];

    result.a = (uColorMatrix[15] * color.r);
       result.a += (uColorMatrix[16] * color.g);
       result.a += (uColorMatrix[17] * color.b);
       result.a += (uColorMatrix[18] * color.a);
       result.a += uColorMatrix[19];

    vec3 rgb = mix(color.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    finalColor = vec4(rgb, result.a);
}
`,Hc=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct ColorMatrixUniforms {
  uColorMatrix:array<vec4<f32>, 5>,
  uAlpha:f32,
};


@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;
@group(1) @binding(0) var<uniform> colorMatrixUniforms : ColorMatrixUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
  };
  
fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
  );
}


@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
) -> @location(0) vec4<f32> {


  var c = textureSample(uTexture, uSampler, uv);
  
  if (colorMatrixUniforms.uAlpha == 0.0) {
    return c;
  }

 
    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.r /= c.a;
      c.g /= c.a;
      c.b /= c.a;
    }

    var cm = colorMatrixUniforms.uColorMatrix;


    var result = vec4<f32>(0.);

    result.r = (cm[0][0] * c.r);
    result.r += (cm[0][1] * c.g);
    result.r += (cm[0][2] * c.b);
    result.r += (cm[0][3] * c.a);
    result.r += cm[1][0];

    result.g = (cm[1][1] * c.r);
    result.g += (cm[1][2] * c.g);
    result.g += (cm[1][3] * c.b);
    result.g += (cm[2][0] * c.a);
    result.g += cm[2][1];

    result.b = (cm[2][2] * c.r);
    result.b += (cm[2][3] * c.g);
    result.b += (cm[3][0] * c.b);
    result.b += (cm[3][1] * c.a);
    result.b += cm[3][2];

    result.a = (cm[3][3] * c.r);
    result.a += (cm[4][0] * c.g);
    result.a += (cm[4][1] * c.b);
    result.a += (cm[4][2] * c.a);
    result.a += cm[4][3];

    var rgb = mix(c.rgb, result.rgb, colorMatrixUniforms.uAlpha);

    rgb.r *= result.a;
    rgb.g *= result.a;
    rgb.b *= result.a;

    return vec4(rgb, result.a);
}`;class xw extends en{constructor(e={}){const n=new fh({uColorMatrix:{value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],type:"f32",size:20},uAlpha:{value:1,type:"f32"}}),r=ul.from({vertex:{source:Hc,entryPoint:"mainVertex"},fragment:{source:Hc,entryPoint:"mainFragment"}}),o=Ot.from({vertex:Zh,fragment:bw,name:"color-matrix-filter"});super({...e,gpuProgram:r,glProgram:o,resources:{colorMatrixUniforms:n}}),this.alpha=1}_loadMatrix(e,n=!1){let r=e;n&&(this._multiply(r,this.matrix,e),r=this._colorMatrix(r)),this.resources.colorMatrixUniforms.uniforms.uColorMatrix=r,this.resources.colorMatrixUniforms.update()}_multiply(e,n,r){return e[0]=n[0]*r[0]+n[1]*r[5]+n[2]*r[10]+n[3]*r[15],e[1]=n[0]*r[1]+n[1]*r[6]+n[2]*r[11]+n[3]*r[16],e[2]=n[0]*r[2]+n[1]*r[7]+n[2]*r[12]+n[3]*r[17],e[3]=n[0]*r[3]+n[1]*r[8]+n[2]*r[13]+n[3]*r[18],e[4]=n[0]*r[4]+n[1]*r[9]+n[2]*r[14]+n[3]*r[19]+n[4],e[5]=n[5]*r[0]+n[6]*r[5]+n[7]*r[10]+n[8]*r[15],e[6]=n[5]*r[1]+n[6]*r[6]+n[7]*r[11]+n[8]*r[16],e[7]=n[5]*r[2]+n[6]*r[7]+n[7]*r[12]+n[8]*r[17],e[8]=n[5]*r[3]+n[6]*r[8]+n[7]*r[13]+n[8]*r[18],e[9]=n[5]*r[4]+n[6]*r[9]+n[7]*r[14]+n[8]*r[19]+n[9],e[10]=n[10]*r[0]+n[11]*r[5]+n[12]*r[10]+n[13]*r[15],e[11]=n[10]*r[1]+n[11]*r[6]+n[12]*r[11]+n[13]*r[16],e[12]=n[10]*r[2]+n[11]*r[7]+n[12]*r[12]+n[13]*r[17],e[13]=n[10]*r[3]+n[11]*r[8]+n[12]*r[13]+n[13]*r[18],e[14]=n[10]*r[4]+n[11]*r[9]+n[12]*r[14]+n[13]*r[19]+n[14],e[15]=n[15]*r[0]+n[16]*r[5]+n[17]*r[10]+n[18]*r[15],e[16]=n[15]*r[1]+n[16]*r[6]+n[17]*r[11]+n[18]*r[16],e[17]=n[15]*r[2]+n[16]*r[7]+n[17]*r[12]+n[18]*r[17],e[18]=n[15]*r[3]+n[16]*r[8]+n[17]*r[13]+n[18]*r[18],e[19]=n[15]*r[4]+n[16]*r[9]+n[17]*r[14]+n[18]*r[19]+n[19],e}_colorMatrix(e){const n=new Float32Array(e);return n[4]/=255,n[9]/=255,n[14]/=255,n[19]/=255,n}brightness(e,n){const r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,n)}tint(e,n){const[r,o,s]=H.shared.setValue(e).toArray(),i=[r,0,0,0,0,0,o,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(i,n)}greyscale(e,n){const r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,n)}grayscale(e,n){this.greyscale(e,n)}blackAndWhite(e){const n=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(n,e)}hue(e,n){e=(e||0)/180*Math.PI;const r=Math.cos(e),o=Math.sin(e),s=Math.sqrt,i=1/3,a=s(i),l=r+(1-r)*i,c=i*(1-r)-a*o,u=i*(1-r)+a*o,d=i*(1-r)+a*o,h=r+i*(1-r),p=i*(1-r)-a*o,g=i*(1-r)-a*o,y=i*(1-r)+a*o,v=r+i*(1-r),w=[l,c,u,0,0,d,h,p,0,0,g,y,v,0,0,0,0,0,1,0];this._loadMatrix(w,n)}contrast(e,n){const r=(e||0)+1,o=-.5*(r-1),s=[r,0,0,0,o,0,r,0,0,o,0,0,r,0,o,0,0,0,1,0];this._loadMatrix(s,n)}saturate(e=0,n){const r=e*2/3+1,o=(r-1)*-.5,s=[r,o,o,0,0,o,r,o,0,0,o,o,r,0,0,0,0,0,1,0];this._loadMatrix(s,n)}desaturate(){this.saturate(-1)}negative(e){const n=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(n,e)}sepia(e){const n=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(n,e)}technicolor(e){const n=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(n,e)}polaroid(e){const n=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(n,e)}toBGR(e){const n=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(n,e)}kodachrome(e){const n=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(n,e)}browni(e){const n=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(n,e)}vintage(e){const n=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(n,e)}colorTone(e,n,r,o,s){e||(e=.2),n||(n=.15),r||(r=16770432),o||(o=3375104);const i=H.shared,[a,l,c]=i.setValue(r).toArray(),[u,d,h]=i.setValue(o).toArray(),p=[.3,.59,.11,0,0,a,l,c,e,0,u,d,h,n,0,a-u,l-d,c-h,0,0];this._loadMatrix(p,s)}night(e,n){e||(e=.1);const r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,n)}predator(e,n){const r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,n)}lsd(e){const n=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(n,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.resources.colorMatrixUniforms.uniforms.uColorMatrix}set matrix(e){this.resources.colorMatrixUniforms.uniforms.uColorMatrix=e}get alpha(){return this.resources.colorMatrixUniforms.uniforms.uAlpha}set alpha(e){this.resources.colorMatrixUniforms.uniforms.uAlpha=e}}class fr extends Pn{constructor(...e){let n=e[0];Array.isArray(e[0])&&(n={textures:e[0],autoUpdate:e[1]});const{animationSpeed:r=1,autoPlay:o=!1,autoUpdate:s=!0,loop:i=!0,onComplete:a=null,onFrameChange:l=null,onLoop:c=null,textures:u,updateAnchor:d=!1,...h}=n,[p]=u;super({...h,texture:p instanceof Tt?p:p.texture}),this._textures=null,this._durations=null,this._autoUpdate=s,this._isConnectedToTicker=!1,this.animationSpeed=r,this.loop=i,this.updateAnchor=d,this.onComplete=a,this.onFrameChange=l,this.onLoop=c,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=u,o&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Qn.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Qn.shared.add(this.update,this,uy.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const n=e.deltaTime,r=this.animationSpeed*n,o=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=r/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*n);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o||this.animationSpeed<0&&this.currentFrame>o)&&this.onLoop(),this._updateTexture())}_updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const n=[];for(let r=0;r<e.length;++r)n.push(Tt.from(e[r]));return new fr(n)}static fromImages(e){const n=[];for(let r=0;r<e.length;++r)n.push(Tt.from(e[r]));return new fr(n)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof Tt)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let n=0;n<e.length;n++)this._textures.push(e[n].texture),this._durations.push(e[n].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const n=this.currentFrame;this._currentTime=e,n!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Qn.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Qn.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class _w{constructor({matrix:e,observer:n}={}){this.dirty=!0,this._matrix=e??new dy,this.observer=n,this.position=new er(this,0,0),this.scale=new er(this,1,1),this.pivot=new er(this,0,0),this.skew=new er(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}_onUpdate(e){this.dirty=!0,e===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}}const tf=class os extends ph{constructor(...e){let n=e[0]||{};n instanceof Tt&&(n={texture:n}),e.length>1&&(ro(oo,"use new TilingSprite({ texture, width:100, height:100 }) instead"),n.width=e[1],n.height=e[2]),n={...os.defaultOptions,...n};const{texture:r,anchor:o,tilePosition:s,tileScale:i,tileRotation:a,width:l,height:c,applyAnchorToTexture:u,roundPixels:d,...h}=n??{};super({label:"TilingSprite",...h}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new er({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=u,this.texture=r,this._width=l??r.width,this._height=c??r.height,this._tileTransform=new _w({observer:{_onUpdate:()=>this.onViewUpdate()}}),o&&(this.anchor=o),this.tilePosition=s,this.tileScale=i,this.tileRotation=a,this.roundPixels=d??!1}static from(e,n={}){return typeof e=="string"?new os({texture:hy.get(e),...n}):new os({texture:e,...n})}get uvRespectAnchor(){return ya("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){ya("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){typeof e=="number"?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=Tt.EMPTY);const n=this._texture;n!==e&&(n&&n.dynamic&&n.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,n){typeof e=="object"&&(n=e.height??e.width,e=e.width),this._width=e,this._height=n??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){const e=this._bounds,n=this._anchor,r=this._width,o=this._height;e.minX=-n._x*r,e.maxX=e.minX+r,e.minY=-n._y*o,e.maxY=e.minY+o}containsPoint(e){const n=this._width,r=this._height,o=-n*this._anchor._x;let s=0;return e.x>=o&&e.x<=o+n&&(s=-r*this._anchor._y,e.y>=s&&e.y<=s+r)}destroy(e=!1){if(super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof e=="boolean"?e:e?.texture){const r=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(r)}this._texture=null}};tf.defaultOptions={texture:Tt.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let Cw=tf;class Sw extends ph{constructor(e,n){const{text:r,resolution:o,style:s,anchor:i,width:a,height:l,roundPixels:c,...u}=e;super({...u}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=n,this.text=r??"",this.style=s,this.resolution=o??null,this.allowChildren=!1,this._anchor=new er({_onUpdate:()=>{this.onViewUpdate()}}),i&&(this.anchor=i),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){e||(e={}),this._style?.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,n){typeof e=="object"?(n=e.height??e.width,e=e.width):n??(n=e),e!==void 0&&this._setWidth(e,this.bounds.width),n!==void 0&&this._setHeight(n,this.bounds.height)}containsPoint(e){const n=this.bounds.width,r=this.bounds.height,o=-n*this.anchor.x;let s=0;return e.x>=o&&e.x<=o+n&&(s=-r*this.anchor.y,e.y>=s&&e.y<=s+r)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e?.style)&&this._style.destroy(e),this._style=null,this._text=null}}function kw(t,e){let n=t[0]??{};return(typeof n=="string"||t[1])&&(ro(oo,`use new ${e}({ text: "hi!", style }) instead`),n={text:n,style:t[1]}),n}class Pw extends Sw{constructor(...e){const n=kw(e,"Text");super(n,fy),this.renderPipeId="text"}updateBounds(){const e=this._bounds,n=this._anchor,r=py.measureText(this._text,this._style),{width:o,height:s}=r;e.minX=-n._x*o,e.maxX=e.minX+o,e.minY=-n._y*s,e.maxY=e.minY+s}}class Fs extends Tt{static create(e){return new Fs({source:new my(e)})}resize(e,n,r){return this.source.resize(e,n,r),this}}const nf=class rf extends ne{constructor(e={}){e={...rf.defaultOptions,...e},super(),this.renderLayerChildren=[],this.sortableChildren=e.sortableChildren,this.sortFunction=e.sortFunction}attach(...e){for(let n=0;n<e.length;n++){const r=e[n];if(r.parentRenderLayer){if(r.parentRenderLayer===this)continue;r.parentRenderLayer.detach(r)}this.renderLayerChildren.push(r),r.parentRenderLayer=this;const o=this.renderGroup||this.parentRenderGroup;o&&(o.structureDidChange=!0)}return e[0]}detach(...e){for(let n=0;n<e.length;n++){const r=e[n],o=this.renderLayerChildren.indexOf(r);o!==-1&&this.renderLayerChildren.splice(o,1),r.parentRenderLayer=null;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)}return e[0]}detachAll(){const e=this.renderLayerChildren;for(let n=0;n<e.length;n++)e[n].parentRenderLayer=null;this.renderLayerChildren.length=0}collectRenderables(e,n,r){const o=this.renderLayerChildren,s=o.length;this.sortableChildren&&this.sortRenderLayerChildren();for(let i=0;i<s;i++)o[i].parent||ya("Container must be added to both layer and scene graph. Layers only handle render order - the scene graph is required for transforms (addChild)",o[i]),o[i].collectRenderables(e,n,this)}sortRenderLayerChildren(){this.renderLayerChildren.sort(this.sortFunction)}_getGlobalBoundsRecursive(e,n,r){if(!e)return;const o=this.renderLayerChildren;for(let s=0;s<o.length;s++)o[s]._getGlobalBoundsRecursive(!0,n,this)}};nf.defaultOptions={sortableChildren:!1,sortFunction:(t,e)=>t.zIndex-e.zIndex};let Ew=nf;const Wc=Ew,Cl="-",Tw=t=>{const e=Rw(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:i=>{const a=i.split(Cl);return a[0]===""&&a.length!==1&&a.shift(),of(a,e)||Aw(i)},getConflictingClassGroupIds:(i,a)=>{const l=n[i]||[];return a&&r[i]?[...l,...r[i]]:l}}},of=(t,e)=>{if(t.length===0)return e.classGroupId;const n=t[0],r=e.nextPart.get(n),o=r?of(t.slice(1),r):void 0;if(o)return o;if(e.validators.length===0)return;const s=t.join(Cl);return e.validators.find(({validator:i})=>i(s))?.classGroupId},Gc=/^\[(.+)\]$/,Aw=t=>{if(Gc.test(t)){const e=Gc.exec(t)[1],n=e?.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},Rw=t=>{const{theme:e,prefix:n}=t,r={nextPart:new Map,validators:[]};return Iw(Object.entries(t.classGroups),n).forEach(([s,i])=>{Ca(i,r,s,e)}),r},Ca=(t,e,n,r)=>{t.forEach(o=>{if(typeof o=="string"){const s=o===""?e:qc(e,o);s.classGroupId=n;return}if(typeof o=="function"){if(Ow(o)){Ca(o(r),e,n,r);return}e.validators.push({validator:o,classGroupId:n});return}Object.entries(o).forEach(([s,i])=>{Ca(i,qc(e,s),n,r)})})},qc=(t,e)=>{let n=t;return e.split(Cl).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},Ow=t=>t.isThemeGetter,Iw=(t,e)=>e?t.map(([n,r])=>{const o=r.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([i,a])=>[e+i,a])):s);return[n,o]}):t,jw=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,r=new Map;const o=(s,i)=>{n.set(s,i),e++,e>t&&(e=0,r=n,n=new Map)};return{get(s){let i=n.get(s);if(i!==void 0)return i;if((i=r.get(s))!==void 0)return o(s,i),i},set(s,i){n.has(s)?n.set(s,i):o(s,i)}}},sf="!",$w=t=>{const{separator:e,experimentalParseClassName:n}=t,r=e.length===1,o=e[0],s=e.length,i=a=>{const l=[];let c=0,u=0,d;for(let v=0;v<a.length;v++){let w=a[v];if(c===0){if(w===o&&(r||a.slice(v,v+s)===e)){l.push(a.slice(u,v)),u=v+s;continue}if(w==="/"){d=v;continue}}w==="["?c++:w==="]"&&c--}const h=l.length===0?a:a.substring(u),p=h.startsWith(sf),g=p?h.substring(1):h,y=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:p,baseClassName:g,maybePostfixModifierPosition:y}};return n?a=>n({className:a,parseClassName:i}):i},Nw=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(r=>{r[0]==="["?(e.push(...n.sort(),r),n=[]):n.push(r)}),e.push(...n.sort()),e},Mw=t=>({cache:jw(t.cacheSize),parseClassName:$w(t),...Tw(t)}),zw=/\s+/,Dw=(t,e)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:o}=e,s=[],i=t.trim().split(zw);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:p}=n(c);let g=!!p,y=r(g?h.substring(0,p):h);if(!y){if(!g){a=c+(a.length>0?" "+a:a);continue}if(y=r(h),!y){a=c+(a.length>0?" "+a:a);continue}g=!1}const v=Nw(u).join(":"),w=d?v+sf:v,x=w+y;if(s.includes(x))continue;s.push(x);const b=o(y,g);for(let _=0;_<b.length;++_){const S=b[_];s.push(w+S)}a=c+(a.length>0?" "+a:a)}return a};function Lw(){let t=0,e,n,r="";for(;t<arguments.length;)(e=arguments[t++])&&(n=af(e))&&(r&&(r+=" "),r+=n);return r}const af=t=>{if(typeof t=="string")return t;let e,n="";for(let r=0;r<t.length;r++)t[r]&&(e=af(t[r]))&&(n&&(n+=" "),n+=e);return n};function Bw(t,...e){let n,r,o,s=i;function i(l){const c=e.reduce((u,d)=>d(u),t());return n=Mw(c),r=n.cache.get,o=n.cache.set,s=a,a(l)}function a(l){const c=r(l);if(c)return c;const u=Dw(l,n);return o(l,u),u}return function(){return s(Lw.apply(null,arguments))}}const me=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},lf=/^\[(?:([a-z-]+):)?(.+)\]$/i,Fw=/^\d+\/\d+$/,Uw=new Set(["px","full","screen"]),Hw=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ww=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Gw=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,qw=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Vw=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,bt=t=>ar(t)||Uw.has(t)||Fw.test(t),$t=t=>Er(t,"length",tb),ar=t=>!!t&&!Number.isNaN(Number(t)),Pi=t=>Er(t,"number",ar),Nr=t=>!!t&&Number.isInteger(Number(t)),Kw=t=>t.endsWith("%")&&ar(t.slice(0,-1)),Q=t=>lf.test(t),Nt=t=>Hw.test(t),Xw=new Set(["length","size","percentage"]),Jw=t=>Er(t,Xw,cf),Yw=t=>Er(t,"position",cf),Zw=new Set(["image","url"]),Qw=t=>Er(t,Zw,rb),eb=t=>Er(t,"",nb),Mr=()=>!0,Er=(t,e,n)=>{const r=lf.exec(t);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):n(r[2]):!1},tb=t=>Ww.test(t)&&!Gw.test(t),cf=()=>!1,nb=t=>qw.test(t),rb=t=>Vw.test(t),ob=()=>{const t=me("colors"),e=me("spacing"),n=me("blur"),r=me("brightness"),o=me("borderColor"),s=me("borderRadius"),i=me("borderSpacing"),a=me("borderWidth"),l=me("contrast"),c=me("grayscale"),u=me("hueRotate"),d=me("invert"),h=me("gap"),p=me("gradientColorStops"),g=me("gradientColorStopPositions"),y=me("inset"),v=me("margin"),w=me("opacity"),x=me("padding"),b=me("saturate"),_=me("scale"),S=me("sepia"),k=me("skew"),C=me("space"),M=me("translate"),X=()=>["auto","contain","none"],L=()=>["auto","hidden","clip","visible","scroll"],J=()=>["auto",Q,e],j=()=>[Q,e],oe=()=>["",bt,$t],B=()=>["auto",ar,Q],Y=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],K=()=>["solid","dashed","dotted","double","none"],ie=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],F=()=>["start","end","center","between","around","evenly","stretch"],ae=()=>["","0",Q],ve=()=>["auto","avoid","all","avoid-page","page","left","right","column"],pe=()=>[ar,Q];return{cacheSize:500,separator:":",theme:{colors:[Mr],spacing:[bt,$t],blur:["none","",Nt,Q],brightness:pe(),borderColor:[t],borderRadius:["none","","full",Nt,Q],borderSpacing:j(),borderWidth:oe(),contrast:pe(),grayscale:ae(),hueRotate:pe(),invert:ae(),gap:j(),gradientColorStops:[t],gradientColorStopPositions:[Kw,$t],inset:J(),margin:J(),opacity:pe(),padding:j(),saturate:pe(),scale:pe(),sepia:ae(),skew:pe(),space:j(),translate:j()},classGroups:{aspect:[{aspect:["auto","square","video",Q]}],container:["container"],columns:[{columns:[Nt]}],"break-after":[{"break-after":ve()}],"break-before":[{"break-before":ve()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Y(),Q]}],overflow:[{overflow:L()}],"overflow-x":[{"overflow-x":L()}],"overflow-y":[{"overflow-y":L()}],overscroll:[{overscroll:X()}],"overscroll-x":[{"overscroll-x":X()}],"overscroll-y":[{"overscroll-y":X()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[y]}],"inset-x":[{"inset-x":[y]}],"inset-y":[{"inset-y":[y]}],start:[{start:[y]}],end:[{end:[y]}],top:[{top:[y]}],right:[{right:[y]}],bottom:[{bottom:[y]}],left:[{left:[y]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Nr,Q]}],basis:[{basis:J()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Q]}],grow:[{grow:ae()}],shrink:[{shrink:ae()}],order:[{order:["first","last","none",Nr,Q]}],"grid-cols":[{"grid-cols":[Mr]}],"col-start-end":[{col:["auto",{span:["full",Nr,Q]},Q]}],"col-start":[{"col-start":B()}],"col-end":[{"col-end":B()}],"grid-rows":[{"grid-rows":[Mr]}],"row-start-end":[{row:["auto",{span:[Nr,Q]},Q]}],"row-start":[{"row-start":B()}],"row-end":[{"row-end":B()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Q]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Q]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...F()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...F(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...F(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[x]}],px:[{px:[x]}],py:[{py:[x]}],ps:[{ps:[x]}],pe:[{pe:[x]}],pt:[{pt:[x]}],pr:[{pr:[x]}],pb:[{pb:[x]}],pl:[{pl:[x]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[C]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[C]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Q,e]}],"min-w":[{"min-w":[Q,e,"min","max","fit"]}],"max-w":[{"max-w":[Q,e,"none","full","min","max","fit","prose",{screen:[Nt]},Nt]}],h:[{h:[Q,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Q,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Q,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Q,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Nt,$t]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Pi]}],"font-family":[{font:[Mr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Q]}],"line-clamp":[{"line-clamp":["none",ar,Pi]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",bt,Q]}],"list-image":[{"list-image":["none",Q]}],"list-style-type":[{list:["none","disc","decimal",Q]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...K(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",bt,$t]}],"underline-offset":[{"underline-offset":["auto",bt,Q]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:j()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Q]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Q]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Y(),Yw]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Jw]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Qw]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[g]}],"gradient-via-pos":[{via:[g]}],"gradient-to-pos":[{to:[g]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[...K(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:K()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...K()]}],"outline-offset":[{"outline-offset":[bt,Q]}],"outline-w":[{outline:[bt,$t]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:oe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[bt,$t]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Nt,eb]}],"shadow-color":[{shadow:[Mr]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":[...ie(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ie()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Nt,Q]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[b]}],sepia:[{sepia:[S]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[S]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Q]}],duration:[{duration:pe()}],ease:[{ease:["linear","in","out","in-out",Q]}],delay:[{delay:pe()}],animate:[{animate:["none","spin","ping","pulse","bounce",Q]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[_]}],"scale-x":[{"scale-x":[_]}],"scale-y":[{"scale-y":[_]}],rotate:[{rotate:[Nr,Q]}],"translate-x":[{"translate-x":[M]}],"translate-y":[{"translate-y":[M]}],"skew-x":[{"skew-x":[k]}],"skew-y":[{"skew-y":[k]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Q]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Q]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":j()}],"scroll-mx":[{"scroll-mx":j()}],"scroll-my":[{"scroll-my":j()}],"scroll-ms":[{"scroll-ms":j()}],"scroll-me":[{"scroll-me":j()}],"scroll-mt":[{"scroll-mt":j()}],"scroll-mr":[{"scroll-mr":j()}],"scroll-mb":[{"scroll-mb":j()}],"scroll-ml":[{"scroll-ml":j()}],"scroll-p":[{"scroll-p":j()}],"scroll-px":[{"scroll-px":j()}],"scroll-py":[{"scroll-py":j()}],"scroll-ps":[{"scroll-ps":j()}],"scroll-pe":[{"scroll-pe":j()}],"scroll-pt":[{"scroll-pt":j()}],"scroll-pr":[{"scroll-pr":j()}],"scroll-pb":[{"scroll-pb":j()}],"scroll-pl":[{"scroll-pl":j()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Q]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[bt,$t,Pi]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Sl=Bw(ob);function uf(t){if(!bs(t))throw new Error(`Invalid textureId: "${t}"; textureId  {${Object.keys(En.frames).sort().map(e=>`"${e}"`).join(`,
`)}}`)}function bs(t){return En.frames[t]!==void 0}function df(t){return En.animations[t]!==void 0}const sb=({className:t,children:e})=>t?f.jsx("div",{className:`contents ${t}`,children:e}):e,ib=t=>t.replaceAll(/(?<!\.)\./g,"_"),O=({children:t,className:e,noSlitWords:n,classnameCycle:r,onClick:o,noTint:s=!1,TagName:i="span"})=>{const a=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(a.length===0)return null;const l=n?[a.toUpperCase()]:a.toUpperCase().split(/\s+/);return f.jsxs(i,{className:e,onClick:o,children:[f.jsx("span",{className:"sr-only",children:a}),l.map((c,u)=>f.jsx("span",{className:Sl("text-nowrap inline-block",u===l.length-1?"":"me-1"),children:Array.from(c).map((d,h)=>{const p=`hud.char.${mh(d)}`;return bs(p)||console.error("no texture for char",d,d.charCodeAt(0),p,"we have:",Object.keys(qt().textures)),f.jsx("span",{className:`sprite ${bs(p)?`texture-${ib(p)}`:"texture-hud_char_?"}
                  ${s?"":"sprite-tinted"}
                  ${r===void 0?"":r[h%r.length]}`},h)})},u))]})},ab=t=>t.props.children!==void 0,nt=({children:t,className:e})=>f.jsx(sb,{className:e,children:Array.isArray(t)?t.map((n,r)=>f.jsx(nt,{children:n},r)):typeof t=="number"?f.jsx(O,{children:String(t)}):typeof t=="string"?f.jsx(O,{children:t}):m.isValidElement(t)?t.type===O||t.type===nt?t:ab(t)?m.cloneElement(t,void 0,typeof t.props.children=="string"?f.jsx(O,{children:`${t.props.children}`}):f.jsx(nt,{children:t.props.children})):t:t});function Xe(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t?.(o),n===!1||!o.defaultPrevented)return e?.(o)}}function Vc(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function hf(...t){return e=>{let n=!1;const r=t.map(o=>{const s=Vc(o,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():Vc(t[o],null)}}}}function at(...t){return m.useCallback(hf(...t),t)}function lb(t,e){const n=m.createContext(e),r=s=>{const{children:i,...a}=s,l=m.useMemo(()=>a,Object.values(a));return f.jsx(n.Provider,{value:l,children:i})};r.displayName=t+"Provider";function o(s){const i=m.useContext(n);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[r,o]}function kl(t,e=[]){let n=[];function r(s,i){const a=m.createContext(i),l=n.length;n=[...n,i];const c=d=>{const{scope:h,children:p,...g}=d,y=h?.[t]?.[l]||a,v=m.useMemo(()=>g,Object.values(g));return f.jsx(y.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(d,h){const p=h?.[t]?.[l]||a,g=m.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=n.map(i=>m.createContext(i));return function(a){const l=a?.[t]||s;return m.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[r,cb(o,...e)]}function cb(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}var Us=gy();const ff=yt(Us);var Hs=m.forwardRef((t,e)=>{const{children:n,...r}=t,o=m.Children.toArray(n),s=o.find(db);if(s){const i=s.props.children,a=o.map(l=>l===s?m.Children.count(i)>1?m.Children.only(null):m.isValidElement(i)?i.props.children:null:l);return f.jsx(Sa,{...r,ref:e,children:m.isValidElement(i)?m.cloneElement(i,void 0,a):null})}return f.jsx(Sa,{...r,ref:e,children:n})});Hs.displayName="Slot";var Sa=m.forwardRef((t,e)=>{const{children:n,...r}=t;if(m.isValidElement(n)){const o=fb(n),s=hb(r,n.props);return n.type!==m.Fragment&&(s.ref=e?hf(e,o):o),m.cloneElement(n,s)}return m.Children.count(n)>1?m.Children.only(null):null});Sa.displayName="SlotClone";var ub=({children:t})=>f.jsx(f.Fragment,{children:t});function db(t){return m.isValidElement(t)&&t.type===ub}function hb(t,e){const n={...e};for(const r in e){const o=t[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{s(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...t,...n}}function fb(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var pb=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],be=pb.reduce((t,e)=>{const n=m.forwardRef((r,o)=>{const{asChild:s,...i}=r,a=s?Hs:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),f.jsx(a,{...i,ref:o})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function mb(t,e){t&&Us.flushSync(()=>t.dispatchEvent(e))}function Xt(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t}),m.useMemo(()=>(...n)=>e.current?.(...n),[])}function gb(t,e=globalThis?.document){const n=Xt(t);m.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var yb="DismissableLayer",ka="dismissableLayer.update",vb="dismissableLayer.pointerDownOutside",wb="dismissableLayer.focusOutside",Kc,pf=m.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Pl=m.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=m.useContext(pf),[u,d]=m.useState(null),h=u?.ownerDocument??globalThis?.document,[,p]=m.useState({}),g=at(e,C=>d(C)),y=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),w=y.indexOf(v),x=u?y.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,_=x>=w,S=_b(C=>{const M=C.target,X=[...c.branches].some(L=>L.contains(M));!_||X||(o?.(C),i?.(C),C.defaultPrevented||a?.())},h),k=Cb(C=>{const M=C.target;[...c.branches].some(L=>L.contains(M))||(s?.(C),i?.(C),C.defaultPrevented||a?.())},h);return gb(C=>{x===c.layers.size-1&&(r?.(C),!C.defaultPrevented&&a&&(C.preventDefault(),a()))},h),m.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Kc=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),Xc(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=Kc)}},[u,h,n,c]),m.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),Xc())},[u,c]),m.useEffect(()=>{const C=()=>p({});return document.addEventListener(ka,C),()=>document.removeEventListener(ka,C)},[]),f.jsx(be.div,{...l,ref:g,style:{pointerEvents:b?_?"auto":"none":void 0,...t.style},onFocusCapture:Xe(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Xe(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Xe(t.onPointerDownCapture,S.onPointerDownCapture)})});Pl.displayName=yb;var bb="DismissableLayerBranch",xb=m.forwardRef((t,e)=>{const n=m.useContext(pf),r=m.useRef(null),o=at(e,r);return m.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),f.jsx(be.div,{...t,ref:o})});xb.displayName=bb;function _b(t,e=globalThis?.document){const n=Xt(t),r=m.useRef(!1),o=m.useRef(()=>{});return m.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){mf(vb,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function Cb(t,e=globalThis?.document){const n=Xt(t),r=m.useRef(!1);return m.useEffect(()=>{const o=s=>{s.target&&!r.current&&mf(wb,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Xc(){const t=new CustomEvent(ka);document.dispatchEvent(t)}function mf(t,e,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?mb(o,s):o.dispatchEvent(s)}var Ei=0;function gf(){m.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Jc()),document.body.insertAdjacentElement("beforeend",t[1]??Jc()),Ei++,()=>{Ei===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Ei--}},[])}function Jc(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Ti="focusScope.autoFocusOnMount",Ai="focusScope.autoFocusOnUnmount",Yc={bubbles:!1,cancelable:!0},Sb="FocusScope",El=m.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=t,[a,l]=m.useState(null),c=Xt(o),u=Xt(s),d=m.useRef(null),h=at(e,y=>l(y)),p=m.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;m.useEffect(()=>{if(r){let y=function(b){if(p.paused||!a)return;const _=b.target;a.contains(_)?d.current=_:Lt(d.current,{select:!0})},v=function(b){if(p.paused||!a)return;const _=b.relatedTarget;_!==null&&(a.contains(_)||Lt(d.current,{select:!0}))},w=function(b){if(document.activeElement===document.body)for(const S of b)S.removedNodes.length>0&&Lt(a)};document.addEventListener("focusin",y),document.addEventListener("focusout",v);const x=new MutationObserver(w);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",v),x.disconnect()}}},[r,a,p.paused]),m.useEffect(()=>{if(a){Qc.add(p);const y=document.activeElement;if(!a.contains(y)){const w=new CustomEvent(Ti,Yc);a.addEventListener(Ti,c),a.dispatchEvent(w),w.defaultPrevented||(kb(Rb(yf(a)),{select:!0}),document.activeElement===y&&Lt(a))}return()=>{a.removeEventListener(Ti,c),setTimeout(()=>{const w=new CustomEvent(Ai,Yc);a.addEventListener(Ai,u),a.dispatchEvent(w),w.defaultPrevented||Lt(y??document.body,{select:!0}),a.removeEventListener(Ai,u),Qc.remove(p)},0)}}},[a,c,u,p]);const g=m.useCallback(y=>{if(!n&&!r||p.paused)return;const v=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,w=document.activeElement;if(v&&w){const x=y.currentTarget,[b,_]=Pb(x);b&&_?!y.shiftKey&&w===_?(y.preventDefault(),n&&Lt(b,{select:!0})):y.shiftKey&&w===b&&(y.preventDefault(),n&&Lt(_,{select:!0})):w===x&&y.preventDefault()}},[n,r,p.paused]);return f.jsx(be.div,{tabIndex:-1,...i,ref:h,onKeyDown:g})});El.displayName=Sb;function kb(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(Lt(r,{select:e}),document.activeElement!==n)return}function Pb(t){const e=yf(t),n=Zc(e,t),r=Zc(e.reverse(),t);return[n,r]}function yf(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Zc(t,e){for(const n of t)if(!Eb(n,{upTo:e}))return n}function Eb(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Tb(t){return t instanceof HTMLInputElement&&"select"in t}function Lt(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&Tb(t)&&e&&t.select()}}var Qc=Ab();function Ab(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=eu(t,e),t.unshift(e)},remove(e){t=eu(t,e),t[0]?.resume()}}}function eu(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function Rb(t){return t.filter(e=>e.tagName!=="A")}var vn=globalThis?.document?m.useLayoutEffect:()=>{},Ob=Ns.useId||(()=>{}),Ib=0;function ft(t){const[e,n]=m.useState(Ob());return vn(()=>{n(r=>r??String(Ib++))},[t]),t||(e?`radix-${e}`:"")}const jb=["top","right","bottom","left"],Jt=Math.min,Ke=Math.max,xs=Math.round,Lo=Math.floor,pt=t=>({x:t,y:t}),$b={left:"right",right:"left",bottom:"top",top:"bottom"},Nb={start:"end",end:"start"};function Pa(t,e,n){return Ke(t,Jt(e,n))}function At(t,e){return typeof t=="function"?t(e):t}function Rt(t){return t.split("-")[0]}function Tr(t){return t.split("-")[1]}function Tl(t){return t==="x"?"y":"x"}function Al(t){return t==="y"?"height":"width"}function Yt(t){return["top","bottom"].includes(Rt(t))?"y":"x"}function Rl(t){return Tl(Yt(t))}function Mb(t,e,n){n===void 0&&(n=!1);const r=Tr(t),o=Rl(t),s=Al(o);let i=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(i=_s(i)),[i,_s(i)]}function zb(t){const e=_s(t);return[Ea(t),e,Ea(e)]}function Ea(t){return t.replace(/start|end/g,e=>Nb[e])}function Db(t,e,n){const r=["left","right"],o=["right","left"],s=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return n?e?o:r:e?r:o;case"left":case"right":return e?s:i;default:return[]}}function Lb(t,e,n,r){const o=Tr(t);let s=Db(Rt(t),n==="start",r);return o&&(s=s.map(i=>i+"-"+o),e&&(s=s.concat(s.map(Ea)))),s}function _s(t){return t.replace(/left|right|bottom|top/g,e=>$b[e])}function Bb(t){return{top:0,right:0,bottom:0,left:0,...t}}function vf(t){return typeof t!="number"?Bb(t):{top:t,right:t,bottom:t,left:t}}function Cs(t){const{x:e,y:n,width:r,height:o}=t;return{width:r,height:o,top:n,left:e,right:e+r,bottom:n+o,x:e,y:n}}function tu(t,e,n){let{reference:r,floating:o}=t;const s=Yt(e),i=Rl(e),a=Al(i),l=Rt(e),c=s==="y",u=r.x+r.width/2-o.width/2,d=r.y+r.height/2-o.height/2,h=r[a]/2-o[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-o.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-o.width,y:d};break;default:p={x:r.x,y:r.y}}switch(Tr(e)){case"start":p[i]-=h*(n&&c?-1:1);break;case"end":p[i]+=h*(n&&c?-1:1);break}return p}const Fb=async(t,e,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:s=[],platform:i}=n,a=s.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:o}),{x:u,y:d}=tu(c,r,l),h=r,p={},g=0;for(let y=0;y<a.length;y++){const{name:v,fn:w}=a[y],{x,y:b,data:_,reset:S}=await w({x:u,y:d,initialPlacement:r,placement:h,strategy:o,middlewareData:p,rects:c,platform:i,elements:{reference:t,floating:e}});u=x??u,d=b??d,p={...p,[v]:{...p[v],..._}},S&&g<=50&&(g++,typeof S=="object"&&(S.placement&&(h=S.placement),S.rects&&(c=S.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:o}):S.rects),{x:u,y:d}=tu(c,h,l)),y=-1)}return{x:u,y:d,placement:h,strategy:o,middlewareData:p}};async function ao(t,e){var n;e===void 0&&(e={});const{x:r,y:o,platform:s,rects:i,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=At(e,t),g=vf(p),v=a[h?d==="floating"?"reference":"floating":d],w=Cs(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(v)))==null||n?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),x=d==="floating"?{x:r,y:o,width:i.floating.width,height:i.floating.height}:i.reference,b=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),_=await(s.isElement==null?void 0:s.isElement(b))?await(s.getScale==null?void 0:s.getScale(b))||{x:1,y:1}:{x:1,y:1},S=Cs(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:x,offsetParent:b,strategy:l}):x);return{top:(w.top-S.top+g.top)/_.y,bottom:(S.bottom-w.bottom+g.bottom)/_.y,left:(w.left-S.left+g.left)/_.x,right:(S.right-w.right+g.right)/_.x}}const Ub=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:o,rects:s,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=At(t,e)||{};if(c==null)return{};const d=vf(u),h={x:n,y:r},p=Rl(o),g=Al(p),y=await i.getDimensions(c),v=p==="y",w=v?"top":"left",x=v?"bottom":"right",b=v?"clientHeight":"clientWidth",_=s.reference[g]+s.reference[p]-h[p]-s.floating[g],S=h[p]-s.reference[p],k=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let C=k?k[b]:0;(!C||!await(i.isElement==null?void 0:i.isElement(k)))&&(C=a.floating[b]||s.floating[g]);const M=_/2-S/2,X=C/2-y[g]/2-1,L=Jt(d[w],X),J=Jt(d[x],X),j=L,oe=C-y[g]-J,B=C/2-y[g]/2+M,Y=Pa(j,B,oe),K=!l.arrow&&Tr(o)!=null&&B!==Y&&s.reference[g]/2-(B<j?L:J)-y[g]/2<0,ie=K?B<j?B-j:B-oe:0;return{[p]:h[p]+ie,data:{[p]:Y,centerOffset:B-Y-ie,...K&&{alignmentOffset:ie}},reset:K}}}),Hb=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:y=!0,...v}=At(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const w=Rt(o),x=Yt(a),b=Rt(a)===a,_=await(l.isRTL==null?void 0:l.isRTL(c.floating)),S=h||(b||!y?[_s(a)]:zb(a)),k=g!=="none";!h&&k&&S.push(...Lb(a,y,g,_));const C=[a,...S],M=await ao(e,v),X=[];let L=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&X.push(M[w]),d){const B=Mb(o,i,_);X.push(M[B[0]],M[B[1]])}if(L=[...L,{placement:o,overflows:X}],!X.every(B=>B<=0)){var J,j;const B=(((J=s.flip)==null?void 0:J.index)||0)+1,Y=C[B];if(Y)return{data:{index:B,overflows:L},reset:{placement:Y}};let K=(j=L.filter(ie=>ie.overflows[0]<=0).sort((ie,F)=>ie.overflows[1]-F.overflows[1])[0])==null?void 0:j.placement;if(!K)switch(p){case"bestFit":{var oe;const ie=(oe=L.filter(F=>{if(k){const ae=Yt(F.placement);return ae===x||ae==="y"}return!0}).map(F=>[F.placement,F.overflows.filter(ae=>ae>0).reduce((ae,ve)=>ae+ve,0)]).sort((F,ae)=>F[1]-ae[1])[0])==null?void 0:oe[0];ie&&(K=ie);break}case"initialPlacement":K=a;break}if(o!==K)return{reset:{placement:K}}}return{}}}};function nu(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function ru(t){return jb.some(e=>t[e]>=0)}const Wb=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...o}=At(t,e);switch(r){case"referenceHidden":{const s=await ao(e,{...o,elementContext:"reference"}),i=nu(s,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:ru(i)}}}case"escaped":{const s=await ao(e,{...o,altBoundary:!0}),i=nu(s,n.floating);return{data:{escapedOffsets:i,escaped:ru(i)}}}default:return{}}}}};async function Gb(t,e){const{placement:n,platform:r,elements:o}=t,s=await(r.isRTL==null?void 0:r.isRTL(o.floating)),i=Rt(n),a=Tr(n),l=Yt(n)==="y",c=["left","top"].includes(i)?-1:1,u=s&&l?-1:1,d=At(e,t);let{mainAxis:h,crossAxis:p,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(p=a==="end"?g*-1:g),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}const qb=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:o,y:s,placement:i,middlewareData:a}=e,l=await Gb(e,t);return i===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:o+l.x,y:s+l.y,data:{...l,placement:i}}}}},Vb=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:o}=e,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:v=>{let{x:w,y:x}=v;return{x:w,y:x}}},...l}=At(t,e),c={x:n,y:r},u=await ao(e,l),d=Yt(Rt(o)),h=Tl(d);let p=c[h],g=c[d];if(s){const v=h==="y"?"top":"left",w=h==="y"?"bottom":"right",x=p+u[v],b=p-u[w];p=Pa(x,p,b)}if(i){const v=d==="y"?"top":"left",w=d==="y"?"bottom":"right",x=g+u[v],b=g-u[w];g=Pa(x,g,b)}const y=a.fn({...e,[h]:p,[d]:g});return{...y,data:{x:y.x-n,y:y.y-r,enabled:{[h]:s,[d]:i}}}}}},Kb=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:o,rects:s,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=At(t,e),u={x:n,y:r},d=Yt(o),h=Tl(d);let p=u[h],g=u[d];const y=At(a,e),v=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(l){const b=h==="y"?"height":"width",_=s.reference[h]-s.floating[b]+v.mainAxis,S=s.reference[h]+s.reference[b]-v.mainAxis;p<_?p=_:p>S&&(p=S)}if(c){var w,x;const b=h==="y"?"width":"height",_=["top","left"].includes(Rt(o)),S=s.reference[d]-s.floating[b]+(_&&((w=i.offset)==null?void 0:w[d])||0)+(_?0:v.crossAxis),k=s.reference[d]+s.reference[b]+(_?0:((x=i.offset)==null?void 0:x[d])||0)-(_?v.crossAxis:0);g<S?g=S:g>k&&(g=k)}return{[h]:p,[d]:g}}}},Xb=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:o,rects:s,platform:i,elements:a}=e,{apply:l=()=>{},...c}=At(t,e),u=await ao(e,c),d=Rt(o),h=Tr(o),p=Yt(o)==="y",{width:g,height:y}=s.floating;let v,w;d==="top"||d==="bottom"?(v=d,w=h===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(w=d,v=h==="end"?"top":"bottom");const x=y-u.top-u.bottom,b=g-u.left-u.right,_=Jt(y-u[v],x),S=Jt(g-u[w],b),k=!e.middlewareData.shift;let C=_,M=S;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(M=b),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(C=x),k&&!h){const L=Ke(u.left,0),J=Ke(u.right,0),j=Ke(u.top,0),oe=Ke(u.bottom,0);p?M=g-2*(L!==0||J!==0?L+J:Ke(u.left,u.right)):C=y-2*(j!==0||oe!==0?j+oe:Ke(u.top,u.bottom))}await l({...e,availableWidth:M,availableHeight:C});const X=await i.getDimensions(a.floating);return g!==X.width||y!==X.height?{reset:{rects:!0}}:{}}}};function Ws(){return typeof window<"u"}function Ar(t){return wf(t)?(t.nodeName||"").toLowerCase():"#document"}function Je(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function wt(t){var e;return(e=(wf(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function wf(t){return Ws()?t instanceof Node||t instanceof Je(t).Node:!1}function st(t){return Ws()?t instanceof Element||t instanceof Je(t).Element:!1}function mt(t){return Ws()?t instanceof HTMLElement||t instanceof Je(t).HTMLElement:!1}function ou(t){return!Ws()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Je(t).ShadowRoot}function wo(t){const{overflow:e,overflowX:n,overflowY:r,display:o}=it(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(o)}function Jb(t){return["table","td","th"].includes(Ar(t))}function Gs(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function Ol(t){const e=Il(),n=st(t)?it(t):t;return["transform","translate","scale","rotate","perspective"].some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function Yb(t){let e=Zt(t);for(;mt(e)&&!pr(e);){if(Ol(e))return e;if(Gs(e))return null;e=Zt(e)}return null}function Il(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function pr(t){return["html","body","#document"].includes(Ar(t))}function it(t){return Je(t).getComputedStyle(t)}function qs(t){return st(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Zt(t){if(Ar(t)==="html")return t;const e=t.assignedSlot||t.parentNode||ou(t)&&t.host||wt(t);return ou(e)?e.host:e}function bf(t){const e=Zt(t);return pr(e)?t.ownerDocument?t.ownerDocument.body:t.body:mt(e)&&wo(e)?e:bf(e)}function lo(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const o=bf(t),s=o===((r=t.ownerDocument)==null?void 0:r.body),i=Je(o);if(s){const a=Ta(i);return e.concat(i,i.visualViewport||[],wo(o)?o:[],a&&n?lo(a):[])}return e.concat(o,lo(o,[],n))}function Ta(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function xf(t){const e=it(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=mt(t),s=o?t.offsetWidth:n,i=o?t.offsetHeight:r,a=xs(n)!==s||xs(r)!==i;return a&&(n=s,r=i),{width:n,height:r,$:a}}function jl(t){return st(t)?t:t.contextElement}function lr(t){const e=jl(t);if(!mt(e))return pt(1);const n=e.getBoundingClientRect(),{width:r,height:o,$:s}=xf(e);let i=(s?xs(n.width):n.width)/r,a=(s?xs(n.height):n.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const Zb=pt(0);function _f(t){const e=Je(t);return!Il()||!e.visualViewport?Zb:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Qb(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Je(t)?!1:e}function wn(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const o=t.getBoundingClientRect(),s=jl(t);let i=pt(1);e&&(r?st(r)&&(i=lr(r)):i=lr(t));const a=Qb(s,n,r)?_f(s):pt(0);let l=(o.left+a.x)/i.x,c=(o.top+a.y)/i.y,u=o.width/i.x,d=o.height/i.y;if(s){const h=Je(s),p=r&&st(r)?Je(r):r;let g=h,y=Ta(g);for(;y&&r&&p!==g;){const v=lr(y),w=y.getBoundingClientRect(),x=it(y),b=w.left+(y.clientLeft+parseFloat(x.paddingLeft))*v.x,_=w.top+(y.clientTop+parseFloat(x.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,d*=v.y,l+=b,c+=_,g=Je(y),y=Ta(g)}}return Cs({width:u,height:d,x:l,y:c})}function $l(t,e){const n=qs(t).scrollLeft;return e?e.left+n:wn(wt(t)).left+n}function Cf(t,e,n){n===void 0&&(n=!1);const r=t.getBoundingClientRect(),o=r.left+e.scrollLeft-(n?0:$l(t,r)),s=r.top+e.scrollTop;return{x:o,y:s}}function ex(t){let{elements:e,rect:n,offsetParent:r,strategy:o}=t;const s=o==="fixed",i=wt(r),a=e?Gs(e.floating):!1;if(r===i||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=pt(1);const u=pt(0),d=mt(r);if((d||!d&&!s)&&((Ar(r)!=="body"||wo(i))&&(l=qs(r)),mt(r))){const p=wn(r);c=lr(r),u.x=p.x+r.clientLeft,u.y=p.y+r.clientTop}const h=i&&!d&&!s?Cf(i,l,!0):pt(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:n.y*c.y-l.scrollTop*c.y+u.y+h.y}}function tx(t){return Array.from(t.getClientRects())}function nx(t){const e=wt(t),n=qs(t),r=t.ownerDocument.body,o=Ke(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Ke(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let i=-n.scrollLeft+$l(t);const a=-n.scrollTop;return it(r).direction==="rtl"&&(i+=Ke(e.clientWidth,r.clientWidth)-o),{width:o,height:s,x:i,y:a}}function rx(t,e){const n=Je(t),r=wt(t),o=n.visualViewport;let s=r.clientWidth,i=r.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;const c=Il();(!c||c&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:s,height:i,x:a,y:l}}function ox(t,e){const n=wn(t,!0,e==="fixed"),r=n.top+t.clientTop,o=n.left+t.clientLeft,s=mt(t)?lr(t):pt(1),i=t.clientWidth*s.x,a=t.clientHeight*s.y,l=o*s.x,c=r*s.y;return{width:i,height:a,x:l,y:c}}function su(t,e,n){let r;if(e==="viewport")r=rx(t,n);else if(e==="document")r=nx(wt(t));else if(st(e))r=ox(e,n);else{const o=_f(t);r={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return Cs(r)}function Sf(t,e){const n=Zt(t);return n===e||!st(n)||pr(n)?!1:it(n).position==="fixed"||Sf(n,e)}function sx(t,e){const n=e.get(t);if(n)return n;let r=lo(t,[],!1).filter(a=>st(a)&&Ar(a)!=="body"),o=null;const s=it(t).position==="fixed";let i=s?Zt(t):t;for(;st(i)&&!pr(i);){const a=it(i),l=Ol(i);!l&&a.position==="fixed"&&(o=null),(s?!l&&!o:!l&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||wo(i)&&!l&&Sf(t,i))?r=r.filter(u=>u!==i):o=a,i=Zt(i)}return e.set(t,r),r}function ix(t){let{element:e,boundary:n,rootBoundary:r,strategy:o}=t;const i=[...n==="clippingAncestors"?Gs(e)?[]:sx(e,this._c):[].concat(n),r],a=i[0],l=i.reduce((c,u)=>{const d=su(e,u,o);return c.top=Ke(d.top,c.top),c.right=Jt(d.right,c.right),c.bottom=Jt(d.bottom,c.bottom),c.left=Ke(d.left,c.left),c},su(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function ax(t){const{width:e,height:n}=xf(t);return{width:e,height:n}}function lx(t,e,n){const r=mt(e),o=wt(e),s=n==="fixed",i=wn(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=pt(0);if(r||!r&&!s)if((Ar(e)!=="body"||wo(o))&&(a=qs(e)),r){const h=wn(e,!0,s,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else o&&(l.x=$l(o));const c=o&&!r&&!s?Cf(o,a):pt(0),u=i.left+a.scrollLeft-l.x-c.x,d=i.top+a.scrollTop-l.y-c.y;return{x:u,y:d,width:i.width,height:i.height}}function Ri(t){return it(t).position==="static"}function iu(t,e){if(!mt(t)||it(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return wt(t)===n&&(n=n.ownerDocument.body),n}function kf(t,e){const n=Je(t);if(Gs(t))return n;if(!mt(t)){let o=Zt(t);for(;o&&!pr(o);){if(st(o)&&!Ri(o))return o;o=Zt(o)}return n}let r=iu(t,e);for(;r&&Jb(r)&&Ri(r);)r=iu(r,e);return r&&pr(r)&&Ri(r)&&!Ol(r)?n:r||Yb(t)||n}const cx=async function(t){const e=this.getOffsetParent||kf,n=this.getDimensions,r=await n(t.floating);return{reference:lx(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function ux(t){return it(t).direction==="rtl"}const dx={convertOffsetParentRelativeRectToViewportRelativeRect:ex,getDocumentElement:wt,getClippingRect:ix,getOffsetParent:kf,getElementRects:cx,getClientRects:tx,getDimensions:ax,getScale:lr,isElement:st,isRTL:ux};function Pf(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function hx(t,e){let n=null,r;const o=wt(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:h,height:p}=c;if(a||e(),!h||!p)return;const g=Lo(d),y=Lo(o.clientWidth-(u+h)),v=Lo(o.clientHeight-(d+p)),w=Lo(u),b={rootMargin:-g+"px "+-y+"px "+-v+"px "+-w+"px",threshold:Ke(0,Jt(1,l))||1};let _=!0;function S(k){const C=k[0].intersectionRatio;if(C!==l){if(!_)return i();C?i(!1,C):r=setTimeout(()=>{i(!1,1e-7)},1e3)}C===1&&!Pf(c,t.getBoundingClientRect())&&i(),_=!1}try{n=new IntersectionObserver(S,{...b,root:o.ownerDocument})}catch{n=new IntersectionObserver(S,b)}n.observe(t)}return i(!0),s}function Ef(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=jl(t),u=o||s?[...c?lo(c):[],...lo(e)]:[];u.forEach(w=>{o&&w.addEventListener("scroll",n,{passive:!0}),s&&w.addEventListener("resize",n)});const d=c&&a?hx(c,n):null;let h=-1,p=null;i&&(p=new ResizeObserver(w=>{let[x]=w;x&&x.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var b;(b=p)==null||b.observe(e)})),n()}),c&&!l&&p.observe(c),p.observe(e));let g,y=l?wn(t):null;l&&v();function v(){const w=wn(t);y&&!Pf(y,w)&&n(),y=w,g=requestAnimationFrame(v)}return n(),()=>{var w;u.forEach(x=>{o&&x.removeEventListener("scroll",n),s&&x.removeEventListener("resize",n)}),d?.(),(w=p)==null||w.disconnect(),p=null,l&&cancelAnimationFrame(g)}}const fx=qb,px=Vb,mx=Hb,gx=Xb,yx=Wb,au=Ub,vx=Kb,wx=(t,e,n)=>{const r=new Map,o={platform:dx,...n},s={...o.platform,_c:r};return Fb(t,e,{...o,platform:s})};var ss=typeof document<"u"?m.useLayoutEffect:m.useEffect;function Ss(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!Ss(t[r],e[r]))return!1;return!0}if(o=Object.keys(t),n=o.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,o[r]))return!1;for(r=n;r--!==0;){const s=o[r];if(!(s==="_owner"&&t.$$typeof)&&!Ss(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Tf(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function lu(t,e){const n=Tf(t);return Math.round(e*n)/n}function Oi(t){const e=m.useRef(t);return ss(()=>{e.current=t}),e}function Af(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=m.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=m.useState(r);Ss(h,r)||p(r);const[g,y]=m.useState(null),[v,w]=m.useState(null),x=m.useCallback(F=>{F!==k.current&&(k.current=F,y(F))},[]),b=m.useCallback(F=>{F!==C.current&&(C.current=F,w(F))},[]),_=s||g,S=i||v,k=m.useRef(null),C=m.useRef(null),M=m.useRef(u),X=l!=null,L=Oi(l),J=Oi(o),j=Oi(c),oe=m.useCallback(()=>{if(!k.current||!C.current)return;const F={placement:e,strategy:n,middleware:h};J.current&&(F.platform=J.current),wx(k.current,C.current,F).then(ae=>{const ve={...ae,isPositioned:j.current!==!1};B.current&&!Ss(M.current,ve)&&(M.current=ve,Us.flushSync(()=>{d(ve)}))})},[h,e,n,J,j]);ss(()=>{c===!1&&M.current.isPositioned&&(M.current.isPositioned=!1,d(F=>({...F,isPositioned:!1})))},[c]);const B=m.useRef(!1);ss(()=>(B.current=!0,()=>{B.current=!1}),[]),ss(()=>{if(_&&(k.current=_),S&&(C.current=S),_&&S){if(L.current)return L.current(_,S,oe);oe()}},[_,S,oe,L,X]);const Y=m.useMemo(()=>({reference:k,floating:C,setReference:x,setFloating:b}),[x,b]),K=m.useMemo(()=>({reference:_,floating:S}),[_,S]),ie=m.useMemo(()=>{const F={position:n,left:0,top:0};if(!K.floating)return F;const ae=lu(K.floating,u.x),ve=lu(K.floating,u.y);return a?{...F,transform:"translate("+ae+"px, "+ve+"px)",...Tf(K.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:ae,top:ve}},[n,a,K.floating,u.x,u.y]);return m.useMemo(()=>({...u,update:oe,refs:Y,elements:K,floatingStyles:ie}),[u,oe,Y,K,ie])}const bx=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:o}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?au({element:r.current,padding:o}).fn(n):{}:r?au({element:r,padding:o}).fn(n):{}}}},Rf=(t,e)=>({...fx(t),options:[t,e]}),Of=(t,e)=>({...px(t),options:[t,e]}),If=(t,e)=>({...vx(t),options:[t,e]}),jf=(t,e)=>({...mx(t),options:[t,e]}),$f=(t,e)=>({...gx(t),options:[t,e]}),Nf=(t,e)=>({...yx(t),options:[t,e]}),Mf=(t,e)=>({...bx(t),options:[t,e]});var xx="Arrow",zf=m.forwardRef((t,e)=>{const{children:n,width:r=10,height:o=5,...s}=t;return f.jsx(be.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:f.jsx("polygon",{points:"0,0 30,0 15,10"})})});zf.displayName=xx;var _x=zf;function Cx(t){const[e,n]=m.useState(void 0);return vn(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var Nl="Popper",[Df,Lf]=kl(Nl),[Sx,Bf]=Df(Nl),Ff=t=>{const{__scopePopper:e,children:n}=t,[r,o]=m.useState(null);return f.jsx(Sx,{scope:e,anchor:r,onAnchorChange:o,children:n})};Ff.displayName=Nl;var Uf="PopperAnchor",Hf=m.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,s=Bf(Uf,n),i=m.useRef(null),a=at(e,i);return m.useEffect(()=>{s.onAnchorChange(r?.current||i.current)}),r?null:f.jsx(be.div,{...o,ref:a})});Hf.displayName=Uf;var Ml="PopperContent",[kx,Px]=Df(Ml),Wf=m.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:g,...y}=t,v=Bf(Ml,n),[w,x]=m.useState(null),b=at(e,A=>x(A)),[_,S]=m.useState(null),k=Cx(_),C=k?.width??0,M=k?.height??0,X=r+(s!=="center"?"-"+s:""),L=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},J=Array.isArray(c)?c:[c],j=J.length>0,oe={padding:L,boundary:J.filter(Tx),altBoundary:j},{refs:B,floatingStyles:Y,placement:K,isPositioned:ie,middlewareData:F}=Af({strategy:"fixed",placement:X,whileElementsMounted:(...A)=>Ef(...A,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[Rf({mainAxis:o+M,alignmentAxis:i}),l&&Of({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?If():void 0,...oe}),l&&jf({...oe}),$f({...oe,apply:({elements:A,rects:z,availableWidth:re,availableHeight:ue})=>{const{width:Ne,height:Me}=z.reference,ce=A.floating.style;ce.setProperty("--radix-popper-available-width",`${re}px`),ce.setProperty("--radix-popper-available-height",`${ue}px`),ce.setProperty("--radix-popper-anchor-width",`${Ne}px`),ce.setProperty("--radix-popper-anchor-height",`${Me}px`)}}),_&&Mf({element:_,padding:a}),Ax({arrowWidth:C,arrowHeight:M}),h&&Nf({strategy:"referenceHidden",...oe})]}),[ae,ve]=Vf(K),pe=Xt(g);vn(()=>{ie&&pe?.()},[ie,pe]);const E=F.arrow?.x,P=F.arrow?.y,R=F.arrow?.centerOffset!==0,[T,I]=m.useState();return vn(()=>{w&&I(window.getComputedStyle(w).zIndex)},[w]),f.jsx("div",{ref:B.setFloating,"data-radix-popper-content-wrapper":"",style:{...Y,transform:ie?Y.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:T,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:f.jsx(kx,{scope:n,placedSide:ae,onArrowChange:S,arrowX:E,arrowY:P,shouldHideArrow:R,children:f.jsx(be.div,{"data-side":ae,"data-align":ve,...y,ref:b,style:{...y.style,animation:ie?void 0:"none"}})})})});Wf.displayName=Ml;var Gf="PopperArrow",Ex={top:"bottom",right:"left",bottom:"top",left:"right"},qf=m.forwardRef(function(e,n){const{__scopePopper:r,...o}=e,s=Px(Gf,r),i=Ex[s.placedSide];return f.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:f.jsx(_x,{...o,ref:n,style:{...o.style,display:"block"}})})});qf.displayName=Gf;function Tx(t){return t!==null}var Ax=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=Vf(n),d={start:"0%",center:"50%",end:"100%"}[u],h=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let g="",y="";return c==="bottom"?(g=i?d:`${h}px`,y=`${-l}px`):c==="top"?(g=i?d:`${h}px`,y=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,y=i?d:`${p}px`):c==="left"&&(g=`${r.floating.width+l}px`,y=i?d:`${p}px`),{data:{x:g,y}}}});function Vf(t){const[e,n="center"]=t.split("-");return[e,n]}var Rx=Ff,Kf=Hf,Ox=Wf,Ix=qf,jx="Portal",Xf=m.forwardRef((t,e)=>{const{container:n,...r}=t,[o,s]=m.useState(!1);vn(()=>s(!0),[]);const i=n||o&&globalThis?.document?.body;return i?ff.createPortal(f.jsx(be.div,{...r,ref:e}),i):null});Xf.displayName=jx;function $x(t,e){return m.useReducer((n,r)=>e[n][r]??n,t)}var bo=t=>{const{present:e,children:n}=t,r=Nx(e),o=typeof n=="function"?n({present:r.isPresent}):m.Children.only(n),s=at(r.ref,Mx(o));return typeof n=="function"||r.isPresent?m.cloneElement(o,{ref:s}):null};bo.displayName="Presence";function Nx(t){const[e,n]=m.useState(),r=m.useRef({}),o=m.useRef(t),s=m.useRef("none"),i=t?"mounted":"unmounted",[a,l]=$x(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return m.useEffect(()=>{const c=Bo(r.current);s.current=a==="mounted"?c:"none"},[a]),vn(()=>{const c=r.current,u=o.current;if(u!==t){const h=s.current,p=Bo(c);t?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&h!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),vn(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const y=Bo(r.current).includes(p.animationName);if(p.target===e&&y&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},h=p=>{p.target===e&&(s.current=Bo(r.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:m.useCallback(c=>{c&&(r.current=getComputedStyle(c)),n(c)},[])}}function Bo(t){return t?.animationName||"none"}function Mx(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function Jf({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,o]=zx({defaultProp:e,onChange:n}),s=t!==void 0,i=s?t:r,a=Xt(n),l=m.useCallback(c=>{if(s){const d=typeof c=="function"?c(t):c;d!==t&&a(d)}else o(c)},[s,t,o,a]);return[i,l]}function zx({defaultProp:t,onChange:e}){const n=m.useState(t),[r]=n,o=m.useRef(r),s=Xt(e);return m.useEffect(()=>{o.current!==r&&(s(r),o.current=r)},[r,o,s]),n}var Dx=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},jn=new WeakMap,Fo=new WeakMap,Uo={},Ii=0,Yf=function(t){return t&&(t.host||Yf(t.parentNode))},Lx=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=Yf(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},Bx=function(t,e,n,r){var o=Lx(e,Array.isArray(t)?t:[t]);Uo[n]||(Uo[n]=new WeakMap);var s=Uo[n],i=[],a=new Set,l=new Set(o),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};o.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var p=h.getAttribute(r),g=p!==null&&p!=="false",y=(jn.get(h)||0)+1,v=(s.get(h)||0)+1;jn.set(h,y),s.set(h,v),i.push(h),y===1&&g&&Fo.set(h,!0),v===1&&h.setAttribute(n,"true"),g||h.setAttribute(r,"true")}catch(w){console.error("aria-hidden: cannot operate on ",h,w)}})};return u(e),a.clear(),Ii++,function(){i.forEach(function(d){var h=jn.get(d)-1,p=s.get(d)-1;jn.set(d,h),s.set(d,p),h||(Fo.has(d)||d.removeAttribute(r),Fo.delete(d)),p||d.removeAttribute(n)}),Ii--,Ii||(jn=new WeakMap,jn=new WeakMap,Fo=new WeakMap,Uo={})}},Zf=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),o=Dx(t);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live]"))),Bx(r,o,n,"aria-hidden")):function(){return null}},dt=function(){return dt=Object.assign||function(e){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},dt.apply(this,arguments)};function Qf(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function Fx(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,s;r<o;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}var is="right-scroll-bar-position",as="width-before-scroll-bar",Ux="with-scroll-bars-hidden",Hx="--removed-body-scroll-bar-size";function ji(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function Wx(t,e){var n=m.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var o=n.value;o!==r&&(n.value=r,n.callback(r,o))}}}})[0];return n.callback=e,n.facade}var Gx=typeof window<"u"?m.useLayoutEffect:m.useEffect,cu=new WeakMap;function qx(t,e){var n=Wx(null,function(r){return t.forEach(function(o){return ji(o,r)})});return Gx(function(){var r=cu.get(n);if(r){var o=new Set(r),s=new Set(t),i=n.current;o.forEach(function(a){s.has(a)||ji(a,null)}),s.forEach(function(a){o.has(a)||ji(a,i)})}cu.set(n,t)},[t]),n}function Vx(t){return t}function Kx(t,e){e===void 0&&(e=Vx);var n=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var i=e(s,r);return n.push(i),function(){n=n.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(r=!0;n.length;){var i=n;n=[],i.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){r=!0;var i=[];if(n.length){var a=n;n=[],a.forEach(s),i=n}var l=function(){var u=i;i=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),n={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),n}}}};return o}function Xx(t){t===void 0&&(t={});var e=Kx(null);return e.options=dt({async:!0,ssr:!1},t),e}var ep=function(t){var e=t.sideCar,n=Qf(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return m.createElement(r,dt({},n))};ep.isSideCarExport=!0;function Jx(t,e){return t.useMedium(e),ep}var tp=Xx(),$i=function(){},Vs=m.forwardRef(function(t,e){var n=m.useRef(null),r=m.useState({onScrollCapture:$i,onWheelCapture:$i,onTouchMoveCapture:$i}),o=r[0],s=r[1],i=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,h=t.sideCar,p=t.noIsolation,g=t.inert,y=t.allowPinchZoom,v=t.as,w=v===void 0?"div":v,x=t.gapMode,b=Qf(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),_=h,S=qx([n,e]),k=dt(dt({},b),o);return m.createElement(m.Fragment,null,u&&m.createElement(_,{sideCar:tp,removeScrollBar:c,shards:d,noIsolation:p,inert:g,setCallbacks:s,allowPinchZoom:!!y,lockRef:n,gapMode:x}),i?m.cloneElement(m.Children.only(a),dt(dt({},k),{ref:S})):m.createElement(w,dt({},k,{className:l,ref:S}),a))});Vs.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Vs.classNames={fullWidth:as,zeroRight:is};var Yx=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Zx(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Yx();return e&&t.setAttribute("nonce",e),t}function Qx(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function e0(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var t0=function(){var t=0,e=null;return{add:function(n){t==0&&(e=Zx())&&(Qx(e,n),e0(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},n0=function(){var t=t0();return function(e,n){m.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},np=function(){var t=n0(),e=function(n){var r=n.styles,o=n.dynamic;return t(r,o),null};return e},r0={left:0,top:0,right:0,gap:0},Ni=function(t){return parseInt(t||"",10)||0},o0=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],o=e[t==="padding"?"paddingRight":"marginRight"];return[Ni(n),Ni(r),Ni(o)]},s0=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return r0;var e=o0(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},i0=np(),cr="data-scroll-locked",a0=function(t,e,n,r){var o=t.left,s=t.top,i=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(Ux,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(cr,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(is,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(as,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(is," .").concat(is,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(as," .").concat(as,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(cr,`] {
    `).concat(Hx,": ").concat(a,`px;
  }
`)},uu=function(){var t=parseInt(document.body.getAttribute(cr)||"0",10);return isFinite(t)?t:0},l0=function(){m.useEffect(function(){return document.body.setAttribute(cr,(uu()+1).toString()),function(){var t=uu()-1;t<=0?document.body.removeAttribute(cr):document.body.setAttribute(cr,t.toString())}},[])},c0=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,o=r===void 0?"margin":r;l0();var s=m.useMemo(function(){return s0(o)},[o]);return m.createElement(i0,{styles:a0(s,!e,o,n?"":"!important")})},Aa=!1;if(typeof window<"u")try{var Ho=Object.defineProperty({},"passive",{get:function(){return Aa=!0,!0}});window.addEventListener("test",Ho,Ho),window.removeEventListener("test",Ho,Ho)}catch{Aa=!1}var $n=Aa?{passive:!1}:!1,u0=function(t){return t.tagName==="TEXTAREA"},rp=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!u0(t)&&n[e]==="visible")},d0=function(t){return rp(t,"overflowY")},h0=function(t){return rp(t,"overflowX")},du=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=op(t,r);if(o){var s=sp(t,r),i=s[1],a=s[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},f0=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},p0=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},op=function(t,e){return t==="v"?d0(e):h0(e)},sp=function(t,e){return t==="v"?f0(e):p0(e)},m0=function(t,e){return t==="h"&&e==="rtl"?-1:1},g0=function(t,e,n,r,o){var s=m0(t,window.getComputedStyle(e).direction),i=s*r,a=n.target,l=e.contains(a),c=!1,u=i>0,d=0,h=0;do{var p=sp(t,a),g=p[0],y=p[1],v=p[2],w=y-v-s*g;(g||w)&&op(t,a)&&(d+=w,h+=g),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},Wo=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},hu=function(t){return[t.deltaX,t.deltaY]},fu=function(t){return t&&"current"in t?t.current:t},y0=function(t,e){return t[0]===e[0]&&t[1]===e[1]},v0=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},w0=0,Nn=[];function b0(t){var e=m.useRef([]),n=m.useRef([0,0]),r=m.useRef(),o=m.useState(w0++)[0],s=m.useState(np)[0],i=m.useRef(t);m.useEffect(function(){i.current=t},[t]),m.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(o));var y=Fx([t.lockRef.current],(t.shards||[]).map(fu),!0).filter(Boolean);return y.forEach(function(v){return v.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),y.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(o))})}}},[t.inert,t.lockRef.current,t.shards]);var a=m.useCallback(function(y,v){if("touches"in y&&y.touches.length===2||y.type==="wheel"&&y.ctrlKey)return!i.current.allowPinchZoom;var w=Wo(y),x=n.current,b="deltaX"in y?y.deltaX:x[0]-w[0],_="deltaY"in y?y.deltaY:x[1]-w[1],S,k=y.target,C=Math.abs(b)>Math.abs(_)?"h":"v";if("touches"in y&&C==="h"&&k.type==="range")return!1;var M=du(C,k);if(!M)return!0;if(M?S=C:(S=C==="v"?"h":"v",M=du(C,k)),!M)return!1;if(!r.current&&"changedTouches"in y&&(b||_)&&(r.current=S),!S)return!0;var X=r.current||S;return g0(X,v,y,X==="h"?b:_)},[]),l=m.useCallback(function(y){var v=y;if(!(!Nn.length||Nn[Nn.length-1]!==s)){var w="deltaY"in v?hu(v):Wo(v),x=e.current.filter(function(S){return S.name===v.type&&(S.target===v.target||v.target===S.shadowParent)&&y0(S.delta,w)})[0];if(x&&x.should){v.cancelable&&v.preventDefault();return}if(!x){var b=(i.current.shards||[]).map(fu).filter(Boolean).filter(function(S){return S.contains(v.target)}),_=b.length>0?a(v,b[0]):!i.current.noIsolation;_&&v.cancelable&&v.preventDefault()}}},[]),c=m.useCallback(function(y,v,w,x){var b={name:y,delta:v,target:w,should:x,shadowParent:x0(w)};e.current.push(b),setTimeout(function(){e.current=e.current.filter(function(_){return _!==b})},1)},[]),u=m.useCallback(function(y){n.current=Wo(y),r.current=void 0},[]),d=m.useCallback(function(y){c(y.type,hu(y),y.target,a(y,t.lockRef.current))},[]),h=m.useCallback(function(y){c(y.type,Wo(y),y.target,a(y,t.lockRef.current))},[]);m.useEffect(function(){return Nn.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,$n),document.addEventListener("touchmove",l,$n),document.addEventListener("touchstart",u,$n),function(){Nn=Nn.filter(function(y){return y!==s}),document.removeEventListener("wheel",l,$n),document.removeEventListener("touchmove",l,$n),document.removeEventListener("touchstart",u,$n)}},[]);var p=t.removeScrollBar,g=t.inert;return m.createElement(m.Fragment,null,g?m.createElement(s,{styles:v0(o)}):null,p?m.createElement(c0,{gapMode:t.gapMode}):null)}function x0(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const _0=Jx(tp,b0);var zl=m.forwardRef(function(t,e){return m.createElement(Vs,dt({},t,{ref:e,sideCar:_0}))});zl.classNames=Vs.classNames;var Dl="Popover",[ip,bR]=kl(Dl,[Lf]),xo=Lf(),[C0,An]=ip(Dl),ap=t=>{const{__scopePopover:e,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!1}=t,a=xo(e),l=m.useRef(null),[c,u]=m.useState(!1),[d=!1,h]=Jf({prop:r,defaultProp:o,onChange:s});return f.jsx(Rx,{...a,children:f.jsx(C0,{scope:e,contentId:ft(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:m.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:c,onCustomAnchorAdd:m.useCallback(()=>u(!0),[]),onCustomAnchorRemove:m.useCallback(()=>u(!1),[]),modal:i,children:n})})};ap.displayName=Dl;var lp="PopoverAnchor",S0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=An(lp,n),s=xo(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=o;return m.useEffect(()=>(i(),()=>a()),[i,a]),f.jsx(Kf,{...s,...r,ref:e})});S0.displayName=lp;var cp="PopoverTrigger",up=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=An(cp,n),s=xo(n),i=at(e,o.triggerRef),a=f.jsx(be.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":pp(o.open),...r,ref:i,onClick:Xe(t.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:f.jsx(Kf,{asChild:!0,...s,children:a})});up.displayName=cp;var k0="PopoverPortal",[xR,P0]=ip(k0,{forceMount:void 0}),mr="PopoverContent",dp=m.forwardRef((t,e)=>{const n=P0(mr,t.__scopePopover),{forceMount:r=n.forceMount,...o}=t,s=An(mr,t.__scopePopover);return f.jsx(bo,{present:r||s.open,children:s.modal?f.jsx(E0,{...o,ref:e}):f.jsx(T0,{...o,ref:e})})});dp.displayName=mr;var E0=m.forwardRef((t,e)=>{const n=An(mr,t.__scopePopover),r=m.useRef(null),o=at(e,r),s=m.useRef(!1);return m.useEffect(()=>{const i=r.current;if(i)return Zf(i)},[]),f.jsx(zl,{as:Hs,allowPinchZoom:!0,children:f.jsx(hp,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Xe(t.onCloseAutoFocus,i=>{i.preventDefault(),s.current||n.triggerRef.current?.focus()}),onPointerDownOutside:Xe(t.onPointerDownOutside,i=>{const a=i.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Xe(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),T0=m.forwardRef((t,e)=>{const n=An(mr,t.__scopePopover),r=m.useRef(!1),o=m.useRef(!1);return f.jsx(hp,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;n.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),hp=m.forwardRef((t,e)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=t,h=An(mr,n),p=xo(n);return gf(),f.jsx(El,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:f.jsx(Pl,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1),children:f.jsx(Ox,{"data-state":pp(h.open),role:"dialog",id:h.contentId,...p,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),fp="PopoverClose",A0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=An(fp,n);return f.jsx(be.button,{type:"button",...r,ref:e,onClick:Xe(t.onClick,()=>o.onOpenChange(!1))})});A0.displayName=fp;var R0="PopoverArrow",O0=m.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,o=xo(n);return f.jsx(Ix,{...o,...r,ref:e})});O0.displayName=R0;function pp(t){return t?"open":"closed"}var I0=up;function mp(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(e=0;e<o;e++)t[e]&&(n=mp(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function Ll(){for(var t,e,n=0,r="",o=arguments.length;n<o;n++)(t=arguments[n])&&(e=mp(t))&&(r&&(r+=" "),r+=e);return r}function Te(...t){return Sl(Ll(t))}const gp=ap,yp=I0,vp=m.forwardRef(({className:t,align:e="end",...n},r)=>f.jsx(dp,{ref:r,align:e,className:Te("z-popups drop-shadow-oneBlock p-0 border-shadow outline-none",t),...n,onKeyDown:o=>{o.stopPropagation()}})),Ks=({children:t,scaleFactor:e})=>{const n=gh();return f.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??n,"--block":`${(e??n)*8}px`},children:t})};var pu=1,j0=.9,$0=.8,N0=.17,Mi=.1,zi=.999,M0=.9999,z0=.99,D0=/[\\\/_+.#"@\[\(\{&]/,L0=/[\\\/_+.#"@\[\(\{&]/g,B0=/[\s-]/,wp=/[\s-]/g;function Ra(t,e,n,r,o,s,i){if(s===e.length)return o===t.length?pu:z0;var a=`${o},${s}`;if(i[a]!==void 0)return i[a];for(var l=r.charAt(s),c=n.indexOf(l,o),u=0,d,h,p,g;c>=0;)d=Ra(t,e,n,r,c+1,s+1,i),d>u&&(c===o?d*=pu:D0.test(t.charAt(c-1))?(d*=$0,p=t.slice(o,c-1).match(L0),p&&o>0&&(d*=Math.pow(zi,p.length))):B0.test(t.charAt(c-1))?(d*=j0,g=t.slice(o,c-1).match(wp),g&&o>0&&(d*=Math.pow(zi,g.length))):(d*=N0,o>0&&(d*=Math.pow(zi,c-o))),t.charAt(c)!==e.charAt(s)&&(d*=M0)),(d<Mi&&n.charAt(c-1)===r.charAt(s+1)||r.charAt(s+1)===r.charAt(s)&&n.charAt(c-1)!==r.charAt(s))&&(h=Ra(t,e,n,r,c+1,s+2,i),h*Mi>d&&(d=h*Mi)),d>u&&(u=d),c=n.indexOf(l,c+1);return i[a]=u,u}function mu(t){return t.toLowerCase().replace(wp," ")}function F0(t,e,n){return t=n&&n.length>0?`${t+" "+n.join(" ")}`:t,Ra(t,e,mu(t),mu(e),0,0,{})}var Bl="Dialog",[bp,_R]=kl(Bl),[U0,lt]=bp(Bl),xp=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!0}=t,a=m.useRef(null),l=m.useRef(null),[c=!1,u]=Jf({prop:r,defaultProp:o,onChange:s});return f.jsx(U0,{scope:e,triggerRef:a,contentRef:l,contentId:ft(),titleId:ft(),descriptionId:ft(),open:c,onOpenChange:u,onOpenToggle:m.useCallback(()=>u(d=>!d),[u]),modal:i,children:n})};xp.displayName=Bl;var _p="DialogTrigger",H0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(_p,n),s=at(e,o.triggerRef);return f.jsx(be.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Hl(o.open),...r,ref:s,onClick:Xe(t.onClick,o.onOpenToggle)})});H0.displayName=_p;var Fl="DialogPortal",[W0,Cp]=bp(Fl,{forceMount:void 0}),Sp=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:o}=t,s=lt(Fl,e);return f.jsx(W0,{scope:e,forceMount:n,children:m.Children.map(r,i=>f.jsx(bo,{present:n||s.open,children:f.jsx(Xf,{asChild:!0,container:o,children:i})}))})};Sp.displayName=Fl;var ks="DialogOverlay",kp=m.forwardRef((t,e)=>{const n=Cp(ks,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,s=lt(ks,t.__scopeDialog);return s.modal?f.jsx(bo,{present:r||s.open,children:f.jsx(G0,{...o,ref:e})}):null});kp.displayName=ks;var G0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(ks,n);return f.jsx(zl,{as:Hs,allowPinchZoom:!0,shards:[o.contentRef],children:f.jsx(be.div,{"data-state":Hl(o.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),bn="DialogContent",Pp=m.forwardRef((t,e)=>{const n=Cp(bn,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,s=lt(bn,t.__scopeDialog);return f.jsx(bo,{present:r||s.open,children:s.modal?f.jsx(q0,{...o,ref:e}):f.jsx(V0,{...o,ref:e})})});Pp.displayName=bn;var q0=m.forwardRef((t,e)=>{const n=lt(bn,t.__scopeDialog),r=m.useRef(null),o=at(e,n.contentRef,r);return m.useEffect(()=>{const s=r.current;if(s)return Zf(s)},[]),f.jsx(Ep,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Xe(t.onCloseAutoFocus,s=>{s.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Xe(t.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:Xe(t.onFocusOutside,s=>s.preventDefault())})}),V0=m.forwardRef((t,e)=>{const n=lt(bn,t.__scopeDialog),r=m.useRef(!1),o=m.useRef(!1);return f.jsx(Ep,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;n.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),Ep=m.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=t,a=lt(bn,n),l=m.useRef(null),c=at(e,l);return gf(),f.jsxs(f.Fragment,{children:[f.jsx(El,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:f.jsx(Pl,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":Hl(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),f.jsxs(f.Fragment,{children:[f.jsx(Y0,{titleId:a.titleId}),f.jsx(Q0,{contentRef:l,descriptionId:a.descriptionId})]})]})}),Ul="DialogTitle",K0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(Ul,n);return f.jsx(be.h2,{id:o.titleId,...r,ref:e})});K0.displayName=Ul;var Tp="DialogDescription",X0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(Tp,n);return f.jsx(be.p,{id:o.descriptionId,...r,ref:e})});X0.displayName=Tp;var Ap="DialogClose",J0=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=lt(Ap,n);return f.jsx(be.button,{type:"button",...r,ref:e,onClick:Xe(t.onClick,()=>o.onOpenChange(!1))})});J0.displayName=Ap;function Hl(t){return t?"open":"closed"}var Rp="DialogTitleWarning",[CR,Op]=lb(Rp,{contentName:bn,titleName:Ul,docsSlug:"dialog"}),Y0=({titleId:t})=>{const e=Op(Rp),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return m.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},Z0="DialogDescriptionWarning",Q0=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Op(Z0).contentName}}.`;return m.useEffect(()=>{const o=t.current?.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},e_=xp,t_=Sp,n_=kp,r_=Pp,Di={exports:{}},Li={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gu;function o_(){if(gu)return Li;gu=1;var t=yy();function e(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,o=t.useEffect,s=t.useLayoutEffect,i=t.useDebugValue;function a(d,h){var p=h(),g=r({inst:{value:p,getSnapshot:h}}),y=g[0].inst,v=g[1];return s(function(){y.value=p,y.getSnapshot=h,l(y)&&v({inst:y})},[d,p,h]),o(function(){return l(y)&&v({inst:y}),d(function(){l(y)&&v({inst:y})})},[d]),i(p),p}function l(d){var h=d.getSnapshot;d=d.value;try{var p=h();return!n(d,p)}catch{return!0}}function c(d,h){return h()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return Li.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,Li}var yu;function s_(){return yu||(yu=1,Di.exports=o_()),Di.exports}var i_=s_(),zr='[cmdk-group=""]',Bi='[cmdk-group-items=""]',a_='[cmdk-group-heading=""]',Wl='[cmdk-item=""]',vu=`${Wl}:not([aria-disabled="true"])`,Oa="cmdk-item-select",un="data-value",l_=(t,e,n)=>F0(t,e,n),Ip=m.createContext(void 0),_o=()=>m.useContext(Ip),jp=m.createContext(void 0),Gl=()=>m.useContext(jp),$p=m.createContext(void 0),Np=m.forwardRef((t,e)=>{let n=Xn(()=>{var E,P;return{search:"",value:(P=(E=t.value)!=null?E:t.defaultValue)!=null?P:"",filtered:{count:0,items:new Map,groups:new Set}}}),r=Xn(()=>new Set),o=Xn(()=>new Map),s=Xn(()=>new Map),i=Xn(()=>new Set),a=Mp(t),{label:l,children:c,value:u,onValueChange:d,filter:h,shouldFilter:p,loop:g,disablePointerSelection:y=!1,vimBindings:v=!0,...w}=t,x=ft(),b=ft(),_=ft(),S=m.useRef(null),k=w_();xn(()=>{if(u!==void 0){let E=u.trim();n.current.value=E,C.emit()}},[u]),xn(()=>{k(6,oe)},[]);let C=m.useMemo(()=>({subscribe:E=>(i.current.add(E),()=>i.current.delete(E)),snapshot:()=>n.current,setState:(E,P,R)=>{var T,I,A;if(!Object.is(n.current[E],P)){if(n.current[E]=P,E==="search")j(),L(),k(1,J);else if(E==="value"&&(R||k(5,oe),((T=a.current)==null?void 0:T.value)!==void 0)){let z=P??"";(A=(I=a.current).onValueChange)==null||A.call(I,z);return}C.emit()}},emit:()=>{i.current.forEach(E=>E())}}),[]),M=m.useMemo(()=>({value:(E,P,R)=>{var T;P!==((T=s.current.get(E))==null?void 0:T.value)&&(s.current.set(E,{value:P,keywords:R}),n.current.filtered.items.set(E,X(P,R)),k(2,()=>{L(),C.emit()}))},item:(E,P)=>(r.current.add(E),P&&(o.current.has(P)?o.current.get(P).add(E):o.current.set(P,new Set([E]))),k(3,()=>{j(),L(),n.current.value||J(),C.emit()}),()=>{s.current.delete(E),r.current.delete(E),n.current.filtered.items.delete(E);let R=B();k(4,()=>{j(),R?.getAttribute("id")===E&&J(),C.emit()})}),group:E=>(o.current.has(E)||o.current.set(E,new Set),()=>{s.current.delete(E),o.current.delete(E)}),filter:()=>a.current.shouldFilter,label:l||t["aria-label"],getDisablePointerSelection:()=>a.current.disablePointerSelection,listId:x,inputId:_,labelId:b,listInnerRef:S}),[]);function X(E,P){var R,T;let I=(T=(R=a.current)==null?void 0:R.filter)!=null?T:l_;return E?I(E,n.current.search,P):0}function L(){if(!n.current.search||a.current.shouldFilter===!1)return;let E=n.current.filtered.items,P=[];n.current.filtered.groups.forEach(T=>{let I=o.current.get(T),A=0;I.forEach(z=>{let re=E.get(z);A=Math.max(re,A)}),P.push([T,A])});let R=S.current;Y().sort((T,I)=>{var A,z;let re=T.getAttribute("id"),ue=I.getAttribute("id");return((A=E.get(ue))!=null?A:0)-((z=E.get(re))!=null?z:0)}).forEach(T=>{let I=T.closest(Bi);I?I.appendChild(T.parentElement===I?T:T.closest(`${Bi} > *`)):R.appendChild(T.parentElement===R?T:T.closest(`${Bi} > *`))}),P.sort((T,I)=>I[1]-T[1]).forEach(T=>{var I;let A=(I=S.current)==null?void 0:I.querySelector(`${zr}[${un}="${encodeURIComponent(T[0])}"]`);A?.parentElement.appendChild(A)})}function J(){let E=Y().find(R=>R.getAttribute("aria-disabled")!=="true"),P=E?.getAttribute(un);C.setState("value",P||void 0)}function j(){var E,P,R,T;if(!n.current.search||a.current.shouldFilter===!1){n.current.filtered.count=r.current.size;return}n.current.filtered.groups=new Set;let I=0;for(let A of r.current){let z=(P=(E=s.current.get(A))==null?void 0:E.value)!=null?P:"",re=(T=(R=s.current.get(A))==null?void 0:R.keywords)!=null?T:[],ue=X(z,re);n.current.filtered.items.set(A,ue),ue>0&&I++}for(let[A,z]of o.current)for(let re of z)if(n.current.filtered.items.get(re)>0){n.current.filtered.groups.add(A);break}n.current.filtered.count=I}function oe(){var E,P,R;let T=B();T&&(((E=T.parentElement)==null?void 0:E.firstChild)===T&&((R=(P=T.closest(zr))==null?void 0:P.querySelector(a_))==null||R.scrollIntoView({block:"nearest"})),T.scrollIntoView({block:"nearest"}))}function B(){var E;return(E=S.current)==null?void 0:E.querySelector(`${Wl}[aria-selected="true"]`)}function Y(){var E;return Array.from(((E=S.current)==null?void 0:E.querySelectorAll(vu))||[])}function K(E){let P=Y()[E];P&&C.setState("value",P.getAttribute(un))}function ie(E){var P;let R=B(),T=Y(),I=T.findIndex(z=>z===R),A=T[I+E];(P=a.current)!=null&&P.loop&&(A=I+E<0?T[T.length-1]:I+E===T.length?T[0]:T[I+E]),A&&C.setState("value",A.getAttribute(un))}function F(E){let P=B(),R=P?.closest(zr),T;for(;R&&!T;)R=E>0?y_(R,zr):v_(R,zr),T=R?.querySelector(vu);T?C.setState("value",T.getAttribute(un)):ie(E)}let ae=()=>K(Y().length-1),ve=E=>{E.preventDefault(),E.metaKey?ae():E.altKey?F(1):ie(1)},pe=E=>{E.preventDefault(),E.metaKey?K(0):E.altKey?F(-1):ie(-1)};return m.createElement(be.div,{ref:e,tabIndex:-1,...w,"cmdk-root":"",onKeyDown:E=>{var P;if((P=w.onKeyDown)==null||P.call(w,E),!E.defaultPrevented)switch(E.key){case"n":case"j":{v&&E.ctrlKey&&ve(E);break}case"ArrowDown":{ve(E);break}case"p":case"k":{v&&E.ctrlKey&&pe(E);break}case"ArrowUp":{pe(E);break}case"Home":{E.preventDefault(),K(0);break}case"End":{E.preventDefault(),ae();break}case"Enter":if(!E.nativeEvent.isComposing&&E.keyCode!==229){E.preventDefault();let R=B();if(R){let T=new Event(Oa);R.dispatchEvent(T)}}}}},m.createElement("label",{"cmdk-label":"",htmlFor:M.inputId,id:M.labelId,style:x_},l),Xs(t,E=>m.createElement(jp.Provider,{value:C},m.createElement(Ip.Provider,{value:M},E))))}),c_=m.forwardRef((t,e)=>{var n,r;let o=ft(),s=m.useRef(null),i=m.useContext($p),a=_o(),l=Mp(t),c=(r=(n=l.current)==null?void 0:n.forceMount)!=null?r:i?.forceMount;xn(()=>{if(!c)return a.item(o,i?.id)},[c]);let u=zp(o,s,[t.value,t.children,s],t.keywords),d=Gl(),h=_n(k=>k.value&&k.value===u.current),p=_n(k=>c||a.filter()===!1?!0:k.search?k.filtered.items.get(o)>0:!0);m.useEffect(()=>{let k=s.current;if(!(!k||t.disabled))return k.addEventListener(Oa,g),()=>k.removeEventListener(Oa,g)},[p,t.onSelect,t.disabled]);function g(){var k,C;y(),(C=(k=l.current).onSelect)==null||C.call(k,u.current)}function y(){d.setState("value",u.current,!0)}if(!p)return null;let{disabled:v,value:w,onSelect:x,forceMount:b,keywords:_,...S}=t;return m.createElement(be.div,{ref:co([s,e]),...S,id:o,"cmdk-item":"",role:"option","aria-disabled":!!v,"aria-selected":!!h,"data-disabled":!!v,"data-selected":!!h,onPointerMove:v||a.getDisablePointerSelection()?void 0:y,onClick:v?void 0:g},t.children)}),u_=m.forwardRef((t,e)=>{let{heading:n,children:r,forceMount:o,...s}=t,i=ft(),a=m.useRef(null),l=m.useRef(null),c=ft(),u=_o(),d=_n(p=>o||u.filter()===!1?!0:p.search?p.filtered.groups.has(i):!0);xn(()=>u.group(i),[]),zp(i,a,[t.value,t.heading,l]);let h=m.useMemo(()=>({id:i,forceMount:o}),[o]);return m.createElement(be.div,{ref:co([a,e]),...s,"cmdk-group":"",role:"presentation",hidden:d?void 0:!0},n&&m.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:c},n),Xs(t,p=>m.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?c:void 0},m.createElement($p.Provider,{value:h},p))))}),d_=m.forwardRef((t,e)=>{let{alwaysRender:n,...r}=t,o=m.useRef(null),s=_n(i=>!i.search);return!n&&!s?null:m.createElement(be.div,{ref:co([o,e]),...r,"cmdk-separator":"",role:"separator"})}),h_=m.forwardRef((t,e)=>{let{onValueChange:n,...r}=t,o=t.value!=null,s=Gl(),i=_n(u=>u.search),a=_n(u=>u.value),l=_o(),c=m.useMemo(()=>{var u;let d=(u=l.listInnerRef.current)==null?void 0:u.querySelector(`${Wl}[${un}="${encodeURIComponent(a)}"]`);return d?.getAttribute("id")},[]);return m.useEffect(()=>{t.value!=null&&s.setState("search",t.value)},[t.value]),m.createElement(be.input,{ref:e,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":c,id:l.inputId,type:"text",value:o?t.value:i,onChange:u=>{o||s.setState("search",u.target.value),n?.(u.target.value)}})}),f_=m.forwardRef((t,e)=>{let{children:n,label:r="Suggestions",...o}=t,s=m.useRef(null),i=m.useRef(null),a=_o();return m.useEffect(()=>{if(i.current&&s.current){let l=i.current,c=s.current,u,d=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let h=l.offsetHeight;c.style.setProperty("--cmdk-list-height",h.toFixed(1)+"px")})});return d.observe(l),()=>{cancelAnimationFrame(u),d.unobserve(l)}}},[]),m.createElement(be.div,{ref:co([s,e]),...o,"cmdk-list":"",role:"listbox","aria-label":r,id:a.listId},Xs(t,l=>m.createElement("div",{ref:co([i,a.listInnerRef]),"cmdk-list-sizer":""},l)))}),p_=m.forwardRef((t,e)=>{let{open:n,onOpenChange:r,overlayClassName:o,contentClassName:s,container:i,...a}=t;return m.createElement(e_,{open:n,onOpenChange:r},m.createElement(t_,{container:i},m.createElement(n_,{"cmdk-overlay":"",className:o}),m.createElement(r_,{"aria-label":t.label,"cmdk-dialog":"",className:s},m.createElement(Np,{ref:e,...a}))))}),m_=m.forwardRef((t,e)=>_n(n=>n.filtered.count===0)?m.createElement(be.div,{ref:e,...t,"cmdk-empty":"",role:"presentation"}):null),g_=m.forwardRef((t,e)=>{let{progress:n,children:r,label:o="Loading...",...s}=t;return m.createElement(be.div,{ref:e,...s,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},Xs(t,i=>m.createElement("div",{"aria-hidden":!0},i)))}),We=Object.assign(Np,{List:f_,Item:c_,Input:h_,Group:u_,Separator:d_,Dialog:p_,Empty:m_,Loading:g_});function y_(t,e){let n=t.nextElementSibling;for(;n;){if(n.matches(e))return n;n=n.nextElementSibling}}function v_(t,e){let n=t.previousElementSibling;for(;n;){if(n.matches(e))return n;n=n.previousElementSibling}}function Mp(t){let e=m.useRef(t);return xn(()=>{e.current=t}),e}var xn=typeof window>"u"?m.useEffect:m.useLayoutEffect;function Xn(t){let e=m.useRef();return e.current===void 0&&(e.current=t()),e}function co(t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}function _n(t){let e=Gl(),n=()=>t(e.snapshot());return i_.useSyncExternalStore(e.subscribe,n,n)}function zp(t,e,n,r=[]){let o=m.useRef(),s=_o();return xn(()=>{var i;let a=(()=>{var c;for(let u of n){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(c=u.current.textContent)==null?void 0:c.trim():o.current}})(),l=r.map(c=>c.trim());s.value(t,a,l),(i=e.current)==null||i.setAttribute(un,a),o.current=a}),o}var w_=()=>{let[t,e]=m.useState(),n=Xn(()=>new Map);return xn(()=>{n.current.forEach(r=>r()),n.current=new Map},[t]),(r,o)=>{n.current.set(r,o),e({})}};function b_(t){let e=t.type;return typeof e=="function"?e(t.props):"render"in e?e.render(t.props):t}function Xs({asChild:t,children:e},n){return t&&m.isValidElement(e)?m.cloneElement(b_(e),{ref:e.ref},n(e.props.children)):n(e)}var x_={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Dp=m.forwardRef(({className:t,...e},n)=>f.jsx(We,{ref:n,className:Te("flex h-full w-full flex-col overflow-hidden bg-metallicBlue text-popover-foreground",t),...e}));Dp.displayName=We.displayName;const Lp=m.forwardRef(({className:t,...e},n)=>f.jsxs("div",{className:"flex items-center border-b px-1 pb-1","cmdk-input-wrapper":"",children:[f.jsx("span",{className:"sprite mr-1 texture-hud_char_gt"}),f.jsx(We.Input,{ref:n,className:Te("flex h-1 w-full bg-pastelBlue py-1 outline-none placeholder:text-shadow disabled:cursor-not-allowed",t),...e})]}));Lp.displayName=We.Input.displayName;const Bp=m.forwardRef(({className:t,...e},n)=>f.jsx(We.List,{ref:n,className:Te("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...e}));Bp.displayName=We.List.displayName;const Fp=m.forwardRef((t,e)=>f.jsx(We.Empty,{ref:e,className:"pl-1",...t}));Fp.displayName=We.Empty.displayName;const Up=m.forwardRef(({className:t,...e},n)=>f.jsx(We.Group,{ref:n,className:Te("overflow-hidden",t),...e}));Up.displayName=We.Group.displayName;const __=m.forwardRef(({className:t,...e},n)=>f.jsx(We.Separator,{ref:n,className:Te("-mx-1 h-px bg-shadow",t),...e}));__.displayName=We.Separator.displayName;const Js=m.forwardRef(({className:t,...e},n)=>f.jsx(We.Item,{ref:n,className:Te("relative flex cursor-default select-none items-center text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-midRed hover:bg-pastelBlue data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...e}));Js.displayName=We.Item.displayName;function Pt(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t?.(o),n===!1||!o.defaultPrevented)return e?.(o)}}function wu(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Hp(...t){return e=>{let n=!1;const r=t.map(o=>{const s=wu(o,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let o=0;o<r.length;o++){const s=r[o];typeof s=="function"?s():wu(t[o],null)}}}}function Rn(...t){return m.useCallback(Hp(...t),t)}function Wp(t,e=[]){let n=[];function r(s,i){const a=m.createContext(i),l=n.length;n=[...n,i];const c=d=>{const{scope:h,children:p,...g}=d,y=h?.[t]?.[l]||a,v=m.useMemo(()=>g,Object.values(g));return f.jsx(y.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(d,h){const p=h?.[t]?.[l]||a,g=m.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=n.map(i=>m.createContext(i));return function(a){const l=a?.[t]||s;return m.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[r,C_(o,...e)]}function C_(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}function S_(t){const e=k_(t),n=m.forwardRef((r,o)=>{const{children:s,...i}=r,a=m.Children.toArray(s),l=a.find(E_);if(l){const c=l.props.children,u=a.map(d=>d===l?m.Children.count(c)>1?m.Children.only(null):m.isValidElement(c)?c.props.children:null:d);return f.jsx(e,{...i,ref:o,children:m.isValidElement(c)?m.cloneElement(c,void 0,u):null})}return f.jsx(e,{...i,ref:o,children:s})});return n.displayName=`${t}.Slot`,n}function k_(t){const e=m.forwardRef((n,r)=>{const{children:o,...s}=n;if(m.isValidElement(o)){const i=A_(o),a=T_(s,o.props);return o.type!==m.Fragment&&(a.ref=r?Hp(r,i):i),m.cloneElement(o,a)}return m.Children.count(o)>1?m.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Gp=Symbol("radix.slottable");function P_(t){const e=({children:n})=>f.jsx(f.Fragment,{children:n});return e.displayName=`${t}.Slottable`,e.__radixId=Gp,e}function E_(t){return m.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Gp}function T_(t,e){const n={...e};for(const r in e){const o=t[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{const l=s(...a);return o(...a),l}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...t,...n}}function A_(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var R_=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],tn=R_.reduce((t,e)=>{const n=S_(`Primitive.${e}`),r=m.forwardRef((o,s)=>{const{asChild:i,...a}=o,l=i?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),f.jsx(l,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function O_(t,e){t&&Us.flushSync(()=>t.dispatchEvent(e))}function Ys(t){const e=m.useRef(t);return m.useEffect(()=>{e.current=t}),m.useMemo(()=>(...n)=>e.current?.(...n),[])}function I_(t,e=globalThis?.document){const n=Ys(t);m.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var j_="DismissableLayer",Ia="dismissableLayer.update",$_="dismissableLayer.pointerDownOutside",N_="dismissableLayer.focusOutside",bu,qp=m.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Vp=m.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=m.useContext(qp),[u,d]=m.useState(null),h=u?.ownerDocument??globalThis?.document,[,p]=m.useState({}),g=Rn(e,C=>d(C)),y=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),w=y.indexOf(v),x=u?y.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,_=x>=w,S=D_(C=>{const M=C.target,X=[...c.branches].some(L=>L.contains(M));!_||X||(o?.(C),i?.(C),C.defaultPrevented||a?.())},h),k=L_(C=>{const M=C.target;[...c.branches].some(L=>L.contains(M))||(s?.(C),i?.(C),C.defaultPrevented||a?.())},h);return I_(C=>{x===c.layers.size-1&&(r?.(C),!C.defaultPrevented&&a&&(C.preventDefault(),a()))},h),m.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(bu=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),xu(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=bu)}},[u,h,n,c]),m.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),xu())},[u,c]),m.useEffect(()=>{const C=()=>p({});return document.addEventListener(Ia,C),()=>document.removeEventListener(Ia,C)},[]),f.jsx(tn.div,{...l,ref:g,style:{pointerEvents:b?_?"auto":"none":void 0,...t.style},onFocusCapture:Pt(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Pt(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Pt(t.onPointerDownCapture,S.onPointerDownCapture)})});Vp.displayName=j_;var M_="DismissableLayerBranch",z_=m.forwardRef((t,e)=>{const n=m.useContext(qp),r=m.useRef(null),o=Rn(e,r);return m.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),f.jsx(tn.div,{...t,ref:o})});z_.displayName=M_;function D_(t,e=globalThis?.document){const n=Ys(t),r=m.useRef(!1),o=m.useRef(()=>{});return m.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){Kp($_,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function L_(t,e=globalThis?.document){const n=Ys(t),r=m.useRef(!1);return m.useEffect(()=>{const o=s=>{s.target&&!r.current&&Kp(N_,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function xu(){const t=new CustomEvent(Ia);document.dispatchEvent(t)}function Kp(t,e,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),r?O_(o,s):o.dispatchEvent(s)}var Qt=globalThis?.document?m.useLayoutEffect:()=>{},B_=Ns[" useId ".trim().toString()]||(()=>{}),F_=0;function U_(t){const[e,n]=m.useState(B_());return Qt(()=>{n(r=>r??String(F_++))},[t]),e?`radix-${e}`:""}var H_="Arrow",Xp=m.forwardRef((t,e)=>{const{children:n,width:r=10,height:o=5,...s}=t;return f.jsx(tn.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:f.jsx("polygon",{points:"0,0 30,0 15,10"})})});Xp.displayName=H_;var W_=Xp;function G_(t){const[e,n]=m.useState(void 0);return Qt(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var ql="Popper",[Jp,Yp]=Wp(ql),[q_,Zp]=Jp(ql),Qp=t=>{const{__scopePopper:e,children:n}=t,[r,o]=m.useState(null);return f.jsx(q_,{scope:e,anchor:r,onAnchorChange:o,children:n})};Qp.displayName=ql;var em="PopperAnchor",tm=m.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,s=Zp(em,n),i=m.useRef(null),a=Rn(e,i);return m.useEffect(()=>{s.onAnchorChange(r?.current||i.current)}),r?null:f.jsx(tn.div,{...o,ref:a})});tm.displayName=em;var Vl="PopperContent",[V_,K_]=Jp(Vl),nm=m.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:g,...y}=t,v=Zp(Vl,n),[w,x]=m.useState(null),b=Rn(e,A=>x(A)),[_,S]=m.useState(null),k=G_(_),C=k?.width??0,M=k?.height??0,X=r+(s!=="center"?"-"+s:""),L=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},J=Array.isArray(c)?c:[c],j=J.length>0,oe={padding:L,boundary:J.filter(J_),altBoundary:j},{refs:B,floatingStyles:Y,placement:K,isPositioned:ie,middlewareData:F}=Af({strategy:"fixed",placement:X,whileElementsMounted:(...A)=>Ef(...A,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[Rf({mainAxis:o+M,alignmentAxis:i}),l&&Of({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?If():void 0,...oe}),l&&jf({...oe}),$f({...oe,apply:({elements:A,rects:z,availableWidth:re,availableHeight:ue})=>{const{width:Ne,height:Me}=z.reference,ce=A.floating.style;ce.setProperty("--radix-popper-available-width",`${re}px`),ce.setProperty("--radix-popper-available-height",`${ue}px`),ce.setProperty("--radix-popper-anchor-width",`${Ne}px`),ce.setProperty("--radix-popper-anchor-height",`${Me}px`)}}),_&&Mf({element:_,padding:a}),Y_({arrowWidth:C,arrowHeight:M}),h&&Nf({strategy:"referenceHidden",...oe})]}),[ae,ve]=sm(K),pe=Ys(g);Qt(()=>{ie&&pe?.()},[ie,pe]);const E=F.arrow?.x,P=F.arrow?.y,R=F.arrow?.centerOffset!==0,[T,I]=m.useState();return Qt(()=>{w&&I(window.getComputedStyle(w).zIndex)},[w]),f.jsx("div",{ref:B.setFloating,"data-radix-popper-content-wrapper":"",style:{...Y,transform:ie?Y.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:T,"--radix-popper-transform-origin":[F.transformOrigin?.x,F.transformOrigin?.y].join(" "),...F.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:f.jsx(V_,{scope:n,placedSide:ae,onArrowChange:S,arrowX:E,arrowY:P,shouldHideArrow:R,children:f.jsx(tn.div,{"data-side":ae,"data-align":ve,...y,ref:b,style:{...y.style,animation:ie?void 0:"none"}})})})});nm.displayName=Vl;var rm="PopperArrow",X_={top:"bottom",right:"left",bottom:"top",left:"right"},om=m.forwardRef(function(e,n){const{__scopePopper:r,...o}=e,s=K_(rm,r),i=X_[s.placedSide];return f.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:f.jsx(W_,{...o,ref:n,style:{...o.style,display:"block"}})})});om.displayName=rm;function J_(t){return t!==null}var Y_=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=sm(n),d={start:"0%",center:"50%",end:"100%"}[u],h=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let g="",y="";return c==="bottom"?(g=i?d:`${h}px`,y=`${-l}px`):c==="top"?(g=i?d:`${h}px`,y=`${r.floating.height+l}px`):c==="right"?(g=`${-l}px`,y=i?d:`${p}px`):c==="left"&&(g=`${r.floating.width+l}px`,y=i?d:`${p}px`),{data:{x:g,y}}}});function sm(t){const[e,n="center"]=t.split("-");return[e,n]}var Z_=Qp,Q_=tm,eC=nm,tC=om,nC="Portal",im=m.forwardRef((t,e)=>{const{container:n,...r}=t,[o,s]=m.useState(!1);Qt(()=>s(!0),[]);const i=n||o&&globalThis?.document?.body;return i?ff.createPortal(f.jsx(tn.div,{...r,ref:e}),i):null});im.displayName=nC;function rC(t,e){return m.useReducer((n,r)=>e[n][r]??n,t)}var Kl=t=>{const{present:e,children:n}=t,r=oC(e),o=typeof n=="function"?n({present:r.isPresent}):m.Children.only(n),s=Rn(r.ref,sC(o));return typeof n=="function"||r.isPresent?m.cloneElement(o,{ref:s}):null};Kl.displayName="Presence";function oC(t){const[e,n]=m.useState(),r=m.useRef(null),o=m.useRef(t),s=m.useRef("none"),i=t?"mounted":"unmounted",[a,l]=rC(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return m.useEffect(()=>{const c=Go(r.current);s.current=a==="mounted"?c:"none"},[a]),Qt(()=>{const c=r.current,u=o.current;if(u!==t){const h=s.current,p=Go(c);t?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&h!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),Qt(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const y=Go(r.current).includes(p.animationName);if(p.target===e&&y&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},h=p=>{p.target===e&&(s.current=Go(r.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:m.useCallback(c=>{r.current=c?getComputedStyle(c):null,n(c)},[])}}function Go(t){return t?.animationName||"none"}function sC(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var iC=Ns[" useInsertionEffect ".trim().toString()]||Qt;function aC({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[o,s,i]=lC({defaultProp:e,onChange:n}),a=t!==void 0,l=a?t:o;{const u=m.useRef(t!==void 0);m.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,r])}const c=m.useCallback(u=>{if(a){const d=cC(u)?u(t):u;d!==t&&i.current?.(d)}else s(u)},[a,t,s,i]);return[l,c]}function lC({defaultProp:t,onChange:e}){const[n,r]=m.useState(t),o=m.useRef(n),s=m.useRef(e);return iC(()=>{s.current=e},[e]),m.useEffect(()=>{o.current!==n&&(s.current?.(n),o.current=n)},[n,o]),[n,r,s]}function cC(t){return typeof t=="function"}var uC=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),dC="VisuallyHidden",am=m.forwardRef((t,e)=>f.jsx(tn.span,{...t,ref:e,style:{...uC,...t.style}}));am.displayName=dC;var hC=am,[Zs,SR]=Wp("Tooltip",[Yp]),Qs=Yp(),lm="TooltipProvider",fC=700,ja="tooltip.open",[pC,Xl]=Zs(lm),cm=t=>{const{__scopeTooltip:e,delayDuration:n=fC,skipDelayDuration:r=300,disableHoverableContent:o=!1,children:s}=t,i=m.useRef(!0),a=m.useRef(!1),l=m.useRef(0);return m.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),f.jsx(pC,{scope:e,isOpenDelayedRef:i,delayDuration:n,onOpen:m.useCallback(()=>{window.clearTimeout(l.current),i.current=!1},[]),onClose:m.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.current=!0,r)},[r]),isPointerInTransitRef:a,onPointerInTransitChange:m.useCallback(c=>{a.current=c},[]),disableHoverableContent:o,children:s})};cm.displayName=lm;var uo="Tooltip",[mC,Co]=Zs(uo),um=t=>{const{__scopeTooltip:e,children:n,open:r,defaultOpen:o,onOpenChange:s,disableHoverableContent:i,delayDuration:a}=t,l=Xl(uo,t.__scopeTooltip),c=Qs(e),[u,d]=m.useState(null),h=U_(),p=m.useRef(0),g=i??l.disableHoverableContent,y=a??l.delayDuration,v=m.useRef(!1),[w,x]=aC({prop:r,defaultProp:o??!1,onChange:C=>{C?(l.onOpen(),document.dispatchEvent(new CustomEvent(ja))):l.onClose(),s?.(C)},caller:uo}),b=m.useMemo(()=>w?v.current?"delayed-open":"instant-open":"closed",[w]),_=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,v.current=!1,x(!0)},[x]),S=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,x(!1)},[x]),k=m.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{v.current=!0,x(!0),p.current=0},y)},[y,x]);return m.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),f.jsx(Z_,{...c,children:f.jsx(mC,{scope:e,contentId:h,open:w,stateAttribute:b,trigger:u,onTriggerChange:d,onTriggerEnter:m.useCallback(()=>{l.isOpenDelayedRef.current?k():_()},[l.isOpenDelayedRef,k,_]),onTriggerLeave:m.useCallback(()=>{g?S():(window.clearTimeout(p.current),p.current=0)},[S,g]),onOpen:_,onClose:S,disableHoverableContent:g,children:n})})};um.displayName=uo;var $a="TooltipTrigger",dm=m.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=Co($a,n),s=Xl($a,n),i=Qs(n),a=m.useRef(null),l=Rn(e,a,o.onTriggerChange),c=m.useRef(!1),u=m.useRef(!1),d=m.useCallback(()=>c.current=!1,[]);return m.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),f.jsx(Q_,{asChild:!0,...i,children:f.jsx(tn.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...r,ref:l,onPointerMove:Pt(t.onPointerMove,h=>{h.pointerType!=="touch"&&!u.current&&!s.isPointerInTransitRef.current&&(o.onTriggerEnter(),u.current=!0)}),onPointerLeave:Pt(t.onPointerLeave,()=>{o.onTriggerLeave(),u.current=!1}),onPointerDown:Pt(t.onPointerDown,()=>{o.open&&o.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:Pt(t.onFocus,()=>{c.current||o.onOpen()}),onBlur:Pt(t.onBlur,o.onClose),onClick:Pt(t.onClick,o.onClose)})})});dm.displayName=$a;var Jl="TooltipPortal",[gC,yC]=Zs(Jl,{forceMount:void 0}),hm=t=>{const{__scopeTooltip:e,forceMount:n,children:r,container:o}=t,s=Co(Jl,e);return f.jsx(gC,{scope:e,forceMount:n,children:f.jsx(Kl,{present:n||s.open,children:f.jsx(im,{asChild:!0,container:o,children:r})})})};hm.displayName=Jl;var gr="TooltipContent",fm=m.forwardRef((t,e)=>{const n=yC(gr,t.__scopeTooltip),{forceMount:r=n.forceMount,side:o="top",...s}=t,i=Co(gr,t.__scopeTooltip);return f.jsx(Kl,{present:r||i.open,children:i.disableHoverableContent?f.jsx(pm,{side:o,...s,ref:e}):f.jsx(vC,{side:o,...s,ref:e})})}),vC=m.forwardRef((t,e)=>{const n=Co(gr,t.__scopeTooltip),r=Xl(gr,t.__scopeTooltip),o=m.useRef(null),s=Rn(e,o),[i,a]=m.useState(null),{trigger:l,onClose:c}=n,u=o.current,{onPointerInTransitChange:d}=r,h=m.useCallback(()=>{a(null),d(!1)},[d]),p=m.useCallback((g,y)=>{const v=g.currentTarget,w={x:g.clientX,y:g.clientY},x=CC(w,v.getBoundingClientRect()),b=SC(w,x),_=kC(y.getBoundingClientRect()),S=EC([...b,..._]);a(S),d(!0)},[d]);return m.useEffect(()=>()=>h(),[h]),m.useEffect(()=>{if(l&&u){const g=v=>p(v,u),y=v=>p(v,l);return l.addEventListener("pointerleave",g),u.addEventListener("pointerleave",y),()=>{l.removeEventListener("pointerleave",g),u.removeEventListener("pointerleave",y)}}},[l,u,p,h]),m.useEffect(()=>{if(i){const g=y=>{const v=y.target,w={x:y.clientX,y:y.clientY},x=l?.contains(v)||u?.contains(v),b=!PC(w,i);x?h():b&&(h(),c())};return document.addEventListener("pointermove",g),()=>document.removeEventListener("pointermove",g)}},[l,u,i,c,h]),f.jsx(pm,{...t,ref:s})}),[wC,bC]=Zs(uo,{isInside:!1}),xC=P_("TooltipContent"),pm=m.forwardRef((t,e)=>{const{__scopeTooltip:n,children:r,"aria-label":o,onEscapeKeyDown:s,onPointerDownOutside:i,...a}=t,l=Co(gr,n),c=Qs(n),{onClose:u}=l;return m.useEffect(()=>(document.addEventListener(ja,u),()=>document.removeEventListener(ja,u)),[u]),m.useEffect(()=>{if(l.trigger){const d=h=>{h.target?.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),f.jsx(Vp,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:f.jsxs(eC,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[f.jsx(xC,{children:r}),f.jsx(wC,{scope:n,isInside:!0,children:f.jsx(hC,{id:l.contentId,role:"tooltip",children:o||r})})]})})});fm.displayName=gr;var mm="TooltipArrow",_C=m.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=Qs(n);return bC(mm,n).isInside?null:f.jsx(tC,{...o,...r,ref:e})});_C.displayName=mm;function CC(t,e){const n=Math.abs(e.top-t.y),r=Math.abs(e.bottom-t.y),o=Math.abs(e.right-t.x),s=Math.abs(e.left-t.x);switch(Math.min(n,r,o,s)){case s:return"left";case o:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function SC(t,e,n=5){const r=[];switch(e){case"top":r.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":r.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":r.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":r.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return r}function kC(t){const{top:e,right:n,bottom:r,left:o}=t;return[{x:o,y:e},{x:n,y:e},{x:n,y:r},{x:o,y:r}]}function PC(t,e){const{x:n,y:r}=t;let o=!1;for(let s=0,i=e.length-1;s<e.length;i=s++){const a=e[s],l=e[i],c=a.x,u=a.y,d=l.x,h=l.y;u>r!=h>r&&n<(d-c)*(r-u)/(h-u)+c&&(o=!o)}return o}function EC(t){const e=t.slice();return e.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),TC(e)}function TC(t){if(t.length<=1)return t.slice();const e=[];for(let r=0;r<t.length;r++){const o=t[r];for(;e.length>=2;){const s=e[e.length-1],i=e[e.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))e.pop();else break}e.push(o)}e.pop();const n=[];for(let r=t.length-1;r>=0;r--){const o=t[r];for(;n.length>=2;){const s=n[n.length-1],i=n[n.length-2];if((s.x-i.x)*(o.y-i.y)>=(s.y-i.y)*(o.x-i.x))n.pop();else break}n.push(o)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}var AC=cm,RC=um;const OC={"":m.Fragment,pre:"pre",code:"code",ol:"ol",ul:"ul",hr:"hr",blockquote:"blockquote",li:"li",a:"a",img:"img",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",p:"p",em:"em",strong:"strong"},_u=t=>t.replace(RegExp("^"+(t.match(/^(\t| )+/)||"")[0],"gm"),""),IC=t=>t&&typeof t!="string"&&["div","ul","ol","pre","h1","h2","h3","h4","h5","h6"].includes(t.t),Fi=t=>t.replace(/^\s+|\s+$/g," "),xe=(t,e=[],n={})=>({t,c:Array.isArray(e)?e:[e],p:n}),Wr=(t,e=!1)=>{let n=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,r=0;const o=xe("");let s,i;e?(s=xe("p"),i=[o,s],o.c.push(s)):(s=o,i=[o]);let a;const l=(d,h=!0)=>(h&&i.push(d),s.c.push(d),h&&(s=d),d),c=d=>{const h=i.findIndex(p=>p.t===d);i=i.slice(0,h),s=i.at(-1)};for(;a=n.exec(t);){const d=t.substring(r,a.index);if(r=n.lastIndex,d!=="")if(s===o&&e){const h=xe("p",Fi(d));o.c.push(h),i=[o,h],s=h}else s.c.push(Fi(d));if(!d.match(/[^\\](\\\\)*\\$/)){if(a[3]||a[4]){const h=xe("pre",a[4]?_u(a[4]):xe("code",_u(a[3]),a[2]?{language:`language-${a[2].toLowerCase()}`}:{}));o.c.push(h),i=[o],s=o}else if(a[6]){const h=a[6],p=h!==">",g=!!h.match(/\./),y=p?g?"ol":"ul":"blockquote",v=a[5].split(`
`).map(x=>x.replace(/^(\*|-|\+|>|\d+\.)\s+/,"")).filter(x=>x.trim()!==""),w=xe(y,p?v.map(x=>xe("li",Wr(x).c)):Wr(v.join(`
`)).c);o.c.push(w),i=[o,w],s=o}else if(a[8]){const h=xe("img",[],{src:a[8],...a[7]?{alt:a[7]}:{}});if(e&&s===o){const p=xe("p",h);o.c.push(p),s=p,i=[o,p]}else l(h,!1)}else if(a[10]){const h=i.find(p=>p.t==="a");h&&(h.p.href=a[11])}else if(a[9])l(xe("a"));else if(a[14]){const h="h"+a[14].length;o.c.push(xe(h,Wr(a[15]).c)),i=[o],s=o}else if(a[13])o.c.push(xe("h1",Wr(a[12]).c)),i=[o],s=o;else if(a[16])l(xe("code",a[16]),!1);else if(a[17]?.[0]===`
`||a[17]===`  
`){if(!(i[1]?.t==="p")){const g=o.c;let y;for(y=g.length-1;y>=0&&!IC(g[y]);y--);if(y!==o.c.length-1){const v=o.c.splice(y+1);o.c.push(xe("p",v))}}const p=xe("p");o.c.push(p),i=[o,p],s=p}else if(a[1])o.c.push(xe("hr")),i=[o],s=o;else if(a[17]){const h=a[17].length===2?"strong":"em";i.findIndex(g=>g.t===h)===-1?l(xe(h)):c(h)}}}const u=Fi(t.substring(r));if(u.length){const d=o.c.at(-1);let h;d?.t==="p"?h=d:e?(h=xe("p"),o.c.push(h)):h=o,h.c.push(u)}return o.c=o.c.filter(d=>typeof d=="string"||d.t!=="p"||d.c?.length>0),o},jC=(t,e={})=>{const n={...OC,...e},r=(o,s=0)=>{const i=o.t===""?m.Fragment:n[o.t];return m.createElement(i,{...o.p,key:s},o.c.length===0?void 0:o.c.map((a,l)=>typeof a=="string"?a:r(a,l)))};return r(Wr(t,!0))},$C=({markdown:t,customComponents:e})=>jC(t,e),qo="leading-none [&_[class*='texture-hud']]:mb-oneScaledPix",NC={h2:function({children:e}){return f.jsx("h2",{className:`mb-1 sprites-double-height text-metallicBlue zx:text-zxBlue clear-both ${qo}`,children:f.jsx(nt,{children:e})})},h3:function({children:e}){return f.jsx("h3",{className:"mt-1 mb-1 text-metallicBlue zx:text-zxBlue clear-both",children:f.jsx(nt,{children:e})})},blockquote:function({children:e}){return f.jsx("blockquote",{className:`${qo} mt-1 mb-1 text-moss zx:text-zxBlue clear-both`,children:f.jsxs(nt,{children:["> ",e]})})},p:function({children:e}){return f.jsx("div",{className:`mb-1 last:mb-0 ${qo}`,children:f.jsx(nt,{children:e})})},a:function({children:e,href:n}){return f.jsx("a",{className:"bitmap-text-link",href:n,target:"_blank",rel:"noopener noreferrer",children:f.jsx(nt,{children:e})})},li:function({children:e}){return f.jsx("div",{className:`mb-1 clear-both ${qo}`,children:f.jsxs(nt,{children:[f.jsx(O,{className:"text-metallicBlue zx:text-zxYellow",children:""}),e]})})},strong:function({children:e}){return f.jsx(nt,{className:"strong text-midRed zx:text-zxRed",children:e})},em:function({children:e}){return f.jsx(nt,{className:"em text-moss zx:text-zxBlue",children:e})},img:function({src:e}){const n=gh();if(e===void 0)throw new Error("image without src");const r=e.split(/\?|&/);return f.jsx("span",{style:{"--scale":n*2},children:f.jsx("span",{className:Sl("sprite float-left mr-1 mb-1 zx:sprite-revert-to-two-tone",r.join(" "))})})},hr:function(){return f.jsx("hr",{className:"bg-metallicBlue zx:bg-zxWhite h-half mb-half border-none"})}},MC=({markdown:t,className:e})=>f.jsx("div",{className:`contents ${e}`,children:f.jsx($C,{customComponents:NC,markdown:t})}),Yl=({triggerContent:t,tooltipContent:e})=>e?f.jsxs(RC,{children:[f.jsx(dm,{asChild:!0,children:t}),f.jsx(hm,{children:f.jsx(Ks,{scaleFactor:2,children:f.jsx(fm,{side:"bottom",align:"end",className:"bg-highlightBeige text-white p-1 mt-oneScaledPix drop-shadow-oneBlock z-popups",children:typeof e=="string"?f.jsx("div",{className:"max-w-16",children:f.jsx(MC,{markdown:e})}):e})})})]}):t,zC=/^(?<modifiers>[^]*)(?<key>.+)$/,DC=t=>{const e=new Set;for(const n of t){if(e.has(n))return!0;e.add(n)}return!1},Zl=(t,e,n)=>{const r=t?.join(" ");m.useEffect(()=>{if(!t||t.length===0)return;const o=s=>{if(s.target.closest(".monaco-editor")===null)for(const l of t){const c=l.match(zC);if(!c||!c.groups)continue;const{modifiers:u,key:d}=c.groups;if(DC(u)){console.warn(`Invalid shortcut "${l}": duplicate modifiers`);continue}const h=u.includes("^"),p=u.includes(""),g=u.includes(""),y=u.includes(""),v=h||p||g||y,w=h===s.ctrlKey&&p===s.metaKey&&g===s.shiftKey&&y===s.altKey&&(v||!s.ctrlKey&&!s.metaKey&&!s.shiftKey&&!s.altKey);if((y&&s.altKey?s.code.replace(/^Key/,"").toLowerCase():s.key.toLowerCase())===d.toLowerCase()&&w){e||n?.(),s.preventDefault();break}}};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e,n,r])},gm=t=>t.replace(/ArrowLeft/g,"").replace(/ArrowRight/g,"").replace(/ArrowUp/g,"").replace(/ArrowDown/g,""),LC=t=>{const e=t.map(gm);return e.length===1?`

Hotkey: **${e[0]}**`:`

Hotkeys: ${e.map(n=>`**${n}**`).join(" or ")}`},Ql=(t,e)=>{if(!e)return t;if(t)return`${t}${LC(e)}`;const n=e.map(gm);return n.length===1?`Hotkey: **${n[0]}**`:`Hotkeys: ${n.map(r=>`**${r}**`).join(" or ")}`},ur=({className:t,selected:e,disabled:n=!1,onClick:r,ref:o,tooltipContent:s,shortcutKeys:i,...a})=>{Zl(i,n,r);const l=f.jsx("button",{disabled:n,onClick:r,"data-selected":e,className:Te(`inline-flex items-center justify-center whitespace-nowrap 
          bg-metallicBlue zx:bg-zxBlue border-none border-shadow
          gap-2
           disabled:bg-midGrey disabled:text-lightGrey 
           data-[selected=true]:bg-lightBeige
           [&:not(:disabled):hover:not([data-selected=true])]:bg-pastelBlue 
           `,t),ref:o,...a}),c=Ql(typeof s=="string"?s:void 0,i)??s;return f.jsx(Yl,{triggerContent:l,tooltipContent:c})};var Cu=!1,dn,Na,Ma,ls,cs,ym,us,za,Da,La,vm,Ba,Fa,wm,bm;function De(){if(!Cu){Cu=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),n=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(Ba=/\b(iPhone|iP[ao]d)/.exec(t),Fa=/\b(iP[ao]d)/.exec(t),La=/Android/i.exec(t),wm=/FBAN\/\w+;/i.exec(t),bm=/Mobile/i.exec(t),vm=!!/Win64/.exec(t),e){dn=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN,dn&&document&&document.documentMode&&(dn=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(t);ym=r?parseFloat(r[1])+4:dn,Na=e[2]?parseFloat(e[2]):NaN,Ma=e[3]?parseFloat(e[3]):NaN,ls=e[4]?parseFloat(e[4]):NaN,ls?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),cs=e&&e[1]?parseFloat(e[1]):NaN):cs=NaN}else dn=Na=Ma=cs=ls=NaN;if(n){if(n[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);us=o?parseFloat(o[1].replace("_",".")):!0}else us=!1;za=!!n[2],Da=!!n[3]}else us=za=Da=!1}}var Ua={ie:function(){return De()||dn},ieCompatibilityMode:function(){return De()||ym>dn},ie64:function(){return Ua.ie()&&vm},firefox:function(){return De()||Na},opera:function(){return De()||Ma},webkit:function(){return De()||ls},safari:function(){return Ua.webkit()},chrome:function(){return De()||cs},windows:function(){return De()||za},osx:function(){return De()||us},linux:function(){return De()||Da},iphone:function(){return De()||Ba},mobile:function(){return De()||Ba||Fa||La||bm},nativeApp:function(){return De()||wm},android:function(){return De()||La},ipad:function(){return De()||Fa}},BC=Ua,FC=!!(typeof window<"u"&&window.document&&window.document.createElement),UC={canUseDOM:FC},xm=UC,_m;xm.canUseDOM&&(_m=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);function HC(t,e){if(!xm.canUseDOM||e&&!("addEventListener"in document))return!1;var n="on"+t,r=n in document;if(!r){var o=document.createElement("div");o.setAttribute(n,"return;"),r=typeof o[n]=="function"}return!r&&_m&&t==="wheel"&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var WC=HC,Su=10,ku=40,Pu=800;function Cm(t){var e=0,n=0,r=0,o=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*Su,o=n*Su,"deltaY"in t&&(o=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||o)&&t.deltaMode&&(t.deltaMode==1?(r*=ku,o*=ku):(r*=Pu,o*=Pu)),r&&!e&&(e=r<1?-1:1),o&&!n&&(n=o<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:o}}Cm.getEventType=function(){return BC.firefox()?"DOMMouseScroll":WC("wheel")?"wheel":"mousewheel"};var GC=Cm;/**
* Checks if an event is supported in the current execution environment.
*
* NOTE: This will not work correctly for non-generic events such as `change`,
* `reset`, `load`, `error`, and `select`.
*
* Borrows from Modernizr.
*
* @param {string} eventNameSuffix Event name, e.g. "click".
* @param {?boolean} capture Check if the capture phase is supported.
* @return {boolean} True if the event is supported.
* @internal
* @license Modernizr 3.0.0pre (Custom Build) | MIT
*/const qC=(t,e,n=!1)=>{const r=m.useRef(0),o=m.useCallback(s=>{if(n)return;const i=s;i.preventDefault(),i.stopPropagation();const a=GC(i);r.current-=a.spinY,r.current>=1&&(e(1),r.current=0),r.current<=-1&&(e(-1),r.current=0)},[e,n]);m.useEffect(()=>{const s=t.current;if(s!==null)return s.addEventListener("wheel",o,{passive:!1}),()=>{s.removeEventListener("wheel",o)}},[t,o])},Sm=(t,e,n,r=!1)=>{const o=m.useRef(0);return qC(t,s=>{if(e.length===0)return;const i=(o.current+s+256*e.length)%e.length;o.current=i,n(e[i],i)},r)},VC=({value:t,onSelect:e})=>f.jsx(Js,{value:t,onSelect:e,className:"px-1",children:f.jsx(O,{children:t})}),ei=t=>{const{value:e,values:n,onSelect:r,triggerButtonClassName:o="",triggerButtonStyle:s=fe,triggerButtonLabel:i="",OptionCommandItem:a=VC,tooltipContent:l}=t,[c,u]=m.useState(!1),d=m.useRef(null);return Sm(d,n,h=>{r(h)},!c),f.jsxs(gp,{open:c,onOpenChange:u,children:[f.jsx(yp,{asChild:!0,children:f.jsxs(ur,{className:Te("h-2 px-1 flex flex-row gap-1 justify-start leading-none",o),style:s,ref:d,tooltipContent:!c&&l,children:[typeof i=="string"?f.jsx(O,{className:"grow overflow-hidden text-left",children:i}):i,f.jsx(O,{className:"grow-0",children:c?"X":""})]})}),f.jsx(vp,{className:"p-0",children:f.jsx(Ks,{scaleFactor:2,children:f.jsxs(Dp,{value:e,className:"w-[--radix-popper-anchor-width]",children:[t.disableCommandInput===!0?null:f.jsx(Lp,{placeholder:t.placeholder}),f.jsxs(Bp,{children:[f.jsx(Fp,{children:f.jsx(O,{children:"Nothing found"})}),f.jsx(Up,{children:n.map(h=>f.jsx(a,{value:h,onSelect:p=>{u(!1),r(p)}},h))})]})]})})})]})},KC=()=>{const t=He(),e=yh();return f.jsx(f.Fragment,{children:f.jsx(ei,{value:e,values:vy,onSelect:n=>{t(wy(n))},disableCommandInput:!0,triggerButtonLabel:e,triggerButtonClassName:"w-13"})})};var Ui={exports:{}},Eu;function XC(){if(Eu)return Ui.exports;Eu=1;/*
 * @version    1.4.0
 * @date       2015-10-26
 * @stability  3 - Stable
 * @author     Lauri Rooden (https://github.com/litejs/natural-compare-lite)
 * @license    MIT License
 */var t=function(e,n){var r,o,s=1,i=0,a=0,l=String.alphabet;function c(u,d,h){if(h){for(r=d;h=c(u,r),h<76&&h>65;)++r;return+u.slice(d-1,r)}return h=l&&l.indexOf(u.charAt(d)),h>-1?h+76:(h=u.charCodeAt(d)||0,h<45||h>127?h:h<46?65:h<48?h-1:h<58?h+18:h<65?h-11:h<91?h+11:h<97?h-37:h<123?h+5:h-63)}if((e+="")!=(n+="")){for(;s;)if(o=c(e,i++),s=c(n,a++),o<76&&s<76&&o>66&&s>66&&(o=c(e,i,i),s=c(n,a,i=r),a=r),o!=s)return o<s?-1:1}return 0};try{Ui.exports=t}catch{String.naturalCompare=t}return Ui.exports}var JC=XC();const YC=yt(JC);function km({campaign:t,onSelect:e,headRoomId:n,heelsRoomId:r,value:o,triggerButtonClassName:s,excludeRoomIds:i=[],tooltipContent:a}){const l=Object.keys(t.rooms).filter(c=>!i.includes(c)).sort(YC);return f.jsx(ei,{onSelect:c=>e?.(c),value:o,values:l,triggerButtonClassName:s,placeholder:"search",tooltipContent:a,disableCommandInput:!1,triggerButtonLabel:o??"none",OptionCommandItem:({value:c,onSelect:u})=>f.jsxs(Js,{value:c,onSelect:u,className:"px-1",children:[n===c&&f.jsx("span",{className:"sprite mr-1 my-1 texture-head_walking_towards_2"}),r===c&&f.jsx("span",{className:"sprite mr-1 my-1 texture-heels_walking_towards_2"}),f.jsx(O,{children:c})]})})}const ye=t=>t,Pm="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",ZC="h-[calc(2*var(--block)-1px*var(--scale))] w-[calc(2*var(--block)-1px*var(--scale))]",U=ye("[button:not([data-selected=true]):not(:hover)_&]:sprite-revert-to-two-tone-dim"),Ae=ye("flex flex-wrap gap-oneScaledPix w-full"),ee=({className:t,onClick:e,children:n,disabled:r=!1,isCurrentTool:o=!1,shortcutKeys:s,small:i=!1,tooltipContent:a})=>f.jsx(ur,{disabled:r,selected:o,className:`
        ${i?ZC:Pm} 
        ${i?"leading-none":""} 
        active:pt-oneScaledPix gap-0 inline-flex overflow-hidden 
        
        ${t??""}`,onClick:e,tooltipContent:a,shortcutKeys:s,children:n}),QC=()=>{const t=ge(e=>e.levelEditor.selectedJsonItemIds.length>0);return f.jsx(ee,{className:"bg-midRed",disabled:!t,onClick:()=>W.dispatch(Yy()),shortcutKeys:["Delete","Backspace"],tooltipContent:`## Delete items
delete selected item(s)`,children:f.jsx("span",{className:"sprite sprite-tinted texture-hud_char_X relative"})})},yr=({className:t,value:e,onChange:n,trueLabel:r="ON",falseLabel:o="OFF",label:s,shortcutKeys:i,tooltipContent:a})=>{const l=Math.max(r.length,o.length)+1,c=r.padStart(l," "),u=o.padEnd(l," ");Zl(i,!1,()=>{n?.(!e,void 0)});const d=f.jsxs("span",{onClick:p=>n?.(!e,p),className:Te("inline-flex justify-between",t),children:[s&&f.jsx(O,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),f.jsx(O,{className:Ll("inline-block w-min h-min",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:e?c:u})]}),h=Ql(typeof a=="string"?a:void 0,i)??a;return f.jsx(Yl,{triggerContent:d,tooltipContent:h})},eS=({className:t,value:e,onChange:n,values:r,valueLabels:o=[`${r[0]}`,`${r[1]}`,`${r[2]}`],label:s,shortcutKeys:i,tooltipContent:a})=>{const l=r.indexOf(e),c=Math.max(o[0].length,o[1].length+2,o[2].length)+1,u=m.useCallback(()=>{const p=(l+1)%3;n?.(r[p],void 0)},[n,l,r]);Zl(i,!1,()=>{u()});const d=f.jsxs("span",{onClick:u,className:Te("inline-flex justify-between",t),children:[s&&f.jsx(O,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),f.jsx(O,{className:Ll("inline-block w-min h-min",l===0?"bg-redShadowHalfbrite text-highlightBeige zx:bg-zxBlack zx:text-zxGreen":l===1?"bg-metallicBlueHalfbrite text-pastelBlue zx:bg-zxBlack zx:text-zxBlue":"bg-pinkHalfbrite text-pink zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:l===0?o[0].padEnd(c," "):l===1?o[1].padStart(Math.ceil((c+o[1].length)/2)," ").padEnd(c," "):o[2].padStart(c," ")})]}),h=Ql(typeof a=="string"?a:void 0,i)??a;return f.jsx(Yl,{triggerContent:d,tooltipContent:h})},tS=({className:t})=>{const e=He();return f.jsx(eS,{className:t,label:"snap",values:Zy,value:ge(n=>n.levelEditor.gridResolution),onChange:n=>{e(Qy(n))},valueLabels:["block","half","fine"],shortcutKeys:["S"],tooltipContent:`snaps to either the grid (like the original game)

or, on a half-block grid

or to a fine 2px resolution`})},Em=t=>{const e=ge(pn);return Ge(e?.type==="item"&&e.item,t)},$=({itemTool:t,children:e,className:n,shortcutKeys:r,tooltipContent:o})=>{const s=Em(t);return f.jsx(ee,{isCurrentTool:s,className:n,onClick:()=>W.dispatch(Tn({type:"item",item:t})),shortcutKeys:r,tooltipContent:o,children:e})},ec=({main:t,children:e,closeOnSelect:n,ref:r})=>{const[o,s]=m.useState(!1);return f.jsxs(gp,{open:o,onOpenChange:s,children:[f.jsx("div",{ref:r,className:Te(Pm,"relative",{"drop-shadow-oneBlock z-popups":o}),children:f.jsxs("span",{className:"content",children:[t,f.jsx(yp,{asChild:!0,children:f.jsx(ur,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:f.jsx(O,{className:"pl-oneScaledPix leading-none py-oneScaledPix",children:o?"X":""})})})]})}),f.jsx(vp,{children:f.jsx(Ks,{scaleFactor:2,children:f.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:e.map((i,a)=>i===null?null:f.jsx("div",{className:"leading-none",onClick:()=>{n&&s(!1)},children:i},a))})})})]})},Dr=({children:t})=>{const[e,n]=m.useState(0),r=m.useRef(null);Sm(r,t,(s,i)=>{n(i)});const o=t[e];return f.jsx(ec,{main:o,closeOnSelect:!0,ref:r,children:t.map((s,i)=>i===e?null:f.jsx("div",{className:"leading-none",onClick:()=>{n(i)},children:s===null?null:m.cloneElement(s,{onClick(){n(i),s.props.onClick?.()}})},i))})},nS=()=>{const e=ge(pn)?.type==="pointer";return f.jsx(ee,{onClick:()=>W.dispatch(Tn({type:"pointer"})),isCurrentTool:e,shortcutKeys:["Escape","."],tooltipContent:"## Pointer",children:f.jsx("span",{className:"sprite texture-editor_tool_pointer relative"})})},N={pureBlack:new H("#000000"),shadow:new H("#325149"),midGrey:new H("#7F7773"),lightGrey:new H("#BBB1AB"),white:new H("#FBFEFB"),pastelBlue:new H("#75ACFF"),metallicBlue:new H("#366CAA"),pink:new H("#D68ED1"),moss:new H("#9E9600"),redShadow:new H("#805E50"),midRed:new H("#CA7463"),lightBeige:new H("#DAA78F"),highlightBeige:new H("#EBC690"),alpha:new H("#1E7790"),replaceLight:new H("#08A086"),replaceDark:new H("#0A4730")},Qr=.4,Tm=t=>{const[e,n,r]=t.toUint8RgbArray();return new H({r:e*.75,g:n*.75,b:r*.75})},vr=(t,e=Qr)=>{const[n,r,o]=t.toUint8RgbArray();return new H({r:n*e,g:r*e,b:o*e})};function kR(t){t=t.replace(/^#/,"");let e=parseInt(t.substring(0,2),16),n=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16);e=Math.floor(e*Qr),n=Math.floor(n*Qr),r=Math.floor(r*Qr);const o=s=>s.toString(16).padStart(2,"0");return`#${o(e)}${o(n)}${o(r)}`}const Qe={original:new H(Sr.zxWhite),basic:N.white,dimmed:N.lightGrey},et={original:new H(Sr.zxYellow),basic:new H(15654246),dimmed:vr(new H(15654246),.5)},Am={original:new H(Sr.zxYellow),basic:N.midRed,dimmed:N.redShadow},ct={original:new H(Sr.zxMagenta),basic:N.pink,dimmed:vr(N.pink,.5)},_e={original:new H(Sr.zxCyan),basic:N.pastelBlue,dimmed:vr(N.pastelBlue,.5)},ut={original:new H(Sr.zxGreen),basic:N.moss,dimmed:vr(N.moss,.5)},ti={white:{basic:{main:Qe,edges:{towards:{..._e,dimInOriginal:!1},right:{...et,dimInOriginal:!0}},hud:{lives:et,dimmed:ct,icons:_e}},dimmed:{main:Qe,edges:{towards:{...ut,dimInOriginal:!1},right:{..._e,dimInOriginal:!0}},hud:{lives:Am,dimmed:ct,icons:_e}}},yellow:{basic:{main:et,edges:{towards:{...ut,dimInOriginal:!1},right:{...Qe,dimInOriginal:!0}},hud:{lives:_e,dimmed:ct,icons:ut}},dimmed:{main:et,edges:{towards:{..._e,dimInOriginal:!0},right:{..._e,dimInOriginal:!1}},hud:{lives:_e,dimmed:ct,icons:ut}}},magenta:{basic:{main:ct,edges:{towards:{...ut,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Qe,dimmed:_e,icons:et}},dimmed:{main:ct,edges:{towards:{...ut,dimInOriginal:!0},right:{..._e,dimInOriginal:!0}},hud:{lives:Qe,dimmed:_e,icons:et}}},cyan:{basic:{main:_e,edges:{towards:{...ct,dimInOriginal:!1},right:{...Qe,dimInOriginal:!1}},hud:{lives:Qe,dimmed:ut,icons:et}},dimmed:{main:_e,edges:{towards:{...ct,dimInOriginal:!0},right:{...Qe,dimInOriginal:!0}},hud:{lives:Qe,dimmed:ut,icons:et}}},green:{basic:{main:ut,edges:{towards:{..._e,dimInOriginal:!1},right:{...et,dimInOriginal:!1}},hud:{lives:Qe,dimmed:ct,icons:_e}},dimmed:{main:ut,edges:{towards:{..._e,dimInOriginal:!0},right:{...et,dimInOriginal:!0}},hud:{lives:Qe,dimmed:ct,icons:_e}}}},Ps=t=>ti[t.hue][t.shade],tr={head:"pastelBlue",heels:"pink"},Tu=t=>{const{main:e}=ti[t].basic;return{backgroundColor:e.basic.toHex(),borderColor:e.dimmed.toHex()}};function rS(){const t=He(),e=ge(ev);return f.jsxs(f.Fragment,{children:[f.jsx(ei,{value:e.hue,onSelect:n=>{t(yc({hue:n}))},values:by,disableCommandInput:!0,OptionCommandItem:({value:n,onSelect:r})=>f.jsx(Js,{value:n,className:"border-l-3 h-2 w-full p-0",style:Tu(n),onSelect:r}),triggerButtonLabel:"colour",triggerButtonClassName:Te("w-full",`${e.hue==="white"||e.hue==="yellow"?"text-pureBlack":"text-white"}`),triggerButtonStyle:Tu(e.hue),tooltipContent:"Change the colour of this room"}),f.jsx(yr,{className:"",label:"shade",value:e.shade==="basic",onChange:n=>{t(yc({shade:n?"basic":"dimmed"}))},falseLabel:"dim",trueLabel:"basic"})]})}function oS(){const t=He(),e=ge(tv);return f.jsx(ei,{value:e,onSelect:n=>{t(nv(n))},values:xy,placeholder:"scenery",triggerButtonClassName:"w-full",triggerButtonLabel:e,tooltipContent:"Change this rooms scenery"})}const _t=({iconClasses:t,text:e,className:n=""})=>f.jsxs("div",{className:`relative w-full h-full ${n}`,children:[f.jsx("span",{className:`sprite absolute top-0 left-0 ${t} ${U}`}),f.jsx(O,{className:"bg-moss text-pureBlack absolute top-0 left-0 pl-oneScaledPix py-oneScaledPix block leading-none",children:e})]}),Vo=({iconClassName:t})=>f.jsx(Ct,{topClasses:ye("texture-bubbles_white_2 [button:hover_&]:texture-animated-bubbles_white"),bottomClasses:t}),Ct=({topClasses:t,bottomClasses:e="texture-headlessBase"})=>f.jsxs("div",{className:"relative w-full h-full",children:[f.jsx("span",{className:`sprite absolute top-[calc(9px*var(--scale))] left-0 ${e} ${U}`}),f.jsx("span",{className:`sprite absolute top-[calc(-3px*var(--scale))] left-0 ${t} ${U}`})]}),sS="[button:not(:disabled):hover_&]:hidden",iS="hidden [button:not(:disabled):hover_&]:inline mt-quarter",aS="hidden [button:not(:disabled):hover_&]:inline",Ha=({icon:t,topText:e,bottomText:n})=>f.jsxs("span",{className:"w-full h-full flex flex-col items-center justify-center",children:[f.jsx("span",{className:sS,children:t}),f.jsx(O,{className:iS,children:e}),f.jsx(O,{className:aS,children:n})]}),lS=()=>{const t=He(),e=ge(rv),n=ge(ov);return f.jsxs("div",{className:"flex flex-row gap-oneScaledPix bg-metallicBlue",children:[f.jsx(ee,{disabled:!e,onClick:()=>{t(sv())},shortcutKeys:["Z","^Z"],children:f.jsx(Ha,{icon:f.jsx(O,{children:""}),topText:"un",bottomText:"do"})}),f.jsx(ee,{disabled:!n,onClick:()=>{t(iv())},shortcutKeys:["Z","^Z"],children:f.jsx(Ha,{icon:f.jsx(O,{children:""}),topText:"re",bottomText:"do"})})]})},cS=({className:t})=>{const e=He();return f.jsx(yr,{className:t,label:"scenery",value:ge(n=>n.levelEditor.wallsFloorsLocked),onChange:n=>{e(av(n))},falseLabel:"edit",trueLabel:"lock",shortcutKeys:["C"],tooltipContent:"locks walls and floors, to edit their contents"})};function Au(t){return{type:"door",config:{direction:"away",toRoom:t?"+":"nowhere"}}}const uS=()=>{const[t,e]=m.useState(!0),n=ge(i=>Bs(i).planet),r=ye(n==="moonbase"?"texture-door_frame_moonbase_x_whole":"texture-door_frame_generic_x_whole"),o=Au(t),s=Em(o);return f.jsx(ec,{main:f.jsx($,{itemTool:o,shortcutKeys:["D"],children:f.jsx(_t,{iconClasses:`sprite top-[calc(-17px*var(--scale))] left-[calc(-2px*var(--scale))] ${r} ${U}`,text:t?"+":""})}),children:[f.jsx(yr,{className:"w-full",value:t,label:"auto + room",onChange:i=>{e(i),s&&W.dispatch(Tn({type:"item",item:Au(i)}))}},"autoAddDoor")]})},dS=()=>{const t=ge(r=>Bs(r).planet),e={type:"wall",config:{direction:"away",tiles:Array.from(lv(t,1))}},n=ye(t==="blacktooth"?"texture-blacktooth_wall_plain_away":t==="bookworld"?"texture-bookworld_wall_cowboy_away":t==="jail"?"texture-jail_wall_bars_away":t==="egyptus"?"texture-egyptus_wall_hieroglyphics_away":t==="market"?"texture-market_wall_passage_away":t==="moonbase"?"texture-moonbase_wall_window1_away":t==="penitentiary"?"texture-penitentiary_wall_loop_away":"texture-safari_wall_wall_away");return f.jsx($,{itemTool:e,children:f.jsx("span",{className:`sprite ${n} ${U}`})})},hS=()=>f.jsx(ee,{className:"bg-midRed",onClick:()=>W.dispatch(cv()),tooltipContent:`## Clear room

Clears the room out, leaving just walls, floors, and doors`,children:f.jsx(O,{className:"relative leading-none",children:"CLR"})}),Rm=({currentRoomId:t,direction:e})=>{const n=ge(({levelEditor:i})=>i.campaignInProgress),r=ge(({levelEditor:i})=>i.currentlyEditingRoomId),o=He(),s=e==="above"?"":"";return f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap pt-1 items-center",children:[f.jsxs(O,{className:"text-lightGrey leading-none h-1",children:["Room ",s]}),f.jsx("div",{className:"flex-grow"}),f.jsxs("div",{className:"flex flex-row gap-oneScaledPix",children:[f.jsx(ee,{small:!0,className:"bg-highlightBeige w-max px-half",tooltipContent:`Switch to the room *${e}*`,disabled:!t,children:f.jsx(O,{onClick:()=>t&&o(io(t)),children:`go ${s}`})}),f.jsx(ee,{small:!0,className:" bg-moss",tooltipContent:`Add a new room *${e}* this one`,children:f.jsx(O,{onClick:()=>o(gi({direction:e,createNew:!0})),children:"+"})}),f.jsx(ee,{small:!0,className:"bg-midRed",tooltipContent:`Break the link with the room *${e}*`,children:f.jsx(O,{onClick:()=>o(gi({direction:e,createNew:!1,roomId:void 0})),children:"x"})})]})]}),f.jsx("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap",children:f.jsx(km,{value:t,campaign:n,excludeRoomIds:[r],triggerButtonClassName:"w-full",onSelect:i=>{o(gi({direction:e,createNew:!1,roomId:i}))},tooltipContent:`Select a room to place *${e}* this one`})})]})},fS=()=>{const t=ge(({levelEditor:e})=>vl(e).roomAbove);return f.jsx(f.Fragment,{children:f.jsx(Rm,{currentRoomId:t,direction:"above"})})},pS=()=>{const t=ge(({levelEditor:e})=>vl(e).roomBelow);return f.jsx(f.Fragment,{children:f.jsx(Rm,{currentRoomId:t,direction:"below"})})},mS=()=>{const t=ge(({levelEditor:e})=>e.tool.type==="eyeDropper");return f.jsx(ee,{shortcutKeys:["I",","],isCurrentTool:t,onClick:()=>W.dispatch(Tn({type:"eyeDropper"})),tooltipContent:`## eye-dropper

click on an item in the room to copy it and put a copy down somewhere else`,children:f.jsx("span",{className:"relative sprite texture-editor_tool_eyedropper leading-none"})})},ni=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const gS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Gr=Array.prototype.slice.call(gS),Ko=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(Gr),yS=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ds=String.fromCharCode.bind(String),Ru=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),vS=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),Om=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),wS=t=>{let e,n,r,o,s="";const i=t.length%3;for(let a=0;a<t.length;){if((n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(o=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|o,s+=Gr[e>>18&63]+Gr[e>>12&63]+Gr[e>>6&63]+Gr[e&63]}return i?s.slice(0,i-3)+"===".substring(i):s},bS=typeof btoa=="function"?t=>btoa(t):ni?t=>Buffer.from(t,"binary").toString("base64"):wS,Ou=ni?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let r=0,o=t.length;r<o;r+=4096)n.push(ds.apply(null,t.subarray(r,r+4096)));return bS(n.join(""))},xS=(t,e=!1)=>e?vS(Ou(t)):Ou(t),_S=t=>{if(t=t.replace(/\s+/g,""),!yS.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,o;for(let s=0;s<t.length;)e=Ko[t.charAt(s++)]<<18|Ko[t.charAt(s++)]<<12|(r=Ko[t.charAt(s++)])<<6|(o=Ko[t.charAt(s++)]),n+=r===64?ds(e>>16&255):o===64?ds(e>>16&255,e>>8&255):ds(e>>16&255,e>>8&255,e&255);return n},CS=typeof atob=="function"?t=>atob(Om(t)):ni?t=>Buffer.from(t,"base64").toString("binary"):_S,SS=ni?t=>Ru(Buffer.from(t,"base64")):t=>Ru(CS(t).split("").map(e=>e.charCodeAt(0))),kS=t=>SS(PS(t)),PS=t=>Om(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),ES=!0,Im="gzip",jm=async t=>{const e=JSON.stringify(t),r=new TextEncoder().encode(e),o=new Blob([r]),s=new CompressionStream(Im),i=o.stream().pipeThrough(s),a=await new Response(i).arrayBuffer(),l=new Uint8Array(a);return xS(l,ES)},TS=async t=>{try{const e=kS(t),n=new Blob([e]),r=new DecompressionStream(Im),o=n.stream().pipeThrough(r),s=await new Response(o).text();return JSON.parse(s)}catch(e){throw new Error("error decompressing object",{cause:e})}},AS=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Gt(async()=>{const{default:r}=await Promise.resolve().then(()=>Rr);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)};class tc extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class RS extends tc{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Iu extends tc{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ju extends tc{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Wa;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Wa||(Wa={}));var OS=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class IS{constructor(e,{headers:n={},customFetch:r,region:o=Wa.Any}={}){this.url=e,this.headers=n,this.region=o,this.fetch=AS(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,n={}){var r;return OS(this,void 0,void 0,function*(){try{const{headers:o,method:s,body:i}=n;let a={},{region:l}=n;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(a["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:u}).catch(y=>{throw new RS(y)}),h=d.headers.get("x-relay-error");if(h&&h==="true")throw new Iu(d);if(!d.ok)throw new ju(d);let p=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return p==="application/json"?g=yield d.json():p==="application/octet-stream"?g=yield d.blob():p==="text/event-stream"?g=d:p==="multipart/form-data"?g=yield d.formData():g=yield d.text(),{data:g,error:null,response:d}}catch(o){return{data:null,error:o,response:o instanceof ju||o instanceof Iu?o.context:void 0}}})}}var Ce={},Mn={},zn={},Dn={},Ln={},Bn={},jS=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},wr=jS();const $S=wr.fetch,$m=wr.fetch.bind(wr),Nm=wr.Headers,NS=wr.Request,MS=wr.Response,Rr=Object.freeze(Object.defineProperty({__proto__:null,Headers:Nm,Request:NS,Response:MS,default:$m,fetch:$S},Symbol.toStringTag,{value:"Module"})),zS=_y(Rr);var Xo={},$u;function Mm(){if($u)return Xo;$u=1,Object.defineProperty(Xo,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return Xo.default=t,Xo}var Nu;function zm(){if(Nu)return Bn;Nu=1;var t=Bn&&Bn.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Bn,"__esModule",{value:!0});const e=t(zS),n=t(Mm());class r{constructor(s){this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=s.headers,this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=s.shouldThrowOnError,this.signal=s.signal,this.isMaybeSingle=s.isMaybeSingle,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=Object.assign({},this.headers),this.headers[s]=i,this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,h;let p=null,g=null,y=null,v=c.status,w=c.statusText;if(c.ok){if(this.method!=="HEAD"){const S=await c.text();S===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=S:g=JSON.parse(S))}const b=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),_=(d=c.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");b&&_&&_.length>1&&(y=parseInt(_[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(p={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,y=null,v=406,w="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const b=await c.text();try{p=JSON.parse(b),Array.isArray(p)&&c.status===404&&(g=[],p=null,v=200,w="OK")}catch{c.status===404&&b===""?(v=204,w="No Content"):p={message:b}}if(p&&this.isMaybeSingle&&(!((h=p?.details)===null||h===void 0)&&h.includes("0 rows"))&&(p=null,v=200,w="OK"),p&&this.shouldThrowOnError)throw new n.default(p)}return{error:p,data:g,count:y,status:v,statusText:w}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,h;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(d=c?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(h=c?.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,i)}returns(){return this}overrideTypes(){return this}}return Bn.default=r,Bn}var Mu;function Dm(){if(Mu)return Ln;Mu=1;var t=Ln&&Ln.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ln,"__esModule",{value:!0});const e=t(zm());class n extends e.default{select(o){let s=!1;const i=(o??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(o,{ascending:s=!0,nullsFirst:i,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${o}.${s?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:s,referencedTable:i=s}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${o}`),this}range(o,s,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${o}`),this.url.searchParams.set(c,`${s-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:o=!1,verbose:s=!1,settings:i=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[o?"analyze":null,s?"verbose":null,i?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),h=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${h}"; options=${d};`,c==="json"?this:this}rollback(){var o;return((o=this.headers.Prefer)!==null&&o!==void 0?o:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Ln.default=n,Ln}var zu;function nc(){if(zu)return Dn;zu=1;var t=Dn&&Dn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Dn,"__esModule",{value:!0});const e=t(Dm());class n extends e.default{eq(o,s){return this.url.searchParams.append(o,`eq.${s}`),this}neq(o,s){return this.url.searchParams.append(o,`neq.${s}`),this}gt(o,s){return this.url.searchParams.append(o,`gt.${s}`),this}gte(o,s){return this.url.searchParams.append(o,`gte.${s}`),this}lt(o,s){return this.url.searchParams.append(o,`lt.${s}`),this}lte(o,s){return this.url.searchParams.append(o,`lte.${s}`),this}like(o,s){return this.url.searchParams.append(o,`like.${s}`),this}likeAllOf(o,s){return this.url.searchParams.append(o,`like(all).{${s.join(",")}}`),this}likeAnyOf(o,s){return this.url.searchParams.append(o,`like(any).{${s.join(",")}}`),this}ilike(o,s){return this.url.searchParams.append(o,`ilike.${s}`),this}ilikeAllOf(o,s){return this.url.searchParams.append(o,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(o,s){return this.url.searchParams.append(o,`ilike(any).{${s.join(",")}}`),this}is(o,s){return this.url.searchParams.append(o,`is.${s}`),this}in(o,s){const i=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(o,`in.(${i})`),this}contains(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cs.{${s.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(s)}`),this}containedBy(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cd.{${s.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(s)}`),this}rangeGt(o,s){return this.url.searchParams.append(o,`sr.${s}`),this}rangeGte(o,s){return this.url.searchParams.append(o,`nxl.${s}`),this}rangeLt(o,s){return this.url.searchParams.append(o,`sl.${s}`),this}rangeLte(o,s){return this.url.searchParams.append(o,`nxr.${s}`),this}rangeAdjacent(o,s){return this.url.searchParams.append(o,`adj.${s}`),this}overlaps(o,s){return typeof s=="string"?this.url.searchParams.append(o,`ov.${s}`):this.url.searchParams.append(o,`ov.{${s.join(",")}}`),this}textSearch(o,s,{config:i,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=i===void 0?"":`(${i})`;return this.url.searchParams.append(o,`${l}fts${c}.${s}`),this}match(o){return Object.entries(o).forEach(([s,i])=>{this.url.searchParams.append(s,`eq.${i}`)}),this}not(o,s,i){return this.url.searchParams.append(o,`not.${s}.${i}`),this}or(o,{foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${o})`),this}filter(o,s,i){return this.url.searchParams.append(o,`${s}.${i}`),this}}return Dn.default=n,Dn}var Du;function Lm(){if(Du)return zn;Du=1;var t=zn&&zn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(zn,"__esModule",{value:!0});const e=t(nc());class n{constructor(o,{headers:s={},schema:i,fetch:a}){this.url=o,this.headers=s,this.schema=i,this.fetch=a}select(o,{head:s=!1,count:i}={}){const a=s?"HEAD":"GET";let l=!1;const c=(o??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),i&&(this.headers.Prefer=`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(o,{count:s,defaultToNull:i=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(o)){const c=o.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}upsert(o,{onConflict:s,ignoreDuplicates:i=!1,count:a,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${i?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(o)){const d=o.reduce((h,p)=>h.concat(Object.keys(p)),[]);if(d.length>0){const h=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}update(o,{count:s}={}){const i="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}delete({count:o}={}){const s="DELETE",i=[];return o&&i.push(`count=${o}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return zn.default=n,zn}var Lr={},Br={},Lu;function DS(){return Lu||(Lu=1,Object.defineProperty(Br,"__esModule",{value:!0}),Br.version=void 0,Br.version="0.0.0-automated"),Br}var Bu;function LS(){if(Bu)return Lr;Bu=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.DEFAULT_HEADERS=void 0;const t=DS();return Lr.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${t.version}`},Lr}var Fu;function BS(){if(Fu)return Mn;Fu=1;var t=Mn&&Mn.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Mn,"__esModule",{value:!0});const e=t(Lm()),n=t(nc()),r=LS();class o{constructor(i,{headers:a={},schema:l,fetch:c}={}){this.url=i,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new o(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:l=!1,get:c=!1,count:u}={}){let d;const h=new URL(`${this.url}/rpc/${i}`);let p;l||c?(d=l?"HEAD":"GET",Object.entries(a).filter(([y,v])=>v!==void 0).map(([y,v])=>[y,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([y,v])=>{h.searchParams.append(y,v)})):(d="POST",p=a);const g=Object.assign({},this.headers);return u&&(g.Prefer=`count=${u}`),new n.default({method:d,url:h,headers:g,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return Mn.default=o,Mn}var Uu;function FS(){if(Uu)return Ce;Uu=1;var t=Ce&&Ce.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.PostgrestError=Ce.PostgrestBuilder=Ce.PostgrestTransformBuilder=Ce.PostgrestFilterBuilder=Ce.PostgrestQueryBuilder=Ce.PostgrestClient=void 0;const e=t(BS());Ce.PostgrestClient=e.default;const n=t(Lm());Ce.PostgrestQueryBuilder=n.default;const r=t(nc());Ce.PostgrestFilterBuilder=r.default;const o=t(Dm());Ce.PostgrestTransformBuilder=o.default;const s=t(zm());Ce.PostgrestBuilder=s.default;const i=t(Mm());return Ce.PostgrestError=i.default,Ce.default={PostgrestClient:e.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:s.default,PostgrestError:i.default},Ce}var US=FS();const HS=yt(US),{PostgrestClient:WS,PostgrestQueryBuilder:PR,PostgrestFilterBuilder:ER,PostgrestTransformBuilder:TR,PostgrestBuilder:AR,PostgrestError:RR}=HS;function GS(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const qS=GS(),VS="2.11.15",KS=`realtime-js/${VS}`,XS="1.0.0",Bm=1e4,JS=1e3;var eo;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(eo||(eo={}));var Re;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Re||(Re={}));var rt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(rt||(rt={}));var Ga;(function(t){t.websocket="websocket"})(Ga||(Ga={}));var hn;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(hn||(hn={}));class YS{constructor(){this.HEADER_LENGTH=1}decode(e,n){return e.constructor===ArrayBuffer?n(this._binaryDecode(e)):n(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const n=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,n,r)}_decodeBroadcast(e,n,r){const o=n.getUint8(1),s=n.getUint8(2);let i=this.HEADER_LENGTH+2;const a=r.decode(e.slice(i,i+o));i=i+o;const l=r.decode(e.slice(i,i+s));i=i+s;const c=JSON.parse(r.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class Fm{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var he;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(he||(he={}));const Hu=(t,e,n={})=>{var r;const o=(r=n.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,i)=>(s[i]=ZS(i,t,e,o),s),{})},ZS=(t,e,n,r)=>{const o=e.find(a=>a.name===t),s=o?.type,i=n[t];return s&&!r.includes(s)?Um(s,i):qa(i)},Um=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return nk(e,n)}switch(t){case he.bool:return QS(e);case he.float4:case he.float8:case he.int2:case he.int4:case he.int8:case he.numeric:case he.oid:return ek(e);case he.json:case he.jsonb:return tk(e);case he.timestamp:return rk(e);case he.abstime:case he.date:case he.daterange:case he.int4range:case he.int8range:case he.money:case he.reltime:case he.text:case he.time:case he.timestamptz:case he.timetz:case he.tsrange:case he.tstzrange:return qa(e);default:return qa(e)}},qa=t=>t,QS=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},ek=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},tk=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},nk=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let s;const i=t.slice(1,n);try{s=JSON.parse("["+i+"]")}catch{s=i?i.split(","):[]}return s.map(a=>Um(e,a))}return t},rk=t=>typeof t=="string"?t.replace(" ","T"):t,Hm=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Hi{constructor(e,n,r={},o=Bm){this.channel=e,this.event=n,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Wu;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Wu||(Wu={}));class to{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=to.syncState(this.state,o,s,i),this.pendingDiffs.forEach(l=>{this.state=to.syncDiff(this.state,l,s,i)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=to.syncDiff(this.state,o,s,i),a())}),this.onJoin((o,s,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:s,newPresences:i})}),this.onLeave((o,s,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:s,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,o){const s=this.cloneDeep(e),i=this.transformState(n),a={},l={};return this.map(s,(c,u)=>{i[c]||(l[c]=u)}),this.map(i,(c,u)=>{const d=s[c];if(d){const h=u.map(v=>v.presence_ref),p=d.map(v=>v.presence_ref),g=u.filter(v=>p.indexOf(v.presence_ref)<0),y=d.filter(v=>h.indexOf(v.presence_ref)<0);g.length>0&&(a[c]=g),y.length>0&&(l[c]=y)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},r,o)}static syncDiff(e,n,r,o){const{joins:s,leaves:i}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(s,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(p=>p.presence_ref),h=u.filter(p=>d.indexOf(p.presence_ref)<0);e[a].unshift(...h)}r(a,u,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,o(a,c,l),c.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const o=e[r];return"metas"in o?n[r]=o.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):n[r]=o,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Gu;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Gu||(Gu={}));var qu;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(qu||(qu={}));var kt;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(kt||(kt={}));class rc{constructor(e,n={config:{}},r){this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Re.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Hi(this,rt.join,this.params,this.timeout),this.rejoinTimer=new Fm(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Re.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Re.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Re.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Re.errored,this.rejoinTimer.scheduleTimeout())}),this._on(rt.reply,{},(o,s)=>{this._trigger(this._replyEventName(s),o)}),this.presence=new to(this),this.broadcastEndpointURL=Hm(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,n=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Re.closed){const{config:{broadcast:s,presence:i,private:a}}=this.params;this._onError(u=>e?.(kt.CHANNEL_ERROR,u)),this._onClose(()=>e?.(kt.CLOSED));const l={},c={broadcast:s,presence:i,postgres_changes:(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){e?.(kt.SUBSCRIBED);return}else{const h=this.bindings.postgres_changes,p=(d=h?.length)!==null&&d!==void 0?d:0,g=[];for(let y=0;y<p;y++){const v=h[y],{filter:{event:w,schema:x,table:b,filter:_}}=v,S=u&&u[y];if(S&&S.event===w&&S.schema===x&&S.table===b&&S.filter===_)g.push(Object.assign(Object.assign({},v),{id:S.id}));else{this.unsubscribe(),this.state=Re.errored,e?.(kt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(kt.SUBSCRIBED);return}}).receive("error",u=>{this.state=Re.errored,e?.(kt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e?.(kt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this._on(e,n,r)}async send(e,n={}){var r,o;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var i,a,l;const c=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Re.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(rt.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(o=>{r=new Hi(this,rt.leave,{},e),r.receive("ok",()=>{n(),o("ok")}).receive("timeout",()=>{n(),o("timed out")}).receive("error",()=>{o("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,n,r){const o=new AbortController,s=setTimeout(()=>o.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:o.signal}));return clearTimeout(s),i}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Hi(this,e,n,r);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var o,s;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=rt;if(r&&[a,l,c,u].indexOf(i)>=0&&r!==this._joinRef())return;let h=this._onMessage(i,n,r);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(p=>{var g,y,v;return((g=p.filter)===null||g===void 0?void 0:g.event)==="*"||((v=(y=p.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(p=>p.callback(h,r)):(s=this.bindings[i])===null||s===void 0||s.filter(p=>{var g,y,v,w,x,b;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in p){const _=p.id,S=(g=p.filter)===null||g===void 0?void 0:g.event;return _&&((y=n.ids)===null||y===void 0?void 0:y.includes(_))&&(S==="*"||S?.toLocaleLowerCase()===((v=n.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const _=(x=(w=p?.filter)===null||w===void 0?void 0:w.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return _==="*"||_===((b=n?.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===i}).map(p=>{if(typeof h=="object"&&"ids"in h){const g=h.data,{schema:y,table:v,commit_timestamp:w,type:x,errors:b}=g;h=Object.assign(Object.assign({},{schema:y,table:v,commit_timestamp:w,eventType:x,new:{},old:{},errors:b}),this._getPayloadRecords(g))}p.callback(h,r)})}_isClosed(){return this.state===Re.closed}_isJoined(){return this.state===Re.joined}_isJoining(){return this.state===Re.joining}_isLeaving(){return this.state===Re.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const o=e.toLocaleLowerCase(),s={type:o,filter:n,callback:r};return this.bindings[o]?this.bindings[o].push(s):this.bindings[o]=[s],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(o=>{var s;return!(((s=o.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&rc.isEqual(o.filter,n))}),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(rt.close,{},e)}_onError(e){this._on(rt.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Re.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Hu(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Hu(e.columns,e.old_record)),n}}const Vu=()=>{},ok=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class sk{constructor(e,n){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Bm,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Vu,this.ref=0,this.logger=Vu,this.conn=null,this.sendBuffer=[],this.serializer=new YS,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>Gt(async()=>{const{default:l}=await Promise.resolve().then(()=>Rr);return{default:l}},void 0).then(({default:l})=>l(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${Ga.websocket}`,this.httpEndpoint=Hm(e),n?.transport?this.transport=n.transport:this.transport=null,n?.params&&(this.params=n.params),n?.timeout&&(this.timeout=n.timeout),n?.logger&&(this.logger=n.logger),(n?.logLevel||n?.log_level)&&(this.logLevel=n.logLevel||n.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),n?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=n.heartbeatIntervalMs);const o=(r=n?.params)===null||r===void 0?void 0:r.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=n?.reconnectAfterMs?n.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=n?.encode?n.encode:(s,i)=>i(JSON.stringify(s)),this.decode=n?.decode?n.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Fm(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(n?.fetch),n?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=n?.worker||!1,this.workerUrl=n?.workerUrl}this.accessToken=n?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=qS),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:XS}))}disconnect(e,n){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,n??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case eo.connecting:return hn.Connecting;case eo.open:return hn.Open;case eo.closing:return hn.Closing;default:return hn.Closed}}isConnected(){return this.connectionState()===hn.Open}channel(e,n={config:{}}){const r=`realtime:${e}`,o=this.getChannels().find(s=>s.topic===r);if(o)return o;{const s=new rc(`realtime:${e}`,n,this);return this.channels.push(s),s}}push(e){const{topic:n,event:r,payload:o,ref:s}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${s})`,o),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let n=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const o={access_token:n,version:KS};n&&r.updateJoinPayload(o),r.joinedOnce&&r._isJoined()&&r._push(rt.access_token,{access_token:n})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(JS,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,n=>{let{topic:r,event:o,payload:s,ref:i}=n;r==="phoenix"&&o==="phx_reply"&&this.heartbeatCallback(n.payload.status=="ok"?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${r} ${o} ${i&&"("+i+")"||""}`,s),Array.from(this.channels).filter(a=>a._isMember(r)).forEach(a=>a._trigger(o,s,i)),this.stateChangeCallbacks.message.forEach(a=>a(n))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(n=>n(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(n=>n(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(rt.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",o=new URLSearchParams(n);return`${e}${r}${o}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([ok],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}}class oc extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Se(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class ik extends oc{constructor(e,n){super(e),this.name="StorageApiError",this.status=n}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Va extends oc{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}var ak=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const Wm=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Gt(async()=>{const{default:r}=await Promise.resolve().then(()=>Rr);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},lk=()=>ak(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Gt(()=>Promise.resolve().then(()=>Rr),void 0)).Response:Response}),Ka=t=>{if(Array.isArray(t))return t.map(n=>Ka(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const o=n.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[o]=Ka(r)}),e};var On=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const Wi=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),ck=(t,e,n)=>On(void 0,void 0,void 0,function*(){const r=yield lk();t instanceof r&&!n?.noResolveJson?t.json().then(o=>{e(new ik(Wi(o),t.status||500))}).catch(o=>{e(new Va(Wi(o),o))}):e(new Va(Wi(t),t))}),uk=(t,e,n,r)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),r&&(o.body=JSON.stringify(r)),Object.assign(Object.assign({},o),n))};function So(t,e,n,r,o,s){return On(this,void 0,void 0,function*(){return new Promise((i,a)=>{t(n,uk(e,r,o,s)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>ck(l,a,r))})})}function Es(t,e,n,r){return On(this,void 0,void 0,function*(){return So(t,"GET",e,n,r)})}function Ft(t,e,n,r,o){return On(this,void 0,void 0,function*(){return So(t,"POST",e,r,o,n)})}function dk(t,e,n,r,o){return On(this,void 0,void 0,function*(){return So(t,"PUT",e,r,o,n)})}function hk(t,e,n,r){return On(this,void 0,void 0,function*(){return So(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function Gm(t,e,n,r,o){return On(this,void 0,void 0,function*(){return So(t,"DELETE",e,r,o,n)})}var Le=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const fk={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ku={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class pk{constructor(e,n={},r,o){this.url=e,this.headers=n,this.bucketId=r,this.fetch=Wm(o)}uploadOrUpdate(e,n,r,o){return Le(this,void 0,void 0,function*(){try{let s;const i=Object.assign(Object.assign({},Ku),o);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=r,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));const c=this._removeEmptyFolders(n),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:s,headers:a},i?.duplex?{duplex:i.duplex}:{})),h=yield d.json();return d.ok?{data:{path:c,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(s){if(Se(s))return{data:null,error:s};throw s}})}upload(e,n,r){return Le(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,o){return Le(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),i=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",n);try{let l;const c=Object.assign({upsert:Ku.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),h=yield d.json();return d.ok?{data:{path:s,fullPath:h.Key},error:null}:{data:null,error:h}}catch(l){if(Se(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,n){return Le(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const o=Object.assign({},this.headers);n?.upsert&&(o["x-upsert"]="true");const s=yield Ft(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),i=new URL(this.url+s.url),a=i.searchParams.get("token");if(!a)throw new oc("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}update(e,n,r){return Le(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return Le(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}copy(e,n,r){return Le(this,void 0,void 0,function*(){try{return{data:{path:(yield Ft(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrl(e,n,r){return Le(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),s=yield Ft(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:n},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${i}`)},{data:s,error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrls(e,n,r){return Le(this,void 0,void 0,function*(){try{const o=yield Ft(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${s}`):null})),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}download(e,n){return Le(this,void 0,void 0,function*(){const o=typeof n?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(n?.transform||{}),i=s?`?${s}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Es(this.fetch,`${this.url}/${o}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Se(a))return{data:null,error:a};throw a}})}info(e){return Le(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield Es(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:Ka(r),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}exists(e){return Le(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield hk(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Se(r)&&r instanceof Va){const o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),o=[],s=n?.download?`download=${n.download===!0?"":n.download}`:"";s!==""&&o.push(s);const a=typeof n?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(n?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return Le(this,void 0,void 0,function*(){try{return{data:yield Gm(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}list(e,n,r){return Le(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},fk),n),{prefix:e||""});return{data:yield Ft(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const mk="2.7.1",gk={"X-Client-Info":`storage-js/${mk}`};var Fn=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class yk{constructor(e,n={},r){this.url=e,this.headers=Object.assign(Object.assign({},gk),n),this.fetch=Wm(r)}listBuckets(){return Fn(this,void 0,void 0,function*(){try{return{data:yield Es(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Se(e))return{data:null,error:e};throw e}})}getBucket(e){return Fn(this,void 0,void 0,function*(){try{return{data:yield Es(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}createBucket(e,n={public:!1}){return Fn(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}updateBucket(e,n){return Fn(this,void 0,void 0,function*(){try{return{data:yield dk(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Fn(this,void 0,void 0,function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Fn(this,void 0,void 0,function*(){try{return{data:yield Gm(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}}class vk extends yk{constructor(e,n={},r){super(e,n,r)}from(e){return new pk(this.url,this.headers,e,this.fetch)}}const wk="2.51.0";let qr="";typeof Deno<"u"?qr="deno":typeof document<"u"?qr="web":typeof navigator<"u"&&navigator.product==="ReactNative"?qr="react-native":qr="node";const bk={"X-Client-Info":`supabase-js-${qr}/${wk}`},xk={headers:bk},_k={schema:"public"},Ck={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Sk={};var kk=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};const Pk=t=>{let e;return t?e=t:typeof fetch>"u"?e=$m:e=fetch,(...n)=>e(...n)},Ek=()=>typeof Headers>"u"?Nm:Headers,Tk=(t,e,n)=>{const r=Pk(n),o=Ek();return(s,i)=>kk(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:t;let c=new o(i?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(s,Object.assign(Object.assign({},i),{headers:c}))})};var Ak=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};function Rk(t){return t.endsWith("/")?t:t+"/"}function Ok(t,e){var n,r;const{db:o,auth:s,realtime:i,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,h={db:Object.assign(Object.assign({},l),o),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(n=d?.headers)!==null&&n!==void 0?n:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Ak(this,void 0,void 0,function*(){return""})};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}const qm="2.71.0",Jn=30*1e3,Xa=3,Gi=Xa*Jn,Ik="http://localhost:9999",jk="supabase.auth.token",$k={"X-Client-Info":`gotrue-js/${qm}`},Ja="X-Supabase-Api-Version",Vm={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Nk=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Mk=10*60*1e3;class sc extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Z(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class zk extends sc{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function Dk(t){return Z(t)&&t.name==="AuthApiError"}class Km extends sc{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class nn extends sc{constructor(e,n,r,o){super(e,r,o),this.name=n,this.status=r}}class Bt extends nn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Lk(t){return Z(t)&&t.name==="AuthSessionMissingError"}class Jo extends nn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Yo extends nn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Zo extends nn{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Bk(t){return Z(t)&&t.name==="AuthImplicitGrantRedirectError"}class Xu extends nn{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ya extends nn{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function qi(t){return Z(t)&&t.name==="AuthRetryableFetchError"}class Ju extends nn{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Za extends nn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ts="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Yu=` 	
\r=`.split(""),Fk=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Yu.length;e+=1)t[Yu[e].charCodeAt(0)]=-2;for(let e=0;e<Ts.length;e+=1)t[Ts[e].charCodeAt(0)]=e;return t})();function Zu(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Ts[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Ts[r]),e.queuedBits-=6}}function Xm(t,e,n){const r=Fk[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Qu(t){const e=[],n=i=>{e.push(String.fromCodePoint(i))},r={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},s=i=>{Wk(i,r,n)};for(let i=0;i<t.length;i+=1)Xm(t.charCodeAt(i),o,s);return e.join("")}function Uk(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Hk(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const o=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|o)+65536,n+=1}Uk(r,e)}}function Wk(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function Gk(t){const e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};for(let o=0;o<t.length;o+=1)Xm(t.charCodeAt(o),n,r);return new Uint8Array(e)}function qk(t){const e=[];return Hk(t,n=>e.push(n)),new Uint8Array(e)}function Vk(t){const e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};return t.forEach(o=>Zu(o,n,r)),Zu(null,n,r),e.join("")}function Kk(t){return Math.round(Date.now()/1e3)+t}function Xk(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const tt=()=>typeof window<"u"&&typeof document<"u",sn={tested:!1,writable:!1},Jm=()=>{if(!tt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(sn.tested)return sn.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),sn.tested=!0,sn.writable=!0}catch{sn.tested=!0,sn.writable=!1}return sn.writable};function Jk(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((o,s)=>{e[s]=o})}catch{}return n.searchParams.forEach((r,o)=>{e[o]=r}),e}const Ym=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Gt(async()=>{const{default:r}=await Promise.resolve().then(()=>Rr);return{default:r}},void 0).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},Yk=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Yn=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},an=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Mt=async(t,e)=>{await t.removeItem(e)};class ri{constructor(){this.promise=new ri.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}ri.promiseConstructor=Promise;function Vi(t){const e=t.split(".");if(e.length!==3)throw new Za("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Nk.test(e[r]))throw new Za("JWT not in base64url format");return{header:JSON.parse(Qu(e[0])),payload:JSON.parse(Qu(e[1])),signature:Gk(e[2]),raw:{header:e[0],payload:e[1]}}}async function Zk(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Qk(t,e){return new Promise((r,o)=>{(async()=>{for(let s=0;s<1/0;s++)try{const i=await t(s);if(!e(s,null,i)){r(i);return}}catch(i){if(!e(s,i)){o(i);return}}})()})}function e1(t){return("0"+t.toString(16)).substr(-2)}function t1(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let o="";for(let s=0;s<56;s++)o+=n.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(e),Array.from(e,e1).join("")}async function n1(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),o=new Uint8Array(r);return Array.from(o).map(s=>String.fromCharCode(s)).join("")}async function r1(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await n1(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Un(t,e,n=!1){const r=t1();let o=r;n&&(o+="/PASSWORD_RECOVERY"),await Yn(t,`${e}-code-verifier`,o);const s=await r1(r);return[s,r===s?"plain":"s256"]}const o1=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function s1(t){const e=t.headers.get(Ja);if(!e||!e.match(o1))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function i1(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function a1(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const l1=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Hn(t){if(!l1.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ki(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}var c1=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n};const cn=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),u1=[502,503,504];async function ed(t){var e;if(!Yk(t))throw new Ya(cn(t),0);if(u1.includes(t.status))throw new Ya(cn(t),t.status);let n;try{n=await t.json()}catch(s){throw new Km(cn(s),s)}let r;const o=s1(t);if(o&&o.getTime()>=Vm["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new Ju(cn(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Bt}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((s,i)=>s&&typeof i=="string",!0))throw new Ju(cn(n),t.status,n.weak_password.reasons);throw new zk(cn(n),t.status||500,r)}const d1=(t,e,n,r)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),n))};async function se(t,e,n,r){var o;const s=Object.assign({},r?.headers);s[Ja]||(s[Ja]=Vm["2024-01-01"].name),r?.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const i=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(i.redirect_to=r.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await h1(t,e,n+a,{headers:s,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function h1(t,e,n,r,o,s){const i=d1(e,r,o,s);let a;try{a=await t(n,Object.assign({},i))}catch(l){throw console.error(l),new Ya(cn(l),0)}if(a.ok||await ed(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await ed(l)}}function St(t){var e;let n=null;g1(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=Kk(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function td(t){const e=St(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Ut(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function f1(t){return{data:t,error:null}}function p1(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s}=t,i=c1(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function m1(t){return t}function g1(t){return t.access_token&&t.refresh_token&&t.expires_in}const Xi=["global","local","others"];var y1=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n};class v1{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=Ym(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,n=Xi[0]){if(Xi.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Xi.join(", ")}`);try{return await se(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await se(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Ut})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=y1(e,["options"]),o=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await se(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:p1,redirectTo:n?.redirectTo})}catch(n){if(Z(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await se(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ut})}catch(n){if(Z(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,o,s,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await se(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(s=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""},xform:m1});if(u.error)throw u.error;const d=await u.json(),h=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,p=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(g=>{const y=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);c[`${v}Page`]=y}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(Z(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Hn(e);try{return await se(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ut})}catch(n){if(Z(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){Hn(e);try{return await se(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Ut})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){Hn(e);try{return await se(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Ut})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Hn(e.userId);try{const{data:n,error:r}=await se(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:n,error:r}}catch(n){if(Z(n))return{data:null,error:n};throw n}}async _deleteFactor(e){Hn(e.userId),Hn(e.id);try{return{data:await se(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}}}function nd(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}function w1(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Wn={debug:!!(globalThis&&Jm()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Zm extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class b1 extends Zm{}async function x1(t,e,n){Wn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Wn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){Wn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await n()}finally{Wn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(e===0)throw Wn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new b1(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Wn.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}w1();const _1={url:Ik,storageKey:jk,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:$k,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function rd(t,e,n){return await n()}const Gn={};class ho{constructor(e){var n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ho.nextInstanceID,ho.nextInstanceID+=1,this.instanceID>0&&tt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},_1),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new v1({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Ym(o.fetch),this.lock=o.lock||rd,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:tt()&&(!((n=globalThis?.navigator)===null||n===void 0)&&n.locks)?this.lock=x1:this.lock=rd,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:Jm()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=nd(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=nd(this.memoryStorage)),tt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,n;return(n=(e=Gn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){Gn[this.storageKey]=Object.assign(Object.assign({},Gn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=Gn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Gn[this.storageKey]=Object.assign(Object.assign({},Gn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${qm}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const n=Jk(window.location.href);let r="none";if(this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce"),tt()&&this.detectSessionInUrl&&r!=="none"){const{data:o,error:s}=await this._getSessionFromURL(n,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),Bk(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:i,redirectType:a}=o;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Z(n)?{error:n}:{error:new Km("Unexpected error during initialization",n)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,o;try{const s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e?.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:St}),{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Z(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var n,r,o;try{let s;if("email"in e){const{email:u,password:d,options:h}=e;let p=null,g=null;this.flowType==="pkce"&&([p,g]=await Un(this.storage,this.storageKey)),s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h?.emailRedirectTo,body:{email:u,password:d,data:(n=h?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:p,code_challenge_method:g},xform:St})}else if("phone"in e){const{phone:u,password:d,options:h}=e;s=await se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(r=h?.data)!==null&&r!==void 0?r:{},channel:(o=h?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:St})}else throw new Yo("You must provide either an email or phone number and a password");const{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Z(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let n;if("email"in e){const{email:s,password:i,options:a}=e;n=await se(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:td})}else if("phone"in e){const{phone:s,password:i,options:a}=e;n=await se(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:td})}else throw new Yo("You must provide either an email or phone number and a password");const{data:r,error:o}=n;return o?{data:{user:null,session:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Jo}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(n){if(Z(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOAuth(e){var n,r,o,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;if(n==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}async signInWithSolana(e){var n,r,o,s,i,a,l,c,u,d,h,p;let g,y;if("message"in e)g=e.message,y=e.signature;else{const{chain:v,wallet:w,statement:x,options:b}=e;let _;if(tt())if(typeof w=="object")_=w;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))_=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=w}const S=new URL((n=b?.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in _&&_.signIn){const k=await _.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b?.signInWithSolana),{version:"1",domain:S.host,uri:S.href}),x?{statement:x}:null));let C;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")C=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)C=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in C&&"signature"in C&&(typeof C.signedMessage=="string"||C.signedMessage instanceof Uint8Array)&&C.signature instanceof Uint8Array)g=typeof C.signedMessage=="string"?C.signedMessage:new TextDecoder().decode(C.signedMessage),y=C.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in _)||typeof _.signMessage!="function"||!("publicKey"in _)||typeof _!="object"||!_.publicKey||!("toBase58"in _.publicKey)||typeof _.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${S.host} wants you to sign in with your Solana account:`,_.publicKey.toBase58(),...x?["",x,""]:[""],"Version: 1",`URI: ${S.href}`,`Issued At: ${(o=(r=b?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=b?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((i=b?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((a=b?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((c=b?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((d=(u=b?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...b.signInWithSolana.resources.map(C=>`- ${C}`)]:[]].join(`
`);const k=await _.signMessage(new TextEncoder().encode(g),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=k}}try{const{data:v,error:w}=await se(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Vk(y)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:St});if(w)throw w;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new Jo}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:w})}catch(v){if(Z(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const n=await an(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(n??"").split("/");try{const{data:s,error:i}=await se(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:St});if(await Mt(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Jo}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:i})}catch(s){if(Z(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:n,provider:r,token:o,access_token:s,nonce:i}=e,a=await se(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:St}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Jo}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(n){if(Z(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOtp(e){var n,r,o,s,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Un(this.storage,this.storageKey));const{error:d}=await se(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await se(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(o=l?.data)!==null&&o!==void 0?o:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(i=l?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new Yo("You must provide either an email or phone number.")}catch(a){if(Z(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var n,r;try{let o,s;"options"in e&&(o=(n=e.options)===null||n===void 0?void 0:n.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:i,error:a}=await se(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:St});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(Z(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var n,r,o;try{let s=null,i=null;return this.flowType==="pkce"&&([s,i]=await Un(this.storage,this.storageKey)),await se(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:i}),headers:this.headers,xform:f1})}catch(s){if(Z(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Bt;const{error:o}=await se(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(Z(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:o,options:s}=e,{error:i}=await se(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:r,type:o,options:s}=e,{data:i,error:a}=await se(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:a}}throw new Yo("You must provide either an email or phone number and a type")}catch(n){if(Z(n))return{data:{user:null,session:null},error:n};throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await an(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Gi:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const i=await an(this.userStorage,this.storageKey+"-user");i?.user?e.user=i.user:e.user=Ki()}if(this.storage.isServer&&e.user){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await se(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ut}):await this._useSession(async n=>{var r,o,s;const{data:i,error:a}=n;if(a)throw a;return!(!((r=i.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Bt}:await se(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:Ut})})}catch(n){if(Z(n))return Lk(n)&&(await this._removeSession(),await Mt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:n};throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:o,error:s}=r;if(s)throw s;if(!o.session)throw new Bt;const i=o.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Un(this.storage,this.storageKey));const{data:c,error:u}=await se(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Ut});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Bt;const n=Date.now()/1e3;let r=n,o=!0,s=null;const{payload:i}=Vi(e.access_token);if(i.exp&&(r=i.exp,o=r<=n),o){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(n){if(Z(n))return{data:{session:null,user:null},error:n};throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:i,error:a}=n;if(a)throw a;e=(r=i.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Bt;const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(n){if(Z(n))return{data:{user:null,session:null},error:n};throw n}}async _getSessionFromURL(e,n){try{if(!tt())throw new Zo("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Zo(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Xu("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Zo("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Xu("No code detected.");const{data:x,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:x.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:o,access_token:s,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!i||!c)throw new Zo("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let h=u+d;l&&(h=parseInt(l));const p=h-u;p*1e3<=Jn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const g=h-d;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,h,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,h,u);const{data:y,error:v}=await this._getUser(s);if(v)throw v;const w={provider_token:r,provider_refresh_token:o,access_token:s,expires_in:d,expires_at:h,refresh_token:i,token_type:c,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(r){if(Z(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await an(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:o,error:s}=n;if(s)return{error:s};const i=(r=o.session)===null||r===void 0?void 0:r.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(Dk(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Mt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const n=Xk(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,o;try{const{data:{session:s},error:i}=n;if(i)throw i;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,n={}){let r=null,o=null;this.flowType==="pkce"&&([r,o]=await Un(this.storage,this.storageKey,!0));try{return await se(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:o,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(s){if(Z(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}}async linkIdentity(e){var n;try{const{data:r,error:o}=await this._useSession(async s=>{var i,a,l,c,u;const{data:d,error:h}=s;if(h)throw h;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await se(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(o)throw o;return tt()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(Z(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,o;const{data:s,error:i}=n;if(i)throw i;return await se(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})})}catch(n){if(Z(n))return{data:null,error:n};throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await Qk(async o=>(o>0&&await Zk(200*Math.pow(2,o-1)),this._debug(n,"refreshing attempt",o),await se(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:St})),(o,s)=>{const i=200*Math.pow(2,o);return s&&qi(s)&&Date.now()+i-r<Jn})}catch(r){if(this._debug(n,"error",r),Z(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),tt()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const o=await an(this.storage,this.storageKey);if(o&&this.userStorage){let i=await an(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:o.user},await Yn(this.userStorage,this.storageKey+"-user",i)),o.user=(e=i?.user)!==null&&e!==void 0?e:Ki()}else if(o&&!o.user&&!o.user){const i=await an(this.storage,this.storageKey+"-user");i&&i?.user?(o.user=i.user,await Mt(this.storage,this.storageKey+"-user"),await Yn(this.storage,this.storageKey,o)):o.user=Ki()}if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}const s=((n=o.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Gi;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${Gi}s`),s){if(this.autoRefreshToken&&o.refresh_token){const{error:i}=await this._callRefreshToken(o.refresh_token);i&&(console.error(i),qi(i)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:a}=await this._getUser(o.access_token);!a&&i?.user?(o.user=i.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(r,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Bt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new ri;const{data:s,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new Bt;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(o,"error",s),Z(s)){const i={session:null,error:s};return qi(s)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(i),i}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,n,r=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const s=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){s.push(l)}});if(await Promise.all(i),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await Yn(this.userStorage,this.storageKey+"-user",{user:n.user});const o=Object.assign({},n);delete o.user;const s=structuredClone(o);await Yn(this.storage,this.storageKey,s)}else{const o=structuredClone(n);await Yn(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await Mt(this.storage,this.storageKey),await Mt(this.storage,this.storageKey+"-code-verifier"),await Mt(this.storage,this.storageKey+"-user"),this.userStorage&&await Mt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&tt()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Jn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((r.expires_at*1e3-e)/Jn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Jn}ms, refresh threshold is ${Xa} ticks`),o<=Xa&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Zm)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!tt()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const o=[`provider=${encodeURIComponent(n)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[s,i]=await Un(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(i)}`});o.push(a.toString())}if(r?.queryParams){const s=new URLSearchParams(r.queryParams);o.push(s.toString())}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;return s?{data:null,error:s}:await se(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Z(n))return{data:null,error:n};throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,o;const{data:s,error:i}=n;if(i)return{data:null,error:i};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await se(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((o=l?.totp)===null||o===void 0)&&o.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(n){if(Z(n))return{data:null,error:n};throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;if(s)return{data:null,error:s};const{data:i,error:a}=await se(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(n){if(Z(n))return{data:null,error:n};throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:s}=n;return s?{data:null,error:s}:await se(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Z(n))return{data:null,error:n};throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){const{data:{user:e},error:n}=await this.getUser();if(n)return{data:null,error:n};const r=e?.factors||[],o=r.filter(i=>i.factor_type==="totp"&&i.status==="verified"),s=r.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:r,totp:o,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var n,r;const{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Vi(o.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((r=(n=o.user.factors)===null||n===void 0?void 0:n.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;const o=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+Mk>o)return r;const{data:s,error:i}=await se(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=o,r=s.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:g}=await this.getSession();if(g||!p.session)return{data:null,error:g};r=p.session.access_token}const{header:o,payload:s,signature:i,raw:{header:a,payload:l}}=Vi(r);n?.allowExpired||i1(s.exp);const c=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,n?.keys?{keys:n.keys}:n?.jwks);if(!c){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:s,header:o,signature:i},error:null}}const u=a1(o.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,i,qk(`${a}.${l}`)))throw new Za("Invalid JWT signature");return{data:{claims:s,header:o,signature:i},error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}}}ho.nextInstanceID=0;const C1=ho;class S1 extends C1{constructor(e){super(e)}}var k1=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};class P1{constructor(e,n,r){var o,s,i;if(this.supabaseUrl=e,this.supabaseKey=n,!e)throw new Error("supabaseUrl is required.");if(!n)throw new Error("supabaseKey is required.");const a=Rk(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:_k,realtime:Sk,auth:Object.assign(Object.assign({},Ck),{storageKey:c}),global:xk},d=Ok(r??{},u);this.storageKey=(o=d.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=Tk(n,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new WS(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new IS(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new vk(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,n;return k1(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,storageKey:s,flowType:i,lock:a,debug:l},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new S1({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:s,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,flowType:i,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new sk(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r?.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const E1=(t,e,n)=>new P1(t,e,n),Cn=E1("https://pkswdnpftrundnewgnya.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrc3dkbnBmdHJ1bmRuZXdnbnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODI2MzIsImV4cCI6MjA2ODI1ODYzMn0.r_Y1RLOGJ55C0De5SBTVXqO09SMDqgV38sQuE-oDxXE"),T1=async(t,e)=>{const n=await Cn.rpc("save_campaign_version",{p_name:t,p_data:await jm(e)});if(n.error)throw new Error(`error saving to db ${n.error.message} ${n.error.details}`,{cause:n.error});return n.data},A1=async t=>{const e=await Cn.rpc("get_latest_campaign",{p_name:t.name,p_created_by:t.createdBy,p_version:t.version});if(e.error)throw new Error("could not get campaign",{cause:e.error});const n=await TS(e.data.data);return Object.values(n.rooms).forEach(r=>{delete r.size}),n},Qm=()=>{const[t,e]=m.useState(null);return m.useEffect(()=>{Cn.auth.getUser().then(({data:{user:r}})=>{e(r)});const{data:{subscription:n}}=Cn.auth.onAuthStateChange((r,o)=>{e(o?.user??null)});return()=>n.unsubscribe()},[]),t},ic=()=>{const[t,e]=m.useState(0);return{justDone:t,doneNow(){e(n=>n+1),setTimeout(()=>e(n=>n-1),R1)}}},R1=2e3,O1=`
## Save

put your campaign on cassette tape, or even floppy disk!

to be shared or worked on later

(really, saves to a cloud database)
`,I1=`
## Load

continue working from your last save
`,eg=()=>ge(({levelEditor:{savedCampaign:t,campaignInProgress:e}})=>Ge(t,e)),j1=()=>{const t=Qm(),e=eg(),{doneNow:n,justDone:r}=ic(),o=async()=>{const i=W.getState(),a=Eh(i);console.info("saving...",a);const l=await T1("sequel",a);console.info(`...saved as v${l}`),W.dispatch(uv({campaign:a})),n()},s=async()=>{try{const i=await A1({name:"sequel"});console.info("loaded",i),W.dispatch(dv({campaign:i}))}catch(i){console.error(i)}};return f.jsxs(f.Fragment,{children:[r>0?f.jsx(ee,{disabled:!0,className:"!bg-moss !text-white",children:f.jsx(O,{className:"relative leading-none",children:"OK!"})}):f.jsx(ee,{disabled:t===null||e,onClick:o,shortcutKeys:["^S","S"],tooltipContent:O1,children:f.jsxs("div",{className:"flex flex-row items-center",children:[f.jsx("span",{className:Te("sprite sprite-tinted text-highlightBeige texture-hud_char_ relative",{"text-lightGrey":t===null})}),f.jsx("span",{className:Te("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})})]})}),f.jsx(ee,{disabled:t===null,onClick:s,tooltipContent:I1,children:f.jsxs("div",{className:"flex flex-row items-center",children:[f.jsx("span",{className:Te("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})}),f.jsx("span",{className:Te("sprite sprite-tinted text-highlightBeige texture-hud_char_ relative",{"text-lightGrey":t===null})})]})})]})},$1=()=>f.jsx(ee,{children:f.jsx(O,{className:"relative leading-none",children:"MAP"})}),N1=()=>{const[t,e]=m.useState(!1),[n,r]=m.useState(!1);return f.jsx(ec,{main:f.jsx(ee,{onClick:async()=>{const o=W.getState(),s=Eh(o),i=await jm(s),a=new URL("https://blockstack.ing"),l=a.searchParams;l.set("campaignData",i),l.set("noSaves","1"),l.set("cheats","1"),n&&l.set("playAsHeels","1"),t||(a.hash=o.levelEditor.currentlyEditingRoomId),window.open(a.toString(),"playtest")},shortcutKeys:["P","^P"],children:f.jsx(Ha,{topText:"pl",bottomText:"ay",icon:f.jsx("span",{className:"sprite texture-joystick mt-half"})})}),children:[f.jsx(yr,{className:"w-full",value:t,label:"from",falseLabel:"room",trueLabel:"start",onChange:o=>e(o)},"fromStart"),f.jsx(yr,{className:"w-full",value:n,label:"as",falseLabel:"head",trueLabel:"heels",onChange:o=>r(o)},"playAsHeels")]})},M1=t=>{switch(t){case"github":return vh;case"discord":return wh;default:throw new Error}},z1=({className:t})=>{const e=Qm(),n=o=>async()=>{const s=new URL(window.location.href);s.hash="";const i=s.toString(),{error:a}=await Cn.auth.signInWithOAuth({provider:o,options:{redirectTo:i}});a&&console.error("Login error:",a)},r=async()=>{const{error:o}=await Cn.auth.signOut();o&&console.error("Logout error:",o)};return f.jsx("div",{className:Te(t),children:e?f.jsxs("div",{className:"bg-moss overflow-hidden text-center",children:[f.jsx(O,{noSlitWords:!0,className:"overflow-hidden",children:`${M1(e.app_metadata.provider)}${e.email}`}),f.jsx(ur,{className:"px-1 w-full",onClick:r,children:f.jsx(O,{children:"Logout"})})]}):f.jsxs("div",{className:"px-1 bg-midRed",children:[f.jsx(O,{className:"block w-full sprites-double-height pb-1",children:"Not logged in"}),f.jsx(O,{className:"block w-full text-highlightBeige",children:"You will not be able to save"}),f.jsxs("div",{className:"pt-1 flex flex-col gap-half",children:[f.jsx(O,{children:"Log in with:"}),f.jsxs(ur,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:n("github"),children:[f.jsx(O,{children:vh}),f.jsx(O,{children:"GitHub"})]}),f.jsxs(ur,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:n("discord"),children:[f.jsx(O,{children:wh}),f.jsx(O,{children:"Discord"})]})]})]})})},D1=`
## Add room

Add a **new room** to this campaign

Nothing will link to the room so add *doors* and *teleporters* to get into it
`,L1=`
## Delete room

Delete this room
`,B1=()=>{const t=He(),e=ge(n=>Object.keys(n.levelEditor.campaignInProgress.rooms).length>1);return f.jsxs(f.Fragment,{children:[f.jsx(ee,{className:"bg-moss",onClick:()=>t(hv()),tooltipContent:D1,children:f.jsx("span",{className:"sprite texture-hud_char_+ relative"})}),f.jsx(ee,{className:"bg-midRed",onClick:()=>t(fv()),disabled:!e,tooltipContent:L1,children:f.jsx("span",{className:"sprite texture-hud_char_X relative"})})]})},tg=t=>()=>kr(t),Oe={x:12,y:12,z:V.h},F1={x:14,y:14,z:V.h},fn={x:16,y:16,z:V.h},Ji={...Oe,z:V.h*2},ng=t=>{switch(t.type){case"spring":case"portableBlock":case"moveableDeadly":case"slidingDeadly":case"firedDoughnut":return{aabb:Oe};case"slidingBlock":return t.config.style==="book"?{aabb:fn}:{aabb:Oe};case"lift":return{aabb:{...Oe,z:Oe.z}};case"switch":return{aabb:{...Oe,z:Oe.z}};case"pickup":return t.config.gives==="scroll"?{aabb:{x:16,y:4,z:13}}:{aabb:Oe};case"charles":return{aabb:Ji};case"ball":return{aabb:{x:12,y:12,z:12}};case"pushableBlock":case"movingPlatform":return{aabb:fn};case"block":switch(t.config.style){case"artificial":case"organic":case"book":return{aabb:fn};case"tower":return{aabb:{x:11,y:11,z:V.h}};default:throw new Error("unknown block style")}case"monster":switch(t.config.which){case"skiHead":return{aabb:{...Oe,z:21}};case"bubbleRobot":case"cyberman":case"elephant":case"emperorsGuardian":case"monkey":case"computerBot":return{aabb:Ji};case"helicopterBug":case"dalek":case"emperor":case"homingBot":case"elephantHead":return{aabb:Oe};case"turtle":return{aabb:Oe};default:throw t.config,new Error("unknown monster type")}case"deadlyBlock":case"spikes":return{aabb:fn};case"bubbles":return{aabb:Oe};case"conveyor":case"hushPuppy":case"teleporter":return{aabb:fn};case"barrier":return{aabb:t.config.axis==="y"?{x:3,y:15,z:V.h}:{x:15,y:3,z:V.h}};case"sceneryPlayer":return t.config.which==="headOverHeels"?{aabb:Ji}:{aabb:Oe};case"emitter":return{aabb:le};default:return{aabb:F1}}},Ve={aabb:Oe,castsShadowWhileStoodOn:!1},U1=({config:{direction:t},position:e})=>t==="right"&&e.x===0||t==="towards"&&e.y===0,H1=({x:t=0,y:e=0})=>e-t,G=({x:t=0,y:e=0,z:n=0})=>({x:e-t,y:-(t+e)/2-n}),W1=(t,e,n)=>{const r=G(t),o=Vt(n,r);return D(rg(e,o),t)},rg=(t,{x:e,y:n})=>{switch(bh(t)){case"xy":return{x:-e/2-n,y:e/2-n,z:0};case"xz":return{x:-e,y:0,z:e/2-n};case"yz":return{x:0,y:e,z:-e/2-n};default:throw new Error("only axis-aligned planes are supported for unprojection")}},ke=({x:t=0,y:e=0,z:n=0})=>({x:t*V.w,y:e*V.d,z:n*V.h}),hs=({x:t=0,y:e=0,z:n=0})=>({x:t/V.w,y:e/V.d,z:n/V.h}),Sn=t=>G(ke(t)),Qa=t=>{const e=ke(t.position),{aabb:n}=ng(t);if(n===void 0)throw new Error(`item type= ${t.type} config=${JSON.stringify(t.config)} has no bounding box`);return t.type==="wall"?e:D(e,{x:V.w-n.x>>1,y:V.d-n.y>>1})},Ee=Number.MIN_SAFE_INTEGER,od=Cy/1e3,og={firedDoughnut:2*od,floatingText:od},sg=10,sd=6e4,G1=8,q1=750,V1=2500,id=200,K1=.15,X1=sr.h-sr.w/2,ig=X1+2,oi=9999,Be=()=>({expires:null,stoodOnBy:{},disappearing:null,switchedAtRoomTime:Ee,stoodOnUntilRoomTime:Ee}),ad=()=>({standingOnItemId:null,vels:{gravity:le,movingFloor:le},latentMovement:[],actedOnAt:{roomTime:Ee,by:fe},collidedWith:{roomTime:Ee,by:fe}}),J1=t=>{const e=pv.includes(t.type);return{...Be(),position:Qa(t),...e?{standingOnItemId:null,vels:{gravity:le,movingFloor:le,...mv.includes(t.type)?{sliding:le}:{},...t.type==="monster"||t.type==="movingPlatform"?{walking:le}:{}},latentMovement:[],actedOnAt:{roomTime:Ee,by:fe},collidedWith:{roomTime:Ee,by:fe}}:{},...t.type==="monster"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",timeOfLastDirectionChange:Number.NEGATIVE_INFINITY,...t.config.which==="skiHead"||t.config.which==="turtle"||t.config.which==="elephantHead"||t.config.which==="cyberman"?{facing:Pe[t.config.startDirection]}:{facing:Pe.towards}}:{},...t.type==="pickup"?{disappearing:{on:"touch",byType:t.config.gives==="bag"||t.config.gives==="jumps"?["heels","headOverHeels"]:t.config.gives==="doughnuts"||t.config.gives==="hooter"||t.config.gives==="fast"?["head","headOverHeels"]:["head","heels","headOverHeels"]}}:{},...t.type==="movingPlatform"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",facing:Pe[t.config.startDirection]}:{},...t.type==="switch"?{setting:t.config.initialSetting,touchedOnProgression:-1}:{},...t.type==="block"?{disappearing:t.config.disappearing??null}:{},...t.type==="conveyor"?{disappearing:t.config.disappearing??null}:{},...t.type==="barrier"?{disappearing:t.config.disappearing??null}:{},...t.type==="lift"?{direction:"up",vels:{lift:le}}:{},...t.type==="charles"?{facing:Pe.towards}:{},...t.type==="emitter"?{lastEmittedAtRoomTime:Ee,quantityEmitted:0}:{},...t.type==="firedDoughnut"?{disappearing:{on:"touch"},vels:{fired:t.config.direction?Ms(Pe[t.config.direction],og.firedDoughnut):le}}:{}}},Yi=V.h*2,Y1=4,Vr=V.h*Y1,Z1=2,Q1=2*V.w,eP=.5,ld=2;function*tP(t,e){const{config:{direction:n},position:r}=t,o=go(n),s=Pr(o),i=U1(t),a={...le,[s]:i?-.5:0},l=1,c={[s]:i?-1:0},u=l*V.w,d={...le,[s]:u},h=9,p=8,g=8;{const y={[o]:p,[s]:g,z:Vr};yield{...t,...Ve,type:"doorFrame",id:`${e}/frameFar`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"far"},state:{...Be(),position:ke(D(r,{[o]:1.5},a,c)),stoodOnBy:fe},aabb:D(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}{const y={[o]:h,[s]:g,z:Vr};yield{...t,...Ve,type:"doorFrame",id:`${e}/frameNear`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"near"},state:{...Be(),position:ke(D(r,a,c)),stoodOnBy:fe},aabb:D(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}{const y={[o]:2*V.w-h-p,[s]:g,z:Vr-Yi};yield{...t,...Ve,type:"doorFrame",id:`${e}/frameTop`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"top"},state:{...Be(),position:D(ke(D(r,a,c)),{[o]:h,z:Yi}),stoodOnBy:fe},aabb:D(y,d),renderAabb:y,renderAabbOffset:i?d:void 0}}yield{...t,...Ve,type:"blocker",id:`${e}/blockerAbove`,jsonItemId:e,config:{},renders:!1,state:{...Be(),position:D(ke(D(r,a,c)),{z:Vr}),stoodOnBy:fe},aabb:D(ke({[o]:2,[s]:l,z:oi}),{[s]:g}),renderAabb:le,fixedZIndex:mn},yield{...t,...Ve,type:"portal",id:`${e}/portal`,jsonItemId:e,config:{...gv(t.config,"toRoom","toDoor"),inHidden:i,relativePoint:ke({...le,[s]:i?l+.25:-.25}),direction:Pe[n]},fixedZIndex:mn,state:{...Be(),position:D(ke(D(r,{[s]:i?-.5-l:.5})),{[o]:h}),stoodOnBy:fe},aabb:{[o]:Z1*V.w-h-p,[s]:u,z:Yi}},r.z!==0&&(yield{...t,...Ve,type:"doorLegs",id:`${e}/legs`,jsonItemId:e,config:{...t.config,inHiddenWall:i,style:"none",side:"away",height:r.z},renders:!0,shadowCastTexture:i?{textureId:"shadow.door.floatingThreshold.double.y",flipX:o==="x"}:void 0,castsShadowWhileStoodOn:i,state:{...Be(),position:{...ke(D(r,a,c)),z:0}},aabb:D(ke({[o]:2,[s]:.5,z:r.z}),d),renderAabb:i?D(ke({[o]:2,[s]:.5,z:.5})):void 0,renderAabbOffset:i?D({[o]:0,[s]:0,z:(r.z-.5)*V.h},{[s]:d[s]}):void 0,shadowOffset:{z:r.z*V.h,[s]:i?d[s]:void 0}}),yield{...Ve,type:"stopAutowalk",id:`${e}/stopAutowalk`,jsonItemId:e,aabb:ke({[o]:2,[s]:ld,z:2}),config:{},fixedZIndex:mn,state:{...Be(),position:ke(hr(r,Ms(Pe[n],eP),i?le:{[s]:ld})),stoodOnBy:fe}}}const cd={config:fe,shadowCastTexture:"shadow.smallRound",castsShadowWhileStoodOn:!0,aabb:Oe},ud=()=>{const t=ky(W.getState());return{action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:Pe.towards,walkStartFacing:Pe.towards,walkDistance:0,vels:{walking:le,gravity:le,movingFloor:le},switchedToAt:Ee,lastDiedAt:Ee,gameTime:0,jumpStartTime:Ee,lives:t?"infinite":G1,jumpStartZ:0}},nP=(t,e)=>{const n=Sy(W.getState());return t.config.which==="head"?{id:e,jsonItemId:e,type:"head",...Ve,...cd,state:{...Be(),...ad(),...ud(),hasHooter:!1,gameWalkDistance:0,fastStepsStartedAtDistance:Ee,shieldCollectedAt:Ee,doughnuts:n?"infinite":0,position:Qa(t),stoodOnUntilRoomTime:Ee}}:{id:e,jsonItemId:e,type:"heels",...Ve,...cd,state:{...Be(),...ad(),...ud(),carrying:null,hasBag:!1,bigJumps:0,isBigJump:!1,shieldCollectedAt:Ee,position:Qa(t),stoodOnUntilRoomTime:Ee}}},fo=(t,e={})=>{const n=Th(e),r=hr(vc,t);return hr(Py(n,vc),r)},ag=1,rP={x:V.w,y:V.d*ag,z:oi},oP={x:V.w,y:0,z:ig},sP={x:V.w*ag,y:V.d,z:oi},iP={x:0,y:V.d,z:ig},aP=(t,e)=>{const{config:{direction:n},position:r}=e,o=wl(e.config),s=go(n),i=Pr(s),a=yv(n),l={...le,[i]:a?-1:0};return{type:"wall",id:t,jsonItemId:t,config:e.config,aabb:fo(s==="y"?sP:rP,o),renderAabb:a?le:fo(s==="y"?iP:oP,o),fixedZIndex:a?mn:void 0,state:{...Be(),position:ke(D(r,l)),stoodOnBy:fe},shadowCastTexture:s==="y"?"shadow.wall.y":{textureId:"shadow.wall.y",flipX:!0},castsShadowWhileStoodOn:a}},lP=3,dd=10,hd=.52,fd=.5,cP=(t,e,n)=>{const{config:{times:r},position:o}=e,s=D(o,{z:-3}),i={...r,z:lP};let a=s,l=i;const c=vt(ys(n.items)).filter(h=>h.type==="door");if(o.z===0){const h={};for(const p of c){const{position:g,config:{direction:y}}=p;switch(y){case"towards":!h.towards&&g.y===s.y&&g.x>=s.x&&g.x<=s.x+r.x-2&&(l=D(l,{y:fd}),a=D(a,{y:-.5}),h.towards=!0);break;case"away":!h.away&&g.y===s.y+r.y&&g.x>=s.x&&g.x<=s.x+r.x-2&&(l=D(l,{y:hd}),h.away=!0);break;case"right":!h.right&&g.x===s.x&&g.y>=s.y&&g.y<=s.y+r.y-2&&(l=D(l,{x:fd}),a=D(a,{x:-.5}),h.right=!0);break;case"left":!h.left&&g.x===s.x+r.x&&g.y>=s.y&&g.y<=s.y+r.y-2&&(l=D(l,{x:hd}),h.left=!0);break}}}const u=ke(a),d=fo(fn,l);return{...Ve,type:"floor",id:t,jsonItemId:t,config:{...e.config,naturalFootprint:{aabb:fo(fn,i),position:ke(s)}},aabb:d,renderAabb:{...d,z:dd},renderAabbOffset:{...le,z:d.z-dd},shadowCastTexture:"shadow.fullBlock",state:{...Be(),position:u}}};function*si(t,e,n,r=fe,o={},s=""){if(!r[t]&&!(e.type==="pickup"&&e.config.gives==="scroll"&&e.config.source==="manual"&&o[e.config.page]))switch(!0){case e.type==="door":return yield*tP(e,t);case e.type==="player":{yield nP(e,t);return}case e.type==="wall":{yield aP(t,e);return}case e.type==="floor":{yield cP(t,e,n);return}case(e.type==="block"&&e.config.disappearing!==void 0&&zs(ws(e))>=2):{const i=ws(e);for(let a=0;a<i.x;a++)for(let l=0;l<i.y;l++)for(let c=0;c<i.z;c++){const u=Ds(e,d=>{d.position={x:e.position.x+a,y:e.position.y+l,z:e.position.z+c},d.config.times=xh});yield*si(t,u,n,r,o,`${s}_${a}_${l}_${c}`)}break}case(e.type==="sceneryCrown"&&!W.getState().gameMenus.planetsLiberated[e.config.planet]):return;default:{const i=ng(e),a=e.config.times!==void 0?{aabb:fo(i.aabb,e.config.times),renderAabb:void 0}:i;let l;try{l=J1(e)}catch(c){throw new Error(`loadItemFromJson: error creating initial state for jsonItem ${JSON.stringify(e,null,2)}`,{cause:c})}yield{...e,...Ve,...a,id:`${t}${s}`,jsonItemId:t,fixedZIndex:e.type==="emitter"?mn:void 0,shadowCastTexture:uP(e),castsShadowWhileStoodOn:e.type==="monster"&&(e.config.which==="emperor"||e.config.which==="emperorsGuardian"||e.config.which==="turtle"||e.config.which==="helicopterBug")||e.type==="pickup"||e.type==="ball"||e.type==="lift"||e.type==="pushableBlock"||e.type==="sceneryPlayer"||e.type==="slidingDeadly"||e.type==="spring",config:e.config,state:l}}}}const uP=t=>{switch(t.type){case"lift":case"switch":return"shadow.smallBlock";case"conveyor":return{textureId:"shadow.fullBlock",flipX:Kt(t.config.direction)==="x"};case"barrier":return{textureId:"shadow.barrier.y",flipX:t.config.axis==="x"};case"spring":case"firedDoughnut":case"slidingDeadly":return"shadow.smallRound";case"block":return t.config.style==="tower"?"shadow.smallRound":"shadow.fullBlock";case"pushableBlock":case"movingPlatform":case"hushPuppy":case"deadlyBlock":case"teleporter":case"spikes":return"shadow.fullBlock";case"portableBlock":return t.config.style==="drum"?"shadow.smallRound":"shadow.smallBlock";case"pickup":return t.config.gives==="scroll"?"shadow.scroll":"shadow.smallRound";case"ball":case"charles":case"monster":return"shadow.smallRound";case"slidingBlock":return t.config.style==="book"?"shadow.fullBlock":"shadow.smallRound"}},ii=({aabb:t,state:{position:e}},{aabb:n,state:{position:r}})=>!(e.x+t.x<=r.x||e.x>=r.x+n.x)&&!(e.y+t.y<=r.y||e.y>=r.y+n.y)&&!(e.z+t.z<=r.z||e.z>=r.z+n.z),dP=(t,e)=>[...vt(e).filter(n=>t.id!==n.id&&ii(t,n))];function*el(t,e){for(const n of e)t.id!==n.id&&ii(t,n)&&(yield n)}function*hP(t,e){if(t.roomBelow!==void 0)for(const n of $e(e).filter(wc)){const{config:{naturalFootprint:r}}=n;yield{...Ve,type:"portal",id:"floor/portal",fixedZIndex:mn,config:{toRoom:t.roomBelow,relativePoint:{x:r.aabb.x/2,y:r.aabb.y/2,z:r.aabb.z},direction:Pe.down},aabb:r.aabb,state:{...Be(),position:r.position},renders:!1}}if(t.roomAbove!==void 0)for(const n of $e(e).filter(wc)){const{config:{naturalFootprint:r}}=n;yield{...Ve,type:"portal",id:"ceilingPortal",fixedZIndex:mn,config:{toRoom:t.roomAbove,relativePoint:{...t.ceilingRelativePoint!==void 0?ke(t.ceilingRelativePoint):{x:r.aabb.x/2,y:r.aabb.y/2},z:-12},direction:Pe.up},aabb:{...r.aabb,z:V.h},state:{...Be(),position:D(r.position,{z:r.aabb.z},{z:V.h*(t.height??sg)})}}}}const fP=(t,e,n,r)=>{const o=Math.max(0,Math.min(t.x+e.x,n.x+r.x)-Math.max(t.x,n.x)),s=Math.max(0,Math.min(t.y+e.y,n.y+r.y)-Math.max(t.y,n.y));return o*s},pd=({state:{position:t},aabb:e},{state:{position:n},aabb:r})=>fP(t,e,n,r),md={stopAutowalk:5,portal:5,wall:5,blocker:5,doorLegs:5,sceneryPlayer:5,bubbles:5,switch:10,doorFrame:15,ball:18,block:20,barrier:20,floor:20,hushPuppy:20,teleporter:20,lift:30,movingPlatform:30,pushableBlock:30,portableBlock:30,sceneryCrown:30,slidingBlock:30,spring:30,joystick:40,charles:40,conveyor:40,head:50,heels:50,headOverHeels:50,pickup:80,firedDoughnut:90,spikes:98,slidingDeadly:100,moveableDeadly:100,deadlyBlock:100,monster:100,floatingText:200,particle:200,emitter:200},pP=(t,e)=>md[t.type]-md[e.type],mP=(t,e,n=.001)=>{if(!yn(e,t)||t.id===e.id)return!1;const{state:{vels:{gravity:{z:r}}}}=t;return r>0?!1:ii({state:{position:D(t.state.position,{x:0,y:0,z:-1e-4})},aabb:{...t.aabb,z:n+_h},id:t.id},{state:{position:D(e.state.position,{x:0,y:0,z:e.aabb.z})},aabb:{...e.aabb,z:0},id:e.id})},gP=(t,e)=>{const r=[...vt(e).filter(s=>mP(t,s))];return r.length===0?void 0:r.reduce((s,i)=>{const a=pP(i,s);return a<0||a===0&&pd(t,i)>pd(t,s)?i:s})},yP=({above:t,below:e})=>{const n=e.state.stoodOnBy;if(!Object.isExtensible(n))throw new Error(`${t.id} can't stand on ${e.id} - its standingOn is not extensible`);t.state.standingOnItemId=e.id,n[t.id]=!0};function*vP(t,e,n,r){const o=Ty(t.items);for(const[s,i]of o)i.type==="player"&&!r||(yield*si(s,i,t,e,n))}const gd=t=>vt(t).reduce((e,n)=>({...e,[n.id]:n}),{}),lg=({roomJson:t,roomPickupsCollected:e,scrollsRead:n,isNewGame:r=!1})=>{const o=gd(vP(t,e,n,r)),s={...gd(hP(t,o)),...o};for(const a of $e(s)){const c=dP(a,Ey(s)).find(u=>yn(a)&&yn(u)&&!(a.type==="wall"&&u.type==="wall"));c!==void 0&&console.error(`in room ${t.id} item ${a.id} @${JSON.stringify(a.state.position)} #${JSON.stringify(a.aabb)} is colliding with (solid item) ${c.id} @${JSON.stringify(c.state.position)} #${JSON.stringify(c.aabb)} on loading room ${t.id}`)}for(const a of $e(s).filter(vv)){const l=gP(a,$e(s).filter(c=>c.id!==a.id));l!==void 0&&yP({above:a,below:l})}return{...t,roomJson:t,items:s,roomTime:0}},wP={floors:{edgeLeftX:Number.POSITIVE_INFINITY,edgeRightX:Number.NEGATIVE_INFINITY,topEdgeY:Number.POSITIVE_INFINITY,bottomEdgeY:Number.NEGATIVE_INFINITY},allItems:{topEdgeY:Number.POSITIVE_INFINITY}},cg=t=>$e(t.items).reduce((e,n)=>{if(n.type==="floor"){const{config:{naturalFootprint:r},state:{position:o},renderAabb:s,renderAabbOffset:i,aabb:a}=n,l=G(D(r.position,{x:r.aabb.x,z:r.aabb.z})).x,c=G(D(r.position,{y:r.aabb.y,z:r.aabb.z})).x,u=G(D(r.position,r.aabb)).y,d=G(D(o,i??le,{z:(s??a).z})).y;return{allItems:e.allItems,floors:{edgeLeftX:Math.min(e.floors.edgeLeftX,l),edgeRightX:Math.max(e.floors.edgeRightX,c),topEdgeY:Math.min(e.floors.topEdgeY,u),bottomEdgeY:Math.max(e.floors.bottomEdgeY,d)}}}else{const r=G(D(n.state.position,n.renderAabb??n.aabb??le,n.renderAabbOffset??le)).y;return{allItems:{topEdgeY:Math.min(e.allItems.topEdgeY,r)},floors:e.floors}}},wP),bP=vo([Bs,t=>t.levelEditor.previewedEdits],(t,e)=>Ds(t,n=>{const r=Ch(e);for(const[o,s]of r)s===null?delete n.items[o]:n.items[o]=s})),nr=vo([Bs],t=>lg({roomJson:t,roomPickupsCollected:fe,scrollsRead:fe,isNewGame:!0})),xP=vo([bP],t=>lg({roomJson:t,roomPickupsCollected:fe,scrollsRead:fe,isNewGame:!0})),fs=vo([nr],t=>{const{floors:{edgeLeftX:e,edgeRightX:n,bottomEdgeY:r},allItems:{topEdgeY:o}}=cg(t);return{l:e,r:n,w:n-e,b:r,t:o,h:r-o}}),ug=tg(xP),dg=tg(fs),_P=t=>$e(t.items).filter(e=>yn(e)),hg=(t,e)=>{const n=vt(_P(t));return e==="door"?n.filter(o=>o.type!=="wall"):n},fg=({roomState:t,jsonItemIds:e,blockPositionDelta:n,timesDelta:r})=>{const o=Dc(Nc(a=>[a,t.roomJson.items[a]]),Nc(([a,l])=>[a,Ds(l,c=>{c.position=D(c.position,n),wv(c,r)})]),Yv(function*([a,l]){for(const c of si(a,l,t.roomJson))yield[a,l,c]}),bv(([,,a])=>yn(a))),s=Array.from(o(e));return Dc(cw(([,a,l])=>{const c=vt(hg(t,a.type)).filter(u=>u.jsonItemId&&!e.includes(u.jsonItemId));for(const u of el(l,c))return console.warn(l.id,"colliding with static item",u.id),!0;for(const u of el(l,s.map(([d,h,p])=>p)))return console.warn(l.id,"colliding with other mutating item",u.id),!0;return!1}))(s)},CP=({roomState:t,blockPosition:e,itemTool:n})=>{const r=si("maybeAddedItem",{...n,position:e},t.roomJson).filter(s=>yn(s)),o=Array.from(hg(t,n.type));return r.some(s=>{const i=el(s,o);return!Fh(i)})},SP=()=>{const t=He(),e=ge(i=>i.levelEditor.selectedJsonItemIds.map(a=>vl(i.levelEditor).items[a])),n=e.length>0,r=n?so(...e.map(i=>bl(i))):le,o=n?e.map(i=>ws(i)).reduce((i,a)=>({x:Math.max(i.x,a.x),y:Math.max(i.y,a.y),z:Math.max(i.z,a.z)}),xh):le,s=(i=le,a)=>()=>{const l=W.getState().levelEditor,c=nr(W.getState()),{gridResolution:u,selectedJsonItemIds:d}=l,h=a?i:so(i,{x:u,y:u,z:1});if(fg({roomState:c,jsonItemIds:d,blockPositionDelta:h})){console.warn("nudge would collide");return}t(Ah({jsonItemIds:d,positionDelta:h,timesDelta:{...le,...a}})),t(Rh())};return f.jsxs("div",{className:"flex flex-row flex-wrap gap-x-0 gap-y-oneScaledPix items-center mt-1",children:[f.jsx(O,{className:"inline-block mr-1 text-lightGrey leading-none pr-oneScaledPix",noSlitWords:!0,children:"move  "}),f.jsxs("div",{className:"flex flex-row flex-wrap gap-oneScaledPix items-center",children:[f.jsx(ee,{small:!0,disabled:!n,onClick:s(Pe.left),shortcutKeys:["ArrowLeft"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:!n,onClick:s(Pe.right),shortcutKeys:["ArrowRight"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:!n,onClick:s(Pe.away),shortcutKeys:["ArrowUp"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:!n,onClick:s(Pe.towards),shortcutKeys:["ArrowDown"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:!n,onClick:s(Pe.up),shortcutKeys:["PageUp"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:!n,onClick:s(Pe.down),shortcutKeys:["PageDown"],children:f.jsx(O,{className:"relative leading-none",children:""})})]}),f.jsxs("div",{className:"flex flex-row flex-wrap gap-x-0 gap-y-oneScaledPix items-center",children:[f.jsx(O,{className:"inline-block mr-1 text-lightGrey leading-none pr-oneScaledPix",noSlitWords:!0,children:"grow  "}),f.jsxs("div",{className:"flex flex-row flex-wrap gap-oneScaledPix items-center",children:[f.jsx(ee,{small:!0,disabled:r.x===0,onClick:s(void 0,{x:1}),shortcutKeys:["ArrowLeft"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:r.x===0,onClick:s({x:-1,y:0,z:0},{x:1}),shortcutKeys:["ArrowRight"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:r.y===0,onClick:s(void 0,{y:1}),shortcutKeys:["ArrowUp"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:r.y===0,onClick:s({x:0,y:-1,z:0},{y:1}),shortcutKeys:["ArrowDown"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:r.z===0,onClick:s(void 0,{z:1}),shortcutKeys:["PageUp"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:r.z===0,onClick:s({x:0,y:0,z:-1},{z:1}),shortcutKeys:["PageDown"],children:f.jsx(O,{className:"relative leading-none",children:""})})]})]}),f.jsxs("div",{className:"flex flex-row flex-wrap gap-x-0 gap-y-oneScaledPix items-center",children:[f.jsx(O,{className:"inline-block mr-1 text-lightGrey leading-none pr-oneScaledPix",noSlitWords:!0,children:"shrink"}),f.jsxs("div",{className:"flex flex-row flex-wrap gap-oneScaledPix items-center",children:[f.jsx(ee,{small:!0,disabled:o.x<=1,onClick:s(void 0,{x:-1}),shortcutKeys:["ArrowRight"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:o.x<=1,onClick:s({x:1,y:0,z:0},{x:-1}),shortcutKeys:["ArrowLeft"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:o.y<=1,onClick:s(void 0,{y:-1}),shortcutKeys:["ArrowDown"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:o.y<=1,onClick:s({x:0,y:1,z:0},{y:-1}),shortcutKeys:["ArrowUp"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:o.z<=1,onClick:s(void 0,{z:-1}),shortcutKeys:["PageDown"],children:f.jsx(O,{className:"relative leading-none",children:""})}),f.jsx(ee,{small:!0,disabled:o.z<=1,onClick:s({x:0,y:0,z:1},{z:-1}),shortcutKeys:["PageUp"],children:f.jsx(O,{className:"relative leading-none",children:""})})]})]})]})},kP=`
## Back

Go back to the previous room
`,PP=`
## Forward

The opposite of back
`,EP=()=>{const t=ge(({levelEditor:r})=>{const{editingRoomIdHistory:o}=r;return o.back.length>0}),e=ge(({levelEditor:r})=>{const{editingRoomIdHistory:o}=r;return o.forward.length>0}),n=He();return f.jsxs(f.Fragment,{children:[f.jsx(ee,{className:"bg-highlightBeige",disabled:!t,onClick:()=>{n(xv())},shortcutKeys:["<"],tooltipContent:kP,children:f.jsx("span",{className:"sprite texture-hud_char_lt relative"})}),f.jsx(ee,{className:"bg-highlightBeige",disabled:!e,onClick:()=>{n(_v())},shortcutKeys:[">"],tooltipContent:PP,children:f.jsx("span",{className:"sprite texture-hud_char_gt relative"})})]})},TP=({className:t})=>{const e=He();return f.jsx(yr,{className:t,label:"coalesce",value:ge(n=>n.levelEditor.autoCoalesce),onChange:n=>{e(Cv(n))},shortcutKeys:["L"],tooltipContent:"optimise blocks into single items while editing, or keep separate?"})},AP=`
## Share

copies a link to the clipboard

anyone with the link can play your game
`,RP=()=>{const t=eg(),{doneNow:e,justDone:n}=ic();return n>0?f.jsx(ee,{className:"bg-moss",children:f.jsx(O,{className:"relative leading-none",children:"OK!"})}):f.jsx(ee,{disabled:!t,onClick:async()=>{const r=new URL("https://blockstack.ing"),o=r.searchParams,{data:{session:s}}=await Cn.auth.getSession(),i=s?.user.id;if(i===void 0)throw new Error("no user id on supabase session");o.set("campaignName","sequel"),o.set("campaignAuthor",i),o.set("noSaves","1"),navigator.clipboard.writeText(r.toString()).then(e)},tooltipContent:AP,children:f.jsx("span",{className:"sprite sprite-tinted texture-hud_char_ relative"})})},Qo=()=>f.jsx("div",{className:"w-[calc(var(--block)-1px)]"}),OP=()=>{const t=ge(r=>r.levelEditor.campaignInProgress),e=ge(r=>r.levelEditor.currentlyEditingRoomId),n=He();return f.jsxs("div",{className:"scale-editor flex w-full h-full text-white bg-metallicBlueHalfbrite pb-1 gap-1 flex-wrap justify-start overflow-auto",children:[f.jsx("div",{className:Ae,children:f.jsx(z1,{className:"w-full mb-1"})}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full",children:"Campaign"}),f.jsx(j1,{}),f.jsx(RP,{}),f.jsx(Qo,{}),f.jsx($1,{}),f.jsx(N1,{})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full pt-1",children:"Room"}),f.jsx(EP,{}),f.jsx(Qo,{}),f.jsx(B1,{}),f.jsx(Qo,{}),f.jsx(hS,{}),f.jsx(km,{value:e,campaign:t,onSelect:r=>{n(io(r))},triggerButtonClassName:"w-full",tooltipContent:"Choose the room to view/edit"}),f.jsx("div",{className:"h-1 w-full"}),f.jsx(oS,{}),f.jsx(rS,{}),f.jsx("div",{className:"h-half w-full"}),f.jsx(fS,{}),f.jsx(pS,{})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full pt-1",children:"Edit"}),f.jsxs("div",{className:Ae,children:[f.jsx(nS,{}),f.jsx(mS,{})]}),f.jsx(lS,{}),f.jsx(Qo,{}),f.jsx(QC,{}),f.jsx(SP,{}),f.jsx("div",{className:"h-1 w-full"}),f.jsxs("div",{className:"flex flex-row justify-between flex-wrap gap-x-2",children:[f.jsx(tS,{}),f.jsx(cS,{}),f.jsx(TP,{})]})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full pt-1",children:"Blocks"}),f.jsx($,{itemTool:{type:"block",config:{style:"organic"}},shortcutKeys:["B"],tooltipContent:`## Block 
The basic block`,children:f.jsx("span",{className:`sprite texture-block_organic ${U}`})}),f.jsx($,{itemTool:{type:"block",config:{style:"organic",disappearing:{on:"stand"}}},shortcutKeys:["B"],tooltipContent:`## Block 
Disappearing basic block`,children:f.jsx(Vo,{iconClassName:ye("texture-block_organic_disappearing")})}),f.jsx($,{itemTool:{type:"block",config:{style:"artificial"}},shortcutKeys:["B"],tooltipContent:`## Block 
Basic block with a metallic look`,children:f.jsx("span",{className:`sprite texture-block_artificial ${U}`})}),f.jsx($,{itemTool:{type:"block",config:{style:"artificial",disappearing:{on:"stand"}}},shortcutKeys:["B"],tooltipContent:`## Block 
Disappearing metallic look block`,children:f.jsx(Vo,{iconClassName:ye("texture-block_artificial_disappearing")})}),f.jsx($,{itemTool:{type:"block",config:{style:"tower"}},shortcutKeys:["T"],tooltipContent:`## Tower
Very high block`,children:f.jsx("span",{className:`sprite texture-tower ${U}`})}),f.jsx($,{itemTool:{type:"block",config:{style:"book"}},children:f.jsx("span",{className:`sprite texture-book_x ${U}`})}),f.jsxs(Dr,{children:[f.jsx($,{itemTool:{type:"barrier",config:{axis:"x"}},children:f.jsx("span",{className:`sprite texture-barrier_x ${U}`})}),f.jsx($,{itemTool:{type:"barrier",config:{axis:"y"}},children:f.jsx("span",{className:`sprite texture-barrier_y ${U}`})}),f.jsx($,{itemTool:{type:"barrier",config:{axis:"x",disappearing:{on:"touch"}}},children:f.jsx(Vo,{iconClassName:ye("texture-barrier_x")})}),f.jsx($,{itemTool:{type:"barrier",config:{axis:"y",disappearing:{on:"touch"}}},children:f.jsx(Vo,{iconClassName:ye("texture-barrier_y")})})]})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full",children:"Monsters"}),f.jsx($,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},tooltipContent:`## mojo
the emperors worker bots

patrols randomly in a diagonal pattern`,children:f.jsx("span",{className:`sprite texture-dalek_1 [button:hover_&]:texture-animated-dalek" ${U}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},tooltipContent:`## guard
hovers towards the player on the shortest axis

heels can outrun, but not head

place on a toaster to make a charging guard`,children:f.jsx(Ct,{topClasses:"texture-cyberman_towards [button:hover_&]:texture-cyberman_right",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),f.jsx($,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},tooltipContent:`## monster
moves *back and forth* by default

or can be set to *patrol clockwise*`,children:f.jsx("span",{className:`sprite texture-skiHead_greenAndPink_towards [button:hover_&]:texture-skiHead_greenAndPink_right ${U}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:f.jsx("span",{className:`sprite texture-helicopterBug_1 [button:hover_&]:texture-animated-helicopterBug ${U}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},tooltipContent:`## turtle
plods along in a clockwise pattern`,children:f.jsx("span",{className:`sprite texture-turtle_towards_1 [button:hover_&]:texture-animated-turtle_right ${U}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},tooltipContent:`## homing bot
detects a player in a straight line on an axis and rushes towards them`,children:f.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase_all ${U}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},tooltipContent:`## Computer bot
usually patrols randomly, but can be programmed to move towards the player`,children:f.jsx(Ct,{topClasses:"texture-computerBot_towards [button:hover_&]:texture-computerBot_right"})}),f.jsx($,{itemTool:{type:"monster",config:{which:"bubbleRobot",activated:"on",movement:"patrol-randomly-xy8"}},tooltipContent:`## Bubble bot
patrols randomly in 8 directions

fast and dangerous`,children:f.jsx(Ct,{topClasses:ye("texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"),bottomClasses:ye("texture-headlessBase")})}),f.jsx($,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:f.jsx(Ct,{topClasses:"texture-monkey_towards [button:hover_&]:texture-monkey_right"})}),f.jsx($,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},children:f.jsx(Ct,{topClasses:"texture-elephant_towards [button:hover_&]:texture-elephant_right"})}),f.jsx($,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},tooltipContent:`## Elephant head
Things have gone weird

Stationary, but deadly`,children:f.jsx("span",{className:`sprite texture-elephant_towards [button:hover_&]:texture-elephant_right ${U}`})}),f.jsx($,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",tooltipContent:`## Emperor's Guardian

very dangerous

moves towards the player, unless they have all four planet crowns

does not *like doughnuts*
`,children:f.jsx(Ct,{topClasses:"texture-ball",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),f.jsx($,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},tooltipContent:`## Emperor
The end boss, usually found guarding his Blacktooth crown`,children:f.jsx("span",{className:`sprite texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold ${U}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full",children:"Pickups"}),f.jsxs(Dr,{children:[f.jsx($,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:f.jsx(_t,{iconClasses:"texture-whiteRabbit",text:"2"})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"shield"}},children:f.jsx(_t,{iconClasses:"texture-whiteRabbit",text:""})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"jumps"}},children:f.jsx(_t,{iconClasses:"texture-whiteRabbit",text:""})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"fast"}},children:f.jsx(_t,{iconClasses:"texture-whiteRabbit",text:""})})]}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"bag"}},children:f.jsx("span",{className:`sprite texture-bag ${U}`})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"hooter"}},tooltipContent:`## hooter

head's doughnut firing hooter`,children:f.jsx("span",{className:`sprite texture-hooter ${U}`})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:f.jsx("span",{className:`sprite texture-doughnuts ${U}`})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"reincarnation"}},children:f.jsx("span",{className:`sprite texture-fish_1 [button:hover_&]:texture-animated-fish ${U}`})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:f.jsx("span",{className:`sprite texture-crown_blacktooth ${U}`})}),f.jsx($,{itemTool:{type:"pickup",config:{gives:"scroll",source:"inline",markdown:`#Write me

TODO: Put content here`}},children:f.jsx("span",{className:`sprite texture-scroll ${U}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full",children:"deadly"}),f.jsxs(Dr,{children:[f.jsx($,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},tooltipContent:"## Volcano",shortcutKeys:["V"],children:f.jsx("span",{className:`sprite texture-volcano_1 [button:hover_&]:texture-animated-volcano ${U}`})}),f.jsx($,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},tooltipContent:`## Toaster

charging stations for the Emperor's Guardians`,children:f.jsx("span",{className:`sprite texture-toaster_off ${U}`})})]}),f.jsx($,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},tooltipContent:`## Spiky ball
rolls fast if pushed

deadly to touch`,children:f.jsx("span",{className:`sprite texture-spikyBall_1 [button:hover_&]:texture-spikyBall_2 ${U}`})}),f.jsx($,{itemTool:{type:"spikes",config:fe},tooltipContent:`## spikes

deadly to touch on top

safe to run into the sides`,children:f.jsx("span",{className:`sprite texture-spikes ${U}`})}),f.jsx($,{itemTool:{type:"moveableDeadly",config:{style:"deadFish"}},tooltipContent:`## dead fish

(deadly to touch)

dead fish decompose very quickly and it rapidly
turns so poisonous that a single lick can kill`,children:f.jsx("span",{className:`sprite texture-fish_1 ${U}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full",children:"control"}),f.jsx($,{itemTool:{type:"charles",config:fe},children:f.jsx(Ct,{topClasses:"texture-charles_towards [button:hover_&]:texture-charles_right"})}),f.jsx($,{itemTool:{type:"joystick",config:{controls:["charles"]}},tooltipContent:`## Joystick
Controls one or more Charles bots

Change *which* Charles in the json`,children:f.jsx("span",{className:`sprite texture-joystick ${U}`})}),f.jsx($,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:vs}},tooltipContent:`## Switch
toggles when touched.

edit the json to choose:

* de/activate monsters
* turn on/off moving platforms
* make blocks disappear on touch`,children:f.jsx("span",{className:`sprite texture-switch_left [button:hover_&]:texture-switch_right ${U}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full",children:"movable"}),f.jsx($,{itemTool:{type:"spring",config:{}},children:f.jsx("span",{className:`sprite texture-spring_released [button:hover_&]:texture-spring_compressed ${U}`})}),f.jsxs(Dr,{children:[f.jsx($,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:f.jsx("span",{className:`sprite texture-cube ${U}`})}),f.jsx($,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:f.jsx("span",{className:`sprite texture-drum ${U}`})}),f.jsx($,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:f.jsx("span",{className:`sprite texture-sticks ${U}`})})]}),f.jsx($,{itemTool:{type:"pushableBlock",config:{}},children:f.jsx("span",{className:`sprite texture-stepStool ${U}`})}),f.jsx($,{itemTool:{type:"ball",config:fe},children:f.jsx("span",{className:`sprite texture-ball ${U}`})}),f.jsx($,{itemTool:{type:"slidingBlock",config:{style:"puck"}},tooltipContent:`## Sliding puck

Small item that can be stood on and slides when touched`,children:f.jsx("span",{className:`sprite texture-puck ${U}`})}),f.jsx($,{itemTool:{type:"slidingBlock",config:{style:"book"}},tooltipContent:`## Sliding book

Why are the books slippery?`,children:f.jsx("span",{className:`sprite texture-book_y ${U}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full",children:"misc."}),f.jsxs($,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[f.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_static ${U} [button:active_&]:top-oneScaledPix`}),f.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_1 [button:hover_&]:texture-animated-lift ${U} [button:active_&]:top-oneScaledPix`})]}),f.jsxs(Dr,{children:[f.jsx($,{itemTool:{type:"conveyor",config:{direction:"away"}},children:f.jsx(_t,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-conveyor_y",text:""})}),f.jsx($,{itemTool:{type:"conveyor",config:{direction:"towards"}},children:f.jsx(_t,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-reversed-conveyor_y",text:""})}),f.jsx($,{itemTool:{type:"conveyor",config:{direction:"left"}},children:f.jsx(_t,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-conveyor_x",text:""})}),f.jsx($,{itemTool:{type:"conveyor",config:{direction:"right"}},children:f.jsx(_t,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-reversed-conveyor_x",text:""})})]}),f.jsx($,{itemTool:{type:"teleporter",config:{toRoom:"to?",toPosition:le}},children:f.jsx("span",{className:`sprite texture-teleporter ${U}`})}),f.jsx($,{itemTool:{type:"movingPlatform",config:{movement:"clockwise",activated:"on",startDirection:"towards"}},tooltipContent:`## Moving Platform
Clockwise or back-and-forth

Can be (de)activated by a switch, or touch 

Why a sandwich?`,children:f.jsx("span",{className:`sprite texture-sandwich ${U}`})}),f.jsx($,{itemTool:{type:"hushPuppy",config:{}},children:f.jsx("span",{className:`sprite texture-hushPuppy ${U}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full",children:"Structure"}),f.jsx(uS,{}),f.jsx(dS,{}),f.jsx($,{itemTool:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:{x:1,y:1}}},children:f.jsx("span",{className:`sprite texture-blacktooth_floor ${U}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full",children:"Player"}),f.jsx($,{itemTool:{type:"player",config:{which:"head"}},tooltipContent:`## Head

Place on of these into one room

This is where head will start the game`,children:f.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${U}`})}),f.jsx($,{itemTool:{type:"player",config:{which:"heels"}},tooltipContent:`## Heels

Place on of these into one room

This is where head will start the game`,children:f.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${U}`})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full",children:"NPCs"}),f.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"head",startDirection:"towards"}},tooltipContent:`##NPC head
Citizens of Freedom

stand around not doing much`,children:f.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${U}`})}),f.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"heels",startDirection:"towards"}},tooltipContent:`##NPC heels
Citizens of Freedom

stand around not doing much`,children:f.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${U}`})}),f.jsx($,{itemTool:{type:"sceneryPlayer",config:{which:"headOverHeels",startDirection:"towards"}},tooltipContent:`##NPC head over heels
Citizens of Freedom

stand around not doing much`,children:f.jsx(Ct,{topClasses:"texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right",bottomClasses:"texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right"})})]}),f.jsxs("div",{className:Ae,children:[f.jsx(O,{className:"w-full pt-2",children:"debug"}),f.jsx(KC,{})]})]})},br=(t,e)=>({get bottomCentre(){return this.c000},get topLeft(){return this.c101},get topRight(){return this.c011},get c000(){return G(t)},get c001(){return G(D(t,{z:e.z}))},get c010(){return G(D(t,{y:e.y}))},get c011(){return G(D(t,{y:e.y,z:e.z}))},get c100(){return G(D(t,{x:e.x}))},get c101(){return G(D(t,{x:e.x,z:e.z}))},get c110(){return G(D(t,{x:e.x,y:e.y}))},get c111(){return G(D(t,e))},projectCorner(n){return G(D(t,{x:n.x*e.x,y:n.y*e.y,z:n.z*e.z}))}}),Zi=1e-5,yd=-1,Fr=(t,e,n,r,o)=>r-o>t&&n<e-o,IP=0,pg=1,mg=2,gg=3,jP=(t,e,n,r)=>{const{topLeft:o,topRight:s,bottomCentre:i}=br(t,e),{topLeft:a,topRight:l,bottomCentre:c}=br(n,r),u=o.x,d=s.x,h=a.x,p=l.x,g=Fr(u,d,h,p,Zi),y=s.y-s.x/2,v=i.y-i.x/2,w=l.y-l.x/2,x=c.y-c.x/2,b=Fr(y,v,w,x,Zi),_=o.y+o.x/2,S=i.y+i.x/2,k=a.y+a.x/2,C=c.y+c.x/2,M=Fr(_,S,k,C,Zi);return b&&M&&g?pg:M&&g&&Fr(y,v,w,x,yd)?mg:b&&g&&Fr(_,S,k,C,yd)?gg:IP},$P=(t,e,n,r)=>{for(const o of Ay){const s=t[o],i=s+e[o],a=n[o],l=a+r[o];if(i<=a)return 1*(o==="z"?-1:1);if(s>=l)return-1*(o==="z"?-1:1)}return vd(n)-vd(t)},NP=(t,e)=>{if(t.fixedZIndex!==void 0||e.fixedZIndex!==void 0)return 0;const n=t.renderAabb||t.aabb,r=e.renderAabb||e.aabb,o=t.renderAabbOffset?D(t.state.position,t.renderAabbOffset):t.state.position,s=e.renderAabbOffset?D(e.state.position,e.renderAabbOffset):e.state.position;switch(jP(o,n,s,r)){case pg:return $P(o,n,s,r);case mg:return jt(o.y,s.y+r.y)&&jt(o.z,s.z+r.z)?1:jt(s.y,o.y+n.y)&&jt(s.z,o.z+n.z)?-1:0;case gg:return jt(o.x,s.x+r.x)&&jt(o.z,s.z+r.z)?1:jt(s.x,o.x+n.x)&&jt(s.z,o.z+n.z)?-1:0;default:return 0}},vd=t=>t.x+t.y-t.z,MP=(t,e,n,r)=>(t.has(e)||t.set(e,new Map),t.get(e).set(n,r),t),es=(t,e,n)=>{const r=t.get(e);return r!==void 0&&(r.delete(n),r.size===0&&t.delete(e)),t},yg=(t,e=new Set(ys(t)),n=new Map)=>{const r=new Map;for(const[o,s]of n)if(!t[o])n.delete(o);else for(const[i]of s)t[i]||es(n,o,i);for(const o of e)if(o.fixedZIndex===void 0)for(const s of ys(t)){if(s.fixedZIndex!==void 0||r.get(s)?.has(o)||o===s)continue;const i=NP(o,s);if(r.has(o)||r.set(o,new Set),r.get(o).add(s),i===0){es(n,o.id,s.id),es(n,s.id,o.id);continue}const a=i>0?o.id:s.id,l=i>0?s.id:o.id;MP(n,l,a,!1),es(n,a,l)}return n},vg=t=>{for(const[,l]of t)for(const[c]of l)l.set(c,!1);const e=Array.from(zP(t));let n=e.length,r=n;const o=new Array(n),s={},i=DP(e);for(;r--;)s[r]||a(e[r],r,new Set,null);return o;function a(l,c,u,d){if(u.has(l)){if(d!==null){const g=t.get(d);g?.has(l)&&g.set(l,!0)}return}if(s[c])return;s[c]=!0;const h=t.get(l),p=Array.from(h?.entries()??va);if(c=p.length){u.add(l);do{const[g,y]=p[--c];y||a(g,i.get(g),u,l)}while(c);u.delete(l)}o[--n]=l}};function zP(t){const e=new Set;for(const[n,r]of t.entries()){e.add(n);for(const o of r.keys())e.add(o)}return e}function DP(t){const e=new Map;for(let n=0,r=t.length;n<r;n++)e.set(t[n],n);return e}class LP{constructor(e,n){this.renderContext=e,this.appearance=n,this.output=new ne({label:"AppearanceRenderer"})}#e;output;destroy(){this.output.destroy({children:!0})}tick(e){const n=this.appearance({renderContext:this.renderContext,currentRendering:this.#e,tickContext:e});n!=="no-update"&&(this.output.children.at(0)!==n.output&&(this.#e?.output&&(this.output.removeChild(this.#e.output),this.#e.output.destroy({texture:!0,children:!0})),n.output!==void 0&&this.output.addChild(n.output)),this.#e=n)}}class wg extends LP{}const wd=(t,e)=>{e.poly([G({}),G({x:t.x}),G({x:t.x,y:t.y}),G({y:t.y})]).poly([G({}),G({z:t.z}),G({y:t.y,z:t.z}),G({y:t.y})]).poly([G({x:t.x}),G({x:t.x,z:t.z}),G(t),G({x:t.x,y:t.y})]).poly([G({z:t.z}),G({x:t.x,z:t.z}),G({x:t.x,y:t.y,z:t.z}),G({y:t.y,z:t.z})])},bd=(t,e)=>{const n=new ht;return wd(t,n),n.stroke({width:.5,color:e,alpha:1}),n.eventMode="static",n.on("pointerenter",()=>{n.fill({color:e,alpha:.5})}),n.on("pointerleave",()=>{n.clear(),wd(t,n),n.stroke({width:.5,color:e,alpha:1})}),n},BP={head:"rgba(255,184,0)",wall:"rgba(128,200,0)",portal:"rgba(255,0,255)",pickup:"rgba(0,196,255)",emitter:"rgba(0,255,255)",stopAutowalk:"rgba(255,128,128)",floatingText:"rgba(128,0,255)"};class FP{constructor(e){this.renderContext=e;const{item:n}=e,r=BP[n.type]??"rgba(255,255,255)";if(this.#e=new ne({label:`ItemBoundingBoxRenderer ${n.id}`}),yo("portal")(n)){const s=G(n.config.relativePoint);this.#e.addChild(new ht().circle(s.x,s.y,5).stroke(r)),this.#e.addChild(new ht().circle(s.x,s.y,2).fill(r))}if(this.#e.addChild(new ht({label:"objectOrigin"}).circle(0,0,2).fill(r)),this.#e.addChild(bd(n.aabb,r)),n.renderAabb){const s="rgba(184, 184, 255)",i=bd(n.renderAabb,s);if(n.renderAabbOffset){const a=G(n.renderAabbOffset);i.position.set(a.x,a.y),i.circle(0,0,2).fill(s)}this.#e.addChild(i)}this.#e.eventMode="static";let o;this.#e.on("pointerenter",()=>{if(o!==void 0)return;const s=`${n.id} ${n.type}
@(${n.state.position.x}, ${n.state.position.y}, ${n.state.position.z})}
#(${n.aabb.x}, ${n.aabb.y}, ${n.aabb.z})}`;this.#e.addChild(o=new Pw({text:s,style:{fill:r,fontSize:6,fontFamily:"Menlo"}})),o.resolution=4}),this.#e.on("pointerleave",()=>{o!==void 0&&(this.#e.removeChild(o),o=void 0)}),e.frontLayer.attach(this.#e)}#e;tick(){}destroy(){this.#e.destroy({children:!0})}get output(){return this.#e}}class UP extends Pn{constructor(...e){const[n]=e;super(n)}destroy(e){const n=this.texture!==null;typeof e=="boolean"?super.destroy({texture:n,textureSource:e,children:e}):super.destroy({...e,texture:n})}}const HP={Container:"",Sprite:"",UniqueTextureSprite:"",Graphics:"",Text:"",AnimatedSprite:"",TilingSprite:"",BitmapText:"",Mesh:"",NineSliceSprite:""},As=(t,e="",n=!0,r=!0,o=[])=>{const s=[];r&&s.push("");const i=t.constructor.name,a=i.startsWith("_")?i.slice(1):i;let l=HP[a]||"";o.forEach((p,g)=>{p.mask===t&&(g===0?l+="":l+=`^${g+1}`)});const c=t.label&&t.label!==a?` "${t.label}"`:"",u=[];try{(t.x!==0||t.y!==0)&&u.push(`@(${t.x}, ${t.y})`)}catch{u.push("@(ERROR)")}if(t.children.length>2&&u.push(`children: ${t.children.length}`),t.visible||u.push("hidden"),t.alpha<1&&u.push(`alpha: ${t.alpha.toFixed(2)}`),t.mask&&u.push(" masked"),t instanceof Pn){const p=t;if(p.texture===null||p.texture===void 0)u.push("texture: NO TEXTURE");else{const g=p.texture.label||"(anon texture)";u.push(`texture: "${g}"`)}}const d=r?"":e+(n?" ":" ");if(s.push(`${d}${l} ${a}${c}`),u.length>0){const p=t.children.length>0,g=r?p?"  ":"   ":e+(n?"    ":"   ")+(p?"  ":"   ");u.forEach(y=>{s.push(`${g} ${y}`)})}const h=r?"":e+(n?"    ":"   ");return t.children.forEach((p,g)=>{const y=g===t.children.length-1;s.push(As(p,h,y,!1,[t,...o]))}),s.join(`
`)+(r?`
`:"")},WP=(t,e,n)=>{const r=e.getLocalBounds(),o=Math.ceil(r.maxX-r.minX),s=Math.ceil(r.maxY-r.minY),i=n!==void 0?n.width===o&&n.height===s:!1,a=i?n:Fs.create({width:o,height:s,antialias:!1,autoGenerateMipmaps:!1});a.label=`renderTexture of ${e.label??"(anon)"}`,n&&!i&&n.destroy();const{x:l,y:c}=e;e.x-=r.minX,e.y-=r.minY;try{t.render({container:e,target:a,clear:i})}catch(u){throw new Error(`renderContainerToTexture: failed to render to texture. Container:
 ${As(e)}`,{cause:u})}return e.x=l,e.y=c,a},xr=(t,e,n,r)=>{const o=e.getLocalBounds(),s=n?.texture&&n?.texture instanceof Fs?n.texture:void 0,i=WP(t,e,s),a=n||new UP;return a.texture=i,a.label=r??`sprite of container (${e.label})`,a.pivot={x:Math.floor(-o.minX),y:Math.floor(-o.minY)},a},ko=(t,e)=>e instanceof Pn?e:xr(t,e),bg=new xw;bg.matrix=[0,0,0,1,0,0,.3,0,0,0,0,0,.3,0,0,0,0,0,1,0];class GP{constructor(e,n){this.renderContext=e,this.wrappedRenderer=n,this.output=new ne({label:`ItemPositionRenderer ${e.item.id}`,children:[n.output]}),this.#t()}output;#e=new Map;#t(){const e=G(this.renderContext.item.state.position);this.output.x=e.x,this.output.y=e.y}tick(e){this.wrappedRenderer?.tick(e),e.movedItems.has(this.renderContext.item)&&this.#t(),this.#s()}#n(){const e=this.renderContext.item.id,n=this.renderContext.zEdges.get(e);if(!n)return va;let r;for(const[o,s]of n)s&&(r||(r=new Set),r.add(o));return r??va}#r(e,n){const r=new ne({label:`maskWith: ${e}`,children:[n,this.output.children[0]]});return this.output.addChild(r),r.setMask({mask:n,inverse:!0}),this.#e.set(e,r),r}#o(e,n){const[r,o]=n.children,s=n.parent;s.removeChild(n),s.addChild(o),n.mask=null,r.destroy(),n.destroy(),this.#e.delete(e)}#s(){const{pixiRenderer:e}=this.renderContext.general,n=this.#n();for(const r of this.#e.keys())if(!n.has(r)){const o=this.#e.get(r);if(o)try{this.#o(r,o)}catch(s){throw new Error(`error while destroying masking container ${As(o)} 
              for our rendering: ${As(this.output)}`,{cause:s})}}for(const r of n){const o=this.#e.get(r),s=o?.children[0],i=this.renderContext.getItemRenderPipeline(r)?.itemAppearanceRenderer?.output;if(i===void 0)throw new Error("nothing to use as a mask");const a=i.filters;i.filters=bg;const l=xr(e,i,s,`red mask: ${r}`);i.filters=a,o===void 0&&this.#r(r,l);const c=this.renderContext.room.items[r],u=Vt(G(c.state.position),G(this.renderContext.item.state.position));l.x=u.x,l.y=u.y}}destroy(){this.output.destroy({children:!0}),this.wrappedRenderer?.destroy()}}const xd={x:.5,y:1},_d=t=>typeof t!="string"&&Object.hasOwn(t,"animationId"),tl=t=>{if(typeof t=="string")return tl({textureId:t});{const{anchor:e,flipX:n,pivot:r,x:o,y:s,filter:i,times:a,label:l}=t;if(t.times){const u=Th(a);if(zs(u)>=2){const h=new ne({label:l??"timesXyz"});for(let{x:p}=u;p>=1;p--)for(let{y:g}=u;g>=1;g--)for(let y=1;y<=u.z;y++){const v={...t,textureId:t.textureId??t.textureIdCallback?.(p-1,g-1,y-1),label:`(${p},${g},${y})`};delete v.times;const w=tl(v),x=Sn({x:p-1,y:g-1,z:y-1});w.x+=x.x,w.y+=+x.y,h.addChild(w)}return h}}let c;if(_d(t))c=qP(t);else{const u=t.textureId??t.textureIdCallback?.(0,0,0);c=new Pn(qt().textures[u])}if(e===void 0&&r===void 0)if(_d(t))c.anchor=xd;else{const u=t.textureId??t.textureIdCallback?.(0,0,0),d=qt().data.frames[u];if(d===void 0)throw new Error(`no spritesheet entry for textureId "${u}"`);const h=d.frame;h.pivot!==void 0?c.pivot=h.pivot:c.anchor=xd}else e!==void 0&&(c.anchor=e),r!==void 0&&(c.pivot=r);return o!==void 0&&(c.x=o),s!==void 0&&(c.y=s),i!==void 0&&(c.filters=i),l!==void 0&&(c.label=l),c.eventMode="static",n===!0&&(c.scale.x=-1),c}},q=tl;function qP({animationId:t,reverse:e,playOnce:n,paused:r,randomiseStartFrame:o}){const s=qt().animations[t],a=(r?[s[0]]:s).map(c=>({texture:c,time:Ry}));e&&a.reverse();const l=new fr(a);return l.animationSpeed=En.animations[t].animationSpeed,l.gotoAndPlay(o?Math.floor(Math.random()*a.length):0),n!==void 0&&(l.loop=!1,l.onComplete=()=>{l.stop(),n==="and-destroy"&&(l.visible=!1)}),l}const ai=(t,e)=>{const n=e&&{x:e.x??1,y:e.y??1};return q({...typeof t=="string"?{textureId:t}:t,times:n})},zt=t=>Ie(({renderContext:{item:e}})=>Oh(e)?q({...typeof t=="string"?{textureId:t}:t,times:xl(e)}):q(t)),Ye=t=>Ie(({renderContext:{item:e,general:{pixiRenderer:n}}})=>{if(Oh(e))return ko(n,ai(t,xl(e)));{const r=q(t);return r instanceof Pn?r:xr(n,r)}}),Ie=t=>({renderContext:e,currentRendering:n,tickContext:r})=>n===void 0?{output:t({renderContext:e,currentRendering:void 0,tickContext:r}),renderProps:fe}:"no-update",Dt=t=>({renderContext:{general:{pixiRenderer:e},item:n},currentRendering:r})=>{if(r===void 0){const o=xl(n),s={output:ko(e,ai(t(n.config),o)),renderProps:fe};return o&&(s.output.y-=((o.z??1)-1)*V.h),s}else return"no-update"},Po=(t,e)=>vt(Ls(t)).map(n=>{const r=e.items[n];if(r===void 0)throw new Error(`item in stoodOnBy "${n}" is not in the room`);return r});yo("head");const VP=yo("heels"),KP=yo("headOverHeels"),XP=t=>{if(VP(t))return t.state;if(KP(t))return t.state.heels},JP=1e3/25,xg=t=>{const e=En.animations[t],n=e.length,{animationSpeed:r}=e;return n*JP/r};xg("bubbles.white");xg("head.fadeOut");const ac=({config:{activatedOnStoreValue:t}})=>t===void 0?!0:hl(W.getState(),t),YP=({renderContext:{general:{pixiRenderer:t},item:e,room:n},currentRendering:r})=>{const{state:{stoodOnBy:o},config:{times:s}}=e,i=r?.renderProps,a=ac(e),l=a&&Po(o,n).find(_l)!==void 0;return i===void 0||a!==i.activated||l!==i.flashing?{output:ko(t,ai({textureId:l?"shadowMask.teleporter.flashing":a?"shadowMask.teleporter":"shadowMask.fullBlock"},s)),renderProps:{flashing:l,activated:a}}:"no-update"},Qi=(t,e=1)=>({renderContext:{item:{state:{facing:n}}},currentRendering:r})=>{const o=r?.renderProps,s=fl(n)??"towards";if(!(o===void 0||s!==o.facingXy4))return"no-update";const a=q(s==="left"||s==="away"?`shadowMask.${t}.away`:`shadowMask.${t}.right`);return a.y=-(V.h*(e-1)),a.scale.x=s==="away"||s==="right"?1:-1,{output:a,renderProps:{facingXy4:s}}},Cd={lift:Ye("shadowMask.smallBlock"),conveyor:Dt(({direction:t})=>({textureId:"shadowMask.conveyor",flipX:Kt(t)==="x"})),doorLegs:Dt(({direction:t})=>({textureId:t==="right"||t==="towards"?"shadowMask.door.floatingThreshold.double.y":"shadowMask.door.legs.threshold.double.y",flipX:Kt(t)==="y"})),teleporter:YP,floor:"no-mask",barrier:Dt(({axis:t})=>({textureId:"shadowMask.barrier.y",flipX:t==="x"})),spring:Ye("shadowMask.smallRound"),block:Dt(({style:t})=>t==="tower"?"shadowMask.tower":"shadowMask.fullBlock"),pushableBlock:Ye("shadowMask.stepStool"),movingPlatform:Ye("shadowMask.fullBlock"),hushPuppy:Ye("shadowMask.hushPuppy"),portableBlock:Dt(({style:t})=>t==="drum"?"shadowMask.smallRound":"shadowMask.smallBlock"),slidingBlock:Dt(({style:t})=>t==="book"?"shadowMask.fullBlock":"shadowMask.smallRound"),deadlyBlock:Dt(({style:t})=>t==="volcano"?"shadowMask.volcano":"shadowMask.toaster"),spikes:Ye("shadowMask.spikes"),switch:Ye("shadowMask.switch"),pickup:Dt(({gives:t})=>{switch(t){case"scroll":return"shadowMask.scroll";case"doughnuts":return"shadowMask.doughnuts";case"fast":case"extra-life":case"jumps":case"shield":return"shadowMask.whiteRabbit";default:return"blank"}}),slidingDeadly:Ye("shadowMask.smallRound"),ball:Ye("shadowMask.ball"),"monster.dalek":Ye("shadowMask.dalek"),"monster.turtle":Qi("turtle"),"monster.skiHead":Qi("skiHead"),"monster.homingBot":Ye("shadowMask.smallRound"),joystick:Ye("shadowMask.joystick"),charles:Qi("charles",2)},ZP=t=>{switch(t.type){case"monster":return Cd[`monster.${t.config.which}`];case"floor":return t.config.floorType==="none"?void 0:"no-mask";default:return Cd[t.type]}},QP=new ww({alpha:1-Qr});class eE{constructor(e,n){if(this.renderContext=e,this.#e.filters=QP,n!=="no-mask")if(this.#n=new wg(e,n),e.item.shadowOffset===void 0)this.#e.addChild(this.#n.output);else{const r=new ne({label:"shadowMaskOffset",...G(e.item.shadowOffset),children:[this.#n.output]});this.#e.addChild(r)}this.#e.addChild(this.#t)}#e=new ne({label:"ItemShadowRenderer"});#t=new ne({label:"shadows"});#n;#r={};get#o(){return W.getState().gameMenus.userSettings.displaySettings.showShadowMasks}#s(e){if(this.#n===void 0)return;const n=this.#n.output.children.at(0);this.#n.tick(e);const r=this.#n.output.children.at(0);if(r===void 0||!(r instanceof Pn)){const{item:o}=this.renderContext;throw new Error(`ItemShadowRenderer: this.#shadowMaskRenderer didn't create a sprite for item "${o.id}" of type "${o.type}". Have got ${r}`)}n!==r&&(this.#o?this.renderContext.frontLayer.attach(r):this.#e.mask=r)}destroy(){this.#e.destroy(!0),this.#n?.destroy();for(const e of Object.values(this.#r))e.sprite.destroy()}tick(e){if(this.#t.parent===null)throw new Error("shadow container not in scene graph");const{movedItems:n,progression:r}=e,{item:o,general:{pixiRenderer:s},room:i}=this.renderContext,a=n.has(o),l=o.state.position.z+o.aabb.z,c=$e(i.items).filter(function(p){return p.shadowCastTexture!==void 0}),u=Object.groupBy(c,h=>{const p=this.#r[h.id]!==void 0,g=n.has(h);if(!a&&!g)return p?"keepUnchanged":"noShadow";if(h.castsShadowWhileStoodOn||h.state.position.z>o.state.position.z+o.aabb.z){const y={id:o.id,state:{position:{...o.state.position,z:l}},aabb:{...o.aabb,z:oi}};if(ii(y,h))return p?"update":"create"}return"noShadow"});for(const h of Oc(u.keepUnchanged,u.update))this.#r[h.id].renderedOnProgression=r;if(u.create)for(const h of u.create){const{times:p}=h.config,g=ko(s,ai(h.shadowCastTexture,p));g.label=h.id,this.#t.addChild(g),this.#r[h.id]={sprite:g,renderedOnProgression:r}}for(const h of Oc(u.create,u.update)){const{sprite:p}=this.#r[h.id],g=G({...Zr(Vt(h.state.position,o.state.position),h.shadowOffset??ir),z:o.aabb.z});p.x=g.x,p.y=g.y}for(const[h,{sprite:p,renderedOnProgression:g}]of Ch(this.#r))g!==r&&(p.destroy(),delete this.#r[h]);const d=(u.keepUnchanged?.length??0)+(u.update?.length??0)+(u.create?.length??0)>0;this.#e.visible=d,d&&this.#s(e)}get output(){return this.#e}}const tE=t=>{const e=ZP(t.item);return e===void 0?void 0:new eE(t,e)};class nE{constructor(e,n){this.renderContext=e,this.componentRenderers=n,this.output={graphics:n.graphics?.output,sound:n.sound?.output}}output;tick(e){this.componentRenderers.graphics?.tick(e),this.componentRenderers.sound?.tick(e)}destroy(){this.componentRenderers.graphics?.destroy(),this.componentRenderers.sound?.destroy()}}const de=new window.AudioContext,nl=()=>{throw new Error(`sounds not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`)},je=t=>{const e=typeof t=="string"?{soundId:t}:t,{playbackRate:n=1,soundId:r,connectTo:o,loop:s=!1,varyPlaybackRate:i=!1,randomiseStartPoint:a=!1}=e,l=de.createBufferSource(),c=nl()[r];return l.buffer=c,l.loop=s,l.playbackRate.value=i?n-.05+Math.random()*.1:n,s&&a?l.start(0,c.duration*Math.random()):l.start(),o!==void 0&&l.connect(o),l},qn=(t,e,n)=>{const r=de.createGain();return e!==void 0&&(r.gain.value=e),t.connect(r),r.connect(n),r},Fe=({start:t,change:e,loop:n,stop:r,startAndLoopTogether:o=!1,noStartOnFirstFrame:s=!0},i)=>{let a=!0,l,c;return u=>{if(!!u!=!!c)u?t!==void 0&&!(a&&s)?(l?.stop(),l=je({...t}),qn(l,t.gain,i),n!==void 0&&(o?(l=je({...n,loop:!0}),qn(l,n.gain,i)):l.onended=()=>{c&&(l=je({...n,loop:!0}),qn(l,n.gain,i))})):n!==void 0&&(l=je({...n,loop:!0}),qn(l,n.gain,i)):(l&&l.loop&&(l.stop(),l.onended=null),r!==void 0&&(l=je({...r}),qn(l,r.gain,i)));else if(c!==u&&e!==void 0){const h=je({...e});qn(h,e.gain,i)}a=!1,c=u}};class rE{constructor(e){this.renderContext=e,this.output.gain.value=4}output=de.createGain();#e=Fe({loop:{soundId:"rollingBallLoop",playbackRate:.5}},this.output);tick(){const{renderContext:{item:{state:{vels:{sliding:e},standingOnItemId:n}}}}=this,r=(e.x!==0||e.y!==0)&&n!==null;this.#e(r)}destroy(){}}class oE{constructor(e){this.renderContext=e;const{item:{config:{was:n}}}=e;switch(n.type){case"pickup":{n.gives!=="scroll"&&je({soundId:"bonus",connectTo:this.output});break}case"disappearing":{je({soundId:"destroy",connectTo:this.output});break}case"hushPuppy":{this.output.gain.value=.5,je({soundId:"hushPuppyVanish",connectTo:this.output});break}}}output=de.createGain();tick(){}destroy(){}}class lc{constructor(e,n,r=1){this.renderContext=e,this.#e=Fe({start:n},this.output),this.output.gain.value=r}output=de.createGain();#e;tick({lastRenderRoomTime:e}){const{renderContext:{item:n}}=this,{state:{collidedWith:{roomTime:r,by:o}}}=n,s=r>(e??Ee)&&!Fh(Ls(o));this.#e(s)}destroy(){}}class sE{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#e.gain.value=.5,this.#n=new lc(e,{soundId:"metalHit"},.3),this.#n.output.connect(this.output)}output=de.createGain();#e=de.createGain();#t=Fe({start:{soundId:"servoStart",playbackRate:.5},loop:{soundId:"servoLoop",playbackRate:.5},stop:{soundId:"servoStop",playbackRate:.5}},this.#e);#n;tick(e){const{renderContext:{item:n,room:{roomTime:r,items:o}}}=this,{state:{actedOnAt:{roomTime:s,by:i}}}=n,a=r===s&&vt(Ls(i)).some(l=>Ih(o[l]));this.#t(a),this.#n.tick(e)}destroy(){}}const Eo=t=>{for(const e in t)return!0;return!1},ea=2;class iE{constructor(e){this.renderContext=e}output=de.createGain();#e=Fe({start:{soundId:"conveyorStart",playbackRate:ea},loop:{soundId:"conveyorLoop",playbackRate:ea},stop:{soundId:"conveyorEnd",playbackRate:ea}},this.output);tick(){const{renderContext:{item:{state:{stoodOnBy:e}}}}=this,n=Eo(e);this.#e(n)}destroy(){this.#e(!1)}}const aE=3;class lE{constructor(e){this.renderContext=e,this.output.gain.value=.7}output=de.createGain();#e=je({soundId:"helicopter",loop:!0,connectTo:this.output});tick(){const{renderContext:{item:{state:{vels:{lift:{z:e}}}}}}=this;this.#e.playbackRate.value=Math.max(.5,1+aE*e)}destroy(){}}const Sd={skiHead:{soundId:"softBump"},turtle:{soundId:"softBump"},dalek:{soundId:"metalHit"},homingBot:{soundId:"metalHit"},computerBot:{soundId:"metalHit"}},kd={cyberman:{soundId:"jetpackTurnaround",gain:1.2},dalek:{soundId:"mojoTurn",gain:.3}},Pd={cyberman:{soundId:"jetpackLoop",gain:.7},emperorsGuardian:{soundId:"jetpackLoop"},dalek:{soundId:"mojoLoop"},bubbleRobot:{soundId:"bubbleRobotLoop"},helicopterBug:{soundId:"helicopter"}},Ed={homingBot:{start:{soundId:"detect"},loop:{soundId:"robotWhirLoop",gain:4},startAndLoopTogether:!0},computerBot:{loop:{soundId:"robotBeepingLoop",randomiseStartPoint:!0,varyPlaybackRate:!0}}};class cE{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#t.connect(this.output),this.#t.gain.value=.66;const{item:{config:{which:n}}}=e;Sd[n]!==void 0&&(this.#o=new lc(e,Sd[n]),this.#o.output.connect(this.output)),kd[n]!==void 0&&(this.#n=Fe({change:kd[n]},this.#e)),Ed[n]!==void 0&&(this.#s=Fe(Ed[n],this.#e)),Pd[n]!==void 0&&(this.#r=Fe({loop:Pd[n]},this.#t))}output=de.createGain();#e=de.createGain();#t=de.createGain();#n;#r;#o;#s;tick(e){const{renderContext:{item:n}}=this,{state:{facing:r,activated:o,busyLickingDoughnutsOffFace:s,vels:{walking:i}}}=n;if(this.#n){const a=Sh(r);this.#n(a)}if(this.#o&&this.#o.tick(e),this.#r){const a=o&&!s;this.#r(a)}if(this.#s){const a=!pl(i,le);this.#s(a)}}destroy(){}}class ta{constructor(e){this.renderContext=e;const{general:{soundSettings:n},item:{type:r}}=e,{noFootsteps:o}={...ml.soundSettings,...n};o||(this.#e=de.createGain(),this.#e.gain.value=2,this.#e.connect(this.output),this.#t=Fe({loop:{soundId:`${r==="headOverHeels"?"heels":r}Walk`}},this.#e)),this.#n.gain.value=.8,this.#n.connect(this.output),this.#i.gain.value=1.2,this.#i.connect(this.output),this.#s.connect(this.output),this.#r=Fe({start:{soundId:`${r==="headOverHeels"?"head":r}Jump`}},this.#n),this.#o=Fe({loop:{soundId:`${r==="headOverHeels"?"head":r}Fall`}},this.#n)}output=de.createGain();#e;#t;#n=de.createGain();#r;#o;#s=de.createGain();#a=Fe({start:{soundId:"landing"},noStartOnFirstFrame:!0},this.#s);#i=de.createGain();#c=Fe({start:{soundId:"carry",playbackRate:.95},stop:{soundId:"carry",playbackRate:1.05}},this.#i);#l={teleportingPhase:null,positionZ:0};tick({lastRenderRoomTime:e}){const{renderContext:{item:n}}=this,{state:{action:r,teleporting:o,jumpStartZ:s,jumped:i,standingOnItemId:a,position:{z:l},vels:{gravity:{z:c}},collidedWith:{roomTime:u,by:d}}}=n,h=XP(n),{teleportingPhase:p,positionZ:g}=this.#l,y=o?o.phase:null,v=i&&l>s&&l>g&&c>0,w=l<g&&c<0&&a===null;this.#o(w),this.#r(v),this.#t!==void 0&&this.#t(!v&&!w&&r==="moving"),h!==void 0&&this.#c(h.carrying!==null);const x=a!==null&&u>(e??Ee)&&d[a];if(this.#a(x),y!==null&&y!==p)if(y==="in"){const b=nl().teleportIn,_=de.createBufferSource();_.buffer=b,_.connect(this.output),_.start()}else{const b=nl().teleportOut,_=de.createBufferSource();_.buffer=b,_.connect(this.output),_.start()}this.#l={teleportingPhase:y,positionZ:l}}destroy(){}}class uE{constructor(e){this.renderContext=e}output=de.createGain();#e=void 0;tick(){const{renderContext:{item:{state:{stoodOnBy:e},config:{style:n}}}}=this;if(n!=="drum")return;const r=this.#e?.stoodOn??!1,o=Eo(e);!r&&o&&je({soundId:"drum",connectTo:this.output}),this.#e={stoodOn:o}}destroy(){}}class dE{constructor(e){this.renderContext=e,this.scrapeBracketed=Fe({loop:{soundId:"stepStoolScraping"}},this.output),this.output.gain.value=.4}output=de.createGain();scrapeBracketed;tick({movedItems:e}){const{renderContext:{item:n,room:{roomTime:r}}}=this,{state:{actedOnAt:{roomTime:o},standingOnItemId:s}}=n,i=r===o&&s!==null&&e.has(n);this.scrapeBracketed(i)}destroy(){}}class hE{constructor(e){this.renderContext=e}output=de.createGain();tick({lastRenderRoomTime:e}){const{renderContext:{item:{state:{stoodOnBy:n,stoodOnUntilRoomTime:r}}}}=this,o=Eo(n);e!==void 0&&r>e&&!o&&je({soundId:"springBoing",connectTo:this.output})}destroy(){}}class fE{constructor(e){this.renderContext=e,this.#e.connect(this.output)}output=de.createGain();#e=de.createGain();#t=void 0;tick(){const{renderContext:{item:{state:{setting:e},config:n}}}=this,r=n.type==="in-store"?hl(W.getState(),n.path)?"right":"left":e,o=this.#t?.setting;o!==void 0&&o!==r&&je({soundId:"switchClick",playbackRate:r==="right"?.95:1.05,connectTo:this.#e}),this.#t={setting:r}}destroy(){}}class pE{constructor(e){this.renderContext=e}output=de.createGain();#e=Fe({loop:{soundId:"teleportWarningSiren"}},this.output);tick(){const{renderContext:{item:e,room:n}}=this;this.#e(ac(e)&&Po(e.state.stoodOnBy,n).some(_l))}destroy(){}}class mE{constructor(e){this.renderContext=e,je({soundId:"hooter",connectTo:this.output})}output=de.createGain();tick(){}destroy(){}}class gE extends lc{constructor(e){super(e,{soundId:"glassClink",varyPlaybackRate:!0},.8),this.renderContext=e}}const yE=(t,e)=>Uh(Po(t.state.stoodOnBy,e).filter(jh));class vE{constructor(e){this.renderContext=e,this.output.gain.value=2}output=de.createGain();#e=void 0;tick(e){const{renderContext:{item:n,room:r}}=this,o=yE(n,r);this.#e!==void 0&&o<this.#e&&je({soundId:"toasterPopUpSoundUrl",connectTo:this.output}),this.#e=o}destroy(){}}const wE={lift:lE,switch:fE,bubbles:oE,head:ta,heels:ta,headOverHeels:ta,teleporter:pE,monster:cE,conveyor:iE,spring:hE,portableBlock:uE,charles:sE,ball:rE,pushableBlock:dE,firedDoughnut:mE,slidingBlock:gE},bE=t=>{if(t.item.type==="deadlyBlock"&&t.item.config.style==="toaster")return new vE(t);const e=wE[t.item.type];if(e)return new e(t)},Td=V.h*-1,Ad=V.h*sg,xE=0,_E=V.w*16,na=(t,e,n)=>(t-e)/(n-e)*2-1;class CE{constructor(e,n){this.renderContext=e,this.childRenderer=n,n.output.connect(this.output),this.output.rolloffFactor=2,this.output.maxDistance=5,this.output.distanceModel="exponential";const r=cg(e.room).floors;this.soundPositionMinX=r.edgeLeftX,this.soundPositionMaxX=r.edgeRightX}output=de.createPanner();soundPositionMinX;soundPositionMaxX;tick(e){this.childRenderer.tick(e);const{item:n}=this.renderContext,r=n.state,o=D(r.position,Ms(n.aabb,.5)),s=na(H1(o),this.soundPositionMaxX,this.soundPositionMinX),i=na(o.z,Td,Ad);if(!Number.isFinite(i))throw new Error(`y position for sound rendering is not finite;
        positionY = numberInRangeToMinus1To1Range(
          itemCentrePosition = ${o.z},
          ${Td},
          ${Ad},
        );
        itemCentrePosition = addXyz(
          itemState.position = ${JSON.stringify(r.position)},
          scaleXyz(${JSON.stringify(n.aabb)}, 0.5),
        )`);const a=na(o.x+o.y,xE,_E);this.output.positionX.value=s,this.output.positionY.value=i,this.output.positionZ.value=a}destroy(){this.childRenderer.destroy()}}const Or=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,SE=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // we know c.a is either 0 or 1, so no need to do a step()

    finalColor = mix(c, vec4(uColour, 1), c.a);
}
`;class Rs extends en{constructor(e){const n=Ot.from({vertex:Or,fragment:SE,name:"oneColour-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uColour:{value:new Float32Array(3),type:"vec3<f32>"}}}});const r=this.resources.colorReplaceUniforms.uniforms,[o,s,i]=e.toArray();r.uColour[0]=o,r.uColour[1]=s,r.uColour[2]=i}}const kE={pureBlack:new H("#000000"),shadow:new H("#1B2D3B"),midGrey:new H("#505A55"),lightGrey:new H("#929981"),white:new H("#F8FEF8"),pastelBlue:new H("#4893FF"),metallicBlue:new H("#1D4E80"),pink:new H("#B973AF"),moss:new H("#6E7B00"),redShadow:new H("#513D40"),midRed:new H("#A7574B"),lightBeige:new H("#BF8E69"),highlightBeige:new H("#DBB269"),alpha:new H("#105A69"),replaceLight:new H("#048662"),replaceDark:new H("#052229")},PE=`#version 300 es
// keep this one at mediump for the hash function's precision
precision mediump float;

in vec2 vTextureCoord;
out vec4 finalColor;

const float LUT_SIZE = 256.0;
const float magicNumber = 31.0; // Small prime number

uniform sampler2D uTexture;
uniform sampler2D uLut;

/** returns in [0, LUT_SIZE] range
this must match the TypeScript version of the hash function*/
float hashColor(vec3 color) {
    vec3 c255 = floor(color * 255.0);
    
    float hash = mod(
        c255.r + c255.g * magicNumber + c255.b * magicNumber * magicNumber, 
        LUT_SIZE
    );
    return hash;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    float h = hashColor(c.rgb);

    // use the hash to look up the replacement in the LUT:
    vec4 replacementColour = texture(
        uLut, 
        vec2(
            // normalise h to [0, 1] range
            (h + 0.5) / LUT_SIZE, 
            0.5
        )
    );
    
    // use original if either: 
    //      original alpha is 0 (because keep transparent)
    //      or lut alpha is 0 (signals nothing in this slot of the LUT)
    finalColor = mix(c, replacementColour, c.a * replacementColour.a);
}
`,Kr=256,ra=31,Rd=new Map;function EE(t){const e=Math.floor(t.red*255),n=Math.floor(t.green*255),r=Math.floor(t.blue*255);return(e+n*ra+r*ra*ra)%Kr}function TE(t){const e=new Float32Array(Kr*4);for(const[o,s]of Oy(t)){const i=N[o],a=EE(i);if(e[a*4+3]>.5)throw new Error("LUT collision - mess with the hash function or lut size until this goes away");e[a*4+0]=s.red,e[a*4+1]=s.green,e[a*4+2]=s.blue,e[a*4+3]=1}const n=new Uint8Array(Kr*4);for(let o=0;o<Kr*4;o++)n[o]=Math.floor(e[o]*255);return Tt.from({resource:n,width:Kr,height:1,scaleMode:"nearest"})}class AE extends en{#e;constructor(e){const n=Object.keys(e).length,r=Ot.from({vertex:Or,fragment:PE,name:"palette-swop-filter"}),o=TE(e);super({glProgram:r,resources:{colorReplaceUniforms:{uOriginal:{value:new Float32Array(3*n),type:"vec3<f32>",size:n},uReplacement:{value:new Float32Array(3*n),type:"vec3<f32>",size:n}},uLut:o.source}}),this.#e=o;const s=this.resources.colorReplaceUniforms.uniforms;Object.entries(e).forEach(([i,a],l)=>{N[i].toArray().forEach((c,u)=>{s.uOriginal[l*3+u]=c}),a.toArray().forEach((c,u)=>{s.uReplacement[l*3+u]=c})})}destroy(e){this.#e?.destroy(!0),this.#e=null,super.destroy(e)}}const RE=t=>Object.entries(t).sort(([e],[n])=>e.localeCompare(n)).map(([e,n])=>`${e}:${n.toHex()}`).join("|"),rn=t=>{const e=RE(t);let n=Rd.get(e);return n||(n=new AE(t),Rd.set(e,n)),n},OE=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uTargetColor;

vec4 black = vec4(0.0, 0.0, 0.0, 1.0);

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // 1 if black, 0 if non-black
    float isBlack = step(length(c.rgb), 0.01);

    // keep original if either:
    //      * black
    //      * transparent

    finalColor = mix(    
        vec4(uTargetColor, 1),    
        c, 
        max(isBlack, 1.0 - c.a)
    );
}
`;class Ue extends en{uniforms;constructor(e="white"){const n=Ot.from({vertex:Or,fragment:OE,name:"revert-colourise-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[n,r,o]=new H(e).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}}const IE=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    finalColor = vec4(c.rgb * 0.5, c.a);
}
`;class jE extends en{constructor(){const e=Ot.from({vertex:Or,fragment:IE,name:"halfbrite-filter"});super({glProgram:e,resources:{}})}}const _g=({basic:t,dimmed:e})=>({replaceLight:t,replaceDark:e}),Cg=({color:{hue:t,shade:e},planet:n})=>{const r=t==="yellow"?e==="dimmed"||n==="jail"?Am:et:ti[t][e].main;return _g(r)},$E=t=>rn({lightBeige:N.lightGrey,redShadow:N.shadow,pink:N.lightGrey,moss:N.lightGrey,midRed:N.midGrey,highlightBeige:N.lightGrey,...t&&Cg(t)}),NE=rn({midGrey:N.midRed,lightGrey:N.lightBeige,white:N.highlightBeige,metallicBlue:N.redShadow,pink:N.midRed,moss:N.midRed,replaceDark:N.midRed,replaceLight:N.lightBeige}),Od=(t,e)=>{const n=Ps(t.color).edges[e],r=n.original;return n.dimInOriginal?Tm(r):r},Sg=(t,e,n)=>n?rn(_g(ti[t.color.hue][t.color.shade].edges[e])):new Ue(Ps(t.color).edges[e].original),gt=t=>rn(Cg(t)),ME=t=>{switch(t.color.hue){case"white":return rn({replaceLight:N.lightGrey,replaceDark:N.midGrey});default:return gt(t)}},kg=t=>{switch(t.color.hue){case"white":return rn({replaceLight:N.lightBeige,replaceDark:N.midRed,shadow:N.redShadow});case"yellow":return gt({planet:t.planet,color:{hue:"yellow",shade:"dimmed"}});default:return gt(t)}};new jE;const on=vs,zE=rn(kE),DE=[new Rs(N.midRed)],LE=[new Rs(N.moss)],BE=75;class FE{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output)}output=new ne({label:"ItemFlashOnSwitchedRenderer"});tick(e){const{renderContext:{item:{state:{switchedAtRoomTime:n,switchedSetting:r}},room:{roomTime:o}}}=this;this.output.filters=o-n<BE?r==="left"?LE:DE:on,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const UE=(t,e,n)=>{const o=qt().textures[`door.frame.${t.planet}.${e}.near`]!==void 0?t.planet:"generic",s=t.color.shade==="dimmed"&&qt().textures[`door.frame.${o}.dark.${e}.${n}`]!==void 0;return`door.frame.${o}${s?".dark":""}.${e}.${n}`};function li(t,e){const n=e||new ne;for(const r of t)n.addChild(r);return n}function*HE({config:{direction:t,inHiddenWall:e,height:n}},r){const o=go(t),s=o==="y"?1:16;function*i(a){if(e){if(n!==0){const l=q({textureId:`generic.door.floatingThreshold.${o}`,...Zr(a,{y:-12*n})});l.filters=Sg(r,o==="x"?"towards":"right",!0),yield l}}else{yield q({pivot:{x:s,y:9},textureId:`generic.door.legs.base.${o}`,...Zr(a,{})});for(let l=1;l<n;l++)yield q({pivot:{x:s,y:9},textureId:`generic.door.legs.pillar.${o}`,...Zr(a,{y:-l*V.h})})}}yield*i(Sn({...ir,[o]:1})),yield*i(ir),e||(yield q({pivot:{x:16,y:V.h*n+13},textureId:`generic.door.legs.threshold.double.${o}`,...Sn({...ir,[o]:1})}))}const Pg=(t,e)=>{const n=go(t),r=Pr(n),o=8;return t==="towards"||t==="right"?G({[r]:e[r]-o}):ir},WE=Ie(({renderContext:{item:t,room:e}})=>li(HE(t,e),new ne({filters:gt(e),...Pg(t.config.direction,t.aabb)}))),GE=Ie(({renderContext:{item:{config:{direction:t,part:e,toRoom:n},aabb:r},room:o,general:{gameState:s}}})=>{const i=go(t),a=s===void 0?o:s.campaign.rooms[n]??o;return q({textureId:UE(o,i,e),filter:gt(a),...Pg(t,r)})}),oa={animationId:"bubbles.cold"},rr=({top:t,bottom:e="headlessBase",filter:n})=>{const r=new ne({filters:n}),o=q(e);r.addChild(o);const s=q(t);return s.y=-12,r.addChild(s),r[ci]=s,r[cc]=o,r},ci=Symbol(),cc=Symbol(),qE=({top:t,bottom:e})=>{const n=new ne;return n.addChild(e),t.y=-12,n.addChild(t),n[ci]=t,n[cc]=e,n},VE=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform vec2 uTextureSize;
uniform sampler2D uTexture;
uniform vec3 uOutline;
uniform float uOutlineWidth;

void main(void) {
    vec2 scaledTexelSize = vec2(1.0f) / vec2(textureSize(uTexture, 0)) * uOutlineWidth;    
    
    // Calculate offset coordinates
    vec2 rightCoord = vec2(vTextureCoord.x + scaledTexelSize.x, vTextureCoord.y);
    vec2 leftCoord = vec2(vTextureCoord.x - scaledTexelSize.x, vTextureCoord.y);
    vec2 belowCoord = vec2(vTextureCoord.x, vTextureCoord.y + scaledTexelSize.y);
    vec2 aboveCoord = vec2(vTextureCoord.x, vTextureCoord.y - scaledTexelSize.y);
    
    // Create boundary masks (1.0 if within bounds, 0.0 if out of bounds)
    // seems to work fine without this, but could multiply colourToX by this to get zero'd out when OOB
    // float rightInBounds = step(rightCoord.x, 1.0);
    // float leftInBounds = step(0.0, leftCoord.x);
    // float belowInBounds = step(belowCoord.y, 1.0);
    // float aboveInBounds = step(0.0, aboveCoord.y);
    
    vec4 colourToRight = texture(uTexture, rightCoord);
    vec4 colourToLeft = texture(uTexture, leftCoord);
    vec4 colourBelow = texture(uTexture, belowCoord);
    vec4 colourAbove = texture(uTexture, aboveCoord);
    
    // Check if any neighbor is opaque (combine all alpha values)
    float hasOpaqueNeighbor = max(max(colourToRight.a, colourToLeft.a), 
                                  max(colourBelow.a, colourAbove.a));

    vec4 originalColour = texture(uTexture, vTextureCoord);
        
    finalColor = mix(
        originalColour, 
        vec4(uOutline, 1), 
        // 1 if: original colour is transparent and has an opaque neighbour - use outline colour
        // 0 if: original colour is opaque or has no opaque neighbour - use original colour (transparent or sprite)
        (1.0 - originalColour.a) * hasOpaqueNeighbor
    );
}
`;let Xr=kh(W.getState());W.subscribe(()=>{Xr=kh(W.getState())});class Eg extends en{constructor(e){const n=Ot.from({vertex:Or,fragment:VE,name:"outline-filter"});super({glProgram:n,padding:Xr,resources:{colorReplaceUniforms:{uOutline:{value:new Float32Array(3),type:"vec3<f32>"},uOutlineWidth:{value:new Float32Array(1),type:"f32"}}}});const r=this.resources.colorReplaceUniforms.uniforms,[o,s,i]=e.toArray();r.uOutline[0]=o,r.uOutline[1]=s,r.uOutline[2]=i,r.uOutlineWidth[0]=Xr}apply(e,n,r,o){const s=this.resources.colorReplaceUniforms.uniforms;this.padding=Xr,s.uOutlineWidth[0]=Xr,super.apply(e,n,r,o)}}const It=Iy(N,([t,e])=>[t,new Eg(e)]),KE=t=>{const{gameTime:e,lastDiedAt:n}=t.type==="headOverHeels"?t.state.head:t.state;return e-n<V1},sa=t=>{if(t===void 0)return 0;const{shieldCollectedAt:e,gameTime:n}=t;return e!==null&&e+sd>n?100-Math.ceil((n-e)/(sd/100)):0},XE=t=>t.type==="headOverHeels"?sa(t.state.head)>0||sa(t.state.heels)>0:sa(t.state)>0,ui=t=>t,rl=.02,JE=({name:t,action:e,facingXy8:n,teleportingPhase:r,gravityZ:o,paused:s})=>{if(e==="death")return{animationId:`${t}.fadeOut`,paused:s};if(r==="out")return{animationId:`${t}.fadeOut`,paused:s};if(r==="in")return{animationId:`${t}.fadeOut`,paused:s};if(e==="moving")return{animationId:`${t}.walking.${n}`,paused:s};if(e==="jumping")return{textureId:o<rl?`${t}.walking.${n}.2`:`${t}.walking.${n}.1`};if(e==="falling"){const a=`${t}.falling.${n}`;if(bs(a))return{textureId:a}}const i=`${t}.idle.${n}`;return df(i)?{animationId:i,paused:s}:{textureId:`${t}.walking.${n}.2`}},ol=Symbol(),sl=Symbol(),YE=(t,e)=>{t[ol].removeChildren(),t[ol].addChild(q(JE(e)))},Tg=rn({pastelBlue:N.pink}),ia=(t,e,n)=>{const r=new ne,o=new ne;r[ol]=o,r.addChild(o);const s=q({animationId:e?`shine.${t}InSymbio`:"shine",paused:n,filter:t==="heels"?Tg:on,flipX:t==="heels"});return r[sl]=s,r},Id=({gameTime:t,switchedToAt:e},n,r)=>(n==="headOverHeels"||n===r)&&e+q1>t,ZE=t=>{if(!KE(t))return!1;const{gameTime:e,lastDiedAt:n}=t.type==="headOverHeels"?t.state.head:t.state;return(e-n)%id<id*K1},jd=(t,e)=>{t.filters?Array.isArray(t.filters)?t.filters=[...t.filters,e]:t.filters=[t.filters,e].flat():t.filters=e},$d=(t,e)=>{t.filters=Array.isArray(t.filters)?t.filters.filter(n=>!(n instanceof e)):t.filters instanceof e?on:[...t.filters]},QE=(t,{highlighted:e,flashing:n},r,o)=>{const s=r?.highlighted??!1;e&&!s?jd(o,It[tr[t]]):!e&&s&&$d(o,Eg);const i=r?.flashing??!1;n&&!i?jd(o,new Rs(N[tr[t]])):!n&&i&&$d(o,Rs)},eT=(t,e,n)=>{e&&!n?t.addChild(t[sl]):!e&&n&&t.removeChild(t[sl])},aa=(t,e,n,r,o,s)=>{n&&YE(e,{name:t,...r,paused:o}),QE(t,r,s,e),eT(e,r.shining,s?.shining??!1)},tT=({renderContext:{item:t,general:{gameState:e,paused:n}},currentRendering:r})=>{const{type:o,state:{action:s,facing:i,teleporting:a,vels:{gravity:{z:l}}}}=t,c=r?.renderProps,u=r?.output,d=Sh(i)??"towards",h=e!==void 0&&(t.type==="headOverHeels"?Id(t.state.head,"headOverHeels","headOverHeels"):Id(t.state,t.type,e.currentCharacterName)),p=ZE(t),g=XE(t),y=zs(i),v=a?.phase??null,w={action:s,facingXy8:d,teleportingPhase:v,flashing:p,highlighted:h,shining:g,gravityZ:l},x=c===void 0||c.action!==s||c.facingXy8!==d||c.teleportingPhase!==v||c?.gravityZ>rl!=l>rl;let b;if(o==="headOverHeels"){b=u??qE({top:ia("head",!0,n),bottom:ia("heels",!0,n)});const _=b;aa("head",_[ci],x,w,n,c),aa("heels",_[cc],x,w,n,c)}else b=u??ia(o,!1,n),aa(o,b,x,w,n,c);return s==="moving"&&u instanceof fr&&(u.animationSpeed=y*jy),{output:b,renderProps:w}},la=ui(tT),Nd=t=>t-Math.floor(t),nT=({state:{position:t}},e)=>{const n=o=>o.config.direction==="away"||o.config.direction==="left";return li($e(e.items).filter(o=>o.type==="wall"||o.type==="doorLegs").filter(n).map(o=>{const{id:s,config:{direction:i},state:{position:a}}=o;return q({textureId:"floorOverdraw.cornerNearWall",label:s,...G(hr(a,t)),times:o.type==="wall"?wl(o.config):{[Pr(Kt(i))]:2},anchor:{x:0,y:1},flipX:i==="away"})}),new ne({label:"floorOverdraws"}))},rT=`#version 300 es
precision lowp float;

out vec4 finalColor;

in vec2 vTextureCoord;
uniform sampler2D uBackBuffer;
uniform vec3 uTargetColor;
// do not use uTexture in this frag - for some reason it causes pixi's render pipeline
// to take away the backbuffer, which we rely on sampling from

void main() {
    vec3 bg = texture(uBackBuffer, vTextureCoord).rgb;

    float isBlack = step(length(bg), 0.001f); // 1 if black, 0 otherwise
    finalColor = mix(vec4(uTargetColor, 1.0f), vec4(0, 0, 0, 0), isBlack);


}`;class Md extends en{uniforms;constructor(e="white"){const n=Ot.from({vertex:Or,fragment:rT,name:"colour-clash-filter"});super({glProgram:n,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}},blendRequired:!0}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[n,r,o]=new H(e).toArray();this.uniforms.uTargetColor[0]=n,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=o}}const zd=({colourised:t,direction:e,room:n,times:r,position:o,colourSwap:s})=>q({label:`floorEdge(${e})`,textureId:`floorEdge.${e}`,times:r,filter:s?Sg(n,e,t):void 0,...G(o)}),oT=({room:t,xSize:e,ySize:n,y:r})=>{const o=new ne({label:"floorColourClash"}),s=Od(t,"right");for(let a=0;a<=n;a++){const l=Sn({x:0,y:a,z:0}),c=new ht().rect(l.x-(a===0?0:8),l.y,8*3,8).fill(s);c.filters=new Md(s),o.addChild(c)}const i=Od(t,"towards");for(let a=0;a<=e;a++){const l=Sn({x:a,y:0,z:0}),c=new ht().rect(l.x-16,l.y,8*(a===0?2:3),8).fill(i);c.filters=new Md(i),o.addChild(c)}return o.y=r,o},sT=Ie(({renderContext:{room:t,item:e,general:{colourised:n,pixiRenderer:r},colourClashLayer:o}})=>{const{color:{shade:s}}=t,{config:i,state:{position:a},aabb:l}=e,{floorType:c,naturalFootprint:u}=i,d=new ne({label:"floorAppearance"}),h=G({...l,y:0}),p=G({...l,x:0,y:0}),g=G({...l,x:0}),y=G(l);if(c!=="none"){const v=new ne({label:"tiles"}),w=c==="deadly"?`generic${s==="dimmed"?".dark":""}.floor.deadly`:`${i.scenery}${s==="dimmed"?".dark":""}.floor`,x=qt().textures[w];try{uf(w)}catch(J){throw new Error(`no floor textureId for floorType: ${c}, shade: ${s}`,{cause:J})}const b=Vt(u.position,a),_={x:Nd(b.x/V.w),y:Nd(b.y/V.w)},S=8,k={x:h.x,y:y.y-S,width:g.x-h.x,height:p.y-y.y+2*S},C=Vt(Sn(Zr(_,{x:.5,y:.5})),{y:l.z},k),M=new Cw({texture:x,tilePosition:C,...k});v.addChild(M),v.addChild(nT(e,t));const X=new ht().moveTo(y.x,y.y).lineTo(g.x,g.y).lineTo(g.x,g.y+3).lineTo(p.x,p.y+3).lineTo(h.x,h.y+3).lineTo(h.x,h.y).fill({color:16711680,alpha:.5});v.addChild(X),v.mask=X,v.filters=[ME(t)];const L=new ne({children:[v]});L.filters=It.pureBlack,d.addChild(xr(r,L))}{const v=new ne({label:"edges"});c==="none"&&v.addChild(new ht().moveTo(g.x,g.y+8).lineTo(g.x,g.y+100).lineTo(h.x,h.y+100).lineTo(h.x,h.y+8).lineTo(p.x,p.y+8).fill(0));const w=Math.ceil(l.y/V.w);v.addChild(zd({colourised:n,direction:"right",room:t,times:{y:w},position:{z:l.z},colourSwap:n}));const x=Math.ceil(l.x/V.w);if(v.addChild(zd({colourised:n,direction:"towards",room:t,times:{x},position:{z:l.z},colourSwap:n})),d.addChild(xr(r,v)),!n){const b=oT({xSize:x,ySize:w,y:-l.z+1,room:t});d.addChild(b),o.attach(b)}}return d}),iT=["cyberman","dalek","skiHead","bubbleRobot","computerBot","turtle","homingBot"],aT=t=>{let e=2166136261;const n=t.length;for(let r=Math.max(0,n-9);r<n;r++)e^=t.charCodeAt(r),e=Math.imul(e,1540483477),e^=e>>>15;return(e>>>0)/4294967295},lT=200,cT=1,uT=(t,e)=>{const n=aT(e);return Math.sin((t+n*2e4)/lT)*cT},Dd=({id:t,config:{which:e},state:n},r,o)=>{if((e==="cyberman"||e==="bubbleRobot")&&n.activated||e==="emperorsGuardian"){const s=o;s[ci].y=-12+uT(r.roomTime,t)}},dT=({renderContext:{item:t,room:e,general:{paused:n}},currentRendering:r})=>{const{config:o,state:s}=t,i=r?.renderProps,{activated:a,busyLickingDoughnutsOffFace:l}=s,c=l?NE:a?void 0:iT.includes(o.which)?$E(e):void 0;switch(o.which){case"skiHead":case"turtle":case"cyberman":case"computerBot":case"elephant":case"elephantHead":case"monkey":{const u=fl(s.facing)??"towards";if(!(i===void 0||a!==i.activated||l!==i.busyLickingDoughnutsOffFace||u!==i.facingXy4))return Dd(t,e,r.output),"no-update";const h={facingXy4:u,activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"skiHead":return{output:q({textureId:`${o.which}.${o.style}.${u}`,filter:c}),renderProps:h};case"elephantHead":return{output:q({textureId:`elephant.${u}`,filter:c}),renderProps:h};case"turtle":return{output:q(a&&!l?{animationId:`${o.which}.${u}`,filter:c,paused:n}:{textureId:`${o.which}.${u}.1`,filter:c}),renderProps:h};case"cyberman":return{output:s.activated||s.busyLickingDoughnutsOffFace?rr({top:{textureId:`${o.which}.${u}`,filter:c||gt(e)},bottom:{...oa,paused:n}}):q({textureId:`${o.which}.${u}`,filter:c}),renderProps:h};case"computerBot":case"elephant":case"monkey":return{output:rr({top:`${o.which}.${u}`,bottom:{animationId:"headlessBase.flash",playOnce:"and-stop"},filter:c}),renderProps:h};default:throw new Error(`unexpected monster ${o}`)}break}case"homingBot":{const u=!$y(s.vels.walking,ir);return i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated||u!==i.walking?{filter:c,output:q(a&&!l?{animationId:u?"headlessBase.flash":"headlessBase.scan",filter:c}:{textureId:"headlessBase",filter:c}),renderProps:{activated:a,busyLickingDoughnutsOffFace:l,walking:u}}:"no-update"}case"helicopterBug":case"emperor":case"dalek":case"bubbleRobot":case"emperorsGuardian":{if(!(i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated))return Dd(t,e,r.output),"no-update";const d={activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"helicopterBug":case"dalek":return{output:q(a&&!l?{animationId:o.which,filter:c,paused:n}:{textureId:`${o.which}.1`,filter:c}),renderProps:d};case"bubbleRobot":return{output:rr({top:{...oa,paused:n},filter:c}),renderProps:d};case"emperorsGuardian":return{output:rr({top:"ball",bottom:{...oa,paused:n},filter:c}),renderProps:d};case"emperor":return{output:q({animationId:"bubbles.cold",filter:c,paused:n}),renderProps:d};default:throw new Error(`unexpected monster ${o}`)}break}default:throw new Error(`unexpected monster ${o}`)}},ts=It.pureBlack;new Ue;new Ue;new Ue;new Ue(N.moss);new Ue;new Ue(N[tr.head]),new Ue(vr(N[tr.head])),new Ue(N[tr.heels]),new Ue(vr(N[tr.heels]));function*hT(t){const e=typeof t=="string"?t==="infinite"?"":t:t.toString(),n=Uh(e);let r=0;for(const o of e){const s=`hud.char.${mh(o)}`;try{uf(s)}catch(i){throw new Error(`no texture id for char "${o}": ${i.message}`,{cause:i})}yield q({textureId:s,x:(r+.5-n/2)*Ny.w}),r++}}const Ag=(t,e)=>{t.removeChildren();try{li(hT(e),t)}catch(n){throw console.error("invalid string is",e,"and on window as window.invalid"),console.error(n),window.invalid=e,new Error(`could not show text "${e}" in container because: "${n.message}"`,{cause:n})}return t},fT=og.floatingText,pT=12,Ld=V.h*3,Bd=[N.shadow,N.midGrey,N.redShadow,N.metallicBlue,N.midRed,N.moss,N.pink,N.lightBeige,N.pastelBlue,N.lightGrey,N.highlightBeige],Fd=[...Bd,...new Array(20).fill(N.white),...Bd.toReversed()],mT=({renderContext:{item:{config:{textLines:t,appearanceRoomTime:e}},room:{roomTime:n},general:{displaySettings:{uncolourised:r}},frontLayer:o},currentRendering:s})=>{const i=s?.output;let a;const c=(n-e)*fT;if(i===void 0){a=new ne({filters:It.pureBlack}),o?.attach(a);for(let d=0;d<t.length;d++){const h=t[d],p=Ag(new ne({label:h,y:d*pT,filters:r?on:new Ue(N.pink)}),h.toUpperCase());a.addChild(p)}}else a=i;let u=!1;for(let d=0;d<t.length;d++){const h=a.children[d],[p]=h.filters,g=c+d*-12,y=g>0&&g<Ld;if(h.visible=y,u||=y,y&&p){const v=Math.floor(g/Ld*Fd.length);p.targetColor=Fd[v]}}return a.visible=u,a.y=-c,{output:a,renderProps:fe}},Ud=500,gT=En.animations["conveyor.x"].animationSpeed,Hd=En.animations["conveyor.x"].length,yT=t=>1-(1-t)**2,vT=(t,e)=>{for(let n=0;n<t.children.length;n++){const r=t.children[n],o=n%Hd;r.gotoAndStop(e?Hd-o-1:o)}},wT=(t,e)=>{const n=Kt(t),r=q({animationId:`conveyor.${n}`,reverse:t==="towards"||t==="right",times:e}),o=r instanceof fr?new ne({children:[r]}):r;return vT(o,t==="towards"||t==="right"),o},bT=({renderContext:{item:{config:{direction:t,times:e},state:{stoodOnBy:n}},room:{roomTime:r}},currentRendering:o})=>{const s=o?.renderProps,i=Eo(n),a=(!i&&s?.moving?r:s?.roomTimeStoppedMoving)??Ee,l=o?.output??wT(t,e),c=i?0:Math.min(r-a,Ud),u=Math.max(0,1-c/Ud);for(const d of l.children)if(u===0)d.stop();else{const h=gT*yT(u);d.play(),d.animationSpeed=h}return{output:l,renderProps:{moving:i,roomTimeStoppedMoving:a}}},xT=ui(bT),_T=({renderContext:{item:t,room:e,general:{paused:n}},currentRendering:r})=>{const{state:{stoodOnBy:o},config:{times:s}}=t,i=r?.renderProps,a=ac(t),l=a&&Po(o,e).some(_l);return i===void 0||a!==i.activated||l!==i.flashing?{output:l?new ne({children:[q({textureId:"teleporter",times:s}),q({animationId:"teleporter.flashing",times:s,paused:n})]}):q({textureId:a?"teleporter":"block.artificial",times:s}),renderProps:{flashing:l,activated:a}}:"no-update"},CT=({renderContext:{item:{state:{facing:t,actedOnAt:{roomTime:e,by:n}}},room:{roomTime:r,items:o}},currentRendering:s})=>{const i=s?.renderProps,a=fl(t)??"towards",l=r===e&&vt(Ls(n)).some(u=>Ih(o[u]));return i===void 0||a!==i.facingXy4||l!==i.controlledByJoystick?{output:rr({top:`charles.${a}`,bottom:l?"headlessBase.all":"headlessBase"}),renderProps:{facingXy4:a,controlledByJoystick:l}}:"no-update"},ST=({renderContext:{item:{state:{stoodOnBy:t,stoodOnUntilRoomTime:e}},general:{paused:n}},tickContext:{lastRenderRoomTime:r},currentRendering:o})=>{const s=o?.renderProps,i=Eo(t);let a;return o?.output?a=o?.output:(a=q({animationId:"spring.bounce"}),a.loop=!1,a.gotoAndStop(0)),r!==void 0&&e>r&&!i&&!n?a.gotoAndPlay(0):i&&!(s?.compressed??!1)&&a.gotoAndStop(1),{output:a,renderProps:{compressed:i}}},kT=ui(ST),PT=({renderContext:{item:{config:{which:t,startDirection:e}}},currentRendering:n})=>n?.renderProps===void 0?{output:t==="headOverHeels"?rr({top:{textureId:`head.walking.${e}.2`},bottom:{textureId:`heels.walking.${e}.2`}}):q({textureId:`${t}.walking.${e}.2`}),renderProps:fe}:"no-update",ET=({renderContext:{item:{state:{vels:{sliding:t}},config:{startingPhase:e}},general:{paused:n}},tickContext:{deltaMS:r},currentRendering:o})=>{const i=(o?.renderProps?.distanceTravelled??0)+gl(t)*(n?0:r),l=o?.output??q("spikyBall.1"),u=(Math.floor(i*2/sr.w)+e)%2+1;return l.texture=qt().textures[`spikyBall.${u}`],{output:l,renderProps:{distanceTravelled:i}}},TT=ui(ET),AT=(t,e,n,r)=>`${t}${r?".dark":""}.wall.${e}.${n}`,RT=Ie(({renderContext:{general:{pixiRenderer:t},item:{id:e,config:n},room:r}})=>{if(n.direction==="right"||n.direction==="towards")throw new Error(`wall is near: ${e}`);const{direction:o,tiles:s}=n,i=Pr(Kt(o)),a=new ne({label:"wallTiles"}),l=new ne({label:"wallAnimations"});for(let u=0;u<n.tiles.length;u++){const d=Sn({[i]:u});if(a.addChild(q({textureId:AT(r.planet,s[u],o,r.color.shade==="dimmed"),...d,pivot:o==="away"?{x:sr.w,y:sr.h}:{x:0,y:sr.h}})),r.planet==="moonbase"){const h=`moonbase.wall.screen.${s[u]}.away`;df(h)&&l.addChild(q({animationId:h,randomiseStartFrame:!0,flipX:o==="left",x:d.x+(o==="away"?-8:8),y:d.y-23}))}}const c=new ne({label:"wallAppearance"});return c.addChild(xr(t,a)),l.children.length>0&&c.addChild(l),c.filters=gt(r),c}),OT=({renderContext:{item:{state:{setting:t},config:e}},currentRendering:n})=>{const r=n?.renderProps,o=e.type==="in-store"?hl(W.getState(),e.path)?"right":"left":t;return r===void 0||o!==r.setting?{output:q(`switch.${o}`),renderProps:{setting:o}}:"no-update"},IT=(t,e,n)=>e==="tower"?"tower":e==="book"?"book.x":e==="organic"&&t?`block.organic.dark${n?".disappearing":""}`:`block.${e}${n?".disappearing":""}`,jT=({renderContext:{general:{pixiRenderer:t},item:{config:{style:e,times:n},state:{disappearing:r}},room:o},currentRendering:s})=>{const i=s?.renderProps,a=r!==null;return i===void 0||i.isDissapearing!==a?{output:ko(t,q({textureId:IT(o.color.shade==="dimmed",e,a),filter:e==="organic"?gt(o):e==="book"?kg(o):void 0,times:n})),renderProps:{isDissapearing:a}}:"no-update"},$T=({state:{stoodOnBy:t,position:e},config:{times:n}},r)=>{const o=new Array(n?.x??1).fill(null).map(()=>new Array(n?.y??1));return Po(t,r).filter(jh).forEach(({id:s,state:{position:i}})=>{const a=Vt(i,e),l={x:Math.floor(a.x/V.w),y:Math.floor(a.y/V.d)};l.x<0||l.x>=(n?.x??1)||l.y<0||l.y>=(n?.y??1)||(o[l.x][l.y]=s)}),o},NT=(t,e)=>{let n=0,r=1;for(const o of e)for(const s of o)s!==void 0&&t.items[s]?.state.activated&&(n|=r),r<<=1;return n},MT=({renderContext:{item:t,room:e},currentRendering:n})=>{const{config:{times:r}}=t,o=n===void 0?$T(t,e):n.renderProps.chargePositions,s=NT(e,o);return s!==n?.renderProps.cybermanActivationBitmask?{output:q({textureIdCallback(a,l){const c=o[a][l];return c===void 0||e.items[c]?.state.everActivated?"toaster.off":"toaster.on"},times:r??fe}),renderProps:{chargePositions:o,cybermanActivationBitmask:s}}:"no-update"},zT={head:la,heels:la,headOverHeels:la,doorFrame:GE,doorLegs:WE,monster:dT,floatingText:mT,barrier:Ie(({renderContext:{item:{config:{axis:t,times:e}}}})=>q({textureId:`barrier.${t}`,times:e})),deadlyBlock:Ie(({renderContext:{item:{config:t},room:e}})=>{switch(t.style){case"volcano":return q({animationId:"volcano",filter:gt(e),times:t.times,randomiseStartFrame:!0});case"toaster":throw new Error("use the special toaster appearance instead");default:throw t.style,new Error("unknown deadly block style")}}),spikes:zt("spikes"),slidingDeadly:TT,slidingBlock:Ie(({renderContext:{item:{config:{style:t}},room:e}})=>q(t==="book"?{textureId:"book.y",filter:kg(e)}:t)),block:jT,switch:OT,conveyor:xT,lift:Ie(({renderContext:{general:{paused:t}}})=>{const e=new ne,n={x:gc.w/2,y:gc.h};return e.addChild(q({animationId:"lift",pivot:n,paused:t})),e.addChild(q({textureId:"lift.static",pivot:n})),e}),teleporter:_T,sceneryCrown:Ie(({renderContext:{item:{config:{planet:t}}}})=>q({textureId:`crown.${t}`})),pickup:Ie(({renderContext:{item:{config:t},room:e,general:{paused:n}}})=>{if(t.gives==="crown")return q({textureId:`crown.${t.planet}`});const o={shield:"whiteRabbit",jumps:"whiteRabbit",fast:"whiteRabbit","extra-life":"whiteRabbit",bag:"bag",doughnuts:"doughnuts",hooter:"hooter",scroll:{textureId:"scroll",filter:gt(e)},reincarnation:{animationId:"fish",paused:n}}[t.gives];return q(o)}),moveableDeadly:zt("fish.1"),charles:CT,joystick:zt("joystick"),movingPlatform:zt("sandwich"),pushableBlock:zt("stepStool"),portableBlock:Ie(({renderContext:{item:{config:{style:t}}}})=>q(t)),spring:kT,sceneryPlayer:PT,hushPuppy:zt("hushPuppy"),bubbles:Ie(({renderContext:{item:{config:{style:t}},general:{paused:e}}})=>q({animationId:`bubbles.${t}`,paused:e})),firedDoughnut:zt({animationId:"bubbles.doughnut"}),ball:zt("ball"),floor:sT,particle:Ie(({renderContext:{item:{config:{forCharacter:t}}}})=>q({animationId:"particle.fade",anchor:{x:.5,y:.5},filter:t==="heels"?Tg:on}))},DT=t=>{if(t.type==="wall"){const{direction:e}=t.config;return e==="right"||e==="towards"?void 0:RT}return t.type==="deadlyBlock"&&t.config.style==="toaster"?MT:zT[t.type]},LT=()=>It.moss;class BT{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output)}output=new ne({label:"PortableItemPickUpNextHighlightRenderer"});#e=!1;tick(e){const{wouldPickUpNext:n}=this.renderContext.item.state;n!==!this.#e&&(this.output.filters=n?[LT()]:on),this.#e=n,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const FT=(t,e,n)=>Sv(t)?new BT(e,n):n,UT=N.pastelBlue,Wd=It.highlightBeige,Gd=It.midRed,HT=It.white,qd=new Ue(UT),Vd={left:"",away:"",right:"",towards:""},Kd=(t,e)=>{switch(t){case"back-forth":switch(e){case"left":return"";case"right":return"";case"away":return"";case"towards":return"";default:throw new Error("Unexpected startDirection")}case"clockwise":switch(e){case"left":return"";case"right":return"";case"away":return"";case"towards":return"";default:throw new Error("Unexpected startDirection")}case"towards-analogue":return"."}return""};class WT{constructor(e,n){this.renderContext=e,this.childRenderer=n,this.output.addChild(n.output),this.#e()}output=new ne({label:"EditorAnnotationsRenderer"});#e(){const e=this.renderContext.item;switch(e.type){case"pickup":if(e.config.gives==="shield"||e.config.gives==="extra-life"||e.config.gives==="jumps"||e.config.gives==="fast"){const n={shield:"",jumps:"",fast:"","extra-life":"+2"};this.#t({annotationText:n[e.config.gives],yAdj:-16})}break;case"doorFrame":if(e.config.part==="near"){const{rooms:n}=W.getState().levelEditor.campaignInProgress,{config:{toRoom:r,direction:o}}=e,s=!!n[r],i=r.toUpperCase(),a=Vd[o],l=o==="away"||o==="right"?`${i}${a}`:`${a}${i}`;this.#t({annotationText:l,yAdj:o==="left"||o==="away"?-48:0,error:!s,clickDispatch:s?()=>io(r):void 0})}break;case"teleporter":{const{rooms:n}=W.getState().levelEditor.campaignInProgress,{config:{toRoom:r}}=e,o=!!n[r];this.#t({annotationText:`${r.toUpperCase()}`,yAdj:-12,error:!o,clickDispatch:o?()=>io(r):void 0})}break;case"conveyor":{const{config:{direction:n}}=e,r=Vd[n];this.#t({annotationText:r,yAdj:-12})}break;case"movingPlatform":{const{config:{movement:n,startDirection:r}}=e;this.#t({annotationText:Kd(n,r),yAdj:-12})}break;case"monster":{const{config:n}=e;(n.which==="turtle"||n.which==="skiHead")&&this.#t({annotationText:Kd(n.movement,n.startDirection),yAdj:-12})}break}}#t({annotationText:e,yAdj:n=0,error:r=!1,clickDispatch:o}){const{renderContext:{frontLayer:s}}=this,i=new Ue(r?N.midRed:N.white),a=Ag(new ne({label:"EditorAnnotationTextContainer",filters:[i,It.pureBlack]}),e);a.y=n,o!==void 0&&(a.eventMode="static",a.on("click",()=>{W.dispatch(o())}),a.on("mouseover",()=>{W.getState().levelEditor.tool.type==="pointer"&&(W.dispatch(bc(!0)),i.targetColor=N.pastelBlue)}),a.on("mouseout",()=>{W.dispatch(bc(!1)),i.targetColor=N.white}),a.cursor="pointer"),this.output.addChild(a),s.attach(a)}tick(e){this.#n(),this.childRenderer.tick(e)}#n(){const{renderContext:{item:e,room:n}}=this,{clickableAnnotationHovered:r}=W.getState().levelEditor,{jsonItemId:o}=e,s=W.getState(),i=$h(s),a=kv(s),l=pn(s),c=o&&i?.jsonItemId===o&&!r,u=o&&a.includes(o),d=()=>o!==void 0&&($e(n.items).some(h=>h.jsonItemId===i?.jsonItemId&&h.type==="switch"&&h.config.type==="in-room"&&h.config.modifies.some(p=>p.targets.includes(o)))||e.type==="switch"&&$e(n.items).some(({jsonItemId:h})=>h!==void 0&&h===i?.jsonItemId&&e.config.type==="in-room"&&e.config.modifies.some(p=>p.targets.includes(h)))||e.type==="charles"&&$e(n.items).some(h=>h.jsonItemId===i?.jsonItemId&&h.type==="joystick"&&h.config.controls.some(p=>p===o))||e.type==="joystick"&&e.config.controls.some(h=>i?.jsonItemId===h));this.output.filters=c&&u?[qd,l.type==="eyeDropper"?Gd:Wd]:c?l.type==="eyeDropper"?Gd:Wd:u?qd:d()?HT:on}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const GT=(t,e,n)=>e.general.editor?new WT(e,n):n,qT=(t,e)=>{e!==void 0&&W.getState().gameMenus.cheatsOn&&(e.eventMode="static",e.on("pointertap",()=>{W.dispatch(Dy({item:t,pixiContainer:e}))}))},VT=t=>{const e=W.getState(),n=My(e),r=!zy(e),{item:o}=t,s=n==="all"||n==="non-wall"&&t.item.type!=="wall",i=[],a=DT(o);let l;if(a!==void 0){l=new wg(t,a);const p=new FE(t,l);i.push(GT(o,t,FT(o,t,p)))}if(r){const p=tE(t);p!==void 0&&i.push(p)}s&&i.push(new FP(t));let c;if(i.length===0)c=void 0;else{const p=i.length===1?i[0]:new KT(i,t);c=new GP(t,p),qT(o,c.output)}const u=t.general.soundSettings.mute??ml.soundSettings.mute,d=t.general.paused||u?void 0:bE(t),h=d===void 0?void 0:new CE(t,d);return{top:new nE(t,{graphics:c,sound:h}),itemAppearanceRenderer:l}};class KT{constructor(e,n){this.renderContext=n,this.#e=e,this.#t.addChild(...e.map(r=>r.output))}#e;#t=new ne({label:"CompositeRenderer"});tick(e){for(const n of this.#e)n.tick(e)}destroy(){for(const e of this.#e)e.destroy()}get output(){return this.#t}}const XT=yo("wall","doorFrame"),Xd=256;function*JT(t){const{left:e,right:n}=$e(t.items).filter(XT).reduce((r,{aabb:o,renderAabb:s,renderAabbOffset:i,state:{position:a}})=>{const l=s??o,c=D(a,i??le),u=G(D(c,{x:l.x})).x,d=G(D(c,{y:l.y})).x;return{left:Math.min(r.left,u),right:Math.max(r.right,d)}},{left:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY});e!==Number.POSITIVE_INFINITY&&(yield new ht().rect(e-100,-256,100,Xd).fill(0)),n!==Number.NEGATIVE_INFINITY&&(yield new ht().rect(n,-256,100,Xd).fill(0))}class YT{constructor(e){this.renderContext=e;const{general:{colourised:n,soundSettings:r},room:o}=e;this.initFilters(n,e.room.color);const i=r.mute??ml.soundSettings.mute?void 0:de.createGain();li(JT(o),this.#o),this.output={sound:i,graphics:new ne({label:`RoomRenderer(${e.room.id})`})},this.output.graphics.addChild(this.#t),n||(this.#n=new Wc({sortableChildren:!1}),this.output.graphics.addChild(this.#n)),this.output.graphics.addChild(this.#o),this.output.graphics.addChild(this.#r)}#e=!1;#t=new ne({label:"items"});#n;#r=new Wc({sortableChildren:!1});#o=new ne({label:"occlusion"});output;#s=void 0;#a=new Map;#i=new Map;initFilters(e,n){this.#t.filters=e?n.shade==="dimmed"?zE:on:new Ue(n.shade==="dimmed"?Tm(Ps(n).main.original):Ps(n).main.original)}#c=e=>this.#i.get(e);#l(e,n){let r=this.#i.get(n.id);if(r===void 0){r=VT({...this.renderContext,colourClashLayer:this.#n,frontLayer:this.#r,item:n,zEdges:this.#a,getItemRenderPipeline:this.#c}),this.#i.set(n.id,r);const{graphics:o,sound:s}=r.top.output;if(o&&(this.#t.addChild(o),n.fixedZIndex&&(o.zIndex=n.fixedZIndex)),s){if(!this.output.sound)throw new Error("item renderer has sound, but room renderer does not - this probably means that they disagree on if the user has sound muted");s.connect(this.output.sound)}}try{r.top.tick(e)}catch(o){throw new Error(`RoomRenderer: error while ticking item "${n.id}"
in room "${this.renderContext.room.id}"
item in play object is:
           
${JSON.stringify(n,null,2)}`,{cause:o})}}#d(e){const{room:n}=this.renderContext,r={...e,lastRenderRoomTime:this.#s},o=new Set,s=a=>{if(o.has(a))return;const l=this.#a.get(a);if(l)for(const[c,u]of l.entries())u&&s(c);this.#l(r,n.items[a]),o.add(a)};for(const a in n.items)s(a);let i=!1;for(const[a,l]of this.#i.entries())n.items[a]===void 0&&(l.top.destroy(),this.#i.delete(a),i=!0);i&&this.#h()}#h(){if(this.#n)for(const e of this.#n.renderLayerChildren)e.parent===null&&this.#n.detach(e);for(const e of this.#r.renderLayerChildren)e.parent===null&&this.#r.detach(e)}#f(e){for(let n=0;n<e.length;n++){const r=this.#i.get(e[n]);if(r===void 0)throw new Error(`Item id=${e[n]} does not have a renderer - cannot assign a z-index`);const o=r.top.output.graphics;if(!o)throw new Error(`order ${e[n]} was given a z-order by sorting, but item has no graphics`);o.zIndex=n}}get#u(){return this.#s!==void 0}tick(e){const n=this.#u?e:{...e,movedItems:new Set($e(this.renderContext.room.items))};yg(this.renderContext.room.items,n.movedItems,this.#a);const r=vg(this.#a);this.#d(n),(!this.#u||n.movedItems.size>0)&&this.#f(r),this.#s=this.renderContext.room.roomTime}destroy(){this.output.graphics.label=this.output.graphics.label+"DESTROYED",this.output.graphics.destroy({children:!0}),this.output.sound?.disconnect(),this.#i.forEach(e=>{e.top.destroy()}),this.#e=!0}get destroyed(){return this.#e}}const ZT=t=>{t.ticker.remove(t.render,t)},Rg=m.createContext(null),QT=({children:t})=>{const[e,n]=m.useState(null);return m.useEffect(()=>{const r=new Yh;return r.init({background:N.pureBlack,sharedTicker:!0}).then(()=>{ZT(r),n(r)}),()=>{}},[]),e===null?null:f.jsx(Rg,{value:e,children:t})},In=()=>m.useContext(Rg),eA=(t,e)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:e},soundSettings:{mute:!0},pixiRenderer:t,gameState:void 0,paused:!1,colourised:!0,upscale:yl(W.getState()),editor:!0}),Jd=(t,e,n)=>new YT({room:t,general:eA(e,n)}),tA=()=>{const{renderer:t}=In(),e=yh();if(!t)throw new Error("this should never be falsey (typescript violation)");const n=ug(),[r,o]=m.useState(()=>Jd(n,t,e));return m.useEffect(()=>{const s=Jd(n,t,e);return o(s),()=>{s.destroy()}},[n,t,e]),r},nA={z:1,x:0,y:0},rA={z:0,x:0,y:-1},Yd={z:0,x:-1,y:0},oA=(t,{x:e,y:n},r)=>{if(r.type==="item"&&r.item.type==="door"&&t.type==="wall"){const l=t.config.direction;return Ms(Pe[l],-1)}const{bottomCentre:o,topLeft:s,topRight:i}=br(t.state.position,t.aabb);return n<s.y-(s.x-e)/2?n<i.y-(e-i.x)/2?nA:Yd:e<o.x?rA:Yd},sA=3,iA=(t,{x:e,y:n},r)=>{const o=br(t.state.position,t.aabb);return Ly.find(s=>{const i=o.projectCorner(s);return gl(Vt(i,{x:e,y:n}))<sA})},Vn=3,ca=1.5;function xt({x:t,y:e},n,r){const o={x:t-n.x,y:e-n.y},s=o.x*r.y-o.y*r.x;return Math.abs(s)/By(Math.hypot(r.x,r.y))}const Og={point:{x:-1,y:-1,z:0},normal:{x:0,y:0,z:1}},Ig={point:{x:-1,y:0,z:1},normal:{x:0,y:1,z:0}},jg={point:{x:0,y:-1,z:1},normal:{x:1,y:0,z:0}},$g={point:{x:0,y:1,z:1},normal:{x:1,y:0,z:0}},Ng={point:{x:1,y:0,z:1},normal:{x:0,y:1,z:0}},Mg={point:{x:1,y:-1,z:0},normal:{x:0,y:0,z:1}},zg={point:{x:0,y:-1,z:-1},normal:{x:1,y:0,z:0}},Dg={point:{x:-1,y:1,z:0},normal:{x:0,y:0,z:1}},Lg={point:{x:-1,y:0,z:-1},normal:{x:0,y:1,z:0}},aA=(t,e,n,r)=>{const o=br(t.state.position,t.aabb),s=n.x<0,i=n.y<0,a=n.z>0;if((s||i)&&xt(e,o.bottomCentre,{x:0,y:-1})<ca)return Og;if((s||a)&&xt(e,o.topRight,{x:2,y:-1})<ca)return Ig;if((i||a)&&xt(e,o.topLeft,{x:2,y:1})<ca)return jg;switch(!0){case a:{const l=o.c111;if(xt(e,l,{x:2,y:1})<Vn)return $g;if(xt(e,l,{x:-2,y:1})<Vn)return Ng;break}case i:{const l=o.c100;if(xt(e,l,{x:0,y:-1})<Vn)return Mg;if(xt(e,l,{x:2,y:1})<Vn)return zg;break}case s:{const l=o.c010;if(xt(e,l,{x:0,y:-1})<Vn)return Dg;if(xt(e,l,{x:-2,y:1})<Vn)return Lg;break}}},Zd=(t,e,n)=>n?{position:t.state.position,aabb:t.aabb}:{position:D(t.state.position,t.renderAabbOffset??le),aabb:t.renderAabb??t.aabb},Qd=({x:t,y:e},n,r)=>{const{bottomCentre:o,topLeft:s,topRight:i}=br(n,r);return!(t<s.x||t>i.x||e<i.y-(i.x-t)/2||e<s.y-(t-s.x)/2||e>o.y-(t-o.x)/2||e>o.y-(o.x-t)/2)},lA=(t,e,n)=>{const{position:r,aabb:o}=Zd(n,e,!1);if(Qd(t,r,o))return"intersects-rendered";if(e.type==="item"&&n.type==="wall"){const{position:i,aabb:a}=Zd(n,e,!0);if(Qd(t,i,a))return"intersects-unrendered"}return"non-intersecting"},eh=t=>t.fixedZIndex!==void 0,cA=t=>{const n=t.some(([,a])=>a==="intersects-rendered")?t.filter(([,a])=>a==="intersects-rendered").map(([a])=>a):t.map(([a])=>a);if(n.every(eh))return n.toSorted((a,l)=>l.fixedZIndex-a.fixedZIndex).at(0);const r=n.filter(a=>!eh(a));if(r.length===0)return;if(r.length===1)return r[0];const o=Object.fromEntries(r.map(a=>[a.id,a])),s=yg(o),i=vg(s);return o[i.at(-1)]},Bg=(t,e,n,r)=>{const o=n.type==="item"&&n.item.type==="door"?1:r,s=V.w*o,i=V.h,a=o===1?0:V.w/2,l=i/2,c=bh(e);return{x:c==="yz"?Math.round(t.x/s)*s:Math.floor((t.x-a)/s)*s,y:c==="xz"?Math.round(t.y/s)*s:Math.floor((t.y-a)/s)*s,z:c==="xy"?Math.round(t.z/i)*i:Math.floor((t.z+l)/i)*i}},uA=({state:{position:t},aabb:e},n,r,o,s)=>{const i={x:t.x+(n.x<0?0:e.x),y:t.y+(n.y<0?0:e.y),z:t.z+(n.z<0?0:e.z)},a=W1(i,n,r);return Bg(a,n,o,s)},dA=t=>e=>{const n=yn(e);return t.type==="item"&&t.item.type==="door"?n&&e.type==="wall":n},ua=(t,e,n,r)=>{const o=$e(e.items).filter(dA(n)).map(a=>[a,lA(t,n,a)]).filter(a=>a[1]!=="non-intersecting"),s=cA(Array.from(o)),i=e.id;if(s){const a=oA(s,t,n);if(!(a.z>0&&!Object.isExtensible(s.state.stoodOnBy)))return{roomId:i,scrXy:t,world:{itemId:s.id,onItem:{face:a,corner:iA(s,t),edge:aA(s,t,a)},position:uA(s,a,t,n,r)}}}return{roomId:i,scrXy:t,world:void 0}},hA=(t,e=console.error)=>(...n)=>{try{return t(...n)}catch(r){e(r);return}},_r=40,ps=(t,e,n)=>{const r=t.cssUpscale*t.gameEngineUpscale;if(n.target===null)throw new Error("Mouse event target is null");const o=n.target.getBoundingClientRect(),s=n.clientX-o.left,i=n.clientY-o.top;return{x:s/r+e.l-_r,y:i/r+e.t-_r}},fA=(t,e)=>{const n=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const r=e.movementX,o=e.movementY;return{x:r/n,y:o/n}},th=(t,e,n)=>{const{world:{onItem:{face:r},position:o,itemId:s}}=t;if(r.z>_h)return hs(o);if(n.type==="door"){const i=e.items[s];if(i.type!=="wall")return;const{config:a,aabb:l,state:{position:c}}=i,u=Pv(wl(a)),d=Pr(Kt(a.direction)),h=Kt(a.direction);if(u[d]<2)return;const p=c[d],g=c[d]+l[d]-Q1,y=c.z,v=c.z+l.z-Vr,w={[d]:Math.max(Math.min(o[d],g),p),[h]:o[h],z:Math.max(Math.min(o.z,v),y)};return hs(w)}return D(hs(o),r)},Os=({levelEditor:t},e,n)=>{const r=e.items[n]?.jsonItemId;if(r===void 0)return;const o=Nh(t,r);if(o!==void 0)return[r,o]},{dispatch:Ur}=W;class pA{handleMouseMove({pointingAtChanged:e,roomState:n,pointingAt:r,tool:o,storeState:s}){if(!e||(Ur(wa()),r.world===void 0))return;const i=Os(s,n,r.world.itemId);if(i===void 0)return;const[,a]=i,l=th(r,n,o.item);if(l===void 0)return;const{item:c}=o,u=c.type==="door"?Ds(c,h=>{const p=n.items[r.world.itemId];h.config.direction=p.config.direction}):o.item;CP({roomState:n,blockPosition:l,itemTool:u})||Ur(xc({blockPosition:l,pointedAtItemJson:a,preview:!0}))}handleMouseUp({roomState:e,pointingAt:n,tool:r,storeState:o,isClick:s}){if(!s)return;if(n.world===void 0){Ur(Tn({type:"pointer"}));return}const i=Os(o,e,n.world.itemId);if(i===void 0)return;const[,a]=i,l=th(n,e,r.item);l!==void 0&&Ur(xc({blockPosition:l,pointedAtItemJson:a,preview:!1}))}handleMouseDown(e){}handleMouseLeave(e){Ur(wa())}}const mA=t=>Mh(e=>e>0?e:e>-1?1:-e+1,t),gA=({jsonItem:t,blockDragAccVec:e,resizeEdgeDirection:n})=>{const r=t.position,o=ws(t),s=so(e,n,bl(t)),i=D(o,s),a=mA(i),l=Mh((c,u,d,h,p)=>{const g=u<1;return c<0!==g?g?d-p+1:d+h-p:g?d+h-1:d},n,i,r,o,a);return{timesDelta:hr(a,o),positionDelta:hr(l,r)}},Is=(t,...e)=>t.levelEditor.wallsFloorsLocked&&e.some(n=>n.type==="wall"||n.type==="floor"),il=(t,e)=>{const n=W.getState();let r;if(e.world){const o=e.world.itemId,s=o&&t.items[o],i=Is(n,s)?void 0:s.jsonItemId;r=i===void 0?void 0:{jsonItemId:i,pointingAtOnItem:e.world.onItem}}else r=void 0;Ge($h(n),r)||W.dispatch(zh(r))},yA=5,{dispatch:Hr}=W,vA=(t,e,n)=>{const r=n?.world?.itemId;if(r===void 0)return vs;const o=e.items[r].jsonItemId;if(o===void 0)return vs;const{selectedJsonItemIds:s}=t.levelEditor;return s.includes(o)?s:[o]},wA=(t,e,n)=>{const r=t.world?.onItem.edge,o=so(...vt(n).map(i=>bl(i))),s=so(r?.point??le,o);return zs(s)>0?r.normal:e?{x:1,y:0,z:0}:{x:0,y:0,z:1}},bA=(t,e,n,r,o,s)=>{if(t===void 0)return;const i=Vt(e,t.scrXy),a=gl(i);if(!(o||a>yA))return;const c=wA(t,r,s),u=rg(c,n);return r?{x:0,y:0,z:u.z}:u},nh=(t,e=!1)=>{const n=W.getState().levelEditor;return Bg(t,{x:0,y:0,z:1},n.tool,e?1:n.gridResolution)};class xA{handleMouseMove({roomState:e,pointingAt:n,storeState:r,mouseDownPointingAtRef:o,mouseEvent:s,upscale:i,dragAccVec:a,roomRenderSize:l}){const c=fA(i,s),u=vA(r,e,o.current);if(u.length===0){il(e,n);return}const d=u.map(C=>Ev(r,C));if(Is(r,...d))return;const p=n.roomId===o.current?.roomId?bA(o.current,ps(i,l,s),c,s.metaKey||s.shiftKey,a.current!==void 0,d):void 0;if(!p){il(e,n);return}u.length===1&&!Tv(r,u[0])&&W.dispatch(yi({jsonItemIds:u}));const g=o.current?.world?.onItem.edge,y=g&&d.every(C=>Dh(C)),v=a.current??le,w=D(v,p),x=nh(w,y);if(a.current=w,pl(nh(v,y),x))return;const b=hs(x);let _,S;if(y){const[,C]=Os(r,e,o.current.world.itemId);({timesDelta:S,positionDelta:_}=gA({jsonItem:C,blockDragAccVec:b,resizeEdgeDirection:g.point}))}else _=b;fg({roomState:e,jsonItemIds:u,blockPositionDelta:_,timesDelta:S})||Hr(Ah({jsonItemIds:u,positionDelta:_,timesDelta:S}))}handleMouseUp({roomState:e,pointingAt:n,storeState:r,mouseEvent:o,isClick:s,isDragEnd:i}){if(s){const a=n.world===void 0?void 0:e.items[n.world.itemId];if(a?.jsonItemId===void 0||Is(r,a)){Hr(yi({jsonItemIds:[]}));return}Hr(o.ctrlKey||o.metaKey?Av({jsonItemId:a.jsonItemId}):yi({jsonItemIds:[a.jsonItemId]}))}else i&&Hr(Rh())}handleMouseDown(e){}handleMouseLeave(e){Hr(zh(void 0))}}const{dispatch:_A}=W;class CA{handleMouseMove({roomState:e,pointingAt:n}){il(e,n)}handleMouseUp({roomState:e,pointingAt:n,storeState:r,isClick:o}){if(!o)return;const s=n.world?.itemId;if(s===void 0){console.warn("no itemId");return}const i=e.items[s];if(Is(r,i))return;const a=Os(r,e,s);if(a===void 0)return;const[,l]=a;_A(Tn({type:"item",item:{type:l.type,config:l.config}}))}handleMouseDown(e){}handleMouseLeave(e){}}const ns={item:new pA,pointer:new xA,eyeDropper:new CA},SA=t=>{const e=In(),n=kr(yl),r=He(),o=m.useRef(void 0),s=m.useRef(void 0),i=m.useRef(void 0);m.useEffect(()=>{if(t===null)return;const a=h=>{const p=W.getState(),g=nr(p),y=fs(p),v=ps(n,y,h),w=pn(p),x=ua(v,g,w,p.levelEditor.gridResolution),b=!Ge(x.world,o.current?.world);ns[w.type].handleMouseMove({pointingAtChanged:b,roomState:g,pointingAt:x,tool:w,storeState:p,mouseDownPointingAtRef:s,mouseEvent:h,upscale:n,dragAccVec:i,roomRenderSize:y}),o.current=x},l=h=>{const p=W.getState(),g=nr(p);if(g.id!==p.levelEditor.currentlyEditingRoomId)return;const y=fs(p),v=ps(n,y,h),w=pn(W.getState()),x=ua(v,g,w,p.levelEditor.gridResolution),b=i.current!==void 0,_=!b&&x.roomId===s.current?.roomId&&x.world?.itemId===s.current?.world?.itemId,S=s.current;if(i.current=void 0,s.current=void 0,W.dispatch(Rv(!1)),!_&&!b){console.log("mouseUp - not a click or drag end - skipping");return}ns[w.type].handleMouseUp({roomState:g,pointingAt:x,tool:w,storeState:p,mouseDownPointingAt:S,mouseEvent:h,upscale:n,isClick:_,isDragEnd:b})},c=h=>{const p=W.getState(),g=nr(p),y=pn(p);i.current=void 0,s.current=void 0,ns[y.type].handleMouseLeave({roomState:g,tool:y,storeState:p,mouseEvent:h})},u=h=>{const p=W.getState(),g=nr(p),y=fs(p),v=ps(n,y,h),w=pn(p),x=ua(v,g,w,p.levelEditor.gridResolution);console.log("setting mouseDownPointingAtRef to",x),s.current=x,ns[w.type].handleMouseDown({roomState:g,pointingAt:x,tool:w,storeState:p,mouseEvent:h,upscale:n})},d=hA(a);return t.addEventListener("mousemove",d),t.addEventListener("mouseup",l),t.addEventListener("mousedown",u),t.addEventListener("mouseleave",c),t.tabIndex=0,()=>{t.removeEventListener("mousemove",d),t.removeEventListener("mouseup",l),t.removeEventListener("mousedown",u),t.removeEventListener("mouseleave",c)}},[e.stage,n,t,r])},kA=()=>{const{cssUpscale:t,canvasSize:e,rotate90:n}=kr(yl);return n?`scale(${t}) rotate(90deg) translate(0, -${e.y}px)`:`scale(${t})`},PA=t=>{const e=ug(),n=In();m.useEffect(()=>{let r=0;const o=({deltaMS:s})=>{if(t.destroyed)return;t.renderContext.room!==e&&console.warn("room renderer does not have the current room");const i=new Set(ys(e.items));e.roomTime+=s,t.tick({deltaMS:s,movedItems:i,progression:r++}),n.render()};return Qn.shared.add(o),()=>{Qn.shared.remove(o)}},[t,e,n])},EA=t=>{const e=In();m.useEffect(()=>{if(t)return t.appendChild(e.canvas),()=>{t.removeChild(e.canvas)}},[t,e])},TA=()=>{const t=In(),e=kr(n=>n.upscale.upscale.gameEngineUpscale);t.stage.scale=e},AA=()=>{const t=In(),e=dg(),n=kr(r=>r.upscale.upscale);m.useEffect(()=>{const r=(2*_r+e.w)*n.gameEngineUpscale,o=(2*_r+e.h)*n.gameEngineUpscale;t.renderer?.resize(r,o)},[t.renderer,e,n])},RA=t=>{const e=In(),[n]=m.useState(()=>new ne({label:"editorPositioner"})),r=dg();m.useEffect(()=>{if(t.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return n.addChild(t.output.graphics),e.stage.addChild(n),()=>{e.stage.removeChild(n),n.removeChild(t.output.graphics)}},[t,e,n]),m.useEffect(()=>{n.x=-r.l+_r,n.y=-r.t+_r},[n,r])},rh=(t,e)=>{W.dispatch(Fy(Uy(t??Hy(W.getState()),e)))},OA=(t,e)=>{const n=He();m.useLayoutEffect(()=>{rh()},[]),m.useLayoutEffect(()=>{const r=()=>rh(t,e);if(e){const o=new ResizeObserver(r);return o.observe(e),()=>o.disconnect()}else return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[n,e,t])},IA=()=>{m.useEffect(()=>Ph({actionCreator:Tn,effect(t,{dispatch:e}){e(wa())}}))},jA=(t,e)=>{const n=m.useCallback(()=>{if(t===null)return;const r=Math.max(0,(t.scrollWidth-t.clientWidth)/2),o=Math.max(0,(t.scrollHeight-t.clientHeight)/2);t.scrollTo(r,o)},[t]);m.useEffect(()=>{if(t!==null)return Ph({actionCreator:io,effect(){setTimeout(n,0)}})},[n,t]),m.useEffect(()=>{if(t===null||e===null)return;if(e.querySelector("canvas"))setTimeout(n,0);else{const o=new MutationObserver(()=>{e.querySelector("canvas")&&(n(),o.disconnect())});return o.observe(e,{childList:!0,subtree:!0}),()=>o.disconnect()}},[t,e,n])},$A={amigaHiResPal:"Amiga Hi-Res PAL",classicMac:"Classic Mac",amigaLowResPal:"Amiga Low-Res PAL",zxSpectrum:"ZX Spectrum",handheld:"Handheld"},NA=({selectedResolution:t,onResolutionChange:e})=>{const n=Ao.indexOf(t),r=n<Ao.length-1,o=n>0,{justDone:s,doneNow:i}=ic();return f.jsxs("div",{className:"absolute top-0 right-0 z-popups flex gap-0 leading-none text-white",children:[s>0&&f.jsx(O,{className:"px-1 bg-moss items-center flex",children:$A[t]}),f.jsx(ee,{small:!0,disabled:!o,tooltipContent:`##zoom 

makes things look *smaller* by *increasing* emulated resolution`,onClick:()=>{o&&(e(Ao[n-1]),i())},shortcutKeys:["-"],children:f.jsx(O,{children:"-"})}),f.jsx(ee,{small:!0,disabled:!r,tooltipContent:`##zoom 

makes things look *bigger* by *decreasing* emulated resolution`,onClick:()=>{r&&(e(Ao[n+1]),i())},shortcutKeys:["+","="],children:f.jsx(O,{children:"+"})})]})},MA=({levelEditor:t})=>{const{dragInProgress:e,clickableAnnotationHovered:n,hoveredItem:r,selectedJsonItemIds:o}=t;if(e)return ye("cursor-grabbing");if(n)return ye("cursor-pointer");if(r){const s=Nh(t,r.jsonItemId);if(s!==void 0&&Dh(s))if(r.pointingAtOnItem.corner){if(pl(r.pointingAtOnItem.corner,{x:1,y:1,z:1}))return ye("cursor-n-resize")}else{const{edge:i}=r.pointingAtOnItem;if(i){if(Ge(i,Dg))return ye("cursor-e-resize");if(Ge(i,Og))return ye("cursor-s-resize");if(Ge(i,Mg))return ye("cursor-w-resize");if(Ge(i,Ig)||Ge(i,$g))return ye("cursor-ne-resize");if(Ge(i,jg)||Ge(i,Ng))return ye("cursor-nw-resize");if(Ge(i,Lg))return ye("cursor-se-resize");if(Ge(i,zg))return ye("cursor-sw-resize")}}return o.includes(r.jsonItemId)?ye("cursor-grab"):ye("cursor-default")}return ye("cursor-crosshair")},zA=()=>ge(MA);Wy.defaultOptions.scaleMode="nearest";const DA=()=>{const t=tA(),[e,n]=m.useState(null),[r,o]=m.useState(null),[s,i]=m.useState("amigaLowResPal"),a=zA();return OA(s,r??void 0),AA(),RA(t),PA(t),SA(e),EA(e),TA(),IA(),jA(r,e),f.jsxs("div",{className:`w-full h-full ${a} relative scale-editor`,children:[f.jsx(NA,{selectedResolution:s,onResolutionChange:i}),f.jsx("div",{className:`w-full h-full bg-editor-checkerboard overflow-scroll flex scrollbar scrollbar-w-1 scrollbar-track-pureBlack scrollbar-thumb-metallicBlue ${a}`,ref:o,children:f.jsx("div",{className:"flex justify-center items-center w-[500dvw] h-[500dvh]",children:f.jsx("div",{style:{transform:kA(),transformOrigin:"center center"},ref:n})})})]})},oh=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,LA=()=>{const t=Gy(),e=kr(qy);m.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",Vy())},[]),m.useEffect(()=>{document.body.classList.remove(...Object.keys(Ky).map(oh)),document.body.classList.add(oh(t)),document.body.classList.toggle("portrait-rot",e)},[t,e])},di=m.createContext(null);di.displayName="PanelGroupContext";const we={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},uc=10,gn=m.useLayoutEffect,sh=Ns.useId,BA=typeof sh=="function"?sh:()=>null;let FA=0;function dc(t=null){const e=BA(),n=m.useRef(t||e||null);return n.current===null&&(n.current=""+FA++),t??n.current}function Fg({children:t,className:e="",collapsedSize:n,collapsible:r,defaultSize:o,forwardedRef:s,id:i,maxSize:a,minSize:l,onCollapse:c,onExpand:u,onResize:d,order:h,style:p,tagName:g="div",...y}){const v=m.useContext(di);if(v===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:w,expandPanel:x,getPanelSize:b,getPanelStyle:_,groupId:S,isPanelCollapsed:k,reevaluatePanelConstraints:C,registerPanel:M,resizePanel:X,unregisterPanel:L}=v,J=dc(i),j=m.useRef({callbacks:{onCollapse:c,onExpand:u,onResize:d},constraints:{collapsedSize:n,collapsible:r,defaultSize:o,maxSize:a,minSize:l},id:J,idIsFromProps:i!==void 0,order:h});m.useRef({didLogMissingDefaultSizeWarning:!1}),gn(()=>{const{callbacks:B,constraints:Y}=j.current,K={...Y};j.current.id=J,j.current.idIsFromProps=i!==void 0,j.current.order=h,B.onCollapse=c,B.onExpand=u,B.onResize=d,Y.collapsedSize=n,Y.collapsible=r,Y.defaultSize=o,Y.maxSize=a,Y.minSize=l,(K.collapsedSize!==Y.collapsedSize||K.collapsible!==Y.collapsible||K.maxSize!==Y.maxSize||K.minSize!==Y.minSize)&&C(j.current,K)}),gn(()=>{const B=j.current;return M(B),()=>{L(B)}},[h,J,M,L]),m.useImperativeHandle(s,()=>({collapse:()=>{w(j.current)},expand:B=>{x(j.current,B)},getId(){return J},getSize(){return b(j.current)},isCollapsed(){return k(j.current)},isExpanded(){return!k(j.current)},resize:B=>{X(j.current,B)}}),[w,x,b,k,J,X]);const oe=_(j.current,o);return m.createElement(g,{...y,children:t,className:e,id:J,style:{...oe,...p},[we.groupId]:S,[we.panel]:"",[we.panelCollapsible]:r||void 0,[we.panelId]:J,[we.panelSize]:parseFloat(""+oe.flexGrow).toFixed(1)})}const ms=m.forwardRef((t,e)=>m.createElement(Fg,{...t,forwardedRef:e}));Fg.displayName="Panel";ms.displayName="forwardRef(Panel)";let al=null,gs=-1,Ht=null;function UA(t,e){if(e){const n=(e&qg)!==0,r=(e&Vg)!==0,o=(e&Kg)!==0,s=(e&Xg)!==0;if(n)return o?"se-resize":s?"ne-resize":"e-resize";if(r)return o?"sw-resize":s?"nw-resize":"w-resize";if(o)return"s-resize";if(s)return"n-resize"}switch(t){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function HA(){Ht!==null&&(document.head.removeChild(Ht),al=null,Ht=null,gs=-1)}function da(t,e){var n,r;const o=UA(t,e);if(al!==o){if(al=o,Ht===null&&(Ht=document.createElement("style"),document.head.appendChild(Ht)),gs>=0){var s;(s=Ht.sheet)===null||s===void 0||s.removeRule(gs)}gs=(n=(r=Ht.sheet)===null||r===void 0?void 0:r.insertRule(`*{cursor: ${o} !important;}`))!==null&&n!==void 0?n:-1}}function Ug(t){return t.type==="keydown"}function Hg(t){return t.type.startsWith("pointer")}function Wg(t){return t.type.startsWith("mouse")}function hi(t){if(Hg(t)){if(t.isPrimary)return{x:t.clientX,y:t.clientY}}else if(Wg(t))return{x:t.clientX,y:t.clientY};return{x:1/0,y:1/0}}function WA(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function GA(t,e,n){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function qA(t,e){if(t===e)throw new Error("Cannot compare node with itself");const n={a:lh(t),b:lh(e)};let r;for(;n.a.at(-1)===n.b.at(-1);)t=n.a.pop(),e=n.b.pop(),r=t;te(r,"Stacking order can only be calculated for elements with a common ancestor");const o={a:ah(ih(n.a)),b:ah(ih(n.b))};if(o.a===o.b){const s=r.childNodes,i={a:n.a.at(-1),b:n.b.at(-1)};let a=s.length;for(;a--;){const l=s[a];if(l===i.a)return 1;if(l===i.b)return-1}}return Math.sign(o.a-o.b)}const VA=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function KA(t){var e;const n=getComputedStyle((e=Gg(t))!==null&&e!==void 0?e:t).display;return n==="flex"||n==="inline-flex"}function XA(t){const e=getComputedStyle(t);return!!(e.position==="fixed"||e.zIndex!=="auto"&&(e.position!=="static"||KA(t))||+e.opacity<1||"transform"in e&&e.transform!=="none"||"webkitTransform"in e&&e.webkitTransform!=="none"||"mixBlendMode"in e&&e.mixBlendMode!=="normal"||"filter"in e&&e.filter!=="none"||"webkitFilter"in e&&e.webkitFilter!=="none"||"isolation"in e&&e.isolation==="isolate"||VA.test(e.willChange)||e.webkitOverflowScrolling==="touch")}function ih(t){let e=t.length;for(;e--;){const n=t[e];if(te(n,"Missing node"),XA(n))return n}return null}function ah(t){return t&&Number(getComputedStyle(t).zIndex)||0}function lh(t){const e=[];for(;t;)e.push(t),t=Gg(t);return e}function Gg(t){const{parentNode:e}=t;return e&&e instanceof ShadowRoot?e.host:e}const qg=1,Vg=2,Kg=4,Xg=8,JA=WA()==="coarse";let ot=[],dr=!1,Wt=new Map,fi=new Map;const po=new Set;function YA(t,e,n,r,o){var s;const{ownerDocument:i}=e,a={direction:n,element:e,hitAreaMargins:r,setResizeHandlerState:o},l=(s=Wt.get(i))!==null&&s!==void 0?s:0;return Wt.set(i,l+1),po.add(a),js(),function(){var u;fi.delete(t),po.delete(a);const d=(u=Wt.get(i))!==null&&u!==void 0?u:1;if(Wt.set(i,d-1),js(),d===1&&Wt.delete(i),ot.includes(a)){const h=ot.indexOf(a);h>=0&&ot.splice(h,1),fc(),o("up",!0,null)}}}function ZA(t){const{target:e}=t,{x:n,y:r}=hi(t);dr=!0,hc({target:e,x:n,y:r}),js(),ot.length>0&&($s("down",t),t.preventDefault(),Jg(e)||t.stopImmediatePropagation())}function ha(t){const{x:e,y:n}=hi(t);if(dr&&t.buttons===0&&(dr=!1,$s("up",t)),!dr){const{target:r}=t;hc({target:r,x:e,y:n})}$s("move",t),fc(),ot.length>0&&t.preventDefault()}function fa(t){const{target:e}=t,{x:n,y:r}=hi(t);fi.clear(),dr=!1,ot.length>0&&(t.preventDefault(),Jg(e)||t.stopImmediatePropagation()),$s("up",t),hc({target:e,x:n,y:r}),fc(),js()}function Jg(t){let e=t;for(;e;){if(e.hasAttribute(we.resizeHandle))return!0;e=e.parentElement}return!1}function hc({target:t,x:e,y:n}){ot.splice(0);let r=null;(t instanceof HTMLElement||t instanceof SVGElement)&&(r=t),po.forEach(o=>{const{element:s,hitAreaMargins:i}=o,a=s.getBoundingClientRect(),{bottom:l,left:c,right:u,top:d}=a,h=JA?i.coarse:i.fine;if(e>=c-h&&e<=u+h&&n>=d-h&&n<=l+h){if(r!==null&&document.contains(r)&&s!==r&&!s.contains(r)&&!r.contains(s)&&qA(r,s)>0){let g=r,y=!1;for(;g&&!g.contains(s);){if(GA(g.getBoundingClientRect(),a)){y=!0;break}g=g.parentElement}if(y)return}ot.push(o)}})}function pa(t,e){fi.set(t,e)}function fc(){let t=!1,e=!1;ot.forEach(r=>{const{direction:o}=r;o==="horizontal"?t=!0:e=!0});let n=0;fi.forEach(r=>{n|=r}),t&&e?da("intersection",n):t?da("horizontal",n):e?da("vertical",n):HA()}let ma;function js(){var t;(t=ma)===null||t===void 0||t.abort(),ma=new AbortController;const e={capture:!0,signal:ma.signal};po.size&&(dr?(ot.length>0&&Wt.forEach((n,r)=>{const{body:o}=r;n>0&&(o.addEventListener("contextmenu",fa,e),o.addEventListener("pointerleave",ha,e),o.addEventListener("pointermove",ha,e))}),Wt.forEach((n,r)=>{const{body:o}=r;o.addEventListener("pointerup",fa,e),o.addEventListener("pointercancel",fa,e)})):Wt.forEach((n,r)=>{const{body:o}=r;n>0&&(o.addEventListener("pointerdown",ZA,e),o.addEventListener("pointermove",ha,e))}))}function $s(t,e){po.forEach(n=>{const{setResizeHandlerState:r}=n,o=ot.includes(n);r(t,o,e)})}function QA(){const[t,e]=m.useState(0);return m.useCallback(()=>e(n=>n+1),[])}function te(t,e){if(!t)throw console.error(e),Error(e)}function kn(t,e,n=uc){return t.toFixed(n)===e.toFixed(n)?0:t>e?1:-1}function Et(t,e,n=uc){return kn(t,e,n)===0}function qe(t,e,n){return kn(t,e,n)===0}function eR(t,e,n){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const o=t[r],s=e[r];if(!qe(o,s,n))return!1}return!0}function or({panelConstraints:t,panelIndex:e,size:n}){const r=t[e];te(r!=null,`Panel constraints not found for index ${e}`);let{collapsedSize:o=0,collapsible:s,maxSize:i=100,minSize:a=0}=r;if(kn(n,a)<0)if(s){const l=(o+a)/2;kn(n,l)<0?n=o:n=a}else n=a;return n=Math.min(i,n),n=parseFloat(n.toFixed(uc)),n}function Jr({delta:t,initialLayout:e,panelConstraints:n,pivotIndices:r,prevLayout:o,trigger:s}){if(qe(t,0))return e;const i=[...e],[a,l]=r;te(a!=null,"Invalid first pivot index"),te(l!=null,"Invalid second pivot index");let c=0;if(s==="keyboard"){{const d=t<0?l:a,h=n[d];te(h,`Panel constraints not found for index ${d}`);const{collapsedSize:p=0,collapsible:g,minSize:y=0}=h;if(g){const v=e[d];if(te(v!=null,`Previous layout not found for panel index ${d}`),qe(v,p)){const w=y-v;kn(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}{const d=t<0?a:l,h=n[d];te(h,`No panel constraints found for index ${d}`);const{collapsedSize:p=0,collapsible:g,minSize:y=0}=h;if(g){const v=e[d];if(te(v!=null,`Previous layout not found for panel index ${d}`),qe(v,y)){const w=v-p;kn(w,Math.abs(t))>0&&(t=t<0?0-w:w)}}}}{const d=t<0?1:-1;let h=t<0?l:a,p=0;for(;;){const y=e[h];te(y!=null,`Previous layout not found for panel index ${h}`);const w=or({panelConstraints:n,panelIndex:h,size:100})-y;if(p+=w,h+=d,h<0||h>=n.length)break}const g=Math.min(Math.abs(t),Math.abs(p));t=t<0?0-g:g}{let h=t<0?a:l;for(;h>=0&&h<n.length;){const p=Math.abs(t)-Math.abs(c),g=e[h];te(g!=null,`Previous layout not found for panel index ${h}`);const y=g-p,v=or({panelConstraints:n,panelIndex:h,size:y});if(!qe(g,v)&&(c+=g-v,i[h]=v,c.toPrecision(3).localeCompare(Math.abs(t).toPrecision(3),void 0,{numeric:!0})>=0))break;t<0?h--:h++}}if(eR(o,i))return o;{const d=t<0?l:a,h=e[d];te(h!=null,`Previous layout not found for panel index ${d}`);const p=h+c,g=or({panelConstraints:n,panelIndex:d,size:p});if(i[d]=g,!qe(g,p)){let y=p-g,w=t<0?l:a;for(;w>=0&&w<n.length;){const x=i[w];te(x!=null,`Previous layout not found for panel index ${w}`);const b=x+y,_=or({panelConstraints:n,panelIndex:w,size:b});if(qe(x,_)||(y-=_-x,i[w]=_),qe(y,0))break;t>0?w--:w++}}}const u=i.reduce((d,h)=>h+d,0);return qe(u,100)?i:o}function tR({layout:t,panelsArray:e,pivotIndices:n}){let r=0,o=100,s=0,i=0;const a=n[0];te(a!=null,"No pivot index found"),e.forEach((d,h)=>{const{constraints:p}=d,{maxSize:g=100,minSize:y=0}=p;h===a?(r=y,o=g):(s+=y,i+=g)});const l=Math.min(o,100-s),c=Math.max(r,100-i),u=t[a];return{valueMax:l,valueMin:c,valueNow:u}}function mo(t,e=document){return Array.from(e.querySelectorAll(`[${we.resizeHandleId}][data-panel-group-id="${t}"]`))}function Yg(t,e,n=document){const o=mo(t,n).findIndex(s=>s.getAttribute(we.resizeHandleId)===e);return o??null}function Zg(t,e,n){const r=Yg(t,e,n);return r!=null?[r,r+1]:[-1,-1]}function nR(t){return t instanceof HTMLElement?!0:typeof t=="object"&&t!==null&&"tagName"in t&&"getAttribute"in t}function Qg(t,e=document){if(nR(e)&&e.dataset.panelGroupId==t)return e;const n=e.querySelector(`[data-panel-group][data-panel-group-id="${t}"]`);return n||null}function pi(t,e=document){const n=e.querySelector(`[${we.resizeHandleId}="${t}"]`);return n||null}function rR(t,e,n,r=document){var o,s,i,a;const l=pi(e,r),c=mo(t,r),u=l?c.indexOf(l):-1,d=(o=(s=n[u])===null||s===void 0?void 0:s.id)!==null&&o!==void 0?o:null,h=(i=(a=n[u+1])===null||a===void 0?void 0:a.id)!==null&&i!==void 0?i:null;return[d,h]}function oR({committedValuesRef:t,eagerValuesRef:e,groupId:n,layout:r,panelDataArray:o,panelGroupElement:s,setLayout:i}){m.useRef({didWarnAboutMissingResizeHandle:!1}),gn(()=>{if(!s)return;const a=mo(n,s);for(let l=0;l<o.length-1;l++){const{valueMax:c,valueMin:u,valueNow:d}=tR({layout:r,panelsArray:o,pivotIndices:[l,l+1]}),h=a[l];if(h!=null){const p=o[l];te(p,`No panel data found for index "${l}"`),h.setAttribute("aria-controls",p.id),h.setAttribute("aria-valuemax",""+Math.round(c)),h.setAttribute("aria-valuemin",""+Math.round(u)),h.setAttribute("aria-valuenow",d!=null?""+Math.round(d):"")}}return()=>{a.forEach((l,c)=>{l.removeAttribute("aria-controls"),l.removeAttribute("aria-valuemax"),l.removeAttribute("aria-valuemin"),l.removeAttribute("aria-valuenow")})}},[n,r,o,s]),m.useEffect(()=>{if(!s)return;const a=e.current;te(a,"Eager values not found");const{panelDataArray:l}=a,c=Qg(n,s);te(c!=null,`No group found for id "${n}"`);const u=mo(n,s);te(u,`No resize handles found for group id "${n}"`);const d=u.map(h=>{const p=h.getAttribute(we.resizeHandleId);te(p,"Resize handle element has no handle id attribute");const[g,y]=rR(n,p,l,s);if(g==null||y==null)return()=>{};const v=w=>{if(!w.defaultPrevented)switch(w.key){case"Enter":{w.preventDefault();const x=l.findIndex(b=>b.id===g);if(x>=0){const b=l[x];te(b,`No panel data found for index ${x}`);const _=r[x],{collapsedSize:S=0,collapsible:k,minSize:C=0}=b.constraints;if(_!=null&&k){const M=Jr({delta:qe(_,S)?C-S:S-_,initialLayout:r,panelConstraints:l.map(X=>X.constraints),pivotIndices:Zg(n,p,s),prevLayout:r,trigger:"keyboard"});r!==M&&i(M)}}break}}};return h.addEventListener("keydown",v),()=>{h.removeEventListener("keydown",v)}});return()=>{d.forEach(h=>h())}},[s,t,e,n,r,o,i])}function ch(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function ey(t,e){const n=t==="horizontal",{x:r,y:o}=hi(e);return n?r:o}function sR(t,e,n,r,o){const s=n==="horizontal",i=pi(e,o);te(i,`No resize handle element found for id "${e}"`);const a=i.getAttribute(we.groupId);te(a,"Resize handle element has no group id attribute");let{initialCursorPosition:l}=r;const c=ey(n,t),u=Qg(a,o);te(u,`No group element found for id "${a}"`);const d=u.getBoundingClientRect(),h=s?d.width:d.height;return(c-l)/h*100}function iR(t,e,n,r,o,s){if(Ug(t)){const i=n==="horizontal";let a=0;t.shiftKey?a=100:o!=null?a=o:a=10;let l=0;switch(t.key){case"ArrowDown":l=i?0:a;break;case"ArrowLeft":l=i?-a:0;break;case"ArrowRight":l=i?a:0;break;case"ArrowUp":l=i?0:-a;break;case"End":l=100;break;case"Home":l=-100;break}return l}else return r==null?0:sR(t,e,n,r,s)}function aR({panelDataArray:t}){const e=Array(t.length),n=t.map(s=>s.constraints);let r=0,o=100;for(let s=0;s<t.length;s++){const i=n[s];te(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;a!=null&&(r++,e[s]=a,o-=a)}for(let s=0;s<t.length;s++){const i=n[s];te(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;if(a!=null)continue;const l=t.length-r,c=o/l;r++,e[s]=c,o-=c}return e}function Kn(t,e,n){e.forEach((r,o)=>{const s=t[o];te(s,`Panel data not found for index ${o}`);const{callbacks:i,constraints:a,id:l}=s,{collapsedSize:c=0,collapsible:u}=a,d=n[l];if(d==null||r!==d){n[l]=r;const{onCollapse:h,onExpand:p,onResize:g}=i;g&&g(r,d),u&&(h||p)&&(p&&(d==null||Et(d,c))&&!Et(r,c)&&p(),h&&(d==null||!Et(d,c))&&Et(r,c)&&h())}})}function rs(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!=e[n])return!1;return!0}function lR({defaultSize:t,dragState:e,layout:n,panelData:r,panelIndex:o,precision:s=3}){const i=n[o];let a;return i==null?a=t!=null?t.toPrecision(s):"1":r.length===1?a="1":a=i.toPrecision(s),{flexBasis:0,flexGrow:a,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function cR(t,e=10){let n=null;return(...o)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{t(...o)},e)}}function uh(t){try{if(typeof localStorage<"u")t.getItem=e=>localStorage.getItem(e),t.setItem=(e,n)=>{localStorage.setItem(e,n)};else throw new Error("localStorage not supported in this environment")}catch(e){console.error(e),t.getItem=()=>null,t.setItem=()=>{}}}function ty(t){return`react-resizable-panels:${t}`}function ny(t){return t.map(e=>{const{constraints:n,id:r,idIsFromProps:o,order:s}=e;return o?r:s?`${s}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((e,n)=>e.localeCompare(n)).join(",")}function ry(t,e){try{const n=ty(t),r=e.getItem(n);if(r){const o=JSON.parse(r);if(typeof o=="object"&&o!=null)return o}}catch{}return null}function uR(t,e,n){var r,o;const s=(r=ry(t,n))!==null&&r!==void 0?r:{},i=ny(e);return(o=s[i])!==null&&o!==void 0?o:null}function dR(t,e,n,r,o){var s;const i=ty(t),a=ny(e),l=(s=ry(t,o))!==null&&s!==void 0?s:{};l[a]={expandToSizes:Object.fromEntries(n.entries()),layout:r};try{o.setItem(i,JSON.stringify(l))}catch(c){console.error(c)}}function dh({layout:t,panelConstraints:e}){const n=[...t],r=n.reduce((s,i)=>s+i,0);if(n.length!==e.length)throw Error(`Invalid ${e.length} panel layout: ${n.map(s=>`${s}%`).join(", ")}`);if(!qe(r,100)&&n.length>0)for(let s=0;s<e.length;s++){const i=n[s];te(i!=null,`No layout data found for index ${s}`);const a=100/r*i;n[s]=a}let o=0;for(let s=0;s<e.length;s++){const i=n[s];te(i!=null,`No layout data found for index ${s}`);const a=or({panelConstraints:e,panelIndex:s,size:i});i!=a&&(o+=i-a,n[s]=a)}if(!qe(o,0))for(let s=0;s<e.length;s++){const i=n[s];te(i!=null,`No layout data found for index ${s}`);const a=i+o,l=or({panelConstraints:e,panelIndex:s,size:a});if(i!==l&&(o-=l-i,n[s]=l,qe(o,0)))break}return n}const hR=100,Yr={getItem:t=>(uh(Yr),Yr.getItem(t)),setItem:(t,e)=>{uh(Yr),Yr.setItem(t,e)}},hh={};function oy({autoSaveId:t=null,children:e,className:n="",direction:r,forwardedRef:o,id:s=null,onLayout:i=null,keyboardResizeBy:a=null,storage:l=Yr,style:c,tagName:u="div",...d}){const h=dc(s),p=m.useRef(null),[g,y]=m.useState(null),[v,w]=m.useState([]),x=QA(),b=m.useRef({}),_=m.useRef(new Map),S=m.useRef(0),k=m.useRef({autoSaveId:t,direction:r,dragState:g,id:h,keyboardResizeBy:a,onLayout:i,storage:l}),C=m.useRef({layout:v,panelDataArray:[],panelDataArrayChanged:!1});m.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),m.useImperativeHandle(o,()=>({getId:()=>k.current.id,getLayout:()=>{const{layout:P}=C.current;return P},setLayout:P=>{const{onLayout:R}=k.current,{layout:T,panelDataArray:I}=C.current,A=dh({layout:P,panelConstraints:I.map(z=>z.constraints)});ch(T,A)||(w(A),C.current.layout=A,R&&R(A),Kn(I,A,b.current))}}),[]),gn(()=>{k.current.autoSaveId=t,k.current.direction=r,k.current.dragState=g,k.current.id=h,k.current.onLayout=i,k.current.storage=l}),oR({committedValuesRef:k,eagerValuesRef:C,groupId:h,layout:v,panelDataArray:C.current.panelDataArray,setLayout:w,panelGroupElement:p.current}),m.useEffect(()=>{const{panelDataArray:P}=C.current;if(t){if(v.length===0||v.length!==P.length)return;let R=hh[t];R==null&&(R=cR(dR,hR),hh[t]=R);const T=[...P],I=new Map(_.current);R(t,T,I,v,l)}},[t,v,l]),m.useEffect(()=>{});const M=m.useCallback(P=>{const{onLayout:R}=k.current,{layout:T,panelDataArray:I}=C.current;if(P.constraints.collapsible){const A=I.map(Ne=>Ne.constraints),{collapsedSize:z=0,panelSize:re,pivotIndices:ue}=ln(I,P,T);if(te(re!=null,`Panel size not found for panel "${P.id}"`),!Et(re,z)){_.current.set(P.id,re);const Me=Zn(I,P)===I.length-1?re-z:z-re,ce=Jr({delta:Me,initialLayout:T,panelConstraints:A,pivotIndices:ue,prevLayout:T,trigger:"imperative-api"});rs(T,ce)||(w(ce),C.current.layout=ce,R&&R(ce),Kn(I,ce,b.current))}}},[]),X=m.useCallback((P,R)=>{const{onLayout:T}=k.current,{layout:I,panelDataArray:A}=C.current;if(P.constraints.collapsible){const z=A.map(Ze=>Ze.constraints),{collapsedSize:re=0,panelSize:ue=0,minSize:Ne=0,pivotIndices:Me}=ln(A,P,I),ce=R??Ne;if(Et(ue,re)){const Ze=_.current.get(P.id),Ir=Ze!=null&&Ze>=ce?Ze:ce,mi=Zn(A,P)===A.length-1?ue-Ir:Ir-ue,ze=Jr({delta:mi,initialLayout:I,panelConstraints:z,pivotIndices:Me,prevLayout:I,trigger:"imperative-api"});rs(I,ze)||(w(ze),C.current.layout=ze,T&&T(ze),Kn(A,ze,b.current))}}},[]),L=m.useCallback(P=>{const{layout:R,panelDataArray:T}=C.current,{panelSize:I}=ln(T,P,R);return te(I!=null,`Panel size not found for panel "${P.id}"`),I},[]),J=m.useCallback((P,R)=>{const{panelDataArray:T}=C.current,I=Zn(T,P);return lR({defaultSize:R,dragState:g,layout:v,panelData:T,panelIndex:I})},[g,v]),j=m.useCallback(P=>{const{layout:R,panelDataArray:T}=C.current,{collapsedSize:I=0,collapsible:A,panelSize:z}=ln(T,P,R);return te(z!=null,`Panel size not found for panel "${P.id}"`),A===!0&&Et(z,I)},[]),oe=m.useCallback(P=>{const{layout:R,panelDataArray:T}=C.current,{collapsedSize:I=0,collapsible:A,panelSize:z}=ln(T,P,R);return te(z!=null,`Panel size not found for panel "${P.id}"`),!A||kn(z,I)>0},[]),B=m.useCallback(P=>{const{panelDataArray:R}=C.current;R.push(P),R.sort((T,I)=>{const A=T.order,z=I.order;return A==null&&z==null?0:A==null?-1:z==null?1:A-z}),C.current.panelDataArrayChanged=!0,x()},[x]);gn(()=>{if(C.current.panelDataArrayChanged){C.current.panelDataArrayChanged=!1;const{autoSaveId:P,onLayout:R,storage:T}=k.current,{layout:I,panelDataArray:A}=C.current;let z=null;if(P){const ue=uR(P,A,T);ue&&(_.current=new Map(Object.entries(ue.expandToSizes)),z=ue.layout)}z==null&&(z=aR({panelDataArray:A}));const re=dh({layout:z,panelConstraints:A.map(ue=>ue.constraints)});ch(I,re)||(w(re),C.current.layout=re,R&&R(re),Kn(A,re,b.current))}}),gn(()=>{const P=C.current;return()=>{P.layout=[]}},[]);const Y=m.useCallback(P=>{let R=!1;const T=p.current;return T&&window.getComputedStyle(T,null).getPropertyValue("direction")==="rtl"&&(R=!0),function(A){A.preventDefault();const z=p.current;if(!z)return()=>null;const{direction:re,dragState:ue,id:Ne,keyboardResizeBy:Me,onLayout:ce}=k.current,{layout:Ze,panelDataArray:Ir}=C.current,{initialLayout:To}=ue??{},mi=Zg(Ne,P,z);let ze=iR(A,P,re,ue,Me,z);const pc=re==="horizontal";pc&&R&&(ze=-ze);const iy=Ir.map(ay=>ay.constraints),jr=Jr({delta:ze,initialLayout:To??Ze,panelConstraints:iy,pivotIndices:mi,prevLayout:Ze,trigger:Ug(A)?"keyboard":"mouse-or-touch"}),mc=!rs(Ze,jr);(Hg(A)||Wg(A))&&S.current!=ze&&(S.current=ze,!mc&&ze!==0?pc?pa(P,ze<0?qg:Vg):pa(P,ze<0?Kg:Xg):pa(P,0)),mc&&(w(jr),C.current.layout=jr,ce&&ce(jr),Kn(Ir,jr,b.current))}},[]),K=m.useCallback((P,R)=>{const{onLayout:T}=k.current,{layout:I,panelDataArray:A}=C.current,z=A.map(Ze=>Ze.constraints),{panelSize:re,pivotIndices:ue}=ln(A,P,I);te(re!=null,`Panel size not found for panel "${P.id}"`);const Me=Zn(A,P)===A.length-1?re-R:R-re,ce=Jr({delta:Me,initialLayout:I,panelConstraints:z,pivotIndices:ue,prevLayout:I,trigger:"imperative-api"});rs(I,ce)||(w(ce),C.current.layout=ce,T&&T(ce),Kn(A,ce,b.current))},[]),ie=m.useCallback((P,R)=>{const{layout:T,panelDataArray:I}=C.current,{collapsedSize:A=0,collapsible:z}=R,{collapsedSize:re=0,collapsible:ue,maxSize:Ne=100,minSize:Me=0}=P.constraints,{panelSize:ce}=ln(I,P,T);ce!=null&&(z&&ue&&Et(ce,A)?Et(A,re)||K(P,re):ce<Me?K(P,Me):ce>Ne&&K(P,Ne))},[K]),F=m.useCallback((P,R)=>{const{direction:T}=k.current,{layout:I}=C.current;if(!p.current)return;const A=pi(P,p.current);te(A,`Drag handle element not found for id "${P}"`);const z=ey(T,R);y({dragHandleId:P,dragHandleRect:A.getBoundingClientRect(),initialCursorPosition:z,initialLayout:I})},[]),ae=m.useCallback(()=>{y(null)},[]),ve=m.useCallback(P=>{const{panelDataArray:R}=C.current,T=Zn(R,P);T>=0&&(R.splice(T,1),delete b.current[P.id],C.current.panelDataArrayChanged=!0,x())},[x]),pe=m.useMemo(()=>({collapsePanel:M,direction:r,dragState:g,expandPanel:X,getPanelSize:L,getPanelStyle:J,groupId:h,isPanelCollapsed:j,isPanelExpanded:oe,reevaluatePanelConstraints:ie,registerPanel:B,registerResizeHandle:Y,resizePanel:K,startDragging:F,stopDragging:ae,unregisterPanel:ve,panelGroupElement:p.current}),[M,g,r,X,L,J,h,j,oe,ie,B,Y,K,F,ae,ve]),E={display:"flex",flexDirection:r==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return m.createElement(di.Provider,{value:pe},m.createElement(u,{...d,children:e,className:n,id:s,ref:p,style:{...E,...c},[we.group]:"",[we.groupDirection]:r,[we.groupId]:h}))}const sy=m.forwardRef((t,e)=>m.createElement(oy,{...t,forwardedRef:e}));oy.displayName="PanelGroup";sy.displayName="forwardRef(PanelGroup)";function Zn(t,e){return t.findIndex(n=>n===e||n.id===e.id)}function ln(t,e,n){const r=Zn(t,e),s=r===t.length-1?[r-1,r]:[r,r+1],i=n[r];return{...e.constraints,panelSize:i,pivotIndices:s}}function fR({disabled:t,handleId:e,resizeHandler:n,panelGroupElement:r}){m.useEffect(()=>{if(t||n==null||r==null)return;const o=pi(e,r);if(o==null)return;const s=i=>{if(!i.defaultPrevented)switch(i.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{i.preventDefault(),n(i);break}case"F6":{i.preventDefault();const a=o.getAttribute(we.groupId);te(a,`No group element found for id "${a}"`);const l=mo(a,r),c=Yg(a,e,r);te(c!==null,`No resize element found for id "${e}"`);const u=i.shiftKey?c>0?c-1:l.length-1:c+1<l.length?c+1:0;l[u].focus();break}}};return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}},[r,t,e,n])}function ll({children:t=null,className:e="",disabled:n=!1,hitAreaMargins:r,id:o,onBlur:s,onClick:i,onDragging:a,onFocus:l,onPointerDown:c,onPointerUp:u,style:d={},tabIndex:h=0,tagName:p="div",...g}){var y,v;const w=m.useRef(null),x=m.useRef({onClick:i,onDragging:a,onPointerDown:c,onPointerUp:u});m.useEffect(()=>{x.current.onClick=i,x.current.onDragging=a,x.current.onPointerDown=c,x.current.onPointerUp=u});const b=m.useContext(di);if(b===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:_,groupId:S,registerResizeHandle:k,startDragging:C,stopDragging:M,panelGroupElement:X}=b,L=dc(o),[J,j]=m.useState("inactive"),[oe,B]=m.useState(!1),[Y,K]=m.useState(null),ie=m.useRef({state:J});gn(()=>{ie.current.state=J}),m.useEffect(()=>{if(n)K(null);else{const pe=k(L);K(()=>pe)}},[n,L,k]);const F=(y=r?.coarse)!==null&&y!==void 0?y:15,ae=(v=r?.fine)!==null&&v!==void 0?v:5;m.useEffect(()=>{if(n||Y==null)return;const pe=w.current;te(pe,"Element ref not attached");let E=!1;return YA(L,pe,_,{coarse:F,fine:ae},(R,T,I)=>{if(!T){j("inactive");return}switch(R){case"down":{j("drag"),E=!1,te(I,'Expected event to be defined for "down" action'),C(L,I);const{onDragging:A,onPointerDown:z}=x.current;A?.(!0),z?.();break}case"move":{const{state:A}=ie.current;E=!0,A!=="drag"&&j("hover"),te(I,'Expected event to be defined for "move" action'),Y(I);break}case"up":{j("hover"),M();const{onClick:A,onDragging:z,onPointerUp:re}=x.current;z?.(!1),re?.(),E||A?.();break}}})},[F,_,n,ae,k,L,Y,C,M]),fR({disabled:n,handleId:L,resizeHandler:Y,panelGroupElement:X});const ve={touchAction:"none",userSelect:"none"};return m.createElement(p,{...g,children:t,className:e,id:o,onBlur:()=>{B(!1),s?.()},onFocus:()=>{B(!0),l?.()},ref:w,role:"separator",style:{...ve,...d},tabIndex:h,[we.groupDirection]:_,[we.groupId]:S,[we.resizeHandle]:"",[we.resizeHandleActive]:J==="drag"?"pointer":oe?"keyboard":void 0,[we.resizeHandleEnabled]:!n,[we.resizeHandleId]:L,[we.resizeHandleState]:J})}ll.displayName="PanelResizeHandle";const pR=Xy(()=>Gt(()=>import("./JsonRoomEditor-CGkRczBH.js").then(t=>t.J),__vite__mapDeps([8,1,2,6,9]))),mR=m.lazy(pR),gR=()=>{LA();const t=f.jsx("div",{className:"flex h-full items-center justify-center bg-pureBlack",children:f.jsx("span",{className:"sprite texture-animated-head_walking_right"})});return f.jsx(f.Fragment,{children:f.jsx(Ks,{children:f.jsx(AC,{children:f.jsxs(sy,{direction:"horizontal",className:"w-full h-full",children:[f.jsx(ms,{id:"jsonEditor",defaultSize:18,minSize:12,collapsible:!0,children:f.jsx(m.Suspense,{fallback:t,children:f.jsx(mR,{})})}),f.jsx(ll,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-r-[calc(1px*var(--scale))] border-metallicBlue"}),f.jsx(ms,{id:"editingArea",children:f.jsx(QT,{children:f.jsx(DA,{})})}),f.jsx(ll,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-l-[calc(1px*var(--scale))] border-metallicBlue"}),f.jsx(ms,{id:"toolbar",defaultSize:20,maxSize:33,minSize:10,children:f.jsx(OP,{})})]})})})})},OR=Object.freeze(Object.defineProperty({__proto__:null,default:gR},Symbol.toStringTag,{value:"Module"}));export{Vh as A,Wh as C,en as F,OR as L,Fs as R,hw as S,Kh as V,yw as a,kR as h,ye as t,dw as u};
