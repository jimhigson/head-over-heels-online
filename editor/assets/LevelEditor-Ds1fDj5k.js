const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WebGPURenderer-DHBlZLQM.js","assets/index-BC1SrdB3.js","assets/index-bgp0aWZX.css","assets/colorToUniform-KTpA7KSL.js","assets/SharedSystems-2bm6mCnU.js","assets/Graphics-CpYZdid_.js","assets/levelEditorSlice-BmkPxErl.js","assets/WebGLRenderer-CIurLBtc.js","assets/JsonRoomEditor-hQoeR9kK.js","assets/JsonRoomEditor-Cpm53wG5.css"])))=>i.map(i=>d[i]);
import{a6 as Ea,a5 as gn,a7 as Tt,s as _g,x as pd,y as Rt,e as Pa,E as Hn,a as Sg,C as te,d as Wn,v as Gn,Z as G,D as Mi,az as Ht,k as kg,K as mn,t as Ct,T as Kr,U as Cg,M as Eg,aA as Xr,V as gd,aB as Pg,w as Di,aC as Ag,aD as Tg,j as Rg,aE as _r,aF as h,aG as md,aH as Wt,aI as g,aJ as Ig,aK as yd,aL as Og,aM as jg,aN as le,aO as Be,aP as vd,aQ as $g,aR as Ng,aS as L,aT as Ue,aU as yn,al as zg,aV as Mg,aW as Dg,aX as bd,aY as wd,ae as fe,aZ as Qr,a_ as Lg,ai as hr,aa as D,a$ as xd,b0 as hs,b1 as ur,ag as sn,b2 as to,an as vn,b3 as Bg,b4 as Fg,b5 as Ug,ab as mt,ac as Yo,ao as Gt,b6 as Re,b7 as _d,b8 as Hg,af as Wg,b9 as Sr,ap as Sd,aq as kd,au as Zo,ba as Qo,bb as It,bc as Gg,bd as qg,av as fs,be as Aa,bf as Ta,bg as Ln,ad as en,bh as Cd,as as Ra,bi as Ia,bj as Vg,at as Ed,bk as Kg,bl as Jt,ah as Xg,bm as Jg,bn as Oa,bo as Cl,bp as Yg,bq as Zg,br as Qg,bs as ja,bt as em,bu as tm,bv as rm,bw as nm,bx as om,by as sm,bz as im,bA as am,bB as lm,bC as cm,bD as um,bE as dm,bF as hm,bG as fm}from"./index-BC1SrdB3.js";import{r as pm,u as de,d as gm,c as mm,s as cr,a as fr,b as ym,e as El,f as vm,g as bm,h as wm,i as xm,j as _m,k as Sm,l as km,m as an,n as Cm,o as Em,p as Pd,q as Ns,t as Ad,v as Pm,w as Am,x as Tm,y as Rm,z as Im,A as Ce,B as Om,C as jm,D as $m,E as $a,F as Nm,G as Li,H as ln,I as zm,J as Mm,K as Dm,L as Td,M as Rd,N as Lm,O as Bm,P as Fm,Q as Bi,R as ro,S as Id,T as Na,U as za,V as Od,W as jd,X as Um,Y as Pl,Z as $d,_ as Hm,$ as Wm,a0 as Gm,a1 as Nd,a2 as zd,a3 as qm,a4 as zs,a5 as Vm,a6 as Al,a7 as Md,a8 as Fi,a9 as Dd,aa as Km,ab as Xm,ac as Ld}from"./levelEditorSlice-BmkPxErl.js";import{S as Jm,G as ut}from"./Graphics-CpYZdid_.js";function Ym(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function Zm(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function Qm(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(r=>typeof r=="function")){const r=t.map(n=>typeof n=="function"?`function ${n.name||"unnamed"}()`:typeof n).join(", ");throw new TypeError(`${e}[${r}]`)}}var Tl=t=>Array.isArray(t)?t:[t];function ey(t){const e=Array.isArray(t[0])?t[0]:t;return Qm(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function ty(t,e){const r=[],{length:n}=t;for(let o=0;o<n;o++)r.push(t[o].apply(null,e));return r}var ry=class{constructor(t){this.value=t}deref(){return this.value}},ny=typeof WeakRef<"u"?WeakRef:ry,oy=0,Rl=1;function fo(){return{s:oy,v:void 0,o:null,p:null}}function Bd(t,e={}){let r=fo();const{resultEqualityCheck:n}=e;let o,s=0;function i(){let a=r;const{length:l}=arguments;for(let d=0,f=l;d<f;d++){const p=arguments[d];if(typeof p=="function"||typeof p=="object"&&p!==null){let y=a.o;y===null&&(a.o=y=new WeakMap);const m=y.get(p);m===void 0?(a=fo(),y.set(p,a)):a=m}else{let y=a.p;y===null&&(a.p=y=new Map);const m=y.get(p);m===void 0?(a=fo(),y.set(p,a)):a=m}}const c=a;let u;if(a.s===Rl)u=a.v;else if(u=t.apply(null,arguments),s++,n){const d=o?.deref?.()??o;d!=null&&n(d,u)&&(u=d,s!==0&&s--),o=typeof u=="object"&&u!==null||typeof u=="function"?new ny(u):u}return c.s=Rl,c.v=u,u}return i.clearCache=()=>{r=fo(),i.resetResultsCount()},i.resultsCount=()=>s,i.resetResultsCount=()=>{s=0},i}function sy(t,...e){const r=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,n=(...o)=>{let s=0,i=0,a,l={},c=o.pop();typeof c=="object"&&(l=c,c=o.pop()),Ym(c,`createSelector expects an output function after the inputs, but received: [${typeof c}]`);const u={...r,...l},{memoize:d,memoizeOptions:f=[],argsMemoize:p=Bd,argsMemoizeOptions:y=[]}=u,m=Tl(f),v=Tl(y),b=ey(o),_=d(function(){return s++,c.apply(null,arguments)},...m),w=p(function(){i++;const k=ty(b,arguments);return a=_.apply(null,k),a},...v);return Object.assign(w,{resultFunc:c,memoizedResultFunc:_,dependencies:b,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>a,recomputations:()=>s,resetRecomputations:()=>{s=0},memoize:d,argsMemoize:p})};return Object.assign(n,{withTypes:()=>n}),n}var Fd=sy(Bd),iy=Object.assign((t,e=Fd)=>{Zm(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const r=Object.keys(t),n=r.map(s=>t[s]);return e(n,(...s)=>s.reduce((i,a,l)=>(i[r[l]]=a,i),{}))},{withTypes:()=>iy}),po={},Il;function Ud(){if(Il)return po;Il=1;var t=Ea(),e=t.mark(a);function r(c,u){var d;if(typeof Symbol>"u"||c[Symbol.iterator]==null){if(Array.isArray(c)||(d=n(c))||u){d&&(c=d);var f=0,p=function(){};return{s:p,n:function(){return f>=c.length?{done:!0}:{done:!1,value:c[f++]}},e:function(_){throw _},f:p}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y=!0,m=!1,v;return{s:function(){d=c[Symbol.iterator]()},n:function(){var _=d.next();return y=_.done,_},e:function(_){m=!0,v=_},f:function(){try{!y&&d.return!=null&&d.return()}finally{if(m)throw v}}}}function n(c,u){if(c){if(typeof c=="string")return o(c,u);var d=Object.prototype.toString.call(c).slice(8,-1);if(d==="Object"&&c.constructor&&(d=c.constructor.name),d==="Map"||d==="Set")return Array.from(c);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return o(c,u)}}function o(c,u){(u==null||u>c.length)&&(u=c.length);for(var d=0,f=new Array(u);d<u;d++)f[d]=c[d];return f}var s=gn(),i=s.iterableCurry;function a(c,u){var d,f,p,y;return t.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d=0,f=r(c),v.prev=2,f.s();case 4:if((p=f.n()).done){v.next=10;break}return y=p.value,v.next=8,u(y,d++);case 8:v.next=4;break;case 10:v.next=15;break;case 12:v.prev=12,v.t0=v.catch(2),f.e(v.t0);case 15:return v.prev=15,f.f(),v.finish(15);case 18:case"end":return v.stop()}},e,null,[[2,12,15,18]])}po.__map=a;var l=i(a);return po.map=l,po}var go={},Ol;function ay(){if(Ol)return go;Ol=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,p=!1,y;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return f=v.done,v},e:function(v){p=!0,y=v},f:function(){try{!f&&c.return!=null&&c.return()}finally{if(p)throw y}}}}function e(a,l){if(a){if(typeof a=="string")return r(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return r(a,l)}}function r(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var n=gn(),o=n.iterableCurry;function s(a,l){var c=0,u=t(a),d;try{for(u.s();!(d=u.n()).done;){var f=d.value;if(l(f,c++))return!0}}catch(p){u.e(p)}finally{u.f()}return!1}go.__some=s;var i=o(s,{reduces:!0});return go.some=i,go}var mo={},jl;function ly(){if(jl)return mo;jl=1;var t=Ea(),e=t.mark(s),r=gn(),n=r.wrapWithIterableIterator,o=r.ensureIterable;function s(){var a,l,c,u,d,f,p=arguments;return t.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:for(a=p.length,l=new Array(a),c=0;c<a;c++)l[c]=p[c];u=0,d=l;case 2:if(!(u<d.length)){m.next=8;break}return f=d[u],m.delegateYield(o(f),"t0",5);case 5:u++,m.next=2;break;case 8:case"end":return m.stop()}},e)}mo.__concat=s;var i=n(s);return mo.concat=i,mo}var yo={},$l;function cy(){if($l)return yo;$l=1;var t=Ea(),e=t.mark(c);function r(d,f){var p;if(typeof Symbol>"u"||d[Symbol.iterator]==null){if(Array.isArray(d)||(p=n(d))||f){p&&(d=p);var y=0,m=function(){};return{s:m,n:function(){return y>=d.length?{done:!0}:{done:!1,value:d[y++]}},e:function(x){throw x},f:m}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,b=!1,_;return{s:function(){p=d[Symbol.iterator]()},n:function(){var x=p.next();return v=x.done,x},e:function(x){b=!0,_=x},f:function(){try{!v&&p.return!=null&&p.return()}finally{if(b)throw _}}}}function n(d,f){if(d){if(typeof d=="string")return o(d,f);var p=Object.prototype.toString.call(d).slice(8,-1);if(p==="Object"&&d.constructor&&(p=d.constructor.name),p==="Map"||p==="Set")return Array.from(d);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return o(d,f)}}function o(d,f){(f==null||f>d.length)&&(f=d.length);for(var p=0,y=new Array(f);p<f;p++)y[p]=d[p];return y}var s=gn(),i=s.iterableCurry,a=Ud(),l=a.__map;function c(d,f){var p,y,m;return t.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:p=r(l(d,f)),b.prev=1,p.s();case 3:if((y=p.n()).done){b.next=8;break}return m=y.value,b.delegateYield(m,"t0",6);case 6:b.next=3;break;case 8:b.next=13;break;case 10:b.prev=10,b.t1=b.catch(1),p.e(b.t1);case 13:return b.prev=13,p.f(),b.finish(13);case 16:case"end":return b.stop()}},e,null,[[1,10,13,16]])}yo.__flatMap=c;var u=i(c);return yo.flatMap=u,yo}var vo={},Nl;function uy(){if(Nl)return vo;Nl=1;var t=gn(),e=t.iterableCurry,r=pm(),n=r.__firstOr,o=Symbol("none");function s(a){return n(a,o)===o}vo.__isEmpty=s;var i=e(s,{reduces:!0});return vo.isEmpty=i,vo}var bo={},zl;function dy(){if(zl)return bo;zl=1;function t(a,l){var c;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(c=e(a))||l){c&&(a=c);var u=0,d=function(){};return{s:d,n:function(){return u>=a.length?{done:!0}:{done:!1,value:a[u++]}},e:function(v){throw v},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,p=!1,y;return{s:function(){c=a[Symbol.iterator]()},n:function(){var v=c.next();return f=v.done,v},e:function(v){p=!0,y=v},f:function(){try{!f&&c.return!=null&&c.return()}finally{if(p)throw y}}}}function e(a,l){if(a){if(typeof a=="string")return r(a,l);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return r(a,l)}}function r(a,l){(l==null||l>a.length)&&(l=a.length);for(var c=0,u=new Array(l);c<l;c++)u[c]=a[c];return u}var n=gn(),o=n.ensureIterable;function s(a){var l=o(a),c=0,u=t(l),d;try{for(u.s();!(d=u.n()).done;){var f=d.value;c++}}catch(p){u.e(p)}finally{u.f()}return c}bo.__size=s;var i=s;return bo.size=i,bo}var Ms,Ml;function hy(){return Ml||(Ml=1,Ms=ly().concat),Ms}var fy=hy();const Dl=Tt(fy);var Ds,Ll;function py(){return Ll||(Ll=1,Ds=cy().flatMap),Ds}var gy=py();const my=Tt(gy);var Ls,Bl;function yy(){return Bl||(Bl=1,Ls=uy().isEmpty),Ls}var vy=yy();const Hd=Tt(vy);var Bs,Fl;function by(){return Fl||(Fl=1,Bs=Ud().map),Bs}var wy=by();const Ul=Tt(wy);var Fs={},Hl;function xy(){if(Hl)return Fs;Hl=1;var t=function(n){return n};function e(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return n.length||(n=[t]),n.reduce(function(s,i){return function(){return i(s.apply(void 0,arguments))}})}return Fs.pipe=e,Fs}var Us,Wl;function _y(){return Wl||(Wl=1,Us=xy().pipe),Us}var Sy=_y();const Gl=Tt(Sy);var Hs,ql;function ky(){return ql||(ql=1,Hs=dy().size),Hs}var Cy=ky();const Wd=Tt(Cy);var Ws,Vl;function Ey(){return Vl||(Vl=1,Ws=ay().some),Ws}var Py=Ey();const Ay=Tt(Py),Gd=class Ui extends _g{constructor(e){e={...Ui.defaultOptions,...e},super(e),this.enabled=!0,this._state=Jm.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(e,r,n,o){e.applyFilter(this,r,n,o)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:r,gl:n,...o}=e;let s,i;return r&&(s=pd.from(r)),n&&(i=Rt.from(n)),new Ui({gpuProgram:s,glProgram:i,...o})}};Gd.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let Yt=Gd;const Hi=[];Pa.handleByNamedList(Hn.Environment,Hi);async function Ty(t){if(!t)for(let e=0;e<Hi.length;e++){const r=Hi[e];if(r.value.test()){await r.value.load();return}}}let Cn;function Ry(){if(typeof Cn=="boolean")return Cn;try{Cn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Cn=!1}return Cn}var qd=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(qd||{});class Iy{constructor(e){this.items=[],this._name=e}emit(e,r,n,o,s,i,a,l){const{name:c,items:u}=this;for(let d=0,f=u.length;d<f;d++)u[d][c](e,r,n,o,s,i,a,l);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const r=this.items.indexOf(e);return r!==-1&&this.items.splice(r,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const Oy=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Vd=class Kd extends Sg{constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;const r=[...Oy,...this.config.runners??[]];this._addRunners(...r),this._unsafeEvalCheck()}async init(e={}){const r=e.skipExtensionImports===!0?!0:e.manageImports===!1;await Ty(r),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const n in this._systemsHash)e={...this._systemsHash[n].constructor.defaultOptions,...e};e={...Kd.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let n=0;n<this.runners.init.items.length;n++)await this.runners.init.items[n].init(e);this._initOptions=e}render(e,r){let n=e;if(n instanceof te&&(n={container:n},r&&(Wn(Gn,"passing a second argument is deprecated, please use render options instead"),n.target=r.renderTexture)),n.target||(n.target=this.view.renderTarget),n.target===this.view.renderTarget&&(this._lastObjectRendered=n.container,n.clearColor??(n.clearColor=this.background.colorRgba),n.clear??(n.clear=this.background.clearBeforeRender)),n.clearColor){const o=Array.isArray(n.clearColor)&&n.clearColor.length===4;n.clearColor=o?n.clearColor:G.shared.setValue(n.clearColor).toArray()}n.transform||(n.container.updateLocalTransform(),n.transform=n.container.localTransform),n.container.enableRenderGroup(),this.runners.prerender.emit(n),this.runners.renderStart.emit(n),this.runners.render.emit(n),this.runners.renderEnd.emit(n),this.runners.postrender.emit(n)}resize(e,r,n){const o=this.view.resolution;this.view.resize(e,r,n),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),n!==void 0&&n!==o&&this.runners.resolutionChange.emit(n)}clear(e={}){const r=this;e.target||(e.target=r.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=qd.ALL);const{clear:n,clearColor:o,target:s}=e;G.shared.setValue(o??this.background.colorRgba),r.renderTarget.clear(s,n,G.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(r=>{this.runners[r]=new Iy(r)})}_addSystems(e){let r;for(r in e){const n=e[r];this._addSystem(n.value,n.name)}}_addSystem(e,r){const n=new e(this);if(this[r])throw new Error(`Whoops! The name "${r}" is already in use`);this[r]=n,this._systemsHash[r]=n;for(const o in this.runners)this.runners[o].add(n);return this}_addPipes(e,r){const n=r.reduce((o,s)=>(o[s.name]=s.value,o),{});e.forEach(o=>{const s=o.value,i=o.name,a=n[i];this.renderPipes[i]=new s(this,a?new a:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(r=>{r.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!Ry())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Vd.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Xd=Vd,wo;function jy(t){return wo!==void 0||(wo=(()=>{const e={stencil:!0,failIfMajorPerformanceCaveat:t??Xd.defaultOptions.failIfMajorPerformanceCaveat};try{if(!Mi.get().getWebGLRenderingContext())return!1;let n=Mi.get().createCanvas().getContext("webgl",e);const o=!!n?.getContextAttributes()?.stencil;if(n){const s=n.getExtension("WEBGL_lose_context");s&&s.loseContext()}return n=null,o}catch{return!1}})()),wo}let xo;async function $y(t={}){return xo!==void 0||(xo=await(async()=>{const e=Mi.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(t)).requestDevice(),!0}catch{return!1}})()),xo}const Kl=["webgl","webgpu","canvas"];async function Ny(t){let e=[];t.preference?(e.push(t.preference),Kl.forEach(s=>{s!==t.preference&&e.push(s)})):e=Kl.slice();let r,n={};for(let s=0;s<e.length;s++){const i=e[s];if(i==="webgpu"&&await $y()){const{WebGPURenderer:a}=await Ht(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-DHBlZLQM.js");return{WebGPURenderer:l}},__vite__mapDeps([0,1,2,3,4,5,6]));r=a,n={...t,...t.webgpu};break}else if(i==="webgl"&&jy(t.failIfMajorPerformanceCaveat??Xd.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await Ht(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-CIurLBtc.js");return{WebGLRenderer:l}},__vite__mapDeps([7,1,2,3,4,5,6]));r=a,n={...t,...t.webgl};break}else if(i==="canvas")throw n={...t},new Error("CanvasRenderer is not yet implemented")}if(delete n.webgpu,delete n.webgl,!r)throw new Error("No available renderer for the current environment");const o=new r;return await o.init(n),o}const Jd="8.8.1";class Yd{static init(){globalThis.__PIXI_APP_INIT__?.(this,Jd)}static destroy(){}}Yd.extension=Hn.Application;class zy{constructor(e){this._renderer=e}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,Jd)}destroy(){this._renderer=null}}zy.extension={type:[Hn.WebGLSystem,Hn.WebGPUSystem],name:"initHook",priority:-10};const Zd=class Wi{constructor(...e){this.stage=new te,e[0]!==void 0&&Wn(Gn,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await Ny(e),Wi._plugins.forEach(r=>{r.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return Wn(Gn,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,r=!1){const n=Wi._plugins.slice(0);n.reverse(),n.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(r),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Zd._plugins=[];let Qd=Zd;Pa.handleByList(Hn.Application,Qd._plugins);Pa.add(Yd);var My=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Dy=`
in vec2 vTextureCoord;

out vec4 finalColor;

uniform float uAlpha;
uniform sampler2D uTexture;

void main()
{
    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;
}
`,Xl=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
 
    var sample = textureSample(uTexture, uSampler, uv);
    
    return sample * alphaUniforms.uAlpha;
}`;const eh=class th extends Yt{constructor(e){e={...th.defaultOptions,...e};const r=pd.from({vertex:{source:Xl,entryPoint:"mainVertex"},fragment:{source:Xl,entryPoint:"mainFragment"}}),n=Rt.from({vertex:My,fragment:Dy,name:"alpha-filter"}),{alpha:o,...s}=e,i=new kg({uAlpha:{value:o,type:"f32"}});super({...s,gpuProgram:r,glProgram:n,resources:{alphaUniforms:i}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(e){this.resources.alphaUniforms.uniforms.uAlpha=e}};eh.defaultOptions={alpha:1};let Ly=eh;class qn extends mn{constructor(...e){let r=e[0];Array.isArray(e[0])&&(r={textures:e[0],autoUpdate:e[1]});const{animationSpeed:n=1,autoPlay:o=!1,autoUpdate:s=!0,loop:i=!0,onComplete:a=null,onFrameChange:l=null,onLoop:c=null,textures:u,updateAnchor:d=!1,...f}=r,[p]=u;super({...f,texture:p instanceof Ct?p:p.texture}),this._textures=null,this._durations=null,this._autoUpdate=s,this._isConnectedToTicker=!1,this.animationSpeed=n,this.loop=i,this.updateAnchor=d,this.onComplete=a,this.onFrameChange=l,this.onLoop=c,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=u,o&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Kr.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Kr.shared.add(this.update,this,Cg.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const r=e.deltaTime,n=this.animationSpeed*r,o=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=n/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*r);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=n;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):o!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<o||this.animationSpeed<0&&this.currentFrame>o)&&this.onLoop(),this._updateTexture())}_updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const r=[];for(let n=0;n<e.length;++n)r.push(Ct.from(e[n]));return new qn(r)}static fromImages(e){const r=[];for(let n=0;n<e.length;++n)r.push(Ct.from(e[n]));return new qn(r)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof Ct)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let r=0;r<e.length;r++)this._textures.push(e[r].texture),this._durations.push(e[r].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const r=this.currentFrame;this._currentTime=e,r!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Kr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Kr.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class By{constructor({matrix:e,observer:r}={}){this.dirty=!0,this._matrix=e??new Eg,this.observer=r,this.position=new Xr(this,0,0),this.scale=new Xr(this,1,1),this.pivot=new Xr(this,0,0),this.skew=new Xr(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}_onUpdate(e){this.dirty=!0,e===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}}const rh=class Do extends gd{constructor(...e){let r=e[0]||{};r instanceof Ct&&(r={texture:r}),e.length>1&&(Wn(Gn,"use new TilingSprite({ texture, width:100, height:100 }) instead"),r.width=e[1],r.height=e[2]),r={...Do.defaultOptions,...r};const{texture:n,anchor:o,tilePosition:s,tileScale:i,tileRotation:a,width:l,height:c,applyAnchorToTexture:u,roundPixels:d,...f}=r??{};super({label:"TilingSprite",...f}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new Xr({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=u,this.texture=n,this._width=l??n.width,this._height=c??n.height,this._tileTransform=new By({observer:{_onUpdate:()=>this.onViewUpdate()}}),o&&(this.anchor=o),this.tilePosition=s,this.tileScale=i,this.tileRotation=a,this.roundPixels=d??!1}static from(e,r={}){return typeof e=="string"?new Do({texture:Pg.get(e),...r}):new Do({texture:e,...r})}get uvRespectAnchor(){return Di("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){Di("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){typeof e=="number"?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=Ct.EMPTY);const r=this._texture;r!==e&&(r&&r.dynamic&&r.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,r){typeof e=="object"&&(r=e.height??e.width,e=e.width),this._width=e,this._height=r??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){const e=this._bounds,r=this._anchor,n=this._width,o=this._height;e.minX=-r._x*n,e.maxX=e.minX+n,e.minY=-r._y*o,e.maxY=e.minY+o}containsPoint(e){const r=this._width,n=this._height,o=-r*this._anchor._x;let s=0;return e.x>=o&&e.x<=o+r&&(s=-n*this._anchor._y,e.y>=s&&e.y<=s+n)}destroy(e=!1){if(super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof e=="boolean"?e:e?.texture){const n=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(n)}this._texture=null}};rh.defaultOptions={texture:Ct.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let Fy=rh;class Uy extends gd{constructor(e,r){const{text:n,resolution:o,style:s,anchor:i,width:a,height:l,roundPixels:c,...u}=e;super({...u}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=r,this.text=n??"",this.style=s,this.resolution=o??null,this.allowChildren=!1,this._anchor=new Xr({_onUpdate:()=>{this.onViewUpdate()}}),i&&(this.anchor=i),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){e||(e={}),this._style?.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,r){typeof e=="object"?(r=e.height??e.width,e=e.width):r??(r=e),e!==void 0&&this._setWidth(e,this.bounds.width),r!==void 0&&this._setHeight(r,this.bounds.height)}containsPoint(e){const r=this.bounds.width,n=this.bounds.height,o=-r*this.anchor.x;let s=0;return e.x>=o&&e.x<=o+r&&(s=-n*this.anchor.y,e.y>=s&&e.y<=s+n)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e?.style)&&this._style.destroy(e),this._style=null,this._text=null}}function Hy(t,e){let r=t[0]??{};return(typeof r=="string"||t[1])&&(Wn(Gn,`use new ${e}({ text: "hi!", style }) instead`),r={text:r,style:t[1]}),r}class Wy extends Uy{constructor(...e){const r=Hy(e,"Text");super(r,Ag),this.renderPipeId="text"}updateBounds(){const e=this._bounds,r=this._anchor,n=Tg.measureText(this._text,this._style),{width:o,height:s}=n;e.minX=-r._x*o,e.maxX=e.minX+o,e.minY=-r._y*s,e.maxY=e.minY+s}}class Ma extends Ct{static create(e){return new Ma({source:new Rg(e)})}resize(e,r,n){return this.source.resize(e,r,n),this}}const nh=class oh extends te{constructor(e={}){e={...oh.defaultOptions,...e},super(),this.renderLayerChildren=[],this.sortableChildren=e.sortableChildren,this.sortFunction=e.sortFunction}attach(...e){for(let r=0;r<e.length;r++){const n=e[r];if(n.parentRenderLayer){if(n.parentRenderLayer===this)continue;n.parentRenderLayer.detach(n)}this.renderLayerChildren.push(n),n.parentRenderLayer=this;const o=this.renderGroup||this.parentRenderGroup;o&&(o.structureDidChange=!0)}return e[0]}detach(...e){for(let r=0;r<e.length;r++){const n=e[r],o=this.renderLayerChildren.indexOf(n);o!==-1&&this.renderLayerChildren.splice(o,1),n.parentRenderLayer=null;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)}return e[0]}detachAll(){const e=this.renderLayerChildren;for(let r=0;r<e.length;r++)e[r].parentRenderLayer=null;this.renderLayerChildren.length=0}collectRenderables(e,r,n){const o=this.renderLayerChildren,s=o.length;this.sortableChildren&&this.sortRenderLayerChildren();for(let i=0;i<s;i++)o[i].parent||Di("Container must be added to both layer and scene graph. Layers only handle render order - the scene graph is required for transforms (addChild)",o[i]),o[i].collectRenderables(e,r,this)}sortRenderLayerChildren(){this.renderLayerChildren.sort(this.sortFunction)}_getGlobalBoundsRecursive(e,r,n){if(!e)return;const o=this.renderLayerChildren;for(let s=0;s<o.length;s++)o[s]._getGlobalBoundsRecursive(!0,r,this)}};nh.defaultOptions={sortableChildren:!1,sortFunction:(t,e)=>t.zIndex-e.zIndex};let Gy=nh;const Jl=Gy,Da="-",qy=t=>{const e=Ky(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:i=>{const a=i.split(Da);return a[0]===""&&a.length!==1&&a.shift(),sh(a,e)||Vy(i)},getConflictingClassGroupIds:(i,a)=>{const l=r[i]||[];return a&&n[i]?[...l,...n[i]]:l}}},sh=(t,e)=>{if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),o=n?sh(t.slice(1),n):void 0;if(o)return o;if(e.validators.length===0)return;const s=t.join(Da);return e.validators.find(({validator:i})=>i(s))?.classGroupId},Yl=/^\[(.+)\]$/,Vy=t=>{if(Yl.test(t)){const e=Yl.exec(t)[1],r=e?.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},Ky=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return Jy(Object.entries(t.classGroups),r).forEach(([s,i])=>{Gi(i,n,s,e)}),n},Gi=(t,e,r,n)=>{t.forEach(o=>{if(typeof o=="string"){const s=o===""?e:Zl(e,o);s.classGroupId=r;return}if(typeof o=="function"){if(Xy(o)){Gi(o(n),e,r,n);return}e.validators.push({validator:o,classGroupId:r});return}Object.entries(o).forEach(([s,i])=>{Gi(i,Zl(e,s),r,n)})})},Zl=(t,e)=>{let r=t;return e.split(Da).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},Xy=t=>t.isThemeGetter,Jy=(t,e)=>e?t.map(([r,n])=>{const o=n.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([i,a])=>[e+i,a])):s);return[r,o]}):t,Yy=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const o=(s,i)=>{r.set(s,i),e++,e>t&&(e=0,n=r,r=new Map)};return{get(s){let i=r.get(s);if(i!==void 0)return i;if((i=n.get(s))!==void 0)return o(s,i),i},set(s,i){r.has(s)?r.set(s,i):o(s,i)}}},ih="!",Zy=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,o=e[0],s=e.length,i=a=>{const l=[];let c=0,u=0,d;for(let v=0;v<a.length;v++){let b=a[v];if(c===0){if(b===o&&(n||a.slice(v,v+s)===e)){l.push(a.slice(u,v)),u=v+s;continue}if(b==="/"){d=v;continue}}b==="["?c++:b==="]"&&c--}const f=l.length===0?a:a.substring(u),p=f.startsWith(ih),y=p?f.substring(1):f,m=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:p,baseClassName:y,maybePostfixModifierPosition:m}};return r?a=>r({className:a,parseClassName:i}):i},Qy=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},ev=t=>({cache:Yy(t.cacheSize),parseClassName:Zy(t),...qy(t)}),tv=/\s+/,rv=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:o}=e,s=[],i=t.trim().split(tv);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:d,baseClassName:f,maybePostfixModifierPosition:p}=r(c);let y=!!p,m=n(y?f.substring(0,p):f);if(!m){if(!y){a=c+(a.length>0?" "+a:a);continue}if(m=n(f),!m){a=c+(a.length>0?" "+a:a);continue}y=!1}const v=Qy(u).join(":"),b=d?v+ih:v,_=b+m;if(s.includes(_))continue;s.push(_);const w=o(m,y);for(let x=0;x<w.length;++x){const k=w[x];s.push(b+k)}a=c+(a.length>0?" "+a:a)}return a};function nv(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=ah(e))&&(n&&(n+=" "),n+=r);return n}const ah=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=ah(t[n]))&&(r&&(r+=" "),r+=e);return r};function ov(t,...e){let r,n,o,s=i;function i(l){const c=e.reduce((u,d)=>d(u),t());return r=ev(c),n=r.cache.get,o=r.cache.set,s=a,a(l)}function a(l){const c=n(l);if(c)return c;const u=rv(l,r);return o(l,u),u}return function(){return s(nv.apply(null,arguments))}}const pe=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},lh=/^\[(?:([a-z-]+):)?(.+)\]$/i,sv=/^\d+\/\d+$/,iv=new Set(["px","full","screen"]),av=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,lv=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,cv=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,uv=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,dv=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,vt=t=>tn(t)||iv.has(t)||sv.test(t),Ot=t=>bn(t,"length",bv),tn=t=>!!t&&!Number.isNaN(Number(t)),Gs=t=>bn(t,"number",tn),En=t=>!!t&&Number.isInteger(Number(t)),hv=t=>t.endsWith("%")&&tn(t.slice(0,-1)),Q=t=>lh.test(t),jt=t=>av.test(t),fv=new Set(["length","size","percentage"]),pv=t=>bn(t,fv,ch),gv=t=>bn(t,"position",ch),mv=new Set(["image","url"]),yv=t=>bn(t,mv,xv),vv=t=>bn(t,"",wv),Pn=()=>!0,bn=(t,e,r)=>{const n=lh.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},bv=t=>lv.test(t)&&!cv.test(t),ch=()=>!1,wv=t=>uv.test(t),xv=t=>dv.test(t),_v=()=>{const t=pe("colors"),e=pe("spacing"),r=pe("blur"),n=pe("brightness"),o=pe("borderColor"),s=pe("borderRadius"),i=pe("borderSpacing"),a=pe("borderWidth"),l=pe("contrast"),c=pe("grayscale"),u=pe("hueRotate"),d=pe("invert"),f=pe("gap"),p=pe("gradientColorStops"),y=pe("gradientColorStopPositions"),m=pe("inset"),v=pe("margin"),b=pe("opacity"),_=pe("padding"),w=pe("saturate"),x=pe("scale"),k=pe("sepia"),C=pe("skew"),S=pe("space"),N=pe("translate"),X=()=>["auto","contain","none"],B=()=>["auto","hidden","clip","visible","scroll"],q=()=>["auto",Q,e],O=()=>[Q,e],se=()=>["",vt,Ot],M=()=>["auto",tn,Q],J=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],V=()=>["solid","dashed","dotted","double","none"],re=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Y=()=>["start","end","center","between","around","evenly","stretch"],ie=()=>["","0",Q],we=()=>["auto","avoid","all","avoid-page","page","left","right","column"],me=()=>[tn,Q];return{cacheSize:500,separator:":",theme:{colors:[Pn],spacing:[vt,Ot],blur:["none","",jt,Q],brightness:me(),borderColor:[t],borderRadius:["none","","full",jt,Q],borderSpacing:O(),borderWidth:se(),contrast:me(),grayscale:ie(),hueRotate:me(),invert:ie(),gap:O(),gradientColorStops:[t],gradientColorStopPositions:[hv,Ot],inset:q(),margin:q(),opacity:me(),padding:O(),saturate:me(),scale:me(),sepia:ie(),skew:me(),space:O(),translate:O()},classGroups:{aspect:[{aspect:["auto","square","video",Q]}],container:["container"],columns:[{columns:[jt]}],"break-after":[{"break-after":we()}],"break-before":[{"break-before":we()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...J(),Q]}],overflow:[{overflow:B()}],"overflow-x":[{"overflow-x":B()}],"overflow-y":[{"overflow-y":B()}],overscroll:[{overscroll:X()}],"overscroll-x":[{"overscroll-x":X()}],"overscroll-y":[{"overscroll-y":X()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[m]}],"inset-x":[{"inset-x":[m]}],"inset-y":[{"inset-y":[m]}],start:[{start:[m]}],end:[{end:[m]}],top:[{top:[m]}],right:[{right:[m]}],bottom:[{bottom:[m]}],left:[{left:[m]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",En,Q]}],basis:[{basis:q()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Q]}],grow:[{grow:ie()}],shrink:[{shrink:ie()}],order:[{order:["first","last","none",En,Q]}],"grid-cols":[{"grid-cols":[Pn]}],"col-start-end":[{col:["auto",{span:["full",En,Q]},Q]}],"col-start":[{"col-start":M()}],"col-end":[{"col-end":M()}],"grid-rows":[{"grid-rows":[Pn]}],"row-start-end":[{row:["auto",{span:[En,Q]},Q]}],"row-start":[{"row-start":M()}],"row-end":[{"row-end":M()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Q]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Q]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...Y()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Y(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Y(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Q,e]}],"min-w":[{"min-w":[Q,e,"min","max","fit"]}],"max-w":[{"max-w":[Q,e,"none","full","min","max","fit","prose",{screen:[jt]},jt]}],h:[{h:[Q,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Q,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Q,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Q,e,"auto","min","max","fit"]}],"font-size":[{text:["base",jt,Ot]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Gs]}],"font-family":[{font:[Pn]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Q]}],"line-clamp":[{"line-clamp":["none",tn,Gs]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",vt,Q]}],"list-image":[{"list-image":["none",Q]}],"list-style-type":[{list:["none","disc","decimal",Q]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[b]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[b]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...V(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",vt,Ot]}],"underline-offset":[{"underline-offset":["auto",vt,Q]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:O()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Q]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Q]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[b]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...J(),gv]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",pv]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},yv]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[b]}],"border-style":[{border:[...V(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[b]}],"divide-style":[{divide:V()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...V()]}],"outline-offset":[{"outline-offset":[vt,Q]}],"outline-w":[{outline:[vt,Ot]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:se()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[b]}],"ring-offset-w":[{"ring-offset":[vt,Ot]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",jt,vv]}],"shadow-color":[{shadow:[Pn]}],opacity:[{opacity:[b]}],"mix-blend":[{"mix-blend":[...re(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":re()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",jt,Q]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[w]}],sepia:[{sepia:[k]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[b]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[k]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Q]}],duration:[{duration:me()}],ease:[{ease:["linear","in","out","in-out",Q]}],delay:[{delay:me()}],animate:[{animate:["none","spin","ping","pulse","bounce",Q]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[x]}],"scale-x":[{"scale-x":[x]}],"scale-y":[{"scale-y":[x]}],rotate:[{rotate:[En,Q]}],"translate-x":[{"translate-x":[N]}],"translate-y":[{"translate-y":[N]}],"skew-x":[{"skew-x":[C]}],"skew-y":[{"skew-y":[C]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Q]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Q]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":O()}],"scroll-mx":[{"scroll-mx":O()}],"scroll-my":[{"scroll-my":O()}],"scroll-ms":[{"scroll-ms":O()}],"scroll-me":[{"scroll-me":O()}],"scroll-mt":[{"scroll-mt":O()}],"scroll-mr":[{"scroll-mr":O()}],"scroll-mb":[{"scroll-mb":O()}],"scroll-ml":[{"scroll-ml":O()}],"scroll-p":[{"scroll-p":O()}],"scroll-px":[{"scroll-px":O()}],"scroll-py":[{"scroll-py":O()}],"scroll-ps":[{"scroll-ps":O()}],"scroll-pe":[{"scroll-pe":O()}],"scroll-pt":[{"scroll-pt":O()}],"scroll-pr":[{"scroll-pr":O()}],"scroll-pb":[{"scroll-pb":O()}],"scroll-pl":[{"scroll-pl":O()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Q]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[vt,Ot,Gs]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},uh=ov(_v);function dh(t){if(!es(t))throw new Error(`Invalid textureId: "${t}"; textureId ∋ {${Object.keys(_r.frames).sort().map(e=>`"${e}"`).join(`,
`)}}`)}function es(t){return _r.frames[t]!==void 0}function hh(t){return _r.animations[t]!==void 0}const Sv=t=>t.replaceAll(".","_"),H=({children:t,className:e,noSlitWords:r,classnameCycle:n,onClick:o,noTint:s=!1,TagName:i="span"})=>{const a=Array.isArray(t)?t.join(" "):typeof t=="number"?`${t}`:t;if(a.length===0)return null;const l=r?[a.toUpperCase()]:a.toUpperCase().split(/\s+/);return h.jsxs(i,{className:e,onClick:o,children:[h.jsx("span",{className:"sr-only",children:a}),l.map((c,u)=>h.jsx("span",{className:uh("text-nowrap inline-block",u===l.length-1?"":"me-1"),children:Array.from(c).map((d,f)=>{const p=`hud.char.${md(d)}`;return es(p)||console.error("no texture for char",d,d.charCodeAt(0),p,"we have:",Object.keys(Wt().textures)),h.jsx("span",{className:`sprite ${es(p)?`texture-${Sv(p)}`:"texture-hud_char_?"}
                  ${s?"":"sprite-tinted"}
                  ${n===void 0?"":n[f%n.length]}`},f)})},u))]})};function Ge(t,e,{checkForDefaultPrevented:r=!0}={}){return function(o){if(t?.(o),r===!1||!o.defaultPrevented)return e?.(o)}}function Ql(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function fh(...t){return e=>{let r=!1;const n=t.map(o=>{const s=Ql(o,e);return!r&&typeof s=="function"&&(r=!0),s});if(r)return()=>{for(let o=0;o<n.length;o++){const s=n[o];typeof s=="function"?s():Ql(t[o],null)}}}}function st(...t){return g.useCallback(fh(...t),t)}function kv(t,e){const r=g.createContext(e),n=s=>{const{children:i,...a}=s,l=g.useMemo(()=>a,Object.values(a));return h.jsx(r.Provider,{value:l,children:i})};n.displayName=t+"Provider";function o(s){const i=g.useContext(r);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[n,o]}function La(t,e=[]){let r=[];function n(s,i){const a=g.createContext(i),l=r.length;r=[...r,i];const c=d=>{const{scope:f,children:p,...y}=d,m=f?.[t]?.[l]||a,v=g.useMemo(()=>y,Object.values(y));return h.jsx(m.Provider,{value:v,children:p})};c.displayName=s+"Provider";function u(d,f){const p=f?.[t]?.[l]||a,y=g.useContext(p);if(y)return y;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const o=()=>{const s=r.map(i=>g.createContext(i));return function(a){const l=a?.[t]||s;return g.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[n,Cv(o,...e)]}function Cv(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=n.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return g.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return r.scopeName=e.scopeName,r}var Ba=Ig();const Ev=Tt(Ba);var ps=g.forwardRef((t,e)=>{const{children:r,...n}=t,o=g.Children.toArray(r),s=o.find(Av);if(s){const i=s.props.children,a=o.map(l=>l===s?g.Children.count(i)>1?g.Children.only(null):g.isValidElement(i)?i.props.children:null:l);return h.jsx(qi,{...n,ref:e,children:g.isValidElement(i)?g.cloneElement(i,void 0,a):null})}return h.jsx(qi,{...n,ref:e,children:r})});ps.displayName="Slot";var qi=g.forwardRef((t,e)=>{const{children:r,...n}=t;if(g.isValidElement(r)){const o=Rv(r),s=Tv(n,r.props);return r.type!==g.Fragment&&(s.ref=e?fh(e,o):o),g.cloneElement(r,s)}return g.Children.count(r)>1?g.Children.only(null):null});qi.displayName="SlotClone";var Pv=({children:t})=>h.jsx(h.Fragment,{children:t});function Av(t){return g.isValidElement(t)&&t.type===Pv}function Tv(t,e){const r={...e};for(const n in e){const o=t[n],s=e[n];/^on[A-Z]/.test(n)?o&&s?r[n]=(...a)=>{s(...a),o(...a)}:o&&(r[n]=o):n==="style"?r[n]={...o,...s}:n==="className"&&(r[n]=[o,s].filter(Boolean).join(" "))}return{...t,...r}}function Rv(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var Iv=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],be=Iv.reduce((t,e)=>{const r=g.forwardRef((n,o)=>{const{asChild:s,...i}=n,a=s?ps:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(a,{...i,ref:o})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function Ov(t,e){t&&Ba.flushSync(()=>t.dispatchEvent(e))}function qt(t){const e=g.useRef(t);return g.useEffect(()=>{e.current=t}),g.useMemo(()=>(...r)=>e.current?.(...r),[])}function jv(t,e=globalThis?.document){const r=qt(t);g.useEffect(()=>{const n=o=>{o.key==="Escape"&&r(o)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[r,e])}var $v="DismissableLayer",Vi="dismissableLayer.update",Nv="dismissableLayer.pointerDownOutside",zv="dismissableLayer.focusOutside",ec,ph=g.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Fa=g.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...l}=t,c=g.useContext(ph),[u,d]=g.useState(null),f=u?.ownerDocument??globalThis?.document,[,p]=g.useState({}),y=st(e,S=>d(S)),m=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),b=m.indexOf(v),_=u?m.indexOf(u):-1,w=c.layersWithOutsidePointerEventsDisabled.size>0,x=_>=b,k=Lv(S=>{const N=S.target,X=[...c.branches].some(B=>B.contains(N));!x||X||(o?.(S),i?.(S),S.defaultPrevented||a?.())},f),C=Bv(S=>{const N=S.target;[...c.branches].some(B=>B.contains(N))||(s?.(S),i?.(S),S.defaultPrevented||a?.())},f);return jv(S=>{_===c.layers.size-1&&(n?.(S),!S.defaultPrevented&&a&&(S.preventDefault(),a()))},f),g.useEffect(()=>{if(u)return r&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(ec=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),tc(),()=>{r&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=ec)}},[u,f,r,c]),g.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),tc())},[u,c]),g.useEffect(()=>{const S=()=>p({});return document.addEventListener(Vi,S),()=>document.removeEventListener(Vi,S)},[]),h.jsx(be.div,{...l,ref:y,style:{pointerEvents:w?x?"auto":"none":void 0,...t.style},onFocusCapture:Ge(t.onFocusCapture,C.onFocusCapture),onBlurCapture:Ge(t.onBlurCapture,C.onBlurCapture),onPointerDownCapture:Ge(t.onPointerDownCapture,k.onPointerDownCapture)})});Fa.displayName=$v;var Mv="DismissableLayerBranch",Dv=g.forwardRef((t,e)=>{const r=g.useContext(ph),n=g.useRef(null),o=st(e,n);return g.useEffect(()=>{const s=n.current;if(s)return r.branches.add(s),()=>{r.branches.delete(s)}},[r.branches]),h.jsx(be.div,{...t,ref:o})});Dv.displayName=Mv;function Lv(t,e=globalThis?.document){const r=qt(t),n=g.useRef(!1),o=g.useRef(()=>{});return g.useEffect(()=>{const s=a=>{if(a.target&&!n.current){let l=function(){gh(Nv,r,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=l,e.addEventListener("click",o.current,{once:!0})):l()}else e.removeEventListener("click",o.current);n.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,r]),{onPointerDownCapture:()=>n.current=!0}}function Bv(t,e=globalThis?.document){const r=qt(t),n=g.useRef(!1);return g.useEffect(()=>{const o=s=>{s.target&&!n.current&&gh(zv,r,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function tc(){const t=new CustomEvent(Vi);document.dispatchEvent(t)}function gh(t,e,r,{discrete:n}){const o=r.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&o.addEventListener(t,e,{once:!0}),n?Ov(o,s):o.dispatchEvent(s)}var qs=0;function mh(){g.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??rc()),document.body.insertAdjacentElement("beforeend",t[1]??rc()),qs++,()=>{qs===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),qs--}},[])}function rc(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Vs="focusScope.autoFocusOnMount",Ks="focusScope.autoFocusOnUnmount",nc={bubbles:!1,cancelable:!0},Fv="FocusScope",Ua=g.forwardRef((t,e)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=t,[a,l]=g.useState(null),c=qt(o),u=qt(s),d=g.useRef(null),f=st(e,m=>l(m)),p=g.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;g.useEffect(()=>{if(n){let m=function(w){if(p.paused||!a)return;const x=w.target;a.contains(x)?d.current=x:Mt(d.current,{select:!0})},v=function(w){if(p.paused||!a)return;const x=w.relatedTarget;x!==null&&(a.contains(x)||Mt(d.current,{select:!0}))},b=function(w){if(document.activeElement===document.body)for(const k of w)k.removedNodes.length>0&&Mt(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",v);const _=new MutationObserver(b);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",v),_.disconnect()}}},[n,a,p.paused]),g.useEffect(()=>{if(a){sc.add(p);const m=document.activeElement;if(!a.contains(m)){const b=new CustomEvent(Vs,nc);a.addEventListener(Vs,c),a.dispatchEvent(b),b.defaultPrevented||(Uv(Vv(yh(a)),{select:!0}),document.activeElement===m&&Mt(a))}return()=>{a.removeEventListener(Vs,c),setTimeout(()=>{const b=new CustomEvent(Ks,nc);a.addEventListener(Ks,u),a.dispatchEvent(b),b.defaultPrevented||Mt(m??document.body,{select:!0}),a.removeEventListener(Ks,u),sc.remove(p)},0)}}},[a,c,u,p]);const y=g.useCallback(m=>{if(!r&&!n||p.paused)return;const v=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,b=document.activeElement;if(v&&b){const _=m.currentTarget,[w,x]=Hv(_);w&&x?!m.shiftKey&&b===x?(m.preventDefault(),r&&Mt(w,{select:!0})):m.shiftKey&&b===w&&(m.preventDefault(),r&&Mt(x,{select:!0})):b===_&&m.preventDefault()}},[r,n,p.paused]);return h.jsx(be.div,{tabIndex:-1,...i,ref:f,onKeyDown:y})});Ua.displayName=Fv;function Uv(t,{select:e=!1}={}){const r=document.activeElement;for(const n of t)if(Mt(n,{select:e}),document.activeElement!==r)return}function Hv(t){const e=yh(t),r=oc(e,t),n=oc(e.reverse(),t);return[r,n]}function yh(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const o=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||o?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function oc(t,e){for(const r of t)if(!Wv(r,{upTo:e}))return r}function Wv(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Gv(t){return t instanceof HTMLInputElement&&"select"in t}function Mt(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&Gv(t)&&e&&t.select()}}var sc=qv();function qv(){let t=[];return{add(e){const r=t[0];e!==r&&r?.pause(),t=ic(t,e),t.unshift(e)},remove(e){t=ic(t,e),t[0]?.resume()}}}function ic(t,e){const r=[...t],n=r.indexOf(e);return n!==-1&&r.splice(n,1),r}function Vv(t){return t.filter(e=>e.tagName!=="A")}var pr=globalThis?.document?g.useLayoutEffect:()=>{},Kv=yd.useId||(()=>{}),Xv=0;function dt(t){const[e,r]=g.useState(Kv());return pr(()=>{r(n=>n??String(Xv++))},[t]),t||(e?`radix-${e}`:"")}const Jv=["top","right","bottom","left"],Vt=Math.min,We=Math.max,ts=Math.round,_o=Math.floor,ht=t=>({x:t,y:t}),Yv={left:"right",right:"left",bottom:"top",top:"bottom"},Zv={start:"end",end:"start"};function Ki(t,e,r){return We(t,Vt(e,r))}function Pt(t,e){return typeof t=="function"?t(e):t}function At(t){return t.split("-")[0]}function wn(t){return t.split("-")[1]}function Ha(t){return t==="x"?"y":"x"}function Wa(t){return t==="y"?"height":"width"}function Kt(t){return["top","bottom"].includes(At(t))?"y":"x"}function Ga(t){return Ha(Kt(t))}function Qv(t,e,r){r===void 0&&(r=!1);const n=wn(t),o=Ga(t),s=Wa(o);let i=o==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(i=rs(i)),[i,rs(i)]}function eb(t){const e=rs(t);return[Xi(t),e,Xi(e)]}function Xi(t){return t.replace(/start|end/g,e=>Zv[e])}function tb(t,e,r){const n=["left","right"],o=["right","left"],s=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return r?e?o:n:e?n:o;case"left":case"right":return e?s:i;default:return[]}}function rb(t,e,r,n){const o=wn(t);let s=tb(At(t),r==="start",n);return o&&(s=s.map(i=>i+"-"+o),e&&(s=s.concat(s.map(Xi)))),s}function rs(t){return t.replace(/left|right|bottom|top/g,e=>Yv[e])}function nb(t){return{top:0,right:0,bottom:0,left:0,...t}}function vh(t){return typeof t!="number"?nb(t):{top:t,right:t,bottom:t,left:t}}function ns(t){const{x:e,y:r,width:n,height:o}=t;return{width:n,height:o,top:r,left:e,right:e+n,bottom:r+o,x:e,y:r}}function ac(t,e,r){let{reference:n,floating:o}=t;const s=Kt(e),i=Ga(e),a=Wa(i),l=At(e),c=s==="y",u=n.x+n.width/2-o.width/2,d=n.y+n.height/2-o.height/2,f=n[a]/2-o[a]/2;let p;switch(l){case"top":p={x:u,y:n.y-o.height};break;case"bottom":p={x:u,y:n.y+n.height};break;case"right":p={x:n.x+n.width,y:d};break;case"left":p={x:n.x-o.width,y:d};break;default:p={x:n.x,y:n.y}}switch(wn(e)){case"start":p[i]-=f*(r&&c?-1:1);break;case"end":p[i]+=f*(r&&c?-1:1);break}return p}const ob=async(t,e,r)=>{const{placement:n="bottom",strategy:o="absolute",middleware:s=[],platform:i}=r,a=s.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:o}),{x:u,y:d}=ac(c,n,l),f=n,p={},y=0;for(let m=0;m<a.length;m++){const{name:v,fn:b}=a[m],{x:_,y:w,data:x,reset:k}=await b({x:u,y:d,initialPlacement:n,placement:f,strategy:o,middlewareData:p,rects:c,platform:i,elements:{reference:t,floating:e}});u=_??u,d=w??d,p={...p,[v]:{...p[v],...x}},k&&y<=50&&(y++,typeof k=="object"&&(k.placement&&(f=k.placement),k.rects&&(c=k.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:o}):k.rects),{x:u,y:d}=ac(c,f,l)),m=-1)}return{x:u,y:d,placement:f,strategy:o,middlewareData:p}};async function Vn(t,e){var r;e===void 0&&(e={});const{x:n,y:o,platform:s,rects:i,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:p=0}=Pt(e,t),y=vh(p),v=a[f?d==="floating"?"reference":"floating":d],b=ns(await s.getClippingRect({element:(r=await(s.isElement==null?void 0:s.isElement(v)))==null||r?v:v.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),_=d==="floating"?{x:n,y:o,width:i.floating.width,height:i.floating.height}:i.reference,w=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),x=await(s.isElement==null?void 0:s.isElement(w))?await(s.getScale==null?void 0:s.getScale(w))||{x:1,y:1}:{x:1,y:1},k=ns(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:w,strategy:l}):_);return{top:(b.top-k.top+y.top)/x.y,bottom:(k.bottom-b.bottom+y.bottom)/x.y,left:(b.left-k.left+y.left)/x.x,right:(k.right-b.right+y.right)/x.x}}const sb=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:n,placement:o,rects:s,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Pt(t,e)||{};if(c==null)return{};const d=vh(u),f={x:r,y:n},p=Ga(o),y=Wa(p),m=await i.getDimensions(c),v=p==="y",b=v?"top":"left",_=v?"bottom":"right",w=v?"clientHeight":"clientWidth",x=s.reference[y]+s.reference[p]-f[p]-s.floating[y],k=f[p]-s.reference[p],C=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let S=C?C[w]:0;(!S||!await(i.isElement==null?void 0:i.isElement(C)))&&(S=a.floating[w]||s.floating[y]);const N=x/2-k/2,X=S/2-m[y]/2-1,B=Vt(d[b],X),q=Vt(d[_],X),O=B,se=S-m[y]-q,M=S/2-m[y]/2+N,J=Ki(O,M,se),V=!l.arrow&&wn(o)!=null&&M!==J&&s.reference[y]/2-(M<O?B:q)-m[y]/2<0,re=V?M<O?M-O:M-se:0;return{[p]:f[p]+re,data:{[p]:J,centerOffset:M-J-re,...V&&{alignmentOffset:re}},reset:V}}}),ib=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,n;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:m=!0,...v}=Pt(t,e);if((r=s.arrow)!=null&&r.alignmentOffset)return{};const b=At(o),_=Kt(a),w=At(a)===a,x=await(l.isRTL==null?void 0:l.isRTL(c.floating)),k=f||(w||!m?[rs(a)]:eb(a)),C=y!=="none";!f&&C&&k.push(...rb(a,m,y,x));const S=[a,...k],N=await Vn(e,v),X=[];let B=((n=s.flip)==null?void 0:n.overflows)||[];if(u&&X.push(N[b]),d){const M=Qv(o,i,x);X.push(N[M[0]],N[M[1]])}if(B=[...B,{placement:o,overflows:X}],!X.every(M=>M<=0)){var q,O;const M=(((q=s.flip)==null?void 0:q.index)||0)+1,J=S[M];if(J)return{data:{index:M,overflows:B},reset:{placement:J}};let V=(O=B.filter(re=>re.overflows[0]<=0).sort((re,Y)=>re.overflows[1]-Y.overflows[1])[0])==null?void 0:O.placement;if(!V)switch(p){case"bestFit":{var se;const re=(se=B.filter(Y=>{if(C){const ie=Kt(Y.placement);return ie===_||ie==="y"}return!0}).map(Y=>[Y.placement,Y.overflows.filter(ie=>ie>0).reduce((ie,we)=>ie+we,0)]).sort((Y,ie)=>Y[1]-ie[1])[0])==null?void 0:se[0];re&&(V=re);break}case"initialPlacement":V=a;break}if(o!==V)return{reset:{placement:V}}}return{}}}};function lc(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function cc(t){return Jv.some(e=>t[e]>=0)}const ab=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:n="referenceHidden",...o}=Pt(t,e);switch(n){case"referenceHidden":{const s=await Vn(e,{...o,elementContext:"reference"}),i=lc(s,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:cc(i)}}}case"escaped":{const s=await Vn(e,{...o,altBoundary:!0}),i=lc(s,r.floating);return{data:{escapedOffsets:i,escaped:cc(i)}}}default:return{}}}}};async function lb(t,e){const{placement:r,platform:n,elements:o}=t,s=await(n.isRTL==null?void 0:n.isRTL(o.floating)),i=At(r),a=wn(r),l=Kt(r)==="y",c=["left","top"].includes(i)?-1:1,u=s&&l?-1:1,d=Pt(e,t);let{mainAxis:f,crossAxis:p,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof y=="number"&&(p=a==="end"?y*-1:y),l?{x:p*u,y:f*c}:{x:f*c,y:p*u}}const cb=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,n;const{x:o,y:s,placement:i,middlewareData:a}=e,l=await lb(e,t);return i===((r=a.offset)==null?void 0:r.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:o+l.x,y:s+l.y,data:{...l,placement:i}}}}},ub=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:n,placement:o}=e,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:v=>{let{x:b,y:_}=v;return{x:b,y:_}}},...l}=Pt(t,e),c={x:r,y:n},u=await Vn(e,l),d=Kt(At(o)),f=Ha(d);let p=c[f],y=c[d];if(s){const v=f==="y"?"top":"left",b=f==="y"?"bottom":"right",_=p+u[v],w=p-u[b];p=Ki(_,p,w)}if(i){const v=d==="y"?"top":"left",b=d==="y"?"bottom":"right",_=y+u[v],w=y-u[b];y=Ki(_,y,w)}const m=a.fn({...e,[f]:p,[d]:y});return{...m,data:{x:m.x-r,y:m.y-n,enabled:{[f]:s,[d]:i}}}}}},db=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:n,placement:o,rects:s,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Pt(t,e),u={x:r,y:n},d=Kt(o),f=Ha(d);let p=u[f],y=u[d];const m=Pt(a,e),v=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const w=f==="y"?"height":"width",x=s.reference[f]-s.floating[w]+v.mainAxis,k=s.reference[f]+s.reference[w]-v.mainAxis;p<x?p=x:p>k&&(p=k)}if(c){var b,_;const w=f==="y"?"width":"height",x=["top","left"].includes(At(o)),k=s.reference[d]-s.floating[w]+(x&&((b=i.offset)==null?void 0:b[d])||0)+(x?0:v.crossAxis),C=s.reference[d]+s.reference[w]+(x?0:((_=i.offset)==null?void 0:_[d])||0)-(x?v.crossAxis:0);y<k?y=k:y>C&&(y=C)}return{[f]:p,[d]:y}}}},hb=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var r,n;const{placement:o,rects:s,platform:i,elements:a}=e,{apply:l=()=>{},...c}=Pt(t,e),u=await Vn(e,c),d=At(o),f=wn(o),p=Kt(o)==="y",{width:y,height:m}=s.floating;let v,b;d==="top"||d==="bottom"?(v=d,b=f===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(b=d,v=f==="end"?"top":"bottom");const _=m-u.top-u.bottom,w=y-u.left-u.right,x=Vt(m-u[v],_),k=Vt(y-u[b],w),C=!e.middlewareData.shift;let S=x,N=k;if((r=e.middlewareData.shift)!=null&&r.enabled.x&&(N=w),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(S=_),C&&!f){const B=We(u.left,0),q=We(u.right,0),O=We(u.top,0),se=We(u.bottom,0);p?N=y-2*(B!==0||q!==0?B+q:We(u.left,u.right)):S=m-2*(O!==0||se!==0?O+se:We(u.top,u.bottom))}await l({...e,availableWidth:N,availableHeight:S});const X=await i.getDimensions(a.floating);return y!==X.width||m!==X.height?{reset:{rects:!0}}:{}}}};function gs(){return typeof window<"u"}function xn(t){return bh(t)?(t.nodeName||"").toLowerCase():"#document"}function qe(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function yt(t){var e;return(e=(bh(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function bh(t){return gs()?t instanceof Node||t instanceof qe(t).Node:!1}function nt(t){return gs()?t instanceof Element||t instanceof qe(t).Element:!1}function ft(t){return gs()?t instanceof HTMLElement||t instanceof qe(t).HTMLElement:!1}function uc(t){return!gs()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof qe(t).ShadowRoot}function no(t){const{overflow:e,overflowX:r,overflowY:n,display:o}=ot(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+r)&&!["inline","contents"].includes(o)}function fb(t){return["table","td","th"].includes(xn(t))}function ms(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function qa(t){const e=Va(),r=nt(t)?ot(t):t;return["transform","translate","scale","rotate","perspective"].some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(n=>(r.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(r.contain||"").includes(n))}function pb(t){let e=Xt(t);for(;ft(e)&&!cn(e);){if(qa(e))return e;if(ms(e))return null;e=Xt(e)}return null}function Va(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function cn(t){return["html","body","#document"].includes(xn(t))}function ot(t){return qe(t).getComputedStyle(t)}function ys(t){return nt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Xt(t){if(xn(t)==="html")return t;const e=t.assignedSlot||t.parentNode||uc(t)&&t.host||yt(t);return uc(e)?e.host:e}function wh(t){const e=Xt(t);return cn(e)?t.ownerDocument?t.ownerDocument.body:t.body:ft(e)&&no(e)?e:wh(e)}function Kn(t,e,r){var n;e===void 0&&(e=[]),r===void 0&&(r=!0);const o=wh(t),s=o===((n=t.ownerDocument)==null?void 0:n.body),i=qe(o);if(s){const a=Ji(i);return e.concat(i,i.visualViewport||[],no(o)?o:[],a&&r?Kn(a):[])}return e.concat(o,Kn(o,[],r))}function Ji(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function xh(t){const e=ot(t);let r=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const o=ft(t),s=o?t.offsetWidth:r,i=o?t.offsetHeight:n,a=ts(r)!==s||ts(n)!==i;return a&&(r=s,n=i),{width:r,height:n,$:a}}function Ka(t){return nt(t)?t:t.contextElement}function rn(t){const e=Ka(t);if(!ft(e))return ht(1);const r=e.getBoundingClientRect(),{width:n,height:o,$:s}=xh(e);let i=(s?ts(r.width):r.width)/n,a=(s?ts(r.height):r.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const gb=ht(0);function _h(t){const e=qe(t);return!Va()||!e.visualViewport?gb:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function mb(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==qe(t)?!1:e}function gr(t,e,r,n){e===void 0&&(e=!1),r===void 0&&(r=!1);const o=t.getBoundingClientRect(),s=Ka(t);let i=ht(1);e&&(n?nt(n)&&(i=rn(n)):i=rn(t));const a=mb(s,r,n)?_h(s):ht(0);let l=(o.left+a.x)/i.x,c=(o.top+a.y)/i.y,u=o.width/i.x,d=o.height/i.y;if(s){const f=qe(s),p=n&&nt(n)?qe(n):n;let y=f,m=Ji(y);for(;m&&n&&p!==y;){const v=rn(m),b=m.getBoundingClientRect(),_=ot(m),w=b.left+(m.clientLeft+parseFloat(_.paddingLeft))*v.x,x=b.top+(m.clientTop+parseFloat(_.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,d*=v.y,l+=w,c+=x,y=qe(m),m=Ji(y)}}return ns({width:u,height:d,x:l,y:c})}function Xa(t,e){const r=ys(t).scrollLeft;return e?e.left+r:gr(yt(t)).left+r}function Sh(t,e,r){r===void 0&&(r=!1);const n=t.getBoundingClientRect(),o=n.left+e.scrollLeft-(r?0:Xa(t,n)),s=n.top+e.scrollTop;return{x:o,y:s}}function yb(t){let{elements:e,rect:r,offsetParent:n,strategy:o}=t;const s=o==="fixed",i=yt(n),a=e?ms(e.floating):!1;if(n===i||a&&s)return r;let l={scrollLeft:0,scrollTop:0},c=ht(1);const u=ht(0),d=ft(n);if((d||!d&&!s)&&((xn(n)!=="body"||no(i))&&(l=ys(n)),ft(n))){const p=gr(n);c=rn(n),u.x=p.x+n.clientLeft,u.y=p.y+n.clientTop}const f=i&&!d&&!s?Sh(i,l,!0):ht(0);return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:r.y*c.y-l.scrollTop*c.y+u.y+f.y}}function vb(t){return Array.from(t.getClientRects())}function bb(t){const e=yt(t),r=ys(t),n=t.ownerDocument.body,o=We(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),s=We(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+Xa(t);const a=-r.scrollTop;return ot(n).direction==="rtl"&&(i+=We(e.clientWidth,n.clientWidth)-o),{width:o,height:s,x:i,y:a}}function wb(t,e){const r=qe(t),n=yt(t),o=r.visualViewport;let s=n.clientWidth,i=n.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;const c=Va();(!c||c&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:s,height:i,x:a,y:l}}function xb(t,e){const r=gr(t,!0,e==="fixed"),n=r.top+t.clientTop,o=r.left+t.clientLeft,s=ft(t)?rn(t):ht(1),i=t.clientWidth*s.x,a=t.clientHeight*s.y,l=o*s.x,c=n*s.y;return{width:i,height:a,x:l,y:c}}function dc(t,e,r){let n;if(e==="viewport")n=wb(t,r);else if(e==="document")n=bb(yt(t));else if(nt(e))n=xb(e,r);else{const o=_h(t);n={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return ns(n)}function kh(t,e){const r=Xt(t);return r===e||!nt(r)||cn(r)?!1:ot(r).position==="fixed"||kh(r,e)}function _b(t,e){const r=e.get(t);if(r)return r;let n=Kn(t,[],!1).filter(a=>nt(a)&&xn(a)!=="body"),o=null;const s=ot(t).position==="fixed";let i=s?Xt(t):t;for(;nt(i)&&!cn(i);){const a=ot(i),l=qa(i);!l&&a.position==="fixed"&&(o=null),(s?!l&&!o:!l&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||no(i)&&!l&&kh(t,i))?n=n.filter(u=>u!==i):o=a,i=Xt(i)}return e.set(t,n),n}function Sb(t){let{element:e,boundary:r,rootBoundary:n,strategy:o}=t;const i=[...r==="clippingAncestors"?ms(e)?[]:_b(e,this._c):[].concat(r),n],a=i[0],l=i.reduce((c,u)=>{const d=dc(e,u,o);return c.top=We(d.top,c.top),c.right=Vt(d.right,c.right),c.bottom=Vt(d.bottom,c.bottom),c.left=We(d.left,c.left),c},dc(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function kb(t){const{width:e,height:r}=xh(t);return{width:e,height:r}}function Cb(t,e,r){const n=ft(e),o=yt(e),s=r==="fixed",i=gr(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=ht(0);if(n||!n&&!s)if((xn(e)!=="body"||no(o))&&(a=ys(e)),n){const f=gr(e,!0,s,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else o&&(l.x=Xa(o));const c=o&&!n&&!s?Sh(o,a):ht(0),u=i.left+a.scrollLeft-l.x-c.x,d=i.top+a.scrollTop-l.y-c.y;return{x:u,y:d,width:i.width,height:i.height}}function Xs(t){return ot(t).position==="static"}function hc(t,e){if(!ft(t)||ot(t).position==="fixed")return null;if(e)return e(t);let r=t.offsetParent;return yt(t)===r&&(r=r.ownerDocument.body),r}function Ch(t,e){const r=qe(t);if(ms(t))return r;if(!ft(t)){let o=Xt(t);for(;o&&!cn(o);){if(nt(o)&&!Xs(o))return o;o=Xt(o)}return r}let n=hc(t,e);for(;n&&fb(n)&&Xs(n);)n=hc(n,e);return n&&cn(n)&&Xs(n)&&!qa(n)?r:n||pb(t)||r}const Eb=async function(t){const e=this.getOffsetParent||Ch,r=this.getDimensions,n=await r(t.floating);return{reference:Cb(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function Pb(t){return ot(t).direction==="rtl"}const Ab={convertOffsetParentRelativeRectToViewportRelativeRect:yb,getDocumentElement:yt,getClippingRect:Sb,getOffsetParent:Ch,getElementRects:Eb,getClientRects:vb,getDimensions:kb,getScale:rn,isElement:nt,isRTL:Pb};function Eh(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Tb(t,e){let r=null,n;const o=yt(t);function s(){var a;clearTimeout(n),(a=r)==null||a.disconnect(),r=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:f,height:p}=c;if(a||e(),!f||!p)return;const y=_o(d),m=_o(o.clientWidth-(u+f)),v=_o(o.clientHeight-(d+p)),b=_o(u),w={rootMargin:-y+"px "+-m+"px "+-v+"px "+-b+"px",threshold:We(0,Vt(1,l))||1};let x=!0;function k(C){const S=C[0].intersectionRatio;if(S!==l){if(!x)return i();S?i(!1,S):n=setTimeout(()=>{i(!1,1e-7)},1e3)}S===1&&!Eh(c,t.getBoundingClientRect())&&i(),x=!1}try{r=new IntersectionObserver(k,{...w,root:o.ownerDocument})}catch{r=new IntersectionObserver(k,w)}r.observe(t)}return i(!0),s}function Rb(t,e,r,n){n===void 0&&(n={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=Ka(t),u=o||s?[...c?Kn(c):[],...Kn(e)]:[];u.forEach(b=>{o&&b.addEventListener("scroll",r,{passive:!0}),s&&b.addEventListener("resize",r)});const d=c&&a?Tb(c,r):null;let f=-1,p=null;i&&(p=new ResizeObserver(b=>{let[_]=b;_&&_.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var w;(w=p)==null||w.observe(e)})),r()}),c&&!l&&p.observe(c),p.observe(e));let y,m=l?gr(t):null;l&&v();function v(){const b=gr(t);m&&!Eh(m,b)&&r(),m=b,y=requestAnimationFrame(v)}return r(),()=>{var b;u.forEach(_=>{o&&_.removeEventListener("scroll",r),s&&_.removeEventListener("resize",r)}),d?.(),(b=p)==null||b.disconnect(),p=null,l&&cancelAnimationFrame(y)}}const Ib=cb,Ob=ub,jb=ib,$b=hb,Nb=ab,fc=sb,zb=db,Mb=(t,e,r)=>{const n=new Map,o={platform:Ab,...r},s={...o.platform,_c:n};return ob(t,e,{...o,platform:s})};var Lo=typeof document<"u"?g.useLayoutEffect:g.useEffect;function os(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,n,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(n=r;n--!==0;)if(!os(t[n],e[n]))return!1;return!0}if(o=Object.keys(t),r=o.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(e,o[n]))return!1;for(n=r;n--!==0;){const s=o[n];if(!(s==="_owner"&&t.$$typeof)&&!os(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Ph(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function pc(t,e){const r=Ph(t);return Math.round(e*r)/r}function Js(t){const e=g.useRef(t);return Lo(()=>{e.current=t}),e}function Db(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:n=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=g.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[f,p]=g.useState(n);os(f,n)||p(n);const[y,m]=g.useState(null),[v,b]=g.useState(null),_=g.useCallback(Y=>{Y!==C.current&&(C.current=Y,m(Y))},[]),w=g.useCallback(Y=>{Y!==S.current&&(S.current=Y,b(Y))},[]),x=s||y,k=i||v,C=g.useRef(null),S=g.useRef(null),N=g.useRef(u),X=l!=null,B=Js(l),q=Js(o),O=Js(c),se=g.useCallback(()=>{if(!C.current||!S.current)return;const Y={placement:e,strategy:r,middleware:f};q.current&&(Y.platform=q.current),Mb(C.current,S.current,Y).then(ie=>{const we={...ie,isPositioned:O.current!==!1};M.current&&!os(N.current,we)&&(N.current=we,Ba.flushSync(()=>{d(we)}))})},[f,e,r,q,O]);Lo(()=>{c===!1&&N.current.isPositioned&&(N.current.isPositioned=!1,d(Y=>({...Y,isPositioned:!1})))},[c]);const M=g.useRef(!1);Lo(()=>(M.current=!0,()=>{M.current=!1}),[]),Lo(()=>{if(x&&(C.current=x),k&&(S.current=k),x&&k){if(B.current)return B.current(x,k,se);se()}},[x,k,se,B,X]);const J=g.useMemo(()=>({reference:C,floating:S,setReference:_,setFloating:w}),[_,w]),V=g.useMemo(()=>({reference:x,floating:k}),[x,k]),re=g.useMemo(()=>{const Y={position:r,left:0,top:0};if(!V.floating)return Y;const ie=pc(V.floating,u.x),we=pc(V.floating,u.y);return a?{...Y,transform:"translate("+ie+"px, "+we+"px)",...Ph(V.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:ie,top:we}},[r,a,V.floating,u.x,u.y]);return g.useMemo(()=>({...u,update:se,refs:J,elements:V,floatingStyles:re}),[u,se,J,V,re])}const Lb=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:n,padding:o}=typeof t=="function"?t(r):t;return n&&e(n)?n.current!=null?fc({element:n.current,padding:o}).fn(r):{}:n?fc({element:n,padding:o}).fn(r):{}}}},Bb=(t,e)=>({...Ib(t),options:[t,e]}),Fb=(t,e)=>({...Ob(t),options:[t,e]}),Ub=(t,e)=>({...zb(t),options:[t,e]}),Hb=(t,e)=>({...jb(t),options:[t,e]}),Wb=(t,e)=>({...$b(t),options:[t,e]}),Gb=(t,e)=>({...Nb(t),options:[t,e]}),qb=(t,e)=>({...Lb(t),options:[t,e]});var Vb="Arrow",Ah=g.forwardRef((t,e)=>{const{children:r,width:n=10,height:o=5,...s}=t;return h.jsx(be.svg,{...s,ref:e,width:n,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});Ah.displayName=Vb;var Kb=Ah;function Xb(t){const[e,r]=g.useState(void 0);return pr(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=t.offsetWidth,a=t.offsetHeight;r({width:i,height:a})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else r(void 0)},[t]),e}var Ja="Popper",[Th,Rh]=La(Ja),[Jb,Ih]=Th(Ja),Oh=t=>{const{__scopePopper:e,children:r}=t,[n,o]=g.useState(null);return h.jsx(Jb,{scope:e,anchor:n,onAnchorChange:o,children:r})};Oh.displayName=Ja;var jh="PopperAnchor",$h=g.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:n,...o}=t,s=Ih(jh,r),i=g.useRef(null),a=st(e,i);return g.useEffect(()=>{s.onAnchorChange(n?.current||i.current)}),n?null:h.jsx(be.div,{...o,ref:a})});$h.displayName=jh;var Ya="PopperContent",[Yb,Zb]=Th(Ya),Nh=g.forwardRef((t,e)=>{const{__scopePopper:r,side:n="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:p="optimized",onPlaced:y,...m}=t,v=Ih(Ya,r),[b,_]=g.useState(null),w=st(e,T=>_(T)),[x,k]=g.useState(null),C=Xb(x),S=C?.width??0,N=C?.height??0,X=n+(s!=="center"?"-"+s:""),B=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},q=Array.isArray(c)?c:[c],O=q.length>0,se={padding:B,boundary:q.filter(ew),altBoundary:O},{refs:M,floatingStyles:J,placement:V,isPositioned:re,middlewareData:Y}=Db({strategy:"fixed",placement:X,whileElementsMounted:(...T)=>Rb(...T,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[Bb({mainAxis:o+N,alignmentAxis:i}),l&&Fb({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?Ub():void 0,...se}),l&&Hb({...se}),Wb({...se,apply:({elements:T,rects:z,availableWidth:ne,availableHeight:ce})=>{const{width:Ve,height:Ke}=z.reference,ue=T.floating.style;ue.setProperty("--radix-popper-available-width",`${ne}px`),ue.setProperty("--radix-popper-available-height",`${ce}px`),ue.setProperty("--radix-popper-anchor-width",`${Ve}px`),ue.setProperty("--radix-popper-anchor-height",`${Ke}px`)}}),x&&qb({element:x,padding:a}),tw({arrowWidth:S,arrowHeight:N}),f&&Gb({strategy:"referenceHidden",...se})]}),[ie,we]=Dh(V),me=qt(y);pr(()=>{re&&me?.()},[re,me]);const P=Y.arrow?.x,E=Y.arrow?.y,R=Y.arrow?.centerOffset!==0,[A,I]=g.useState();return pr(()=>{b&&I(window.getComputedStyle(b).zIndex)},[b]),h.jsx("div",{ref:M.setFloating,"data-radix-popper-content-wrapper":"",style:{...J,transform:re?J.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:A,"--radix-popper-transform-origin":[Y.transformOrigin?.x,Y.transformOrigin?.y].join(" "),...Y.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:h.jsx(Yb,{scope:r,placedSide:ie,onArrowChange:k,arrowX:P,arrowY:E,shouldHideArrow:R,children:h.jsx(be.div,{"data-side":ie,"data-align":we,...m,ref:w,style:{...m.style,animation:re?void 0:"none"}})})})});Nh.displayName=Ya;var zh="PopperArrow",Qb={top:"bottom",right:"left",bottom:"top",left:"right"},Mh=g.forwardRef(function(e,r){const{__scopePopper:n,...o}=e,s=Zb(zh,n),i=Qb[s.placedSide];return h.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:h.jsx(Kb,{...o,ref:r,style:{...o.style,display:"block"}})})});Mh.displayName=zh;function ew(t){return t!==null}var tw=t=>({name:"transformOrigin",options:t,fn(e){const{placement:r,rects:n,middlewareData:o}=e,i=o.arrow?.centerOffset!==0,a=i?0:t.arrowWidth,l=i?0:t.arrowHeight,[c,u]=Dh(r),d={start:"0%",center:"50%",end:"100%"}[u],f=(o.arrow?.x??0)+a/2,p=(o.arrow?.y??0)+l/2;let y="",m="";return c==="bottom"?(y=i?d:`${f}px`,m=`${-l}px`):c==="top"?(y=i?d:`${f}px`,m=`${n.floating.height+l}px`):c==="right"?(y=`${-l}px`,m=i?d:`${p}px`):c==="left"&&(y=`${n.floating.width+l}px`,m=i?d:`${p}px`),{data:{x:y,y:m}}}});function Dh(t){const[e,r="center"]=t.split("-");return[e,r]}var rw=Oh,Lh=$h,nw=Nh,ow=Mh,sw="Portal",Bh=g.forwardRef((t,e)=>{const{container:r,...n}=t,[o,s]=g.useState(!1);pr(()=>s(!0),[]);const i=r||o&&globalThis?.document?.body;return i?Ev.createPortal(h.jsx(be.div,{...n,ref:e}),i):null});Bh.displayName=sw;function iw(t,e){return g.useReducer((r,n)=>e[r][n]??r,t)}var oo=t=>{const{present:e,children:r}=t,n=aw(e),o=typeof r=="function"?r({present:n.isPresent}):g.Children.only(r),s=st(n.ref,lw(o));return typeof r=="function"||n.isPresent?g.cloneElement(o,{ref:s}):null};oo.displayName="Presence";function aw(t){const[e,r]=g.useState(),n=g.useRef({}),o=g.useRef(t),s=g.useRef("none"),i=t?"mounted":"unmounted",[a,l]=iw(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return g.useEffect(()=>{const c=So(n.current);s.current=a==="mounted"?c:"none"},[a]),pr(()=>{const c=n.current,u=o.current;if(u!==t){const f=s.current,p=So(c);t?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),pr(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const m=So(n.current).includes(p.animationName);if(p.target===e&&m&&(l("ANIMATION_END"),!o.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},f=p=>{p.target===e&&(s.current=So(n.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:g.useCallback(c=>{c&&(n.current=getComputedStyle(c)),r(c)},[])}}function So(t){return t?.animationName||"none"}function lw(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function Fh({prop:t,defaultProp:e,onChange:r=()=>{}}){const[n,o]=cw({defaultProp:e,onChange:r}),s=t!==void 0,i=s?t:n,a=qt(r),l=g.useCallback(c=>{if(s){const d=typeof c=="function"?c(t):c;d!==t&&a(d)}else o(c)},[s,t,o,a]);return[i,l]}function cw({defaultProp:t,onChange:e}){const r=g.useState(t),[n]=r,o=g.useRef(n),s=qt(e);return g.useEffect(()=>{o.current!==n&&(s(n),o.current=n)},[n,o,s]),r}var uw=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Ar=new WeakMap,ko=new WeakMap,Co={},Ys=0,Uh=function(t){return t&&(t.host||Uh(t.parentNode))},dw=function(t,e){return e.map(function(r){if(t.contains(r))return r;var n=Uh(r);return n&&t.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},hw=function(t,e,r,n){var o=dw(e,Array.isArray(t)?t:[t]);Co[r]||(Co[r]=new WeakMap);var s=Co[r],i=[],a=new Set,l=new Set(o),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};o.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(f){if(a.has(f))u(f);else try{var p=f.getAttribute(n),y=p!==null&&p!=="false",m=(Ar.get(f)||0)+1,v=(s.get(f)||0)+1;Ar.set(f,m),s.set(f,v),i.push(f),m===1&&y&&ko.set(f,!0),v===1&&f.setAttribute(r,"true"),y||f.setAttribute(n,"true")}catch(b){console.error("aria-hidden: cannot operate on ",f,b)}})};return u(e),a.clear(),Ys++,function(){i.forEach(function(d){var f=Ar.get(d)-1,p=s.get(d)-1;Ar.set(d,f),s.set(d,p),f||(ko.has(d)||d.removeAttribute(n),ko.delete(d)),p||d.removeAttribute(r)}),Ys--,Ys||(Ar=new WeakMap,Ar=new WeakMap,ko=new WeakMap,Co={})}},Hh=function(t,e,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(t)?t:[t]),o=uw(t);return o?(n.push.apply(n,Array.from(o.querySelectorAll("[aria-live]"))),hw(n,o,r,"aria-hidden")):function(){return null}},ct=function(){return ct=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ct.apply(this,arguments)};function Wh(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r}function fw(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))}var Bo="right-scroll-bar-position",Fo="width-before-scroll-bar",pw="with-scroll-bars-hidden",gw="--removed-body-scroll-bar-size";function Zs(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function mw(t,e){var r=g.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(n){var o=r.value;o!==n&&(r.value=n,r.callback(n,o))}}}})[0];return r.callback=e,r.facade}var yw=typeof window<"u"?g.useLayoutEffect:g.useEffect,gc=new WeakMap;function vw(t,e){var r=mw(null,function(n){return t.forEach(function(o){return Zs(o,n)})});return yw(function(){var n=gc.get(r);if(n){var o=new Set(n),s=new Set(t),i=r.current;o.forEach(function(a){s.has(a)||Zs(a,null)}),s.forEach(function(a){o.has(a)||Zs(a,i)})}gc.set(r,t)},[t]),r}function bw(t){return t}function ww(t,e){e===void 0&&(e=bw);var r=[],n=!1,o={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(s){var i=e(s,n);return r.push(i),function(){r=r.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(n=!0;r.length;){var i=r;r=[],i.forEach(s)}r={push:function(a){return s(a)},filter:function(){return r}}},assignMedium:function(s){n=!0;var i=[];if(r.length){var a=r;r=[],a.forEach(s),i=r}var l=function(){var u=i;i=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),r={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),r}}}};return o}function xw(t){t===void 0&&(t={});var e=ww(null);return e.options=ct({async:!0,ssr:!1},t),e}var Gh=function(t){var e=t.sideCar,r=Wh(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return g.createElement(n,ct({},r))};Gh.isSideCarExport=!0;function _w(t,e){return t.useMedium(e),Gh}var qh=xw(),Qs=function(){},vs=g.forwardRef(function(t,e){var r=g.useRef(null),n=g.useState({onScrollCapture:Qs,onWheelCapture:Qs,onTouchMoveCapture:Qs}),o=n[0],s=n[1],i=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,f=t.sideCar,p=t.noIsolation,y=t.inert,m=t.allowPinchZoom,v=t.as,b=v===void 0?"div":v,_=t.gapMode,w=Wh(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=f,k=vw([r,e]),C=ct(ct({},w),o);return g.createElement(g.Fragment,null,u&&g.createElement(x,{sideCar:qh,removeScrollBar:c,shards:d,noIsolation:p,inert:y,setCallbacks:s,allowPinchZoom:!!m,lockRef:r,gapMode:_}),i?g.cloneElement(g.Children.only(a),ct(ct({},C),{ref:k})):g.createElement(b,ct({},C,{className:l,ref:k}),a))});vs.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};vs.classNames={fullWidth:Fo,zeroRight:Bo};var Sw=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function kw(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Sw();return e&&t.setAttribute("nonce",e),t}function Cw(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function Ew(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Pw=function(){var t=0,e=null;return{add:function(r){t==0&&(e=kw())&&(Cw(e,r),Ew(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Aw=function(){var t=Pw();return function(e,r){g.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},Vh=function(){var t=Aw(),e=function(r){var n=r.styles,o=r.dynamic;return t(n,o),null};return e},Tw={left:0,top:0,right:0,gap:0},ei=function(t){return parseInt(t||"",10)||0},Rw=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],n=e[t==="padding"?"paddingTop":"marginTop"],o=e[t==="padding"?"paddingRight":"marginRight"];return[ei(r),ei(n),ei(o)]},Iw=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Tw;var e=Rw(t),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-r+e[2]-e[0])}},Ow=Vh(),nn="data-scroll-locked",jw=function(t,e,r,n){var o=t.left,s=t.top,i=t.right,a=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(pw,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(a,"px ").concat(n,`;
  }
  body[`).concat(nn,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(a,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Bo,` {
    right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Fo,` {
    margin-right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Bo," .").concat(Bo,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Fo," .").concat(Fo,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(nn,`] {
    `).concat(gw,": ").concat(a,`px;
  }
`)},mc=function(){var t=parseInt(document.body.getAttribute(nn)||"0",10);return isFinite(t)?t:0},$w=function(){g.useEffect(function(){return document.body.setAttribute(nn,(mc()+1).toString()),function(){var t=mc()-1;t<=0?document.body.removeAttribute(nn):document.body.setAttribute(nn,t.toString())}},[])},Nw=function(t){var e=t.noRelative,r=t.noImportant,n=t.gapMode,o=n===void 0?"margin":n;$w();var s=g.useMemo(function(){return Iw(o)},[o]);return g.createElement(Ow,{styles:jw(s,!e,o,r?"":"!important")})},Yi=!1;if(typeof window<"u")try{var Eo=Object.defineProperty({},"passive",{get:function(){return Yi=!0,!0}});window.addEventListener("test",Eo,Eo),window.removeEventListener("test",Eo,Eo)}catch{Yi=!1}var Tr=Yi?{passive:!1}:!1,zw=function(t){return t.tagName==="TEXTAREA"},Kh=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!zw(t)&&r[e]==="visible")},Mw=function(t){return Kh(t,"overflowY")},Dw=function(t){return Kh(t,"overflowX")},yc=function(t,e){var r=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var o=Xh(t,n);if(o){var s=Jh(t,n),i=s[1],a=s[2];if(i>a)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},Lw=function(t){var e=t.scrollTop,r=t.scrollHeight,n=t.clientHeight;return[e,r,n]},Bw=function(t){var e=t.scrollLeft,r=t.scrollWidth,n=t.clientWidth;return[e,r,n]},Xh=function(t,e){return t==="v"?Mw(e):Dw(e)},Jh=function(t,e){return t==="v"?Lw(e):Bw(e)},Fw=function(t,e){return t==="h"&&e==="rtl"?-1:1},Uw=function(t,e,r,n,o){var s=Fw(t,window.getComputedStyle(e).direction),i=s*n,a=r.target,l=e.contains(a),c=!1,u=i>0,d=0,f=0;do{var p=Jh(t,a),y=p[0],m=p[1],v=p[2],b=m-v-s*y;(y||b)&&Xh(t,a)&&(d+=b,f+=y),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(f)<1)&&(c=!0),c},Po=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},vc=function(t){return[t.deltaX,t.deltaY]},bc=function(t){return t&&"current"in t?t.current:t},Hw=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Ww=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Gw=0,Rr=[];function qw(t){var e=g.useRef([]),r=g.useRef([0,0]),n=g.useRef(),o=g.useState(Gw++)[0],s=g.useState(Vh)[0],i=g.useRef(t);g.useEffect(function(){i.current=t},[t]),g.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(o));var m=fw([t.lockRef.current],(t.shards||[]).map(bc),!0).filter(Boolean);return m.forEach(function(v){return v.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),m.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(o))})}}},[t.inert,t.lockRef.current,t.shards]);var a=g.useCallback(function(m,v){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!i.current.allowPinchZoom;var b=Po(m),_=r.current,w="deltaX"in m?m.deltaX:_[0]-b[0],x="deltaY"in m?m.deltaY:_[1]-b[1],k,C=m.target,S=Math.abs(w)>Math.abs(x)?"h":"v";if("touches"in m&&S==="h"&&C.type==="range")return!1;var N=yc(S,C);if(!N)return!0;if(N?k=S:(k=S==="v"?"h":"v",N=yc(S,C)),!N)return!1;if(!n.current&&"changedTouches"in m&&(w||x)&&(n.current=k),!k)return!0;var X=n.current||k;return Uw(X,v,m,X==="h"?w:x)},[]),l=g.useCallback(function(m){var v=m;if(!(!Rr.length||Rr[Rr.length-1]!==s)){var b="deltaY"in v?vc(v):Po(v),_=e.current.filter(function(k){return k.name===v.type&&(k.target===v.target||v.target===k.shadowParent)&&Hw(k.delta,b)})[0];if(_&&_.should){v.cancelable&&v.preventDefault();return}if(!_){var w=(i.current.shards||[]).map(bc).filter(Boolean).filter(function(k){return k.contains(v.target)}),x=w.length>0?a(v,w[0]):!i.current.noIsolation;x&&v.cancelable&&v.preventDefault()}}},[]),c=g.useCallback(function(m,v,b,_){var w={name:m,delta:v,target:b,should:_,shadowParent:Vw(b)};e.current.push(w),setTimeout(function(){e.current=e.current.filter(function(x){return x!==w})},1)},[]),u=g.useCallback(function(m){r.current=Po(m),n.current=void 0},[]),d=g.useCallback(function(m){c(m.type,vc(m),m.target,a(m,t.lockRef.current))},[]),f=g.useCallback(function(m){c(m.type,Po(m),m.target,a(m,t.lockRef.current))},[]);g.useEffect(function(){return Rr.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",l,Tr),document.addEventListener("touchmove",l,Tr),document.addEventListener("touchstart",u,Tr),function(){Rr=Rr.filter(function(m){return m!==s}),document.removeEventListener("wheel",l,Tr),document.removeEventListener("touchmove",l,Tr),document.removeEventListener("touchstart",u,Tr)}},[]);var p=t.removeScrollBar,y=t.inert;return g.createElement(g.Fragment,null,y?g.createElement(s,{styles:Ww(o)}):null,p?g.createElement(Nw,{gapMode:t.gapMode}):null)}function Vw(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Kw=_w(qh,qw);var Za=g.forwardRef(function(t,e){return g.createElement(vs,ct({},t,{ref:e,sideCar:Kw}))});Za.classNames=vs.classNames;var Qa="Popover",[Yh,pA]=La(Qa,[Rh]),so=Rh(),[Xw,kr]=Yh(Qa),Zh=t=>{const{__scopePopover:e,children:r,open:n,defaultOpen:o,onOpenChange:s,modal:i=!1}=t,a=so(e),l=g.useRef(null),[c,u]=g.useState(!1),[d=!1,f]=Fh({prop:n,defaultProp:o,onChange:s});return h.jsx(rw,{...a,children:h.jsx(Xw,{scope:e,contentId:dt(),triggerRef:l,open:d,onOpenChange:f,onOpenToggle:g.useCallback(()=>f(p=>!p),[f]),hasCustomAnchor:c,onCustomAnchorAdd:g.useCallback(()=>u(!0),[]),onCustomAnchorRemove:g.useCallback(()=>u(!1),[]),modal:i,children:r})})};Zh.displayName=Qa;var Qh="PopoverAnchor",Jw=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=kr(Qh,r),s=so(r),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=o;return g.useEffect(()=>(i(),()=>a()),[i,a]),h.jsx(Lh,{...s,...n,ref:e})});Jw.displayName=Qh;var ef="PopoverTrigger",tf=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=kr(ef,r),s=so(r),i=st(e,o.triggerRef),a=h.jsx(be.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":sf(o.open),...n,ref:i,onClick:Ge(t.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:h.jsx(Lh,{asChild:!0,...s,children:a})});tf.displayName=ef;var Yw="PopoverPortal",[gA,Zw]=Yh(Yw,{forceMount:void 0}),un="PopoverContent",rf=g.forwardRef((t,e)=>{const r=Zw(un,t.__scopePopover),{forceMount:n=r.forceMount,...o}=t,s=kr(un,t.__scopePopover);return h.jsx(oo,{present:n||s.open,children:s.modal?h.jsx(Qw,{...o,ref:e}):h.jsx(ex,{...o,ref:e})})});rf.displayName=un;var Qw=g.forwardRef((t,e)=>{const r=kr(un,t.__scopePopover),n=g.useRef(null),o=st(e,n),s=g.useRef(!1);return g.useEffect(()=>{const i=n.current;if(i)return Hh(i)},[]),h.jsx(Za,{as:ps,allowPinchZoom:!0,children:h.jsx(nf,{...t,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ge(t.onCloseAutoFocus,i=>{i.preventDefault(),s.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Ge(t.onPointerDownOutside,i=>{const a=i.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Ge(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),ex=g.forwardRef((t,e)=>{const r=kr(un,t.__scopePopover),n=g.useRef(!1),o=g.useRef(!1);return h.jsx(nf,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(n.current||r.triggerRef.current?.focus(),s.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(n.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;r.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),nf=g.forwardRef((t,e)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=t,f=kr(un,r),p=so(r);return mh(),h.jsx(Ua,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:s,children:h.jsx(Fa,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>f.onOpenChange(!1),children:h.jsx(nw,{"data-state":sf(f.open),role:"dialog",id:f.contentId,...p,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),of="PopoverClose",tx=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=kr(of,r);return h.jsx(be.button,{type:"button",...n,ref:e,onClick:Ge(t.onClick,()=>o.onOpenChange(!1))})});tx.displayName=of;var rx="PopoverArrow",nx=g.forwardRef((t,e)=>{const{__scopePopover:r,...n}=t,o=so(r);return h.jsx(ow,{...o,...n,ref:e})});nx.displayName=rx;function sf(t){return t?"open":"closed"}var ox=tf;function af(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(e=0;e<o;e++)t[e]&&(r=af(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function lf(){for(var t,e,r=0,n="",o=arguments.length;r<o;r++)(t=arguments[r])&&(e=af(t))&&(n&&(n+=" "),n+=e);return n}function Pe(...t){return uh(lf(t))}const cf=Zh,uf=ox,df=g.forwardRef(({className:t,align:e="end",...r},n)=>h.jsx(rf,{ref:n,align:e,className:Pe("z-popups drop-shadow-oneBlock p-0 border-shadow outline-none",t),...r,onKeyDown:o=>{o.stopPropagation()}})),el=({children:t,scaleFactor:e})=>{const r=Og();return h.jsx("div",{className:"contents set-spritesheet-vars",style:{"--scale":e??r,"--block":`${(e??r)*8}px`},children:t})};var wc=1,sx=.9,ix=.8,ax=.17,ti=.1,ri=.999,lx=.9999,cx=.99,ux=/[\\\/_+.#"@\[\(\{&]/,dx=/[\\\/_+.#"@\[\(\{&]/g,hx=/[\s-]/,hf=/[\s-]/g;function Zi(t,e,r,n,o,s,i){if(s===e.length)return o===t.length?wc:cx;var a=`${o},${s}`;if(i[a]!==void 0)return i[a];for(var l=n.charAt(s),c=r.indexOf(l,o),u=0,d,f,p,y;c>=0;)d=Zi(t,e,r,n,c+1,s+1,i),d>u&&(c===o?d*=wc:ux.test(t.charAt(c-1))?(d*=ix,p=t.slice(o,c-1).match(dx),p&&o>0&&(d*=Math.pow(ri,p.length))):hx.test(t.charAt(c-1))?(d*=sx,y=t.slice(o,c-1).match(hf),y&&o>0&&(d*=Math.pow(ri,y.length))):(d*=ax,o>0&&(d*=Math.pow(ri,c-o))),t.charAt(c)!==e.charAt(s)&&(d*=lx)),(d<ti&&r.charAt(c-1)===n.charAt(s+1)||n.charAt(s+1)===n.charAt(s)&&r.charAt(c-1)!==n.charAt(s))&&(f=Zi(t,e,r,n,c+1,s+2,i),f*ti>d&&(d=f*ti)),d>u&&(u=d),c=r.indexOf(l,c+1);return i[a]=u,u}function xc(t){return t.toLowerCase().replace(hf," ")}function fx(t,e,r){return t=r&&r.length>0?`${t+" "+r.join(" ")}`:t,Zi(t,e,xc(t),xc(e),0,0,{})}var tl="Dialog",[ff,mA]=La(tl),[px,it]=ff(tl),pf=t=>{const{__scopeDialog:e,children:r,open:n,defaultOpen:o,onOpenChange:s,modal:i=!0}=t,a=g.useRef(null),l=g.useRef(null),[c=!1,u]=Fh({prop:n,defaultProp:o,onChange:s});return h.jsx(px,{scope:e,triggerRef:a,contentRef:l,contentId:dt(),titleId:dt(),descriptionId:dt(),open:c,onOpenChange:u,onOpenToggle:g.useCallback(()=>u(d=>!d),[u]),modal:i,children:r})};pf.displayName=tl;var gf="DialogTrigger",gx=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=it(gf,r),s=st(e,o.triggerRef);return h.jsx(be.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":ol(o.open),...n,ref:s,onClick:Ge(t.onClick,o.onOpenToggle)})});gx.displayName=gf;var rl="DialogPortal",[mx,mf]=ff(rl,{forceMount:void 0}),yf=t=>{const{__scopeDialog:e,forceMount:r,children:n,container:o}=t,s=it(rl,e);return h.jsx(mx,{scope:e,forceMount:r,children:g.Children.map(n,i=>h.jsx(oo,{present:r||s.open,children:h.jsx(Bh,{asChild:!0,container:o,children:i})}))})};yf.displayName=rl;var ss="DialogOverlay",vf=g.forwardRef((t,e)=>{const r=mf(ss,t.__scopeDialog),{forceMount:n=r.forceMount,...o}=t,s=it(ss,t.__scopeDialog);return s.modal?h.jsx(oo,{present:n||s.open,children:h.jsx(yx,{...o,ref:e})}):null});vf.displayName=ss;var yx=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=it(ss,r);return h.jsx(Za,{as:ps,allowPinchZoom:!0,shards:[o.contentRef],children:h.jsx(be.div,{"data-state":ol(o.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),mr="DialogContent",bf=g.forwardRef((t,e)=>{const r=mf(mr,t.__scopeDialog),{forceMount:n=r.forceMount,...o}=t,s=it(mr,t.__scopeDialog);return h.jsx(oo,{present:n||s.open,children:s.modal?h.jsx(vx,{...o,ref:e}):h.jsx(bx,{...o,ref:e})})});bf.displayName=mr;var vx=g.forwardRef((t,e)=>{const r=it(mr,t.__scopeDialog),n=g.useRef(null),o=st(e,r.contentRef,n);return g.useEffect(()=>{const s=n.current;if(s)return Hh(s)},[]),h.jsx(wf,{...t,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ge(t.onCloseAutoFocus,s=>{s.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:Ge(t.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:Ge(t.onFocusOutside,s=>s.preventDefault())})}),bx=g.forwardRef((t,e)=>{const r=it(mr,t.__scopeDialog),n=g.useRef(!1),o=g.useRef(!1);return h.jsx(wf,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(n.current||r.triggerRef.current?.focus(),s.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(n.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;r.triggerRef.current?.contains(i)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),wf=g.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=t,a=it(mr,r),l=g.useRef(null),c=st(e,l);return mh(),h.jsxs(h.Fragment,{children:[h.jsx(Ua,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:s,children:h.jsx(Fa,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":ol(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),h.jsxs(h.Fragment,{children:[h.jsx(Sx,{titleId:a.titleId}),h.jsx(Cx,{contentRef:l,descriptionId:a.descriptionId})]})]})}),nl="DialogTitle",wx=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=it(nl,r);return h.jsx(be.h2,{id:o.titleId,...n,ref:e})});wx.displayName=nl;var xf="DialogDescription",xx=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=it(xf,r);return h.jsx(be.p,{id:o.descriptionId,...n,ref:e})});xx.displayName=xf;var _f="DialogClose",_x=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,o=it(_f,r);return h.jsx(be.button,{type:"button",...n,ref:e,onClick:Ge(t.onClick,()=>o.onOpenChange(!1))})});_x.displayName=_f;function ol(t){return t?"open":"closed"}var Sf="DialogTitleWarning",[yA,kf]=kv(Sf,{contentName:mr,titleName:nl,docsSlug:"dialog"}),Sx=({titleId:t})=>{const e=kf(Sf),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return g.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},kx="DialogDescriptionWarning",Cx=({contentRef:t,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${kf(kx).contentName}}.`;return g.useEffect(()=>{const o=t.current?.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(n))},[n,t,e]),null},Ex=pf,Px=yf,Ax=vf,Tx=bf,ni={exports:{}},oi={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _c;function Rx(){if(_c)return oi;_c=1;var t=jg();function e(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var r=typeof Object.is=="function"?Object.is:e,n=t.useState,o=t.useEffect,s=t.useLayoutEffect,i=t.useDebugValue;function a(d,f){var p=f(),y=n({inst:{value:p,getSnapshot:f}}),m=y[0].inst,v=y[1];return s(function(){m.value=p,m.getSnapshot=f,l(m)&&v({inst:m})},[d,p,f]),o(function(){return l(m)&&v({inst:m}),d(function(){l(m)&&v({inst:m})})},[d]),i(p),p}function l(d){var f=d.getSnapshot;d=d.value;try{var p=f();return!r(d,p)}catch{return!0}}function c(d,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return oi.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,oi}var Sc;function Ix(){return Sc||(Sc=1,ni.exports=Rx()),ni.exports}var Ox=Ix(),An='[cmdk-group=""]',si='[cmdk-group-items=""]',jx='[cmdk-group-heading=""]',sl='[cmdk-item=""]',kc=`${sl}:not([aria-disabled="true"])`,Qi="cmdk-item-select",sr="data-value",$x=(t,e,r)=>fx(t,e,r),Cf=g.createContext(void 0),io=()=>g.useContext(Cf),Ef=g.createContext(void 0),il=()=>g.useContext(Ef),Pf=g.createContext(void 0),Af=g.forwardRef((t,e)=>{let r=Wr(()=>{var P,E;return{search:"",value:(E=(P=t.value)!=null?P:t.defaultValue)!=null?E:"",filtered:{count:0,items:new Map,groups:new Set}}}),n=Wr(()=>new Set),o=Wr(()=>new Map),s=Wr(()=>new Map),i=Wr(()=>new Set),a=Tf(t),{label:l,children:c,value:u,onValueChange:d,filter:f,shouldFilter:p,loop:y,disablePointerSelection:m=!1,vimBindings:v=!0,...b}=t,_=dt(),w=dt(),x=dt(),k=g.useRef(null),C=Gx();yr(()=>{if(u!==void 0){let P=u.trim();r.current.value=P,S.emit()}},[u]),yr(()=>{C(6,se)},[]);let S=g.useMemo(()=>({subscribe:P=>(i.current.add(P),()=>i.current.delete(P)),snapshot:()=>r.current,setState:(P,E,R)=>{var A,I,T;if(!Object.is(r.current[P],E)){if(r.current[P]=E,P==="search")O(),B(),C(1,q);else if(P==="value"&&(R||C(5,se),((A=a.current)==null?void 0:A.value)!==void 0)){let z=E??"";(T=(I=a.current).onValueChange)==null||T.call(I,z);return}S.emit()}},emit:()=>{i.current.forEach(P=>P())}}),[]),N=g.useMemo(()=>({value:(P,E,R)=>{var A;E!==((A=s.current.get(P))==null?void 0:A.value)&&(s.current.set(P,{value:E,keywords:R}),r.current.filtered.items.set(P,X(E,R)),C(2,()=>{B(),S.emit()}))},item:(P,E)=>(n.current.add(P),E&&(o.current.has(E)?o.current.get(E).add(P):o.current.set(E,new Set([P]))),C(3,()=>{O(),B(),r.current.value||q(),S.emit()}),()=>{s.current.delete(P),n.current.delete(P),r.current.filtered.items.delete(P);let R=M();C(4,()=>{O(),R?.getAttribute("id")===P&&q(),S.emit()})}),group:P=>(o.current.has(P)||o.current.set(P,new Set),()=>{s.current.delete(P),o.current.delete(P)}),filter:()=>a.current.shouldFilter,label:l||t["aria-label"],getDisablePointerSelection:()=>a.current.disablePointerSelection,listId:_,inputId:x,labelId:w,listInnerRef:k}),[]);function X(P,E){var R,A;let I=(A=(R=a.current)==null?void 0:R.filter)!=null?A:$x;return P?I(P,r.current.search,E):0}function B(){if(!r.current.search||a.current.shouldFilter===!1)return;let P=r.current.filtered.items,E=[];r.current.filtered.groups.forEach(A=>{let I=o.current.get(A),T=0;I.forEach(z=>{let ne=P.get(z);T=Math.max(ne,T)}),E.push([A,T])});let R=k.current;J().sort((A,I)=>{var T,z;let ne=A.getAttribute("id"),ce=I.getAttribute("id");return((T=P.get(ce))!=null?T:0)-((z=P.get(ne))!=null?z:0)}).forEach(A=>{let I=A.closest(si);I?I.appendChild(A.parentElement===I?A:A.closest(`${si} > *`)):R.appendChild(A.parentElement===R?A:A.closest(`${si} > *`))}),E.sort((A,I)=>I[1]-A[1]).forEach(A=>{var I;let T=(I=k.current)==null?void 0:I.querySelector(`${An}[${sr}="${encodeURIComponent(A[0])}"]`);T?.parentElement.appendChild(T)})}function q(){let P=J().find(R=>R.getAttribute("aria-disabled")!=="true"),E=P?.getAttribute(sr);S.setState("value",E||void 0)}function O(){var P,E,R,A;if(!r.current.search||a.current.shouldFilter===!1){r.current.filtered.count=n.current.size;return}r.current.filtered.groups=new Set;let I=0;for(let T of n.current){let z=(E=(P=s.current.get(T))==null?void 0:P.value)!=null?E:"",ne=(A=(R=s.current.get(T))==null?void 0:R.keywords)!=null?A:[],ce=X(z,ne);r.current.filtered.items.set(T,ce),ce>0&&I++}for(let[T,z]of o.current)for(let ne of z)if(r.current.filtered.items.get(ne)>0){r.current.filtered.groups.add(T);break}r.current.filtered.count=I}function se(){var P,E,R;let A=M();A&&(((P=A.parentElement)==null?void 0:P.firstChild)===A&&((R=(E=A.closest(An))==null?void 0:E.querySelector(jx))==null||R.scrollIntoView({block:"nearest"})),A.scrollIntoView({block:"nearest"}))}function M(){var P;return(P=k.current)==null?void 0:P.querySelector(`${sl}[aria-selected="true"]`)}function J(){var P;return Array.from(((P=k.current)==null?void 0:P.querySelectorAll(kc))||[])}function V(P){let E=J()[P];E&&S.setState("value",E.getAttribute(sr))}function re(P){var E;let R=M(),A=J(),I=A.findIndex(z=>z===R),T=A[I+P];(E=a.current)!=null&&E.loop&&(T=I+P<0?A[A.length-1]:I+P===A.length?A[0]:A[I+P]),T&&S.setState("value",T.getAttribute(sr))}function Y(P){let E=M(),R=E?.closest(An),A;for(;R&&!A;)R=P>0?Hx(R,An):Wx(R,An),A=R?.querySelector(kc);A?S.setState("value",A.getAttribute(sr)):re(P)}let ie=()=>V(J().length-1),we=P=>{P.preventDefault(),P.metaKey?ie():P.altKey?Y(1):re(1)},me=P=>{P.preventDefault(),P.metaKey?V(0):P.altKey?Y(-1):re(-1)};return g.createElement(be.div,{ref:e,tabIndex:-1,...b,"cmdk-root":"",onKeyDown:P=>{var E;if((E=b.onKeyDown)==null||E.call(b,P),!P.defaultPrevented)switch(P.key){case"n":case"j":{v&&P.ctrlKey&&we(P);break}case"ArrowDown":{we(P);break}case"p":case"k":{v&&P.ctrlKey&&me(P);break}case"ArrowUp":{me(P);break}case"Home":{P.preventDefault(),V(0);break}case"End":{P.preventDefault(),ie();break}case"Enter":if(!P.nativeEvent.isComposing&&P.keyCode!==229){P.preventDefault();let R=M();if(R){let A=new Event(Qi);R.dispatchEvent(A)}}}}},g.createElement("label",{"cmdk-label":"",htmlFor:N.inputId,id:N.labelId,style:Vx},l),bs(t,P=>g.createElement(Ef.Provider,{value:S},g.createElement(Cf.Provider,{value:N},P))))}),Nx=g.forwardRef((t,e)=>{var r,n;let o=dt(),s=g.useRef(null),i=g.useContext(Pf),a=io(),l=Tf(t),c=(n=(r=l.current)==null?void 0:r.forceMount)!=null?n:i?.forceMount;yr(()=>{if(!c)return a.item(o,i?.id)},[c]);let u=Rf(o,s,[t.value,t.children,s],t.keywords),d=il(),f=vr(C=>C.value&&C.value===u.current),p=vr(C=>c||a.filter()===!1?!0:C.search?C.filtered.items.get(o)>0:!0);g.useEffect(()=>{let C=s.current;if(!(!C||t.disabled))return C.addEventListener(Qi,y),()=>C.removeEventListener(Qi,y)},[p,t.onSelect,t.disabled]);function y(){var C,S;m(),(S=(C=l.current).onSelect)==null||S.call(C,u.current)}function m(){d.setState("value",u.current,!0)}if(!p)return null;let{disabled:v,value:b,onSelect:_,forceMount:w,keywords:x,...k}=t;return g.createElement(be.div,{ref:Xn([s,e]),...k,id:o,"cmdk-item":"",role:"option","aria-disabled":!!v,"aria-selected":!!f,"data-disabled":!!v,"data-selected":!!f,onPointerMove:v||a.getDisablePointerSelection()?void 0:m,onClick:v?void 0:y},t.children)}),zx=g.forwardRef((t,e)=>{let{heading:r,children:n,forceMount:o,...s}=t,i=dt(),a=g.useRef(null),l=g.useRef(null),c=dt(),u=io(),d=vr(p=>o||u.filter()===!1?!0:p.search?p.filtered.groups.has(i):!0);yr(()=>u.group(i),[]),Rf(i,a,[t.value,t.heading,l]);let f=g.useMemo(()=>({id:i,forceMount:o}),[o]);return g.createElement(be.div,{ref:Xn([a,e]),...s,"cmdk-group":"",role:"presentation",hidden:d?void 0:!0},r&&g.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:c},r),bs(t,p=>g.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?c:void 0},g.createElement(Pf.Provider,{value:f},p))))}),Mx=g.forwardRef((t,e)=>{let{alwaysRender:r,...n}=t,o=g.useRef(null),s=vr(i=>!i.search);return!r&&!s?null:g.createElement(be.div,{ref:Xn([o,e]),...n,"cmdk-separator":"",role:"separator"})}),Dx=g.forwardRef((t,e)=>{let{onValueChange:r,...n}=t,o=t.value!=null,s=il(),i=vr(u=>u.search),a=vr(u=>u.value),l=io(),c=g.useMemo(()=>{var u;let d=(u=l.listInnerRef.current)==null?void 0:u.querySelector(`${sl}[${sr}="${encodeURIComponent(a)}"]`);return d?.getAttribute("id")},[]);return g.useEffect(()=>{t.value!=null&&s.setState("search",t.value)},[t.value]),g.createElement(be.input,{ref:e,...n,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":c,id:l.inputId,type:"text",value:o?t.value:i,onChange:u=>{o||s.setState("search",u.target.value),r?.(u.target.value)}})}),Lx=g.forwardRef((t,e)=>{let{children:r,label:n="Suggestions",...o}=t,s=g.useRef(null),i=g.useRef(null),a=io();return g.useEffect(()=>{if(i.current&&s.current){let l=i.current,c=s.current,u,d=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let f=l.offsetHeight;c.style.setProperty("--cmdk-list-height",f.toFixed(1)+"px")})});return d.observe(l),()=>{cancelAnimationFrame(u),d.unobserve(l)}}},[]),g.createElement(be.div,{ref:Xn([s,e]),...o,"cmdk-list":"",role:"listbox","aria-label":n,id:a.listId},bs(t,l=>g.createElement("div",{ref:Xn([i,a.listInnerRef]),"cmdk-list-sizer":""},l)))}),Bx=g.forwardRef((t,e)=>{let{open:r,onOpenChange:n,overlayClassName:o,contentClassName:s,container:i,...a}=t;return g.createElement(Ex,{open:r,onOpenChange:n},g.createElement(Px,{container:i},g.createElement(Ax,{"cmdk-overlay":"",className:o}),g.createElement(Tx,{"aria-label":t.label,"cmdk-dialog":"",className:s},g.createElement(Af,{ref:e,...a}))))}),Fx=g.forwardRef((t,e)=>vr(r=>r.filtered.count===0)?g.createElement(be.div,{ref:e,...t,"cmdk-empty":"",role:"presentation"}):null),Ux=g.forwardRef((t,e)=>{let{progress:r,children:n,label:o="Loading...",...s}=t;return g.createElement(be.div,{ref:e,...s,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},bs(t,i=>g.createElement("div",{"aria-hidden":!0},i)))}),Fe=Object.assign(Af,{List:Lx,Item:Nx,Input:Dx,Group:zx,Separator:Mx,Dialog:Bx,Empty:Fx,Loading:Ux});function Hx(t,e){let r=t.nextElementSibling;for(;r;){if(r.matches(e))return r;r=r.nextElementSibling}}function Wx(t,e){let r=t.previousElementSibling;for(;r;){if(r.matches(e))return r;r=r.previousElementSibling}}function Tf(t){let e=g.useRef(t);return yr(()=>{e.current=t}),e}var yr=typeof window>"u"?g.useEffect:g.useLayoutEffect;function Wr(t){let e=g.useRef();return e.current===void 0&&(e.current=t()),e}function Xn(t){return e=>{t.forEach(r=>{typeof r=="function"?r(e):r!=null&&(r.current=e)})}}function vr(t){let e=il(),r=()=>t(e.snapshot());return Ox.useSyncExternalStore(e.subscribe,r,r)}function Rf(t,e,r,n=[]){let o=g.useRef(),s=io();return yr(()=>{var i;let a=(()=>{var c;for(let u of r){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(c=u.current.textContent)==null?void 0:c.trim():o.current}})(),l=n.map(c=>c.trim());s.value(t,a,l),(i=e.current)==null||i.setAttribute(sr,a),o.current=a}),o}var Gx=()=>{let[t,e]=g.useState(),r=Wr(()=>new Map);return yr(()=>{r.current.forEach(n=>n()),r.current=new Map},[t]),(n,o)=>{r.current.set(n,o),e({})}};function qx(t){let e=t.type;return typeof e=="function"?e(t.props):"render"in e?e.render(t.props):t}function bs({asChild:t,children:e},r){return t&&g.isValidElement(e)?g.cloneElement(qx(e),{ref:e.ref},r(e.props.children)):r(e)}var Vx={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const If=g.forwardRef(({className:t,...e},r)=>h.jsx(Fe,{ref:r,className:Pe("flex h-full w-full flex-col overflow-hidden bg-metallicBlue text-popover-foreground",t),...e}));If.displayName=Fe.displayName;const Of=g.forwardRef(({className:t,...e},r)=>h.jsxs("div",{className:"flex items-center border-b px-1 pb-1","cmdk-input-wrapper":"",children:[h.jsx("span",{className:"sprite mr-1 texture-hud_char_gt"}),h.jsx(Fe.Input,{ref:r,className:Pe("flex h-1 w-full bg-pastelBlue py-1 outline-none placeholder:text-shadow disabled:cursor-not-allowed",t),...e})]}));Of.displayName=Fe.Input.displayName;const jf=g.forwardRef(({className:t,...e},r)=>h.jsx(Fe.List,{ref:r,className:Pe("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...e}));jf.displayName=Fe.List.displayName;const $f=g.forwardRef((t,e)=>h.jsx(Fe.Empty,{ref:e,className:"pl-1",...t}));$f.displayName=Fe.Empty.displayName;const Nf=g.forwardRef(({className:t,...e},r)=>h.jsx(Fe.Group,{ref:r,className:Pe("overflow-hidden",t),...e}));Nf.displayName=Fe.Group.displayName;const Kx=g.forwardRef(({className:t,...e},r)=>h.jsx(Fe.Separator,{ref:r,className:Pe("-mx-1 h-px bg-shadow",t),...e}));Kx.displayName=Fe.Separator.displayName;const ws=g.forwardRef(({className:t,...e},r)=>h.jsx(Fe.Item,{ref:r,className:Pe("relative flex cursor-default select-none items-center text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-midRed hover:bg-pastelBlue data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...e}));ws.displayName=Fe.Item.displayName;const Et=g.forwardRef(({className:t,selected:e,disabled:r=!1,onClick:n,...o},s)=>h.jsx("button",{disabled:r,onClick:n,"data-selected":e,className:Pe(`inline-flex items-center justify-center whitespace-nowrap 
          bg-metallicBlue zx:bg-zxBlue border-none border-shadow
          gap-2
           disabled:bg-midGrey disabled:text-lightGrey 
           data-[selected=true]:bg-lightBeige
           [&:not(:disabled):hover:not([data-selected=true])]:bg-pastelBlue 
           `,t),ref:s,...o}));Et.displayName="Button";var Cc=!1,ir,ea,ta,Uo,Ho,zf,Wo,ra,na,oa,Mf,sa,ia,Df,Lf;function Ne(){if(!Cc){Cc=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),r=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(sa=/\b(iPhone|iP[ao]d)/.exec(t),ia=/\b(iP[ao]d)/.exec(t),oa=/Android/i.exec(t),Df=/FBAN\/\w+;/i.exec(t),Lf=/Mobile/i.exec(t),Mf=!!/Win64/.exec(t),e){ir=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN,ir&&document&&document.documentMode&&(ir=document.documentMode);var n=/(?:Trident\/(\d+.\d+))/.exec(t);zf=n?parseFloat(n[1])+4:ir,ea=e[2]?parseFloat(e[2]):NaN,ta=e[3]?parseFloat(e[3]):NaN,Uo=e[4]?parseFloat(e[4]):NaN,Uo?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),Ho=e&&e[1]?parseFloat(e[1]):NaN):Ho=NaN}else ir=ea=ta=Ho=Uo=NaN;if(r){if(r[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);Wo=o?parseFloat(o[1].replace("_",".")):!0}else Wo=!1;ra=!!r[2],na=!!r[3]}else Wo=ra=na=!1}}var aa={ie:function(){return Ne()||ir},ieCompatibilityMode:function(){return Ne()||zf>ir},ie64:function(){return aa.ie()&&Mf},firefox:function(){return Ne()||ea},opera:function(){return Ne()||ta},webkit:function(){return Ne()||Uo},safari:function(){return aa.webkit()},chrome:function(){return Ne()||Ho},windows:function(){return Ne()||ra},osx:function(){return Ne()||Wo},linux:function(){return Ne()||na},iphone:function(){return Ne()||sa},mobile:function(){return Ne()||sa||ia||oa||Lf},nativeApp:function(){return Ne()||Df},android:function(){return Ne()||oa},ipad:function(){return Ne()||ia}},Xx=aa,Jx=!!(typeof window<"u"&&window.document&&window.document.createElement),Yx={canUseDOM:Jx},Bf=Yx,Ff;Bf.canUseDOM&&(Ff=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);function Zx(t,e){if(!Bf.canUseDOM||e&&!("addEventListener"in document))return!1;var r="on"+t,n=r in document;if(!n){var o=document.createElement("div");o.setAttribute(r,"return;"),n=typeof o[r]=="function"}return!n&&Ff&&t==="wheel"&&(n=document.implementation.hasFeature("Events.wheel","3.0")),n}var Qx=Zx,Ec=10,Pc=40,Ac=800;function Uf(t){var e=0,r=0,n=0,o=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),n=e*Ec,o=r*Ec,"deltaY"in t&&(o=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||o)&&t.deltaMode&&(t.deltaMode==1?(n*=Pc,o*=Pc):(n*=Ac,o*=Ac)),n&&!e&&(e=n<1?-1:1),o&&!r&&(r=o<1?-1:1),{spinX:e,spinY:r,pixelX:n,pixelY:o}}Uf.getEventType=function(){return Xx.firefox()?"DOMMouseScroll":Qx("wheel")?"wheel":"mousewheel"};var e0=Uf;/**
* Checks if an event is supported in the current execution environment.
*
* NOTE: This will not work correctly for non-generic events such as `change`,
* `reset`, `load`, `error`, and `select`.
*
* Borrows from Modernizr.
*
* @param {string} eventNameSuffix Event name, e.g. "click".
* @param {?boolean} capture Check if the capture phase is supported.
* @return {boolean} True if the event is supported.
* @internal
* @license Modernizr 3.0.0pre (Custom Build) | MIT
*/const t0=(t,e,r=!1)=>{const n=g.useRef(0),o=g.useCallback(s=>{if(r)return;const i=s;i.preventDefault(),i.stopPropagation();const a=e0(i);n.current-=a.spinY,n.current>=1&&(e(1),n.current=0),n.current<=-1&&(e(-1),n.current=0)},[e,r]);g.useEffect(()=>{const s=t.current;if(s!==null)return s.addEventListener("wheel",o,{passive:!1}),()=>{s.removeEventListener("wheel",o)}},[t,o])},Hf=(t,e,r,n=!1)=>{const o=g.useRef(0);return t0(t,s=>{if(e.length===0)return;const i=(o.current+s+256*e.length)%e.length;o.current=i,r(e[i],i)},n)},r0=({value:t,onSelect:e})=>h.jsx(ws,{value:t,onSelect:e,className:"px-1",children:h.jsx(H,{children:t})}),xs=t=>{const{value:e,values:r,onSelect:n,triggerButtonClassName:o="",triggerButtonStyle:s=le,triggerButtonLabel:i="",OptionCommandItem:a=r0}=t,[l,c]=g.useState(!1),u=g.useRef(null);return Hf(u,r,d=>{n(d)},!l),h.jsxs(cf,{open:l,onOpenChange:c,children:[h.jsx(uf,{asChild:!0,children:h.jsxs(Et,{className:Pe("h-2 px-1 flex flex-row gap-1 justify-start leading-none",o),style:s,ref:u,children:[typeof i=="string"?h.jsx(H,{className:"grow overflow-hidden text-left",children:i}):i,h.jsx(H,{className:"grow-0",children:l?"X":"⬇"})]})}),h.jsx(df,{className:"p-0",children:h.jsx(el,{scaleFactor:2,children:h.jsxs(If,{value:e,onValueChange:d=>n(d),className:"w-[--radix-popper-anchor-width]",children:[t.disableCommandInput===!0?null:h.jsx(Of,{placeholder:t.placeholder}),h.jsxs(jf,{children:[h.jsx($f,{children:h.jsx(H,{children:"Nothing found"})}),h.jsx(Nf,{children:r.map(d=>h.jsx(a,{value:d,onSelect:f=>{c(!1),n(f)}},d))})]})]})})})]})},n0=()=>{const t=Be(),e=vd();return h.jsx(h.Fragment,{children:h.jsx(xs,{value:e,values:$g,onSelect:r=>{t(Ng(r))},disableCommandInput:!0,triggerButtonLabel:e,triggerButtonClassName:"w-13"})})};function Wf({campaign:t,onSelect:e,headRoomId:r,heelsRoomId:n,value:o,triggerButtonClassName:s,excludeRoomIds:i=[]}){const a=Object.keys(t.rooms).filter(l=>!i.includes(l));return h.jsx(xs,{onSelect:l=>e?.(l),value:o,values:a,triggerButtonClassName:s,placeholder:"search",disableCommandInput:!1,triggerButtonLabel:o??"none",OptionCommandItem:({value:l})=>h.jsxs(ws,{value:l,className:"px-1",children:[r===l&&h.jsx("span",{className:"sprite mr-1 my-1 texture-head_walking_towards_2"}),n===l&&h.jsx("span",{className:"sprite mr-1 my-1 texture-heels_walking_towards_2"}),h.jsx(H,{children:l})]})})}const F={w:16,d:16,h:12},Tc={x:16,y:16,z:12},ge=t=>t,Gf="h-[calc(3*var(--block)-1px*var(--scale))] w-[calc(3*var(--block)-1px*var(--scale))]",o0="h-[calc(2*var(--block)-1px*var(--scale))] w-[calc(2*var(--block)-1px*var(--scale))]",U=ge("[button:not([data-selected=true]):not(:hover)_&]:sprite-revert-to-two-tone-dim"),Ae=ge("flex flex-wrap gap-oneScaledPix w-full"),s0=/^(?<modifiers>[⇧⌘^]*)(?<key>.+)$/,i0=t=>{const e=new Set;for(const r of t){if(e.has(r))return!0;e.add(r)}return!1},qf=(t,e,r)=>{const n=t?.join(" ");g.useEffect(()=>{if(!t||t.length===0)return;const o=s=>{if(s.target.closest(".monaco-editor")===null)for(const l of t){const c=l.match(s0);if(!c||!c.groups)continue;const{modifiers:u,key:d}=c.groups;if(i0(u)){console.warn(`Invalid shortcut "${l}": duplicate modifiers`);continue}const f=u.includes("^"),p=u.includes("⌘"),y=u.includes("⇧"),m=f||p||y,v=f===s.ctrlKey&&p===s.metaKey&&y===s.shiftKey&&(m||!s.ctrlKey&&!s.metaKey&&!s.shiftKey);if(s.key.toLowerCase()===d.toLowerCase()&&v){e||r?.(),s.preventDefault();break}}};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e,r,n])},ve=({className:t,onClick:e,children:r,disabled:n=!1,isCurrentTool:o=!1,shortcutKeys:s,small:i=!1})=>(qf(s,n,e),h.jsx(Et,{disabled:n,selected:o,className:`
        ${i?o0:Gf} 
        active:pt-oneScaledPix gap-0 inline-flex overflow-hidden 
        
        ${t??""}`,onClick:e,children:r})),a0=()=>{const t=de(e=>e.levelEditor.selectedJsonItemIds.length>0);return h.jsx(ve,{className:"bg-midRed",disabled:!t,onClick:()=>L.dispatch(gm()),shortcutKeys:["Delete","Backspace"],children:h.jsx("span",{className:"sprite sprite-tinted texture-hud_char_X relative"})})},br=({className:t,value:e,onChange:r,trueLabel:n="ON",falseLabel:o="OFF",label:s,shortcutKeys:i})=>{const a=Math.max(n.length,o.length)+1,l=n.padStart(a," "),c=o.padEnd(a," ");return qf(i,!1,()=>{r?.(!e,void 0)}),h.jsxs("span",{onClick:u=>r?.(!e,u),className:Pe("inline-flex justify-between",t),children:[s&&h.jsx(H,{className:"inline-block mr-1 text-lightGrey",noSlitWords:!0,children:s}),h.jsx(H,{className:lf("inline-block w-min h-min",e?"bg-shadowHalfbrite text-moss zx:bg-zxBlack zx:text-zxGreen":"bg-redShadowHalfbrite text-midRed zx:bg-zxBlack zx:text-zxRed"),noSlitWords:!0,children:e?l:c})]})},l0=({className:t})=>{const e=Be();return h.jsx(br,{className:t,label:"snap",value:de(r=>r.levelEditor.halfGridResolution),onChange:r=>{e(mm(r))},falseLabel:"Block",trueLabel:"Half",shortcutKeys:["S"]})},Vf=t=>{const e=de(cr);return Ue(e?.type==="item"&&e.item,t)},j=({itemTool:t,children:e,className:r,shortcutKeys:n})=>{const o=Vf(t);return h.jsx(ve,{isCurrentTool:o,className:r,onClick:()=>L.dispatch(fr({type:"item",item:t})),shortcutKeys:n,children:e})},al=({main:t,children:e,closeOnSelect:r,ref:n})=>{const[o,s]=g.useState(!1);return h.jsxs(cf,{open:o,onOpenChange:s,children:[h.jsx("div",{ref:n,className:Pe(Gf,"relative",{"drop-shadow-oneBlock z-popups":o}),children:h.jsxs("span",{className:"content",children:[t,h.jsx(uf,{asChild:!0,children:h.jsx(Et,{className:"absolute bottom-0 right-0 bg-metallicBlueHalfbrite",children:h.jsx(H,{className:"pl-oneScaledPix leading-none py-oneScaledPix",children:o?"X":"⬇"})})})]})}),h.jsx(df,{children:h.jsx(el,{scaleFactor:2,children:h.jsx("div",{className:"flex flex-col gap-oneScaledPix py-oneScaledPix bg-metallicBlueHalfbrite",children:e.map((i,a)=>i===null?null:h.jsx("div",{className:"leading-none",onClick:()=>{r&&s(!1)},children:i},a))})})})]})},Tn=({children:t})=>{const[e,r]=g.useState(0),n=g.useRef(null);Hf(n,t,(s,i)=>{r(i)});const o=t[e];return h.jsx(al,{main:o,closeOnSelect:!0,ref:n,children:t.map((s,i)=>i===e?null:h.jsx("div",{className:"leading-none",onClick:()=>{r(i)},children:s},i))})},c0=()=>{const e=de(cr)?.type==="pointer";return h.jsx(ve,{onClick:()=>L.dispatch(fr({type:"pointer"})),isCurrentTool:e,shortcutKeys:["Escape","."],children:h.jsx("span",{className:"sprite texture-editor_tool_pointer relative"})})},$={pureBlack:new G("#000000"),shadow:new G("#325149"),midGrey:new G("#7F7773"),lightGrey:new G("#BBB1AB"),white:new G("#FBFEFB"),pastelBlue:new G("#75ACFF"),metallicBlue:new G("#366CAA"),pink:new G("#D68ED1"),moss:new G("#9E9600"),redShadow:new G("#805E50"),midRed:new G("#CA7463"),lightBeige:new G("#DAA78F"),highlightBeige:new G("#EBC690"),alpha:new G("#1E7790"),replaceLight:new G("#08A086"),replaceDark:new G("#0A4730")},Bn=.33,Kf=t=>{const[e,r,n]=t.toUint8RgbArray();return new G({r:e*.75,g:r*.75,b:n*.75})},dn=(t,e=Bn)=>{const[r,n,o]=t.toUint8RgbArray();return new G({r:r*e,g:n*e,b:o*e})};function vA(t){t=t.replace(/^#/,"");let e=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),n=parseInt(t.substring(4,6),16);e=Math.floor(e*Bn),r=Math.floor(r*Bn),n=Math.floor(n*Bn);const o=s=>s.toString(16).padStart(2,"0");return`#${o(e)}${o(r)}${o(n)}`}const Ye={original:new G(yn.zxWhite),basic:$.white,dimmed:$.lightGrey},Ze={original:new G(yn.zxYellow),basic:new G(15654246),dimmed:dn(new G(15654246),.5)},Xf={original:new G(yn.zxYellow),basic:$.midRed,dimmed:$.redShadow},at={original:new G(yn.zxMagenta),basic:$.pink,dimmed:dn($.pink,.5)},xe={original:new G(yn.zxCyan),basic:$.pastelBlue,dimmed:dn($.pastelBlue,.5)},lt={original:new G(yn.zxGreen),basic:$.moss,dimmed:dn($.moss,.5)},_s={white:{basic:{main:Ye,edges:{towards:{...xe,dimInOriginal:!1},right:{...Ze,dimInOriginal:!0}},hud:{lives:Ze,dimmed:at,icons:xe}},dimmed:{main:Ye,edges:{towards:{...lt,dimInOriginal:!1},right:{...xe,dimInOriginal:!0}},hud:{lives:Xf,dimmed:at,icons:xe}}},yellow:{basic:{main:Ze,edges:{towards:{...lt,dimInOriginal:!1},right:{...Ye,dimInOriginal:!0}},hud:{lives:xe,dimmed:at,icons:lt}},dimmed:{main:Ze,edges:{towards:{...xe,dimInOriginal:!0},right:{...xe,dimInOriginal:!1}},hud:{lives:xe,dimmed:at,icons:lt}}},magenta:{basic:{main:at,edges:{towards:{...lt,dimInOriginal:!0},right:{...xe,dimInOriginal:!0}},hud:{lives:Ye,dimmed:xe,icons:Ze}},dimmed:{main:at,edges:{towards:{...lt,dimInOriginal:!0},right:{...xe,dimInOriginal:!0}},hud:{lives:Ye,dimmed:xe,icons:Ze}}},cyan:{basic:{main:xe,edges:{towards:{...at,dimInOriginal:!1},right:{...Ye,dimInOriginal:!1}},hud:{lives:Ye,dimmed:lt,icons:Ze}},dimmed:{main:xe,edges:{towards:{...at,dimInOriginal:!0},right:{...Ye,dimInOriginal:!0}},hud:{lives:Ye,dimmed:lt,icons:Ze}}},green:{basic:{main:lt,edges:{towards:{...xe,dimInOriginal:!1},right:{...Ze,dimInOriginal:!1}},hud:{lives:Ye,dimmed:at,icons:xe}},dimmed:{main:lt,edges:{towards:{...xe,dimInOriginal:!0},right:{...Ze,dimInOriginal:!0}},hud:{lives:Ye,dimmed:at,icons:xe}}}},is=t=>_s[t.hue][t.shade],Jr={head:$.pastelBlue,heels:$.pink},Rc=t=>{const{main:e}=_s[t].basic;return{backgroundColor:e.basic.toHex(),borderColor:e.dimmed.toHex()}};function u0(){const t=Be(),e=de(ym);return h.jsxs(h.Fragment,{children:[h.jsx(xs,{value:e.hue,onSelect:r=>{t(El({hue:r}))},values:zg,disableCommandInput:!0,OptionCommandItem:({value:r,onSelect:n})=>h.jsx(ws,{value:r,className:"border-l-3 h-2 w-full p-0",style:Rc(r),onSelect:n}),triggerButtonLabel:"colour",triggerButtonClassName:Pe("w-full",`${e.hue==="white"||e.hue==="yellow"?"text-pureBlack":"text-white"}`),triggerButtonStyle:Rc(e.hue)}),h.jsx(br,{className:"",label:"shade",value:e.shade==="basic",onChange:r=>{t(El({shade:r?"basic":"dimmed"}))},falseLabel:"dim",trueLabel:"basic"})]})}function d0(){const t=Be(),e=de(vm);return h.jsx(xs,{value:e,onSelect:r=>{t(bm(r))},values:Mg,placeholder:"scenery",triggerButtonClassName:"w-full",triggerButtonLabel:e})}const wt=({iconClasses:t,text:e,className:r=""})=>h.jsxs("div",{className:`relative w-full h-full ${r}`,children:[h.jsx("span",{className:`sprite absolute top-0 left-0 ${t} ${U}`}),h.jsx(H,{className:"bg-moss text-pureBlack absolute top-0 left-0 pl-oneScaledPix py-oneScaledPix block leading-none",children:e})]}),Ao=({iconClassName:t})=>h.jsx(xt,{topClasses:ge("texture-bubbles_white_2 [button:hover_&]:texture-animated-bubbles_white"),bottomClasses:t}),xt=({topClasses:t,bottomClasses:e="texture-headlessBase"})=>h.jsxs("div",{className:"relative w-full h-full",children:[h.jsx("span",{className:`sprite absolute top-[calc(9px*var(--scale))] left-0 ${e} ${U}`}),h.jsx("span",{className:`sprite absolute top-[calc(-3px*var(--scale))] left-0 ${t} ${U}`})]}),h0="[button:not(:disabled):hover_&]:hidden",f0="hidden [button:not(:disabled):hover_&]:inline mt-quarter",p0="hidden [button:not(:disabled):hover_&]:inline",Jn=({icon:t,topText:e,bottomText:r})=>h.jsxs("span",{className:"w-full h-full flex flex-col items-center justify-center",children:[h.jsx("span",{className:h0,children:t}),h.jsx(H,{className:f0,children:e}),h.jsx(H,{className:p0,children:r})]}),g0=()=>{const t=Be(),e=de(wm),r=de(xm);return h.jsxs("div",{className:"flex flex-row gap-oneScaledPix bg-metallicBlue",children:[h.jsx(ve,{disabled:!e,onClick:()=>{t(_m())},shortcutKeys:["⌘Z","^Z"],children:h.jsx(Jn,{icon:h.jsx(H,{children:"⬅"}),topText:"un",bottomText:"do"})}),h.jsx(ve,{disabled:!r,onClick:()=>{t(Sm())},shortcutKeys:["⌘⇧Z","^⇧Z"],children:h.jsx(Jn,{icon:h.jsx(H,{children:"➡"}),topText:"re",bottomText:"do"})})]})},m0=({className:t})=>{const e=Be();return h.jsx(br,{className:t,label:"scenery",value:de(r=>r.levelEditor.wallsFloorsLocked),onChange:r=>{e(km(r))},falseLabel:"edit",trueLabel:"lock",shortcutKeys:["C"]})};function Ic(t){return{type:"door",config:{direction:"away",toRoom:t?"+":"nowhere"}}}const y0=()=>{const[t,e]=g.useState(!0),r=de(i=>an(i).planet),n=ge(r==="moonbase"?"texture-door_frame_moonbase_x_whole":"texture-door_frame_generic_x_whole"),o=Ic(t),s=Vf(o);return h.jsx(al,{main:h.jsx(j,{itemTool:o,shortcutKeys:["D"],children:h.jsx(wt,{iconClasses:`sprite top-[calc(-17px*var(--scale))] left-[calc(-2px*var(--scale))] ${n} ${U}`,text:t?"+":""})}),children:[h.jsx(br,{className:"w-full",value:t,label:"auto + room",onChange:i=>{e(i),s&&L.dispatch(fr({type:"item",item:Ic(i)}))}},"autoAddDoor")]})},v0=()=>{const t=de(n=>an(n).planet),e={type:"wall",config:{direction:"away",tiles:Array.from(Cm(t,1))}},r=ge(t==="blacktooth"?"texture-blacktooth_wall_plain_away":t==="bookworld"?"texture-bookworld_wall_cowboy_away":t==="jail"?"texture-jail_wall_bars_away":t==="egyptus"?"texture-egyptus_wall_hieroglyphics_away":t==="market"?"texture-market_wall_passage_away":t==="moonbase"?"texture-moonbase_wall_window1_away":t==="penitentiary"?"texture-penitentiary_wall_loop_away":"texture-safari_wall_wall_away");return h.jsx(j,{itemTool:e,children:h.jsx("span",{className:`sprite ${r} ${U}`})})},b0=()=>h.jsx(ve,{className:"bg-midRed",onClick:()=>L.dispatch(Em()),children:h.jsx(H,{className:"relative leading-none",children:"CLR"})}),Jf=({currentRoomId:t,direction:e})=>{const r=de(({levelEditor:s})=>s.campaignInProgress),n=de(({levelEditor:s})=>s.currentlyEditingRoomId),o=Be();return h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap pt-1",children:[h.jsxs(H,{className:"text-lightGrey leading-none",children:["Room ",e==="roomAbove"?"⬆":"⬇"]}),h.jsx("div",{className:"flex-grow"}),h.jsxs("div",{className:"flex flex-row gap-oneScaledPix",children:[h.jsx(Et,{className:"w-2 leading-none bg-moss",children:h.jsx(H,{onClick:()=>o(Ns({direction:e,createNew:!0})),children:"+"})}),h.jsx(Et,{className:"w-2 leading-none bg-midRed",children:h.jsx(H,{onClick:()=>o(Ns({direction:e,createNew:!1,roomId:void 0})),children:"x"})})]})]}),h.jsx("div",{className:"flex flex-row gap-oneScaledPix w-full flex-wrap",children:h.jsx(Wf,{value:t,campaign:r,excludeRoomIds:[n],triggerButtonClassName:"w-full",onSelect:s=>{o(Ns({direction:e,createNew:!1,roomId:s}))}})})]})},w0=()=>{const t=de(({levelEditor:e})=>Pd(e).roomAbove);return h.jsx(h.Fragment,{children:h.jsx(Jf,{currentRoomId:t,direction:"roomAbove"})})},x0=()=>{const t=de(({levelEditor:e})=>Pd(e).roomBelow);return h.jsx(h.Fragment,{children:h.jsx(Jf,{currentRoomId:t,direction:"roomBelow"})})},_0=()=>{const t=de(({levelEditor:e})=>e.tool.type==="eyeDropper");return h.jsx(ve,{shortcutKeys:["I",","],isCurrentTool:t,onClick:()=>L.dispatch(fr({type:"eyeDropper"})),children:h.jsx("span",{className:"relative sprite texture-editor_tool_eyedropper leading-none"})})},Ss=typeof Buffer=="function";typeof TextDecoder=="function"&&new TextDecoder;typeof TextEncoder=="function"&&new TextEncoder;const S0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",jn=Array.prototype.slice.call(S0),To=(t=>{let e={};return t.forEach((r,n)=>e[r]=n),e})(jn),k0=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Go=String.fromCharCode.bind(String),Oc=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),C0=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),Yf=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),E0=t=>{let e,r,n,o,s="";const i=t.length%3;for(let a=0;a<t.length;){if((r=t.charCodeAt(a++))>255||(n=t.charCodeAt(a++))>255||(o=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=r<<16|n<<8|o,s+=jn[e>>18&63]+jn[e>>12&63]+jn[e>>6&63]+jn[e&63]}return i?s.slice(0,i-3)+"===".substring(i):s},P0=typeof btoa=="function"?t=>btoa(t):Ss?t=>Buffer.from(t,"binary").toString("base64"):E0,jc=Ss?t=>Buffer.from(t).toString("base64"):t=>{let r=[];for(let n=0,o=t.length;n<o;n+=4096)r.push(Go.apply(null,t.subarray(n,n+4096)));return P0(r.join(""))},A0=(t,e=!1)=>e?C0(jc(t)):jc(t),T0=t=>{if(t=t.replace(/\s+/g,""),!k0.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,r="",n,o;for(let s=0;s<t.length;)e=To[t.charAt(s++)]<<18|To[t.charAt(s++)]<<12|(n=To[t.charAt(s++)])<<6|(o=To[t.charAt(s++)]),r+=n===64?Go(e>>16&255):o===64?Go(e>>16&255,e>>8&255):Go(e>>16&255,e>>8&255,e&255);return r},R0=typeof atob=="function"?t=>atob(Yf(t)):Ss?t=>Buffer.from(t,"base64").toString("binary"):T0,I0=Ss?t=>Oc(Buffer.from(t,"base64")):t=>Oc(R0(t).split("").map(e=>e.charCodeAt(0))),O0=t=>I0(j0(t)),j0=t=>Yf(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),$0=!0,Zf="gzip",Qf=async t=>{const e=JSON.stringify(t),n=new TextEncoder().encode(e),o=new Blob([n]),s=new CompressionStream(Zf),i=o.stream().pipeThrough(s),a=await new Response(i).arrayBuffer(),l=new Uint8Array(a);return A0(l,$0)},N0=async t=>{try{const e=O0(t),r=new Blob([e]),n=new DecompressionStream(Zf),o=r.stream().pipeThrough(n),s=await new Response(o).text();return JSON.parse(s)}catch(e){throw new Error("error decompressing object",{cause:e})}},z0=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Ht(async()=>{const{default:n}=await Promise.resolve().then(()=>_n);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)};class ll extends Error{constructor(e,r="FunctionsError",n){super(e),this.name=r,this.context=n}}class M0 extends ll{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class $c extends ll{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Nc extends ll{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var la;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(la||(la={}));var D0=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class L0{constructor(e,{headers:r={},customFetch:n,region:o=la.Any}={}){this.url=e,this.headers=r,this.region=o,this.fetch=z0(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,r={}){var n;return D0(this,void 0,void 0,function*(){try{const{headers:o,method:s,body:i}=r;let a={},{region:l}=r;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(a["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(a["Content-Type"]="application/json",u=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:u}).catch(m=>{throw new M0(m)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new $c(d);if(!d.ok)throw new Nc(d);let p=((n=d.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),y;return p==="application/json"?y=yield d.json():p==="application/octet-stream"?y=yield d.blob():p==="text/event-stream"?y=d:p==="multipart/form-data"?y=yield d.formData():y=yield d.text(),{data:y,error:null,response:d}}catch(o){return{data:null,error:o,response:o instanceof Nc||o instanceof $c?o.context:void 0}}})}}var _e={},Ir={},Or={},jr={},$r={},Nr={},B0=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},hn=B0();const F0=hn.fetch,ep=hn.fetch.bind(hn),tp=hn.Headers,U0=hn.Request,H0=hn.Response,_n=Object.freeze(Object.defineProperty({__proto__:null,Headers:tp,Request:U0,Response:H0,default:ep,fetch:F0},Symbol.toStringTag,{value:"Module"})),W0=Dg(_n);var Ro={},zc;function rp(){if(zc)return Ro;zc=1,Object.defineProperty(Ro,"__esModule",{value:!0});class t extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return Ro.default=t,Ro}var Mc;function np(){if(Mc)return Nr;Mc=1;var t=Nr&&Nr.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Nr,"__esModule",{value:!0});const e=t(W0),r=t(rp());class n{constructor(s){this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=s.headers,this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=s.shouldThrowOnError,this.signal=s.signal,this.isMaybeSingle=s.isMaybeSingle,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=Object.assign({},this.headers),this.headers[s]=i,this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,f;let p=null,y=null,m=null,v=c.status,b=c.statusText;if(c.ok){if(this.method!=="HEAD"){const k=await c.text();k===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?y=k:y=JSON.parse(k))}const w=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),x=(d=c.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");w&&x&&x.length>1&&(m=parseInt(x[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(y)&&(y.length>1?(p={code:"PGRST116",details:`Results contain ${y.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},y=null,m=null,v=406,b="Not Acceptable"):y.length===1?y=y[0]:y=null)}else{const w=await c.text();try{p=JSON.parse(w),Array.isArray(p)&&c.status===404&&(y=[],p=null,v=200,b="OK")}catch{c.status===404&&w===""?(v=204,b="No Content"):p={message:w}}if(p&&this.isMaybeSingle&&(!((f=p?.details)===null||f===void 0)&&f.includes("0 rows"))&&(p=null,v=200,b="OK"),p&&this.shouldThrowOnError)throw new r.default(p)}return{error:p,data:y,count:m,status:v,statusText:b}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,f;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(d=c?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(f=c?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,i)}returns(){return this}overrideTypes(){return this}}return Nr.default=n,Nr}var Dc;function op(){if(Dc)return $r;Dc=1;var t=$r&&$r.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty($r,"__esModule",{value:!0});const e=t(np());class r extends e.default{select(o){let s=!1;const i=(o??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(o,{ascending:s=!0,nullsFirst:i,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${o}.${s?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:s,referencedTable:i=s}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${o}`),this}range(o,s,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${o}`),this.url.searchParams.set(c,`${s-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:o=!1,verbose:s=!1,settings:i=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[o?"analyze":null,s?"verbose":null,i?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${f}"; options=${d};`,c==="json"?this:this}rollback(){var o;return((o=this.headers.Prefer)!==null&&o!==void 0?o:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return $r.default=r,$r}var Lc;function cl(){if(Lc)return jr;Lc=1;var t=jr&&jr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(jr,"__esModule",{value:!0});const e=t(op());class r extends e.default{eq(o,s){return this.url.searchParams.append(o,`eq.${s}`),this}neq(o,s){return this.url.searchParams.append(o,`neq.${s}`),this}gt(o,s){return this.url.searchParams.append(o,`gt.${s}`),this}gte(o,s){return this.url.searchParams.append(o,`gte.${s}`),this}lt(o,s){return this.url.searchParams.append(o,`lt.${s}`),this}lte(o,s){return this.url.searchParams.append(o,`lte.${s}`),this}like(o,s){return this.url.searchParams.append(o,`like.${s}`),this}likeAllOf(o,s){return this.url.searchParams.append(o,`like(all).{${s.join(",")}}`),this}likeAnyOf(o,s){return this.url.searchParams.append(o,`like(any).{${s.join(",")}}`),this}ilike(o,s){return this.url.searchParams.append(o,`ilike.${s}`),this}ilikeAllOf(o,s){return this.url.searchParams.append(o,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(o,s){return this.url.searchParams.append(o,`ilike(any).{${s.join(",")}}`),this}is(o,s){return this.url.searchParams.append(o,`is.${s}`),this}in(o,s){const i=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(o,`in.(${i})`),this}contains(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cs.{${s.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(s)}`),this}containedBy(o,s){return typeof s=="string"?this.url.searchParams.append(o,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(o,`cd.{${s.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(s)}`),this}rangeGt(o,s){return this.url.searchParams.append(o,`sr.${s}`),this}rangeGte(o,s){return this.url.searchParams.append(o,`nxl.${s}`),this}rangeLt(o,s){return this.url.searchParams.append(o,`sl.${s}`),this}rangeLte(o,s){return this.url.searchParams.append(o,`nxr.${s}`),this}rangeAdjacent(o,s){return this.url.searchParams.append(o,`adj.${s}`),this}overlaps(o,s){return typeof s=="string"?this.url.searchParams.append(o,`ov.${s}`):this.url.searchParams.append(o,`ov.{${s.join(",")}}`),this}textSearch(o,s,{config:i,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=i===void 0?"":`(${i})`;return this.url.searchParams.append(o,`${l}fts${c}.${s}`),this}match(o){return Object.entries(o).forEach(([s,i])=>{this.url.searchParams.append(s,`eq.${i}`)}),this}not(o,s,i){return this.url.searchParams.append(o,`not.${s}.${i}`),this}or(o,{foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${o})`),this}filter(o,s,i){return this.url.searchParams.append(o,`${s}.${i}`),this}}return jr.default=r,jr}var Bc;function sp(){if(Bc)return Or;Bc=1;var t=Or&&Or.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Or,"__esModule",{value:!0});const e=t(cl());class r{constructor(o,{headers:s={},schema:i,fetch:a}){this.url=o,this.headers=s,this.schema=i,this.fetch=a}select(o,{head:s=!1,count:i}={}){const a=s?"HEAD":"GET";let l=!1;const c=(o??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),i&&(this.headers.Prefer=`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(o,{count:s,defaultToNull:i=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(o)){const c=o.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}upsert(o,{onConflict:s,ignoreDuplicates:i=!1,count:a,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${i?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(o)){const d=o.reduce((f,p)=>f.concat(Object.keys(p)),[]);if(d.length>0){const f=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}update(o,{count:s}={}){const i="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}delete({count:o}={}){const s="DELETE",i=[];return o&&i.push(`count=${o}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Or.default=r,Or}var Rn={},In={},Fc;function G0(){return Fc||(Fc=1,Object.defineProperty(In,"__esModule",{value:!0}),In.version=void 0,In.version="0.0.0-automated"),In}var Uc;function q0(){if(Uc)return Rn;Uc=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.DEFAULT_HEADERS=void 0;const t=G0();return Rn.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${t.version}`},Rn}var Hc;function V0(){if(Hc)return Ir;Hc=1;var t=Ir&&Ir.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ir,"__esModule",{value:!0});const e=t(sp()),r=t(cl()),n=q0();class o{constructor(i,{headers:a={},schema:l,fetch:c}={}){this.url=i,this.headers=Object.assign(Object.assign({},n.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new o(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:l=!1,get:c=!1,count:u}={}){let d;const f=new URL(`${this.url}/rpc/${i}`);let p;l||c?(d=l?"HEAD":"GET",Object.entries(a).filter(([m,v])=>v!==void 0).map(([m,v])=>[m,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([m,v])=>{f.searchParams.append(m,v)})):(d="POST",p=a);const y=Object.assign({},this.headers);return u&&(y.Prefer=`count=${u}`),new r.default({method:d,url:f,headers:y,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return Ir.default=o,Ir}var Wc;function K0(){if(Wc)return _e;Wc=1;var t=_e&&_e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(_e,"__esModule",{value:!0}),_e.PostgrestError=_e.PostgrestBuilder=_e.PostgrestTransformBuilder=_e.PostgrestFilterBuilder=_e.PostgrestQueryBuilder=_e.PostgrestClient=void 0;const e=t(V0());_e.PostgrestClient=e.default;const r=t(sp());_e.PostgrestQueryBuilder=r.default;const n=t(cl());_e.PostgrestFilterBuilder=n.default;const o=t(op());_e.PostgrestTransformBuilder=o.default;const s=t(np());_e.PostgrestBuilder=s.default;const i=t(rp());return _e.PostgrestError=i.default,_e.default={PostgrestClient:e.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:s.default,PostgrestError:i.default},_e}var X0=K0();const J0=Tt(X0),{PostgrestClient:Y0,PostgrestQueryBuilder:bA,PostgrestFilterBuilder:wA,PostgrestTransformBuilder:xA,PostgrestBuilder:_A,PostgrestError:SA}=J0;function Z0(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Q0=Z0(),e_="2.11.15",t_=`realtime-js/${e_}`,r_="1.0.0",ip=1e4,n_=1e3;var Fn;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Fn||(Fn={}));var Te;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Te||(Te={}));var et;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(et||(et={}));var ca;(function(t){t.websocket="websocket"})(ca||(ca={}));var ar;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(ar||(ar={}));class o_{constructor(){this.HEADER_LENGTH=1}decode(e,r){return e.constructor===ArrayBuffer?r(this._binaryDecode(e)):r(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const r=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,r,n)}_decodeBroadcast(e,r,n){const o=r.getUint8(1),s=r.getUint8(2);let i=this.HEADER_LENGTH+2;const a=n.decode(e.slice(i,i+o));i=i+o;const l=n.decode(e.slice(i,i+s));i=i+s;const c=JSON.parse(n.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class ap{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var he;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(he||(he={}));const Gc=(t,e,r={})=>{var n;const o=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((s,i)=>(s[i]=s_(i,t,e,o),s),{})},s_=(t,e,r,n)=>{const o=e.find(a=>a.name===t),s=o?.type,i=r[t];return s&&!n.includes(s)?lp(s,i):ua(i)},lp=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return c_(e,r)}switch(t){case he.bool:return i_(e);case he.float4:case he.float8:case he.int2:case he.int4:case he.int8:case he.numeric:case he.oid:return a_(e);case he.json:case he.jsonb:return l_(e);case he.timestamp:return u_(e);case he.abstime:case he.date:case he.daterange:case he.int4range:case he.int8range:case he.money:case he.reltime:case he.text:case he.time:case he.timestamptz:case he.timetz:case he.tsrange:case he.tstzrange:return ua(e);default:return ua(e)}},ua=t=>t,i_=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},a_=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},l_=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},c_=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let s;const i=t.slice(1,r);try{s=JSON.parse("["+i+"]")}catch{s=i?i.split(","):[]}return s.map(a=>lp(e,a))}return t},u_=t=>typeof t=="string"?t.replace(" ","T"):t,cp=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class ii{constructor(e,r,n={},o=ip){this.channel=e,this.event=r,this.payload=n,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var qc;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(qc||(qc={}));class Un{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Un.syncState(this.state,o,s,i),this.pendingDiffs.forEach(l=>{this.state=Un.syncDiff(this.state,l,s,i)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},o=>{const{onJoin:s,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=Un.syncDiff(this.state,o,s,i),a())}),this.onJoin((o,s,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:s,newPresences:i})}),this.onLeave((o,s,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:s,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,o){const s=this.cloneDeep(e),i=this.transformState(r),a={},l={};return this.map(s,(c,u)=>{i[c]||(l[c]=u)}),this.map(i,(c,u)=>{const d=s[c];if(d){const f=u.map(v=>v.presence_ref),p=d.map(v=>v.presence_ref),y=u.filter(v=>p.indexOf(v.presence_ref)<0),m=d.filter(v=>f.indexOf(v.presence_ref)<0);y.length>0&&(a[c]=y),m.length>0&&(l[c]=m)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},n,o)}static syncDiff(e,r,n,o){const{joins:s,leaves:i}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),o||(o=()=>{}),this.map(s,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(p=>p.presence_ref),f=u.filter(p=>d.indexOf(p.presence_ref)<0);e[a].unshift(...f)}n(a,u,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,o(a,c,l),c.length===0&&delete e[a]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const o=e[n];return"metas"in o?r[n]=o.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):r[n]=o,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Vc;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Vc||(Vc={}));var Kc;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Kc||(Kc={}));var St;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(St||(St={}));class ul{constructor(e,r={config:{}},n){this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=Te.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new ii(this,et.join,this.params,this.timeout),this.rejoinTimer=new ap(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Te.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Te.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Te.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Te.errored,this.rejoinTimer.scheduleTimeout())}),this._on(et.reply,{},(o,s)=>{this._trigger(this._replyEventName(s),o)}),this.presence=new Un(this),this.broadcastEndpointURL=cp(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,r=this.timeout){var n,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Te.closed){const{config:{broadcast:s,presence:i,private:a}}=this.params;this._onError(u=>e?.(St.CHANNEL_ERROR,u)),this._onClose(()=>e?.(St.CLOSED));const l={},c={broadcast:s,presence:i,postgres_changes:(o=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){e?.(St.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,p=(d=f?.length)!==null&&d!==void 0?d:0,y=[];for(let m=0;m<p;m++){const v=f[m],{filter:{event:b,schema:_,table:w,filter:x}}=v,k=u&&u[m];if(k&&k.event===b&&k.schema===_&&k.table===w&&k.filter===x)y.push(Object.assign(Object.assign({},v),{id:k.id}));else{this.unsubscribe(),this.state=Te.errored,e?.(St.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(St.SUBSCRIBED);return}}).receive("error",u=>{this.state=Te.errored,e?.(St.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e?.(St.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this._on(e,r,n)}async send(e,r={}){var n,o;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var i,a,l;const c=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Te.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(et.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(o=>{n=new ii(this,et.leave,{},e),n.receive("ok",()=>{r(),o("ok")}).receive("timeout",()=>{r(),o("timed out")}).receive("error",()=>{o("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,r,n){const o=new AbortController,s=setTimeout(()=>o.abort(),n),i=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:o.signal}));return clearTimeout(s),i}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new ii(this,e,r,n);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var o,s;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=et;if(n&&[a,l,c,u].indexOf(i)>=0&&n!==this._joinRef())return;let f=this._onMessage(i,r,n);if(r&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(p=>{var y,m,v;return((y=p.filter)===null||y===void 0?void 0:y.event)==="*"||((v=(m=p.filter)===null||m===void 0?void 0:m.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(p=>p.callback(f,n)):(s=this.bindings[i])===null||s===void 0||s.filter(p=>{var y,m,v,b,_,w;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in p){const x=p.id,k=(y=p.filter)===null||y===void 0?void 0:y.event;return x&&((m=r.ids)===null||m===void 0?void 0:m.includes(x))&&(k==="*"||k?.toLocaleLowerCase()===((v=r.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const x=(_=(b=p?.filter)===null||b===void 0?void 0:b.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return x==="*"||x===((w=r?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===i}).map(p=>{if(typeof f=="object"&&"ids"in f){const y=f.data,{schema:m,table:v,commit_timestamp:b,type:_,errors:w}=y;f=Object.assign(Object.assign({},{schema:m,table:v,commit_timestamp:b,eventType:_,new:{},old:{},errors:w}),this._getPayloadRecords(y))}p.callback(f,n)})}_isClosed(){return this.state===Te.closed}_isJoined(){return this.state===Te.joined}_isJoining(){return this.state===Te.joining}_isLeaving(){return this.state===Te.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const o=e.toLocaleLowerCase(),s={type:o,filter:r,callback:n};return this.bindings[o]?this.bindings[o].push(s):this.bindings[o]=[s],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(o=>{var s;return!(((s=o.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===n&&ul.isEqual(o.filter,r))}),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(et.close,{},e)}_onError(e){this._on(et.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Te.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=Gc(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=Gc(e.columns,e.old_record)),r}}const Xc=()=>{},d_=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class h_{constructor(e,r){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ip,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Xc,this.ref=0,this.logger=Xc,this.conn=null,this.sendBuffer=[],this.serializer=new o_,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>Ht(async()=>{const{default:l}=await Promise.resolve().then(()=>_n);return{default:l}},void 0).then(({default:l})=>l(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${ca.websocket}`,this.httpEndpoint=cp(e),r?.transport?this.transport=r.transport:this.transport=null,r?.params&&(this.params=r.params),r?.timeout&&(this.timeout=r.timeout),r?.logger&&(this.logger=r.logger),(r?.logLevel||r?.log_level)&&(this.logLevel=r.logLevel||r.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),r?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=r.heartbeatIntervalMs);const o=(n=r?.params)===null||n===void 0?void 0:n.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=r?.reconnectAfterMs?r.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=r?.encode?r.encode:(s,i)=>i(JSON.stringify(s)),this.decode=r?.decode?r.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new ap(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(r?.fetch),r?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=r?.worker||!1,this.workerUrl=r?.workerUrl}this.accessToken=r?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=Q0),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:r_}))}disconnect(e,r){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,r??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(n=>n.teardown()))}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Fn.connecting:return ar.Connecting;case Fn.open:return ar.Open;case Fn.closing:return ar.Closing;default:return ar.Closed}}isConnected(){return this.connectionState()===ar.Open}channel(e,r={config:{}}){const n=`realtime:${e}`,o=this.getChannels().find(s=>s.topic===n);if(o)return o;{const s=new ul(`realtime:${e}`,r,this);return this.channels.push(s),s}}push(e){const{topic:r,event:n,payload:o,ref:s}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${r} ${n} (${s})`,o),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let r=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const o={access_token:r,version:t_};r&&n.updateJoinPayload(o),n.joinedOnce&&n._isJoined()&&n._push(et.access_token,{access_token:r})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(n_,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,r=>{let{topic:n,event:o,payload:s,ref:i}=r;n==="phoenix"&&o==="phx_reply"&&this.heartbeatCallback(r.payload.status=="ok"?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${n} ${o} ${i&&"("+i+")"||""}`,s),Array.from(this.channels).filter(a=>a._isMember(n)).forEach(a=>a._trigger(o,s,i)),this.stateChangeCallbacks.message.forEach(a=>a(r))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(r=>r(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(r=>r(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(et.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",o=new URLSearchParams(r);return`${e}${n}${o}`}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([d_],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}}class dl extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Se(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class f_ extends dl{constructor(e,r){super(e),this.name="StorageApiError",this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class da extends dl{constructor(e,r){super(e),this.name="StorageUnknownError",this.originalError=r}}var p_=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const up=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Ht(async()=>{const{default:n}=await Promise.resolve().then(()=>_n);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},g_=()=>p_(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ht(()=>Promise.resolve().then(()=>_n),void 0)).Response:Response}),ha=t=>{if(Array.isArray(t))return t.map(r=>ha(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const o=r.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[o]=ha(n)}),e};var Cr=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const ai=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),m_=(t,e,r)=>Cr(void 0,void 0,void 0,function*(){const n=yield g_();t instanceof n&&!r?.noResolveJson?t.json().then(o=>{e(new f_(ai(o),t.status||500))}).catch(o=>{e(new da(ai(o),o))}):e(new da(ai(t),t))}),y_=(t,e,r,n)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n&&(o.body=JSON.stringify(n)),Object.assign(Object.assign({},o),r))};function ao(t,e,r,n,o,s){return Cr(this,void 0,void 0,function*(){return new Promise((i,a)=>{t(r,y_(e,n,o,s)).then(l=>{if(!l.ok)throw l;return n?.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>m_(l,a,n))})})}function as(t,e,r,n){return Cr(this,void 0,void 0,function*(){return ao(t,"GET",e,r,n)})}function Lt(t,e,r,n,o){return Cr(this,void 0,void 0,function*(){return ao(t,"POST",e,n,o,r)})}function v_(t,e,r,n,o){return Cr(this,void 0,void 0,function*(){return ao(t,"PUT",e,n,o,r)})}function b_(t,e,r,n){return Cr(this,void 0,void 0,function*(){return ao(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function dp(t,e,r,n,o){return Cr(this,void 0,void 0,function*(){return ao(t,"DELETE",e,n,o,r)})}var ze=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const w_={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Jc={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class x_{constructor(e,r={},n,o){this.url=e,this.headers=r,this.bucketId=n,this.fetch=up(o)}uploadOrUpdate(e,r,n,o){return ze(this,void 0,void 0,function*(){try{let s;const i=Object.assign(Object.assign({},Jc),o);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&n instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",n)):typeof FormData<"u"&&n instanceof FormData?(s=n,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=n,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));const c=this._removeEmptyFolders(r),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:s,headers:a},i?.duplex?{duplex:i.duplex}:{})),f=yield d.json();return d.ok?{data:{path:c,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(s){if(Se(s))return{data:null,error:s};throw s}})}upload(e,r,n){return ze(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,r,n)})}uploadToSignedUrl(e,r,n,o){return ze(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),i=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",r);try{let l;const c=Object.assign({upsert:Jc.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),f=yield d.json();return d.ok?{data:{path:s,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(Se(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,r){return ze(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const o=Object.assign({},this.headers);r?.upsert&&(o["x-upsert"]="true");const s=yield Lt(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:o}),i=new URL(this.url+s.url),a=i.searchParams.get("token");if(!a)throw new dl("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}update(e,r,n){return ze(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,r,n)})}move(e,r,n){return ze(this,void 0,void 0,function*(){try{return{data:yield Lt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}copy(e,r,n){return ze(this,void 0,void 0,function*(){try{return{data:{path:(yield Lt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrl(e,r,n){return ze(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),s=yield Lt(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:r},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${i}`)},{data:s,error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}createSignedUrls(e,r,n){return ze(this,void 0,void 0,function*(){try{const o=yield Lt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:e},{headers:this.headers}),s=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${s}`):null})),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}download(e,r){return ze(this,void 0,void 0,function*(){const o=typeof r?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(r?.transform||{}),i=s?`?${s}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield as(this.fetch,`${this.url}/${o}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Se(a))return{data:null,error:a};throw a}})}info(e){return ze(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{const n=yield as(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:ha(n),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}exists(e){return ze(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{return yield b_(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Se(n)&&n instanceof da){const o=n.originalError;if([400,404].includes(o?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,r){const n=this._getFinalPath(e),o=[],s=r?.download?`download=${r.download===!0?"":r.download}`:"";s!==""&&o.push(s);const a=typeof r?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(r?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${c}`)}}}remove(e){return ze(this,void 0,void 0,function*(){try{return{data:yield dp(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}list(e,r,n){return ze(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},w_),r),{prefix:e||""});return{data:yield Lt(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},n),error:null}}catch(o){if(Se(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const r=[];return e.width&&r.push(`width=${e.width}`),e.height&&r.push(`height=${e.height}`),e.resize&&r.push(`resize=${e.resize}`),e.format&&r.push(`format=${e.format}`),e.quality&&r.push(`quality=${e.quality}`),r.join("&")}}const __="2.7.1",S_={"X-Client-Info":`storage-js/${__}`};var zr=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class k_{constructor(e,r={},n){this.url=e,this.headers=Object.assign(Object.assign({},S_),r),this.fetch=up(n)}listBuckets(){return zr(this,void 0,void 0,function*(){try{return{data:yield as(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Se(e))return{data:null,error:e};throw e}})}getBucket(e){return zr(this,void 0,void 0,function*(){try{return{data:yield as(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}createBucket(e,r={public:!1}){return zr(this,void 0,void 0,function*(){try{return{data:yield Lt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}updateBucket(e,r){return zr(this,void 0,void 0,function*(){try{return{data:yield v_(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}})}emptyBucket(e){return zr(this,void 0,void 0,function*(){try{return{data:yield Lt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}deleteBucket(e){return zr(this,void 0,void 0,function*(){try{return{data:yield dp(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(Se(r))return{data:null,error:r};throw r}})}}class C_ extends k_{constructor(e,r={},n){super(e,r,n)}from(e){return new x_(this.url,this.headers,e,this.fetch)}}const E_="2.51.0";let $n="";typeof Deno<"u"?$n="deno":typeof document<"u"?$n="web":typeof navigator<"u"&&navigator.product==="ReactNative"?$n="react-native":$n="node";const P_={"X-Client-Info":`supabase-js-${$n}/${E_}`},A_={headers:P_},T_={schema:"public"},R_={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},I_={};var O_=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const j_=t=>{let e;return t?e=t:typeof fetch>"u"?e=ep:e=fetch,(...r)=>e(...r)},$_=()=>typeof Headers>"u"?tp:Headers,N_=(t,e,r)=>{const n=j_(r),o=$_();return(s,i)=>O_(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:t;let c=new o(i?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(s,Object.assign(Object.assign({},i),{headers:c}))})};var z_=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};function M_(t){return t.endsWith("/")?t:t+"/"}function D_(t,e){var r,n;const{db:o,auth:s,realtime:i,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,f={db:Object.assign(Object.assign({},l),o),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(r=d?.headers)!==null&&r!==void 0?r:{}),(n=a?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>z_(this,void 0,void 0,function*(){return""})};return t.accessToken?f.accessToken=t.accessToken:delete f.accessToken,f}const hp="2.71.0",Gr=30*1e3,fa=3,li=fa*Gr,L_="http://localhost:9999",B_="supabase.auth.token",F_={"X-Client-Info":`gotrue-js/${hp}`},pa="X-Supabase-Api-Version",fp={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},U_=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,H_=10*60*1e3;class hl extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function Z(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class W_ extends hl{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function G_(t){return Z(t)&&t.name==="AuthApiError"}class pp extends hl{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class Zt extends hl{constructor(e,r,n,o){super(e,n,o),this.name=r,this.status=n}}class Dt extends Zt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function q_(t){return Z(t)&&t.name==="AuthSessionMissingError"}class Io extends Zt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Oo extends Zt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class jo extends Zt{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function V_(t){return Z(t)&&t.name==="AuthImplicitGrantRedirectError"}class Yc extends Zt{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ga extends Zt{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function ci(t){return Z(t)&&t.name==="AuthRetryableFetchError"}class Zc extends Zt{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class ma extends Zt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ls="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Qc=` 	
\r=`.split(""),K_=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Qc.length;e+=1)t[Qc[e].charCodeAt(0)]=-2;for(let e=0;e<ls.length;e+=1)t[ls[e].charCodeAt(0)]=e;return t})();function eu(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(ls[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(ls[n]),e.queuedBits-=6}}function gp(t,e,r){const n=K_[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function tu(t){const e=[],r=i=>{e.push(String.fromCodePoint(i))},n={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},s=i=>{Y_(i,n,r)};for(let i=0;i<t.length;i+=1)gp(t.charCodeAt(i),o,s);return e.join("")}function X_(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function J_(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&n<=56319){const o=(n-55296)*1024&65535;n=(t.charCodeAt(r+1)-56320&65535|o)+65536,r+=1}X_(n,e)}}function Y_(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let n=1;n<6;n+=1)if((t>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function Z_(t){const e=[],r={queue:0,queuedBits:0},n=o=>{e.push(o)};for(let o=0;o<t.length;o+=1)gp(t.charCodeAt(o),r,n);return new Uint8Array(e)}function Q_(t){const e=[];return J_(t,r=>e.push(r)),new Uint8Array(e)}function eS(t){const e=[],r={queue:0,queuedBits:0},n=o=>{e.push(o)};return t.forEach(o=>eu(o,r,n)),eu(null,r,n),e.join("")}function tS(t){return Math.round(Date.now()/1e3)+t}function rS(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const Qe=()=>typeof window<"u"&&typeof document<"u",tr={tested:!1,writable:!1},mp=()=>{if(!Qe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(tr.tested)return tr.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),tr.tested=!0,tr.writable=!0}catch{tr.tested=!0,tr.writable=!1}return tr.writable};function nS(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((o,s)=>{e[s]=o})}catch{}return r.searchParams.forEach((n,o)=>{e[o]=n}),e}const yp=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Ht(async()=>{const{default:n}=await Promise.resolve().then(()=>_n);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},oS=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",qr=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},rr=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},$t=async(t,e)=>{await t.removeItem(e)};class ks{constructor(){this.promise=new ks.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}ks.promiseConstructor=Promise;function ui(t){const e=t.split(".");if(e.length!==3)throw new ma("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!U_.test(e[n]))throw new ma("JWT not in base64url format");return{header:JSON.parse(tu(e[0])),payload:JSON.parse(tu(e[1])),signature:Z_(e[2]),raw:{header:e[0],payload:e[1]}}}async function sS(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function iS(t,e){return new Promise((n,o)=>{(async()=>{for(let s=0;s<1/0;s++)try{const i=await t(s);if(!e(s,null,i)){n(i);return}}catch(i){if(!e(s,i)){o(i);return}}})()})}function aS(t){return("0"+t.toString(16)).substr(-2)}function lS(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let o="";for(let s=0;s<56;s++)o+=r.charAt(Math.floor(Math.random()*n));return o}return crypto.getRandomValues(e),Array.from(e,aS).join("")}async function cS(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),o=new Uint8Array(n);return Array.from(o).map(s=>String.fromCharCode(s)).join("")}async function uS(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await cS(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Mr(t,e,r=!1){const n=lS();let o=n;r&&(o+="/PASSWORD_RECOVERY"),await qr(t,`${e}-code-verifier`,o);const s=await uS(n);return[s,n===s?"plain":"s256"]}const dS=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function hS(t){const e=t.headers.get(pa);if(!e||!e.match(dS))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function fS(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function pS(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const gS=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Dr(t){if(!gS.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function di(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}var mS=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};const or=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),yS=[502,503,504];async function ru(t){var e;if(!oS(t))throw new ga(or(t),0);if(yS.includes(t.status))throw new ga(or(t),t.status);let r;try{r=await t.json()}catch(s){throw new pp(or(s),s)}let n;const o=hS(t);if(o&&o.getTime()>=fp["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new Zc(or(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Dt}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((s,i)=>s&&typeof i=="string",!0))throw new Zc(or(r),t.status,r.weak_password.reasons);throw new W_(or(r),t.status||500,n)}const vS=(t,e,r,n)=>{const o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(n),Object.assign(Object.assign({},o),r))};async function oe(t,e,r,n){var o;const s=Object.assign({},n?.headers);s[pa]||(s[pa]=fp["2024-01-01"].name),n?.jwt&&(s.Authorization=`Bearer ${n.jwt}`);const i=(o=n?.query)!==null&&o!==void 0?o:{};n?.redirectTo&&(i.redirect_to=n.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await bS(t,e,r+a,{headers:s,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(l):{data:Object.assign({},l),error:null}}async function bS(t,e,r,n,o,s){const i=vS(e,n,o,s);let a;try{a=await t(r,Object.assign({},i))}catch(l){throw console.error(l),new ga(or(l),0)}if(a.ok||await ru(a),n?.noResolveJson)return a;try{return await a.json()}catch(l){await ru(l)}}function _t(t){var e;let r=null;SS(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=tS(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function nu(t){const e=_t(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Bt(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function wS(t){return{data:t,error:null}}function xS(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:o,verification_type:s}=t,i=mS(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:r,hashed_token:n,redirect_to:o,verification_type:s},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function _S(t){return t}function SS(t){return t.access_token&&t.refresh_token&&t.expires_in}const hi=["global","local","others"];var kS=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};class CS{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=yp(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,r=hi[0]){if(hi.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${hi.join(", ")}`);try{return await oe(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await oe(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Bt})}catch(n){if(Z(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=kS(e,["options"]),o=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(o.new_email=n?.newEmail,delete o.newEmail),await oe(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:xS,redirectTo:r?.redirectTo})}catch(r){if(Z(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await oe(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Bt})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,o,s,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await oe(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(s=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""},xform:_S});if(u.error)throw u.error;const d=await u.json(),f=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,p=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(y=>{const m=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(y.split(";")[1].split("=")[1]);c[`${v}Page`]=m}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(Z(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Dr(e);try{return await oe(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Bt})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){Dr(e);try{return await oe(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:Bt})}catch(n){if(Z(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){Dr(e);try{return await oe(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:Bt})}catch(n){if(Z(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Dr(e.userId);try{const{data:r,error:n}=await oe(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:r,error:n}}catch(r){if(Z(r))return{data:null,error:r};throw r}}async _deleteFactor(e){Dr(e.userId),Dr(e.id);try{return{data:await oe(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}}}function ou(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}function ES(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Lr={debug:!!(globalThis&&mp()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class vp extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class PS extends vp{}async function AS(t,e,r){Lr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Lr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async o=>{if(o){Lr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await r()}finally{Lr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(e===0)throw Lr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new PS(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Lr.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}ES();const TS={url:L_,storageKey:B_,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:F_,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function su(t,e,r){return await r()}const Br={};class Yn{constructor(e){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Yn.nextInstanceID,Yn.nextInstanceID+=1,this.instanceID>0&&Qe()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},TS),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new CS({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=yp(o.fetch),this.lock=o.lock||su,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:Qe()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=AS:this.lock=su,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:mp()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ou(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=ou(this.memoryStorage)),Qe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,r;return(r=(e=Br[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Br[this.storageKey]=Object.assign(Object.assign({},Br[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Br[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Br[this.storageKey]=Object.assign(Object.assign({},Br[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${hp}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const r=nS(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),Qe()&&this.detectSessionInUrl&&n!=="none"){const{data:o,error:s}=await this._getSessionFromURL(r,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),V_(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:i,redirectType:a}=o;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Z(r)?{error:r}:{error:new pp("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,o;try{const s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:_t}),{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Z(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var r,n,o;try{let s;if("email"in e){const{email:u,password:d,options:f}=e;let p=null,y=null;this.flowType==="pkce"&&([p,y]=await Mr(this.storage,this.storageKey)),s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:u,password:d,data:(r=f?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:y},xform:_t})}else if("phone"in e){const{phone:u,password:d,options:f}=e;s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(n=f?.data)!==null&&n!==void 0?n:{},channel:(o=f?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:_t})}else throw new Oo("You must provide either an email or phone number and a password");const{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Z(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let r;if("email"in e){const{email:s,password:i,options:a}=e;r=await oe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:nu})}else if("phone"in e){const{phone:s,password:i,options:a}=e;r=await oe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:nu})}else throw new Oo("You must provide either an email or phone number and a password");const{data:n,error:o}=r;return o?{data:{user:null,session:null},error:o}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Io}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:o})}catch(r){if(Z(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,n,o,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;if(r==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(e){var r,n,o,s,i,a,l,c,u,d,f,p;let y,m;if("message"in e)y=e.message,m=e.signature;else{const{chain:v,wallet:b,statement:_,options:w}=e;let x;if(Qe())if(typeof b=="object")x=b;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))x=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=b}const k=new URL((r=w?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in x&&x.signIn){const C=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w?.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),_?{statement:_}:null));let S;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")S=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)S=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)y=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),m=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${k.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(o=(n=w?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=w?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((i=w?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((d=(u=w?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...w.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const C=await x.signMessage(new TextEncoder().encode(y),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=C}}try{const{data:v,error:b}=await oe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:eS(m)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:_t});if(b)throw b;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new Io}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:b})}catch(v){if(Z(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const r=await rr(this.storage,`${this.storageKey}-code-verifier`),[n,o]=(r??"").split("/");try{const{data:s,error:i}=await oe(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:_t});if(await $t(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Io}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:i})}catch(s){if(Z(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:r,provider:n,token:o,access_token:s,nonce:i}=e,a=await oe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:o,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:_t}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Io}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(r){if(Z(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,n,o,s,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Mr(this.storage,this.storageKey));const{error:d}=await oe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=l?.data)!==null&&r!==void 0?r:{},create_user:(n=l?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await oe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(o=l?.data)!==null&&o!==void 0?o:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(i=l?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new Oo("You must provide either an email or phone number.")}catch(a){if(Z(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var r,n;try{let o,s;"options"in e&&(o=(r=e.options)===null||r===void 0?void 0:r.redirectTo,s=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:i,error:a}=await oe(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:_t});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(Z(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var r,n,o;try{let s=null,i=null;return this.flowType==="pkce"&&([s,i]=await Mr(this.storage,this.storageKey)),await oe(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:i}),headers:this.headers,xform:wS})}catch(s){if(Z(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new Dt;const{error:o}=await oe(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(Z(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:o,options:s}=e,{error:i}=await oe(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:n,type:o,options:s}=e,{data:i,error:a}=await oe(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:a}}throw new Oo("You must provide either an email or phone number and a type")}catch(r){if(Z(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await rr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<li:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const i=await rr(this.userStorage,this.storageKey+"-user");i?.user?e.user=i.user:e.user=di()}if(this.storage.isServer&&e.user){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await oe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Bt}):await this._useSession(async r=>{var n,o,s;const{data:i,error:a}=r;if(a)throw a;return!(!((n=i.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Dt}:await oe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:Bt})})}catch(r){if(Z(r))return q_(r)&&(await this._removeSession(),await $t(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:o,error:s}=n;if(s)throw s;if(!o.session)throw new Dt;const i=o.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Mr(this.storage,this.storageKey));const{data:c,error:u}=await oe(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Bt});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(n){if(Z(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Dt;const r=Date.now()/1e3;let n=r,o=!0,s=null;const{payload:i}=ui(e.access_token);if(i.exp&&(n=i.exp,o=n<=r),o){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(r){if(Z(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:i,error:a}=r;if(a)throw a;e=(n=i.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new Dt;const{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Z(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!Qe())throw new jo("No browser detected.");if(e.error||e.error_description||e.error_code)throw new jo(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new Yc("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new jo("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Yc("No code detected.");const{data:_,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:o,access_token:s,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!i||!c)throw new jo("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let f=u+d;l&&(f=parseInt(l));const p=f-u;p*1e3<=Gr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const y=f-d;u-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,f,u):u-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,f,u);const{data:m,error:v}=await this._getUser(s);if(v)throw v;const b={provider_token:n,provider_refresh_token:o,access_token:s,expires_in:d,expires_at:f,refresh_token:i,token_type:c,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:e.type},error:null}}catch(n){if(Z(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await rr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:o,error:s}=r;if(s)return{error:s};const i=(n=o.session)===null||n===void 0?void 0:n.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(G_(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await $t(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const r=rS(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,o;try{const{data:{session:s},error:i}=r;if(i)throw i;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,r={}){let n=null,o=null;this.flowType==="pkce"&&([n,o]=await Mr(this.storage,this.storageKey,!0));try{return await oe(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:o,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(s){if(Z(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{const{data:n,error:o}=await this._useSession(async s=>{var i,a,l,c,u;const{data:d,error:f}=s;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await oe(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(o)throw o;return Qe()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if(Z(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,o;const{data:s,error:i}=r;if(i)throw i;return await oe(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0})})}catch(r){if(Z(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await iS(async o=>(o>0&&await sS(200*Math.pow(2,o-1)),this._debug(r,"refreshing attempt",o),await oe(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:_t})),(o,s)=>{const i=200*Math.pow(2,o);return s&&ci(s)&&Date.now()+i-n<Gr})}catch(n){if(this._debug(r,"error",n),Z(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),Qe()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const o=await rr(this.storage,this.storageKey);if(o&&this.userStorage){let i=await rr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:o.user},await qr(this.userStorage,this.storageKey+"-user",i)),o.user=(e=i?.user)!==null&&e!==void 0?e:di()}else if(o&&!o.user&&!o.user){const i=await rr(this.storage,this.storageKey+"-user");i&&i?.user?(o.user=i.user,await $t(this.storage,this.storageKey+"-user"),await qr(this.storage,this.storageKey,o)):o.user=di()}if(this._debug(n,"session from storage",o),!this._isValidSession(o)){this._debug(n,"session is not valid"),o!==null&&await this._removeSession();return}const s=((r=o.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<li;if(this._debug(n,`session has${s?"":" not"} expired with margin of ${li}s`),s){if(this.autoRefreshToken&&o.refresh_token){const{error:i}=await this._callRefreshToken(o.refresh_token);i&&(console.error(i),ci(i)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:a}=await this._getUser(o.access_token);!a&&i?.user?(o.user=i.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(n,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(n,"error",o),console.error(o);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new Dt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new ks;const{data:s,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new Dt;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(o,"error",s),Z(s)){const i={session:null,error:s};return ci(s)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(i),i}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,r,n=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const s=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,r)}catch(l){s.push(l)}});if(await Promise.all(i),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const r=Object.assign({},e),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await qr(this.userStorage,this.storageKey+"-user",{user:r.user});const o=Object.assign({},r);delete o.user;const s=structuredClone(o);await qr(this.storage,this.storageKey,s)}else{const o=structuredClone(r);await qr(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await $t(this.storage,this.storageKey),await $t(this.storage,this.storageKey+"-code-verifier"),await $t(this.storage,this.storageKey+"-user"),this.userStorage&&await $t(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Qe()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Gr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((n.expires_at*1e3-e)/Gr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Gr}ms, refresh threshold is ${fa} ticks`),o<=fa&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof vp)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Qe()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const o=[`provider=${encodeURIComponent(r)}`];if(n?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&o.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[s,i]=await Mr(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(i)}`});o.push(a.toString())}if(n?.queryParams){const s=new URLSearchParams(n.queryParams);o.push(s.toString())}return n?.skipBrowserRedirect&&o.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;return s?{data:null,error:s}:await oe(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Z(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,o;const{data:s,error:i}=r;if(i)return{data:null,error:i};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await oe(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((o=l?.totp)===null||o===void 0)&&o.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(r){if(Z(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;if(s)return{data:null,error:s};const{data:i,error:a}=await oe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(r){if(Z(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:s}=r;return s?{data:null,error:s}:await oe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=o?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Z(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=e?.factors||[],o=n.filter(i=>i.factor_type==="totp"&&i.status==="verified"),s=n.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:n,totp:o,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,n;const{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=ui(o.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((n=(r=o.user.factors)===null||r===void 0?void 0:r.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,r={keys:[]}){let n=r.keys.find(a=>a.kid===e);if(n)return n;const o=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+H_>o)return n;const{data:s,error:i}=await oe(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=o,n=s.keys.find(a=>a.kid===e),!n)?null:n}async getClaims(e,r={}){try{let n=e;if(!n){const{data:p,error:y}=await this.getSession();if(y||!p.session)return{data:null,error:y};n=p.session.access_token}const{header:o,payload:s,signature:i,raw:{header:a,payload:l}}=ui(n);r?.allowExpired||fS(s.exp);const c=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!c){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:s,header:o,signature:i},error:null}}const u=pS(o.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,i,Q_(`${a}.${l}`)))throw new ma("Invalid JWT signature");return{data:{claims:s,header:o,signature:i},error:null}}catch(n){if(Z(n))return{data:null,error:n};throw n}}}Yn.nextInstanceID=0;const RS=Yn;class IS extends RS{constructor(e){super(e)}}var OS=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{c(n.next(u))}catch(d){i(d)}}function l(u){try{c(n.throw(u))}catch(d){i(d)}}function c(u){u.done?s(u.value):o(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class jS{constructor(e,r,n){var o,s,i;if(this.supabaseUrl=e,this.supabaseKey=r,!e)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const a=M_(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:T_,realtime:I_,auth:Object.assign(Object.assign({},R_),{storageKey:c}),global:A_},d=D_(n??{},u);this.storageKey=(o=d.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(f,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=N_(r,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Y0(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new L0(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new C_(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,r={},n={}){return this.rest.rpc(e,r,n)}channel(e,r={config:{}}){return this.realtime.channel(e,r)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,r;return OS(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&r!==void 0?r:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:o,storageKey:s,flowType:i,lock:a,debug:l},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new IS({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:s,autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:o,flowType:i,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new h_(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n?.access_token)})}_handleTokenChanged(e,r,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const $S=(t,e,r)=>new jS(t,e,r),fn=$S("https://pkswdnpftrundnewgnya.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrc3dkbnBmdHJ1bmRuZXdnbnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2ODI2MzIsImV4cCI6MjA2ODI1ODYzMn0.r_Y1RLOGJ55C0De5SBTVXqO09SMDqgV38sQuE-oDxXE"),NS=async(t,e)=>{const r=await fn.rpc("save_campaign_version",{p_name:t,p_data:await Qf(e)});if(r.error)throw new Error(`error saving to db ${r.error.message} ${r.error.details}`,{cause:r.error});return r.data},zS=async t=>{const e=await fn.rpc("get_latest_campaign",{p_name:t});if(e.error)throw e.error;return await N0(e.data.data)},bp=()=>{const[t,e]=g.useState(null);return g.useEffect(()=>{fn.auth.getUser().then(({data:{user:n}})=>{e(n)});const{data:{subscription:r}}=fn.auth.onAuthStateChange((n,o)=>{e(o?.user??null)});return()=>r.unsubscribe()},[]),t},MS=2e3,DS=()=>{const t=bp(),e=de(({levelEditor:{savedCampaign:i,campaignInProgress:a}})=>Ue(i,a)),[r,n]=g.useState(0),o=async()=>{const i=L.getState(),a=Ad(i);console.info("saving...",a);const l=await NS("sequel",a);console.info(`...saved as v${l}`),L.dispatch(Pm({campaign:a})),n(c=>c+1),setTimeout(()=>n(c=>c-1),MS)},s=async()=>{try{const i=await zS("sequel");console.info("loaded",i),L.dispatch(Am({campaign:i}))}catch(i){console.error(i)}};return h.jsxs(h.Fragment,{children:[r>0?h.jsx(ve,{disabled:!0,className:"!bg-moss !text-white",children:h.jsx(H,{className:"relative leading-none",children:"OK!"})}):h.jsx(ve,{disabled:t===null||e,onClick:o,shortcutKeys:["^S","⌘S"],children:h.jsx(Jn,{icon:h.jsxs("div",{className:"flex flex-row items-center",children:[h.jsx("span",{className:Pe("sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative",{"text-lightGrey":t===null})}),h.jsx("span",{className:Pe("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})})]}),topText:"sa",bottomText:"ve"})}),h.jsx(ve,{disabled:t===null,onClick:s,children:h.jsx(Jn,{icon:h.jsxs("div",{className:"flex flex-row items-center",children:[h.jsx("span",{className:Pe("sprite texture-editor_tool_save relative",{"sprite-revert-to-two-tone-dim":t===null})}),h.jsx("span",{className:Pe("sprite sprite-tinted text-highlightBeige texture-hud_char_➡ relative",{"text-lightGrey":t===null})})]}),topText:"lo",bottomText:"ad"})})]})},LS=()=>h.jsx(ve,{children:h.jsx(H,{className:"relative leading-none",children:"MAP"})}),BS=()=>{const[t,e]=g.useState(!1),[r,n]=g.useState(!1);return h.jsx(al,{main:h.jsx(ve,{onClick:async()=>{const o=L.getState(),s=Ad(o),i=await Qf(s),a=new URL("https://blockstack.ing"),l=a.searchParams;l.set("campaignData",i),l.set("noSaves","1"),l.set("cheats","1"),r&&l.set("playAsHeels","1"),t||(a.hash=o.levelEditor.currentlyEditingRoomId),window.open(a.toString(),"playtest")},shortcutKeys:["⌘P","^P"],children:h.jsx(Jn,{topText:"pl",bottomText:"ay",icon:h.jsx("span",{className:"sprite texture-joystick mt-half"})})}),children:[h.jsx(br,{className:"w-full",value:t,label:"from",falseLabel:"room",trueLabel:"start",onChange:o=>e(o)},"fromStart"),h.jsx(br,{className:"w-full",value:r,label:"as",falseLabel:"head",trueLabel:"heels",onChange:o=>n(o)},"playAsHeels")]})},FS=t=>{switch(t){case"github":return bd;case"discord":return wd;default:throw new Error}},US=({className:t})=>{const e=bp(),r=o=>async()=>{const s=new URL(window.location.href);s.hash="";const i=s.toString(),{error:a}=await fn.auth.signInWithOAuth({provider:o,options:{redirectTo:i}});a&&console.error("Login error:",a)},n=async()=>{const{error:o}=await fn.auth.signOut();o&&console.error("Logout error:",o)};return h.jsx("div",{className:Pe(t),children:e?h.jsxs("div",{className:"bg-moss overflow-hidden text-center",children:[h.jsx(H,{noSlitWords:!0,className:"overflow-hidden",children:`${FS(e.app_metadata.provider)}${e.email}`}),h.jsx(Et,{className:"px-1 w-full",onClick:n,children:h.jsx(H,{children:"Logout"})})]}):h.jsxs("div",{className:"px-1 bg-midRed",children:[h.jsx(H,{className:"block w-full sprites-double-height pb-1",children:"Not logged in"}),h.jsx(H,{className:"block w-full text-highlightBeige",children:"You will not be able to save"}),h.jsxs("div",{className:"pt-1 flex flex-col gap-half",children:[h.jsx(H,{children:"Log in with:"}),h.jsxs(Et,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:r("github"),children:[h.jsx(H,{children:bd}),h.jsx(H,{children:"GitHub"})]}),h.jsxs(Et,{className:"px-1 w-full flex-row justify-between bg-redShadow",onClick:r("discord"),children:[h.jsx(H,{children:wd}),h.jsx(H,{children:"Discord"})]})]})]})})},HS=()=>{const t=Be(),e=de(r=>Object.keys(r.levelEditor.campaignInProgress.rooms).length>1);return h.jsxs(h.Fragment,{children:[h.jsx(ve,{className:"bg-moss",onClick:()=>t(Tm()),children:h.jsx("span",{className:"sprite texture-hud_char_+ relative"})}),h.jsx(ve,{className:"bg-midRed",onClick:()=>t(Rm()),disabled:!e,children:h.jsx("span",{className:"sprite texture-hud_char_X relative"})})]})},Ie={x:12,y:12,z:F.h},WS={x:14,y:14,z:F.h},lr={x:16,y:16,z:F.h},fi={...Ie,z:F.h*2},wp=t=>{switch(t.type){case"spring":case"portableBlock":case"moveableDeadly":case"slidingDeadly":case"firedDoughnut":return{aabb:Ie};case"slidingBlock":return t.config.style==="book"?{aabb:lr}:{aabb:Ie};case"lift":return{aabb:{...Ie,z:Ie.z}};case"switch":return{aabb:{...Ie,z:Ie.z}};case"pickup":return t.config.gives==="scroll"?{aabb:{x:16,y:4,z:13}}:{aabb:Ie};case"charles":return{aabb:fi};case"ball":return{aabb:{x:12,y:12,z:12}};case"pushableBlock":case"movingPlatform":return{aabb:lr};case"block":switch(t.config.style){case"artificial":case"organic":case"book":return{aabb:lr};case"tower":return{aabb:{x:11,y:11,z:F.h}};default:throw new Error("unknown block style")}case"monster":switch(t.config.which){case"skiHead":return{aabb:{...Ie,z:21}};case"bubbleRobot":case"cyberman":case"elephant":case"emperorsGuardian":case"monkey":case"computerBot":return{aabb:fi};case"helicopterBug":case"dalek":case"emperor":case"homingBot":case"elephantHead":return{aabb:Ie};case"turtle":return{aabb:Ie};default:throw t.config,new Error("unknown monster type")}case"deadlyBlock":case"spikes":return{aabb:lr};case"bubbles":return{aabb:Ie};case"conveyor":case"hushPuppy":case"teleporter":return{aabb:lr};case"barrier":return{aabb:t.config.axis==="y"?{x:3,y:15,z:F.h}:{x:15,y:3,z:F.h}};case"sceneryPlayer":return t.config.which==="headOverHeels"?{aabb:fi}:{aabb:Ie};case"emitter":return{aabb:fe};default:return{aabb:WS}}},tt={aabb:Ie},GS=({config:{direction:t},position:e})=>t==="right"&&e.x===0||t==="towards"&&e.y===0,iu=Lg/1e3,xp={firedDoughnut:2*iu,floatingText:iu},lo=10,au=6e4,qS=8,VS=750,KS=2500,lu=200,XS=.15,JS=Qr.h-Qr.w/2,_p=JS+2,YS=({x:t=0,y:e=0})=>e-t,K=({x:t=0,y:e=0,z:r=0})=>({x:e-t,y:-(t+e)/2-r}),ZS=(t,e,r)=>{const n=K(t),o=hr(r,n);return D(Sp(e,o),t)},Sp=(t,{x:e,y:r})=>{switch(xd(t)){case"xy":return{x:-e/2-r,y:e/2-r,z:0};case"xz":return{x:-e,y:0,z:e/2-r};case"yz":return{x:0,y:e,z:-e/2-r};default:throw new Error("only axis-aligned planes are supported for unprojection")}},ke=({x:t=0,y:e=0,z:r=0})=>({x:t*F.w,y:e*F.d,z:r*F.h}),qo=({x:t=0,y:e=0,z:r=0})=>({x:t/F.w,y:e/F.d,z:r/F.h}),wr=t=>K(ke(t)),ya=t=>{const e=ke(t.position),{aabb:r}=wp(t);if(r===void 0)throw new Error(`item type= ${t.type} config=${JSON.stringify(t.config)} has no bounding box`);return t.type==="wall"?e:D(e,{x:F.w-r.x>>1,y:F.d-r.y>>1})},Ee=Number.MIN_SAFE_INTEGER,Me=()=>({expires:null,stoodOnBy:{},disappearing:null,switchedAtRoomTime:Ee,stoodOnUntilRoomTime:Ee}),cu=()=>({standingOnItemId:null,vels:{gravity:fe,movingFloor:fe},latentMovement:[],actedOnAt:{roomTime:Ee,by:le},collidedWith:{roomTime:Ee,by:le}}),QS=t=>{const e=Im.includes(t.type);return{...Me(),position:ya(t),...e?{standingOnItemId:null,vels:{gravity:fe,movingFloor:fe,...Om.includes(t.type)?{sliding:fe}:{},...t.type==="monster"||t.type==="movingPlatform"?{walking:fe}:{}},latentMovement:[],actedOnAt:{roomTime:Ee,by:le},collidedWith:{roomTime:Ee,by:le}}:{},...t.type==="monster"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",timeOfLastDirectionChange:Number.NEGATIVE_INFINITY,...t.config.which==="skiHead"||t.config.which==="turtle"||t.config.which==="elephantHead"||t.config.which==="cyberman"?{facing:Ce[t.config.startDirection]}:{facing:Ce.towards}}:{},...t.type==="pickup"?{disappearing:{on:"touch",byType:t.config.gives==="bag"||t.config.gives==="jumps"?["heels","headOverHeels"]:t.config.gives==="doughnuts"||t.config.gives==="hooter"||t.config.gives==="fast"?["head","headOverHeels"]:["head","heels","headOverHeels"]}}:{},...t.type==="movingPlatform"?{activated:t.config.activated==="on",everActivated:t.config.activated==="on",facing:Ce[t.config.startDirection]}:{},...t.type==="switch"?{setting:t.config.initialSetting,touchedOnProgression:-1}:{},...t.type==="block"?{disappearing:t.config.disappearing??null}:{},...t.type==="conveyor"?{disappearing:t.config.disappearing??null}:{},...t.type==="barrier"?{disappearing:t.config.disappearing??null}:{},...t.type==="lift"?{direction:"up",vels:{lift:fe}}:{},...t.type==="charles"?{facing:Ce.towards}:{},...t.type==="emitter"?{lastEmittedAtRoomTime:Ee,quantityEmitted:0}:{},...t.type==="firedDoughnut"?{disappearing:{on:"touch"},vels:{fired:t.config.direction?hs(Ce[t.config.direction],xp.firedDoughnut):fe}}:{}}},pi=F.h*2,kp=4,Nn=F.h*kp,ek=2,tk=2*F.w;function*rk(t,e){const{config:{direction:r},position:n}=t,o=to(r),s=vn(o),i=GS(t),a={...fe,[s]:i?-.5:0},l=1,c={[s]:i?-1:0},u=l*F.w,d={...fe,[s]:u},f=9,p=8,y=8;{const m={[o]:p,[s]:y,z:Nn};yield{...t,...tt,type:"doorFrame",id:`${e}/frameFar`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"far"},state:{...Me(),position:ke(D(n,{[o]:1.5},a,c)),stoodOnBy:le},aabb:D(m,d),renderAabb:m,renderAabbOffset:i?d:void 0}}{const m={[o]:f,[s]:y,z:Nn};yield{...t,...tt,type:"doorFrame",id:`${e}/frameNear`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"near"},state:{...Me(),position:ke(D(n,a,c)),stoodOnBy:le},aabb:D(m,d),renderAabb:m,renderAabbOffset:i?d:void 0}}{const m={[o]:2*F.w-f-p,[s]:y,z:Nn-pi};yield{...t,...tt,type:"doorFrame",id:`${e}/frameTop`,jsonItemId:e,config:{...t.config,inHiddenWall:i,part:"top"},state:{...Me(),position:D(ke(D(n,a,c)),{[o]:f,z:pi}),stoodOnBy:le},aabb:D(m,d),renderAabb:m,renderAabbOffset:i?d:void 0}}yield{...t,...tt,type:"blocker",id:`${e}/blockerAbove`,jsonItemId:e,config:{},renders:!1,state:{...Me(),position:D(ke(D(n,a,c)),{z:Nn}),stoodOnBy:le},aabb:D(ke({[o]:2,[s]:l,z:lo-kp-n.z}),{[s]:y}),renderAabb:fe,fixedZIndex:ur},yield{...t,...tt,type:"portal",id:`${e}/portal`,jsonItemId:e,config:{...jm(t.config,"toRoom","toDoor"),inHidden:i,relativePoint:ke({...fe,[s]:i?l+.25:-.25}),direction:Ce[r]},fixedZIndex:ur,state:{...Me(),position:D(ke(D(n,{[s]:i?-.5-l:.5})),{[o]:f}),stoodOnBy:le},aabb:{[o]:ek*F.w-f-p,[s]:u,z:pi}},n.z!==0&&(yield{...t,...tt,type:"doorLegs",id:`${e}/legs`,jsonItemId:e,config:{...t.config,inHiddenWall:i,style:"none",side:"away",height:n.z},renders:!0,shadowCastTexture:i?{textureId:"shadow.door.floatingThreshold.double.y",flipX:o==="x"}:void 0,state:{...Me(),position:{...ke(D(n,a,c)),z:0}},aabb:D(ke({[o]:2,[s]:.5,z:n.z}),d),renderAabb:i?D(ke({[o]:2,[s]:.5,z:.5})):void 0,renderAabbOffset:i?D({[o]:0,[s]:0,z:(n.z-.5)*F.h},{[s]:d[s]}):void 0,shadowOffset:{z:n.z*F.h,[s]:i?d[s]:void 0}}),yield{type:"stopAutowalk",id:`${e}/stopAutowalk`,jsonItemId:e,aabb:ke({[o]:2,[s]:0,z:2}),config:{},fixedZIndex:ur,state:{...Me(),position:ke(sn(n,hs(Ce[r],.75))),stoodOnBy:le}}}const uu={config:le,shadowCastTexture:"shadow.smallRound",aabb:Ie},du=()=>{const t=Fg(L.getState());return{action:"idle",jumped:!1,teleporting:null,autoWalk:!1,facing:Ce.towards,walkStartFacing:Ce.towards,walkDistance:0,vels:{walking:fe,gravity:fe,movingFloor:fe},switchedToAt:Ee,lastDiedAt:Ee,gameTime:0,jumpStartTime:Ee,lives:t?"infinite":qS,jumpStartZ:0}},nk=(t,e)=>{const r=Bg(L.getState());return t.config.which==="head"?{id:e,jsonItemId:e,type:"head",...tt,...uu,state:{...Me(),...cu(),...du(),hasHooter:!1,gameWalkDistance:0,fastStepsStartedAtDistance:Ee,shieldCollectedAt:Ee,doughnuts:r?"infinite":0,position:ya(t),stoodOnUntilRoomTime:Ee}}:{id:e,jsonItemId:e,type:"heels",...tt,...uu,state:{...Me(),...cu(),...du(),carrying:null,hasBag:!1,bigJumps:0,isBigJump:!1,shieldCollectedAt:Ee,position:ya(t),stoodOnUntilRoomTime:Ee}}},Zn=(t,e={})=>{const r=$m(e),n=sn(Tc,t);return sn(Ug(r,Tc),n)},Cp=1,ok=(t=lo)=>({x:F.w,y:F.d*Cp,z:t*F.h}),sk={x:F.w,y:0,z:_p},ik=(t=lo)=>({x:F.w*Cp,y:F.d,z:t*F.h}),ak={x:0,y:F.d,z:_p},lk=(t,e,r)=>{const{config:{direction:n},position:o}=e,s=$a(e.config),{height:i}=r,a=to(n),l=vn(a),c=Nm(n),u={...fe,[l]:c?-1:0};return{type:"wall",id:t,jsonItemId:t,config:e.config,aabb:Zn(a==="y"?ik(i):ok(i),s),renderAabb:c?fe:Zn(a==="y"?ak:sk,s),fixedZIndex:c?ur:void 0,state:{...Me(),position:ke(D(o,u)),stoodOnBy:le},shadowCastTexture:a==="y"?"shadow.wall.y":{textureId:"shadow.wall.y",flipX:!0}}},ck=3,hu=10,fu=.52,pu=.5,uk=(t,e,r)=>{const{config:{times:n},position:o}=e,s=D(o,{z:-3}),i={...n,z:ck};let a=s,l=i;const c=mt(Yo(r.items)).filter(f=>f.type==="door");if(o.z===0){const f={};for(const p of c){const{position:y,config:{direction:m}}=p;switch(m){case"towards":!f.towards&&y.y===s.y&&(l=D(l,{y:pu}),a=D(a,{y:-.5}),f.towards=!0);break;case"away":!f.away&&y.y===s.y+n.y&&(l=D(l,{y:fu}),f.away=!0);break;case"right":!f.right&&y.x===s.x&&(l=D(l,{x:pu}),a=D(a,{x:-.5}),f.right=!0);break;case"left":!f.left&&y.x===s.x+n.x&&(l=D(l,{x:fu}),f.left=!0);break}}}const u=ke(a),d=Zn(lr,l);return{type:"floor",id:t,jsonItemId:t,config:{...e.config,naturalFootprint:{aabb:Zn(lr,i),position:ke(s)}},aabb:d,renderAabb:{...d,z:hu},renderAabbOffset:{...fe,z:d.z-hu},shadowCastTexture:"shadow.fullBlock",state:{...Me(),position:u}}};function*fl(t,e,r,n=le,o={}){if(!n[t]&&!(e.type==="pickup"&&e.config.gives==="scroll"&&o[e.config.page]))switch(e.type){case"door":return yield*rk(e,t);case"player":{yield nk(e,t);return}case"wall":{yield lk(t,e,r);return}case"floor":{yield uk(t,e,r);return}case"sceneryCrown":if(!L.getState().gameMenus.planetsLiberated[e.config.planet])return;default:{const s=wp(e),i=e.config.times!==void 0?{aabb:Zn(s.aabb,e.config.times),renderAabb:void 0}:s;let a;try{a=QS(e)}catch(l){throw new Error(`loadItemFromJson: error creating initial state for jsonItem ${JSON.stringify(e,null,2)}`,{cause:l})}yield{...e,...tt,...i,id:t,jsonItemId:t,fixedZIndex:e.type==="emitter"?ur:void 0,shadowCastTexture:dk(e),config:e.config,state:a}}}}const dk=t=>{switch(t.type){case"lift":return"shadow.smallBlock";case"conveyor":return{textureId:"shadow.fullBlock",flipX:Gt(t.config.direction)==="x"};case"barrier":return{textureId:"shadow.barrier.y",flipX:t.config.axis==="x"};case"spring":case"firedDoughnut":case"slidingDeadly":return"shadow.smallRound";case"block":return t.config.style==="tower"?"shadow.smallRound":"shadow.fullBlock";case"pushableBlock":case"movingPlatform":case"hushPuppy":case"deadlyBlock":case"teleporter":case"spikes":return"shadow.fullBlock";case"portableBlock":return t.config.style==="drum"?"shadow.smallRound":"shadow.smallBlock";case"pickup":return t.config.gives==="scroll"?"shadow.scroll":"shadow.smallRound";case"ball":case"charles":case"monster":return"shadow.smallRound";case"slidingBlock":return t.config.style==="book"?"shadow.fullBlock":"shadow.smallRound"}},Cs=({aabb:t,state:{position:e}},{aabb:r,state:{position:n}})=>!(e.x+t.x<=n.x||e.x>=n.x+r.x)&&!(e.y+t.y<=n.y||e.y>=n.y+r.y)&&!(e.z+t.z<=n.z||e.z>=n.z+r.z),hk=(t,e)=>[...mt(e).filter(r=>t.id!==r.id&&Cs(t,r))];function*va(t,e){for(const r of e)t.id!==r.id&&Cs(t,r)&&(yield r)}function*fk(t,e){if(t.roomBelow!==void 0)for(const r of Re(e).filter(Li)){const{config:{naturalFootprint:n}}=r;yield{...tt,type:"portal",id:"floor/portal",fixedZIndex:ur,config:{toRoom:t.roomBelow,relativePoint:{x:n.aabb.x/2,y:n.aabb.y/2,z:n.aabb.z},direction:Ce.down},aabb:n.aabb,state:{...Me(),position:n.position},renders:!1}}if(t.roomAbove!==void 0)for(const r of Re(e).filter(Li)){const{config:{naturalFootprint:n}}=r;yield{...tt,type:"portal",id:"ceilingPortal",fixedZIndex:ur,config:{toRoom:t.roomAbove,relativePoint:{...t.ceilingRelativePoint!==void 0?ke(t.ceilingRelativePoint):{x:n.aabb.x/2,y:n.aabb.y/2},z:-12},direction:Ce.up},aabb:{...n.aabb,z:F.h},state:{...Me(),position:D(n.position,{z:n.aabb.z},{z:F.h*(t.height??lo)})}}}}const pk=(t,e,r,n)=>{const o=Math.max(0,Math.min(t.x+e.x,r.x+n.x)-Math.max(t.x,r.x)),s=Math.max(0,Math.min(t.y+e.y,r.y+n.y)-Math.max(t.y,r.y));return o*s},gu=({state:{position:t},aabb:e},{state:{position:r},aabb:n})=>pk(t,e,r,n),mu={stopAutowalk:5,portal:5,wall:5,blocker:5,doorLegs:5,sceneryPlayer:5,bubbles:5,switch:10,doorFrame:15,ball:18,block:20,barrier:20,floor:20,hushPuppy:20,teleporter:20,lift:30,movingPlatform:30,pushableBlock:30,portableBlock:30,sceneryCrown:30,slidingBlock:30,spring:30,joystick:40,charles:40,conveyor:40,head:50,heels:50,headOverHeels:50,pickup:80,firedDoughnut:90,spikes:98,slidingDeadly:100,moveableDeadly:100,deadlyBlock:100,monster:100,floatingText:200,particle:200,emitter:200},gk=(t,e)=>mu[t.type]-mu[e.type],mk=(t,e,r=.001)=>{if(!ln(e,t)||t.id===e.id)return!1;const{state:{vels:{gravity:{z:n}}}}=t;return n>0?!1:Cs({state:{position:D(t.state.position,{x:0,y:0,z:-1e-4})},aabb:{...t.aabb,z:r+_d},id:t.id},{state:{position:D(e.state.position,{x:0,y:0,z:e.aabb.z})},aabb:{...e.aabb,z:0},id:e.id})},yk=(t,e)=>{const n=[...mt(e).filter(s=>mk(t,s))];return n.length===0?void 0:n.reduce((s,i)=>{const a=gk(i,s);return a<0||a===0&&gu(t,i)>gu(t,s)?i:s})},vk=({above:t,below:e})=>{const r=e.state.stoodOnBy;if(!Object.isExtensible(r))throw new Error(`${t.id} can't stand on ${e.id} - its standingOn is not extensible`);t.state.standingOnItemId=e.id,r[t.id]=!0};function*bk(t,e,r,n){const o=Wg(t.items);for(const[s,i]of o)i.type==="player"&&!n||(yield*fl(s,i,t,e,r))}const yu=t=>mt(t).reduce((e,r)=>({...e,[r.id]:r}),{}),gi=({roomJson:t,roomPickupsCollected:e,scrollsRead:r,isNewGame:n=!1})=>{const o=yu(bk(t,e,r,n)),s={...yu(fk(t,o)),...o};for(const a of Re(s)){const c=hk(a,Hg(s)).find(u=>ln(a)&&ln(u)&&!(a.type==="wall"&&u.type==="wall"));c!==void 0&&console.error(`in room ${t.id} item ${a.id} @${JSON.stringify(a.state.position)} #${JSON.stringify(a.aabb)} is colliding with (solid item) ${c.id} @${JSON.stringify(c.state.position)} #${JSON.stringify(c.aabb)} on loading room ${t.id}`)}for(const a of Re(s).filter(zm)){const l=yk(a,Re(s).filter(c=>c.id!==a.id));l!==void 0&&vk({above:a,below:l})}return{...t,roomJson:t,items:s,roomTime:0}},wk=t=>()=>Sr(t),kA=wk(an),xk=Fd([an,t=>t.levelEditor.previewedEdits],(t,e)=>Sd(t,r=>{const n=kd(e);for(const[o,s]of n)s===null?delete r.items[o]:r.items[o]=s})),pl=g.createContext(null),_k=()=>{const[t,e]=g.useState(()=>gi({roomJson:an(L.getState()),roomPickupsCollected:le,scrollsRead:le,isNewGame:!0})),[r,n]=g.useState(t),o=de(an),s=de(xk);return g.useEffect(()=>{const i=gi({roomJson:o,roomPickupsCollected:le,scrollsRead:le,isNewGame:!0});if(e(i),o===s)n(i);else{const a=gi({roomJson:s,roomPickupsCollected:le,scrollsRead:le,isNewGame:!0});n(a)}},[o,s]),{roomState:t,roomStateWithPreviews:r}},Sk=({children:t})=>{const e=_k();return h.jsx(pl,{value:e,children:t})},Ep=()=>{const t=g.useContext(pl);if(t===null)throw new Error("no room state in context, or no context");return t.roomState},Pp=()=>{const t=g.useContext(pl);if(t===null)throw new Error("no room state in context, or no context");return t.roomStateWithPreviews},kk=t=>Re(t.items).filter(e=>ln(e)),Ap=(t,e)=>{const r=mt(kk(t));return e==="door"?r.filter(o=>o.type!=="wall"):r},Tp=({roomState:t,jsonItemIds:e,blockPositionDelta:r,timesDelta:n})=>{const o=Gl(Ul(a=>[a,t.roomJson.items[a]]),Ul(([a,l])=>[a,Sd(l,c=>{c.position=D(c.position,r),Mm(c,n)})]),my(function*([a,l]){for(const c of fl(a,l,t.roomJson))yield[a,l,c]}),Dm(([,,a])=>ln(a))),s=Array.from(o(e));return Gl(Ay(([,a,l])=>{const c=mt(Ap(t,a.type)).filter(u=>u.jsonItemId&&!e.includes(u.jsonItemId));for(const u of va(l,c))return console.warn(l.id,"colliding with static item",u.id),!0;for(const u of va(l,s.map(([d,f,p])=>p)))return console.warn(l.id,"colliding with other mutating item",u.id),!0;return!1}))(s)},Ck=({roomState:t,blockPosition:e,itemTool:r})=>{const n=fl("maybeAddedItem",{...r,position:e},t.roomJson),o=Array.from(Ap(t,r.type));return n.some(s=>{const i=va(s,o);return!Hd(i)})},Ek=()=>{const t=Be(),e=de(o=>o.levelEditor.selectedJsonItemIds.length>0),r=Ep(),n=o=>{if(r===null)return;const s=L.getState().levelEditor,{halfGridResolution:i,selectedJsonItemIds:a}=s,l=i?Zo(o,{x:.5,y:.5,z:1}):o;if(Tp({roomState:r,jsonItemIds:a,blockPositionDelta:l})){console.warn("nudge would collide");return}t(Td({jsonItemIds:a,positionDelta:l})),t(Rd())};return h.jsxs("div",{className:"flex flex-row flex-wrap gap-x-0 gap-y-oneScaledPix items-center",children:[h.jsx(H,{className:"inline-block mr-1 text-lightGrey leading-none",noSlitWords:!0,children:"move"}),h.jsxs("div",{className:"flex flex-row flex-wrap gap-oneScaledPix items-center",children:[h.jsx(ve,{small:!0,disabled:!e,onClick:()=>{n(Ce.left)},shortcutKeys:["ArrowLeft"],children:h.jsx(H,{className:"relative leading-none",children:"↖"})}),h.jsx(ve,{small:!0,disabled:!e,onClick:()=>{n(Ce.right)},shortcutKeys:["ArrowRight"],children:h.jsx(H,{className:"relative leading-none",children:"↘"})}),h.jsx(ve,{small:!0,disabled:!e,onClick:()=>{n(Ce.away)},shortcutKeys:["ArrowUp"],children:h.jsx(H,{className:"relative leading-none",children:"↗"})}),h.jsx(ve,{small:!0,disabled:!e,onClick:()=>{n(Ce.towards)},shortcutKeys:["ArrowDown"],children:h.jsx(H,{className:"relative leading-none",children:"↙"})}),h.jsx(ve,{small:!0,disabled:!e,onClick:()=>{n(Ce.up)},shortcutKeys:["⇧ArrowUp"],children:h.jsx(H,{className:"relative leading-none",children:"⬆"})}),h.jsx(ve,{small:!0,disabled:!e,onClick:()=>{n(Ce.down)},shortcutKeys:["⇧ArrowDown"],children:h.jsx(H,{className:"relative leading-none",children:"⬇"})})]})]})},Pk=()=>{const t=de(({levelEditor:n})=>{const{editingRoomIdHistory:o}=n;return o.back.length>0}),e=de(({levelEditor:n})=>{const{editingRoomIdHistory:o}=n;return o.forward.length>0}),r=Be();return h.jsxs(h.Fragment,{children:[h.jsx(ve,{disabled:!t,onClick:()=>{r(Lm())},shortcutKeys:["⇧<"],children:h.jsx("span",{className:"sprite texture-hud_char_lt relative"})}),h.jsx(ve,{disabled:!e,onClick:()=>{r(Bm())},shortcutKeys:["⇧>"],children:h.jsx("span",{className:"sprite texture-hud_char_gt relative"})})]})},Ak=({className:t})=>{const e=Be();return h.jsx(br,{className:t,label:"coalesce",value:de(r=>r.levelEditor.autoCoalesce),onChange:r=>{e(Fm(r))},shortcutKeys:["C"]})},mi=()=>h.jsx("div",{className:"w-[calc(var(--block)-1px)]"}),Tk=()=>{const t=de(n=>n.levelEditor.campaignInProgress),e=de(n=>n.levelEditor.currentlyEditingRoomId),r=Be();return h.jsxs("div",{className:"scale-editor flex w-full h-full text-white bg-metallicBlueHalfbrite pb-1 gap-1 flex-wrap justify-start overflow-auto",children:[h.jsx("div",{className:Ae,children:h.jsx(US,{className:"w-full mb-1"})}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full",children:"Campaign"}),h.jsx(DS,{}),h.jsx(mi,{}),h.jsx(LS,{}),h.jsx(BS,{})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full pt-1",children:"Room"}),h.jsx(Pk,{}),h.jsx(mi,{}),h.jsx(HS,{}),h.jsx(Wf,{value:e,campaign:t,onSelect:n=>{r(Bi(n))},triggerButtonClassName:"w-full"}),h.jsx("div",{className:"h-1 w-full"}),h.jsx(d0,{}),h.jsx(u0,{}),h.jsx("div",{className:"h-half w-full"}),h.jsx(w0,{}),h.jsx(x0,{})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full pt-1",children:"Edit"}),h.jsxs("div",{className:Ae,children:[h.jsx(c0,{}),h.jsx(_0,{})]}),h.jsx(g0,{}),h.jsx(mi,{}),h.jsx(a0,{}),h.jsx(b0,{}),h.jsx(Ek,{}),h.jsx("div",{className:"h-1 w-full"}),h.jsxs("div",{className:"flex flex-row justify-between flex-wrap gap-x-2",children:[h.jsx(l0,{}),h.jsx(m0,{}),h.jsx(Ak,{})]})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full pt-1",children:"Blocks"}),h.jsx(j,{itemTool:{type:"block",config:{style:"organic"}},shortcutKeys:["B"],children:h.jsx("span",{className:`sprite texture-block_organic ${U}`})}),h.jsx(j,{itemTool:{type:"block",config:{style:"organic",disappearing:{on:"stand"}}},children:h.jsx(Ao,{iconClassName:ge("texture-block_organic_disappearing")})}),h.jsx(j,{itemTool:{type:"block",config:{style:"artificial"}},children:h.jsx("span",{className:`sprite texture-block_artificial ${U}`})}),h.jsx(j,{itemTool:{type:"block",config:{style:"artificial",disappearing:{on:"stand"}}},children:h.jsx(Ao,{iconClassName:ge("texture-block_artificial_disappearing")})}),h.jsx(j,{itemTool:{type:"block",config:{style:"tower"}},children:h.jsx("span",{className:`sprite texture-tower ${U}`})}),h.jsx(j,{itemTool:{type:"block",config:{style:"book"}},children:h.jsx("span",{className:`sprite texture-book_x ${U}`})}),h.jsxs(Tn,{children:[h.jsx(j,{itemTool:{type:"barrier",config:{axis:"x"}},children:h.jsx("span",{className:`sprite texture-barrier_x ${U}`})}),h.jsx(j,{itemTool:{type:"barrier",config:{axis:"y"}},children:h.jsx("span",{className:`sprite texture-barrier_y ${U}`})}),h.jsx(j,{itemTool:{type:"barrier",config:{axis:"x",disappearing:{on:"touch"}}},children:h.jsx(Ao,{iconClassName:ge("texture-barrier_x")})}),h.jsx(j,{itemTool:{type:"barrier",config:{axis:"y",disappearing:{on:"touch"}}},children:h.jsx(Ao,{iconClassName:ge("texture-barrier_y")})})]})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full",children:"Monsters"}),h.jsx(j,{itemTool:{type:"monster",config:{which:"dalek",movement:"patrol-randomly-diagonal",activated:"on"}},children:h.jsx("span",{className:`sprite texture-dalek_1 [button:hover_&]:texture-animated-dalek" ${U}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"cyberman",activated:"on",movement:"towards-on-shortest-axis-xy4",startDirection:"towards"}},children:h.jsx(xt,{topClasses:"texture-cyberman_towards [button:hover_&]:texture-cyberman_right",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"skiHead",style:"greenAndPink",activated:"on",movement:"back-forth",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-skiHead_greenAndPink_towards [button:hover_&]:texture-skiHead_greenAndPink_right ${U}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"helicopterBug",activated:"on",movement:"patrol-randomly-xy8"}},children:h.jsx("span",{className:`sprite texture-helicopterBug_1 [button:hover_&]:texture-animated-helicopterBug ${U}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"turtle",activated:"on",movement:"clockwise",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-turtle_towards_1 [button:hover_&]:texture-animated-turtle_right ${U}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"homingBot",activated:"on",movement:"towards-tripped-on-axis-xy4"}},children:h.jsx("span",{className:`sprite texture-headlessBase [button:hover_&]:texture-headlessBase_all ${U}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"computerBot",activated:"on",movement:"patrol-randomly-xy4-and-reverse"}},children:h.jsx(xt,{topClasses:"texture-computerBot_towards [button:hover_&]:texture-computerBot_right"})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"bubbleRobot",activated:"on",movement:"patrol-randomly-xy8"}},children:h.jsx(xt,{topClasses:ge("texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"),bottomClasses:ge("texture-headlessBase")})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"monkey",activated:"on",movement:"patrol-randomly-xy4"}},children:h.jsx(xt,{topClasses:"texture-monkey_towards [button:hover_&]:texture-monkey_right"})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"elephant",activated:"on",movement:"patrol-randomly-xy4"}},children:h.jsx(xt,{topClasses:"texture-elephant_towards [button:hover_&]:texture-elephant_right"})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"elephantHead",activated:"on",movement:"turn-to-player",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-elephant_towards [button:hover_&]:texture-elephant_right ${U}`})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"emperorsGuardian",activated:"while-player-near",movement:"towards-analogue-unless-planet-crowns"}},className:"inline relative",children:h.jsx(xt,{topClasses:"texture-ball",bottomClasses:"texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold"})}),h.jsx(j,{itemTool:{type:"monster",config:{which:"emperor",activated:"while-player-near",movement:"towards-analogue"}},children:h.jsx("span",{className:`sprite texture-bubbles_cold_2 [button:hover_&]:texture-animated-bubbles_cold ${U}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full",children:"Pickups"}),h.jsxs(Tn,{children:[h.jsx(j,{itemTool:{type:"pickup",config:{gives:"extra-life"}},children:h.jsx(wt,{iconClasses:"texture-whiteRabbit",text:"2"})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"shield"}},children:h.jsx(wt,{iconClasses:"texture-whiteRabbit",text:"🛡"})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"jumps"}},children:h.jsx(wt,{iconClasses:"texture-whiteRabbit",text:"♨"})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"fast"}},children:h.jsx(wt,{iconClasses:"texture-whiteRabbit",text:"⚡"})})]}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"bag"}},children:h.jsx("span",{className:`sprite texture-bag ${U}`})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"hooter"}},children:h.jsx("span",{className:`sprite texture-hooter ${U}`})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"doughnuts"}},children:h.jsx("span",{className:`sprite texture-doughnuts ${U}`})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"reincarnation"}},children:h.jsx("span",{className:`sprite texture-fish_1 [button:hover_&]:texture-animated-fish ${U}`})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"crown",planet:"blacktooth"}},children:h.jsx("span",{className:`sprite texture-crown_blacktooth ${U}`})}),h.jsx(j,{itemTool:{type:"pickup",config:{gives:"scroll",page:"blacktooth"}},children:h.jsx("span",{className:`sprite texture-scroll ${U}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full",children:"deadly"}),h.jsxs(Tn,{children:[h.jsx(j,{itemTool:{type:"deadlyBlock",config:{style:"volcano"}},children:h.jsx("span",{className:`sprite texture-volcano_1 [button:hover_&]:texture-animated-volcano ${U}`})}),h.jsx(j,{itemTool:{type:"deadlyBlock",config:{style:"toaster"}},children:h.jsx("span",{className:`sprite texture-toaster_off ${U}`})})]}),h.jsx(j,{itemTool:{type:"slidingDeadly",config:{style:"spikyBall",startingPhase:1}},children:h.jsx("span",{className:`sprite texture-spikyBall_1 [button:hover_&]:texture-spikyBall_2 ${U}`})}),h.jsx(j,{itemTool:{type:"spikes",config:le},children:h.jsx("span",{className:`sprite texture-spikes ${U}`})}),h.jsx(j,{itemTool:{type:"moveableDeadly",config:{style:"deadFish"}},children:h.jsx("span",{className:`sprite texture-fish_1 ${U}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full",children:"control"}),h.jsx(j,{itemTool:{type:"charles",config:le},children:h.jsx(xt,{topClasses:"texture-charles_towards [button:hover_&]:texture-charles_right"})}),h.jsx(j,{itemTool:{type:"joystick",config:{controls:["charles"]}},children:h.jsx("span",{className:`sprite texture-joystick ${U}`})}),h.jsx(j,{itemTool:{type:"switch",config:{initialSetting:"left",type:"in-room",modifies:Qo}},children:h.jsx("span",{className:`sprite texture-switch_left [button:hover_&]:texture-switch_right ${U}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full",children:"movable"}),h.jsx(j,{itemTool:{type:"spring",config:{}},children:h.jsx("span",{className:`sprite texture-spring_released [button:hover_&]:texture-spring_compressed ${U}`})}),h.jsxs(Tn,{children:[h.jsx(j,{itemTool:{type:"portableBlock",config:{style:"cube"}},children:h.jsx("span",{className:`sprite texture-cube ${U}`})}),h.jsx(j,{itemTool:{type:"portableBlock",config:{style:"drum"}},children:h.jsx("span",{className:`sprite texture-drum ${U}`})}),h.jsx(j,{itemTool:{type:"portableBlock",config:{style:"sticks"}},children:h.jsx("span",{className:`sprite texture-sticks ${U}`})})]}),h.jsx(j,{itemTool:{type:"pushableBlock",config:{}},children:h.jsx("span",{className:`sprite texture-stepStool ${U}`})}),h.jsx(j,{itemTool:{type:"ball",config:le},children:h.jsx("span",{className:`sprite texture-ball ${U}`})}),h.jsx(j,{itemTool:{type:"slidingBlock",config:{style:"puck"}},children:h.jsx("span",{className:`sprite texture-puck ${U}`})}),h.jsx(j,{itemTool:{type:"slidingBlock",config:{style:"book"}},children:h.jsx("span",{className:`sprite texture-book_y ${U}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full",children:"misc."}),h.jsxs(j,{itemTool:{type:"lift",config:{top:11,bottom:0}},className:"inline relative",children:[h.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_static ${U} [button:active_&]:top-oneScaledPix`}),h.jsx("span",{className:`sprite inline-block absolute top-0 left-0 texture-lift_1 [button:hover_&]:texture-animated-lift ${U} [button:active_&]:top-oneScaledPix`})]}),h.jsxs(Tn,{children:[h.jsx(j,{itemTool:{type:"conveyor",config:{direction:"away"}},children:h.jsx(wt,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-conveyor_y",text:"↗"})}),h.jsx(j,{itemTool:{type:"conveyor",config:{direction:"towards"}},children:h.jsx(wt,{iconClasses:"texture-conveyor_y_1 [button:hover_&]:texture-animated-reversed-conveyor_y",text:"↙"})}),h.jsx(j,{itemTool:{type:"conveyor",config:{direction:"left"}},children:h.jsx(wt,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-conveyor_x",text:"↖"})}),h.jsx(j,{itemTool:{type:"conveyor",config:{direction:"right"}},children:h.jsx(wt,{iconClasses:"texture-conveyor_x_1 [button:hover_&]:texture-animated-reversed-conveyor_x",text:"↘"})})]}),h.jsx(j,{itemTool:{type:"teleporter",config:{toRoom:"to?",toPosition:fe}},children:h.jsx("span",{className:`sprite texture-teleporter ${U}`})}),h.jsx(j,{itemTool:{type:"movingPlatform",config:{movement:"clockwise",activated:"on",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-sandwich ${U}`})}),h.jsx(j,{itemTool:{type:"hushPuppy",config:{}},children:h.jsx("span",{className:`sprite texture-hushPuppy ${U}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full",children:"Structure"}),h.jsx(y0,{}),h.jsx(v0,{}),h.jsx(j,{itemTool:{type:"floor",config:{floorType:"standable",scenery:"blacktooth",times:{x:1,y:1}}},children:h.jsx("span",{className:`sprite texture-blacktooth_floor ${U}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full",children:"Player"}),h.jsx(j,{itemTool:{type:"player",config:{which:"head"}},children:h.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${U}`})}),h.jsx(j,{itemTool:{type:"player",config:{which:"heels"}},children:h.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${U}`})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full",children:"NPC’s"}),h.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"head",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right ${U}`})}),h.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"heels",startDirection:"towards"}},children:h.jsx("span",{className:`sprite texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right ${U}`})}),h.jsx(j,{itemTool:{type:"sceneryPlayer",config:{which:"headOverHeels",startDirection:"towards"}},children:h.jsx(xt,{topClasses:"texture-head_walking_towards_2 [button:hover_&]:texture-animated-head_walking_right",bottomClasses:"texture-heels_walking_towards_2 [button:hover_&]:texture-animated-heels_walking_right"})})]}),h.jsxs("div",{className:Ae,children:[h.jsx(H,{className:"w-full pt-2",children:"debug"}),h.jsx(n0,{})]})]})},pn=(t,e)=>({get bottomCentre(){return this.c000},get topLeft(){return this.c101},get topRight(){return this.c011},get c000(){return K(t)},get c001(){return K(D(t,{z:e.z}))},get c010(){return K(D(t,{y:e.y}))},get c011(){return K(D(t,{y:e.y,z:e.z}))},get c100(){return K(D(t,{x:e.x}))},get c101(){return K(D(t,{x:e.x,z:e.z}))},get c110(){return K(D(t,{x:e.x,y:e.y}))},get c111(){return K(D(t,{x:e.x,y:e.y,z:e.z}))},projectCorner(r){return K(D(t,{x:r.x*e.x,y:r.y*e.y,z:r.z*e.z}))}}),yi=1e-5,vu=-1,On=(t,e,r,n,o)=>n-o>t&&r<e-o,Rk=0,Rp=1,Ip=2,Op=3,Ik=(t,e,r,n)=>{const{topLeft:o,topRight:s,bottomCentre:i}=pn(t,e),{topLeft:a,topRight:l,bottomCentre:c}=pn(r,n),u=s.y-s.x/2,d=i.y-i.x/2,f=l.y-l.x/2,p=c.y-c.x/2,y=o.y+o.x/2,m=i.y+i.x/2,v=a.y+a.x/2,b=c.y+c.x/2,_=o.x,w=s.x,x=a.x,k=l.x,C=On(u,d,f,p,yi),S=On(y,m,v,b,yi),N=On(_,w,x,k,yi);return C&&S&&N?Rp:S&&N&&On(u,d,f,p,vu)?Ip:C&&N&&On(y,m,v,b,vu)?Op:Rk},Ok=(t,e,r,n)=>{for(const o of Gg){const s=t[o],i=s+e[o],a=r[o],l=a+n[o];if(i<=a)return 1*(o==="z"?-1:1);if(s>=l)return-1*(o==="z"?-1:1)}return bu(r)-bu(t)},jk=(t,e)=>{if(t.fixedZIndex!==void 0||e.fixedZIndex!==void 0)return 0;const r=t.renderAabb||t.aabb,n=e.renderAabb||e.aabb,o=t.renderAabbOffset?D(t.state.position,t.renderAabbOffset):t.state.position,s=e.renderAabbOffset?D(e.state.position,e.renderAabbOffset):e.state.position;switch(Ik(o,r,s,n)){case Rp:return Ok(o,r,s,n);case Ip:return It(o.y,s.y+n.y)&&It(o.z,s.z+n.z)?1:It(s.y,o.y+r.y)&&It(s.z,o.z+r.z)?-1:0;case Op:return It(o.x,s.x+n.x)&&It(o.z,s.z+n.z)?1:It(s.x,o.x+r.x)&&It(s.z,o.z+r.z)?-1:0;default:return 0}},bu=t=>t.x+t.y-t.z;class Vo extends Error{constructor(e,r,n){super(`CyclicDependencyError: .cyclicDependency property of this error has nodes as an array. ${e.join(" -> ")}`,n),this.cyclicDependency=e,this.hasClosedCycle=r}}const $k=t=>{const e=Nk(t);let r=e.length,n=r;const o=new Array(r),s={},i=zk(e);for(;n--;)s[n]||a(e[n],n,new Set);return o;function a(l,c,u){if(u.has(l))throw new Vo([l],!1);if(s[c])return;s[c]=!0;const d=t.get(l)||new Set,f=Array.from(d);if(c=f.length){u.add(l);do{const p=f[--c];try{a(p,i.get(p),u)}catch(y){throw y instanceof Vo?y.hasClosedCycle?y:new Vo([l,...y.cyclicDependency],y.cyclicDependency.includes(l)):y}}while(c);u.delete(l)}o[--r]=l}};function Nk(t){const e=new Set;for(const[r,n]of t.entries()){e.add(r);for(const o of n)e.add(o)}return Array.from(e)}function zk(t){const e=new Map;for(let r=0,n=t.length;r<n;r++)e.set(t[r],r);return e}const wu=(t,e,r)=>{t.has(e)||t.set(e,new Set),t.get(e).add(r)},$o=(t,e,r)=>{const n=t.get(e);n!==void 0&&(n?.delete(r),n.size===0&&t.delete(e))},jp=(t,e=new Set(Yo(t)),r=new Map)=>{const n=new Map;for(const[o,s]of r)if(!t[o])r.delete(o);else for(const i of s)t[i]||$o(r,o,i);for(const o of e)if(o.fixedZIndex===void 0)for(const s of Yo(t)){if(s.fixedZIndex!==void 0||n.get(s)?.has(o)||o===s)continue;const i=jk(o,s);if(wu(n,o,s),i===0){$o(r,o.id,s.id),$o(r,s.id,o.id);continue}const a=i>0?o.id:s.id,l=i>0?s.id:o.id;wu(r,a,l),$o(r,l,a)}return r},gl=(t,e,r=3)=>{try{return{order:$k(t),impossible:!1}}catch(n){if(n instanceof Vo){const o=n.cyclicDependency;return t.get(o[0])?.delete(o[1]),console.warn("cyclc dependency detected: ",o.join(" --front-of--> "),`breaking link ${o[0]} --front-of--> ${o[1]}`),{order:gl(t,e,r-1).order,impossible:!0}}else throw n}};class Mk{constructor(e,r){this.renderContext=e,this.appearance=r,this.output=new te({label:"AppearanceRenderer"})}#e;output;destroy(){this.output.destroy({children:!0})}tick(e){const r=this.appearance({renderContext:this.renderContext,currentRendering:this.#e,tickContext:e});r!=="no-update"&&(this.output.children.at(0)!==r.output&&(this.#e?.output&&this.output.removeChild(this.#e.output),r.output!==void 0&&this.output.addChild(r.output)),this.#e=r)}}class $p extends Mk{}const xu=(t,e)=>{e.poly([K({}),K({x:t.x}),K({x:t.x,y:t.y}),K({y:t.y})]).poly([K({}),K({z:t.z}),K({y:t.y,z:t.z}),K({y:t.y})]).poly([K({x:t.x}),K({x:t.x,z:t.z}),K(t),K({x:t.x,y:t.y})]).poly([K({z:t.z}),K({x:t.x,z:t.z}),K({x:t.x,y:t.y,z:t.z}),K({y:t.y,z:t.z})])},_u=(t,e)=>{const r=new ut;return xu(t,r),r.stroke({width:.5,color:e,alpha:1}),r.eventMode="static",r.on("pointerenter",()=>{r.fill({color:e,alpha:.5})}),r.on("pointerleave",()=>{r.clear(),xu(t,r),r.stroke({width:.5,color:e,alpha:1})}),r},Dk={head:"rgba(255,184,0)",wall:"rgba(128,200,0)",portal:"rgba(255,0,255)",pickup:"rgba(0,196,255)",emitter:"rgba(0,255,255)",stopAutowalk:"rgba(255,128,128)",floatingText:"rgba(128,0,255)"};class Lk{constructor(e){this.renderContext=e;const{item:r}=e,n=Dk[r.type]??"rgba(255,255,255)";if(this.#e=new te({label:`ItemBoundingBoxRenderer ${r.id}`}),ro("portal")(r)){const s=K(r.config.relativePoint);this.#e.addChild(new ut().circle(s.x,s.y,5).stroke(n)),this.#e.addChild(new ut().circle(s.x,s.y,2).fill(n))}if(this.#e.addChild(new ut({label:"objectOrigin"}).circle(0,0,2).fill(n)),this.#e.addChild(_u(r.aabb,n)),r.renderAabb){const s="rgba(184, 184, 255)",i=_u(r.renderAabb,s);if(r.renderAabbOffset){const a=K(r.renderAabbOffset);i.position.set(a.x,a.y),i.circle(0,0,2).fill(s)}this.#e.addChild(i)}this.#e.eventMode="static";let o;this.#e.on("pointerenter",()=>{if(o!==void 0)return;const s=`${r.id} ${r.type}
@(${r.state.position.x}, ${r.state.position.y}, ${r.state.position.z})}
#(${r.aabb.x}, ${r.aabb.y}, ${r.aabb.z})}`;this.#e.addChild(o=new Wy({text:s,style:{fill:n,fontSize:6,fontFamily:"Menlo"}})),o.resolution=4}),this.#e.on("pointerleave",()=>{o!==void 0&&(this.#e.removeChild(o),o=void 0)}),e.frontLayer.attach(this.#e)}#e;tick(){}destroy(){this.#e.destroy({children:!0})}get output(){return this.#e}}class Bk{constructor(e,r){this.renderContext=e,this.wrappedRenderer=r,this.#e=new te({label:`ItemPositionRenderer ${e.item.id}`,children:[r.output]}),this.#t()}#e;#t(){const e=K(this.renderContext.item.state.position);this.#e.x=e.x,this.#e.y=e.y}tick(e){this.wrappedRenderer?.tick(e),e.movedItems.has(this.renderContext.item)&&this.#t()}destroy(){this.#e.destroy({children:!0}),this.wrappedRenderer?.destroy()}get output(){return this.#e}}const Su={x:.5,y:1},ku=t=>typeof t!="string"&&Object.hasOwn(t,"animationId"),ba=t=>{if(typeof t=="string")return ba({textureId:t});{const{anchor:e,flipX:r,pivot:n,x:o,y:s,filter:i,times:a,label:l}=t;let c;if(ku(t)?c=Fk(t):c=new mn(Wt().textures[t.textureId]),t.hasOwnProperty("times")){const u={x:1,y:1,z:1,...a},d=new te({label:l??"timesXyz"});for(let{x:f}=u;f>=1;f--)for(let{y:p}=u;p>=1;p--)for(let y=1;y<=u.z;y++){const m={...t,textureId:t.textureId??t.textureIdCallback?.(f-1,p-1,y-1),label:`(${f},${p},${y})`};delete m.times;const v=ba(m),b=wr({x:f-1,y:p-1,z:y-1});v.x+=b.x,v.y+=+b.y,d.addChild(v)}return d}if(e===void 0&&n===void 0)if(ku(t))c.anchor=Su;else{const u=Wt().data.frames[t.textureId];if(u===void 0)throw new Error(`no spritesheet entry for textureId "${t.textureId}"`);const d=u.frame;d.pivot!==void 0?c.pivot=d.pivot:c.anchor=Su}else e!==void 0&&(c.anchor=e),n!==void 0&&(c.pivot=n);return o!==void 0&&(c.x=o),s!==void 0&&(c.y=s),i!==void 0&&(c.filters=i),l!==void 0&&(c.label=l),c.eventMode="static",r===!0&&(c.scale.x=-1),c}},W=ba;function Fk({animationId:t,reverse:e,playOnce:r,paused:n,randomiseStartFrame:o}){const s=Wt().animations[t],a=(n?[s[0]]:s).map(c=>({texture:c,time:qg}));e&&a.reverse();const l=new qn(a);return l.animationSpeed=_r.animations[t].animationSpeed,l.gotoAndPlay(o?Math.floor(Math.random()*a.length):0),r!==void 0&&(l.loop=!1,l.onComplete=()=>{l.stop(),r==="and-destroy"&&(l.visible=!1)}),l}const Np=(t,e)=>{const r=e.getLocalBounds(),n=Ma.create({width:r.maxX-r.minX,height:r.maxY-r.minY});return e.x-=r.minX,e.y-=r.minY,t.render({container:e,target:n}),new mn({texture:n,label:"shadowMaskSprite (of renderTexture)",pivot:{x:-r.minX,y:-r.minY}})},Es=(t,e,r)=>{const n=r&&{x:r.x??1,y:r.y??1},o=W({...typeof e=="string"?{textureId:e}:e,times:n});return o instanceof mn?o:Np(t,o)},Nt=t=>Oe(({renderContext:{item:e}})=>Id(e)?W({...typeof t=="string"?{textureId:t}:t,times:Na(e)}):W(t)),Xe=t=>Oe(({renderContext:{item:e,general:{pixiRenderer:r}}})=>{if(Id(e))return Es(r,t,Na(e));{const n=W(t);return n instanceof mn?n:Np(r,n)}}),Oe=t=>({renderContext:e,currentRendering:r,tickContext:n})=>r===void 0?{output:t({renderContext:e,currentRendering:void 0,tickContext:n}),renderProps:le}:"no-update",zt=t=>({renderContext:{general:{pixiRenderer:e},item:r},currentRendering:n})=>{if(n===void 0){const o=Na(r),s={output:Es(e,t(r.config),o),renderProps:le};return o&&(s.output.y-=((o.z??1)-1)*F.h),s}else return"no-update"},co=(t,e)=>mt(fs(t)).map(r=>{const n=e.items[r];if(n===void 0)throw new Error(`item in stoodOnBy "${r}" is not in the room`);return n});ro("head");const Uk=ro("heels"),Hk=ro("headOverHeels"),Wk=t=>{if(Uk(t))return t.state;if(Hk(t))return t.state.heels},Gk=1e3/25,zp=t=>{const e=_r.animations[t],r=e.length,{animationSpeed:n}=e;return r*Gk/n};zp("bubbles.white");zp("head.fadeOut");const ml=({config:{activatedOnStoreValue:t}})=>t===void 0?!0:Aa(L.getState(),t),qk=({renderContext:{general:{pixiRenderer:t},item:e,room:r},currentRendering:n})=>{const{state:{stoodOnBy:o},config:{times:s}}=e,i=n?.renderProps,a=ml(e),l=a&&co(o,r).find(za)!==void 0;return i===void 0||a!==i.activated||l!==i.flashing?{output:Es(t,{textureId:l?"shadowMask.teleporter.flashing":a?"shadowMask.teleporter":"shadowMask.fullBlock"},s),renderProps:{flashing:l,activated:a}}:"no-update"},vi=(t,e=1)=>({renderContext:{item:{state:{facing:r}}},currentRendering:n})=>{const o=n?.renderProps,s=Ta(r)??"towards";if(!(o===void 0||s!==o.facingXy4))return"no-update";const a=W(s==="left"||s==="away"?`shadowMask.${t}.away`:`shadowMask.${t}.right`);return a.y=-(F.h*(e-1)),a.scale.x=s==="away"||s==="right"?1:-1,{output:a,renderProps:{facingXy4:s}}},Cu={lift:Xe("shadowMask.smallBlock"),conveyor:zt(({direction:t})=>({textureId:"shadowMask.conveyor",flipX:Gt(t)==="x"})),doorLegs:zt(({direction:t})=>({textureId:t==="right"||t==="towards"?"shadowMask.door.floatingThreshold.double.y":"shadowMask.door.legs.threshold.double.y",flipX:Gt(t)==="y"})),teleporter:qk,floor:"no-mask",barrier:zt(({axis:t})=>({textureId:"shadowMask.barrier.y",flipX:t==="x"})),spring:Xe("shadowMask.smallRound"),block:zt(({style:t})=>t==="tower"?"shadowMask.tower":"shadowMask.fullBlock"),pushableBlock:Xe("shadowMask.stepStool"),movingPlatform:Xe("shadowMask.fullBlock"),hushPuppy:Xe("shadowMask.hushPuppy"),portableBlock:zt(({style:t})=>t==="drum"?"shadowMask.smallRound":"shadowMask.smallBlock"),slidingBlock:zt(({style:t})=>t==="book"?"shadowMask.fullBlock":"shadowMask.smallRound"),deadlyBlock:zt(({style:t})=>t==="volcano"?"shadowMask.volcano":"shadowMask.toaster"),spikes:Xe("shadowMask.spikes"),switch:Xe("shadowMask.switch"),pickup:zt(({gives:t})=>{switch(t){case"scroll":return"shadowMask.scroll";case"doughnuts":return"shadowMask.doughnuts";case"fast":case"extra-life":case"jumps":case"shield":return"shadowMask.whiteRabbit";default:return"blank"}}),slidingDeadly:Xe("shadowMask.smallRound"),ball:Xe("shadowMask.ball"),"monster.dalek":Xe("shadowMask.dalek"),"monster.turtle":vi("turtle"),"monster.skiHead":vi("skiHead"),"monster.homingBot":Xe("shadowMask.smallRound"),joystick:Xe("shadowMask.joystick"),charles:vi("charles",2)},Vk=t=>{switch(t.type){case"monster":return Cu[`monster.${t.config.which}`];case"floor":return t.config.floorType==="none"?void 0:"no-mask";default:return Cu[t.type]}},Kk=9999,Xk=new Ly({alpha:1-Bn});class Jk{constructor(e,r){if(this.renderContext=e,this.#e.filters=Xk,r!=="no-mask")if(this.#r=new $p(e,r),e.item.shadowOffset===void 0)this.#e.addChild(this.#r.output);else{const n=new te({label:"shadowMaskOffset",...K(e.item.shadowOffset),children:[this.#r.output]});this.#e.addChild(n)}this.#e.addChild(this.#t)}#e=new te({label:"ItemShadowRenderer"});#t=new te({label:"shadows"});#r;#n={};get#o(){return L.getState().gameMenus.userSettings.displaySettings.showShadowMasks}#s(e){if(this.#r===void 0)return;const r=this.#r.output.children.at(0);this.#r.tick(e);const n=this.#r.output.children.at(0);if(n===void 0||!(n instanceof mn)){const{item:o}=this.renderContext;throw new Error(`ItemShadowRenderer: this.#shadowMaskRenderer didn't create a sprite for item "${o.id}" of type "${o.type}". Have got ${n}`)}r!==n&&(this.#o?this.renderContext.frontLayer.attach(n):this.#e.mask=n)}destroy(){this.#e.destroy(!0),this.#r?.destroy()}tick(e){if(this.#t.parent===null)throw new Error("shadow container not in scene graph");const{movedItems:r,progression:n}=e,{item:o,general:{pixiRenderer:s},room:i}=this.renderContext,a=r.has(o),l=o.state.position.z+o.aabb.z,c=Re(i.items).filter(function(y){return y.shadowCastTexture!==void 0}),u={id:o.id,state:{position:{...o.state.position,z:l}},aabb:{...o.aabb,z:Kk}},d=Object.groupBy(c,p=>{const y=this.#n[p.id]!==void 0,m=r.has(p);return!a&&!m?y?"keepUnchanged":"noShadow":Cs(u,p)?y?"update":"create":"noShadow"});for(const p of Dl(d.keepUnchanged,d.update))this.#n[p.id].renderedOnProgression=n;if(d.create)for(const p of d.create){const{times:y}=p.config,m=Es(s,p.shadowCastTexture,y);m.label=p.id,this.#t.addChild(m),this.#n[p.id]={sprite:m,renderedOnProgression:n}}for(const p of Dl(d.create,d.update)){const{sprite:y}=this.#n[p.id],m=K({...Ln(hr(p.state.position,o.state.position),p.shadowOffset??en),z:o.aabb.z});y.x=m.x,y.y=m.y}for(const[p,{sprite:y,renderedOnProgression:m}]of kd(this.#n))m!==n&&(y.destroy(),delete this.#n[p]);const f=(d.keepUnchanged?.length??0)+(d.update?.length??0)+(d.create?.length??0)>0;this.#e.visible=f,f&&this.#s(e)}get output(){return this.#e}}const Yk=t=>{const e=Vk(t.item);return e===void 0?void 0:new Jk(t,e)};class Zk{constructor(e,r){this.renderContext=e,this.componentRenderers=r,this.output={graphics:r.graphics?.output,sound:r.sound?.output}}output;tick(e){this.componentRenderers.graphics?.tick(e),this.componentRenderers.sound?.tick(e)}destroy(){this.componentRenderers.graphics?.destroy(),this.componentRenderers.sound?.destroy()}}const ae=new window.AudioContext,wa=()=>{throw new Error(`sounds not loaded - only call this from inside code 
      (like in a render loop) that is protected and only executed once 
      loading has happened`)},je=t=>{const e=typeof t=="string"?{soundId:t}:t,{playbackRate:r=1,soundId:n,connectTo:o,loop:s=!1,varyPlaybackRate:i=!1,randomiseStartPoint:a=!1}=e,l=ae.createBufferSource(),c=wa()[n];return l.buffer=c,l.loop=s,l.playbackRate.value=i?r-.05+Math.random()*.1:r,s&&a?l.start(0,c.duration*Math.random()):l.start(),o!==void 0&&l.connect(o),l},Fr=(t,e,r)=>{const n=ae.createGain();return e!==void 0&&(n.gain.value=e),t.connect(n),n.connect(r),n},De=({start:t,change:e,loop:r,stop:n,startAndLoopTogether:o=!1,noStartOnFirstFrame:s=!0},i)=>{let a=!0,l,c;return u=>{if(!!u!=!!c)u?t!==void 0&&!(a&&s)?(l?.stop(),l=je({...t}),Fr(l,t.gain,i),r!==void 0&&(o?(l=je({...r,loop:!0}),Fr(l,r.gain,i)):l.onended=()=>{c&&(l=je({...r,loop:!0}),Fr(l,r.gain,i))})):r!==void 0&&(l=je({...r,loop:!0}),Fr(l,r.gain,i)):(l&&l.loop&&(l.stop(),l.onended=null),n!==void 0&&(l=je({...n}),Fr(l,n.gain,i)));else if(c!==u&&e!==void 0){const f=je({...e});Fr(f,e.gain,i)}a=!1,c=u}};class Qk{constructor(e){this.renderContext=e,this.output.gain.value=4}output=ae.createGain();#e=De({loop:{soundId:"rollingBallLoop",playbackRate:.5}},this.output);tick(){const{renderContext:{item:{state:{vels:{sliding:e},standingOnItemId:r}}}}=this,n=(e.x!==0||e.y!==0)&&r!==null;this.#e(n)}destroy(){}}class eC{constructor(e){this.renderContext=e;const{item:{config:{was:r}}}=e;switch(r.type){case"pickup":{r.gives!=="scroll"&&je({soundId:"bonus",connectTo:this.output});break}case"disappearing":{je({soundId:"destroy",connectTo:this.output});break}case"hushPuppy":{this.output.gain.value=.5,je({soundId:"hushPuppyVanish",connectTo:this.output});break}}}output=ae.createGain();tick(){}destroy(){}}class yl{constructor(e,r,n=1){this.renderContext=e,this.#e=De({start:r},this.output),this.output.gain.value=n}output=ae.createGain();#e;tick({lastRenderRoomTime:e}){const{renderContext:{item:r}}=this,{state:{collidedWith:{roomTime:n,by:o}}}=r,s=n>(e??Ee)&&!Hd(fs(o));this.#e(s)}destroy(){}}class tC{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#e.gain.value=.5,this.#r=new yl(e,{soundId:"metalHit"},.3),this.#r.output.connect(this.output)}output=ae.createGain();#e=ae.createGain();#t=De({start:{soundId:"servoStart",playbackRate:.5},loop:{soundId:"servoLoop",playbackRate:.5},stop:{soundId:"servoStop",playbackRate:.5}},this.#e);#r;tick(e){const{renderContext:{item:r,room:{roomTime:n,items:o}}}=this,{state:{actedOnAt:{roomTime:s,by:i}}}=r,a=n===s&&mt(fs(i)).some(l=>Od(o[l]));this.#t(a),this.#r.tick(e)}destroy(){}}const uo=t=>{for(const e in t)return!0;return!1},bi=2;class rC{constructor(e){this.renderContext=e}output=ae.createGain();#e=De({start:{soundId:"conveyorStart",playbackRate:bi},loop:{soundId:"conveyorLoop",playbackRate:bi},stop:{soundId:"conveyorEnd",playbackRate:bi}},this.output);tick(){const{renderContext:{item:{state:{stoodOnBy:e}}}}=this,r=uo(e);this.#e(r)}destroy(){this.#e(!1)}}const nC=3;class oC{constructor(e){this.renderContext=e,this.output.gain.value=.7}output=ae.createGain();#e=je({soundId:"helicopter",loop:!0,connectTo:this.output});tick(){const{renderContext:{item:{state:{vels:{lift:{z:e}}}}}}=this;this.#e.playbackRate.value=Math.max(.5,1+nC*e)}destroy(){}}const Eu={skiHead:{soundId:"softBump"},turtle:{soundId:"softBump"},dalek:{soundId:"metalHit"},homingBot:{soundId:"metalHit"},computerBot:{soundId:"metalHit"}},Pu={cyberman:{soundId:"jetpackTurnaround",gain:1.2},dalek:{soundId:"mojoTurn",gain:.3}},Au={cyberman:{soundId:"jetpackLoop",gain:.7},emperorsGuardian:{soundId:"jetpackLoop"},dalek:{soundId:"mojoLoop"},bubbleRobot:{soundId:"bubbleRobotLoop"},helicopterBug:{soundId:"helicopter"}},Tu={homingBot:{start:{soundId:"detect"},loop:{soundId:"robotWhirLoop",gain:4},startAndLoopTogether:!0},computerBot:{loop:{soundId:"robotBeepingLoop",randomiseStartPoint:!0,varyPlaybackRate:!0}}};class sC{constructor(e){this.renderContext=e,this.#e.connect(this.output),this.#t.connect(this.output),this.#t.gain.value=.66;const{item:{config:{which:r}}}=e;Eu[r]!==void 0&&(this.#o=new yl(e,Eu[r]),this.#o.output.connect(this.output)),Pu[r]!==void 0&&(this.#r=De({change:Pu[r]},this.#e)),Tu[r]!==void 0&&(this.#s=De(Tu[r],this.#e)),Au[r]!==void 0&&(this.#n=De({loop:Au[r]},this.#t))}output=ae.createGain();#e=ae.createGain();#t=ae.createGain();#r;#n;#o;#s;tick(e){const{renderContext:{item:r}}=this,{state:{facing:n,activated:o,busyLickingDoughnutsOffFace:s,vels:{walking:i}}}=r;if(this.#r){const a=Cd(n);this.#r(a)}if(this.#o&&this.#o.tick(e),this.#n){const a=o&&!s;this.#n(a)}if(this.#s){const a=!Ra(i,fe);this.#s(a)}}destroy(){}}class wi{constructor(e){this.renderContext=e;const{general:{soundSettings:r},item:{type:n}}=e,{noFootsteps:o}={...Ia.soundSettings,...r};o||(this.#e=ae.createGain(),this.#e.gain.value=2,this.#e.connect(this.output),this.#t=De({loop:{soundId:`${n==="headOverHeels"?"heels":n}Walk`}},this.#e)),this.#r.gain.value=.8,this.#r.connect(this.output),this.#i.gain.value=1.2,this.#i.connect(this.output),this.#s.connect(this.output),this.#n=De({start:{soundId:`${n==="headOverHeels"?"head":n}Jump`}},this.#r),this.#o=De({loop:{soundId:`${n==="headOverHeels"?"head":n}Fall`}},this.#r)}output=ae.createGain();#e;#t;#r=ae.createGain();#n;#o;#s=ae.createGain();#l=De({start:{soundId:"landing"},noStartOnFirstFrame:!0},this.#s);#i=ae.createGain();#c=De({start:{soundId:"carry",playbackRate:.95},stop:{soundId:"carry",playbackRate:1.05}},this.#i);#a={teleportingPhase:null,positionZ:0};tick({lastRenderRoomTime:e}){const{renderContext:{item:r}}=this,{state:{action:n,teleporting:o,jumpStartZ:s,jumped:i,standingOnItemId:a,position:{z:l},vels:{gravity:{z:c}},collidedWith:{roomTime:u,by:d}}}=r,f=Wk(r),{teleportingPhase:p,positionZ:y}=this.#a,m=o?o.phase:null,v=i&&l>s&&l>y&&c>0,b=l<y&&c<0&&a===null;this.#o(b),this.#n(v),this.#t!==void 0&&this.#t(!v&&!b&&n==="moving"),f!==void 0&&this.#c(f.carrying!==null);const _=a!==null&&u>(e??Ee)&&d[a];if(this.#l(_),m!==null&&m!==p)if(m==="in"){const w=wa().teleportIn,x=ae.createBufferSource();x.buffer=w,x.connect(this.output),x.start()}else{const w=wa().teleportOut,x=ae.createBufferSource();x.buffer=w,x.connect(this.output),x.start()}this.#a={teleportingPhase:m,positionZ:l}}destroy(){}}class iC{constructor(e){this.renderContext=e}output=ae.createGain();#e=void 0;tick(){const{renderContext:{item:{state:{stoodOnBy:e},config:{style:r}}}}=this;if(r!=="drum")return;const n=this.#e?.stoodOn??!1,o=uo(e);!n&&o&&je({soundId:"drum",connectTo:this.output}),this.#e={stoodOn:o}}destroy(){}}class aC{constructor(e){this.renderContext=e,this.scrapeBracketed=De({loop:{soundId:"stepStoolScraping"}},this.output),this.output.gain.value=.4}output=ae.createGain();scrapeBracketed;tick({movedItems:e}){const{renderContext:{item:r,room:{roomTime:n}}}=this,{state:{actedOnAt:{roomTime:o},standingOnItemId:s}}=r,i=n===o&&s!==null&&e.has(r);this.scrapeBracketed(i)}destroy(){}}class lC{constructor(e){this.renderContext=e}output=ae.createGain();tick({lastRenderRoomTime:e}){const{renderContext:{item:{state:{stoodOnBy:r,stoodOnUntilRoomTime:n}}}}=this,o=uo(r);e!==void 0&&n>e&&!o&&je({soundId:"springBoing",connectTo:this.output})}destroy(){}}class cC{constructor(e){this.renderContext=e,this.#e.connect(this.output)}output=ae.createGain();#e=ae.createGain();#t=void 0;tick(){const{renderContext:{item:{state:{setting:e},config:r}}}=this,n=r.type==="in-store"?Aa(L.getState(),r.path)?"right":"left":e,o=this.#t?.setting;o!==void 0&&o!==n&&je({soundId:"switchClick",playbackRate:n==="right"?.95:1.05,connectTo:this.#e}),this.#t={setting:n}}destroy(){}}class uC{constructor(e){this.renderContext=e}output=ae.createGain();#e=De({loop:{soundId:"teleportWarningSiren"}},this.output);tick(){const{renderContext:{item:e,room:r}}=this;this.#e(ml(e)&&co(e.state.stoodOnBy,r).some(za))}destroy(){}}class dC{constructor(e){this.renderContext=e,je({soundId:"hooter",connectTo:this.output})}output=ae.createGain();tick(){}destroy(){}}class hC extends yl{constructor(e){super(e,{soundId:"glassClink",varyPlaybackRate:!0},.8),this.renderContext=e}}const fC=(t,e)=>Wd(co(t.state.stoodOnBy,e).filter(jd));class pC{constructor(e){this.renderContext=e,this.output.gain.value=2}output=ae.createGain();#e=void 0;tick(e){const{renderContext:{item:r,room:n}}=this,o=fC(r,n);this.#e!==void 0&&o<this.#e&&je({soundId:"toasterPopUpSoundUrl",connectTo:this.output}),this.#e=o}destroy(){}}const gC={lift:oC,switch:cC,bubbles:eC,head:wi,heels:wi,headOverHeels:wi,teleporter:uC,monster:sC,conveyor:rC,spring:lC,portableBlock:iC,charles:tC,ball:Qk,pushableBlock:aC,firedDoughnut:dC,slidingBlock:hC},mC=t=>{if(t.item.type==="deadlyBlock"&&t.item.config.style==="toaster")return new pC(t);const e=gC[t.item.type];if(e)return new e(t)},yC={edgeLeftX:Number.POSITIVE_INFINITY,edgeRightX:Number.NEGATIVE_INFINITY,topEdgeY:Number.POSITIVE_INFINITY,bottomEdgeY:Number.NEGATIVE_INFINITY},vC=t=>Re(t.items).filter(Li).reduce((e,{config:{naturalFootprint:r},state:{position:n},renderAabb:o,renderAabbOffset:s,aabb:i})=>{const a=K(D(r.position,{x:r.aabb.x,z:r.aabb.z})).x,l=K(D(r.position,{y:r.aabb.y,z:r.aabb.z})).x,c=K(D(r.position,r.aabb)).y,u=K(D(n,s??fe,{z:(o??i).z})).y;return{edgeLeftX:Math.min(e.edgeLeftX,a),edgeRightX:Math.max(e.edgeRightX,l),topEdgeY:Math.min(e.topEdgeY,c),bottomEdgeY:Math.max(e.bottomEdgeY,u)}},yC),Ru=F.h*-1,Iu=F.h*lo,bC=0,wC=F.w*16,xi=(t,e,r)=>(t-e)/(r-e)*2-1;class xC{constructor(e,r){this.renderContext=e,this.childRenderer=r,r.output.connect(this.output),this.output.rolloffFactor=2,this.output.maxDistance=5,this.output.distanceModel="exponential";const n=vC(e.room);this.soundPositionMinX=n.edgeLeftX,this.soundPositionMaxX=n.edgeRightX}output=ae.createPanner();soundPositionMinX;soundPositionMaxX;tick(e){this.childRenderer.tick(e);const{item:r}=this.renderContext,n=r.state,o=D(n.position,hs(r.aabb,.5)),s=xi(YS(o),this.soundPositionMaxX,this.soundPositionMinX),i=xi(o.z,Ru,Iu);if(!Number.isFinite(i))throw new Error(`y position for sound rendering is not finite;
        positionY = numberInRangeToMinus1To1Range(
          itemCentrePosition = ${o.z},
          ${Ru},
          ${Iu},
        );
        itemCentrePosition = addXyz(
          itemState.position = ${JSON.stringify(n.position)},
          scaleXyz(${JSON.stringify(r.aabb)}, 0.5),
        )`);const a=xi(o.x+o.y,bC,wC);this.output.positionX.value=s,this.output.positionY.value=i,this.output.positionZ.value=a}destroy(){this.childRenderer.destroy()}}const Er=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,_C=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // we know c.a is either 0 or 1, so no need to do a step()

    finalColor = mix(c, vec4(uColour, 1), c.a);
}
`;class cs extends Yt{constructor(e){const r=Rt.from({vertex:Er,fragment:_C,name:"oneColour-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uColour:{value:new Float32Array(3),type:"vec3<f32>"}}}});const n=this.resources.colorReplaceUniforms.uniforms,[o,s,i]=e.toArray();n.uColour[0]=o,n.uColour[1]=s,n.uColour[2]=i}}const SC={pureBlack:new G("#000000"),shadow:new G("#1B2D3B"),midGrey:new G("#505A55"),lightGrey:new G("#929981"),white:new G("#F8FEF8"),pastelBlue:new G("#4893FF"),metallicBlue:new G("#1D4E80"),pink:new G("#B973AF"),moss:new G("#6E7B00"),redShadow:new G("#513D40"),midRed:new G("#A7574B"),lightBeige:new G("#BF8E69"),highlightBeige:new G("#DBB269"),alpha:new G("#105A69"),replaceLight:new G("#048662"),replaceDark:new G("#052229")},kC=`#version 300 es
// keep this one at mediump for the hash function's precision
precision mediump float;

in vec2 vTextureCoord;
out vec4 finalColor;

const float LUT_SIZE = 256.0;
const float magicNumber = 31.0; // Small prime number

uniform sampler2D uTexture;
uniform sampler2D uLut;

/** returns in [0, LUT_SIZE] range
this must match the TypeScript version of the hash function*/
float hashColor(vec3 color) {
    vec3 c255 = floor(color * 255.0);
    
    float hash = mod(
        c255.r + c255.g * magicNumber + c255.b * magicNumber * magicNumber, 
        LUT_SIZE
    );
    return hash;
}

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    float h = hashColor(c.rgb);

    // use the hash to look up the replacement in the LUT:
    vec4 replacementColour = texture(
        uLut, 
        vec2(
            // normalise h to [0, 1] range
            (h + 0.5) / LUT_SIZE, 
            0.5
        )
    );
    
    // use original if either: 
    //      original alpha is 0 (because keep transparent)
    //      or lut alpha is 0 (signals nothing in this slot of the LUT)
    finalColor = mix(c, replacementColour, c.a * replacementColour.a);
}
`,zn=256,_i=31;function CC(t){const e=Math.floor(t.red*255),r=Math.floor(t.green*255),n=Math.floor(t.blue*255);return(e+r*_i+n*_i*_i)%zn}function EC(t){const e=new Float32Array(zn*4);for(const[o,s]of Vg(t)){const i=$[o],a=CC(i);if(e[a*4+3]>.5)throw new Error("LUT collision - mess with the hash function or lut size until this goes away");e[a*4+0]=s.red,e[a*4+1]=s.green,e[a*4+2]=s.blue,e[a*4+3]=1}const r=new Uint8Array(zn*4);for(let o=0;o<zn*4;o++)r[o]=Math.floor(e[o]*255);return Ct.from({resource:r,width:zn,height:1,scaleMode:"nearest"})}class Qt extends Yt{#e;constructor(e){const r=Object.keys(e).length,n=Rt.from({vertex:Er,fragment:kC,name:"palette-swop-filter"}),o=EC(e);super({glProgram:n,resources:{colorReplaceUniforms:{uOriginal:{value:new Float32Array(3*r),type:"vec3<f32>",size:r},uReplacement:{value:new Float32Array(3*r),type:"vec3<f32>",size:r}},uLut:o.source}}),this.#e=o;const s=this.resources.colorReplaceUniforms.uniforms;Object.entries(e).forEach(([i,a],l)=>{$[i].toArray().forEach((c,u)=>{s.uOriginal[l*3+u]=c}),a.toArray().forEach((c,u)=>{s.uReplacement[l*3+u]=c})})}destroy(e){this.#e?.destroy(!0),this.#e=null,super.destroy(e)}}const PC=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uTargetColor;

vec4 black = vec4(0.0, 0.0, 0.0, 1.0);

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    // 1 if black, 0 if non-black
    float isBlack = step(length(c.rgb), 0.01);

    // keep original if either:
    //      * black
    //      * transparent

    finalColor = mix(    
        vec4(uTargetColor, 1),    
        c, 
        max(isBlack, 1.0 - c.a)
    );
}
`;class Le extends Yt{uniforms;constructor(e="white"){const r=Rt.from({vertex:Er,fragment:PC,name:"revert-colourise-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}}}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[r,n,o]=new G(e).toArray();this.uniforms.uTargetColor[0]=r,this.uniforms.uTargetColor[1]=n,this.uniforms.uTargetColor[2]=o}}const AC=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);

    finalColor = vec4(c.rgb * 0.5, c.a);
}
`;class TC extends Yt{constructor(){const e=Rt.from({vertex:Er,fragment:AC,name:"halfbrite-filter"});super({glProgram:e,resources:{}})}}const Mp=({basic:t,dimmed:e})=>({replaceLight:t,replaceDark:e}),Dp=({color:{hue:t,shade:e},planet:r})=>{const n=t==="yellow"?e==="dimmed"||r==="jail"?Xf:Ze:_s[t][e].main;return Mp(n)},RC=t=>new Qt({lightBeige:$.lightGrey,redShadow:$.shadow,pink:$.lightGrey,moss:$.lightGrey,midRed:$.midGrey,highlightBeige:$.lightGrey,...t&&Dp(t)}),IC=new Qt({midGrey:$.midRed,lightGrey:$.lightBeige,white:$.highlightBeige,metallicBlue:$.redShadow,pink:$.midRed,moss:$.midRed,replaceDark:$.midRed,replaceLight:$.lightBeige}),Ou=(t,e)=>{const r=is(t.color).edges[e],n=r.original;return r.dimInOriginal?Kf(n):n},Lp=(t,e,r)=>r?new Qt(Mp(_s[t.color.hue][t.color.shade].edges[e])):new Le(is(t.color).edges[e].original),pt=t=>new Qt(Dp(t)),OC=t=>{switch(t.color.hue){case"white":return new Qt({replaceLight:$.lightGrey,replaceDark:$.midGrey});default:return pt(t)}},Bp=t=>{switch(t.color.hue){case"white":return new Qt({replaceLight:$.lightBeige,replaceDark:$.midRed,shadow:$.redShadow});case"yellow":return pt({planet:t.planet,color:{hue:"yellow",shade:"dimmed"}});default:return pt(t)}};new TC;const er=Qo,jC=new Qt(SC),$C=[new cs($.midRed)],NC=[new cs($.moss)],zC=75;class MC{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output)}output=new te({label:"ItemFlashOnSwitchedRenderer"});tick(e){const{renderContext:{item:{state:{switchedAtRoomTime:r,switchedSetting:n}},room:{roomTime:o}}}=this;this.output.filters=o-r<zC?n==="left"?NC:$C:er,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const DC=(t,e,r)=>{const o=Wt().textures[`door.frame.${t.planet}.${e}.near`]!==void 0?t.planet:"generic",s=t.color.shade==="dimmed"&&Wt().textures[`door.frame.${o}.dark.${e}.${r}`]!==void 0;return`door.frame.${o}${s?".dark":""}.${e}.${r}`};function Ps(t,e){const r=e||new te;for(const n of t)r.addChild(n);return r}function*LC({config:{direction:t,inHiddenWall:e,height:r}},n){const o=to(t),s=o==="y"?1:16;function*i(a){if(e){if(r!==0){const l=W({textureId:`generic.door.floatingThreshold.${o}`,...Ln(a,{y:-12*r})});l.filters=Lp(n,o==="x"?"towards":"right",!0),yield l}}else{yield W({pivot:{x:s,y:9},textureId:`generic.door.legs.base.${o}`,...Ln(a,{})});for(let l=1;l<r;l++)yield W({pivot:{x:s,y:9},textureId:`generic.door.legs.pillar.${o}`,...Ln(a,{y:-l*F.h})})}}yield*i(wr({...en,[o]:1})),yield*i(en),e||(yield W({pivot:{x:16,y:F.h*r+13},textureId:`generic.door.legs.threshold.double.${o}`,...wr({...en,[o]:1})}))}const Fp=(t,e)=>{const r=to(t),n=vn(r),o=8;return t==="towards"||t==="right"?K({[n]:e[n]-o}):en},BC=Oe(({renderContext:{item:t,room:e}})=>Ps(LC(t,e),new te({filters:pt(e),...Fp(t.config.direction,t.aabb)}))),FC=Oe(({renderContext:{item:{config:{direction:t,part:e,toRoom:r},aabb:n},room:o,general:{gameState:s}}})=>{const i=to(t),a=s===void 0?o:s.campaign.rooms[r];return W({textureId:DC(o,i,e),filter:pt(a),...Fp(t,n)})}),Si={animationId:"bubbles.cold"},Yr=({top:t,bottom:e="headlessBase",filter:r})=>{const n=new te({filters:r}),o=W(e);n.addChild(o);const s=W(t);return s.y=-12,n.addChild(s),n[As]=s,n[vl]=o,n},As=Symbol(),vl=Symbol(),UC=({top:t,bottom:e})=>{const r=new te;return r.addChild(e),t.y=-12,r.addChild(t),r[As]=t,r[vl]=e,r},HC=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform vec2 uTextureSize;
uniform sampler2D uTexture;
uniform vec3 uOutline;
uniform float uOutlineWidth;

void main(void) {
    vec2 scaledTexelSize = vec2(1.0f) / vec2(textureSize(uTexture, 0)) * uOutlineWidth;    
    
    // Calculate offset coordinates
    vec2 rightCoord = vec2(vTextureCoord.x + scaledTexelSize.x, vTextureCoord.y);
    vec2 leftCoord = vec2(vTextureCoord.x - scaledTexelSize.x, vTextureCoord.y);
    vec2 belowCoord = vec2(vTextureCoord.x, vTextureCoord.y + scaledTexelSize.y);
    vec2 aboveCoord = vec2(vTextureCoord.x, vTextureCoord.y - scaledTexelSize.y);
    
    // Create boundary masks (1.0 if within bounds, 0.0 if out of bounds)
    // seems to work fine without this, but could multiply colourToX by this to get zero'd out when OOB
    // float rightInBounds = step(rightCoord.x, 1.0);
    // float leftInBounds = step(0.0, leftCoord.x);
    // float belowInBounds = step(belowCoord.y, 1.0);
    // float aboveInBounds = step(0.0, aboveCoord.y);
    
    vec4 colourToRight = texture(uTexture, rightCoord);
    vec4 colourToLeft = texture(uTexture, leftCoord);
    vec4 colourBelow = texture(uTexture, belowCoord);
    vec4 colourAbove = texture(uTexture, aboveCoord);
    
    // Check if any neighbor is opaque (combine all alpha values)
    float hasOpaqueNeighbor = max(max(colourToRight.a, colourToLeft.a), 
                                  max(colourBelow.a, colourAbove.a));

    vec4 originalColour = texture(uTexture, vTextureCoord);
        
    finalColor = mix(
        originalColour, 
        vec4(uOutline, 1), 
        // 1 if: original colour is transparent and has an opaque neighbour - use outline colour
        // 0 if: original colour is opaque or has no opaque neighbour - use original colour (transparent or sprite)
        (1.0 - originalColour.a) * hasOpaqueNeighbor
    );
}
`;class gt extends Yt{constructor({outlineColor:e,upscale:r,lowRes:n}){const o=Rt.from({vertex:Er,fragment:HC,name:"outline-filter"});super({glProgram:o,padding:r,resources:{colorReplaceUniforms:{uOutline:{value:new Float32Array(3),type:"vec3<f32>"},uOutlineWidth:{value:new Float32Array(1),type:"f32"}}}});const s=this.resources.colorReplaceUniforms.uniforms,[i,a,l]=e.toArray();s.uOutline[0]=i,s.uOutline[1]=a,s.uOutline[2]=l,s.uOutlineWidth[0]=r,n&&(this.resolution=1/r,this.padding=r,s.uOutlineWidth[0]=1)}}const WC=t=>{const{gameTime:e,lastDiedAt:r}=t.type==="headOverHeels"?t.state.head:t.state;return e-r<KS},ki=t=>{if(t===void 0)return 0;const{shieldCollectedAt:e,gameTime:r}=t;return e!==null&&e+au>r?100-Math.ceil((r-e)/(au/100)):0},GC=t=>t.type==="headOverHeels"?ki(t.state.head)>0||ki(t.state.heels)>0:ki(t.state)>0,Ts=t=>t,xa=.02,qC=({name:t,action:e,facingXy8:r,teleportingPhase:n,gravityZ:o,paused:s})=>{if(e==="death")return{animationId:`${t}.fadeOut`,paused:s};if(n==="out")return{animationId:`${t}.fadeOut`,paused:s};if(n==="in")return{animationId:`${t}.fadeOut`,paused:s};if(e==="moving")return{animationId:`${t}.walking.${r}`,paused:s};if(e==="jumping")return{textureId:o<xa?`${t}.walking.${r}.2`:`${t}.walking.${r}.1`};if(e==="falling"){const a=`${t}.falling.${r}`;if(es(a))return{textureId:a}}const i=`${t}.idle.${r}`;return hh(i)?{animationId:i,paused:s}:{textureId:`${t}.walking.${r}.2`}},_a=Symbol(),Sa=Symbol(),VC=(t,e)=>{t[_a].removeChildren(),t[_a].addChild(W(qC(e)))},Up=new Qt({pastelBlue:$.pink}),Ci=(t,e,r)=>{const n=new te,o=new te;n[_a]=o,n.addChild(o);const s=W({animationId:e?`shine.${t}InSymbio`:"shine",paused:r,filter:t==="heels"?Up:er,flipX:t==="heels"});return n[Sa]=s,n},ju=({gameTime:t,switchedToAt:e},r,n)=>(r==="headOverHeels"||r===n)&&e+VS>t,KC=t=>{if(!WC(t))return!1;const{gameTime:e,lastDiedAt:r}=t.type==="headOverHeels"?t.state.head:t.state;return(e-r)%lu<lu*XS},$u=(t,e)=>{t.filters?Array.isArray(t.filters)?t.filters=[...t.filters,e]:t.filters=[t.filters,e].flat():t.filters=e},Nu=(t,e)=>{t.filters=Array.isArray(t.filters)?t.filters.filter(r=>!(r instanceof e)):t.filters instanceof e?er:[...t.filters]},XC=(t,{highlighted:e,flashing:r},n,o)=>{const s=n?.highlighted??!1;e&&!s?$u(o,new gt({outlineColor:Jr[t],upscale:Jt(L.getState()),lowRes:!1})):!e&&s&&Nu(o,gt);const i=n?.flashing??!1;r&&!i?$u(o,new cs(Jr[t])):!r&&i&&Nu(o,cs)},JC=(t,e,r)=>{e&&!r?t.addChild(t[Sa]):!e&&r&&t.removeChild(t[Sa])},Ei=(t,e,r,n,o,s)=>{r&&VC(e,{name:t,...n,paused:o}),XC(t,n,s,e),JC(e,n.shining,s?.shining??!1)},YC=({renderContext:{item:t,general:{gameState:e,paused:r}},currentRendering:n})=>{const{type:o,state:{action:s,facing:i,teleporting:a,vels:{gravity:{z:l}}}}=t,c=n?.renderProps,u=n?.output,d=Cd(i)??"towards",f=e!==void 0&&(t.type==="headOverHeels"?ju(t.state.head,"headOverHeels","headOverHeels"):ju(t.state,t.type,e.currentCharacterName)),p=KC(t),y=GC(t),m=Ed(i),v=a?.phase??null,b={action:s,facingXy8:d,teleportingPhase:v,flashing:p,highlighted:f,shining:y,gravityZ:l},_=c===void 0||c.action!==s||c.facingXy8!==d||c.teleportingPhase!==v||c?.gravityZ>xa!=l>xa;let w;if(o==="headOverHeels"){w=u??UC({top:Ci("head",!0,r),bottom:Ci("heels",!0,r)});const x=w;Ei("head",x[As],_,b,r,c),Ei("heels",x[vl],_,b,r,c)}else w=u??Ci(o,!1,r),Ei(o,w,_,b,r,c);return s==="moving"&&u instanceof qn&&(u.animationSpeed=m*Kg),{output:w,renderProps:b}},Pi=Ts(YC),zu=t=>t-Math.floor(t),ZC=({state:{position:t}},e)=>{const r=o=>o.config.direction==="away"||o.config.direction==="left";return Ps(Re(e.items).filter(o=>o.type==="wall"||o.type==="doorLegs").filter(r).map(o=>{const{id:s,config:{direction:i},state:{position:a}}=o;return W({textureId:"floorOverdraw.cornerNearWall",label:s,...K(sn(a,t)),times:o.type==="wall"?$a(o.config):{[vn(Gt(i))]:2},anchor:{x:0,y:1},flipX:i==="away"})}),new te({label:"floorOverdraws"}))},QC=`#version 300 es
precision lowp float;

in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColour;

void main(void) {
    finalColor = texture(uTexture, vTextureCoord);
}
`;class eE extends Yt{constructor(){const e=Rt.from({vertex:Er,fragment:QC,name:"null-filter"});super({glProgram:e,resources:{}})}}const tE=`#version 300 es
precision lowp float;

out vec4 finalColor;

in vec2 vTextureCoord;
uniform sampler2D uBackBuffer;
uniform vec3 uTargetColor;
// do not use uTexture in this frag - for some reason it causes pixi's render pipeline
// to take away the backbuffer, which we rely on sampling from

void main() {
    vec3 bg = texture(uBackBuffer, vTextureCoord).rgb;

    float isBlack = step(length(bg), 0.001f); // 1 if black, 0 otherwise
    finalColor = mix(vec4(uTargetColor, 1.0f), vec4(0, 0, 0, 0), isBlack);


}`;class Mu extends Yt{uniforms;constructor(e="white"){const r=Rt.from({vertex:Er,fragment:tE,name:"colour-clash-filter"});super({glProgram:r,resources:{colorReplaceUniforms:{uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"}}},blendRequired:!0}),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this.targetColor=e}set targetColor(e){const[r,n,o]=new G(e).toArray();this.uniforms.uTargetColor[0]=r,this.uniforms.uTargetColor[1]=n,this.uniforms.uTargetColor[2]=o}}const Du=({colourised:t,direction:e,room:r,times:n,position:o,colourSwap:s})=>W({label:`floorEdge(${e})`,textureId:`floorEdge.${e}`,times:n,filter:s?Lp(r,e,t):void 0,...K(o)}),rE=({room:t,xSize:e,ySize:r,y:n})=>{const o=new te({label:"floorColourClash"}),s=Ou(t,"right");for(let a=0;a<=r;a++){const l=wr({x:0,y:a,z:0}),c=new ut().rect(l.x-(a===0?0:8),l.y,8*3,8).fill(s);c.filters=new Mu(s),o.addChild(c)}const i=Ou(t,"towards");for(let a=0;a<=e;a++){const l=wr({x:a,y:0,z:0}),c=new ut().rect(l.x-16,l.y,8*(a===0?2:3),8).fill(i);c.filters=new Mu(i),o.addChild(c)}return o.y=n,o},nE=Oe(({renderContext:{room:t,item:e,general:{colourised:r},colourClashLayer:n}})=>{const{color:{shade:o}}=t,{config:s,state:{position:i},aabb:a}=e,{floorType:l,naturalFootprint:c}=s,u=new te({label:"floorAppearance"}),d=K({...a,y:0}),f=K({...a,x:0,y:0}),p=K({...a,x:0}),y=K(a);if(l!=="none"){const m=new te({label:"tiles"}),v=l==="deadly"?`generic${o==="dimmed"?".dark":""}.floor.deadly`:`${s.scenery}${o==="dimmed"?".dark":""}.floor`,b=Wt().textures[v];try{dh(v)}catch(O){throw new Error(`no floor textureId for floorType: ${l}, shade: ${o}`,{cause:O})}const _=hr(c.position,i),w={x:zu(_.x/F.w),y:zu(_.y/F.w)},x=8,k={x:d.x,y:y.y-x,width:p.x-d.x,height:f.y-y.y+2*x},C=hr(wr(Ln(w,{x:.5,y:.5})),{y:a.z},k),S=new Fy({texture:b,tilePosition:C,...k});m.addChild(S),m.addChild(ZC(e,t));const N=new ut().moveTo(y.x,y.y).lineTo(p.x,p.y).lineTo(p.x,p.y+3).lineTo(f.x,f.y+3).lineTo(d.x,d.y+3).lineTo(d.x,d.y).fill({color:16711680,alpha:.5});m.addChild(N),m.mask=N,m.filters=[OC(t)];const X=new te({children:[m]});X.filters=new gt({outlineColor:$.pureBlack,upscale:1,lowRes:!1});const B=new te({children:[X]}),q=new eE;q.enabled=!1,B.filters=q,B.cacheAsTexture(!0),u.addChild(B),u.addChild(W({textureId:"blank",x:p.x,y:f.y+8}))}{const m=new te({label:"edges"});l==="none"&&m.addChild(new ut().moveTo(p.x,p.y+8).lineTo(p.x,p.y+100).lineTo(d.x,d.y+100).lineTo(d.x,d.y+8).lineTo(f.x,f.y+8).fill(0));const v=Math.ceil(a.y/F.w);m.addChild(Du({colourised:r,direction:"right",room:t,times:{y:v},position:{z:a.z},colourSwap:r}));const b=Math.ceil(a.x/F.w);if(m.addChild(Du({colourised:r,direction:"towards",room:t,times:{x:b},position:{z:a.z},colourSwap:r})),u.addChild(m),!r){const _=rE({xSize:b,ySize:v,y:-a.z+1,room:t});u.addChild(_),n.attach(_)}}return u}),oE=["cyberman","dalek","skiHead","bubbleRobot","computerBot","turtle","homingBot"],sE=t=>{let e=2166136261;const r=t.length;for(let n=Math.max(0,r-9);n<r;n++)e^=t.charCodeAt(n),e=Math.imul(e,1540483477),e^=e>>>15;return(e>>>0)/4294967295},iE=200,aE=1,lE=(t,e)=>{const r=sE(e);return Math.sin((t+r*2e4)/iE)*aE},Lu=({id:t,config:{which:e},state:r},n,o)=>{if((e==="cyberman"||e==="bubbleRobot")&&r.activated||e==="emperorsGuardian"){const s=o;s[As].y=-12+lE(n.roomTime,t)}},cE=({renderContext:{item:t,room:e,general:{paused:r}},currentRendering:n})=>{const{config:o,state:s}=t,i=n?.renderProps,{activated:a,busyLickingDoughnutsOffFace:l}=s,c=l?IC:a?void 0:oE.includes(o.which)?RC(e):void 0;switch(o.which){case"skiHead":case"turtle":case"cyberman":case"computerBot":case"elephant":case"elephantHead":case"monkey":{const u=Ta(s.facing)??"towards";if(!(i===void 0||a!==i.activated||l!==i.busyLickingDoughnutsOffFace||u!==i.facingXy4))return Lu(t,e,n.output),"no-update";const f={facingXy4:u,activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"skiHead":return{output:W({textureId:`${o.which}.${o.style}.${u}`,filter:c}),renderProps:f};case"elephantHead":return{output:W({textureId:`elephant.${u}`,filter:c}),renderProps:f};case"turtle":return{output:W(a&&!l?{animationId:`${o.which}.${u}`,filter:c,paused:r}:{textureId:`${o.which}.${u}.1`,filter:c}),renderProps:f};case"cyberman":return{output:s.activated||s.busyLickingDoughnutsOffFace?Yr({top:{textureId:`${o.which}.${u}`,filter:c||pt(e)},bottom:{...Si,paused:r}}):W({textureId:`${o.which}.${u}`,filter:c}),renderProps:f};case"computerBot":case"elephant":case"monkey":return{output:Yr({top:`${o.which}.${u}`,bottom:{animationId:"headlessBase.flash",playOnce:"and-stop"},filter:c}),renderProps:f};default:throw new Error(`unexpected monster ${o}`)}break}case"homingBot":{const u=!Xg(s.vels.walking,en);return i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated||u!==i.walking?{filter:c,output:W(a&&!l?{animationId:u?"headlessBase.flash":"headlessBase.scan",filter:c}:{textureId:"headlessBase",filter:c}),renderProps:{activated:a,busyLickingDoughnutsOffFace:l,walking:u}}:"no-update"}case"helicopterBug":case"emperor":case"dalek":case"bubbleRobot":case"emperorsGuardian":{if(!(i===void 0||l!==i.busyLickingDoughnutsOffFace||a!==i.activated))return Lu(t,e,n.output),"no-update";const d={activated:a,busyLickingDoughnutsOffFace:l};switch(o.which){case"helicopterBug":case"dalek":return{output:W(a&&!l?{animationId:o.which,filter:c,paused:r}:{textureId:`${o.which}.1`,filter:c}),renderProps:d};case"bubbleRobot":return{output:Yr({top:{...Si,paused:r},filter:c}),renderProps:d};case"emperorsGuardian":return{output:Yr({top:"ball",bottom:{...Si,paused:r},filter:c}),renderProps:d};case"emperor":return{output:W({animationId:"bubbles.cold",filter:c,paused:r}),renderProps:d};default:throw new Error(`unexpected monster ${o}`)}break}default:throw new Error(`unexpected monster ${o}`)}},No=new gt({outlineColor:$.pureBlack,upscale:Jt(L.getState()),lowRes:!0});new Le;new Le;new Le;new Le($.moss);new Le;new Le(Jr.head),new Le(dn(Jr.head)),new Le(Jr.heels),new Le(dn(Jr.heels));function*uE(t){const e=typeof t=="string"?t==="infinite"?"":t:t.toString(),r=Wd(e);let n=0;for(const o of e){const s=`hud.char.${md(o)}`;try{dh(s)}catch(i){throw new Error(`no texture id for char "${o}": ${i.message}`,{cause:i})}yield W({textureId:s,x:(n+.5-r/2)*Jg.w}),n++}}const Hp=(t,e)=>{t.removeChildren();try{Ps(uE(e),t)}catch(r){throw console.error("invalid string is",e,"and on window as window.invalid"),console.error(r),window.invalid=e,new Error(`could not show text "${e}" in container because: "${r.message}"`,{cause:r})}return t},dE=xp.floatingText,hE=12,Bu=F.h*3,Fu=[$.shadow,$.midGrey,$.redShadow,$.metallicBlue,$.midRed,$.moss,$.pink,$.lightBeige,$.pastelBlue,$.lightGrey,$.highlightBeige],Uu=[...Fu,...new Array(20).fill($.white),...Fu.toReversed()],fE=({renderContext:{item:{config:{textLines:t,appearanceRoomTime:e}},room:{roomTime:r},general:{displaySettings:{uncolourised:n}},frontLayer:o},currentRendering:s})=>{const i=s?.output;let a;const c=(r-e)*dE;if(i===void 0){a=new te({filters:new gt({outlineColor:$.pureBlack,upscale:Jt(L.getState()),lowRes:!1})}),o?.attach(a);for(let d=0;d<t.length;d++){const f=t[d],p=Hp(new te({label:f,y:d*hE,filters:n?er:new Le($.pink)}),f.toUpperCase());a.addChild(p)}}else a=i;let u=!1;for(let d=0;d<t.length;d++){const f=a.children[d],[p]=f.filters,y=c+d*-12,m=y>0&&y<Bu;if(f.visible=m,u||=m,m&&p){const v=Math.floor(y/Bu*Uu.length);p.targetColor=Uu[v]}}return a.visible=u,a.y=-c,{output:a,renderProps:le}},Hu=500,pE=_r.animations["conveyor.x"].animationSpeed,Wu=_r.animations["conveyor.x"].length,gE=t=>1-(1-t)**2,mE=(t,e)=>{for(let r=0;r<t.children.length;r++){const n=t.children[r],o=r%Wu;n.gotoAndStop(e?Wu-o-1:o)}return t},yE=({renderContext:{item:{config:{direction:t,times:e},state:{stoodOnBy:r}},room:{roomTime:n}},currentRendering:o})=>{const s=o?.renderProps,i=uo(r),a=(!i&&s?.moving?n:s?.roomTimeStoppedMoving)??Ee,l=Gt(t),c=o?.output??mE(W({animationId:`conveyor.${l}`,reverse:t==="towards"||t==="right",times:e}),t==="towards"||t==="right"),u=i?0:Math.min(n-a,Hu),d=Math.max(0,1-u/Hu);for(const f of c.children)if(d===0)f.stop();else{const p=pE*gE(d);f.play(),f.animationSpeed=p}return{output:c,renderProps:{moving:i,roomTimeStoppedMoving:a}}},vE=Ts(yE),bE=({renderContext:{item:t,room:e,general:{paused:r}},currentRendering:n})=>{const{state:{stoodOnBy:o},config:{times:s}}=t,i=n?.renderProps,a=ml(t),l=a&&co(o,e).some(za);return i===void 0||a!==i.activated||l!==i.flashing?{output:l?new te({children:[W({textureId:"teleporter",times:s}),W({animationId:"teleporter.flashing",times:s,paused:r})]}):W({textureId:a?"teleporter":"block.artificial",times:s}),renderProps:{flashing:l,activated:a}}:"no-update"},wE=({renderContext:{item:{state:{facing:t,actedOnAt:{roomTime:e,by:r}}},room:{roomTime:n,items:o}},currentRendering:s})=>{const i=s?.renderProps,a=Ta(t)??"towards",l=n===e&&mt(fs(r)).some(u=>Od(o[u]));return i===void 0||a!==i.facingXy4||l!==i.controlledByJoystick?{output:Yr({top:`charles.${a}`,bottom:l?"headlessBase.all":"headlessBase"}),renderProps:{facingXy4:a,controlledByJoystick:l}}:"no-update"},xE=({renderContext:{item:{state:{stoodOnBy:t,stoodOnUntilRoomTime:e}},general:{paused:r}},tickContext:{lastRenderRoomTime:n},currentRendering:o})=>{const s=o?.renderProps,i=uo(t);let a;return o?.output?a=o?.output:(a=W({animationId:"spring.bounce"}),a.loop=!1,a.gotoAndStop(0)),n!==void 0&&e>n&&!i&&!r?a.gotoAndPlay(0):i&&!(s?.compressed??!1)&&a.gotoAndStop(1),{output:a,renderProps:{compressed:i}}},_E=Ts(xE),SE=({renderContext:{item:{config:{which:t,startDirection:e}}},currentRendering:r})=>r?.renderProps===void 0?{output:t==="headOverHeels"?Yr({top:{textureId:`head.walking.${e}.2`},bottom:{textureId:`heels.walking.${e}.2`}}):W({textureId:`${t}.walking.${e}.2`}),renderProps:le}:"no-update",kE=({renderContext:{item:{state:{vels:{sliding:t}},config:{startingPhase:e}},general:{paused:r}},tickContext:{deltaMS:n},currentRendering:o})=>{const i=(o?.renderProps?.distanceTravelled??0)+Oa(t)*(r?0:n),l=o?.output??W("spikyBall.1"),u=(Math.floor(i*2/Qr.w)+e)%2+1;return l.texture=Wt().textures[`spikyBall.${u}`],{output:l,renderProps:{distanceTravelled:i}}},CE=Ts(kE),EE=(t,e,r,n)=>`${t}${n?".dark":""}.wall.${e}.${r}`,PE=Oe(({renderContext:{item:{id:t,config:e},room:r}})=>{if(e.direction==="right"||e.direction==="towards")throw new Error(`wall is near: ${t}`);const{direction:n,tiles:o}=e,s=vn(Gt(n)),i=new te({label:"wallTiles"});for(let a=0;a<e.tiles.length;a++){let l=W({textureId:EE(r.planet,o[a],n,r.color.shade==="dimmed"),y:1,pivot:n==="away"?{x:Qr.w,y:Qr.h+1}:{x:0,y:Qr.h+1}});const c=wr({[s]:a});if(r.planet==="moonbase"){const u=`moonbase.wall.screen.${o[a]}.away`;hh(u)&&(l=new te({children:[l]}),l.addChild(W({animationId:u,randomiseStartFrame:!0,flipX:n==="left",x:n==="away"?-8:8,y:-23})))}l.x+=c.x,l.y+=c.y,i.addChild(l),i.filters=pt(r)}return i}),AE=({renderContext:{item:{state:{setting:t},config:e}},currentRendering:r})=>{const n=r?.renderProps,o=e.type==="in-store"?Aa(L.getState(),e.path)?"right":"left":t;return n===void 0||o!==n.setting?{output:W(`switch.${o}`),renderProps:{setting:o}}:"no-update"},TE=(t,e,r)=>e==="tower"?"tower":e==="book"?"book.x":e==="organic"&&t?`block.organic.dark${r?".disappearing":""}`:`block.${e}${r?".disappearing":""}`,RE=({renderContext:{item:{config:{style:t,times:e},state:{disappearing:r}},room:n},currentRendering:o})=>{const s=o?.renderProps,i=r!==null;return s===void 0||s.isDissapearing!==i?{output:W({textureId:TE(n.color.shade==="dimmed",t,i),filter:t==="organic"?pt(n):t==="book"?Bp(n):void 0,times:e}),renderProps:{isDissapearing:i}}:"no-update"},IE=({state:{stoodOnBy:t,position:e},config:{times:r}},n)=>{const o=new Array(r?.x??1).fill(null).map(()=>new Array(r?.y??1));return co(t,n).filter(jd).forEach(({id:s,state:{position:i}})=>{const a=hr(i,e),l={x:Math.floor(a.x/F.w),y:Math.floor(a.y/F.d)};l.x<0||l.x>=(r?.x??1)||l.y<0||l.y>=(r?.y??1)||(o[l.x][l.y]=s)}),o},OE=(t,e)=>{let r=0,n=1;for(const o of e)for(const s of o)s!==void 0&&t.items[s]?.state.activated&&(r|=n),n<<=1;return r},jE=({renderContext:{item:t,room:e},currentRendering:r})=>{const{config:{times:n}}=t,o=r===void 0?IE(t,e):r.renderProps.chargePositions,s=OE(e,o);return s!==r?.renderProps.cybermanActivationBitmask?{output:W({textureIdCallback(a,l){const c=o[a][l];return c===void 0||e.items[c]?.state.everActivated?"toaster.off":"toaster.on"},times:n??le}),renderProps:{chargePositions:o,cybermanActivationBitmask:s}}:"no-update"},$E={head:Pi,heels:Pi,headOverHeels:Pi,doorFrame:FC,doorLegs:BC,monster:cE,floatingText:fE,barrier:Oe(({renderContext:{item:{config:{axis:t,times:e}}}})=>W({textureId:`barrier.${t}`,times:e})),deadlyBlock:Oe(({renderContext:{item:{config:t},room:e}})=>{switch(t.style){case"volcano":return W({animationId:"volcano",filter:pt(e),times:t.times,randomiseStartFrame:!0});case"toaster":throw new Error("use the special toaster appearance instead");default:throw t.style,new Error("unknown deadly block style")}}),spikes:Nt("spikes"),slidingDeadly:CE,slidingBlock:Oe(({renderContext:{item:{config:{style:t}},room:e}})=>W(t==="book"?{textureId:"book.y",filter:Bp(e)}:t)),block:RE,switch:AE,conveyor:vE,lift:Oe(({renderContext:{general:{paused:t}}})=>{const e=new te,r={x:Cl.w/2,y:Cl.h};return e.addChild(W({animationId:"lift",pivot:r,paused:t})),e.addChild(W({textureId:"lift.static",pivot:r})),e}),teleporter:bE,sceneryCrown:Oe(({renderContext:{item:{config:{planet:t}}}})=>W({textureId:`crown.${t}`})),pickup:Oe(({renderContext:{item:{config:t},room:e,general:{paused:r}}})=>{if(t.gives==="crown")return W({textureId:`crown.${t.planet}`});const o={shield:"whiteRabbit",jumps:"whiteRabbit",fast:"whiteRabbit","extra-life":"whiteRabbit",bag:"bag",doughnuts:"doughnuts",hooter:"hooter",scroll:{textureId:"scroll",filter:pt(e)},reincarnation:{animationId:"fish",paused:r}}[t.gives];return W(o)}),moveableDeadly:Nt("fish.1"),charles:wE,joystick:Nt("joystick"),movingPlatform:Nt("sandwich"),pushableBlock:Nt("stepStool"),portableBlock:Oe(({renderContext:{item:{config:{style:t}}}})=>W(t)),spring:_E,sceneryPlayer:SE,hushPuppy:Nt("hushPuppy"),bubbles:Oe(({renderContext:{item:{config:{style:t}},general:{paused:e}}})=>W({animationId:`bubbles.${t}`,paused:e})),firedDoughnut:Nt({animationId:"bubbles.doughnut"}),ball:Nt("ball"),floor:nE,particle:Oe(({renderContext:{item:{config:{forCharacter:t}}}})=>W({animationId:"particle.fade",anchor:{x:.5,y:.5},filter:t==="heels"?Up:er}))},NE=t=>{if(t.type==="wall"){const{direction:e}=t.config;return e==="right"||e==="towards"?void 0:PE}return t.type==="deadlyBlock"&&t.config.style==="toaster"?jE:$E[t.type]},zE=$.moss,ME=()=>new gt({outlineColor:zE,lowRes:!1,upscale:Jt(L.getState())});class DE{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output)}output=new te({label:"PortableItemPickUpNextHighlightRenderer"});#e=!1;tick(e){const{wouldPickUpNext:r}=this.renderContext.item.state;r!==!this.#e&&(this.output.filters=r?[ME()]:er),this.#e=r,this.childRenderer.tick(e)}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const LE=(t,e,r)=>Um(t)?new DE(e,r):r,BE=$.pastelBlue,FE=$.highlightBeige,UE=$.midRed,HE=$.white,Gu=new gt({outlineColor:FE,upscale:Jt(L.getState()),lowRes:!1}),qu=new gt({outlineColor:UE,upscale:Jt(L.getState()),lowRes:!1}),WE=new gt({outlineColor:HE,upscale:Jt(L.getState()),lowRes:!1}),Vu=new Le(BE),Ku={left:"↖",away:"↗",right:"↘",towards:"↙"},Xu=(t,e)=>{switch(t){case"back-forth":switch(e){case"left":return"↖↘";case"right":return"↘↖";case"away":return"↗↙";case"towards":return"↙↗";default:throw new Error("Unexpected startDirection")}case"clockwise":switch(e){case"left":return"↖↗↘↙";case"right":return"↘↙↖↘";case"away":return"↗↘↙↖";case"towards":return"↙↖↗↘";default:throw new Error("Unexpected startDirection")}case"towards-analogue":return"➡.⬅"}return""};class GE{constructor(e,r){this.renderContext=e,this.childRenderer=r,this.output.addChild(r.output),this.#e()}output=new te({label:"EditorAnnotationsRenderer"});#e(){const e=this.renderContext.item;switch(e.type){case"pickup":if(e.config.gives==="shield"||e.config.gives==="extra-life"||e.config.gives==="jumps"||e.config.gives==="fast"){const r={shield:"🛡",jumps:"♨",fast:"⚡","extra-life":"+2"};this.#t({annotationText:r[e.config.gives],yAdj:-16})}break;case"doorFrame":if(e.config.part==="near"){const{rooms:r}=L.getState().levelEditor.campaignInProgress,{config:{toRoom:n,direction:o}}=e,s=!!r[n],i=n.toUpperCase(),a=Ku[o],l=o==="away"||o==="right"?`${i}${a}`:`${a}${i}`;this.#t({annotationText:l,yAdj:o==="left"||o==="away"?-48:0,error:!s,clickDispatch:s?()=>Bi(n):void 0})}break;case"teleporter":{const{rooms:r}=L.getState().levelEditor.campaignInProgress,{config:{toRoom:n}}=e,o=!!r[n];this.#t({annotationText:`➡${n.toUpperCase()}`,yAdj:-12,error:!o,clickDispatch:o?()=>Bi(n):void 0})}break;case"conveyor":{const{config:{direction:r}}=e,n=Ku[r];this.#t({annotationText:n,yAdj:-12})}break;case"movingPlatform":{const{config:{movement:r,startDirection:n}}=e;this.#t({annotationText:Xu(r,n),yAdj:-12})}break;case"monster":{const{config:r}=e;(r.which==="turtle"||r.which==="skiHead")&&this.#t({annotationText:Xu(r.movement,r.startDirection),yAdj:-12})}break}}#t({annotationText:e,yAdj:r=0,error:n=!1,clickDispatch:o}){const{renderContext:{frontLayer:s}}=this,i=new Le(n?$.midRed:$.white),a=Hp(new te({label:"EditorAnnotationTextContainer",filters:[i,new gt({lowRes:!0,outlineColor:$.pureBlack,upscale:Jt(L.getState())})]}),e);a.y=r,o!==void 0&&(a.eventMode="static",a.on("click",()=>{L.dispatch(o())}),a.on("mouseover",()=>{L.getState().levelEditor.tool.type==="pointer"&&(L.dispatch(Pl(!0)),i.targetColor=$.pastelBlue)}),a.on("mouseout",()=>{L.dispatch(Pl(!1)),i.targetColor=$.white}),a.cursor="pointer"),this.output.addChild(a),s.attach(a)}tick(e){this.#r(),this.childRenderer.tick(e)}#r(){const{renderContext:{item:e,room:r}}=this,{clickableAnnotationHovered:n}=L.getState().levelEditor,{jsonItemId:o}=e,s=L.getState(),i=$d(s),a=Hm(s),l=cr(s),c=o&&i?.jsonItemId===o&&!n,u=o&&a.includes(o),d=()=>o!==void 0&&(Re(r.items).some(f=>f.jsonItemId===i?.jsonItemId&&f.type==="switch"&&f.config.type==="in-room"&&f.config.modifies.some(p=>p.targets.includes(o)))||e.type==="switch"&&Re(r.items).some(({jsonItemId:f})=>f!==void 0&&f===i?.jsonItemId&&e.config.type==="in-room"&&e.config.modifies.some(p=>p.targets.includes(f)))||e.type==="charles"&&Re(r.items).some(f=>f.jsonItemId===i?.jsonItemId&&f.type==="joystick"&&f.config.controls.some(p=>p===o))||e.type==="joystick"&&e.config.controls.some(f=>i?.jsonItemId===f));this.output.filters=c&&u?[Vu,l.type==="eyeDropper"?qu:Gu]:c?l.type==="eyeDropper"?qu:Gu:u?Vu:d()?WE:er}destroy(){this.output.destroy(),this.childRenderer.destroy()}}const qE=(t,e,r)=>e.general.editor?new GE(e,r):r,VE=(t,e)=>{e!==void 0&&L.getState().gameMenus.cheatsOn&&(e.eventMode="static",e.on("pointertap",()=>{L.dispatch(Qg({item:t}))}))},KE=t=>{const e=L.getState(),r=Yg(e),n=!Zg(e),{item:o}=t,s=r==="all"||r==="non-wall"&&t.item.type!=="wall",i=[],a=NE(o);if(a!==void 0){const f=new $p(t,a),p=new MC(t,f);i.push(qE(o,t,LE(o,t,p)))}if(n){const f=Yk(t);f!==void 0&&i.push(f)}s&&i.push(new Lk(t));let l;if(i.length===0)l=void 0;else{const f=i.length===1?i[0]:new XE(i,t);VE(o,f.output),l=new Bk(t,f)}const c=t.general.soundSettings.mute??Ia.soundSettings.mute,u=t.general.paused||c?void 0:mC(t),d=u===void 0?void 0:new xC(t,u);return new Zk(t,{graphics:l,sound:d})};class XE{constructor(e,r){this.renderContext=r,this.#e=e,this.#t.addChild(...e.map(n=>n.output))}#e;#t=new te({label:"CompositeRenderer"});tick(e){for(const r of this.#e)r.tick(e)}destroy(){for(const e of this.#e)e.destroy()}get output(){return this.#t}}const JE=ro("wall","doorFrame"),Ju=256;function*YE(t){const{left:e,right:r}=Re(t.items).filter(JE).reduce((n,{aabb:o,renderAabb:s,renderAabbOffset:i,state:{position:a}})=>{const l=s??o,c=D(a,i??fe),u=K(D(c,{x:l.x})).x,d=K(D(c,{y:l.y})).x;return{left:Math.min(n.left,u),right:Math.max(n.right,d)}},{left:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY});e!==Number.POSITIVE_INFINITY&&(yield new ut().rect(e-100,-256,100,Ju).fill(0)),r!==Number.NEGATIVE_INFINITY&&(yield new ut().rect(r,-256,100,Ju).fill(0))}class ZE{constructor(e){this.renderContext=e;const{general:{colourised:r,soundSettings:n},room:o}=e;this.initFilters(r,e.room.color);const i=n.mute??Ia.soundSettings.mute?void 0:ae.createGain();Ps(YE(o),this.#o),this.output={sound:i,graphics:new te({label:`RoomRenderer(${e.room.id})`})},this.output.graphics.addChild(this.#t),r||(this.#r=new Jl({sortableChildren:!1}),this.output.graphics.addChild(this.#r)),this.output.graphics.addChild(this.#o),this.output.graphics.addChild(this.#n)}#e=!1;#t=new te({label:"items"});#r;#n=new Jl({sortableChildren:!1});#o=new te({label:"occlusion"});output;#s=void 0;#l=new Map;#i=new Map;initFilters(e,r){this.#t.filters=e?r.shade==="dimmed"?jC:er:new Le(r.shade==="dimmed"?Kf(is(r).main.original):is(r).main.original)}#c(e){const{room:r}=this.renderContext,n={...e,lastRenderRoomTime:this.#s};for(const s of Re(r.items)){let i=this.#i.get(s.id);if(i===void 0){i=KE({...this.renderContext,colourClashLayer:this.#r,frontLayer:this.#n,item:s}),this.#i.set(s.id,i);const{graphics:a,sound:l}=i.output;if(a&&(this.#t.addChild(a),s.fixedZIndex&&(a.zIndex=s.fixedZIndex)),l){if(!this.output.sound)throw new Error("item renderer has sound, but room renderer does not - this probably means that they disagree on if the user has sound muted");l.connect(this.output.sound)}}try{i.tick(n)}catch(a){throw new Error(`RoomRenderer for room ${this.renderContext.room.id} caught error while ticking Renderer for item "${s.id}" - item in play object is:
           ${JSON.stringify(s,null,2)}`,{cause:a})}}let o=!1;for(const[s,i]of this.#i.entries())r.items[s]===void 0&&(i.destroy(),this.#i.delete(s),o=!0);o&&this.#a()}#a(){if(this.#r)for(const e of this.#r.renderLayerChildren)e.parent===null&&this.#r.detach(e);for(const e of this.#n.renderLayerChildren)e.parent===null&&this.#n.detach(e)}#d(e){const r=jp(this.renderContext.room.items,e.movedItems,this.#l),{order:n}=gl(r,this.renderContext.room.items);for(let o=0;o<n.length;o++){const s=this.#i.get(n[o]);if(s===void 0)throw new Error(`Item id=${n[o]} does not have a renderer - cannot assign a z-index`);const i=s.output.graphics;if(i)i.zIndex=n.length-o;else throw new Error(`order ${n[o]} was given a z-order by sorting, but item has no graphics`)}}get#u(){return this.#s!==void 0}tick(e){const r=this.#u?e:{...e,movedItems:new Set(Re(this.renderContext.room.items))};this.#c(r),(!this.#u||r.movedItems.size>0)&&this.#d(r),this.#s=this.renderContext.room.roomTime}destroy(){this.output.graphics.label=this.output.graphics.label+"DESTROYED",this.output.graphics.destroy({children:!0}),this.output.sound?.disconnect(),this.#i.forEach(e=>{e.destroy()}),this.#e=!0}get destroyed(){return this.#e}}const QE=t=>{t.ticker.remove(t.render,t)},Wp=g.createContext(null),eP=({children:t})=>{const[e,r]=g.useState(null);return g.useEffect(()=>{const n=new Qd;return n.init({background:$.pureBlack,sharedTicker:!0}).then(()=>{QE(n),r(n)}),()=>{}},[]),e===null?null:h.jsx(Wp,{value:e,children:t})},Pr=()=>g.useContext(Wp),tP=(t,e)=>({displaySettings:{emulatedResolution:"amigaLowResPal",showBoundingBoxes:e},soundSettings:{mute:!0},pixiRenderer:t,gameState:void 0,paused:!1,colourised:!0,upscale:ja(L.getState()),editor:!0}),Yu=(t,e,r)=>new ZE({room:t,general:tP(e,r)}),rP=()=>{const{renderer:t}=Pr(),e=vd();if(!t)throw new Error("this should never be falsey (typescript violation)");const r=Pp(),[n,o]=g.useState(()=>Yu(r,t,e));return g.useEffect(()=>{const s=Yu(r,t,e);return o(s),()=>{s.destroy()}},[r,t,e]),n},Zu=(t,e,r)=>{const{world:{onItem:{face:n},position:o,itemId:s}}=t;if(n.z>_d)return qo(o);if(r.type==="door"){const i=e.items[s];if(i.type!=="wall")return;const{config:a,aabb:l,state:{position:c}}=i,u=Wm($a(a)),d=vn(Gt(a.direction)),f=Gt(a.direction);if(u[d]<2)return;const p=c[d],y=c[d]+l[d]-tk,m=c.z,v=c.z+l.z-Nn,b={[d]:Math.max(Math.min(o[d],y),p),[f]:o[f],z:Math.max(Math.min(o.z,v),m)};return qo(b)}return D(qo(o),n)},nP={z:1,x:0,y:0},oP={z:0,x:0,y:-1},Qu={z:0,x:-1,y:0},sP=(t,{x:e,y:r},n)=>{if(n.type==="item"&&n.item.type==="door"&&t.type==="wall"){const l=t.config.direction;return hs(Ce[l],-1)}const{bottomCentre:o,topLeft:s,topRight:i}=pn(t.state.position,t.aabb);return r<s.y-(s.x-e)/2?r<i.y-(e-i.x)/2?nP:Qu:e<o.x?oP:Qu},iP=3,aP=(t,{x:e,y:r},n)=>{const o=pn(t.state.position,t.aabb);return em.find(s=>{const i=o.projectCorner(s);return Oa(hr(i,{x:e,y:r}))<iP})},Ur=3,Ai=1.5;function bt({x:t,y:e},r,n){const o={x:t-r.x,y:e-r.y},s=o.x*n.y-o.y*n.x;return Math.abs(s)/tm(Math.hypot(n.x,n.y))}const Gp={point:{x:-1,y:-1,z:0},normal:{x:0,y:0,z:1}},qp={point:{x:-1,y:0,z:1},normal:{x:0,y:1,z:0}},Vp={point:{x:0,y:-1,z:1},normal:{x:1,y:0,z:0}},Kp={point:{x:0,y:1,z:1},normal:{x:1,y:0,z:0}},Xp={point:{x:1,y:0,z:1},normal:{x:0,y:1,z:0}},Jp={point:{x:1,y:-1,z:0},normal:{x:0,y:0,z:1}},Yp={point:{x:0,y:-1,z:-1},normal:{x:1,y:0,z:0}},Zp={point:{x:-1,y:1,z:0},normal:{x:0,y:0,z:1}},Qp={point:{x:-1,y:0,z:-1},normal:{x:0,y:1,z:0}},lP=(t,e,r,n)=>{const o=pn(t.state.position,t.aabb),s=r.x<0,i=r.y<0,a=r.z>0;if((s||i)&&bt(e,o.bottomCentre,{x:0,y:-1})<Ai)return Gp;if((s||a)&&bt(e,o.topRight,{x:2,y:-1})<Ai)return qp;if((i||a)&&bt(e,o.topLeft,{x:2,y:1})<Ai)return Vp;switch(!0){case a:{const l=o.c111;if(bt(e,l,{x:2,y:1})<Ur)return Kp;if(bt(e,l,{x:-2,y:1})<Ur)return Xp;break}case i:{const l=o.c100;if(bt(e,l,{x:0,y:-1})<Ur)return Jp;if(bt(e,l,{x:2,y:1})<Ur)return Yp;break}case s:{const l=o.c010;if(bt(e,l,{x:0,y:-1})<Ur)return Zp;if(bt(e,l,{x:-2,y:1})<Ur)return Qp;break}}},ed=(t,e,r)=>r?{position:t.state.position,aabb:t.aabb}:{position:D(t.state.position,t.renderAabbOffset??fe),aabb:t.renderAabb??t.aabb},td=({x:t,y:e},r,n)=>{const{bottomCentre:o,topLeft:s,topRight:i}=pn(r,n);return!(t<s.x||t>i.x||e<i.y-(i.x-t)/2||e<s.y-(t-s.x)/2||e>o.y-(t-o.x)/2||e>o.y-(o.x-t)/2)},cP=(t,e,r)=>{const{position:n,aabb:o}=ed(r,e,!1);if(td(t,n,o))return"intersects-rendered";if(e.type==="item"&&r.type==="wall"){const{position:i,aabb:a}=ed(r,e,!0);if(td(t,i,a))return"intersects-unrendered"}return"non-intersecting"},rd=t=>t.fixedZIndex!==void 0,uP=t=>{const r=t.some(([,a])=>a==="intersects-rendered")?t.filter(([,a])=>a==="intersects-rendered").map(([a])=>a):t.map(([a])=>a);if(r.every(rd))return r.toSorted((a,l)=>l.fixedZIndex-a.fixedZIndex).at(0);const n=r.filter(a=>!rd(a));if(n.length===0)return;if(n.length===1)return n[0];const o=Object.fromEntries(n.map(a=>[a.id,a])),s=jp(o),{order:i}=gl(s,o);return o[i[0]]},eg=(t,e,r,n)=>{const o=!n||r.type==="item"&&r.item.type==="door",s=o?F.w:F.w/2,i=F.h,a=o?0:s/2,l=i/2,c=xd(e);return{x:c==="yz"?Math.round(t.x/s)*s:Math.floor((t.x-a)/s)*s,y:c==="xz"?Math.round(t.y/s)*s:Math.floor((t.y-a)/s)*s,z:c==="xy"?Math.round(t.z/i)*i:Math.floor((t.z+l)/i)*i}},dP=({state:{position:t},aabb:e},r,n,o,s)=>{const i={x:t.x+(r.x<0?0:e.x),y:t.y+(r.y<0?0:e.y),z:t.z+(r.z<0?0:e.z)},a=ZS(i,r,n);return eg(a,r,o,s)},hP=t=>e=>{const r=ln(e);return t.type==="item"&&t.item.type==="door"?r&&e.type==="wall":r},Ti=(t,e,r,n)=>{const o=Re(e.items).filter(hP(r)).map(a=>[a,cP(t,r,a)]).filter(a=>a[1]!=="non-intersecting"),s=uP(Array.from(o)),i=e.id;if(s){const a=sP(s,t,r);if(!(a.z>0&&!Object.isExtensible(s.state.stoodOnBy)))return{roomId:i,scrXy:t,world:{itemId:s.id,onItem:{face:a,corner:aP(s,t),edge:lP(s,t,a)},position:dP(s,a,t,r,n)}}}return{roomId:i,scrXy:t,world:void 0}},fP=(t,e=console.error)=>(...r)=>{try{return t(...r)}catch(n){e(n);return}},pP=t=>zd(e=>e>0?e:e>-1?1:-e+1,t),gP=({jsonItem:t,blockDragAccVec:e,resizeEdgeDirection:r})=>{const n=t.position,o=Gm(t),s=Zo(e,r,Nd(t)),i=D(o,s),a=pP(i),l=zd((c,u,d,f,p)=>{const y=u<1;return c<0!==y?y?d-p+1:d+f-p:y?d+f-1:d},r,i,n,o,a);return{timesDelta:sn(a,o),positionDelta:sn(l,n)}},Ri=(t,e)=>{const r=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const n=e.target.getBoundingClientRect(),o=e.clientX-n.left,s=e.clientY-n.top;return{x:o/r-t.gameEngineScreenSize.x/2,y:s/r-t.gameEngineScreenSize.y+16}},mP=(t,e)=>{const r=t.cssUpscale*t.gameEngineUpscale;if(e.target===null)throw new Error("Mouse event target is null");const n=e.movementX,o=e.movementY;return{x:n/r,y:o/r}},yP=5,vP=(t,e,r)=>{const n=t.world?.onItem.edge,o=Zo(...mt(r).map(i=>Nd(i))),s=Zo(n?.point??fe,o);return Ed(s)>0?n.normal:e?{x:1,y:0,z:0}:{x:0,y:0,z:1}},bP=(t,e,r,n,o,s)=>{if(t===void 0)return;const i=hr(e,t.scrXy),a=Oa(i);if(!(o||a>yP))return;const c=vP(t,n,s),u=Sp(c,r);return n?{x:0,y:0,z:u.z}:u},nd=(t,e=!1)=>{const r=L.getState().levelEditor;return eg(t,{x:0,y:0,z:1},r.tool,!e&&r.halfGridResolution)},zo=({levelEditor:t},e,r)=>{const n=e.items[r]?.jsonItemId;if(n===void 0)return;const o=Dd(t,n);if(o!==void 0)return[n,o]},Ko=(t,...e)=>t.levelEditor.wallsFloorsLocked&&e.some(r=>r.type==="wall"||r.type==="floor"),Ii=(t,e)=>{const r=L.getState();let n;if(e.world){const o=e.world.itemId,s=o&&t.items[o],i=Ko(r,s)?void 0:s.jsonItemId;n=i===void 0?void 0:{jsonItemId:i,pointingAtOnItem:e.world.onItem}}else n=void 0;Ue($d(r),n)||L.dispatch(Md(n))},wP=(t,e,r)=>{const n=r?.world?.itemId;if(n===void 0)return Qo;const o=e.items[n].jsonItemId;if(o===void 0)return Qo;const{selectedJsonItemIds:s}=t.levelEditor;return s.includes(o)?s:[o]},xP=t=>{const e=Pr(),r=Sr(ja),n=Be(),o=Ep(),s=g.useRef(void 0),i=g.useRef(void 0),a=g.useRef(void 0);g.useEffect(()=>{if(t===null)return;const l=p=>{const y=Ri(r,p),m=mP(r,p),v=L.getState(),b=cr(v),_=Ti(y,o,b,v.levelEditor.halfGridResolution),w=!Ue(_.world,s.current?.world);switch(b.type){case"item":{if(!w||(n(Fi()),_.world===void 0))break;const x=zo(v,o,_.world.itemId);if(x===void 0)break;const[,k]=x,C=Zu(_,o,b.item);if(C===void 0||Ck({roomState:o,blockPosition:C,itemTool:b.item}))break;n(Al({blockPosition:C,pointedAtItemJson:k,preview:!0}));break}case"pointer":{const x=wP(v,o,i.current);if(x.length===0){Ii(o,_);break}const k=x.map(re=>Km(v,re));if(Ko(v,...k))break;const S=_.roomId===i.current?.roomId?bP(i.current,y,m,p.metaKey||p.shiftKey,a.current!==void 0,k):void 0;if(!S){Ii(o,_);break}x.length===1&&!Xm(v,x[0])&&L.dispatch(zs({jsonItemIds:x}));const N=i.current?.world?.onItem.edge,X=N&&k.every(re=>Ld(re)),B=a.current??fe,q=D(B,S),O=nd(q,X);if(a.current=q,Ra(nd(B,X),O))break;const se=qo(O);let M,J;if(X){const[,re]=zo(v,o,i.current.world.itemId);({timesDelta:J,positionDelta:M}=gP({jsonItem:re,blockDragAccVec:se,resizeEdgeDirection:N.point}))}else M=se;if(Tp({roomState:o,jsonItemIds:x,blockPositionDelta:M,timesDelta:J}))break;n(Td({jsonItemIds:x,positionDelta:M,timesDelta:J}));break}case"eyeDropper":Ii(o,_);break}s.current=_},c=p=>{const y=L.getState();if(o.id!==y.levelEditor.currentlyEditingRoomId)return;const m=Ri(r,p),v=cr(L.getState()),b=Ti(m,o,v,y.levelEditor.halfGridResolution),_=a.current!==void 0,w=!_&&b.roomId===i.current?.roomId&&b.world?.itemId===i.current?.world?.itemId;if(a.current=void 0,i.current=void 0,L.dispatch(qm(!1)),!w&&!_){console.log("mouseUp - not a click or drag end - skipping");return}switch(v.type){case"item":{if(b.world===void 0){n(fr({type:"pointer"}));break}const x=zo(y,o,b.world.itemId);if(x===void 0)break;const[,k]=x;n(Al({blockPosition:Zu(b,o,v.item),pointedAtItemJson:k,preview:!1}));break}case"pointer":{if(w){const x=b.world===void 0?void 0:o.items[b.world.itemId];if(x?.jsonItemId===void 0||Ko(y,x)){n(zs({jsonItemIds:[]}));break}n(p.ctrlKey||p.metaKey?Vm({jsonItemId:x.jsonItemId}):zs({jsonItemIds:[x.jsonItemId]}))}else _&&n(Rd());break}case"eyeDropper":{if(w){const x=b.world?.itemId;if(x===void 0){console.warn("no itemId");break}const k=o.items[x];if(Ko(y,k))break;const C=zo(y,o,x);if(C===void 0)break;const[,S]=C;n(fr({type:"item",item:{type:S.type,config:S.config}}))}break}}},u=p=>{const y=cr(L.getState());switch(a.current=void 0,i.current=void 0,y.type){case"item":{n(Fi());break}case"pointer":{n(Md(void 0));break}}},d=p=>{const y=Ri(r,p),m=L.getState(),v=cr(m),b=Ti(y,o,v,m.levelEditor.halfGridResolution);console.log("setting mouseDownPointingAtRef to",b),i.current=b},f=fP(l);return t.addEventListener("mousemove",f),t.addEventListener("mouseup",c),t.addEventListener("mousedown",d),t.addEventListener("mouseleave",u),t.tabIndex=0,()=>{t.removeEventListener("mousemove",f),t.removeEventListener("mouseup",c),t.removeEventListener("mousedown",d),t.removeEventListener("mouseleave",u)}},[e.stage,r,t,n,o])},_P=()=>{const{cssUpscale:t,canvasSize:e,rotate90:r}=Sr(ja);return{transform:r?`scale(${t}) rotate(90deg) translate(0, -${e.y}px)`:`scale(${t})`,width:e.x,height:e.y,transformOrigin:"top left"}},SP=t=>{const e=Pp(),r=Pr();g.useEffect(()=>{let n=0;const o=({deltaMS:s})=>{if(t.destroyed)return;t.renderContext.room!==e&&console.warn("room renderer does not have the current room");const i=new Set(Yo(e.items));e.roomTime+=s,t.tick({deltaMS:s,movedItems:i,progression:n++}),r.render()};return Kr.shared.add(o),()=>{Kr.shared.remove(o)}},[t,e,r])},kP=t=>{const e=Pr();g.useEffect(()=>{if(t)return t.appendChild(e.canvas),()=>{t.removeChild(e.canvas)}},[t,e])},CP=()=>{const t=Pr(),e=Sr(r=>r.upscale.upscale.gameEngineUpscale);t.stage.scale=e},EP=()=>{const t=Pr(),e=Sr(rm);g.useEffect(()=>{t.renderer?.resize(e.x,e.y)},[t.renderer,e])},PP=t=>{const e=Pr(),[r]=g.useState(()=>new te),n=Sr(nm);g.useEffect(()=>{if(t.destroyed){console.log("useAddRoomRendererOutputToApplicationStage: room renderer was destroyed, will not add its output to app");return}return r.addChild(t.output.graphics),e.stage.addChild(r),()=>{e.stage.removeChild(r),r.removeChild(t.output.graphics)}},[t,e,r]),g.useEffect(()=>{r.x=n.x/2,r.y=n.y-16},[r,n])},od=(t,e)=>{L.dispatch(om(sm(t??im(L.getState()),e)))},AP=(t,e)=>{const r=Be();g.useLayoutEffect(()=>{od()},[]),g.useLayoutEffect(()=>{const n=()=>od(t,e);if(e){const o=new ResizeObserver(n);return o.observe(e),()=>o.disconnect()}else return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[r,e,t])},TP=()=>{g.useEffect(()=>am({actionCreator:fr,effect(t,{dispatch:e}){e(Fi())}}))},RP=({levelEditor:t})=>{const{dragInProgress:e,clickableAnnotationHovered:r,hoveredItem:n,selectedJsonItemIds:o}=t;if(e)return ge("cursor-grabbing");if(r)return ge("cursor-pointer");if(n){const s=Dd(t,n.jsonItemId);if(s!==void 0&&Ld(s))if(n.pointingAtOnItem.corner){if(Ra(n.pointingAtOnItem.corner,{x:1,y:1,z:1}))return ge("cursor-n-resize")}else{const{edge:i}=n.pointingAtOnItem;if(i){if(Ue(i,Zp))return ge("cursor-e-resize");if(Ue(i,Gp))return ge("cursor-s-resize");if(Ue(i,Jp))return ge("cursor-w-resize");if(Ue(i,qp)||Ue(i,Kp))return ge("cursor-ne-resize");if(Ue(i,Vp)||Ue(i,Xp))return ge("cursor-nw-resize");if(Ue(i,Qp))return ge("cursor-se-resize");if(Ue(i,Yp))return ge("cursor-sw-resize")}}return o.includes(n.jsonItemId)?ge("cursor-grab"):ge("cursor-default")}return ge("cursor-crosshair")},IP=()=>de(RP);lm.defaultOptions.scaleMode="nearest";const OP=()=>{const t=rP(),[e,r]=g.useState(null),[n,o]=g.useState(null),s=IP();AP("amigaLowResPal",n??void 0),EP(),PP(t),SP(t),xP(e),kP(e),CP(),TP();const i=_P();return h.jsx("div",{className:`w-full h-full overflow-hidden ${s}`,ref:o,children:h.jsx("div",{style:i,ref:r})})},sd=t=>`res${t[0].toUpperCase()}${t.slice(1)}`,jP=()=>{const t=cm(),e=Sr(um);g.useEffect(()=>{document.body.classList.add("overscroll-none","overflow-hidden","select-none",dm())},[]),g.useEffect(()=>{document.body.classList.remove(...Object.keys(hm).map(sd)),document.body.classList.add(sd(t)),document.body.classList.toggle("portrait-rot",e)},[t,e])},Rs=g.createContext(null);Rs.displayName="PanelGroupContext";const ye={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},bl=10,dr=g.useLayoutEffect,id=yd.useId,$P=typeof id=="function"?id:()=>null;let NP=0;function wl(t=null){const e=$P(),r=g.useRef(t||e||null);return r.current===null&&(r.current=""+NP++),t??r.current}function tg({children:t,className:e="",collapsedSize:r,collapsible:n,defaultSize:o,forwardedRef:s,id:i,maxSize:a,minSize:l,onCollapse:c,onExpand:u,onResize:d,order:f,style:p,tagName:y="div",...m}){const v=g.useContext(Rs);if(v===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:b,expandPanel:_,getPanelSize:w,getPanelStyle:x,groupId:k,isPanelCollapsed:C,reevaluatePanelConstraints:S,registerPanel:N,resizePanel:X,unregisterPanel:B}=v,q=wl(i),O=g.useRef({callbacks:{onCollapse:c,onExpand:u,onResize:d},constraints:{collapsedSize:r,collapsible:n,defaultSize:o,maxSize:a,minSize:l},id:q,idIsFromProps:i!==void 0,order:f});g.useRef({didLogMissingDefaultSizeWarning:!1}),dr(()=>{const{callbacks:M,constraints:J}=O.current,V={...J};O.current.id=q,O.current.idIsFromProps=i!==void 0,O.current.order=f,M.onCollapse=c,M.onExpand=u,M.onResize=d,J.collapsedSize=r,J.collapsible=n,J.defaultSize=o,J.maxSize=a,J.minSize=l,(V.collapsedSize!==J.collapsedSize||V.collapsible!==J.collapsible||V.maxSize!==J.maxSize||V.minSize!==J.minSize)&&S(O.current,V)}),dr(()=>{const M=O.current;return N(M),()=>{B(M)}},[f,q,N,B]),g.useImperativeHandle(s,()=>({collapse:()=>{b(O.current)},expand:M=>{_(O.current,M)},getId(){return q},getSize(){return w(O.current)},isCollapsed(){return C(O.current)},isExpanded(){return!C(O.current)},resize:M=>{X(O.current,M)}}),[b,_,w,C,q,X]);const se=x(O.current,o);return g.createElement(y,{...m,children:t,className:e,id:q,style:{...se,...p},[ye.groupId]:k,[ye.panel]:"",[ye.panelCollapsible]:n||void 0,[ye.panelId]:q,[ye.panelSize]:parseFloat(""+se.flexGrow).toFixed(1)})}const Xo=g.forwardRef((t,e)=>g.createElement(tg,{...t,forwardedRef:e}));tg.displayName="Panel";Xo.displayName="forwardRef(Panel)";let ka=null,Jo=-1,Ft=null;function zP(t,e){if(e){const r=(e&ig)!==0,n=(e&ag)!==0,o=(e&lg)!==0,s=(e&cg)!==0;if(r)return o?"se-resize":s?"ne-resize":"e-resize";if(n)return o?"sw-resize":s?"nw-resize":"w-resize";if(o)return"s-resize";if(s)return"n-resize"}switch(t){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function MP(){Ft!==null&&(document.head.removeChild(Ft),ka=null,Ft=null,Jo=-1)}function Oi(t,e){var r,n;const o=zP(t,e);if(ka!==o){if(ka=o,Ft===null&&(Ft=document.createElement("style"),document.head.appendChild(Ft)),Jo>=0){var s;(s=Ft.sheet)===null||s===void 0||s.removeRule(Jo)}Jo=(r=(n=Ft.sheet)===null||n===void 0?void 0:n.insertRule(`*{cursor: ${o} !important;}`))!==null&&r!==void 0?r:-1}}function rg(t){return t.type==="keydown"}function ng(t){return t.type.startsWith("pointer")}function og(t){return t.type.startsWith("mouse")}function Is(t){if(ng(t)){if(t.isPrimary)return{x:t.clientX,y:t.clientY}}else if(og(t))return{x:t.clientX,y:t.clientY};return{x:1/0,y:1/0}}function DP(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function LP(t,e,r){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function BP(t,e){if(t===e)throw new Error("Cannot compare node with itself");const r={a:cd(t),b:cd(e)};let n;for(;r.a.at(-1)===r.b.at(-1);)t=r.a.pop(),e=r.b.pop(),n=t;ee(n,"Stacking order can only be calculated for elements with a common ancestor");const o={a:ld(ad(r.a)),b:ld(ad(r.b))};if(o.a===o.b){const s=n.childNodes,i={a:r.a.at(-1),b:r.b.at(-1)};let a=s.length;for(;a--;){const l=s[a];if(l===i.a)return 1;if(l===i.b)return-1}}return Math.sign(o.a-o.b)}const FP=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function UP(t){var e;const r=getComputedStyle((e=sg(t))!==null&&e!==void 0?e:t).display;return r==="flex"||r==="inline-flex"}function HP(t){const e=getComputedStyle(t);return!!(e.position==="fixed"||e.zIndex!=="auto"&&(e.position!=="static"||UP(t))||+e.opacity<1||"transform"in e&&e.transform!=="none"||"webkitTransform"in e&&e.webkitTransform!=="none"||"mixBlendMode"in e&&e.mixBlendMode!=="normal"||"filter"in e&&e.filter!=="none"||"webkitFilter"in e&&e.webkitFilter!=="none"||"isolation"in e&&e.isolation==="isolate"||FP.test(e.willChange)||e.webkitOverflowScrolling==="touch")}function ad(t){let e=t.length;for(;e--;){const r=t[e];if(ee(r,"Missing node"),HP(r))return r}return null}function ld(t){return t&&Number(getComputedStyle(t).zIndex)||0}function cd(t){const e=[];for(;t;)e.push(t),t=sg(t);return e}function sg(t){const{parentNode:e}=t;return e&&e instanceof ShadowRoot?e.host:e}const ig=1,ag=2,lg=4,cg=8,WP=DP()==="coarse";let rt=[],on=!1,Ut=new Map,Os=new Map;const Qn=new Set;function GP(t,e,r,n,o){var s;const{ownerDocument:i}=e,a={direction:r,element:e,hitAreaMargins:n,setResizeHandlerState:o},l=(s=Ut.get(i))!==null&&s!==void 0?s:0;return Ut.set(i,l+1),Qn.add(a),us(),function(){var u;Os.delete(t),Qn.delete(a);const d=(u=Ut.get(i))!==null&&u!==void 0?u:1;if(Ut.set(i,d-1),us(),d===1&&Ut.delete(i),rt.includes(a)){const f=rt.indexOf(a);f>=0&&rt.splice(f,1),_l(),o("up",!0,null)}}}function qP(t){const{target:e}=t,{x:r,y:n}=Is(t);on=!0,xl({target:e,x:r,y:n}),us(),rt.length>0&&(ds("down",t),t.preventDefault(),ug(e)||t.stopImmediatePropagation())}function ji(t){const{x:e,y:r}=Is(t);if(on&&t.buttons===0&&(on=!1,ds("up",t)),!on){const{target:n}=t;xl({target:n,x:e,y:r})}ds("move",t),_l(),rt.length>0&&t.preventDefault()}function $i(t){const{target:e}=t,{x:r,y:n}=Is(t);Os.clear(),on=!1,rt.length>0&&(t.preventDefault(),ug(e)||t.stopImmediatePropagation()),ds("up",t),xl({target:e,x:r,y:n}),_l(),us()}function ug(t){let e=t;for(;e;){if(e.hasAttribute(ye.resizeHandle))return!0;e=e.parentElement}return!1}function xl({target:t,x:e,y:r}){rt.splice(0);let n=null;(t instanceof HTMLElement||t instanceof SVGElement)&&(n=t),Qn.forEach(o=>{const{element:s,hitAreaMargins:i}=o,a=s.getBoundingClientRect(),{bottom:l,left:c,right:u,top:d}=a,f=WP?i.coarse:i.fine;if(e>=c-f&&e<=u+f&&r>=d-f&&r<=l+f){if(n!==null&&document.contains(n)&&s!==n&&!s.contains(n)&&!n.contains(s)&&BP(n,s)>0){let y=n,m=!1;for(;y&&!y.contains(s);){if(LP(y.getBoundingClientRect(),a)){m=!0;break}y=y.parentElement}if(m)return}rt.push(o)}})}function Ni(t,e){Os.set(t,e)}function _l(){let t=!1,e=!1;rt.forEach(n=>{const{direction:o}=n;o==="horizontal"?t=!0:e=!0});let r=0;Os.forEach(n=>{r|=n}),t&&e?Oi("intersection",r):t?Oi("horizontal",r):e?Oi("vertical",r):MP()}let zi;function us(){var t;(t=zi)===null||t===void 0||t.abort(),zi=new AbortController;const e={capture:!0,signal:zi.signal};Qn.size&&(on?(rt.length>0&&Ut.forEach((r,n)=>{const{body:o}=n;r>0&&(o.addEventListener("contextmenu",$i,e),o.addEventListener("pointerleave",ji,e),o.addEventListener("pointermove",ji,e))}),Ut.forEach((r,n)=>{const{body:o}=n;o.addEventListener("pointerup",$i,e),o.addEventListener("pointercancel",$i,e)})):Ut.forEach((r,n)=>{const{body:o}=n;r>0&&(o.addEventListener("pointerdown",qP,e),o.addEventListener("pointermove",ji,e))}))}function ds(t,e){Qn.forEach(r=>{const{setResizeHandlerState:n}=r,o=rt.includes(r);n(t,o,e)})}function VP(){const[t,e]=g.useState(0);return g.useCallback(()=>e(r=>r+1),[])}function ee(t,e){if(!t)throw console.error(e),Error(e)}function xr(t,e,r=bl){return t.toFixed(r)===e.toFixed(r)?0:t>e?1:-1}function kt(t,e,r=bl){return xr(t,e,r)===0}function He(t,e,r){return xr(t,e,r)===0}function KP(t,e,r){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++){const o=t[n],s=e[n];if(!He(o,s,r))return!1}return!0}function Zr({panelConstraints:t,panelIndex:e,size:r}){const n=t[e];ee(n!=null,`Panel constraints not found for index ${e}`);let{collapsedSize:o=0,collapsible:s,maxSize:i=100,minSize:a=0}=n;if(xr(r,a)<0)if(s){const l=(o+a)/2;xr(r,l)<0?r=o:r=a}else r=a;return r=Math.min(i,r),r=parseFloat(r.toFixed(bl)),r}function Mn({delta:t,initialLayout:e,panelConstraints:r,pivotIndices:n,prevLayout:o,trigger:s}){if(He(t,0))return e;const i=[...e],[a,l]=n;ee(a!=null,"Invalid first pivot index"),ee(l!=null,"Invalid second pivot index");let c=0;if(s==="keyboard"){{const d=t<0?l:a,f=r[d];ee(f,`Panel constraints not found for index ${d}`);const{collapsedSize:p=0,collapsible:y,minSize:m=0}=f;if(y){const v=e[d];if(ee(v!=null,`Previous layout not found for panel index ${d}`),He(v,p)){const b=m-v;xr(b,Math.abs(t))>0&&(t=t<0?0-b:b)}}}{const d=t<0?a:l,f=r[d];ee(f,`No panel constraints found for index ${d}`);const{collapsedSize:p=0,collapsible:y,minSize:m=0}=f;if(y){const v=e[d];if(ee(v!=null,`Previous layout not found for panel index ${d}`),He(v,m)){const b=v-p;xr(b,Math.abs(t))>0&&(t=t<0?0-b:b)}}}}{const d=t<0?1:-1;let f=t<0?l:a,p=0;for(;;){const m=e[f];ee(m!=null,`Previous layout not found for panel index ${f}`);const b=Zr({panelConstraints:r,panelIndex:f,size:100})-m;if(p+=b,f+=d,f<0||f>=r.length)break}const y=Math.min(Math.abs(t),Math.abs(p));t=t<0?0-y:y}{let f=t<0?a:l;for(;f>=0&&f<r.length;){const p=Math.abs(t)-Math.abs(c),y=e[f];ee(y!=null,`Previous layout not found for panel index ${f}`);const m=y-p,v=Zr({panelConstraints:r,panelIndex:f,size:m});if(!He(y,v)&&(c+=y-v,i[f]=v,c.toPrecision(3).localeCompare(Math.abs(t).toPrecision(3),void 0,{numeric:!0})>=0))break;t<0?f--:f++}}if(KP(o,i))return o;{const d=t<0?l:a,f=e[d];ee(f!=null,`Previous layout not found for panel index ${d}`);const p=f+c,y=Zr({panelConstraints:r,panelIndex:d,size:p});if(i[d]=y,!He(y,p)){let m=p-y,b=t<0?l:a;for(;b>=0&&b<r.length;){const _=i[b];ee(_!=null,`Previous layout not found for panel index ${b}`);const w=_+m,x=Zr({panelConstraints:r,panelIndex:b,size:w});if(He(_,x)||(m-=x-_,i[b]=x),He(m,0))break;t>0?b--:b++}}}const u=i.reduce((d,f)=>f+d,0);return He(u,100)?i:o}function XP({layout:t,panelsArray:e,pivotIndices:r}){let n=0,o=100,s=0,i=0;const a=r[0];ee(a!=null,"No pivot index found"),e.forEach((d,f)=>{const{constraints:p}=d,{maxSize:y=100,minSize:m=0}=p;f===a?(n=m,o=y):(s+=m,i+=y)});const l=Math.min(o,100-s),c=Math.max(n,100-i),u=t[a];return{valueMax:l,valueMin:c,valueNow:u}}function eo(t,e=document){return Array.from(e.querySelectorAll(`[${ye.resizeHandleId}][data-panel-group-id="${t}"]`))}function dg(t,e,r=document){const o=eo(t,r).findIndex(s=>s.getAttribute(ye.resizeHandleId)===e);return o??null}function hg(t,e,r){const n=dg(t,e,r);return n!=null?[n,n+1]:[-1,-1]}function JP(t){return t instanceof HTMLElement?!0:typeof t=="object"&&t!==null&&"tagName"in t&&"getAttribute"in t}function fg(t,e=document){if(JP(e)&&e.dataset.panelGroupId==t)return e;const r=e.querySelector(`[data-panel-group][data-panel-group-id="${t}"]`);return r||null}function js(t,e=document){const r=e.querySelector(`[${ye.resizeHandleId}="${t}"]`);return r||null}function YP(t,e,r,n=document){var o,s,i,a;const l=js(e,n),c=eo(t,n),u=l?c.indexOf(l):-1,d=(o=(s=r[u])===null||s===void 0?void 0:s.id)!==null&&o!==void 0?o:null,f=(i=(a=r[u+1])===null||a===void 0?void 0:a.id)!==null&&i!==void 0?i:null;return[d,f]}function ZP({committedValuesRef:t,eagerValuesRef:e,groupId:r,layout:n,panelDataArray:o,panelGroupElement:s,setLayout:i}){g.useRef({didWarnAboutMissingResizeHandle:!1}),dr(()=>{if(!s)return;const a=eo(r,s);for(let l=0;l<o.length-1;l++){const{valueMax:c,valueMin:u,valueNow:d}=XP({layout:n,panelsArray:o,pivotIndices:[l,l+1]}),f=a[l];if(f!=null){const p=o[l];ee(p,`No panel data found for index "${l}"`),f.setAttribute("aria-controls",p.id),f.setAttribute("aria-valuemax",""+Math.round(c)),f.setAttribute("aria-valuemin",""+Math.round(u)),f.setAttribute("aria-valuenow",d!=null?""+Math.round(d):"")}}return()=>{a.forEach((l,c)=>{l.removeAttribute("aria-controls"),l.removeAttribute("aria-valuemax"),l.removeAttribute("aria-valuemin"),l.removeAttribute("aria-valuenow")})}},[r,n,o,s]),g.useEffect(()=>{if(!s)return;const a=e.current;ee(a,"Eager values not found");const{panelDataArray:l}=a,c=fg(r,s);ee(c!=null,`No group found for id "${r}"`);const u=eo(r,s);ee(u,`No resize handles found for group id "${r}"`);const d=u.map(f=>{const p=f.getAttribute(ye.resizeHandleId);ee(p,"Resize handle element has no handle id attribute");const[y,m]=YP(r,p,l,s);if(y==null||m==null)return()=>{};const v=b=>{if(!b.defaultPrevented)switch(b.key){case"Enter":{b.preventDefault();const _=l.findIndex(w=>w.id===y);if(_>=0){const w=l[_];ee(w,`No panel data found for index ${_}`);const x=n[_],{collapsedSize:k=0,collapsible:C,minSize:S=0}=w.constraints;if(x!=null&&C){const N=Mn({delta:He(x,k)?S-k:k-x,initialLayout:n,panelConstraints:l.map(X=>X.constraints),pivotIndices:hg(r,p,s),prevLayout:n,trigger:"keyboard"});n!==N&&i(N)}}break}}};return f.addEventListener("keydown",v),()=>{f.removeEventListener("keydown",v)}});return()=>{d.forEach(f=>f())}},[s,t,e,r,n,o,i])}function ud(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function pg(t,e){const r=t==="horizontal",{x:n,y:o}=Is(e);return r?n:o}function QP(t,e,r,n,o){const s=r==="horizontal",i=js(e,o);ee(i,`No resize handle element found for id "${e}"`);const a=i.getAttribute(ye.groupId);ee(a,"Resize handle element has no group id attribute");let{initialCursorPosition:l}=n;const c=pg(r,t),u=fg(a,o);ee(u,`No group element found for id "${a}"`);const d=u.getBoundingClientRect(),f=s?d.width:d.height;return(c-l)/f*100}function eA(t,e,r,n,o,s){if(rg(t)){const i=r==="horizontal";let a=0;t.shiftKey?a=100:o!=null?a=o:a=10;let l=0;switch(t.key){case"ArrowDown":l=i?0:a;break;case"ArrowLeft":l=i?-a:0;break;case"ArrowRight":l=i?a:0;break;case"ArrowUp":l=i?0:-a;break;case"End":l=100;break;case"Home":l=-100;break}return l}else return n==null?0:QP(t,e,r,n,s)}function tA({panelDataArray:t}){const e=Array(t.length),r=t.map(s=>s.constraints);let n=0,o=100;for(let s=0;s<t.length;s++){const i=r[s];ee(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;a!=null&&(n++,e[s]=a,o-=a)}for(let s=0;s<t.length;s++){const i=r[s];ee(i,`Panel constraints not found for index ${s}`);const{defaultSize:a}=i;if(a!=null)continue;const l=t.length-n,c=o/l;n++,e[s]=c,o-=c}return e}function Hr(t,e,r){e.forEach((n,o)=>{const s=t[o];ee(s,`Panel data not found for index ${o}`);const{callbacks:i,constraints:a,id:l}=s,{collapsedSize:c=0,collapsible:u}=a,d=r[l];if(d==null||n!==d){r[l]=n;const{onCollapse:f,onExpand:p,onResize:y}=i;y&&y(n,d),u&&(f||p)&&(p&&(d==null||kt(d,c))&&!kt(n,c)&&p(),f&&(d==null||!kt(d,c))&&kt(n,c)&&f())}})}function Mo(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!=e[r])return!1;return!0}function rA({defaultSize:t,dragState:e,layout:r,panelData:n,panelIndex:o,precision:s=3}){const i=r[o];let a;return i==null?a=t!=null?t.toPrecision(s):"1":n.length===1?a="1":a=i.toPrecision(s),{flexBasis:0,flexGrow:a,flexShrink:1,overflow:"hidden",pointerEvents:e!==null?"none":void 0}}function nA(t,e=10){let r=null;return(...o)=>{r!==null&&clearTimeout(r),r=setTimeout(()=>{t(...o)},e)}}function dd(t){try{if(typeof localStorage<"u")t.getItem=e=>localStorage.getItem(e),t.setItem=(e,r)=>{localStorage.setItem(e,r)};else throw new Error("localStorage not supported in this environment")}catch(e){console.error(e),t.getItem=()=>null,t.setItem=()=>{}}}function gg(t){return`react-resizable-panels:${t}`}function mg(t){return t.map(e=>{const{constraints:r,id:n,idIsFromProps:o,order:s}=e;return o?n:s?`${s}:${JSON.stringify(r)}`:JSON.stringify(r)}).sort((e,r)=>e.localeCompare(r)).join(",")}function yg(t,e){try{const r=gg(t),n=e.getItem(r);if(n){const o=JSON.parse(n);if(typeof o=="object"&&o!=null)return o}}catch{}return null}function oA(t,e,r){var n,o;const s=(n=yg(t,r))!==null&&n!==void 0?n:{},i=mg(e);return(o=s[i])!==null&&o!==void 0?o:null}function sA(t,e,r,n,o){var s;const i=gg(t),a=mg(e),l=(s=yg(t,o))!==null&&s!==void 0?s:{};l[a]={expandToSizes:Object.fromEntries(r.entries()),layout:n};try{o.setItem(i,JSON.stringify(l))}catch(c){console.error(c)}}function hd({layout:t,panelConstraints:e}){const r=[...t],n=r.reduce((s,i)=>s+i,0);if(r.length!==e.length)throw Error(`Invalid ${e.length} panel layout: ${r.map(s=>`${s}%`).join(", ")}`);if(!He(n,100)&&r.length>0)for(let s=0;s<e.length;s++){const i=r[s];ee(i!=null,`No layout data found for index ${s}`);const a=100/n*i;r[s]=a}let o=0;for(let s=0;s<e.length;s++){const i=r[s];ee(i!=null,`No layout data found for index ${s}`);const a=Zr({panelConstraints:e,panelIndex:s,size:i});i!=a&&(o+=i-a,r[s]=a)}if(!He(o,0))for(let s=0;s<e.length;s++){const i=r[s];ee(i!=null,`No layout data found for index ${s}`);const a=i+o,l=Zr({panelConstraints:e,panelIndex:s,size:a});if(i!==l&&(o-=l-i,r[s]=l,He(o,0)))break}return r}const iA=100,Dn={getItem:t=>(dd(Dn),Dn.getItem(t)),setItem:(t,e)=>{dd(Dn),Dn.setItem(t,e)}},fd={};function vg({autoSaveId:t=null,children:e,className:r="",direction:n,forwardedRef:o,id:s=null,onLayout:i=null,keyboardResizeBy:a=null,storage:l=Dn,style:c,tagName:u="div",...d}){const f=wl(s),p=g.useRef(null),[y,m]=g.useState(null),[v,b]=g.useState([]),_=VP(),w=g.useRef({}),x=g.useRef(new Map),k=g.useRef(0),C=g.useRef({autoSaveId:t,direction:n,dragState:y,id:f,keyboardResizeBy:a,onLayout:i,storage:l}),S=g.useRef({layout:v,panelDataArray:[],panelDataArrayChanged:!1});g.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),g.useImperativeHandle(o,()=>({getId:()=>C.current.id,getLayout:()=>{const{layout:E}=S.current;return E},setLayout:E=>{const{onLayout:R}=C.current,{layout:A,panelDataArray:I}=S.current,T=hd({layout:E,panelConstraints:I.map(z=>z.constraints)});ud(A,T)||(b(T),S.current.layout=T,R&&R(T),Hr(I,T,w.current))}}),[]),dr(()=>{C.current.autoSaveId=t,C.current.direction=n,C.current.dragState=y,C.current.id=f,C.current.onLayout=i,C.current.storage=l}),ZP({committedValuesRef:C,eagerValuesRef:S,groupId:f,layout:v,panelDataArray:S.current.panelDataArray,setLayout:b,panelGroupElement:p.current}),g.useEffect(()=>{const{panelDataArray:E}=S.current;if(t){if(v.length===0||v.length!==E.length)return;let R=fd[t];R==null&&(R=nA(sA,iA),fd[t]=R);const A=[...E],I=new Map(x.current);R(t,A,I,v,l)}},[t,v,l]),g.useEffect(()=>{});const N=g.useCallback(E=>{const{onLayout:R}=C.current,{layout:A,panelDataArray:I}=S.current;if(E.constraints.collapsible){const T=I.map(Ve=>Ve.constraints),{collapsedSize:z=0,panelSize:ne,pivotIndices:ce}=nr(I,E,A);if(ee(ne!=null,`Panel size not found for panel "${E.id}"`),!kt(ne,z)){x.current.set(E.id,ne);const Ke=Vr(I,E)===I.length-1?ne-z:z-ne,ue=Mn({delta:Ke,initialLayout:A,panelConstraints:T,pivotIndices:ce,prevLayout:A,trigger:"imperative-api"});Mo(A,ue)||(b(ue),S.current.layout=ue,R&&R(ue),Hr(I,ue,w.current))}}},[]),X=g.useCallback((E,R)=>{const{onLayout:A}=C.current,{layout:I,panelDataArray:T}=S.current;if(E.constraints.collapsible){const z=T.map(Je=>Je.constraints),{collapsedSize:ne=0,panelSize:ce=0,minSize:Ve=0,pivotIndices:Ke}=nr(T,E,I),ue=R??Ve;if(kt(ce,ne)){const Je=x.current.get(E.id),Sn=Je!=null&&Je>=ue?Je:ue,$s=Vr(T,E)===T.length-1?ce-Sn:Sn-ce,$e=Mn({delta:$s,initialLayout:I,panelConstraints:z,pivotIndices:Ke,prevLayout:I,trigger:"imperative-api"});Mo(I,$e)||(b($e),S.current.layout=$e,A&&A($e),Hr(T,$e,w.current))}}},[]),B=g.useCallback(E=>{const{layout:R,panelDataArray:A}=S.current,{panelSize:I}=nr(A,E,R);return ee(I!=null,`Panel size not found for panel "${E.id}"`),I},[]),q=g.useCallback((E,R)=>{const{panelDataArray:A}=S.current,I=Vr(A,E);return rA({defaultSize:R,dragState:y,layout:v,panelData:A,panelIndex:I})},[y,v]),O=g.useCallback(E=>{const{layout:R,panelDataArray:A}=S.current,{collapsedSize:I=0,collapsible:T,panelSize:z}=nr(A,E,R);return ee(z!=null,`Panel size not found for panel "${E.id}"`),T===!0&&kt(z,I)},[]),se=g.useCallback(E=>{const{layout:R,panelDataArray:A}=S.current,{collapsedSize:I=0,collapsible:T,panelSize:z}=nr(A,E,R);return ee(z!=null,`Panel size not found for panel "${E.id}"`),!T||xr(z,I)>0},[]),M=g.useCallback(E=>{const{panelDataArray:R}=S.current;R.push(E),R.sort((A,I)=>{const T=A.order,z=I.order;return T==null&&z==null?0:T==null?-1:z==null?1:T-z}),S.current.panelDataArrayChanged=!0,_()},[_]);dr(()=>{if(S.current.panelDataArrayChanged){S.current.panelDataArrayChanged=!1;const{autoSaveId:E,onLayout:R,storage:A}=C.current,{layout:I,panelDataArray:T}=S.current;let z=null;if(E){const ce=oA(E,T,A);ce&&(x.current=new Map(Object.entries(ce.expandToSizes)),z=ce.layout)}z==null&&(z=tA({panelDataArray:T}));const ne=hd({layout:z,panelConstraints:T.map(ce=>ce.constraints)});ud(I,ne)||(b(ne),S.current.layout=ne,R&&R(ne),Hr(T,ne,w.current))}}),dr(()=>{const E=S.current;return()=>{E.layout=[]}},[]);const J=g.useCallback(E=>{let R=!1;const A=p.current;return A&&window.getComputedStyle(A,null).getPropertyValue("direction")==="rtl"&&(R=!0),function(T){T.preventDefault();const z=p.current;if(!z)return()=>null;const{direction:ne,dragState:ce,id:Ve,keyboardResizeBy:Ke,onLayout:ue}=C.current,{layout:Je,panelDataArray:Sn}=S.current,{initialLayout:ho}=ce??{},$s=hg(Ve,E,z);let $e=eA(T,E,ne,ce,Ke,z);const Sl=ne==="horizontal";Sl&&R&&($e=-$e);const wg=Sn.map(xg=>xg.constraints),kn=Mn({delta:$e,initialLayout:ho??Je,panelConstraints:wg,pivotIndices:$s,prevLayout:Je,trigger:rg(T)?"keyboard":"mouse-or-touch"}),kl=!Mo(Je,kn);(ng(T)||og(T))&&k.current!=$e&&(k.current=$e,!kl&&$e!==0?Sl?Ni(E,$e<0?ig:ag):Ni(E,$e<0?lg:cg):Ni(E,0)),kl&&(b(kn),S.current.layout=kn,ue&&ue(kn),Hr(Sn,kn,w.current))}},[]),V=g.useCallback((E,R)=>{const{onLayout:A}=C.current,{layout:I,panelDataArray:T}=S.current,z=T.map(Je=>Je.constraints),{panelSize:ne,pivotIndices:ce}=nr(T,E,I);ee(ne!=null,`Panel size not found for panel "${E.id}"`);const Ke=Vr(T,E)===T.length-1?ne-R:R-ne,ue=Mn({delta:Ke,initialLayout:I,panelConstraints:z,pivotIndices:ce,prevLayout:I,trigger:"imperative-api"});Mo(I,ue)||(b(ue),S.current.layout=ue,A&&A(ue),Hr(T,ue,w.current))},[]),re=g.useCallback((E,R)=>{const{layout:A,panelDataArray:I}=S.current,{collapsedSize:T=0,collapsible:z}=R,{collapsedSize:ne=0,collapsible:ce,maxSize:Ve=100,minSize:Ke=0}=E.constraints,{panelSize:ue}=nr(I,E,A);ue!=null&&(z&&ce&&kt(ue,T)?kt(T,ne)||V(E,ne):ue<Ke?V(E,Ke):ue>Ve&&V(E,Ve))},[V]),Y=g.useCallback((E,R)=>{const{direction:A}=C.current,{layout:I}=S.current;if(!p.current)return;const T=js(E,p.current);ee(T,`Drag handle element not found for id "${E}"`);const z=pg(A,R);m({dragHandleId:E,dragHandleRect:T.getBoundingClientRect(),initialCursorPosition:z,initialLayout:I})},[]),ie=g.useCallback(()=>{m(null)},[]),we=g.useCallback(E=>{const{panelDataArray:R}=S.current,A=Vr(R,E);A>=0&&(R.splice(A,1),delete w.current[E.id],S.current.panelDataArrayChanged=!0,_())},[_]),me=g.useMemo(()=>({collapsePanel:N,direction:n,dragState:y,expandPanel:X,getPanelSize:B,getPanelStyle:q,groupId:f,isPanelCollapsed:O,isPanelExpanded:se,reevaluatePanelConstraints:re,registerPanel:M,registerResizeHandle:J,resizePanel:V,startDragging:Y,stopDragging:ie,unregisterPanel:we,panelGroupElement:p.current}),[N,y,n,X,B,q,f,O,se,re,M,J,V,Y,ie,we]),P={display:"flex",flexDirection:n==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return g.createElement(Rs.Provider,{value:me},g.createElement(u,{...d,children:e,className:r,id:s,ref:p,style:{...P,...c},[ye.group]:"",[ye.groupDirection]:n,[ye.groupId]:f}))}const bg=g.forwardRef((t,e)=>g.createElement(vg,{...t,forwardedRef:e}));vg.displayName="PanelGroup";bg.displayName="forwardRef(PanelGroup)";function Vr(t,e){return t.findIndex(r=>r===e||r.id===e.id)}function nr(t,e,r){const n=Vr(t,e),s=n===t.length-1?[n-1,n]:[n,n+1],i=r[n];return{...e.constraints,panelSize:i,pivotIndices:s}}function aA({disabled:t,handleId:e,resizeHandler:r,panelGroupElement:n}){g.useEffect(()=>{if(t||r==null||n==null)return;const o=js(e,n);if(o==null)return;const s=i=>{if(!i.defaultPrevented)switch(i.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{i.preventDefault(),r(i);break}case"F6":{i.preventDefault();const a=o.getAttribute(ye.groupId);ee(a,`No group element found for id "${a}"`);const l=eo(a,n),c=dg(a,e,n);ee(c!==null,`No resize element found for id "${e}"`);const u=i.shiftKey?c>0?c-1:l.length-1:c+1<l.length?c+1:0;l[u].focus();break}}};return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}},[n,t,e,r])}function Ca({children:t=null,className:e="",disabled:r=!1,hitAreaMargins:n,id:o,onBlur:s,onClick:i,onDragging:a,onFocus:l,onPointerDown:c,onPointerUp:u,style:d={},tabIndex:f=0,tagName:p="div",...y}){var m,v;const b=g.useRef(null),_=g.useRef({onClick:i,onDragging:a,onPointerDown:c,onPointerUp:u});g.useEffect(()=>{_.current.onClick=i,_.current.onDragging=a,_.current.onPointerDown=c,_.current.onPointerUp=u});const w=g.useContext(Rs);if(w===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:x,groupId:k,registerResizeHandle:C,startDragging:S,stopDragging:N,panelGroupElement:X}=w,B=wl(o),[q,O]=g.useState("inactive"),[se,M]=g.useState(!1),[J,V]=g.useState(null),re=g.useRef({state:q});dr(()=>{re.current.state=q}),g.useEffect(()=>{if(r)V(null);else{const me=C(B);V(()=>me)}},[r,B,C]);const Y=(m=n?.coarse)!==null&&m!==void 0?m:15,ie=(v=n?.fine)!==null&&v!==void 0?v:5;g.useEffect(()=>{if(r||J==null)return;const me=b.current;ee(me,"Element ref not attached");let P=!1;return GP(B,me,x,{coarse:Y,fine:ie},(R,A,I)=>{if(!A){O("inactive");return}switch(R){case"down":{O("drag"),P=!1,ee(I,'Expected event to be defined for "down" action'),S(B,I);const{onDragging:T,onPointerDown:z}=_.current;T?.(!0),z?.();break}case"move":{const{state:T}=re.current;P=!0,T!=="drag"&&O("hover"),ee(I,'Expected event to be defined for "move" action'),J(I);break}case"up":{O("hover"),N();const{onClick:T,onDragging:z,onPointerUp:ne}=_.current;z?.(!1),ne?.(),P||T?.();break}}})},[Y,x,r,ie,C,B,J,S,N]),aA({disabled:r,handleId:B,resizeHandler:J,panelGroupElement:X});const we={touchAction:"none",userSelect:"none"};return g.createElement(p,{...y,children:t,className:e,id:o,onBlur:()=>{M(!1),s?.()},onFocus:()=>{M(!0),l?.()},ref:b,role:"separator",style:{...we,...d},tabIndex:f,[ye.groupDirection]:x,[ye.groupId]:k,[ye.resizeHandle]:"",[ye.resizeHandleActive]:q==="drag"?"pointer":se?"keyboard":void 0,[ye.resizeHandleEnabled]:!r,[ye.resizeHandleId]:B,[ye.resizeHandleState]:q})}Ca.displayName="PanelResizeHandle";const lA=fm(()=>Ht(()=>import("./JsonRoomEditor-hQoeR9kK.js").then(t=>t.J),__vite__mapDeps([8,1,2,6,9]))),cA=g.lazy(lA),uA=()=>{jP();const t=h.jsx("div",{className:"flex h-full items-center justify-center bg-pureBlack",children:h.jsx("span",{className:"sprite texture-animated-head_walking_right"})});return h.jsx(h.Fragment,{children:h.jsx(Sk,{children:h.jsx(el,{children:h.jsxs(bg,{direction:"horizontal",className:"w-full h-full",children:[h.jsx(Xo,{id:"jsonEditor",defaultSize:18,minSize:12,collapsible:!0,children:h.jsx(g.Suspense,{fallback:t,children:h.jsx(cA,{})})}),h.jsx(Ca,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-r-[calc(1px*var(--scale))] border-metallicBlue"}),h.jsx(Xo,{id:"editingArea",children:h.jsx(eP,{children:h.jsx(OP,{})})}),h.jsx(Ca,{className:"scale-editor w-1 bg-metallicBlueHalfbrite  hover:border-moss hover:bg-moss border-l-[calc(1px*var(--scale))] border-metallicBlue"}),h.jsx(Xo,{id:"toolbar",defaultSize:20,maxSize:33,minSize:10,children:h.jsx(Tk,{})})]})})})})},CA=Object.freeze(Object.defineProperty({__proto__:null,default:uA},Symbol.toStringTag,{value:"Module"}));export{Xd as A,qd as C,Yt as F,CA as L,Ma as R,Iy as S,Jd as V,zy as a,kA as b,vA as h,ge as t,Ry as u};
